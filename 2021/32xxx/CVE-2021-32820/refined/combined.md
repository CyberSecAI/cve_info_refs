=== Content from github.com_723400bf_20250114_222720.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fcommit%2F78c47a235c4ad7bc2674bddd8ec2721567ed8c72)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fcommit%2F78c47a235c4ad7bc2674bddd8ec2721567ed8c72)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=express-handlebars%2Fexpress-handlebars)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[express-handlebars](/express-handlebars)
/
**[express-handlebars](/express-handlebars/express-handlebars)**
Public

* [Notifications](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars) You must be signed in to change notification settings
* [Fork
  67](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars)
* [Star
   262](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars)

* [Code](/express-handlebars/express-handlebars)
* [Issues
  2](/express-handlebars/express-handlebars/issues)
* [Pull requests
  1](/express-handlebars/express-handlebars/pulls)
* [Actions](/express-handlebars/express-handlebars/actions)
* [Projects
  0](/express-handlebars/express-handlebars/projects)
* [Security](/express-handlebars/express-handlebars/security)
* [Insights](/express-handlebars/express-handlebars/pulse)

Additional navigation options

* [Code](/express-handlebars/express-handlebars)
* [Issues](/express-handlebars/express-handlebars/issues)
* [Pull requests](/express-handlebars/express-handlebars/pulls)
* [Actions](/express-handlebars/express-handlebars/actions)
* [Projects](/express-handlebars/express-handlebars/projects)
* [Security](/express-handlebars/express-handlebars/security)
* [Insights](/express-handlebars/express-handlebars/pulse)

## Commit

[Permalink](/express-handlebars/express-handlebars/commit/78c47a235c4ad7bc2674bddd8ec2721567ed8c72)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix: add note about security

[Browse files](/express-handlebars/express-handlebars/tree/78c47a235c4ad7bc2674bddd8ec2721567ed8c72)
Browse the repository at this point in the history

* Loading branch information

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&v=4)](/UziTech)

[UziTech](/express-handlebars/express-handlebars/commits?author=UziTech "View all commits by UziTech")
authored
May 4, 2021

1 parent
[2cde11e](/express-handlebars/express-handlebars/commit/2cde11e4d4b5aabf0c7bef5725eda629c51eeb92)

commit 78c47a2

Showing
**1 changed file**
with
**3 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/express-handlebars/express-handlebars/blob/78c47a235c4ad7bc2674bddd8ec2721567ed8c72/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -63,6 +63,9 @@ Install using npm: |
|  |  | $ npm install express-handlebars |
|  |  | ``` |
|  |  |  |
|  |  | ## Danger ðŸ”¥ |
|  |  |  |
|  |  | Never put objects on the `req` object straight in as the data, this can allow hackers to run XSS attacks. Always make sure you are destructuring the values on objects like `req.query` and `req.params`. See https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/ for more details. |
|  |  |  |
|  |  | ## Usage |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `78c47a2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fcommit%2F78c47a235c4ad7bc2674bddd8ec2721567ed8c72) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_23b012e8_20250114_222718.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fblob%2F78c47a235c4ad7bc2674bddd8ec2721567ed8c72%2FREADME.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fblob%2F78c47a235c4ad7bc2674bddd8ec2721567ed8c72%2FREADME.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=express-handlebars%2Fexpress-handlebars)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[express-handlebars](/express-handlebars)
/
**[express-handlebars](/express-handlebars/express-handlebars)**
Public

* [Notifications](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars) You must be signed in to change notification settings
* [Fork
  67](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars)
* [Star
   262](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars)

* [Code](/express-handlebars/express-handlebars)
* [Issues
  2](/express-handlebars/express-handlebars/issues)
* [Pull requests
  1](/express-handlebars/express-handlebars/pulls)
* [Actions](/express-handlebars/express-handlebars/actions)
* [Projects
  0](/express-handlebars/express-handlebars/projects)
* [Security](/express-handlebars/express-handlebars/security)
* [Insights](/express-handlebars/express-handlebars/pulse)

Additional navigation options

* [Code](/express-handlebars/express-handlebars)
* [Issues](/express-handlebars/express-handlebars/issues)
* [Pull requests](/express-handlebars/express-handlebars/pulls)
* [Actions](/express-handlebars/express-handlebars/actions)
* [Projects](/express-handlebars/express-handlebars/projects)
* [Security](/express-handlebars/express-handlebars/security)
* [Insights](/express-handlebars/express-handlebars/pulse)

## Files

Â 78c47a2
## Breadcrumbs

1. [express-handlebars](/express-handlebars/express-handlebars/tree/78c47a235c4ad7bc2674bddd8ec2721567ed8c72)
/
# README.md

Copy path Blame  Blame
## Latest commit

## History

[History](/express-handlebars/express-handlebars/commits/78c47a235c4ad7bc2674bddd8ec2721567ed8c72/README.md)599 lines (369 loc) Â· 26.3 KBÂ 78c47a2
## Breadcrumbs

1. [express-handlebars](/express-handlebars/express-handlebars/tree/78c47a235c4ad7bc2674bddd8ec2721567ed8c72)
/
# README.md

Top
## File metadata and controls

* Preview
* Code
* Blame

599 lines (369 loc) Â· 26.3 KB[Raw](https://github.com/express-handlebars/express-handlebars/raw/78c47a235c4ad7bc2674bddd8ec2721567ed8c72/README.md)
# Express Handlebars

A [Handlebars](https://github.com/handlebars-lang/handlebars.js) view engine for [Express](https://github.com/expressjs/express) which doesn't suck.

[![npm version](https://camo.githubusercontent.com/254671ffdf3dd4af6625452ece00080e0e0ef505bb844b279f7924b5fb394355/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f657870726573732d68616e646c65626172732e7376673f7374796c653d666c61742d737175617265)](https://www.npmjs.org/package/express-handlebars)
[![dependency status](https://camo.githubusercontent.com/7afa5044b09d3c90941a898e8f72e6b079b4e95739f746c54c448a039789c4b6/68747470733a2f2f696d672e736869656c64732e696f2f64617669642f657870726573732d68616e646c65626172732f657870726573732d68616e646c65626172732e7376673f7374796c653d666c61742d737175617265)](https://david-dm.org/express-handlebars/express-handlebars)

**This package used to be named `express3-handlebars`. The previous `express-handlebars` package by @jneen can be found [here](https://github.com/jneen/express-handlebars).**

## Goals & Design

I created this project out of frustration with the existing Handlebars view engines for Express. As of version 3.x, Express got out of the business of being a generic view engine â€” this was a great decision â€” leaving developers to implement the concepts of layouts, partials, and doing file I/O for their template engines of choice.

### Goals and Features

After building a half-dozen Express apps, I developed requirements and opinions about what a Handlebars view engine should provide and how it should be implemented. The following is that list:

* Add back the concept of "layout", which was removed in Express 3.x.
* Add back the concept of "partials" via Handlebars' partials mechanism.
* Support a directory of partials; e.g., `{{> foo/bar}}` which exists on the file system at `views/partials/foo/bar.handlebars`, by default.
* Smart file system I/O and template caching. When in development, templates are always loaded from disk. In production, raw files and compiled templates are cached, including partials.
* All async and non-blocking. File system I/O is slow and servers should not be blocked from handling requests while reading from disk. I/O queuing is used to avoid doing unnecessary work.
* Ability to easily precompile templates and partials for use on the client, enabling template sharing and reuse.
* Ability to use a different Handlebars module/implementation other than the Handlebars npm package.

### Package Design

This package was designed to work great for both the simple and complex use cases. I *intentionally* made sure the full implementation is exposed and is easily overridable.

The package exports a function which can be invoked with no arguments or with a `config` object and it will return a function (closed over sensible defaults) which can be registered with an Express app. It's an engine factory function.

This exported engine factory has two properties which expose the underlying implementation:

* `ExpressHandlebars()`: The constructor function which holds the internal implementation on its `prototype`. This produces instance objects which store their configuration, `compiled` and `precompiled` templates, and expose an `engine()` function which can be registered with an Express app.
* `create()`: A convenience factory function for creating `ExpressHandlebars` instances.

An instance-based approach is used so that multiple `ExpressHandlebars` instances can be created with their own configuration, templates, partials, and helpers.

## Installation

Install using npm:

```
$ npm install express-handlebars
```

## Danger ðŸ”¥

Never put objects on the `req` object straight in as the data, this can allow hackers to run XSS attacks. Always make sure you are destructuring the values on objects like `req.query` and `req.params`. See <https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/> for more details.

## Usage

This view engine uses sensible defaults that leverage the "Express-way" of structuring an app's views. This makes it trivial to use in basic apps:

### Basic Usage

**Directory Structure:**

```
.
â”œâ”€â”€ app.js
â””â”€â”€ views
    â”œâ”€â”€ home.handlebars
    â””â”€â”€ layouts
        â””â”€â”€ main.handlebars

2 directories, 3 files

```

**app.js:**

Creates a super simple Express app which shows the basic way to register a Handlebars view engine using this package.

```
var express = require('express');
var exphbs  = require('express-handlebars');

var app = express();

app.engine('handlebars', exphbs());
app.set('view engine', 'handlebars');

app.get('/', function (req, res) {
    res.render('home');
});

app.listen(3000);
```

**views/layouts/main.handlebars:**

The main layout is the HTML page wrapper which can be reused for the different views of the app. `{{{body}}}` is used as a placeholder for where the main content should be rendered.

```
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Example App</title>
</head>
<body>

    {{{body}}}

</body>
</html>
```

**views/home.handlebars:**

The content for the app's home view which will be rendered into the layout's `{{{body}}}`.

```
<h1>Example App: Home</h1>
```

#### Running the Example

The above example is bundled in this package's [examples directory](https://github.com/express-handlebars/express-handlebars/tree/master/examples), where it can be run by:

```
$ cd examples/basic/
$ npm install
$ npm start
```

### Using Instances

Another way to use this view engine is to create an instance(s) of `ExpressHandlebars`, allowing access to the full API:

```
var express = require('express');
var exphbs  = require('express-handlebars');

var app = express();
var hbs = exphbs.create({ /* config */ });

// Register `hbs.engine` with the Express app.
app.engine('handlebars', hbs.engine);
app.set('view engine', 'handlebars');

// ...still have a reference to `hbs`, on which methods like `getPartials()`
// can be called.
```

**Note:** The [Advanced Usage](https://github.com/express-handlebars/express-handlebars/tree/master/examples/advanced) example demonstrates how `ExpressHandlebars` instances can be leveraged.

### Template Caching

This view engine uses a smart template caching strategy. In development, templates will always be loaded from disk, i.e., no caching. In production, raw files and compiled Handlebars templates are aggressively cached.

The easiest way to control template/view caching is through Express' [view cache setting](https://expressjs.com/en/api.html#app.settings.table):

```
app.enable('view cache');
```

Express enables this setting by default when in production mode, i.e.:

```
process.env.NODE_ENV === "production"

```

**Note:** All of the public API methods accept `options.cache`, which gives control over caching when calling these methods directly.

### Layouts

A layout is simply a Handlebars template with a `{{{body}}}` placeholder. Usually it will be an HTML page wrapper into which views will be rendered.

This view engine adds back the concept of "layout", which was removed in Express 3.x. It can be configured with a path to the layouts directory, by default it's set to relative to `express settings.view` + `layouts/`

There are two ways to set a default layout: configuring the view engine's `defaultLayout` property, or setting [Express locals](https://expressjs.com/en/api.html#app.locals) `app.locals.layout`.

The layout into which a view should be rendered can be overridden per-request by assigning a different value to the `layout` request local. The following will render the "home" view with no layout:

```
app.get('/', function (req, res, next) {
    res.render('home', {layout: false});
});
```

### Helpers

Helper functions, or "helpers" are functions that can be [registered with Handlebars](https://github.com/wycats/handlebars.js/#registering-helpers) and can be called within a template. Helpers can be used for transforming output, iterating over data, etc. To keep with the spirit of *logic-less* templates, helpers are the place where logic should be defined.

Handlebars ships with some [built-in helpers](https://handlebarsjs.com/guide/builtin-helpers.html), such as: `with`, `if`, `each`, etc. Most application will need to extend this set of helpers to include app-specific logic and transformations. Beyond defining global helpers on `Handlebars`, this view engine supports `ExpressHandlebars` instance-level helpers via the `helpers` configuration property, and render-level helpers via `options.helpers` when calling the `render()` and `renderView()` methods.

The following example shows helpers being specified at each level:

**app.js:**

Creates a super simple Express app which shows the basic way to register `ExpressHandlebars` instance-level helpers, and override one at the render-level.

```
var express = require('express');
var exphbs  = require('express-handlebars');

var app = express();

var hbs = exphbs.create({
    // Specify helpers which are only registered on this instance.
    helpers: {
        foo: function () { return 'FOO!'; },
        bar: function () { return 'BAR!'; }
    }
});

app.engine('handlebars', hbs.engine);
app.set('view engine', 'handlebars');

app.get('/', function (req, res, next) {
    res.render('home', {
        showTitle: true,

        // Override `foo` helper only for this rendering.
        helpers: {
            foo: function () { return 'foo.'; }
        }
    });
});

app.listen(3000);
```

**views/home.handlebars:**

The app's home view which uses helper functions to help render the contents.

```
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Example App - Home</title>
</head>
<body>

    <!-- Uses built-in `if` helper. -->
  {{#if showTitle}}
    <h1>Home</h1>
  {{/if}}

    <!-- Calls `foo` helper, overridden at render-level. -->
    <p>{{foo}}</p>

    <!-- Calls `bar` helper, defined at instance-level. -->
    <p>{{bar}}</p>

</body>
</html>
```

#### More on Helpers

Refer to the [Handlebars website](https://handlebarsjs.com/) for more information on defining helpers:

* [Expression Helpers](https://handlebarsjs.com/guide/#custom-helpers)
* [Block Helpers](https://handlebarsjs.com/guide/#block-helpers)

### Metadata

Handlebars has a data channel feature that propagates data through all scopes, including helpers and partials. Values in the data channel can be accessed via the `{{@variable}}` syntax. Express Handlebars provides metadata about a template it renders on a `{{@exphbs}}` object allowing access to things like the view name passed to `res.render()` via `{{@exphbs.view}}`.

The following is the list of metadata that's accessible on the `{{@exphbs}}` data object:

* `cache`: Boolean whether or not the template is cached.
* `encoding`: String name of encoding for files.
* `view`: String name of the view passed to `res.render()`.
* `layout`: String name of the layout view.
* `data`: Original data object passed when rendering the template.
* `helpers`: Collection of helpers used when rendering the template.
* `partials`: Collection of partials used when rendering the template.
* `runtimeOptions`: Runtime Options used to render the template.

## API

### Configuration and Defaults

There are two main ways to use this package: via its engine factory function, or creating `ExpressHandlebars` instances; both use the same configuration properties and defaults.

```
var exphbs = require('express-handlebars');

// Using the engine factory:
exphbs({ /* config */ });

// Create an instance:
exphbs.create({ /* config */ });
```

The following is the list of configuration properties and their default values (if any):

#### `handlebars=require('handlebars')`

The Handlebars module/implementation. This allows for the `ExpressHandlebars` instance to use a different Handlebars module/implementation than that provided by the Handlebars npm package.

#### `extname=".handlebars"`

The string name of the file extension used by the templates. This value should correspond with the `extname` under which this view engine is registered with Express when calling `app.engine()`.

The following example sets up an Express app to use `.hbs` as the file extension for views:

```
var express = require('express');
var exphbs  = require('express-handlebars');

var app = express();

app.engine('.hbs', exphbs({extname: '.hbs'}));
app.set('view engine', '.hbs');
```

**Note:** Setting the app's `"view engine"` setting will make that value the default file extension used for looking up views.

#### `encoding="utf8"`

Default encoding when reading files.

#### `layoutsDir`

Default layouts directory is relative to `express settings.view` + `layouts/`
The string path to the directory where the layout templates reside.

**Note:** If you configure Express to look for views in a custom location (e.g., `app.set('views', 'some/path/')`), and if your `layoutsDir` is not relative to `express settings.view` + `layouts/`, you will need to reflect that by passing an updated path as the `layoutsDir` property in your configuration.

#### `partialsDir`

Default partials directory is relative to `express settings.view` + `partials/`
The string path to the directory where the partials templates reside or object with the following properties:

* `dir`: The string path to the directory where the partials templates reside.
* `namespace`: Optional string namespace to prefix the partial names.
* `templates`: Optional collection (or promise of a collection) of templates in the form: `{filename: template}`.
* `rename(filePath, namespace)`: Optional function to rename the partials. Takes two arguments: `filePath`, e.g., `partials/some/path/template.handlebars` and `namespace`.

**Note:** If you configure Express to look for views in a custom location (e.g., `app.set('views', 'some/path/')`), and if your `partialsDir` is not relative to `express settings.view` + `partials/`, you will need to reflect that by passing an updated path as the `partialsDir` property in your configuration.

**Note:** Multiple partials dirs can be used by making `partialsDir` an array of strings, and/or config objects as described above. The namespacing feature is useful if multiple partials dirs are used and their file paths might clash.

#### `defaultLayout`

The string name or path of a template in the `layoutsDir` to use as the default layout. `main` is used as the default. This is overridden by a `layout` specified in the app or response `locals`. **Note:** A falsy value will render without a layout; e.g., `res.render('home', {layout: false});`. You can also use a falsy value when creating the engine to make using no layout a default e.g. `app.engine('.hbs', exphbs({defaultLayout: false}));`.

#### `helpers`

An object which holds the helper functions used when rendering templates with this `ExpressHandlebars` instance. When rendering a template, a collection of helpers will be generated by merging: `handlebars.helpers` (global), `helpers` (instance), and `options.helpers` (render-level). This allows Handlebars' `registerHelper()` function to operate as expected, will providing two extra levels over helper overrides.

#### `compilerOptions`

An object which holds options that will be passed along to the Handlebars compiler functions: `Handlebars.compile()` and `Handlebars.precompile()`.

#### `runtimeOptions`

An object which holds options that will be passed along to the template function in addition to the `data`, `helpers`, and `partials` options. See [Runtime Options](https://handlebarsjs.com/api-reference/runtime-options.html) for a list of available options.

### Properties

The public API properties are provided via `ExpressHandlebars` instances. In additional to the properties listed in the **Configuration and Defaults** section, the following are additional public properties:

#### `engine`

A function reference to the `renderView()` method which is bound to `this` `ExpressHandlebars` instance. This bound function should be used when registering this view engine with an Express app.

#### `extname`

The normalized `extname` which will *always* start with `.` and defaults to `.handlebars`.

#### `compiled`

An object cache which holds compiled Handlebars template functions in the format: `{"path/to/template": [Function]}`.

#### `precompiled`

An object cache which holds precompiled Handlebars template strings in the format: `{"path/to/template": [String]}`.

### Methods

The following is the list of public API methods provided via `ExpressHandlebars` instances:

**Note:** All of the public methods return a [`Promise`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) (with the exception of `renderView()` which is the interface with Express.)

#### `getPartials([options])`

Retrieves the partials in the `partialsDir` and returns a Promise for an object mapping the partials in the form `{name: partial}`.

By default each partial will be a compiled Handlebars template function. Use `options.precompiled` to receive the partials as precompiled templates â€” this is useful for sharing templates with client code.

**Parameters:**

* `[options]`: Optional object containing any of the following properties:

  + `[cache]`: Whether cached templates can be used if they have already been requested. This is recommended for production to avoid unnecessary file I/O.
  + `[encoding]`: File encoding.
  + `[precompiled=false]`: Whether precompiled templates should be provided, instead of compiled Handlebars template functions.

The name of each partial corresponds to its location in `partialsDir`. For example, consider the following directory structure:

```
views
â””â”€â”€ partials
    â”œâ”€â”€ foo
    â”‚Â Â  â””â”€â”€ bar.handlebars
    â””â”€â”€ title.handlebars

2 directories, 2 files

```

`getPartials()` would produce the following result:

```
var hbs = require('express-handlebars').create();

hbs.getPartials().then(function (partials) {
    console.log(partials);
    // => { 'foo/bar': [Function],
    // =>    title: [Function] }
});
```

#### `getTemplate(filePath, [options])`

Retrieves the template at the specified `filePath` and returns a Promise for the compiled Handlebars template function.

Use `options.precompiled` to receive a precompiled Handlebars template.

**Parameters:**

* `filePath`: String path to the Handlebars template file.
* `[options]`: Optional object containing any of the following properties:

  + `[cache]`: Whether a cached template can be used if it have already been requested. This is recommended for production to avoid necessary file I/O.
  + `[encoding]`: File encoding.
  + `[precompiled=false]`: Whether a precompiled template should be provided, instead of a compiled Handlebars template function.

#### `getTemplates(dirPath, [options])`

Retrieves all the templates in the specified `dirPath` and returns a Promise for an object mapping the compiled templates in the form `{filename: template}`.

Use `options.precompiled` to receive precompiled Handlebars templates â€” this is useful for sharing templates with client code.

**Parameters:**

* `dirPath`: String path to the directory containing Handlebars template files.
* `[options]`: Optional object containing any of the following properties:

  + `[cache]`: Whether cached templates can be used if it have already been requested. This is recommended for production to avoid necessary file I/O.
  + `[encoding]`: File encoding.
  + `[precompiled=false]`: Whether precompiled templates should be provided, instead of a compiled Handlebars template function.

#### `render(filePath, context, [options])`

Renders the template at the specified `filePath` with the `context`, using this instance's `helpers` and partials by default, and returns a Promise for the resulting string.

**Parameters:**

* `filePath`: String path to the Handlebars template file.
* `context`: Object in which the template will be executed. This contains all of the values to fill into the template.
* `[options]`: Optional object which can contain any of the following properties which affect this view engine's behavior:

  + `[cache]`: Whether a cached template can be used if it have already been requested. This is recommended for production to avoid unnecessary file I/O.
  + `[encoding]`: File encoding.
  + `[data]`: Optional object which can contain any data that Handlebars will pipe through the template, all helpers, and all partials. This is a side data channel.
  + `[helpers]`: Render-level helpers that will be used instead of any instance-level helpers; these will be merged with (and will override) any global Handlebars helper functions.
  + `[partials]`: Render-level partials that will be used instead of any instance-level partials. This is used internally as an optimization to avoid re-loading all the partials.
  + `[runtimeOptions]`: Optional object which can contain options passed to the template function.

#### `renderView(viewPath, options|callback, [callback])`

Renders the template at the specified `viewPath` as the `{{{body}}}` within the layout specified by the `defaultLayout` or `options.layout`. Rendering will use this instance's `helpers` and partials, and passes the resulting string to the `callback`.

This method is called by Express and is the main entry point into this Express view engine implementation. It adds the concept of a "layout" and delegates rendering to the `render()` method.

The `options` will be used both as the context in which the Handlebars templates are rendered, and to signal this view engine on how it should behave, e.g., `options.cache=false` will *always* load the templates from disk.

**Parameters:**

* `viewPath`: String path to the Handlebars template file which should serve as the `{{{body}}}` when using a layout.
* `[options]`: Optional object which will serve as the context in which the Handlebars templates are rendered. It may also contain any of the following properties which affect this view engine's behavior:

  + `[cache]`: Whether cached templates can be used if they have already been requested. This is recommended for production to avoid unnecessary file I/O.
  + `[encoding]`: File encoding.
  + `[data]`: Optional object which can contain any data that Handlebars will pipe through the template, all helpers, and all partials. This is a side data channel.
  + `[helpers]`: Render-level helpers that will be merged with (and will override) instance and global helper functions.
  + `[partials]`: Render-level partials will be merged with (and will override) instance and global partials. This should be a `{partialName: fn}` hash or a Promise of an object with this shape.
  + `[layout]`: Optional string path to the Handlebars template file to be used as the "layout". This overrides any `defaultLayout` value. Passing a falsy value will render with no layout (even if a `defaultLayout` is defined).
  + `[runtimeOptions]`: Optional object which can contain options passed to the template function.
* `callback`: Function to call once the template is retrieved.

### Hooks

The following is the list of protected methods that are called internally and serve as *hooks* to override functionality of `ExpressHandlebars` instances. A value or a promise can be returned from these methods which allows them to perform async operations.

#### `_compileTemplate(template, options)`

This hook will be called when a Handlebars template needs to be compiled. This function needs to return a compiled Handlebars template function, or a promise for one.

By default this hook calls `Handlebars.compile()`, but it can be overridden to preform operations before and/or after Handlebars compiles the template. This is useful if you wanted to first process Markdown within a Handlebars template.

**Parameters:**

* `template`: String Handlebars template that needs to be compiled.
* `options`: Object `compilerOptions` that were specified when the `ExpressHandlebars` instance as created. This object should be passed along to the `Handlebars.compile()` function.

#### `_precompileTemplate(template, options)`

This hook will be called when a Handlebars template needs to be precompiled. This function needs to return a serialized Handlebars template spec. string, or a promise for one.

By default this hook calls `Handlebars.precompile()`, but it can be overridden to preform operations before and/or after Handlebars precompiles the template. This is useful if you wanted to first process Markdown within a Handlebars template.

**Parameters:**

* `template`: String Handlebars template that needs to be precompiled.
* `options`: Object `compilerOptions` that were specified when the `ExpressHandlebars` instance as created. This object should be passed along to the `Handlebars.compile()` function.

#### `_renderTemplate(template, context, options)`

This hook will be called when a compiled Handlebars template needs to be rendered. This function needs to returned the rendered output string, or a promise for one.

By default this hook simply calls the passed-in `template` with the `context` and `options` arguments, but it can be overridden to perform operations before and/or after rendering the template.

**Parameters:**

* `template`: Compiled Handlebars template function to call.
* `context`: The context object in which to render the `template`.
* `options`: Object that contains options and metadata for rendering the template:

  + `data`: Object to define custom `@variable` private variables.
  + `helpers`: Object to provide custom helpers in addition to the globally defined helpers.
  + `partials`: Object to provide custom partials in addition to the globally defined partials.
  + `...runtimeOptions`: Other options specified by the `runtimeOptions` value.

## Examples

### [Basic Usage](https://github.com/express-handlebars/express-handlebars/tree/master/examples/basic)

This example shows the most basic way to use this view engine.

### [Advanced Usage](https://github.com/express-handlebars/express-handlebars/tree/master/examples/advanced)

This example is more comprehensive and shows how to use many of the features of this view engine, including helpers, partials, multiple layouts, etc.

As noted in the **Package Design** section, this view engine's implementation is instance-based, and more advanced usages can take advantage of this. The Advanced Usage example demonstrates how to use an `ExpressHandlebars` instance to share templates with the client, among other features.

## License

This software is free to use under the Yahoo! Inc. BSD license. See the [LICENSE file](https://github.com/express-handlebars/express-handlebars/blob/master/LICENSE) for license text and copyright information.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.npmjs.com_8e20c76e_20250114_222730.html ===

skip to:[content](#main)[package search](#search)[sign in](#signin)Ã¢ÂÂ¤

* [Pro](/products/pro)
* [Teams](/products/teams)
* [Pricing](/products)
* [Documentation](https://docs.npmjs.com)
npmSearch[Sign Up](/signup)[Sign In](/login)
## express-handlebarsTypeScript icon, indicating that this package has built-in type declarations

8.0.1Ã‚Â Ã¢Â€Â¢Ã‚Â PublicÃ‚Â Ã¢Â€Â¢Ã‚Â Published 5 months ago

* [Readme](?activeTab=readme)
* [Code Beta](?activeTab=code)
* [3 Dependencies](?activeTab=dependencies)
* [798 Dependents](?activeTab=dependents)
* [57 Versions](?activeTab=versions)

# Express Handlebars

A [Handlebars](https://github.com/handlebars-lang/handlebars.js) view engine for [Express](https://github.com/expressjs/express) which doesn't suck.

[![npm version](https://camo.githubusercontent.com/46e5c467497188c5f722c72a04c3161d85f001a2f97074e709d2198831f62e19/68747470733a2f2f696d672e736869656c64732e696f2f6e706d2f762f657870726573732d68616e646c65626172732e7376673f7374796c653d666c61742d737175617265)](https://www.npmjs.org/package/express-handlebars)

**This package used to be named `express3-handlebars`. The previous `express-handlebars` package by @jneen can be found [here](https://github.com/jneen/express-handlebars).**

## Goals & Design

I created this project out of frustration with the existing Handlebars view engines for Express. As of version 3.x, Express got out of the business of being a generic view engine Ã¢Â€Â” this was a great decision Ã¢Â€Â” leaving developers to implement the concepts of layouts, partials, and doing file I/O for their template engines of choice.

### Goals and Features

After building a half-dozen Express apps, I developed requirements and opinions about what a Handlebars view engine should provide and how it should be implemented. The following is that list:

* Add back the concept of "layout", which was removed in Express 3.x.
* Add back the concept of "partials" via Handlebars' partials mechanism.
* Support a directory of partials; e.g., `{{> foo/bar}}` which exists on the file system at `views/partials/foo/bar.handlebars`, by default.
* Smart file system I/O and template caching. When in development, templates are always loaded from disk. In production, raw files and compiled templates are cached, including partials.
* All async and non-blocking. File system I/O is slow and servers should not be blocked from handling requests while reading from disk. I/O queuing is used to avoid doing unnecessary work.
* Ability to easily precompile templates and partials for use on the client, enabling template sharing and reuse.
* Ability to use a different Handlebars module/implementation other than the Handlebars npm package.

### Package Design

This package was designed to work great for both the simple and complex use cases. I *intentionally* made sure the full implementation is exposed and is easily overridable.

The package exports a function which can be invoked with no arguments or with a `config` object and it will return a function (closed over sensible defaults) which can be registered with an Express app. It's an engine factory function.

This exported engine factory has two properties which expose the underlying implementation:

* `ExpressHandlebars()`: The constructor function which holds the internal implementation on its `prototype`. This produces instance objects which store their configuration, `compiled` and `precompiled` templates, and expose an `engine()` function which can be registered with an Express app.
* `create()`: A convenience factory function for creating `ExpressHandlebars` instances.

An instance-based approach is used so that multiple `ExpressHandlebars` instances can be created with their own configuration, templates, partials, and helpers.

## Installation

Install using npm:

```
$ npm install express-handlebars
```

## Danger Ã°ÂŸÂ”Â¥

Never put objects on the `req` object straight in as the data, this can allow hackers to run XSS attacks. Always make sure you are destructuring the values on objects like `req.query` and `req.params`. See <https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/> for more details.

## Usage

This view engine uses sensible defaults that leverage the "Express-way" of structuring an app's views. This makes it trivial to use in basic apps:

### Basic Usage

**Directory Structure:**

```
.
Ã¢Â”ÂœÃ¢Â”Â€Ã¢Â”Â€ app.js
Ã¢Â”Â”Ã¢Â”Â€Ã¢Â”Â€ views
    Ã¢Â”ÂœÃ¢Â”Â€Ã¢Â”Â€ home.handlebars
    Ã¢Â”Â”Ã¢Â”Â€Ã¢Â”Â€ layouts
        Ã¢Â”Â”Ã¢Â”Â€Ã¢Â”Â€ main.handlebars

2 directories, 3 files

```

**app.js:**

Creates a super simple Express app which shows the basic way to register a Handlebars view engine using this package.

```
import express from 'express';
import { engine } from 'express-handlebars';

const app = express();

app.engine('handlebars', engine());
app.set('view engine', 'handlebars');
app.set('views', './views');

app.get('/', (req, res) => {
    res.render('home');
});

app.listen(3000);
```

**views/layouts/main.handlebars:**

The main layout is the HTML page wrapper which can be reused for the different views of the app. `{{{body}}}` is used as a placeholder for where the main content should be rendered.

```
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Example App</title>
</head>
<body>

    {{{body}}}

</body>
</html>
```

**views/home.handlebars:**

The content for the app's home view which will be rendered into the layout's `{{{body}}}`.

```
<h1>Example App: Home</h1>
```

#### Running the Example

The above example is bundled in this package's [examples directory](https://github.com/express-handlebars/express-handlebars/tree/master/examples), where it can be run by:

```
$ cd examples/basic/
$ npm install
$ npm start
```

### Using Instances

Another way to use this view engine is to create an instance(s) of `ExpressHandlebars`, allowing access to the full API:

```
import express from 'express';
import { create } from 'express-handlebars';

const app = express();
const hbs = create({ /* config */ });

// Register `hbs.engine` with the Express app.
app.engine('handlebars', hbs.engine);
app.set('view engine', 'handlebars');
app.set('views', './views');

// ...still have a reference to `hbs`, on which methods like `getPartials()`
// can be called.
```

**Note:** The [Advanced Usage](https://github.com/express-handlebars/express-handlebars/tree/master/examples/advanced) example demonstrates how `ExpressHandlebars` instances can be leveraged.

### Template Caching

This view engine uses a smart template caching strategy. In development, templates will always be loaded from disk, i.e., no caching. In production, raw files and compiled Handlebars templates are aggressively cached.

The easiest way to control template/view caching is through Express' [view cache setting](https://expressjs.com/en/api.html#app.settings.table):

```
app.enable('view cache');
```

Express enables this setting by default when in production mode, i.e.:

```
process.env.NODE_ENV === "production"

```

**Note:** All of the public API methods accept `options.cache`, which gives control over caching when calling these methods directly.

### Layouts

A layout is simply a Handlebars template with a `{{{body}}}` placeholder. Usually it will be an HTML page wrapper into which views will be rendered.

This view engine adds back the concept of "layout", which was removed in Express 3.x. It can be configured with a path to the layouts directory, by default it's set to relative to `express settings.view` + `layouts/`

There are two ways to set a default layout: configuring the view engine's `defaultLayout` property, or setting [Express locals](https://expressjs.com/en/api.html#app.locals) `app.locals.layout`.

The layout into which a view should be rendered can be overridden per-request by assigning a different value to the `layout` request local. The following will render the "home" view with no layout:

```
app.get('/', (req, res, next) => {
    res.render('home', {layout: false});
});
```

### Helpers

Helper functions, or "helpers" are functions that can be [registered with Handlebars](https://github.com/wycats/handlebars.js/#registering-helpers) and can be called within a template. Helpers can be used for transforming output, iterating over data, etc. To keep with the spirit of *logic-less* templates, helpers are the place where logic should be defined.

Handlebars ships with some [built-in helpers](https://handlebarsjs.com/guide/builtin-helpers.html), such as: `with`, `if`, `each`, etc. Most applications will need to extend this set of helpers to include app-specific logic and transformations. Beyond defining global helpers on `Handlebars`, this view engine supports `ExpressHandlebars` instance-level helpers via the `helpers` configuration property, and render-level helpers via `options.helpers` when calling the `render()` and `renderView()` methods.

The following example shows helpers being specified at each level:

**app.js:**

Creates a super simple Express app which shows the basic way to register `ExpressHandlebars` instance-level helpers, and override one at the render-level.

```
import express from 'express';
import { create } from 'express-handlebars';

const app = express();

const hbs = create({
    // Specify helpers which are only registered on this instance.
    helpers: {
        foo() { return 'FOO!'; },
        bar() { return 'BAR!'; }
    }
});

app.engine('handlebars', hbs.engine);
app.set('view engine', 'handlebars');
app.set('views', './views');

app.get('/', (req, res, next) => {
    res.render('home', {
        showTitle: true,

        // Override `foo` helper only for this rendering.
        helpers: {
            foo() { return 'foo.'; }
        }
    });
});

app.listen(3000);
```

**views/home.handlebars:**

The app's home view which uses helper functions to help render the contents.

```
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Example App - Home</title>
</head>
<body>

    <!-- Uses built-in `if` helper. -->
  {{#if showTitle}}
    <h1>Home</h1>
  {{/if}}

    <!-- Calls `foo` helper, overridden at render-level. -->
    <p>{{foo}}</p>

    <!-- Calls `bar` helper, defined at instance-level. -->
    <p>{{bar}}</p>

</body>
</html>
```

#### More on Helpers

Refer to the [Handlebars website](https://handlebarsjs.com/) for more information on defining helpers:

* [Expression Helpers](https://handlebarsjs.com/guide/#custom-helpers)
* [Block Helpers](https://handlebarsjs.com/guide/#block-helpers)

### Metadata

Handlebars has a data channel feature that propagates data through all scopes, including helpers and partials. Values in the data channel can be accessed via the `{{@variable}}` syntax. Express Handlebars provides metadata about a template it renders on a `{{@exphbs}}` object allowing access to things like the view name passed to `res.render()` via `{{@exphbs.view}}`.

The following is the list of metadata that's accessible on the `{{@exphbs}}` data object:

* `cache`: Boolean whether or not the template is cached.
* `encoding`: String name of encoding for files.
* `view`: String name of the view passed to `res.render()`.
* `layout`: String name of the layout view.
* `data`: Original data object passed when rendering the template.
* `helpers`: Collection of helpers used when rendering the template.
* `partials`: Collection of partials used when rendering the template.
* `runtimeOptions`: Runtime Options used to render the template.

## API

### Configuration and Defaults

There are two main ways to use this package: via its engine factory function, or creating `ExpressHandlebars` instances; both use the same configuration properties and defaults.

```
import { engine, create, ExpressHandlebars } from 'express-handlebars';

// Using the engine factory:
engine({ /* config */ });

// Create an instance:
create({ /* config */ });

// Using the class:
new ExpressHandlebars({ /* config */})
```

The following is the list of configuration properties and their default values (if any):

#### `handlebars=require('handlebars')`

The Handlebars module/implementation. This allows for the `ExpressHandlebars` instance to use a different Handlebars module/implementation than that provided by the Handlebars npm package.

#### `extname=".handlebars"`

The string name of the file extension used by the templates. This value should correspond with the `extname` under which this view engine is registered with Express when calling `app.engine()`.

The following example sets up an Express app to use `.hbs` as the file extension for views:

```
import express from 'express';
import { engine } from 'express-handlebars';

const app = express();

app.engine('.hbs', engine({extname: '.hbs'}));
app.set('view engine', '.hbs');
app.set('views', './views');
```

**Note:** Setting the app's `"view engine"` setting will make that value the default file extension used for looking up views.

#### `encoding="utf8"`

Default encoding when reading files.

#### `layoutsDir`

Default layouts directory is relative to `express settings.view` + `layouts/`
The string path to the directory where the layout templates reside.

**Note:** If you configure Express to look for views in a custom location (e.g., `app.set('views', 'some/path/')`), and if your `layoutsDir` is not relative to `express settings.view` + `layouts/`, you will need to reflect that by passing an updated path as the `layoutsDir` property in your configuration.

#### `partialsDir`

Default partials directory is relative to `express settings.view` + `partials/`
The string path to the directory where the partials templates reside or object with the following properties:

* `dir`: The string path to the directory where the partials templates reside.
* `namespace`: Optional string namespace to prefix the partial names.
* `templates`: Optional collection (or promise of a collection) of templates in the form: `{filename: template}`.
* `rename(filePath, namespace)`: Optional function to rename the partials. Takes two arguments: `filePath`, e.g., `partials/some/path/template.handlebars` and `namespace`.

**Note:** If you configure Express to look for views in a custom location (e.g., `app.set('views', 'some/path/')`), and if your `partialsDir` is not relative to `express settings.view` + `partials/`, you will need to reflect that by passing an updated path as the `partialsDir` property in your configuration.

**Note:** Multiple partials dirs can be used by making `partialsDir` an array of strings, and/or config objects as described above. The namespacing feature is useful if multiple partials dirs are used and their file paths might clash.

#### `defaultLayout`

The string name or path of a template in the `layoutsDir` to use as the default layout. `main` is used as the default. This is overridden by a `layout` specified in the app or response `locals`. **Note:** A falsy value will render without a layout; e.g., `res.render('home', {layout: false});`. You can also use a falsy value when creating the engine to make using no layout a default e.g. `app.engine('.hbs', exphbs({defaultLayout: false}));`.

#### `helpers`

An object which holds the helper functions used when rendering templates with this `ExpressHandlebars` instance. When rendering a template, a collection of helpers will be generated by merging: `handlebars.helpers` (global), `helpers` (instance), and `options.helpers` (render-level). This allows Handlebars' `registerHelper()` function to operate as expected, will providing two extra levels over helper overrides.

#### `compilerOptions`

An object which holds options that will be passed along to the Handlebars compiler functions: `Handlebars.compile()` and `Handlebars.precompile()`.

#### `runtimeOptions`

An object which holds options that will be passed along to the template function in addition to the `data`, `helpers`, and `partials` options. See [Runtime Options](https://handlebarsjs.com/api-reference/runtime-options.html) for a list of available options.

### Properties

The public API properties are provided via `ExpressHandlebars` instances. In additional to the properties listed in the **Configuration and Defaults** section, the following are additional public properties:

#### `engine`

A function reference to the `renderView()` method which is bound to `this` `ExpressHandlebars` instance. This bound function should be used when registering this view engine with an Express app.

#### `extname`

The normalized `extname` which will *always* start with `.` and defaults to `.handlebars`.

#### `compiled`

An object cache which holds compiled Handlebars template functions in the format: `{"path/to/template": [Function]}`.

#### `precompiled`

An object cache which holds precompiled Handlebars template strings in the format: `{"path/to/template": [String]}`.

### Methods

The following is the list of public API methods provided via `ExpressHandlebars` instances:

**Note:** All of the public methods return a [`Promise`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) (with the exception of `renderView()` which is the interface with Express.)

#### `getPartials([options])`

Retrieves the partials in the `partialsDir` and returns a Promise for an object mapping the partials in the form `{name: partial}`.

By default each partial will be a compiled Handlebars template function. Use `options.precompiled` to receive the partials as precompiled templates Ã¢Â€Â” this is useful for sharing templates with client code.

**Parameters:**

* `[options]`: Optional object containing any of the following properties:

  + `[cache]`: Whether cached templates can be used if they have already been requested. This is recommended for production to avoid unnecessary file I/O.
  + `[encoding]`: File encoding.
  + `[precompiled=false]`: Whether precompiled templates should be provided, instead of compiled Handlebars template functions.

The name of each partial corresponds to its location in `partialsDir`. For example, consider the following directory structure:

```
views
Ã¢Â”Â”Ã¢Â”Â€Ã¢Â”Â€ partials
    Ã¢Â”ÂœÃ¢Â”Â€Ã¢Â”Â€ foo
    Ã¢Â”Â‚Ã‚Â Ã‚Â  Ã¢Â”Â”Ã¢Â”Â€Ã¢Â”Â€ bar.handlebars
    Ã¢Â”Â”Ã¢Â”Â€Ã¢Â”Â€ title.handlebars

2 directories, 2 files

```

`getPartials()` would produce the following result:

```
import { create } from 'express-handlebars';

const hbs = create();
hbs.getPartials().then(function (partials) {
    console.log(partials);
    // => { 'foo/bar': [Function],
    // =>    title: [Function] }
});
```

#### `getTemplate(filePath, [options])`

Retrieves the template at the specified `filePath` and returns a Promise for the compiled Handlebars template function.

Use `options.precompiled` to receive a precompiled Handlebars template.

**Parameters:**

* `filePath`: String path to the Handlebars template file.
* `[options]`: Optional object containing any of the following properties:

  + `[cache]`: Whether a cached template can be used if it have already been requested. This is recommended for production to avoid necessary file I/O.
  + `[encoding]`: File encoding.
  + `[precompiled=false]`: Whether a precompiled template should be provided, instead of a compiled Handlebars template function.

#### `getTemplates(dirPath, [options])`

Retrieves all the templates in the specified `dirPath` and returns a Promise for an object mapping the compiled templates in the form `{filename: template}`.

Use `options.precompiled` to receive precompiled Handlebars templates Ã¢Â€Â” this is useful for sharing templates with client code.

**Parameters:**

* `dirPath`: String path to the directory containing Handlebars template files.
* `[options]`: Optional object containing any of the following properties:

  + `[cache]`: Whether cached templates can be used if it have already been requested. This is recommended for production to avoid necessary file I/O.
  + `[encoding]`: File encoding.
  + `[precompiled=false]`: Whether precompiled templates should be provided, instead of a compiled Handlebars template function.

#### `resetCache([filePathsOrFilter])`

Reset template cache. The cache can be partially reset by providing a filter argument. If no argument is given the whole cache will be reset.

**Parameters:**

* `[filePathsOrFilter]`: Optional filter to reset part of the cache. This can be a file path, an array of file paths, or a filter function based on file path.

#### `render(filePath, context, [options])`

Renders the template at the specified `filePath` with the `context`, using this instance's `helpers` and partials by default, and returns a Promise for the resulting string.

**Parameters:**

* `filePath`: String path to the Handlebars template file.
* `context`: Object in which the template will be executed. This contains all of the values to fill into the template.
* `[options]`: Optional object which can contain any of the following properties which affect this view engine's behavior:

  + `[cache]`: Whether a cached template can be used if it have already been requested. This is recommended for production to avoid unnecessary file I/O.
  + `[encoding]`: File encoding.
  + `[data]`: Optional object which can contain any data that Handlebars will pipe through the template, all helpers, and all partials. This is a side data channel.
  + `[helpers]`: Render-level helpers that will be used instead of any instance-level helpers; these will be merged with (and will override) any global Handlebars helper functions.
  + `[partials]`: Render-level partials that will be used instead of any instance-level partials. This is used internally as an optimization to avoid re-loading all the partials.
  + `[runtimeOptions]`: Optional object which can contain options passed to the template function.

#### `renderView(viewPath, options|callback, [callback])`

Renders the template at the specified `viewPath` as the `{{{body}}}` within the layout specified by the `defaultLayout` or `options.layout`. Rendering will use this instance's `helpers` and partials, and passes the resulting string to the `callback`.

This method is called by Express and is the main entry point into this Express view engine implementation. It adds the concept of a "layout" and delegates rendering to the `render()` method.

The `options` will be used both as the context in which the Handlebars templates are rendered, and to signal this view engine on how it should behave, e.g., `options.cache=false` will *always* load the templates from disk.

**Parameters:**

* `viewPath`: String path to the Handlebars template file which should serve as the `{{{body}}}` when using a layout.
* `[options]`: Optional object which will serve as the context in which the Handlebars templates are rendered. It may also contain any of the following properties which affect this view engine's behavior:

  + `[cache]`: Whether cached templates can be used if they have already been requested. This is recommended for production to avoid unnecessary file I/O.
  + `[encoding]`: File encoding.
  + `[data]`: Optional object which can contain any data that Handlebars will pipe through the template, all helpers, and all partials. This is a side data channel.
  + `[helpers]`: Render-level helpers that will be merged with (and will override) instance and global helper functions.
  + `[partials]`: Render-level partials will be merged with (and will override) instance and global partials. This should be a `{partialName: fn}` hash or a Promise of an object with this shape.
  + `[layout]`: Optional string path to the Handlebars template file to be used as the "layout". This overrides any `defaultLayout` value. Passing a falsy value will render with no layout (even if a `defaultLayout` is defined).
  + `[runtimeOptions]`: Optional object which can contain options passed to the template function.
* `callback`: Function to call once the template is retrieved.

### Hooks

The following is the list of protected methods that are called internally and serve as *hooks* to override functionality of `ExpressHandlebars` instances. A value or a promise can be returned from these methods which allows them to perform async operations.

#### `_compileTemplate(template, options)`

This hook will be called when a Handlebars template needs to be compiled. This function needs to return a compiled Handlebars template function, or a promise for one.

By default this hook calls `Handlebars.compile()`, but it can be overridden to preform operations before and/or after Handlebars compiles the template. This is useful if you wanted to first process Markdown within a Handlebars template.

**Parameters:**

* `template`: String Handlebars template that needs to be compiled.
* `options`: Object `compilerOptions` that were specified when the `ExpressHandlebars` instance as created. This object should be passed along to the `Handlebars.compile()` function.

#### `_precompileTemplate(template, options)`

This hook will be called when a Handlebars template needs to be precompiled. This function needs to return a serialized Handlebars template spec. string, or a promise for one.

By default this hook calls `Handlebars.precompile()`, but it can be overridden to preform operations before and/or after Handlebars precompiles the template. This is useful if you wanted to first process Markdown within a Handlebars template.

**Parameters:**

* `template`: String Handlebars template that needs to be precompiled.
* `options`: Object `compilerOptions` that were specified when the `ExpressHandlebars` instance as created. This object should be passed along to the `Handlebars.compile()` function.

#### `_renderTemplate(template, context, options)`

This hook will be called when a compiled Handlebars template needs to be rendered. This function needs to returned the rendered output string, or a promise for one.

By default this hook simply calls the passed-in `template` with the `context` and `options` arguments, but it can be overridden to perform operations before and/or after rendering the template.

**Parameters:**

* `template`: Compiled Handlebars template function to call.
* `context`: The context object in which to render the `template`.
* `options`: Object that contains options and metadata for rendering the template:

  + `data`: Object to define custom `@variable` private variables.
  + `helpers`: Object to provide custom helpers in addition to the globally defined helpers.
  + `partials`: Object to provide custom partials in addition to the globally defined partials.
  + `...runtimeOptions`: Other options specified by the `runtimeOptions` value.

## Examples

### [Basic Usage](https://github.com/express-handlebars/express-handlebars/tree/master/examples/basic)

This example shows the most basic way to use this view engine.

### [Advanced Usage](https://github.com/express-handlebars/express-handlebars/tree/master/examples/advanced)

This example is more comprehensive and shows how to use many of the features of this view engine, including helpers, partials, multiple layouts, etc.

As noted in the **Package Design** section, this view engine's implementation is instance-based, and more advanced usages can take advantage of this. The Advanced Usage example demonstrates how to use an `ExpressHandlebars` instance to share templates with the client, among other features.

## License

This software is free to use under the Yahoo! Inc. BSD license. See the [LICENSE file](https://github.com/express-handlebars/express-handlebars/blob/master/LICENSE) for license text and copyright information.

## Readme

### Keywords

* [express](/search?q=keywords:express)
* [express3](/search?q=keywords:express3)
* [handlebars](/search?q=keywords:handlebars)
* [view](/search?q=keywords:view)
* [layout](/search?q=keywords:layout)
* [partials](/search?q=keywords:partials)
* [templates](/search?q=keywords:templates)
## Package Sidebar

### Install

`npm i express-handlebars`

### Repository

[Gitgithub.com/express-handlebars/express-handlebars](https://github.com/express-handlebars/express-handlebars)

### Homepage

[github.com/express-handlebars/express-handlebars](https://github.com/express-handlebars/express-handlebars)

### DownloadsWeekly Downloads

282,697

### Version

8.0.1

### License

BSD-3-Clause

### Unpacked Size

142 kB

### Total Files

37

### Last publish

5 months ago

### Collaborators

* [![ericf](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9jZjMzODQxOTE4ZDkwZmU5NDFmNTIyZGRlNWVlNGZmMD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.Q1GdX92OVfmGS1Dmev6CXG_S22wX4FTdkADgIBeQ6OM "ericf")](/~ericf)
* [![sahat](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci9lMzQ1YmNmYTQwNTljNmNhZWJlZGVjMTU5N2Y5ZWI1Zj9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.uXIFG5pn3u62UJgBF8AoKlS9Rzu2Yo44gsSDqLDnoNk "sahat")](/~sahat)
* [![tonybrix](/npm-avatar/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdmF0YXJVUkwiOiJodHRwczovL3MuZ3JhdmF0YXIuY29tL2F2YXRhci8zYTY2MDUxYzVhMzM4MzM3OWE1Mzk0MmY3YWJiNDcyZD9zaXplPTEwMCZkZWZhdWx0PXJldHJvIn0.oc3bRT9LqKoAUmsFix-vK0y4MbLVJDgk7AGKHNbHFY8 "tonybrix")](/~tonybrix)
[**Try** on RunKit](https://runkit.com/npm/express-handlebars)[**Report** malware](/support?inquire=security&security-inquire=malware&package=express-handlebars&version=8.0.1)
## Footer

### Support

* [Help](https://docs.npmjs.com)
* [Advisories](https://github.com/advisories)
* [Status](http://status.npmjs.org/)
* [Contact npm](/support)
### Company

* [About](/about)
* [Blog](https://github.blog/tag/npm/)
* [Press](/press)
### Terms & Policies

* [Policies](/policies/)
* [Terms of Use](/policies/terms)
* [Code of Conduct](/policies/conduct)
* [Privacy](/policies/privacy)



=== Content from github.com_cf350ee5_20250114_222726.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fpull%2F163)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fpull%2F163)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=express-handlebars%2Fexpress-handlebars)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[express-handlebars](/express-handlebars)
/
**[express-handlebars](/express-handlebars/express-handlebars)**
Public

* [Notifications](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars) You must be signed in to change notification settings
* [Fork
  67](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars)
* [Star
   262](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars)

* [Code](/express-handlebars/express-handlebars)
* [Issues
  2](/express-handlebars/express-handlebars/issues)
* [Pull requests
  1](/express-handlebars/express-handlebars/pulls)
* [Actions](/express-handlebars/express-handlebars/actions)
* [Projects
  0](/express-handlebars/express-handlebars/projects)
* [Security](/express-handlebars/express-handlebars/security)
* [Insights](/express-handlebars/express-handlebars/pulse)

Additional navigation options

* [Code](/express-handlebars/express-handlebars)
* [Issues](/express-handlebars/express-handlebars/issues)
* [Pull requests](/express-handlebars/express-handlebars/pulls)
* [Actions](/express-handlebars/express-handlebars/actions)
* [Projects](/express-handlebars/express-handlebars/projects)
* [Security](/express-handlebars/express-handlebars/security)
* [Insights](/express-handlebars/express-handlebars/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fexpress-handlebars%2Fexpress-handlebars%2Fissues%2Fnew%2Fchoose)

By clicking â€œSign up for GitHubâ€, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). Weâ€™ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fexpress-handlebars%2Fexpress-handlebars%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# fix: use `context` property for template variables #163

 Closed

[UziTech](/UziTech)
wants to merge
3
commits into
[express-handlebars:master](/express-handlebars/express-handlebars/tree/master "express-handlebars/express-handlebars:master")
from
[UziTech:options-data](/UziTech/express-handlebars/tree/options-data "UziTech/express-handlebars:options-data")

 Closed

# [fix: use `context` property for template variables](#top) #163

[UziTech](/UziTech)
wants to merge
3
commits into
[express-handlebars:master](/express-handlebars/express-handlebars/tree/master "express-handlebars/express-handlebars:master")
from
[UziTech:options-data](/UziTech/express-handlebars/tree/options-data "UziTech/express-handlebars:options-data")

[Conversation
7](/express-handlebars/express-handlebars/pull/163)
[Commits
3](/express-handlebars/express-handlebars/pull/163/commits)
[Checks
0](/express-handlebars/express-handlebars/pull/163/checks)
[Files changed](/express-handlebars/express-handlebars/pull/163/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![UziTech](https://avatars.githubusercontent.com/u/97994?s=60&v=4)](/UziTech)

Copy link

Member

### @UziTech **[UziTech](/UziTech)** commented [Apr 29, 2021](#issue-871398325) â€¢ edited Loading

# BREAKING CHANGE:

An object passed to template data will need to be passed as an object in the `context` property.

This prevents mixing untrusted data with express-handlebars options.

For more information see <https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/>

Thanks [@agustingianni](https://github.com/agustingianni) for bringing this to my attention.

**Example:**

```
<h1>Hi, {{name}}</h1>
```

**<= v5**

```
res.render('hi', {name: "Tony", layout: false})
```

**v6**

```
res.render('hi', {context: {name: "Tony"}, layout: false})
```

Sorry, something went wrong.

All reactions

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&v=4)](/UziTech)

`[fix: use context property for template variables](/express-handlebars/express-handlebars/pull/163/commits/187194b997d83f4316684471d7dcaedba5fc2068 "fix: use `context` property for template variables

BREAKING CHANGE:

An object passed to template data with need to be passed as an object in the `context` property.
This prevents mixing untrusted data with express-handlebars options.
For more information see https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/

**Example:**

```handlebars
<h1>Hi, {{name}}</h1>
```

**<= v5**

```js
res.render('hi', {name: \"Tony\", layout: false})
```

**v6**

```js
res.render('hi', {context: {name: \"Tony\"}, layout: false})
```")`
 â€¦

`[187194b](/express-handlebars/express-handlebars/pull/163/commits/187194b997d83f4316684471d7dcaedba5fc2068)`

```
BREAKING CHANGE:

An object passed to template data with need to be passed as an object in the `context` property.
This prevents mixing untrusted data with express-handlebars options.
For more information see <https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/>

**Example:**

```handlebars
<h1>Hi, {{name}}</h1>
```

**<= v5**

```js
res.render('hi', {name: "Tony", layout: false})
```

**v6**

```js
res.render('hi', {context: {name: "Tony"}, layout: false})
```
```

 [![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)
[UziTech](/UziTech)
[force-pushed](/express-handlebars/express-handlebars/compare/db292ce85875ea8b5870e6a68a0ad10926f5bdd3..187194b997d83f4316684471d7dcaedba5fc2068)
the
options-data

branch
from
[`db292ce`](/express-handlebars/express-handlebars/commit/db292ce85875ea8b5870e6a68a0ad10926f5bdd3) to
[`187194b`](/express-handlebars/express-handlebars/commit/187194b997d83f4316684471d7dcaedba5fc2068)  [Compare](/express-handlebars/express-handlebars/compare/db292ce85875ea8b5870e6a68a0ad10926f5bdd3..187194b997d83f4316684471d7dcaedba5fc2068)
[April 29, 2021 19:35](#event-4664828139)

 [UziTech](/UziTech)
added 2 commits
[April 29, 2021 14:59](#commits-pushed-4f0689b)

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&v=4)](/UziTech)

`[chore(readme): update readme to reflect context property](/express-handlebars/express-handlebars/pull/163/commits/4f0689b7fbbc9a00d82eed46c1e9f0d6c9c16bcc "chore(readme): update readme to reflect `context` property")`

`[4f0689b](/express-handlebars/express-handlebars/pull/163/commits/4f0689b7fbbc9a00d82eed46c1e9f0d6c9c16bcc)`

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&v=4)](/UziTech)

`[chore(examples): update advanced example with context property](/express-handlebars/express-handlebars/pull/163/commits/35b1f7804ef15500571c2f5ebec7a1b06751a3ca "chore(examples): update advanced example with `context` property")`

`[35b1f78](/express-handlebars/express-handlebars/pull/163/commits/35b1f7804ef15500571c2f5ebec7a1b06751a3ca)`

[![@agustingianni](https://avatars.githubusercontent.com/u/102623?s=80&u=b1c72cebb72a49012050bf4aa25e55ccc5d513f2&v=4)](/agustingianni)

Copy link

### **[agustingianni](/agustingianni)** commented [May 4, 2021](#issuecomment-831784607)

| Hello, thanks for tagging me and sorry for the slight delay, I've been swamped with work. I will give it a look now. |
| --- |

All reactions

Sorry, something went wrong.

[![@agustingianni](https://avatars.githubusercontent.com/u/102623?s=80&u=b1c72cebb72a49012050bf4aa25e55ccc5d513f2&v=4)](/agustingianni)

Copy link

### **[agustingianni](/agustingianni)** commented [May 4, 2021](#issuecomment-831819881)

| So with this change if you force users to pass the template arguments via `{ context: { ... } }` that should stop the attack, but I think this is not whats happening from my understanding of the code. If the user supplies an object that does not have the `context` handlebars just creates a default one and proceeds with the rendering:  ``` 	async renderView (viewPath, options = {}, callback = null) { 		const context = options.context || {};     } ```  My concern would be that users that call res.render("name", taintedObject) are still vulnerable because `taintedObject` can be made in a way that it has the `context` key recently introduced **and** they still can override the same set of properties that allow for the bug to happen.  The problem with trying to fix this is that the problem is at three different levels, first the user uses the `express` render method in a way that is dangerous, second express merges the object passed by the user with data that is intended to be used by the underlying template engine, and third the renderer assumes that the configuration data comming from express is trustworthy.  In my opinion the most balanced way to fix this is to warn clients of handlebars to never pass objects whose keys are attacker controlled to the `render` method. This also has the benefit of not breaking the API for your users.  This is what `eta` did to address the same issue here, <https://eta.js.org/docs/examples/express> while they wait for `express` to implement a better API for the next big release.  Until then, I can't imagine a proper solution to the issue.  Let me know what you think! |
| --- |

All reactions

Sorry, something went wrong.

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=80&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)

Copy link

Member

Author

### **[UziTech](/UziTech)** commented [May 4, 2021](#issuecomment-831969731)

| Thanks! I added a [note](https://github.com/express-handlebars/express-handlebars#danger-) to the readme about this. |
| --- |

All reactions

Sorry, something went wrong.

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=80&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)

Copy link

Member

Author

### **[UziTech](/UziTech)** commented [May 4, 2021](#issuecomment-831973378)

| I'm going to hold off on this type of change until express fixes their API. Express v5 has been in alpha for almost 7 years ðŸ¤ž they will release it one of these days ðŸ¤£. |
| --- |

All reactions

Sorry, something went wrong.

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)
[UziTech](/UziTech)
closed this
[May 4, 2021](#event-4683632057)

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)
[UziTech](/UziTech)
reopened this
[May 4, 2021](#event-4683632275)

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)
[UziTech](/UziTech)
closed this
[May 4, 2021](#event-4683633673)

[![@agustingianni](https://avatars.githubusercontent.com/u/102623?s=80&u=b1c72cebb72a49012050bf4aa25e55ccc5d513f2&v=4)](/agustingianni)

Copy link

### **[agustingianni](/agustingianni)** commented [May 10, 2021](#issuecomment-836472539)

| Fantastic [@UziTech](https://github.com/UziTech) thank you for your time addressing this issue! |
| --- |

All reactions

Sorry, something went wrong.

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=40&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)
[UziTech](/UziTech)
mentioned this pull request
[Jun 7, 2021](#ref-issue-913218029)

[Security Vulnerability Issue [CVE-2021-32820]
#184](/express-handlebars/express-handlebars/issues/184)

Closed

[![@bavarianbytes](https://avatars.githubusercontent.com/u/17915115?s=80&u=ef66884a4e762a7132edb1494334f2e6d2c6f2eb&v=4)](/bavarianbytes)

Copy link

### **[bavarianbytes](/bavarianbytes)** commented [Mar 22, 2022](#issuecomment-1075048720)

| Is it still neccessary to put template variables in a `context` object when passing to the `render` method? Can't find anything about that in the current documentation.  If yes, is it right that i need to access these variables in the handlebar template by calling `{{context.myvariable}}`? |
| --- |

All reactions

Sorry, something went wrong.

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=80&u=62a0ac50424c26046bdcf839a82d9ffa15972579&v=4)](/UziTech)

Copy link

Member

Author

### **[UziTech](/UziTech)** commented [Mar 22, 2022](#issuecomment-1075247932)

| [@bavarianbytes](https://github.com/bavarianbytes) no this change was not merged as it didn't fix the underlying vulnerability. The documentation should be correct. |
| --- |

 ðŸ‘
1
 bavarianbytes reacted with thumbs up emoji

All reactions

* ðŸ‘
  1 reaction

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fexpress-handlebars%2Fexpress-handlebars%2Fpull%2F163)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@UziTech](https://avatars.githubusercontent.com/u/97994?s=52&v=4)](/UziTech) [![@agustingianni](https://avatars.githubusercontent.com/u/102623?s=52&v=4)](/agustingianni) [![@bavarianbytes](https://avatars.githubusercontent.com/u/17915115?s=52&v=4)](/bavarianbytes)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from securitylab.github.com_84ac3d0f_20250114_222728.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

May 14, 2021
# GHSL-2021-018: File disclosure in Express Handlebars - CVE-2021-32820

[![Author avatar](https://avatars.githubusercontent.com/u/102623)
Agustin Gianni](https://github.com/agustingianni)

## Coordinated Disclosure Timeline

* 01/25/2021: Report sent to maintainers.
* 01/28/2021: Maintainers acknowledged report.
* 04/29/2021: Maintainers proposed a fix.
* 05/04/2021: Proposed fix was found to be ineffective.
* 05/04/2021: Maintainers added documentation warning users about the potential danger of the pattern.

## Executive Summary

[The Express render API](https://expressjs.com/en/api.html#res.render) was designed to only pass in template data. By allowing template engine configuration options to be passed through the Express render API directly, downstream users of an Express template engine may inadvertently introduce insecure behavior into their applications with impacts ranging from Cross Site Scripting (XSS) to Remote Code Execution (RCE).

## Technical Summary

[Express JS](https://expressjs.com/) allows developers to use a variety of template rendering engines. These engines substitute things inside the template by inspecting an object that the application has supplied. For example, the following snippet renders a template named â€œindexâ€ and passes an object with two elements, a title, and a message.

```

app.get('/', function (req, res) {
 res.render('index', { title: 'Hey', message: 'Hello there!' })
})

```

Template engines often need a way to set their configuration parameters, such as the path to the template directory, the name of the template, and other engine-specific parameters. To accomplish this many template engines have opted to receive their configuration options directly through the Express render API.

Passing template engine configuration parameters through the Express render API can lead to vulnerabilities if the object is user controlled. Downstream applications often opt to pass their template data in directly through the remote user-controlled `req.query` object. This results in a scenario where a remote attacker may be able to subvert the vulnerable application through malicious template engine configuration options.

The security impact is specific to the engine used by the application but ranges from XSS to RCE.

IMPORTANT: this is a library/engine level API misuse resulting in a **potential** vulnerability in downstream application code. Express did **not** intend for render engines to mix template data with configuration options in the same object. We have confirmed this in discussion with the ExpressJS team.

Real world downstream vulnerabilities manifest when applications pass a user controlled object (e.g. req.query) directly into a render engine that accepts config options through the Express render interface.

Our research has shown that this vulnerability pattern occurs in the wild and that many template engines are following this unintended Express render API pattern of use, resulting in an unknown number of affected downstream applications.

By reporting this API misuse at the engine level, we hope to capture this issue more broadly than trying to pursue every single affected application as well as prevent future API misuse.

## Product

Express Handlebars

## Tested Version

v5.2.0

## Details

### Issue: template engine configuration options are passed through Express render API

Express-handlebars mixes pure template data with engine configuration options through the Express render API. More specifically, the `layout` parameter may trigger file disclosure vulnerabilities in downstream applications.

This potential vulnerability is somewhat restricted in that only files with existing extentions (i.e. `file.extension`) can be included, files that lack an extension will have `.handlebars` appended to them.

Example vulnerable application code:

```
app.js
const express = require('express');
const exphbs  = require('express-handlebars');
const app = express();

app.engine('handlebars', exphbs());
app.set('view engine', 'handlebars');
app.get('/', function (req, res) {
   res.render('home', req.query);
});

app.listen(3000);

```

The following POC would retrieve the contents of the `/tmp/test.file` from a vulnerable application:

```
curl "http://localhost:3000?layout=/tmp/test.file"

```
#### Impact

File disclosure.

#### Resources

* <https://expressjs.com/en/api.html#res.render>
* <http://expressjs.com/en/guide/using-template-engines.html>
* <http://expressjs.com/en/advanced/developing-template-engines.html>

## CVE

* CVE-2021-32820

## Resources

* <https://github.com/express-handlebars/express-handlebars#danger->
* <https://github.com/express-handlebars/express-handlebars/pull/163>

## Credit

This issue was discovered and reported by GHSL team member [@agustingianni (Agustin Gianni)](https://github.com/agustingianni).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2021-018` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. Â©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information


