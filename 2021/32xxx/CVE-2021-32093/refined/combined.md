=== Content from blog.sonarsource.com_33416c79_20250114_224952.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar’s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# Code Vulnerabilities in NSA Application Revealed

![](data:image/svg+xml;charset=utf-8...)![Dennis Brinkrolf photo]()![Dennis Brinkrolf photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/4e33a3d4-6781-4fe3-aaa3-0ec178d00386/d118d723-bccb-4102-9d5c-ccf1a2a99e5f_dennis_brinkrolf.png?w=400&h=400&auto=format&fit=crop)

Dennis Brinkrolf

Security Researcher

April 6, 2021

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![Our security research team discovered multiple code vulnerabilities in the NSA's Java application Emissary. Find out more about these issues and related attacks.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/74a10024-5c8b-4bf5-98f7-912db043ad58/cover-70ba2589-455f-41cb-87a0-820e0765a379_NSA_emissary_blogpost%25402x.png?w=2400&h=1200&auto=format&fit=crop)![Our security research team discovered multiple code vulnerabilities in the NSA's Java application Emissary. Find out more about these issues and related attacks.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/74a10024-5c8b-4bf5-98f7-912db043ad58/cover-70ba2589-455f-41cb-87a0-820e0765a379_NSA_emissary_blogpost%25402x.png?w=2400&h=1200&auto=format&fit=crop)

Emissary is a P2P based data-driven workflow engine that runs in a heterogeneous possibly widely dispersed, multi-tiered P2P network of compute resources. The application’s Java source code is distributed by the official [GitHub repository](https://github.com/NationalSecurityAgency/emissary "GitHub repository") of the U.S. National Security Agency (NSA). An interesting pick for our research team to look at its code security.

In our analysis, we discovered several code vulnerabilities in Emissary version 5.9.0. A combination of these vulnerabilities allows remote attackers to execute arbitrary system commands on any Emissary server. All in all, this may lead to the compromise of the whole P2P network.

In this blog post we analyze the technical root cause of three different security issues and demonstrate how attackers could exploit these. We reported all issues responsibly to the affected vendor who released multiple security patches to protect all users against the most severe vulnerabilities.

## Impact

During the analysis of Emissary 5.9.0 we found the following code vulnerabilities that enable different ways to attack the application:

* Code Injection (CVE-2021-32096)
* Arbitrary File Upload (CVE-2021-32094)
* Arbitrary File Disclosure (CVE-2021-32093)
* Arbitrary File Delete (CVE-2021-32095)
* Reflected Cross-site-Scripting (CVE-2021-32092)

Access to the web application (and its vulnerable features) is protected by HTTP Digest Authentication. By default, there is only one administrator account that has access to the web application. However, the web application is vulnerable to Cross-Site Request Forgery (CSRF) attacks. This allows an attacker to abuse the browser of an authenticated victim to manipulate the state of the web application. For example, the CSRF vulnerability can be combined with the Code Injection vulnerability to achieve remote code execution. You can find out more about CSRF and how it can be exploited by attackers in our [previous blog post](/blog/hack-the-stack-with-localstack/ "previous blog post").

For demonstration purposes we’ve created a short video that shows how quick and easy a server is compromised.

Emissary - Remote Code Execution vulnerability

## Technical Analysis

In the following, we look at the root cause of three vulnerabilities in the source code of Emissary. First we introduce the Code Injection vulnerability that can be exploited via CSRF. In the next step, we analyse two vulnerabilities (Arbitrary File Disclosure, Cross-site Scripting) that can be combined by an attacker to extract the administrator credentials of the HTTP Digest Authentication used by Emissary.

### Remote Ruby Code Execution (CVE-2021-32096)

The administration area of Emissary includes a console feature to evaluate Ruby code. Since the entire web application does not use CSRF tokens, an attacker can execute arbitrary Ruby code on the server through the browser of a logged-in administrator. Let’s have a look at the source code.

**src/main/java/emissary/server/mvc/ConsoleAction.java**

```
 47   @POST
 48   @Path("/Console.action")
 49   @Produces(MediaType.TEXT_PLAIN)
 50   public Response rubyConsolePost(@Context HttpServletRequest request) {
 52       RubyConsole console = getOrCreateConsole(request);
 56       try {
 57           final String cmd = request.getParameter(CONSOLE_COMMAND);
 67           if ("eval".equals(cmd)) {
 69               String commandString = request.getParameter(CONSOLE_COMMAND_STRING);
 70               if (commandString != null) {
 79               try {
 80                   result = console.evalAndWait(commandString, 60000);
 81               }
 92           }
 94       }
118   }
```

In line 57 the user controlled post parameter `CONSOLE_COMMAND` is received and in line 67 it is checked if this parameter is equal to the string *eval*. If it is, the next attacker controlled post variable `CONSOLE_COMMAND_STRING` is received in line 69 and passed to the function `evalAndWait()` from the class `RubyConsole` in line 80. When following the function `evalAndWait()` we will get to the `eval()` function as shown below.

**src/main/java/emissary/scripting/RubyConsole.java**

```
331   public Object eval(String expression) throws Exception{
332       Object result = null;
333       try{
334           result = rubyEngine.eval(expression,rubyContext);
339       }
349   }
```

The function `eval()` receives a Ruby `expression` as the first parameter which can be controlled by an attacker in order to execute the vulnerable function `eval()` of the Ruby engine in line 334. This allows an attacker to inject arbitrary Ruby code for execution on the server ([S5334](https://rules.sonarsource.com/java/RSPEC-5334 "S5334")).

The Ruby Console is obviously intended as a feature and is not an actual vulnerability. The problem is, however, that the web application does not use CSRF tokens and an adversary can thus abuse any feature of the software within an attack.

### Leaking the Admin Password

Further, we detected an Arbitrary File Disclosure and Cross-site Scripting vulnerability. Both can be combined to read arbitrary files from the Emissary server. For example, an attacker could read the stored admin credentials for the HTTP Digest Authentication and then login to Emissary as an administrator to take over the installation.

![](data:image/svg+xml;charset=utf-8...)![Emissary file disclosure vulnerability]()![Emissary file disclosure vulnerability](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/80e3fbe9-0765-498f-b714-d85797f9f185/body-2ee69d16-508b-4030-963c-02247c85c14b_blog_post_file_read.png?w=568&h=349&auto=format&fit=crop)
### Arbitrary File Disclosure (CVE-2021-32093)

Emissary’s feature to show certain configuration files contains a File Disclosure vulnerability ([S2083](https://rules.sonarsource.com/java/RSPEC-2083 "S2083")) that can be used to read any file from the server. In line 35, the user-controlled HTTP GET variable `CONFIG_PARAM` is received from the query string. The variable `configName` is not sanitized and can contain any file path. The content of the opened file in line 44 is then printed in line 45.

**src/main/java/emissary/server/mvc/internal/ConfigFileAction.java**

```
32   @GET
33   @Path("/ConfigFile.action")
34   @Produces(MediaType.TEXT_PLAIN)
35   public Response configFile(@QueryParam(CONFIG_PARAM) String configName) {
36       try {
44           String content = IOUtils.toString(
                 ConfigUtil.getConfigStream(configName), StandardCharsets.UTF_8);
45           return Response.ok().entity(content).build();
46       }
51   }
```

By using a Path Traversal attack and injecting character sequences like `../` a malicious user can traverse through the file system and read any file on the system, including the HTTP Digest Authentication file that contains the secret credentials. However, this feature is only available to authenticated users and in a CSRF attack it is not possible to read the request’s response. A remote attacker needs another vulnerability.

### Reflected Cross-site-Scripting (CVE-2021-32092)

We found a Cross-Site Scripting vulnerability ([S5131](https://rules.sonarsource.com/java/RSPEC-5131 "S5131")) in the error response message of the `DocumentAction` class. When a requested document is not found, user input is reflected without any output encoding.

**src/main/java/emissary/server/mvc/DocumentAction.java**

```
62   @GET
63   @Path("/Document.action/{uuid}")
64   @Produces(MediaType.APPLICATION_XML)
65   public Response documentShow(
       @Context HttpServletRequest request,
       @PathParam("uuid") String uuid
     ) {
69      final List<IBaseDataObject> payload = wsp.take(uuid);
...
82      return Response.status(400).entity("<error>uuid " + uuid + " not found</error>").build();
92   }
```

The user controlled GET variable`uuid` is passed in line 65 via a path. Then, the variable is used in line 69 in the function `wsp.take()` and if no element is found for the passed`uuid`, an error message is printed in line 82. So the user-controlled input is concatenated and printed with an error message.

An attacker can therefore craft a malicious link that passes a payload via the `uuid` parameter which executes JavaScript in the victim's browser. The HTTP response has an XML content type (see line 64) but this does not prevent an attacker from executing an arbitrary JavaScript payload. Once this payload executes in an authenticated victim’s browser it can exploit the File Disclosure vulnerability to read the administrator credentials and send these to an attacker-controlled server. With this, a remote attacker is able to gain access to the credentials and to authenticate. Next to the previously described Code Injection vulnerability, we also reported a File Delete and File Upload vulnerability that could be exploited by the attacker once authenticated.

## Timeline

| **Date** | **Event** |
| --- | --- |
| 24.09.2020 | We ask for security contact on GitHub issues |
| 01.10.2020 | We ask for security contact via generic email |
| 09.10.2020 | Emissary provides an email on GitHub issues |
| 16.10.2020 | We send detailed advisory to contributor |
| 16.11.2020 | No response, we ask for status update |
| 15.12.2020 | Emissary releases 5.11.0 to fix RCE and sets up new email |
| 17.12.2020 | We inform about email problem |
| 07.01.2021 | Emissary resolves email problem, we inform about remaining vulnerabilities |
| 01.02.2021 | We ask for status update: work in progress |
| 26.02.2021 | We inform about upcoming disclosure |
| 02.03.2021 | Emissary releases 6.1 and informs that all issues should be fixed |
| 05.03.2021 | We inform about unpatched CSRF and Path Traversal |

## Summary

In this blog post, we analyzed three vulnerabilities found in Emissary. The combination of the vulnerabilities can lead to a complete takeover of an Emissary installation. We evaluated the causes in the Java code and explained how an attacker can exploit them. We also showed that a simple authentication is not enough to secure a web application and how intended features of developers offer a high potential for attackers. If you are hosting an Emissary instance and have not yet updated your installation, we highly recommend that you do so now. Last but not least, we would like to thank the Emissary team who addressed most of the issues in the latest release 6.1.

#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.



=== Content from portswigger.net_ff2384f0_20250114_224953.html ===


[![The Daily Swig](/content/images/banners/the-daily-swig-logo.svg)](/daily-swig)

Latest threats

Bug bounty

For devs

Deep dives

More

[About](https://portswigger.net/daily-swig/about)
[Web security vulnerabilities](https://portswigger.net/daily-swig/vulnerabilities)
[Network security vulnerabilities](https://portswigger.net/daily-swig/network-security)
[Cloud security](https://portswigger.net/daily-swig/cloud-security)
[Zero-day news](https://portswigger.net/daily-swig/zero-day)
[Supply chain attacks](https://portswigger.net/daily-swig/supply-chain-attacks)

[View all web security news](https://portswigger.net/daily-swig/vulnerabilities)

[**Prototype pollution**

Prototype pollution project yields another Parse Server RCE

![Prototype-pollution](/daily-swig-mega-nav/images/latestthreats.png)](https://portswigger.net/daily-swig/prototype-pollution-project-yields-another-parse-server-rce)

[Bug bounty news](https://portswigger.net/daily-swig/bug-bounty)
[VDPs](https://portswigger.net/daily-swig/vdp)
[Bug Bounty Radar](https://portswigger.net/daily-swig/bug-bounty-radar)

[View all bug bounty news](https://portswigger.net/daily-swig/bug-bounty)

[**Bug Bounty Radar**

The latest programs for February 2023

![Bug bounties](/daily-swig-mega-nav/images/bug-bounties.png)](https://portswigger.net/daily-swig/bug-bounty-radar-the-latest-bug-bounty-programs-for-february-2023)

[DevSecOps](https://portswigger.net/daily-swig/devsecops)
[Security best practices](https://portswigger.net/daily-swig/security-best-practices)
[Dev stack tech](https://portswigger.net/daily-swig/dev-stack-tech)

[View all dev related news](https://portswigger.net/daily-swig/devsecops)

[**All Day DevOps**

AppSec engineer keynote says Log4j revealed lessons were not learned from the Equifax breach

![DevOps](/daily-swig-mega-nav/images/devsecops.png)](https://portswigger.net/daily-swig/all-day-devops-third-of-log4j-downloads-still-pull-vulnerable-version-despite-threat-of-supply-chain-attacks)

[Deep dives](https://portswigger.net/daily-swig/deep-dives)
[Interviews](https://portswigger.net/daily-swig/interviews)

[View all of the latest features](https://portswigger.net/daily-swig/deep-dives)

[**Infosec beginner?**

A rough guide to launching a career in cybersecurity

![cyber-career](/daily-swig-mega-nav/images/deepdives.png)](https://portswigger.net/daily-swig/a-rough-guide-to-launching-a-career-in-cybersecurity)

[Industry news](https://portswigger.net/daily-swig/industry-news)
[Enterprise security news](https://portswigger.net/daily-swig/enterprise)
[Web hacking tools](https://portswigger.net/daily-swig/hacking-tools)
[Events](https://portswigger.net/daily-swig/events)

[View all infosec industry news](https://portswigger.net/daily-swig/industry-news)

[**Cybersecurity conferences**

A schedule of events in 2022 and beyond

![More topics](/daily-swig-mega-nav/images/more-topics.jpg)](https://portswigger.net/daily-swig/cybersecurity-conferences-a-rundown-of-online-in-person-and-hybrid-events)

# NSA workflow application Emissary vulnerable to malicious takeover

[Adam Bannister](/daily-swig/by/adam-bannister)
07 April 2021 at 14:28 UTC

Updated: 07 April 2021 at 15:16 UTC

[Vulnerabilities](/daily-swig/vulnerabilities)
[Open Source Software](/daily-swig/open-source-software)
[Research](/daily-swig/research)

[Twitter](https://twitter.com/share?url=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover&text=NSA+workflow+application+Emissary+vulnerable+to+malicious+takeover+%7c+The+Daily+Swig%0A)
[WhatsApp](https://api.whatsapp.com/send?text=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
[Facebook](https://www.facebook.com/sharer.php?u=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
[Reddit](https://reddit.com/submit?url=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
[LinkedIn](https://www.linkedin.com/sharing/share-offsite?url=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
Email

Users urged to update their systems after disclosure of serious vulnerabilities

![Emissary NSA software vulnerable to security exploits](/cms/images/ab/67/d395-article-210407-emissary-body-text.png "Image: Salah Ait Mokhtar / Shutterstock / PortSwigger Ltd")

Emissary, an open source, peer-to-peer (P2P) workflow engine developed by the US National Security Agency (NSA), contains vulnerabilities that attackers could chain to take over Emissary instances.

Users have been urged to update their systems after the discovery of five security flaws in the Java web application, which runs in a [multi-tiered P2P network of computer resources](https://github.com/NationalSecurityAgency/emissary).

In a [blog post](https://blog.sonarsource.com/code-vulnerabilities-in-nsa-application-revealed) published on Monday (April 5), security researchers from Swiss infosec outfit SonarSource demonstrated how an attacker could mount a [cross-site request forgery](/web-security/csrf) ([CSRF](/web-security/csrf)) attack against a logged-in user to exploit a code injection vulnerability and achieve remote code execution (RCE).

[Read more of the latest open source security news](https://portswigger.net/daily-swig/open-source-software)

They also combined arbitrary file disclosure and reflected [cross-site scripting](https://portswigger.net/daily-swig/xss) ([XSS](/web-security/cross-site-scripting)) flaws to read arbitrary files from the Emissary server.

Once the XSS payload is executed in the victim’s browser, the file disclosure vulnerability could be exploited to read administrator credentials and relay them to an attacker-controlled server – resulting in a “quick and easy” server compromise demonstrated in the video below:

### XSS and arbitrary file disclosure

The Emissary XSS flaw was found in a DocumentAction error response message generated when a requested document was not found, resulting in user input being reflected without output encoding.

An attacker could therefore craft a malicious link that, if clicked by an authenticated victim, passes a payload that executes JavaScript in the browser, explained SonarSource researcher Dennis Brinkrolf.

**RELATED** [NSA advises US security supply chain on replacing deprecated encryption protocols](https://portswigger.net/daily-swig/nsa-advises-defense-national-security-supply-chain-on-replacing-deprecated-encryption-protocols)

The file disclosure flaw was found in a feature showing configuration files. The user-controlled HTTP GET variable CONFIG\_PARAM was received from the query string, and the configName variable was not sanitized and could contain any file path.

A [path traversal](https://portswigger.net/daily-swig/path-traversal) attack that injects character sequences such as ../ would therefore enable a malicious user to access authentication files on Emissary’s HTTP Digest Authentication function, which by default has administrator credentials for only a single user.

### Remote takeover

Found in a console feature used to evaluate Ruby code, the code injection bug arises from the absence of CSRF tokens.

Brinkrolf demonstrated how if the user-controlled post parameter CONSOLE\_COMMAND mirrors the string eval then an attacker-controlled post variable, CONSOLE\_COMMAND\_STRING, is received and passed to the function evalAndWait() from the RubyConsole class.

The vulnerable eval() function then receives a Ruby expression as the first parameter controllable by an attacker, who can therefore execute arbitrary Ruby code through the browser of a logged-in administrator.

SonarSource researchers also discovered authenticated file delete and file upload vulnerabilities.

### Disclosure timeline

The vulnerabilities were found in Emissary version 5.9.0.

The researchers [initiated contact](https://github.com/NationalSecurityAgency/emissary/issues/86) with Emissary’s maintainers on September 24, 2020, and sent them an advisory on October 16. Version 5.11.0, which addressed the RCE issue, was then issued on December 15.

After being notified of the remaining vulnerabilities on January 7, Emissary maintainers then released version 6.1 on March 2.

However, on March 5 SonarSource informed maintainers that the CSRF and [path traversal](/web-security/file-path-traversal) problems remained unpatched.

*The Daily Swig* has asked the maintainers about a timeline for final patches – we will update this article if and when we hear back.

**RELATED** [LocalStack zero-day vulnerabilities chained to achieve remote takeover of local instances](https://portswigger.net/daily-swig/localstack-zero-day-vulnerabilities-chained-to-achieve-remote-takeover-of-local-instances)

[Vulnerabilities](/daily-swig/vulnerabilities)
[Open Source Software](/daily-swig/open-source-software)
[Research](/daily-swig/research)
[Hacking News](/daily-swig/hacking-news)
[Hacking Techniques](/daily-swig/hacking-techniques)
[CSRF](/daily-swig/csrf)
[Path Traversal](/daily-swig/path-traversal)
[RCE](/daily-swig/rce)
[XSS](/daily-swig/xss)
[Java](/daily-swig/java)
[Authentication](/daily-swig/authentication)
[Privacy](/daily-swig/privacy)
[Organizations](/daily-swig/organizations)
[Network Security](/daily-swig/network-security)
[US](/daily-swig/us)
[Switzerland](/daily-swig/switzerland)
[North America](/daily-swig/north-america)
[Europe](/daily-swig/europe)
[Browsers](/daily-swig/browsers)

![Adam Bannister](/cms/profiles/adam-bannister.png)
[Twitter](https://twitter.com/share?url=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover&text=NSA+workflow+application+Emissary+vulnerable+to+malicious+takeover+%7c+The+Daily+Swig%0A)
[WhatsApp](https://api.whatsapp.com/send?text=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
[Facebook](https://www.facebook.com/sharer.php?u=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
[Reddit](https://reddit.com/submit?url=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
[LinkedIn](https://www.linkedin.com/sharing/share-offsite?url=https%3a%2f%2fportswigger.net%2fdaily-swig%2fnsa-workflow-application-emissary-vulnerable-to-malicious-takeover)
Email

This page requires JavaScript for an enhanced user experience.

Latest Posts
[### We’re going teetotal – It’s goodbye to The Daily Swig

02 March 2023
We’re going teetotal – It’s goodbye to The Daily Swig
PortSwigger today announces that The Daily Swig is closing down](/daily-swig/were-going-teetotal-its-goodbye-to-the-daily-swig)
[### Bug Bounty Radar

The latest bug bounty programs for March 2023
28 February 2023
Bug Bounty Radar
The latest bug bounty programs for March 2023](/daily-swig/bug-bounty-radar-the-latest-bug-bounty-programs-for-march-2023)
[### Indian gov flaws allowed creation of counterfeit driving licenses

28 February 2023
Indian gov flaws allowed creation of counterfeit driving licenses
Armed with personal data fragments, a researcher could also access 185 million citizens’ PII](/daily-swig/indian-transport-ministry-flaws-potentially-allowed-creation-of-counterfeit-driving-licenses)

Burp Suite

[Web vulnerability scanner](/burp/vulnerability-scanner)
[Burp Suite Editions](/burp)
[Release Notes](/burp/releases)

Vulnerabilities

[Cross-site scripting (XSS)](/web-security/cross-site-scripting)
[SQL injection](/web-security/sql-injection)
[Cross-site request forgery](/web-security/csrf)
[XML external entity injection](/web-security/xxe)
[Directory traversal](/web-security/file-path-traversal)
[Server-side request forgery](/web-security/ssrf)

Customers

[Organizations](/organizations)
[Testers](/testers)
[Developers](/developers)

Company

[About](/about)
[Careers](/careers)
[Contact](/about/contact)
[Legal](/legal)
[Privacy Notice](/privacy)

Insights

[Web Security Academy](/web-security)
[Blog](/blog)
[Research](/research)

[![PortSwigger Logo](/content/images/logos/portswigger-logo.svg)](/)
 [Follow us](https://twitter.com/Burp_Suite)

© 2025 PortSwigger Ltd.


