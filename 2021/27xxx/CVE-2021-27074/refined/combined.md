=== Content from portal.msrc.microsoft.com_e666fd7c_20250114_224442.html ===
You need to enable JavaScript to run this app.

=== Content from www.talosintelligence.com_8d5d08ab_20250114_224443.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

×

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2021-1247

## Microsoft Azure Sphere mount namespace unsigned code execution vulnerability

##### April 13, 2021

##### CVE Number

CVE-2021-27074

### Summary

An unsigned code execution vulnerability exists in the mount namespace functionality of Microsoft Azure Sphere 21.01. A specially crafted shellcode could allow an adversary to execute an arbitrary binary in a tmpfs mount, leading to unsigned code execution. An attacker can switch to a new mount namespace to trigger this vulnerability.

### Tested Versions

Microsoft Azure Sphere 21.01

### Product URLs

<https://azure.microsoft.com/en-us/services/azure-sphere/>

### CVSSv3 Score

6.2 - CVSS:3.0/AV:L/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N

### CWE

CWE-284 - Improper Access Control

### Details

Microsoft’s Azure Sphere is a platform for the development of internet-of-things applications. It features a custom SoC that consists of a set of cores that run both high-level and real-time applications, enforces security and manages encryption (among other functions). The high-level applications execute on a custom Linux-based OS, with several modifications to make it smaller and more secure, specifically for IoT applications.

A namespace is an abstraction provided by the Linux kernel that allows for modifying the execution context of a process (or thread).

Currently, there exist 8 kinds of namespaces: Cgroup, IPC, Network, Mount, PID, Time, User, UTS. An unprivileged user can create a new user namespace (using the `CLONE_NEWUSER` flag) and have a full capabilities (root user with all caps) in that namespace. From `man user_namespaces(7)`:

```
User namespaces isolate security-related identifiers and
attributes, in particular, user IDs and group IDs (see
credentials(7)), the root directory, keys (see keyrings(7)), and
capabilities (see capabilities(7)).  A process's user and group
IDs can be different inside and outside a user namespace.  In
particular, a process can have a normal unprivileged user ID
outside a user namespace while at the same time having a user ID
of 0 inside the namespace; in other words, the process has full
privileges for operations inside the user namespace, but is
unprivileged for operations outside the namespace.

```

Once in the new user namespace, the user has the `CAP_SYS_ADMIN` capability in the namespace. This means that it’s possible to use the `CLONE_NEWNS` flag to switch to a new mount namespace. From `man mount_namespaces(7)`:

```
Mount namespaces provide isolation of the list of mount points
seen by the processes in each namespace instance.  Thus, the
processes in each of the mount namespace instances will see
distinct single-directory hierarchies.
...
Subsequent modifications to the mount point list (mount(2) and
umount(2)) in either mount namespace will not (by default) affect
the mount point list seen in the other namespace (but see the
following discussion of shared subtrees).

```

For more details on namespaces, see the `man namespaces(7)`.

Since the user can modify the mount point list in the new namespace, a subset of the usual mount operations is available.

For example, it’s not possible to mount an existing block device (e.g. `/dev/mtdblock0`) in the new namespace, since that requires root privileges on the parent namespace. It is however possible to create a new `tmpfs` mount within the new namespace, since that won’t affect the parent namespace.

One of the security features provided by Azure Sphere is the protection against unsigned code: only the code already present in the device, or signed code that has been deployed to the device via the cloud, and marked as executable can ever be executed. This is enforced by Linux kernel patches around `mprotect` and `mmap` that make sure that memory that has ever been writeable can’t be executable. Moreover, this is enforced at the userspace level by ensuring all executable mountpoints are not writeable and conversely that all writeable mountpoints are not executable.

By using namespaces however, it’s possible to alter this situation. The `CLONE_NEWUSER` and `CLONE_NEWNS` flags can be used together in a single invokation of the `unshare` syscall to change the current (unprivileged) namespace. Next, it’s possible to mount a `tmpfs` filesystem anywhere (e.g. to `/tmp`), create a binary file inside the mountpoint with arbitrary contents, and execute it.

### Timeline

2021-02-02 - Vendor Disclosure

2021-04-13 - Public Release

##### Credit

Discovered by Claudio Bozzato and Lilith >\_> of Cisco Talos.

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2021-1250](/vulnerability_reports/TALOS-2021-1250) [Previous Report

TALOS-2020-1202](/vulnerability_reports/TALOS-2020-1202)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)



=== Content from www.talosintelligence.com_5d6e5952_20250114_224445.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

×

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2021-1249

## Microsoft Azure Sphere Linux namespace ptrace unsigned code execution vulnerability

##### April 13, 2021

##### CVE Number

CVE-2021-27074

### Summary

An unsigned code execution vulnerability exists in the Linux namespace ptrace functionality of Microsoft Azure Sphere 21.01. Specially crafted shellcode could allow an adversary to execute unsigned code. An attacker can change the namespace and use ptrace to modify the code of a running process to trigger this vulnerability.

### Tested Versions

Microsoft Azure Sphere 21.01

### Product URLs

<https://azure.microsoft.com/en-us/services/azure-sphere/>

### CVSSv3 Score

6.2 - CVSS:3.0/AV:L/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N

### CWE

CWE-284 - Improper Access Control

### Details

Microsoft’s Azure Sphere is a platform for the development of internet-of-things applications. It features a custom SoC that consists of a set of cores that run both high-level and real-time applications, enforces security and manages encryption (among other functions). The high-level applications execute on a custom Linux-based OS, with several modifications to make it smaller and more secure, specifically for IoT applications.

A Linux namespace is an abstraction provided by the kernel to limit the execution context of a given process or thread and potentially also to isolate it.

Currently, there exist 8 kinds of namespaces: Cgroup, IPC, Network, Mount, PID, Time, User, UTS. An unprivileged user can create a new user namespace (using the `CLONE_NEWUSER` flag) and have a full capabilities (root user with all caps) in that namespace. From `man user_namespaces(7)`:

```
User namespaces isolate security-related identifiers and
attributes, in particular, user IDs and group IDs (see
credentials(7)), the root directory, keys (see keyrings(7)), and
capabilities (see capabilities(7)).  A process's user and group
IDs can be different inside and outside a user namespace.  In
particular, a process can have a normal unprivileged user ID
outside a user namespace while at the same time having a user ID
of 0 inside the namespace; in other words, the process has full
privileges for operations inside the user namespace, but is
unprivileged for operations outside the namespace.

```

Once in the new user namespace, the user has full capabilities in the namespace (including `CAP_SYS_PTRACE`) to all other resources within the namespace, which allows for tracing arbitrary processes within the namespace. It is worth emphasizing again that the elevated permissions only apply to resources within the user namespace, if one were to attempt tracing a process outside the new user namespace, the credentials utilized by the tracer would be the same unpriviledged credentials as before.

In the Azure Sphere platfom, a more novel approach at preventing unsigned code execution exists: only the code already present in the device, or signed code that has been deployed to the device via the cloud, and marked as executable can ever be executed. This is enforced by Linux kernel patches around and inside `mprotect` and `mmap` that make sure that memory that has ever been writable cannot ever be executable. Moreover, this is also enforced at the kernel driver level by ensuring all mountpoints are exclusively either writable or executable.

In order to stop attackers from simply using `PTRACE_ATTACH` and `PTRACE_POKETEXT` to write to non-writable memory for subsequent execution, kernel patches have been added to deny the ptracing of any process unless the device is running in development mode. This is implemented via LSM hooks:

```
static struct security_hook_list azure_sphere_hooks[] = {
    ...
    LSM_HOOK_INIT(ptrace_access_check, azure_sphere_ptrace_access_check),
    LSM_HOOK_INIT(ptrace_traceme, azure_sphere_ptrace_traceme),
    ...
};

// LSM entry only called on ptrace_traceme
static int azure_sphere_ptrace_traceme(struct task_struct *parent)
{
    // if pluton says we are in development mode then allow otherwise fail
    if(azure_sphere_in_dev_mode()) {
        return 0;
    }

    return -EPERM;
}

// LSM entry only called on ptrace_attach and a small subset of /proc entries impacting if you can see other PIDs
static int azure_sphere_ptrace_access_check(struct task_struct *child, unsigned int mode)
{
    struct mm_struct *mm;
    const struct cred *cred = current_cred();
    bool ret;
    struct azure_sphere_task_cred *child_tsec;
    struct azure_sphere_task_cred *self_tsec;

    // if CAP_SYS_PTRACE is active then allow        // [1]
    rcu_read_lock();
    ret = az_ptrace_has_cap(cred, __task_cred(child)->user_ns, mode);
    rcu_read_unlock();
    if (ret) {
        // check if the user_ns is accessible for the task memory
        mm = child->mm;
        if (mm && az_ptrace_has_cap(cred, mm->user_ns, mode)) {
                return 0;
        }
    }

    // make sure that the capabilities of the process is a superset of the process being traced to avoid elevating privileges
    child_tsec = get_task_cred(child)->security;
    self_tsec = get_task_cred(current)->security;
    if(!child_tsec || !self_tsec || ((child_tsec->capabilities & self_tsec->capabilities) != child_tsec->capabilities))
        return -EPERM;

    // if pluton says we are in development mode then allow otherwise fail
    if(!azure_sphere_in_dev_mode()) {
        return -EPERM;
    }

    return 0;
}

```

Notice how `azure_sphere_ptrace_traceme` is disallowed altogether in non-dev mode, while `azure_sphere_ptrace_access_check` (hit from `PTRACE_ATTACH`, `PTRACE_SEIZE` and `PTRACE_MODE_READ`) allows ptracing to occur when not in development mode, assuming process owns the `CAP_SYS_PTRACE` [1] capability.

Indeed, the function `az_ptrace_has_cap` determines if a process is allowed to trace, just by checking `CAP_SYS_PTRACE`:

```
static bool az_ptrace_has_cap(const struct cred *cred, struct user_namespace *ns,
              unsigned int mode)
{
   int ret;

   if (mode & PTRACE_MODE_NOAUDIT)
       ret = security_capable(cred, ns, CAP_SYS_PTRACE, CAP_OPT_NOAUDIT);
   else
       ret = security_capable(cred, ns, CAP_SYS_PTRACE, CAP_OPT_NONE);

   return ret == 0;
}

```

Returning back to `azure_sphere_access_check`:

```
...
ret = az_ptrace_has_cap(cred, __task_cred(child)->user_ns, mode); // [2]
rcu_read_unlock();
if (ret) {
    // check if the user_ns is accessible for the task memory
    mm = child->mm;
    if (mm && az_ptrace_has_cap(cred, mm->user_ns, mode)) {       // [3]
            return 0;
    }
}

```

At [2], the security module checks to see that the tracing process has `CAP_SYS_PTRACE` within the tracee process’s user namespace. This check can be passed simply by entering a new username space, `fork()`‘ing or `clone()`‘ing and then having the parent process ptrace the child process. Since the credentials of the parent are inherited by the child (most importantly the user namespace), and also because the parent has `CAP_SYS_PTRACE` within this user namespace, we can pass this check rather easily. The check at [3] however is not automatically passed with `fork()` or `clone()`, while the child’s credential structure might live in the same namespace as the parent, the child’s memory map (`child->mm->user_ns`) does not necessarily follow the trend, extra steps must be taken by an attacker (one of the simpler ways to pass this check is to just `execl()` after `clone()`or `fork()`).

Regardless, since there are no checks are in place to verify that the parent process’ namespace is not the root namespace (`init_user_ns`), it’s allowed to create a new namespace (either via `unshare` or `clone`) and use ptrace inside it. Thus, once an attacker has passed both `az_ptrace_has_cap` checks, it follows that a process can spawn a new child, attach to it via `PTRACE_ATTACH`, modify its executable memory via `PTRACE_POKETEXT`, and let it resume, effectively running unsigned code on the device (similarly to how it was demonstrated in TALOS-2020-1090).

### Timeline

2021-02-12 - Vendor Disclosure

2021-04-13 - Public Release

##### Credit

Discovered by Claudio Bozzato and Lilith >\_> of Cisco Talos.

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2021-1262](/vulnerability_reports/TALOS-2021-1262) [Previous Report

TALOS-2021-1250](/vulnerability_reports/TALOS-2021-1250)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)


