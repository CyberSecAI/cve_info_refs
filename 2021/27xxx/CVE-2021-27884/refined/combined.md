=== Content from github.com_497fad2c_20250114_191032.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FYMFE%2Fyapi%2Fissues%2F2117)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FYMFE%2Fyapi%2Fissues%2F2117)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=YMFE%2Fyapi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[YMFE](/YMFE)
/
**[yapi](/YMFE/yapi)**
Public

* [Notifications](/login?return_to=%2FYMFE%2Fyapi) You must be signed in to change notification settings
* [Fork
  4.8k](/login?return_to=%2FYMFE%2Fyapi)
* [Star
   27.5k](/login?return_to=%2FYMFE%2Fyapi)

* [Code](/YMFE/yapi)
* [Issues
  1.5k](/YMFE/yapi/issues)
* [Pull requests
  77](/YMFE/yapi/pulls)
* [Actions](/YMFE/yapi/actions)
* [Security](/YMFE/yapi/security)
* [Insights](/YMFE/yapi/pulse)

Additional navigation options

* [Code](/YMFE/yapi)
* [Issues](/YMFE/yapi/issues)
* [Pull requests](/YMFE/yapi/pulls)
* [Actions](/YMFE/yapi/actions)
* [Security](/YMFE/yapi/security)
* [Insights](/YMFE/yapi/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FYMFE%2Fyapi%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FYMFE%2Fyapi%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# GitHub Security Lab (GHSL) Vulnerability Report: `GHSL-2020-228` #2117

Open

[JarLob](/JarLob) opened this issue
Feb 23, 2021
· 0 comments

Open

# [GitHub Security Lab (GHSL) Vulnerability Report: `GHSL-2020-228`](#top) #2117

[JarLob](/JarLob) opened this issue
Feb 23, 2021
· 0 comments

## Comments

[![@JarLob](https://avatars.githubusercontent.com/u/26652396?s=80&u=94afdf60dc3944fec75e6b0299a82fd5286ae1a5&v=4)](/JarLob)

Copy link

Contributor

### **[JarLob](/JarLob)** commented [Feb 23, 2021](#issue-814540386) • edited Loading

| Summary Weak random number generator is used to sign JSON Web Token (JWT). Product [YApi](https://github.com/YMFE/yapi) Tested Version The latest commit to the date: [8e1f654](https://github.com/YMFE/yapi/tree/8e1f6546d52ad6a3f8d3ce3325eb1d0276209f4c). DetailsJWT signing Function [randStr](https://github.com/YMFE/yapi/blob/8e1f6546d52ad6a3f8d3ce3325eb1d0276209f4c/server/utils/commons.js#L155-L159) is using a cryptographically insecure pseudo-random number generator `Math.random` to create a randomly looking string that later is used to sign and verify issued tokens:  ``` exports.randStr = () => {   return Math.random()     .toString(36)     .substr(2); }; ```  When a new user is created the `randStr` function is used to generate a `passsalt`. It is used as a salt to hash the password and as the secret to sign a JWT that authenticates the user:  ```   async reg(ctx) { ...     let passsalt = yapi.commons.randStr();     let data = {       username: params.username,       password: yapi.commons.generatePassword(params.password, passsalt), //加密       email: params.email,       passsalt: passsalt, ...       this.setLoginCookie(user._id, user.passsalt); ...   } ...   setLoginCookie(uid, passsalt) {     let token = jwt.sign({ uid: uid }, passsalt, { expiresIn: '7 days' });     this.ctx.cookies.set('_yapi_token', token, {       expires: yapi.commons.expireDate(7),       httpOnly: true     }); ...   } ```  The `Math.random` returns a floating-point number that is more than or equal to 0.0 and less than 1.0. The call to `toString(36)` formats the number as base36. For example, `0.19280841320093556` gets encoded as `0.6xvo3g36129`. The first two characters are trimmed and the result is `6xvo3g36129`. The generated secret is mostly 10-12 characters long and consists of numbers and lowercase Latin alphabet characters only. Since the trimmed part is always `0.` the calculation is completely reversible.  The weakness of cryptographically insecure pseudo-random number generators is that given some number of observed values the internal state of the generator can be recreated that reveals the numbers generated in the past or allows calculation of the future outputs. The internal state of the current implementation of `Math.random` in Node.js (a modification of XorShift128+ algorithm) can be recreated from three observed consecutive values.  To get the values an attacker may automate the user creation process to get three new user tokens rapidly, then run a brute force attack on the JWT HMAC signatures. This still should not be feasible to do in a reasonable time on a single machine like:  ``` - Hashcat version: 6.1.1 - Nvidia GPUs: 4 * Tesla V100  Hashmode: 16500 - JWT (JSON Web Token)  Speed.#1.........:  1368.5 MH/s (244.80ms) @ Accel:32 Loops:128 Thr:1024 Vec:1 Speed.#2.........:  1368.9 MH/s (244.65ms) @ Accel:32 Loops:128 Thr:1024 Vec:1 Speed.#3.........:  1368.2 MH/s (244.80ms) @ Accel:32 Loops:128 Thr:1024 Vec:1 Speed.#4.........:  1368.3 MH/s (244.74ms) @ Accel:32 Loops:128 Thr:1024 Vec:1 Speed.#*.........:  5473.9 MH/s  ```  However a very rough estimation shows that by using cloud computing the attack could cost from 8 000$ to 24 000$ to break the tokens (Cracking three values versus one value has very little penalty as cracking machines are optimized for multiple hashes and cracking a single hash doesn't fully utilize computer resources). Please notice that the token's 7 days expiration time doesn't put a limit on the attack as the target is the `passsalt` value used to sign the token. Impact After successfully brute forcing the three pseudo-random values the attacker may recreate the `passsalt` values that are used to sign tokens of other users. It may be argued if there is an incentive to spend this amount of resources, but GPUs get better all the time. Remediation Use `crypto.randomBytes` to get at least 32 bytes random value in `randStr`. Consider not using the `passsalt` for signing JWT, but using a 256 bits secret from the server configuration environment. Credit This issue was discovered and reported by GHSL team member [@JarLob (Jaroslav Lobačevski)](https://github.com/JarLob). Contact You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2020-228` in any communication regarding this issue. Disclosure Policy Our [coordinated disclosure policy](https://securitylab.github.com/advisories#policy). |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@JarLob](https://avatars.githubusercontent.com/u/26652396?s=40&u=94afdf60dc3944fec75e6b0299a82fd5286ae1a5&v=4)](/JarLob)
[JarLob](/JarLob)
changed the title
~~Potential security vulnerability in YApi~~
GitHub Security Lab (GHSL) Vulnerability Report: `GHSL-2020-228`
[Feb 23, 2021](#event-4365628298)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FYMFE%2Fyapi%2Fissues%2F2117)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

1 participant

[![@JarLob](https://avatars.githubusercontent.com/u/26652396?s=52&v=4)](/JarLob)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_b76f9a7f_20250114_191033.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

February 24, 2021
# GHSL-2020-228: Weak JSON Web Token (JWT) signing secret in YApi - CVE-2021-27884

[![Author avatar](https://avatars.githubusercontent.com/u/26652396)
Jaroslav Lobačevski](https://github.com/jarlob)

## Coordinated Disclosure Timeline

* 2020-11-18: Report sent to maintainer
* 2020-12-01: Created a [public pull request](https://github.com/YMFE/yapi/pull/2011) asking for a contact
* 2021-02-16: Disclosure deadline reached
* 2021-02-23: [Public issue](https://github.com/YMFE/yapi/issues/2117) was created

## Summary

Weak random number generator is used to sign JSON Web Token (JWT).

## Product

[YApi](https://github.com/YMFE/yapi)

## Tested Version

The latest commit to the date: [8e1f654](https://github.com/YMFE/yapi/tree/8e1f6546d52ad6a3f8d3ce3325eb1d0276209f4c).

## Details

### JWT signing

Function [randStr](https://github.com/YMFE/yapi/blob/8e1f6546d52ad6a3f8d3ce3325eb1d0276209f4c/server/utils/commons.js#L155-L159) is using a cryptographically insecure pseudo-random number generator `Math.random` to create a randomly looking string that later is used to sign and verify issued tokens:

```
exports.randStr = () => {
  return Math.random()
    .toString(36)
    .substr(2);
};

```

When a new user is created the `randStr` function is used to generate a `passsalt`. It is used as a salt to hash the password and as the secret to sign a JWT that authenticates the user:

```
  async reg(ctx) {
...
    let passsalt = yapi.commons.randStr();
    let data = {
      username: params.username,
      password: yapi.commons.generatePassword(params.password, passsalt), //加密
      email: params.email,
      passsalt: passsalt,
...
      this.setLoginCookie(user._id, user.passsalt);
...
  }
...
  setLoginCookie(uid, passsalt) {
    let token = jwt.sign({ uid: uid }, passsalt, { expiresIn: '7 days' });
    this.ctx.cookies.set('_yapi_token', token, {
      expires: yapi.commons.expireDate(7),
      httpOnly: true
    });
...
  }

```

The `Math.random` returns a floating-point number that is more than or equal to 0.0 and less than 1.0. The call to `toString(36)` formats the number as base36. For example, `0.19280841320093556` gets encoded as `0.6xvo3g36129`. The first two characters are trimmed and the result is `6xvo3g36129`. The generated secret is mostly 10-12 characters long and consists of numbers and lowercase Latin alphabet characters only. Since the trimmed part is always `0.` the calculation is completely reversible.

The weakness of cryptographically insecure pseudo-random number generators is that given some number of observed values the internal state of the generator can be recreated that reveals the numbers generated in the past or allows calculation of the future outputs. The internal state of the current implementation of `Math.random` in Node.js (a modification of XorShift128+ algorithm) can be recreated from three observed consecutive values.

To get the values an attacker may automate the user creation process to get three new user tokens rapidly, then run a brute force attack on the JWT HMAC signatures. This still should not be feasible to do in a reasonable time on a single machine like:

```
- Hashcat version: 6.1.1
- Nvidia GPUs: 4 * Tesla V100

Hashmode: 16500 - JWT (JSON Web Token)

Speed.#1.........:  1368.5 MH/s (244.80ms) @ Accel:32 Loops:128 Thr:1024 Vec:1
Speed.#2.........:  1368.9 MH/s (244.65ms) @ Accel:32 Loops:128 Thr:1024 Vec:1
Speed.#3.........:  1368.2 MH/s (244.80ms) @ Accel:32 Loops:128 Thr:1024 Vec:1
Speed.#4.........:  1368.3 MH/s (244.74ms) @ Accel:32 Loops:128 Thr:1024 Vec:1
Speed.#*.........:  5473.9 MH/s

```

However a very rough estimation shows that by using cloud computing the attack could cost from 8 000$ to 24 000$ to break the tokens (Cracking three values versus one value has very little penalty as cracking machines are optimized for multiple hashes and cracking a single hash doesn’t fully utilize computer resources). Please notice that the token’s 7 days expiration time doesn’t put a limit on the attack as the target is the `passsalt` value used to sign the token.

#### Impact

After successfully brute forcing the three pseudo-random values the attacker may recreate the `passsalt` values that are used to sign tokens of other users. It may be argued if there is an incentive to spend this amount of resources, but GPUs get better all the time.

## CVE

* CVE-2021-27884

## Credit

This issue was discovered and reported by GHSL team member [@JarLob (Jaroslav Lobačevski)](https://github.com/JarLob).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2020-228` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information


