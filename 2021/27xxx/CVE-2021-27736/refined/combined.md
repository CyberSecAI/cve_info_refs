=== Content from github.com_67a09d07_20250114_225325.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFusionAuth%2Ffusionauth-samlv2%2Fcompare%2F0.5.3...0.5.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFusionAuth%2Ffusionauth-samlv2%2Fcompare%2F0.5.3...0.5.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcompare%2Fshow&source=header-repo&source_repo=FusionAuth%2Ffusionauth-samlv2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[FusionAuth](/FusionAuth)
/
**[fusionauth-samlv2](/FusionAuth/fusionauth-samlv2)**
Public

* [Notifications](/login?return_to=%2FFusionAuth%2Ffusionauth-samlv2) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2FFusionAuth%2Ffusionauth-samlv2)
* [Star
   9](/login?return_to=%2FFusionAuth%2Ffusionauth-samlv2)

* [Code](/FusionAuth/fusionauth-samlv2)
* [Issues
  0](/FusionAuth/fusionauth-samlv2/issues)
* [Pull requests
  0](/FusionAuth/fusionauth-samlv2/pulls)
* [Actions](/FusionAuth/fusionauth-samlv2/actions)
* [Projects
  0](/FusionAuth/fusionauth-samlv2/projects)
* [Security](/FusionAuth/fusionauth-samlv2/security)
* [Insights](/FusionAuth/fusionauth-samlv2/pulse)

Additional navigation options

* [Code](/FusionAuth/fusionauth-samlv2)
* [Issues](/FusionAuth/fusionauth-samlv2/issues)
* [Pull requests](/FusionAuth/fusionauth-samlv2/pulls)
* [Actions](/FusionAuth/fusionauth-samlv2/actions)
* [Projects](/FusionAuth/fusionauth-samlv2/projects)
* [Security](/FusionAuth/fusionauth-samlv2/security)
* [Insights](/FusionAuth/fusionauth-samlv2/pulse)

[Permalink](https://github.com/FusionAuth/fusionauth-samlv2/compare/FusionAuth%3Aeb75ed9...FusionAuth%3A14c4772)
# Comparing changes

 Choose two branches to see what’s changed or to start a new pull request.
If you need to, you can also  compare across forks
 or
[learn more about diff comparisons](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

# Open a pull request

 Create a new pull request by comparing changes across two branches. If you need to, you can also  compare across forks
.
[Learn more about diff comparisons here](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

*base repository:*
FusionAuth/fusionauth-samlv2

Failed to load repositories. Confirm that selected base ref is valid, then try again.

 Loading

*base:*
0.5.3

Choose a base ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/FusionAuth/fusionauth-samlv2/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...0.5.4)

Could not load tags

Nothing to show

[{{ refName }}
default](/FusionAuth/fusionauth-samlv2/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...0.5.4)

 Loading

...

*head repository:*
FusionAuth/fusionauth-samlv2

Failed to load repositories. Confirm that selected head ref is valid, then try again.

 Loading

*compare:*
0.5.4

Choose a head ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/FusionAuth/fusionauth-samlv2/compare/0.5.3...%7B%7B%20urlEncodedRefName%20%7D%7D)

Could not load tags

Nothing to show

[{{ refName }}
default](/FusionAuth/fusionauth-samlv2/compare/0.5.3...%7B%7B%20urlEncodedRefName%20%7D%7D)

 Loading

* 3

  commits
* 9

  files changed
* 1

  contributor

### Commits on Jan 27, 2021

1. [Add a test for failing signature.](/FusionAuth/fusionauth-samlv2/commit/15fa48df134833ab86286474770f502a2c872f53)

   [![@robotdan](https://avatars.githubusercontent.com/u/1148709?s=40&v=4)](/robotdan)

   [robotdan](/FusionAuth/fusionauth-samlv2/commits?author=robotdan "View all commits by robotdan")
   committed
   Jan 27, 2021

   Configuration menu

   * [View commit details](/FusionAuth/fusionauth-samlv2/commit/15fa48df134833ab86286474770f502a2c872f53)
   * Copy full SHA for 15fa48d
   * [Browse repository at this point](/FusionAuth/fusionauth-samlv2/tree/15fa48df134833ab86286474770f502a2c872f53)

   Copy the full SHA

    [15fa48d](/FusionAuth/fusionauth-samlv2/commit/15fa48df134833ab86286474770f502a2c872f53)View commit details

   Browse the repository at this point in the history

### Commits on Feb 7, 2021

1. [Refactor utility methods into SAMLTools, add tests.](/FusionAuth/fusionauth-samlv2/commit/c66fb689d50010662f705d5b585c6388ce555dbd)

   [![@robotdan](https://avatars.githubusercontent.com/u/1148709?s=40&v=4)](/robotdan)

   [robotdan](/FusionAuth/fusionauth-samlv2/commits?author=robotdan "View all commits by robotdan")
   committed
   Feb 7, 2021

   Configuration menu

   * [View commit details](/FusionAuth/fusionauth-samlv2/commit/c66fb689d50010662f705d5b585c6388ce555dbd)
   * Copy full SHA for c66fb68
   * [Browse repository at this point](/FusionAuth/fusionauth-samlv2/tree/c66fb689d50010662f705d5b585c6388ce555dbd)

   Copy the full SHA

    [c66fb68](/FusionAuth/fusionauth-samlv2/commit/c66fb689d50010662f705d5b585c6388ce555dbd)View commit details

   Browse the repository at this point in the history
2. [Bump version](/FusionAuth/fusionauth-samlv2/commit/14c4772ee1f9a76c7bae50368884446878d68a68)

   [![@robotdan](https://avatars.githubusercontent.com/u/1148709?s=40&v=4)](/robotdan)

   [robotdan](/FusionAuth/fusionauth-samlv2/commits?author=robotdan "View all commits by robotdan")
   committed
   Feb 7, 2021

   Configuration menu

   * [View commit details](/FusionAuth/fusionauth-samlv2/commit/14c4772ee1f9a76c7bae50368884446878d68a68)
   * Copy full SHA for 14c4772
   * [Browse repository at this point](/FusionAuth/fusionauth-samlv2/tree/14c4772ee1f9a76c7bae50368884446878d68a68)

   Copy the full SHA

    [14c4772](/FusionAuth/fusionauth-samlv2/commit/14c4772ee1f9a76c7bae50368884446878d68a68)View commit details

   Browse the repository at this point in the history

 Loading

### This comparison is taking too long to generate.

Unfortunately it looks like we can’t render this comparison for you right now. It might be too big, or there might be something weird with your repository.

You can try running this command locally to see the comparison on your machine:

`git diff 0.5.3...0.5.4`

  Retry

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5e0465c6_20250114_225324.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFusionAuth%2Ffusionauth-samlv2%2Fcommit%2Fc66fb689d50010662f705d5b585c6388ce555dbd)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFusionAuth%2Ffusionauth-samlv2%2Fcommit%2Fc66fb689d50010662f705d5b585c6388ce555dbd)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=FusionAuth%2Ffusionauth-samlv2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[FusionAuth](/FusionAuth)
/
**[fusionauth-samlv2](/FusionAuth/fusionauth-samlv2)**
Public

* [Notifications](/login?return_to=%2FFusionAuth%2Ffusionauth-samlv2) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2FFusionAuth%2Ffusionauth-samlv2)
* [Star
   9](/login?return_to=%2FFusionAuth%2Ffusionauth-samlv2)

* [Code](/FusionAuth/fusionauth-samlv2)
* [Issues
  0](/FusionAuth/fusionauth-samlv2/issues)
* [Pull requests
  0](/FusionAuth/fusionauth-samlv2/pulls)
* [Actions](/FusionAuth/fusionauth-samlv2/actions)
* [Projects
  0](/FusionAuth/fusionauth-samlv2/projects)
* [Security](/FusionAuth/fusionauth-samlv2/security)
* [Insights](/FusionAuth/fusionauth-samlv2/pulse)

Additional navigation options

* [Code](/FusionAuth/fusionauth-samlv2)
* [Issues](/FusionAuth/fusionauth-samlv2/issues)
* [Pull requests](/FusionAuth/fusionauth-samlv2/pulls)
* [Actions](/FusionAuth/fusionauth-samlv2/actions)
* [Projects](/FusionAuth/fusionauth-samlv2/projects)
* [Security](/FusionAuth/fusionauth-samlv2/security)
* [Insights](/FusionAuth/fusionauth-samlv2/pulse)

## Commit

[Permalink](/FusionAuth/fusionauth-samlv2/commit/c66fb689d50010662f705d5b585c6388ce555dbd)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Refactor utility methods into SAMLTools, add tests.

[Browse files](/FusionAuth/fusionauth-samlv2/tree/c66fb689d50010662f705d5b585c6388ce555dbd)
Browse the repository at this point in the history

* Loading branch information

[![@robotdan](https://avatars.githubusercontent.com/u/1148709?s=40&v=4)](/robotdan)

[robotdan](/FusionAuth/fusionauth-samlv2/commits?author=robotdan "View all commits by robotdan")
committed
Feb 7, 2021

1 parent
[15fa48d](/FusionAuth/fusionauth-samlv2/commit/15fa48df134833ab86286474770f502a2c872f53)

commit c66fb68

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**580 additions**
and
**210 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* fusionauth-samlv2.iml
  [fusionauth-samlv2.iml](#diff-039aa3565e693fa1c3db3a575e96fe8ea6dce45e50f8b6f641b537194a50e0ae)
* src

  + main/java/io/fusionauth/samlv2

    - service

      * src/main/java/io/fusionauth/samlv2/service/DefaultSAMLv2Service.java
        [DefaultSAMLv2Service.java](#diff-8a2df2671a99b7b052fe464b72e7c8ee04f67aa116345044acfbf2222d2a6a3a)
    - util

      * src/main/java/io/fusionauth/samlv2/util/SAMLTools.java
        [SAMLTools.java](#diff-7d0fbc9d656e2f983b648352bfcd1ff52e9de36bad2bbb8c106533da9457e734)
  + test

    - java/io/fusionauth/samlv2/service

      * src/test/java/io/fusionauth/samlv2/service/DefaultSAMLv2ServiceTest.java
        [DefaultSAMLv2ServiceTest.java](#diff-3f691be96f30ce39dc187be9e6d59da977a113f614be8fd0ff2a408d0424e246)
    - xml

      * src/test/xml/authn-request-expanded-entity.xml
        [authn-request-expanded-entity.xml](#diff-f9ac9499b8b5505955fd6769badb56a1def1f1a953f2e010e0f9ee4402319b9c)
      * src/test/xml/authn-request-external-dtd.xml
        [authn-request-external-dtd.xml](#diff-5107a48e8334f8442bfed2bec76ce102c9a045c48b1afce7f2ac3160dae5da18)
      * src/test/xml/authn-request-has-doctype.xml
        [authn-request-has-doctype.xml](#diff-de6a8985590439d276f1b6e57fe30dd13aeb0b2bec963b8eb8fda3863ee24e3e)
      * src/test/xml/metadata.xml
        [metadata.xml](#diff-f7665a8bd1e53daf3b833bfbeb1e2846dda5c86281a6f5adadf217f9376adaae)

## There are no files selected for viewing

5 changes: 2 additions & 3 deletions

5
[fusionauth-samlv2.iml](#diff-039aa3565e693fa1c3db3a575e96fe8ea6dce45e50f8b6f641b537194a50e0ae "fusionauth-samlv2.iml")

Show comments

[View file](/FusionAuth/fusionauth-samlv2/blob/c66fb689d50010662f705d5b585c6388ce555dbd/fusionauth-samlv2.iml)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,7 +6,7 @@ |
|  |  | <exclude-output /> |
|  |  | <content url="file://$MODULE\_DIR$"> |
|  |  | <sourceFolder url="file://$MODULE\_DIR$/src/main/java" isTestSource="false" /> |
|  |  | <sourceFolder url="file://$MODULE\_DIR$/src/main/resources" isTestSource="false" /> |
|  |  | <sourceFolder url="file://$MODULE\_DIR$/src/main/resources" type="java-resource" /> |
|  |  | <sourceFolder url="file://$MODULE\_DIR$/src/test/java" isTestSource="true" /> |
|  |  | <sourceFolder url="file://$MODULE\_DIR$/src/test/resources" isTestSource="true" /> |
|  |  | <excludeFolder url="file://$MODULE\_DIR$/.gradle" /> |
| Expand Down  Expand Up | | @@ -136,5 +136,4 @@ |
|  |  | </library> |
|  |  | </orderEntry> |
|  |  | </component> |
|  |  | </module> |
|  |  |  |
|  |  | </module> |

209 changes: 17 additions & 192 deletions

209
[src/main/java/io/fusionauth/samlv2/service/DefaultSAMLv2Service.java](#diff-8a2df2671a99b7b052fe464b72e7c8ee04f67aa116345044acfbf2222d2a6a3a "src/main/java/io/fusionauth/samlv2/service/DefaultSAMLv2Service.java")

Show comments

[View file](/FusionAuth/fusionauth-samlv2/blob/c66fb689d50010662f705d5b585c6388ce555dbd/src/main/java/io/fusionauth/samlv2/service/DefaultSAMLv2Service.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -15,11 +15,7 @@ |
|  |  | \*/ |
|  |  | package io.fusionauth.samlv2.service; |
|  |  |  |
|  |  | import javax.xml.bind.JAXBContext; |
|  |  | import javax.xml.bind.JAXBElement; |
|  |  | import javax.xml.bind.JAXBException; |
|  |  | import javax.xml.bind.Marshaller; |
|  |  | import javax.xml.bind.Unmarshaller; |
|  |  | import javax.xml.crypto.KeySelector; |
|  |  | import javax.xml.crypto.MarshalException; |
|  |  | import javax.xml.crypto.dsig.CanonicalizationMethod; |
| Expand All | | @@ -37,19 +33,7 @@ |
|  |  | import javax.xml.crypto.dsig.keyinfo.X509Data; |
|  |  | import javax.xml.crypto.dsig.spec.C14NMethodParameterSpec; |
|  |  | import javax.xml.crypto.dsig.spec.TransformParameterSpec; |
|  |  | import javax.xml.datatype.XMLGregorianCalendar; |
|  |  | import javax.xml.parsers.DocumentBuilder; |
|  |  | import javax.xml.parsers.DocumentBuilderFactory; |
|  |  | import javax.xml.parsers.ParserConfigurationException; |
|  |  | import javax.xml.transform.Transformer; |
|  |  | import javax.xml.transform.TransformerException; |
|  |  | import javax.xml.transform.TransformerFactory; |
|  |  | import javax.xml.transform.dom.DOMSource; |
|  |  | import javax.xml.transform.stream.StreamResult; |
|  |  | import java.io.ByteArrayInputStream; |
|  |  | import java.io.ByteArrayOutputStream; |
|  |  | import java.io.IOException; |
|  |  | import java.io.StringWriter; |
|  |  | import java.io.UnsupportedEncodingException; |
|  |  | import java.net.URLEncoder; |
|  |  | import java.nio.charset.StandardCharsets; |
| Expand All | | @@ -59,8 +43,6 @@ |
|  |  | import java.security.PrivateKey; |
|  |  | import java.security.Signature; |
|  |  | import java.security.cert.Certificate; |
|  |  | import java.security.cert.CertificateException; |
|  |  | import java.security.cert.CertificateFactory; |
|  |  | import java.security.cert.X509Certificate; |
|  |  | import java.time.ZoneOffset; |
|  |  | import java.time.ZonedDateTime; |
| Expand All | | @@ -75,9 +57,6 @@ |
|  |  | import java.util.UUID; |
|  |  | import java.util.function.Function; |
|  |  | import java.util.stream.Collectors; |
|  |  | import java.util.zip.DataFormatException; |
|  |  | import java.util.zip.Deflater; |
|  |  | import java.util.zip.Inflater; |
|  |  |  |
|  |  | import com.sun.org.apache.xerces.internal.jaxp.datatype.XMLGregorianCalendarImpl; |
|  |  | import io.fusionauth.samlv2.domain.Algorithm; |
| Expand All | | @@ -89,7 +68,6 @@ |
|  |  | import io.fusionauth.samlv2.domain.MetaData; |
|  |  | import io.fusionauth.samlv2.domain.MetaData.IDPMetaData; |
|  |  | import io.fusionauth.samlv2.domain.MetaData.SPMetaData; |
|  |  | import io.fusionauth.samlv2.domain.NameID; |
|  |  | import io.fusionauth.samlv2.domain.NameIDFormat; |
|  |  | import io.fusionauth.samlv2.domain.ResponseStatus; |
|  |  | import io.fusionauth.samlv2.domain.SAMLException; |
| Expand Down  Expand Up | | @@ -128,6 +106,7 @@ |
|  |  | import io.fusionauth.samlv2.domain.jaxb.oasis.protocol.StatusType; |
|  |  | import io.fusionauth.samlv2.domain.jaxb.w3c.xmldsig.KeyInfoType; |
|  |  | import io.fusionauth.samlv2.domain.jaxb.w3c.xmldsig.X509DataType; |
|  |  | import io.fusionauth.samlv2.util.SAMLTools; |
|  |  | import org.slf4j.Logger; |
|  |  | import org.slf4j.LoggerFactory; |
|  |  | import org.w3c.dom.Attr; |
| Expand All | | @@ -136,7 +115,16 @@ |
|  |  | import org.w3c.dom.NamedNodeMap; |
|  |  | import org.w3c.dom.Node; |
|  |  | import org.w3c.dom.NodeList; |
|  |  | import org.xml.sax.SAXException; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.convertToZonedDateTime; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.decodeAndInflate; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.marshallToBytes; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.marshallToDocument; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.marshallToString; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.newDocumentFromBytes; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.parseNameId; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.toXMLGregorianCalendar; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.toZonedDateTime; |
|  |  | import static io.fusionauth.samlv2.util.SAMLTools.unmarshallFromDocument; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Default implementation of the SAML service. |
| Expand Down  Expand Up | | @@ -411,7 +399,7 @@ public String buildRedirectAuthnRequest(AuthenticationRequest request, String re |
|  |  |  |
|  |  | @Override |
|  |  | public MetaData parseMetaData(String metaDataXML) throws SAMLException { |
|  |  | Document document = parseFromBytes(metaDataXML.getBytes(StandardCharsets.UTF\_8)); |
|  |  | Document document = newDocumentFromBytes(metaDataXML.getBytes(StandardCharsets.UTF\_8)); |
|  |  | EntityDescriptorType root = unmarshallFromDocument(document, EntityDescriptorType.class); |
|  |  | MetaData metaData = new MetaData(); |
|  |  | metaData.id = root.getID(); |
| Expand Down  Expand Up | | @@ -450,7 +438,7 @@ public MetaData parseMetaData(String metaDataXML) throws SAMLException { |
|  |  | metaData.idp.certificates = idp.getKeyDescriptor() |
|  |  | .stream() |
|  |  | .filter(kd -> kd.getUse() == KeyTypes.SIGNING) |
|  |  | .map(this::toCertificate) |
|  |  | .map(SAMLTools::toCertificate) |
|  |  | .filter(Objects::nonNull) |
|  |  | .collect(Collectors.toList()); |
|  |  | } catch (IllegalArgumentException e) { |
| Expand Down  Expand Up | | @@ -532,7 +520,7 @@ public AuthenticationResponse parseResponse(String encodedResponse, boolean veri |
|  |  | byte[] decodedResponse = Base64.getMimeDecoder().decode(encodedResponse); |
|  |  | response.rawResponse = new String(decodedResponse, StandardCharsets.UTF\_8); |
|  |  |  |
|  |  | Document document = parseFromBytes(decodedResponse); |
|  |  | Document document = newDocumentFromBytes(decodedResponse); |
|  |  | if (verifySignature) { |
|  |  | verifySignature(document, keySelector); |
|  |  | } |
| Expand Down  Expand Up | | @@ -613,7 +601,7 @@ public AuthenticationResponse parseResponse(String encodedResponse, boolean veri |
|  |  | AttributeType attributeType = (AttributeType) attributeObject; |
|  |  | String name = attributeType.getName(); |
|  |  | List<Object> attributeValues = attributeType.getAttributeValue(); |
|  |  | List<String> values = attributeValues.stream().map(this::attributeToString).collect(Collectors.toList()); |
|  |  | List<String> values = attributeValues.stream().map(SAMLTools::attributeToString).collect(Collectors.toList()); |
|  |  | response.assertion.attributes.computeIfAbsent(name, k -> new ArrayList<>()).addAll(values); |
|  |  | } else { |
|  |  | throw new SAMLException("This library currently doesn't support encrypted attributes"); |
| Expand Down  Expand Up | | @@ -646,24 +634,6 @@ private void addKeyDescriptors(SSODescriptorType descriptor, List<Certificate> c |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | private String attributeToString(Object attribute) { |
|  |  | if (attribute == null) { |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | if (attribute instanceof Number) { |
|  |  | return attribute.toString(); |
|  |  | } else if (attribute instanceof String) { |
|  |  | return (String) attribute; |
|  |  | } else if (attribute instanceof Element) { |
|  |  | return ((Element) attribute).getTextContent(); |
|  |  | } else { |
|  |  | logger.warn("This library currently doesn't handle attributes of type [" + attribute.getClass() + "]"); |
|  |  | } |
|  |  |  |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | private String buildPostAuthnRequest(AuthnRequestType authnRequest, boolean sign, PrivateKey privateKey, |
|  |  | X509Certificate certificate, |
|  |  | Algorithm algorithm, String xmlSignatureC14nMethod) throws SAMLException { |
| Expand All | | @@ -687,7 +657,7 @@ private String buildRedirectAuthnRequest(AuthnRequestType authnRequest, String r |
|  |  | PrivateKey key, Algorithm algorithm) throws SAMLException { |
|  |  | try { |
|  |  | byte[] xml = marshallToBytes(PROTOCOL\_OBJECT\_FACTORY.createAuthnRequest(authnRequest), AuthnRequestType.class); |
|  |  | String encodedResult = deflateAndEncode(xml); |
|  |  | String encodedResult = SAMLTools.deflateAndEncode(xml); |
|  |  | String parameters = "SAMLRequest=" + URLEncoder.encode(encodedResult, "UTF-8"); |
|  |  | if (relayState != null) { |
|  |  | parameters += "&RelayState=" + URLEncoder.encode(relayState, "UTF-8"); |
| Expand All | | @@ -711,43 +681,6 @@ private String buildRedirectAuthnRequest(AuthnRequestType authnRequest, String r |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private ZonedDateTime convertToZonedDateTime(XMLGregorianCalendar cal) { |
|  |  | return cal != null ? cal.toGregorianCalendar().toZonedDateTime() : null; |
|  |  | } |
|  |  |  |
|  |  | private byte[] decodeAndInflate(String encodedRequest) throws SAMLException { |
|  |  | byte[] bytes = Base64.getMimeDecoder().decode(encodedRequest); |
|  |  | Inflater inflater = new Inflater(true); |
|  |  | inflater.setInput(bytes); |
|  |  | inflater.finished(); |
|  |  |  |
|  |  | try { |
|  |  | ByteArrayOutputStream baos = new ByteArrayOutputStream(); |
|  |  | byte[] result = new byte[bytes.length]; |
|  |  | while (!inflater.finished()) { |
|  |  | int length = inflater.inflate(result); |
|  |  | if (length > 0) { |
|  |  | baos.write(result, 0, length); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return baos.toByteArray(); |
|  |  | } catch (DataFormatException e) { |
|  |  | throw new SAMLException("Invalid AuthnRequest. Inflating the bytes failed.", e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private String deflateAndEncode(byte[] result) { |
|  |  | Deflater deflater = new Deflater(Deflater.DEFLATED, true); |
|  |  | deflater.setInput(result); |
|  |  | deflater.finish(); |
|  |  | byte[] deflatedResult = new byte[result.length]; |
|  |  | int length = deflater.deflate(deflatedResult); |
|  |  | deflater.end(); |
|  |  | byte[] src = Arrays.copyOf(deflatedResult, length); |
|  |  | return Base64.getEncoder().encodeToString(src); |
|  |  | } |
|  |  |  |
|  |  | private void fixIDs(Element element) { |
|  |  | NamedNodeMap attributes = element.getAttributes(); |
|  |  | for (int i = 0; i < attributes.getLength(); i++) { |
| Expand All | | @@ -766,42 +699,6 @@ private void fixIDs(Element element) { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private <T> byte[] marshallToBytes(JAXBElement<T> object, Class<T> type) throws SAMLException { |
|  |  | try { |
|  |  | JAXBContext context = JAXBContext.newInstance(type); |
|  |  | Marshaller marshaller = context.createMarshaller(); |
|  |  | ByteArrayOutputStream baos = new ByteArrayOutputStream(); |
|  |  | marshaller.marshal(object, baos); |
|  |  | return baos.toByteArray(); |
|  |  | } catch (JAXBException e) { |
|  |  | throw new SAMLException("Unable to marshallRequest JAXB SAML object to bytes.", e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | @SuppressWarnings("SameParameterValue") |
|  |  | private <T> Document marshallToDocument(JAXBElement<T> object, Class<T> type) throws SAMLException { |
|  |  | try { |
|  |  | JAXBContext context = JAXBContext.newInstance(type); |
|  |  | Marshaller marshaller = context.createMarshaller(); |
|  |  | DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); |
|  |  | dbf.setNamespaceAware(true); |
|  |  | DocumentBuilder db = dbf.newDocumentBuilder(); |
|  |  | Document document = db.newDocument(); |
|  |  | marshaller.marshal(object, document); |
|  |  | return document; |
|  |  | } catch (JAXBException | ParserConfigurationException e) { |
|  |  | throw new SAMLException("Unable to marshallRequest JAXB SAML object to DOM.", e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private String marshallToString(Document document) throws TransformerException { |
|  |  | StringWriter sw = new StringWriter(); |
|  |  | TransformerFactory tf = TransformerFactory.newInstance(); |
|  |  | Transformer transformer = tf.newTransformer(); |
|  |  | transformer.transform(new DOMSource(document), new StreamResult(sw)); |
|  |  | return sw.toString(); |
|  |  | } |
|  |  |  |
|  |  | private SubjectConfirmation parseConfirmation(SubjectConfirmationType subjectConfirmationType) { |
|  |  | SubjectConfirmation subjectConfirmation = new SubjectConfirmation(); |
|  |  | SubjectConfirmationDataType data = subjectConfirmationType.getSubjectConfirmationData(); |
| Expand All | | @@ -818,32 +715,14 @@ private SubjectConfirmation parseConfirmation(SubjectConfirmationType subjectCon |
|  |  | return subjectConfirmation; |
|  |  | } |
|  |  |  |
|  |  | private Document parseFromBytes(byte[] bytes) throws SAMLException { |
|  |  | DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance(); |
|  |  | documentBuilderFactory.setNamespaceAware(true); |
|  |  | try { |
|  |  | DocumentBuilder builder = documentBuilderFactory.newDocumentBuilder(); |
|  |  | return builder.parse(new ByteArrayInputStream(bytes)); |
|  |  | } catch (ParserConfigurationException | SAXException | IOException e) { |
|  |  | throw new SAMLException("Unable to parse SAML v2.0 authentication response", e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private NameID parseNameId(NameIDType element) { |
|  |  | NameID nameId = new NameID(); |
|  |  | nameId.format = NameIDFormat.fromSAMLFormat(element.getFormat()); |
|  |  | nameId.id = element.getValue(); |
|  |  | return nameId; |
|  |  | } |
|  |  |  |
|  |  | private AuthnRequestParseResult parseRequest(byte[] xmlBytes) throws SAMLException { |
|  |  | String xml = new String(xmlBytes, StandardCharsets.UTF\_8); |
|  |  | if (logger.isDebugEnabled()) { |
|  |  | logger.debug("SAMLRequest XML is\n{}", xml); |
|  |  | } |
|  |  |  |
|  |  | AuthnRequestParseResult result = new AuthnRequestParseResult(); |
|  |  | result.document = parseFromBytes(xmlBytes); |
|  |  | result.document = newDocumentFromBytes(xmlBytes); |
|  |  | result.authnRequest = unmarshallFromDocument(result.document, AuthnRequestType.class); |
|  |  | result.request = new AuthenticationRequest(); |
|  |  | result.request.xml = xml; |
| Expand Down  Expand Up | | @@ -907,60 +786,6 @@ private AuthnRequestType toAuthnRequest(AuthenticationRequest request, String ve |
|  |  | return authnRequest; |
|  |  | } |
|  |  |  |
|  |  | private Certificate toCertificate(KeyDescriptorType keyDescriptorType) { |
|  |  | try { |
|  |  | List<Object> keyData = keyDescriptorType.getKeyInfo().getContent(); |
|  |  | for (Object keyDatum : keyData) { |
|  |  | if (keyDatum instanceof JAXBElement<?>) { |
|  |  | JAXBElement<?> element = (JAXBElement<?>) keyDatum; |
|  |  | if (element.getDeclaredType() == X509DataType.class) { |
|  |  | X509DataType cert = (X509DataType) element.getValue(); |
|  |  | List<Object> certData = cert.getX509IssuerSerialOrX509SKIOrX509SubjectName(); |
|  |  | for (Object certDatum : certData) { |
|  |  | element = (JAXBElement<?>) certDatum; |
|  |  | if (element.getName().getLocalPart().equals("X509Certificate")) { |
|  |  | byte[] certBytes = (byte[]) element.getValue(); |
|  |  | CertificateFactory cf = CertificateFactory.getInstance("X.509"); |
|  |  | return cf.generateCertificate(new ByteArrayInputStream(certBytes)); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | return null; |
|  |  | } catch (CertificateException e) { |
|  |  | throw new IllegalArgumentException(e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private XMLGregorianCalendar toXMLGregorianCalendar(ZonedDateTime instant) { |
|  |  | if (instant == null) { |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | return new XMLGregorianCalendarImpl(GregorianCalendar.from(instant)); |
|  |  | } |
|  |  |  |
|  |  | private ZonedDateTime toZonedDateTime(XMLGregorianCalendar instant) { |
|  |  | if (instant == null) { |
|  |  | return null; |
|  |  | } |
|  |  |  |
|  |  | return instant.toGregorianCalendar().toZonedDateTime(); |
|  |  | } |
|  |  |  |
|  |  | private <T> T unmarshallFromDocument(Document document, Class<T> type) throws SAMLException { |
|  |  | try { |
|  |  | JAXBContext context = JAXBContext.newInstance(type); |
|  |  | Unmarshaller unmarshaller = context.createUnmarshaller(); |
|  |  | JAXBElement<T> element = unmarshaller.unmarshal(document, type); |
|  |  | return element.getValue(); |
|  |  | } catch (JAXBException e) { |
|  |  | throw new SAMLException("Unable to unmarshall SAML response", e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | private void verifySignature(Document document, KeySelector keySelector) throws SAMLException { |
|  |  | // Fix the IDs in the entire document per the suggestions at http://stackoverflow.com/questions/17331187/xml-dig-sig-error-after-upgrade-to-java7u25 |
|  |  | fixIDs(document.getDocumentElement()); |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c66fb68`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFusionAuth%2Ffusionauth-samlv2%2Fcommit%2Fc66fb689d50010662f705d5b585c6388ce555dbd) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.compass-security.com_f1a879cd_20250114_225325.html ===
#############################################################
#
# COMPASS SECURITY ADVISORY
# https://www.compass-security.com/research/advisories/
#
#############################################################
#
# Product: FusionAuth SAML Library [1]
# Vendor: FusionAuth [2]
# CSNC ID: CSNC-2021-004
# CVE ID: CVE-2021-27736
# Subject: XML External Entity
# Risk: High
# Effect: Remotely exploitable
# Author: Philipp Mao
# Date: 2021-4-21
#
#############################################################
Introduction:
-------------
FusionAuth provides authentication, authorization, and user management for any app.
The FusionAuth SAML Library implements SAML v2.0 bindings in Java using JAXB and is employed in the
FusionAuth IDP. Compass Security [3] identified a vulnerability that allows remote attackers to
forge SAML messages with xml external entities and read files on the filesystem or send network requests to other systems.
Affected:
---------
Vulnerable:
fusionauth-samlv2 <0.5.4
Not vulnerable:
fusionauth-samlv2 >=0.5.4
Technical Description
---------------------
Unauthenticated users can send forged SAML messages with xml external entities to FusionAuth.
FusionAuth will parse the xml external entities and reflect the result on a error page.
The forged SAML messges with external entities may be sent in the AuthnRequest or in the
LogoutRequest, since neither of these requests necessarily require a signature. Any FusionAuth deployment exposing
the SAML endpoint or applications utilizing the fusionauth-samlv2 library are vulnerable.
The code which is responsible for parsing the XML is found in the parseFromBytes function [4].
The function initializes javax.xml.parsers.DocumentBuilderFactory without explicitly disabling the
document type definitions.
```
private Document parseFromBytes(byte[] bytes) throws SAMLException {
DocumentBuilderFactory documentBuilderFactory = DocumentBuilderFactory.newInstance();
documentBuilderFactory.setNamespaceAware(true);
try {
DocumentBuilder builder = documentBuilderFactory.newDocumentBuilder();
return builder.parse(new ByteArrayInputStream(bytes));
} catch (ParserConfigurationException | SAXException | IOException e) {
throw new SAMLException("Unable to parse SAML v2.0 authentication response", e);
}
}
```
Workaround / Fix:
-----------------
Upgrade to fusionauth-samlv2 0.5.4 or newer, where the document type definitions are disabled.
Timeline:
---------
2021-01-20: Discovery by Philipp Mao
2021-01-21: Initial vendor notification/response
2021-02-07: Release of fixed Version
2021-02-25: Assigned CVE-2021-27736
2021-04-21: Coordinated public disclosure date
References:
-----------
[1] https://github.com/FusionAuth/fusionauth-samlv2
[2] https://fusionauth.io/
[3] https://compass-security.com
[4] https://github.com/FusionAuth/fusionauth-samlv2/blob/eb75ed9de1043c8d0564f0d1a136523457cc2dc3/src/main/java/io/fusionauth/samlv2/service/DefaultSAMLv2Service.java#L821
