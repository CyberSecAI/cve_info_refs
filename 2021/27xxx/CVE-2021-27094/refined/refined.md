The provided content discusses CVE-2021-27094, along with another vulnerability (CVE-2021-28447) found in the Windows loader.

**CVE-2021-27094**

*   **Root cause:** The vulnerability is caused by a missing check for the lexicographical order of elements in subkeys lists within the Windows loader when parsing the ELAM registry hive. This check is present in the Windows kernel but not in the Windows loader. The Windows loader skips this check, while the Windows kernel enforces it.

*   **Weaknesses/vulnerabilities:**
    *   The Windows loader does not validate the lexicographical order of subkeys, allowing a specially crafted registry hive to be loaded without issues during the early boot process.
    *   The Windows kernel, however, enforces this order. If the order is incorrect, it will delete the offending keys.

*   **Impact of exploitation:**
    *   An attacker can manipulate the ELAM registry hive to cause ELAM signatures to be measured by the Windows loader but then removed by the Windows kernel before the ELAM driver uses them.
    *   This results in the system booting without proper ELAM signatures, while the measured boot process does not detect the issue (since PCR values are as expected).
    *   An attacker can effectively disable or downgrade ELAM signatures without triggering any measured boot alarms.

*   **Attack vectors:**
    *   The attacker requires the ability to modify the ELAM registry hive file (located at *C:\Windows\System32\config\ELAM*) which requires administrator level privileges.
    *   This can be achieved by using a registry editor to insert a new key and then using a hex editor to modify the subkeys list to break the lexicographical order.

*   **Required attacker capabilities/position:**
    *   The attacker needs to have administrator level privileges to modify the registry hive file.
    *   The attacker needs to be able to modify the ELAM hive file by either using a registry editor and hex editor or by using a custom tool that can modify registry hives.

**Additional Details:**

*   The vulnerability arises from a difference in implementation of registry hive parsing between the Windows loader and the Windows kernel.
*   The Windows loader omits the lexicographical subkey order check due to the absence of proper Unicode uppercase table functionality during early boot.
*   The fix implemented by Microsoft introduces the lexicographical order check in the Windows loader, but only for ASCII characters, because the Unicode uppercase table is not available in the Windows loader. This fix caused a data corruption issue in the SYSTEM hive because keys with non-ASCII names are sorted differently in the Windows loader and the Windows kernel.

The provided content provides more detail than a typical CVE description, outlining the technical root cause, steps for exploitation, and the fix implemented by Microsoft.