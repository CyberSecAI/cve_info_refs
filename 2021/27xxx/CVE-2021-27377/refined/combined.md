=== Content from rustsec.org_897946e2_20250115_084911.html ===


RUSTSEC-2021-0022: yottadb: Use-after-free in `subscript\_next` and `subscript\_prev` wrappers › RustSec Advisory Database

#

[About](/)
[Advisories](/advisories/)
[Report Vulnerabilities](/contributing.html)

[History](https://github.com/RustSec/advisory-db/commits/main/crates/yottadb/RUSTSEC-2021-0022.md) ⋅
[Edit](https://github.com/RustSec/advisory-db/edit/main/crates/yottadb/RUSTSEC-2021-0022.md) ⋅
[JSON (OSV)](https://api.osv.dev/v1/vulns/RUSTSEC-2021-0022)

# RUSTSEC-2021-0022

Use-after-free in `subscript_next` and `subscript_prev` wrappers

Reported
February 9, 2021

Issued
February 15, 2021

(last modified: June 13, 2023)

Package
[yottadb](/packages/yottadb.html)
([crates.io](https://crates.io/crates/yottadb))

Type
Vulnerability

Categories

* [memory-corruption](/categories/memory-corruption.html)

Keywords
[#use-after-free](/keywords/use-after-free.html)

Aliases

* [CVE-2021-27377](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-27377)
* [GHSA-9658-c26v-7qvf](https://github.com/advisories/GHSA-9658-c26v-7qvf)

References

* <https://gitlab.com/YottaDB/Lang/YDBRust/-/issues/40>

CVSS Score
9.8
CRITICAL

CVSS Details
Attack vectorNetwork
Attack complexityLow
Privileges requiredNone
User interactionNone
ScopeUnchanged
ConfidentialityHigh
IntegrityHigh
AvailabilityHigh

CVSS Vector
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H)
Patched

* `>=1.2.0`

Affected Functions
Version
`yottadb::Key::sub_next_self_st`

* `<1.2.0`

`yottadb::Key::sub_prev_self_st`

* `<1.2.0`

`yottadb::KeyContext::sub_next_self_st`

* `<1.2.0`

`yottadb::KeyContext::sub_prev_self_st`

* `<1.2.0`

### Description

Affected versions of this crate had an unsound implementation which could pass
a pointer to freed memory to `ydb_subscript_next_st` and
`ydb_subscript_prev_st` if the variable and subscripts did not have enough
memory allocated on the first call to hold the next variable in the database.

For example, the following code had undefined behavior:

```
let mut key = Key::variable(String::from("a"));
Key::variable("averylongkeywithlotsofletters")
    .set_st(YDB_NOTTP, Vec::new(), b"some val")
    .unwrap();
key.sub_next_self_st(YDB_NOTTP, Vec::new()).unwrap();

```

`yottadb` has no reverse-dependencies on crates.io and there are no known
instances of this API being used incorrectly in practice. The fix is backwards
compatible.

The flaw was corrected by recalculating the pointer each time it was reallocated.

Advisory available under [CC0-1.0](https://spdx.org/licenses/CC0-1.0.html)
license.


