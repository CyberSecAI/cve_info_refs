=== Content from drivertom.blogspot.com_682fa8d2_20250114_190159.html ===

[跳至主要内容](#main)

### 搜索此博客

# [Driver Tom's Blog](https://drivertom.blogspot.com/)

### 局域网监控软件WFilter ICF 鸡肋0day RCE漏洞挖掘

* 获取链接
* Facebook
* X
* Pinterest
* 电子邮件
* 其他应用

[一月 16, 2021](https://drivertom.blogspot.com/2021/01/wfilter-icf-0day-rce.html "permanent link")

### 0x00关于本文

逛freebuf的时候看到了这篇文章，[关于PDD员工发帖溯源联想到的相关技术与实现](https://www.freebuf.com/articles/es/260549.html)，其中提到了一个叫做wfilter的局域网监控软件。这个软件官网提供了下载链接，支持10天实用，于是我就下下来研究一番。[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjHKNhZRvp1Rzc0-NQR18cc3728qpTBg-TUe84FJuMux-M5hu8qEG302i9QnoT75cgdodau22EExvhyaQUYcwHJbHgMGrF9X5oRfloSzl9Ft9d_ki9zplHG0pE9AwH0wGcqAATwmV3QQEuM/w640-h248/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjHKNhZRvp1Rzc0-NQR18cc3728qpTBg-TUe84FJuMux-M5hu8qEG302i9QnoT75cgdodau22EExvhyaQUYcwHJbHgMGrF9X5oRfloSzl9Ft9d_ki9zplHG0pE9AwH0wGcqAATwmV3QQEuM/)
作为一个搞安全的人，我最感兴趣的是这个软件本身是否存在缺陷，毕竟这类用于监控的安全软件自身出现漏洞是最有戏剧性的事情了

0x01不同寻常**Web管理**Wfilter通过串联/旁路的方式进行部署，同时提供一个Web管理接口供管理员进行远程管理。而作为一个Web狗，我自然把重心放在了这个Web管理接口上了。这个Web管理接口不同寻常的第一点就是登录之后不会返回任何Cookies，而且请求接口的时候也不会带Cookies或者任何特殊的Headers
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhF_uOEC-0XTqlSLQV1CpkzoM2vZwtVZEkFVk8MxQTrx6KGZICgB3ejOVIwUb7IqmItNynor50WN45MdMZ67ZAPvGU_jehfmP-3ytUi7mONvDqeHLPA8VE8DbFlD1FuTft-nteGJwKjxEmp/w640-h288/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhF_uOEC-0XTqlSLQV1CpkzoM2vZwtVZEkFVk8MxQTrx6KGZICgB3ejOVIwUb7IqmItNynor50WN45MdMZ67ZAPvGU_jehfmP-3ytUi7mONvDqeHLPA8VE8DbFlD1FuTft-nteGJwKjxEmp/)

那它是怎么进行鉴别的呢？测试了一番之后发现居然是根据IP地址来鉴别的，一旦管理者登录，wfilter就会记录下管理者的IP地址，然后允许其访问这些接口。这么诡异的鉴别方式大概率搭配了一个诡异的后端实现，结果我用火绒剑一看，发现后台是通过CGI运行的。也就是说想要审计这个软件还得去逆向这个EXE！[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiCyBdbAamWZ2T-owFkFaueEgMk7MGOIB16px4xheANOjQt33BW_Z308jXltJX4k1rBXhiMmhQXiUb8XB44StrDosMJuxVUIBRMS5KX8ZFXguWwD61IX1atYgYzFC3gVVBUpqy8CYn0t6Jh/w640-h206/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiCyBdbAamWZ2T-owFkFaueEgMk7MGOIB16px4xheANOjQt33BW_Z308jXltJX4k1rBXhiMmhQXiUb8XB44StrDosMJuxVUIBRMS5KX8ZFXguWwD61IX1atYgYzFC3gVVBUpqy8CYn0t6Jh/)算了，逆向就逆向吧，正好试试IDA7.5效果怎么样
0x01对于cgiproj.exe的逆向分析
这个Web接口的特点是通过/fcgi?cmd=【功能名】来调用，因此在IDA里面搜索相关的字符串就可以找到实现通过功能名来执行不同功能的函数了。[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhufojFSzTy8fa8GxPc9tD7qYeqbXVYVcd837T4avlwKyLcX__1Ok5KBbMXunQmYN-PDAfGhkGJOMIxtwTksbe58FctDzuIMKJ6wMoy-y7vHFHoycNpZVSrUIlmGUcaXfVxbye73sY5XUY1/w640-h436/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhufojFSzTy8fa8GxPc9tD7qYeqbXVYVcd837T4avlwKyLcX__1Ok5KBbMXunQmYN-PDAfGhkGJOMIxtwTksbe58FctDzuIMKJ6wMoy-y7vHFHoycNpZVSrUIlmGUcaXfVxbye73sY5XUY1/)
这个函数非常的大，以至于我需要修改IDA的hexrays支持的最大函数大小来让IDA能够成功反编译这个函数（Web狗实在是不想啃汇编了）。经过一番猜测和实验，我发现这个调用sub\_BF65E0中的参数包含了功能名字，而v266[1]中存放的则是其对应的函数。通过这些信息我可以查看具体接口是如何实现。
0x02 思路1：找到无需鉴权的功能，直接拿下服务器！实现这个思路，简单来说就两个步骤，第一个是找到无需鉴权的功能，第二个是逆向分析然后找到有漏洞功能然后利用。为了找到无需鉴权就能使用的功能，简单起见，我搜集了那个大函数中的所有的字符串，然后拿到接口中去fuzz，接着发现viewHelp,helpSearch,login,mobileCode,mlogin,logout,remoteLogin,viewToolTip,ExecuteNoLogin,forgetPassword,resetPassword,viewHTML这些功能对应的接口无需登录。但是很快发现他们都无助于入侵。比如mobileCode功能虽然调用了system()但是所有的参数都是写死的，要么写死在程序里面，要么从配置文件里面读取[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiAfxcJcUF2kRHleEHgmv-O79vC-8wIadWhbPivKuuBo06JM-KWQDjabGwmq9ryGg4w9e4JSVYM4lUrbHK-D5VqmV9A48YAPV5LTcw2ahqjDB3ZNp_hcUiq386nLN4mRDTzojqfGc1fdxlZ/)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiAfxcJcUF2kRHleEHgmv-O79vC-8wIadWhbPivKuuBo06JM-KWQDjabGwmq9ryGg4w9e4JSVYM4lUrbHK-D5VqmV9A48YAPV5LTcw2ahqjDB3ZNp_hcUiq386nLN4mRDTzojqfGc1fdxlZ/)
而viewHTML功能虽然可以玩路径穿越读取文件，但是后缀写死了htm，我尝试了00截断和Windows路径长度截断来绕过但是均未成功[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjwRtInklMGEBpSHyujoAZmUl3YmrWKU73dcfmlJuKIdJOMi2rUpUW4fLvSAtRisPffbE04phWvVGanYxruPYU_3gnfhzbuwfRnkimIdwIpwkK-xUPsnuv634DRHYSA0OnE5Svpn2DHUJf7/)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjwRtInklMGEBpSHyujoAZmUl3YmrWKU73dcfmlJuKIdJOMi2rUpUW4fLvSAtRisPffbE04phWvVGanYxruPYU_3gnfhzbuwfRnkimIdwIpwkK-xUPsnuv634DRHYSA0OnE5Svpn2DHUJf7/)ExecuteNoLogin功能看名字很诱人，看样子似乎还可以直接给一个IP让它信任，但是我无论如何调用都显示错误，也没法直接RCE了[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh2hte2INzk1FxuQnz0p3MimpMQK5WlYUkJXXq5Yym-y0iljRlEu99lEjK97A-EVcHNJJ5JUOPVFWu3-pQ903GQclnseKZrqttphhGFB9cqjLv2h0_o62b8TdEodSqEpngIiayomvQChLCf/)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh2hte2INzk1FxuQnz0p3MimpMQK5WlYUkJXXq5Yym-y0iljRlEu99lEjK97A-EVcHNJJ5JUOPVFWu3-pQ903GQclnseKZrqttphhGFB9cqjLv2h0_o62b8TdEodSqEpngIiayomvQChLCf/)
而其余的功能更是没法利用，因此目前看下来这条路就堵死了。
0x02 思路2：利用XSS/CSRF配合后台RCE ---XSS挖掘实现一键日天看起来是不现实了，但是XSS/CSRF配合后台RCE并不是没有可能的。首先我需要找一个靠谱的XSS漏洞。很快我就发现一个似乎可以利用的点，在“网页浏览”记录查看中，一旦请求带了User Agent，系统就会把User Agent放在前端[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6vn8MiKZYLltl6aGebUcdbLB3AGdgc4jy2X342EsG1Em5NMTEq7xNdjiHVjL-qG7FFMIejZupYvKIupUvUfi78QJg6onEA0wS3T-xvR-M-4DYT_48LdY76vHYnFrrcs1nMcbcSZBxVZOP/w640-h136/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6vn8MiKZYLltl6aGebUcdbLB3AGdgc4jy2X342EsG1Em5NMTEq7xNdjiHVjL-qG7FFMIejZupYvKIupUvUfi78QJg6onEA0wS3T-xvR-M-4DYT_48LdY76vHYnFrrcs1nMcbcSZBxVZOP/)
为了验证我这个猜测，我在安装了wfilter的机器上再装了个python requests库，以便于调试（简单起见，我并没有用串联/并联的方式将其接入我的网络），接着利用requests库构造一个包含XSS Payload的User-Agent，就像这样[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjXu-0_SqMYs6CrzZwFKjbkdPy2NpraDzhHJi_JyHd0945AdjuWN4rt-pSyxaOjTK9fudGFdkxCDoDoyJY5sRHIWK3KsYodPmdx6df1ZasIu8PtbcRJlJuOuAAYEFYi4KsFIKLukr7Cx1tn/w640-h100/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjXu-0_SqMYs6CrzZwFKjbkdPy2NpraDzhHJi_JyHd0945AdjuWN4rt-pSyxaOjTK9fudGFdkxCDoDoyJY5sRHIWK3KsYodPmdx6df1ZasIu8PtbcRJlJuOuAAYEFYi4KsFIKLukr7Cx1tn/)
接着再去看历史[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiGYNqPoxWhbEtzhOfNn_200VrXhyZ2YekmJN2hlnOYvAv5bu0LLk5EaRD68SkguvArNUMNW892eajbyh0JcIEZqbIOWIpXSRXUOFMfSEx4f43WMnpvAo3_THD_hpk3os3vN71l9sTJAma7/w640-h192/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiGYNqPoxWhbEtzhOfNn_200VrXhyZ2YekmJN2hlnOYvAv5bu0LLk5EaRD68SkguvArNUMNW892eajbyh0JcIEZqbIOWIpXSRXUOFMfSEx4f43WMnpvAo3_THD_hpk3os3vN71l9sTJAma7/)

0x03 思路2：利用XSS/CSRF配合后台RCE ---后台RCE挖掘
最开始我想的是直接搜system函数，查看引用，寻觅一波命令注入，但是并没有明显容易注入的点（主要是因为反编译出来的函数太大，而且一些不太清晰的反编译让我无法理清逻辑）。因此我采取另一种办法，即查看web界面有哪些有趣的功能，然后针对性地反编译。在翻找了一阵子后，我发现了这个系统包含了利用插件扩展的功能。[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEht3qeofRwK9hDzGqzyAGGKVTnzzaXORIxj7V-soSd12CEycBLseDCWL4Y1DVoMBmBQE4ZU0kr9tCaW6fcxM25m21UtOsCmO1d9Aq1y1RbJPhEHiWCnwJ6y3n7cDI10mNXzqYXnmW-4mNUL/w640-h178/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEht3qeofRwK9hDzGqzyAGGKVTnzzaXORIxj7V-soSd12CEycBLseDCWL4Y1DVoMBmBQE4ZU0kr9tCaW6fcxM25m21UtOsCmO1d9Aq1y1RbJPhEHiWCnwJ6y3n7cDI10mNXzqYXnmW-4mNUL/)
执行插件的时候抓个包，我发现了一个叫做runDll的功能，这不明显的让我为所欲为？[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiSzZazf8azgClCc_WAHJnV-fV-xHKaLrGbSpR1mEmWzNm0PViHO5LsL_ECtrzrx2IgR7BwcDFl77GkbROT-Qrq1wnkiXBhCL1ACfIpfvl6UrHT7AzXVcgHDlk_F_Ddoja7O9AEqgyQM8dP/w640-h478/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiSzZazf8azgClCc_WAHJnV-fV-xHKaLrGbSpR1mEmWzNm0PViHO5LsL_ECtrzrx2IgR7BwcDFl77GkbROT-Qrq1wnkiXBhCL1ACfIpfvl6UrHT7AzXVcgHDlk_F_Ddoja7O9AEqgyQM8dP/)
到IDA上一看，发现这个runDll的逻辑是根据接收到的dll参数加载dll[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuUs7IUSyLaoUFg5tPlBJHCWmBP5CIi2W3gKp2qwzS1WAKdtHpcVEFGbe9J8h4lROxjI5oNZhZI-NjnCMqTd8aovqpQrZktSqm2FZTggK1n7Mj5tLMF8k93ymDiBMzy0SV8bUtcjUWrEA3/w623-h321/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjuUs7IUSyLaoUFg5tPlBJHCWmBP5CIi2W3gKp2qwzS1WAKdtHpcVEFGbe9J8h4lROxjI5oNZhZI-NjnCMqTd8aovqpQrZktSqm2FZTggK1n7Mj5tLMF8k93ymDiBMzy0SV8bUtcjUWrEA3/)

接着再去获取的proc参数作为函数名，通过GetProcAddress获取函数地址。最后再去把获取的para参数和另一个不知道干什么的v36传入到刚刚获取的函数中[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgA2xIDq3s5JkQwAlVARhBBuh9_DEKY_4OoSmnj6Q1cSbyIg7trvxSTu8k7Yf8UixzIaKGu68Dtq7sNxKyZ1XhrMYHfGcjPJuOLkbK63SgVbujiNAsiigoSpNRGGg6zL7p-ZCRz6PqQvdz4/w640-h344/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgA2xIDq3s5JkQwAlVARhBBuh9_DEKY_4OoSmnj6Q1cSbyIg7trvxSTu8k7Yf8UixzIaKGu68Dtq7sNxKyZ1XhrMYHfGcjPJuOLkbK63SgVbujiNAsiigoSpNRGGg6zL7p-ZCRz6PqQvdz4/)分析透了这个runDll之后，我们可以发现这里有执行shell的可能性。首先这个dll参数并没有任何过滤，这意味着我们可以穿越到任意目录中去调用任意位置的DLL，因此Windows的各种API我们都可以想办法去调用了。接着我需要找一个API函数，它接收两个参数，第一个参数是命令，第二个参数随便什么都可以，尽管看起来要满足这个条件相当的苛刻，但是真的有一个函数可以做到，那就是WinExec
[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgxNzMKl76_yBX_DzssOQBx_pXGI3m2tTqDOd4ojXSwrblOeelI5IZ86t2HIkEEUmUG0QQJ9J8m4WKAdRsuasa4PjItXlei02qAFdv9o8815Ul7C-nUr6sNUxUyV8pCiqX4JP_uubpwKciF/w640-h390/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgxNzMKl76_yBX_DzssOQBx_pXGI3m2tTqDOd4ojXSwrblOeelI5IZ86t2HIkEEUmUG0QQJ9J8m4WKAdRsuasa4PjItXlei02qAFdv9o8815Ul7C-nUr6sNUxUyV8pCiqX4JP_uubpwKciF/)
而根据微软的描述，这个函数在Kernel32.dll中[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgueJJMYbvpvglPz-ANITf-FcqYa5pJeFkR-G7jhJPwioHTrfqSc_2hEytAth0hjk-rt0VefcZuk2VvL69LDoEfu9bSlqHjLBxdJQ1Ek2EmdXSaBlQAiG_shvnLCNjUhm5Bh_KPLSi8bd_a/w640-h322/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgueJJMYbvpvglPz-ANITf-FcqYa5pJeFkR-G7jhJPwioHTrfqSc_2hEytAth0hjk-rt0VefcZuk2VvL69LDoEfu9bSlqHjLBxdJQ1Ek2EmdXSaBlQAiG_shvnLCNjUhm5Bh_KPLSi8bd_a/)
于是构造如下Payload打过去[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_1ACJnMjgQ3SxM1jyZt7eDoWGihd8LX_AxvaKgUbaNmDVv5I2T_YhTfLHkENn3RRBS6qRcrJhhx6_YJftECOZRL1fP-2vxngbhBVgYciWk4VX8VThgyGwKeloWEdsOAkwSgjJ5haFuHEn/w640-h204/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_1ACJnMjgQ3SxM1jyZt7eDoWGihd8LX_AxvaKgUbaNmDVv5I2T_YhTfLHkENn3RRBS6qRcrJhhx6_YJftECOZRL1fP-2vxngbhBVgYciWk4VX8VThgyGwKeloWEdsOAkwSgjJ5haFuHEn/)

函数成功执行，但是并没有弹出计算器，不过这个执行的过程已经被火绒剑记录了下来，这证明我们成功地执行了shell[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhieyqVbzzlZGBuQZRmznL5ckz2kEmI_Txj2i51_okBjhdsRBEDrly16M_T3G8-ANLFKzg-5PZnBkHtyIhOSz9Tnm8XWktRnmwfpBkLpBhJ32m9TAoVRjKinWuBwmJDIcOjZ0qWZljt-Sj2/w640-h264/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhieyqVbzzlZGBuQZRmznL5ckz2kEmI_Txj2i51_okBjhdsRBEDrly16M_T3G8-ANLFKzg-5PZnBkHtyIhOSz9Tnm8XWktRnmwfpBkLpBhJ32m9TAoVRjKinWuBwmJDIcOjZ0qWZljt-Sj2/)
至此，整个利用链已经清晰了，就是通过XSS让管理员执行恶意JS，从而触发一个CSRF过去让服务器执行shell

0x04 完整的利用过程展示
首先用CS生成一个powershell的payload，这样就可以做到一执行命令就弹shell，接着编写CSRFPayload,用我写的[CSRF 原理 利用 防御](https://drivertom.blogspot.com/2019/03/csrf.html)就可以了。[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgNBu2zo5Qxjyx1Fu8OYS0VJMtKtP9Xmh4KeUC7m7OXJ5_KuSFhmwzbDJ1pqEQnYaQRm0JV_1fuHV6EKOD9ieqTIHgFmj9iQkF27PDGq-mrRFErdb6FLDoOugo0b09Y5RRbIgyooXXJ9_BH/w640-h378/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgNBu2zo5Qxjyx1Fu8OYS0VJMtKtP9Xmh4KeUC7m7OXJ5_KuSFhmwzbDJ1pqEQnYaQRm0JV_1fuHV6EKOD9ieqTIHgFmj9iQkF27PDGq-mrRFErdb6FLDoOugo0b09Y5RRbIgyooXXJ9_BH/)

由于samesite Cookies机制，现在用POST来发CSRF包会导致Cookies不会发过去，但是现在是用IP来认证的，和Cookies无关，所以用POST来发是完全没问题的
接着用requests去插入一个带有XSS的访问记录，这个Payload的功能是去引入攻击机上面的JS来执行[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgugU8q7HfbloaeeSGqGYhWpgyy6Lel0G7YyAt5OijwqANP1s7rkmbY48BOecUreecrKhmx8VQpOk65RjqcUq1XTNPPce0eD9Iymh-O5cRQ0JkEuwwMNiraz3oPbskYXk6Y7AEkb8dVlyl3/w640-h112/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgugU8q7HfbloaeeSGqGYhWpgyy6Lel0G7YyAt5OijwqANP1s7rkmbY48BOecUreecrKhmx8VQpOk65RjqcUq1XTNPPce0eD9Iymh-O5cRQ0JkEuwwMNiraz3oPbskYXk6Y7AEkb8dVlyl3/)
再去访问历史记录查询页面，发现CS Shell弹回来了！，攻击成功！[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgXepD9vtq1fZSVW-cWU_O5GOpd7JHKz1CVGmNn_tDZPWAQl5EXC-YgZa7j7_vzuNTFBbXGuRPyr8akoAYTV8zfeNTqtMXbptTjDbFack3Iglohk37VWvVy5bjoOlYfcyUg0j0sUcQfQW4l/w640-h242/image.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgXepD9vtq1fZSVW-cWU_O5GOpd7JHKz1CVGmNn_tDZPWAQl5EXC-YgZa7j7_vzuNTFBbXGuRPyr8akoAYTV8zfeNTqtMXbptTjDbFack3Iglohk37VWvVy5bjoOlYfcyUg0j0sUcQfQW4l/)
在复现的时候发现有点坑，对于已经访问过的网站Wfilter似乎不是那么愿意再记录一次，并且有时候记录不下来，不知道原因是什么，猜测是软件自带的bug
0x04 结语这次就懒得写EXP出来了，毕竟这个漏洞用起来应该还是相对鸡肋的，写出来也没有什么用处。这个漏洞首先要求攻击者需要能让自己的流量被记录下来（所以需要能够进入内网中），而且还要管理员点击了历史记录查询页面才会触发，而且XSS Payload的引入过程还并不是那么的稳定因为有的时候还插入不了。因此想要成功利用这个漏洞进行攻击，需要天时（XSS 能够插入）地利（进入了内网）人和（管理员去查看历史访问记录）的配合，这个条件是相当苛刻的，在实战中也不太可能真正使用这么不稳定的攻击。不过逆向这么一个cgi程序还是挺有意思的，玩玩IDA陶冶身心也不错，权当是一次小练习吧

* 获取链接
* Facebook
* X
* Pinterest
* 电子邮件
* 其他应用

### 评论

1. ![](//resources.blogblog.com/img/blank.gif)vv[2023年2月8日 13:51](https://drivertom.blogspot.com/2021/01/wfilter-icf-0day-rce.html?showComment=1675893110526#c8484523669644534937)

   [betpark](https://onlinebestecasinos.com "betpark")
   [tipobet](https://tipobet.online "tipobet")
   [betmatik](https://topsnslots.com "betmatik")
   [mobil ödeme bahis](https://flightnuts.com "mobil ödeme bahis")
   [poker siteleri](https://canlipokersiteleri.info "poker siteleri")
   [kralbet](https://sakralarab.com "kralbet")
   [slot siteleri](https://slothensai.com "slot siteleri")
   [kibris bahis siteleri](https://kibrisbahissiteleri.com "kibris bahis siteleri")
   [bonus veren siteler](https://casinosallinfo.com "bonus veren siteler")
   E2DV8F

   回复[删除](https://www.blogger.com/delete-comment.g?blogID=2311248944786954878&postID=8484523669644534937)回复
   回复
2. ![](//resources.blogblog.com/img/blank.gif)匿名[2024年10月12日 03:48](https://drivertom.blogspot.com/2021/01/wfilter-icf-0day-rce.html?showComment=1728730137206#c8626237694988210105)

   [شركة تسليك مجاري بالاحساء](https://etaleya.com/%D8%B4%D8%B1%D9%83%D8%A9-%D8%AA%D8%B3%D9%84%D9%8A%D9%83-%D9%85%D8%AC%D8%A7%D8%B1%D9%8A-%D8%A8%D8%A7%D9%84%D8%A7%D8%AD%D8%B3%D8%A7%D8%A1/) Ku2BMjGpqf

   回复[删除](https://www.blogger.com/delete-comment.g?blogID=2311248944786954878&postID=8626237694988210105)回复
   回复
3. ![](//resources.blogblog.com/img/blank.gif)匿名[2024年10月20日 11:27](https://drivertom.blogspot.com/2021/01/wfilter-icf-0day-rce.html?showComment=1729448868151#c8812242363157816453)

   [شركة مكافحة حشرات ابوظبي](https://www.sama-clean.com/%D8%B4%D8%B1%D9%83%D8%A9-%D9%85%D9%83%D8%A7%D9%81%D8%AD%D8%A9-%D8%AD%D8%B4%D8%B1%D8%A7%D8%AA-%D9%81%D9%8A-%D8%A3%D8%A8%D9%88%D8%B8%D8%A8%D9%8A/) imnbDYZeWT

   回复[删除](https://www.blogger.com/delete-comment.g?blogID=2311248944786954878&postID=8812242363157816453)回复
   回复
4. ![](//resources.blogblog.com/img/blank.gif)匿名[2024年12月12日 04:30](https://drivertom.blogspot.com/2021/01/wfilter-icf-0day-rce.html?showComment=1734006601800#c6034455155165584415)

   [شركة عزل اسطح بالدمام](https://alnahda-elomrania-sa.com/%D8%B4%D8%B1%D9%83%D8%A9-%D8%B9%D8%B2%D9%84-%D8%A7%D8%B3%D8%B7%D8%AD-%D8%A8%D8%A7%D9%84%D8%AF%D9%85%D8%A7%D9%85/) d0frKTL3ST

   回复[删除](https://www.blogger.com/delete-comment.g?blogID=2311248944786954878&postID=6034455155165584415)回复
   回复

添加评论加载更多...

#### 发表评论

### 此博客中的热门博文

### [别想偷我源码：通用的针对源码泄露利用程序的反制（常见工具集体沦陷）](https://drivertom.blogspot.com/2021/08/git.html)

[八月 01, 2021](https://drivertom.blogspot.com/2021/08/git.html "permanent link")

[![图片](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgBDa046yTUhDQ4srpfcy7_1E_GQN6aAG7aNdYgWkH-R561asKaEYExFbrkVmyP3pTgXp9hA4QsszOfHlyH6uPg4-7kQqfywozzp4dHHdL_ePm5uAnoYjAK6SMNSmGfXyJCnC0WDd1tUbUZ/w363-h400/image.png)](https://drivertom.blogspot.com/2021/08/git.html)

  0x00 关于本文     是的没错 我又去蹂躏安全工具了，和以前我单个单个地欺负不同，这次发现的攻击手段是通用的，可以通杀大部分源码泄露漏洞利用程序。      本文会包含常见泄露漏洞的原理介绍（Git/Svn），利用工具自身的安全风险分析，简单易懂的POC制作方式，针对常见工具的攻击测试，以及提升反制威力的方法及展望。 0x01Git泄露：漏洞原理介绍      Git是什么大家应该都很清楚（不知道Git是啥的人多半是不肯来光临这个博客的）      有些开发人员直接把代码clone到服务器的web目录来部署，但是开发人员或许不知道的是，clone下来的不只是代码，还有一个.git目录，这个目录被叫做版本库。攻击者可以通过访问这个目录，解析其中的文件，dump整站源码。     想要更深入地理解Git泄露漏洞，了解攻击流程，就需要了解.git目录的结构     tree一下这个目录，发现内容如下      index文件中包含了这个项目中的各个文件的信息，包括文件路径和Git对象的对应的40位哈希值。在这里我们不需要对Git对象理解的很深入，只需要知道里面包含了文件内容，是让攻击者垂涎欲滴的东西就可以了。      想要拿到Git对象，就需要转去objects目录。objects目录存放了所有的git对象，对于一个git对象，40位哈希的前两位会作为目录名，而后面的38位会作为文件名，存在objects下面。举个例子，一个Git对象那个的hash是cb75d8439f004f41d5f85ffa5f8d017df395651a，那么它就会被存在cb/75d8439f004f41d5f85ffa5f8d017df395651a。     知道了这些信息之后，就可以知道Git泄露攻击是如何进行的了，首先攻击者访问index文件，解析后得到文件名和对象哈希。接着按着对象哈希一个一个去objects目录获取到Git对象，解析后得到文件。 0x02 Git泄露利用工具的安全风险     显而易见的，手动解析inde...

[阅读全文](https://drivertom.blogspot.com/2021/08/git.html "别想偷我源码：通用的针对源码泄露利用程序的反制（常见工具集体沦陷）")

### [复现基于eBPF实现的Docker逃逸](https://drivertom.blogspot.com/2022/01/ebpfdocker.html)

[一月 22, 2022](https://drivertom.blogspot.com/2022/01/ebpfdocker.html "permanent link")

[![图片](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhyRi5x9acc5rrOFq8CgD3yrGolQN8vDWMczuMY-YjE8RARZizBMKDLRCFH8JBRYKK74rsfIREQd41sdLRZXn9azyPAqKxEvD1c86uMwkv-xSaMSvHzTP2_DEeF4fFwzA6yvM5fagVqMN6u/w640-h542/image.png)](https://drivertom.blogspot.com/2022/01/ebpfdocker.html)

0x00 关于本文     最近搞毕业设计在研究Docker逃逸，如果只把 CDK工具 的东西复现一遍（或者照抄），那诚意不足，也失掉了我刻意选我不熟悉领域的题目的意义所在，于是想自己动手做点东西。     看到 seebug上基于eBPF的逃逸 和 ScUpax0s的容器逃逸文章 ，我意识到基于eBPF的逃逸可以做一做，虽然他们都写了思路贴了部分代码片段，但毕竟没有放完整的代码出来，我自己踩坑实现一遍，可以学点东西，也能算是工作量。     文章中的代码实现已上传至 Github 。     在实现的过程中，ScUpax0s给了我许多指点，让我少走了很多弯路，感谢他！ 0x01 eBPF为什么能帮助Docker逃逸     eBPF技术允许用户在用户态编写代码，被verifier扫描鉴定无问题后，送入内核执行。     e BPF可以在Linux系统的各个地方插桩，在执行到指定位置时，执行用户自定的代码，实现数据搜集和修改。 因此 eBPF使得用户可以在用户态高效安全地监控Linux的方方面面。     能看，还能改，黑客自然也可以拿它来使坏。更妙的是，在Docker环境中，容器和宿主机共享同一个内核，因此如果容器被赋予了CAP\_SYS\_ADMIN能力，成功在容器中加载了eBPF程序的话，eBPF程序将能够直接在系统的内核中运行，无视容器的各类隔离机制。因此在宿主机环境中作恶的eBPF，在容器中照作不误，它能在宿主机环境里面干上面，那就能在容器里干什么，突破隔离一步到位。 0x02 通过BPF劫持cron进行逃逸     尽管看起来很容易，但真正实现逃逸还需要一番周折。eBPF的代码仅能在触发插桩点的时候执行，它能够读参数，对指定地址的用户内存读写，但无法直接发起一个系统调用，弹一个shell回来。      seebug上基于eBPF的逃逸 给出了一种思路，即利用cron进行逃逸。      cron服务在Linux系统上实现了计划任务，它每隔一段时间检查配置文件是否被更改过，如果更改了就读取配置文件，根据配置文件的描述设定定时的命令执行。因此通过...

[阅读全文](https://drivertom.blogspot.com/2022/01/ebpfdocker.html "复现基于eBPF实现的Docker逃逸")

[由 Blogger 提供支持](https://www.blogger.com)

主题背景图片创建者：[Michael Elkan](http://www.offset.com/photos/394244)

[DriverTom](https://www.blogger.com/profile/02138474656496366347)

[访问个人资料](https://www.blogger.com/profile/02138474656496366347)

### 归档

* [七月 20221](https://drivertom.blogspot.com/2022/07/)
* [六月 20221](https://drivertom.blogspot.com/2022/06/)
* [一月 20221](https://drivertom.blogspot.com/2022/01/)
* [八月 20212](https://drivertom.blogspot.com/2021/08/)
* [六月 20211](https://drivertom.blogspot.com/2021/06/)
* [一月 20212](https://drivertom.blogspot.com/2021/01/)
* [十二月 20201](https://drivertom.blogspot.com/2020/12/)
* [八月 20203](https://drivertom.blogspot.com/2020/08/)
* [五月 20201](https://drivertom.blogspot.com/2020/05/)
* [一月 20203](https://drivertom.blogspot.com/2020/01/)

* [十一月 20191](https://drivertom.blogspot.com/2019/11/)
* [十月 20191](https://drivertom.blogspot.com/2019/10/)
* [八月 20193](https://drivertom.blogspot.com/2019/08/)
* [七月 20192](https://drivertom.blogspot.com/2019/07/)
* [六月 20193](https://drivertom.blogspot.com/2019/06/)
* [五月 20191](https://drivertom.blogspot.com/2019/05/)
* [四月 20192](https://drivertom.blogspot.com/2019/04/)
* [三月 20193](https://drivertom.blogspot.com/2019/03/)
* [十二月 20181](https://drivertom.blogspot.com/2018/12/)
* [十一月 20181](https://drivertom.blogspot.com/2018/11/)

显示更多
隐藏部分

### [举报滥用情况](https://www.blogger.com/go/report-abuse)


