Based on the provided content, here's a breakdown of the vulnerability associated with CVE-2021-3139:

**Root Cause of Vulnerability:**

The vulnerability stems from a logic error in how the Linux SCSI target (LIO) and tcmu-runner handle SCSI "EXTENDED COPY" (XCOPY) requests, specifically in their handling of Copy Source/Copy Destination (CSCD) descriptors.

*   **LIO (Kernel):** When processing XCOPY requests, the `target_xcopy_locate_se_dev_e4()` function iterates through *all* configured backstores, instead of only considering those exposed to the initiator via transport layer ACL settings. This allows an attacker to target any backstore.
*   **tcmu-runner (User-space):** Similarly, `xcopy_locate_udev()` in tcmu-runner iterates over *all* tcmu-runner devices, disregarding transport layer restrictions.

**Weaknesses/Vulnerabilities Present:**

*   **Inadequate Access Control:** Both LIO and tcmu-runner fail to properly enforce transport layer access controls when processing XCOPY requests.
*   **Global Device List Iteration:** The vulnerability arises from iterating over a global list of devices instead of a filtered list based on access permissions.
*   **Lack of Input Validation:** The software does not adequately validate the CSCD descriptors against transport/HBA settings.
*   **Reliance on Knowledge of NAA Identifiers:** The vulnerability relies on the attacker's ability to discover NAA identifiers of victim backstores through the exposed `vpd_unit_serial`.

**Impact of Exploitation:**

*   **Unrestricted Read/Write:** An attacker with access to one LUN and knowledge of a victim backstore's Unit Serial Number (vpd\_unit\_serial, or WWN) can read and write to *any* LIO backstore on the host, bypassing transport isolation.
*   **VM Data Exposure (vhost-scsi):** In multi-tenant vhost-scsi environments, this can lead to VM guests reading or writing to images belonging to other qemu processes.
*   **iSCSI Bypass:** For iSCSI, CHAP, ACL, and network portal isolation can be bypassed, exposing data on other LUNs.
*   **Backstore Compromise:** All LIO backstore types, including "iblock", "fileio", "rd\_mcp", "pscsi", and "user", are potentially vulnerable.
*   **tcmu-runner Specific:** Within tcmu-runner, an XCOPY request to one backstore can be used to read/write other backstores handled by the same tcmu-runner instance.

**Attack Vectors:**

*   **Malicious XCOPY Requests:** Attackers send specially crafted XCOPY requests containing two CSCD descriptors. One for a LUN they have access to, and another for the victim backstore.

**Required Attacker Capabilities/Position:**

*   **Access to a LUN:** The attacker must have access to at least one LUN on the LIO target.
*   **Knowledge of Victim NAA Identifier:** The attacker must be able to obtain the NAA IEEE identifier of the victim backstore. This usually involves obtaining the vpd\_unit\_serial, which is not considered secret and can be read by any local user by default.

**Additional details:**

*   The vulnerability exists in Linux kernel versions v3.12-rc1 and later due to commit `f99715ac8d6f` and in tcmu-runner versions 1.3.0 and later due to commit `9c86bd0db97a`.
*   Mitigation for LIO (kernel) involves disabling XCOPY support by setting `emulate_3pc=0`. However this does not mitigate the tcmu-runner vulnerability.
*   The tcmu-runner fix is a complete disabling of cross-device XCOPY due to inability to evaluate transport layer access permissions.

The provided information also indicates that CVE-2021-3139 was specifically assigned for the `tcmu-runner` vulnerability, while `CVE-2020-28374` was assigned for the Linux Kernel LIO vulnerability.