=== Content from github.com_0b273cef_20250115_092228.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzephyrproject-rtos%2Fzephyr%2Fsecurity%2Fadvisories%2FGHSA-94jg-2p6q-5364)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fzephyrproject-rtos%2Fzephyr%2Fsecurity%2Fadvisories%2FGHSA-94jg-2p6q-5364)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=zephyrproject-rtos%2Fzephyr)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[zephyrproject-rtos](/zephyrproject-rtos)
/
**[zephyr](/zephyrproject-rtos/zephyr)**
Public

* [Notifications](/login?return_to=%2Fzephyrproject-rtos%2Fzephyr) You must be signed in to change notification settings
* [Fork
  6.8k](/login?return_to=%2Fzephyrproject-rtos%2Fzephyr)
* [Star
   11.2k](/login?return_to=%2Fzephyrproject-rtos%2Fzephyr)

* [Code](/zephyrproject-rtos/zephyr)
* [Issues
  1.9k](/zephyrproject-rtos/zephyr/issues)
* [Pull requests
  877](/zephyrproject-rtos/zephyr/pulls)
* [Discussions](/zephyrproject-rtos/zephyr/discussions)
* [Actions](/zephyrproject-rtos/zephyr/actions)
* [Projects
  20](/zephyrproject-rtos/zephyr/projects)
* [Wiki](/zephyrproject-rtos/zephyr/wiki)
* [Security](/zephyrproject-rtos/zephyr/security)
* [Insights](/zephyrproject-rtos/zephyr/pulse)

Additional navigation options

* [Code](/zephyrproject-rtos/zephyr)
* [Issues](/zephyrproject-rtos/zephyr/issues)
* [Pull requests](/zephyrproject-rtos/zephyr/pulls)
* [Discussions](/zephyrproject-rtos/zephyr/discussions)
* [Actions](/zephyrproject-rtos/zephyr/actions)
* [Projects](/zephyrproject-rtos/zephyr/projects)
* [Wiki](/zephyrproject-rtos/zephyr/wiki)
* [Security](/zephyrproject-rtos/zephyr/security)
* [Insights](/zephyrproject-rtos/zephyr/pulse)

# DOS: Incorrect 802154 Frame Validation for Omitted Source / Dest Addresses

Moderate

[ceolin](/ceolin)
published
GHSA-94jg-2p6q-5364
Oct 5, 2021

## Package

zephyr
(west)

## Affected versions

> v2.4.0

## Patched versions

v2.5.0

## Description

# 1. Incorrect 802154 Frame Validation for Omitted Source / Dest Addresses

* Bug Description: Improper processing of omitted source and destination addresses in ieee802154 frame validation (ieee802154\_validate\_frame)
* Bug Result: Value "2" treated as a struct pointer within 802154 logic. More specifically, bytes at addresses 2-8 are endianness swapped (initial stack pointer and reset vector address in case IVT is mapped at address 0). This may change the initial stack pointer and reset vector address on some systems. Depending on the values and memory layout, this might lead to attacker-controlled code being executed during device reset.
* Bug Impact: In most cases, denial of service (crash of firmware). In niche situations, RCE might be achieved by an attacker.

## Bug Details

* Affected code: 802154 Frame parsing and validation, starting in subsys/net/l2/ieee802154/ieee802154.c#ieee802154\_recv

High-Level reasoning for bug occurrence:

1. Source and Destination addresses are validated in ieee802154\_recv->ieee802154\_validate\_frame->validate\_addr
2. Address validation may result in assignment of NULL source and dest addresses
3. Assigning NULL seems to be intended behavior during frame validation
4. However, the potential assignment of NULL is not properly handled while processing DATA frames, and the assignment of the source/dest addresses in set\_pkt\_ll\_addr function may result in the assignment of an invalid pointer in the set\_pkt\_ll\_addr function.
5. This invalid pointer is then used during DATA frame processing in ieee802154\_manage\_recv\_packet->sys\_mem\_swap, resulting in the use of a corrupted pointer and thus a crash

Vulnerable code path:

1. ieee802154\_recv->ieee802154\_validate\_frame->validate\_addr may return NULL pointer
   * This is the case for the IEEE802154\_ADDR\_MODE\_NONE address type and for short packets. For too short packets, any address type can be indicated (including IEEE802154\_ADDR\_MODE\_EXTENDED)
   * As soon as an address with a type other than IEEE802154\_ADDR\_MODE\_NONE and a corrupt pointer is assigned, the following processing logic will wrongly operate on this data
   * Link:

     [zephyr/subsys/net/l2/ieee802154/ieee802154\_frame.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154_frame.c#L120)

     Line 120
     in
     [d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

     |  | return NULL; |
     | --- | --- |
2. ieee802154\_recv->ieee802154\_validate\_frame treats this as intended behavior, not indicating failed frame validation when NULL is returned for an address of type other than IEEE802154\_ADDR\_MODE\_NONE
   * Consequently, the statement: mpdu->mhr.src\_addr = validate\_addr(...)
   * May result in a NULL pointer assignment mpdu->mhr.src\_addr==NULL
   * Link:

     [zephyr/subsys/net/l2/ieee802154/ieee802154\_frame.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154_frame.c#L442)

     Line 442
     in
     [d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

     |  | mpdu->mhr.dst\_addr = validate\_addr(p\_buf, &p\_buf, &length, |
     | --- | --- |

Bug Manifestation Path a) DATA frames

3. During DATA Frame processing, this NULL value is passed on to set\_pkt\_ll\_addr

- Code: set\_pkt\_ll\_addr(net\_pkt\_lladdr\_src(pkt), mpdu.mhr.fs->fc.pan\_id\_comp, mpdu.mhr.fs->fc.src\_addr\_mode, mpdu.mhr.src\_addr);

- Link:

[zephyr/subsys/net/l2/ieee802154/ieee802154.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154.c#L209)

Line 209
in
[d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

|  | set\_pkt\_ll\_addr(net\_pkt\_lladdr\_src(pkt), mpdu.mhr.fs->fc.pan\_id\_comp, |
| --- | --- |

4. Within set\_pkt\_ll\_addr, the address argument is not checked against NULL

- It is used in the following assignment: addr->addr = ll->plain.addr.ext\_addr;

- For ll being a NULL pointer, this results in addr->addr==2, which is a non-NULL, corrupted pointer

- Link:

[zephyr/subsys/net/l2/ieee802154/ieee802154.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154.c#L110)

Line 110
in
[d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

|  | addr->addr = ll->plain.addr.ext\_addr; |
| --- | --- |

5. In further 6LoWPAN processing in ieee802154\_manage\_recv\_packet, the packet containing the corrupted address is then used in case it is not NULL

- The call sys\_mem\_swap(net\_pkt\_lladdr\_src(pkt)->addr, net\_pkt\_lladdr\_src(pkt)->len) then results in addresses 2-8 being byte-swapped

- Link:

[zephyr/subsys/net/l2/ieee802154/ieee802154.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154.c#L134)

Line 134
in
[d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

|  | if (net\_pkt\_lladdr\_src(pkt)->addr && |
| --- | --- |

Bug Manifestation Path b) MAC\_COMMAND frames

3. ieee802154\_validate\_frame->(validate\_addr)->validate\_payload\_and\_mfr->validate\_mac\_command->validate\_mac\_command\_cfi\_to\_mhr will similarly use the provided destination address, resulting in a crash

- The crash occurs while making sure that the destination is a broadcast statement in the following statement: mhr->dst\_addr->plain.addr.short\_addr != IEEE802154\_BROADCAST\_ADDRESS

- This is the case for frames of types IEEE802154\_CFI\_BEACON\_REQUEST or IEEE802154\_CFI\_COORDINATOR\_REALIGNEMENT with NULL addresses in mode IEEE802154\_ADDR\_MODE\_SHORT

## Annotated Source Code Snippets

```
struct ieee802154_address_field_plain {
	uint16_t pan_id;
	struct ieee802154_address addr;
} __packed;

struct ieee802154_address_field {
	union {
		struct ieee802154_address_field_plain plain;
		struct ieee802154_address_field_comp comp;
	};
} __packed;

// addr->addr = ll->plain.addr.ext_addr;
// For ll==0, this means that addr->addr=2;

```

```
static inline struct ieee802154_address_field *
validate_addr(uint8_t *buf, uint8_t **p_buf, uint8_t *length,
	      enum ieee802154_addressing_mode mode,
	      bool pan_id_compression)
{
	...
    if (mode == IEEE802154_ADDR_MODE_SHORT) {
		len += IEEE802154_SHORT_ADDR_LENGTH;
	} else {
		/* IEEE802154_ADDR_MODE_EXTENDED */
		len += IEEE802154_EXT_ADDR_LENGTH;
	}

    // BUG: IEEE802154_ADDR_MODE_EXTENDED and len > *length lead to NULL
	if (len > *length) {
		return NULL;
	}
    ...
}

```

```
bool ieee802154_validate_frame(uint8_t *buf, uint8_t length,
			       struct ieee802154_mpdu *mpdu)
{
    ...
    mpdu->mhr.dst_addr = validate_addr(p_buf, &p_buf, &length,
					   mpdu->mhr.fs->fc.dst_addr_mode,
					   false);

    // This can be NULL
	mpdu->mhr.src_addr = validate_addr(p_buf, &p_buf, &length,
					   mpdu->mhr.fs->fc.src_addr_mode,
					   (mpdu->mhr.fs->fc.pan_id_comp));

    // Bug: Missing check for null pointer assignment of src_addr
    ...
}

```

```
static enum net_verdict ieee802154_recv(struct net_if *iface,
					struct net_pkt *pkt)
{
    ...
    if (!ieee802154_validate_frame(net_pkt_data(pkt),
				       net_pkt_get_len(pkt), &mpdu)) {
		return NET_DROP;
	}
    ...
    // BUG: mpdu.mhr.src_addr can be NULL
    set_pkt_ll_addr(net_pkt_lladdr_src(pkt), mpdu.mhr.fs->fc.pan_id_comp,
			mpdu.mhr.fs->fc.src_addr_mode, mpdu.mhr.src_addr);

	set_pkt_ll_addr(net_pkt_lladdr_dst(pkt), false,
			mpdu.mhr.fs->fc.dst_addr_mode, mpdu.mhr.dst_addr);
    ...
}

```

```
static inline void set_pkt_ll_addr(struct net_linkaddr *addr, bool comp,
				   enum ieee802154_addressing_mode mode,
				   struct ieee802154_address_field *ll)
{
	if (mode == IEEE802154_ADDR_MODE_NONE) {
		return;
	}

	if (mode == IEEE802154_ADDR_MODE_EXTENDED) {
		addr->len = IEEE802154_EXT_ADDR_LENGTH;

		if (comp) {
			addr->addr = ll->comp.addr.ext_addr;
		} else {
            // BUG: for null ll pointer, this mean addr->addr = 2
			addr->addr = ll->plain.addr.ext_addr;
		}
	} else {
		/* ToDo: Handle short address (lookup known nbr, ...) */
		addr->len = 0U;
		addr->addr = NULL;
	}

	addr->type = NET_LINK_IEEE802154;
}

```

```
enum net_verdict ieee802154_manage_recv_packet(struct net_if *iface,
					       struct net_pkt *pkt,
					       size_t hdr_len)
{
    ...
    	/* Upper IP stack expects the link layer address to be in
	 * big endian format so we must swap it here.
	 */
    // BUG: this null pointer check is bypassed, as net_pkt_lladdr_src(pkt)->addr==2 in the vuln code path
    // -> This leads to endianness swap of addresses 2-8
	if (net_pkt_lladdr_src(pkt)->addr &&
	    net_pkt_lladdr_src(pkt)->len == IEEE802154_EXT_ADDR_LENGTH) {
		sys_mem_swap(net_pkt_lladdr_src(pkt)->addr,
			     net_pkt_lladdr_src(pkt)->len);
	}

```
## Proposed Fix

* During address validation in validate\_addr, ensure that frame validation fails if no valid address is present outside the IEEE802154\_ADDR\_MODE\_NONE address type.
  + In case the packet is too short to hold the actual address, either change the address mode to IEEE802154\_ADDR\_MODE\_NONE or (probably the better idea) outright drop the packet
  + Link:

    [zephyr/subsys/net/l2/ieee802154/ieee802154\_frame.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154_frame.c#L120)

    Line 120
    in
    [d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

    |  | return NULL; |
    | --- | --- |
  + This could be implemented as ieee802154\_validate\_frame returning false in case mpdu->mhr.dst\_addr or mpdu->mhr.src\_addr are NULL, but not of type IEEE802154\_ADDR\_MODE\_NONE
  + Links:
    - Destination address:

      [zephyr/subsys/net/l2/ieee802154/ieee802154\_frame.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154_frame.c#L442)

      Line 442
      in
      [d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

      |  | mpdu->mhr.dst\_addr = validate\_addr(p\_buf, &p\_buf, &length, |
      | --- | --- |
    - Source address:

      [zephyr/subsys/net/l2/ieee802154/ieee802154\_frame.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154_frame.c#L446)

      Line 446
      in
      [d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

      |  | mpdu->mhr.src\_addr = validate\_addr(p\_buf, &p\_buf, &length, |
      | --- | --- |
  + Alternatively, change the validate\_addr prototype to return false for failed address asignments (more specifically, the too-short-packet case), similar to other validation functions
  + Link:

    [zephyr/subsys/net/l2/ieee802154/ieee802154\_frame.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154_frame.c#L119)

    Line 119
    in
    [d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

    |  | if (len > \*length) { |
    | --- | --- |

Fix code for

[zephyr/subsys/net/l2/ieee802154/ieee802154\_frame.c](https://github.com/zephyrproject-rtos/zephyr/blob/d969aced6dd9ef7834d21ff8131aa561e71cc42d/subsys/net/l2/ieee802154/ieee802154_frame.c#L442)

Line 442
in
[d969ace](/zephyrproject-rtos/zephyr/commit/d969aced6dd9ef7834d21ff8131aa561e71cc42d)

|  | mpdu->mhr.dst\_addr = validate\_addr(p\_buf, &p\_buf, &length, |
| --- | --- |

```
diff --git a/subsys/net/l2/ieee802154/ieee802154_frame.c b/subsys/net/l2/ieee802154/ieee802154_frame.c
m
index 1d479c85d9..56c0b01204 100644
--- a/subsys/net/l2/ieee802154/ieee802154_frame.c
+++ b/subsys/net/l2/ieee802154/ieee802154_frame.c
@@ -443,10 +443,20 @@ bool ieee802154_validate_frame(uint8_t *buf, uint8_t length,
 					   mpdu->mhr.fs->fc.dst_addr_mode,
 					   false);

+	// Proposed fix: Propagate dst address validation
+	if (mpdu->mhr.dst_addr == NULL && mpdu->mhr.fs->fc.dst_addr_mode != IEEE802154_ADDR_MODE_NONE)
 {
+		return false;
+	}
+
 	mpdu->mhr.src_addr = validate_addr(p_buf, &p_buf, &length,
 					   mpdu->mhr.fs->fc.src_addr_mode,
 					   (mpdu->mhr.fs->fc.pan_id_comp));

+	// Proposed fix: Propagage src address validation
+	if (mpdu->mhr.src_addr == NULL && mpdu->mhr.fs->fc.src_addr_mode != IEEE802154_ADDR_MODE_NONE)
 {
+		return false;
+	}

```
### Patches

master: [#31908](https://github.com/zephyrproject-rtos/zephyr/pull/31908) (2.5.0)

v2.4.0: TBD

### For more information

If you have any questions or comments about this advisory:

* Open an issue in [zephyr](https://github.com/zephyrproject-rtos/zephyr/issues/)
* Email us at Zephyr-vulnerabilities

embargo: 2020-04-14

zepsec: ZEPSEC-112

### Severity

Moderate

6.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
Low

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:H

### CVE ID

CVE-2021-3319

### Weaknesses

[CWE-476](/advisories?query=cwe%3A476) [CWE-588](/advisories?query=cwe%3A588)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


