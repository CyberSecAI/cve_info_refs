=== Content from pentest.blog_edde430e_20250115_113647.html ===

[Skip to main content](#content)
[![Pentest Blog](https://pentest.blog/wp-content/uploads/pentestblog-color-e1508706802866.png)](https://pentest.blog/)

Toggle navigation

* [Advisories](https://pentest.blog/category/advisories/)
* [Operating System](https://pentest.blog/category/operating-system/)
* [Application Security](https://pentest.blog/category/application-security/)
* [Network](https://pentest.blog/category/network/)
* [Tools](https://pentest.blog/category/tools/)
* [Article Series](https://pentest.blog/article-series/)
* [About Us](https://pentest.blog/about-us/)

![](https://pentest.blog/wp-content/uploads/pardus-21-ile-gelen-yenilikler-neler137880_13-750x410.jpg)
# Pardus 21 Linux Distro â€“ Remote Code Execution 0day 2021 CVE-2021-3806

 [September 13, 2021September 21, 2021](https://pentest.blog/pardus-21-linux-distro-remote-code-execution-0day-2021/)  [Mehmet Ince](https://pentest.blog/author/mehmet-ince/)
[Research](https://pentest.blog/category/research/)

A couple of days ago, I came up with news that Pardus will organize a report-bug contest. I love to contribute to open-source projects. So that was a pretty good chance to revisit one of my old friends, Pardus, and uncover security and/or privacy issues.

## What is Pardus ?

**Pardus**Â is aÂ [Linux distribution](https://en.wikipedia.org/wiki/Linux_distribution)Â developed with support from the government ofÂ [Turkey](https://en.wikipedia.org/wiki/Turkey). Pardusâ€™ main focus is office-related work including use in TurkishÂ [government agencies](https://en.wikipedia.org/wiki/Government_agency).Â Despite that, Pardus ships in several languages. Its ease of use and availability free of charge has spawned numerous communities throughout the world.[[1]](https://en.wikipedia.org/wiki/Pardus_%28operating_system%29)

It started its life as a Gentoo-based project before developing its own unique identity. Since late 2012 the distribution is based on Debian GNU/Linux.

## Itâ€™s Debian Based Distro. So, where to Target?

I used to be one of the volunteers of Pardus back in 2009. It was an excellent and promising project back in those days. But Pardus has chosen to shift their Linux base to Debian. As far as I know, ever since 2012, they mainly develop packages around new core.

For that reason, I decided to focus on the GUI of the package manager without having a second thought.

![](https://pentest.blog/wp-content/uploads/pardus-software-center.jpg)
## Vulnerability Research

Installation of the Pardus 21 is pretty straightforward. But itâ€™s somewhat complicated to find the source-code of the packages developed by the Pardus team on the internet. I think they are still working on these types of issues while they work hard on releases.

Letâ€™s find where the `Pardus Software Center`. Click on `Pardus` icon on the bottom-left and then click on `Pardus Software Center` shortcut. That will initiate the process. That process has to be child process of the xfce4-session. We can easily locate path and the program with `ps auxf`.

![](https://pentest.blog/wp-content/uploads/main2.jpg)

As a next step, copy all the files under the target directory to the main host. So that we can start offensive code review.

```
â”Œâ”€â”€(rootðŸ’€DESKTOP-I30B071)-[~/pardus-software]
â””â”€# ls -al
total 196
drwxr-xr-x 2 root root   4096 Sep 13 09:18 .
drwx------ 4 root root   4096 Sep 13 09:18 ..
-rwxr-xr-x 1 root root   2707 Sep 13 09:18 Actions.py
-rw-r--r-- 1 root root   1719 Sep 13 09:18 AppDetail.py
-rw-r--r-- 1 root root   1674 Sep 13 09:18 AppImage.py
-rw-r--r-- 1 root root   1723 Sep 13 09:18 AppRequest.py
-rw-r--r-- 1 root root   1999 Sep 13 09:18 CellRendererButton.py
-rw-r--r-- 1 root root   2091 Sep 13 09:18 GnomeComment.py
-rw-r--r-- 1 root root   1094 Sep 13 09:18 GnomeRatingServer.py
-rw-r--r-- 1 root root 132924 Sep 13 09:18 MainWindow.py
-rw-r--r-- 1 root root   4974 Sep 13 09:18 Package.py
-rw-r--r-- 1 root root   7744 Sep 13 09:18 Server.py
-rw-r--r-- 1 root root   1869 Sep 13 09:18 UserSettings.py
-rw-r--r-- 1 root root     11 Sep 13 09:18 __version__
-rwxr-xr-x 1 root root    539 Sep 13 09:18 main.py                                                                                                                                                        100% 1094     3.1MB/s
```
## Vulnerability : Insecure Tar Extraction

While I was reviewing the project, one question has raised in my mind. Where are these app icons coming from? It is not possible to ship all icons via one Pardus package, is it?

Following function is taken from `MainWindows.py` file, between lines 706-712. So it looks like icons are coming from server.

```
    def getIcons(self):
        if self.Server.connection:
            # self.splashbar.pulse()
            print("Getting icons from server")
            self.splashlabel.set_markup("<b>{}</b>".format(_("Getting icons from server")))
            self.serverappicons = self.Server.getAppIcons()
            self.servercaticons = self.Server.getCategoryIcons()
```

Letâ€™s see how does it fetch and use the icons. `getAppIcons()` is defined within Server.py file.

```
    def getAppIcons(self):
        if not self.isExists(self.cachedir + self.serverappicons):
            print("trying to downlad " + self.serverappicons)
            try:
                response = requests.get(self.serverurl + self.serverfiles + self.serverappicons + self.serverarchive)
            except:
                print(
                    "server error getting " + self.serverurl + self.serverfiles + self.serverappicons + self.serverarchive)
                return False
            if response.status_code == 200:
                if self.createDir(self.cachedir):
                    with open(self.cachedir + self.serverappicons + self.serverarchive, "wb") as file:
                        file.write(response.content)
                    if self.extractArchive(self.cachedir + self.serverappicons + self.serverarchive,
                                           self.serverappicons):
                        return True
                return False
            else:
                print("{} : {}".format("error getting app icons, status code", response.status_code))
                return False
        else:
            return True
```

In a nutshell, Pardus Software Center fetches icons as an archive and extracts them on line 15. That sounds okay. But two questions I must ask:

1 â€“ Any kind of network-level encryption ?
2 â€“ How does it extract archives?

Letâ€™s have a look at the class variables of the Server, to answer the first question. Actually, that shouldnâ€™t have been a problem. Because it fetch a innocent archive file that contains lots of images.

```
class Server(object):
    def __init__(self):
        self.serverurl = "http://store.pardus.org.tr"
        self.serverapps = "/api/v2/apps/"
        self.servercats = "/api/v2/cats/"
        self.serverhomepage = "/api/v2/homepage"
        self.serversendrate = "/api/v2/rate"
        self.serversenddownload = "/api/v2/download"
        self.serversendsuggestapp = "/api/v2/suggestapp"
        self.serverfiles = "/files/"
        self.serverappicons = "appicons"
        self.servercaticons = "categoryicons"
        self.serverarchive = ".tar.gz"
        self.serversettings = "/api/v2/settings"
        self.settingsfile = "serversettings.ini"
```

Letâ€™s see how does it extract the archive file. The following function is taken from Server.py file, lines between 163-173.

```
    def extractArchive(self, archive, type):
        if not Path(self.cachedir + type).exists():
            try:
                tar = tarfile.open(archive)
                tar.extractall(path=self.cachedir)
                tar.close()
                return True
            except:
                print("tarfile error")
                return False
        return True
```

I do NOT see any validation on files names within the archive file. extractall() method of tarfile package does NOT restrict the file extraction to the different paths when the file has a directory traversal destination. (E.g: ../../../backdoor.sh) . The archive file is taken over HTTP traffic. You see where Iâ€™m going..

## Exploitation

1 â€“ Perform ARP poisoning attack in order to become Man In The Middle.

2 â€“ When the Pardus user open Pardus Software Center application

3 â€“ Following HTTP request will be generated by the app ( <http://store.pardus.org.tr/files/appicons.tar.gz> )

4 â€“ Intercept the tar.gz file and replace it with your own tar.gz file that contains ../../.ssh/authorized\_keys with a public key of your own ssh file.

5- extractAll() method will be executed with our own tar.gz file.

6 â€“ When the insecure tar extraction is being done, your public ssh key will be stored under the userâ€™s home folder. That will give us the chance to ssh to the target !

7 â€“ SSH to the box your public key.

## Proof of Concept

Iâ€™ve implemented a bash script, which automates all steps.

## Bonus Finding: Privacy Issue : Mac Adress Leakage over HTTP

During the research, Iâ€™ve found that the Pardus Software Center is sending an HTTP POST request (to store.pardus.org.tr ) containing the computerâ€™s MAC address when the user clicks on an app icon.

* ![](https://pentest.blog/wp-content/uploads/pardus-mac-leak.jpg)

That issue also has been fixed along with the vulnerability.

## Timeline

07 Sep 2021 01:15 AM â€“ Research started

07 Sep 2021 02:10 AM â€“ Vulnerabilities found.

07 Sep 2021 03:37 AM â€“ PoC implemented and video record.

08 Sep 2021 12:00 AM â€“ Report it to the Pardus team.

08 Sep 2021 13:15 PM â€“ Vulnerability validated by the vendor.

09 Sep 2021 7:17 AM â€“ Patch released.

[0day](https://pentest.blog/tag/0day/) [advisory](https://pentest.blog/tag/advisory/) [exploit](https://pentest.blog/tag/exploit/) [linux](https://pentest.blog/tag/linux/)

![](https://secure.gravatar.com/avatar/a02c8481b3d29584e05195893e584b61?s=60&d=monsterid&r=g)

#### [Mehmet Ince](https://pentest.blog/author/mehmet-ince/)

Master Ninja @ Prodaft / INVICTUS Europe.

## Post navigation

 [Unexpected Journey #7 â€“ GravCMS Unauthenticated Arbitrary YAML Write/Update leads to Code Execution (CVE-2021-21425)](https://pentest.blog/unexpected-journey-7-gravcms-unauthenticated-arbitrary-yaml-write-update-leads-to-code-execution/)[LiderAhenk 0day â€“ All your PARDUS Clients Belongs To Me (CVE-2021-3825)](https://pentest.blog/liderahenk-0day-all-your-pardus-clients-belongs-to-me/)

Search for:

### PRODAFT Cyber Intelligence and Cyber Security Services

[![](https://pentest.blog/wp-content/uploads/Mg6EYwIk_400x400.jpg)](https://www.invictuseurope.com/)

### Recent Posts

* [Advisory | NetModule Router Software Race Condition Leads to Remote Code Execution](https://pentest.blog/advisory-netmodule-router-software-race-condition-leads-to-remote-code-execution/)
* [Advisory | Roxy-WI Unauthenticated Remote Code Executions CVE-2022-31137](https://pentest.blog/advisory-roxy-wi-unauthenticated-remote-code-executions-cve-2022-31137/)
* [Advisory | GLPI Service Management Software Multiple Vulnerabilities and Remote Code Execution](https://pentest.blog/advisory-glpi-service-management-software-sql-injection-remote-code-execution-and-local-file-inclusion/)
* [LiderAhenk 0day â€“ All your PARDUS Clients Belongs To Me (CVE-2021-3825)](https://pentest.blog/liderahenk-0day-all-your-pardus-clients-belongs-to-me/)
* [Pardus 21 Linux Distro â€“ Remote Code Execution 0day 2021 CVE-2021-3806](https://pentest.blog/pardus-21-linux-distro-remote-code-execution-0day-2021/)
### Latest Comments

* [Ege Balci](https://github.com/EgeBalci) on [Art of Anti Detection 3 â€“ Shellcode Alchemy](https://pentest.blog/art-of-anti-detection-3-shellcode-alchemy/#comment-1244)
* Chase Run Taylor on [Art of Anti Detection 1 â€“ Introduction to AV & Detection Techniques](https://pentest.blog/art-of-anti-detection-1-introduction-to-av-detection-techniques/#comment-1243)
* [Mehmet Ä°nce](http://www.mehmetince.net/) on [Unexpected Journey #4 â€“ Escaping from Restricted Shell and Gaining Root Access to SolarWinds Log & Event Manager (SIEM) Product](https://pentest.blog/unexpected-journey-4-escaping-from-restricted-shell-and-gaining-root-access-to-solarwinds-log-event-manager-siem-product/#comment-1242)
* 0x00 on [Unexpected Journey #4 â€“ Escaping from Restricted Shell and Gaining Root Access to SolarWinds Log & Event Manager (SIEM) Product](https://pentest.blog/unexpected-journey-4-escaping-from-restricted-shell-and-gaining-root-access-to-solarwinds-log-event-manager-siem-product/#comment-1241)
* [Mehmet Ä°nce](http://www.mehmetince.net/) on [Unexpected Journey #4 â€“ Escaping from Restricted Shell and Gaining Root Access to SolarWinds Log & Event Manager (SIEM) Product](https://pentest.blog/unexpected-journey-4-escaping-from-restricted-shell-and-gaining-root-access-to-solarwinds-log-event-manager-siem-product/#comment-1240)
### Tags

[0day](https://pentest.blog/tag/0day/)
[1day](https://pentest.blog/tag/1day/)
[advisory](https://pentest.blog/tag/advisory/)
[alienvault](https://pentest.blog/tag/alienvault/)
[android](https://pentest.blog/tag/android/)
[application](https://pentest.blog/tag/application/)
[assembly](https://pentest.blog/tag/assembly/)
[bof](https://pentest.blog/tag/bof/)
[burp](https://pentest.blog/tag/burp/)
[bypass](https://pentest.blog/tag/bypass/)
[crypter](https://pentest.blog/tag/crypter/)
[decoder](https://pentest.blog/tag/decoder/)
[dns](https://pentest.blog/tag/dns/)
[EMET](https://pentest.blog/tag/emet/)
[encoder](https://pentest.blog/tag/encoder/)
[exploit](https://pentest.blog/tag/exploit/)
[hook](https://pentest.blog/tag/hook/)
[iat](https://pentest.blog/tag/iat/)
[icmp](https://pentest.blog/tag/icmp/)
[in-memory](https://pentest.blog/tag/in-memory/)
[IOT](https://pentest.blog/tag/iot/)
[linux](https://pentest.blog/tag/linux/)
[malware](https://pentest.blog/tag/malware/)
[metasploit](https://pentest.blog/tag/metasploit/)
[multi-stage](https://pentest.blog/tag/multi-stage/)
[nas](https://pentest.blog/tag/nas/)
[packer](https://pentest.blog/tag/packer/)
[php](https://pentest.blog/tag/php/)
[ransomware](https://pentest.blog/tag/ransomware/)
[rce](https://pentest.blog/tag/rce/)
[reflective](https://pentest.blog/tag/reflective/)
[research](https://pentest.blog/tag/research/)
[reverse](https://pentest.blog/tag/reverse/)
[reversing](https://pentest.blog/tag/reversing/)
[secure coding](https://pentest.blog/tag/secure-coding/)
[securityonion](https://pentest.blog/tag/securityonion/)
[self-defence](https://pentest.blog/tag/self-defence/)
[shellcode](https://pentest.blog/tag/shellcode/)
[siem](https://pentest.blog/tag/siem/)
[sql injection](https://pentest.blog/tag/sql-injection/)
[sqlmap](https://pentest.blog/tag/sqlmap/)
[stager](https://pentest.blog/tag/stager/)
[storage](https://pentest.blog/tag/storage/)
[tunneling](https://pentest.blog/tag/tunneling/)
[windows](https://pentest.blog/tag/windows/)
### Awarded Top 15 Pentest Blog

[![Pentest Blogs](/wp-content/uploads/pentest_1000px.png)](https://blog.feedspot.com/pentest_blogs/ "Pentest Blogs")

INVICTUS Cyber Security & Intelligence Services | Theme by [Colorlib](http://colorlib.com/) Powered by [WordPress](http://wordpress.org/)



=== Content from www.usom.gov.tr_aa96c38b_20250114_190147.html ===



