=== Content from www.openwall.com_7430ac33_20250114_210020.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2021/01/31/2) [[next>]](2) [[<thread-prev]](../../../2021/01/30/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20210201064344.GA21262@suse.de>
Date: Mon, 1 Feb 2021 07:43:44 +0100
From: Marcus Meissner <meissner@...e.de>
To: oss-security@...ts.openwall.com
Subject: Re: Re: Linux kernel: linux-block: nbd:
 use-after-free Read in nbd_queue_rq

Hi,

Mitre has assigned CVE-2021-3348 to this issue.

Ciao, Marcus
On Sat, Jan 30, 2021 at 04:46:30PM +0800, butt3rflyh4ck wrote:
> the patch for this issue in upstream:
>
> <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b98e762e3d71e893b221f871825dc64694cfb258>
>
> Regards,
>  butt3rflyh4ck.
>
>
> On Fri, Jan 29, 2021 at 2:10 AM butt3rflyh4ck <butterflyhuangxx@...il.com>
> wrote:
>
> > Hi, I reported a use-after-free Read bug in ndb_queue_rq() in
> > drivers/block/nbd.c and reproduced in linux-5.11.0-rc4+ too.
> >
> > Root Cause:
> >
> > There is a race condition in nbd ioctl.
> > NBD_SET_SIZE_BLOCKS ioctl will call nbd_size_set(), it will change the
> > block size.
> > NBD_SET_SOCK ioctl will call nbd_add_socket() and it will invoke
> > krealloc() to update a block, free and realloc a new one.
> > But nbd_queue_rq() is in runtime. and calls nbd_handle_cmd(), there
> > will use config->sock. there accesses to config->socks without any locking.
> >
> > Patch for this issue:
> >
> > [https://lore.kernel.org/linux-block/24dff677353e2e30a71d8b66c4dffdbdf77c4dbd.1611595239.git.josef@toxicpanda.com/](https://lore.kernel.org/linux-block/24dff677353e2e30a71d8b66c4dffdbdf77c4dbd.1611595239.git.josef%40toxicpanda.com/)
> >
> > CVE assigned:
> > not assigned.
> >
> > Timeline:
> > *2021/1/25  - Vulnerability reported to security@...nel.org.
> > *2020/1/26  - Vulnerability confirmed and patched.
> > *2020/1/28 - Vulnerability reported to linux-distros@...openwall.org.
> > *2021/1/29 - Opened on oss-security@...ts.openwall.com.
> >
> > Credit:
> > This issue was discovered by the ADLab of venustech.
> >
> >
> > Regards,
> >  butt3rflyh4ck.
> >

--
Marcus Meissner, Project Manager Security
SUSE Software Solutions Germany GmbH, Maxfeldstr. 5, 90409 Nuernberg, Germany,
GF: Felix Imendoerffer, HRB 36809, AG Nuernberg

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from lists.debian.org_2a8f1a28_20250114_210021.html ===


---

[[Date Prev](msg00034.html)][[Date Next](msg00036.html)]
[[Thread Prev](msg00034.html)][[Thread Next](msg00036.html)]
[[Date Index](maillist.html#00035)]
[[Thread Index](threads.html#00035)]

# [SECURITY] [DLA 2610-1] linux-4.19 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2610-1] linux-4.19 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Tue, 30 Mar 2021 23:45:31 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/YGOb%2B5OC6If3VHlQ%40decadent.org.uk)Â [YGOb+5OC6If3VHlQ@decadent.org.uk](msg00035.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2610-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
March 30, 2021                                <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-4.19
Version        : 4.19.181-1~deb9u1
CVE ID         : CVE-2020-27170 CVE-2020-27171 CVE-2021-3348 CVE-2021-3428
                 CVE-2021-26930 CVE-2021-26931 CVE-2021-26932 CVE-2021-27363
                 CVE-2021-27364 CVE-2021-27365 CVE-2021-28038 CVE-2021-28660
Debian Bug     : 983595

Several vulnerabilities have been discovered in the Linux kernel that
may lead to the execution of arbitrary code, privilege escalation,
denial of service, or information leaks.

CVE-2020-27170, CVE-2020-27171

    Piotr Krysiuk discovered flaws in the BPF subsystem's checks for
    information leaks through speculative execution.  A local user
    could use these to obtain sensitive information from kernel
    memory.

CVE-2021-3348

    ADlab of venustech discovered a race condition in the nbd block
    driver that can lead to a use-after-free.  A local user with
    access to an nbd block device could use this to cause a denial of
    service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2021-3428

    Wolfgang Frisch reported a potential integer overflow in the
    ext4 filesystem driver.  A user permitted to mount arbitrary
    filesystem images could use this to cause a denial of service
    (crash).

CVE-2021-26930 (XSA-365)

    Olivier Benjamin, Norbert Manthey, Martin Mazein, and Jan
    H. SchÃ¶nherr discovered that the Xen block backend driver
    (xen-blkback) did not handle grant mapping errors correctly.  A
    malicious guest could exploit this bug to cause a denial of
    service (crash), or possibly an information leak or privilege
    escalation, within the domain running the backend, which is
    typically dom0.

CVE-2021-26931 (XSA-362), CVE-2021-26932 (XSA-361), CVE-2021-28038 (XSA-367)

    Jan Beulich discovered that the Xen support code and various Xen
    backend drivers did not handle grant mapping errors correctly.  A
    malicious guest could exploit these bugs to cause a denial of
    service (crash) within the domain running the backend, which is
    typically dom0.

CVE-2021-27363

    Adam Nichols reported that the iSCSI initiator subsystem did not
    properly restrict access to transport handle attributes in sysfs.
    On a system acting as an iSCSI initiator, this is an information
    leak to local users and makes it easier to exploit CVE-2021-27364.

CVE-2021-27364

    Adam Nichols reported that the iSCSI initiator subsystem did not
    properly restrict access to its netlink management interface.  On
    a system acting as an iSCSI initiator, a local user could use
    these to cause a denial of service (disconnection of storage) or
    possibly for privilege escalation.

CVE-2021-27365

    Adam Nichols reported that the iSCSI initiator subsystem did not
    correctly limit the lengths of parameters or "passthrough PDUs"
    sent through its netlink management interface.  On a system acting
    as an iSCSI initiator, a local user could use these to leak the
    contents of kernel memory, to cause a denial of service (kernel
    memory corruption or crash), and probably for privilege
    escalation.

CVE-2021-28660

    It was discovered that the rtl8188eu WiFi driver did not correctly
    limit the length of SSIDs copied into scan results.  An attacker
    within WiFi range could use this to cause a denial of service
    (crash or memory corruption) or possibly to execute code on a
    vulnerable system.

For Debian 9 stretch, these problems have been fixed in version
4.19.181-1~deb9u1.  This update additionally fixes Debian bug
#983595, and includes many more bug fixes from stable updates
4.19.172-4.19.181 inclusive.

We recommend that you upgrade your linux-4.19 packages.

For the detailed security status of linux-4.19 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-4.19>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings
[W]e found...that it wasn't as easy to get programs right as we had
thought. I realized that a large part of my life from then on was going
to be spent in finding mistakes in my own programs.
                                                 - Maurice Wilkes, 1949

```

**Attachment:
[signature.asc](pgpJGlB5Bnen1.pgp)**

*Description:* PGP signature

---



=== Content from www.openwall.com_d0f272e0_20250114_210021.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](../../../2021/01/29/1) [[thread-next>]](../../../2021/01/30/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAFcO6XMDdVx8uoM8-dJf=AP5t+Tva-J2sOE+gV4F11dvU99yrg@mail.gmail.com>
Date: Fri, 29 Jan 2021 02:10:20 +0800
From: butt3rflyh4ck <butterflyhuangxx@...il.com>
To: oss-security@...ts.openwall.com
Subject: Linux kernel: linux-block: nbd: use-after-free Read in nbd_queue_rq

Hi, I reported a use-after-free Read bug in ndb_queue_rq() in
drivers/block/nbd.c and reproduced in linux-5.11.0-rc4+ too.

Root Cause:

There is a race condition in nbd ioctl.
NBD_SET_SIZE_BLOCKS ioctl will call nbd_size_set(), it will change the
block size.
NBD_SET_SOCK ioctl will call nbd_add_socket() and it will invoke
krealloc() to update a block, free and realloc a new one.
But nbd_queue_rq() is in runtime. and calls nbd_handle_cmd(), there
will use config->sock. there accesses to config->socks without any locking.

Patch for this issue:
[https://lore.kernel.org/linux-block/24dff677353e2e30a71d8b66c4dffdbdf77c4dbd.1611595239.git.josef@toxicpanda.com/](https://lore.kernel.org/linux-block/24dff677353e2e30a71d8b66c4dffdbdf77c4dbd.1611595239.git.josef%40toxicpanda.com/)

CVE assigned:
not assigned.

Timeline:
*2021/1/25  - Vulnerability reported to security@...nel.org.
*2020/1/26  - Vulnerability confirmed and patched.
*2020/1/28 - Vulnerability reported to linux-distros@...openwall.org.
*2021/1/29 - Opened on oss-security@...ts.openwall.com.

Credit:
This issue was discovered by the ADLab of venustech.

Regards,
 butt3rflyh4ck.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from git.kernel.org_7ef0a7aa_20250114_210021.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=b98e762e3d71e893b221f871825dc64694cfb258)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=b98e762e3d71e893b221f871825dc64694cfb258)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b98e762e3d71e893b221f871825dc64694cfb258)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b98e762e3d71e893b221f871825dc64694cfb258)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Josef Bacik <josef@toxicpanda.com> | 2021-01-25 12:21:02 -0500 |
| --- | --- | --- |
| committer | Jens Axboe <axboe@kernel.dk> | 2021-01-25 11:04:50 -0700 |
| commit | [b98e762e3d71e893b221f871825dc64694cfb258](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b98e762e3d71e893b221f871825dc64694cfb258) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=b98e762e3d71e893b221f871825dc64694cfb258)) | |
| tree | [e93fee7dd3d2fe7f6af89de22cc35061bede0dc4](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=b98e762e3d71e893b221f871825dc64694cfb258) | |
| parent | [ac55ad2b5fadb6af8826963d7d3331c9950a2608](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ac55ad2b5fadb6af8826963d7d3331c9950a2608) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b98e762e3d71e893b221f871825dc64694cfb258&id2=ac55ad2b5fadb6af8826963d7d3331c9950a2608)) | |
| download | [linux-b98e762e3d71e893b221f871825dc64694cfb258.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-b98e762e3d71e893b221f871825dc64694cfb258.tar.gz) | |

nbd: freeze the queue while we're adding connectionsWhen setting up a device, we can krealloc the config->socks array to add
new sockets to the configuration. However if we happen to get a IO
request in at this point even though we aren't setup we could hit a UAF,
as we deref config->socks without any locking, assuming that the
configuration was setup already and that ->socks is safe to access it as
we have a reference on the configuration.
But there's nothing really preventing IO from occurring at this point of
the device setup, we don't want to incur the overhead of a lock to
access ->socks when it will never change while the device is running.
To fix this UAF scenario simply freeze the queue if we are adding
sockets. This will protect us from this particular case without adding
any additional overhead for the normal running case.
Cc: stable@vger.kernel.org
Signed-off-by: Josef Bacik <josef@toxicpanda.com>
Signed-off-by: Jens Axboe <axboe@kernel.dk>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b98e762e3d71e893b221f871825dc64694cfb258)

| -rw-r--r-- | [drivers/block/nbd.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/block/nbd.c?id=b98e762e3d71e893b221f871825dc64694cfb258) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/block/nbd.c b/drivers/block/nbd.cindex 6727358e147dd8..e6ea5d344f87b6 100644--- a/[drivers/block/nbd.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/nbd.c?id=ac55ad2b5fadb6af8826963d7d3331c9950a2608)+++ b/[drivers/block/nbd.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/block/nbd.c?id=b98e762e3d71e893b221f871825dc64694cfb258)@@ -1022,6 +1022,12 @@ static int nbd\_add\_socket(struct nbd\_device \*nbd, unsigned long arg, if (!sock) return err; + /\*+ \* We need to make sure we don't get any errant requests while we're+ \* reallocating the ->socks array.+ \*/+ blk\_mq\_freeze\_queue(nbd->disk->queue);+ if (!netlink && !nbd->task\_setup && !test\_bit(NBD\_RT\_BOUND, &config->runtime\_flags)) nbd->task\_setup = current;@@ -1060,10 +1066,12 @@ static int nbd\_add\_socket(struct nbd\_device \*nbd, unsigned long arg, nsock->cookie = 0; socks[config->num\_connections++] = nsock; atomic\_inc(&config->live\_connections);+ blk\_mq\_unfreeze\_queue(nbd->disk->queue);  return 0;  put\_socket:+ blk\_mq\_unfreeze\_queue(nbd->disk->queue); sockfd\_put(sock); return err; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:58:58 +0000


