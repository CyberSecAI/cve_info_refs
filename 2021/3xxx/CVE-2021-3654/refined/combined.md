=== Content from opendev.org_6f49f1d8_20250115_123916.html ===

This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

[openstack](/openstack)/[nova](/openstack/nova)

[Code](/openstack/nova/src/branch/master)
[Issues](https://bugs.launchpad.net/nova)
[Proposed changes](https://review.opendev.org/#/q/status:open+project:openstack/nova)

### address open redirect with 3 forward slashes

[Browse Source](/openstack/nova/src/commit/8906552cfc2525a44251d4cf313ece61e57251eb)

```
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.

Conflicts:
  nova/console/websocketproxy.py
  nova/tests/unit/console/test_websocketproxy.py

NOTE(melwitt): The conflict and difference in websocketproxy.py from
the cherry picked change: HTTPStatus.BAD_REQUEST => 400 is due to the
fact that HTTPStatus does not exist in Python 2.7. The conflict in
test_websocketproxy.py is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train. The difference
in test_websocketproxy.py from the cherry picked change is due to a
difference in internal implementation [1] in Python < 3.6. See change
I546d376869a992601b443fb95acf1034da2a8f36 for reference.

[1] [34eeed4290](https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286)

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: [#1927677](https://bugs.launchpad.net/nova/%2Bbug/1927677)
(cherry picked from commit [6fbd0b758d](/openstack/nova/commit/6fbd0b758dcac71323f3be179b1a9d1c17a4acc5))
(cherry picked from commit [47dad4836a](/openstack/nova/commit/47dad4836a26292e9d34e516e1525ecf00be127c))
(cherry picked from commit [9588cdbfd4](/openstack/nova/commit/9588cdbfd4649ea53d60303f2d10c5d62a070a07))
(cherry picked from commit [0997043f45](/openstack/nova/commit/0997043f459ac616b594363b5b253bd0ae6ed9eb))
```
...

This commit is contained in:

![](/assets/img/avatar_default.png "work@seanmooney.info")
parent
[04d48527b6](/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66)

commit
8906552cfc

 **2 changed files** with **33 additions** and **6 deletions**

[Show all changes](?style=unified&whitespace=show-all&show-outdated=)
[Ignore whitespace when comparing lines](?style=unified&whitespace=ignore-all&show-outdated=)
[Ignore changes in amount of whitespace](?style=unified&whitespace=ignore-change&show-outdated=)
[Ignore changes in whitespace at EOL](?style=unified&whitespace=ignore-eol&show-outdated=)

Show Stats
[Download Patch File](/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb.patch)
[Download Diff File](/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb.diff)
Expand all files
Collapse all files

#### 7 [nova/console/websocketproxy.py](#diff-b9d2ad00e05a6d9d14cdb8059d611043b602b37d "nova/console/websocketproxy.py") Unescape Escape [View File](/openstack/nova/src/commit/8906552cfc2525a44251d4cf313ece61e57251eb/nova/console/websocketproxy.py)

|  | |  |  | `@ -313,14 +313,9 @@ class NovaProxyRequestHandler(NovaProxyRequestHandlerBase,` |
|  |  |  |  | `if os.path.isdir(path):` |
|  |  |  |  | `parts = urlparse.urlsplit(self.path)` |
|  |  |  |  | `if not parts.path.endswith('/'):` |
|  |  |  |  | `# redirect browser - doing basically what apache does` |
|  |  |  |  | `new_parts = (parts[0], parts[1], parts[2] + '/',` |
|  |  |  |  | `parts[3], parts[4])` |
|  |  |  |  | `new_url = urlparse.urlunsplit(new_parts)` |
|  |  |  |  |  |
|  |  |  |  | `# Browsers interpret "Location: //uri" as an absolute URI` |
|  |  |  |  | `# like "http://URI"` |
|  |  |  |  | `if new_url.startswith('//'):` |
|  |  |  |  | `if self.path.startswith('//'):` |
|  |  |  |  | `self.send_error(400,` |
|  |  |  |  | `"URI must not start with //")` |
|  |  |  |  | `return None` |
|  | |  |  |  |

#### 32 [nova/tests/unit/console/test\_websocketproxy.py](#diff-f629feecbacc0045cac65cca99e64f6dfdbe5e76 "nova/tests/unit/console/test_websocketproxy.py") Unescape Escape [View File](/openstack/nova/src/commit/8906552cfc2525a44251d4cf313ece61e57251eb/nova/tests/unit/console/test_websocketproxy.py)

|  | |  |  | `@ -659,6 +659,38 @@ class NovaProxyRequestHandlerBaseTestCase(test.NoDBTestCase):` |
|  |  |  |  | `# Verify no redirect happens and instead a 400 Bad Request is returned.` |
|  |  |  |  | `self.assertIn('400 URI must not start with //', result[0].decode())` |
|  |  |  |  |  |
|  |  |  |  | `def test_reject_open_redirect_3_slashes(self):` |
|  |  |  |  | `# This will test the behavior when an attempt is made to cause an open` |
|  |  |  |  | `# redirect. It should be rejected.` |
|  |  |  |  | `mock_req = mock.MagicMock()` |
|  |  |  |  | `mock_req.makefile().readline.side_effect = [` |
|  |  |  |  | `b'GET ///example.com/%2F.. HTTP/1.1\r\n',` |
|  |  |  |  | `b''` |
|  |  |  |  | `]` |
|  |  |  |  |  |
|  |  |  |  | `client_addr = ('8.8.8.8', 54321)` |
|  |  |  |  | `mock_server = mock.MagicMock()` |
|  |  |  |  | `# This specifies that the server will be able to handle requests other` |
|  |  |  |  | `# than only websockets.` |
|  |  |  |  | `mock_server.only_upgrade = False` |
|  |  |  |  |  |
|  |  |  |  | `# Constructing a handler will process the mock_req request passed in.` |
|  |  |  |  | `handler = websocketproxy.NovaProxyRequestHandler(` |
|  |  |  |  | `mock_req, client_addr, mock_server)` |
|  |  |  |  |  |
|  |  |  |  | `# Collect the response data to verify at the end. The` |
|  |  |  |  | `# SimpleHTTPRequestHandler writes the response data to a 'wfile'` |
|  |  |  |  | `# attribute.` |
|  |  |  |  | `output = io.BytesIO()` |
|  |  |  |  | `handler.wfile = output` |
|  |  |  |  | `# Process the mock_req again to do the capture.` |
|  |  |  |  | `handler.do_GET()` |
|  |  |  |  | `output.seek(0)` |
|  |  |  |  | `result = output.readlines()` |
|  |  |  |  |  |
|  |  |  |  | `# Verify no redirect happens and instead a 400 Bad Request is returned.` |
|  |  |  |  | `self.assertIn('400 URI must not start with //', result[0].decode())` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `class NovaWebsocketSecurityProxyTestCase(test.NoDBTestCase):` |
|  |  |  |  |  |
|  | |  |  |  |

Write
Preview

Loading…

Cancel
Save

Reference in New Issue

**Repository**
openstack/nova

**Title**

**Body**

Create Issue

Block a user
Blocking a user prevents them from interacting with repositories, such as opening or commenting on pull requests or issues. Learn more about blocking a user.

User to block:

Optional note:

The note is not visible to the blocked user.

Cancel
Block

[Powered by Gitea](https://about.gitea.com)
Version:
v1.22.6
Page: **4165ms**
Template: **65ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)



=== Content from review.opendev.org_b87cbd4a_20250115_194623.html ===




=== Content from bugs.launchpad.net_66e278a0_20250115_123927.html ===

[Log in / Register](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* [Translations](https://translations.launchpad.net/nova)
* [Answers](https://answers.launchpad.net/nova)

# [OSSA-2021-002] Open Redirect in noVNC proxy (CVE-2021-3654)

Bug #1927677 reported by
[Swe W Aung](https://launchpad.net/~sirswa)
on 2021-05-07

[280](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Compute (nova)](https://bugs.launchpad.net/nova) | Fix Released | Undecided | Unassigned |  |
|  | [Stein](https://bugs.launchpad.net/nova/stein) | In Progress | Undecided | Unassigned |  |
|  | [Train](https://bugs.launchpad.net/nova/train) | Fix Released | Undecided | Unassigned |  |
|  | [Ussuri](https://bugs.launchpad.net/nova/ussuri) | Fix Released | Undecided | Unassigned |  |
|  | [Victoria](https://bugs.launchpad.net/nova/victoria) | Fix Released | Undecided | Unassigned |  |
|  | [Wallaby](https://bugs.launchpad.net/nova/wallaby) | Fix Released | Undecided | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |

### Bug Description

This bug report is related to Security.

Currently novnc is allowing open direction, which could potentially be used for phishing attempts

To test.

https://<sites' vnc domain>//example.com/%2F..

include .. at the end

For example:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

It will redirect to example.com. You can replace example.com with some legitimate domain or spoofed domain.

The description of the risk is

By modifying untrusted URL input to a malicious site, an attacker may successfully launch a phishing scam and steal user credentials.

Because the server name in the modified link is identical to the original site, phishing attempts may have a more trustworthy appearance.

See [original description](comments/0)

Tags:

[console](/nova/%2Bbugs?field.tag=console)
[in-stable-train](/nova/%2Bbugs?field.tag=in-stable-train)
[in-stable-ussuri](/nova/%2Bbugs?field.tag=in-stable-ussuri)
[in-stable-victoria](/nova/%2Bbugs?field.tag=in-stable-victoria)
[in-stable-wallaby](/nova/%2Bbugs?field.tag=in-stable-wallaby)
[in-stable-xena](/nova/%2Bbugs?field.tag=in-stable-xena)
[in-stable-yoga](/nova/%2Bbugs?field.tag=in-stable-yoga)
[novnc](/nova/%2Bbugs?field.tag=novnc)

## CVE References

* [2021-28861](/bugs/cve/2021-28861 "** DISPUTED ** Python 3.x through 3.1...")
* [2021-3654](/bugs/cve/2021-3654 "A vulnerability was found in openstac...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-07: |  |  | [#1](/nova/%2Bbug/1927677/comments/1) |
| --- | --- | --- | --- |

You can also test from the host that running novnc service,

nova:~# curl -v '[http://127.0.0.1:6080//google.com/%2F..'](http://127.0.0.1:6080//google.com//..%27)

\* Trying 127.0.0.1...

\* TCP\_NODELAY set

\* Connected to 127.0.0.1 (127.0.0.1) port 6080 (#0)

> GET //google.com/%2F.. HTTP/1.1

> Host: 127.0.0.1:6080

> User-Agent: curl/7.58.0

> Accept: \*/\*

>

< HTTP/1.1 301 Moved Permanently

< Server: WebSockify Python/3.6.9

< Date: Fri, 07 May 2021 04:49:39 GMT

< Location: //google.com/%2F../

\* no chunk, no close, no size. Assume close to signal end

<

You can also test from the host that running novnc service,
nova:~# curl -v 'http://127.0.0.1:6080//google.com/%2F..'
\* Trying 127.0.0.1...
\* TCP\_NODELAY set
\* Connected to 127.0.0.1 (127.0.0.1) port 6080 (#0)
> GET //google.com/%2F.. HTTP/1.1
> Host: 127.0.0.1:6080
> User-Agent: curl/7.58.0
> Accept: \*/\*
>
< HTTP/1.1 301 Moved Permanently
< Server: WebSockify Python/3.6.9
< Date: Fri, 07 May 2021 04:49:39 GMT
< Location: //google.com/%2F../
\* no chunk, no close, no size. Assume close to signal end
<

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-05-07: |  |  | [#2](/nova/%2Bbug/1927677/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete

security advisory task has been added while the core security

reviewers for the affected project or projects confirm the bug and

discuss the scope of any vulnerability along with potential

solutions.

Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.

| **description**: | updated |
| --- | --- |
| Changed in ossa: | |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-11: |  |  | [#3](/nova/%2Bbug/1927677/comments/3) |
| --- | --- | --- | --- |

This bug report reminds me of an old bug [1] we dealt with in the past where the canned vnc\_auto.html and vnc.html pages allowed injection of arbitrary HTML into them (fixed in noVNC 0.6.2) [2].

vnc\_auto.html (vnc\_lite.html as of v1.0.0) and vnc.html have a feature where a host and port can be specified as query parameters in the URL, example [3]:

<http://1.2.3.4:6080/vnc_auto.html?host=6.7.8.9&port=6080>

and it will connect to a noVNC server running on that host:port as the source of data provided to vnc\_auto.html. The bug [2] meant that if a user specified host:port in the URL query parameters, a potentially malicious noVNC server running on that host:port could inject arbitrary HTML into the vnc\_auto.html being served on the user's machine.

I mention that because it seems like the host:port functionality could be similarly used to phish. I'm thinking if someone ran their own noVNC server at host:port and got a user to click on a link with ?host&port in it, they could steal credentials if the user didn't notice what machine they're connecting to.

If that's the case, I'm not sure this redirect behavior is much different than what is already built-in to the vnc\_lite.html and vnc.html pages that come with noVNC.

Aside from that, it's not clear to me whether this redirect behavior is something we (nova) control or if it's being done by noVNC itself. If it's the latter, I'm not sure whether we could do anything to intercept it or if it's something that would have to be changed in noVNC.

I'm going to add noVNC to this bug to get their input about the redirect behavior.

[1] [https://bugs.launchpad.net/horizon/+bug/1656435](https://bugs.launchpad.net/horizon/%2Bbug/1656435)

[2] <https://github.com/novnc/noVNC/issues/748>

[3] <https://github.com/novnc/noVNC/blob/v1.1.0/vnc_lite.html#L14-L15>

This bug report reminds me of an old bug [1] we dealt with in the past where the canned vnc\_auto.html and vnc.html pages allowed injection of arbitrary HTML into them (fixed in noVNC 0.6.2) [2].
vnc\_auto.html (vnc\_lite.html as of v1.0.0) and vnc.html have a feature where a host and port can be specified as query parameters in the URL, example [3]:
http://1.2.3.4:6080/vnc\_auto.html?host=6.7.8.9&port=6080
and it will connect to a noVNC server running on that host:port as the source of data provided to vnc\_auto.html. The bug [2] meant that if a user specified host:port in the URL query parameters, a potentially malicious noVNC server running on that host:port could inject arbitrary HTML into the vnc\_auto.html being served on the user's machine.
I mention that because it seems like the host:port functionality could be similarly used to phish. I'm thinking if someone ran their own noVNC server at host:port and got a user to click on a link with ?host&port in it, they could steal credentials if the user didn't notice what machine they're connecting to.
If that's the case, I'm not sure this redirect behavior is much different than what is already built-in to the vnc\_lite.html and vnc.html pages that come with noVNC.
Aside from that, it's not clear to me whether this redirect behavior is something we (nova) control or if it's being done by noVNC itself. If it's the latter, I'm not sure whether we could do anything to intercept it or if it's something that would have to be changed in noVNC.
I'm going to add noVNC to this bug to get their input about the redirect behavior.
[1] https://bugs.launchpad.net/horizon/+bug/1656435
[2] https://github.com/novnc/noVNC/issues/748
[3] https://github.com/novnc/noVNC/blob/v1.1.0/vnc\_lite.html#L14-L15

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-11: |  |  | [#4](/nova/%2Bbug/1927677/comments/4) |
| --- | --- | --- | --- |

> I'm going to add noVNC to this bug to get their input about the redirect behavior.

Looks like I can't do that because noVNC and websockify use github issues and those can't be private security. But if it is indeed an issue in noVNC or websockify, then it is probably OK to go ahead and report it publicly in those projects.

I'm going to do some local testing to determine whether this redirect is something we could intercept and handle or if it happens before we (websockify plugin) are called. If it doesn't appear we can intercept it, we can switch this to public and I can report an issue for noVNC or websockify on github.

> I'm going to add noVNC to this bug to get their input about the redirect behavior.
Looks like I can't do that because noVNC and websockify use github issues and those can't be private security. But if it is indeed an issue in noVNC or websockify, then it is probably OK to go ahead and report it publicly in those projects.
I'm going to do some local testing to determine whether this redirect is something we could intercept and handle or if it happens before we (websockify plugin) are called. If it doesn't appear we can intercept it, we can switch this to public and I can report an issue for noVNC or websockify on github.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#5](/nova/%2Bbug/1927677/comments/5) |
| --- | --- | --- | --- |

* [lp1927677.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5496768/%2Bfiles/lp1927677.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5496768)
  (1.6 KiB,
  text/plain)

OK, I really went down the rabbit hole with this one.

The tl;dr is that this is a known issue in the python standard library [1], in the http.server.SimpleHTTPRequestHandler, which WebSockifyRequestHandler derives from and which we ultimately derive from with our NovaProxyRequestHandler.

I found that we \_can\_ intercept this in our code and prevent an open redirect. It could be considered hacky, but I'm attaching a patch that prevents the redirect. It is code copied from a comment on the python issue [2].

The concern about the sample code in the issue is that such code might reject legitimate requests in certain cases. I don't believe we have such a concern with the nova console proxy.

Let me know what you think.

[1] <https://bugs.python.org/issue32084>

[2] <https://bugs.python.org/issue32084#msg306545>

OK, I really went down the rabbit hole with this one.
The tl;dr is that this is a known issue in the python standard library [1], in the http.server.SimpleHTTPRequestHandler, which WebSockifyRequestHandler derives from and which we ultimately derive from with our NovaProxyRequestHandler.
I found that we \_can\_ intercept this in our code and prevent an open redirect. It could be considered hacky, but I'm attaching a patch that prevents the redirect. It is code copied from a comment on the python issue [2].
The concern about the sample code in the issue is that such code might reject legitimate requests in certain cases. I don't believe we have such a concern with the nova console proxy.
Let me know what you think.
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#6](/nova/%2Bbug/1927677/comments/6) |
| --- | --- | --- | --- |

Also, I'm thinking we could make this bug public considering the root cause of the behavior is a public issue in the python standard http.server.SimpleHTTPRequestHandler.

Also, I'm thinking we could make this bug public considering the root cause of the behavior is a public issue in the python standard http.server.SimpleHTTPRequestHandler.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#7](/nova/%2Bbug/1927677/comments/7) |
| --- | --- | --- | --- |

Also, I have tested the patch in comment 5 in devstack and verified it works to return a 400 Bad Request if "//" are included in the URL to redirect, provided that the browser has not previously cached a past redirect.

I used the following URL to test: [http://127.0.0.1:6080//google.com/%2F](http://127.0.0.1:6080//google.com//)..

Also, I have tested the patch in comment 5 in devstack and verified it works to return a 400 Bad Request if "//" are included in the URL to redirect, provided that the browser has not previously cached a past redirect.
I used the following URL to test: http://127.0.0.1:6080//google.com/%2F..

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-05-13

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public |
| **information type**: | Public → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-05-13: |  |  | [#8](/nova/%2Bbug/1927677/comments/8) |
| --- | --- | --- | --- |

Thanks for digging into this, Melanie! I've ended the embargo and switched to Public Security given the relatively low risk this represents and its relationship with known issues in WebSockify/stdlib.

If the patch is sufficient and gets backported to stable branches, we could issue an advisory (class A in our report taxonomy). We could also consider it a workaround for a bug in a dependency (class C2), but that gets into determining whether the vulnerability is in the dependency or merely in the way we're using it. I'll leave the security advisory task incomplete for the time being, and we'll see how the fix progresses in review.

Thanks for digging into this, Melanie! I've ended the embargo and switched to Public Security given the relatively low risk this represents and its relationship with known issues in WebSockify/stdlib.
If the patch is sufficient and gets backported to stable branches, we could issue an advisory (class A in our report taxonomy). We could also consider it a workaround for a bug in a dependency (class C2), but that gets into determining whether the vulnerability is in the dependency or merely in the way we're using it. I'll leave the security advisory task incomplete for the time being, and we'll see how the fix progresses in review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-13:  [**Fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/9) |  |  | [#9](/nova/%2Bbug/1927677/comments/9) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/791297](https://review.opendev.org/c/openstack/nova/%2B/791297)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/791297

| Changed in nova: | |
| --- | --- |
| **status**: | New → In Progress |

[melanie witt (melwitt)](https://launchpad.net/~melwitt)
on 2021-05-13

| **tags**: | added: console |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-14:  [**Re: [Bug 1927677] Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/10) |  |  | [#10](/nova/%2Bbug/1927677/comments/10) |
| --- | --- | --- | --- |

Hi Melanie

The is for the investigation and your effort. Really appreciate that.

Regards

sw3

On Sat, 15 May 2021 at 1:06 am, melanie witt <email address hidden>

wrote:

> \*\* Also affects: nova/train

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/ussuri

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/wallaby

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/victoria

> Importance: Undecided

> Status: New

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/1927677>

>

> Title:

> novnc allowing open direction which could potentially be used for

> phishing

>

> Status in OpenStack Compute (nova):

> In Progress

> Status in OpenStack Compute (nova) train series:

> New

> Status in OpenStack Compute (nova) ussuri series:

> New

> Status in OpenStack Compute (nova) victoria series:

> New

> Status in OpenStack Compute (nova) wallaby series:

> New

> Status in OpenStack Security Advisory:

> Incomplete

>

> Bug description:

> This bug report is related to Security.

>

> Currently novnc is allowing open direction, which could potentially be

> used for phishing attempts

>

> To test.

> https://<sites' vnc domain>//example.com/%2F..

> include .. at the end

>

> For example:

> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>

> It will redirect to example.com. You can replace example.com with some

> legitimate domain or spoofed domain.

>

> The description of the risk is

> By modifying untrusted URL input to a malicious site, an attacker may

> successfully launch a phishing scam and steal user credentials.

> Because the server name in the modified link is identical to the

> original site, phishing attempts may have a more trustworthy appearance.

>

> To manage notifications about this bug go to:

> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>

--

Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Hi Melanie
The is for the investigation and your effort. Really appreciate that.
Regards
sw3
On Sat, 15 May 2021 at 1:06 am, melanie witt <1927677@bugs.launchpad.net>
wrote:
> \*\* Also affects: nova/train
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/ussuri
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/wallaby
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/victoria
> Importance: Undecided
> Status: New
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/1927677
>
> Title:
> novnc allowing open direction which could potentially be used for
> phishing
>
> Status in OpenStack Compute (nova):
> In Progress
> Status in OpenStack Compute (nova) train series:
> New
> Status in OpenStack Compute (nova) ussuri series:
> New
> Status in OpenStack Compute (nova) victoria series:
> New
> Status in OpenStack Compute (nova) wallaby series:
> New
> Status in OpenStack Security Advisory:
> Incomplete
>
> Bug description:
> This bug report is related to Security.
>
> Currently novnc is allowing open direction, which could potentially be
> used for phishing attempts
>
> To test.
> https://<sites' vnc domain>//example.com/%2F..
> include .. at the end
>
> For example:
> http://vncproxy.my.domain.com//example.com/%2F..
>
> It will redirect to example.com. You can replace example.com with some
> legitimate domain or spoofed domain.
>
> The description of the risk is
> By modifying untrusted URL input to a malicious site, an attacker may
> successfully launch a phishing scam and steal user credentials.
> Because the server name in the modified link is identical to the
> original site, phishing attempts may have a more trustworthy appearance.
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>
--
Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-14: |  |  | [#11](/nova/%2Bbug/1927677/comments/11) |
| --- | --- | --- | --- |

Hi Melanie

Thanks for the investigation and the effort. Really appreciate that.

Regards

sw3

On Sat, 15 May 2021 at 7:10 am, Swe Win Aung <email address hidden> wrote:

> Hi Melanie

>

> The is for the investigation and your effort. Really appreciate that.

>

> Regards

> sw3

>

> On Sat, 15 May 2021 at 1:06 am, melanie witt <email address hidden>

> wrote:

>

>> \*\* Also affects: nova/train

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/ussuri

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/wallaby

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/victoria

>> Importance: Undecided

>> Status: New

>>

>> --

>> You received this bug notification because you are subscribed to the bug

>> report.

>> <https://bugs.launchpad.net/bugs/1927677>

>>

>> Title:

>> novnc allowing open direction which could potentially be used for

>> phishing

>>

>> Status in OpenStack Compute (nova):

>> In Progress

>> Status in OpenStack Compute (nova) train series:

>> New

>> Status in OpenStack Compute (nova) ussuri series:

>> New

>> Status in OpenStack Compute (nova) victoria series:

>> New

>> Status in OpenStack Compute (nova) wallaby series:

>> New

>> Status in OpenStack Security Advisory:

>> Incomplete

>>

>> Bug description:

>> This bug report is related to Security.

>>

>> Currently novnc is allowing open direction, which could potentially be

>> used for phishing attempts

>>

>> To test.

>> https://<sites' vnc domain>//example.com/%2F..

>> include .. at the end

>>

>> For example:

>> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>>

>> It will redirect to example.com. You can replace example.com with some

>> legitimate domain or spoofed domain.

>>

>> The description of the risk is

>> By modifying untrusted URL input to a malicious site, an attacker may

>> successfully launch a phishing scam and steal user credentials.

>> Because the server name in the modified link is identical to the

>> original site, phishing attempts may have a more trustworthy appearance.

>>

>> To manage notifications about this bug go to:

>> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>>

> --

> Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

>

--

Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Hi Melanie
Thanks for the investigation and the effort. Really appreciate that.
Regards
sw3
On Sat, 15 May 2021 at 7:10 am, Swe Win Aung <sirswa@gmail.com> wrote:
> Hi Melanie
>
> The is for the investigation and your effort. Really appreciate that.
>
> Regards
> sw3
>
> On Sat, 15 May 2021 at 1:06 am, melanie witt <1927677@bugs.launchpad.net>
> wrote:
>
>> \*\* Also affects: nova/train
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/ussuri
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/wallaby
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/victoria
>> Importance: Undecided
>> Status: New
>>
>> --
>> You received this bug notification because you are subscribed to the bug
>> report.
>> https://bugs.launchpad.net/bugs/1927677
>>
>> Title:
>> novnc allowing open direction which could potentially be used for
>> phishing
>>
>> Status in OpenStack Compute (nova):
>> In Progress
>> Status in OpenStack Compute (nova) train series:
>> New
>> Status in OpenStack Compute (nova) ussuri series:
>> New
>> Status in OpenStack Compute (nova) victoria series:
>> New
>> Status in OpenStack Compute (nova) wallaby series:
>> New
>> Status in OpenStack Security Advisory:
>> Incomplete
>>
>> Bug description:
>> This bug report is related to Security.
>>
>> Currently novnc is allowing open direction, which could potentially be
>> used for phishing attempts
>>
>> To test.
>> https://<sites' vnc domain>//example.com/%2F..
>> include .. at the end
>>
>> For example:
>> http://vncproxy.my.domain.com//example.com/%2F..
>>
>> It will redirect to example.com. You can replace example.com with some
>> legitimate domain or spoofed domain.
>>
>> The description of the risk is
>> By modifying untrusted URL input to a malicious site, an attacker may
>> successfully launch a phishing scam and steal user credentials.
>> Because the server name in the modified link is identical to the
>> original site, phishing attempts may have a more trustworthy appearance.
>>
>> To manage notifications about this bug go to:
>> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>>
> --
> Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"
>
--
Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-15:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/12) |  |  | [#12](/nova/%2Bbug/1927677/comments/12) |
| --- | --- | --- | --- |

Hi sw3,

Thanks for reporting the issue!

Hi sw3,
Thanks for reporting the issue!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-15:  [**Fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/13) |  |  | [#13](/nova/%2Bbug/1927677/comments/13) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791297](https://review.opendev.org/c/openstack/nova/%2B/791297)

Committed: <https://opendev.org/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e>

Submitter: "Zuul (22348)"

Branch: master

commit 781612b33282ed298f742c85dab58a075c8b793e

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

Reviewed: https://review.opendev.org/c/openstack/nova/+/791297
Committed: https://opendev.org/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e
Submitter: "Zuul (22348)"
Branch: master
commit 781612b33282ed298f742c85dab58a075c8b793e
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-15:  [**Fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/14) |  |  | [#14](/nova/%2Bbug/1927677/comments/14) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/791577](https://review.opendev.org/c/openstack/nova/%2B/791577)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/791577

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/15) |  |  | [#15](/nova/%2Bbug/1927677/comments/15) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/791805](https://review.opendev.org/c/openstack/nova/%2B/791805)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/791805

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/16) |  |  | [#16](/nova/%2Bbug/1927677/comments/16) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/791806](https://review.opendev.org/c/openstack/nova/%2B/791806)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/791806

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/17) |  |  | [#17](/nova/%2Bbug/1927677/comments/17) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/791807](https://review.opendev.org/c/openstack/nova/%2B/791807)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/791807

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-19:  [**Fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/18) |  |  | [#18](/nova/%2Bbug/1927677/comments/18) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791577](https://review.opendev.org/c/openstack/nova/%2B/791577)

Committed: <https://opendev.org/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 470925614223c8dd9b1233f54f5a96c02b2d4f70

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791577
Committed: https://opendev.org/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 470925614223c8dd9b1233f54f5a96c02b2d4f70
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-09:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/19) |  |  | [#19](/nova/%2Bbug/1927677/comments/19) |
| --- | --- | --- | --- |

Since we have fixes for this merged to all maintained stable branches (and them some), we need to decide whether we're issuing a security advisory about this or merely treating it as hardening. Does anyone have an opinion?

Since we have fixes for this merged to all maintained stable branches (and them some), we need to decide whether we're issuing a security advisory about this or merely treating it as hardening. Does anyone have an opinion?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-09: |  |  | [#20](/nova/%2Bbug/1927677/comments/20) |
| --- | --- | --- | --- |

The fix backports have been proposed but are not yet merged on stable/victoria, stable/ussuri, and stable/train.

This issue is considered to be of "moderate" severity and is a result of a publicly reported behavior in the python standard library [1] and the http.server documentation has a warning on it that states, "Warning http.server is not recommended for production. It only implements basic security checks." [2].

Our dependency however, the websockify server [3], is based upon http.server and AFAIK websockify isn't characterized as only for dev or non-production use.

There is currently a pull request proposed to fix [1] and it is currently under review [4].

Based on this, I tend to think to treat it as hardening, but of course I defer to the expert opinion of the VMT.

[1] <https://bugs.python.org/issue43223>

[2] <https://docs.python.org/3/library/http.server.html>

[3] <https://github.com/novnc/websockify>

[4] <https://github.com/python/cpython/pull/24848>

The fix backports have been proposed but are not yet merged on stable/victoria, stable/ussuri, and stable/train.
This issue is considered to be of "moderate" severity and is a result of a publicly reported behavior in the python standard library [1] and the http.server documentation has a warning on it that states, "Warning http.server is not recommended for production. It only implements basic security checks." [2].
Our dependency however, the websockify server [3], is based upon http.server and AFAIK websockify isn't characterized as only for dev or non-production use.
There is currently a pull request proposed to fix [1] and it is currently under review [4].
Based on this, I tend to think to treat it as hardening, but of course I defer to the expert opinion of the VMT.
[1] https://bugs.python.org/issue43223
[2] https://docs.python.org/3/library/http.server.html
[3] https://github.com/novnc/websockify
[4] https://github.com/python/cpython/pull/24848

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Joshua Padman (jpadman)](https://launchpad.net/~jpadman) wrote on 2021-07-12: |  |  | [#21](/nova/%2Bbug/1927677/comments/21) |
| --- | --- | --- | --- |

The last OSSA that was released was also for an open redirect.

<https://security.openstack.org/ossa/OSSA-2020-008.html>

Its not a fancy vulnerability but it is one that can lead to far more significant issues. Ideally a CVE would be assigned to this, though maybe in the interest of consistency an OSSA may be required too?

The last OSSA that was released was also for an open redirect.
https://security.openstack.org/ossa/OSSA-2020-008.html
Its not a fancy vulnerability but it is one that can lead to far more significant issues. Ideally a CVE would be assigned to this, though maybe in the interest of consistency an OSSA may be required too?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-12: |  |  | [#22](/nova/%2Bbug/1927677/comments/22) |
| --- | --- | --- | --- |

Melanie: Thanks for pointing out that the backports for branches prior to stable/wallaby haven't merged yet; I misread the notifications. We can't publish an advisory anyway until those are merged for the maintained branches at a minimum (fixes for branches under extended maintenance can merge after any advisory though).

Joshua: As Melanie points out, what we're providing is a workaround for a known security flaw in a dependency, so differs slightly from OSSA-2020-008 in that regard. You are right though that the end result is roughly the same for vulnerable deployments, and unlike most vulnerabilities involving dependencies this is one we actually have an active mitigation for which doesn't require any additional action on the part of the deployer other than upgrading our software in the deployment (no additional configuration or dependency upgrade steps needed).

I'm disappearing on a week-long vacation tomorrow, but if someone wants to compose an impact description for this and request a CVE from MITRE with it (or assign one as a CNA), I'm happy to help coordinate any advisory when I get home. Our template for impact descriptions can be found here: <https://security.openstack.org/vmt-process.html#impact-description-description>

Melanie: Thanks for pointing out that the backports for branches prior to stable/wallaby haven't merged yet; I misread the notifications. We can't publish an advisory anyway until those are merged for the maintained branches at a minimum (fixes for branches under extended maintenance can merge after any advisory though).
Joshua: As Melanie points out, what we're providing is a workaround for a known security flaw in a dependency, so differs slightly from OSSA-2020-008 in that regard. You are right though that the end result is roughly the same for vulnerable deployments, and unlike most vulnerabilities involving dependencies this is one we actually have an active mitigation for which doesn't require any additional action on the part of the deployer other than upgrading our software in the deployment (no additional configuration or dependency upgrade steps needed).
I'm disappearing on a week-long vacation tomorrow, but if someone wants to compose an impact description for this and request a CVE from MITRE with it (or assign one as a CNA), I'm happy to help coordinate any advisory when I get home. Our template for impact descriptions can be found here: https://security.openstack.org/vmt-process.html#impact-description-description

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-15:  [**Fix included in openstack/nova 23.0.2**](/nova/%2Bbug/1927677/comments/23) |  |  | [#23](/nova/%2Bbug/1927677/comments/23) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 23.0.2 release.

This issue was fixed in the openstack/nova 23.0.2 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-23:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/24) |  |  | [#24](/nova/%2Bbug/1927677/comments/24) |
| --- | --- | --- | --- |

Red Hat will be assigning a CVE for this. Sirswa, would you like to be credited as the reporter? What name should we put down? Do you represent an organization?

Red Hat will be assigning a CVE for this. Sirswa, would you like to be credited as the reporter? What name should we put down? Do you represent an organization?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Shahaan Ayyub (shahaan)](https://launchpad.net/~shahaan) wrote on 2021-07-24:  [**Re: [Bug 1927677] Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/25) |  |  | [#25](/nova/%2Bbug/1927677/comments/25) |
| --- | --- | --- | --- |

Thanks Nick,

  We are part of the Monash University Nectar Cloud team. Please feel free

to put us reporters.

Swe Aung

Shahaan Ayyub

Regards,

Shahaan

On Sat, 24 Jul 2021 at 09:25, Nick Tait <email address hidden> wrote:

> Red Hat will be assigning a CVE for this. Sirswa, would you like to be

> credited as the reporter? What name should we put down? Do you represent

> an organization?

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/1927677>

>

> Title:

> novnc allowing open direction which could potentially be used for

> phishing

>

> Status in OpenStack Compute (nova):

> Fix Released

> Status in OpenStack Compute (nova) train series:

> In Progress

> Status in OpenStack Compute (nova) ussuri series:

> In Progress

> Status in OpenStack Compute (nova) victoria series:

> In Progress

> Status in OpenStack Compute (nova) wallaby series:

> Fix Released

> Status in OpenStack Security Advisory:

> Incomplete

>

> Bug description:

> This bug report is related to Security.

>

> Currently novnc is allowing open direction, which could potentially be

> used for phishing attempts

>

> To test.

> https://<sites' vnc domain>//example.com/%2F..

> include .. at the end

>

> For example:

> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>

> It will redirect to example.com. You can replace example.com with some

> legitimate domain or spoofed domain.

>

> The description of the risk is

> By modifying untrusted URL input to a malicious site, an attacker may

> successfully launch a phishing scam and steal user credentials.

> Because the server name in the modified link is identical to the

> original site, phishing attempts may have a more trustworthy appearance.

>

> To manage notifications about this bug go to:

> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>

>

Thanks Nick,
We are part of the Monash University Nectar Cloud team. Please feel free
to put us reporters.
Swe Aung
Shahaan Ayyub
Regards,
Shahaan
On Sat, 24 Jul 2021 at 09:25, Nick Tait <1927677@bugs.launchpad.net> wrote:
> Red Hat will be assigning a CVE for this. Sirswa, would you like to be
> credited as the reporter? What name should we put down? Do you represent
> an organization?
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/1927677
>
> Title:
> novnc allowing open direction which could potentially be used for
> phishing
>
> Status in OpenStack Compute (nova):
> Fix Released
> Status in OpenStack Compute (nova) train series:
> In Progress
> Status in OpenStack Compute (nova) ussuri series:
> In Progress
> Status in OpenStack Compute (nova) victoria series:
> In Progress
> Status in OpenStack Compute (nova) wallaby series:
> Fix Released
> Status in OpenStack Security Advisory:
> Incomplete
>
> Bug description:
> This bug report is related to Security.
>
> Currently novnc is allowing open direction, which could potentially be
> used for phishing attempts
>
> To test.
> https://<sites' vnc domain>//example.com/%2F..
> include .. at the end
>
> For example:
> http://vncproxy.my.domain.com//example.com/%2F..
>
> It will redirect to example.com. You can replace example.com with some
> legitimate domain or spoofed domain.
>
> The description of the risk is
> By modifying untrusted URL input to a malicious site, an attacker may
> successfully launch a phishing scam and steal user credentials.
> Because the server name in the modified link is identical to the
> original site, phishing attempts may have a more trustworthy appearance.
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-24:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/26) |  |  | [#26](/nova/%2Bbug/1927677/comments/26) |
| --- | --- | --- | --- |

Nick: Thanks for offering to assign a CVE for this. Do you have text for an impact description you'll be using in the CVE? If not, I can work on putting one together, though we still don't have any ETA on when the workarounds will merge to stable/victoria and earlier branches (and wouldn't issue a formal advisory until they do).

Nick: Thanks for offering to assign a CVE for this. Do you have text for an impact description you'll be using in the CVE? If not, I can work on putting one together, though we still don't have any ETA on when the workarounds will merge to stable/victoria and earlier branches (and wouldn't issue a formal advisory until they do).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-07-26: |  |  | [#27](/nova/%2Bbug/1927677/comments/27) |
| --- | --- | --- | --- |

Hi Nick

Thanks. I noticed the CVE at RedHat few days ago. Thank you for following up and assigning at RedHat.

I will have to acknowledge Monash University Cyber Security team's vulnerability discovery work and raising the issue to us originally. I work for Monash University.

Our names are

Swe Aung

Shahaan Ayyub

Salman Khan (Cyber Security)

Thank you.

Hi Nick
Thanks. I noticed the CVE at RedHat few days ago. Thank you for following up and assigning at RedHat.
I will have to acknowledge Monash University Cyber Security team's vulnerability discovery work and raising the issue to us originally. I work for Monash University.
Our names are
Swe Aung
Shahaan Ayyub
Salman Khan (Cyber Security)
Thank you.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-26:  [**Fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/28) |  |  | [#28](/nova/%2Bbug/1927677/comments/28) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791805](https://review.opendev.org/c/openstack/nova/%2B/791805)

Committed: <https://opendev.org/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:

        nova/console/websocketproxy.py

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflicts are because the following changes are not

    in Victoria:

Ib2c406327fef2fb4868d8050fc476a7d17706e23 (Remove six.moves)

      I58b0382c86d4ef798572edb63d311e0e3e6937bb (Refactor and rename

        test\_tcp\_rst\_no\_compute\_rpcapi)

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791805
Committed: https://opendev.org/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Conflicts:
nova/console/websocketproxy.py
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflicts are because the following changes are not
in Victoria:
Ib2c406327fef2fb4868d8050fc476a7d17706e23 (Remove six.moves)
I58b0382c86d4ef798572edb63d311e0e3e6937bb (Refactor and rename
test\_tcp\_rst\_no\_compute\_rpcapi)
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-27:  [**Fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/29) |  |  | [#29](/nova/%2Bbug/1927677/comments/29) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791806](https://review.opendev.org/c/openstack/nova/%2B/791806)

Committed: <https://opendev.org/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 719e651e6be277950632e0c2cf5cc9a018344e7b

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

    (cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791806
Committed: https://opendev.org/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 719e651e6be277950632e0c2cf5cc9a018344e7b
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)
(cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/30) |  |  | [#30](/nova/%2Bbug/1927677/comments/30) |
| --- | --- | --- | --- |

Actually, since the stable/train branch has transitioned from maintained to extended maintenance status we no longer need to hold off any advisory waiting for the fix there to merge. I'll go ahead and start drafting the advisory now, since the stable/ussuri fix has merged.

Actually, since the stable/train branch has transitioned from maintained to extended maintenance status we no longer need to hold off any advisory waiting for the fix there to merge. I'll go ahead and start drafting the advisory now, since the stable/ussuri fix has merged.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |
| **importance**: | Undecided → Medium |
| **assignee**: | nobody → Jeremy Stanley (fungi) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27: |  |  | [#31](/nova/%2Bbug/1927677/comments/31) |
| --- | --- | --- | --- |

Nick: What CVE number have you assigned for this? Or should I go ahead and ask MITRE to assign one?

Nick: What CVE number have you assigned for this? Or should I go ahead and ask MITRE to assign one?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-27 (last edit on 2021-07-27): |  |  | [#32](/nova/%2Bbug/1927677/comments/32) |
| --- | --- | --- | --- |

I'm working on getting reviews for the backport patches, only the stable/train patch remains.

(update) Oops, I just now see Jeremy's comment #30. Makes sense.

I'm working on getting reviews for the backport patches, only the stable/train patch remains.
(update) Oops, I just now see Jeremy's comment #30. Makes sense.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-27:  [**Fix proposed to ossa (master)**](/nova/%2Bbug/1927677/comments/33) |  |  | [#33](/nova/%2Bbug/1927677/comments/33) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/802590](https://review.opendev.org/c/openstack/ossa/%2B/802590)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/802590

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/34) |  |  | [#34](/nova/%2Bbug/1927677/comments/34) |
| --- | --- | --- | --- |

Can folks please review the impact description and related metadata in the draft OSSA-2021-002 linked above? I've left the CVE blank for now since I'm waiting for Nick to say what number he assigned.

Can folks please review the impact description and related metadata in the draft OSSA-2021-002 linked above? I've left the CVE blank for now since I'm waiting for Nick to say what number he assigned.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-27: |  |  | [#35](/nova/%2Bbug/1927677/comments/35) |
| --- | --- | --- | --- |

CVE-2021-3654 <https://access.redhat.com/security/cve/CVE-2021-3654>

CVE-2021-3654 https://access.redhat.com/security/cve/CVE-2021-3654

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-27: |  |  | [#36](/nova/%2Bbug/1927677/comments/36) |
| --- | --- | --- | --- |

And cheers to the trio at Monash for reporting. Thanks!

And cheers to the trio at Monash for reporting. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-28:  [**Re: Open Redirect in noVNC proxy (CVE-2021-3654)**](/nova/%2Bbug/1927677/comments/37) |  |  | [#37](/nova/%2Bbug/1927677/comments/37) |
| --- | --- | --- | --- |

The draft advisory has been updated with the CVE (thanks again, Nick!) and a proposed publication date of tomorrow, so if folks could please review <https://review.opendev.org/802590> that will help a ton.

The draft advisory has been updated with the CVE (thanks again, Nick!) and a proposed publication date of tomorrow, so if folks could please review https://review.opendev.org/802590 that will help a ton.

| **summary**: | - novnc allowing open direction which could potentially be used for- phishing+ Open Redirect in noVNC proxy (CVE-2021-3654) |
| --- | --- |
| Changed in ossa: | |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-29:  [**Fix merged to ossa (master)**](/nova/%2Bbug/1927677/comments/38) |  |  | [#38](/nova/%2Bbug/1927677/comments/38) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/802590](https://review.opendev.org/c/openstack/ossa/%2B/802590)

Committed: <https://opendev.org/openstack/ossa/commit/08f2c78ccf3688ad2ed44d0c2239742ea1693cdb>

Submitter: "Zuul (22348)"

Branch: master

commit 08f2c78ccf3688ad2ed44d0c2239742ea1693cdb

Author: Jeremy Stanley <email address hidden>

Date: Tue Jul 27 17:44:41 2021 +0000

Add OSSA-2021-002 (CVE-2021-3654)

Change-Id: I1574738a9aa047314c9b933f8bbe032d346cd2d7

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/ossa/+/802590
Committed: https://opendev.org/openstack/ossa/commit/08f2c78ccf3688ad2ed44d0c2239742ea1693cdb
Submitter: "Zuul (22348)"
Branch: master
commit 08f2c78ccf3688ad2ed44d0c2239742ea1693cdb
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Tue Jul 27 17:44:41 2021 +0000
Add OSSA-2021-002 (CVE-2021-3654)
Change-Id: I1574738a9aa047314c9b933f8bbe032d346cd2d7
Closes-Bug: #1927677

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-07-29

| **summary**: | - Open Redirect in noVNC proxy (CVE-2021-3654)+ [OSSA-2021-002]Open Redirect in noVNC proxy (CVE-2021-3654) |
| --- | --- |
| **summary**: | - [OSSA-2021-002]Open Redirect in noVNC proxy (CVE-2021-3654)+ [OSSA-2021-002] Open Redirect in noVNC proxy (CVE-2021-3654) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-29:  [**Fix proposed to nova (stable/stein)**](/nova/%2Bbug/1927677/comments/39) |  |  | [#39](/nova/%2Bbug/1927677/comments/39) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/802935](https://review.opendev.org/c/openstack/nova/%2B/802935)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/802935

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/40) |  |  | [#40](/nova/%2Bbug/1927677/comments/40) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/803091](https://review.opendev.org/c/openstack/nova/%2B/803091)

Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/803091

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-31: |  |  | [#41](/nova/%2Bbug/1927677/comments/41) |
| --- | --- | --- | --- |

This ^ is just me updating the unit test coverage to work with Python < 3.6 for the courtesy stable/train and stable/stein patches. It's also a general improvement of the unit test to do less mocking.

This ^ is just me updating the unit test coverage to work with Python < 3.6 for the courtesy stable/train and stable/stein patches. It's also a general improvement of the unit test to do less mocking.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/42) |  |  | [#42](/nova/%2Bbug/1927677/comments/42) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/803092](https://review.opendev.org/c/openstack/nova/%2B/803092)

Related fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/803092

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/43) |  |  | [#43](/nova/%2Bbug/1927677/comments/43) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/803093](https://review.opendev.org/c/openstack/nova/%2B/803093)

Related fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/803093

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/44) |  |  | [#44](/nova/%2Bbug/1927677/comments/44) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/803094](https://review.opendev.org/c/openstack/nova/%2B/803094)

Related fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/803094

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-02:  [**Fix proposed to nova (stable/rocky)**](/nova/%2Bbug/1927677/comments/45) |  |  | [#45](/nova/%2Bbug/1927677/comments/45) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/nova/+/803182](https://review.opendev.org/c/openstack/nova/%2B/803182)

Fix proposed to branch: stable/rocky
Review: https://review.opendev.org/c/openstack/nova/+/803182

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#46](/nova/%2Bbug/1927677/comments/46) |
| --- | --- | --- | --- |

Hi,

me and my colleagues were noticing that the patch protects against URLs starting with two slashes, with four slashes, and with more than four slashes. Nevertheless, the patch does not seem to work in case the URL starts with three slashes, e.g.:

[http://vncproxy.my.domain.com///example.com/%2F](http://vncproxy.my.domain.com///example.com//)..

We believe that the reason behind this behaviour is the changes that the URL undergoes when it is split and then unsplit. More specifically:

>>> urlparse.urlunsplit(urlparse.urlsplit('//example.com/%2F..'))

'//example.com/%2F..'

>>> urlparse.urlunsplit(urlparse.urlsplit('///example.com/%2F..'))

'/example.com/%2F..'

>>> urlparse.urlunsplit(urlparse.urlsplit('////example.com/%2F..'))

'//example.com/%2F..'

The first and the last case will be captured by the test introduced by the patch, while the middle case will be sent to the parent class method. This can be observed with both Python 3 and Python 2.

We think that the unsplitting of the url in the patch could be avoided. In the case of Python 3, the reason for which the method is used is to add a final slash to the "path" part of the URL, but this is nevertheless not needed for our purposes (if the URL passes the validity check performed here, the splitting and unsplitting of the URL will be anyway done by the parent class method). Moreover, using the output of the urlsplit + urlunsplit methods causes the aforementioned issue.

I will soon attach a proposal for a Python 2 and a Python 3 patch. Their checks on the URL are slightly different because they mimic the checks that are done by the parent class method in order to identify a redirection case (SimpleHTTPRequestHandler.send\_head defined in SimpleHttpServer.py for Python2 and in http/server.py for Python 3). Please let me know if you are able to reproduce the same issue in your setup and what you think about this.

Hi,
me and my colleagues were noticing that the patch protects against URLs starting with two slashes, with four slashes, and with more than four slashes. Nevertheless, the patch does not seem to work in case the URL starts with three slashes, e.g.:
http://vncproxy.my.domain.com///example.com/%2F..
We believe that the reason behind this behaviour is the changes that the URL undergoes when it is split and then unsplit. More specifically:
>>> urlparse.urlunsplit(urlparse.urlsplit('//example.com/%2F..'))
'//example.com/%2F..'
>>> urlparse.urlunsplit(urlparse.urlsplit('///example.com/%2F..'))
'/example.com/%2F..'
>>> urlparse.urlunsplit(urlparse.urlsplit('////example.com/%2F..'))
'//example.com/%2F..'
The first and the last case will be captured by the test introduced by the patch, while the middle case will be sent to the parent class method. This can be observed with both Python 3 and Python 2.
We think that the unsplitting of the url in the patch could be avoided. In the case of Python 3, the reason for which the method is used is to add a final slash to the "path" part of the URL, but this is nevertheless not needed for our purposes (if the URL passes the validity check performed here, the splitting and unsplitting of the URL will be anyway done by the parent class method). Moreover, using the output of the urlsplit + urlunsplit methods causes the aforementioned issue.
I will soon attach a proposal for a Python 2 and a Python 3 patch. Their checks on the URL are slightly different because they mimic the checks that are done by the parent class method in order to identify a redirection case (SimpleHTTPRequestHandler.send\_head defined in SimpleHttpServer.py for Python2 and in http/server.py for Python 3). Please let me know if you are able to reproduce the same issue in your setup and what you think about this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#47](/nova/%2Bbug/1927677/comments/47) |
| --- | --- | --- | --- |

* [python2.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519968/%2Bfiles/python2.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519968)
  (1.2 KiB,
  text/plain)

This is a proposal for Python 2.

This is a proposal for Python 2.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#48](/nova/%2Bbug/1927677/comments/48) |
| --- | --- | --- | --- |

* [python3.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519969/%2Bfiles/python3.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519969)
  (1009 bytes,
  text/plain)

This is a proposal for Python 3.

This is a proposal for Python 3.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-23:  [**Fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/49) |  |  | [#49](/nova/%2Bbug/1927677/comments/49) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/805654

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Balazs Gibizer (balazs-gibizer)](https://launchpad.net/~balazs-gibizer) wrote on 2021-08-24: |  |  | [#50](/nova/%2Bbug/1927677/comments/50) |
| --- | --- | --- | --- |

It is confirmed that the original fix was incomplete. A new fix is being merged to master [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654) (and then backported)

It is confirmed that the original fix was incomplete. A new fix is being merged to master https://review.opendev.org/c/openstack/nova/+/805654 (and then backported)

| Changed in nova: | |
| --- | --- |
| **status**: | Fix Released → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-24:  [**Fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/51) |  |  | [#51](/nova/%2Bbug/1927677/comments/51) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654)

Committed: <https://opendev.org/openstack/nova/commit/6fbd0b758dcac71323f3be179b1a9d1c17a4acc5>

Submitter: "Zuul (22348)"

Branch: master

commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/nova/+/805654
Committed: https://opendev.org/openstack/nova/commit/6fbd0b758dcac71323f3be179b1a9d1c17a4acc5
Submitter: "Zuul (22348)"
Branch: master
commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-08-24: |  |  | [#52](/nova/%2Bbug/1927677/comments/52) |
| --- | --- | --- | --- |

I've switched the security advisory task back to incomplete for now, while the vulnerability managers debate whether this requires errata publication or a completely new advisory.

I've switched the security advisory task back to incomplete for now, while the vulnerability managers debate whether this requires errata publication or a completely new advisory.

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Released → Incomplete |
| **importance**: | Medium → Undecided |
| **assignee**: | Jeremy Stanley (fungi) → nobody |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-24:  [**Fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/53) |  |  | [#53](/nova/%2Bbug/1927677/comments/53) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/805818](https://review.opendev.org/c/openstack/nova/%2B/805818)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/805818

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-28:  [**Fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/54) |  |  | [#54](/nova/%2Bbug/1927677/comments/54) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/805818](https://review.opendev.org/c/openstack/nova/%2B/805818)

Committed: <https://opendev.org/openstack/nova/commit/47dad4836a26292e9d34e516e1525ecf00be127c>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 47dad4836a26292e9d34e516e1525ecf00be127c

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

Reviewed: https://review.opendev.org/c/openstack/nova/+/805818
Committed: https://opendev.org/openstack/nova/commit/47dad4836a26292e9d34e516e1525ecf00be127c
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 47dad4836a26292e9d34e516e1525ecf00be127c
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Related fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/55) |  |  | [#55](/nova/%2Bbug/1927677/comments/55) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803091](https://review.opendev.org/c/openstack/nova/%2B/803091)

Committed: <https://opendev.org/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af>

Submitter: "Zuul (22348)"

Branch: master

commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

Reviewed: https://review.opendev.org/c/openstack/nova/+/803091
Committed: https://opendev.org/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af
Submitter: "Zuul (22348)"
Branch: master
commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/56) |  |  | [#56](/nova/%2Bbug/1927677/comments/56) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/806626](https://review.opendev.org/c/openstack/nova/%2B/806626)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/806626

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/57) |  |  | [#57](/nova/%2Bbug/1927677/comments/57) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/806628](https://review.opendev.org/c/openstack/nova/%2B/806628)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/806628

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/58) |  |  | [#58](/nova/%2Bbug/1927677/comments/58) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/806629](https://review.opendev.org/c/openstack/nova/%2B/806629)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/806629

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-31:  [**Related fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/59) |  |  | [#59](/nova/%2Bbug/1927677/comments/59) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803092](https://review.opendev.org/c/openstack/nova/%2B/803092)

Committed: <https://opendev.org/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803092
Committed: https://opendev.org/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

| **tags**: | added: in-stable-wallaby |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-01:  [**Related fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/60) |  |  | [#60](/nova/%2Bbug/1927677/comments/60) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803093](https://review.opendev.org/c/openstack/nova/%2B/803093)

Committed: <https://opendev.org/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 94e265f3ca615aa18de0081a76975019997b8709

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803093
Committed: https://opendev.org/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 94e265f3ca615aa18de0081a76975019997b8709
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

| **tags**: | added: in-stable-victoria |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-14:  [**Related fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/61) |  |  | [#61](/nova/%2Bbug/1927677/comments/61) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803094](https://review.opendev.org/c/openstack/nova/%2B/803094)

Committed: <https://opendev.org/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit d43b88a33407b1253e7bce70f720a44f7688141f

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

    (cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803094
Committed: https://opendev.org/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit d43b88a33407b1253e7bce70f720a44f7688141f
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)
(cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

| **tags**: | added: in-stable-ussuri |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-16:  [**Fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/62) |  |  | [#62](/nova/%2Bbug/1927677/comments/62) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806626](https://review.opendev.org/c/openstack/nova/%2B/806626)

Committed: <https://opendev.org/openstack/nova/commit/9588cdbfd4649ea53d60303f2d10c5d62a070a07>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Conflicts:

      nova/tests/unit/console/test\_websocketproxy.py

NOTE: conflict is due to I58b0382c86d4ef798572edb63d311e0e3e6937bb

    is missing in Victoria and Ie36401c782f023d1d5f2623732619105dc2cfa24

    backport contained conflicts and methods order was swapped.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806626
Committed: https://opendev.org/openstack/nova/commit/9588cdbfd4649ea53d60303f2d10c5d62a070a07
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE: conflict is due to I58b0382c86d4ef798572edb63d311e0e3e6937bb
is missing in Victoria and Ie36401c782f023d1d5f2623732619105dc2cfa24
backport contained conflicts and methods order was swapped.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-17:  [**Fix included in openstack/nova 24.0.0.0rc1**](/nova/%2Bbug/1927677/comments/63) |  |  | [#63](/nova/%2Bbug/1927677/comments/63) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 24.0.0.0rc1 release candidate.

This issue was fixed in the openstack/nova 24.0.0.0rc1 release candidate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-09-24: |  |  | [#65](/nova/%2Bbug/1927677/comments/65) |
| --- | --- | --- | --- |

Note that we're still waiting for <https://review.opendev.org/806628> (stable/ussuri) to merge prior to issuing errata, but its merging is held up by discussions of whether to fix or discontinue running lower bounds testing for dependencies on that branch.

Note that we're still waiting for https://review.opendev.org/806628 (stable/ussuri) to merge prior to issuing errata, but its merging is held up by discussions of whether to fix or discontinue running lower bounds testing for dependencies on that branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-09-24: |  |  | [#66](/nova/%2Bbug/1927677/comments/66) |
| --- | --- | --- | --- |

We have actually been rechecking this change to make the l-c job non-voting on stable/ussuri:

[https://review.opendev.org/c/openstack/nova/+/809955](https://review.opendev.org/c/openstack/nova/%2B/809955)

But it has run into failure after unrelated failure in the gate. I have been copy pasting the various errors with every recheck.

We have actually been rechecking this change to make the l-c job non-voting on stable/ussuri:
https://review.opendev.org/c/openstack/nova/+/809955
But it has run into failure after unrelated failure in the gate. I have been copy pasting the various errors with every recheck.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-26:  [**Fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/67) |  |  | [#67](/nova/%2Bbug/1927677/comments/67) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806628](https://review.opendev.org/c/openstack/nova/%2B/806628)

Committed: <https://opendev.org/openstack/nova/commit/0997043f459ac616b594363b5b253bd0ae6ed9eb>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 0997043f459ac616b594363b5b253bd0ae6ed9eb

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

    (cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806628
Committed: https://opendev.org/openstack/nova/commit/0997043f459ac616b594363b5b253bd0ae6ed9eb
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 0997043f459ac616b594363b5b253bd0ae6ed9eb
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)
(cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-27:  [**Fix proposed to ossa (master)**](/nova/%2Bbug/1927677/comments/68) |  |  | [#68](/nova/%2Bbug/1927677/comments/68) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/811181](https://review.opendev.org/c/openstack/ossa/%2B/811181)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/811181

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-27:  [**Fix merged to ossa (master)**](/nova/%2Bbug/1927677/comments/69) |  |  | [#69](/nova/%2Bbug/1927677/comments/69) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/811181](https://review.opendev.org/c/openstack/ossa/%2B/811181)

Committed: <https://opendev.org/openstack/ossa/commit/51a1bf0699128c8ddcb7567347cee69492601091>

Submitter: "Zuul (22348)"

Branch: master

commit 51a1bf0699128c8ddcb7567347cee69492601091

Author: Jeremy Stanley <email address hidden>

Date: Mon Sep 27 15:02:06 2021 +0000

Errata 1 for OSSA-2021-002

Change-Id: Iaeb40574176ae62542a0c17e94917e654d38317d

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/ossa/+/811181
Committed: https://opendev.org/openstack/ossa/commit/51a1bf0699128c8ddcb7567347cee69492601091
Submitter: "Zuul (22348)"
Branch: master
commit 51a1bf0699128c8ddcb7567347cee69492601091
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Mon Sep 27 15:02:06 2021 +0000
Errata 1 for OSSA-2021-002
Change-Id: Iaeb40574176ae62542a0c17e94917e654d38317d
Closes-Bug: #1927677

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-09-27: |  |  | [#70](/nova/%2Bbug/1927677/comments/70) |
| --- | --- | --- | --- |

OSSA-2021-002 errata 1 has been published and distributed to usual mailing lists.

OSSA-2021-002 errata 1 has been published and distributed to usual mailing lists.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 22.3.0**](/nova/%2Bbug/1927677/comments/71) |  |  | [#71](/nova/%2Bbug/1927677/comments/71) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 22.3.0 release.

This issue was fixed in the openstack/nova 22.3.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 23.1.0**](/nova/%2Bbug/1927677/comments/73) |  |  | [#73](/nova/%2Bbug/1927677/comments/73) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 23.1.0 release.

This issue was fixed in the openstack/nova 23.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 21.2.3**](/nova/%2Bbug/1927677/comments/74) |  |  | [#74](/nova/%2Bbug/1927677/comments/74) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 21.2.3 release.

This issue was fixed in the openstack/nova 21.2.3 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-28:  [**Fix merged to nova (stable/train)**](/nova/%2Bbug/1927677/comments/76) |  |  | [#76](/nova/%2Bbug/1927677/comments/76) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/nova/%2Bbug/1927677/comments/76/%2Bdownload) (3.2 KiB)

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791807](https://review.opendev.org/c/openstack/nova/%2B/791807)

Committed: <https://opendev.org/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 04d48527b62a35d912f93bc75613a6cca606df66

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

NOTE(melwitt): This is the combination of two commits, the bug fix and

    a followup change to the unit test to enable it also run on

    Python < 3.6.

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train.

NOTE(melwitt): The difference from the cherry picked change:

    HTTPStatus.BAD\_REQUEST => 400 is due to the fact that HTTPStatus does

    not exist in Python 2.7.

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

    (cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

    (cherry picked from commit d43b88a33407b1253e7bce70f720a44f7688141f)

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

    (cherry picked from commit 6b70350bdcf5...

[Read more...](/nova/%2Bbug/1927677/comments/76)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791807
Committed: https://opendev.org/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66
Submitter: "Zuul (22348)"
Branch: stable/train
commit 04d48527b62a35d912f93bc75613a6cca606df66
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
NOTE(melwitt): This is the combination of two commits, the bug fix and
a followup change to the unit test to enable it also run on
Python < 3.6.
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train.
NOTE(melwitt): The difference from the cherry picked change:
HTTPStatus.BAD\_REQUEST => 400 is due to the fact that HTTPStatus does
not exist in Python 2.7.
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)
(cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)
(cherry picked from commit d43b88a33407b1253e7bce70f720a44f7688141f)
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)
(cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)
(cherry picked from commit 719e651e6be277950632e0c2cf5cc9a018344e7b)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-11-01: |  |  | [#77](/nova/%2Bbug/1927677/comments/77) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806629](https://review.opendev.org/c/openstack/nova/%2B/806629)

Committed: <https://opendev.org/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 8906552cfc2525a44251d4cf313ece61e57251eb

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Conflicts:

      nova/console/websocketproxy.py

      nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict and difference in websocketproxy.py from

    the cherry picked change: HTTPStatus.BAD\_REQUEST => 400 is due to the

    fact that HTTPStatus does not exist in Python 2.7. The conflict in

    test\_websocketproxy.py is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train. The difference

    in test\_websocketproxy.py from the cherry picked change is due to a

    difference in internal implementation [1] in Python < 3.6. See change

    I546d376869a992601b443fb95acf1034da2a8f36 for reference.

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

    (cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

    (cherry picked from commit 0997043f459ac616b594363b5b253bd0ae6ed9eb)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806629
Committed: https://opendev.org/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb
Submitter: "Zuul (22348)"
Branch: stable/train
commit 8906552cfc2525a44251d4cf313ece61e57251eb
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Conflicts:
nova/console/websocketproxy.py
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict and difference in websocketproxy.py from
the cherry picked change: HTTPStatus.BAD\_REQUEST => 400 is due to the
fact that HTTPStatus does not exist in Python 2.7. The conflict in
test\_websocketproxy.py is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train. The difference
in test\_websocketproxy.py from the cherry picked change is due to a
difference in internal implementation [1] in Python < 3.6. See change
I546d376869a992601b443fb95acf1034da2a8f36 for reference.
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)
(cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)
(cherry picked from commit 0997043f459ac616b594363b5b253bd0ae6ed9eb)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-11-08:  [**Fix proposed to nova (stable/stein)**](/nova/%2Bbug/1927677/comments/78) |  |  | [#78](/nova/%2Bbug/1927677/comments/78) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/817037](https://review.opendev.org/c/openstack/nova/%2B/817037)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/817037

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-08-17:  [**Related fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/79) |  |  | [#79](/nova/%2Bbug/1927677/comments/79) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/853379](https://review.opendev.org/c/openstack/nova/%2B/853379)

Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/853379

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-08-30:  [**Related fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/80) |  |  | [#80](/nova/%2Bbug/1927677/comments/80) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/853379](https://review.opendev.org/c/openstack/nova/%2B/853379)

Committed: <https://opendev.org/openstack/nova/commit/15769b883ed4a86d62b141ea30d3f1590565d8e0>

Submitter: "Zuul (22348)"

Branch: master

commit 15769b883ed4a86d62b141ea30d3f1590565d8e0

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

Reviewed: https://review.opendev.org/c/openstack/nova/+/853379
Committed: https://opendev.org/openstack/nova/commit/15769b883ed4a86d62b141ea30d3f1590565d8e0
Submitter: "Zuul (22348)"
Branch: master
commit 15769b883ed4a86d62b141ea30d3f1590565d8e0
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11:  [**Change abandoned on nova (stable/rocky)**](/nova/%2Bbug/1927677/comments/81) |  |  | [#81](/nova/%2Bbug/1927677/comments/81) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/nova/+/803182](https://review.opendev.org/c/openstack/nova/%2B/803182)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/rocky
Review: https://review.opendev.org/c/openstack/nova/+/803182
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11:  [**Change abandoned on nova (stable/stein)**](/nova/%2Bbug/1927677/comments/82) |  |  | [#82](/nova/%2Bbug/1927677/comments/82) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/817037](https://review.opendev.org/c/openstack/nova/%2B/817037)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/817037
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11: |  |  | [#83](/nova/%2Bbug/1927677/comments/83) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/802935](https://review.opendev.org/c/openstack/nova/%2B/802935)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/802935
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/yoga)**](/nova/%2Bbug/1927677/comments/84) |  |  | [#84](/nova/%2Bbug/1927677/comments/84) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/yoga

Review: [https://review.opendev.org/c/openstack/nova/+/866192](https://review.opendev.org/c/openstack/nova/%2B/866192)

Related fix proposed to branch: stable/yoga
Review: https://review.opendev.org/c/openstack/nova/+/866192

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/xena)**](/nova/%2Bbug/1927677/comments/85) |  |  | [#85](/nova/%2Bbug/1927677/comments/85) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/xena

Review: [https://review.opendev.org/c/openstack/nova/+/866193](https://review.opendev.org/c/openstack/nova/%2B/866193)

Related fix proposed to branch: stable/xena
Review: https://review.opendev.org/c/openstack/nova/+/866193

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/86) |  |  | [#86](/nova/%2Bbug/1927677/comments/86) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/866194](https://review.opendev.org/c/openstack/nova/%2B/866194)

Related fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/866194

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/87) |  |  | [#87](/nova/%2Bbug/1927677/comments/87) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/866195](https://review.opendev.org/c/openstack/nova/%2B/866195)

Related fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/866195

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/88) |  |  | [#88](/nova/%2Bbug/1927677/comments/88) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/866196](https://review.opendev.org/c/openstack/nova/%2B/866196)

Related fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/866196

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/89) |  |  | [#89](/nova/%2Bbug/1927677/comments/89) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/866201](https://review.opendev.org/c/openstack/nova/%2B/866201)

Related fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/866201

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-12-20:  [**Related fix merged to nova (stable/yoga)**](/nova/%2Bbug/1927677/comments/90) |  |  | [#90](/nova/%2Bbug/1927677/comments/90) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866192](https://review.opendev.org/c/openstack/nova/%2B/866192)

Committed: <https://opendev.org/openstack/nova/commit/4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af>

Submitter: "Zuul (22348)"

Branch: stable/yoga

commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866192
Committed: https://opendev.org/openstack/nova/commit/4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af
Submitter: "Zuul (22348)"
Branch: stable/yoga
commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

| **tags**: | added: in-stable-yoga |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/xena)**](/nova/%2Bbug/1927677/comments/91) |  |  | [#91](/nova/%2Bbug/1927677/comments/91) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866193](https://review.opendev.org/c/openstack/nova/%2B/866193)

Committed: <https://opendev.org/openstack/nova/commit/0e4a257e8636a979605c614a35e79ba47b74d870>

Submitter: "Zuul (22348)"

Branch: stable/xena

commit 0e4a257e8636a979605c614a35e79ba47b74d870

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866193
Committed: https://opendev.org/openstack/nova/commit/0e4a257e8636a979605c614a35e79ba47b74d870
Submitter: "Zuul (22348)"
Branch: stable/xena
commit 0e4a257e8636a979605c614a35e79ba47b74d870
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

| **tags**: | added: in-stable-xena |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/92) |  |  | [#92](/nova/%2Bbug/1927677/comments/92) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866194](https://review.opendev.org/c/openstack/nova/%2B/866194)

Committed: <https://opendev.org/openstack/nova/commit/3023e162e1a415ddaa70b4b8fbe24b1771dbe424>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866194
Committed: https://opendev.org/openstack/nova/commit/3023e162e1a415ddaa70b4b8fbe24b1771dbe424
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/93) |  |  | [#93](/nova/%2Bbug/1927677/comments/93) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866195](https://review.opendev.org/c/openstack/nova/%2B/866195)

Committed: <https://opendev.org/openstack/nova/commit/77bc3f004e7fe4077ea035c659630bedef1cfea1>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 77bc3f004e7fe4077ea035c659630bedef1cfea1

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I58b0382c86d4ef798572edb63d311e0e3e6937bb

    (Refactor and rename test\_tcp\_rst\_no\_compute\_rpcapi) is not in

    Victoria.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866195
Committed: https://opendev.org/openstack/nova/commit/77bc3f004e7fe4077ea035c659630bedef1cfea1
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 77bc3f004e7fe4077ea035c659630bedef1cfea1
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I58b0382c86d4ef798572edb63d311e0e3e6937bb
(Refactor and rename test\_tcp\_rst\_no\_compute\_rpcapi) is not in
Victoria.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-11:  [**Related fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/94) |  |  | [#94](/nova/%2Bbug/1927677/comments/94) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866196](https://review.opendev.org/c/openstack/nova/%2B/866196)

Committed: <https://opendev.org/openstack/nova/commit/746d654c23d75f084b6f0c70e6c32b97eebf419c>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 746d654c23d75f084b6f0c70e6c32b97eebf419c

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

    (cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866196
Committed: https://opendev.org/openstack/nova/commit/746d654c23d75f084b6f0c70e6c32b97eebf419c
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 746d654c23d75f084b6f0c70e6c32b97eebf419c
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)
(cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-11:  [**Related fix merged to nova (stable/train)**](/nova/%2Bbug/1927677/comments/95) |  |  | [#95](/nova/%2Bbug/1927677/comments/95) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866201](https://review.opendev.org/c/openstack/nova/%2B/866201)

Committed: <https://opendev.org/openstack/nova/commit/43af75243b79e95330ecd982552d568571623e39>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 43af75243b79e95330ecd982552d568571623e39

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train. The difference

    from the cherry picked change is because the flake8 version on the

    stable/train branch does not support f-strings [1].

Related-Bug: #1927677

    Closes-Bug: #1986545

[1] <https://lists.openstack.org/pipermail/openstack-discuss/2019-November/011027.html>

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

    (cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

    (cherry picked from commit 746d654c23d75f084b6f0c70e6c32b97eebf419c)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866201
Committed: https://opendev.org/openstack/nova/commit/43af75243b79e95330ecd982552d568571623e39
Submitter: "Zuul (22348)"
Branch: stable/train
commit 43af75243b79e95330ecd982552d568571623e39
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train. The difference
from the cherry picked change is because the flake8 version on the
stable/train branch does not support f-strings [1].
Related-Bug: #1927677
Closes-Bug: #1986545
[1] https://lists.openstack.org/pipermail/openstack-discuss/2019-November/011027.html
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)
(cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)
(cherry picked from commit 746d654c23d75f084b6f0c70e6c32b97eebf419c)

| **tags**: | added: in-stable-train |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-08-31:  [**Fix included in openstack/nova train-eol**](/nova/%2Bbug/1927677/comments/96) |  |  | [#96](/nova/%2Bbug/1927677/comments/96) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova train-eol release.

This issue was fixed in the openstack/nova train-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Lucas (lucas6)](https://launchpad.net/~lucas6) wrote on 2024-09-10: |  |  | [#98](/nova/%2Bbug/1927677/comments/98) |
| --- | --- | --- | --- |

Python fix an open redirection vulnerability(CVE-2021-28861) in the HTTP server when an URI path starts with //[1]. Reducing to a single /, the Nova patch[2] for fixing the CVE-2021-3654 vulnerability does not take effect.

For example:

The URI patch is changed from ////example.com/%2F.. to /example.com/%2F.. and passed to Nova.

[1] <https://github.com/python/cpython/commit/5715382d3a89ca118ce2e224d8c69550d21fe51b>

[2] [https://review.opendev.org/c/openstack/nova/+/806629/6/nova/console/websocketproxy.py](https://review.opendev.org/c/openstack/nova/%2B/806629/6/nova/console/websocketproxy.py)

Python fix an open redirection vulnerability(CVE-2021-28861) in the HTTP server when an URI path starts with //[1]. Reducing to a single /, the Nova patch[2] for fixing the CVE-2021-3654 vulnerability does not take effect.
For example:
The URI patch is changed from ////example.com/%2F.. to /example.com/%2F.. and passed to Nova.
[1] https://github.com/python/cpython/commit/5715382d3a89ca118ce2e224d8c69550d21fe51b
[2] https://review.opendev.org/c/openstack/nova/+/806629/6/nova/console/websocketproxy.py

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-09-10: |  |  | [#99](/nova/%2Bbug/1927677/comments/99) |
| --- | --- | --- | --- |

Lucas: Are you possibly just rediscovering related [bug 1986545](/bugs/1986545)?

Lucas: Are you possibly just rediscovering related bug 1986545?

[See full activity log](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/nova/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

## Duplicates of this bug

* [Bug #1988302](https://bugs.launchpad.net/nova/%2Bbug/1988302 "novncproxy open redirect")

You are
[not directly subscribed to this bug's notifications.](/nova/%2Bbug/1927677/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [lp1927677.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5496768/%2Bfiles/lp1927677.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5496768 "Change patch details")
* [python2.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519968/%2Bfiles/python2.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519968 "Change patch details")
* [python3.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519969/%2Bfiles/python3.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519969 "Change patch details")

* [Add patch](/nova/%2Bbug/1927677/%2Baddcomment?field.patch=on)

## Remote bug watches

* [python-roundup #32084](http://bugs.python.org/issue32084)

  [2:2]
  [Edit](/bugs/1927677/%2Bwatch/142925 "Change watch details")
* [python-roundup #43223](http://bugs.python.org/issue43223)

  [1:None]
  [Edit](/bugs/1927677/%2Bwatch/143534 "Change watch details")
* [auto-github-novnc-novnc #748](https://github.com/novnc/noVNC/issues/748)

  [closed bug]
  [Edit](/bugs/1927677/%2Bwatch/142896 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from answers.launchpad.net_c6f997e5_20250115_194626.html ===

[Log in / Register](https://answers.launchpad.net/nova/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* [Translations](https://translations.launchpad.net/nova)
* Answers

# Questions for OpenStack Compute (nova)

**Launchpad does not know where
OpenStack Compute (nova)
tracks support requests.**

OpenStack Compute (nova) questions are
tracked in:
[nova in Ubuntu](/ubuntu/%2Bsource/nova),
[python-openstack-compute in Ubuntu](/ubuntu/%2Bsource/python-openstack-compute).

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from blueprints.launchpad.net_7b347be6_20250115_194627.html ===

[Log in / Register](https://blueprints.launchpad.net/nova/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* Blueprints
* [Translations](https://translations.launchpad.net/nova)
* [Answers](https://answers.launchpad.net/nova)

# Blueprints for OpenStack Compute (nova)

Show only blueprints containing:

| **1** → **75** of 1208 results | First • Previous • [**Next**](https://blueprints.launchpad.net/nova/%2Bspecs?memo=75&start=75) • [Last](https://blueprints.launchpad.net/nova/%2Bspecs?direction=backwards&start=1200) |
| --- | --- |

| Priority | Blueprint | Design | Delivery | Assignee | Series |
| --- | --- | --- | --- | --- | --- |
| 4 High | [nova-change-default-overcommit-v...](/nova/%2Bspec/nova-change-default-overcommit-values "Change Default Overcommit values for CPU and MEM") | 0 Approved | 2 Deferred | [Yuriy Shyyan](https://launchpad.net/~yuriyshyyan) | [yoga](/nova/yoga) |
| 4 High | [vgpu-stein](/nova/%2Bspec/vgpu-stein "vgpu work in Stein") | 1 Pending Approval | 9 Needs Code Review |  |  |
| 3 Medium | [configurable-no-compression-imag...](/nova/%2Bspec/configurable-no-compression-image-types "Configurage no_compression_image_types") | 0 Approved | 2 Deferred | [Daniel Speichert](https://launchpad.net/~dasp) | [yoga](/nova/yoga) |
| 3 Medium | [ephemeral-storage-encryption](/nova/%2Bspec/ephemeral-storage-encryption "Image and flavor defined ephemeral storage encryption") | 0 Approved | 2 Deferred | [melanie witt](https://launchpad.net/~melwitt) | [2024.2](/nova/2024.2) |
| 3 Medium | [remove-tenant-id](/nova/%2Bspec/remove-tenant-id "Remove tenant_id") | 0 Approved | 2 Deferred | [Brin Zhang](https://launchpad.net/~zhangbailin) | [zed](/nova/zed) |
| 3 Medium | [add-force-detach-to-nova](/nova/%2Bspec/add-force-detach-to-nova "Add force detach volume to nova") | 1 Pending Approval | 4 Blocked | [Andrea Rosa](https://launchpad.net/~andrea-rosa-m) |  |
| 3 Medium | [deploy-vcenter-templates-from-vm...](/nova/%2Bspec/deploy-vcenter-templates-from-vmware-nova-driver "vCenter Nova Driver to deploy vCenter templates available as glance images") | 1 Pending Approval | 9 Needs Code Review | [Kiran Kumar Vaddi](https://launchpad.net/~kiran-kumar-vaddi) |  |
| 3 Medium | [deprecate-baremetal-driver](/nova/%2Bspec/deprecate-baremetal-driver "Deprecate the Baremetal driver") | 1 Pending Approval | 8 Beta Available |  |  |
| 3 Medium | [ec2-volume-type](/nova/%2Bspec/ec2-volume-type "EC2 API: Implement/expose 'volume type'") | 1 Pending Approval | 9 Needs Code Review | [Rushi Agrawal](https://launchpad.net/~rushiagr) |  |
| 3 Medium | [enable-rebuild-for-instances-in-...](/nova/%2Bspec/enable-rebuild-for-instances-in-cell0 "Enable Rebuild for Instances in cell0") | 1 Pending Approval | 9 Needs Code Review | [Theodoros Tsioutsias](https://launchpad.net/~ttsiouts) |  |
| 3 Medium | [generate-api-sample-from-api-schema](/nova/%2Bspec/generate-api-sample-from-api-schema "API: Autogenerate API sample files from API validation schemas") | 1 Pending Approval | 1 Not started | [Ken'ichi Ohmichi](https://launchpad.net/~oomichi) |  |
| 3 Medium | [host-state-level-locking](/nova/%2Bspec/host-state-level-locking "Scheduler: Introduce lightwieght transactional model for HostState") | 1 Pending Approval | 9 Needs Code Review | [Yingxin](https://launchpad.net/~cyx1231st) |  |
| 3 Medium | [improve-sched-logging](/nova/%2Bspec/improve-sched-logging "Improve Scheduler Logging") | 1 Pending Approval | 8 Beta Available | [Chris Friesen](https://launchpad.net/~cbf123) |  |
| 3 Medium | [libvirt-imagebackend-refactor](/nova/%2Bspec/libvirt-imagebackend-refactor "Libvirt driver imagebackend refactor") | 1 Pending Approval | 9 Needs Code Review | [Matthew Booth](https://launchpad.net/~mbooth-9) |  |
| 3 Medium | [lowercase-metadata-keys](/nova/%2Bspec/lowercase-metadata-keys "Restrict Metadata to Lower Case") | 1 Pending Approval | 8 Beta Available |  | [ocata](/nova/ocata) |
| 3 Medium | [migrate-libvirt-volumes](/nova/%2Bspec/migrate-libvirt-volumes "Use Libvirt Storage Pool Methods to Migrate Libvirt Volumes") | 1 Pending Approval | 0 Unknown | [Paul Carlton](https://launchpad.net/~paul-carlton2) | [newton](/nova/newton) |
| 3 Medium | [migration-state-machine](/nova/%2Bspec/migration-state-machine "Migration state machine.") | 1 Pending Approval | 5 Started | [Tang Chen](https://launchpad.net/~tangchen) |  |
| 3 Medium | [nova-audit](/nova/%2Bspec/nova-audit "Add a nova-audit service for periodic maintenance") | 1 Pending Approval | 6 Slow progress | [melanie witt](https://launchpad.net/~melwitt) |  |
| 3 Medium | [pci-stats-generate](/nova/%2Bspec/pci-stats-generate "On-demand Generate PCI Device Pools¶") | 1 Pending Approval | 5 Started | [Dmitry Stepanenko](https://launchpad.net/~dstepanenko) |  |
| 3 Medium | [placement-aggregate-allocation-r...](/nova/%2Bspec/placement-aggregate-allocation-ratios "Support resource provider inventory allocation ratios based on Nova host aggregate") | 1 Pending Approval | 1 Not started | [Jay Pipes](https://launchpad.net/~jaypipes) |  |
| 3 Medium | [prep-for-network-aware-schedulin...](/nova/%2Bspec/prep-for-network-aware-scheduling-ocata "Prep work for Network aware scheduling (ocata)") | 1 Pending Approval | 9 Needs Code Review | [John Garbutt](https://launchpad.net/~johngarbutt) | [ocata](/nova/ocata) |
| 3 Medium | [prep-for-network-aware-schedulin...](/nova/%2Bspec/prep-for-network-aware-scheduling-pike "Prep work for Network aware scheduling (Pike)") | 1 Pending Approval | 6 Slow progress |  |  |
| 3 Medium | [remove-compute-compute-communica...](/nova/%2Bspec/remove-compute-compute-communication "Remove compute-compute communication in live-migration") | 1 Pending Approval | 8 Beta Available | [Timofey Durakov](https://launchpad.net/~tdurakov) |  |
| 3 Medium | [use-libvirt-storage-pools](/nova/%2Bspec/use-libvirt-storage-pools "libvirt: Use Libvirt Storage Pools") | 1 Pending Approval | 0 Unknown | [Paul Carlton](https://launchpad.net/~paul-carlton2) | [newton](/nova/newton) |
| 3 Medium | [volume-multiattach-enhancements](/nova/%2Bspec/volume-multiattach-enhancements "Volume multiattach enhancements") | 1 Pending Approval | 5 Started | [Matt Riedemann](https://launchpad.net/~mriedem) |  |
| 3 Medium | [autowsdl-repair](/nova/%2Bspec/autowsdl-repair "VMware: automated WSDL repair") | 2 Review | 9 Needs Code Review | [Shawn Hartsock](https://launchpad.net/~hartsock) |  |
| 3 Medium | [cells-aggregate-support](/nova/%2Bspec/cells-aggregate-support "Cells: Aggregate support for Cells") | 2 Review | 9 Needs Code Review | [Sam Morrison](https://launchpad.net/~sorrison) |  |
| 3 Medium | [db-purge-engine](/nova/%2Bspec/db-purge-engine "Need implementation of purge engine for db.") | 2 Review | 1 Not started |  |  |
| 3 Medium | [deprecate-nova-network](/nova/%2Bspec/deprecate-nova-network "Deprecate nova-network in favor of using Neutron") | 2 Review | 1 Not started |  |  |
| 3 Medium | [i18n-messages](/nova/%2Bspec/i18n-messages "Oslo: i18n Message improvements") | 2 Review | 9 Needs Code Review | [James Carey](https://launchpad.net/~jecarey) |  |
| 3 Medium | [improve-instance-action-events](/nova/%2Bspec/improve-instance-action-events "Objects: Improve instance action events to contain more messages") | 2 Review | 9 Needs Code Review | [Qiu Yu](https://launchpad.net/~unicell) |  |
| 3 Medium | [instance-sysmeta-to-json](/nova/%2Bspec/instance-sysmeta-to-json "Convert system_metadata to a JSON blob") | 2 Review | 1 Not started | [Dan Smith](https://launchpad.net/~danms) |  |
| 3 Medium | [list-tested-apis](/nova/%2Bspec/list-tested-apis "API: List tested APIs") | 2 Review | 9 Needs Code Review | [Masayuki Igawa](https://launchpad.net/~igawa) |  |
| 3 Medium | [no-db-scheduler](/nova/%2Bspec/no-db-scheduler "Remove DB between scheduler and compute nodes") | 2 Review | 9 Needs Code Review | [Boris Pavlovic](https://launchpad.net/~boris-42) |  |
| 3 Medium | [recover-stuck-state](/nova/%2Bspec/recover-stuck-state "Recover from \"stuck\" states on compute manager start-up") | 2 Review | 9 Needs Code Review | [David McNally](https://launchpad.net/~dave-mcnally) |  |
| 3 Medium | [smarter-network-cache-update](/nova/%2Bspec/smarter-network-cache-update "Networking: smarter-network-cache-update") | 2 Review | 9 Needs Code Review | [Aaron Rosen](https://launchpad.net/~arosen) |  |
| 3 Medium | [metadata-service-callbacks](/nova/%2Bspec/metadata-service-callbacks "API: Metadata Service Callbacks") | 3 Drafting | 9 Needs Code Review | [Aneesh Puliyedath Udumbath](https://launchpad.net/~aneesh-udumbath) |  |
| 3 Medium | [volume-backed-flavors](/nova/%2Bspec/volume-backed-flavors "Volume-backed flavors") | 3 Drafting | 0 Unknown | [Matt Riedemann](https://launchpad.net/~mriedem) |  |
| 2 Low | [add-ability-to-pass-driver-meta-...](/nova/%2Bspec/add-ability-to-pass-driver-meta-when-starting-instance "Add ability to specify arbitrary key value pairs to be used by driver when launching instance") | 1 Pending Approval | 9 Needs Code Review | [Dennis Kliban](https://launchpad.net/~dkliban) |  |
| 2 Low | [add-instance-number-as-weight](/nova/%2Bspec/add-instance-number-as-weight "scheduler: Add instance number as weight when select hosts") | 1 Pending Approval | 9 Needs Code Review | [jichenjc](https://launchpad.net/~jichenjc) |  |
| 2 Low | [add-virtio-scsi-bus-for-bdm](/nova/%2Bspec/add-virtio-scsi-bus-for-bdm "Add virtio-scsi bus support for block device mapping") | 1 Pending Approval | 5 Started | [Trump.Zhang](https://launchpad.net/~zhangleiqiang) | [trunk](/nova/trunk) |
| 2 Low | [cache-aware-weigher](/nova/%2Bspec/cache-aware-weigher "Image cache aware weigher") | 1 Pending Approval | 9 Needs Code Review | [Alvaro Lopez](https://launchpad.net/~aloga) |  |
| 2 Low | [cells-v1-interface-events](/nova/%2Bspec/cells-v1-interface-events "Support attach/detach interface under cells v1") | 1 Pending Approval | 9 Needs Code Review |  |  |
| 2 Low | [clean-logs](/nova/%2Bspec/clean-logs "Nova logs should be readable, sensible, and contain only errors and traces in exceptional situations") | 1 Pending Approval | 6 Slow progress | [Sean Dague](https://launchpad.net/~sdague) | [trunk](/nova/trunk) |
| 2 Low | [compute-node-metrics-list](/nova/%2Bspec/compute-node-metrics-list "Need a way to list the metrics of the compute node") | 1 Pending Approval | 8 Beta Available | [Lianhao Lu](https://launchpad.net/~lianhao-lu) |  |
| 2 Low | [compute-node-notification](/nova/%2Bspec/compute-node-notification "add notification for compute node") | 1 Pending Approval | 8 Beta Available | [Liyingjun](https://launchpad.net/~liyingjun) |  |
| 2 Low | [conf-network-metadata-always-sta...](/nova/%2Bspec/conf-network-metadata-always-static-ip "Option to always create network metadata information as static") | 1 Pending Approval | 9 Needs Code Review | [Dan Peschman](https://launchpad.net/~dpeschman) |  |
| 2 Low | [config-drive-support-for-virtuoz...](/nova/%2Bspec/config-drive-support-for-virtuozzo-containers "Virtuozzo containers config drive support") | 1 Pending Approval | 9 Needs Code Review | [Maxim Nestratov](https://launchpad.net/~mnestratov) |  |
| 2 Low | [console-log-offset](/nova/%2Bspec/console-log-offset "Add offset to console logs") | 1 Pending Approval | 8 Beta Available | [stgleb](https://launchpad.net/~gstepanov) |  |
| 2 Low | [detach-boot-volume](/nova/%2Bspec/detach-boot-volume "Detach and attach boot volumes") | 1 Pending Approval | 6 Slow progress | [Zhenyu Zheng](https://launchpad.net/~zhengzhenyu) |  |
| 2 Low | [distribute-pci-allocation](/nova/%2Bspec/distribute-pci-allocation "Distribute PCI Requests Across Multiple Devices") | 1 Pending Approval | 1 Not started | [Roman Bogorodskiy](https://launchpad.net/~novel) |  |
| 2 Low | [dm-crypt-to-brick](/nova/%2Bspec/dm-crypt-to-brick "Move DM crypt setup code to brick") | 1 Pending Approval | 1 Not started | [Lisa Li](https://launchpad.net/~lisali) |  |
| 2 Low | [ec2-volume-and-snapshot-tags](/nova/%2Bspec/ec2-volume-and-snapshot-tags "EC2 API: Implement metadata tags for volumes and snapshots") | 1 Pending Approval | 9 Needs Code Review | [Rushi Agrawal](https://launchpad.net/~rushiagr) |  |
| 2 Low | [ec2-volume-filtering](/nova/%2Bspec/ec2-volume-filtering "EC2 API: Allow filtering of volumes") | 1 Pending Approval | 9 Needs Code Review | [Rushi Agrawal](https://launchpad.net/~rushiagr) |  |
| 2 Low | [enable-sriov-nic-features](/nova/%2Bspec/enable-sriov-nic-features "Enable SR-IOV NIC offload feature discovery") | 1 Pending Approval | 9 Needs Code Review | [Rodolfo Alonso](https://launchpad.net/~rodolfo-alonso-hernandez) |  |
| 2 Low | [expose-host-capabilities](/nova/%2Bspec/expose-host-capabilities "Expose host capabilities") | 1 Pending Approval | 9 Needs Code Review | [Claudiu Belu](https://launchpad.net/~cbelu) |  |
| 2 Low | [expose-quiesce-unquiesce-api](/nova/%2Bspec/expose-quiesce-unquiesce-api "expose quiesce unquiesce api") | 1 Pending Approval | 9 Needs Code Review | [Chaoyi Huang](https://launchpad.net/~joehuang) |  |
| 2 Low | [filter-mem-bw](/nova/%2Bspec/filter-mem-bw "Add an extension to the NUMA filter scheduler for host memory bw") | 1 Pending Approval | 1 Not started | [Sudipta Biswas](https://launchpad.net/~sbiswas7) |  |
| 2 Low | [flavor-root-disk-none](/nova/%2Bspec/flavor-root-disk-none "Support flavor with no local disks") | 1 Pending Approval | 9 Needs Code Review | [Tom Patzig](https://launchpad.net/~tom-patzig) |  |
| 2 Low | [get-lock-status-of-instance](/nova/%2Bspec/get-lock-status-of-instance "API: get the status of a locked instance") | 1 Pending Approval | 6 Slow progress | [jichenjc](https://launchpad.net/~jichenjc) | [trunk](/nova/trunk) |
| 2 Low | [hyper-v-boot-from-iso](/nova/%2Bspec/hyper-v-boot-from-iso "Hyper-V boot from ISO") | 1 Pending Approval | 0 Unknown | [Claudiu Belu](https://launchpad.net/~cbelu) |  |
| 2 Low | [hyper-v-cluster](/nova/%2Bspec/hyper-v-cluster "Hyper-V Cluster") | 1 Pending Approval | 9 Needs Code Review | [Claudiu Belu](https://launchpad.net/~cbelu) |  |
| 2 Low | [hyper-v-nested-virtualization](/nova/%2Bspec/hyper-v-nested-virtualization "Hyper-V Nested Virtualization") | 1 Pending Approval | 8 Beta Available | [Claudiu Belu](https://launchpad.net/~cbelu) |  |
| 2 Low | [hyperv-assisted-volume-snapshot](/nova/%2Bspec/hyperv-assisted-volume-snapshot "Hyper-V: Nova assisted volume snapshot") | 1 Pending Approval | 1 Not started | [Lucian Petrut](https://launchpad.net/~petrutlucian94) |  |
| 2 Low | [hyperv-sriov](/nova/%2Bspec/hyperv-sriov "Hyper-V SR-IOV support") | 1 Pending Approval | 1 Not started | [Claudiu Belu](https://launchpad.net/~cbelu) |  |
| 2 Low | [i18n-enablement-juno](/nova/%2Bspec/i18n-enablement-juno "Enable oslo.i18n lazy translation") | 1 Pending Approval | 5 Started | [James Carey](https://launchpad.net/~jecarey) | [trunk](/nova/trunk) |
| 2 Low | [image-type-mapping](/nova/%2Bspec/image-type-mapping "libvirt: Select image type in runtime according to mapping parameter") | 1 Pending Approval | 5 Started | [Maxim Nestratov](https://launchpad.net/~mnestratov) |  |
| 2 Low | [interfaces-template-routes](/nova/%2Bspec/interfaces-template-routes "Add IPv6 routes to interfaces template engine with alternate in-tree template") | 1 Pending Approval | 8 Beta Available |  |  |
| 2 Low | [introduce-pending-vm-state](/nova/%2Bspec/introduce-pending-vm-state "Introduce Pending VM state") | 1 Pending Approval | 9 Needs Code Review | [Theodoros Tsioutsias](https://launchpad.net/~ttsiouts) |  |
| 2 Low | [ips-add-mac-and-type](/nova/%2Bspec/ips-add-mac-and-type "Add mac and type into API for ips") | 1 Pending Approval | 9 Needs Code Review | [jichenjc](https://launchpad.net/~jichenjc) |  |
| 2 Low | [json-schema-for-versioned-notifi...](/nova/%2Bspec/json-schema-for-versioned-notifications "JSON Schema for versioned notifications") | 1 Pending Approval | 4 Blocked | [Balazs Gibizer](https://launchpad.net/~balazs-gibizer) |  |
| 2 Low | [keypair-notification](/nova/%2Bspec/keypair-notification "Improve notification for keypair") | 1 Pending Approval | 1 Not started |  |  |
| 2 Low | [libvirt-os-brick-in-remotefs-vol...](/nova/%2Bspec/libvirt-os-brick-in-remotefs-volumes "Use os-brick in remotefs volume driver in libvirt") | 1 Pending Approval | 1 Not started |  |  |
| 2 Low | [libvirt-sheepdog-backed-instances](/nova/%2Bspec/libvirt-sheepdog-backed-instances "Support Sheepdog instance disks for libvirt driver") | 1 Pending Approval | 0 Unknown | [Scott Devoid](https://launchpad.net/~scott-devoid) | [trunk](/nova/trunk) |
| 2 Low | [libvirt-snap-live-blockcommit](/nova/%2Bspec/libvirt-snap-live-blockcommit "libvirt: Use live blockcommit for snapshot deletion") | 1 Pending Approval | 1 Not started | [Eric Harney](https://launchpad.net/~eharney) | [trunk](/nova/trunk) |

| **1** → **75** of 1208 results | First • Previous • [**Next**](https://blueprints.launchpad.net/nova/%2Bspecs?memo=75&start=75) • [Last](https://blueprints.launchpad.net/nova/%2Bspecs?direction=backwards&start=1200) |
| --- | --- |

* [Register a blueprint](https://blueprints.launchpad.net/nova/%2Baddspec)

* [List all blueprints](https://blueprints.launchpad.net/nova/%2Bspecs?show=all)
* [List documentation](https://blueprints.launchpad.net/nova/%2Bdocumentation)
* [Assignments](https://blueprints.launchpad.net/nova/%2Bassignments)
* [Register a blueprint](https://blueprints.launchpad.net/nova/%2Baddspec)
* [Register a meeting](https://blueprints.launchpad.net/sprints/%2Bnew "Register a developer sprint, summit, or gathering")

## [All blueprints](/nova) Latest blueprints

* [Inclued image properties in server show](/nova/%2Bspec/image-properties-in-server-show)

  Registered
  on 2025-01-13
* [Network ID query filter for server list API](/nova/%2Bspec/network-id-query)

  Registered
  on 2025-01-09
* [Distributed host discovery with leader election](/nova/%2Bspec/distributed-host-discovery)

  Registered
  on 2025-01-07
* [libvirt driver launching Arm-CCA encrypted instances](/nova/%2Bspec/arm-cca-libvirt-support)

  Registered
  on 2024-12-26
* [Image Metadata Properties weigher](/nova/%2Bspec/image-metadata-props-weigher)

  Registered
  on 2024-12-20

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from www.openwall.com_d13319d0_20250114_221540.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](../../../2021/07/30/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20210729173331.7vwinmrmow3gtfni@yuggoth.org>
Date: Thu, 29 Jul 2021 17:33:32 +0000
From: Jeremy Stanley <fungi@...goth.org>
To: oss-security@...ts.openwall.com
Subject: [OSSA-2021-002] Nova: Open Redirect in noVNC proxy (CVE-2021-3654)

===========================================
OSSA-2021-002: Open Redirect in noVNC proxy
===========================================

:Date: July 29, 2021
:CVE: CVE-2021-3654

Affects
~~~~~~~
- Nova: <21.2.3, >=22.0.0 <22.2.3, >=23.0.0 <23.0.2

Description
~~~~~~~~~~~
Swe Aung, Shahaan Ayyub, and Salman Khan with the Monash University
Cyber Security team reported a vulnerability affecting Nova's noVNC
proxying implementation which exposed access to a well-known
redirect behavior in the Python standard library's
http.server.SimpleHTTPRequestHandler and thus noVNC's
WebSockifyRequestHandler which uses it. By convincing a user to
follow a specially-crafted novncproxy URL, the user could be
redirected to an unrelated site under control of the attacker in an
attempt to convince them to divulge credentials or other sensitive
data. All Nova deployments with novncproxy enabled are affected.

Patches
~~~~~~~
- <https://review.opendev.org/791807> (Train)
- <https://review.opendev.org/791806> (Ussuri)
- <https://review.opendev.org/791805> (Victoria)
- <https://review.opendev.org/791577> (Wallaby)
- <https://review.opendev.org/791297> (Xena)

Credits
~~~~~~~
- Swe Aung from Monash University Cyber Security team (CVE-2021-3654)
- Shahaan Ayyub from Monash University Cyber Security team (CVE-2021-3654)
- Salman Khan from Monash University Cyber Security team (CVE-2021-3654)

References
~~~~~~~~~~
- <https://launchpad.net/bugs/1927677>
- <https://bugs.python.org/issue32084>
- <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3654>

Notes
~~~~~
- The stable/train branch is under extended maintenance and will
  receive no new point releases, but a patch for it is provided as a
  courtesy.

--
Jeremy Stanley

Download attachment "[signature.asc](2/1)" of type "application/pgp-signature" (964 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from access.redhat.com_e15750ff_20250115_123939.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=-4w8ZDO4DT4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMiUzQTA5ODMifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=-4w8ZDO4DT4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMiUzQTA5ODMifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=-4w8ZDO4DT4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMiUzQTA5ODMifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

©  Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugs.python.org_b5480c95_20250115_123923.html ===

# [homepage](.)

open

all

* [Python Home](https://www.python.org/ "Go to the Python homepage")
* [About](https://www.python.org/about/ "About The Python Language")
* [News](https://www.python.org/blogs/)
* [Documentation](https://www.python.org/doc/)
* [Downloads](https://www.python.org/downloads/)
* [Community](https://www.python.org/community/)
* [Foundation](https://www.python.org/psf/ "Python Software Foundation")
* [Developer's Guide](https://devguide.python.org/ "Python Developer's Guide")
* [Issue Tracker](. "Python Issue Tracker")
  + **Issues**
    - [Search](issue?@template=search&status=1)
    - [Random Issue](issue?@action=random)
  + **Summaries**
    - [Issues with patch](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Issues%20with%20patch&@startwith=0&@group=priority&keywords=2&@action=search&@filter=&@pagesize=50)
    - [Easy issues](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Easy%20issues&@startwith=0&@group=priority&keywords=6&@action=search&@filter=&@pagesize=50)
    - [Stats](issue?@template=stats)
  + **User**
    - Login

      Remember me?
    - [Lost your login?](user?@template=forgotten)
  + **Administration**
    - [User List](user?@sort=username)
    - [Committer List](user?iscommitter=1&@action=search&@sort=username&@pagesize=300)
  + **Help**
    - [Tracker Documentation](http://docs.python.org/devguide/triaging.html)
    - [Tracker Development](http://wiki.python.org/moin/TrackerDevelopment)
    - [Report Tracker Problem](https://github.com/python/psf-infra-meta/issues)

Issue43223

![](@@file/python-logo-small.png)
➜
[![](@@file/gh-icon.png)](https://github.com/python/cpython/issues)

This issue tracker **has been migrated to [GitHub](https://github.com/python/cpython/issues)**,
and is currently **read-only**.

For more information, [see the GitHub FAQs in the Python's Developer Guide.](https://devguide.python.org/gh-faq/ "GitHub FAQs")

[![](@@file/gh-icon.png)

This issue has been migrated to GitHub:
https://github.com/python/cpython/issues/87389](https://github.com/python/cpython/issues/87389)

classification

| [Title](http://docs.python.org/devguide/triaging.html#title): | [security] http.server: Open Redirection if the URL path starts with // | | |
| --- | --- | --- | --- |
| [Type](http://docs.python.org/devguide/triaging.html#type): | security | [Stage](http://docs.python.org/devguide/triaging.html#stage): | patch review |
| [Components](http://docs.python.org/devguide/triaging.html#components): | Library (Lib) | [Versions](http://docs.python.org/devguide/triaging.html#versions): | Python 3.11, Python 3.10, Python 3.9, Python 3.8, Python 3.7, Python 3.6 |

process

| [Status](http://docs.python.org/devguide/triaging.html#status): | open | [Resolution](http://docs.python.org/devguide/triaging.html#resolution): |  |
| --- | --- | --- | --- |
| [Dependencies](http://docs.python.org/devguide/triaging.html#dependencies): |  | [Superseder](http://docs.python.org/devguide/triaging.html#superseder): |  |
| [Assigned To](http://docs.python.org/devguide/triaging.html#assigned-to): |  | [Nosy List](http://docs.python.org/devguide/triaging.html#nosy-list): | christian.heimes, hamzaavvan, lukasz.langa, ned.deily, paul.moore, steve.dower, tim.golden, vstinner, zach.ware |
| [Priority](http://docs.python.org/devguide/triaging.html#priority): | deferred blocker | [Keywords](http://docs.python.org/devguide/triaging.html#keywords): | patch |

Created on **2021-02-14 11:42** by **hamzaavvan**, last changed **2022-04-11 14:59** by **admin**.

| Files | | | | |
| --- | --- | --- | --- | --- |
| File name | Uploaded | Description | Edit |
| [Capture.PNG](file49808/Capture.PNG) | hamzaavvan, 2021-02-14 11:42 |  |  |

| Pull Requests | | | |
| --- | --- | --- | --- |
| URL | Status | Linked | Edit |
| [PR 24848](https://github.com/python/cpython/pull/24848 "bpo-43223: [SECURITY] Patched Open Redirection In SimpleHTTPServer Module") | open | hamzaavvan, 2021-03-13 21:13 |  |

| Repositories containing patches | | | |
| --- | --- | --- | --- |
| <https://github.com/hamzaavvan/cpython/tree/fix-issue-43223> |  |  |  |

| Messages (5) | | | |
| --- | --- | --- | --- |
| [msg386945](#msg386945) - [(view)](msg386945) | Author: Hamza Avvan (hamzaavvan) \* | Date: 2021-02-14 11:42 |
| ``` The provided version of python distros 3.8.7 and 3.7.4 are vulnerable to open redirection while traversing to an existing directory.  # PAYLOAD [http://127.0.0.1:8000//attacker.com/..%2f..%2f..%2f..%2f..%2f../%0a%0d/../.ssh](http://127.0.0.1:8000//attacker.com/../../../../../../%0A%0D/../.ssh)  In this case, the actual path of .ssh was: <http://127.0.0.1:8000/.ssh>  Upon visiting the payload URI the python server will respond back with a Location header instead of serving the directory contents directly which triggers the redirection to attacker.com  Server: SimpleHTTP/0.6 [Python/3.8.7](https://github.com/python/cpython/blob/master/Python/3.8.7) ``` | | | |
| [msg387193](#msg387193) - [(view)](msg387193) | Author: STINNER Victor (vstinner) \* (Python committer) | Date: 2021-02-17 22:26 |
| ``` I can only reproduce the issue if the current directory (directory used by the HTTP server, see --directory command line option) contains a .ssh/ subdirectory.  The problem is that the HTTP Header Location starts with "//domain/" and such URL is interpreted as an absolute URL of a new domain name ("domain"), rather than a relative path of the same domain ("localhost").  Maybe we should simply strip all additional leading slashes to only keep one. Replace "//path" or  "/////path" with "/path" for example.  ---  By the way, http.server uses urllib.parse.urlsplit() on the request URL without passing its own domain, and urllib.parse.urlsplit() interprets "//attacker.com/path" as if attacker.com is a host with no scheme:  >>> urllib.parse.urlsplit('//attacker.com/path') SplitResult(scheme='', netloc='attacker.com', path='/path', query='', fragment='')  Maybe parse_qs() should be used instead? Or we should reinject the server domain and port number? I am not sure that it's an issue in practice.  SimpleHTTPRequestHandler.translate_path('//attacker.com/..%2f..%2f..%2f..%2f..%2f../.ssh') returns os.path.join(self.directory, ".ssh"). I don't think that it's an issue, it sounds like the expected behavior. We don't attempt to reject ".." in URL.  ---  To reproduce the issue, I used two terminals.  Terminal 1:  $ python3.8 -V Python 3.8.7 $ python3.8 -m http.server Serving HTTP on 0.0.0.0 port 8000 (<http://0.0.0.0:8000/>) ... 127.0.0.1 - - [15/Feb/2021 09:18:20] "GET //attacker.com/..%2f..%2f..%2f..%2f..%2f../.ssh HTTP/1.1" 301 -  Terminal 2:  $ wget '[http://127.0.0.1:8000//attacker.com/..%2f..%2f..%2f..%2f..%2f../.ssh](http://127.0.0.1:8000//attacker.com/../../../../../../.ssh)' (...) HTTP request sent, awaiting response... 301 Moved Permanently Location: //attacker.com/..%2f..%2f..%2f..%2f..%2f../.ssh/ [following]  --2021-02-15 09:18:20--  [http://attacker.com/..%2f..%2f..%2f..%2f..%2f../.ssh/](http://attacker.com/../../../../../../.ssh/) Resolving attacker.com (attacker.com)... 45.88.202.115 Connecting to attacker.com (attacker.com)|45.88.202.115|:80... connected.  (...)  wget is redirected and connects to attacker.com.  The HTTP redirection comes from [Lib/http/server.py](https://github.com/python/cpython/blob/master/Lib/http/server.py):      def send_head(self):         path = self.translate_path(self.path)         f = None         if os.path.isdir(path):             parts = urllib.parse.urlsplit(self.path)             if not parts.path.endswith('/'):                 # redirect browser - doing basically what apache does                 self.send_response(HTTPStatus.MOVED_PERMANENTLY)                 new_parts = (parts[0], parts[1], parts[2] + '/',                              parts[3], parts[4])                 new_url = urllib.parse.urlunsplit(new_parts)                 self.send_header("Location", new_url)                 self.end_headers()                 return None             ...         ...  The problem is that the "Location" header starts with "//". ``` | | | |
| [msg387284](#msg387284) - [(view)](msg387284) | Author: Hamza Avvan (hamzaavvan) \* | Date: 2021-02-19 05:59 |
| ``` As for the directory issue, not only .ssh but an attacker can use any directory to make the open redirection exploitable.  And as for the HTTP Header Location, the server does not remove extra trailing slash from the PAYLOAD uri, which seems to be the cause of vulnerability getting exploited.  [http://127.0.0.1:8000//attacker.com/..%2f..%2f..%2f..%2f..%2f../%0a%0d/../.ssh](http://127.0.0.1:8000//attacker.com/../../../../../../%0A%0D/../.ssh)  So I believe the server should check for multiple slashes and remove them from the path.   Additionally, as you've mentioned it should also prepend the host:port/ to the new_url variable before writing the HTTP Header Location because if an attacker bypasses the protection and add an extra slash the server will still redirect to the host which is getting inserted into the Location header. But honestly I need your opinion as concatenating host to the url may lead to Host Header Injection but it'll then require a different context.  Please watch the POC video. POC Video: <https://youtu.be/rLfOoEu1XXg> ``` | | | |
| [msg390047](#msg390047) - [(view)](msg390047) | Author: Łukasz Langa (lukasz.langa) \* (Python committer) | Date: 2021-04-02 09:35 |
| ``` Deferred the blocker to a regular release due to lack of activity in time for the current expedited releases. ``` | | | |
| [msg394193](#msg394193) - [(view)](msg394193) | Author: Hamza Avvan (hamzaavvan) \* | Date: 2021-05-23 08:10 |
| ``` Requested review for the unit test few days ago. Please check. <https://github.com/python/cpython/pull/24848> ``` | | | |

| History | | | |
| --- | --- | --- | --- |
| Date | User | Action | Args |
| 2022-04-11 14:59:41 | admin | set | github: 87389 |
| 2021-05-23 08:10:57 | hamzaavvan | set | messages: + <msg394193> |
| 2021-05-21 23:10:46 | ned.deily | link | [issue32084 superseder](issue32084) |
| 2021-05-18 09:24:46 | kj | set | type: crash -> securitytitle: [security] http.server: Open Redirection if the URL path starts with //racha999coperation -> [security] http.server: Open Redirection if the URL path starts with // |
| 2021-05-18 09:15:07 | azura9999999999 | set | versions: + Python 3.11type: security -> crashtitle: [security] http.server: Open Redirection if the URL path starts with // -> [security] http.server: Open Redirection if the URL path starts with //racha999coperation |
| 2021-04-02 09:35:23 | lukasz.langa | set | priority: release blocker -> deferred blockermessages: + <msg390047> |
| 2021-03-31 19:59:03 | christian.heimes | set | priority: normal -> release blockernosy: + [christian.heimes](user3108), [ned.deily](user5248), [lukasz.langa](user12704) |
| 2021-03-15 12:51:31 | hamzaavvan | set | hgrepos: + hgrepo404 |
| 2021-03-13 21:13:55 | hamzaavvan | set | keywords: + [patch](keyword2)stage: patch reviewpull\_requests: + <pull_request23609> |
| 2021-02-19 05:59:56 | hamzaavvan | set | messages: + <msg387284> |
| 2021-02-17 22:27:18 | vstinner | set | title: [SECURITY] Open Redirection In Python 3.7 & 3.8 -> [security] http.server: Open Redirection if the URL path starts with //components: + Library (Lib), - Windowsversions: + Python 3.6, Python 3.9, Python 3.10 |
| 2021-02-17 22:26:33 | vstinner | set | nosy: + [vstinner](user2377)messages: + <msg387193> |
| 2021-02-15 12:50:46 | hamzaavvan | set | title: Open Redirection In Python 3.7 & 3.8 -> [SECURITY] Open Redirection In Python 3.7 & 3.8 |
| 2021-02-14 11:42:36 | hamzaavvan | create |  |

Supported by [The Python Software Foundation](https://python.org/psf-landing/ "The Python Software Foundation"),

Powered by [Roundup](http://roundup.sourceforge.net "Powered by the Roundup Issue Tracker")

Copyright © 1990-2022, [Python Software Foundation](http://python.org/psf)



=== Content from bugzilla.redhat.com_9caa6aa8_20250115_194629.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1968735)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1968735)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1968735)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1968735

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1968735**](show_bug.cgi?id=1968735)
- [OSP16.2][neutron]http\_retries config option value not being used for calls to the port binding API

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
[OSP16.2][neutron]http\_retries config option value not being used for calls t...

| | [Keywords](describekeywords.cgi): | Triaged | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-nova | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 16.2 (Train) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | z2 | | [Target Release](page.cgi?id=fields.html#target_release): | 16.2 (Train on RHEL 8.4) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | melanie witt | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | James Parker | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1968722](show_bug.cgi?id=1968722 "CLOSED MIGRATED - [OSP18][neutron]http_retries config option value not being used for calls to the port binding API") [1968723](show_bug.cgi?id=1968723 "CLOSED ERRATA - [OSP17][neutron]http_retries config option value not being used for calls to the port binding API") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1955031](show_bug.cgi?id=1955031 "CLOSED ERRATA - [neutron]http_retries config option value not being used for calls to the port binding API") [1968747](show_bug.cgi?id=1968747 "CLOSED DUPLICATE - [OSP16.1][neutron]http_retries config option value not being used for calls to the port binding API") | | TreeView+ | [depends on](buglist.cgi?bug_id=1968735&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1968735&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-06-07 21:17 UTC by melanie witt | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-03-23 22:10 UTC ([History](show_activity.cgi?id=1968735)) | | [CC List:](page.cgi?id=fields.html#cclist) | 16 users (show)  averi dasmith eglynn ffernand jhakimra jlibosva jparker kchamart lyarwood mwitt nova-maint sbauza sgordon skaplons stephenfin vromanso | | Fixed In Version: | openstack-nova-20.6.2-2.20210616134809.b095ed1 | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: | [1968723](show_bug.cgi?id=1968723 "CLOSED ERRATA - [OSP17][neutron]http_retries config option value not being used for calls to the port binding API") | | | Clones: | [1968747](show_bug.cgi?id=1968747 "CLOSED DUPLICATE - [OSP16.1][neutron]http_retries config option value not being used for calls to the port binding API")  ([view as bug list](buglist.cgi?bug_id=1968747)) | | | Environment: |  | | | Last Closed: | 2022-03-23 22:10:09 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Launchpad | [1929886](https://bugs.launchpad.net/bugs/1929886) | 0 | None | Closed | [BZ] Several RHEL 8 delivered /usr/lib/tmpfile.d/\*.conf files still reference legacy directory /var/run | 2022-05-19 15:56:51 UTC | | OpenStack gerrit | [795177](https://review.opendev.org/795177) | 0 | None | NEW | Honor [neutron]http\_retries in the manual client | 2022-03-15 14:11:56 UTC | | Red Hat Issue Tracker | [OSP-4434](https://issues.redhat.com/browse/OSP-4434) | 0 | None | None | None | 2022-01-28 15:48:04 UTC | | Red Hat Product Errata | [RHBA-2022:1001](https://access.redhat.com/errata/RHBA-2022%3A1001) | 0 | None | None | None | 2022-03-23 22:10:45 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Comment 16](show_bug.cgi?id=1968735#c16)  errata-xmlrpc    2022-03-23 22:10:09 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory (Release of components for Red Hat OpenStack Platform 16.2.2), and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  [https://access.redhat.com/errata/RHBA-2022:1001](https://access.redhat.com/errata/RHBA-2022%3A1001)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1968735&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from review.opendev.org_1a61f08b_20250115_194548.html ===




=== Content from access.redhat.com_0f1fc901_20250115_123922.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_691506f6_20250115_194630.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1961439)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1961439)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1961439)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1961439

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1961439**](show_bug.cgi?id=1961439)
(CVE-2021-3654)
- [CVE-2021-3654](https://access.redhat.com/security/cve/CVE-2021-3654) openstack-nova: novnc allows open redirection

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2021-3654 openstack-nova: novnc allows open redirection

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2021-3654 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1961446](show_bug.cgi?id=1961446 "NEW - CVE-2021-3654 openstack-nova: novnc allows open redirection [openstack-rdo]") [1961346](show_bug.cgi?id=1961346) [1961351](show_bug.cgi?id=1961351) [1961445](show_bug.cgi?id=1961445) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1960387](show_bug.cgi?id=1960387) [1983989](show_bug.cgi?id=1983989) | | TreeView+ | [depends on](buglist.cgi?bug_id=1961439&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1961439&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-05-17 23:54 UTC by Summer Long | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2022-03-24 13:44 UTC ([History](show_activity.cgi?id=1961439)) | | [CC List:](page.cgi?id=fields.html#cclist) | 16 users (show)  dasmith eglynn jhakimra jjoyce jschluet kchamart lhh lpeer mburns nova-maint sbauza sclewis seunlee sgordon slinaber vromanso | | Fixed In Version: | nova 21.2.3, nova 22.3.0, nova 23.1.0 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A vulnerability was found in CPython which is used by openstack-nova's console proxy, noVNC. By crafting a malicious URL, noVNC could be made to redirect to any desired URL. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2022-03-24 13:44:59 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2022:0983](https://access.redhat.com/errata/RHSA-2022%3A0983) | 0 | None | None | None | 2022-03-24 11:03:45 UTC | | Red Hat Product Errata | [RHSA-2022:0999](https://access.redhat.com/errata/RHSA-2022%3A0999) | 0 | None | None | None | 2022-03-23 22:26:45 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1961439#c0)  Summer Long    2021-05-17 23:54:48 UTC  ``` novnc allows open redirection, which could allow phishing attempts. Risk: By modifying untrusted URL input to a malicious site, an attacker may successfully launch a phishing scam and steal user credentials. Because the server name in the modified link is identical to the original site, phishing attempts could have a more trustworthy appearance.  [https://bugs.launchpad.net/nova/+bug/1927677](https://bugs.launchpad.net/nova/%2Bbug/1927677)   ```  [Comment 4](show_bug.cgi?id=1961439#c4)  Summer Long    2021-05-18 00:15:45 UTC  ``` Created openstack-nova tracking bugs for this issue:  Affects: openstack-rdo [[bug 1961446](show_bug.cgi?id=1961446 "NEW - CVE-2021-3654 openstack-nova: novnc allows open redirection [openstack-rdo]")]   ```  [Comment 10](show_bug.cgi?id=1961439#c10)  Summer Long    2021-11-01 22:38:05 UTC  ``` Initial OSSA now out of date: <https://security.openstack.org/ossa/OSSA-2021-002.html> Upstream fixes have been released: 21.2.3, 22.3.0, and 23.1.0 together with two additional stable-train commits:  * <https://opendev.org/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66> * <https://opendev.org/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb>   ```  [Comment 11](show_bug.cgi?id=1961439#c11)  Nick Tait    2022-03-09 21:23:39 UTC  ``` Additional references: <https://bugs.python.org/issue43223> <https://github.com/python/cpython/pull/24848>   ```  [Comment 12](show_bug.cgi?id=1961439#c12)  errata-xmlrpc    2022-03-23 22:26:42 UTC  ``` This issue has been addressed in the following products:    Red Hat OpenStack Platform 16.2  Via RHSA-2022:0999 [https://access.redhat.com/errata/RHSA-2022:0999](https://access.redhat.com/errata/RHSA-2022%3A0999)   ```  [Comment 13](show_bug.cgi?id=1961439#c13)  errata-xmlrpc    2022-03-24 11:03:42 UTC  ``` This issue has been addressed in the following products:    Red Hat OpenStack Platform 16.1  Via RHSA-2022:0983 [https://access.redhat.com/errata/RHSA-2022:0983](https://access.redhat.com/errata/RHSA-2022%3A0983)   ```  [Comment 14](show_bug.cgi?id=1961439#c14)  Product Security DevOps Team    2022-03-24 13:44:57 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2021-3654>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1961439&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from review.opendev.org_8af722c8_20250115_194623.html ===




=== Content from opendev.org_70a27e34_20250115_123946.html ===

This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

[openstack](/openstack)/[nova](/openstack/nova)

[Code](/openstack/nova/src/branch/master)
[Issues](https://bugs.launchpad.net/nova)
[Proposed changes](https://review.opendev.org/#/q/status:open+project:openstack/nova)

### Reject open redirection in the console proxy

[Browse Source](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66)

```
NOTE(melwitt): This is the combination of two commits, the bug fix and
a followup change to the unit test to enable it also run on
Python < 3.6.

Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:

  [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments
[2].

Closes-Bug: [#1927677](https://bugs.launchpad.net/nova/%2Bbug/1927677)

[1] <https://bugs.python.org/issue32084>
[2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:
    nova/tests/unit/console/test_websocketproxy.py

NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train.

NOTE(melwitt): The difference from the cherry picked change:
HTTPStatus.BAD_REQUEST => 400 is due to the fact that HTTPStatus does
not exist in Python 2.7.

Reduce mocking in test_reject_open_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].

This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: [#1927677](https://bugs.launchpad.net/nova/%2Bbug/1927677)

[1] [34eeed4290](https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286)

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit [214cabe684](/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af))
(cherry picked from commit [9c2f297837](/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1))
(cherry picked from commit [94e265f3ca](/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709))
(cherry picked from commit [d43b88a334](/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f))

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit [781612b332](/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e))
(cherry picked from commit [4709256142](/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70))
(cherry picked from commit [6b70350bdc](/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b))
(cherry picked from commit [719e651e6b](/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b))
```
...

This commit is contained in:

![](/assets/img/avatar_default.png "melwittt@gmail.com")
parent
[f1be212a86](/openstack/nova/commit/f1be212a86262f128e73f7201b7b3e51334f1ab4)

commit
04d48527b6

 **3 changed files** with **74 additions** and **0 deletions**

[Show all changes](?style=unified&whitespace=show-all&show-outdated=)
[Ignore whitespace when comparing lines](?style=unified&whitespace=ignore-all&show-outdated=)
[Ignore changes in amount of whitespace](?style=unified&whitespace=ignore-change&show-outdated=)
[Ignore changes in whitespace at EOL](?style=unified&whitespace=ignore-eol&show-outdated=)

Show Stats
[Download Patch File](/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66.patch)
[Download Diff File](/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66.diff)
Expand all files
Collapse all files

#### 22 [nova/console/websocketproxy.py](#diff-b9d2ad00e05a6d9d14cdb8059d611043b602b37d "nova/console/websocketproxy.py") Unescape Escape [View File](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66/nova/console/websocketproxy.py)

|  | |  |  | `@ -19,6 +19,7 @@ Leverages websockify.py by Joel Martin` |
|  |  |  |  | `'''` |
|  |  |  |  |  |
|  |  |  |  | `import copy` |
|  |  |  |  | `import os` |
|  |  |  |  | `import socket` |
|  |  |  |  | `import sys` |
|  |  |  |  |  |
|  | |  |  | `@ -305,6 +306,27 @@ class NovaProxyRequestHandler(NovaProxyRequestHandlerBase,` |
|  |  |  |  | `# Fall back to the websockify <= v0.8.0 'socket' method location.` |
|  |  |  |  | `return websockify.WebSocketServer.socket(*args, **kwargs)` |
|  |  |  |  |  |
|  |  |  |  | `def send_head(self):` |
|  |  |  |  | `# This code is copied from this example patch:` |
|  |  |  |  | `# https://bugs.python.org/issue32084#msg306545` |
|  |  |  |  | `path = self.translate_path(self.path)` |
|  |  |  |  | `if os.path.isdir(path):` |
|  |  |  |  | `parts = urlparse.urlsplit(self.path)` |
|  |  |  |  | `if not parts.path.endswith('/'):` |
|  |  |  |  | `# redirect browser - doing basically what apache does` |
|  |  |  |  | `new_parts = (parts[0], parts[1], parts[2] + '/',` |
|  |  |  |  | `parts[3], parts[4])` |
|  |  |  |  | `new_url = urlparse.urlunsplit(new_parts)` |
|  |  |  |  |  |
|  |  |  |  | `# Browsers interpret "Location: //uri" as an absolute URI` |
|  |  |  |  | `# like "http://URI"` |
|  |  |  |  | `if new_url.startswith('//'):` |
|  |  |  |  | `self.send_error(400,` |
|  |  |  |  | `"URI must not start with //")` |
|  |  |  |  | `return None` |
|  |  |  |  |  |
|  |  |  |  | `return super(NovaProxyRequestHandler, self).send_head()` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `class NovaWebSocketProxy(websockify.WebSocketProxy):` |
|  |  |  |  | `def __init__(self, *args, **kwargs):` |
|  | |  |  |  |

#### 33 [nova/tests/unit/console/test\_websocketproxy.py](#diff-f629feecbacc0045cac65cca99e64f6dfdbe5e76 "nova/tests/unit/console/test_websocketproxy.py") Unescape Escape [View File](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66/nova/tests/unit/console/test_websocketproxy.py)

|  | |  |  | `@ -15,6 +15,7 @@` |
|  |  |  |  | `"""Tests for nova websocketproxy."""` |
|  |  |  |  |  |
|  |  |  |  | `import copy` |
|  |  |  |  | `import io` |
|  |  |  |  | `import socket` |
|  |  |  |  |  |
|  |  |  |  | `import mock` |
|  | |  |  | `@ -626,6 +627,38 @@ class NovaProxyRequestHandlerBaseTestCase(test.NoDBTestCase):` |
|  |  |  |  | `self.wh.server.top_new_client(conn, address)` |
|  |  |  |  | `self.assertIsNone(self.wh._compute_rpcapi)` |
|  |  |  |  |  |
|  |  |  |  | `def test_reject_open_redirect(self):` |
|  |  |  |  | `# This will test the behavior when an attempt is made to cause an open` |
|  |  |  |  | `# redirect. It should be rejected.` |
|  |  |  |  | `mock_req = mock.MagicMock()` |
|  |  |  |  | `mock_req.makefile().readline.side_effect = [` |
|  |  |  |  | `b'GET //example.com/%2F.. HTTP/1.1\r\n',` |
|  |  |  |  | `b''` |
|  |  |  |  | `]` |
|  |  |  |  |  |
|  |  |  |  | `client_addr = ('8.8.8.8', 54321)` |
|  |  |  |  | `mock_server = mock.MagicMock()` |
|  |  |  |  | `# This specifies that the server will be able to handle requests other` |
|  |  |  |  | `# than only websockets.` |
|  |  |  |  | `mock_server.only_upgrade = False` |
|  |  |  |  |  |
|  |  |  |  | `# Constructing a handler will process the mock_req request passed in.` |
|  |  |  |  | `handler = websocketproxy.NovaProxyRequestHandler(` |
|  |  |  |  | `mock_req, client_addr, mock_server)` |
|  |  |  |  |  |
|  |  |  |  | `# Collect the response data to verify at the end. The` |
|  |  |  |  | `# SimpleHTTPRequestHandler writes the response data to a 'wfile'` |
|  |  |  |  | `# attribute.` |
|  |  |  |  | `output = io.BytesIO()` |
|  |  |  |  | `handler.wfile = output` |
|  |  |  |  | `# Process the mock_req again to do the capture.` |
|  |  |  |  | `handler.do_GET()` |
|  |  |  |  | `output.seek(0)` |
|  |  |  |  | `result = output.readlines()` |
|  |  |  |  |  |
|  |  |  |  | `# Verify no redirect happens and instead a 400 Bad Request is returned.` |
|  |  |  |  | `self.assertIn('400 URI must not start with //', result[0].decode())` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `class NovaWebsocketSecurityProxyTestCase(test.NoDBTestCase):` |
|  |  |  |  |  |
|  | |  |  |  |

#### 19 [releasenotes/notes/console-proxy-reject-open-redirect-4ac0a7895acca7eb.yaml](#diff-e5d9ff045dfe47fe4a0b246703a6e3df8133ed8e "releasenotes/notes/console-proxy-reject-open-redirect-4ac0a7895acca7eb.yaml") Normal file Unescape Escape [View File](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66/releasenotes/notes/console-proxy-reject-open-redirect-4ac0a7895acca7eb.yaml)

|  | |  |  | `@ -0,0 +1,19 @@` |
|  |  |  |  | `---` |
|  |  |  |  | `security:` |
|  |  |  |  | `- |` |
|  |  |  |  | `A vulnerability in the console proxies (novnc, serial, spice) that allowed` |
|  |  |  |  | `open redirection has been `patched`_. The novnc, serial, and spice console` |
|  |  |  |  | `proxies are implemented as websockify servers and the request handler` |
|  |  |  |  | `inherits from the python standard SimpleHTTPRequestHandler. There is a` |
|  |  |  |  | ``known issue`_ in the SimpleHTTPRequestHandler which allows open redirects` |
|  |  |  |  | `by way of URLs in the following format::` |
|  |  |  |  |  |
|  |  |  |  | `http://vncproxy.my.domain.com//example.com/%2F..` |
|  |  |  |  |  |
|  |  |  |  | `which if visited, will redirect a user to example.com.` |
|  |  |  |  |  |
|  |  |  |  | `The novnc, serial, and spice console proxies will now reject requests that` |
|  |  |  |  | `pass a redirection URL beginning with "//" with a 400 Bad Request.` |
|  |  |  |  |  |
|  |  |  |  | `.. _patched: https://bugs.launchpad.net/nova/+bug/1927677` |
|  |  |  |  | `.. _known issue: https://bugs.python.org/issue32084` |

Write
Preview

Loading…

Cancel
Save

Reference in New Issue

**Repository**
openstack/nova

**Title**

**Body**

Create Issue

Block a user
Blocking a user prevents them from interacting with repositories, such as opening or commenting on pull requests or issues. Learn more about blocking a user.

User to block:

Optional note:

The note is not visible to the blocked user.

Cancel
Block

[Powered by Gitea](https://about.gitea.com)
Version:
v1.22.6
Page: **4539ms**
Template: **198ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)



=== Content from github.com_5922db98_20250115_123933.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F24848)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F24848)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.9k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# bpo-43223: [SECURITY] Patched Open Redirection In SimpleHTTPServer Module #24848

 Closed

[hamzaavvan](/hamzaavvan)
wants to merge
1
commit into
[python:main](/python/cpython/tree/main "python/cpython:main")
from
[hamzaavvan:fix-issue-43223](/hamzaavvan/cpython/tree/fix-issue-43223 "hamzaavvan/cpython:fix-issue-43223")

 Closed

# [bpo-43223: [SECURITY] Patched Open Redirection In SimpleHTTPServer Module](#top) #24848

[hamzaavvan](/hamzaavvan)
wants to merge
1
commit into
[python:main](/python/cpython/tree/main "python/cpython:main")
from
[hamzaavvan:fix-issue-43223](/hamzaavvan/cpython/tree/fix-issue-43223 "hamzaavvan/cpython:fix-issue-43223")

[Conversation
25](/python/cpython/pull/24848)
[Commits
1](/python/cpython/pull/24848/commits)
[Checks
0](/python/cpython/pull/24848/checks)
[Files changed](/python/cpython/pull/24848/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=60&v=4)](/hamzaavvan)

Copy link

### @hamzaavvan **[hamzaavvan](/hamzaavvan)** commented [Mar 13, 2021](#issue-830997167) • edited Loading

Due to no protection against multiple (/) at the beginning of a url an attacker could achieve an open redirection by crafting a malformed URI followed by an existing directory.

Payload: `http://127.0.0.1:8000//attacker.com/..%2f..%2f../anyexistingdirectory`

The main reason behind open redirection is that there's no (/) at the end of `anyexistingdirectory` because the server is checking for the path supplied is a valid directory at `send_head()` method from [Lib/http/server.py](https://github.com/hamzaavvan/cpython/blob/master/Lib/http/server.py#L683). Right after that, it's checking for the path ending with a (/) or not. So, if there's no (/) at the end of the path then the server will issue a Location header to redirect the web client to that specific directory.

While issuing the redirection, this part `//attacker.com/..%2f..%2f../anyexistingdirectory` will be sent to the Location header's value due to which any web client or browser will consider it as a new url because of multiple (/) at the beginning of the path.

So to mitigate this issue I decided to use regex to replace all the occurrences of (/) from the beginning of the path.

```
 self.path = re.sub(r'(^(/|\\)+)', '/', self.path)
```

This regex will replace multiple entries (if present) of (/) or (\) from the beginning of the path. So that the path would be:

1. //attacker.com/..%2f..%2f../anyexistingdirectory **->** /attacker.com/..%2f..%2f../anyexistingdirectory
2. //\attacker.com/..%2f..%2f../anyexistingdirectory **->** /attacker.com/..%2f..%2f../anyexistingdirectory
3. \//\attacker.com/..%2f..%2f../anyexistingdirectory **->** /attacker.com/..%2f..%2f../anyexistingdirectory

And according to these test cases there was no redirection issued from the server after implementing the fix.

<https://bugs.python.org/issue43223>

Sorry, something went wrong.

All reactions

[![@the-knights-who-say-ni](https://avatars.githubusercontent.com/u/18121554?s=40&u=7f27f578976be995d20742716898b8de1a340824&v=4)](/the-knights-who-say-ni)
[the-knights-who-say-ni](/the-knights-who-say-ni)
added
the
[CLA signed](/python/cpython/labels/CLA%20signed)
label
[Mar 13, 2021](#event-4454558576)

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
added
the
[awaiting review](/python/cpython/labels/awaiting%20review)
label
[Mar 13, 2021](#event-4454558642)

[![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=40&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)
[hamzaavvan](/hamzaavvan)
changed the title
~~bpo-43223: Patched Open Redirection In SimpleHTTPServer Module~~
bpo-43223: [SECURITY] Patched Open Redirection In SimpleHTTPServer Module
[Mar 13, 2021](#event-4454599165)

[![vstinner](https://avatars.githubusercontent.com/u/194129?s=60&v=4)](/vstinner)

**[vstinner](/vstinner)**
reviewed
[Mar 16, 2021](#pullrequestreview-613006453)

 [View reviewed changes](/python/cpython/pull/24848/files)

[Lib/http/server.py](/python/cpython/pull/24848/files#diff-10e6db6c775e351ba2b55c4ad5e177191afe25d4942d1d2162d6e10505788a81)
Outdated

Show resolved

Hide resolved

[Misc/NEWS.d/next/Security/2021-03-13-21-25-29.bpo-43223.ieBVWq.rst](/python/cpython/pull/24848/files#diff-17086c46337214143affec0d66ebf01d305537d07c42874b6c9e413e3467fff0)
Outdated

Show resolved

Hide resolved

 [![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=40&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)
[hamzaavvan](/hamzaavvan)
[force-pushed](/python/cpython/compare/e2137b64b7f9a503ee58f3ffae103f55f0926c6e..403490c95498f8085b12f518901d0f38abad0a1e)
the
fix-issue-43223

branch
2 times, most recently
from
[`e2137b6`](/python/cpython/commit/e2137b64b7f9a503ee58f3ffae103f55f0926c6e) to
[`403490c`](/python/cpython/commit/403490c95498f8085b12f518901d0f38abad0a1e)  [Compare](/python/cpython/compare/e2137b64b7f9a503ee58f3ffae103f55f0926c6e..403490c95498f8085b12f518901d0f38abad0a1e)
[March 16, 2021 17:42](#event-4466031250)

[![vstinner](https://avatars.githubusercontent.com/u/194129?s=60&v=4)](/vstinner)

**[vstinner](/vstinner)**
reviewed
[Mar 16, 2021](#pullrequestreview-613546891)

 [View reviewed changes](/python/cpython/pull/24848/files)

[Lib/http/server.py](/python/cpython/pull/24848/files#diff-10e6db6c775e351ba2b55c4ad5e177191afe25d4942d1d2162d6e10505788a81)
Outdated

Show resolved

Hide resolved

 [![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=40&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)
[hamzaavvan](/hamzaavvan)
[force-pushed](/python/cpython/compare/f61138a19bbc99c1c92f12dc7e366fdf493afae3..0fe6eed31f657b0dde1b804529cc99b1e6ed3682)
the
fix-issue-43223

branch
3 times, most recently
from
[`f61138a`](/python/cpython/commit/f61138a19bbc99c1c92f12dc7e366fdf493afae3) to
[`0fe6eed`](/python/cpython/commit/0fe6eed31f657b0dde1b804529cc99b1e6ed3682)  [Compare](/python/cpython/compare/f61138a19bbc99c1c92f12dc7e366fdf493afae3..0fe6eed31f657b0dde1b804529cc99b1e6ed3682)
[March 16, 2021 18:09](#event-4466163229)

[![vstinner](https://avatars.githubusercontent.com/u/194129?s=60&v=4)](/vstinner)

**[vstinner](/vstinner)**
reviewed
[Mar 18, 2021](#pullrequestreview-615648928)

 [View reviewed changes](/python/cpython/pull/24848/files)

Copy link

Member

### @vstinner **[vstinner](/vstinner)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Can you please try to write an unit test?

Sorry, something went wrong.

All reactions

[Lib/http/server.py](/python/cpython/pull/24848/files#diff-10e6db6c775e351ba2b55c4ad5e177191afe25d4942d1d2162d6e10505788a81)
Outdated

Show resolved

Hide resolved

[Lib/http/server.py](/python/cpython/pull/24848/files#diff-10e6db6c775e351ba2b55c4ad5e177191afe25d4942d1d2162d6e10505788a81)
Outdated

Show resolved

Hide resolved

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=80&v=4)](/apps/github-actions)

Copy link

### **[github-actions](/apps/github-actions) bot** commented [Apr 18, 2021](#issuecomment-821906024)

| This PR is stale because it has been open for 30 days with no activity. |
| --- |

All reactions

Sorry, something went wrong.

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
added
the
[stale](/python/cpython/labels/stale)
Stale PR or inactive for long period of time.
label
[Apr 18, 2021](#event-4608503464)

[![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=80&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)

Copy link

Author

### **[hamzaavvan](/hamzaavvan)** commented [May 6, 2021](#issuecomment-833485455)

| Sorry I was busy with my other projects. Will be pushing the test case shortly. |
| --- |

All reactions

Sorry, something went wrong.

 [![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=40&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)
[hamzaavvan](/hamzaavvan)
[force-pushed](/python/cpython/compare/0fe6eed31f657b0dde1b804529cc99b1e6ed3682..3717f3fee0420ce7dd3f9995650b244f5daa622d)
the
fix-issue-43223

branch
from
[`0fe6eed`](/python/cpython/commit/0fe6eed31f657b0dde1b804529cc99b1e6ed3682) to
[`3717f3f`](/python/cpython/commit/3717f3fee0420ce7dd3f9995650b244f5daa622d)  [Compare](/python/cpython/compare/0fe6eed31f657b0dde1b804529cc99b1e6ed3682..3717f3fee0420ce7dd3f9995650b244f5daa622d)
[May 6, 2021 12:34](#event-4694892580)

[![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=80&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)

Copy link

Author

### **[hamzaavvan](/hamzaavvan)** commented [May 6, 2021](#issuecomment-833487102)

| Since I'm new to writing test cases, please help me in correcting the code if something went wrong. |
| --- |

All reactions

Sorry, something went wrong.

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
removed
the
[stale](/python/cpython/labels/stale)
Stale PR or inactive for long period of time.
label
[May 7, 2021](#event-4698558248)

[![ned-deily](https://avatars.githubusercontent.com/u/5833005?s=60&v=4)](/ned-deily)

**[ned-deily](/ned-deily)**
reviewed
[May 7, 2021](#pullrequestreview-654800893)

 [View reviewed changes](/python/cpython/pull/24848/files)

[Misc/NEWS.d/next/Security/2021-03-13-21-25-29.bpo-43223.ieBVWq.rst](/python/cpython/pull/24848/files#diff-17086c46337214143affec0d66ebf01d305537d07c42874b6c9e413e3467fff0)
Outdated

Show resolved

Hide resolved

[![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=40&v=4)](/hamzaavvan)

`[bpo-43223: Fix Open Redirection In http.server module](/python/cpython/pull/24848/commits/42eb552059eb1ec9df7f71c7c8dd8e6597640a93 "bpo-43223: Fix Open Redirection In http.server module

Fix an open redirection vulnerability in the HTTP server when a URL contains ``//``.
Added test case for bpo-43223 patch")`
 …

`[42eb552](/python/cpython/pull/24848/commits/42eb552059eb1ec9df7f71c7c8dd8e6597640a93)`

```
Fix an open redirection vulnerability in the HTTP server when a URL contains ``//``.
Added test case for bpo-43223 patch
```

 [![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=40&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)
[hamzaavvan](/hamzaavvan)
[force-pushed](/python/cpython/compare/3717f3fee0420ce7dd3f9995650b244f5daa622d..42eb552059eb1ec9df7f71c7c8dd8e6597640a93)
the
fix-issue-43223

branch
from
[`3717f3f`](/python/cpython/commit/3717f3fee0420ce7dd3f9995650b244f5daa622d) to
[`42eb552`](/python/cpython/commit/42eb552059eb1ec9df7f71c7c8dd8e6597640a93)  [Compare](/python/cpython/compare/3717f3fee0420ce7dd3f9995650b244f5daa622d..42eb552059eb1ec9df7f71c7c8dd8e6597640a93)
[May 7, 2021 22:59](#event-4705099926)

 [![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=40&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)
[hamzaavvan](/hamzaavvan)
requested review from
[vstinner](/vstinner) and
[ned-deily](/ned-deily)
[May 8, 2021 14:32](#event-4707923301)

 [![@ned-deily](https://avatars.githubusercontent.com/u/5833005?s=40&u=ced74489e7860ea51ecfac9c8119e72037aed495&v=4)](/ned-deily)
[ned-deily](/ned-deily)
removed their request for review
[May 21, 2021 22:03](#event-4781511107)

[![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=80&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)

Copy link

Author

### **[hamzaavvan](/hamzaavvan)** commented [Jun 6, 2021](#issuecomment-855387726)

| [@vstinner](https://github.com/vstinner) please have a look at the unit test. |
| --- |

All reactions

Sorry, something went wrong.

[![ambv](https://avatars.githubusercontent.com/u/55281?s=60&v=4)](/ambv)

**[ambv](/ambv)**
requested changes
[Jul 12, 2021](#pullrequestreview-704020124)

 [View reviewed changes](/python/cpython/pull/24848/files/42eb552059eb1ec9df7f71c7c8dd8e6597640a93)

[Lib/test/test\_http/test\_http.py](/python/cpython/pull/24848/files/42eb552059eb1ec9df7f71c7c8dd8e6597640a93#diff-40e58fedee6027b048fc43bd0d76000d481b74249dee6f9f67ec0bbcfdf89a94)

|  |  |  |
| --- | --- | --- |
|  |  | def test\_http\_parse\_request(self): |
|  |  | self.assertEqual(re.sub(r'^/+', '/', '//test.com'), '/test.com', '//test.com should be converted to a proper relative path') |
|  |  | self.assertEqual(re.sub(r'^/+', '/', '///test.com'), '/test.com', '///test.com should be converted to a proper relative path') |

Copy link

Contributor

### @ambv **[ambv](/ambv)** [Jul 12, 2021](#discussion_r667861818)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This doesn't test anything useful. It only checks that some regular expression matches two strings. Since your code change is in `http.server`, your test should execute the `http.server` path that you changed.

A good test should fail without your code change to `http.server`, and pass with your change.

Sorry, something went wrong.

 👍
2
 merwok and 14NC reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Copy link

Author

### @hamzaavvan **[hamzaavvan](/hamzaavvan)** [Aug 21, 2021](#discussion_r693323447) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Sorry I've been away due to my workload. But now as I've got some spare time I can do it better. As I've already said earlier that I'm new to writing these test cases and after checking out your comment I'm still confused about your requirements

Can you please elaborate these two statements:

> Since your code change is in http.server, your test should execute the http.server path that you changed.

and this one:

> A good test should fail without your code change to http.server, and pass with your change.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @ambv **[ambv](/ambv)** [Aug 29, 2021](#discussion_r697993223)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@hamzaavvan](https://github.com/hamzaavvan), to put it in the simplest terms:

* on a clean checkout of the `main` branch, write a test that fails because it triggers the problem described in [BPO-43223](https://bugs.python.org/issue?@action=redirect&bpo=43223); this will prove we have a problem;
* *then* include your fix to prove that the fix solved the problem.

The test will have to actually run the HTTP server to be useful.

Sorry, something went wrong.

All reactions

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
removed
the
[awaiting review](/python/cpython/labels/awaiting%20review)
label
[Jul 12, 2021](#event-5007017429)

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=80&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)

Copy link

### **[bedevere-bot](/bedevere-bot)** commented [Jul 12, 2021](#issuecomment-878213608)

| A Python core developer has requested some changes be made to your pull request before we can consider merging it. If you could please address their requests along with any other requests in other reviews from core developers that would be appreciated.  Once you have made the requested changes, please leave a comment on this pull request containing the phrase `I have made the requested changes; please review again`. I will then notify any core developers who have left a review that you're ready for them to take another look at this pull request. |
| --- |

All reactions

Sorry, something went wrong.

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
added
the
[awaiting changes](/python/cpython/labels/awaiting%20changes)
label
[Jul 12, 2021](#event-5007017440)

[![@jhadvig](https://avatars.githubusercontent.com/u/1668218?s=80&u=f7998f6dbf93a724d9e5a423486bbc4098a8b6f9&v=4)](/jhadvig)

Copy link

### **[jhadvig](/jhadvig)** commented [Apr 8, 2022](#issuecomment-1092858779)

| [@hamzaavvan](https://github.com/hamzaavvan) ping :) |
| --- |

All reactions

Sorry, something went wrong.

[![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=80&u=b178c3cc648e46018944e28a5caee1ce28d28153&v=4)](/hamzaavvan)

Copy link

Author

### **[hamzaavvan](/hamzaavvan)** commented [Apr 8, 2022](#issuecomment-1092882627) via email

| I've lost access to my account 😥 replying from email.. … On Fri, Apr 8, 2022, 6:26 PM Jakub Hadvig \*\*\*@\*\*\*.\*\*\*> wrote: [@hamzaavvan](https://github.com/hamzaavvan) <<https://github.com/hamzaavvan>> ping :) — Reply to this email directly, view it on GitHub <[#24848 (comment)](https://github.com/python/cpython/pull/24848#issuecomment-1092858779)>, or unsubscribe <<https://github.com/notifications/unsubscribe-auth/ACNY3RNMO7QIH6RKTIMDD53VEAXYXANCNFSM4ZEGXF4Q>> . You are receiving this because you were mentioned.Message ID: \*\*\*@\*\*\*.\*\*\*> |
| --- |

All reactions

Sorry, something went wrong.

![@hamzaavvan](https://avatars.githubusercontent.com/u/93804574?s=40&v=4)
hamzaavvan
mannequin
mentioned this pull request
[Apr 10, 2022](#ref-issue-1199052821)

[[security] CVE-2021-28861: http.server: Open Redirection if the URL path starts with //
#87389](/python/cpython/issues/87389)

Closed

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=40&v=4)](/gpshead)
[gpshead](/gpshead)
mentioned this pull request
[Jun 15, 2022](#ref-pullrequest-1272689289)

[gh-87389: Fix an open redirection vulnerability in http.server.
#93879](/python/cpython/pull/93879)
 Merged

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=80&v=4)](/gpshead)

Copy link

Member

### **[gpshead](/gpshead)** commented [Jun 15, 2022](#issuecomment-1156886989)

| This PR has been replaced by [#93879](https://github.com/python/cpython/pull/93879) |
| --- |

All reactions

Sorry, something went wrong.

[![@gpshead](https://avatars.githubusercontent.com/u/68491?s=40&v=4)](/gpshead)
[gpshead](/gpshead)
closed this
[Jun 15, 2022](#event-6815861471)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F24848)

Reviewers

[![@ned-deily](https://avatars.githubusercontent.com/u/5833005?s=40&v=4)](/ned-deily) [ned-deily](/ned-deily)

ned-deily left review comments

[![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&v=4)](/ambv) [ambv](/ambv)

ambv requested changes

[![@vstinner](https://avatars.githubusercontent.com/u/194129?s=40&v=4)](/vstinner) [vstinner](/vstinner)

 Awaiting requested review from vstinner

Assignees

No one assigned

Labels

[awaiting changes](/python/cpython/labels/awaiting%20changes)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

8 participants

[![@hamzaavvan](https://avatars.githubusercontent.com/u/10194373?s=52&v=4)](/hamzaavvan) [![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=52&v=4)](/bedevere-bot) [![@jhadvig](https://avatars.githubusercontent.com/u/1668218?s=52&v=4)](/jhadvig) [![@gpshead](https://avatars.githubusercontent.com/u/68491?s=52&v=4)](/gpshead) [![@ambv](https://avatars.githubusercontent.com/u/55281?s=52&v=4)](/ambv) [![@vstinner](https://avatars.githubusercontent.com/u/194129?s=52&v=4)](/vstinner) [![@ned-deily](https://avatars.githubusercontent.com/u/5833005?s=52&v=4)](/ned-deily) [![@the-knights-who-say-ni](https://avatars.githubusercontent.com/u/18121554?s=52&v=4)](/the-knights-who-say-ni)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from access.redhat.com_8c4955b1_20250115_123924.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2022:0983 - Security Advisory

Issued:
2022-03-24
Updated:
2022-03-24
# RHSA-2022:0983 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: Red Hat OpenStack Platform 16.1 (openstack-nova) security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2022%3A0983)

## Topic

An update for openstack-nova is now available for Red Hat OpenStack
Platform 16.1 (Train).

Red Hat Product Security has rated this update as having a security impact
of Moderate. A Common Vulnerability Scoring System (CVSS) base score, which
gives a detailed severity rating, is available for each vulnerability from
the CVE link(s) in the References section.

## Description

OpenStack Compute (codename Nova) is open source software designed
to provision and manage large networks of virtual machines, creating a
redundant and scalable cloud computing platform. It gives you the software,
control panels, and APIs required to orchestrate a cloud, including running
instances, managing networks, and controlling access through users and
projects.OpenStack Compute strives to be both hardware and hypervisor
agnostic, currently supporting a variety of standard hardware
configurations and seven major hypervisors.

Security Fix(es):

* novnc allows open redirection (CVE-2021-3654)

For more details about the security issue(s), including the impact, a CVSS
score, acknowledgments, and other related information, refer to the CVE
page listed in the References section.

## Solution

For details on how to apply this update, which includes the changes
described in this advisory, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack for IBM Power 16.1 ppc64le
* Red Hat OpenStack 16.1 x86\_64

## Fixes

* [BZ - 1961439](https://bugzilla.redhat.com/show_bug.cgi?id=1961439)
  - CVE-2021-3654 openstack-nova: novnc allows open redirection
* [BZ - 1977667](https://bugzilla.redhat.com/show_bug.cgi?id=1977667)
  - Compute service DOWN after FFU from RHOSP13 to 16.1 because service version is still 30.
* [BZ - 1999588](https://bugzilla.redhat.com/show_bug.cgi?id=1999588)
  - [OSP 16.1.8] Provide a workaround option and/or nova-manage command to force the refresh of connection\_info during a hard reboot
* [BZ - 2002773](https://bugzilla.redhat.com/show_bug.cgi?id=2002773)
  - [OSP16.1] Nova is out of sync with ironic as hypervisor list in nova does not agree with ironic list after reboot of the nodes
* [BZ - 2003258](https://bugzilla.redhat.com/show_bug.cgi?id=2003258)
  - [OSP16.1] vm creation interrupted by cluster degradation results in required nova cell information being unpopulated.
* [BZ - 2020313](https://bugzilla.redhat.com/show_bug.cgi?id=2020313)
  - If an upper case mac address is used in a heat template, live migration won't work in nova

## CVEs

* [CVE-2021-3654](https://access.redhat.com/security/cve/CVE-2021-3654)

## References

* <https://access.redhat.com/security/updates/classification/#moderate>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack for IBM Power 16.1

| SRPM | |
| --- | --- |
| openstack-nova-20.4.1-1.20220112153422.1ee93b9.el8ost.src.rpm | SHA-256: cda26a9bab7216a73ca3b15538b762ddf6adf568b16d458b4f366a7c4e090d12 |
| ppc64le | |
| openstack-nova-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 59d0be80760c6c2b7f886b7c9d5e77d25f279dc9a90cf6aef3aab1cde917e0c3 |
| openstack-nova-api-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 743ba8ebfd070c69a49ee3bc3b5d85a72bc260b2ad2cfbded689777bda490b56 |
| openstack-nova-common-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: db3ddf769492cdb18ab789e3c3230e5bba7e508c9a1efc46e494a389346fca87 |
| openstack-nova-compute-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 1fde01bb539b9fb9b85411a79414271f34a88e4e01dd3c044a5517e03c9c03aa |
| openstack-nova-conductor-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 8714b3d1f330fe89437d6e699ae85f528a39298a3153fafa1b6b4473b37fed41 |
| openstack-nova-console-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 940fd43f7a829cb2f0a3a2a2770e754b15db9e2a0960fd95c6d68d0eeee5267d |
| openstack-nova-migration-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 544eac941e88c2e6087e1f64a3775cc46cbadfe98265606b14900e3c2afe065f |
| openstack-nova-novncproxy-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 4fe2e7ec9ad2762ecd580f00f25e19999e3021683c739bdf8b801071394a4e0c |
| openstack-nova-scheduler-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 25004bc8936129a4d7024198388490d09202b43774035c1fcaf1b5ececabd304 |
| openstack-nova-serialproxy-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: c4ad5df23a9ed6978b368673b6d5529b1c5027bc36b4ff562cb3022bb69383ce |
| openstack-nova-spicehtml5proxy-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 323b4af66ebe4783cac13365315695ae518222cf22391060efd81b4c7eeaace2 |
| python3-nova-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: d4371ad888d98d631fa4634369f59e878a70dc53d239793d0216c9ed2dac2d36 |

## Red Hat OpenStack 16.1

| SRPM | |
| --- | --- |
| openstack-nova-20.4.1-1.20220112153422.1ee93b9.el8ost.src.rpm | SHA-256: cda26a9bab7216a73ca3b15538b762ddf6adf568b16d458b4f366a7c4e090d12 |
| x86\_64 | |
| openstack-nova-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 59d0be80760c6c2b7f886b7c9d5e77d25f279dc9a90cf6aef3aab1cde917e0c3 |
| openstack-nova-api-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 743ba8ebfd070c69a49ee3bc3b5d85a72bc260b2ad2cfbded689777bda490b56 |
| openstack-nova-common-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: db3ddf769492cdb18ab789e3c3230e5bba7e508c9a1efc46e494a389346fca87 |
| openstack-nova-compute-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 1fde01bb539b9fb9b85411a79414271f34a88e4e01dd3c044a5517e03c9c03aa |
| openstack-nova-conductor-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 8714b3d1f330fe89437d6e699ae85f528a39298a3153fafa1b6b4473b37fed41 |
| openstack-nova-console-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 940fd43f7a829cb2f0a3a2a2770e754b15db9e2a0960fd95c6d68d0eeee5267d |
| openstack-nova-migration-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 544eac941e88c2e6087e1f64a3775cc46cbadfe98265606b14900e3c2afe065f |
| openstack-nova-novncproxy-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 4fe2e7ec9ad2762ecd580f00f25e19999e3021683c739bdf8b801071394a4e0c |
| openstack-nova-scheduler-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 25004bc8936129a4d7024198388490d09202b43774035c1fcaf1b5ececabd304 |
| openstack-nova-serialproxy-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: c4ad5df23a9ed6978b368673b6d5529b1c5027bc36b4ff562cb3022bb69383ce |
| openstack-nova-spicehtml5proxy-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: 323b4af66ebe4783cac13365315695ae518222cf22391060efd81b4c7eeaace2 |
| python3-nova-20.4.1-1.20220112153422.1ee93b9.el8ost.noarch.rpm | SHA-256: d4371ad888d98d631fa4634369f59e878a70dc53d239793d0216c9ed2dac2d36 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from review.opendev.org_e5c191bf_20250115_194548.html ===




=== Content from review.opendev.org_ac6f7a53_20250115_194609.html ===




=== Content from launchpad.net_c9dc8aab_20250115_194627.html ===

[Log in / Register](https://launchpad.net/~sirswa/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~sirswa)

## [Swe W Aung](https://launchpad.net/~sirswa)

* Overview
* [Code](https://code.launchpad.net/~sirswa)
* [Bugs](https://bugs.launchpad.net/~sirswa)
* [Blueprints](https://blueprints.launchpad.net/~sirswa)
* [Translations](https://translations.launchpad.net/~sirswa)
* [Answers](https://answers.launchpad.net/~sirswa)

* [Related packages](https://launchpad.net/~sirswa/%2Brelated-packages)
* [Related projects](https://launchpad.net/~sirswa/%2Brelated-projects)

## User information

Launchpad Id:
sirswa

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-11-14

[![Icon of Ubuntu Local Community Teams](https://launchpadlibrarian.net/162222905/locoteams-icon.png "Member of Ubuntu Local Community Teams")](/~locoteams)
[![Icon of Ubuntu LoCo Enthusiasts](https://launchpadlibrarian.net/5043813/ls.png "Member of Ubuntu LoCo Enthusiasts")](/~ubuntu-loco-enthusiasts)
[![Icon of Ubuntu Myanmar LoCo Team](https://launchpadlibrarian.net/76283106/mm-bur5.png "Member of Ubuntu Myanmar LoCo Team")](/~ubuntu-mm)
[![Icon of Ubuntu Users](https://launchpadlibrarian.net/9608570/ubuntu_emblem.png "Member of Ubuntu Users")](/~ubuntu-users)

Languages:

English

SSH keys:

[swewa@work-horse](%2Bsshkeys)

[swe.aung@khakaborazi](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~sirswa/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~sirswa/%2Bparticipation) Latest memberships

| [Ubuntu Myanmar LoCo Team](/~ubuntu-mm)  Joined on 2014-12-23 | |
| --- | --- |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_8c326f3f_20250115_194557.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1977667)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1977667)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1977667)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1977667

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1977667**](show_bug.cgi?id=1977667)
- Compute service DOWN after FFU from RHOSP13 to 16.1 because service version is still 30.

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Compute service DOWN after FFU from RHOSP13 to 16.1 because service version i...

| | [Keywords](describekeywords.cgi): | Patch  Triaged | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-nova | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 16.1 (Train) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Unspecified | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | z8 | | [Target Release](page.cgi?id=fields.html#target_release): | 16.1 (Train on RHEL 8.2) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Artom Lifshitz | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | OSP DFG:Compute | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (1): | [2092802](show_bug.cgi?id=2092802 "CLOSED DUPLICATE - RHOSP 13 nova.exception.ComputeHostNotFound after openstack compute service delete 685")  ([view as bug list](buglist.cgi?bug_id=2092802)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1987225](show_bug.cgi?id=1987225 "CLOSED ERRATA - Compute service DOWN after FFU from RHOSP13 to 16.1 because service version is still 30.") | | TreeView+ | [depends on](buglist.cgi?bug_id=1977667&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1977667&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-06-30 08:57 UTC by Rohini Diwakar | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-03-21 19:45 UTC ([History](show_activity.cgi?id=1977667)) | | [CC List:](page.cgi?id=fields.html#cclist) | 17 users (show)  alifshit dasmith dhill eglynn jfrancoa jhakimra jpretori jveiraca kchamart lbezdick ltamagno pbabbar sbauza sgordon shtiwari smooney vromanso | | Fixed In Version: | openstack-nova-20.4.1-1.20210809183306.1ee93b9 | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: |  | | | Clones: | [1986406](show_bug.cgi?id=1986406 "CLOSED CURRENTRELEASE - [QE] controller replacement does not remove compute services before the node is deleted") [1987225](show_bug.cgi?id=1987225 "CLOSED ERRATA - Compute service DOWN after FFU from RHOSP13 to 16.1 because service version is still 30.")  ([view as bug list](buglist.cgi?bug_id=1986406,1987225)) | | | Environment: |  | | | Last Closed: | 2022-03-24 11:04:43 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | OpenStack gerrit | [801285](https://review.opendev.org/801285) | 0 | None | NEW | WIP: allow service delete even if compute node record is missing | 2021-08-12 09:27:38 UTC | | Red Hat Issue Tracker | [OSP-5650](https://issues.redhat.com/browse/OSP-5650) | 0 | None | None | None | 2021-11-15 13:08:34 UTC | | Red Hat Issue Tracker | [UPG-3185](https://issues.redhat.com/browse/UPG-3185) | 0 | None | None | None | 2021-10-12 13:38:55 UTC | | Red Hat Product Errata | [RHSA-2022:0983](https://access.redhat.com/errata/RHSA-2022%3A0983) | 0 | None | None | None | 2022-03-24 11:04:58 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1977667#c0)  Rohini Diwakar    2021-06-30 08:57:17 UTC  ``` Description of problem: After upgrade from osp13 to osp16.1 nova-compute and nova-consoleauth services are in DOWN state on controllers. Looks like stale entries and deleting the services results into the error:  +++ Failed to delete compute service with ID 'dfde0572-447e-4efe-8200-daf76f39f098': Unexpected API Error. Please report this at <http://bugs.launchpad.net/nova/> and attach the Nova API log if possible. <class 'nova.exception.ComputeHostNotFound'> (HTTP 500) (Request-ID: req-a4313d40-a9e3-47ca-99c8-e11183235092) +++  This is impacting migration of VMs. +++ Instance has an associated NUMA topology, cell contains compute nodes older than train, and the enable_numa_live_migration workaround is disabled. Refusing to perform the live migration, as the instance NUMA topology, including related attributes such as CPU pinning, huge page and emulator thread pinning information, cannot be recalculated. See [bug #1289064](show_bug.cgi?id=1289064 "CLOSED WORKSFORME - Node won't show up in Hosts tab") for more information. +++  Version-Release number of selected component (if applicable): RHOSP16.1   Actual results: nova-consoleauth & nova-compute service in DOWN state after upgrade.    Expected results: nova-consoleauth & nova-compute should have been cleaned up during upgrade.  Additional info:   ```  [Comment 2](show_bug.cgi?id=1977667#c2)  Artom Lifshitz    2021-06-30 13:56:23 UTC  ``` (In reply to Rohini Diwakar from [comment #0](show_bug.cgi?id=1977667#c0)) > Description of problem: > After upgrade from osp13 to osp16.1 nova-compute and nova-consoleauth > services are in DOWN state on controllers. Looks like stale entries and > deleting the services results into the error:  > +++ > Failed to delete compute service with ID > 'dfde0572-447e-4efe-8200-daf76f39f098': Unexpected API Error. Please report > this at <http://bugs.launchpad.net/nova/> and attach the Nova API log if > possible. > <class 'nova.exception.ComputeHostNotFound'> (HTTP 500) (Request-ID: > req-a4313d40-a9e3-47ca-99c8-e11183235092)  I wasn't able to find this request ID in any of the logs in the sosreports on supportshell:  [alifshit@supportshell 02975383]$ grep -l req-a4313d40-a9e3-47ca-99c8-e11183235092 -R `!!` grep -l req-a4313d40-a9e3-47ca-99c8-e11183235092 -R `find . -name '*nova*log*'` [supportshell.prod.useraccess-us-west-2.redhat.com] [13:50:51+0000] [alifshit@supportshell 02975383]$  [alifshit@supportshell 02975383]$ zgrep -l req-a4313d40-a9e3-47ca-99c8-e11183235092 -R `find . -name '*nova*log*'` gzip: -R.gz: No such file or directory [supportshell.prod.useraccess-us-west-2.redhat.com] [13:52:14+0000] [alifshit@supportshell 02975383]$  I think that should be the place where we start looking - understanding the full error for why Nova wasn't able to delete the service. Any chance we could get at least the full stacktrace, or another set of sosreports uploaded that include that request ID? Thanks!  > +++ >  > This is impacting migration of VMs. > +++ > Instance has an associated NUMA topology, cell contains compute nodes older > than train, and the enable_numa_live_migration workaround is disabled. > Refusing to perform the live migration, as the instance NUMA topology, > including related attributes such as CPU pinning, huge page and emulator > thread pinning information, cannot be recalculated. See [bug #1289064](show_bug.cgi?id=1289064 "CLOSED WORKSFORME - Node won't show up in Hosts tab") for > more information. > +++ >  > Version-Release number of selected component (if applicable): > RHOSP16.1 >  >  > Actual results: > nova-consoleauth & nova-compute service in DOWN state after upgrade.   >  > Expected results: > nova-consoleauth & nova-compute should have been cleaned up during upgrade. >  > Additional info:   ```  [Comment 3](show_bug.cgi?id=1977667#c3)  Artom Lifshitz    2021-07-07 11:19:21 UTC  ``` Hi again - another question. Manually deleting nova-compute services is not part of the 13 to 16.1 FFU process. What initiated the delete request? The upgrade tooling, or a human being, attempting to clean up left over services? Thanks!   ```  [Comment 7](show_bug.cgi?id=1977667#c7)  Artom Lifshitz    2021-07-19 12:04:43 UTC  ``` @Luigi: Your thing isn't actually related to FFU, and I suspect can be reproduced with just a controller replacement. I've started a WIP patch [1] to fix it.  @Rohini: The stack trace in your case is exactly the same as Luigi's, but in your case there's no mention of a controller replacement. As far as I can tell, a simple FFU should not cause the behaviour that you're seeing. Are you sure there isn't a controller replacement, or a similar operation, going on here?  [1] [https://review.opendev.org/c/openstack/nova/+/801285](https://review.opendev.org/c/openstack/nova/%2B/801285)   ```  [Comment 8](show_bug.cgi?id=1977667#c8)  smooney    2021-07-19 14:23:49 UTC  ``` as far as we can tell there seam too be a gap in the FFU proceedure for ironic. nova is working correctly in prevent numa live migration since the ironic compute services have not been upgraded so that is not a bug. in ironic deployement the ironic virt driver runs in compute services deployed on the contolers. this seams to not have been taken into account so the hard_prov dfg and upgrades dfg need to come to an agreement on how to adress this.  the current workflow for upgrades is that all compute services must be fully upgrade or in the hybrid state before any migration may happen. as such from a compute dfg perspective we would expect all 3 contoler to be fully upgraded including the ironc compute service instnaces prior to putting the other comptue services into the hybrid state(new containers old rhel) and then and only then shoudl any migration happen as compute hosts are leapp upgraded form rhel 7 to rhel 8.  moving this over to the hard_prov dfg to triage and determin what workflow is best in this case.   ```  [Comment 23](show_bug.cgi?id=1977667#c23)  Artom Lifshitz    2021-08-04 17:04:55 UTC  ``` Because this is getting a bit confusing, here's a summary that I'll reproduce in the other affected BZs.  [BZ 1986406](show_bug.cgi?id=1986406 "CLOSED CURRENTRELEASE - [QE] controller replacement does not remove compute services before the node is deleted"): Documentation for controller replacement  [BZ 1990034](show_bug.cgi?id=1990034 "CLOSED WORKSFORME - [Docs][FFU] controller replacement does not remove compute services before the node is deleted"): Documentation for FFU with Ironic as the virt driver  [BZ 1977667](show_bug.cgi?id=1977667 "CLOSED ERRATA - Compute service DOWN after FFU from RHOSP13 to 16.1 because service version is still 30.") (this BZ): Nova fix to allow service deletion when a service has no associated compute nodes.   ```  [Comment 24](show_bug.cgi?id=1977667#c24)  Artom Lifshitz    2021-08-09 20:06:26 UTC  ``` Fix has been merged in our OSP 16.1 branch, and can be obtained from <https://brewweb.engineering.redhat.com/brew/buildinfo?buildID=1688747> for hotfix delivery.   ```  [Comment 48](show_bug.cgi?id=1977667#c48)  Artom Lifshitz    2021-10-12 13:43:27 UTC  ``` @DFG:Upgrades - just looking for an answer to the question in [comment #47](show_bug.cgi?id=1977667#c47), nothing else.   ```  [Comment 65](show_bug.cgi?id=1977667#c65)  errata-xmlrpc    2022-03-24 11:04:43 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory (Moderate: Red Hat OpenStack Platform 16.1 (openstack-nova) security update), and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  [https://access.redhat.com/errata/RHSA-2022:0983](https://access.redhat.com/errata/RHSA-2022%3A0983)   ```  [Comment 66](show_bug.cgi?id=1977667#c66)  Artom Lifshitz    2022-06-06 16:42:57 UTC  ``` *** [Bug 2092802](show_bug.cgi?id=2092802 "CLOSED DUPLICATE - RHOSP 13 nova.exception.ComputeHostNotFound after openstack compute service delete 685") has been marked as a duplicate of this bug. ***   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1977667&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from launchpad.net_358978c3_20250115_194622.html ===

[Log in / Register](https://launchpad.net/~hudson-openstack/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~hudson-openstack)

## [OpenStack Infra](https://launchpad.net/~hudson-openstack)

* Overview
* [Code](https://code.launchpad.net/~hudson-openstack)
* [Bugs](https://bugs.launchpad.net/~hudson-openstack)
* [Blueprints](https://blueprints.launchpad.net/~hudson-openstack)
* [Translations](https://translations.launchpad.net/~hudson-openstack)
* [Answers](https://answers.launchpad.net/~hudson-openstack)

* [Related packages](https://launchpad.net/~hudson-openstack/%2Brelated-packages)
* [Related projects](https://launchpad.net/~hudson-openstack/%2Brelated-projects)

## User information

Launchpad Id:
hudson-openstack

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-07-14

[![Icon of Burrow](https://launchpadlibrarian.net/67728214/os14.png "Member of Burrow")](/~burrow)
[![Icon of Citrix OpenStack development team](https://launchpadlibrarian.net/64472709/Citrix%2014.png "Member of Citrix OpenStack development team")](/~citrix-openstack)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Core](https://launchpadlibrarian.net/360468328/designate_14.jpg "Member of Designate Core")](/~designate-core)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of MidoNet Bugs](https://launchpadlibrarian.net/228074955/midonet_14x14.png "Member of MidoNet Bugs")](/~midonet-bugs)
[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

OpenPGP keys:

72571ACC301E6FE900837F5CDF85501232EE128C

SSH keys:

[hudson@hudson](%2Bsshkeys)

[jenkins@vpcslave](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[6627](https://launchpad.net/~hudson-openstack/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~hudson-openstack/%2Bparticipation) Latest memberships

| [Compute Hyper-V Bugs](/~compute-hyperv-bugs)  Joined on 2019-08-28 | |
| --- | --- |
| [OS-Win Bugs](/~os-win-bugs)  Joined on 2019-08-28 | |
| [Networking Hyper-V Bugs](/~networking-hyperv-bugs)  Joined on 2019-08-28 | |
| [kolla-drivers](/~kolla-drivers)  Joined on 2019-05-20 | |
| [fixtures-git-bugs](/~fixtures-git-bugs)  Joined on 2018-03-25 | |

## [Recent activities](https://launchpad.net/~hudson-openstack/%2Bkarma) Most active in

| [StarlingX](/starlingx) |  |
| --- | --- |
| [kolla-ansible](/kolla-ansible) |  |
| [kolla](/kolla) |  |
| [kayobe](/kayobe) |  |
| [OpenStack Compute (nova)](/nova) |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_fddf5924_20250115_194606.html ===

[Log in / Register](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* [Translations](https://translations.launchpad.net/nova)
* [Answers](https://answers.launchpad.net/nova)

# [OSSA-2021-002] Open Redirect in noVNC proxy (CVE-2021-3654)

Bug #1927677 reported by
[Swe W Aung](https://launchpad.net/~sirswa)
on 2021-05-07

[280](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Compute (nova)](https://bugs.launchpad.net/nova) | Fix Released | Undecided | Unassigned |  |
|  | [Stein](https://bugs.launchpad.net/nova/stein) | In Progress | Undecided | Unassigned |  |
|  | [Train](https://bugs.launchpad.net/nova/train) | Fix Released | Undecided | Unassigned |  |
|  | [Ussuri](https://bugs.launchpad.net/nova/ussuri) | Fix Released | Undecided | Unassigned |  |
|  | [Victoria](https://bugs.launchpad.net/nova/victoria) | Fix Released | Undecided | Unassigned |  |
|  | [Wallaby](https://bugs.launchpad.net/nova/wallaby) | Fix Released | Undecided | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |

### Bug Description

This bug report is related to Security.

Currently novnc is allowing open direction, which could potentially be used for phishing attempts

To test.

https://<sites' vnc domain>//example.com/%2F..

include .. at the end

For example:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

It will redirect to example.com. You can replace example.com with some legitimate domain or spoofed domain.

The description of the risk is

By modifying untrusted URL input to a malicious site, an attacker may successfully launch a phishing scam and steal user credentials.

Because the server name in the modified link is identical to the original site, phishing attempts may have a more trustworthy appearance.

See [original description](comments/0)

Tags:

[console](/nova/%2Bbugs?field.tag=console)
[in-stable-train](/nova/%2Bbugs?field.tag=in-stable-train)
[in-stable-ussuri](/nova/%2Bbugs?field.tag=in-stable-ussuri)
[in-stable-victoria](/nova/%2Bbugs?field.tag=in-stable-victoria)
[in-stable-wallaby](/nova/%2Bbugs?field.tag=in-stable-wallaby)
[in-stable-xena](/nova/%2Bbugs?field.tag=in-stable-xena)
[in-stable-yoga](/nova/%2Bbugs?field.tag=in-stable-yoga)
[novnc](/nova/%2Bbugs?field.tag=novnc)

## CVE References

* [2021-28861](/bugs/cve/2021-28861 "** DISPUTED ** Python 3.x through 3.1...")
* [2021-3654](/bugs/cve/2021-3654 "A vulnerability was found in openstac...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-07: |  |  | [#1](/nova/%2Bbug/1927677/comments/1) |
| --- | --- | --- | --- |

You can also test from the host that running novnc service,

nova:~# curl -v '[http://127.0.0.1:6080//google.com/%2F..'](http://127.0.0.1:6080//google.com//..%27)

\* Trying 127.0.0.1...

\* TCP\_NODELAY set

\* Connected to 127.0.0.1 (127.0.0.1) port 6080 (#0)

> GET //google.com/%2F.. HTTP/1.1

> Host: 127.0.0.1:6080

> User-Agent: curl/7.58.0

> Accept: \*/\*

>

< HTTP/1.1 301 Moved Permanently

< Server: WebSockify Python/3.6.9

< Date: Fri, 07 May 2021 04:49:39 GMT

< Location: //google.com/%2F../

\* no chunk, no close, no size. Assume close to signal end

<

You can also test from the host that running novnc service,
nova:~# curl -v 'http://127.0.0.1:6080//google.com/%2F..'
\* Trying 127.0.0.1...
\* TCP\_NODELAY set
\* Connected to 127.0.0.1 (127.0.0.1) port 6080 (#0)
> GET //google.com/%2F.. HTTP/1.1
> Host: 127.0.0.1:6080
> User-Agent: curl/7.58.0
> Accept: \*/\*
>
< HTTP/1.1 301 Moved Permanently
< Server: WebSockify Python/3.6.9
< Date: Fri, 07 May 2021 04:49:39 GMT
< Location: //google.com/%2F../
\* no chunk, no close, no size. Assume close to signal end
<

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-05-07: |  |  | [#2](/nova/%2Bbug/1927677/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete

security advisory task has been added while the core security

reviewers for the affected project or projects confirm the bug and

discuss the scope of any vulnerability along with potential

solutions.

Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.

| **description**: | updated |
| --- | --- |
| Changed in ossa: | |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-11: |  |  | [#3](/nova/%2Bbug/1927677/comments/3) |
| --- | --- | --- | --- |

This bug report reminds me of an old bug [1] we dealt with in the past where the canned vnc\_auto.html and vnc.html pages allowed injection of arbitrary HTML into them (fixed in noVNC 0.6.2) [2].

vnc\_auto.html (vnc\_lite.html as of v1.0.0) and vnc.html have a feature where a host and port can be specified as query parameters in the URL, example [3]:

<http://1.2.3.4:6080/vnc_auto.html?host=6.7.8.9&port=6080>

and it will connect to a noVNC server running on that host:port as the source of data provided to vnc\_auto.html. The bug [2] meant that if a user specified host:port in the URL query parameters, a potentially malicious noVNC server running on that host:port could inject arbitrary HTML into the vnc\_auto.html being served on the user's machine.

I mention that because it seems like the host:port functionality could be similarly used to phish. I'm thinking if someone ran their own noVNC server at host:port and got a user to click on a link with ?host&port in it, they could steal credentials if the user didn't notice what machine they're connecting to.

If that's the case, I'm not sure this redirect behavior is much different than what is already built-in to the vnc\_lite.html and vnc.html pages that come with noVNC.

Aside from that, it's not clear to me whether this redirect behavior is something we (nova) control or if it's being done by noVNC itself. If it's the latter, I'm not sure whether we could do anything to intercept it or if it's something that would have to be changed in noVNC.

I'm going to add noVNC to this bug to get their input about the redirect behavior.

[1] [https://bugs.launchpad.net/horizon/+bug/1656435](https://bugs.launchpad.net/horizon/%2Bbug/1656435)

[2] <https://github.com/novnc/noVNC/issues/748>

[3] <https://github.com/novnc/noVNC/blob/v1.1.0/vnc_lite.html#L14-L15>

This bug report reminds me of an old bug [1] we dealt with in the past where the canned vnc\_auto.html and vnc.html pages allowed injection of arbitrary HTML into them (fixed in noVNC 0.6.2) [2].
vnc\_auto.html (vnc\_lite.html as of v1.0.0) and vnc.html have a feature where a host and port can be specified as query parameters in the URL, example [3]:
http://1.2.3.4:6080/vnc\_auto.html?host=6.7.8.9&port=6080
and it will connect to a noVNC server running on that host:port as the source of data provided to vnc\_auto.html. The bug [2] meant that if a user specified host:port in the URL query parameters, a potentially malicious noVNC server running on that host:port could inject arbitrary HTML into the vnc\_auto.html being served on the user's machine.
I mention that because it seems like the host:port functionality could be similarly used to phish. I'm thinking if someone ran their own noVNC server at host:port and got a user to click on a link with ?host&port in it, they could steal credentials if the user didn't notice what machine they're connecting to.
If that's the case, I'm not sure this redirect behavior is much different than what is already built-in to the vnc\_lite.html and vnc.html pages that come with noVNC.
Aside from that, it's not clear to me whether this redirect behavior is something we (nova) control or if it's being done by noVNC itself. If it's the latter, I'm not sure whether we could do anything to intercept it or if it's something that would have to be changed in noVNC.
I'm going to add noVNC to this bug to get their input about the redirect behavior.
[1] https://bugs.launchpad.net/horizon/+bug/1656435
[2] https://github.com/novnc/noVNC/issues/748
[3] https://github.com/novnc/noVNC/blob/v1.1.0/vnc\_lite.html#L14-L15

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-11: |  |  | [#4](/nova/%2Bbug/1927677/comments/4) |
| --- | --- | --- | --- |

> I'm going to add noVNC to this bug to get their input about the redirect behavior.

Looks like I can't do that because noVNC and websockify use github issues and those can't be private security. But if it is indeed an issue in noVNC or websockify, then it is probably OK to go ahead and report it publicly in those projects.

I'm going to do some local testing to determine whether this redirect is something we could intercept and handle or if it happens before we (websockify plugin) are called. If it doesn't appear we can intercept it, we can switch this to public and I can report an issue for noVNC or websockify on github.

> I'm going to add noVNC to this bug to get their input about the redirect behavior.
Looks like I can't do that because noVNC and websockify use github issues and those can't be private security. But if it is indeed an issue in noVNC or websockify, then it is probably OK to go ahead and report it publicly in those projects.
I'm going to do some local testing to determine whether this redirect is something we could intercept and handle or if it happens before we (websockify plugin) are called. If it doesn't appear we can intercept it, we can switch this to public and I can report an issue for noVNC or websockify on github.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#5](/nova/%2Bbug/1927677/comments/5) |
| --- | --- | --- | --- |

* [lp1927677.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5496768/%2Bfiles/lp1927677.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5496768)
  (1.6 KiB,
  text/plain)

OK, I really went down the rabbit hole with this one.

The tl;dr is that this is a known issue in the python standard library [1], in the http.server.SimpleHTTPRequestHandler, which WebSockifyRequestHandler derives from and which we ultimately derive from with our NovaProxyRequestHandler.

I found that we \_can\_ intercept this in our code and prevent an open redirect. It could be considered hacky, but I'm attaching a patch that prevents the redirect. It is code copied from a comment on the python issue [2].

The concern about the sample code in the issue is that such code might reject legitimate requests in certain cases. I don't believe we have such a concern with the nova console proxy.

Let me know what you think.

[1] <https://bugs.python.org/issue32084>

[2] <https://bugs.python.org/issue32084#msg306545>

OK, I really went down the rabbit hole with this one.
The tl;dr is that this is a known issue in the python standard library [1], in the http.server.SimpleHTTPRequestHandler, which WebSockifyRequestHandler derives from and which we ultimately derive from with our NovaProxyRequestHandler.
I found that we \_can\_ intercept this in our code and prevent an open redirect. It could be considered hacky, but I'm attaching a patch that prevents the redirect. It is code copied from a comment on the python issue [2].
The concern about the sample code in the issue is that such code might reject legitimate requests in certain cases. I don't believe we have such a concern with the nova console proxy.
Let me know what you think.
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#6](/nova/%2Bbug/1927677/comments/6) |
| --- | --- | --- | --- |

Also, I'm thinking we could make this bug public considering the root cause of the behavior is a public issue in the python standard http.server.SimpleHTTPRequestHandler.

Also, I'm thinking we could make this bug public considering the root cause of the behavior is a public issue in the python standard http.server.SimpleHTTPRequestHandler.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#7](/nova/%2Bbug/1927677/comments/7) |
| --- | --- | --- | --- |

Also, I have tested the patch in comment 5 in devstack and verified it works to return a 400 Bad Request if "//" are included in the URL to redirect, provided that the browser has not previously cached a past redirect.

I used the following URL to test: [http://127.0.0.1:6080//google.com/%2F](http://127.0.0.1:6080//google.com//)..

Also, I have tested the patch in comment 5 in devstack and verified it works to return a 400 Bad Request if "//" are included in the URL to redirect, provided that the browser has not previously cached a past redirect.
I used the following URL to test: http://127.0.0.1:6080//google.com/%2F..

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-05-13

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public |
| **information type**: | Public → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-05-13: |  |  | [#8](/nova/%2Bbug/1927677/comments/8) |
| --- | --- | --- | --- |

Thanks for digging into this, Melanie! I've ended the embargo and switched to Public Security given the relatively low risk this represents and its relationship with known issues in WebSockify/stdlib.

If the patch is sufficient and gets backported to stable branches, we could issue an advisory (class A in our report taxonomy). We could also consider it a workaround for a bug in a dependency (class C2), but that gets into determining whether the vulnerability is in the dependency or merely in the way we're using it. I'll leave the security advisory task incomplete for the time being, and we'll see how the fix progresses in review.

Thanks for digging into this, Melanie! I've ended the embargo and switched to Public Security given the relatively low risk this represents and its relationship with known issues in WebSockify/stdlib.
If the patch is sufficient and gets backported to stable branches, we could issue an advisory (class A in our report taxonomy). We could also consider it a workaround for a bug in a dependency (class C2), but that gets into determining whether the vulnerability is in the dependency or merely in the way we're using it. I'll leave the security advisory task incomplete for the time being, and we'll see how the fix progresses in review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-13:  [**Fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/9) |  |  | [#9](/nova/%2Bbug/1927677/comments/9) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/791297](https://review.opendev.org/c/openstack/nova/%2B/791297)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/791297

| Changed in nova: | |
| --- | --- |
| **status**: | New → In Progress |

[melanie witt (melwitt)](https://launchpad.net/~melwitt)
on 2021-05-13

| **tags**: | added: console |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-14:  [**Re: [Bug 1927677] Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/10) |  |  | [#10](/nova/%2Bbug/1927677/comments/10) |
| --- | --- | --- | --- |

Hi Melanie

The is for the investigation and your effort. Really appreciate that.

Regards

sw3

On Sat, 15 May 2021 at 1:06 am, melanie witt <email address hidden>

wrote:

> \*\* Also affects: nova/train

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/ussuri

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/wallaby

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/victoria

> Importance: Undecided

> Status: New

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/1927677>

>

> Title:

> novnc allowing open direction which could potentially be used for

> phishing

>

> Status in OpenStack Compute (nova):

> In Progress

> Status in OpenStack Compute (nova) train series:

> New

> Status in OpenStack Compute (nova) ussuri series:

> New

> Status in OpenStack Compute (nova) victoria series:

> New

> Status in OpenStack Compute (nova) wallaby series:

> New

> Status in OpenStack Security Advisory:

> Incomplete

>

> Bug description:

> This bug report is related to Security.

>

> Currently novnc is allowing open direction, which could potentially be

> used for phishing attempts

>

> To test.

> https://<sites' vnc domain>//example.com/%2F..

> include .. at the end

>

> For example:

> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>

> It will redirect to example.com. You can replace example.com with some

> legitimate domain or spoofed domain.

>

> The description of the risk is

> By modifying untrusted URL input to a malicious site, an attacker may

> successfully launch a phishing scam and steal user credentials.

> Because the server name in the modified link is identical to the

> original site, phishing attempts may have a more trustworthy appearance.

>

> To manage notifications about this bug go to:

> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>

--

Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Hi Melanie
The is for the investigation and your effort. Really appreciate that.
Regards
sw3
On Sat, 15 May 2021 at 1:06 am, melanie witt <1927677@bugs.launchpad.net>
wrote:
> \*\* Also affects: nova/train
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/ussuri
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/wallaby
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/victoria
> Importance: Undecided
> Status: New
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/1927677
>
> Title:
> novnc allowing open direction which could potentially be used for
> phishing
>
> Status in OpenStack Compute (nova):
> In Progress
> Status in OpenStack Compute (nova) train series:
> New
> Status in OpenStack Compute (nova) ussuri series:
> New
> Status in OpenStack Compute (nova) victoria series:
> New
> Status in OpenStack Compute (nova) wallaby series:
> New
> Status in OpenStack Security Advisory:
> Incomplete
>
> Bug description:
> This bug report is related to Security.
>
> Currently novnc is allowing open direction, which could potentially be
> used for phishing attempts
>
> To test.
> https://<sites' vnc domain>//example.com/%2F..
> include .. at the end
>
> For example:
> http://vncproxy.my.domain.com//example.com/%2F..
>
> It will redirect to example.com. You can replace example.com with some
> legitimate domain or spoofed domain.
>
> The description of the risk is
> By modifying untrusted URL input to a malicious site, an attacker may
> successfully launch a phishing scam and steal user credentials.
> Because the server name in the modified link is identical to the
> original site, phishing attempts may have a more trustworthy appearance.
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>
--
Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-14: |  |  | [#11](/nova/%2Bbug/1927677/comments/11) |
| --- | --- | --- | --- |

Hi Melanie

Thanks for the investigation and the effort. Really appreciate that.

Regards

sw3

On Sat, 15 May 2021 at 7:10 am, Swe Win Aung <email address hidden> wrote:

> Hi Melanie

>

> The is for the investigation and your effort. Really appreciate that.

>

> Regards

> sw3

>

> On Sat, 15 May 2021 at 1:06 am, melanie witt <email address hidden>

> wrote:

>

>> \*\* Also affects: nova/train

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/ussuri

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/wallaby

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/victoria

>> Importance: Undecided

>> Status: New

>>

>> --

>> You received this bug notification because you are subscribed to the bug

>> report.

>> <https://bugs.launchpad.net/bugs/1927677>

>>

>> Title:

>> novnc allowing open direction which could potentially be used for

>> phishing

>>

>> Status in OpenStack Compute (nova):

>> In Progress

>> Status in OpenStack Compute (nova) train series:

>> New

>> Status in OpenStack Compute (nova) ussuri series:

>> New

>> Status in OpenStack Compute (nova) victoria series:

>> New

>> Status in OpenStack Compute (nova) wallaby series:

>> New

>> Status in OpenStack Security Advisory:

>> Incomplete

>>

>> Bug description:

>> This bug report is related to Security.

>>

>> Currently novnc is allowing open direction, which could potentially be

>> used for phishing attempts

>>

>> To test.

>> https://<sites' vnc domain>//example.com/%2F..

>> include .. at the end

>>

>> For example:

>> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>>

>> It will redirect to example.com. You can replace example.com with some

>> legitimate domain or spoofed domain.

>>

>> The description of the risk is

>> By modifying untrusted URL input to a malicious site, an attacker may

>> successfully launch a phishing scam and steal user credentials.

>> Because the server name in the modified link is identical to the

>> original site, phishing attempts may have a more trustworthy appearance.

>>

>> To manage notifications about this bug go to:

>> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>>

> --

> Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

>

--

Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Hi Melanie
Thanks for the investigation and the effort. Really appreciate that.
Regards
sw3
On Sat, 15 May 2021 at 7:10 am, Swe Win Aung <sirswa@gmail.com> wrote:
> Hi Melanie
>
> The is for the investigation and your effort. Really appreciate that.
>
> Regards
> sw3
>
> On Sat, 15 May 2021 at 1:06 am, melanie witt <1927677@bugs.launchpad.net>
> wrote:
>
>> \*\* Also affects: nova/train
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/ussuri
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/wallaby
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/victoria
>> Importance: Undecided
>> Status: New
>>
>> --
>> You received this bug notification because you are subscribed to the bug
>> report.
>> https://bugs.launchpad.net/bugs/1927677
>>
>> Title:
>> novnc allowing open direction which could potentially be used for
>> phishing
>>
>> Status in OpenStack Compute (nova):
>> In Progress
>> Status in OpenStack Compute (nova) train series:
>> New
>> Status in OpenStack Compute (nova) ussuri series:
>> New
>> Status in OpenStack Compute (nova) victoria series:
>> New
>> Status in OpenStack Compute (nova) wallaby series:
>> New
>> Status in OpenStack Security Advisory:
>> Incomplete
>>
>> Bug description:
>> This bug report is related to Security.
>>
>> Currently novnc is allowing open direction, which could potentially be
>> used for phishing attempts
>>
>> To test.
>> https://<sites' vnc domain>//example.com/%2F..
>> include .. at the end
>>
>> For example:
>> http://vncproxy.my.domain.com//example.com/%2F..
>>
>> It will redirect to example.com. You can replace example.com with some
>> legitimate domain or spoofed domain.
>>
>> The description of the risk is
>> By modifying untrusted URL input to a malicious site, an attacker may
>> successfully launch a phishing scam and steal user credentials.
>> Because the server name in the modified link is identical to the
>> original site, phishing attempts may have a more trustworthy appearance.
>>
>> To manage notifications about this bug go to:
>> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>>
> --
> Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"
>
--
Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-15:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/12) |  |  | [#12](/nova/%2Bbug/1927677/comments/12) |
| --- | --- | --- | --- |

Hi sw3,

Thanks for reporting the issue!

Hi sw3,
Thanks for reporting the issue!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-15:  [**Fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/13) |  |  | [#13](/nova/%2Bbug/1927677/comments/13) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791297](https://review.opendev.org/c/openstack/nova/%2B/791297)

Committed: <https://opendev.org/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e>

Submitter: "Zuul (22348)"

Branch: master

commit 781612b33282ed298f742c85dab58a075c8b793e

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

Reviewed: https://review.opendev.org/c/openstack/nova/+/791297
Committed: https://opendev.org/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e
Submitter: "Zuul (22348)"
Branch: master
commit 781612b33282ed298f742c85dab58a075c8b793e
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-15:  [**Fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/14) |  |  | [#14](/nova/%2Bbug/1927677/comments/14) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/791577](https://review.opendev.org/c/openstack/nova/%2B/791577)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/791577

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/15) |  |  | [#15](/nova/%2Bbug/1927677/comments/15) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/791805](https://review.opendev.org/c/openstack/nova/%2B/791805)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/791805

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/16) |  |  | [#16](/nova/%2Bbug/1927677/comments/16) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/791806](https://review.opendev.org/c/openstack/nova/%2B/791806)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/791806

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/17) |  |  | [#17](/nova/%2Bbug/1927677/comments/17) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/791807](https://review.opendev.org/c/openstack/nova/%2B/791807)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/791807

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-19:  [**Fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/18) |  |  | [#18](/nova/%2Bbug/1927677/comments/18) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791577](https://review.opendev.org/c/openstack/nova/%2B/791577)

Committed: <https://opendev.org/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 470925614223c8dd9b1233f54f5a96c02b2d4f70

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791577
Committed: https://opendev.org/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 470925614223c8dd9b1233f54f5a96c02b2d4f70
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-09:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/19) |  |  | [#19](/nova/%2Bbug/1927677/comments/19) |
| --- | --- | --- | --- |

Since we have fixes for this merged to all maintained stable branches (and them some), we need to decide whether we're issuing a security advisory about this or merely treating it as hardening. Does anyone have an opinion?

Since we have fixes for this merged to all maintained stable branches (and them some), we need to decide whether we're issuing a security advisory about this or merely treating it as hardening. Does anyone have an opinion?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-09: |  |  | [#20](/nova/%2Bbug/1927677/comments/20) |
| --- | --- | --- | --- |

The fix backports have been proposed but are not yet merged on stable/victoria, stable/ussuri, and stable/train.

This issue is considered to be of "moderate" severity and is a result of a publicly reported behavior in the python standard library [1] and the http.server documentation has a warning on it that states, "Warning http.server is not recommended for production. It only implements basic security checks." [2].

Our dependency however, the websockify server [3], is based upon http.server and AFAIK websockify isn't characterized as only for dev or non-production use.

There is currently a pull request proposed to fix [1] and it is currently under review [4].

Based on this, I tend to think to treat it as hardening, but of course I defer to the expert opinion of the VMT.

[1] <https://bugs.python.org/issue43223>

[2] <https://docs.python.org/3/library/http.server.html>

[3] <https://github.com/novnc/websockify>

[4] <https://github.com/python/cpython/pull/24848>

The fix backports have been proposed but are not yet merged on stable/victoria, stable/ussuri, and stable/train.
This issue is considered to be of "moderate" severity and is a result of a publicly reported behavior in the python standard library [1] and the http.server documentation has a warning on it that states, "Warning http.server is not recommended for production. It only implements basic security checks." [2].
Our dependency however, the websockify server [3], is based upon http.server and AFAIK websockify isn't characterized as only for dev or non-production use.
There is currently a pull request proposed to fix [1] and it is currently under review [4].
Based on this, I tend to think to treat it as hardening, but of course I defer to the expert opinion of the VMT.
[1] https://bugs.python.org/issue43223
[2] https://docs.python.org/3/library/http.server.html
[3] https://github.com/novnc/websockify
[4] https://github.com/python/cpython/pull/24848

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Joshua Padman (jpadman)](https://launchpad.net/~jpadman) wrote on 2021-07-12: |  |  | [#21](/nova/%2Bbug/1927677/comments/21) |
| --- | --- | --- | --- |

The last OSSA that was released was also for an open redirect.

<https://security.openstack.org/ossa/OSSA-2020-008.html>

Its not a fancy vulnerability but it is one that can lead to far more significant issues. Ideally a CVE would be assigned to this, though maybe in the interest of consistency an OSSA may be required too?

The last OSSA that was released was also for an open redirect.
https://security.openstack.org/ossa/OSSA-2020-008.html
Its not a fancy vulnerability but it is one that can lead to far more significant issues. Ideally a CVE would be assigned to this, though maybe in the interest of consistency an OSSA may be required too?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-12: |  |  | [#22](/nova/%2Bbug/1927677/comments/22) |
| --- | --- | --- | --- |

Melanie: Thanks for pointing out that the backports for branches prior to stable/wallaby haven't merged yet; I misread the notifications. We can't publish an advisory anyway until those are merged for the maintained branches at a minimum (fixes for branches under extended maintenance can merge after any advisory though).

Joshua: As Melanie points out, what we're providing is a workaround for a known security flaw in a dependency, so differs slightly from OSSA-2020-008 in that regard. You are right though that the end result is roughly the same for vulnerable deployments, and unlike most vulnerabilities involving dependencies this is one we actually have an active mitigation for which doesn't require any additional action on the part of the deployer other than upgrading our software in the deployment (no additional configuration or dependency upgrade steps needed).

I'm disappearing on a week-long vacation tomorrow, but if someone wants to compose an impact description for this and request a CVE from MITRE with it (or assign one as a CNA), I'm happy to help coordinate any advisory when I get home. Our template for impact descriptions can be found here: <https://security.openstack.org/vmt-process.html#impact-description-description>

Melanie: Thanks for pointing out that the backports for branches prior to stable/wallaby haven't merged yet; I misread the notifications. We can't publish an advisory anyway until those are merged for the maintained branches at a minimum (fixes for branches under extended maintenance can merge after any advisory though).
Joshua: As Melanie points out, what we're providing is a workaround for a known security flaw in a dependency, so differs slightly from OSSA-2020-008 in that regard. You are right though that the end result is roughly the same for vulnerable deployments, and unlike most vulnerabilities involving dependencies this is one we actually have an active mitigation for which doesn't require any additional action on the part of the deployer other than upgrading our software in the deployment (no additional configuration or dependency upgrade steps needed).
I'm disappearing on a week-long vacation tomorrow, but if someone wants to compose an impact description for this and request a CVE from MITRE with it (or assign one as a CNA), I'm happy to help coordinate any advisory when I get home. Our template for impact descriptions can be found here: https://security.openstack.org/vmt-process.html#impact-description-description

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-15:  [**Fix included in openstack/nova 23.0.2**](/nova/%2Bbug/1927677/comments/23) |  |  | [#23](/nova/%2Bbug/1927677/comments/23) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 23.0.2 release.

This issue was fixed in the openstack/nova 23.0.2 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-23:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/24) |  |  | [#24](/nova/%2Bbug/1927677/comments/24) |
| --- | --- | --- | --- |

Red Hat will be assigning a CVE for this. Sirswa, would you like to be credited as the reporter? What name should we put down? Do you represent an organization?

Red Hat will be assigning a CVE for this. Sirswa, would you like to be credited as the reporter? What name should we put down? Do you represent an organization?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Shahaan Ayyub (shahaan)](https://launchpad.net/~shahaan) wrote on 2021-07-24:  [**Re: [Bug 1927677] Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/25) |  |  | [#25](/nova/%2Bbug/1927677/comments/25) |
| --- | --- | --- | --- |

Thanks Nick,

  We are part of the Monash University Nectar Cloud team. Please feel free

to put us reporters.

Swe Aung

Shahaan Ayyub

Regards,

Shahaan

On Sat, 24 Jul 2021 at 09:25, Nick Tait <email address hidden> wrote:

> Red Hat will be assigning a CVE for this. Sirswa, would you like to be

> credited as the reporter? What name should we put down? Do you represent

> an organization?

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/1927677>

>

> Title:

> novnc allowing open direction which could potentially be used for

> phishing

>

> Status in OpenStack Compute (nova):

> Fix Released

> Status in OpenStack Compute (nova) train series:

> In Progress

> Status in OpenStack Compute (nova) ussuri series:

> In Progress

> Status in OpenStack Compute (nova) victoria series:

> In Progress

> Status in OpenStack Compute (nova) wallaby series:

> Fix Released

> Status in OpenStack Security Advisory:

> Incomplete

>

> Bug description:

> This bug report is related to Security.

>

> Currently novnc is allowing open direction, which could potentially be

> used for phishing attempts

>

> To test.

> https://<sites' vnc domain>//example.com/%2F..

> include .. at the end

>

> For example:

> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>

> It will redirect to example.com. You can replace example.com with some

> legitimate domain or spoofed domain.

>

> The description of the risk is

> By modifying untrusted URL input to a malicious site, an attacker may

> successfully launch a phishing scam and steal user credentials.

> Because the server name in the modified link is identical to the

> original site, phishing attempts may have a more trustworthy appearance.

>

> To manage notifications about this bug go to:

> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>

>

Thanks Nick,
We are part of the Monash University Nectar Cloud team. Please feel free
to put us reporters.
Swe Aung
Shahaan Ayyub
Regards,
Shahaan
On Sat, 24 Jul 2021 at 09:25, Nick Tait <1927677@bugs.launchpad.net> wrote:
> Red Hat will be assigning a CVE for this. Sirswa, would you like to be
> credited as the reporter? What name should we put down? Do you represent
> an organization?
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/1927677
>
> Title:
> novnc allowing open direction which could potentially be used for
> phishing
>
> Status in OpenStack Compute (nova):
> Fix Released
> Status in OpenStack Compute (nova) train series:
> In Progress
> Status in OpenStack Compute (nova) ussuri series:
> In Progress
> Status in OpenStack Compute (nova) victoria series:
> In Progress
> Status in OpenStack Compute (nova) wallaby series:
> Fix Released
> Status in OpenStack Security Advisory:
> Incomplete
>
> Bug description:
> This bug report is related to Security.
>
> Currently novnc is allowing open direction, which could potentially be
> used for phishing attempts
>
> To test.
> https://<sites' vnc domain>//example.com/%2F..
> include .. at the end
>
> For example:
> http://vncproxy.my.domain.com//example.com/%2F..
>
> It will redirect to example.com. You can replace example.com with some
> legitimate domain or spoofed domain.
>
> The description of the risk is
> By modifying untrusted URL input to a malicious site, an attacker may
> successfully launch a phishing scam and steal user credentials.
> Because the server name in the modified link is identical to the
> original site, phishing attempts may have a more trustworthy appearance.
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-24:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/26) |  |  | [#26](/nova/%2Bbug/1927677/comments/26) |
| --- | --- | --- | --- |

Nick: Thanks for offering to assign a CVE for this. Do you have text for an impact description you'll be using in the CVE? If not, I can work on putting one together, though we still don't have any ETA on when the workarounds will merge to stable/victoria and earlier branches (and wouldn't issue a formal advisory until they do).

Nick: Thanks for offering to assign a CVE for this. Do you have text for an impact description you'll be using in the CVE? If not, I can work on putting one together, though we still don't have any ETA on when the workarounds will merge to stable/victoria and earlier branches (and wouldn't issue a formal advisory until they do).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-07-26: |  |  | [#27](/nova/%2Bbug/1927677/comments/27) |
| --- | --- | --- | --- |

Hi Nick

Thanks. I noticed the CVE at RedHat few days ago. Thank you for following up and assigning at RedHat.

I will have to acknowledge Monash University Cyber Security team's vulnerability discovery work and raising the issue to us originally. I work for Monash University.

Our names are

Swe Aung

Shahaan Ayyub

Salman Khan (Cyber Security)

Thank you.

Hi Nick
Thanks. I noticed the CVE at RedHat few days ago. Thank you for following up and assigning at RedHat.
I will have to acknowledge Monash University Cyber Security team's vulnerability discovery work and raising the issue to us originally. I work for Monash University.
Our names are
Swe Aung
Shahaan Ayyub
Salman Khan (Cyber Security)
Thank you.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-26:  [**Fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/28) |  |  | [#28](/nova/%2Bbug/1927677/comments/28) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791805](https://review.opendev.org/c/openstack/nova/%2B/791805)

Committed: <https://opendev.org/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:

        nova/console/websocketproxy.py

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflicts are because the following changes are not

    in Victoria:

Ib2c406327fef2fb4868d8050fc476a7d17706e23 (Remove six.moves)

      I58b0382c86d4ef798572edb63d311e0e3e6937bb (Refactor and rename

        test\_tcp\_rst\_no\_compute\_rpcapi)

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791805
Committed: https://opendev.org/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Conflicts:
nova/console/websocketproxy.py
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflicts are because the following changes are not
in Victoria:
Ib2c406327fef2fb4868d8050fc476a7d17706e23 (Remove six.moves)
I58b0382c86d4ef798572edb63d311e0e3e6937bb (Refactor and rename
test\_tcp\_rst\_no\_compute\_rpcapi)
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-27:  [**Fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/29) |  |  | [#29](/nova/%2Bbug/1927677/comments/29) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791806](https://review.opendev.org/c/openstack/nova/%2B/791806)

Committed: <https://opendev.org/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 719e651e6be277950632e0c2cf5cc9a018344e7b

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

    (cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791806
Committed: https://opendev.org/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 719e651e6be277950632e0c2cf5cc9a018344e7b
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)
(cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/30) |  |  | [#30](/nova/%2Bbug/1927677/comments/30) |
| --- | --- | --- | --- |

Actually, since the stable/train branch has transitioned from maintained to extended maintenance status we no longer need to hold off any advisory waiting for the fix there to merge. I'll go ahead and start drafting the advisory now, since the stable/ussuri fix has merged.

Actually, since the stable/train branch has transitioned from maintained to extended maintenance status we no longer need to hold off any advisory waiting for the fix there to merge. I'll go ahead and start drafting the advisory now, since the stable/ussuri fix has merged.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |
| **importance**: | Undecided → Medium |
| **assignee**: | nobody → Jeremy Stanley (fungi) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27: |  |  | [#31](/nova/%2Bbug/1927677/comments/31) |
| --- | --- | --- | --- |

Nick: What CVE number have you assigned for this? Or should I go ahead and ask MITRE to assign one?

Nick: What CVE number have you assigned for this? Or should I go ahead and ask MITRE to assign one?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-27 (last edit on 2021-07-27): |  |  | [#32](/nova/%2Bbug/1927677/comments/32) |
| --- | --- | --- | --- |

I'm working on getting reviews for the backport patches, only the stable/train patch remains.

(update) Oops, I just now see Jeremy's comment #30. Makes sense.

I'm working on getting reviews for the backport patches, only the stable/train patch remains.
(update) Oops, I just now see Jeremy's comment #30. Makes sense.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-27:  [**Fix proposed to ossa (master)**](/nova/%2Bbug/1927677/comments/33) |  |  | [#33](/nova/%2Bbug/1927677/comments/33) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/802590](https://review.opendev.org/c/openstack/ossa/%2B/802590)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/802590

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/34) |  |  | [#34](/nova/%2Bbug/1927677/comments/34) |
| --- | --- | --- | --- |

Can folks please review the impact description and related metadata in the draft OSSA-2021-002 linked above? I've left the CVE blank for now since I'm waiting for Nick to say what number he assigned.

Can folks please review the impact description and related metadata in the draft OSSA-2021-002 linked above? I've left the CVE blank for now since I'm waiting for Nick to say what number he assigned.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-27: |  |  | [#35](/nova/%2Bbug/1927677/comments/35) |
| --- | --- | --- | --- |

CVE-2021-3654 <https://access.redhat.com/security/cve/CVE-2021-3654>

CVE-2021-3654 https://access.redhat.com/security/cve/CVE-2021-3654

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-27: |  |  | [#36](/nova/%2Bbug/1927677/comments/36) |
| --- | --- | --- | --- |

And cheers to the trio at Monash for reporting. Thanks!

And cheers to the trio at Monash for reporting. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-28:  [**Re: Open Redirect in noVNC proxy (CVE-2021-3654)**](/nova/%2Bbug/1927677/comments/37) |  |  | [#37](/nova/%2Bbug/1927677/comments/37) |
| --- | --- | --- | --- |

The draft advisory has been updated with the CVE (thanks again, Nick!) and a proposed publication date of tomorrow, so if folks could please review <https://review.opendev.org/802590> that will help a ton.

The draft advisory has been updated with the CVE (thanks again, Nick!) and a proposed publication date of tomorrow, so if folks could please review https://review.opendev.org/802590 that will help a ton.

| **summary**: | - novnc allowing open direction which could potentially be used for- phishing+ Open Redirect in noVNC proxy (CVE-2021-3654) |
| --- | --- |
| Changed in ossa: | |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-29:  [**Fix merged to ossa (master)**](/nova/%2Bbug/1927677/comments/38) |  |  | [#38](/nova/%2Bbug/1927677/comments/38) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/802590](https://review.opendev.org/c/openstack/ossa/%2B/802590)

Committed: <https://opendev.org/openstack/ossa/commit/08f2c78ccf3688ad2ed44d0c2239742ea1693cdb>

Submitter: "Zuul (22348)"

Branch: master

commit 08f2c78ccf3688ad2ed44d0c2239742ea1693cdb

Author: Jeremy Stanley <email address hidden>

Date: Tue Jul 27 17:44:41 2021 +0000

Add OSSA-2021-002 (CVE-2021-3654)

Change-Id: I1574738a9aa047314c9b933f8bbe032d346cd2d7

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/ossa/+/802590
Committed: https://opendev.org/openstack/ossa/commit/08f2c78ccf3688ad2ed44d0c2239742ea1693cdb
Submitter: "Zuul (22348)"
Branch: master
commit 08f2c78ccf3688ad2ed44d0c2239742ea1693cdb
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Tue Jul 27 17:44:41 2021 +0000
Add OSSA-2021-002 (CVE-2021-3654)
Change-Id: I1574738a9aa047314c9b933f8bbe032d346cd2d7
Closes-Bug: #1927677

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-07-29

| **summary**: | - Open Redirect in noVNC proxy (CVE-2021-3654)+ [OSSA-2021-002]Open Redirect in noVNC proxy (CVE-2021-3654) |
| --- | --- |
| **summary**: | - [OSSA-2021-002]Open Redirect in noVNC proxy (CVE-2021-3654)+ [OSSA-2021-002] Open Redirect in noVNC proxy (CVE-2021-3654) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-29:  [**Fix proposed to nova (stable/stein)**](/nova/%2Bbug/1927677/comments/39) |  |  | [#39](/nova/%2Bbug/1927677/comments/39) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/802935](https://review.opendev.org/c/openstack/nova/%2B/802935)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/802935

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/40) |  |  | [#40](/nova/%2Bbug/1927677/comments/40) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/803091](https://review.opendev.org/c/openstack/nova/%2B/803091)

Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/803091

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-31: |  |  | [#41](/nova/%2Bbug/1927677/comments/41) |
| --- | --- | --- | --- |

This ^ is just me updating the unit test coverage to work with Python < 3.6 for the courtesy stable/train and stable/stein patches. It's also a general improvement of the unit test to do less mocking.

This ^ is just me updating the unit test coverage to work with Python < 3.6 for the courtesy stable/train and stable/stein patches. It's also a general improvement of the unit test to do less mocking.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/42) |  |  | [#42](/nova/%2Bbug/1927677/comments/42) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/803092](https://review.opendev.org/c/openstack/nova/%2B/803092)

Related fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/803092

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/43) |  |  | [#43](/nova/%2Bbug/1927677/comments/43) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/803093](https://review.opendev.org/c/openstack/nova/%2B/803093)

Related fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/803093

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/44) |  |  | [#44](/nova/%2Bbug/1927677/comments/44) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/803094](https://review.opendev.org/c/openstack/nova/%2B/803094)

Related fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/803094

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-02:  [**Fix proposed to nova (stable/rocky)**](/nova/%2Bbug/1927677/comments/45) |  |  | [#45](/nova/%2Bbug/1927677/comments/45) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/nova/+/803182](https://review.opendev.org/c/openstack/nova/%2B/803182)

Fix proposed to branch: stable/rocky
Review: https://review.opendev.org/c/openstack/nova/+/803182

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#46](/nova/%2Bbug/1927677/comments/46) |
| --- | --- | --- | --- |

Hi,

me and my colleagues were noticing that the patch protects against URLs starting with two slashes, with four slashes, and with more than four slashes. Nevertheless, the patch does not seem to work in case the URL starts with three slashes, e.g.:

[http://vncproxy.my.domain.com///example.com/%2F](http://vncproxy.my.domain.com///example.com//)..

We believe that the reason behind this behaviour is the changes that the URL undergoes when it is split and then unsplit. More specifically:

>>> urlparse.urlunsplit(urlparse.urlsplit('//example.com/%2F..'))

'//example.com/%2F..'

>>> urlparse.urlunsplit(urlparse.urlsplit('///example.com/%2F..'))

'/example.com/%2F..'

>>> urlparse.urlunsplit(urlparse.urlsplit('////example.com/%2F..'))

'//example.com/%2F..'

The first and the last case will be captured by the test introduced by the patch, while the middle case will be sent to the parent class method. This can be observed with both Python 3 and Python 2.

We think that the unsplitting of the url in the patch could be avoided. In the case of Python 3, the reason for which the method is used is to add a final slash to the "path" part of the URL, but this is nevertheless not needed for our purposes (if the URL passes the validity check performed here, the splitting and unsplitting of the URL will be anyway done by the parent class method). Moreover, using the output of the urlsplit + urlunsplit methods causes the aforementioned issue.

I will soon attach a proposal for a Python 2 and a Python 3 patch. Their checks on the URL are slightly different because they mimic the checks that are done by the parent class method in order to identify a redirection case (SimpleHTTPRequestHandler.send\_head defined in SimpleHttpServer.py for Python2 and in http/server.py for Python 3). Please let me know if you are able to reproduce the same issue in your setup and what you think about this.

Hi,
me and my colleagues were noticing that the patch protects against URLs starting with two slashes, with four slashes, and with more than four slashes. Nevertheless, the patch does not seem to work in case the URL starts with three slashes, e.g.:
http://vncproxy.my.domain.com///example.com/%2F..
We believe that the reason behind this behaviour is the changes that the URL undergoes when it is split and then unsplit. More specifically:
>>> urlparse.urlunsplit(urlparse.urlsplit('//example.com/%2F..'))
'//example.com/%2F..'
>>> urlparse.urlunsplit(urlparse.urlsplit('///example.com/%2F..'))
'/example.com/%2F..'
>>> urlparse.urlunsplit(urlparse.urlsplit('////example.com/%2F..'))
'//example.com/%2F..'
The first and the last case will be captured by the test introduced by the patch, while the middle case will be sent to the parent class method. This can be observed with both Python 3 and Python 2.
We think that the unsplitting of the url in the patch could be avoided. In the case of Python 3, the reason for which the method is used is to add a final slash to the "path" part of the URL, but this is nevertheless not needed for our purposes (if the URL passes the validity check performed here, the splitting and unsplitting of the URL will be anyway done by the parent class method). Moreover, using the output of the urlsplit + urlunsplit methods causes the aforementioned issue.
I will soon attach a proposal for a Python 2 and a Python 3 patch. Their checks on the URL are slightly different because they mimic the checks that are done by the parent class method in order to identify a redirection case (SimpleHTTPRequestHandler.send\_head defined in SimpleHttpServer.py for Python2 and in http/server.py for Python 3). Please let me know if you are able to reproduce the same issue in your setup and what you think about this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#47](/nova/%2Bbug/1927677/comments/47) |
| --- | --- | --- | --- |

* [python2.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519968/%2Bfiles/python2.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519968)
  (1.2 KiB,
  text/plain)

This is a proposal for Python 2.

This is a proposal for Python 2.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#48](/nova/%2Bbug/1927677/comments/48) |
| --- | --- | --- | --- |

* [python3.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519969/%2Bfiles/python3.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519969)
  (1009 bytes,
  text/plain)

This is a proposal for Python 3.

This is a proposal for Python 3.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-23:  [**Fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/49) |  |  | [#49](/nova/%2Bbug/1927677/comments/49) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/805654

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Balazs Gibizer (balazs-gibizer)](https://launchpad.net/~balazs-gibizer) wrote on 2021-08-24: |  |  | [#50](/nova/%2Bbug/1927677/comments/50) |
| --- | --- | --- | --- |

It is confirmed that the original fix was incomplete. A new fix is being merged to master [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654) (and then backported)

It is confirmed that the original fix was incomplete. A new fix is being merged to master https://review.opendev.org/c/openstack/nova/+/805654 (and then backported)

| Changed in nova: | |
| --- | --- |
| **status**: | Fix Released → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-24:  [**Fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/51) |  |  | [#51](/nova/%2Bbug/1927677/comments/51) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654)

Committed: <https://opendev.org/openstack/nova/commit/6fbd0b758dcac71323f3be179b1a9d1c17a4acc5>

Submitter: "Zuul (22348)"

Branch: master

commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/nova/+/805654
Committed: https://opendev.org/openstack/nova/commit/6fbd0b758dcac71323f3be179b1a9d1c17a4acc5
Submitter: "Zuul (22348)"
Branch: master
commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-08-24: |  |  | [#52](/nova/%2Bbug/1927677/comments/52) |
| --- | --- | --- | --- |

I've switched the security advisory task back to incomplete for now, while the vulnerability managers debate whether this requires errata publication or a completely new advisory.

I've switched the security advisory task back to incomplete for now, while the vulnerability managers debate whether this requires errata publication or a completely new advisory.

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Released → Incomplete |
| **importance**: | Medium → Undecided |
| **assignee**: | Jeremy Stanley (fungi) → nobody |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-24:  [**Fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/53) |  |  | [#53](/nova/%2Bbug/1927677/comments/53) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/805818](https://review.opendev.org/c/openstack/nova/%2B/805818)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/805818

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-28:  [**Fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/54) |  |  | [#54](/nova/%2Bbug/1927677/comments/54) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/805818](https://review.opendev.org/c/openstack/nova/%2B/805818)

Committed: <https://opendev.org/openstack/nova/commit/47dad4836a26292e9d34e516e1525ecf00be127c>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 47dad4836a26292e9d34e516e1525ecf00be127c

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

Reviewed: https://review.opendev.org/c/openstack/nova/+/805818
Committed: https://opendev.org/openstack/nova/commit/47dad4836a26292e9d34e516e1525ecf00be127c
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 47dad4836a26292e9d34e516e1525ecf00be127c
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Related fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/55) |  |  | [#55](/nova/%2Bbug/1927677/comments/55) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803091](https://review.opendev.org/c/openstack/nova/%2B/803091)

Committed: <https://opendev.org/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af>

Submitter: "Zuul (22348)"

Branch: master

commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

Reviewed: https://review.opendev.org/c/openstack/nova/+/803091
Committed: https://opendev.org/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af
Submitter: "Zuul (22348)"
Branch: master
commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/56) |  |  | [#56](/nova/%2Bbug/1927677/comments/56) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/806626](https://review.opendev.org/c/openstack/nova/%2B/806626)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/806626

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/57) |  |  | [#57](/nova/%2Bbug/1927677/comments/57) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/806628](https://review.opendev.org/c/openstack/nova/%2B/806628)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/806628

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/58) |  |  | [#58](/nova/%2Bbug/1927677/comments/58) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/806629](https://review.opendev.org/c/openstack/nova/%2B/806629)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/806629

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-31:  [**Related fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/59) |  |  | [#59](/nova/%2Bbug/1927677/comments/59) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803092](https://review.opendev.org/c/openstack/nova/%2B/803092)

Committed: <https://opendev.org/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803092
Committed: https://opendev.org/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

| **tags**: | added: in-stable-wallaby |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-01:  [**Related fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/60) |  |  | [#60](/nova/%2Bbug/1927677/comments/60) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803093](https://review.opendev.org/c/openstack/nova/%2B/803093)

Committed: <https://opendev.org/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 94e265f3ca615aa18de0081a76975019997b8709

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803093
Committed: https://opendev.org/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 94e265f3ca615aa18de0081a76975019997b8709
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

| **tags**: | added: in-stable-victoria |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-14:  [**Related fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/61) |  |  | [#61](/nova/%2Bbug/1927677/comments/61) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803094](https://review.opendev.org/c/openstack/nova/%2B/803094)

Committed: <https://opendev.org/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit d43b88a33407b1253e7bce70f720a44f7688141f

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

    (cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803094
Committed: https://opendev.org/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit d43b88a33407b1253e7bce70f720a44f7688141f
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)
(cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

| **tags**: | added: in-stable-ussuri |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-16:  [**Fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/62) |  |  | [#62](/nova/%2Bbug/1927677/comments/62) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806626](https://review.opendev.org/c/openstack/nova/%2B/806626)

Committed: <https://opendev.org/openstack/nova/commit/9588cdbfd4649ea53d60303f2d10c5d62a070a07>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Conflicts:

      nova/tests/unit/console/test\_websocketproxy.py

NOTE: conflict is due to I58b0382c86d4ef798572edb63d311e0e3e6937bb

    is missing in Victoria and Ie36401c782f023d1d5f2623732619105dc2cfa24

    backport contained conflicts and methods order was swapped.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806626
Committed: https://opendev.org/openstack/nova/commit/9588cdbfd4649ea53d60303f2d10c5d62a070a07
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE: conflict is due to I58b0382c86d4ef798572edb63d311e0e3e6937bb
is missing in Victoria and Ie36401c782f023d1d5f2623732619105dc2cfa24
backport contained conflicts and methods order was swapped.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-17:  [**Fix included in openstack/nova 24.0.0.0rc1**](/nova/%2Bbug/1927677/comments/63) |  |  | [#63](/nova/%2Bbug/1927677/comments/63) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 24.0.0.0rc1 release candidate.

This issue was fixed in the openstack/nova 24.0.0.0rc1 release candidate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-09-24: |  |  | [#65](/nova/%2Bbug/1927677/comments/65) |
| --- | --- | --- | --- |

Note that we're still waiting for <https://review.opendev.org/806628> (stable/ussuri) to merge prior to issuing errata, but its merging is held up by discussions of whether to fix or discontinue running lower bounds testing for dependencies on that branch.

Note that we're still waiting for https://review.opendev.org/806628 (stable/ussuri) to merge prior to issuing errata, but its merging is held up by discussions of whether to fix or discontinue running lower bounds testing for dependencies on that branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-09-24: |  |  | [#66](/nova/%2Bbug/1927677/comments/66) |
| --- | --- | --- | --- |

We have actually been rechecking this change to make the l-c job non-voting on stable/ussuri:

[https://review.opendev.org/c/openstack/nova/+/809955](https://review.opendev.org/c/openstack/nova/%2B/809955)

But it has run into failure after unrelated failure in the gate. I have been copy pasting the various errors with every recheck.

We have actually been rechecking this change to make the l-c job non-voting on stable/ussuri:
https://review.opendev.org/c/openstack/nova/+/809955
But it has run into failure after unrelated failure in the gate. I have been copy pasting the various errors with every recheck.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-26:  [**Fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/67) |  |  | [#67](/nova/%2Bbug/1927677/comments/67) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806628](https://review.opendev.org/c/openstack/nova/%2B/806628)

Committed: <https://opendev.org/openstack/nova/commit/0997043f459ac616b594363b5b253bd0ae6ed9eb>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 0997043f459ac616b594363b5b253bd0ae6ed9eb

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

    (cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806628
Committed: https://opendev.org/openstack/nova/commit/0997043f459ac616b594363b5b253bd0ae6ed9eb
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 0997043f459ac616b594363b5b253bd0ae6ed9eb
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)
(cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-27:  [**Fix proposed to ossa (master)**](/nova/%2Bbug/1927677/comments/68) |  |  | [#68](/nova/%2Bbug/1927677/comments/68) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/811181](https://review.opendev.org/c/openstack/ossa/%2B/811181)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/811181

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-27:  [**Fix merged to ossa (master)**](/nova/%2Bbug/1927677/comments/69) |  |  | [#69](/nova/%2Bbug/1927677/comments/69) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/811181](https://review.opendev.org/c/openstack/ossa/%2B/811181)

Committed: <https://opendev.org/openstack/ossa/commit/51a1bf0699128c8ddcb7567347cee69492601091>

Submitter: "Zuul (22348)"

Branch: master

commit 51a1bf0699128c8ddcb7567347cee69492601091

Author: Jeremy Stanley <email address hidden>

Date: Mon Sep 27 15:02:06 2021 +0000

Errata 1 for OSSA-2021-002

Change-Id: Iaeb40574176ae62542a0c17e94917e654d38317d

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/ossa/+/811181
Committed: https://opendev.org/openstack/ossa/commit/51a1bf0699128c8ddcb7567347cee69492601091
Submitter: "Zuul (22348)"
Branch: master
commit 51a1bf0699128c8ddcb7567347cee69492601091
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Mon Sep 27 15:02:06 2021 +0000
Errata 1 for OSSA-2021-002
Change-Id: Iaeb40574176ae62542a0c17e94917e654d38317d
Closes-Bug: #1927677

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-09-27: |  |  | [#70](/nova/%2Bbug/1927677/comments/70) |
| --- | --- | --- | --- |

OSSA-2021-002 errata 1 has been published and distributed to usual mailing lists.

OSSA-2021-002 errata 1 has been published and distributed to usual mailing lists.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 22.3.0**](/nova/%2Bbug/1927677/comments/71) |  |  | [#71](/nova/%2Bbug/1927677/comments/71) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 22.3.0 release.

This issue was fixed in the openstack/nova 22.3.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 23.1.0**](/nova/%2Bbug/1927677/comments/73) |  |  | [#73](/nova/%2Bbug/1927677/comments/73) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 23.1.0 release.

This issue was fixed in the openstack/nova 23.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 21.2.3**](/nova/%2Bbug/1927677/comments/74) |  |  | [#74](/nova/%2Bbug/1927677/comments/74) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 21.2.3 release.

This issue was fixed in the openstack/nova 21.2.3 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-28:  [**Fix merged to nova (stable/train)**](/nova/%2Bbug/1927677/comments/76) |  |  | [#76](/nova/%2Bbug/1927677/comments/76) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/nova/%2Bbug/1927677/comments/76/%2Bdownload) (3.2 KiB)

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791807](https://review.opendev.org/c/openstack/nova/%2B/791807)

Committed: <https://opendev.org/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 04d48527b62a35d912f93bc75613a6cca606df66

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

NOTE(melwitt): This is the combination of two commits, the bug fix and

    a followup change to the unit test to enable it also run on

    Python < 3.6.

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train.

NOTE(melwitt): The difference from the cherry picked change:

    HTTPStatus.BAD\_REQUEST => 400 is due to the fact that HTTPStatus does

    not exist in Python 2.7.

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

    (cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

    (cherry picked from commit d43b88a33407b1253e7bce70f720a44f7688141f)

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

    (cherry picked from commit 6b70350bdcf5...

[Read more...](/nova/%2Bbug/1927677/comments/76)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791807
Committed: https://opendev.org/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66
Submitter: "Zuul (22348)"
Branch: stable/train
commit 04d48527b62a35d912f93bc75613a6cca606df66
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
NOTE(melwitt): This is the combination of two commits, the bug fix and
a followup change to the unit test to enable it also run on
Python < 3.6.
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train.
NOTE(melwitt): The difference from the cherry picked change:
HTTPStatus.BAD\_REQUEST => 400 is due to the fact that HTTPStatus does
not exist in Python 2.7.
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)
(cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)
(cherry picked from commit d43b88a33407b1253e7bce70f720a44f7688141f)
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)
(cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)
(cherry picked from commit 719e651e6be277950632e0c2cf5cc9a018344e7b)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-11-01: |  |  | [#77](/nova/%2Bbug/1927677/comments/77) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806629](https://review.opendev.org/c/openstack/nova/%2B/806629)

Committed: <https://opendev.org/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 8906552cfc2525a44251d4cf313ece61e57251eb

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Conflicts:

      nova/console/websocketproxy.py

      nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict and difference in websocketproxy.py from

    the cherry picked change: HTTPStatus.BAD\_REQUEST => 400 is due to the

    fact that HTTPStatus does not exist in Python 2.7. The conflict in

    test\_websocketproxy.py is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train. The difference

    in test\_websocketproxy.py from the cherry picked change is due to a

    difference in internal implementation [1] in Python < 3.6. See change

    I546d376869a992601b443fb95acf1034da2a8f36 for reference.

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

    (cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

    (cherry picked from commit 0997043f459ac616b594363b5b253bd0ae6ed9eb)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806629
Committed: https://opendev.org/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb
Submitter: "Zuul (22348)"
Branch: stable/train
commit 8906552cfc2525a44251d4cf313ece61e57251eb
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Conflicts:
nova/console/websocketproxy.py
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict and difference in websocketproxy.py from
the cherry picked change: HTTPStatus.BAD\_REQUEST => 400 is due to the
fact that HTTPStatus does not exist in Python 2.7. The conflict in
test\_websocketproxy.py is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train. The difference
in test\_websocketproxy.py from the cherry picked change is due to a
difference in internal implementation [1] in Python < 3.6. See change
I546d376869a992601b443fb95acf1034da2a8f36 for reference.
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)
(cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)
(cherry picked from commit 0997043f459ac616b594363b5b253bd0ae6ed9eb)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-11-08:  [**Fix proposed to nova (stable/stein)**](/nova/%2Bbug/1927677/comments/78) |  |  | [#78](/nova/%2Bbug/1927677/comments/78) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/817037](https://review.opendev.org/c/openstack/nova/%2B/817037)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/817037

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-08-17:  [**Related fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/79) |  |  | [#79](/nova/%2Bbug/1927677/comments/79) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/853379](https://review.opendev.org/c/openstack/nova/%2B/853379)

Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/853379

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-08-30:  [**Related fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/80) |  |  | [#80](/nova/%2Bbug/1927677/comments/80) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/853379](https://review.opendev.org/c/openstack/nova/%2B/853379)

Committed: <https://opendev.org/openstack/nova/commit/15769b883ed4a86d62b141ea30d3f1590565d8e0>

Submitter: "Zuul (22348)"

Branch: master

commit 15769b883ed4a86d62b141ea30d3f1590565d8e0

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

Reviewed: https://review.opendev.org/c/openstack/nova/+/853379
Committed: https://opendev.org/openstack/nova/commit/15769b883ed4a86d62b141ea30d3f1590565d8e0
Submitter: "Zuul (22348)"
Branch: master
commit 15769b883ed4a86d62b141ea30d3f1590565d8e0
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11:  [**Change abandoned on nova (stable/rocky)**](/nova/%2Bbug/1927677/comments/81) |  |  | [#81](/nova/%2Bbug/1927677/comments/81) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/nova/+/803182](https://review.opendev.org/c/openstack/nova/%2B/803182)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/rocky
Review: https://review.opendev.org/c/openstack/nova/+/803182
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11:  [**Change abandoned on nova (stable/stein)**](/nova/%2Bbug/1927677/comments/82) |  |  | [#82](/nova/%2Bbug/1927677/comments/82) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/817037](https://review.opendev.org/c/openstack/nova/%2B/817037)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/817037
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11: |  |  | [#83](/nova/%2Bbug/1927677/comments/83) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/802935](https://review.opendev.org/c/openstack/nova/%2B/802935)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/802935
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/yoga)**](/nova/%2Bbug/1927677/comments/84) |  |  | [#84](/nova/%2Bbug/1927677/comments/84) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/yoga

Review: [https://review.opendev.org/c/openstack/nova/+/866192](https://review.opendev.org/c/openstack/nova/%2B/866192)

Related fix proposed to branch: stable/yoga
Review: https://review.opendev.org/c/openstack/nova/+/866192

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/xena)**](/nova/%2Bbug/1927677/comments/85) |  |  | [#85](/nova/%2Bbug/1927677/comments/85) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/xena

Review: [https://review.opendev.org/c/openstack/nova/+/866193](https://review.opendev.org/c/openstack/nova/%2B/866193)

Related fix proposed to branch: stable/xena
Review: https://review.opendev.org/c/openstack/nova/+/866193

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/86) |  |  | [#86](/nova/%2Bbug/1927677/comments/86) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/866194](https://review.opendev.org/c/openstack/nova/%2B/866194)

Related fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/866194

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/87) |  |  | [#87](/nova/%2Bbug/1927677/comments/87) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/866195](https://review.opendev.org/c/openstack/nova/%2B/866195)

Related fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/866195

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/88) |  |  | [#88](/nova/%2Bbug/1927677/comments/88) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/866196](https://review.opendev.org/c/openstack/nova/%2B/866196)

Related fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/866196

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/89) |  |  | [#89](/nova/%2Bbug/1927677/comments/89) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/866201](https://review.opendev.org/c/openstack/nova/%2B/866201)

Related fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/866201

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-12-20:  [**Related fix merged to nova (stable/yoga)**](/nova/%2Bbug/1927677/comments/90) |  |  | [#90](/nova/%2Bbug/1927677/comments/90) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866192](https://review.opendev.org/c/openstack/nova/%2B/866192)

Committed: <https://opendev.org/openstack/nova/commit/4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af>

Submitter: "Zuul (22348)"

Branch: stable/yoga

commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866192
Committed: https://opendev.org/openstack/nova/commit/4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af
Submitter: "Zuul (22348)"
Branch: stable/yoga
commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

| **tags**: | added: in-stable-yoga |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/xena)**](/nova/%2Bbug/1927677/comments/91) |  |  | [#91](/nova/%2Bbug/1927677/comments/91) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866193](https://review.opendev.org/c/openstack/nova/%2B/866193)

Committed: <https://opendev.org/openstack/nova/commit/0e4a257e8636a979605c614a35e79ba47b74d870>

Submitter: "Zuul (22348)"

Branch: stable/xena

commit 0e4a257e8636a979605c614a35e79ba47b74d870

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866193
Committed: https://opendev.org/openstack/nova/commit/0e4a257e8636a979605c614a35e79ba47b74d870
Submitter: "Zuul (22348)"
Branch: stable/xena
commit 0e4a257e8636a979605c614a35e79ba47b74d870
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

| **tags**: | added: in-stable-xena |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/92) |  |  | [#92](/nova/%2Bbug/1927677/comments/92) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866194](https://review.opendev.org/c/openstack/nova/%2B/866194)

Committed: <https://opendev.org/openstack/nova/commit/3023e162e1a415ddaa70b4b8fbe24b1771dbe424>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866194
Committed: https://opendev.org/openstack/nova/commit/3023e162e1a415ddaa70b4b8fbe24b1771dbe424
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/93) |  |  | [#93](/nova/%2Bbug/1927677/comments/93) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866195](https://review.opendev.org/c/openstack/nova/%2B/866195)

Committed: <https://opendev.org/openstack/nova/commit/77bc3f004e7fe4077ea035c659630bedef1cfea1>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 77bc3f004e7fe4077ea035c659630bedef1cfea1

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I58b0382c86d4ef798572edb63d311e0e3e6937bb

    (Refactor and rename test\_tcp\_rst\_no\_compute\_rpcapi) is not in

    Victoria.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866195
Committed: https://opendev.org/openstack/nova/commit/77bc3f004e7fe4077ea035c659630bedef1cfea1
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 77bc3f004e7fe4077ea035c659630bedef1cfea1
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I58b0382c86d4ef798572edb63d311e0e3e6937bb
(Refactor and rename test\_tcp\_rst\_no\_compute\_rpcapi) is not in
Victoria.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-11:  [**Related fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/94) |  |  | [#94](/nova/%2Bbug/1927677/comments/94) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866196](https://review.opendev.org/c/openstack/nova/%2B/866196)

Committed: <https://opendev.org/openstack/nova/commit/746d654c23d75f084b6f0c70e6c32b97eebf419c>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 746d654c23d75f084b6f0c70e6c32b97eebf419c

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

    (cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866196
Committed: https://opendev.org/openstack/nova/commit/746d654c23d75f084b6f0c70e6c32b97eebf419c
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 746d654c23d75f084b6f0c70e6c32b97eebf419c
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)
(cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-11:  [**Related fix merged to nova (stable/train)**](/nova/%2Bbug/1927677/comments/95) |  |  | [#95](/nova/%2Bbug/1927677/comments/95) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866201](https://review.opendev.org/c/openstack/nova/%2B/866201)

Committed: <https://opendev.org/openstack/nova/commit/43af75243b79e95330ecd982552d568571623e39>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 43af75243b79e95330ecd982552d568571623e39

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train. The difference

    from the cherry picked change is because the flake8 version on the

    stable/train branch does not support f-strings [1].

Related-Bug: #1927677

    Closes-Bug: #1986545

[1] <https://lists.openstack.org/pipermail/openstack-discuss/2019-November/011027.html>

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

    (cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

    (cherry picked from commit 746d654c23d75f084b6f0c70e6c32b97eebf419c)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866201
Committed: https://opendev.org/openstack/nova/commit/43af75243b79e95330ecd982552d568571623e39
Submitter: "Zuul (22348)"
Branch: stable/train
commit 43af75243b79e95330ecd982552d568571623e39
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train. The difference
from the cherry picked change is because the flake8 version on the
stable/train branch does not support f-strings [1].
Related-Bug: #1927677
Closes-Bug: #1986545
[1] https://lists.openstack.org/pipermail/openstack-discuss/2019-November/011027.html
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)
(cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)
(cherry picked from commit 746d654c23d75f084b6f0c70e6c32b97eebf419c)

| **tags**: | added: in-stable-train |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-08-31:  [**Fix included in openstack/nova train-eol**](/nova/%2Bbug/1927677/comments/96) |  |  | [#96](/nova/%2Bbug/1927677/comments/96) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova train-eol release.

This issue was fixed in the openstack/nova train-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Lucas (lucas6)](https://launchpad.net/~lucas6) wrote on 2024-09-10: |  |  | [#98](/nova/%2Bbug/1927677/comments/98) |
| --- | --- | --- | --- |

Python fix an open redirection vulnerability(CVE-2021-28861) in the HTTP server when an URI path starts with //[1]. Reducing to a single /, the Nova patch[2] for fixing the CVE-2021-3654 vulnerability does not take effect.

For example:

The URI patch is changed from ////example.com/%2F.. to /example.com/%2F.. and passed to Nova.

[1] <https://github.com/python/cpython/commit/5715382d3a89ca118ce2e224d8c69550d21fe51b>

[2] [https://review.opendev.org/c/openstack/nova/+/806629/6/nova/console/websocketproxy.py](https://review.opendev.org/c/openstack/nova/%2B/806629/6/nova/console/websocketproxy.py)

Python fix an open redirection vulnerability(CVE-2021-28861) in the HTTP server when an URI path starts with //[1]. Reducing to a single /, the Nova patch[2] for fixing the CVE-2021-3654 vulnerability does not take effect.
For example:
The URI patch is changed from ////example.com/%2F.. to /example.com/%2F.. and passed to Nova.
[1] https://github.com/python/cpython/commit/5715382d3a89ca118ce2e224d8c69550d21fe51b
[2] https://review.opendev.org/c/openstack/nova/+/806629/6/nova/console/websocketproxy.py

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-09-10: |  |  | [#99](/nova/%2Bbug/1927677/comments/99) |
| --- | --- | --- | --- |

Lucas: Are you possibly just rediscovering related [bug 1986545](/bugs/1986545)?

Lucas: Are you possibly just rediscovering related bug 1986545?

[See full activity log](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/nova/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

## Duplicates of this bug

* [Bug #1988302](https://bugs.launchpad.net/nova/%2Bbug/1988302 "novncproxy open redirect")

You are
[not directly subscribed to this bug's notifications.](/nova/%2Bbug/1927677/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [lp1927677.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5496768/%2Bfiles/lp1927677.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5496768 "Change patch details")
* [python2.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519968/%2Bfiles/python2.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519968 "Change patch details")
* [python3.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519969/%2Bfiles/python3.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519969 "Change patch details")

* [Add patch](/nova/%2Bbug/1927677/%2Baddcomment?field.patch=on)

## Remote bug watches

* [python-roundup #32084](http://bugs.python.org/issue32084)

  [2:2]
  [Edit](/bugs/1927677/%2Bwatch/142925 "Change watch details")
* [python-roundup #43223](http://bugs.python.org/issue43223)

  [1:None]
  [Edit](/bugs/1927677/%2Bwatch/143534 "Change watch details")
* [auto-github-novnc-novnc #748](https://github.com/novnc/noVNC/issues/748)

  [closed bug]
  [Edit](/bugs/1927677/%2Bwatch/142896 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from security.openstack.org_8184aaa0_20250115_123924.html ===


Toggle navigation

 Search

* [Software](https://www.openstack.org/software/)
  + [Overview](https://www.openstack.org/software/)
  + [OpenStack Components](https://www.openstack.org/software/project-navigator/openstack-components)
  + [SDKs](https://www.openstack.org/software/project-navigator/sdks)
  + [Deployment Tools](https://www.openstack.org/software/project-navigator/deployment-tools)
  + [OpenStack Map](https://www.openstack.org/assets/software/projectmap/openstack-map.pdf)
  + [Sample Configs](https://www.openstack.org/software/sample-configs/)
* [Use Cases](https://www.openstack.org/use-cases/)
  + [Users in Production](https://www.openstack.org/use-cases/)
  + [Ironic Bare Metal](https://www.openstack.org/use-cases/bare-metal/)
  + [Edge Computing](https://www.openstack.org/use-cases/edge-computing/)
  + [Telecom & NFV](https://www.openstack.org/use-cases/telecoms-and-nfv/)
  + [Science and HPC](https://www.openstack.org/use-cases/science/)
  + [Containers](https://www.openstack.org/use-cases/containers/)
  + [Enterprise](https://www.openstack.org/use-cases/enterprise/)
  + [User Survey](https://www.openstack.org/surveys/landing)
* [Events](https://openinfra.dev/summit)
  + [OpenInfra Summit](https://openinfra.dev/summit)
  + [Project Teams Gathering](https://www.openstack.org/ptg/)
  + [OpenDev](https://www.openstack.org/events/opendev-2020/)
  + [Community Events](https://www.openstack.org/events/community-events/)
  + [OpenStack & OpenInfra Days](https://www.openstack.org/events/openstackdays)
  + [Summit Videos](https://www.openstack.org/videos/)
* [Community](https://www.openstack.org/community/)
  + [Welcome! Start Here](https://www.openstack.org/community/)
  + [OpenStack Technical Committee](https://www.openstack.org/community/tech-committee)
  + [Speakers Bureau](https://www.openstack.org/community/speakers/)
  + [OpenStack Wiki](http://wiki.openstack.org)
  + [Get Certified (COA)](https://www.openstack.org/coa/)
  + [Jobs](https://www.openstack.org/community/jobs/)
  + [Marketing Resources](https://www.openstack.org/marketing/)
  + [Community News](https://www.openstack.org/news/)
  + [Superuser Magazine](http://superuser.openstack.org)
  + [OpenInfra Foundation Supporting Organizations](https://www.openstack.org/community/supporting-organizations/)
  + [OpenInfra Foundation](https://openinfra.dev)
* [Marketplace](https://www.openstack.org/marketplace/)
  + [Training](https://www.openstack.org/marketplace/training/)
  + [Distros & Appliances](https://www.openstack.org/marketplace/distros/)
  + [Public Clouds](https://www.openstack.org/marketplace/public-clouds/)
  + [Hosted Private Clouds](https://www.openstack.org/marketplace/hosted-private-clouds/)
  + [Remotely Managed Private Clouds](https://www.openstack.org/marketplace/remotely-managed-private-clouds/)
  + [Consulting & Integrators](https://www.openstack.org/marketplace/consulting/)
  + [Drivers](https://www.openstack.org/marketplace/drivers/)
* [Blog](https://www.openstack.org/blog/)
* [Docs](http://docs.openstack.org/)
* [Join](https://openinfra.dev/join/)
  + [Sign up for Foundation Membership](https://openinfra.dev/join/)
  + [Sponsor the Foundation](https://openinfra.dev/join/)
  + [More about the Foundation](https://openinfra.dev)
* [Log In](https://www.openstack.org/Security/login/?BackURL=/home/)

# OSSA-2021-002: Open Redirect in noVNC proxy

# OSSA-2021-002: Open Redirect in noVNC proxy[Â¶](#ossa-2021-002-open-redirect-in-novnc-proxy "Link to this heading")

Date:

July 29, 2021

CVE:

CVE-2021-3654

## Affects[Â¶](#affects "Link to this heading")

* Nova: <21.2.3, >=22.0.0 <22.2.3, >=23.0.0 <23.0.3

## Description[Â¶](#description "Link to this heading")

Swe Aung, Shahaan Ayyub, and Salman Khan with the Monash University Cyber Security team reported a vulnerability affecting Novaâs noVNC proxying implementation which exposed access to a well-known redirect behavior in the Python standard libraryâs http.server.SimpleHTTPRequestHandler and thus noVNCâs WebSockifyRequestHandler which uses it. By convincing a user to follow a specially-crafted novncproxy URL, the user could be redirected to an unrelated site under control of the attacker in an attempt to convince them to divulge credentials or other sensitive data. All Nova deployments with novncproxy enabled are affected.

## Errata[Â¶](#errata "Link to this heading")

The initial fix did not take into account the possibility of bypass using exactly three slashes. This update provides a more thorough revised fix for the issue. The affected versions list has been updated to indicate versions expected to include the newer solution.

## Patches[Â¶](#patches "Link to this heading")

* <https://review.opendev.org/791807> (Train)
* <https://review.opendev.org/806629> (errata 1) (Train)
* <https://review.opendev.org/791806> (Ussuri)
* <https://review.opendev.org/806628> (errata 1) (Ussuri)
* <https://review.opendev.org/791805> (Victoria)
* <https://review.opendev.org/806626> (errata 1) (Victoria)
* <https://review.opendev.org/791577> (Wallaby)
* <https://review.opendev.org/805818> (errata 1) (Wallaby)
* <https://review.opendev.org/791297> (Xena)
* <https://review.opendev.org/805654> (errata 1) (Xena)

## Credits[Â¶](#credits "Link to this heading")

* Swe Aung from Monash University Cyber Security team (CVE-2021-3654)
* Shahaan Ayyub from Monash University Cyber Security team (CVE-2021-3654)
* Salman Khan from Monash University Cyber Security team (CVE-2021-3654)

## References[Â¶](#references "Link to this heading")

* <https://launchpad.net/bugs/1927677>
* <https://bugs.python.org/issue32084>
* <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3654>

## Notes[Â¶](#notes "Link to this heading")

* The stable/train branch is under extended maintenance and will receive
  no new point releases, but a patch for it is provided as a courtesy.

## OSSA History[Â¶](#ossa-history "Link to this heading")

* 2021-09-27 - Errata 1
* 2021-07-29 - Original Version

this page last updated: 2025-01-07 18:17:35

[![Creative Commons Attribution 3.0 License](../_static/images/docs/license.png)](https://creativecommons.org/licenses/by/3.0/)

Except where otherwise noted, this document is licensed under
[Creative Commons
Attribution 3.0 License](https://creativecommons.org/licenses/by/3.0/). See all [OpenStack Legal Documents](https://www.openstack.org/legal).

found an error? report a bug

OpenStack Documentation

* Guides
* [Install Guides](https://docs.openstack.org/index.html#install-guides)
* [User Guides](https://docs.openstack.org/index.html#user-guides)
* [Configuration Guides](https://docs.openstack.org/index.html#configuration-guides)
* [Operations and Administration Guides](https://docs.openstack.org/index.html#ops-and-admin-guides)
* [API Guides](https://docs.openstack.org/index.html#api-guides)
* [Contributor Guides](https://docs.openstack.org/index.html#contributor-guides)
* Languages
* [Deutsch (German)](https://docs.openstack.org/de/)
* [FranÃ§ais (French)](https://docs.openstack.org/fr/)
* [Bahasa Indonesia (Indonesian)](https://docs.openstack.org/id/)
* [Italiano (Italian)](https://docs.openstack.org/it/)
* [æ¥æ¬èª (Japanese)](https://docs.openstack.org/ja/)
* [íêµ­ì´ (Korean)](https://docs.openstack.org/ko_KR/)
* [PortuguÃªs (Portuguese)](https://docs.openstack.org/pt_BR/)
* [TÃ¼rkÃ§e (TÃ¼rkiye)](https://docs.openstack.org/tr_TR/)
* [ç®ä½ä¸­æ (Simplified Chinese)](https://docs.openstack.org/zh_CN/)

#### Contents

* OSSA-2021-002: Open Redirect in noVNC proxy
  + [Affects](#affects)
  + [Description](#description)
  + [Errata](#errata)
  + [Patches](#patches)
  + [Credits](#credits)
  + [References](#references)
  + [Notes](#notes)
  + [OSSA History](#ossa-history)

### OpenStack

* [Projects](https://www.openstack.org/software/project-navigator/)
* [OpenStack Security](https://security.openstack.org/)
* [Blog](https://openstack.org/blog/)
* [News](https://openstack.org/news/)

### Community

* [User Groups](https://www.meetup.com/pro/openinfradev/)
* [Events](https://openstack.org/community/events/)
* [Jobs](https://openstack.org/community/jobs/)
* [Companies](https://openinfra.dev/members/)
* [Contribute](https://docs.openstack.org/contributors)

### Documentation

* [OpenStack Manuals](https://docs.openstack.org)
* [Getting Started](https://openstack.org/software/start/)
* [API Documentation](https://developer.openstack.org)
* [Wiki](https://wiki.openstack.org)

### Branding & Legal

* [Legal Docs](https://openinfra.dev/legal)
* [Logos & Guidelines](https://openstack.org/brand/)
* [Trademark Policy](https://openinfra.dev/legal/trademark-policy)
* [Privacy Policy](https://openinfra.dev/privacy-policy)
* [OpenInfra CLA](https://docs.openstack.org/contributors/common/setup-gerrit.html#individual-contributor-license-agreement)

### Stay In Touch

The OpenStack project is provided under the
[Apache 2.0 license](https://www.apache.org/licenses/LICENSE-2.0). Docs.openstack.org is powered by
[Rackspace Cloud Computing](https://rackspace.com).



=== Content from launchpad.net_10d41e1e_20250115_194622.html ===

[Log in / Register](https://launchpad.net/~nickthetait/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~nickthetait)

## [Nick Tait](https://launchpad.net/~nickthetait)

* Overview
* [Code](https://code.launchpad.net/~nickthetait)
* [Bugs](https://bugs.launchpad.net/~nickthetait)
* [Blueprints](https://blueprints.launchpad.net/~nickthetait)
* [Translations](https://translations.launchpad.net/~nickthetait)
* [Answers](https://answers.launchpad.net/~nickthetait)

* [Related packages](https://launchpad.net/~nickthetait/%2Brelated-packages)
* [Related projects](https://launchpad.net/~nickthetait/%2Brelated-projects)

## User information

Launchpad Id:
nickthetait

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-01-23

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)

Languages:

English, Spanish

SSH keys:

[ntait@redhat.com](%2Bsshkeys)

Time zone:

US/Mountain
(UTC-0700)

Karma:
[0](https://launchpad.net/~nickthetait/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**nickthetait**
 on
**chat.freenode.net**

## [All memberships](https://launchpad.net/~nickthetait/%2Bparticipation) Latest memberships

| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2018-03-22 | |
| --- | --- |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_22884c23_20250115_194625.html ===

[Log in / Register](https://launchpad.net/~fungi/%2Blogin)

[![](https://launchpadlibrarian.net/112681987/gnome-gmush-64.png)](https://launchpad.net/~fungi)

## [Jeremy Stanley](https://launchpad.net/~fungi)

* Overview
* [Code](https://code.launchpad.net/~fungi)
* [Bugs](https://bugs.launchpad.net/~fungi)
* [Blueprints](https://blueprints.launchpad.net/~fungi)
* [Translations](https://translations.launchpad.net/~fungi)
* [Answers](https://answers.launchpad.net/~fungi)

<http://fungi.yuggoth.org/>

* [Related packages](https://launchpad.net/~fungi/%2Brelated-packages)
* [Related projects](https://launchpad.net/~fungi/%2Brelated-projects)

## User information

Launchpad Id:
fungi

Email:
[Log in](%2Blogin) for email information.

Member since:
2006-06-16

[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)
[![Icon of OpenStack Vulnerability Management team](https://launchpadlibrarian.net/83816787/icon.png "Member of OpenStack Vulnerability Management team")](/~openstack-vuln-mgmt)
[![Icon of Python OpenStack Client Bugs](https://launchpadlibrarian.net/697274771/osc-icon.png "Member of Python OpenStack Client Bugs")](/~python-openstackclient-bugs)
[![Icon of Python OpenStack Client](https://launchpadlibrarian.net/697274843/osc-icon.png "Member of Python OpenStack Client")](/~python-openstackclient)
[![Icon of Swift](https://launchpadlibrarian.net/52560230/os14.png "Member of Swift")](/~swift)

Languages:

English

OpenPGP keys:

97AE496FC02DEC9FC353B2E748F9961143495829

SSH keys:

[fungi@yuggoth.org](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[342](https://launchpad.net/~fungi/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**fungi**
 on
**irc.libera.chat**

![IRC](/@@/social-irc "IRC")
**fungi**
 on
**irc.oftc.net**

## [All bugs in progress](https://launchpad.net/~fungi/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1354829 [Booting from stale snapshots in rax-dfw leads to miscellaneous failures](https://bugs.launchpad.net/openstack-ci/%2Bbug/1354829) |  |
| --- | --- | --- |
| in [OpenStack Core Infrastructure](/openstack-ci), [OpenStack Dashboard (Horizon)](/horizon), [neutron](/neutron), [tempest](/tempest) | | |

| --- | --- | --- | --- | --- | --- |

## [All memberships](https://launchpad.net/~fungi/%2Bparticipation) Latest memberships

| [Oslo Core security contacts](/~oslo-coresec)  Joined on 2023-10-02 | |
| --- | --- |
| [Glance Release](/~glance-release)  Joined on 2021-07-27 | |
| [Ubuntu SSO 2-factor testers](/~sso-2f-testers)  Joined on 2020-11-12 | |
| [OpenDev Two-Factor Authentication](/~opendev-2fa)  Joined on 2020-11-05 | |
| [Trove Drivers](/~trove-drivers)  Joined on 2020-06-22 | |

## [Recent activities](https://launchpad.net/~fungi/%2Bkarma) Most active in

| [OpenStack Security Advisory](/ossa) |  |  |
| --- | --- | --- |
| [Ubuntu](/ubuntu) |  |  |
| [OpenStack Compute (nova)](/nova) |  |  |
| [OpenStack Security Notes](/ossn) |  |  |
| [Ubuntu Cloud Archive](/cloud-archive) |  |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_504f73d9_20250115_194621.html ===

[Log in / Register](https://launchpad.net/%2Blogin)

![Launchpad logo and name](/@@/launchpad-logo-and-name.svg)

---

Search

Search

**47,156** projects,
**2,042,151** bugs,
**1,009,605** branches,
**86,512** Git repositories,
**3,148,900** translations,
**817,650** answers,
**76,148** blueprints,
and counting...

## Launchpad

#### A software collaboration platform that provides

#### [Bug tracking](https://bugs.launchpad.net/)

One place to track bugs across project boundaries and tools

#### [Code hosting](https://code.launchpad.net/) using [Git](https://git-scm.com/) and [Bazaar](http://bazaar.canonical.com/)

Easy for anyone to get your project's code using Git or Bazaar

#### [Code reviews](https://help.launchpad.net/Code/Review)

Full control of who can land code in your project remains with you

#### [Ubuntu package building and hosting](https://launchpad.net/ubuntu)

Publishing your software is simple with Personal Package Archives

#### [Crowd source translations](https://translations.launchpad.net/)

Build an open community to translate your software into almost any language

#### [Mailing lists](https://help.launchpad.net/Teams/MailingLists)

Find and work with the right people by building a social network of individuals and teams around projects

#### [Answer tracking and FAQs](https://answers.launchpad.net/)

Free software thrives on people helping each other when the unexpected happens

#### [Specification tracking](https://blueprints.launchpad.net/)

Track ideas and chunks of work as “blueprints”

## Get started

Learn more about Launchpad in the
[user guide](https://help.launchpad.net/).

If you're ready, you can:

* ![add](/@@/add-homepage.png)
  #### [Create an account](/%2Blogin)
* ![tour](/@@/tour-homepage.png)
  #### [Take the tour](/%2Btour)
* ![question](/@@/question-homepage.png)
  #### [Find answers](https://answers.launchpad.net/)

## Featured projects

* ![Beautiful Soup](/@@/product-logo)
  #### [Beautiful Soup](/beautifulsoup)

  A program designed for screen-scraping HTML. The discussion group is at: http://groups.google.com...
* ![Breezy](/@@/product-logo)
  #### [Breezy](/brz)

  Breezy is a friendly powerful distributed version control system.
* ![Inkscape](https://launchpadlibrarian.net/66795469/ink-lp-logo.png)
  #### [Inkscape](/inkscape)

  Inkscape is an SVG-based graphics editor featuring alpha
  blending, node editing, SVG to PNG exp...
* ![Launchpad itself](https://launchpadlibrarian.net/600817174/Canonical_Launchpad_icon_64px.png)
  #### [Launchpad itself](/launchpad)

  Launchpad is a set of Web services to help software developers collaborate.
* ![OpenMW](/@@/product-logo)
  #### [OpenMW](/openmw)

  OpenMW is an attempt to reimplement the popular role playing game Morrowind. It aims to be a full...
* ![OpenShot Video Editor](https://launchpadlibrarian.net/250357498/OpenShot-2-Logo.png)
  #### [OpenShot Video Editor](/openshot)

  OpenShot Video Editor is a free, open-source, non-linear video editor. It can create and edit vid...
* ![OpenStack](https://launchpadlibrarian.net/52042558/os64.png)
  #### [OpenStack](/openstack)

  The OpenStack Open Source Cloud Mission: to produce the ubiquitous Open Source Cloud Computing pl...
* ![txpkgupload](/@@/product-logo)
  #### [txpkgupload](/txpkgupload)

  Package upload server used by Launchpad.
* ![Ubuntu](https://launchpadlibrarian.net/606381979/CoF%2064px.png)
  #### [Ubuntu](/ubuntu)

  Ubuntu is a complete Linux-based operating system, freely available with both community and profe...

* **[Browse all
  47156
  projects](/projects)!**

## Recent Launchpad blog posts

[Read the blog](http://blog.launchpad.net)

* [Introducing Launchpad Bug Templates](https://blog.launchpad.net/general/introducing-launchpad-bug-templates)
  – 03 Dec 2024

  The new feature bug templates in Launchpad aims to streamline the bug reporting process, making it more efficient for both users and project maintainers. In the past, Launchpad provided only a basic description field for filling bug reports. This often led to incomplete or vague submissions, as users may not include essential details or steps […]
* [Launchpad’s new homepage](https://blog.launchpad.net/general/launchpads-new-homepage)
  – 01 Mar 2024

  Launchpad’s new homepage Launchpad has been around for a while, and its frontpage has remained untouched for a few years now. If you go into launchpad.net, you’ll notice it looks quite different from what it has looked like for the past 10 years – it has been updated! The goal was to modernize it while […]
* [Launchpad-linked federated Matrix accounts](https://blog.launchpad.net/general/launchpad-verified-federated-matrix-accounts)
  – 22 Jan 2024

  Users can now add their Matrix accounts to their profile in Launchpad, as requested by Canonical’s Community team. We also took the chance to slightly rework the frontend and how we display social accounts in the user profiles. Instead of having different sections in the profile for each social account , all social accounts are […]
* [Self-service riscv64 builds](https://blog.launchpad.net/ppa/self-service-riscv64-builds)
  – 22 Nov 2023

  Launchpad has supported building for riscv64 for a while, since it was a requirement to get Ubuntu’s riscv64 port going. We don’t actually have riscv64 hardware in our datacentre, since we’d need server-class hardware with the hypervisor extension and that’s still in its infancy; instead, we do full-system emulation of riscv64 on beefy amd64 hardware […]
* [Introducing Project-Scoped Access Tokens](https://blog.launchpad.net/general/introducing-project-scoped-access-tokens)
  – 20 Nov 2023

  Access tokens can be used to access repositories on behalf of someone. They have scope limitations, optional expiry dates, and can be revoked at any time. They are a stricter and safer alternative to using real user authentication when needing to automate pushing and/or pulling from your git repositories. This is a concept that has […]
* [New domain names for PPAs](https://blog.launchpad.net/ppa/new-domain-names-for-ppas)
  – 16 Feb 2022

  Since they were introduced in 2007, Launchpad’s Personal Package Archives (PPAs) have always been hosted on ppa.launchpad.net. This has generally worked well, but one significant snag became clear later on: it was difficult to add HTTPS support for PPAs due to the way that cookies work on the web. Launchpad uses a cookie for your […]

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_22884c23_20250115_123911.html ===

[Log in / Register](https://launchpad.net/~fungi/%2Blogin)

[![](https://launchpadlibrarian.net/112681987/gnome-gmush-64.png)](https://launchpad.net/~fungi)

## [Jeremy Stanley](https://launchpad.net/~fungi)

* Overview
* [Code](https://code.launchpad.net/~fungi)
* [Bugs](https://bugs.launchpad.net/~fungi)
* [Blueprints](https://blueprints.launchpad.net/~fungi)
* [Translations](https://translations.launchpad.net/~fungi)
* [Answers](https://answers.launchpad.net/~fungi)

<http://fungi.yuggoth.org/>

* [Related packages](https://launchpad.net/~fungi/%2Brelated-packages)
* [Related projects](https://launchpad.net/~fungi/%2Brelated-projects)

## User information

Launchpad Id:
fungi

Email:
[Log in](%2Blogin) for email information.

Member since:
2006-06-16

[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)
[![Icon of OpenStack Vulnerability Management team](https://launchpadlibrarian.net/83816787/icon.png "Member of OpenStack Vulnerability Management team")](/~openstack-vuln-mgmt)
[![Icon of Python OpenStack Client Bugs](https://launchpadlibrarian.net/697274771/osc-icon.png "Member of Python OpenStack Client Bugs")](/~python-openstackclient-bugs)
[![Icon of Python OpenStack Client](https://launchpadlibrarian.net/697274843/osc-icon.png "Member of Python OpenStack Client")](/~python-openstackclient)
[![Icon of Swift](https://launchpadlibrarian.net/52560230/os14.png "Member of Swift")](/~swift)

Languages:

English

OpenPGP keys:

97AE496FC02DEC9FC353B2E748F9961143495829

SSH keys:

[fungi@yuggoth.org](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[345](https://launchpad.net/~fungi/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**fungi**
 on
**irc.libera.chat**

![IRC](/@@/social-irc "IRC")
**fungi**
 on
**irc.oftc.net**

## [All bugs in progress](https://launchpad.net/~fungi/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1354829 [Booting from stale snapshots in rax-dfw leads to miscellaneous failures](https://bugs.launchpad.net/openstack-ci/%2Bbug/1354829) |  |
| --- | --- | --- |
| in [OpenStack Core Infrastructure](/openstack-ci), [OpenStack Dashboard (Horizon)](/horizon), [neutron](/neutron), [tempest](/tempest) | | |

| --- | --- | --- | --- | --- | --- |

## [All memberships](https://launchpad.net/~fungi/%2Bparticipation) Latest memberships

| [Oslo Core security contacts](/~oslo-coresec)  Joined on 2023-10-02 | |
| --- | --- |
| [Glance Release](/~glance-release)  Joined on 2021-07-27 | |
| [Ubuntu SSO 2-factor testers](/~sso-2f-testers)  Joined on 2020-11-12 | |
| [OpenDev Two-Factor Authentication](/~opendev-2fa)  Joined on 2020-11-05 | |
| [Trove Drivers](/~trove-drivers)  Joined on 2020-06-22 | |

## [Recent activities](https://launchpad.net/~fungi/%2Bkarma) Most active in

| [OpenStack Security Advisory](/ossa) |  |  |  |
| --- | --- | --- | --- |
| [Ubuntu](/ubuntu) |  |  |  |
| [OpenStack Compute (nova)](/nova) |  |  |  |
| [OpenStack Security Notes](/ossn) |  |  |  |
| [Ubuntu Cloud Archive](/cloud-archive) |  |  |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from access.redhat.com_9200e20d_20250115_194628.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_17465dfb_20250115_194631.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)

  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Product Documentation](https://access.redhat.com/documentation)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)

  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform)
  [All Product Docs](//docs.redhat.com/en/products/)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)

  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Classifications](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Severety Ratings](https://access.redhat.com/security/security-updates/#/cve)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)

  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

 Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

# Severity ratings

## Understanding Red Hat security ratings

Red Hat Product Security rates the severity of security issues found
in Red Hat products using a four-point scale (Low, Moderate,
Important, and Critical), as well as including a separate Common
Vulnerability Scoring System (CVSS) base score. These scoring systems
provide a prioritized risk assessment to help you understand and
schedule upgrades to your systems, enabling informed decisions on the
risk each issue places on your unique environment.

The four-point scale tells you how serious Red Hat considers an issue
to be, helping you judge the severity and determine the most important
updates. The scale takes into account the potential risk based on a technical analysis of the exact flaw and its type. The risk level of a flaw does not change if an exploit or worm is later released for a flaw, or if one is available before the release of a fix. A flaw will only be re-evaluated if new technical details emerge.

The following table provides severity ratings for Red Hat products and systems. For flaws specific to AI models, see [Red Hat security ratings for AI models](https://access.redhat.com/security/ai).

| **Severity ratings** | **Security flaw description** |
| --- | --- |
| **Critical impact** | This rating is given to flaws that could be easily exploited by a remote unauthenticated attacker and lead to system compromise (arbitrary code execution) without requiring user interaction, or easily cause system compromise via inference end points on AI systems. Flaws that require authentication, local or physical access to a system, or an unlikely configuration are not classified as Critical impact. These are the types of vulnerabilities that can be exploited by worms. |
| **Important impact** | This rating is given to flaws that can easily compromise the confidentiality, integrity or availability of resources. These are the types of vulnerabilities that allow local or authenticated users to gain additional privileges, allow unauthenticated remote users to view resources that should otherwise be protected by authentication or other controls, allow authenticated remote users to execute arbitrary code, allow remote users to cause a denial of service, or can cause system compromise via inference end points on AI systems. |
| **Moderate impact** | This rating is given to flaws that may be more difficult to exploit but could still lead to some compromise of the confidentiality, integrity or availability of resources under certain circumstances. It is also given to flaws that could be exploited to cause denial of service-like conditions on AI systems via an inference end point, or allow attackers to steal other users’ data from the AI system without authorization. These are the types of vulnerabilities that could have had a Critical or Important impact but are less easily exploited based on a technical evaluation of the flaw and/or affect unlikely configurations. || **Low impact** | This rating is given to all other issues that may have a security impact. These are the types of vulnerabilities that are believed to require unlikely circumstances to be able to be exploited, or where a successful exploit would give minimal consequences. This includes flaws that are present in a program’s source code but to which no current or theoretically possible, but unproven, exploitation vectors exist or were found during the technical analysis of the flaw. |

A Red Hat security advisory can contain fixes for more than one
vulnerability and for packages for more than one product (such as both
Red Hat Enterprise Linux 7 and 8). Each issue in an advisory has a
severity rating for each product. The overall severity of an advisory
is the highest severity out of all the individual issues, across all
the products the advisory targets. For simplicity, advisories only
show the overall severity. The advisories contain links to the
relevant entries in Red Hat's bug-tracking system, where you can
examine individual severity ratings and additional commentary, as well
as links to the relevant pages in Red Hat’s CVE database.

When a technology—enabled and most likely used by default—completely
blocks the exploitation of a particular vulnerability across all
architectures, we will adjust the severity level. When a technology
reduces the risk of a vulnerability, we may adjust the severity level
and give an explanation of the decision in the bug-tracking  and CVE
database entries.

## Common Vulnerability Scoring System (CVSS)

Common Vulnerability Scoring System (CVSS) base scores provide
additional guidance about a vulnerability, giving a detailed severity
rating by scoring the constant aspects of a vulnerability: Attack
Vector, Attack Complexity, User Interaction, Privileges Required,
Scope, Confidentiality, Integrity, and Availability.

CVSS version 2 base metrics are available for all vulnerabilities from
2009-2016, as well as selected earlier vulnerabilities. In 2016, Red
Hat adopted the CVSS v3 standard, and all vulnerabilities going
forward will use version 3.1 for scoring. These scores are found on
the
[CVE pages](https://access.redhat.com/security/security-updates/#/cve)
(linked from the References section of each Red Hat Security Advisory).

Red Hat does not solely use the CVSS rating to determine the priority
with which flaws are fixed, or to determine the severity rating of the
vulnerability. It is used as a guideline to identify and describe key
metrics of a flaw, however the priority for which flaws are fixed is
determined by the overall severity of the flaw using the
aforementioned four-point scale.  CVSS is meant to help customers
prioritize the order in which they remediate flaws.

### CVSS v3 Base Metrics

The CVSS v3 base metrics group covers the constant aspects of a
vulnerability:

* Attack Vector (AV) - Expresses the "remoteness" of the attack and
  how the vulnerability is exploited.
* Attack Complexity (AC) - Speaks to the difficulty of executing an
  attack and what factors are needed for it to be successful. (Along
  with User Interaction, Attack Complexity was formerly part of the
  Access Complexity metric.).
* User Interaction (UI) - Determines whether the attack requires an
  active human to participate or if the attack can be automated.
* Privileges Required (PR) - Documents the level of user
  authentication required for the attack to be successful. (This
  replaces the former Authentication metric.).
* Scope (S) - Determines whether an attacker can impact a component
  beyond its security scope/authority.
* Confidentiality (C) - Determines whether unauthorized parties can
  access data and to what extent.
* Integrity (I) - Measures the impact to the trustworthiness and
  veracity of data.
* Availability (A) - Refers to the impact to accessibility of data or
  services for authorized users.

A formula translates these measurements into a single, numerical base
score, ranging from 0.0 (no risk) to 10.0 (highest risk). Refer to
[Common Vulnerability Scoring System v3.1: User Guide](https://www.first.org/cvss/user-guide)
for detailed descriptions of the base metrics. It is important to note
that the CVSS base metrics were designed to be used with the other
CVSS metric groups, notably the Temporal and Environmental metrics, to
provide an accurate representation of risk in customer environments.
Alone, the Base metrics offer a shallow view of the vulnerability
itself without accounting for deployment or the environment.

### How Red Hat Uses CVSS v3 Base Metrics

We aim to comply with the CVSS v3 standard when assigning base scores,
and Red Hat uses base metrics that reflect how a vulnerability affects
our products specifically.  In addition, we do not use the Qualitative
Severity Rating Scale in the CVSS v3.1 User Guide to rate severity,
and our severity ratings are always based on the aforementioned
four-point scale.  In some circumstances, it may not be obvious why a
flaw received a particular score. The following are some common
vulnerability types with our interpretation and typical scoring:

#### Libraries

It is not always possible to know how third-party applications use
libraries, making it difficult to give accurate CVSS v3 base metrics
for flaws in system libraries. When rating these flaws, we take into
account the way the library is used by applications that we ship, and
also look at other popular software that may use the library in a way
that would cause an issue to be of higher severity, and adjust the
score appropriately.

#### Other Common Scores

Flaws where a local, unprivileged user can cause a kernel to crash
(denial of service) typically score 5.5 (for example,
[CVE-2019-9213](https://access.redhat.com/security/cve/CVE-2019-9213)).

Flaws that allow a local, unprivileged user to escalate their
privileges to root typically score 7.8 (for example,
[CVE-2019-18634](https://access.redhat.com/security/cve/CVE-2019-18634)).

Cross-site scripting flaws are generally scored as having Low impact
to Integrity and/or Confidentiality, with no impact to Availability,
in line with scoring from other vendors and NVD. A typical score for
these flaws is 6.1 (for example,
[CVE-2020-11023](https://access.redhat.com/security/cve/CVE-2020-11023)).

### Base Score Variations Across Products

It is common for a given CVE-named vulnerability to have several
different CVSS base metrics, depending on the product, version, and
architecture. Examples of this include:

* A vulnerability that only affected some architectures. For example,
  [CVE-2019-15031](https://access.redhat.com/security/cve/CVE-2019-15031)
  only affected PowerPC.
* A vulnerability that is mitigated by source code protection
  mechanisms on some platforms. For example,
  [CVE-2018-1125](https://access.redhat.com/security/cve/CVE-2018-1125)
  could have led to arbitrary code execution on Red Hat Enterprise
  Linux, but it is only a denial of service because it was compiled
  with FORTIFY protections.
* A vulnerability that affected more than one product.  For example,
  [CVE-2020-14060](https://access.redhat.com/security/cve/CVE-2020-14060)
  affected a component in both OpenShift and OpenStack.  The severity
  to OpenStack was lower (Low) as compared to OpenShift (Moderate)
  based on its usage; the overall vulnerability itself was rated
  Important.

If CVSS v3 base scores are significantly different across products, we
note that separately wherever possible. If we do not split the score,
we report the metric that gives the highest CVSS v3 base score (the
worst-case outcome).

### Differences Between NVD and Red Hat Scores

For open source software shipped by multiple vendors, the CVSS base
scores may vary for each vendor's version, depending on the version
they ship, how they ship it, the platform, and even how the software
is compiled. This makes scoring vulnerabilities difficult for
third-party vulnerability databases, such as NVD, who can give only a
single CVSS base score to each vulnerability, or when comparing to
other vendors who score based on the characteristics of use in their
own products. See the
[National Vulnerability Database](https://nvd.nist.gov/vuln-metrics/cvss)
for more information regarding NVD security ratings.

These differences can cause the scores to vary widely. Other reasons
may include how the source code was compiled with certain compiler
flags or hardening technologies that reduce or eliminate the security
severity of a flaw, or how the software is used within the product.
Software running standalone may suffer from a flaw, but its use within
a product may preclude the vulnerable code from ever being used in a
way that could be exploited.

For example, NVD may rate a flaw in a particular service as having
High Impact on the CVSS CIA Triad (Confidentiality, Integrity,
Availability) where the service in question is typically run as the
root user with full privileges on a system. However, in a Red Hat
product, the service may be specifically configured to run as a
dedicated non-privileged user running entirely in a SELinux sandbox,
greatly reducing the immediate impact from compromise, resulting in
Low impact.

For these reasons, we recommend that, whenever possible, you use a
CVSS base score provided by Red Hat in preference to a score from a
third party. Please
[let us know](https://access.redhat.com/site/security/team/contact/)
if you believe we have given an incorrect CVSS v3 base score for a
particular vulnerability. We are happy to discuss and update if
needed.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com)

### Help

* [Contact Customer Portal](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Systems Status

### About

* [Red Hat Subscription Value](https://access.redhat.com/subscription-value)
* [About Red Hat](https://www.redhat.com/about/)
* [Red Hat Jobs](http://jobs.redhat.com)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

Copyright © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)

×
### Formatting Tips

Here are the common uses of Markdown.

Code blocks
```
~~~
Code surrounded in tildes is easier to read
~~~
```

Links/URLs`[Red Hat Customer Portal](https://access.redhat.com)`

[Learn more](/help/markdown)
Close



=== Content from security.gentoo.org_19d4fabb_20250114_221538.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Python, PyPy3: Multiple Vulnerabilities — GLSA **202305-02**

Multiple vulnerabilities have been found in Python and PyPy, the worst of which could result in arbitrary code execution.

### Affected packages

| Package | **dev-lang/python** on all architectures |
| --- | --- |
| Affected versions | < **3.8.15\_p3**< **3.9.15\_p3**< **3.10.8\_p3**< **3.11.0\_p2**< **3.12.0\_alpha1\_p2** |
| Unaffected versions | >= **3.8.15\_p3**>= **3.9.15\_p3**>= **3.10.8\_p3**>= **3.11.0\_p2**>= **3.12.0\_alpha1\_p2** |

| Package | **dev-python/pypy3** on all architectures |
| --- | --- |
| Affected versions | < **7.3.9\_p9** |
| Unaffected versions | >= **7.3.9\_p9** |

### Background

Python is an interpreted, interactive, object-oriented, cross-platform programming language.

### Description

Multiple vulnerabilities have been discovered in Python and PyPy3. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Python 3.8 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/python-3.8.15_p3:3.8"

```

All Python 3.9 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/python-3.9.15_p3:3.9"

```

All Python 3.10 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/python-3.10.8_p3:3.10"

```

All Python 3.11 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/python-3.11.0_p2:3.11"

```

All Python 3.12 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-lang/python-3.12.0_alpha1_p2"

```

All PyPy3 users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-python/pypy3-7.3.9_p9"

```
### References

* [CVE-2015-20107](https://nvd.nist.gov/vuln/detail/CVE-2015-20107)
* [CVE-2021-3654](https://nvd.nist.gov/vuln/detail/CVE-2021-3654)
* [CVE-2021-28363](https://nvd.nist.gov/vuln/detail/CVE-2021-28363)
* [CVE-2021-28861](https://nvd.nist.gov/vuln/detail/CVE-2021-28861)
* [CVE-2021-29921](https://nvd.nist.gov/vuln/detail/CVE-2021-29921)
* [CVE-2022-0391](https://nvd.nist.gov/vuln/detail/CVE-2022-0391)
* [CVE-2022-37454](https://nvd.nist.gov/vuln/detail/CVE-2022-37454)
* [CVE-2022-42919](https://nvd.nist.gov/vuln/detail/CVE-2022-42919)
* [CVE-2022-45061](https://nvd.nist.gov/vuln/detail/CVE-2022-45061)

**Release date**

May 03, 2023

**Latest revision**

May 03, 2023: 1

**Severity**

high

**Exploitable**

local and remote

**Bugzilla entries**

* [880629](https://bugs.gentoo.org/show_bug.cgi?id=880629)
* [878385](https://bugs.gentoo.org/show_bug.cgi?id=878385)
* [877851](https://bugs.gentoo.org/show_bug.cgi?id=877851)
* [876815](https://bugs.gentoo.org/show_bug.cgi?id=876815)
* [864747](https://bugs.gentoo.org/show_bug.cgi?id=864747)
* [838250](https://bugs.gentoo.org/show_bug.cgi?id=838250)
* [835443](https://bugs.gentoo.org/show_bug.cgi?id=835443)
* [834533](https://bugs.gentoo.org/show_bug.cgi?id=834533)
* [787260](https://bugs.gentoo.org/show_bug.cgi?id=787260)
* [811165](https://bugs.gentoo.org/show_bug.cgi?id=811165)
* [793833](https://bugs.gentoo.org/show_bug.cgi?id=793833)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugzilla.redhat.com_8596417a_20250115_194633.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2036690)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2036690)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2036690)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2036690

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2036690**](show_bug.cgi?id=2036690)
- If an upper case mac address is used in a heat template, live migration won't work in nova

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
If an upper case mac address is used in a heat template, live migration won't...

| | [Keywords](describekeywords.cgi): | Triaged | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-nova | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 16.2 (Train) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | x86\_64 | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | z2 | | [Target Release](page.cgi?id=fields.html#target_release): | 16.2 (Train on RHEL 8.4) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Alex Stupnikov | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | OSP DFG:Compute | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=2036690&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2036690&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2022-01-03 15:36 UTC by Alex Stupnikov | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-03-21 19:49 UTC ([History](show_activity.cgi?id=2036690)) | | [CC List:](page.cgi?id=fields.html#cclist) | 11 users (show)  astupnik dasmith dhill eglynn jhakimra jhardee kchamart nova-maint sbauza sgordon vromanso | | Fixed In Version: | openstack-nova-20.6.2-2.20220112164912.8906552.el8ost | | | Doc Type: | If docs needed, set a value | | | Doc Text: |  | | | Clone Of: | [2020313](show_bug.cgi?id=2020313 "CLOSED ERRATA - If an upper case mac address is used in a heat template, live migration won't work in nova") | | | Environment: |  | | | Last Closed: | 2022-03-23 22:12:27 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Issue Tracker | [OSP-11986](https://issues.redhat.com/browse/OSP-11986) | 0 | None | None | None | 2022-01-03 15:36:58 UTC | | Red Hat Product Errata | [RHBA-2022:1001](https://access.redhat.com/errata/RHBA-2022%3A1001) | 0 | None | None | None | 2022-03-23 22:12:53 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Comment 15](show_bug.cgi?id=2036690#c15)  errata-xmlrpc    2022-03-23 22:12:27 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory (Release of components for Red Hat OpenStack Platform 16.2.2), and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  [https://access.redhat.com/errata/RHBA-2022:1001](https://access.redhat.com/errata/RHBA-2022%3A1001)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2036690&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_5566b98f_20250115_123922.html ===

[Skip to main content](#rh-login-card)
![Red Hat logo](/auth/resources/wi6vu/login/rhd-theme/img/RHLogo_white.svg)

All Red Hat

[Register](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=lIzGePbDYf4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMiUzQTA5OTkifQ)

# Log in to your Red Hat account

#### Danger alert:

#### Log in attempt timed out

Resubmit your information.

 Red Hat login or email

Next

 Red Hat login or email

Log in with company single sign-on

Log in with Red Hat account

 Red Hat login or email

Password

Log in

[Register for a Red Hat account](/auth/realms/redhat-external/login-actions/registration?client_id=unified-downloads&tab_id=lIzGePbDYf4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMiUzQTA5OTkifQ)

[Forgot your password?](/auth/realms/redhat-external/login-actions/reset-credentials?client_id=unified-downloads&tab_id=lIzGePbDYf4&client_data=eyJydSI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZG93bmxvYWRzL3NhbWwvZmluYWxpemUiLCJybSI6InBvc3QiLCJzdCI6Imh0dHBzOi8vYWNjZXNzLnJlZGhhdC5jb20vZXJyYXRhL1JIU0EtMjAyMiUzQTA5OTkifQ)

### Why create an account?

* ![](/auth/resources/wi6vu/login/rhd-theme/img/pricetag.png)

  #### Product trials

  Try our products hands-on to see if they’ll work for you.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/book.png)

  #### Learning resources

  Get training and learning tools to help you use our products.
* ![](/auth/resources/wi6vu/login/rhd-theme/img/support.png)

  #### World-class support

  Rely on our trusted customer support and partner enablement.

A subscription may be required for some services.

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[LinkedIn](https://www.linkedin.com/company/red-hat)
[YouTube](https://www.youtube.com/user/RedHatVideos)
[Facebook](https://www.facebook.com/redhatinc)
[X/Twitter](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](https://redhat.com/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](https://redhat.com/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](https://redhat.com/en/technologies/management/ansible)
* [Cloud services](https://redhat.com/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](https://redhat.com/en/technologies/all-products)

### Tools

* [My account](https://sso.redhat.com)
* [Training and certification](https://redhat.com/en/services/training-and-certification)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Learning community](https://learn.redhat.com/)
* [Partner resources](https://connect.redhat.com/)
* [Resource library](https://redhat.com/en/resources)

### Try, buy & sell

* [Product trial center](https://redhat.com/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](http://redhat.force.com/finder/)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact consulting](https://redhat.com/en/services/consulting-overview#contact-us)
* [Contact sales](https://redhat.com/en/contact)
* [Contact training](https://redhat.com/en/services/training-and-certification/contact-us)
* [Social](https://redhat.com/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Subscribe to our newsletter, Red Hat Shares

[Sign up now](https://www.redhat.com/en/email-preferences?newsletter=RH-Shares&intcmp=7016000000154xCAAQ)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

©  Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from github.com_d5c08252_20250115_194622.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5715382d3a8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5715382d3a8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.9k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/5715382d3a89ca118ce2e224d8c69550d21fe51b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-87389](https://github.com/python/cpython/issues/87389): Fix an open redirection vulnerability in http.server. ([GH-9…](https://github.com/python/cpython/pull/93879)

[Browse files](/python/cpython/tree/5715382d3a89ca118ce2e224d8c69550d21fe51b)
Browse the repository at this point in the history

```
[…3879](https://github.com/python/cpython/pull/93879))

Fix an open redirection vulnerability in the `http.server` module when
an URI path starts with `//` that could produce a 301 Location header
with a misleading target.  Vulnerability discovered, and logic fix
proposed, by Hamza Avvan ([@hamzaavvan](https://github.com/hamzaavvan)).

Test and comments authored by Gregory P. Smith [Google].
(cherry picked from commit [4abab6b](https://github.com/python/cpython/commit/4abab6b603dd38bec1168e9a37c40a48ec89508e))

Co-authored-by: Gregory P. Smith <greg@krypto.org>
```

* Loading branch information

[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington) [![@gpshead](https://avatars.githubusercontent.com/u/68491?s=40&v=4)](/gpshead)

[miss-islington](/python/cpython/commits?author=miss-islington "View all commits by miss-islington")
and
[gpshead](/python/cpython/commits?author=gpshead "View all commits by gpshead")
authored
Jun 21, 2022

1 parent
[1b8aa7a](/python/cpython/commit/1b8aa7aafd2ac07836777707fd9ba5ffb353eb0c)

commit 5715382

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**61 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib

  + http

    - Lib/http/server.py
      [server.py](#diff-10e6db6c775e351ba2b55c4ad5e177191afe25d4942d1d2162d6e10505788a81)
  + test

    - Lib/test/test\_httpservers.py
      [test\_httpservers.py](#diff-5c8de474c50a44ead423e2d9ce85c1932b9c87ba9f5a3215c0b8b996c65e62b9)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2022-06-15-20-09-23.gh-issue-87389.QVaC3f.rst
    [2022-06-15-20-09-23.gh-issue-87389.QVaC3f.rst](#diff-6640afaca3b1429be871db4ab6fff0c959ea046ee41019016eb6e57a105dfbb6)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[Lib/http/server.py](#diff-10e6db6c775e351ba2b55c4ad5e177191afe25d4942d1d2162d6e10505788a81 "Lib/http/server.py")

Show comments

[View file](/python/cpython/blob/5715382d3a89ca118ce2e224d8c69550d21fe51b/Lib/http/server.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -330,6 +330,13 @@ def parse\_request(self): |
|  |  | return False |
|  |  | self.command, self.path = command, path |
|  |  |  |
|  |  | # gh-87389: The purpose of replacing '//' with '/' is to protect |
|  |  | # against open redirect attacks possibly triggered if the path starts |
|  |  | # with '//' because http clients treat //path as an absolute URI |
|  |  | # without scheme (similar to http://path) rather than a path. |
|  |  | if self.path.startswith('//'): |
|  |  | self.path = '/' + self.path.lstrip('/') # Reduce to a single / |
|  |  |  |
|  |  | # Examine the headers and look for a Connection directive. |
|  |  | try: |
|  |  | self.headers = http.client.parse\_headers(self.rfile, |
| Expand Down | |  |

53 changes: 51 additions & 2 deletions

53
[Lib/test/test\_httpservers.py](#diff-5c8de474c50a44ead423e2d9ce85c1932b9c87ba9f5a3215c0b8b996c65e62b9 "Lib/test/test_httpservers.py")

Show comments

[View file](/python/cpython/blob/5715382d3a89ca118ce2e224d8c69550d21fe51b/Lib/test/test_httpservers.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -333,7 +333,7 @@ class request\_handler(NoLogRequestHandler, SimpleHTTPRequestHandler): |
|  |  | pass |
|  |  |  |
|  |  | def setUp(self): |
|  |  | BaseTestCase.setUp(self) |
|  |  | super().setUp() |
|  |  | self.cwd = os.getcwd() |
|  |  | basetempdir = tempfile.gettempdir() |
|  |  | os.chdir(basetempdir) |
| Expand Down  Expand Up | | @@ -361,7 +361,7 @@ def tearDown(self): |
|  |  | except: |
|  |  | pass |
|  |  | finally: |
|  |  | BaseTestCase.tearDown(self) |
|  |  | super().tearDown() |
|  |  |  |
|  |  | def check\_status\_and\_reason(self, response, status, data=None): |
|  |  | def close\_conn(): |
| Expand Down  Expand Up | | @@ -417,6 +417,55 @@ def test\_undecodable\_filename(self): |
|  |  | self.check\_status\_and\_reason(response, HTTPStatus.OK, |
|  |  | data=os\_helper.TESTFN\_UNDECODABLE) |
|  |  |  |
|  |  | def test\_get\_dir\_redirect\_location\_domain\_injection\_bug(self): |
|  |  | """Ensure //evil.co/..%2f../../X does not put //evil.co/ in Location. |
|  |  |  |
|  |  | //netloc/ in a Location header is a redirect to a new host. |
|  |  | https://github.com/python/cpython/issues/87389 |
|  |  |  |
|  |  | This checks that a path resolving to a directory on our server cannot |
|  |  | resolve into a redirect to another server. |
|  |  | """ |
|  |  | os.mkdir(os.path.join(self.tempdir, 'existing\_directory')) |
|  |  | url = f'/python.org/..%2f..%2f..%2f..%2f..%2f../%0a%0d/../{self.tempdir\_name}/existing\_directory' |
|  |  | expected\_location = f'{url}/' # /python.org.../ single slash single prefix, trailing slash |
|  |  | # Canonicalizes to /tmp/tempdir\_name/existing\_directory which does |
|  |  | # exist and is a dir, triggering the 301 redirect logic. |
|  |  | response = self.request(url) |
|  |  | self.check\_status\_and\_reason(response, HTTPStatus.MOVED\_PERMANENTLY) |
|  |  | location = response.getheader('Location') |
|  |  | self.assertEqual(location, expected\_location, msg='non-attack failed!') |
|  |  |  |
|  |  | # //python.org... multi-slash prefix, no trailing slash |
|  |  | attack\_url = f'/{url}' |
|  |  | response = self.request(attack\_url) |
|  |  | self.check\_status\_and\_reason(response, HTTPStatus.MOVED\_PERMANENTLY) |
|  |  | location = response.getheader('Location') |
|  |  | self.assertFalse(location.startswith('//'), msg=location) |
|  |  | self.assertEqual(location, expected\_location, |
|  |  | msg='Expected Location header to start with a single / and ' |
|  |  | 'end with a / as this is a directory redirect.') |
|  |  |  |
|  |  | # ///python.org... triple-slash prefix, no trailing slash |
|  |  | attack3\_url = f'//{url}' |
|  |  | response = self.request(attack3\_url) |
|  |  | self.check\_status\_and\_reason(response, HTTPStatus.MOVED\_PERMANENTLY) |
|  |  | self.assertEqual(response.getheader('Location'), expected\_location) |
|  |  |  |
|  |  | # If the second word in the http request (Request-URI for the http |
|  |  | # method) is a full URI, we don't worry about it, as that'll be parsed |
|  |  | # and reassembled as a full URI within BaseHTTPRequestHandler.send\_head |
|  |  | # so no errant scheme-less //netloc//evil.co/ domain mixup can happen. |
|  |  | attack\_scheme\_netloc\_2slash\_url = f'https://pypi.org/{url}' |
|  |  | expected\_scheme\_netloc\_location = f'{attack\_scheme\_netloc\_2slash\_url}/' |
|  |  | response = self.request(attack\_scheme\_netloc\_2slash\_url) |
|  |  | self.check\_status\_and\_reason(response, HTTPStatus.MOVED\_PERMANENTLY) |
|  |  | location = response.getheader('Location') |
|  |  | # We're just ensuring that the scheme and domain make it through, if |
|  |  | # there are or aren't multiple slashes at the start of the path that |
|  |  | # follows that isn't important in this Location: header. |
|  |  | self.assertTrue(location.startswith('https://pypi.org/'), msg=location) |
|  |  |  |
|  |  | def test\_get(self): |
|  |  | #constructs the path relative to the root directory of the HTTPServer |
|  |  | response = self.request(self.base\_url + '/test') |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[Misc/NEWS.d/next/Security/2022-06-15-20-09-23.gh-issue-87389.QVaC3f.rst](#diff-6640afaca3b1429be871db4ab6fff0c959ea046ee41019016eb6e57a105dfbb6 "Misc/NEWS.d/next/Security/2022-06-15-20-09-23.gh-issue-87389.QVaC3f.rst")

Show comments

[View file](/python/cpython/blob/5715382d3a89ca118ce2e224d8c69550d21fe51b/Misc/NEWS.d/next/Security/2022-06-15-20-09-23.gh-issue-87389.QVaC3f.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,3 @@ |
|  |  | :mod:`http.server`: Fix an open redirection vulnerability in the HTTP server |
|  |  | when an URI path starts with ``//``. Vulnerability discovered, and initial |
|  |  | fix proposed, by Hamza Avvan. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5715382`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5715382d3a8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from translations.launchpad.net_13b83fdf_20250115_194622.html ===

[Log in / Register](https://translations.launchpad.net/nova/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* Translations
* [Answers](https://answers.launchpad.net/nova)

# Translation overview

[Help for translations](https://help.launchpad.net/Translations)

### Translation details

Launchpad currently recommends translating
[OpenStack Compute (nova) trunk series](/nova/trunk).

To see all the translation files that are waiting to be
imported, please look at
[OpenStack Compute (nova) import queue](/nova/%2Bimports).

### Permissions

[OpenStack Compute (nova)](https://launchpad.net/nova) is translated
with [Open](/%2Bhelp-translations/permissions-policies.html)
permissions.

### All translatable series

* [OpenStack Compute (nova) trunk series](/nova/trunk/%2Btranslations)
* [OpenStack Compute (nova) bexar series](/nova/bexar/%2Btranslations)
* [OpenStack Compute (nova) cactus series](/nova/cactus/%2Btranslations)

### All translatable distribution packages

* [nova source package in Plucky](/ubuntu/plucky/%2Bsources/nova/%2Btranslations)
* [nova source package in Oracular](/ubuntu/oracular/%2Bsources/nova/%2Btranslations)
* [nova source package in Noble](/ubuntu/noble/%2Bsources/nova/%2Btranslations)
* [nova source package in Mantic](/ubuntu/mantic/%2Bsources/nova/%2Btranslations)
* [nova source package in Lunar](/ubuntu/lunar/%2Bsources/nova/%2Btranslations)
* [nova source package in Kinetic](/ubuntu/kinetic/%2Bsources/nova/%2Btranslations)
* [nova source package in Jammy](/ubuntu/jammy/%2Bsources/nova/%2Btranslations)
* [nova source package in Impish](/ubuntu/impish/%2Bsources/nova/%2Btranslations)
* [nova source package in Hirsute](/ubuntu/hirsute/%2Bsources/nova/%2Btranslations)
* [nova source package in Groovy](/ubuntu/groovy/%2Bsources/nova/%2Btranslations)
* [nova source package in Focal](/ubuntu/focal/%2Bsources/nova/%2Btranslations)
* [nova source package in Eoan](/ubuntu/eoan/%2Bsources/nova/%2Btranslations)
* [nova source package in Disco](/ubuntu/disco/%2Bsources/nova/%2Btranslations)
* [nova source package in Cosmic](/ubuntu/cosmic/%2Bsources/nova/%2Btranslations)
* [nova source package in Bionic](/ubuntu/bionic/%2Bsources/nova/%2Btranslations)
* [nova source package in Artful](/ubuntu/artful/%2Bsources/nova/%2Btranslations)
* [nova source package in Zesty](/ubuntu/zesty/%2Bsources/nova/%2Btranslations)
* [nova source package in Yakkety](/ubuntu/yakkety/%2Bsources/nova/%2Btranslations)
* [nova source package in Xenial](/ubuntu/xenial/%2Bsources/nova/%2Btranslations)
* [nova source package in Wily](/ubuntu/wily/%2Bsources/nova/%2Btranslations)
* [nova source package in Vivid](/ubuntu/vivid/%2Bsources/nova/%2Btranslations)
* [nova source package in Utopic](/ubuntu/utopic/%2Bsources/nova/%2Btranslations)
* [nova source package in Trusty](/ubuntu/trusty/%2Bsources/nova/%2Btranslations)
* [nova source package in Saucy](/ubuntu/saucy/%2Bsources/nova/%2Btranslations)
* [nova source package in Raring](/ubuntu/raring/%2Bsources/nova/%2Btranslations)
* [nova source package in Quantal](/ubuntu/quantal/%2Bsources/nova/%2Btranslations)
* [nova source package in Precise](/ubuntu/precise/%2Bsources/nova/%2Btranslations)

## Translation for trunk

| Language | Status | Untranslated | Needs review | Last Changed |
| --- | --- | --- | --- | --- |
| [Afrikaans](/nova/trunk/%2Bpots/nova/af/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/af/%2Btranslate?show=untranslated) | 254 [254](/nova/trunk/%2Bpots/nova/af/%2Btranslate?show=new_suggestions) | 2022-09-12 03:14:23 UTC 2022-09-12 |
| [Albanian](/nova/trunk/%2Bpots/nova/sq/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/sq/%2Btranslate?show=untranslated) | 0 0 | 2014-04-02 15:56:19 UTC 2014-04-02 |
| [Arabic](/nova/trunk/%2Bpots/nova/ar/%2Btranslate) | 13 099.14  0.8563899868247694% translated  99.14361001317523% untranslated | 1505 [1505](/nova/trunk/%2Bpots/nova/ar/%2Btranslate?show=untranslated) | 0 0 | 2013-02-16 21:33:39 UTC 2013-02-16 |
| [Asturian](/nova/trunk/%2Bpots/nova/ast/%2Btranslate) | 2 099.87  0.13175230566534915% translated  99.86824769433466% untranslated | 1516 [1516](/nova/trunk/%2Bpots/nova/ast/%2Btranslate?show=untranslated) | 0 0 | 2011-01-12 19:50:20 UTC 2011-01-12 |
| [Azerbaijani](/nova/trunk/%2Bpots/nova/az/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/az/%2Btranslate?show=untranslated) | 5 [5](/nova/trunk/%2Bpots/nova/az/%2Btranslate?show=new_suggestions) | 2013-04-03 14:46:02 UTC 2013-04-03 |
| [Basque](/nova/trunk/%2Bpots/nova/eu/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/eu/%2Btranslate?show=untranslated) | 0 0 | 2013-12-05 23:09:27 UTC 2013-12-05 |
| [Belarusian](/nova/trunk/%2Bpots/nova/be/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/be/%2Btranslate?show=untranslated) | 0 0 | 2020-05-03 16:45:18 UTC 2020-05-03 |
| [Bosnian](/nova/trunk/%2Bpots/nova/bs/%2Btranslate) | 2 099.87  0.13175230566534915% translated  99.86824769433466% untranslated | 1516 [1516](/nova/trunk/%2Bpots/nova/bs/%2Btranslate?show=untranslated) | 914 [914](/nova/trunk/%2Bpots/nova/bs/%2Btranslate?show=new_suggestions) | 2012-01-19 20:22:10 UTC 2012-01-19 |
| [Brazilian Portuguese](/nova/trunk/%2Bpots/nova/pt_BR/%2Btranslate) | 815 046.31  53.689064558629774% translated  46.31093544137022% untranslated | 703 [703](/nova/trunk/%2Bpots/nova/pt_BR/%2Btranslate?show=untranslated) | 84 [84](/nova/trunk/%2Bpots/nova/pt_BR/%2Btranslate?show=new_suggestions) | 2013-02-06 03:43:42 UTC 2013-02-06 |
| [Catalan](/nova/trunk/%2Bpots/nova/ca/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ca/%2Btranslate?show=untranslated) | 0 0 | 2013-06-07 09:16:32 UTC 2013-06-07 |
| [Chechen](/nova/trunk/%2Bpots/nova/ce/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ce/%2Btranslate?show=untranslated) | 0 0 | 2014-08-13 08:13:14 UTC 2014-08-13 |
| [Chinese (Hong Kong)](/nova/trunk/%2Bpots/nova/zh_HK/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/zh_HK/%2Btranslate?show=untranslated) | 0 0 | 2013-06-07 09:16:31 UTC 2013-06-07 |
| [Chinese (Simplified)](/nova/trunk/%2Bpots/nova/zh_CN/%2Btranslate) | 1518 000.00  100.0% translated | 0 0 | 106 [106](/nova/trunk/%2Bpots/nova/zh_CN/%2Btranslate?show=new_suggestions) | 2013-06-05 09:20:38 UTC 2013-06-05 |
| [Chinese (Traditional)](/nova/trunk/%2Bpots/nova/zh_TW/%2Btranslate) | 294 080.63  19.367588932806324% translated  80.63241106719367% untranslated | 1224 [1224](/nova/trunk/%2Bpots/nova/zh_TW/%2Btranslate?show=untranslated) | 30 [30](/nova/trunk/%2Bpots/nova/zh_TW/%2Btranslate?show=new_suggestions) | 2012-08-15 07:46:05 UTC 2012-08-15 |
| [Croatian](/nova/trunk/%2Bpots/nova/hr/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/hr/%2Btranslate?show=untranslated) | 0 0 | 2013-06-07 09:16:33 UTC 2013-06-07 |
| [Czech](/nova/trunk/%2Bpots/nova/cs/%2Btranslate) | 1518 000.00  100.0% translated | 0 0 | 4 [4](/nova/trunk/%2Bpots/nova/cs/%2Btranslate?show=new_suggestions) | 2013-05-12 21:44:53 UTC 2013-05-12 |
| [Danish](/nova/trunk/%2Bpots/nova/da/%2Btranslate) | 2 099.87  0.13175230566534915% translated  99.86824769433466% untranslated | 1516 [1516](/nova/trunk/%2Bpots/nova/da/%2Btranslate?show=untranslated) | 2 [2](/nova/trunk/%2Bpots/nova/da/%2Btranslate?show=new_suggestions) | 2011-01-15 21:46:58 UTC 2011-01-15 |
| [English (Australia)](/nova/trunk/%2Bpots/nova/en_AU/%2Btranslate) | 350 076.94  23.056653491436098% translated  76.9433465085639% untranslated | 1168 [1168](/nova/trunk/%2Bpots/nova/en_AU/%2Btranslate?show=untranslated) | 1166 [1166](/nova/trunk/%2Bpots/nova/en_AU/%2Btranslate?show=new_suggestions) | 2012-06-17 06:35:56 UTC 2012-06-17 |
| [English (Canada)](/nova/trunk/%2Bpots/nova/en_CA/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/en_CA/%2Btranslate?show=untranslated) | 0 0 | 2013-09-10 14:44:32 UTC 2013-09-10 |
| [English (United Kingdom)](/nova/trunk/%2Bpots/nova/en_GB/%2Btranslate) | 1518 000.00  100.0% translated | 0 0 | 10 [10](/nova/trunk/%2Bpots/nova/en_GB/%2Btranslate?show=new_suggestions) | 2013-06-04 15:36:12 UTC 2013-06-04 |
| [Filipino](/nova/trunk/%2Bpots/nova/fil/%2Btranslate) | 30 098.02  1.9762845849802373% translated  98.02371541501977% untranslated | 1488 [1488](/nova/trunk/%2Bpots/nova/fil/%2Btranslate?show=untranslated) | 0 0 | 2012-07-20 05:07:53 UTC 2012-07-20 |
| [French](/nova/trunk/%2Bpots/nova/fr/%2Btranslate) | 641 057.77  42.226613965744406% translated  57.7733860342556% untranslated | 877 [877](/nova/trunk/%2Bpots/nova/fr/%2Btranslate?show=untranslated) | 139 [139](/nova/trunk/%2Bpots/nova/fr/%2Btranslate?show=new_suggestions) | 2013-03-04 16:32:33 UTC 2013-03-04 |
| [Galician](/nova/trunk/%2Bpots/nova/gl/%2Btranslate) | 97 093.61  6.389986824769434% translated  93.61001317523056% untranslated | 1421 [1421](/nova/trunk/%2Bpots/nova/gl/%2Btranslate?show=untranslated) | 5 [5](/nova/trunk/%2Bpots/nova/gl/%2Btranslate?show=new_suggestions) | 2013-07-10 23:58:13 UTC 2013-07-10 |
| [German](/nova/trunk/%2Bpots/nova/de/%2Btranslate) | 1094 027.93  72.06851119894598% translated  27.931488801054016% untranslated | 424 [424](/nova/trunk/%2Bpots/nova/de/%2Btranslate?show=untranslated) | 31 [31](/nova/trunk/%2Bpots/nova/de/%2Btranslate?show=new_suggestions) | 2013-07-10 09:57:58 UTC 2013-07-10 |
| [Greek](/nova/trunk/%2Bpots/nova/el/%2Btranslate) | 2 099.87  0.13175230566534915% translated  99.86824769433466% untranslated | 1516 [1516](/nova/trunk/%2Bpots/nova/el/%2Btranslate?show=untranslated) | 0 0 | 2014-04-02 15:56:24 UTC 2014-04-02 |
| [Hebrew](/nova/trunk/%2Bpots/nova/he/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/he/%2Btranslate?show=untranslated) | 0 0 | 2014-03-07 06:39:29 UTC 2014-03-07 |
| [Hindi](/nova/trunk/%2Bpots/nova/hi/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/hi/%2Btranslate?show=untranslated) | 0 0 | 2013-09-09 20:15:29 UTC 2013-09-09 |
| [Hungarian](/nova/trunk/%2Bpots/nova/hu/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/hu/%2Btranslate?show=untranslated) | 0 0 | 2013-06-07 09:16:34 UTC 2013-06-07 |
| [Indonesian](/nova/trunk/%2Bpots/nova/id/%2Btranslate) | 1166 023.19  76.81159420289855% translated  23.18840579710145% untranslated | 352 [352](/nova/trunk/%2Bpots/nova/id/%2Btranslate?show=untranslated) | 4 [4](/nova/trunk/%2Bpots/nova/id/%2Btranslate?show=new_suggestions) | 2013-06-12 06:23:30 UTC 2013-06-12 |
| [Italian](/nova/trunk/%2Bpots/nova/it/%2Btranslate) | 399 073.72  26.284584980237153% translated  73.71541501976284% untranslated | 1119 [1119](/nova/trunk/%2Bpots/nova/it/%2Btranslate?show=untranslated) | 3 [3](/nova/trunk/%2Bpots/nova/it/%2Btranslate?show=new_suggestions) | 2013-04-12 14:24:26 UTC 2013-04-12 |
| [Japanese](/nova/trunk/%2Bpots/nova/ja/%2Btranslate) | 526 065.35  34.65085638998682% translated  65.34914361001317% untranslated | 992 [992](/nova/trunk/%2Bpots/nova/ja/%2Btranslate?show=untranslated) | 4 [4](/nova/trunk/%2Bpots/nova/ja/%2Btranslate?show=new_suggestions) | 2012-06-17 06:26:26 UTC 2012-06-17 |
| [Kabyle](/nova/trunk/%2Bpots/nova/kab/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/kab/%2Btranslate?show=untranslated) | 0 0 | 2020-09-26 09:29:19 UTC 2020-09-26 |
| [Kannada](/nova/trunk/%2Bpots/nova/kn/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/kn/%2Btranslate?show=untranslated) | 0 0 | 2013-10-03 20:33:34 UTC 2013-10-03 |
| [Khmer](/nova/trunk/%2Bpots/nova/km/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/km/%2Btranslate?show=untranslated) | 12 [12](/nova/trunk/%2Bpots/nova/km/%2Btranslate?show=new_suggestions) | 2013-12-05 23:09:30 UTC 2013-12-05 |
| [Korean](/nova/trunk/%2Bpots/nova/ko/%2Btranslate) | 133 091.24  8.761528326745719% translated  91.23847167325428% untranslated | 1385 [1385](/nova/trunk/%2Bpots/nova/ko/%2Btranslate?show=untranslated) | 0 0 | 2012-08-18 04:14:44 UTC 2012-08-18 |
| [Latgalian](/nova/trunk/%2Bpots/nova/ltg/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ltg/%2Btranslate?show=untranslated) | 1 [1](/nova/trunk/%2Bpots/nova/ltg/%2Btranslate?show=new_suggestions) | 2013-12-03 08:45:58 UTC 2013-12-03 |
| [Latvian](/nova/trunk/%2Bpots/nova/lv/%2Btranslate) | 5 099.67  0.32938076416337286% translated  99.67061923583663% untranslated | 1513 [1513](/nova/trunk/%2Bpots/nova/lv/%2Btranslate?show=untranslated) | 0 0 | 2013-03-07 16:14:28 UTC 2013-03-07 |
| [Malay](/nova/trunk/%2Bpots/nova/ms/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ms/%2Btranslate?show=untranslated) | 406 [406](/nova/trunk/%2Bpots/nova/ms/%2Btranslate?show=new_suggestions) | 2012-06-13 09:15:03 UTC 2012-06-13 |
| [Mari (Meadow)](/nova/trunk/%2Bpots/nova/mhr/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/mhr/%2Btranslate?show=untranslated) | 3 [3](/nova/trunk/%2Bpots/nova/mhr/%2Btranslate?show=new_suggestions) | 2013-11-05 08:44:17 UTC 2013-11-05 |
| [Nepali](/nova/trunk/%2Bpots/nova/ne/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ne/%2Btranslate?show=untranslated) | 0 0 | 2013-10-03 20:33:29 UTC 2013-10-03 |
| [Norwegian Bokmal](/nova/trunk/%2Bpots/nova/nb/%2Btranslate) | 74 095.13  4.874835309617918% translated  95.12516469038208% untranslated | 1444 [1444](/nova/trunk/%2Bpots/nova/nb/%2Btranslate?show=untranslated) | 0 0 | 2012-03-13 11:36:56 UTC 2012-03-13 |
| [Occitan (post 1500)](/nova/trunk/%2Bpots/nova/oc/%2Btranslate) | 16 098.95  1.0540184453227932% translated  98.9459815546772% untranslated | 1502 [1502](/nova/trunk/%2Bpots/nova/oc/%2Btranslate?show=untranslated) | 394 [394](/nova/trunk/%2Bpots/nova/oc/%2Btranslate?show=new_suggestions) | 2011-11-17 07:23:06 UTC 2011-11-17 |
| [Persian](/nova/trunk/%2Bpots/nova/fa/%2Btranslate) | 14 099.08  0.922266139657444% translated  99.07773386034255% untranslated | 1504 [1504](/nova/trunk/%2Bpots/nova/fa/%2Btranslate?show=untranslated) | 0 0 | 2012-09-18 11:44:07 UTC 2012-09-18 |
| [Polish](/nova/trunk/%2Bpots/nova/pl/%2Btranslate) | 2 099.87  0.13175230566534915% translated  99.86824769433466% untranslated | 1516 [1516](/nova/trunk/%2Bpots/nova/pl/%2Btranslate?show=untranslated) | 0 0 | 2012-09-04 20:24:42 UTC 2012-09-04 |
| [Portuguese](/nova/trunk/%2Bpots/nova/pt/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/pt/%2Btranslate?show=untranslated) | 8 [8](/nova/trunk/%2Bpots/nova/pt/%2Btranslate?show=new_suggestions) | 2013-06-07 09:16:30 UTC 2013-06-07 |
| [Romanian](/nova/trunk/%2Bpots/nova/ro/%2Btranslate) | 2 099.87  0.13175230566534915% translated  99.86824769433466% untranslated | 1516 [1516](/nova/trunk/%2Bpots/nova/ro/%2Btranslate?show=untranslated) | 4 [4](/nova/trunk/%2Bpots/nova/ro/%2Btranslate?show=new_suggestions) | 2013-03-03 09:38:48 UTC 2013-03-03 |
| [Russian](/nova/trunk/%2Bpots/nova/ru/%2Btranslate) | 1307 013.90  86.10013175230566% translated  13.899868247694336% untranslated | 211 [211](/nova/trunk/%2Bpots/nova/ru/%2Btranslate?show=untranslated) | 15 [15](/nova/trunk/%2Bpots/nova/ru/%2Btranslate?show=new_suggestions) | 2013-05-21 06:50:11 UTC 2013-05-21 |
| [Serbian](/nova/trunk/%2Bpots/nova/sr/%2Btranslate) | 1 099.93  0.06587615283267458% translated  99.93412384716733% untranslated | 1517 [1517](/nova/trunk/%2Bpots/nova/sr/%2Btranslate?show=untranslated) | 0 0 | 2014-04-02 15:56:24 UTC 2014-04-02 |
| [Slovak](/nova/trunk/%2Bpots/nova/sk/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/sk/%2Btranslate?show=untranslated) | 6 [6](/nova/trunk/%2Bpots/nova/sk/%2Btranslate?show=new_suggestions) | 2013-09-09 20:15:25 UTC 2013-09-09 |
| [Spanish](/nova/trunk/%2Bpots/nova/es/%2Btranslate) | 1517 000.07  99.93412384716733% translated  0.06587615283267458% untranslated | 1 [1](/nova/trunk/%2Bpots/nova/es/%2Btranslate?show=untranslated) | 80 [80](/nova/trunk/%2Bpots/nova/es/%2Btranslate?show=new_suggestions) | 2013-07-09 23:15:49 UTC 2013-07-09 |
| [Swedish](/nova/trunk/%2Bpots/nova/sv/%2Btranslate) | 20 098.68  1.3175230566534915% translated  98.68247694334651% untranslated | 1498 [1498](/nova/trunk/%2Bpots/nova/sv/%2Btranslate?show=untranslated) | 1 [1](/nova/trunk/%2Bpots/nova/sv/%2Btranslate?show=new_suggestions) | 2013-01-15 20:08:01 UTC 2013-01-15 |
| [Tagalog](/nova/trunk/%2Bpots/nova/tl/%2Btranslate) | 6 099.60  0.3952569169960474% translated  99.60474308300395% untranslated | 1512 [1512](/nova/trunk/%2Bpots/nova/tl/%2Btranslate?show=untranslated) | 0 0 | 2011-08-23 11:21:43 UTC 2011-08-23 |
| [Tajik](/nova/trunk/%2Bpots/nova/tg/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/tg/%2Btranslate?show=untranslated) | 0 0 | 2020-07-23 06:12:18 UTC 2020-07-23 |
| [Tamil](/nova/trunk/%2Bpots/nova/ta/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ta/%2Btranslate?show=untranslated) | 0 0 | 2014-04-02 15:56:25 UTC 2014-04-02 |
| [Thai](/nova/trunk/%2Bpots/nova/th/%2Btranslate) | 5 099.67  0.32938076416337286% translated  99.67061923583663% untranslated | 1513 [1513](/nova/trunk/%2Bpots/nova/th/%2Btranslate?show=untranslated) | 0 0 | 2012-05-27 00:06:52 UTC 2012-05-27 |
| [Tibetan](/nova/trunk/%2Bpots/nova/bo/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/bo/%2Btranslate?show=untranslated) | 0 0 | 2019-12-12 01:59:05 UTC 2019-12-12 |
| [Turkish](/nova/trunk/%2Bpots/nova/tr/%2Btranslate) | 28 098.16  1.844532279314888% translated  98.15546772068511% untranslated | 1490 [1490](/nova/trunk/%2Bpots/nova/tr/%2Btranslate?show=untranslated) | 43 [43](/nova/trunk/%2Bpots/nova/tr/%2Btranslate?show=new_suggestions) | 2013-03-14 06:55:20 UTC 2013-03-14 |
| [Ukrainian](/nova/trunk/%2Bpots/nova/uk/%2Btranslate) | 19 098.75  1.251646903820817% translated  98.74835309617919% untranslated | 1499 [1499](/nova/trunk/%2Bpots/nova/uk/%2Btranslate?show=untranslated) | 391 [391](/nova/trunk/%2Bpots/nova/uk/%2Btranslate?show=new_suggestions) | 2011-08-23 11:21:35 UTC 2011-08-23 |
| [Urdu](/nova/trunk/%2Bpots/nova/ur/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ur/%2Btranslate?show=untranslated) | 0 0 | 2013-12-05 23:09:34 UTC 2013-12-05 |
| [Uyghur](/nova/trunk/%2Bpots/nova/ug/%2Btranslate) | 0 100.00  100.0% untranslated | 1518 [1518](/nova/trunk/%2Bpots/nova/ug/%2Btranslate?show=untranslated) | 1 [1](/nova/trunk/%2Bpots/nova/ug/%2Btranslate?show=new_suggestions) | 2012-03-18 09:35:05 UTC 2012-03-18 |

[ [Change your preferred languages...](/%2Beditmylanguages)
—
View all languages
]

![Key to this table: “Unchanged” means](/@@/green-bar)
Translated

![and “untranslated” means just that,](/@@/red-bar)
Untranslated

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from bugs.launchpad.net_60f9b624_20250115_123930.html ===

[Log in / Register](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* [Translations](https://translations.launchpad.net/nova)
* [Answers](https://answers.launchpad.net/nova)

# [OSSA-2021-002] Open Redirect in noVNC proxy (CVE-2021-3654)

Bug #1927677 reported by
[Swe W Aung](https://launchpad.net/~sirswa)
on 2021-05-07

[280](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Compute (nova)](https://bugs.launchpad.net/nova) | Fix Released | Undecided | Unassigned |  |
|  | [Stein](https://bugs.launchpad.net/nova/stein) | In Progress | Undecided | Unassigned |  |
|  | [Train](https://bugs.launchpad.net/nova/train) | Fix Released | Undecided | Unassigned |  |
|  | [Ussuri](https://bugs.launchpad.net/nova/ussuri) | Fix Released | Undecided | Unassigned |  |
|  | [Victoria](https://bugs.launchpad.net/nova/victoria) | Fix Released | Undecided | Unassigned |  |
|  | [Wallaby](https://bugs.launchpad.net/nova/wallaby) | Fix Released | Undecided | Unassigned |  |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Undecided | Unassigned |  |

### Bug Description

This bug report is related to Security.

Currently novnc is allowing open direction, which could potentially be used for phishing attempts

To test.

https://<sites' vnc domain>//example.com/%2F..

include .. at the end

For example:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

It will redirect to example.com. You can replace example.com with some legitimate domain or spoofed domain.

The description of the risk is

By modifying untrusted URL input to a malicious site, an attacker may successfully launch a phishing scam and steal user credentials.

Because the server name in the modified link is identical to the original site, phishing attempts may have a more trustworthy appearance.

See [original description](comments/0)

Tags:

[console](/nova/%2Bbugs?field.tag=console)
[in-stable-train](/nova/%2Bbugs?field.tag=in-stable-train)
[in-stable-ussuri](/nova/%2Bbugs?field.tag=in-stable-ussuri)
[in-stable-victoria](/nova/%2Bbugs?field.tag=in-stable-victoria)
[in-stable-wallaby](/nova/%2Bbugs?field.tag=in-stable-wallaby)
[in-stable-xena](/nova/%2Bbugs?field.tag=in-stable-xena)
[in-stable-yoga](/nova/%2Bbugs?field.tag=in-stable-yoga)
[novnc](/nova/%2Bbugs?field.tag=novnc)

## CVE References

* [2021-28861](/bugs/cve/2021-28861 "** DISPUTED ** Python 3.x through 3.1...")
* [2021-3654](/bugs/cve/2021-3654 "A vulnerability was found in openstac...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-07: |  |  | [#1](/nova/%2Bbug/1927677/comments/1) |
| --- | --- | --- | --- |

You can also test from the host that running novnc service,

nova:~# curl -v '[http://127.0.0.1:6080//google.com/%2F..'](http://127.0.0.1:6080//google.com//..%27)

\* Trying 127.0.0.1...

\* TCP\_NODELAY set

\* Connected to 127.0.0.1 (127.0.0.1) port 6080 (#0)

> GET //google.com/%2F.. HTTP/1.1

> Host: 127.0.0.1:6080

> User-Agent: curl/7.58.0

> Accept: \*/\*

>

< HTTP/1.1 301 Moved Permanently

< Server: WebSockify Python/3.6.9

< Date: Fri, 07 May 2021 04:49:39 GMT

< Location: //google.com/%2F../

\* no chunk, no close, no size. Assume close to signal end

<

You can also test from the host that running novnc service,
nova:~# curl -v 'http://127.0.0.1:6080//google.com/%2F..'
\* Trying 127.0.0.1...
\* TCP\_NODELAY set
\* Connected to 127.0.0.1 (127.0.0.1) port 6080 (#0)
> GET //google.com/%2F.. HTTP/1.1
> Host: 127.0.0.1:6080
> User-Agent: curl/7.58.0
> Accept: \*/\*
>
< HTTP/1.1 301 Moved Permanently
< Server: WebSockify Python/3.6.9
< Date: Fri, 07 May 2021 04:49:39 GMT
< Location: //google.com/%2F../
\* no chunk, no close, no size. Assume close to signal end
<

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-05-07: |  |  | [#2](/nova/%2Bbug/1927677/comments/2) |
| --- | --- | --- | --- |

Since this report concerns a possible security risk, an incomplete

security advisory task has been added while the core security

reviewers for the affected project or projects confirm the bug and

discuss the scope of any vulnerability along with potential

solutions.

Since this report concerns a possible security risk, an incomplete
security advisory task has been added while the core security
reviewers for the affected project or projects confirm the bug and
discuss the scope of any vulnerability along with potential
solutions.

| **description**: | updated |
| --- | --- |
| Changed in ossa: | |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-11: |  |  | [#3](/nova/%2Bbug/1927677/comments/3) |
| --- | --- | --- | --- |

This bug report reminds me of an old bug [1] we dealt with in the past where the canned vnc\_auto.html and vnc.html pages allowed injection of arbitrary HTML into them (fixed in noVNC 0.6.2) [2].

vnc\_auto.html (vnc\_lite.html as of v1.0.0) and vnc.html have a feature where a host and port can be specified as query parameters in the URL, example [3]:

<http://1.2.3.4:6080/vnc_auto.html?host=6.7.8.9&port=6080>

and it will connect to a noVNC server running on that host:port as the source of data provided to vnc\_auto.html. The bug [2] meant that if a user specified host:port in the URL query parameters, a potentially malicious noVNC server running on that host:port could inject arbitrary HTML into the vnc\_auto.html being served on the user's machine.

I mention that because it seems like the host:port functionality could be similarly used to phish. I'm thinking if someone ran their own noVNC server at host:port and got a user to click on a link with ?host&port in it, they could steal credentials if the user didn't notice what machine they're connecting to.

If that's the case, I'm not sure this redirect behavior is much different than what is already built-in to the vnc\_lite.html and vnc.html pages that come with noVNC.

Aside from that, it's not clear to me whether this redirect behavior is something we (nova) control or if it's being done by noVNC itself. If it's the latter, I'm not sure whether we could do anything to intercept it or if it's something that would have to be changed in noVNC.

I'm going to add noVNC to this bug to get their input about the redirect behavior.

[1] [https://bugs.launchpad.net/horizon/+bug/1656435](https://bugs.launchpad.net/horizon/%2Bbug/1656435)

[2] <https://github.com/novnc/noVNC/issues/748>

[3] <https://github.com/novnc/noVNC/blob/v1.1.0/vnc_lite.html#L14-L15>

This bug report reminds me of an old bug [1] we dealt with in the past where the canned vnc\_auto.html and vnc.html pages allowed injection of arbitrary HTML into them (fixed in noVNC 0.6.2) [2].
vnc\_auto.html (vnc\_lite.html as of v1.0.0) and vnc.html have a feature where a host and port can be specified as query parameters in the URL, example [3]:
http://1.2.3.4:6080/vnc\_auto.html?host=6.7.8.9&port=6080
and it will connect to a noVNC server running on that host:port as the source of data provided to vnc\_auto.html. The bug [2] meant that if a user specified host:port in the URL query parameters, a potentially malicious noVNC server running on that host:port could inject arbitrary HTML into the vnc\_auto.html being served on the user's machine.
I mention that because it seems like the host:port functionality could be similarly used to phish. I'm thinking if someone ran their own noVNC server at host:port and got a user to click on a link with ?host&port in it, they could steal credentials if the user didn't notice what machine they're connecting to.
If that's the case, I'm not sure this redirect behavior is much different than what is already built-in to the vnc\_lite.html and vnc.html pages that come with noVNC.
Aside from that, it's not clear to me whether this redirect behavior is something we (nova) control or if it's being done by noVNC itself. If it's the latter, I'm not sure whether we could do anything to intercept it or if it's something that would have to be changed in noVNC.
I'm going to add noVNC to this bug to get their input about the redirect behavior.
[1] https://bugs.launchpad.net/horizon/+bug/1656435
[2] https://github.com/novnc/noVNC/issues/748
[3] https://github.com/novnc/noVNC/blob/v1.1.0/vnc\_lite.html#L14-L15

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-11: |  |  | [#4](/nova/%2Bbug/1927677/comments/4) |
| --- | --- | --- | --- |

> I'm going to add noVNC to this bug to get their input about the redirect behavior.

Looks like I can't do that because noVNC and websockify use github issues and those can't be private security. But if it is indeed an issue in noVNC or websockify, then it is probably OK to go ahead and report it publicly in those projects.

I'm going to do some local testing to determine whether this redirect is something we could intercept and handle or if it happens before we (websockify plugin) are called. If it doesn't appear we can intercept it, we can switch this to public and I can report an issue for noVNC or websockify on github.

> I'm going to add noVNC to this bug to get their input about the redirect behavior.
Looks like I can't do that because noVNC and websockify use github issues and those can't be private security. But if it is indeed an issue in noVNC or websockify, then it is probably OK to go ahead and report it publicly in those projects.
I'm going to do some local testing to determine whether this redirect is something we could intercept and handle or if it happens before we (websockify plugin) are called. If it doesn't appear we can intercept it, we can switch this to public and I can report an issue for noVNC or websockify on github.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#5](/nova/%2Bbug/1927677/comments/5) |
| --- | --- | --- | --- |

* [lp1927677.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5496768/%2Bfiles/lp1927677.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5496768)
  (1.6 KiB,
  text/plain)

OK, I really went down the rabbit hole with this one.

The tl;dr is that this is a known issue in the python standard library [1], in the http.server.SimpleHTTPRequestHandler, which WebSockifyRequestHandler derives from and which we ultimately derive from with our NovaProxyRequestHandler.

I found that we \_can\_ intercept this in our code and prevent an open redirect. It could be considered hacky, but I'm attaching a patch that prevents the redirect. It is code copied from a comment on the python issue [2].

The concern about the sample code in the issue is that such code might reject legitimate requests in certain cases. I don't believe we have such a concern with the nova console proxy.

Let me know what you think.

[1] <https://bugs.python.org/issue32084>

[2] <https://bugs.python.org/issue32084#msg306545>

OK, I really went down the rabbit hole with this one.
The tl;dr is that this is a known issue in the python standard library [1], in the http.server.SimpleHTTPRequestHandler, which WebSockifyRequestHandler derives from and which we ultimately derive from with our NovaProxyRequestHandler.
I found that we \_can\_ intercept this in our code and prevent an open redirect. It could be considered hacky, but I'm attaching a patch that prevents the redirect. It is code copied from a comment on the python issue [2].
The concern about the sample code in the issue is that such code might reject legitimate requests in certain cases. I don't believe we have such a concern with the nova console proxy.
Let me know what you think.
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#6](/nova/%2Bbug/1927677/comments/6) |
| --- | --- | --- | --- |

Also, I'm thinking we could make this bug public considering the root cause of the behavior is a public issue in the python standard http.server.SimpleHTTPRequestHandler.

Also, I'm thinking we could make this bug public considering the root cause of the behavior is a public issue in the python standard http.server.SimpleHTTPRequestHandler.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-12: |  |  | [#7](/nova/%2Bbug/1927677/comments/7) |
| --- | --- | --- | --- |

Also, I have tested the patch in comment 5 in devstack and verified it works to return a 400 Bad Request if "//" are included in the URL to redirect, provided that the browser has not previously cached a past redirect.

I used the following URL to test: [http://127.0.0.1:6080//google.com/%2F](http://127.0.0.1:6080//google.com//)..

Also, I have tested the patch in comment 5 in devstack and verified it works to return a 400 Bad Request if "//" are included in the URL to redirect, provided that the browser has not previously cached a past redirect.
I used the following URL to test: http://127.0.0.1:6080//google.com/%2F..

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-05-13

| **description**: | updated |
| --- | --- |
| **information type**: | Private Security → Public |
| **information type**: | Public → Public Security |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-05-13: |  |  | [#8](/nova/%2Bbug/1927677/comments/8) |
| --- | --- | --- | --- |

Thanks for digging into this, Melanie! I've ended the embargo and switched to Public Security given the relatively low risk this represents and its relationship with known issues in WebSockify/stdlib.

If the patch is sufficient and gets backported to stable branches, we could issue an advisory (class A in our report taxonomy). We could also consider it a workaround for a bug in a dependency (class C2), but that gets into determining whether the vulnerability is in the dependency or merely in the way we're using it. I'll leave the security advisory task incomplete for the time being, and we'll see how the fix progresses in review.

Thanks for digging into this, Melanie! I've ended the embargo and switched to Public Security given the relatively low risk this represents and its relationship with known issues in WebSockify/stdlib.
If the patch is sufficient and gets backported to stable branches, we could issue an advisory (class A in our report taxonomy). We could also consider it a workaround for a bug in a dependency (class C2), but that gets into determining whether the vulnerability is in the dependency or merely in the way we're using it. I'll leave the security advisory task incomplete for the time being, and we'll see how the fix progresses in review.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-13:  [**Fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/9) |  |  | [#9](/nova/%2Bbug/1927677/comments/9) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/791297](https://review.opendev.org/c/openstack/nova/%2B/791297)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/791297

| Changed in nova: | |
| --- | --- |
| **status**: | New → In Progress |

[melanie witt (melwitt)](https://launchpad.net/~melwitt)
on 2021-05-13

| **tags**: | added: console |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-14:  [**Re: [Bug 1927677] Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/10) |  |  | [#10](/nova/%2Bbug/1927677/comments/10) |
| --- | --- | --- | --- |

Hi Melanie

The is for the investigation and your effort. Really appreciate that.

Regards

sw3

On Sat, 15 May 2021 at 1:06 am, melanie witt <email address hidden>

wrote:

> \*\* Also affects: nova/train

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/ussuri

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/wallaby

> Importance: Undecided

> Status: New

>

> \*\* Also affects: nova/victoria

> Importance: Undecided

> Status: New

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/1927677>

>

> Title:

> novnc allowing open direction which could potentially be used for

> phishing

>

> Status in OpenStack Compute (nova):

> In Progress

> Status in OpenStack Compute (nova) train series:

> New

> Status in OpenStack Compute (nova) ussuri series:

> New

> Status in OpenStack Compute (nova) victoria series:

> New

> Status in OpenStack Compute (nova) wallaby series:

> New

> Status in OpenStack Security Advisory:

> Incomplete

>

> Bug description:

> This bug report is related to Security.

>

> Currently novnc is allowing open direction, which could potentially be

> used for phishing attempts

>

> To test.

> https://<sites' vnc domain>//example.com/%2F..

> include .. at the end

>

> For example:

> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>

> It will redirect to example.com. You can replace example.com with some

> legitimate domain or spoofed domain.

>

> The description of the risk is

> By modifying untrusted URL input to a malicious site, an attacker may

> successfully launch a phishing scam and steal user credentials.

> Because the server name in the modified link is identical to the

> original site, phishing attempts may have a more trustworthy appearance.

>

> To manage notifications about this bug go to:

> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>

--

Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Hi Melanie
The is for the investigation and your effort. Really appreciate that.
Regards
sw3
On Sat, 15 May 2021 at 1:06 am, melanie witt <1927677@bugs.launchpad.net>
wrote:
> \*\* Also affects: nova/train
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/ussuri
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/wallaby
> Importance: Undecided
> Status: New
>
> \*\* Also affects: nova/victoria
> Importance: Undecided
> Status: New
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/1927677
>
> Title:
> novnc allowing open direction which could potentially be used for
> phishing
>
> Status in OpenStack Compute (nova):
> In Progress
> Status in OpenStack Compute (nova) train series:
> New
> Status in OpenStack Compute (nova) ussuri series:
> New
> Status in OpenStack Compute (nova) victoria series:
> New
> Status in OpenStack Compute (nova) wallaby series:
> New
> Status in OpenStack Security Advisory:
> Incomplete
>
> Bug description:
> This bug report is related to Security.
>
> Currently novnc is allowing open direction, which could potentially be
> used for phishing attempts
>
> To test.
> https://<sites' vnc domain>//example.com/%2F..
> include .. at the end
>
> For example:
> http://vncproxy.my.domain.com//example.com/%2F..
>
> It will redirect to example.com. You can replace example.com with some
> legitimate domain or spoofed domain.
>
> The description of the risk is
> By modifying untrusted URL input to a malicious site, an attacker may
> successfully launch a phishing scam and steal user credentials.
> Because the server name in the modified link is identical to the
> original site, phishing attempts may have a more trustworthy appearance.
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>
--
Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-05-14: |  |  | [#11](/nova/%2Bbug/1927677/comments/11) |
| --- | --- | --- | --- |

Hi Melanie

Thanks for the investigation and the effort. Really appreciate that.

Regards

sw3

On Sat, 15 May 2021 at 7:10 am, Swe Win Aung <email address hidden> wrote:

> Hi Melanie

>

> The is for the investigation and your effort. Really appreciate that.

>

> Regards

> sw3

>

> On Sat, 15 May 2021 at 1:06 am, melanie witt <email address hidden>

> wrote:

>

>> \*\* Also affects: nova/train

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/ussuri

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/wallaby

>> Importance: Undecided

>> Status: New

>>

>> \*\* Also affects: nova/victoria

>> Importance: Undecided

>> Status: New

>>

>> --

>> You received this bug notification because you are subscribed to the bug

>> report.

>> <https://bugs.launchpad.net/bugs/1927677>

>>

>> Title:

>> novnc allowing open direction which could potentially be used for

>> phishing

>>

>> Status in OpenStack Compute (nova):

>> In Progress

>> Status in OpenStack Compute (nova) train series:

>> New

>> Status in OpenStack Compute (nova) ussuri series:

>> New

>> Status in OpenStack Compute (nova) victoria series:

>> New

>> Status in OpenStack Compute (nova) wallaby series:

>> New

>> Status in OpenStack Security Advisory:

>> Incomplete

>>

>> Bug description:

>> This bug report is related to Security.

>>

>> Currently novnc is allowing open direction, which could potentially be

>> used for phishing attempts

>>

>> To test.

>> https://<sites' vnc domain>//example.com/%2F..

>> include .. at the end

>>

>> For example:

>> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>>

>> It will redirect to example.com. You can replace example.com with some

>> legitimate domain or spoofed domain.

>>

>> The description of the risk is

>> By modifying untrusted URL input to a malicious site, an attacker may

>> successfully launch a phishing scam and steal user credentials.

>> Because the server name in the modified link is identical to the

>> original site, phishing attempts may have a more trustworthy appearance.

>>

>> To manage notifications about this bug go to:

>> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>>

> --

> Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

>

--

Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Hi Melanie
Thanks for the investigation and the effort. Really appreciate that.
Regards
sw3
On Sat, 15 May 2021 at 7:10 am, Swe Win Aung <sirswa@gmail.com> wrote:
> Hi Melanie
>
> The is for the investigation and your effort. Really appreciate that.
>
> Regards
> sw3
>
> On Sat, 15 May 2021 at 1:06 am, melanie witt <1927677@bugs.launchpad.net>
> wrote:
>
>> \*\* Also affects: nova/train
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/ussuri
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/wallaby
>> Importance: Undecided
>> Status: New
>>
>> \*\* Also affects: nova/victoria
>> Importance: Undecided
>> Status: New
>>
>> --
>> You received this bug notification because you are subscribed to the bug
>> report.
>> https://bugs.launchpad.net/bugs/1927677
>>
>> Title:
>> novnc allowing open direction which could potentially be used for
>> phishing
>>
>> Status in OpenStack Compute (nova):
>> In Progress
>> Status in OpenStack Compute (nova) train series:
>> New
>> Status in OpenStack Compute (nova) ussuri series:
>> New
>> Status in OpenStack Compute (nova) victoria series:
>> New
>> Status in OpenStack Compute (nova) wallaby series:
>> New
>> Status in OpenStack Security Advisory:
>> Incomplete
>>
>> Bug description:
>> This bug report is related to Security.
>>
>> Currently novnc is allowing open direction, which could potentially be
>> used for phishing attempts
>>
>> To test.
>> https://<sites' vnc domain>//example.com/%2F..
>> include .. at the end
>>
>> For example:
>> http://vncproxy.my.domain.com//example.com/%2F..
>>
>> It will redirect to example.com. You can replace example.com with some
>> legitimate domain or spoofed domain.
>>
>> The description of the risk is
>> By modifying untrusted URL input to a malicious site, an attacker may
>> successfully launch a phishing scam and steal user credentials.
>> Because the server name in the modified link is identical to the
>> original site, phishing attempts may have a more trustworthy appearance.
>>
>> To manage notifications about this bug go to:
>> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>>
> --
> Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"
>
--
Sent from Gmail Mobile. Please excuse random autocorrects and "tpyos"

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-05-15:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/12) |  |  | [#12](/nova/%2Bbug/1927677/comments/12) |
| --- | --- | --- | --- |

Hi sw3,

Thanks for reporting the issue!

Hi sw3,
Thanks for reporting the issue!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-15:  [**Fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/13) |  |  | [#13](/nova/%2Bbug/1927677/comments/13) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791297](https://review.opendev.org/c/openstack/nova/%2B/791297)

Committed: <https://opendev.org/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e>

Submitter: "Zuul (22348)"

Branch: master

commit 781612b33282ed298f742c85dab58a075c8b793e

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

Reviewed: https://review.opendev.org/c/openstack/nova/+/791297
Committed: https://opendev.org/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e
Submitter: "Zuul (22348)"
Branch: master
commit 781612b33282ed298f742c85dab58a075c8b793e
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-15:  [**Fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/14) |  |  | [#14](/nova/%2Bbug/1927677/comments/14) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/791577](https://review.opendev.org/c/openstack/nova/%2B/791577)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/791577

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/15) |  |  | [#15](/nova/%2Bbug/1927677/comments/15) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/791805](https://review.opendev.org/c/openstack/nova/%2B/791805)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/791805

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/16) |  |  | [#16](/nova/%2Bbug/1927677/comments/16) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/791806](https://review.opendev.org/c/openstack/nova/%2B/791806)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/791806

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-05-17:  [**Fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/17) |  |  | [#17](/nova/%2Bbug/1927677/comments/17) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/791807](https://review.opendev.org/c/openstack/nova/%2B/791807)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/791807

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-06-19:  [**Fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/18) |  |  | [#18](/nova/%2Bbug/1927677/comments/18) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791577](https://review.opendev.org/c/openstack/nova/%2B/791577)

Committed: <https://opendev.org/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 470925614223c8dd9b1233f54f5a96c02b2d4f70

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791577
Committed: https://opendev.org/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 470925614223c8dd9b1233f54f5a96c02b2d4f70
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-09:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/19) |  |  | [#19](/nova/%2Bbug/1927677/comments/19) |
| --- | --- | --- | --- |

Since we have fixes for this merged to all maintained stable branches (and them some), we need to decide whether we're issuing a security advisory about this or merely treating it as hardening. Does anyone have an opinion?

Since we have fixes for this merged to all maintained stable branches (and them some), we need to decide whether we're issuing a security advisory about this or merely treating it as hardening. Does anyone have an opinion?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-09: |  |  | [#20](/nova/%2Bbug/1927677/comments/20) |
| --- | --- | --- | --- |

The fix backports have been proposed but are not yet merged on stable/victoria, stable/ussuri, and stable/train.

This issue is considered to be of "moderate" severity and is a result of a publicly reported behavior in the python standard library [1] and the http.server documentation has a warning on it that states, "Warning http.server is not recommended for production. It only implements basic security checks." [2].

Our dependency however, the websockify server [3], is based upon http.server and AFAIK websockify isn't characterized as only for dev or non-production use.

There is currently a pull request proposed to fix [1] and it is currently under review [4].

Based on this, I tend to think to treat it as hardening, but of course I defer to the expert opinion of the VMT.

[1] <https://bugs.python.org/issue43223>

[2] <https://docs.python.org/3/library/http.server.html>

[3] <https://github.com/novnc/websockify>

[4] <https://github.com/python/cpython/pull/24848>

The fix backports have been proposed but are not yet merged on stable/victoria, stable/ussuri, and stable/train.
This issue is considered to be of "moderate" severity and is a result of a publicly reported behavior in the python standard library [1] and the http.server documentation has a warning on it that states, "Warning http.server is not recommended for production. It only implements basic security checks." [2].
Our dependency however, the websockify server [3], is based upon http.server and AFAIK websockify isn't characterized as only for dev or non-production use.
There is currently a pull request proposed to fix [1] and it is currently under review [4].
Based on this, I tend to think to treat it as hardening, but of course I defer to the expert opinion of the VMT.
[1] https://bugs.python.org/issue43223
[2] https://docs.python.org/3/library/http.server.html
[3] https://github.com/novnc/websockify
[4] https://github.com/python/cpython/pull/24848

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Joshua Padman (jpadman)](https://launchpad.net/~jpadman) wrote on 2021-07-12: |  |  | [#21](/nova/%2Bbug/1927677/comments/21) |
| --- | --- | --- | --- |

The last OSSA that was released was also for an open redirect.

<https://security.openstack.org/ossa/OSSA-2020-008.html>

Its not a fancy vulnerability but it is one that can lead to far more significant issues. Ideally a CVE would be assigned to this, though maybe in the interest of consistency an OSSA may be required too?

The last OSSA that was released was also for an open redirect.
https://security.openstack.org/ossa/OSSA-2020-008.html
Its not a fancy vulnerability but it is one that can lead to far more significant issues. Ideally a CVE would be assigned to this, though maybe in the interest of consistency an OSSA may be required too?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-12: |  |  | [#22](/nova/%2Bbug/1927677/comments/22) |
| --- | --- | --- | --- |

Melanie: Thanks for pointing out that the backports for branches prior to stable/wallaby haven't merged yet; I misread the notifications. We can't publish an advisory anyway until those are merged for the maintained branches at a minimum (fixes for branches under extended maintenance can merge after any advisory though).

Joshua: As Melanie points out, what we're providing is a workaround for a known security flaw in a dependency, so differs slightly from OSSA-2020-008 in that regard. You are right though that the end result is roughly the same for vulnerable deployments, and unlike most vulnerabilities involving dependencies this is one we actually have an active mitigation for which doesn't require any additional action on the part of the deployer other than upgrading our software in the deployment (no additional configuration or dependency upgrade steps needed).

I'm disappearing on a week-long vacation tomorrow, but if someone wants to compose an impact description for this and request a CVE from MITRE with it (or assign one as a CNA), I'm happy to help coordinate any advisory when I get home. Our template for impact descriptions can be found here: <https://security.openstack.org/vmt-process.html#impact-description-description>

Melanie: Thanks for pointing out that the backports for branches prior to stable/wallaby haven't merged yet; I misread the notifications. We can't publish an advisory anyway until those are merged for the maintained branches at a minimum (fixes for branches under extended maintenance can merge after any advisory though).
Joshua: As Melanie points out, what we're providing is a workaround for a known security flaw in a dependency, so differs slightly from OSSA-2020-008 in that regard. You are right though that the end result is roughly the same for vulnerable deployments, and unlike most vulnerabilities involving dependencies this is one we actually have an active mitigation for which doesn't require any additional action on the part of the deployer other than upgrading our software in the deployment (no additional configuration or dependency upgrade steps needed).
I'm disappearing on a week-long vacation tomorrow, but if someone wants to compose an impact description for this and request a CVE from MITRE with it (or assign one as a CNA), I'm happy to help coordinate any advisory when I get home. Our template for impact descriptions can be found here: https://security.openstack.org/vmt-process.html#impact-description-description

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-15:  [**Fix included in openstack/nova 23.0.2**](/nova/%2Bbug/1927677/comments/23) |  |  | [#23](/nova/%2Bbug/1927677/comments/23) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 23.0.2 release.

This issue was fixed in the openstack/nova 23.0.2 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-23:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/24) |  |  | [#24](/nova/%2Bbug/1927677/comments/24) |
| --- | --- | --- | --- |

Red Hat will be assigning a CVE for this. Sirswa, would you like to be credited as the reporter? What name should we put down? Do you represent an organization?

Red Hat will be assigning a CVE for this. Sirswa, would you like to be credited as the reporter? What name should we put down? Do you represent an organization?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Shahaan Ayyub (shahaan)](https://launchpad.net/~shahaan) wrote on 2021-07-24:  [**Re: [Bug 1927677] Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/25) |  |  | [#25](/nova/%2Bbug/1927677/comments/25) |
| --- | --- | --- | --- |

Thanks Nick,

  We are part of the Monash University Nectar Cloud team. Please feel free

to put us reporters.

Swe Aung

Shahaan Ayyub

Regards,

Shahaan

On Sat, 24 Jul 2021 at 09:25, Nick Tait <email address hidden> wrote:

> Red Hat will be assigning a CVE for this. Sirswa, would you like to be

> credited as the reporter? What name should we put down? Do you represent

> an organization?

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/1927677>

>

> Title:

> novnc allowing open direction which could potentially be used for

> phishing

>

> Status in OpenStack Compute (nova):

> Fix Released

> Status in OpenStack Compute (nova) train series:

> In Progress

> Status in OpenStack Compute (nova) ussuri series:

> In Progress

> Status in OpenStack Compute (nova) victoria series:

> In Progress

> Status in OpenStack Compute (nova) wallaby series:

> Fix Released

> Status in OpenStack Security Advisory:

> Incomplete

>

> Bug description:

> This bug report is related to Security.

>

> Currently novnc is allowing open direction, which could potentially be

> used for phishing attempts

>

> To test.

> https://<sites' vnc domain>//example.com/%2F..

> include .. at the end

>

> For example:

> [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

>

> It will redirect to example.com. You can replace example.com with some

> legitimate domain or spoofed domain.

>

> The description of the risk is

> By modifying untrusted URL input to a malicious site, an attacker may

> successfully launch a phishing scam and steal user credentials.

> Because the server name in the modified link is identical to the

> original site, phishing attempts may have a more trustworthy appearance.

>

> To manage notifications about this bug go to:

> [https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions)

>

>

Thanks Nick,
We are part of the Monash University Nectar Cloud team. Please feel free
to put us reporters.
Swe Aung
Shahaan Ayyub
Regards,
Shahaan
On Sat, 24 Jul 2021 at 09:25, Nick Tait <1927677@bugs.launchpad.net> wrote:
> Red Hat will be assigning a CVE for this. Sirswa, would you like to be
> credited as the reporter? What name should we put down? Do you represent
> an organization?
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/1927677
>
> Title:
> novnc allowing open direction which could potentially be used for
> phishing
>
> Status in OpenStack Compute (nova):
> Fix Released
> Status in OpenStack Compute (nova) train series:
> In Progress
> Status in OpenStack Compute (nova) ussuri series:
> In Progress
> Status in OpenStack Compute (nova) victoria series:
> In Progress
> Status in OpenStack Compute (nova) wallaby series:
> Fix Released
> Status in OpenStack Security Advisory:
> Incomplete
>
> Bug description:
> This bug report is related to Security.
>
> Currently novnc is allowing open direction, which could potentially be
> used for phishing attempts
>
> To test.
> https://<sites' vnc domain>//example.com/%2F..
> include .. at the end
>
> For example:
> http://vncproxy.my.domain.com//example.com/%2F..
>
> It will redirect to example.com. You can replace example.com with some
> legitimate domain or spoofed domain.
>
> The description of the risk is
> By modifying untrusted URL input to a malicious site, an attacker may
> successfully launch a phishing scam and steal user credentials.
> Because the server name in the modified link is identical to the
> original site, phishing attempts may have a more trustworthy appearance.
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/nova/+bug/1927677/+subscriptions
>
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-24:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/26) |  |  | [#26](/nova/%2Bbug/1927677/comments/26) |
| --- | --- | --- | --- |

Nick: Thanks for offering to assign a CVE for this. Do you have text for an impact description you'll be using in the CVE? If not, I can work on putting one together, though we still don't have any ETA on when the workarounds will merge to stable/victoria and earlier branches (and wouldn't issue a formal advisory until they do).

Nick: Thanks for offering to assign a CVE for this. Do you have text for an impact description you'll be using in the CVE? If not, I can work on putting one together, though we still don't have any ETA on when the workarounds will merge to stable/victoria and earlier branches (and wouldn't issue a formal advisory until they do).

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Swe W Aung (sirswa)](https://launchpad.net/~sirswa) wrote on 2021-07-26: |  |  | [#27](/nova/%2Bbug/1927677/comments/27) |
| --- | --- | --- | --- |

Hi Nick

Thanks. I noticed the CVE at RedHat few days ago. Thank you for following up and assigning at RedHat.

I will have to acknowledge Monash University Cyber Security team's vulnerability discovery work and raising the issue to us originally. I work for Monash University.

Our names are

Swe Aung

Shahaan Ayyub

Salman Khan (Cyber Security)

Thank you.

Hi Nick
Thanks. I noticed the CVE at RedHat few days ago. Thank you for following up and assigning at RedHat.
I will have to acknowledge Monash University Cyber Security team's vulnerability discovery work and raising the issue to us originally. I work for Monash University.
Our names are
Swe Aung
Shahaan Ayyub
Salman Khan (Cyber Security)
Thank you.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-26:  [**Fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/28) |  |  | [#28](/nova/%2Bbug/1927677/comments/28) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791805](https://review.opendev.org/c/openstack/nova/%2B/791805)

Committed: <https://opendev.org/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:

        nova/console/websocketproxy.py

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflicts are because the following changes are not

    in Victoria:

Ib2c406327fef2fb4868d8050fc476a7d17706e23 (Remove six.moves)

      I58b0382c86d4ef798572edb63d311e0e3e6937bb (Refactor and rename

        test\_tcp\_rst\_no\_compute\_rpcapi)

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791805
Committed: https://opendev.org/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Conflicts:
nova/console/websocketproxy.py
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflicts are because the following changes are not
in Victoria:
Ib2c406327fef2fb4868d8050fc476a7d17706e23 (Remove six.moves)
I58b0382c86d4ef798572edb63d311e0e3e6937bb (Refactor and rename
test\_tcp\_rst\_no\_compute\_rpcapi)
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-27:  [**Fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/29) |  |  | [#29](/nova/%2Bbug/1927677/comments/29) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791806](https://review.opendev.org/c/openstack/nova/%2B/791806)

Committed: <https://opendev.org/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 719e651e6be277950632e0c2cf5cc9a018344e7b

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

    (cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791806
Committed: https://opendev.org/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 719e651e6be277950632e0c2cf5cc9a018344e7b
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)
(cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/30) |  |  | [#30](/nova/%2Bbug/1927677/comments/30) |
| --- | --- | --- | --- |

Actually, since the stable/train branch has transitioned from maintained to extended maintenance status we no longer need to hold off any advisory waiting for the fix there to merge. I'll go ahead and start drafting the advisory now, since the stable/ussuri fix has merged.

Actually, since the stable/train branch has transitioned from maintained to extended maintenance status we no longer need to hold off any advisory waiting for the fix there to merge. I'll go ahead and start drafting the advisory now, since the stable/ussuri fix has merged.

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |
| **importance**: | Undecided → Medium |
| **assignee**: | nobody → Jeremy Stanley (fungi) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27: |  |  | [#31](/nova/%2Bbug/1927677/comments/31) |
| --- | --- | --- | --- |

Nick: What CVE number have you assigned for this? Or should I go ahead and ask MITRE to assign one?

Nick: What CVE number have you assigned for this? Or should I go ahead and ask MITRE to assign one?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-27 (last edit on 2021-07-27): |  |  | [#32](/nova/%2Bbug/1927677/comments/32) |
| --- | --- | --- | --- |

I'm working on getting reviews for the backport patches, only the stable/train patch remains.

(update) Oops, I just now see Jeremy's comment #30. Makes sense.

I'm working on getting reviews for the backport patches, only the stable/train patch remains.
(update) Oops, I just now see Jeremy's comment #30. Makes sense.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-27:  [**Fix proposed to ossa (master)**](/nova/%2Bbug/1927677/comments/33) |  |  | [#33](/nova/%2Bbug/1927677/comments/33) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/802590](https://review.opendev.org/c/openstack/ossa/%2B/802590)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/802590

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-27:  [**Re: novnc allowing open direction which could potentially be used for phishing**](/nova/%2Bbug/1927677/comments/34) |  |  | [#34](/nova/%2Bbug/1927677/comments/34) |
| --- | --- | --- | --- |

Can folks please review the impact description and related metadata in the draft OSSA-2021-002 linked above? I've left the CVE blank for now since I'm waiting for Nick to say what number he assigned.

Can folks please review the impact description and related metadata in the draft OSSA-2021-002 linked above? I've left the CVE blank for now since I'm waiting for Nick to say what number he assigned.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-27: |  |  | [#35](/nova/%2Bbug/1927677/comments/35) |
| --- | --- | --- | --- |

CVE-2021-3654 <https://access.redhat.com/security/cve/CVE-2021-3654>

CVE-2021-3654 https://access.redhat.com/security/cve/CVE-2021-3654

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Nick Tait (nickthetait)](https://launchpad.net/~nickthetait) wrote on 2021-07-27: |  |  | [#36](/nova/%2Bbug/1927677/comments/36) |
| --- | --- | --- | --- |

And cheers to the trio at Monash for reporting. Thanks!

And cheers to the trio at Monash for reporting. Thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-07-28:  [**Re: Open Redirect in noVNC proxy (CVE-2021-3654)**](/nova/%2Bbug/1927677/comments/37) |  |  | [#37](/nova/%2Bbug/1927677/comments/37) |
| --- | --- | --- | --- |

The draft advisory has been updated with the CVE (thanks again, Nick!) and a proposed publication date of tomorrow, so if folks could please review <https://review.opendev.org/802590> that will help a ton.

The draft advisory has been updated with the CVE (thanks again, Nick!) and a proposed publication date of tomorrow, so if folks could please review https://review.opendev.org/802590 that will help a ton.

| **summary**: | - novnc allowing open direction which could potentially be used for- phishing+ Open Redirect in noVNC proxy (CVE-2021-3654) |
| --- | --- |
| Changed in ossa: | |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-29:  [**Fix merged to ossa (master)**](/nova/%2Bbug/1927677/comments/38) |  |  | [#38](/nova/%2Bbug/1927677/comments/38) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/802590](https://review.opendev.org/c/openstack/ossa/%2B/802590)

Committed: <https://opendev.org/openstack/ossa/commit/08f2c78ccf3688ad2ed44d0c2239742ea1693cdb>

Submitter: "Zuul (22348)"

Branch: master

commit 08f2c78ccf3688ad2ed44d0c2239742ea1693cdb

Author: Jeremy Stanley <email address hidden>

Date: Tue Jul 27 17:44:41 2021 +0000

Add OSSA-2021-002 (CVE-2021-3654)

Change-Id: I1574738a9aa047314c9b933f8bbe032d346cd2d7

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/ossa/+/802590
Committed: https://opendev.org/openstack/ossa/commit/08f2c78ccf3688ad2ed44d0c2239742ea1693cdb
Submitter: "Zuul (22348)"
Branch: master
commit 08f2c78ccf3688ad2ed44d0c2239742ea1693cdb
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Tue Jul 27 17:44:41 2021 +0000
Add OSSA-2021-002 (CVE-2021-3654)
Change-Id: I1574738a9aa047314c9b933f8bbe032d346cd2d7
Closes-Bug: #1927677

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Jeremy Stanley (fungi)](https://launchpad.net/~fungi)
on 2021-07-29

| **summary**: | - Open Redirect in noVNC proxy (CVE-2021-3654)+ [OSSA-2021-002]Open Redirect in noVNC proxy (CVE-2021-3654) |
| --- | --- |
| **summary**: | - [OSSA-2021-002]Open Redirect in noVNC proxy (CVE-2021-3654)+ [OSSA-2021-002] Open Redirect in noVNC proxy (CVE-2021-3654) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-29:  [**Fix proposed to nova (stable/stein)**](/nova/%2Bbug/1927677/comments/39) |  |  | [#39](/nova/%2Bbug/1927677/comments/39) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/802935](https://review.opendev.org/c/openstack/nova/%2B/802935)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/802935

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/40) |  |  | [#40](/nova/%2Bbug/1927677/comments/40) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/803091](https://review.opendev.org/c/openstack/nova/%2B/803091)

Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/803091

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-07-31: |  |  | [#41](/nova/%2Bbug/1927677/comments/41) |
| --- | --- | --- | --- |

This ^ is just me updating the unit test coverage to work with Python < 3.6 for the courtesy stable/train and stable/stein patches. It's also a general improvement of the unit test to do less mocking.

This ^ is just me updating the unit test coverage to work with Python < 3.6 for the courtesy stable/train and stable/stein patches. It's also a general improvement of the unit test to do less mocking.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/42) |  |  | [#42](/nova/%2Bbug/1927677/comments/42) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/803092](https://review.opendev.org/c/openstack/nova/%2B/803092)

Related fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/803092

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/43) |  |  | [#43](/nova/%2Bbug/1927677/comments/43) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/803093](https://review.opendev.org/c/openstack/nova/%2B/803093)

Related fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/803093

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-07-31:  [**Related fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/44) |  |  | [#44](/nova/%2Bbug/1927677/comments/44) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/803094](https://review.opendev.org/c/openstack/nova/%2B/803094)

Related fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/803094

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-02:  [**Fix proposed to nova (stable/rocky)**](/nova/%2Bbug/1927677/comments/45) |  |  | [#45](/nova/%2Bbug/1927677/comments/45) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/nova/+/803182](https://review.opendev.org/c/openstack/nova/%2B/803182)

Fix proposed to branch: stable/rocky
Review: https://review.opendev.org/c/openstack/nova/+/803182

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#46](/nova/%2Bbug/1927677/comments/46) |
| --- | --- | --- | --- |

Hi,

me and my colleagues were noticing that the patch protects against URLs starting with two slashes, with four slashes, and with more than four slashes. Nevertheless, the patch does not seem to work in case the URL starts with three slashes, e.g.:

[http://vncproxy.my.domain.com///example.com/%2F](http://vncproxy.my.domain.com///example.com//)..

We believe that the reason behind this behaviour is the changes that the URL undergoes when it is split and then unsplit. More specifically:

>>> urlparse.urlunsplit(urlparse.urlsplit('//example.com/%2F..'))

'//example.com/%2F..'

>>> urlparse.urlunsplit(urlparse.urlsplit('///example.com/%2F..'))

'/example.com/%2F..'

>>> urlparse.urlunsplit(urlparse.urlsplit('////example.com/%2F..'))

'//example.com/%2F..'

The first and the last case will be captured by the test introduced by the patch, while the middle case will be sent to the parent class method. This can be observed with both Python 3 and Python 2.

We think that the unsplitting of the url in the patch could be avoided. In the case of Python 3, the reason for which the method is used is to add a final slash to the "path" part of the URL, but this is nevertheless not needed for our purposes (if the URL passes the validity check performed here, the splitting and unsplitting of the URL will be anyway done by the parent class method). Moreover, using the output of the urlsplit + urlunsplit methods causes the aforementioned issue.

I will soon attach a proposal for a Python 2 and a Python 3 patch. Their checks on the URL are slightly different because they mimic the checks that are done by the parent class method in order to identify a redirection case (SimpleHTTPRequestHandler.send\_head defined in SimpleHttpServer.py for Python2 and in http/server.py for Python 3). Please let me know if you are able to reproduce the same issue in your setup and what you think about this.

Hi,
me and my colleagues were noticing that the patch protects against URLs starting with two slashes, with four slashes, and with more than four slashes. Nevertheless, the patch does not seem to work in case the URL starts with three slashes, e.g.:
http://vncproxy.my.domain.com///example.com/%2F..
We believe that the reason behind this behaviour is the changes that the URL undergoes when it is split and then unsplit. More specifically:
>>> urlparse.urlunsplit(urlparse.urlsplit('//example.com/%2F..'))
'//example.com/%2F..'
>>> urlparse.urlunsplit(urlparse.urlsplit('///example.com/%2F..'))
'/example.com/%2F..'
>>> urlparse.urlunsplit(urlparse.urlsplit('////example.com/%2F..'))
'//example.com/%2F..'
The first and the last case will be captured by the test introduced by the patch, while the middle case will be sent to the parent class method. This can be observed with both Python 3 and Python 2.
We think that the unsplitting of the url in the patch could be avoided. In the case of Python 3, the reason for which the method is used is to add a final slash to the "path" part of the URL, but this is nevertheless not needed for our purposes (if the URL passes the validity check performed here, the splitting and unsplitting of the URL will be anyway done by the parent class method). Moreover, using the output of the urlsplit + urlunsplit methods causes the aforementioned issue.
I will soon attach a proposal for a Python 2 and a Python 3 patch. Their checks on the URL are slightly different because they mimic the checks that are done by the parent class method in order to identify a redirection case (SimpleHTTPRequestHandler.send\_head defined in SimpleHttpServer.py for Python2 and in http/server.py for Python 3). Please let me know if you are able to reproduce the same issue in your setup and what you think about this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#47](/nova/%2Bbug/1927677/comments/47) |
| --- | --- | --- | --- |

* [python2.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519968/%2Bfiles/python2.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519968)
  (1.2 KiB,
  text/plain)

This is a proposal for Python 2.

This is a proposal for Python 2.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Matteo Pozza (matteopozza)](https://launchpad.net/~matteopozza) wrote on 2021-08-23: |  |  | [#48](/nova/%2Bbug/1927677/comments/48) |
| --- | --- | --- | --- |

* [python3.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519969/%2Bfiles/python3.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519969)
  (1009 bytes,
  text/plain)

This is a proposal for Python 3.

This is a proposal for Python 3.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-23:  [**Fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/49) |  |  | [#49](/nova/%2Bbug/1927677/comments/49) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/805654

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Balazs Gibizer (balazs-gibizer)](https://launchpad.net/~balazs-gibizer) wrote on 2021-08-24: |  |  | [#50](/nova/%2Bbug/1927677/comments/50) |
| --- | --- | --- | --- |

It is confirmed that the original fix was incomplete. A new fix is being merged to master [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654) (and then backported)

It is confirmed that the original fix was incomplete. A new fix is being merged to master https://review.opendev.org/c/openstack/nova/+/805654 (and then backported)

| Changed in nova: | |
| --- | --- |
| **status**: | Fix Released → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-24:  [**Fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/51) |  |  | [#51](/nova/%2Bbug/1927677/comments/51) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/805654](https://review.opendev.org/c/openstack/nova/%2B/805654)

Committed: <https://opendev.org/openstack/nova/commit/6fbd0b758dcac71323f3be179b1a9d1c17a4acc5>

Submitter: "Zuul (22348)"

Branch: master

commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/nova/+/805654
Committed: https://opendev.org/openstack/nova/commit/6fbd0b758dcac71323f3be179b1a9d1c17a4acc5
Submitter: "Zuul (22348)"
Branch: master
commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-08-24: |  |  | [#52](/nova/%2Bbug/1927677/comments/52) |
| --- | --- | --- | --- |

I've switched the security advisory task back to incomplete for now, while the vulnerability managers debate whether this requires errata publication or a completely new advisory.

I've switched the security advisory task back to incomplete for now, while the vulnerability managers debate whether this requires errata publication or a completely new advisory.

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Released → Incomplete |
| **importance**: | Medium → Undecided |
| **assignee**: | Jeremy Stanley (fungi) → nobody |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-24:  [**Fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/53) |  |  | [#53](/nova/%2Bbug/1927677/comments/53) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/805818](https://review.opendev.org/c/openstack/nova/%2B/805818)

Fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/805818

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-28:  [**Fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/54) |  |  | [#54](/nova/%2Bbug/1927677/comments/54) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/805818](https://review.opendev.org/c/openstack/nova/%2B/805818)

Committed: <https://opendev.org/openstack/nova/commit/47dad4836a26292e9d34e516e1525ecf00be127c>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 47dad4836a26292e9d34e516e1525ecf00be127c

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

Reviewed: https://review.opendev.org/c/openstack/nova/+/805818
Committed: https://opendev.org/openstack/nova/commit/47dad4836a26292e9d34e516e1525ecf00be127c
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 47dad4836a26292e9d34e516e1525ecf00be127c
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Related fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/55) |  |  | [#55](/nova/%2Bbug/1927677/comments/55) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803091](https://review.opendev.org/c/openstack/nova/%2B/803091)

Committed: <https://opendev.org/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af>

Submitter: "Zuul (22348)"

Branch: master

commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

Reviewed: https://review.opendev.org/c/openstack/nova/+/803091
Committed: https://opendev.org/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af
Submitter: "Zuul (22348)"
Branch: master
commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/56) |  |  | [#56](/nova/%2Bbug/1927677/comments/56) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/806626](https://review.opendev.org/c/openstack/nova/%2B/806626)

Fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/806626

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/57) |  |  | [#57](/nova/%2Bbug/1927677/comments/57) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/806628](https://review.opendev.org/c/openstack/nova/%2B/806628)

Fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/806628

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-30:  [**Fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/58) |  |  | [#58](/nova/%2Bbug/1927677/comments/58) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/806629](https://review.opendev.org/c/openstack/nova/%2B/806629)

Fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/806629

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-08-31:  [**Related fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/59) |  |  | [#59](/nova/%2Bbug/1927677/comments/59) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803092](https://review.opendev.org/c/openstack/nova/%2B/803092)

Committed: <https://opendev.org/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803092
Committed: https://opendev.org/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

| **tags**: | added: in-stable-wallaby |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-01:  [**Related fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/60) |  |  | [#60](/nova/%2Bbug/1927677/comments/60) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803093](https://review.opendev.org/c/openstack/nova/%2B/803093)

Committed: <https://opendev.org/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 94e265f3ca615aa18de0081a76975019997b8709

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803093
Committed: https://opendev.org/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 94e265f3ca615aa18de0081a76975019997b8709
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

| **tags**: | added: in-stable-victoria |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-14:  [**Related fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/61) |  |  | [#61](/nova/%2Bbug/1927677/comments/61) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/803094](https://review.opendev.org/c/openstack/nova/%2B/803094)

Committed: <https://opendev.org/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit d43b88a33407b1253e7bce70f720a44f7688141f

Author: melanie witt <email address hidden>

Date: Sat Jul 31 00:30:16 2021 +0000

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

    (cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

Reviewed: https://review.opendev.org/c/openstack/nova/+/803094
Committed: https://opendev.org/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit d43b88a33407b1253e7bce70f720a44f7688141f
Author: melanie witt <melwittt@gmail.com>
Date: Sat Jul 31 00:30:16 2021 +0000
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)
(cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

| **tags**: | added: in-stable-ussuri |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-16:  [**Fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/62) |  |  | [#62](/nova/%2Bbug/1927677/comments/62) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806626](https://review.opendev.org/c/openstack/nova/%2B/806626)

Committed: <https://opendev.org/openstack/nova/commit/9588cdbfd4649ea53d60303f2d10c5d62a070a07>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Conflicts:

      nova/tests/unit/console/test\_websocketproxy.py

NOTE: conflict is due to I58b0382c86d4ef798572edb63d311e0e3e6937bb

    is missing in Victoria and Ie36401c782f023d1d5f2623732619105dc2cfa24

    backport contained conflicts and methods order was swapped.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806626
Committed: https://opendev.org/openstack/nova/commit/9588cdbfd4649ea53d60303f2d10c5d62a070a07
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE: conflict is due to I58b0382c86d4ef798572edb63d311e0e3e6937bb
is missing in Victoria and Ie36401c782f023d1d5f2623732619105dc2cfa24
backport contained conflicts and methods order was swapped.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-17:  [**Fix included in openstack/nova 24.0.0.0rc1**](/nova/%2Bbug/1927677/comments/63) |  |  | [#63](/nova/%2Bbug/1927677/comments/63) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 24.0.0.0rc1 release candidate.

This issue was fixed in the openstack/nova 24.0.0.0rc1 release candidate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-09-24: |  |  | [#65](/nova/%2Bbug/1927677/comments/65) |
| --- | --- | --- | --- |

Note that we're still waiting for <https://review.opendev.org/806628> (stable/ussuri) to merge prior to issuing errata, but its merging is held up by discussions of whether to fix or discontinue running lower bounds testing for dependencies on that branch.

Note that we're still waiting for https://review.opendev.org/806628 (stable/ussuri) to merge prior to issuing errata, but its merging is held up by discussions of whether to fix or discontinue running lower bounds testing for dependencies on that branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [melanie witt (melwitt)](https://launchpad.net/~melwitt) wrote on 2021-09-24: |  |  | [#66](/nova/%2Bbug/1927677/comments/66) |
| --- | --- | --- | --- |

We have actually been rechecking this change to make the l-c job non-voting on stable/ussuri:

[https://review.opendev.org/c/openstack/nova/+/809955](https://review.opendev.org/c/openstack/nova/%2B/809955)

But it has run into failure after unrelated failure in the gate. I have been copy pasting the various errors with every recheck.

We have actually been rechecking this change to make the l-c job non-voting on stable/ussuri:
https://review.opendev.org/c/openstack/nova/+/809955
But it has run into failure after unrelated failure in the gate. I have been copy pasting the various errors with every recheck.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-26:  [**Fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/67) |  |  | [#67](/nova/%2Bbug/1927677/comments/67) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806628](https://review.opendev.org/c/openstack/nova/%2B/806628)

Committed: <https://opendev.org/openstack/nova/commit/0997043f459ac616b594363b5b253bd0ae6ed9eb>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 0997043f459ac616b594363b5b253bd0ae6ed9eb

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

    (cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806628
Committed: https://opendev.org/openstack/nova/commit/0997043f459ac616b594363b5b253bd0ae6ed9eb
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 0997043f459ac616b594363b5b253bd0ae6ed9eb
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)
(cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-27:  [**Fix proposed to ossa (master)**](/nova/%2Bbug/1927677/comments/68) |  |  | [#68](/nova/%2Bbug/1927677/comments/68) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/ossa/+/811181](https://review.opendev.org/c/openstack/ossa/%2B/811181)

Fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/ossa/+/811181

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-09-27:  [**Fix merged to ossa (master)**](/nova/%2Bbug/1927677/comments/69) |  |  | [#69](/nova/%2Bbug/1927677/comments/69) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/ossa/+/811181](https://review.opendev.org/c/openstack/ossa/%2B/811181)

Committed: <https://opendev.org/openstack/ossa/commit/51a1bf0699128c8ddcb7567347cee69492601091>

Submitter: "Zuul (22348)"

Branch: master

commit 51a1bf0699128c8ddcb7567347cee69492601091

Author: Jeremy Stanley <email address hidden>

Date: Mon Sep 27 15:02:06 2021 +0000

Errata 1 for OSSA-2021-002

Change-Id: Iaeb40574176ae62542a0c17e94917e654d38317d

    Closes-Bug: #1927677

Reviewed: https://review.opendev.org/c/openstack/ossa/+/811181
Committed: https://opendev.org/openstack/ossa/commit/51a1bf0699128c8ddcb7567347cee69492601091
Submitter: "Zuul (22348)"
Branch: master
commit 51a1bf0699128c8ddcb7567347cee69492601091
Author: Jeremy Stanley <fungi@yuggoth.org>
Date: Mon Sep 27 15:02:06 2021 +0000
Errata 1 for OSSA-2021-002
Change-Id: Iaeb40574176ae62542a0c17e94917e654d38317d
Closes-Bug: #1927677

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2021-09-27: |  |  | [#70](/nova/%2Bbug/1927677/comments/70) |
| --- | --- | --- | --- |

OSSA-2021-002 errata 1 has been published and distributed to usual mailing lists.

OSSA-2021-002 errata 1 has been published and distributed to usual mailing lists.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 22.3.0**](/nova/%2Bbug/1927677/comments/71) |  |  | [#71](/nova/%2Bbug/1927677/comments/71) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 22.3.0 release.

This issue was fixed in the openstack/nova 22.3.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 23.1.0**](/nova/%2Bbug/1927677/comments/73) |  |  | [#73](/nova/%2Bbug/1927677/comments/73) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 23.1.0 release.

This issue was fixed in the openstack/nova 23.1.0 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-07:  [**Fix included in openstack/nova 21.2.3**](/nova/%2Bbug/1927677/comments/74) |  |  | [#74](/nova/%2Bbug/1927677/comments/74) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova 21.2.3 release.

This issue was fixed in the openstack/nova 21.2.3 release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-10-28:  [**Fix merged to nova (stable/train)**](/nova/%2Bbug/1927677/comments/76) |  |  | [#76](/nova/%2Bbug/1927677/comments/76) |
| --- | --- | --- | --- |

[Download full text](https://bugs.launchpad.net/nova/%2Bbug/1927677/comments/76/%2Bdownload) (3.2 KiB)

Reviewed: [https://review.opendev.org/c/openstack/nova/+/791807](https://review.opendev.org/c/openstack/nova/%2B/791807)

Committed: <https://opendev.org/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 04d48527b62a35d912f93bc75613a6cca606df66

Author: melanie witt <email address hidden>

Date: Thu May 13 05:43:42 2021 +0000

Reject open redirection in the console proxy

NOTE(melwitt): This is the combination of two commits, the bug fix and

    a followup change to the unit test to enable it also run on

    Python < 3.6.

Our console proxies (novnc, serial, spice) run in a websockify server

    whose request handler inherits from the python standard

    SimpleHTTPRequestHandler. There is a known issue [1] in the

    SimpleHTTPRequestHandler which allows open redirects by way of URLs

    in the following format:

[http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection

    URL beginning with "//" by implementing the

    SimpleHTTPRequestHandler.send\_head() method containing the

    vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments

    [2].

Closes-Bug: #1927677

[1] <https://bugs.python.org/issue32084>

    [2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train.

NOTE(melwitt): The difference from the cherry picked change:

    HTTPStatus.BAD\_REQUEST => 400 is due to the fact that HTTPStatus does

    not exist in Python 2.7.

Reduce mocking in test\_reject\_open\_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24

    to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with

    earlier versions of Python < 3.6 due to a difference in internal

    implementation [1].

This reduces the mocking in the unit test to be more agnostic to the

    internals of the StreamRequestHandler (ancestor of

    SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: #1927677

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36

    (cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)

    (cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)

    (cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)

    (cherry picked from commit d43b88a33407b1253e7bce70f720a44f7688141f)

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24

    (cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)

    (cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)

    (cherry picked from commit 6b70350bdcf5...

[Read more...](/nova/%2Bbug/1927677/comments/76)

Reviewed: https://review.opendev.org/c/openstack/nova/+/791807
Committed: https://opendev.org/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66
Submitter: "Zuul (22348)"
Branch: stable/train
commit 04d48527b62a35d912f93bc75613a6cca606df66
Author: melanie witt <melwittt@gmail.com>
Date: Thu May 13 05:43:42 2021 +0000
Reject open redirection in the console proxy
NOTE(melwitt): This is the combination of two commits, the bug fix and
a followup change to the unit test to enable it also run on
Python < 3.6.
Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:
http://vncproxy.my.domain.com//example.com/%2F..
which if visited, will redirect a user to example.com.
We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send\_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.
This code is copied from a patch suggested in one of the issue comments
[2].
Closes-Bug: #1927677
[1] https://bugs.python.org/issue32084
[2] https://bugs.python.org/issue32084#msg306545
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train.
NOTE(melwitt): The difference from the cherry picked change:
HTTPStatus.BAD\_REQUEST => 400 is due to the fact that HTTPStatus does
not exist in Python 2.7.
Reduce mocking in test\_reject\_open\_redirect for compat
This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.
While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].
This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.
Related-Bug: #1927677
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit 214cabe6848a1fdb4f5941d994c6cc11107fc4af)
(cherry picked from commit 9c2f29783734cb5f9cb05a08d328c10e1d16c4f1)
(cherry picked from commit 94e265f3ca615aa18de0081a76975019997b8709)
(cherry picked from commit d43b88a33407b1253e7bce70f720a44f7688141f)
Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit 781612b33282ed298f742c85dab58a075c8b793e)
(cherry picked from commit 470925614223c8dd9b1233f54f5a96c02b2d4f70)
(cherry picked from commit 6b70350bdcf59a9712f88b6435ba2c6500133e5b)
(cherry picked from commit 719e651e6be277950632e0c2cf5cc9a018344e7b)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-11-01: |  |  | [#77](/nova/%2Bbug/1927677/comments/77) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/806629](https://review.opendev.org/c/openstack/nova/%2B/806629)

Committed: <https://opendev.org/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 8906552cfc2525a44251d4cf313ece61e57251eb

Author: Sean Mooney <email address hidden>

Date: Mon Aug 23 15:37:48 2021 +0100

address open redirect with 3 forward slashes

Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended

    to address OSSA-2021-002 (CVE-2021-3654) however after its

    release it was discovered that the fix only worked

    for urls with 2 leading slashes or more then 4.

This change adresses the missing edgecase for 3 leading slashes

    and also maintian support for rejecting 2+.

Conflicts:

      nova/console/websocketproxy.py

      nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict and difference in websocketproxy.py from

    the cherry picked change: HTTPStatus.BAD\_REQUEST => 400 is due to the

    fact that HTTPStatus does not exist in Python 2.7. The conflict in

    test\_websocketproxy.py is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train. The difference

    in test\_websocketproxy.py from the cherry picked change is due to a

    difference in internal implementation [1] in Python < 3.6. See change

    I546d376869a992601b443fb95acf1034da2a8f36 for reference.

[1] <https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286>

Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866

    co-authored-by: Matteo Pozza

    Closes-Bug: #1927677

    (cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)

    (cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)

    (cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)

    (cherry picked from commit 0997043f459ac616b594363b5b253bd0ae6ed9eb)

Reviewed: https://review.opendev.org/c/openstack/nova/+/806629
Committed: https://opendev.org/openstack/nova/commit/8906552cfc2525a44251d4cf313ece61e57251eb
Submitter: "Zuul (22348)"
Branch: stable/train
commit 8906552cfc2525a44251d4cf313ece61e57251eb
Author: Sean Mooney <work@seanmooney.info>
Date: Mon Aug 23 15:37:48 2021 +0100
address open redirect with 3 forward slashes
Ie36401c782f023d1d5f2623732619105dc2cfa24 was intended
to address OSSA-2021-002 (CVE-2021-3654) however after its
release it was discovered that the fix only worked
for urls with 2 leading slashes or more then 4.
This change adresses the missing edgecase for 3 leading slashes
and also maintian support for rejecting 2+.
Conflicts:
nova/console/websocketproxy.py
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict and difference in websocketproxy.py from
the cherry picked change: HTTPStatus.BAD\_REQUEST => 400 is due to the
fact that HTTPStatus does not exist in Python 2.7. The conflict in
test\_websocketproxy.py is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train. The difference
in test\_websocketproxy.py from the cherry picked change is due to a
difference in internal implementation [1] in Python < 3.6. See change
I546d376869a992601b443fb95acf1034da2a8f36 for reference.
[1] https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286
Change-Id: I95f68be76330ff09e5eabb5ef8dd9a18f5547866
co-authored-by: Matteo Pozza
Closes-Bug: #1927677
(cherry picked from commit 6fbd0b758dcac71323f3be179b1a9d1c17a4acc5)
(cherry picked from commit 47dad4836a26292e9d34e516e1525ecf00be127c)
(cherry picked from commit 9588cdbfd4649ea53d60303f2d10c5d62a070a07)
(cherry picked from commit 0997043f459ac616b594363b5b253bd0ae6ed9eb)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2021-11-08:  [**Fix proposed to nova (stable/stein)**](/nova/%2Bbug/1927677/comments/78) |  |  | [#78](/nova/%2Bbug/1927677/comments/78) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/817037](https://review.opendev.org/c/openstack/nova/%2B/817037)

Fix proposed to branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/817037

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-08-17:  [**Related fix proposed to nova (master)**](/nova/%2Bbug/1927677/comments/79) |  |  | [#79](/nova/%2Bbug/1927677/comments/79) |
| --- | --- | --- | --- |

Related fix proposed to branch: master

Review: [https://review.opendev.org/c/openstack/nova/+/853379](https://review.opendev.org/c/openstack/nova/%2B/853379)

Related fix proposed to branch: master
Review: https://review.opendev.org/c/openstack/nova/+/853379

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-08-30:  [**Related fix merged to nova (master)**](/nova/%2Bbug/1927677/comments/80) |  |  | [#80](/nova/%2Bbug/1927677/comments/80) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/853379](https://review.opendev.org/c/openstack/nova/%2B/853379)

Committed: <https://opendev.org/openstack/nova/commit/15769b883ed4a86d62b141ea30d3f1590565d8e0>

Submitter: "Zuul (22348)"

Branch: master

commit 15769b883ed4a86d62b141ea30d3f1590565d8e0

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

Reviewed: https://review.opendev.org/c/openstack/nova/+/853379
Committed: https://opendev.org/openstack/nova/commit/15769b883ed4a86d62b141ea30d3f1590565d8e0
Submitter: "Zuul (22348)"
Branch: master
commit 15769b883ed4a86d62b141ea30d3f1590565d8e0
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11:  [**Change abandoned on nova (stable/rocky)**](/nova/%2Bbug/1927677/comments/81) |  |  | [#81](/nova/%2Bbug/1927677/comments/81) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/rocky

Review: [https://review.opendev.org/c/openstack/nova/+/803182](https://review.opendev.org/c/openstack/nova/%2B/803182)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/rocky
Review: https://review.opendev.org/c/openstack/nova/+/803182
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11:  [**Change abandoned on nova (stable/stein)**](/nova/%2Bbug/1927677/comments/82) |  |  | [#82](/nova/%2Bbug/1927677/comments/82) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/817037](https://review.opendev.org/c/openstack/nova/%2B/817037)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/817037
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-11: |  |  | [#83](/nova/%2Bbug/1927677/comments/83) |
| --- | --- | --- | --- |

Change abandoned by "Elod Illes <email address hidden>" on branch: stable/stein

Review: [https://review.opendev.org/c/openstack/nova/+/802935](https://review.opendev.org/c/openstack/nova/%2B/802935)

Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Change abandoned by "Elod Illes <elod.illes@est.tech>" on branch: stable/stein
Review: https://review.opendev.org/c/openstack/nova/+/802935
Reason: This branch transitioned to End of Life for this project, open patches needs to be closed to be able to delete the branch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/yoga)**](/nova/%2Bbug/1927677/comments/84) |  |  | [#84](/nova/%2Bbug/1927677/comments/84) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/yoga

Review: [https://review.opendev.org/c/openstack/nova/+/866192](https://review.opendev.org/c/openstack/nova/%2B/866192)

Related fix proposed to branch: stable/yoga
Review: https://review.opendev.org/c/openstack/nova/+/866192

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/xena)**](/nova/%2Bbug/1927677/comments/85) |  |  | [#85](/nova/%2Bbug/1927677/comments/85) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/xena

Review: [https://review.opendev.org/c/openstack/nova/+/866193](https://review.opendev.org/c/openstack/nova/%2B/866193)

Related fix proposed to branch: stable/xena
Review: https://review.opendev.org/c/openstack/nova/+/866193

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/86) |  |  | [#86](/nova/%2Bbug/1927677/comments/86) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/wallaby

Review: [https://review.opendev.org/c/openstack/nova/+/866194](https://review.opendev.org/c/openstack/nova/%2B/866194)

Related fix proposed to branch: stable/wallaby
Review: https://review.opendev.org/c/openstack/nova/+/866194

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/87) |  |  | [#87](/nova/%2Bbug/1927677/comments/87) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/victoria

Review: [https://review.opendev.org/c/openstack/nova/+/866195](https://review.opendev.org/c/openstack/nova/%2B/866195)

Related fix proposed to branch: stable/victoria
Review: https://review.opendev.org/c/openstack/nova/+/866195

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/88) |  |  | [#88](/nova/%2Bbug/1927677/comments/88) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/ussuri

Review: [https://review.opendev.org/c/openstack/nova/+/866196](https://review.opendev.org/c/openstack/nova/%2B/866196)

Related fix proposed to branch: stable/ussuri
Review: https://review.opendev.org/c/openstack/nova/+/866196

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-11-30:  [**Related fix proposed to nova (stable/train)**](/nova/%2Bbug/1927677/comments/89) |  |  | [#89](/nova/%2Bbug/1927677/comments/89) |
| --- | --- | --- | --- |

Related fix proposed to branch: stable/train

Review: [https://review.opendev.org/c/openstack/nova/+/866201](https://review.opendev.org/c/openstack/nova/%2B/866201)

Related fix proposed to branch: stable/train
Review: https://review.opendev.org/c/openstack/nova/+/866201

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2022-12-20:  [**Related fix merged to nova (stable/yoga)**](/nova/%2Bbug/1927677/comments/90) |  |  | [#90](/nova/%2Bbug/1927677/comments/90) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866192](https://review.opendev.org/c/openstack/nova/%2B/866192)

Committed: <https://opendev.org/openstack/nova/commit/4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af>

Submitter: "Zuul (22348)"

Branch: stable/yoga

commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866192
Committed: https://opendev.org/openstack/nova/commit/4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af
Submitter: "Zuul (22348)"
Branch: stable/yoga
commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

| **tags**: | added: in-stable-yoga |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/xena)**](/nova/%2Bbug/1927677/comments/91) |  |  | [#91](/nova/%2Bbug/1927677/comments/91) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866193](https://review.opendev.org/c/openstack/nova/%2B/866193)

Committed: <https://opendev.org/openstack/nova/commit/0e4a257e8636a979605c614a35e79ba47b74d870>

Submitter: "Zuul (22348)"

Branch: stable/xena

commit 0e4a257e8636a979605c614a35e79ba47b74d870

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866193
Committed: https://opendev.org/openstack/nova/commit/0e4a257e8636a979605c614a35e79ba47b74d870
Submitter: "Zuul (22348)"
Branch: stable/xena
commit 0e4a257e8636a979605c614a35e79ba47b74d870
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

| **tags**: | added: in-stable-xena |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/wallaby)**](/nova/%2Bbug/1927677/comments/92) |  |  | [#92](/nova/%2Bbug/1927677/comments/92) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866194](https://review.opendev.org/c/openstack/nova/%2B/866194)

Committed: <https://opendev.org/openstack/nova/commit/3023e162e1a415ddaa70b4b8fbe24b1771dbe424>

Submitter: "Zuul (22348)"

Branch: stable/wallaby

commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866194
Committed: https://opendev.org/openstack/nova/commit/3023e162e1a415ddaa70b4b8fbe24b1771dbe424
Submitter: "Zuul (22348)"
Branch: stable/wallaby
commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-10:  [**Related fix merged to nova (stable/victoria)**](/nova/%2Bbug/1927677/comments/93) |  |  | [#93](/nova/%2Bbug/1927677/comments/93) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866195](https://review.opendev.org/c/openstack/nova/%2B/866195)

Committed: <https://opendev.org/openstack/nova/commit/77bc3f004e7fe4077ea035c659630bedef1cfea1>

Submitter: "Zuul (22348)"

Branch: stable/victoria

commit 77bc3f004e7fe4077ea035c659630bedef1cfea1

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I58b0382c86d4ef798572edb63d311e0e3e6937bb

    (Refactor and rename test\_tcp\_rst\_no\_compute\_rpcapi) is not in

    Victoria.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866195
Committed: https://opendev.org/openstack/nova/commit/77bc3f004e7fe4077ea035c659630bedef1cfea1
Submitter: "Zuul (22348)"
Branch: stable/victoria
commit 77bc3f004e7fe4077ea035c659630bedef1cfea1
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I58b0382c86d4ef798572edb63d311e0e3e6937bb
(Refactor and rename test\_tcp\_rst\_no\_compute\_rpcapi) is not in
Victoria.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-11:  [**Related fix merged to nova (stable/ussuri)**](/nova/%2Bbug/1927677/comments/94) |  |  | [#94](/nova/%2Bbug/1927677/comments/94) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866196](https://review.opendev.org/c/openstack/nova/%2B/866196)

Committed: <https://opendev.org/openstack/nova/commit/746d654c23d75f084b6f0c70e6c32b97eebf419c>

Submitter: "Zuul (22348)"

Branch: stable/ussuri

commit 746d654c23d75f084b6f0c70e6c32b97eebf419c

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Related-Bug: #1927677

    Closes-Bug: #1986545

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

    (cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866196
Committed: https://opendev.org/openstack/nova/commit/746d654c23d75f084b6f0c70e6c32b97eebf419c
Submitter: "Zuul (22348)"
Branch: stable/ussuri
commit 746d654c23d75f084b6f0c70e6c32b97eebf419c
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Related-Bug: #1927677
Closes-Bug: #1986545
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)
(cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-01-11:  [**Related fix merged to nova (stable/train)**](/nova/%2Bbug/1927677/comments/95) |  |  | [#95](/nova/%2Bbug/1927677/comments/95) |
| --- | --- | --- | --- |

Reviewed: [https://review.opendev.org/c/openstack/nova/+/866201](https://review.opendev.org/c/openstack/nova/%2B/866201)

Committed: <https://opendev.org/openstack/nova/commit/43af75243b79e95330ecd982552d568571623e39>

Submitter: "Zuul (22348)"

Branch: stable/train

commit 43af75243b79e95330ecd982552d568571623e39

Author: melanie witt <email address hidden>

Date: Tue Aug 16 06:49:53 2022 +0000

Adapt websocketproxy tests for SimpleHTTPServer fix

In response to [bug 1927677](/bugs/1927677) we added a workaround to

    NovaProxyRequestHandler to respond with a 400 Bad Request if an open

    redirect is attempted:

Ie36401c782f023d1d5f2623732619105dc2cfa24

      I95f68be76330ff09e5eabb5ef8dd9a18f5547866

Recently in python 3.10.6, a fix has landed in cpython to respond with

    a 301 Moved Permanently to a sanitized URL that has had extra leading

    '/' characters removed.

This breaks our existing unit tests which assume a 400 Bad Request as

    the only expected response.

This adds handling of a 301 Moved Permanently response and asserts that

    the redirect location is the expected sanitized URL. Doing this instead

    of checking for a given python version will enable the tests to continue

    to work if and when the cpython fix gets backported to older python

    versions.

While updating the tests, the opportunity was taken to commonize the

    code of two unit tests that were nearly identical.

Conflicts:

        nova/tests/unit/console/test\_websocketproxy.py

NOTE(melwitt): The conflict is because change

    I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols

    to be configurable for console proxies) is not in Train. The difference

    from the cherry picked change is because the flake8 version on the

    stable/train branch does not support f-strings [1].

Related-Bug: #1927677

    Closes-Bug: #1986545

[1] <https://lists.openstack.org/pipermail/openstack-discuss/2019-November/011027.html>

Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a

    (cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)

    (cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)

    (cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)

    (cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)

    (cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)

    (cherry picked from commit 746d654c23d75f084b6f0c70e6c32b97eebf419c)

Reviewed: https://review.opendev.org/c/openstack/nova/+/866201
Committed: https://opendev.org/openstack/nova/commit/43af75243b79e95330ecd982552d568571623e39
Submitter: "Zuul (22348)"
Branch: stable/train
commit 43af75243b79e95330ecd982552d568571623e39
Author: melanie witt <melwittt@gmail.com>
Date: Tue Aug 16 06:49:53 2022 +0000
Adapt websocketproxy tests for SimpleHTTPServer fix
In response to bug 1927677 we added a workaround to
NovaProxyRequestHandler to respond with a 400 Bad Request if an open
redirect is attempted:
Ie36401c782f023d1d5f2623732619105dc2cfa24
I95f68be76330ff09e5eabb5ef8dd9a18f5547866
Recently in python 3.10.6, a fix has landed in cpython to respond with
a 301 Moved Permanently to a sanitized URL that has had extra leading
'/' characters removed.
This breaks our existing unit tests which assume a 400 Bad Request as
the only expected response.
This adds handling of a 301 Moved Permanently response and asserts that
the redirect location is the expected sanitized URL. Doing this instead
of checking for a given python version will enable the tests to continue
to work if and when the cpython fix gets backported to older python
versions.
While updating the tests, the opportunity was taken to commonize the
code of two unit tests that were nearly identical.
Conflicts:
nova/tests/unit/console/test\_websocketproxy.py
NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train. The difference
from the cherry picked change is because the flake8 version on the
stable/train branch does not support f-strings [1].
Related-Bug: #1927677
Closes-Bug: #1986545
[1] https://lists.openstack.org/pipermail/openstack-discuss/2019-November/011027.html
Change-Id: I27441d15cc6fa2ff7715ba15aa900961aadbf54a
(cherry picked from commit 15769b883ed4a86d62b141ea30d3f1590565d8e0)
(cherry picked from commit 4a2b44c7cf55d1d79d5a2dd638bd0def3af0f5af)
(cherry picked from commit 0e4a257e8636a979605c614a35e79ba47b74d870)
(cherry picked from commit 3023e162e1a415ddaa70b4b8fbe24b1771dbe424)
(cherry picked from commit 77bc3f004e7fe4077ea035c659630bedef1cfea1)
(cherry picked from commit 746d654c23d75f084b6f0c70e6c32b97eebf419c)

| **tags**: | added: in-stable-train |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2023-08-31:  [**Fix included in openstack/nova train-eol**](/nova/%2Bbug/1927677/comments/96) |  |  | [#96](/nova/%2Bbug/1927677/comments/96) |
| --- | --- | --- | --- |

This issue was fixed in the openstack/nova train-eol release.

This issue was fixed in the openstack/nova train-eol release.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Lucas (lucas6)](https://launchpad.net/~lucas6) wrote on 2024-09-10: |  |  | [#98](/nova/%2Bbug/1927677/comments/98) |
| --- | --- | --- | --- |

Python fix an open redirection vulnerability(CVE-2021-28861) in the HTTP server when an URI path starts with //[1]. Reducing to a single /, the Nova patch[2] for fixing the CVE-2021-3654 vulnerability does not take effect.

For example:

The URI patch is changed from ////example.com/%2F.. to /example.com/%2F.. and passed to Nova.

[1] <https://github.com/python/cpython/commit/5715382d3a89ca118ce2e224d8c69550d21fe51b>

[2] [https://review.opendev.org/c/openstack/nova/+/806629/6/nova/console/websocketproxy.py](https://review.opendev.org/c/openstack/nova/%2B/806629/6/nova/console/websocketproxy.py)

Python fix an open redirection vulnerability(CVE-2021-28861) in the HTTP server when an URI path starts with //[1]. Reducing to a single /, the Nova patch[2] for fixing the CVE-2021-3654 vulnerability does not take effect.
For example:
The URI patch is changed from ////example.com/%2F.. to /example.com/%2F.. and passed to Nova.
[1] https://github.com/python/cpython/commit/5715382d3a89ca118ce2e224d8c69550d21fe51b
[2] https://review.opendev.org/c/openstack/nova/+/806629/6/nova/console/websocketproxy.py

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2024-09-10: |  |  | [#99](/nova/%2Bbug/1927677/comments/99) |
| --- | --- | --- | --- |

Lucas: Are you possibly just rediscovering related [bug 1986545](/bugs/1986545)?

Lucas: Are you possibly just rediscovering related bug 1986545?

[See full activity log](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/nova/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

## Duplicates of this bug

* [Bug #1988302](https://bugs.launchpad.net/nova/%2Bbug/1988302 "novncproxy open redirect")

You are
[not directly subscribed to this bug's notifications.](/nova/%2Bbug/1927677/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [lp1927677.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5496768/%2Bfiles/lp1927677.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5496768 "Change patch details")
* [python2.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519968/%2Bfiles/python2.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519968 "Change patch details")
* [python3.patch](https://bugs.launchpad.net/nova/%2Bbug/1927677/%2Battachment/5519969/%2Bfiles/python3.patch)
  [Edit](/nova/%2Bbug/1927677/%2Battachment/5519969 "Change patch details")

* [Add patch](/nova/%2Bbug/1927677/%2Baddcomment?field.patch=on)

## Remote bug watches

* [python-roundup #32084](http://bugs.python.org/issue32084)

  [2:2]
  [Edit](/bugs/1927677/%2Bwatch/142925 "Change watch details")
* [python-roundup #43223](http://bugs.python.org/issue43223)

  [1:None]
  [Edit](/bugs/1927677/%2Bwatch/143534 "Change watch details")
* [auto-github-novnc-novnc #748](https://github.com/novnc/noVNC/issues/748)

  [closed bug]
  [Edit](/bugs/1927677/%2Bwatch/142896 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.redhat.com_0d128e72_20250115_194601.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2020313)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2020313)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2020313)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2020313

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2020313**](show_bug.cgi?id=2020313)
- If an upper case mac address is used in a heat template, live migration won't work in nova

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
If an upper case mac address is used in a heat template, live migration won't...

| | [Keywords](describekeywords.cgi): | Triaged | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat OpenStack | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat OpenStack "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | openstack-nova | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 16.1 (Train) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | x86\_64 | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | z8 | | [Target Release](page.cgi?id=fields.html#target_release): | 16.1 (Train on RHEL 8.2) | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Alex Stupnikov | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | OSP DFG:Compute | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=2020313&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2020313&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2021-11-04 15:16 UTC by David Hill | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-03-21 19:48 UTC ([History](show_activity.cgi?id=2020313)) | | [CC List:](page.cgi?id=fields.html#cclist) | 10 users (show)  astupnik dasmith eglynn jhakimra jhardee kchamart sbauza sgordon smooney vromanso | | Fixed In Version: | openstack-nova-20.4.1-1.20220112153422.1ee93b9.el8ost | | | Doc Type: | No Doc Update | | | Doc Text: |  | | | Clone Of: |  | | | Clones: | [2036690](show_bug.cgi?id=2036690 "CLOSED ERRATA - If an upper case mac address is used in a heat template, live migration won't work in nova")  ([view as bug list](buglist.cgi?bug_id=2036690)) | | | Environment: |  | | | Last Closed: | 2022-03-24 11:04:43 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Launchpad | [1945646](https://bugs.launchpad.net/bugs/1945646) | 0 | None | None | None | 2021-11-08 00:17:01 UTC | | OpenStack gerrit | [811947](https://review.opendev.org/811947) | 0 | None | MERGED | Ensure MAC addresses characters are in the same case | 2021-11-08 00:17:32 UTC | | Red Hat Issue Tracker | [OSP-10670](https://issues.redhat.com/browse/OSP-10670) | 0 | None | None | None | 2021-11-15 12:29:49 UTC | | Red Hat Product Errata | [RHSA-2022:0983](https://access.redhat.com/errata/RHSA-2022%3A0983) | 0 | None | None | None | 2022-03-24 11:04:58 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2020313#c0)  David Hill    2021-11-04 15:16:18 UTC  ``` Description of problem: If an upper case mac address is used in a heat template, live migration won't work in nova due to MAC address :  2021-10-21 15:58:26.940 7 DEBUG nova.compute.manager [-] live_migration data is LibvirtLiveMigrateData(bdms=[LibvirtLiveMigrateBDMInfo,LibvirtLiveMigrateBDMInfo,LibvirtLiveMigrateBDMInfo,LibvirtLiveMigrateBDMInfo],block_migration=False,di sk_available_mb=18070528,disk_over_commit=<?>,dst_numa_info=<?>,dst_supports_numa_live_migration=<?>,dst_wants_file_backed_memory=False,file_backed_memory_discard=False,filename='tmplkhegqcj',graphics_listen_addr_spice=127.0.0.1,graphics_ listen_addr_vnc=10.10.10.10,image_type='rbd',instance_relative_path='ad284904-ce29-4d1f-934f-03e5965f204f',is_shared_block_storage=True,is_shared_instance_path=False,is_volume_backed=True,migration=Migration(d7eb618b-db4e-4ece-9db4-503ed cfcea75),old_vol_attachment_ids={12b00e34-e66a-4844-9fd6-4245d782eb95='993e1340-5ac0-49cd-888e-8c45da904760',8b78fffa-2c93-4a7b-8010-6328b8934005='c25bd420-cc32-42a6-819e-c28cb975d33f',bce78f78-84eb-4281-8ca4-a19410872935='4f1abaa9-d3d3-4 72d-8ebf-6a11b6a9195c',be025b5e-59a1-4502-8aba-99ff7de3414d='27b27148-4353-4a0f-9adf-d1873461a458'},serial_listen_addr=None,serial_listen_ports=[],src_supports_native_luks=<?>,src_supports_numa_live_migration=<?>,supported_perf_events=[], target_connect_addr='compute00-animal-dal10.ctlplane.ole.redhat.com',vifs=[VIFMigrateData],wait_for_vif_plugged=True) _do_live_migration /usr/lib/python3.6/site-packages/nova/compute/manager.py:7244 2021-10-21 15:58:26.943 7 DEBUG nova.virt.libvirt.driver [-] [instance: ad284904-ce29-4d1f-934f-03e5965f204f] Starting monitoring of live migration _live_migration /usr/lib/python3.6/site-packages/nova/virt/libvirt/driver.py:9189 2021-10-21 15:58:26.946 7 DEBUG nova.virt.libvirt.driver [-] [instance: ad284904-ce29-4d1f-934f-03e5965f204f] Operation thread is still running _live_migration_monitor /usr/lib/python3.6/site-packages/nova/virt/libvirt/driver.py:8990 2021-10-21 15:58:26.946 7 DEBUG nova.virt.libvirt.driver [-] [instance: ad284904-ce29-4d1f-934f-03e5965f204f] Migration not running yet _live_migration_monitor /usr/lib/python3.6/site-packages/nova/virt/libvirt/driver.py:8999 2021-10-21 15:58:26.961 7 DEBUG nova.virt.libvirt.migration [-] Find same serial number: pos=0, serial=12b00e34-e66a-4844-9fd6-4245d782eb95 _update_volume_xml /usr/lib/python3.6/site-packages/nova/virt/libvirt/migration.py:232 2021-10-21 15:58:26.964 7 DEBUG nova.virt.libvirt.migration [-] Find same serial number: pos=1, serial=8b78fffa-2c93-4a7b-8010-6328b8934005 _update_volume_xml /usr/lib/python3.6/site-packages/nova/virt/libvirt/migration.py:232 2021-10-21 15:58:26.966 7 DEBUG nova.virt.libvirt.migration [-] Find same serial number: pos=2, serial=be025b5e-59a1-4502-8aba-99ff7de3414d _update_volume_xml /usr/lib/python3.6/site-packages/nova/virt/libvirt/migration.py:232 2021-10-21 15:58:26.969 7 DEBUG nova.virt.libvirt.migration [-] Find same serial number: pos=3, serial=bce78f78-84eb-4281-8ca4-a19410872935 _update_volume_xml /usr/lib/python3.6/site-packages/nova/virt/libvirt/migration.py:232 2021-10-21 15:58:26.970 7 ERROR nova.virt.libvirt.driver [-] [instance: ad284904-ce29-4d1f-934f-03e5965f204f] Live Migration failure: '00:00:00:00:fa:0a' 2021-10-21 15:58:26.970 7 DEBUG nova.virt.libvirt.driver [-] [instance: ad284904-ce29-4d1f-934f-03e5965f204f] Migration operation thread notification thread_finished /usr/lib/python3.6/site-packages/nova/virt/libvirt/driver.py:9180 2021-10-21 15:58:27.448 7 DEBUG nova.virt.libvirt.migration [-] [instance: ad284904-ce29-4d1f-934f-03e5965f204f] VM running on src, migration failed _log /usr/lib/python3.6/site-packages/nova/virt/libvirt/migration.py:419     Version-Release number of selected component (if applicable): All  How reproducible: Always  Steps to Reproduce: 1. Create a heat template where you define uppercase mac_addresses 2. Deploy stack 3. Try to live migrate  Actual results: Live migration fails  Expected results: Never fails  Additional info: If we go in the database directly and convert macs to lowercase and then stop/start the VMs, live migration then succeeds.  I've seen some instance network cache info debug logs containing the MAC in uppercase so perhaps the issue is just with instance network cache ?   ```  [Comment 17](show_bug.cgi?id=2020313#c17)  errata-xmlrpc    2022-03-24 11:04:43 UTC  ``` Since the problem described in this bug report should be resolved in a recent advisory, it has been closed with a resolution of ERRATA.  For information on the advisory (Moderate: Red Hat OpenStack Platform 16.1 (openstack-nova) security update), and where to find the updated files, follow the link below.  If the solution does not work for you, open a new bug report.  [https://access.redhat.com/errata/RHSA-2022:0983](https://access.redhat.com/errata/RHSA-2022%3A0983)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2020313&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugs.python.org_9f7e1a7d_20250115_194608.html ===

# [homepage](.)

open

all

* [Python Home](https://www.python.org/ "Go to the Python homepage")
* [About](https://www.python.org/about/ "About The Python Language")
* [News](https://www.python.org/blogs/)
* [Documentation](https://www.python.org/doc/)
* [Downloads](https://www.python.org/downloads/)
* [Community](https://www.python.org/community/)
* [Foundation](https://www.python.org/psf/ "Python Software Foundation")
* [Developer's Guide](https://devguide.python.org/ "Python Developer's Guide")
* [Issue Tracker](. "Python Issue Tracker")
  + **Issues**
    - [Search](issue?@template=search&status=1)
    - [Random Issue](issue?@action=random)
  + **Summaries**
    - [Issues with patch](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Issues%20with%20patch&@startwith=0&@group=priority&keywords=2&@action=search&@filter=&@pagesize=50)
    - [Easy issues](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Easy%20issues&@startwith=0&@group=priority&keywords=6&@action=search&@filter=&@pagesize=50)
    - [Stats](issue?@template=stats)
  + **User**
    - Login

      Remember me?
    - [Lost your login?](user?@template=forgotten)
  + **Administration**
    - [User List](user?@sort=username)
    - [Committer List](user?iscommitter=1&@action=search&@sort=username&@pagesize=300)
  + **Help**
    - [Tracker Documentation](http://docs.python.org/devguide/triaging.html)
    - [Tracker Development](http://wiki.python.org/moin/TrackerDevelopment)
    - [Report Tracker Problem](https://github.com/python/psf-infra-meta/issues)

Issue32084

![](@@file/python-logo-small.png)
➜
[![](@@file/gh-icon.png)](https://github.com/python/cpython/issues)

This issue tracker **has been migrated to [GitHub](https://github.com/python/cpython/issues)**,
and is currently **read-only**.

For more information, [see the GitHub FAQs in the Python's Developer Guide.](https://devguide.python.org/gh-faq/ "GitHub FAQs")

[![](@@file/gh-icon.png)

This issue has been migrated to GitHub:
https://github.com/python/cpython/issues/76265](https://github.com/python/cpython/issues/76265)

classification

| [Title](http://docs.python.org/devguide/triaging.html#title): | [Security] http.server can be abused to redirect to (almost) arbitrary URL | | |
| --- | --- | --- | --- |
| [Type](http://docs.python.org/devguide/triaging.html#type): | security | [Stage](http://docs.python.org/devguide/triaging.html#stage): | resolved |
| [Components](http://docs.python.org/devguide/triaging.html#components): | Library (Lib) | [Versions](http://docs.python.org/devguide/triaging.html#versions): | Python 3.7, Python 3.6, Python 3.4, Python 3.5, Python 2.7 |

process

| [Status](http://docs.python.org/devguide/triaging.html#status): | closed | [Resolution](http://docs.python.org/devguide/triaging.html#resolution): | duplicate |
| --- | --- | --- | --- |
| [Dependencies](http://docs.python.org/devguide/triaging.html#dependencies): |  | [Superseder](http://docs.python.org/devguide/triaging.html#superseder): | [security] http.server: Open Redirection if the URL path starts with //  View: [43223](issue43223 "[security] http.server: Open Redirection if the URL path starts with //") |
| [Assigned To](http://docs.python.org/devguide/triaging.html#assigned-to): |  | [Nosy List](http://docs.python.org/devguide/triaging.html#nosy-list): | epicfaace, martin.panter, ned.deily, vstinner |
| [Priority](http://docs.python.org/devguide/triaging.html#priority): | normal | [Keywords](http://docs.python.org/devguide/triaging.html#keywords): |  |

Created on **2017-11-20 13:49** by **vstinner**, last changed **2022-04-11 14:58** by **admin**. This issue is now **closed**.

| Messages (6) | | | |
| --- | --- | --- | --- |
| [msg306540](#msg306540) - [(view)](msg306540) | Author: STINNER Victor (vstinner) \* (Python committer) | Date: 2017-11-20 13:49 |
| ``` iDer reported a vulnerability in the HTTP server.  (1) Start a local HTTP server (listen to tcp/8000):  python3 -m http.server 8000  (2) Open a web browser and to go:  [http://localhost:8000//www.python.org/%2f.](http://localhost:8000//www.python.org//.).  => the browser is redirected to [http://www.python.org/%2f../](http://www.python.org//../)  (on this example, the python.org web server redirects to [https://www.python.org/%2f../](https://www.python.org//../) )   Raw HTTP to see the HTTP redirection using netcat: --- $ echo -ne "GET //[www.python.org/%2f.](www.python.org//.). HTTP/1.0\n\n" | nc localhost 8000 HTTP/1.0 301 Moved Permanently Server: SimpleHTTP/0.6 [Python/3.6.2](https://github.com/python/cpython/blob/master/Python/3.6.2) Date: Mon, 20 Nov 2017 13:31:42 GMT Location: //[www.python.org/%2f../](http://www.python.org//../) ---  The problem is in the SimpleHTTPRequestHandler.send_head() function:  * self.path = '//[www.python.org/%2f.](www.python.org//.).' * translate_path() translates '//<www.python.org//.>.' path to self.directory (the current directory by default). * isdir(self.directory) is True but self.path doesn't send with '/', so send_head() creates a HTTP redirection (HTTP 301) * The redirection URL is '//[www.python.org/%2f../](http://www.python.org//../)'. Extract of the raw HTTP: "Location: //[www.python.org/%2f../](http://www.python.org//../)"  The web browsers translates the URL '//[www.python.org/%2f../](http://www.python.org//../)' to "[http://www.python.org/%2f../](http://www.python.org//../)"... It surprised me, but ok, it's a fact.  I'm not sure what is the best way to fix this vulnerability without rejecting valid HTTP requests.  IMHO the root issue is the redirection URL starting with "//". I would expect something like "localhost//". The problem is that I'm not sure that the HTTP server knows its own "external" hostname. "localhost" is wrong is the server is accessed from the outside. Maybe the server must just fail on that case?   This vulnerabilility was reported to the Python Security Response Team (PSRT) at October 18, 2017 (one month ago). Since no obvious fix was found, it was decided to make the vulnerability public to get more eyes on it to find a quick fix.  Note: I'm not sure that this vulnerability is important, since the redirected URL ends with "/%2f../" which should be rejected by any correct HTTP Server (say, not the Python builtin "simple" HTTP server...). ``` | | | |
| [msg306542](#msg306542) - [(view)](msg306542) | Author: STINNER Victor (vstinner) \* (Python committer) | Date: 2017-11-20 14:02 |
| ``` Extract of send_head():          path = self.translate_path(self.path)         f = None         if os.path.isdir(path):             parts = urllib.parse.urlsplit(self.path)             ...  urllib.parse.urlsplit('//[www.python.org/%2f.](www.python.org//.).') returns:  SplitResult(scheme='', netloc='[www.python.org](http://www.python.org)', path='/%2f..', query='', fragment='')  Is urlsplit() the correct function to call here? [www.python.org](http://www.python.org) is part of the path, not of the netloc. ``` | | | |
| [msg306545](#msg306545) - [(view)](msg306545) | Author: STINNER Victor (vstinner) \* (Python committer) | Date: 2017-11-20 14:24 |
| ``` I wrote this patch, but I'm not sure that it's ok to always reject redirection URLs starting with //:  diff --git a/Lib/http/server.py b/Lib/http/server.py index [502bce0c7a](https://hg.python.org/lookup/502bce0c7a)..[494031b8c2](https://hg.python.org/lookup/494031b8c2) 100644 --- a/Lib/http/server.py +++ b/Lib/http/server.py @@ -673,10 +673,18 @@ class SimpleHTTPRequestHandler(BaseHTTPRequestHandler):              parts = urllib.parse.urlsplit(self.path)              if not parts.path.endswith('/'):                  # redirect browser - doing basically what apache does -                self.send_response(HTTPStatus.MOVED_PERMANENTLY)                  new_parts = (parts[0], parts[1], parts[2] + '/',                               parts[3], parts[4])                  new_url = urllib.parse.urlunsplit(new_parts) + +                # Browsers interpret "Location: //uri" as an absolute URI +                # like "<http://URI>" +                if new_url.startswith('//'): +                    self.send_error(HTTPStatus.BAD_REQUEST, +                                    "URI must not start with //") +                    return None + +                self.send_response(HTTPStatus.MOVED_PERMANENTLY)                  self.send_header("Location", new_url)                  self.end_headers()                  return None ``` | | | |
| [msg306992](#msg306992) - [(view)](msg306992) | Author: Martin Panter (martin.panter) \* (Python committer) | Date: 2017-11-26 05:28 |
| ``` Maybe a good fix would be to “escape” the double slash with “/.”:  if os.path.isdir(path):     url = self.path     if url.startswith('//'):  # E.g. "//[www.python.org/%2f.](www.python.org//.)."         url = "/." + url  # Becomes "/.//[www.python.org/%2f.](www.python.org//.)."     parts = urllib.parse.urlsplit(url)     ...  When this “escaped” URL is resolved with the base URL, it should give the right result:  >>> base = "[http://localhost:8000//www.python.org/%2f.](http://localhost:8000//www.python.org//.)." >>> redirect = "/.//[www.python.org/%2f../](http://www.python.org//../)" >>> urljoin(base, redirect) '[http://localhost:8000//www.python.org/%2f../](http://localhost:8000//www.python.org//../)'  A simpler idea is to strip off all but one of the leading slashes, so you end up with "/[www.python.org/%2f.](www.python.org//.).". That would technically be a different URL, but would access the same file through the default SimpleHTTPRequestHandler behaviour, so most people wouldn’t notice. ``` | | | |
| [msg322677](#msg322677) - [(view)](msg322677) | Author: Martin Panter (martin.panter) \* (Python committer) | Date: 2018-07-30 13:39 |
| ``` In [Issue 34276](issue34276 "[open] urllib.parse doesn't round-trip file URI's with multiple leading slashes") I suggested a fix to “urlunsplit”. In this case it would send “Location: ////[www.python.org/%2f../](http://www.python.org//../)", with an extra pair of slashes denoting an empty host name. This should stop a browser from seeing “[www.python.org](http://www.python.org)” as a host name. ``` | | | |
| [msg394169](#msg394169) - [(view)](msg394169) | Author: Ned Deily (ned.deily) \* (Python committer) | Date: 2021-05-21 23:10 |
| ``` This looks like a duplicate of [Issue43223](issue43223 "[open] [security] http.server: Open Redirection if the URL path starts with //") which has a PR in progress. ``` | | | |

| History | | | |
| --- | --- | --- | --- |
| Date | User | Action | Args |
| 2022-04-11 14:58:54 | admin | set | github: 76265 |
| 2021-05-21 23:10:46 | ned.deily | set | status: open -> closed |
| 2019-08-15 03:26:20 | epicfaace | set | nosy: + [epicfaace](user30249) |
| 2018-07-30 13:39:40 | martin.panter | set | messages: + <msg322677> |
| 2017-11-26 05:28:23 | martin.panter | set | nosy: + [martin.panter](user14751)messages: + <msg306992> |
| 2017-11-20 14:24:07 | vstinner | set | messages: + <msg306545> |
| 2017-11-20 14:02:11 | vstinner | set | messages: + <msg306542> |
| 2017-11-20 13:49:15 | vstinner | create |  |

Supported by [The Python Software Foundation](https://python.org/psf-landing/ "The Python Software Foundation"),

Powered by [Roundup](http://roundup.sourceforge.net "Powered by the Roundup Issue Tracker")

Copyright © 1990-2022, [Python Software Foundation](http://python.org/psf)



=== Content from access.redhat.com_2d269c3d_20250115_123911.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2022:0999 - Security Advisory

Issued:
2022-03-23
Updated:
2022-03-23
# RHSA-2022:0999 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Moderate: Red Hat OpenStack Platform 16.2 (openstack-nova) security update

## Type/Severity

Security Advisory: Moderate

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2022%3A0999)

## Topic

An update for openstack-nova is now available for Red Hat OpenStack
Platform 16.2 (Train).

Red Hat Product Security has rated this update as having a security impact
of Moderate. A Common Vulnerability Scoring System (CVSS) base score, which
gives a detailed severity rating, is available for each vulnerability from
the CVE link(s) in the References section.

## Description

OpenStack Compute (codename Nova) is open source software designed
to provision and manage large networks of virtual machines,creating a
redundant and scalable cloud computing platform. It gives you the software,
control panels, and APIs required to orchestrate a cloud, including running
instances, managing networks, and controlling access through users and
projects.OpenStack Compute strives to be both hardware and hypervisor
agnostic, currently supporting a variety of standard hardware
configurations and seven major hypervisors.

Security Fix(es):

* novnc allows open redirection (CVE-2021-3654)

For more details about the security issue(s), including the impact, a CVSS
score, acknowledgments, and other related information, refer to the CVE
page listed in the References section.

Bug Fix(es):

* Red Hat OpenStack Platform (RHOSP) does not support the use of a fully qualified domain name (FQDN) as the instance display name in a boot server request. The instance display name is passed from the boot server request to the `instance.hostname` field. Some customers use this unsupported naming in their workflows.

A recent update [1] now sanitizes the `instance.hostname` field. The sanitization steps include replacing periods with dashes, a replacement that makes it impossible to continue using the unsupported FQDN instance display names.

This update provides a temporary workaround for customers who use a fully qualified domain name (FQDN) as the instance display name in a boot server request. It limits the scope of the sanitization to cases where the instance display name ends with a period followed by one or more numeric digits.

If you use FQDN as the instance display name in a boot server request, modify your workflow before upgrading to RHOSP 17. (BZ#2036652)

## Solution

For details on how to apply this update, which includes the changes
described in this advisory, refer to:

<https://access.redhat.com/articles/11258>

## Affected Products

* Red Hat OpenStack for IBM Power 16.2 ppc64le
* Red Hat OpenStack 16.2 x86\_64

## Fixes

* [BZ - 1729485](https://bugzilla.redhat.com/show_bug.cgi?id=1729485)
  - [OSP16.2] "Invalid PCI devices Whitelist config error" configuring passthrough\_whitelist with new 40Gb NICs due domain in PCI address is greater than FFFF
* [BZ - 1908405](https://bugzilla.redhat.com/show_bug.cgi?id=1908405)
  - Nova is out of sync with ironic as hypervisor list in nova does not agree with ironic list after reboot of the nodes
* [BZ - 1915096](https://bugzilla.redhat.com/show_bug.cgi?id=1915096)
  - [OSP16.2] NUMA instance spawn fails on get\_best\_cpu\_topology when there is no 'threads' preference
* [BZ - 1961439](https://bugzilla.redhat.com/show_bug.cgi?id=1961439)
  - CVE-2021-3654 openstack-nova: novnc allows open redirection
* [BZ - 1968735](https://bugzilla.redhat.com/show_bug.cgi?id=1968735)
  - [OSP16.2][neutron]http\_retries config option value not being used for calls to the port binding API
* [BZ - 1972706](https://bugzilla.redhat.com/show_bug.cgi?id=1972706)
  - [OSP 16.2] After host reboot VM goes to error state due to nova-compute EmptyCatalog error
* [BZ - 1987225](https://bugzilla.redhat.com/show_bug.cgi?id=1987225)
  - Compute service DOWN after FFU from RHOSP13 to 16.1 because service version is still 30.
* [BZ - 1992863](https://bugzilla.redhat.com/show_bug.cgi?id=1992863)
  - [OSP 16.2] Avoid duplicate BDMs during reserve\_block\_device\_name
* [BZ - 1998556](https://bugzilla.redhat.com/show_bug.cgi?id=1998556)
  - [OSP 16.2] Attempting to start or hard reboot a users instance as an admin with encrypted rbd volumes leaves the instance unbootable
* [BZ - 1999583](https://bugzilla.redhat.com/show_bug.cgi?id=1999583)
  - [OSP 16.2] Provide a workaround option and/or nova-manage command to force the refresh of connection\_info during a hard reboot
* [BZ - 2036652](https://bugzilla.redhat.com/show_bug.cgi?id=2036652)
  - [HOTFIX] [OSP 16.2] - option for disabling FIX on instance name sanity check
* [BZ - 2036690](https://bugzilla.redhat.com/show_bug.cgi?id=2036690)
  - If an upper case mac address is used in a heat template, live migration won't work in nova

## CVEs

* [CVE-2021-3654](https://access.redhat.com/security/cve/CVE-2021-3654)

## References

* <https://access.redhat.com/security/updates/classification/#moderate>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat OpenStack for IBM Power 16.2

| SRPM | |
| --- | --- |
| openstack-nova-20.6.2-2.20220112164912.8906554.el8ost.src.rpm | SHA-256: ee31c0207b1dcfeb73d9826940131adcd80f55724e2cee6f3d0ea6acae1fd874 |
| ppc64le | |
| openstack-nova-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: d7da2cc615dcc22d7d3b0421cce04460da23c386a7b0fdd2a9e8d87981fa6d38 |
| openstack-nova-api-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: f253fd0ac3be1d81737b96eac53834fee800fcf8985701ca5d2fd5d679061055 |
| openstack-nova-common-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 225abdc9bee1cd04a51af53247bf6f445795613ba55f4253dd146e50fadc3ec3 |
| openstack-nova-compute-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 1d15a81a66a89f47c0b1887dff041d693cc00fdd91ef2e52b666bc5320b43d2c |
| openstack-nova-conductor-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 1a475f8820a65975cc8977066621454eb1adedb493f0edf49df361a5d4d816c5 |
| openstack-nova-console-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 60eba89607816fac656b6218d452fb94e330c7142d97e22b6c94149f5f622e0b |
| openstack-nova-migration-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 7399953eace53a5cb21f638f40a974ef3ffbc8a8b65827e78c225534255a8981 |
| openstack-nova-novncproxy-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: cce02968f2bd01b7bdedc742e111e0e61091df9afe05b6676d58b51f307cb273 |
| openstack-nova-scheduler-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 77c3a1ba97b6166b0f174076f84be24776e9b7ca8fc6c02a69851c0200bd50ab |
| openstack-nova-serialproxy-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 1b5d64b690df294e4ae880fa9191650ccd0a2bdcfbff217a86b4e0ea20a93ffc |
| openstack-nova-spicehtml5proxy-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: f529d1790c6eb9805866f350e06f128ed5446ca7611535056e28a5fc3585b095 |
| python3-nova-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 04295d438af2b68b0029eead05a32a7c0f6f8653fd440a371acbcc4662966579 |

## Red Hat OpenStack 16.2

| SRPM | |
| --- | --- |
| openstack-nova-20.6.2-2.20220112164912.8906554.el8ost.src.rpm | SHA-256: ee31c0207b1dcfeb73d9826940131adcd80f55724e2cee6f3d0ea6acae1fd874 |
| x86\_64 | |
| openstack-nova-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: d7da2cc615dcc22d7d3b0421cce04460da23c386a7b0fdd2a9e8d87981fa6d38 |
| openstack-nova-api-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: f253fd0ac3be1d81737b96eac53834fee800fcf8985701ca5d2fd5d679061055 |
| openstack-nova-common-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 225abdc9bee1cd04a51af53247bf6f445795613ba55f4253dd146e50fadc3ec3 |
| openstack-nova-compute-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 1d15a81a66a89f47c0b1887dff041d693cc00fdd91ef2e52b666bc5320b43d2c |
| openstack-nova-conductor-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 1a475f8820a65975cc8977066621454eb1adedb493f0edf49df361a5d4d816c5 |
| openstack-nova-console-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 60eba89607816fac656b6218d452fb94e330c7142d97e22b6c94149f5f622e0b |
| openstack-nova-migration-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 7399953eace53a5cb21f638f40a974ef3ffbc8a8b65827e78c225534255a8981 |
| openstack-nova-novncproxy-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: cce02968f2bd01b7bdedc742e111e0e61091df9afe05b6676d58b51f307cb273 |
| openstack-nova-scheduler-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 77c3a1ba97b6166b0f174076f84be24776e9b7ca8fc6c02a69851c0200bd50ab |
| openstack-nova-serialproxy-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 1b5d64b690df294e4ae880fa9191650ccd0a2bdcfbff217a86b4e0ea20a93ffc |
| openstack-nova-spicehtml5proxy-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: f529d1790c6eb9805866f350e06f128ed5446ca7611535056e28a5fc3585b095 |
| python3-nova-20.6.2-2.20220112164912.8906554.el8ost.noarch.rpm | SHA-256: 04295d438af2b68b0029eead05a32a7c0f6f8653fd440a371acbcc4662966579 |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from opendev.org_70a27e34_20250114_221532.html ===

This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

[openstack](/openstack)/[nova](/openstack/nova)

[Code](/openstack/nova/src/branch/master)
[Issues](https://bugs.launchpad.net/nova)
[Proposed changes](https://review.opendev.org/#/q/status:open+project:openstack/nova)

### Reject open redirection in the console proxy

[Browse Source](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66)

```
NOTE(melwitt): This is the combination of two commits, the bug fix and
a followup change to the unit test to enable it also run on
Python < 3.6.

Our console proxies (novnc, serial, spice) run in a websockify server
whose request handler inherits from the python standard
SimpleHTTPRequestHandler. There is a known issue [1] in the
SimpleHTTPRequestHandler which allows open redirects by way of URLs
in the following format:

  [http://vncproxy.my.domain.com//example.com/%2F](http://vncproxy.my.domain.com//example.com//)..

which if visited, will redirect a user to example.com.

We can intercept a request and reject requests that pass a redirection
URL beginning with "//" by implementing the
SimpleHTTPRequestHandler.send_head() method containing the
vulnerability to reject such requests with a 400 Bad Request.

This code is copied from a patch suggested in one of the issue comments
[2].

Closes-Bug: [#1927677](https://bugs.launchpad.net/nova/%2Bbug/1927677)

[1] <https://bugs.python.org/issue32084>
[2] <https://bugs.python.org/issue32084#msg306545>

Conflicts:
    nova/tests/unit/console/test_websocketproxy.py

NOTE(melwitt): The conflict is because change
I23ac1cc79482d0fabb359486a4b934463854cae5 (Allow TLS ciphers/protocols
to be configurable for console proxies) is not in Train.

NOTE(melwitt): The difference from the cherry picked change:
HTTPStatus.BAD_REQUEST => 400 is due to the fact that HTTPStatus does
not exist in Python 2.7.

Reduce mocking in test_reject_open_redirect for compat

This is a followup for change Ie36401c782f023d1d5f2623732619105dc2cfa24
to reduce mocking in the unit test coverage for it.

While backporting the bug fix, it was found to be incompatible with
earlier versions of Python < 3.6 due to a difference in internal
implementation [1].

This reduces the mocking in the unit test to be more agnostic to the
internals of the StreamRequestHandler (ancestor of
SimpleHTTPRequestHandler) and work across Python versions >= 2.7.

Related-Bug: [#1927677](https://bugs.launchpad.net/nova/%2Bbug/1927677)

[1] [34eeed4290](https://github.com/python/cpython/commit/34eeed42901666fce099947f93dfdfc05411f286)

Change-Id: I546d376869a992601b443fb95acf1034da2a8f36
(cherry picked from commit [214cabe684](/openstack/nova/commit/214cabe6848a1fdb4f5941d994c6cc11107fc4af))
(cherry picked from commit [9c2f297837](/openstack/nova/commit/9c2f29783734cb5f9cb05a08d328c10e1d16c4f1))
(cherry picked from commit [94e265f3ca](/openstack/nova/commit/94e265f3ca615aa18de0081a76975019997b8709))
(cherry picked from commit [d43b88a334](/openstack/nova/commit/d43b88a33407b1253e7bce70f720a44f7688141f))

Change-Id: Ie36401c782f023d1d5f2623732619105dc2cfa24
(cherry picked from commit [781612b332](/openstack/nova/commit/781612b33282ed298f742c85dab58a075c8b793e))
(cherry picked from commit [4709256142](/openstack/nova/commit/470925614223c8dd9b1233f54f5a96c02b2d4f70))
(cherry picked from commit [6b70350bdc](/openstack/nova/commit/6b70350bdcf59a9712f88b6435ba2c6500133e5b))
(cherry picked from commit [719e651e6b](/openstack/nova/commit/719e651e6be277950632e0c2cf5cc9a018344e7b))
```
...

This commit is contained in:

![](/assets/img/avatar_default.png "melwittt@gmail.com")
parent
[f1be212a86](/openstack/nova/commit/f1be212a86262f128e73f7201b7b3e51334f1ab4)

commit
04d48527b6

 **3 changed files** with **74 additions** and **0 deletions**

[Show all changes](?style=unified&whitespace=show-all&show-outdated=)
[Ignore whitespace when comparing lines](?style=unified&whitespace=ignore-all&show-outdated=)
[Ignore changes in amount of whitespace](?style=unified&whitespace=ignore-change&show-outdated=)
[Ignore changes in whitespace at EOL](?style=unified&whitespace=ignore-eol&show-outdated=)

Show Stats
[Download Patch File](/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66.patch)
[Download Diff File](/openstack/nova/commit/04d48527b62a35d912f93bc75613a6cca606df66.diff)
Expand all files
Collapse all files

#### 22 [nova/console/websocketproxy.py](#diff-b9d2ad00e05a6d9d14cdb8059d611043b602b37d "nova/console/websocketproxy.py") Unescape Escape [View File](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66/nova/console/websocketproxy.py)

|  | |  |  | `@ -19,6 +19,7 @@ Leverages websockify.py by Joel Martin` |
|  |  |  |  | `'''` |
|  |  |  |  |  |
|  |  |  |  | `import copy` |
|  |  |  |  | `import os` |
|  |  |  |  | `import socket` |
|  |  |  |  | `import sys` |
|  |  |  |  |  |
|  | |  |  | `@ -305,6 +306,27 @@ class NovaProxyRequestHandler(NovaProxyRequestHandlerBase,` |
|  |  |  |  | `# Fall back to the websockify <= v0.8.0 'socket' method location.` |
|  |  |  |  | `return websockify.WebSocketServer.socket(*args, **kwargs)` |
|  |  |  |  |  |
|  |  |  |  | `def send_head(self):` |
|  |  |  |  | `# This code is copied from this example patch:` |
|  |  |  |  | `# https://bugs.python.org/issue32084#msg306545` |
|  |  |  |  | `path = self.translate_path(self.path)` |
|  |  |  |  | `if os.path.isdir(path):` |
|  |  |  |  | `parts = urlparse.urlsplit(self.path)` |
|  |  |  |  | `if not parts.path.endswith('/'):` |
|  |  |  |  | `# redirect browser - doing basically what apache does` |
|  |  |  |  | `new_parts = (parts[0], parts[1], parts[2] + '/',` |
|  |  |  |  | `parts[3], parts[4])` |
|  |  |  |  | `new_url = urlparse.urlunsplit(new_parts)` |
|  |  |  |  |  |
|  |  |  |  | `# Browsers interpret "Location: //uri" as an absolute URI` |
|  |  |  |  | `# like "http://URI"` |
|  |  |  |  | `if new_url.startswith('//'):` |
|  |  |  |  | `self.send_error(400,` |
|  |  |  |  | `"URI must not start with //")` |
|  |  |  |  | `return None` |
|  |  |  |  |  |
|  |  |  |  | `return super(NovaProxyRequestHandler, self).send_head()` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `class NovaWebSocketProxy(websockify.WebSocketProxy):` |
|  |  |  |  | `def __init__(self, *args, **kwargs):` |
|  | |  |  |  |

#### 33 [nova/tests/unit/console/test\_websocketproxy.py](#diff-f629feecbacc0045cac65cca99e64f6dfdbe5e76 "nova/tests/unit/console/test_websocketproxy.py") Unescape Escape [View File](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66/nova/tests/unit/console/test_websocketproxy.py)

|  | |  |  | `@ -15,6 +15,7 @@` |
|  |  |  |  | `"""Tests for nova websocketproxy."""` |
|  |  |  |  |  |
|  |  |  |  | `import copy` |
|  |  |  |  | `import io` |
|  |  |  |  | `import socket` |
|  |  |  |  |  |
|  |  |  |  | `import mock` |
|  | |  |  | `@ -626,6 +627,38 @@ class NovaProxyRequestHandlerBaseTestCase(test.NoDBTestCase):` |
|  |  |  |  | `self.wh.server.top_new_client(conn, address)` |
|  |  |  |  | `self.assertIsNone(self.wh._compute_rpcapi)` |
|  |  |  |  |  |
|  |  |  |  | `def test_reject_open_redirect(self):` |
|  |  |  |  | `# This will test the behavior when an attempt is made to cause an open` |
|  |  |  |  | `# redirect. It should be rejected.` |
|  |  |  |  | `mock_req = mock.MagicMock()` |
|  |  |  |  | `mock_req.makefile().readline.side_effect = [` |
|  |  |  |  | `b'GET //example.com/%2F.. HTTP/1.1\r\n',` |
|  |  |  |  | `b''` |
|  |  |  |  | `]` |
|  |  |  |  |  |
|  |  |  |  | `client_addr = ('8.8.8.8', 54321)` |
|  |  |  |  | `mock_server = mock.MagicMock()` |
|  |  |  |  | `# This specifies that the server will be able to handle requests other` |
|  |  |  |  | `# than only websockets.` |
|  |  |  |  | `mock_server.only_upgrade = False` |
|  |  |  |  |  |
|  |  |  |  | `# Constructing a handler will process the mock_req request passed in.` |
|  |  |  |  | `handler = websocketproxy.NovaProxyRequestHandler(` |
|  |  |  |  | `mock_req, client_addr, mock_server)` |
|  |  |  |  |  |
|  |  |  |  | `# Collect the response data to verify at the end. The` |
|  |  |  |  | `# SimpleHTTPRequestHandler writes the response data to a 'wfile'` |
|  |  |  |  | `# attribute.` |
|  |  |  |  | `output = io.BytesIO()` |
|  |  |  |  | `handler.wfile = output` |
|  |  |  |  | `# Process the mock_req again to do the capture.` |
|  |  |  |  | `handler.do_GET()` |
|  |  |  |  | `output.seek(0)` |
|  |  |  |  | `result = output.readlines()` |
|  |  |  |  |  |
|  |  |  |  | `# Verify no redirect happens and instead a 400 Bad Request is returned.` |
|  |  |  |  | `self.assertIn('400 URI must not start with //', result[0].decode())` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `class NovaWebsocketSecurityProxyTestCase(test.NoDBTestCase):` |
|  |  |  |  |  |
|  | |  |  |  |

#### 19 [releasenotes/notes/console-proxy-reject-open-redirect-4ac0a7895acca7eb.yaml](#diff-e5d9ff045dfe47fe4a0b246703a6e3df8133ed8e "releasenotes/notes/console-proxy-reject-open-redirect-4ac0a7895acca7eb.yaml") Normal file Unescape Escape [View File](/openstack/nova/src/commit/04d48527b62a35d912f93bc75613a6cca606df66/releasenotes/notes/console-proxy-reject-open-redirect-4ac0a7895acca7eb.yaml)

|  | |  |  | `@ -0,0 +1,19 @@` |
|  |  |  |  | `---` |
|  |  |  |  | `security:` |
|  |  |  |  | `- |` |
|  |  |  |  | `A vulnerability in the console proxies (novnc, serial, spice) that allowed` |
|  |  |  |  | `open redirection has been `patched`_. The novnc, serial, and spice console` |
|  |  |  |  | `proxies are implemented as websockify servers and the request handler` |
|  |  |  |  | `inherits from the python standard SimpleHTTPRequestHandler. There is a` |
|  |  |  |  | ``known issue`_ in the SimpleHTTPRequestHandler which allows open redirects` |
|  |  |  |  | `by way of URLs in the following format::` |
|  |  |  |  |  |
|  |  |  |  | `http://vncproxy.my.domain.com//example.com/%2F..` |
|  |  |  |  |  |
|  |  |  |  | `which if visited, will redirect a user to example.com.` |
|  |  |  |  |  |
|  |  |  |  | `The novnc, serial, and spice console proxies will now reject requests that` |
|  |  |  |  | `pass a redirection URL beginning with "//" with a 400 Bad Request.` |
|  |  |  |  |  |
|  |  |  |  | `.. _patched: https://bugs.launchpad.net/nova/+bug/1927677` |
|  |  |  |  | `.. _known issue: https://bugs.python.org/issue32084` |

Write
Preview

Loading…

Cancel
Save

Reference in New Issue

**Repository**
openstack/nova

**Title**

**Body**

Create Issue

Block a user
Blocking a user prevents them from interacting with repositories, such as opening or commenting on pull requests or issues. Learn more about blocking a user.

User to block:

Optional note:

The note is not visible to the blocked user.

Cancel
Block

[Powered by Gitea](https://about.gitea.com)
Version:
v1.22.6
Page: **10517ms**
Template: **135ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)


