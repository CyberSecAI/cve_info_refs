## CVE-2019-12385

Based on the provided content, here's a breakdown of the CVE-2019-12385 vulnerability:

*   **Vulnerability:** SQL Injection
*   **Root Cause:** The `Dba::escape` method in `lib/class/dba.class.php` is used to escape user input before it's included in SQL queries. This method uses `PDO::quote` to filter special characters and quote the string, but then it strips the outer single quotes. If the resulting value is not quoted within the query, it allows an attacker to inject SQL commands.
*   **Weakness:** Improper escaping of user-supplied input in SQL queries. Specifically, stripping the outer quotes from the output of `PDO::quote` creates an opportunity for SQL injection when the value is used in a query without proper quoting.
*   **Location:** `lib/class/search.class.php`, specifically in the `case 'last_play'` section. The `$input` variable, derived from user input, is not properly handled, leading to SQL injection.
*   **Attack Vector:** A malicious user can provide SQL commands in the `$input` variable (avoiding quotes and other special characters) via the `search.php` page.
*   **Impact:** An attacker can execute arbitrary SQL queries, potentially allowing them to:
    *   Dump sensitive data from the database (sessions, hashed passwords, etc.).
    *   Steal session cookies and compromise admin accounts.
*   **Attacker Capabilities:** The attacker needs to be able to perform searches, which can even be done by guest users.
*   **Example Attack:** Sending a POST request to `/search.php?type=song` with a crafted `rule_1_input` parameter containing SQL code to trigger a time delay. For example:

    ```
    POST /search.php?type=song
    X-Requested-With: XMLHttpRequest
    Content-Type: application/x-www-form-urlencoded; charset=UTF-8

    limit=0&operator=or&rule_1=last_play&rule_1_operator=1&rule_1_input=1))union+select+1+from+dual+where+sleep(5)--&action=search
    ```

    This payload injects `union select 1 from dual where sleep(5)` into the SQL query, causing a 5-second delay.

    The successful exploitation of this vulnerability, combined with a weak password generation algorithm, could lead to a full compromise of admin accounts.