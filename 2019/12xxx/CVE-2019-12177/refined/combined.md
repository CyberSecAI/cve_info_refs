=== Content from posts.specterops.io_cbf0adb0_20250121_011050.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6d2802bd0585&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Razer Synapse 3 Elevation of Privilege

[![Matt Nelson](https://miro.medium.com/v2/resize:fill:88:88/0*6mGXmQSDMYyKuVUK.jpg)](https://medium.com/%40enigma0x3?source=post_page---byline--6d2802bd0585--------------------------------)[![Posts By SpecterOps Team Members](https://miro.medium.com/v2/resize:fill:48:48/1*D-FDlfkqivRBQZoESrwtqw.png)](https://posts.specterops.io/?source=post_page---byline--6d2802bd0585--------------------------------)

[Matt Nelson](https://medium.com/%40enigma0x3?source=post_page---byline--6d2802bd0585--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bb43103a9a9&operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&user=Matt+Nelson&userId=1bb43103a9a9&source=post_page-1bb43103a9a9--byline--6d2802bd0585---------------------post_header-----------)

Published in[Posts By SpecterOps Team Members](https://posts.specterops.io/?source=post_page---byline--6d2802bd0585--------------------------------)·8 min read·Jan 21, 2019

--

Listen

Share

**Product Version:** Razer Synapse 3 (3.3.1128.112711) Windows Client
 **Downloaded from:** <https://www.razer.com/downloads>
 **Operating System tested on:** Windows 10 1803 (x64)
 **Vulnerability:** Razer Synapse Windows Service EoP

**Brief Description:** The Razer Synapse software has a service (Razer Synapse Service) that runs as “NT AUTHORITY\SYSTEM” and loads multiple .NET assemblies from **“C:\ProgramData\Razer\\*”**. The folder “**C:\ProgramData\Razer\\*”** and recursive directories/files have weak permissions that grant any authenticated user FullControl over the contents. It is possible to circumvent signing checks and elevate to SYSTEM using assembly sideloading.

**Vulnerability Explanation:**
 When the Razer Synapse service starts, it will load .NET assemblies out of various directories within “C:\ProgramData\Razer\\*”, such as “C:\ProgramData\Razer\Synapse3\Service\bin”.

![]()

Razer Synapse Service loading assemblies from C:\ProgramData

When looking at the DACL on the folder “C:\ProgramData\Razer\Synapse3\Service\bin”, you will notice that “Everyone” has “FullControl” rights over the folder (including any files within the folder):

![]()

DACL C:\ProgramData\Razer\Synapse3\Service\Bin

In theory, an attacker could simply replace an existing .NET assembly with a malicious one, reboot the system and let the Razer Synapse Service load it when it starts. This approach came with some complications, such as a race condition to replace an assembly before the service loads it. Additionally, the service implements some checks that must be passed before the assembly can be loaded. For efficient exploitation, it is important to fully understand the conditions in which an assembly can be loaded successfully.

The first issue to tackle is getting a malicious assembly planted in such a way that the service will try to load it. Hijacking an existing assembly can be challenging as low privileged users do not have rights to stop or start the Razer Synapse service. This means that to trigger the assembly loading code path, the box needs to be rebooted. This makes winning the race condition for swapping out a legitimate assembly with a malicious one challenging. Looking at the service, this problem is solved pretty easily as it recursively enumerates all DLLs in “C:\ProgramData\Razer\\*”.

![]()

Razer Synapse Service searching for all DLL files

This means that we can simply drop an assembly in one of the folders (C:\ProgramData\Razer\Synapse3\Service\bin, for example) and it will be treated the same as an existing, valid assembly.

After recursively enumerating all DLLs in “C:\ProgramData\Razer\\*”, the service attempts to ensure those identified assemblies are signed by Razer. This is done by grabbing certificate information from “Razer.cer”, calling [X509Certificate.CreateFromSignedFile()](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509certificate.createfromsignedfile?view=netframework-4.7.2) on each assembly and then comparing the certificate chain from Razer.cer with the assembly being loaded.

![]()

Razer Synapse Service doing certificate comparison

If the certificate chain on the assembly doesn’t match that of Razer.cer, the service will not load it. While the thought behind checking the trust of .NET assemblies before loading them is good, the implementation wasn’t robust, as X509Certificate.CreateFromSignedFile() only extracts the certificate chain and in no way attests the validity of the signature of the file being checked (<https://twitter.com/tiraniddo/status/1072475737142239233>). This means that it is possible to use a tool such as [SigPirate](https://github.com/xorrior/Random-CSharpTools/tree/master/SigPirate) to clone the certificate from a valid Razer assembly onto a malicious one, due to the fact that the signature of said assembly is never actually verified.

Once the assembly passes the certificate check, the service will then load it into the current app domain via [Assembly.LoadFile()](https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly.loadfile?view=netframework-4.7.2). No malicious code will execute during the Assembly.LoadFile() call, however. After doing so, the service will check to make sure there is an [IPackage interface](https://simpleinjector.org/ReferenceLibrary/html/T_SimpleInjector_Packaging_IPackage.htm) implemented.

![]()

Razer Synapse Service checking for IPackage Interface

This interface is specific to the SimpleInjector project, which is well [documented](https://simpleinjector.org/ReferenceLibrary/). The only requirement to pass this check is to implement the IPackage interface in our malicious assembly. Once the service validates the certificate chain of the assembly and verifies the presence of IPackage, it adds the assembly to a running list. Once this is done for all the assemblies found in “C:\ProgramData\Razer\\*”, the list is then passed to SimpleInjector’s “[RegisterPackages()](https://simpleinjector.org/ReferenceLibrary/html/M_SimpleInjector_PackageExtensions_RegisterPackages.htm)” function.

![]()

Razer Synapse Service adding verified assemblies to a list

RegisterPackages() will take the list of “verified” assemblies and call the “[RegisterServices()](https://simpleinjector.org/ReferenceLibrary/html/M_SimpleInjector_Packaging_IPackage_RegisterServices.htm)” function within the IPackage interface of each assembly.

![]()

Razer Synapse Service calling RegisterPackages()

This is the point in which we, as an attacker, can execute malicious code. All that needs done is to add malicious logic in the “RegisterServices()” method within the IPackage interface of our malicious assembly.

At this point, we have found ways to abuse all of the requirements to get elevated code-execution.

1. Write a custom assembly that implements the IPackage interface from the SimpleInjector project
2. Add malicious logic in the “RegisterServices()” method inside the IPackage interface
3. Compile the assembly and use a tool such as SigPirate to clone the certificate chain from a valid Razer assembly
4. Drop the final malicious assembly into “C:\ProgramData\Razer\Synapse3\Service\bin”
5. Restart the service or reboot the host

**Exploitation:**
 After understanding the requirements to get arbitrary code-execution in an elevated context, we can now exploit it. First, we need to create our malicious assembly that implements the required IPackage interface. To do so, a reference to the “SimpleInjector” and “SimpleInjector.Packaging” assemblies need to be added from the [SimpleInjector project](https://simpleinjector.org/index.html). Once the reference is added, we just need to implement the interface and add malicious logic. A PoC assembly would look something like this:

![]()

PoC assembly with IPackage interface and a malicious RegisterServices() function

Since the Razer service is 32-bit, we compile the assembly as x86. Once compiled, we need to pass the certificate chain check. Since the service is using [X509Certificate.CreateFromSignedFile()](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.x509certificate.createfromsignedfile?view=netframework-4.7.2) without any signature validation, we can simply clone the certificate from a signed Razer assembly using [SigPirate](https://github.com/xorrior/Random-CSharpTools/tree/master/SigPirate):

![]()

Using SigPirate to clone a Razer certificate

Using “Get-AuthenticodeSignature” in PowerShell, we can verify that the certificate was applied to our “lol.dll” assembly that was created from SigPirate:

![]()

Verifying certificate clone

At this point, we have a malicious assembly with a “backdoored” IPackage interface that has a cloned certificate chain from a valid Razer assembly. The last step is to drop “lol.dll” in “C:\ProgramData\Razer\Synapse3\Service\bin” and reboot the host. Once the host restarts, you will see that “Razer Synapse Service.exe” (running as SYSTEM) will have loaded “lol.dll” out of “C:\ProgramData\Razer\Synapse3\Service\bin”, causing the “RegisterServices()” method in the implemented IPackage interface to execute cmd.exe.

![]()

Malicious assembly being loaded

When the service loads “lol.dll”, it sees it as valid due to the cloned certificate, and EoP occurs due to the “malicious” logic in the IPackage implementation.

Razer fixed this by implementing a new namespace called “Security.WinTrust”, which contains functionality for integrity checking. The service will now call “WinTrust.VerifyEmbeddedSignature() right after pulling all the “\*.dll” files from the Razer directory.

![]()

Added mitigation in the Razer Synapse service

When looking at “WinTrust.VerifyEmbeddedSignature()”, the function utilizes “WinTrust.WinVerifyTrust()” to validate that the file being checked has a valid signature (through [WinVerifyTrust()](https://docs.microsoft.com/en-us/windows/desktop/api/wintrust/nf-wintrust-winverifytrust)).

![]()

WinVerifyTrust implementation

If the file has a valid signature AND the signer is by Razer, then the service will continue the original code path of checking for a valid IPackage interface before loading the assembly. By validating the integrity of the file, an attacker can no longer clone the certificate off of a signed Razer file as the signature of the newly cloned file will not be valid.

For additional reading on trust validation, I encourage you to read the whitepaper “[Subverting Trust in Windows](https://specterops.io/assets/resources/SpecterOps_Subverting_Trust_in_Windows.pdf)” by [Matt Graeber.](https://twitter.com/mattifestation)

**Disclosure Timeline:**

As committed as SpecterOps is to [transparency](/a-push-toward-transparency-c385a0dd1e34), we acknowledge the speed at which attackers adopt new offensive techniques once they are made public. This is why prior to publicization of a new bug or offensive technique, we regularly inform the respective vendor of the issue, supply ample time to mitigate the issue, and notify select, trusted vendors in order to ensure that detections can be delivered to their customers as quickly as possible.

**06/05/2018**: Submitted vulnerability report to Razer’s HackerOne program
 **06/08/2018**: Response posted on the H1 thread acknowledging the report
 **06/08/2018**: H1 staff asked for specific version number of the Synapse 3 installer
 **06/08/2018**: Synapse 3 installer version number provided to Razer
 **07/05/2018:** Asked for an update
 **08/06/2018**: Report marked as triaged
 **08/27/2018**: Asked for an update, no response
 **09/14/2018**: Asked for update, along with a direct email address to speed up communication. No response
 **12/14/2018**: Asked for a security contact for Razer via Twitter
 **12/14/2018**: H1 program manager reached out to investigate the H1 report
 **12/15/2018**: Razer CEO Min-Liang Tan reached out directly asking for a direct email to pass to the security team
 **12/16/2018**: The Information Security Manager and SVP of Software reached out directly via email. I was provided context that a fix would be pushed out to the public in a couple of weeks
 **12/19/2018**: Pulled down the latest Synapse 3 build and investigated vulnerable code path. Submitted additional information to Razer’s H1 program, along with notice to Razer’s Manager of Information Security
 **12/25/2018**: I was contacted by someone at Razer with a link to an internal build for remediation verification
 **12/27/2018**: Per their request, provided feedback on the implemented mitigation via the H1 report
 **01/09/2019**: Asked for a timeline update for the fixed build to be provided to the public (via H1)
 **01/10/2019**: Informed that the build is now available to the public
 **01/10/2019**: Report closed
 **01/10/2019:** Requested permission for public disclosure
 **01/10/2019:** Permission for public disclosure granted by Razer
 **01/21/2019:** Report published

\*Note: While the disclosure timeline was lengthy, I have to assume it was due to a disconnect between the folks at Razer managing the H1 program and the folks at Razer working on the fix. Once I was provided an internal contact, the timeline and experience improved drastically.

-Matt N.

*Originally published at* [*enigma0x3.net*](https://enigma0x3.net/2019/01/21/razer-synapse-3-elevation-of-privilege/) *on January 21, 2019.*

[Cybersecurity](https://medium.com/tag/cybersecurity?source=post_page-----6d2802bd0585--------------------------------)[Research](https://medium.com/tag/research?source=post_page-----6d2802bd0585--------------------------------)[Exploit](https://medium.com/tag/exploit?source=post_page-----6d2802bd0585--------------------------------)[Razer](https://medium.com/tag/razer?source=post_page-----6d2802bd0585--------------------------------)

--

--

[![Posts By SpecterOps Team Members](https://miro.medium.com/v2/resize:fill:96:96/1*D-FDlfkqivRBQZoESrwtqw.png)](https://posts.specterops.io/?source=post_page---post_publication_info--6d2802bd0585--------------------------------)[![Posts By SpecterOps Team Members](https://miro.medium.com/v2/resize:fill:128:128/1*D-FDlfkqivRBQZoESrwtqw.png)](https://posts.specterops.io/?source=post_page---post_publication_info--6d2802bd0585--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fspecter-ops-posts&operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&collection=Posts+By+SpecterOps+Team+Members&collectionId=f05f8696e3cc&source=post_page---post_publication_info--6d2802bd0585---------------------follow_profile-----------)[## Published in Posts By SpecterOps Team Members](https://posts.specterops.io/?source=post_page---post_publication_info--6d2802bd0585--------------------------------)[4.91K Followers](/followers?source=post_page---post_publication_info--6d2802bd0585--------------------------------)·[Last published 3 days ago](/introducing-bloodhound-cli-7dfaf82e2df8?source=post_page---post_publication_info--6d2802bd0585--------------------------------)

Posts from SpecterOps team members on various topics relating information security

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fspecter-ops-posts&operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&collection=Posts+By+SpecterOps+Team+Members&collectionId=f05f8696e3cc&source=post_page---post_publication_info--6d2802bd0585---------------------follow_profile-----------)[![Matt Nelson](https://miro.medium.com/v2/resize:fill:96:96/0*6mGXmQSDMYyKuVUK.jpg)](https://medium.com/%40enigma0x3?source=post_page---post_author_info--6d2802bd0585--------------------------------)[![Matt Nelson](https://miro.medium.com/v2/resize:fill:128:128/0*6mGXmQSDMYyKuVUK.jpg)](https://medium.com/%40enigma0x3?source=post_page---post_author_info--6d2802bd0585--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bb43103a9a9&operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&user=Matt+Nelson&userId=1bb43103a9a9&source=post_page-1bb43103a9a9--post_author_info--6d2802bd0585---------------------follow_profile-----------)[## Written by Matt Nelson](https://medium.com/%40enigma0x3?source=post_page---post_author_info--6d2802bd0585--------------------------------)[1.5K Followers](https://medium.com/%40enigma0x3/followers?source=post_page---post_author_info--6d2802bd0585--------------------------------)·[56 Following](https://medium.com/%40enigma0x3/following?source=post_page---post_author_info--6d2802bd0585--------------------------------)

Red Teamer | Security Researcher | Enjoys abusing features | Tweets are my own | <http://github.com/enigma0x3>

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bb43103a9a9&operation=register&redirect=https%3A%2F%2Fposts.specterops.io%2Frazer-synapse-3-elevation-of-privilege-6d2802bd0585&user=Matt+Nelson&userId=1bb43103a9a9&source=post_page-1bb43103a9a9--post_author_info--6d2802bd0585---------------------follow_profile-----------)
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----6d2802bd0585--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----6d2802bd0585--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----6d2802bd0585--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----6d2802bd0585--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----6d2802bd0585--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----6d2802bd0585--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6d2802bd0585--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6d2802bd0585--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----6d2802bd0585--------------------------------)[Teams](https://medium.com/business?source=post_page-----6d2802bd0585--------------------------------)



=== Content from huskersec.com_4b84b178_20250121_011049.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fc93471ff87c8&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Privilege Escalation via HTC VIVEPORT Desktop

[![Joshua Arnold](https://miro.medium.com/v2/resize:fill:88:88/1*_z_xY4dKLvWSoEvFUaESow.jpeg)](https://medium.com/%40huskersec?source=post_page---byline--c93471ff87c8--------------------------------)[![huskersec](https://miro.medium.com/v2/resize:fill:48:48/1*_z_xY4dKLvWSoEvFUaESow.jpeg)](https://huskersec.com/?source=post_page---byline--c93471ff87c8--------------------------------)

[Joshua Arnold](https://medium.com/%40huskersec?source=post_page---byline--c93471ff87c8--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bac6a463626&operation=register&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&user=Joshua+Arnold&userId=1bac6a463626&source=post_page-1bac6a463626--byline--c93471ff87c8---------------------post_header-----------)

Published in[huskersec](https://huskersec.com/?source=post_page---byline--c93471ff87c8--------------------------------)·4 min read·May 24, 2019

--

Listen

Share

On the hunt for privilege escalation paths, I decided to take a look at my own gaming computer to see if any of the software I’ve installed over the years would provide for a nice, simple path to SYSTEM. [This](https://twitter.com/enigma0x3/status/1108595493800546304) Tweet from Matt Nelson intrigued my curiosity to look at my own gaming system. Also, thanks to @FuzzySec for his popular Windows privilege escalation [guide](https://www.fuzzysecurity.com/tutorials/16.html). I’ll first preface this and say that these issues were in no way hard to find. It merely just took someone with a little curiosity to look in the right place.

To summarize, I was able to identify insecure service permissions (CVE-2019–12176) and a DLL hijacking opportunity (CVE-2019–12177) due to insecure directory permissions affecting the VIVEPORT Desktop software installation. We’ll go ahead and begin with the first issue, insecure service permissions. Using the Sysinternals Suite AccessChk tool, I was able to use the following commands to identify two services with the SERVICE\_CHANGE\_CONFIG permission:

![]()

AccessChk permissions result for HTC Account Service

![]()

AccessChk permissions result for ViveportDesktopService

Quick note, I already knew these two services were installed and that’s why I specified the exact service names in the above commands. However, you could always tell AccessChk to search across all services by specifying a \* instead of the specific service.

Moving on, Microsoft describes the SERVICE\_CHANGE\_CONFIG permission in the following screenshot and [here](https://docs.microsoft.com/en-us/windows/desktop/services/service-security-and-access-rights):

![]()

SERVICE\_CHANGE\_CONFIG description

As we can see, we’ve identified some serious issues in the way that these two services are configured, especially considering Microsoft states that the permission “should be granted to only administrators.” Essentially, the output from AccessChk has told us that “Authenticated Users” have the ability to “change the executable file that the system runs.” Since many services are configured to execute as Local System, if the vulnerable service is reconfigured to execute a command or execute a malicious executable, the command or executable will be ran in the context of Local System, resulting in successful privilege escalation.

To test out our newly-found privesc path, I ensured I was logged on as a regular user and then executed the commands in the following screenshots:

![]()

Reconfiguring the HTC Account Service to add a new user, admin1

![]()

Reconfiguring the HTC Account Service to add the admin1 user to the Administrators group

![]()

Reconfiguring the ViveportDesktopService to add a new user, admin2

![]()

Reconfiguring the ViveportDesktopService to add the admin2 user to the Administrators group

Above, both the HTC Account Service and ViveportDesktopService were successfully reconfigured to add new users to the system and to the Administrators group, thus, elevating our privileges from a regular user to that of an administrator.

Next, we’ll take a look at the DLL hijack due to insecure directory permissions identified while looking into the VIVEPORT Desktop installation. First, I’d like to thank Matt Nelson for [this](https://posts.specterops.io/razer-synapse-3-elevation-of-privilege-6d2802bd0585) post, in which he details a privilege escalation in Razer Synapse software. His post got me thinking and kind of guided me down a path to look at images that are loaded by VIVEPORT services when they’re started and from where. Somewhat following his process and methodology, I used the Sysinternals Suite tool, Process Monitor, to determine images that are loaded by the ViveportDesktopService when the service is started. In the following screenshot, we can see the vita\_update\_requester\_api64.dll is loaded when the service is started:

![]()

Load Image operation by ViveportDesktopService.exe

Checking access to the folder where the above DLL is loaded from, it was determined that users have FullControl over the folder:

![]()

Identifying all users have FullControl over the folder where the DLL is loaded from

Leveraging these permissions, MSFvenom was used to quickly generate a DLL that, once loaded, would execute a reverse shell back to my attacker host:

![]()

Generating a malicious reverse shell DLL with MSFvenom

With a perfect, malicious payload ready to go, the DLL was copied to the directory where the legitimate DLL, vita\_update\_requester\_api64.dll, is loaded from:

![]()

Malicious DLL copy and execute

Once the service was started, the reverse shell was received on the attacker system and privileges were verified by running the whoami command:

![]()

Successful reverse shell and verification of privileges

By taking advantage of the vulnerabilities described above, escalation of privileges from a regular user to that of an administrator or SYSTEM was able to take place.

To close this out, I just wanted to quickly say that these issues were disclosed to HTC once identified and that HTC worked quickly to fix both vulnerabilities. As of the release of this post, the VIVEPORT Desktop software has been updated to remediate both issues. Thanks for reading and happy hacking!

**References**

<https://twitter.com/enigma0x3/status/1108595493800546304>

<https://www.fuzzysecurity.com/tutorials/16.html>

<https://docs.microsoft.com/en-us/windows/desktop/services/service-security-and-access-rights>

<https://posts.specterops.io/razer-synapse-3-elevation-of-privilege-6d2802bd0585>

[Privilege Escalation](https://medium.com/tag/privilege-escalation?source=post_page-----c93471ff87c8--------------------------------)[Sysinternals](https://medium.com/tag/sysinternals?source=post_page-----c93471ff87c8--------------------------------)[HTC](https://medium.com/tag/htc?source=post_page-----c93471ff87c8--------------------------------)[Viveport](https://medium.com/tag/viveport?source=post_page-----c93471ff87c8--------------------------------)

--

--

[![huskersec](https://miro.medium.com/v2/resize:fill:96:96/1*_z_xY4dKLvWSoEvFUaESow.jpeg)](https://huskersec.com/?source=post_page---post_publication_info--c93471ff87c8--------------------------------)[![huskersec](https://miro.medium.com/v2/resize:fill:128:128/1*_z_xY4dKLvWSoEvFUaESow.jpeg)](https://huskersec.com/?source=post_page---post_publication_info--c93471ff87c8--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fhuskersec&operation=register&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&collection=huskersec&collectionId=24915e773f6a&source=post_page---post_publication_info--c93471ff87c8---------------------follow_profile-----------)[## Published in huskersec](https://huskersec.com/?source=post_page---post_publication_info--c93471ff87c8--------------------------------)[12 Followers](/followers?source=post_page---post_publication_info--c93471ff87c8--------------------------------)·[Last published May 24, 2019](/privilege-escalation-via-htc-viveport-desktop-c93471ff87c8?source=post_page---post_publication_info--c93471ff87c8--------------------------------)

Infosec Stuffs

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Fhuskersec&operation=register&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&collection=huskersec&collectionId=24915e773f6a&source=post_page---post_publication_info--c93471ff87c8---------------------follow_profile-----------)[![Joshua Arnold](https://miro.medium.com/v2/resize:fill:96:96/1*_z_xY4dKLvWSoEvFUaESow.jpeg)](https://medium.com/%40huskersec?source=post_page---post_author_info--c93471ff87c8--------------------------------)[![Joshua Arnold](https://miro.medium.com/v2/resize:fill:128:128/1*_z_xY4dKLvWSoEvFUaESow.jpeg)](https://medium.com/%40huskersec?source=post_page---post_author_info--c93471ff87c8--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bac6a463626&operation=register&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&user=Joshua+Arnold&userId=1bac6a463626&source=post_page-1bac6a463626--post_author_info--c93471ff87c8---------------------follow_profile-----------)[## Written by Joshua Arnold](https://medium.com/%40huskersec?source=post_page---post_author_info--c93471ff87c8--------------------------------)[10 Followers](https://medium.com/%40huskersec/followers?source=post_page---post_author_info--c93471ff87c8--------------------------------)·[2 Following](https://medium.com/%40huskersec/following?source=post_page---post_author_info--c93471ff87c8--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1bac6a463626&operation=register&redirect=https%3A%2F%2Fhuskersec.com%2Fprivilege-escalation-via-htc-viveport-desktop-c93471ff87c8&user=Joshua+Arnold&userId=1bac6a463626&source=post_page-1bac6a463626--post_author_info--c93471ff87c8---------------------follow_profile-----------)
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----c93471ff87c8--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----c93471ff87c8--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----c93471ff87c8--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----c93471ff87c8--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----c93471ff87c8--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----c93471ff87c8--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----c93471ff87c8--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----c93471ff87c8--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----c93471ff87c8--------------------------------)[Teams](https://medium.com/business?source=post_page-----c93471ff87c8--------------------------------)


