=== Content from github.com_59e0f2ee_20250121_005551.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibreswan%2Flibreswan%2Fcompare%2F9b1394e...3897683)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibreswan%2Flibreswan%2Fcompare%2F9b1394e...3897683)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcompare%2Fshow&source=header-repo&source_repo=libreswan%2Flibreswan)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libreswan](/libreswan)
/
**[libreswan](/libreswan/libreswan)**
Public

* [Notifications](/login?return_to=%2Flibreswan%2Flibreswan) You must be signed in to change notification settings
* [Fork
  228](/login?return_to=%2Flibreswan%2Flibreswan)
* [Star
   865](/login?return_to=%2Flibreswan%2Flibreswan)

* [Code](/libreswan/libreswan)
* [Issues
  538](/libreswan/libreswan/issues)
* [Pull requests
  5](/libreswan/libreswan/pulls)
* [Discussions](/libreswan/libreswan/discussions)
* [Actions](/libreswan/libreswan/actions)
* [Projects
  0](/libreswan/libreswan/projects)
* [Security](/libreswan/libreswan/security)
* [Insights](/libreswan/libreswan/pulse)

Additional navigation options

* [Code](/libreswan/libreswan)
* [Issues](/libreswan/libreswan/issues)
* [Pull requests](/libreswan/libreswan/pulls)
* [Discussions](/libreswan/libreswan/discussions)
* [Actions](/libreswan/libreswan/actions)
* [Projects](/libreswan/libreswan/projects)
* [Security](/libreswan/libreswan/security)
* [Insights](/libreswan/libreswan/pulse)

[Permalink](https://github.com/libreswan/libreswan/compare/libreswan%3A9b1394e...libreswan%3A3897683)
# Comparing changes

 Choose two branches to see what’s changed or to start a new pull request.
If you need to, you can also  compare across forks
 or
[learn more about diff comparisons](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

# Open a pull request

 Create a new pull request by comparing changes across two branches. If you need to, you can also  compare across forks
.
[Learn more about diff comparisons here](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

*base repository:*
libreswan/libreswan

Failed to load repositories. Confirm that selected base ref is valid, then try again.

 Loading

*base:*
9b1394e

Choose a base ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/libreswan/libreswan/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...3897683)

Could not load tags

Nothing to show

[{{ refName }}
default](/libreswan/libreswan/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...3897683)

 Loading

...

*head repository:*
libreswan/libreswan

Failed to load repositories. Confirm that selected head ref is valid, then try again.

 Loading

*compare:*
3897683

Choose a head ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/libreswan/libreswan/compare/9b1394e...%7B%7B%20urlEncodedRefName%20%7D%7D)

Could not load tags

Nothing to show

[{{ refName }}
default](/libreswan/libreswan/compare/9b1394e...%7B%7B%20urlEncodedRefName%20%7D%7D)

 Loading

10
contributors

[Commits
1,257](#commits_bucket)
[Files changed
4,340](#files_bucket)

 Loading

 Loading

### This comparison is taking too long to generate.

Unfortunately it looks like we can’t render this comparison for you right now. It might be too big, or there might be something weird with your repository.

You can try running this command locally to see the comparison on your machine:

`git diff 9b1394e...3897683`

  Retry

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from libreswan.org_dee5bfa7_20250121_005552.html ===
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512
Release date: Monday Jun 4, 2019
Contact: team@libreswan.org
PGP key: 907E790F25C1E8E561CD73B585FF4B43B30FC6F9
CVE-2019-12312: IKEv2 bogus Informational Exchange request can cause NULL pointer dereference
This alert (and any possible updates) is available at the following URLs:
https://libreswan.org/security/CVE-2019-12312/
The Libreswan Project was notified by user GuoJiaXing-Lab124 on github
of a bug in handling bogus encrypted INFORMATIONAL packet requests sent
before the IKE\_AUTH exchange has completed. These packets are bogus,
and libreswan attempted to send an encrypted error message without having
an encryption key due to the skipped IKE\_AUTH exchange. This resulted
in a NULL pointer dereference, causing libreswan to crash and restart.
As the impact of this vulnerability was deemed low, no CVE was requested
for this vulnerability. The Libreswan Projected was notified about a CVE
entry for this issue with minimal and partially incorrect information
which lead to this announcement for CVE-2019-12312 which MITR can
hopefully use to replace the original CVE submission text.
Vulnerable versions: libreswan 3.27
Not vulnerable : libreswan 3.0 - 3.26, 3.28 and later
Vulnerability information
=========================
The IKEv2 protocol in normal operation starts out with an IKE\_SA\_INIT
packet exchange, followed by an IKE\_AUTH packet exchange. They IKE\_AUTH
exchange is encrypted with key material derived from the initial
Diffie-Hellman key exchange values in IKE\_SA\_INIT called SKEYSEED.
When libreswan received an IKE\_SA\_INIT, followed by an INFORMATIONAL
exchange instead of an IKE\_AUTH exchange, it would reject this bogus
exchange. During the error path, it attempted to send an error, which for
an INFORMATIONAL exchange would be encrypted. However, since IKE\_AUTH
had not completed, no proper encryption keys had been installed yet,
and encryption of the error message would fail due to a NULL pointer
dereference. libreswan would crash and restart.
Exploitation
============
By continuing to send these packets, a denial of service attack is possible.
This vulnerability cannot be abused for a remote code execution.
Workaround
==========
A possible workaround is to reconfigure IKEv2 connections to use IKEv1,
using the keyword ikev2=never. However, this must be supported and
allowed by the IKE peer as well. It is recommended to upgrade or patch
libreswan instead of downgrading to IKEv1.
History
=======
- - 2019-05-12 Issue reported via github at https://github.com/libreswan/libreswan/issues/246
- - 2019-05-14 Issue fixed in git master - no CVE was deemed required
- - 2019-05-?? CVE issue requested by an unknown entity
(neither requester nor MITR contacted The Libreswan Project for verification)
- - 2019-05-24 CVE-2019-12312 published by MITR
- - 2019-06-03 The Libreswan Project informed of CVE-2019-12312 by Daniel Kahn Gillmor
- - 2019-06-04 This CVE announcement posted by The Libreswan Project.
Credits
=======
This vulnerability was found and reported by github user GuoJiaXing-Lab124
Upgrading
=========
To address this vulnerability, please upgrade to libreswan 3.28 or later.
For those who cannot upgrade, a patch is provided at the above URL. The
patch has also been included below for reference.
About libreswan (https://libreswan.org/)
========================================
Libreswan is a free implementation of the Internet Key Exchange (IKE)
protocols IKEv1 and IKEv2. It is a descendant (continuation fork) of
openswan 2.6.38. IKE is used to establish IPsec VPN connections.
IPsec uses strong cryptography to provide both authentication and
encryption services. These services allow you to build secure tunnels
through untrusted networks. Everything passing through the untrusted
network is encrypted by the IPsec gateway machine, and decrypted by
the gateway at the other end of the tunnel. The resulting tunnel is a
virtual private network (VPN).
Patch
=====
diff -Naur libreswan-3.27-orig/programs/pluto/ikev2\_send.c libreswan-3.27/programs/pluto/ikev2\_send.c
- --- libreswan-3.27-orig/programs/pluto/ikev2\_send.c 2018-10-07 22:52:09.000000000 -0400
+++ libreswan-3.27/programs/pluto/ikev2\_send.c 2019-06-03 19:17:39.951046484 -0400
@@ -407,6 +407,17 @@
chunk\_t \*ndata)
{
passert(md != NULL); /\* always a reply \*/
+
+ /\*
+ \* The caller must have computed DH and SKEYSEED; but may not
+ \* have authenticated (i.e., don't assume that the IKE SA has
+ \* "established").
+ \*/
+ if (!pst->hidden\_variables.st\_skeyid\_calculated) {
+ loglog(RC\_LOG\_SERIOUS, "Cannot send an encrypted response without SKEYSEED, dropping packet");
+ return;
+ }
+
const char \*const notify\_name = enum\_short\_name(&ikev2\_notify\_names, ntype);
enum isakmp\_xchg\_types exchange\_type = md->hdr.isa\_xchg;
======================================================================
-----BEGIN PGP SIGNATURE-----
iQJHBAEBCgAxFiEEkH55DyXB6OVhzXO1hf9LQ7MPxvkFAlz2mcQTHHRlYW1AbGli
cmVzd2FuLm9yZwAKCRCF/0tDsw/G+WqND/0U4W9g4U+wycP4SbDGF7ML7zzjnBWF
qX9Ii7NCMw8pP2uNSt0DvZHwrsMFnpIPD6PuF7vNC9N9V6jDE4eltIfVG1xm6lAd
GAjwMExzWJ41IuFkvC5Ibv1KlRqP0Tl/rIGYC+JnigIrkuZNqYzNuQKfICpz/liQ
U3DHNBfApS+1JzX8KME/+NAtzlsa5ifTDb+NyPk8P3YC/D+BIa8Eu0XALdJ+SSgP
lZ2Ovopgyq4NsjgjajTxNRh1PRd1oNsfher7CePlE5ukjCViLwJVCjU8d6waTsZ9
XmQ1ubahFlMz0q/cpxUfqdxke9cs4PIolzOOH7kxGed+xUngfzaYa06Z5/7hVvlK
lGNIOeOXYScYkZIaLfzk10dUOoQPoWT4k0Vh/Npm961xZQEUilcsI2XPlzH08wqC
oPtuCAPVxkdjTJTfuiEZmSoE3dKyk5Fr60bMTt3e+QtHdhgwcA2XsFaK+eZfIqaq
U+QpDya3YS4ulYOMYqUYN8AtT1k7V683thUY1HDPBzWHN/eFk5S0l/7LMM48q11t
OxHBGJcP8/bkvSio6yuGbsI/Hwei5Wg6Ue/zVhD1cf3ojGOdRCR1juOB3vCYY6Ra
zXKnb4KeAVSSUW126RumrkbWskZXrnPExN3LYxXdZ8P0T3o/GyNRKStuLz1q+J4e
UF7211pGfjtqRw==
=LBA3
-----END PGP SIGNATURE-----


=== Content from libreswan.org_cc278ee3_20250121_005553.html ===
diff -Naur libreswan-3.27-orig/programs/pluto/ikev2\_send.c libreswan-3.27/programs/pluto/ikev2\_send.c
--- libreswan-3.27-orig/programs/pluto/ikev2\_send.c 2018-10-07 22:52:09.000000000 -0400
+++ libreswan-3.27/programs/pluto/ikev2\_send.c 2019-06-03 19:17:39.951046484 -0400
@@ -407,6 +407,17 @@
chunk\_t \*ndata)
{
passert(md != NULL); /\* always a reply \*/
+
+ /\*
+ \* The caller must have computed DH and SKEYSEED; but may not
+ \* have authenticated (i.e., don't assume that the IKE SA has
+ \* "established").
+ \*/
+ if (!pst->hidden\_variables.st\_skeyid\_calculated) {
+ loglog(RC\_LOG\_SERIOUS, "Cannot send an encrypted response without SKEYSEED, dropping packet");
+ return;
+ }
+
const char \*const notify\_name = enum\_short\_name(&ikev2\_notify\_names, ntype);
enum isakmp\_xchg\_types exchange\_type = md->hdr.isa\_xchg;


=== Content from libreswan.org_c34ce0d3_20250121_030554.html ===

# Index of /security/CVE-2019-12312/

---

```
<../>
<CVE-2019-12312.txt>                                 04-Jun-2019 16:19                5774
<libreswan-3.27-CVE-2019-12312.patch>                04-Jun-2019 04:40                 837

```

---



=== Content from github.com_fb562c39_20250121_005551.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibreswan%2Flibreswan%2Fissues%2F246)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibreswan%2Flibreswan%2Fissues%2F246)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=libreswan%2Flibreswan)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libreswan](/libreswan)
/
**[libreswan](/libreswan/libreswan)**
Public

* [Notifications](/login?return_to=%2Flibreswan%2Flibreswan) You must be signed in to change notification settings
* [Fork
  228](/login?return_to=%2Flibreswan%2Flibreswan)
* [Star
   865](/login?return_to=%2Flibreswan%2Flibreswan)

* [Code](/libreswan/libreswan)
* [Issues
  538](/libreswan/libreswan/issues)
* [Pull requests
  5](/libreswan/libreswan/pulls)
* [Discussions](/libreswan/libreswan/discussions)
* [Actions](/libreswan/libreswan/actions)
* [Projects
  0](/libreswan/libreswan/projects)
* [Security](/libreswan/libreswan/security)
* [Insights](/libreswan/libreswan/pulse)

Additional navigation options

* [Code](/libreswan/libreswan)
* [Issues](/libreswan/libreswan/issues)
* [Pull requests](/libreswan/libreswan/pulls)
* [Discussions](/libreswan/libreswan/discussions)
* [Actions](/libreswan/libreswan/actions)
* [Projects](/libreswan/libreswan/projects)
* [Security](/libreswan/libreswan/security)
* [Insights](/libreswan/libreswan/pulse)

# NULL pointer dereference and pluto daemon restart in Libreswan 3.27 #246

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[NULL pointer dereference and pluto daemon restart in Libreswan 3.27](#top)#246Copy link![@GuoJiaXing-Lab124](https://avatars.githubusercontent.com/u/50319909?v=4&size=80)
## Description

![@GuoJiaXing-Lab124](https://avatars.githubusercontent.com/u/50319909?v=4&size=48)[GuoJiaXing-Lab124](https://github.com/GuoJiaXing-Lab124)opened [on May 12, 2019](https://github.com/libreswan/libreswan/issues/246#issue-443103280)

Hello, I triggered a vulnerability while testing the Libreswan 3.27 IKEv2 server.

The pluto IKE daemon will restart (due to NULL pointer dereference when built with NSS) by sending two IKEv2 packets which are init\_IKE and delete\_IKE in 3des\_cbc mode to Libreswan server.

##### A detailed interactive process is as follows:

First, send the first init\_IKE message to the server.

The server replies the init\_IKE message to the client.

Then send a delete\_IKE message (encrypted) to the server.

The server tries to respond INVALID\_IKE\_SPI to the client, but an exception occurred while preparing to encrypt the message.

##### #### detailed packets

```
# The first packet(I: init_IKE)
###[ IP ]###
     version   = 4
     ihl       = 5
     tos       = 0x0
     len       = 416
     id        = 1
     flags     =
     frag      = 0
     ttl       = 64
     proto     = udp
     chksum    = 0xa778
     src       = 192.168.40.1
     dst       = 192.168.40.130
     \options   \
###[ UDP ]###
        sport     = isakmp
        dport     = isakmp
        len       = 396
        chksum    = 0x3708
###[ IKEv2 ]###
           init_SPI  = '4\xba;\xf6\xd8\x8c\x17\xef'
           resp_SPI  = ''
           next_payload= SA
           version   = 0x20
           exch_type = IKE_SA_INIT
           flags     = Initiator
           id        = 0
           length    = 388
###[ IKEv2 SA ]###
              next_payload= KE
              res       = 0
              length    = 44
              \prop      \
               |###[ IKEv2 Proposal ]###
               |  next_payload= last
               |  res       = 0
               |  length    = 40
               |  proposal  = 1
               |  proto     = IKEv2
               |  SPIsize   = 0
               |  trans_nb  = 4
               |  SPI       = ''
               |  \trans     \
               |   |###[ IKE Transform ]###
               |   |  next_payload= Transform
               |   |  res       = 0
               |   |  length    = 8
               |   |  transform_type= Encryption
               |   |  res2      = 0
               |   |  transform_id= 3DES
               |   |###[ IKE Transform ]###
               |   |     next_payload= Transform
               |   |     res       = 0
               |   |     length    = 8
               |   |     transform_type= Integrity
               |   |     res2      = 0
               |   |     transform_id= HMAC-SHA1-96
               |   |###[ IKE Transform ]###
               |   |        next_payload= Transform
               |   |        res       = 0
               |   |        length    = 8
               |   |        transform_type= PRF
               |   |        res2      = 0
               |   |        transform_id= PRF_HMAC_SHA1
               |   |###[ IKE Transform ]###
               |   |           next_payload= last
               |   |           res       = 0
               |   |           length    = 8
               |   |           transform_type= GroupDesc
               |   |           res2      = 0
               |   |           transform_id= 1024MODPgr
###[ IKEv2 Key Exchange ]###
                 next_payload= Nonce
                 res       = 0
                 length    = 136
                 group     = 1024MODPgr
                 res2      = 0
                 load      = '(\xe9\xaa\xaa\x91\xf1\x1d)\xd9\x1c\x9c\xeb\xcab\x90\xd8\x8fZ\x19\xad\x15\x80\xfe\x16\xde\x06j\x93\t\x92\xcay\x0f^}\x16\x11\xdc\xab\xd3\x0f\xf6ciA\xfe\t\x8del\xd4D\x04\x00\x87v\\Q\xa7\x83t\xc4u\x18\xe6\xb1\xdcV\xbb\x00u}?\x8dz\x90\xef\xe9gb\xf3uJr\x8ed\xae\xcf:\x85\xe5\xdf\xda\xdc1\xc3\x95K\x8e\x82\x84\x96\x0b\xea_N\xe5\x8bB\xdf\x9c\\\xa4\x1a\xbd\xf4B\x07\x1a\x0c\xfd)\xb9.4y\x1d\xa1'
###[ IKEv2 Nonce ]###
                    next_payload= Notify
                    res       = 0
                    length    = 36
                    load      = '\x9al/\xbe\x01\x1f\xdc\xdc\x8b\xa4O\xd7k\xdf\x96^9\xcbmx\xcf\xe8\xc4\xa4$x\x8a\r\xbb%\xa6\xb2'
###[ IKEv2 Notify ]###
                       next_payload= Notify
                       res       = 0
                       length    = 28
                       proto     = Reserved
                       SPIsize   = 0
                       type      = NAT_DETECTION_SOURCE_IP
                       SPI       = ''
                       load      = '\x13\xfa\x01\xe7<\xe4\x93T\xb6\xec\x88\x1d\xeaS\x13O\xad2\x86 '
###[ IKEv2 Notify ]###
                          next_payload= VendorID
                          res       = 0
                          length    = 28
                          proto     = Reserved
                          SPIsize   = 0
                          type      = NAT_DETECTION_DESTINATION_IP
                          SPI       = ''
                          load      = '\xde\xb7\xf8\x91\xddX(\xe6\x89\xc3\xc1l\xae\x9a\x07\xb8o\xb4\x13\xc3'
###[ IKEv2 Vendor ID ]###
                             next_payload= VendorID
                             res       = 0
                             length    = 24
                             vendorID  = '\x1e+Qi\x05\x99\x1c}|\x96\xfc\xbf\xb5\x87\xe4a\x00\x00\x00\t'
###[ IKEv2 Vendor ID ]###
                                next_payload= VendorID
                                res       = 0
                                length    = 20
                                vendorID  = '\xfb\x1d\xe3\xcd\xf3A\xb7\xea\x16\xb7\xe5\xbe\x08U\xf1 '
###[ IKEv2 Vendor ID ]###
                                   next_payload= VendorID
                                   res       = 0
                                   length    = 20
                                   vendorID  = '&$M8\xed\xdba\xb3\x17*6\xe3\xd0\xcf\xb8\x19'
###[ IKEv2 Vendor ID ]###
                                      next_payload= None
                                      res       = 0
                                      length    = 24
                                      vendorID  = '\x01R\x8b\xbb\xc0\x06\x96\x12\x18I\xab\x9a\x1c[*Q\x00\x00\x00\x02'

# The second packet(R: init_IKE)
###[ IP ]###
     version   = 4
     ihl       = 5
     tos       = 0x0
     len       = 361
     id        = 31815
     flags     = DF
     frag      = 0
     ttl       = 64
     proto     = udp
     chksum    = 0xeb68
     src       = 192.168.40.130
     dst       = 192.168.40.1
     \options   \
###[ UDP ]###
        sport     = isakmp
        dport     = isakmp
        len       = 341
        chksum    = 0xd236
###[ IKEv2 ]###
           init_SPI  = '4\xba;\xf6\xd8\x8c\x17\xef'
           resp_SPI  = '\xc6\xe1\x11i\x1d^\x18D'
           next_payload= SA
           version   = 0x20
           exch_type = IKE_SA_INIT
           flags     = Response
           id        = 0
           length    = 333
###[ IKEv2 SA ]###
              next_payload= KE
              res       = 0
              length    = 44
              \prop      \
               |###[ IKEv2 Proposal ]###
               |  next_payload= last
               |  res       = 0
               |  length    = 40
               |  proposal  = 1
               |  proto     = IKEv2
               |  SPIsize   = 0
               |  trans_nb  = 4
               |  SPI       = ''
               |  \trans     \
               |   |###[ IKE Transform ]###
               |   |  next_payload= Transform
               |   |  res       = 0
               |   |  length    = 8
               |   |  transform_type= Encryption
               |   |  res2      = 0
               |   |  transform_id= 3DES
               |   |###[ IKE Transform ]###
               |   |     next_payload= Transform
               |   |     res       = 0
               |   |     length    = 8
               |   |     transform_type= PRF
               |   |     res2      = 0
               |   |     transform_id= PRF_HMAC_SHA1
               |   |###[ IKE Transform ]###
               |   |        next_payload= Transform
               |   |        res       = 0
               |   |        length    = 8
               |   |        transform_type= Integrity
               |   |        res2      = 0
               |   |        transform_id= HMAC-SHA1-96
               |   |###[ IKE Transform ]###
               |   |           next_payload= last
               |   |           res       = 0
               |   |           length    = 8
               |   |           transform_type= GroupDesc
               |   |           res2      = 0
               |   |           transform_id= 1024MODPgr
###[ IKEv2 Key Exchange ]###
                 next_payload= Nonce
                 res       = 0
                 length    = 136
                 group     = 1024MODPgr
                 res2      = 0
                 load      = '\x7f\x9b\x1aHlx\xdd\x86\xaa\xcf\x8e\xcd\x14\x9dU\x1e\x9c\x96\x99\xe6\x16\xc6\xce\xc8.&\xe5\x0e\x16\x8cfr\xfc\x8c\xc60\x83k\x8dF\x1a\xd5s\x8a^\xa5\x85\xcd\x86-\xde\x97\x98\xedc\x17\xb8\xf84!\x15\xf0\x11(D?\xd9\xa3\xc2\x80\xd6\xd6\x92R\xe2\t\xcb\xa2D{\x13g\xb7\x99\xa4\xa7\xd4\x8b\x0c\xf7\xb8\xbd\xa0]\x87\xd0\xa1\xa6~Nf\x9d\x98\x9f\x89\x94\xe5V\xed%\x0f&\x8cT\xe6\xa0\x05Uuyk\xe1w\xd82]A\xfa'
###[ IKEv2 Nonce ]###
                    next_payload= Notify
                    res       = 0
                    length    = 36
                    load      = '\xe9\xc3c\x8a\xa7\xa9_\x8d\xf3\x15\xbc7\xaa\xd8\x8b\xd4\x93\x16\xb7\x10\xe0w\xc0\x10IY\xc1s\xf2<+k'
###[ IKEv2 Notify ]###
                       next_payload= Notify
                       res       = 0
                       length    = 8
                       proto     = Reserved
                       SPIsize   = 0
                       type      = IKEV2_FRAGMENTATION_SUPPORTED
                       SPI       = ''
                       load      = ''
###[ IKEv2 Notify ]###
                          next_payload= Notify
                          res       = 0
                          length    = 28
                          proto     = Reserved
                          SPIsize   = 0
                          type      = NAT_DETECTION_SOURCE_IP
                          SPI       = ''
                          load      = 's\x9a\xd1\xecQ\xc4L\xdfy^\xa5\xb9\x9b\xa4\r\xde\x0c\x13;\xdc'
###[ IKEv2 Notify ]###
                             next_payload= CERTREQ
                             res       = 0
                             length    = 28
                             proto     = Reserved
                             SPIsize   = 0
                             type      = NAT_DETECTION_DESTINATION_IP
                             SPI       = ''
                             load      = "\x91\n%J\x85\xb0\xec\xads\xf42\x8b1\x98\x7f\xff'\xcb\xa6\xfe"
###[ IKEv2 Payload ]###
                                next_payload= None
                                flags     =
                                length    = 25
                                load      = '\x04\xa40\xb5\xee\xedr\x07\xa7\xbf\xe1L<]\x95\x19\xde\xeeys\xd9'

# The third packet(I: delete_IKE)
###[ IP ]###
     version   = 4
     ihl       = 5
     tos       = 0x0
     len       = 100
     id        = 1
     flags     =
     frag      = 0
     ttl       = 64
     proto     = udp
     chksum    = 0xa8b4
     src       = 192.168.40.1
     dst       = 192.168.40.130
     \options   \
###[ UDP ]###
        sport     = 4500
        dport     = 4500
        len       = 80
        chksum    = 0xafe4
        data      = 0x00000000
###[ IKEv2 ]###
  init_SPI  = '4\xba;\xf6\xd8\x8c\x17\xef'
  resp_SPI  = '\xc6\xe1\x11i\x1d^\x18D'
  next_payload= Encrypted
  version   = 0x20
  exch_type = INFORMATIONAL
  flags     = Initiator
  id        = 1
  length    = 68
###[ IKEv2 Encrypted and Authenticated ]###
     next_payload= Delete
     res       = 0
     length    = 40
     load      = '=!\x87\x9c@\x0eX\xe5\xa1\xdf\xc6\xc9\xa2&\xf8\xf5\xc7\x0fSu\xd7\xa0\xdf\xc4nZ\x1a\x99U\x02Y_\xad\xc5UA'

# *************** #
# Decrypted message
###[ IKEv2 Delete ]###
  next_payload= None
  res       = 0
  length    = 8
  vendorID  = '\x01\x00\x00\x00'
# *************** #

# relecant parameters
spi_i
0x34\0xba\0x3b\0xf6\0xd8\0x8c\0x17\0xef
spi_r
0xc6\0xe1\0x11\0x69\0x1d\0x5e\0x18\0x44
sk_ai
0xa7\0xcb\0x4f\0x50\0xe9\0xb5\0x61\0x8f\0x04\0xc4\0xaa\0x0f\0x58\0x93\0x98\0xd3\0xfd\0xb6\0xdb\0xdb
sk_ar
0x89\0x2c\0xd0\0x3a\0x4e\0xb1\0xeb\0x19\0xf7\0x04\0xc1\0xc1\0x6f\0x64\0x08\0x5d\0x4b\0xef\0x8d\0x34
sk_ei
0xe9\0x4a\0x94\0x4d\0x2e\0xfb\0x8b\0x8e\0x86\0xb9\0xd6\0x18\0xfb\0xcd\0x53\0xdd\0xd8\0x35\0x60\0xba\0xc8\0xbb\0x71\0x46
sk_er
0x7a\0x4d\0x3d\0xb3\0x4d\0x72\0x7e\0x25\0xa4\0xc5\0x4a\0xb1\0x93\0x9d\0x9f\0x51\0x17\0x44\0x86\0x3e\0x51\0xe0\0x39\0x22

```
##### Relevant log

```
May  7 16:32:32.868480: | state #1 requesting EVENT_CRYPTO_TIMEOUT to be deleted
May  7 16:32:32.868496: | free_event_entry: release EVENT_CRYPTO_TIMEOUT-pe@0x55f4dc4630f8
May  7 16:32:32.868501: | event_schedule: new EVENT_v2_RESPONDER_TIMEOUT-pe@0x55f4dc4630f8
May  7 16:32:32.868506: | inserting event EVENT_v2_RESPONDER_TIMEOUT, timeout in 200.000 seconds for #1
May  7 16:32:32.868515: | processing: stop state #1 connection "ikev2-cp"[1] 192.168.40.1 192.168.40.1:500 (in schedule_event_now_cb() at server.c:561)
May  7 16:32:32.868519: | serialno table: hash serialno #0 to head 0x55f4db2fb4e0
May  7 16:32:32.868522: | serialno table: hash serialno #0 to head 0x55f4db2fb4e0
May  7 16:32:32.883707: | *received 68 bytes from 192.168.40.1:4500 on ens33 (port=4500)
May  7 16:32:32.883740: |   34 ba 3b f6  d8 8c 17 ef  c6 e1 11 69  1d 5e 18 44
May  7 16:32:32.883743: |   2e 20 25 08  00 00 00 01  00 00 00 44  2a 00 00 28
May  7 16:32:32.883745: |   3d 21 87 9c  40 0e 58 e5  a1 df c6 c9  a2 26 f8 f5
May  7 16:32:32.883766: |   c7 0f 53 75  d7 a0 df c4  6e 5a 1a 99  55 02 59 5f
May  7 16:32:32.883769: |   ad c5 55 41
May  7 16:32:32.883773: | processing: start from 192.168.40.1:4500 (in process_md() at demux.c:391)
May  7 16:32:32.883778: | **parse ISAKMP Message:
May  7 16:32:32.883780: |    initiator cookie:
May  7 16:32:32.883782: |   34 ba 3b f6  d8 8c 17 ef
May  7 16:32:32.883785: |    responder cookie:
May  7 16:32:32.883786: |   c6 e1 11 69  1d 5e 18 44
May  7 16:32:32.883789: |    next payload type: ISAKMP_NEXT_v2SK (0x2e)
May  7 16:32:32.883792: |    ISAKMP version: IKEv2 version 2.0 (rfc4306/rfc5996) (0x20)
May  7 16:32:32.883794: |    exchange type: ISAKMP_v2_INFORMATIONAL (0x25)
May  7 16:32:32.883796: |    flags: ISAKMP_FLAG_v2_IKE_INIT (0x8)
May  7 16:32:32.883799: |    message ID:  00 00 00 01
May  7 16:32:32.883801: |    length: 68 (0x44)
May  7 16:32:32.883804: |  processing version=2.0 packet with exchange type=ISAKMP_v2_INFORMATIONAL (37)
May  7 16:32:32.883806: | I am receiving an IKEv2 Request ISAKMP_v2_INFORMATIONAL
May  7 16:32:32.883808: | I am the IKE SA Original Responder
May  7 16:32:32.883814: | cookies table: hash icookie 34 ba 3b f6  d8 8c 17 ef rcookie c6 e1 11 69  1d 5e 18 44 to 3873113480610546027 slot 0x55f4db2f6b40
May  7 16:32:32.883817: | parent v2 peer and cookies match on #1
May  7 16:32:32.883820: | v2 state object #1 found, in STATE_PARENT_R1
May  7 16:32:32.883825: | processing: start state #1 connection "ikev2-cp"[1] 192.168.40.1 192.168.40.1:500 (in processed_retransmit() at ikev2.c:1182)
May  7 16:32:32.883827: | found state #1
May  7 16:32:32.883831: | processing: [RE]START state #1 connection "ikev2-cp"[1] 192.168.40.1 192.168.40.1:500 (in ikev2_process_packet() at ikev2.c:1552)
May  7 16:32:32.883834: | processing: start connection "ikev2-cp"[1] 192.168.40.1 (BACKGROUND) (in ikev2_process_packet() at ikev2.c:1557)
May  7 16:32:32.883837: | #1 is idle
May  7 16:32:32.883839: | #1 idle
May  7 16:32:32.883841: | #1 in state PARENT_R1: received v2I1, sent v2R1
May  7 16:32:32.883844: | selected state microcode roof
May  7 16:32:32.883846: | no useful state microcode entry found
May  7 16:32:32.883850: "ikev2-cp"[1] 192.168.40.1 #1: responding to INFORMATIONAL message (ID 1) from 192.168.40.1:500 with encrypted notification INVALID_IKE_SPI
May  7 16:32:32.883853: | Opening output PBS encrypted notification
May  7 16:32:32.883856: | **emit ISAKMP Message:
May  7 16:32:32.883858: |    initiator cookie:
May  7 16:32:32.883860: |   34 ba 3b f6  d8 8c 17 ef
May  7 16:32:32.883862: |    responder cookie:
May  7 16:32:32.883864: |   c6 e1 11 69  1d 5e 18 44
May  7 16:32:32.883866: |    next payload type: ISAKMP_NEXT_NONE (0x0)
May  7 16:32:32.883869: |    ISAKMP version: IKEv2 version 2.0 (rfc4306/rfc5996) (0x20)
May  7 16:32:32.883871: |    exchange type: ISAKMP_v2_INFORMATIONAL (0x25)
May  7 16:32:32.883873: |    flags: ISAKMP_FLAG_v2_MSG_RESPONSE (0x20)
May  7 16:32:32.883875: |    message ID:  00 00 00 01
May  7 16:32:32.883878: | next payload type: saving message location 'ISAKMP Message'.'next payload type'
May  7 16:32:32.883881: | next payload type: setting 'ISAKMP Message'.'next payload type' to IKEv2 Encryption Payload (46:ISAKMP_NEXT_v2SK)
May  7 16:32:32.883884: | ***emit IKEv2 Encryption Payload:
May  7 16:32:32.883886: |    next payload type: ISAKMP_NEXT_v2NONE (0x0)
May  7 16:32:32.883888: |    flags: none (0x0)
May  7 16:32:32.883890: | next payload type: saving message location 'IKEv2 Encryption Payload'.'next payload type'
May  7 16:32:32.883901: | emitting 8 raw bytes of IV into IKEv2 Encryption Payload
May  7 16:32:32.883904: | IV  d1 f5 3d d9  f2 04 95 d2
May  7 16:32:32.883906: | Adding a v2N Payload
May  7 16:32:32.883909: | next payload type: setting 'IKEv2 Encryption Payload'.'next payload type' to IKEv2 Notify Payload (41:ISAKMP_NEXT_v2N)
May  7 16:32:32.883911: | ****emit IKEv2 Notify Payload:
May  7 16:32:32.883913: |    next payload type: ISAKMP_NEXT_v2NONE (0x0)
May  7 16:32:32.883915: |    flags: none (0x0)
May  7 16:32:32.883918: |    Protocol ID: PROTO_v2_RESERVED (0x0)
May  7 16:32:32.883926: |    SPI size: 0 (0x0)
May  7 16:32:32.883929: |    Notify Message Type: v2N_INVALID_IKE_SPI (0x4)
May  7 16:32:32.883931: | next payload type: saving payload location 'IKEv2 Notify Payload'.'next payload type'
May  7 16:32:32.883944: | emitting length of IKEv2 Notify Payload: 8
May  7 16:32:32.883947: | adding 8 bytes of padding (including 1 byte padding-length)
May  7 16:32:32.883949: | emitting 8 raw bytes of padding and length into IKEv2 Encryption Payload
May  7 16:32:32.883952: | padding and length  00 01 02 03  04 05 06 07
May  7 16:32:32.883955: | emitting 12 zero bytes of length of truncated HMAC/KEY into IKEv2 Encryption Payload
May  7 16:32:32.883966: | emitting length of IKEv2 Encryption Payload: 40
May  7 16:32:32.883969: | emitting length of ISAKMP Message: 68
May  7 16:32:32.883972: | construct_enc_iv: encryption IV/starting-variable: salt-size=0 wire-IV-size=8 block-size 8
May  7 16:32:32.883974: | construct_enc_iv: encryption IV/starting-variable: computed counter-size=0
May  7 16:32:32.883976: | encryption IV/starting-variable
May  7 16:32:32.883978: |   d1 f5 3d d9  f2 04 95 d2
May  7 16:32:32.883980: | data before encryption:
May  7 16:32:32.883982: |   00 00 00 08  00 00 00 04  00 01 02 03  04 05 06 07
May  7 16:32:32.883985: | NSS ike_alg_nss_cbc: 3des_cbc - enter
May  7 16:32:32.883988: "ikev2-cp"[1] 192.168.40.1 #1: ABORT: ASSERTION FAILED: 3des_cbc - NSS derived enc key in NULL (in ike_alg_nss_cbc() at ike_alg_encrypt_nss_cbc_ops.c:41)

```
##### My ipsec.conf

```
version 2.0

config setup
  virtual-private=%v4:10.0.0.0/8,%v4:192.168.0.0/16,%v4:172.16.0.0/12,%v4:!192.168.42.0/24,%v4:!192.168.43.0/24
  protostack=netkey
  interfaces=%defaultroute
  uniqueids=no
  plutodebug="all crypt"
  plutostderrlog=/var/log/libreswan.log

conn ikev2-cp
  left=%defaultroute
  leftcert=192.168.40.130
  leftid=@192.168.40.130
  leftsendcert=always
  leftsubnet=0.0.0.0/0
  leftrsasigkey=%cert
  right=%any
  rightid=%fromcert
  # rightaddresspool=192.168.43.10-192.168.43.250
  rightaddresspool=10.31.2.0-10.31.3.254
  rightca=%same
  rightrsasigkey=%cert
  narrowing=yes
  dpddelay=30
  dpdtimeout=120
  dpdaction=clear
  auto=add
  ikev2=insist
  rekey=yes
  pfs=no
  ike-frag=yes
  ike=3des-sha1;modp1024,aes256-sha2,aes128-sha2,aes256-sha1,aes128-sha1,aes256-sha2;modp1024,aes128-sha1;modp1024
  phase2alg=3des-sha1;modp1024,aes_gcm-null,aes128-sha1,aes256-sha1,aes128-sha2,aes256-sha2
  modecfgdns="8.8.8.8 8.8.4.4"
  encapsulation=yes
  mobike=no

conn shared
  left=%defaultroute
  leftid=218.28.144.36
  right=%any
  encapsulation=yes
  authby=secret
  pfs=no
  rekey=no
  keyingtries=5
  dpddelay=30
  dpdtimeout=120
  dpdaction=clear
  ike=aes256-sha2,aes128-sha2,aes256-sha1,aes128-sha1,aes256-sha2;modp1024,aes128-sha1;modp1024
  phase2alg=aes_gcm-null,aes128-sha1,aes256-sha1,aes256-sha2_512,aes128-sha2,aes256-sha2
  sha2-truncbug=yes

conn l2tp-psk
  auto=add
  leftprotoport=17/1701
  rightprotoport=17/%any
  type=transport
  phase2=esp
  also=shared

conn xauth-psk
  auto=add
  leftsubnet=0.0.0.0/0
  rightaddresspool=192.168.43.10-192.168.43.250
  modecfgdns="8.8.8.8 8.8.4.4"
  leftxauthserver=yes
  rightxauthclient=yes
  leftmodecfgserver=yes
  rightmodecfgclient=yes
  modecfgpull=yes
  xauthby=file
  ike-frag=yes
  ikev2=never
  cisco-unity=yes
  also=shared
  ike=3des-sha1;modp1024,aes256-sha2,aes128-sha2,aes256-sha1,aes128-sha1,aes256-sha2;modp1024,aes128-sha1;modp1024
  phase2alg=aes_gcm-null,aes128-sha1,aes256-sha1,aes128-sha2,aes256-sha2

```

Looking forward to your reply, thank you.

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


