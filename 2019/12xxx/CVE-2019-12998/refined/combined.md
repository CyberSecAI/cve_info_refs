=== Content from lists.linuxfoundation.org_0ff59e80_20250121_010545.html ===
From rusty at rustcorp.com.au Fri Sep 27 12:01:46 2019
From: rusty at rustcorp.com.au (Rusty Russell)
Date: Fri, 27 Sep 2019 21:31:46 +0930
Subject: [Lightning-dev] Full Disclosure: CVE-2019-12998 / CVE-2019-12999 /
CVE-2019-13000
Message-ID: <87mueq6j85.fsf@rustcorp.com.au>
Problem
-------
A lightning node accepting a channel must check that the funding transaction
output does indeed open the channel proposed. Otherwise an attacker can claim
to open a channel but either not pay to the peer, or not pay the full amount.
Once that transaction reaches the minimum depth, it can spend funds from the
channel. The victim will only notice when it tries to close the channel and none
of the commitment or mutual close transactions it has are valid.
Implementations did not always do this check:
c-lightning: v0.7.1 and above do this correctly, prior versions never did.
(CVE-2019-12998)
- This can be exploited by a connecting peer and claiming to open a channel
with any transaction id.
lnd: v0.7.1 and above do this correctly, prior versions did not check the
amount. v0.7.0 and above properly check for the scriptpubkey, v0.6.x
partially enforces the funding scriptpubkey, but pre-v0.6.0 did not verify
at all. (CVE-2019-12999)
- Exploiting via incorrect amount is possible against all prior versions. In
v0.7.0, the attacker must use the correct scriptpubkey, which burns the
coins in the funding output.
- Exploiting via incorrect scriptpubkey is possible on all versions prior to
v0.6.0. This exploit is also possible in v0.6.x if the node is offline
when the funding transaction reached the required number of confirmations
and running with -txindex=0 on either full node backend.
- Exploiting neutrino users (usually mobile or laptop) with an incorrect
outpoint would require the attacker to collide their fake outpoint with
the script of the real outpoint in the BIP 158 filter. The siphash key
used to create the filters is derived from the blockhash. As a result, the
attacker cannot directly grind outpoints without also knowing the block
hash ahead of time. In addition, neutrino nodes are typically either
non-listening or do not have an advertised address, which means an
attacker would have to wait until receiving an inbound connection to
perform either exploit.
eclair: v0.3.1 and above do this correctly, prior versions did not if using
the bitcoin core backend; electrum users only check the script, not the
amount. (CVE-2019-13000)
- Exploiting Electrum users (on mobile) requires the user to actively
connect to a malicious Lightning node, and the attacker to use the correct
scriptpubkey, which burns the coins in the funding output. Since Eclair
Mobile doesn?t relay payments, the attacker can?t cash out without an
offband interaction (e.g. selling something to the user and paying with
the funds in the fake channel).
Solution
--------
Once the funding transaction is seen, peers MUST check that the outpoint as
described in `funding\_created`[1] is a funding transaction output[2] with
the amount described in `open\_channel`[3].
Background
----------
To open a channel, the funding peer sends `open\_channel` with the proposed
`funding\_satoshis`. The fundee replies with `accept\_channel` providing the
keys it wants to use for the funding transaction.
Then the funder creates the funding transaction, and sends the transaction id
and output number in a `funding\_created` message.
```
+-------+ +-------+
| |--(1)--- open\_channel ----->| |
| |<-(2)-- accept\_channel -----| |
| | | |
| A |--(3)-- funding\_created --->| B |
| |<-(4)-- funding\_signed -----| |
| | | |
| |--(5)--- funding\_locked ---->| |
| |<-(6)--- funding\_locked -----| |
+-------+ +-------+
- where node A is 'funder' and node B is 'fundee'
```
With this information, the fundee can create the signatures on the first
"commitment transaction" and sends it in a `funding\_signed` message so the
funder can retrieve their funds should something go wrong. It is then safe
for the funder to sign and broadcast the opening transaction. After some
number of confirmations (set by the fundee), the channel is operational
(`funding\_locked`).
The specification describes clearly the requirement to check that the various
signatures exchanged indeed allow creation of a valid commitment transaction[4],
and describes the requirement to wait for confirmations[5].
It did NOT, however, require the receiver to actually check that the
transaction is the one promised by the funder: both the amount and the actual
scriptpubkey.
Discovery
---------
Rusty Russell (Blockstream) discovered this while working on protocol
tests for the specification itself, as part of an ongoing effort to
test multiple new proposed features add new complexities.[6]
The discovery occurred while writing tests for channel opening
negotiation, in particular that invalid variants were rejected; while
writing a test where the opener supplied an incorrect
`funding\_output\_index` in the `funding\_created` message, he realized
that it would not be rejected by the c-lightning implementation, which
only checked the confirmation count of the `funding\_txid`, and not
even whether the `funding\_output\_index` even existed!
This requirement was not mentioned in the specification, so Rusty
immediately disclosed the problem the authors of the other most widely
used implementations (eclair and lnd). Their own investigations
revealed that they were similarly vulnerable in limited circumstances.
Together the teams made the decision to fix this quietly for pending
releases, then reveal the existence of a problem 8 weeks later, once
most users had already upgraded. Four weeks after that, the full
disclosure would be made.
While this long-standing bug had not been independently discovered, and thus
was unlikely to be discovered by a malicious party before being fixed, it did
provide an opportunity to test communications and methods of upgrade across
the entire lightning ecosystem.
Timeline
--------
2019-06-27: Bug discovered, LND and Eclair notified.
2019-06-28: CVEs assigned.
2019-07-02: lnd v0.7.0-beta released.
2019-07-03: Eclair 0.3.1 released.
2019-07-04: c-lightning 0.7.1 released.
2019-07-06: disclosure to other projects begins (rust-lightning, ptarmigan, BLW).
2019-07-30: lnd v0.7.1-beta released.
2019-08-17: [Review next dates based on deployment stats/problems]
2019-08-30: Reveal existence of CVEs, encourage laggards to upgrade.
2019-09-07: First conclusive evidence of exploit attempt in the wild.
2019-09-27: Full disclosure of CVEs.
2019-09-27: Submit PR to spec to require this.
[1] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#the-funding\_created-message
[2] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/03-transactions.md#funding-transaction-output
[3] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#the-open\_channel-message
[4] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#requirements-2
[5] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#the-funding\_locked-message
[6] https://github.com/ElementsProject/lightning-rfc-protocol-test


=== Content from github.com_4a3cf2ec_20250121_010543.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FElementsProject%2Flightning%2Fcommits%2Fmaster)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FElementsProject%2Flightning%2Fcommits%2Fmaster)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommits%2Fshow&source=header-repo&source_repo=ElementsProject%2Flightning)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ElementsProject](/ElementsProject)
/
**[lightning](/ElementsProject/lightning)**
Public

* [Notifications](/login?return_to=%2FElementsProject%2Flightning) You must be signed in to change notification settings
* [Fork
  912](/login?return_to=%2FElementsProject%2Flightning)
* [Star
   2.9k](/login?return_to=%2FElementsProject%2Flightning)

* [Code](/ElementsProject/lightning)
* [Issues
  632](/ElementsProject/lightning/issues)
* [Pull requests
  49](/ElementsProject/lightning/pulls)
* [Actions](/ElementsProject/lightning/actions)
* [Projects
  0](/ElementsProject/lightning/projects)
* [Security](/ElementsProject/lightning/security)
* [Insights](/ElementsProject/lightning/pulse)

Additional navigation options

* [Code](/ElementsProject/lightning)
* [Issues](/ElementsProject/lightning/issues)
* [Pull requests](/ElementsProject/lightning/pulls)
* [Actions](/ElementsProject/lightning/actions)
* [Projects](/ElementsProject/lightning/projects)
* [Security](/ElementsProject/lightning/security)
* [Insights](/ElementsProject/lightning/pulse)

# Commits

## Branch selector

 master
## User selector

All users
## Datepicker

All time
## Commit History

### Commits on Jan 20, 2025

* #### [ccan/htable: update to explicit DUPS/NODUPS types.](/ElementsProject/lightning/commit/b6c1ffa359936166162a59a7d16c4f5c7534454b "ccan/htable: update to explicit DUPS/NODUPS types. The updated API requires typed htables to explicitly state whether they allow duplicates: for most cases we don't, but we've had issues in the past. This is a big patch, but mainly mechanical. Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for b6c1ffa[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[b6c1ffa](/ElementsProject/lightning/commit/b6c1ffa359936166162a59a7d16c4f5c7534454b)Copy full SHA for b6c1ffa
* #### [common: add test for htable churn.](/ElementsProject/lightning/commit/5cecdd7dbac1f5ea07116204de693fe5a3893123 "common: add test for htable churn. I wanted to make sure we didn't have a bug in our htable routine, so I wrote this test. We don't, but leave it in. Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 5cecdd7[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[5cecdd7](/ElementsProject/lightning/commit/5cecdd7dbac1f5ea07116204de693fe5a3893123)Copy full SHA for 5cecdd7
* #### [wallet: do proper memleak scan of outpoint htables, not notleak().](/ElementsProject/lightning/commit/d6217e2835b66b73577f848ff8ab9667aebd823b "wallet: do proper memleak scan of outpoint htables, not notleak(). Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for d6217e2[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[d6217e2](/ElementsProject/lightning/commit/d6217e2835b66b73577f848ff8ab9667aebd823b)Copy full SHA for d6217e2
### Commits on Jan 15, 2025

* #### [github: Checkout action triggering branch](/ElementsProject/lightning/commit/2f6428394501fe19a2228271f548f6d5540aa85d "github: Checkout action triggering branch To ensure the workflow uses updated files, including the Dockerfile, from the same branch for testing.")

  Show description for 2f64283[![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)](/ShahanaFarooqui)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[2f64283](/ElementsProject/lightning/commit/2f6428394501fe19a2228271f548f6d5540aa85d)Copy full SHA for 2f64283
* #### [build: Update poetry.lock files for CLN and built-in plugins](/ElementsProject/lightning/commit/0129aecda8a55581123641d496fc4331d066ed87 "build: Update poetry.lock files for CLN and built-in plugins Main application poetry.lock file as well as clnrest and wss-proxy.")

  Show description for 0129aec ![s373nZ](https://avatars.githubusercontent.com/u/118189041?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[s373nZ](/ElementsProject/lightning/commits?author=s373nZ)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[0129aec](/ElementsProject/lightning/commit/0129aecda8a55581123641d496fc4331d066ed87)Copy full SHA for 0129aec
* #### [chore(docker): Update support for Poetry v2.0.0.](/ElementsProject/lightning/commit/72df37550311cc4efd318ae58ebb72d98e1b237c "chore(docker): Update support for Poetry v2.0.0. - Install `poetry-plugin-export` as a separate step. - Remove `--no-update` option from `poetry lock` as it's now default behavior. - Add `poetry lock` to the command chain after removing cln-rest and wss-proxy. https://github.com/python-poetry/poetry/releases/tag/2.0.0")

  Show description for 72df375 ![s373nZ](https://avatars.githubusercontent.com/u/118189041?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[s373nZ](/ElementsProject/lightning/commits?author=s373nZ)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[72df375](/ElementsProject/lightning/commit/72df37550311cc4efd318ae58ebb72d98e1b237c)Copy full SHA for 72df375
* #### [chore(docker): Clean up formatting and standardize Dockerfile.](/ElementsProject/lightning/commit/8a0771d08153397097c1f4b369a0337dc0f3e11b "chore(docker): Clean up formatting and standardize Dockerfile. - Align indentation. - Use multi-line `ENV` where values don't depend on each other. Changelog-None")

  Show description for 8a0771d ![s373nZ](https://avatars.githubusercontent.com/u/118189041?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[s373nZ](/ElementsProject/lightning/commits?author=s373nZ)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[8a0771d](/ElementsProject/lightning/commit/8a0771d08153397097c1f4b369a0337dc0f3e11b)Copy full SHA for 8a0771d
* #### [build: Upgrade Docker base images to Debian Bookworm.](/ElementsProject/lightning/commit/ec364deeda75dbc6c01a76c84adcdc81529d2e7a "build: Upgrade Docker base images to Debian Bookworm. Undertaken to upgrade QEMU to 7.2. Also upgrades Python to 3.11 implicitly and migrates Python dependency management to virtual environments. Changelog-Changed: Released Docker images are now based on Debian Bookworm")

  Show description for ec364de ![s373nZ](https://avatars.githubusercontent.com/u/118189041?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[s373nZ](/ElementsProject/lightning/commits?author=s373nZ)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[ec364de](/ElementsProject/lightning/commit/ec364deeda75dbc6c01a76c84adcdc81529d2e7a)Copy full SHA for ec364de
* #### [build: Fixes for the Docker building libpq lib.](/ElementsProject/lightning/commit/4329a194ae82371a450e67ce7c042451f06da3d2 "build: Fixes for the Docker building libpq lib. - Add Postgres dependencies: bison, flex and libiu-dev. - Fix missing `&&` in chained wget commands. - Add `POSTGRES_CONFIG` and `PG_CONFIG` for all architectures. - Remove existing `libpq` Ubuntu packages. - Copy libpq libraries from builder directly to final image. Changelog-Fixed: Fixes Postgres driver availability for arm64 and arm32 Docker images.")

  Show description for 4329a19 ![s373nZ](https://avatars.githubusercontent.com/u/118189041?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[s373nZ](/ElementsProject/lightning/commits?author=s373nZ)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[4329a19](/ElementsProject/lightning/commit/4329a194ae82371a450e67ce7c042451f06da3d2)Copy full SHA for 4329a19
* #### [docker: add libpq for multi-arch build configuration](/ElementsProject/lightning/commit/07c1a7f4fe15d189907b7d579afde4c605faa02c "docker: add libpq for multi-arch build configuration")

   ![arowser](https://avatars.githubusercontent.com/u/541066?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[arowser](/ElementsProject/lightning/commits?author=arowser)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[07c1a7f](/ElementsProject/lightning/commit/07c1a7f4fe15d189907b7d579afde4c605faa02c)Copy full SHA for 07c1a7f
### Commits on Jan 14, 2025

* #### [ci: remove macOS gettext symlinking](/ElementsProject/lightning/commit/9ce885b8a136085bcf435f821b6960ba2606e809 "ci: remove macOS gettext symlinking This doesn't do anything, because it's trying to create a symlink for a verison that doesn't exist. The version installed via brew is 0.22.5. In any case, on any recent macOS system, this should not be necessary. Changelog-None.")

  Show description for 9ce885b ![fanquake](https://avatars.githubusercontent.com/u/863730?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[fanquake](/ElementsProject/lightning/commits?author=fanquake)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[9ce885b](/ElementsProject/lightning/commit/9ce885b8a136085bcf435f821b6960ba2606e809)Copy full SHA for 9ce885b
### Commits on Jan 13, 2025

* #### [tools: Add testnet4 support for reckless and hsmtool](/ElementsProject/lightning/commit/24e0929c0e6b2311c2d67112ae8c6dd22fa1ab66 "tools: Add testnet4 support for reckless and hsmtool Changelog-Added: Support for Bitcoin `testnet4`")

  Show description for 24e0929[![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)](/ShahanaFarooqui)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[24e0929](/ElementsProject/lightning/commit/24e0929c0e6b2311c2d67112ae8c6dd22fa1ab66)Copy full SHA for 24e0929
* #### [tests: Add testnet4 default port](/ElementsProject/lightning/commit/e731170cc932e4d0692ba6850f10e0adf09f091c "tests: Add testnet4 default port")

  [![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)](/ShahanaFarooqui)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[e731170](/ElementsProject/lightning/commit/e731170cc932e4d0692ba6850f10e0adf09f091c)Copy full SHA for e731170
* #### [doc: Add details and script check for testnet4](/ElementsProject/lightning/commit/f640394ceb46bc1228d6703a5c3df353112bb0ba "doc: Add details and script check for testnet4")

  [![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)](/ShahanaFarooqui)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[f640394](/ElementsProject/lightning/commit/f640394ceb46bc1228d6703a5c3df353112bb0ba)Copy full SHA for f640394
* #### [pyln-spec: add testnet4 support](/ElementsProject/lightning/commit/02b19a87969da9a1c1a50a87b736ec2be6a7937c "pyln-spec: add testnet4 support")

  [![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)](/ShahanaFarooqui)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[02b19a8](/ElementsProject/lightning/commit/02b19a87969da9a1c1a50a87b736ec2be6a7937c)Copy full SHA for 02b19a8
* #### [common: Chainparams for testnet4 support](/ElementsProject/lightning/commit/1da0c1fbe2bb440f873452435fee668c496ea4f1 "common: Chainparams for testnet4 support The BIP70 name given as testnet4 to correspond with chaininfo value.")

  Show description for 1da0c1f ![2seaq](https://avatars.githubusercontent.com/u/169211755?v=4&size=32)![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)[2seaq](/ElementsProject/lightning/commits?author=2seaq)authored and[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[1da0c1f](/ElementsProject/lightning/commit/1da0c1fbe2bb440f873452435fee668c496ea4f1)Copy full SHA for 1da0c1f
* #### [ci: Fix for FreeBSD workflow](/ElementsProject/lightning/commit/c1484a65c23ed01d376a9cc66883d6ae081760a1 "ci: Fix for FreeBSD workflow Changelog-None.")

  Show description for c1484a6[![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)](/ShahanaFarooqui)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)committed[c1484a6](/ElementsProject/lightning/commit/c1484a65c23ed01d376a9cc66883d6ae081760a1)Copy full SHA for c1484a6
### Commits on Jan 9, 2025

* #### [tests: Reckless test fix for project must contain name](/ElementsProject/lightning/commit/219623c8d7fd3ffeb0a45ae3653f46f74522313f "tests: Reckless test fix for project must contain name Fix for `The Poetry configuration is invalid: - project must contain ['name'] properties`")

  Show description for 219623c ![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)![cdecker](https://avatars.githubusercontent.com/u/120117?v=4&size=32)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)authored and[cdecker](/ElementsProject/lightning/commits?author=cdecker)committed[219623c](/ElementsProject/lightning/commit/219623c8d7fd3ffeb0a45ae3653f46f74522313f)Copy full SHA for 219623c
* #### [ci: Install poetry-plugin-export for poetry export command](/ElementsProject/lightning/commit/740b7125deabf0b585a3ce38dcd3d523d9d9760f "ci: Install poetry-plugin-export for poetry export command Poetry will no longer include the `poetry-plugin-export` plugin by default, which is essential for exporting dependencies. So, we now need to install it explicitly.")

  Show description for 740b712 ![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)![cdecker](https://avatars.githubusercontent.com/u/120117?v=4&size=32)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)authored and[cdecker](/ElementsProject/lightning/commits?author=cdecker)committed[740b712](/ElementsProject/lightning/commit/740b7125deabf0b585a3ce38dcd3d523d9d9760f)Copy full SHA for 740b712
* #### [ci: Lock MacOS and poetry versions](/ElementsProject/lightning/commit/127ceb6ddb4ac6d687ce0857eaac8764b393d219 "ci: Lock MacOS and poetry versions")

   ![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)![cdecker](https://avatars.githubusercontent.com/u/120117?v=4&size=32)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)authored and[cdecker](/ElementsProject/lightning/commits?author=cdecker)committed[127ceb6](/ElementsProject/lightning/commit/127ceb6ddb4ac6d687ce0857eaac8764b393d219)Copy full SHA for 127ceb6
* #### [ci: Lock Ubuntu version on 22.04](/ElementsProject/lightning/commit/9c34bd61080dab2595bde9a59008b8b6a3036195 "ci: Lock Ubuntu version on 22.04 These workflows are failing due to `ubuntu-latest` being updated from version `22.04` to `24.04`. Reference: https://github.com/actions/runner-images/issues/10636 Changelog-None.")

  Show description for 9c34bd6 ![ShahanaFarooqui](https://avatars.githubusercontent.com/u/23240721?v=4&size=32)![cdecker](https://avatars.githubusercontent.com/u/120117?v=4&size=32)[ShahanaFarooqui](/ElementsProject/lightning/commits?author=ShahanaFarooqui)authored and[cdecker](/ElementsProject/lightning/commits?author=cdecker)committed[9c34bd6](/ElementsProject/lightning/commit/9c34bd61080dab2595bde9a59008b8b6a3036195)Copy full SHA for 9c34bd6
### Commits on Dec 20, 2024

* #### [pytest: fix flake in test\_restorefrompeer.](/ElementsProject/lightning/commit/98679aa6cffe2733bc1d840d541ff779368d7a87 "pytest: fix flake in test_restorefrompeer. Just because we've seen the block doesn't mean onchaind has finished starting up. ``` _____________________________ test_restorefrompeer _____________________________ [gw0] linux -- Python 3.10.15 /home/runner/.cache/pypoetry/virtualenvs/cln-meta-project-AqJ9wMix-py3.10/bin/python node_factory = <pyln.testing.utils.NodeFactory object at 0x7fb8f3887f70> bitcoind = <pyln.testing.utils.BitcoinD object at 0x7fb8f3886f50> @unittest.skipIf(os.getenv('TEST_DB_PROVIDER', 'sqlite3') != 'sqlite3', \"deletes database, which is assumed sqlite3\") def test_restorefrompeer(node_factory, bitcoind): \"\"\" Test restorefrompeer \"\"\" l1, l2 = node_factory.get_nodes(2, [{'broken_log': 'ERROR: Unknown commitment #.*, recovering our funds!', 'experimental-peer-storage': None, 'may_reconnect': True, 'allow_bad_gossip': True}, {'experimental-peer-storage': None, 'may_reconnect': True}]) l1.rpc.connect(l2.info['id'], 'localhost', l2.port) c12, _ = l1.fundchannel(l2, 10**5) assert l1.daemon.is_in_log('Peer storage sent!') assert l2.daemon.is_in_log('Peer storage sent!') l1.stop() os.unlink(os.path.join(l1.daemon.lightning_dir, TEST_NETWORK, \"lightningd.sqlite3\")) l1.start() assert l1.daemon.is_in_log('Server started with public key') # If this happens fast enough, connect fails with \"disconnected # during connection\" try: l1.rpc.connect(l2.info['id'], 'localhost', l2.port) except RpcError as err: assert \"disconnected during connection\" in err.error['message'] l1.daemon.wait_for_log('peer_in WIRE_YOUR_PEER_STORAGE') assert l1.rpc.restorefrompeer()['stubs'][0] == _['channel_id'] l1.daemon.wait_for_log('peer_out WIRE_ERROR') l2.daemon.wait_for_log('State changed from CHANNELD_NORMAL to AWAITING_UNILATERAL') bitcoind.generate_block(5, wait_for_mempool=1) sync_blockheight(bitcoind, [l1, l2]) l1.daemon.wait_for_log(r'All outputs resolved.*') wait_for(lambda: l1.rpc.listfunds()[\"channels\"][0][\"state\"] == \"ONCHAIN\") # Check if funds are recovered. assert l1.rpc.listfunds()[\"channels\"][0][\"state\"] == \"ONCHAIN\" > assert l2.rpc.listfunds()[\"channels\"][0][\"state\"] == \"ONCHAIN\" E AssertionError: assert 'FUNDING_SPEND_SEEN' == 'ONCHAIN' E - ONCHAIN E + FUNDING_SPEND_SEEN tests/test_misc.py:3044: AssertionError ``` Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 98679aa[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[98679aa](/ElementsProject/lightning/commit/98679aa6cffe2733bc1d840d541ff779368d7a87)Copy full SHA for 98679aa
* #### [pytest: fix flake in test\_penalty\_htlc\_tx\_fulfill](/ElementsProject/lightning/commit/9758b05bd0135a51bbf943d2ecf8b76ba1ced697 "pytest: fix flake in test_penalty_htlc_tx_fulfill Make sure balancing payment is fully cleared before trying to get a routeL ``` def test_penalty_htlc_tx_fulfill(node_factory, bitcoind, chainparams, anchors): # now we send one 'sticky' htlc: l4->l1 amt = 10**8 // 2 sticky_inv = l1.rpc.invoice(amt, '2', 'sticky') > route = l4.rpc.getroute(l1.info['id'], amt, 1)['route'] tests/test_closing.py:1232: > raise RpcError(method, payload, resp['error']) E pyln.client.lightning.RpcError: RPC call failed: method: getroute, payload: {'id': '0266e4598d1d3c415f572a8488830b60f7e744ed9235eb0b1ba93283b315c03518', 'amount_msat': 50000000, 'riskfactor': 1, 'cltv': 9}, error: {'code': 205, 'message': 'Could not find a route'} ```")

  Show description for 9758b05[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[9758b05](/ElementsProject/lightning/commit/9758b05bd0135a51bbf943d2ecf8b76ba1ced697)Copy full SHA for 9758b05
* #### [channeld\_fakenet: don't be as brute-force trying to derive keys.](/ElementsProject/lightning/commit/69bfa6f5b1b9aa7b4dbe1a9a6c3e832c8ebda8b4 "channeld_fakenet: don't be as brute-force trying to derive keys. Keep a proper cache of all possible ones. I think this may be the timeout problem: according to the logs, channeld_fakenet stops responding and thus HTLCs eventually time out. ``` ``` 2024-12-16T23:16:16.4874420Z lightningd-1 2024-12-16T22:45:14.068Z UNUSUAL 022d223620a359a47ff7f7ac447c85c46c923da53389221a0054c11c1e3ca31d59-channeld-chan#1: Adding HTLC 18446744073709551615 too slow: killing connection ``` Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 69bfa6f[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[69bfa6f](/ElementsProject/lightning/commit/69bfa6f5b1b9aa7b4dbe1a9a6c3e832c8ebda8b4)Copy full SHA for 69bfa6f
* #### [pytest: fix flake in test\_gossip\_throttle](/ElementsProject/lightning/commit/4b283eb96e92a4b47c9f55cb490a7bf0c225aa7b "pytest: fix flake in test_gossip_throttle We can get the reply_short_channel_ids_end in the messages when we make a query: ``` 2024-11-29T07:39:28.8550652Z time_fast = time.time() - start_fast 2024-11-29T07:39:28.8551067Z assert time_fast < 2 2024-11-29T07:39:28.8551487Z out3 = [m for m in out3 if not m.startswith(b'0109')] 2024-11-29T07:39:28.8552158Z > assert set(out1) == set(out3) ... 2024-11-29T07:39:28.8675516Z E Extra items in the right set: 2024-11-29T07:39:28.8675887Z E b'010606226e46111a0b59caaf126043eb5bbf28c34f3a5e332a1fc7b2b73cf188910f01' ``` Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 4b283eb[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[4b283eb](/ElementsProject/lightning/commit/4b283eb96e92a4b47c9f55cb490a7bf0c225aa7b)Copy full SHA for 4b283eb
* #### [pytest: fix test in test\_gossip\_pruning](/ElementsProject/lightning/commit/3a0e3a159123708a164d301e56b4ae6cf0fd7d58 "pytest: fix test in test_gossip_pruning It's possible that listchannels doesn't show the channel yet: ``` l1.rpc.connect(l2.info['id'], 'localhost', l2.port) l2.rpc.connect(l3.info['id'], 'localhost', l3.port) scid1, _ = l1.fundchannel(l2, 10**6) scid2, _ = l2.fundchannel(l3, 10**6) mine_funding_to_announce(bitcoind, [l1, l2, l3]) > l1_initial_cupdate_timestamp = only_one(l1.rpc.listchannels(source=l1.info['id'])['channels'])['last_update'] tests/test_gossip.py:43: _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ arr = [] def only_one(arr): \"\"\"Many JSON RPC calls return an array; often we only expect a single entry \"\"\" > assert len(arr) == 1 E AssertionError ``` Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 3a0e3a1[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[3a0e3a1](/ElementsProject/lightning/commit/3a0e3a159123708a164d301e56b4ae6cf0fd7d58)Copy full SHA for 3a0e3a1
* #### [lightningd: fix overzealous memleak detection in json\_add\_datastore.](/ElementsProject/lightning/commit/e998a72ef6d40508c613900c1bce3f997af5b573 "lightningd: fix overzealous memleak detection in json_add_datastore. The lifetime is bound to the response, but memleak gets upset if it sees it. Use the standard take() pattern insteas. ``` lightningd-5 2024-11-28T05:02:27.503Z **BROKEN** lightningd: MEMLEAK: 0x55b58f329338 lightningd-5 2024-11-28T05:02:27.503Z **BROKEN** lightningd: label=common/utils.c:150:char[] lightningd-5 2024-11-28T05:02:27.504Z **BROKEN** lightningd: alloc: lightningd-5 2024-11-28T05:02:27.585Z **BROKEN** lightningd: ccan/ccan/tal/tal.c:488 (tal_alloc_) lightningd-5 2024-11-28T05:02:27.586Z **BROKEN** lightningd: ccan/ccan/tal/tal.c:517 (tal_alloc_arr_) lightningd-5 2024-11-28T05:02:27.586Z **BROKEN** lightningd: ccan/ccan/tal/tal.c:861 (tal_dup_) lightningd-5 2024-11-28T05:02:27.586Z **BROKEN** lightningd: common/utils.c:150 (utf8_str) lightningd-5 2024-11-28T05:02:27.589Z **BROKEN** lightningd: lightningd/datastore.c:23 (json_add_datastore) lightningd-5 2024-11-28T05:02:27.589Z **BROKEN** lightningd: lightningd/datastore.c:205 (json_datastore) lightningd-5 2024-11-28T05:02:27.590Z **BROKEN** lightningd: lightningd/jsonrpc.c:808 (command_exec) lightningd-5 2024-11-28T05:02:27.590Z **BROKEN** lightningd: lightningd/jsonrpc.c:954 (rpc_command_hook_final) lightningd-5 2024-11-28T05:02:27.590Z **BROKEN** lightningd: lightningd/plugin_hook.c:196 (plugin_hook_call_next) lightningd-5 2024-11-28T05:02:27.591Z **BROKEN** lightningd: lightningd/plugin_hook.c:183 (plugin_hook_callback) lightningd-5 2024-11-28T05:02:27.593Z **BROKEN** lightningd: lightningd/plugin.c:663 (plugin_response_handle) lightningd-5 2024-11-28T05:02:27.593Z **BROKEN** lightningd: lightningd/plugin.c:775 (plugin_read_json_one) ``` Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for e998a72[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[e998a72](/ElementsProject/lightning/commit/e998a72ef6d40508c613900c1bce3f997af5b573)Copy full SHA for e998a72
* #### [CI: disable --force-flaky.](/ElementsProject/lightning/commit/5c53ed73fbfb521a17d6bf129ac4390de16d8fc1 "CI: disable --force-flaky. This should help us fix the flakes. Dealing with them was a major headache at the end of the last release (and they covered up real bugs!). Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 5c53ed7[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[5c53ed7](/ElementsProject/lightning/commit/5c53ed73fbfb521a17d6bf129ac4390de16d8fc1)Copy full SHA for 5c53ed7
### Commits on Dec 19, 2024

* #### [Changelog: update to match 24.11.1 branch now that's released.](/ElementsProject/lightning/commit/fa103238479afe5e984674d15175a867572bb4dd "Changelog: update to match 24.11.1 branch now that's released. Changelog-None: changelog updated. Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for fa10323[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[fa10323](/ElementsProject/lightning/commit/fa103238479afe5e984674d15175a867572bb4dd)Copy full SHA for fa10323
### Commits on Dec 18, 2024

* #### [pytest: actually test xpay/pay return similarity.](/ElementsProject/lightning/commit/2c8d9d0deb06c8beded4da126d8d30a0ce6910cf "pytest: actually test xpay/pay return similarity. Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 2c8d9d0[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[2c8d9d0](/ElementsProject/lightning/commit/2c8d9d0deb06c8beded4da126d8d30a0ce6910cf)Copy full SHA for 2c8d9d0
* #### [xpay: created\_at response from pay compatibility is a number, not integer.](/ElementsProject/lightning/commit/d7adf06dfef454104a963b3d41664811bfb0db45 "xpay: created_at response from pay compatibility is a number, not integer. Reported-by: @hMsats Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for d7adf06[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[d7adf06](/ElementsProject/lightning/commit/d7adf06dfef454104a963b3d41664811bfb0db45)Copy full SHA for d7adf06
* #### [xpay: simplify printing of destination.](/ElementsProject/lightning/commit/3e9a4fc75019f8e92d1465273232bb1846889e0a "xpay: simplify printing of destination. Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 3e9a4fc[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[3e9a4fc](/ElementsProject/lightning/commit/3e9a4fc75019f8e92d1465273232bb1846889e0a)Copy full SHA for 3e9a4fc
* #### [xpay: add destination to output](/ElementsProject/lightning/commit/545220dfbcae6f46c3be36be34ccff3850f3bf59 "xpay: add destination to output Changelog-Add: xpay: add destination to xpay success output when xpay-handle-pay is active. Signed-off-by: Lagrang3 <lagrang3@protonmail.com>")

  Show description for 545220d ![Lagrang3](https://avatars.githubusercontent.com/u/32647090?v=4&size=32)![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)[Lagrang3](/ElementsProject/lightning/commits?author=Lagrang3)authored and[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[545220d](/ElementsProject/lightning/commit/545220dfbcae6f46c3be36be34ccff3850f3bf59)Copy full SHA for 545220d
### Commits on Dec 17, 2024

* #### [pytest: bonus test to make sure xpay uses zeroconf channels correctly.](/ElementsProject/lightning/commit/84f30b12f789937f0b0653892f5ba6ca3480aca8 "pytest: bonus test to make sure xpay uses zeroconf channels correctly. It needs to use the channel alias here, and it does. Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>")

  Show description for 84f30b1[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[84f30b1](/ElementsProject/lightning/commit/84f30b12f789937f0b0653892f5ba6ca3480aca8)Copy full SHA for 84f30b1
* #### [lightningd: injectpaymentonion can use scids of unannounced channels.](/ElementsProject/lightning/commit/a2f58a28babb0d36d38dabbc88d7422c3dbcd8bc "lightningd: injectpaymentonion can use scids of unannounced channels. Cut & paste from the forwarding code, where we don't let onions use the unannounced scids. Obviously local commands can use them. Reported-by: @michael1011 Changelog-Fixed: JSON-RPC: xpay now works through unannounced channels.")

  Show description for a2f58a2[![rustyrussell](https://avatars.githubusercontent.com/u/775844?v=4&size=32)](/rustyrussell)[rustyrussell](/ElementsProject/lightning/commits?author=rustyrussell)committed[a2f58a2](/ElementsProject/lightning/commit/a2f58a28babb0d36d38dabbc88d7422c3dbcd8bc)Copy full SHA for a2f58a2
## Pagination

[Previous](/ElementsProject/lightning/commits/master?before=b6c1ffa359936166162a59a7d16c4f5c7534454b+0)[Next](/ElementsProject/lightning/commits/master?after=b6c1ffa359936166162a59a7d16c4f5c7534454b+34)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


