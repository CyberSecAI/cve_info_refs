=== Content from lists.linuxfoundation.org_0ff59e80_20250121_010710.html ===
From rusty at rustcorp.com.au Fri Sep 27 12:01:46 2019
From: rusty at rustcorp.com.au (Rusty Russell)
Date: Fri, 27 Sep 2019 21:31:46 +0930
Subject: [Lightning-dev] Full Disclosure: CVE-2019-12998 / CVE-2019-12999 /
CVE-2019-13000
Message-ID: <87mueq6j85.fsf@rustcorp.com.au>
Problem
-------
A lightning node accepting a channel must check that the funding transaction
output does indeed open the channel proposed. Otherwise an attacker can claim
to open a channel but either not pay to the peer, or not pay the full amount.
Once that transaction reaches the minimum depth, it can spend funds from the
channel. The victim will only notice when it tries to close the channel and none
of the commitment or mutual close transactions it has are valid.
Implementations did not always do this check:
c-lightning: v0.7.1 and above do this correctly, prior versions never did.
(CVE-2019-12998)
- This can be exploited by a connecting peer and claiming to open a channel
with any transaction id.
lnd: v0.7.1 and above do this correctly, prior versions did not check the
amount. v0.7.0 and above properly check for the scriptpubkey, v0.6.x
partially enforces the funding scriptpubkey, but pre-v0.6.0 did not verify
at all. (CVE-2019-12999)
- Exploiting via incorrect amount is possible against all prior versions. In
v0.7.0, the attacker must use the correct scriptpubkey, which burns the
coins in the funding output.
- Exploiting via incorrect scriptpubkey is possible on all versions prior to
v0.6.0. This exploit is also possible in v0.6.x if the node is offline
when the funding transaction reached the required number of confirmations
and running with -txindex=0 on either full node backend.
- Exploiting neutrino users (usually mobile or laptop) with an incorrect
outpoint would require the attacker to collide their fake outpoint with
the script of the real outpoint in the BIP 158 filter. The siphash key
used to create the filters is derived from the blockhash. As a result, the
attacker cannot directly grind outpoints without also knowing the block
hash ahead of time. In addition, neutrino nodes are typically either
non-listening or do not have an advertised address, which means an
attacker would have to wait until receiving an inbound connection to
perform either exploit.
eclair: v0.3.1 and above do this correctly, prior versions did not if using
the bitcoin core backend; electrum users only check the script, not the
amount. (CVE-2019-13000)
- Exploiting Electrum users (on mobile) requires the user to actively
connect to a malicious Lightning node, and the attacker to use the correct
scriptpubkey, which burns the coins in the funding output. Since Eclair
Mobile doesn?t relay payments, the attacker can?t cash out without an
offband interaction (e.g. selling something to the user and paying with
the funds in the fake channel).
Solution
--------
Once the funding transaction is seen, peers MUST check that the outpoint as
described in `funding\_created`[1] is a funding transaction output[2] with
the amount described in `open\_channel`[3].
Background
----------
To open a channel, the funding peer sends `open\_channel` with the proposed
`funding\_satoshis`. The fundee replies with `accept\_channel` providing the
keys it wants to use for the funding transaction.
Then the funder creates the funding transaction, and sends the transaction id
and output number in a `funding\_created` message.
```
+-------+ +-------+
| |--(1)--- open\_channel ----->| |
| |<-(2)-- accept\_channel -----| |
| | | |
| A |--(3)-- funding\_created --->| B |
| |<-(4)-- funding\_signed -----| |
| | | |
| |--(5)--- funding\_locked ---->| |
| |<-(6)--- funding\_locked -----| |
+-------+ +-------+
- where node A is 'funder' and node B is 'fundee'
```
With this information, the fundee can create the signatures on the first
"commitment transaction" and sends it in a `funding\_signed` message so the
funder can retrieve their funds should something go wrong. It is then safe
for the funder to sign and broadcast the opening transaction. After some
number of confirmations (set by the fundee), the channel is operational
(`funding\_locked`).
The specification describes clearly the requirement to check that the various
signatures exchanged indeed allow creation of a valid commitment transaction[4],
and describes the requirement to wait for confirmations[5].
It did NOT, however, require the receiver to actually check that the
transaction is the one promised by the funder: both the amount and the actual
scriptpubkey.
Discovery
---------
Rusty Russell (Blockstream) discovered this while working on protocol
tests for the specification itself, as part of an ongoing effort to
test multiple new proposed features add new complexities.[6]
The discovery occurred while writing tests for channel opening
negotiation, in particular that invalid variants were rejected; while
writing a test where the opener supplied an incorrect
`funding\_output\_index` in the `funding\_created` message, he realized
that it would not be rejected by the c-lightning implementation, which
only checked the confirmation count of the `funding\_txid`, and not
even whether the `funding\_output\_index` even existed!
This requirement was not mentioned in the specification, so Rusty
immediately disclosed the problem the authors of the other most widely
used implementations (eclair and lnd). Their own investigations
revealed that they were similarly vulnerable in limited circumstances.
Together the teams made the decision to fix this quietly for pending
releases, then reveal the existence of a problem 8 weeks later, once
most users had already upgraded. Four weeks after that, the full
disclosure would be made.
While this long-standing bug had not been independently discovered, and thus
was unlikely to be discovered by a malicious party before being fixed, it did
provide an opportunity to test communications and methods of upgrade across
the entire lightning ecosystem.
Timeline
--------
2019-06-27: Bug discovered, LND and Eclair notified.
2019-06-28: CVEs assigned.
2019-07-02: lnd v0.7.0-beta released.
2019-07-03: Eclair 0.3.1 released.
2019-07-04: c-lightning 0.7.1 released.
2019-07-06: disclosure to other projects begins (rust-lightning, ptarmigan, BLW).
2019-07-30: lnd v0.7.1-beta released.
2019-08-17: [Review next dates based on deployment stats/problems]
2019-08-30: Reveal existence of CVEs, encourage laggards to upgrade.
2019-09-07: First conclusive evidence of exploit attempt in the wild.
2019-09-27: Full disclosure of CVEs.
2019-09-27: Submit PR to spec to require this.
[1] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#the-funding\_created-message
[2] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/03-transactions.md#funding-transaction-output
[3] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#the-open\_channel-message
[4] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#requirements-2
[5] https://github.com/lightningnetwork/lightning-rfc/blob/v1.0/02-peer-protocol.md#the-funding\_locked-message
[6] https://github.com/ElementsProject/lightning-rfc-protocol-test


=== Content from github.com_3fd7c98f_20250121_010706.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FACINQ%2Feclair%2Fcommits%2Fmaster)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FACINQ%2Feclair%2Fcommits%2Fmaster)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommits%2Fshow&source=header-repo&source_repo=ACINQ%2Feclair)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ACINQ](/ACINQ)
/
**[eclair](/ACINQ/eclair)**
Public

* [Notifications](/login?return_to=%2FACINQ%2Feclair) You must be signed in to change notification settings
* [Fork
  267](/login?return_to=%2FACINQ%2Feclair)
* [Star
   1.3k](/login?return_to=%2FACINQ%2Feclair)

* [Code](/ACINQ/eclair)
* [Issues
  19](/ACINQ/eclair/issues)
* [Pull requests
  32](/ACINQ/eclair/pulls)
* [Discussions](/ACINQ/eclair/discussions)
* [Actions](/ACINQ/eclair/actions)
* [Projects
  0](/ACINQ/eclair/projects)
* [Security](/ACINQ/eclair/security)
* [Insights](/ACINQ/eclair/pulse)

Additional navigation options

* [Code](/ACINQ/eclair)
* [Issues](/ACINQ/eclair/issues)
* [Pull requests](/ACINQ/eclair/pulls)
* [Discussions](/ACINQ/eclair/discussions)
* [Actions](/ACINQ/eclair/actions)
* [Projects](/ACINQ/eclair/projects)
* [Security](/ACINQ/eclair/security)
* [Insights](/ACINQ/eclair/pulse)

# Commits

## Branch selector

 master
## User selector

All users
## Datepicker

All time
## Commit History

### Commits on Jan 16, 2025

* #### [Get rid of various unnecessary warnings in logs (](/ACINQ/eclair/commit/1c38591d0bb3bc8564a293a78538a06e2595b7bd "Get rid of various unnecessary warnings in logs (#2981) * Watch explicit event for channel actor termination We use an explicit event in the `Peer` when watching for child channel actors being terminated. This should get rid of the warnings in the logs about the `Terminated` event not being handled, or at least provide us more hints of which actors aren't properly being tracked. * Fix disconnect response in channel actors We weren't watching for the right event, which creates a lot of log lines saying that the `Disconnecting` event is unhandled. * Ignore closing negotiation if closing or closed If we receive an outdated closing message, we ignore it without creating a warning in the logs. * Ignore HTLC settlement commands while disconnected We ignore HTLC settlement commands while we're disconnected, they will be retried once the channel has been reestablished. We also ignore commands asking us to sign the latest state or update fees.")[#2981](https://github.com/ACINQ/eclair/pull/2981)[)](/ACINQ/eclair/commit/1c38591d0bb3bc8564a293a78538a06e2595b7bd "Get rid of various unnecessary warnings in logs (#2981) * Watch explicit event for channel actor termination We use an explicit event in the `Peer` when watching for child channel actors being terminated. This should get rid of the warnings in the logs about the `Terminated` event not being handled, or at least provide us more hints of which actors aren't properly being tracked. * Fix disconnect response in channel actors We weren't watching for the right event, which creates a lot of log lines saying that the `Disconnecting` event is unhandled. * Ignore closing negotiation if closing or closed If we receive an outdated closing message, we ignore it without creating a warning in the logs. * Ignore HTLC settlement commands while disconnected We ignore HTLC settlement commands while we're disconnected, they will be retried once the channel has been reestablished. We also ignore commands asking us to sign the latest state or update fees.")

  Show description for 1c38591[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[1c38591](/ACINQ/eclair/commit/1c38591d0bb3bc8564a293a78538a06e2595b7bd)Copy full SHA for 1c38591
### Commits on Jan 15, 2025

* #### [Get ready for storing partial commit signatures (](/ACINQ/eclair/commit/8827a043491014d160aae6b5e86cf5c1578090a7 "Get ready for storing partial commit signatures (#2896) * Get ready to store partial signatures We currently store our peer's signature for our remote commit tx, so we can publish it if needed. If we upgrade funding tx to use musig2 instead of multisig 2-of-2 we will need to store a partial signature instead. For this, we add specific types for standard signature (64 bytes) and musig2 partial signatures + nonce.")[#2896](https://github.com/ACINQ/eclair/pull/2896)[)](/ACINQ/eclair/commit/8827a043491014d160aae6b5e86cf5c1578090a7 "Get ready for storing partial commit signatures (#2896) * Get ready to store partial signatures We currently store our peer's signature for our remote commit tx, so we can publish it if needed. If we upgrade funding tx to use musig2 instead of multisig 2-of-2 we will need to store a partial signature instead. For this, we add specific types for standard signature (64 bytes) and musig2 partial signatures + nonce.")

  Show description for 8827a04[![sstone](https://avatars.githubusercontent.com/u/1573866?v=4&size=32)](/sstone)[sstone](/ACINQ/eclair/commits?author=sstone)authored[8827a04](/ACINQ/eclair/commit/8827a043491014d160aae6b5e86cf5c1578090a7)Copy full SHA for 8827a04
* #### [Increase](/ACINQ/eclair/commit/96183a93aa6090c18384db00ea7aea90658494d0 "Increase `min-depth` for funding transactions (#2973) We already use a minimum depth of 6 before announcing channels to protect against reorgs. However, we allowed using the channel for payments after only 3 confirmations (for small channels). A reorg of 3 blocks that invalidates the funding transaction would allow our peer to potentially steal funds. It's more consistent to use the same depth for announcing the channel and actually using it. Note that for wumbo channels, we already scaled the number of confirmations based on the size of the channel. For closing transaction, we don't need the same reorg safety, since we keep watching the funding output for any transaction that spends it, and concurrently spend any commitment transaction that we detect. We thus keep a minimum depth of 3 for closing transactions. We also update our confirmation scaling factor post-halving. We were still using values from before the halving. We update those values and change the scaling factor to a reasonable scaling. This protects channels against attackers with significant mining power.") `[min-depth](/ACINQ/eclair/commit/96183a93aa6090c18384db00ea7aea90658494d0 "Increase `min-depth` for funding transactions (#2973) We already use a minimum depth of 6 before announcing channels to protect against reorgs. However, we allowed using the channel for payments after only 3 confirmations (for small channels). A reorg of 3 blocks that invalidates the funding transaction would allow our peer to potentially steal funds. It's more consistent to use the same depth for announcing the channel and actually using it. Note that for wumbo channels, we already scaled the number of confirmations based on the size of the channel. For closing transaction, we don't need the same reorg safety, since we keep watching the funding output for any transaction that spends it, and concurrently spend any commitment transaction that we detect. We thus keep a minimum depth of 3 for closing transactions. We also update our confirmation scaling factor post-halving. We were still using values from before the halving. We update those values and change the scaling factor to a reasonable scaling. This protects channels against attackers with significant mining power.")` [for funding transactions (](/ACINQ/eclair/commit/96183a93aa6090c18384db00ea7aea90658494d0 "Increase `min-depth` for funding transactions (#2973) We already use a minimum depth of 6 before announcing channels to protect against reorgs. However, we allowed using the channel for payments after only 3 confirmations (for small channels). A reorg of 3 blocks that invalidates the funding transaction would allow our peer to potentially steal funds. It's more consistent to use the same depth for announcing the channel and actually using it. Note that for wumbo channels, we already scaled the number of confirmations based on the size of the channel. For closing transaction, we don't need the same reorg safety, since we keep watching the funding output for any transaction that spends it, and concurrently spend any commitment transaction that we detect. We thus keep a minimum depth of 3 for closing transactions. We also update our confirmation scaling factor post-halving. We were still using values from before the halving. We update those values and change the scaling factor to a reasonable scaling. This protects channels against attackers with significant mining power.")[#2973](https://github.com/ACINQ/eclair/pull/2973)[)](/ACINQ/eclair/commit/96183a93aa6090c18384db00ea7aea90658494d0 "Increase `min-depth` for funding transactions (#2973) We already use a minimum depth of 6 before announcing channels to protect against reorgs. However, we allowed using the channel for payments after only 3 confirmations (for small channels). A reorg of 3 blocks that invalidates the funding transaction would allow our peer to potentially steal funds. It's more consistent to use the same depth for announcing the channel and actually using it. Note that for wumbo channels, we already scaled the number of confirmations based on the size of the channel. For closing transaction, we don't need the same reorg safety, since we keep watching the funding output for any transaction that spends it, and concurrently spend any commitment transaction that we detect. We thus keep a minimum depth of 3 for closing transactions. We also update our confirmation scaling factor post-halving. We were still using values from before the halving. We update those values and change the scaling factor to a reasonable scaling. This protects channels against attackers with significant mining power.")

  Show description for 96183a9[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[96183a9](/ACINQ/eclair/commit/96183a93aa6090c18384db00ea7aea90658494d0)Copy full SHA for 96183a9
### Commits on Jan 9, 2025

* #### [Reestablish partially signed splice with current](/ACINQ/eclair/commit/ef1a029dff5025f29e2b2e26c477638fd0d851eb "Reestablish partially signed splice with current `remote_commitment_number` (#2965) As pointed out in https://github.com/lightning/bolts/pull/1214, when reconnecting a partially signed `interactive-tx` session, we should set `next_commitment_number` to the current commitment number if we haven't received our peer's `commit_sig`, which tells them they need to retransmit it. That's not what we're currently doing: we're currently setting this value to the next commitment number, regardless of whether or not we have received our peer's `commit_sig`. And we always retransmit our `commit_sig` if our peer is setting `next_funding_txid`, even if they have already received it. More importantly, if our peer behaves correctly and sends us the current commitment number, we will think that they're late and will halt, waiting for them to send `error`. This commit fixes that by allowing our peers to use the current commitment number when they set `next_funding_txid`. Note that this doesn't yet make us spec-compliant, but in order to guarantee backwards-compatibility, we must first deploy that change before we can start removing spurious `commit_sig` retransmissions.") `[remote_commitment_number](/ACINQ/eclair/commit/ef1a029dff5025f29e2b2e26c477638fd0d851eb "Reestablish partially signed splice with current `remote_commitment_number` (#2965) As pointed out in https://github.com/lightning/bolts/pull/1214, when reconnecting a partially signed `interactive-tx` session, we should set `next_commitment_number` to the current commitment number if we haven't received our peer's `commit_sig`, which tells them they need to retransmit it. That's not what we're currently doing: we're currently setting this value to the next commitment number, regardless of whether or not we have received our peer's `commit_sig`. And we always retransmit our `commit_sig` if our peer is setting `next_funding_txid`, even if they have already received it. More importantly, if our peer behaves correctly and sends us the current commitment number, we will think that they're late and will halt, waiting for them to send `error`. This commit fixes that by allowing our peers to use the current commitment number when they set `next_funding_txid`. Note that this doesn't yet make us spec-compliant, but in order to guarantee backwards-compatibility, we must first deploy that change before we can start removing spurious `commit_sig` retransmissions.")` [(](/ACINQ/eclair/commit/ef1a029dff5025f29e2b2e26c477638fd0d851eb "Reestablish partially signed splice with current `remote_commitment_number` (#2965) As pointed out in https://github.com/lightning/bolts/pull/1214, when reconnecting a partially signed `interactive-tx` session, we should set `next_commitment_number` to the current commitment number if we haven't received our peer's `commit_sig`, which tells them they need to retransmit it. That's not what we're currently doing: we're currently setting this value to the next commitment number, regardless of whether or not we have received our peer's `commit_sig`. And we always retransmit our `commit_sig` if our peer is setting `next_funding_txid`, even if they have already received it. More importantly, if our peer behaves correctly and sends us the current commitment number, we will think that they're late and will halt, waiting for them to send `error`. This commit fixes that by allowing our peers to use the current commitment number when they set `next_funding_txid`. Note that this doesn't yet make us spec-compliant, but in order to guarantee backwards-compatibility, we must first deploy that change before we can start removing spurious `commit_sig` retransmissions.")[#2965](https://github.com/ACINQ/eclair/pull/2965)[)](/ACINQ/eclair/commit/ef1a029dff5025f29e2b2e26c477638fd0d851eb "Reestablish partially signed splice with current `remote_commitment_number` (#2965) As pointed out in https://github.com/lightning/bolts/pull/1214, when reconnecting a partially signed `interactive-tx` session, we should set `next_commitment_number` to the current commitment number if we haven't received our peer's `commit_sig`, which tells them they need to retransmit it. That's not what we're currently doing: we're currently setting this value to the next commitment number, regardless of whether or not we have received our peer's `commit_sig`. And we always retransmit our `commit_sig` if our peer is setting `next_funding_txid`, even if they have already received it. More importantly, if our peer behaves correctly and sends us the current commitment number, we will think that they're late and will halt, waiting for them to send `error`. This commit fixes that by allowing our peers to use the current commitment number when they set `next_funding_txid`. Note that this doesn't yet make us spec-compliant, but in order to guarantee backwards-compatibility, we must first deploy that change before we can start removing spurious `commit_sig` retransmissions.")

  Show description for ef1a029[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[ef1a029](/ACINQ/eclair/commit/ef1a029dff5025f29e2b2e26c477638fd0d851eb)Copy full SHA for ef1a029
### Commits on Jan 8, 2025

* #### [Add support for taproot outputs to our "input info" class (](/ACINQ/eclair/commit/db93cbeda6eb43f7cd7614d86a0f41b07d99d253 "Add support for taproot outputs to our \"input info\" class (#2895) * Refactor tx signing (no functional changes) * Upgrade input info class to allow spending from taproot transactions Our InputInfo class contains a tx output and the matching redeem script, which is enough to spend segwit v0 transactions. For taproot transactions, instead of a redeem script, we need a script tree instead, and the appropriate internal pubkey. * Use specific segwit and taproot input info types We now use specific subtypes for segwit inputs (which include a redeem script) and taproot inputs (which include a script tree and an internal key). Older codecs have been modified to always return a SegwitInput. v4 codec is modified and uses an empty redeem script as a marker to specify that a script tree is being used, which makes it compatible with the current v4 codec. Current (v4) codecs only handle segwit inputs. Support for taproot inputs will be added to v5 codecs. --------- Co-authored-by: Pierre-Marie Padiou <pm47@users.noreply.github.com>")[#2895](https://github.com/ACINQ/eclair/pull/2895)[)](/ACINQ/eclair/commit/db93cbeda6eb43f7cd7614d86a0f41b07d99d253 "Add support for taproot outputs to our \"input info\" class (#2895) * Refactor tx signing (no functional changes) * Upgrade input info class to allow spending from taproot transactions Our InputInfo class contains a tx output and the matching redeem script, which is enough to spend segwit v0 transactions. For taproot transactions, instead of a redeem script, we need a script tree instead, and the appropriate internal pubkey. * Use specific segwit and taproot input info types We now use specific subtypes for segwit inputs (which include a redeem script) and taproot inputs (which include a script tree and an internal key). Older codecs have been modified to always return a SegwitInput. v4 codec is modified and uses an empty redeem script as a marker to specify that a script tree is being used, which makes it compatible with the current v4 codec. Current (v4) codecs only handle segwit inputs. Support for taproot inputs will be added to v5 codecs. --------- Co-authored-by: Pierre-Marie Padiou <pm47@users.noreply.github.com>")

  Show description for db93cbe ![sstone](https://avatars.githubusercontent.com/u/1573866?v=4&size=32)![pm47](https://avatars.githubusercontent.com/u/2028222?v=4&size=32)[sstone](/ACINQ/eclair/commits?author=sstone)and[pm47](/ACINQ/eclair/commits?author=pm47)authored[db93cbe](/ACINQ/eclair/commit/db93cbeda6eb43f7cd7614d86a0f41b07d99d253)Copy full SHA for db93cbe
* #### [Refactor route finding (](/ACINQ/eclair/commit/e99fa2e0a4d3900cc72cfa62d1ecb64b46ee52e3 "Refactor route finding (#2974) Refactor the route finding to share the same code for payment routes and onion message routes.")[#2974](https://github.com/ACINQ/eclair/pull/2974)[)](/ACINQ/eclair/commit/e99fa2e0a4d3900cc72cfa62d1ecb64b46ee52e3 "Refactor route finding (#2974) Refactor the route finding to share the same code for payment routes and onion message routes.")

  Show description for e99fa2e[![thomash-acinq](https://avatars.githubusercontent.com/u/81159533?v=4&size=32)](/thomash-acinq)[thomash-acinq](/ACINQ/eclair/commits?author=thomash-acinq)authored[e99fa2e](/ACINQ/eclair/commit/e99fa2e0a4d3900cc72cfa62d1ecb64b46ee52e3)Copy full SHA for e99fa2e
### Commits on Jan 7, 2025

* #### [Build against Java 21 (](/ACINQ/eclair/commit/a35a972081628de4647e8989bef91f4eb6380081 "Build against Java 21 (#2929) * Update kamon and kanela-agent Previous version was not compatible with JDK21, see https://github.com/kamon-io/kanela/issues/150. * Add and configure maven wrapper to use maven 3.9.9 This will make it easier to control which version of maven is used to build eclair, which in turns makes deterministic builds easier, as well as using recent compiler options (to target newer JDKs for example). For example, even recent versions of Github runner images use an old version of maven and there is no easy way to upgrade. * Update Dockerfile We now use multiarch (amd64/arm64) base images. * Run CI tests with JDK21 * Update doc to recommend Adoptium OpenJDK21 * Target Java 21 Eclair now targets Java 21 and will require a compatible Java Runtime Environment. It will no longer work on JRE 11 and JRE 17.")[#2929](https://github.com/ACINQ/eclair/pull/2929)[)](/ACINQ/eclair/commit/a35a972081628de4647e8989bef91f4eb6380081 "Build against Java 21 (#2929) * Update kamon and kanela-agent Previous version was not compatible with JDK21, see https://github.com/kamon-io/kanela/issues/150. * Add and configure maven wrapper to use maven 3.9.9 This will make it easier to control which version of maven is used to build eclair, which in turns makes deterministic builds easier, as well as using recent compiler options (to target newer JDKs for example). For example, even recent versions of Github runner images use an old version of maven and there is no easy way to upgrade. * Update Dockerfile We now use multiarch (amd64/arm64) base images. * Run CI tests with JDK21 * Update doc to recommend Adoptium OpenJDK21 * Target Java 21 Eclair now targets Java 21 and will require a compatible Java Runtime Environment. It will no longer work on JRE 11 and JRE 17.")

  Show description for a35a972[![sstone](https://avatars.githubusercontent.com/u/1573866?v=4&size=32)](/sstone)[sstone](/ACINQ/eclair/commits?author=sstone)authored[a35a972](/ACINQ/eclair/commit/a35a972081628de4647e8989bef91f4eb6380081)Copy full SHA for a35a972
### Commits on Dec 19, 2024

* #### `[OutgoingNodeId](/ACINQ/eclair/commit/27ba60f2416c47c6315139f0cb21894534cad890 "`OutgoingNodeId` in a blinded path may not be a wallet (#2970) `OutgoingNodeId` was assumed to be a wallet. While it probably shouldn't cause problems, it's better to keep both cases distinct.")` [in a blinded path may not be a wallet (](/ACINQ/eclair/commit/27ba60f2416c47c6315139f0cb21894534cad890 "`OutgoingNodeId` in a blinded path may not be a wallet (#2970) `OutgoingNodeId` was assumed to be a wallet. While it probably shouldn't cause problems, it's better to keep both cases distinct.")[#2970](https://github.com/ACINQ/eclair/pull/2970)[)](/ACINQ/eclair/commit/27ba60f2416c47c6315139f0cb21894534cad890 "`OutgoingNodeId` in a blinded path may not be a wallet (#2970) `OutgoingNodeId` was assumed to be a wallet. While it probably shouldn't cause problems, it's better to keep both cases distinct.")

  Show description for 27ba60f[![thomash-acinq](https://avatars.githubusercontent.com/u/81159533?v=4&size=32)](/thomash-acinq)[thomash-acinq](/ACINQ/eclair/commits?author=thomash-acinq)authored[27ba60f](/ACINQ/eclair/commit/27ba60f2416c47c6315139f0cb21894534cad890)Copy full SHA for 27ba60f
### Commits on Dec 13, 2024

* #### [Delay considering a channel closed when seeing an on-chain spend (](/ACINQ/eclair/commit/c390560aa1f670f6ad95a60fcb4f610ef12e4b0c "Delay considering a channel closed when seeing an on-chain spend (#2936) Fixes Issue #2437 When an external channel is spent, add it to the `spentChannels` list instead of immediately removing it from the graph. RBF attempts can produce multiple spending txs in the mempool for the same channel. The `spendChannels` list maps the txid of the spending tx to the scid of the spent channel. When a channel announcement is validated with a funding tx on the `spentChannels` list, consider the new channel a splice of the corresponding spent channel. A splice updates the graph edges to preserve balance estimate information in the graph. If a spending tx from the `spentChannels` list is deeply buried before appearing in a valid channel announcement, remove the corresponding spent channel from the graph. The integration test demonstrates that local channels update their capacity, but we can not test the remote node (carol) because the ChannelAnnouncements are ignored because it has a duplicate scid. After PR #2941 we can fix this test. --------- Co-authored-by: t-bast <bastien@acinq.fr>")[#2936](https://github.com/ACINQ/eclair/pull/2936)[)](/ACINQ/eclair/commit/c390560aa1f670f6ad95a60fcb4f610ef12e4b0c "Delay considering a channel closed when seeing an on-chain spend (#2936) Fixes Issue #2437 When an external channel is spent, add it to the `spentChannels` list instead of immediately removing it from the graph. RBF attempts can produce multiple spending txs in the mempool for the same channel. The `spendChannels` list maps the txid of the spending tx to the scid of the spent channel. When a channel announcement is validated with a funding tx on the `spentChannels` list, consider the new channel a splice of the corresponding spent channel. A splice updates the graph edges to preserve balance estimate information in the graph. If a spending tx from the `spentChannels` list is deeply buried before appearing in a valid channel announcement, remove the corresponding spent channel from the graph. The integration test demonstrates that local channels update their capacity, but we can not test the remote node (carol) because the ChannelAnnouncements are ignored because it has a duplicate scid. After PR #2941 we can fix this test. --------- Co-authored-by: t-bast <bastien@acinq.fr>")

  Show description for c390560 ![remyers](https://avatars.githubusercontent.com/u/8568892?v=4&size=32)![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)[remyers](/ACINQ/eclair/commits?author=remyers)and[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[c390560](/ACINQ/eclair/commit/c390560aa1f670f6ad95a60fcb4f610ef12e4b0c)Copy full SHA for c390560
### Commits on Dec 12, 2024

* #### [Add more splice RBF reconnection tests (](/ACINQ/eclair/commit/61af10ac71ec68cc65d215815f209575794a06ae "Add more splice RBF reconnection tests (#2964) We add more tests around disconnection in the middle of signing an RBF attempt, and verify more details of the `channel_reestablish` message sent on reconnection.")[#2964](https://github.com/ACINQ/eclair/pull/2964)[)](/ACINQ/eclair/commit/61af10ac71ec68cc65d215815f209575794a06ae "Add more splice RBF reconnection tests (#2964) We add more tests around disconnection in the middle of signing an RBF attempt, and verify more details of the `channel_reestablish` message sent on reconnection.")

  Show description for 61af10a[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[61af10a](/ACINQ/eclair/commit/61af10ac71ec68cc65d215815f209575794a06ae)Copy full SHA for 61af10a
### Commits on Dec 11, 2024

* #### [Peer storage (](/ACINQ/eclair/commit/e28f23fbc886a98e732c0016094d15a35697c373 "Peer storage (#2888) Implements https://github.com/lightning/bolts/pull/1110 to allow storing a small amount of data for our peers. --------- Co-authored-by: t-bast <bastien@acinq.fr>")[#2888](https://github.com/ACINQ/eclair/pull/2888)[)](/ACINQ/eclair/commit/e28f23fbc886a98e732c0016094d15a35697c373 "Peer storage (#2888) Implements https://github.com/lightning/bolts/pull/1110 to allow storing a small amount of data for our peers. --------- Co-authored-by: t-bast <bastien@acinq.fr>")

  Show description for e28f23f ![thomash-acinq](https://avatars.githubusercontent.com/u/81159533?v=4&size=32)![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)[thomash-acinq](/ACINQ/eclair/commits?author=thomash-acinq)and[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[e28f23f](/ACINQ/eclair/commit/e28f23fbc886a98e732c0016094d15a35697c373)Copy full SHA for e28f23f
### Commits on Dec 9, 2024

* #### [Remove obsolete](/ACINQ/eclair/commit/189e28299373b2aada6f51efe3e0b901bfb3cea3 "Remove obsolete `WatchFundingConfirmed` when using RBF (#2961) When using RBF for a dual-funded channel or a splice, we set multiple `WatchFundingConfirmed` for conflicting transactions. When one of those transactions confirms, the others will never confirm: it is wasteful to keep watching for their confirmation. The watcher doesn't have enough information on its own to efficiently detect that some watches are double-spent: we instead rely on the consumer of the watch to tell the watcher to stop watching the RBF attempts. Fixes #2954") `[WatchFundingConfirmed](/ACINQ/eclair/commit/189e28299373b2aada6f51efe3e0b901bfb3cea3 "Remove obsolete `WatchFundingConfirmed` when using RBF (#2961) When using RBF for a dual-funded channel or a splice, we set multiple `WatchFundingConfirmed` for conflicting transactions. When one of those transactions confirms, the others will never confirm: it is wasteful to keep watching for their confirmation. The watcher doesn't have enough information on its own to efficiently detect that some watches are double-spent: we instead rely on the consumer of the watch to tell the watcher to stop watching the RBF attempts. Fixes #2954")` [when using RBF (](/ACINQ/eclair/commit/189e28299373b2aada6f51efe3e0b901bfb3cea3 "Remove obsolete `WatchFundingConfirmed` when using RBF (#2961) When using RBF for a dual-funded channel or a splice, we set multiple `WatchFundingConfirmed` for conflicting transactions. When one of those transactions confirms, the others will never confirm: it is wasteful to keep watching for their confirmation. The watcher doesn't have enough information on its own to efficiently detect that some watches are double-spent: we instead rely on the consumer of the watch to tell the watcher to stop watching the RBF attempts. Fixes #2954")[#2961](https://github.com/ACINQ/eclair/pull/2961)[)](/ACINQ/eclair/commit/189e28299373b2aada6f51efe3e0b901bfb3cea3 "Remove obsolete `WatchFundingConfirmed` when using RBF (#2961) When using RBF for a dual-funded channel or a splice, we set multiple `WatchFundingConfirmed` for conflicting transactions. When one of those transactions confirms, the others will never confirm: it is wasteful to keep watching for their confirmation. The watcher doesn't have enough information on its own to efficiently detect that some watches are double-spent: we instead rely on the consumer of the watch to tell the watcher to stop watching the RBF attempts. Fixes #2954")

  Show description for 189e282[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[189e282](/ACINQ/eclair/commit/189e28299373b2aada6f51efe3e0b901bfb3cea3)Copy full SHA for 189e282
### Commits on Dec 5, 2024

* #### [Decrypt on-the-fly funding trampoline failures (](/ACINQ/eclair/commit/8381fc4d2bbe81ed35a300bd1b00f188e2e709b2 "Decrypt on-the-fly funding trampoline failures (#2960) While we ignore the actual failure and always return a temporary failure upstream, it's useful to decrypt the recipient failure to log it. When we add support for trampoline errors, we will need the decrypted failure to be able to re-wrap it with trampoline onion secrets.")[#2960](https://github.com/ACINQ/eclair/pull/2960)[)](/ACINQ/eclair/commit/8381fc4d2bbe81ed35a300bd1b00f188e2e709b2 "Decrypt on-the-fly funding trampoline failures (#2960) While we ignore the actual failure and always return a temporary failure upstream, it's useful to decrypt the recipient failure to log it. When we add support for trampoline errors, we will need the decrypted failure to be able to re-wrap it with trampoline onion secrets.")

  Show description for 8381fc4[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[8381fc4](/ACINQ/eclair/commit/8381fc4d2bbe81ed35a300bd1b00f188e2e709b2)Copy full SHA for 8381fc4
* #### [Properly type Sphinx shared secrets (](/ACINQ/eclair/commit/feef44b9803a2cc3144289a328a4d0091b0fcacb "Properly type Sphinx shared secrets (#2959) Otherwise it gets confusing quite quickly, because there are a lot of onion-related secrets (sphinx shared secret, path key, invoice payment secret...).")[#2959](https://github.com/ACINQ/eclair/pull/2959)[)](/ACINQ/eclair/commit/feef44b9803a2cc3144289a328a4d0091b0fcacb "Properly type Sphinx shared secrets (#2959) Otherwise it gets confusing quite quickly, because there are a lot of onion-related secrets (sphinx shared secret, path key, invoice payment secret...).")

  Show description for feef44b[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[feef44b](/ACINQ/eclair/commit/feef44b9803a2cc3144289a328a4d0091b0fcacb)Copy full SHA for feef44b
* #### [Refactor Sphinx failures (](/ACINQ/eclair/commit/2ad22602fd332a32c46c9efff1e90cc962a684a5 "Refactor Sphinx failures (#2955) * Return unwrapped decryption failure onion When we fail to decrypt an onion failure packet, we should return the result of the unwrapping process. When using trampoline, this will let us properly re-encrypt the failure and relay it upstream to the previous trampoline node, until it reaches the sender. * Refactor HTLC failure creation We refactor the shared secret extraction to a dedicated function. * Refactor HTLC failure reason We previously used an `Either[ByteVector, FailureMessage]` to encode: - a downstream error that we couldn't decrypt and must re-wrap (left) - a local error that we must encrypt (right) This won't be sufficient for trampoline, because we will need to handle the following cases: - a downstream error that we couldn't decrypt and must re-wrap - a local error for the node who created the *outer* onion (which we encrypt with the sphinx shared secret of the outer onion) - a local error for the node who created the *trampoline* onion (which we encrypt with the sphinx shared secret of the trampoline onion and then with the shared secret of the outer onion) We thus introduce a trait, which currently only contains the first two cases. We will extend this trait when adding support for trampoline failures. This is a pure refactoring without any behavior changes so far, which will simplify the future trampoline changes. * Include trampoline onion in final trampoline payloads When we receive a (non-blinded) payment that uses trampoline, we keep the trampoline onion to be able to distinguish this payment from a non-trampoline payment.")[#2955](https://github.com/ACINQ/eclair/pull/2955)[)](/ACINQ/eclair/commit/2ad22602fd332a32c46c9efff1e90cc962a684a5 "Refactor Sphinx failures (#2955) * Return unwrapped decryption failure onion When we fail to decrypt an onion failure packet, we should return the result of the unwrapping process. When using trampoline, this will let us properly re-encrypt the failure and relay it upstream to the previous trampoline node, until it reaches the sender. * Refactor HTLC failure creation We refactor the shared secret extraction to a dedicated function. * Refactor HTLC failure reason We previously used an `Either[ByteVector, FailureMessage]` to encode: - a downstream error that we couldn't decrypt and must re-wrap (left) - a local error that we must encrypt (right) This won't be sufficient for trampoline, because we will need to handle the following cases: - a downstream error that we couldn't decrypt and must re-wrap - a local error for the node who created the *outer* onion (which we encrypt with the sphinx shared secret of the outer onion) - a local error for the node who created the *trampoline* onion (which we encrypt with the sphinx shared secret of the trampoline onion and then with the shared secret of the outer onion) We thus introduce a trait, which currently only contains the first two cases. We will extend this trait when adding support for trampoline failures. This is a pure refactoring without any behavior changes so far, which will simplify the future trampoline changes. * Include trampoline onion in final trampoline payloads When we receive a (non-blinded) payment that uses trampoline, we keep the trampoline onion to be able to distinguish this payment from a non-trampoline payment.")

  Show description for 2ad2260[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[2ad2260](/ACINQ/eclair/commit/2ad22602fd332a32c46c9efff1e90cc962a684a5)Copy full SHA for 2ad2260
### Commits on Dec 4, 2024

* #### [Back to dev (](/ACINQ/eclair/commit/4d930c776bc2e08425c82d31c20a27468d659ea9 "Back to dev (#2957) After the v0.11.0 release.")[#2957](https://github.com/ACINQ/eclair/pull/2957)[)](/ACINQ/eclair/commit/4d930c776bc2e08425c82d31c20a27468d659ea9 "Back to dev (#2957) After the v0.11.0 release.")

  Show description for 4d930c7[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[4d930c7](/ACINQ/eclair/commit/4d930c776bc2e08425c82d31c20a27468d659ea9)Copy full SHA for 4d930c7
* #### [Eclair v0.11.0 release (](/ACINQ/eclair/commit/7e7ad4549eab8b7b5341225a7b5ba73a746c2b4d "Eclair v0.11.0 release (#2956)")[#2956](https://github.com/ACINQ/eclair/pull/2956)[)](/ACINQ/eclair/commit/7e7ad4549eab8b7b5341225a7b5ba73a746c2b4d "Eclair v0.11.0 release (#2956)")

  [![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[7e7ad45](/ACINQ/eclair/commit/7e7ad4549eab8b7b5341225a7b5ba73a746c2b4d)Copy full SHA for 7e7ad45
### Commits on Dec 3, 2024

* #### [Check HTLC output status before funding HTLC tx (](/ACINQ/eclair/commit/f47acd0fb4f430a5dd52f307e6008e6b1740715b "Check HTLC output status before funding HTLC tx (#2944) When a channel force-closes, we publish our commit tx and HTLC txs. HTLC transactions conflict with our peer's transactions that also spend the HTLC outputs. If our peer is able to get their transaction confirmed before ours, we should stop retrying to publish our HTLC transaction as that will never succeed. Since we didn't check the output status, we kept retrying until the channel was closed (which requires waiting for the `to_self_delay`). The retries always fail at funding time: `bitcoind` returns an error saying that the UTXO cannot be found (which is expected because it has already been spent by our peer). This creates a lot of unnecessary retries and a lot of noise in the logs. This scenario usually happens when our peer didn't send the preimage before force-closing the channel, but reveals it on-chain before the HTLC timeout: when that happens we kept retrying to publish our HTLC timeout transaction, which cannot succeed. We now check the output status in our publishing preconditions, and immediately abort if the output has already been spent by a confirmed transaction.")[#2944](https://github.com/ACINQ/eclair/pull/2944)[)](/ACINQ/eclair/commit/f47acd0fb4f430a5dd52f307e6008e6b1740715b "Check HTLC output status before funding HTLC tx (#2944) When a channel force-closes, we publish our commit tx and HTLC txs. HTLC transactions conflict with our peer's transactions that also spend the HTLC outputs. If our peer is able to get their transaction confirmed before ours, we should stop retrying to publish our HTLC transaction as that will never succeed. Since we didn't check the output status, we kept retrying until the channel was closed (which requires waiting for the `to_self_delay`). The retries always fail at funding time: `bitcoind` returns an error saying that the UTXO cannot be found (which is expected because it has already been spent by our peer). This creates a lot of unnecessary retries and a lot of noise in the logs. This scenario usually happens when our peer didn't send the preimage before force-closing the channel, but reveals it on-chain before the HTLC timeout: when that happens we kept retrying to publish our HTLC timeout transaction, which cannot succeed. We now check the output status in our publishing preconditions, and immediately abort if the output has already been spent by a confirmed transaction.")

  Show description for f47acd0[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[f47acd0](/ACINQ/eclair/commit/f47acd0fb4f430a5dd52f307e6008e6b1740715b)Copy full SHA for f47acd0
### Commits on Nov 29, 2024

* #### [Various refactoring for trampoline blinded paths (](/ACINQ/eclair/commit/304290d84117ddda912bdca5ad98d7418a064802 "Various refactoring for trampoline blinded paths (#2952) * Fix offer description documentation And remove the `currency` fields as we have no short-term plans to support currency conversion in `eclair`. * Relax `payment_constraints` requirement in final blinded payload We don't always need to include a `payment_constraints` field for ourselves: it's fine to accept payment that don't contain one as long as we created the `encrypted_recipient_data`, which we can verify using the `path_id`. We were too restrictive for no good reason. * Allow omitting `total_amount` in blinded payments If the `total_amount` field isn't provided, we can safely default to using the `amount`, which saves space in the onion. Note that we keep always encoding it in the outgoing payments we send, we're simply more permissive when receiving payments. * Refactor `decryptEncryptedRecipientData` We extract a helper method for decrypting encrypted recipient data which will be used when decrypting trampoline blinded paths. * Use relay methods in `PaymentOnion.IntermediatePayload.NodeRelay` In order to support blinded trampoline payments, we won't have access to a direct `amount_to_forward` field, but will use a `payment_relay` TLV instead, which only allows calculating the outgoing amount from the incoming amount (same thing for the expiry). We refactor this to simplify the diff when introducing blinded trampoline payments.")[#2952](https://github.com/ACINQ/eclair/pull/2952)[)](/ACINQ/eclair/commit/304290d84117ddda912bdca5ad98d7418a064802 "Various refactoring for trampoline blinded paths (#2952) * Fix offer description documentation And remove the `currency` fields as we have no short-term plans to support currency conversion in `eclair`. * Relax `payment_constraints` requirement in final blinded payload We don't always need to include a `payment_constraints` field for ourselves: it's fine to accept payment that don't contain one as long as we created the `encrypted_recipient_data`, which we can verify using the `path_id`. We were too restrictive for no good reason. * Allow omitting `total_amount` in blinded payments If the `total_amount` field isn't provided, we can safely default to using the `amount`, which saves space in the onion. Note that we keep always encoding it in the outgoing payments we send, we're simply more permissive when receiving payments. * Refactor `decryptEncryptedRecipientData` We extract a helper method for decrypting encrypted recipient data which will be used when decrypting trampoline blinded paths. * Use relay methods in `PaymentOnion.IntermediatePayload.NodeRelay` In order to support blinded trampoline payments, we won't have access to a direct `amount_to_forward` field, but will use a `payment_relay` TLV instead, which only allows calculating the outgoing amount from the incoming amount (same thing for the expiry). We refactor this to simplify the diff when introducing blinded trampoline payments.")

  Show description for 304290d[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[304290d](/ACINQ/eclair/commit/304290d84117ddda912bdca5ad98d7418a064802)Copy full SHA for 304290d
### Commits on Nov 28, 2024

* #### [Rename](/ACINQ/eclair/commit/0d2d38026a4c6d279b5eb2d06761e12617c9c121 "Rename `blinding` to `pathKey` (#2951) Rename some variable to align with the spec.") `[blinding](/ACINQ/eclair/commit/0d2d38026a4c6d279b5eb2d06761e12617c9c121 "Rename `blinding` to `pathKey` (#2951) Rename some variable to align with the spec.")` [to](/ACINQ/eclair/commit/0d2d38026a4c6d279b5eb2d06761e12617c9c121 "Rename `blinding` to `pathKey` (#2951) Rename some variable to align with the spec.") `[pathKey](/ACINQ/eclair/commit/0d2d38026a4c6d279b5eb2d06761e12617c9c121 "Rename `blinding` to `pathKey` (#2951) Rename some variable to align with the spec.")` [(](/ACINQ/eclair/commit/0d2d38026a4c6d279b5eb2d06761e12617c9c121 "Rename `blinding` to `pathKey` (#2951) Rename some variable to align with the spec.")[#2951](https://github.com/ACINQ/eclair/pull/2951)[)](/ACINQ/eclair/commit/0d2d38026a4c6d279b5eb2d06761e12617c9c121 "Rename `blinding` to `pathKey` (#2951) Rename some variable to align with the spec.")

  Show description for 0d2d380[![thomash-acinq](https://avatars.githubusercontent.com/u/81159533?v=4&size=32)](/thomash-acinq)[thomash-acinq](/ACINQ/eclair/commits?author=thomash-acinq)authored[0d2d380](/ACINQ/eclair/commit/0d2d38026a4c6d279b5eb2d06761e12617c9c121)Copy full SHA for 0d2d380
### Commits on Nov 27, 2024

* #### [Refactor trampoline-to-legacy payments (](/ACINQ/eclair/commit/ab94128acce8063f08859049e902a8985519f36e "Refactor trampoline-to-legacy payments (#2948) We refactor trampoline-to-legacy payments to use a dedicated class, like what we do for trampoline-to-blinded-paths payments. This allows us to supports two encodings for those payments: - one where the trampoline onion contains a dummy payload for the recipient that must be ignored (current Phoenix wallets), which wastes space in the onion for legacy reasons - one where we don't include a dummy payload for the recipient, which is more efficient and similar to trampoline-to-blinded-paths")[#2948](https://github.com/ACINQ/eclair/pull/2948)[)](/ACINQ/eclair/commit/ab94128acce8063f08859049e902a8985519f36e "Refactor trampoline-to-legacy payments (#2948) We refactor trampoline-to-legacy payments to use a dedicated class, like what we do for trampoline-to-blinded-paths payments. This allows us to supports two encodings for those payments: - one where the trampoline onion contains a dummy payload for the recipient that must be ignored (current Phoenix wallets), which wastes space in the onion for legacy reasons - one where we don't include a dummy payload for the recipient, which is more efficient and similar to trampoline-to-blinded-paths")

  Show description for ab94128[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[ab94128](/ACINQ/eclair/commit/ab94128acce8063f08859049e902a8985519f36e)Copy full SHA for ab94128
* #### [Use bitcoin-lib 0.35 (](/ACINQ/eclair/commit/a624b82e00d5df577007e0b7e382e3dddd99880c "Use bitcoin-lib 0.35 (#2950)")[#2950](https://github.com/ACINQ/eclair/pull/2950)[)](/ACINQ/eclair/commit/a624b82e00d5df577007e0b7e382e3dddd99880c "Use bitcoin-lib 0.35 (#2950)")

  [![sstone](https://avatars.githubusercontent.com/u/1573866?v=4&size=32)](/sstone)[sstone](/ACINQ/eclair/commits?author=sstone)authored[a624b82](/ACINQ/eclair/commit/a624b82e00d5df577007e0b7e382e3dddd99880c)Copy full SHA for a624b82
### Commits on Nov 22, 2024

* #### [Allow plain](/ACINQ/eclair/commit/02abc3a7e561529fab4c30606b7660e40650f80a "Allow plain `outgoing_node_id` in blinded `payment_relay` (#2943) When we're the introduction node of a trampoline blinded path, we previously only allowed our custom `wallet_node_id` format when a `short_channel_id` was not included. But we actually can allow plain `node_id`s as well, as we only need to know the public key. We've rejected some payments in the past months because they included an `outgoing_node_id` that didn't use the wallet format: by removing that limitation we ensure that those payments will be correctly relayed in the future.") `[outgoing_node_id](/ACINQ/eclair/commit/02abc3a7e561529fab4c30606b7660e40650f80a "Allow plain `outgoing_node_id` in blinded `payment_relay` (#2943) When we're the introduction node of a trampoline blinded path, we previously only allowed our custom `wallet_node_id` format when a `short_channel_id` was not included. But we actually can allow plain `node_id`s as well, as we only need to know the public key. We've rejected some payments in the past months because they included an `outgoing_node_id` that didn't use the wallet format: by removing that limitation we ensure that those payments will be correctly relayed in the future.")` [in blinded](/ACINQ/eclair/commit/02abc3a7e561529fab4c30606b7660e40650f80a "Allow plain `outgoing_node_id` in blinded `payment_relay` (#2943) When we're the introduction node of a trampoline blinded path, we previously only allowed our custom `wallet_node_id` format when a `short_channel_id` was not included. But we actually can allow plain `node_id`s as well, as we only need to know the public key. We've rejected some payments in the past months because they included an `outgoing_node_id` that didn't use the wallet format: by removing that limitation we ensure that those payments will be correctly relayed in the future.") `[payment_relay](/ACINQ/eclair/commit/02abc3a7e561529fab4c30606b7660e40650f80a "Allow plain `outgoing_node_id` in blinded `payment_relay` (#2943) When we're the introduction node of a trampoline blinded path, we previously only allowed our custom `wallet_node_id` format when a `short_channel_id` was not included. But we actually can allow plain `node_id`s as well, as we only need to know the public key. We've rejected some payments in the past months because they included an `outgoing_node_id` that didn't use the wallet format: by removing that limitation we ensure that those payments will be correctly relayed in the future.")` [(](/ACINQ/eclair/commit/02abc3a7e561529fab4c30606b7660e40650f80a "Allow plain `outgoing_node_id` in blinded `payment_relay` (#2943) When we're the introduction node of a trampoline blinded path, we previously only allowed our custom `wallet_node_id` format when a `short_channel_id` was not included. But we actually can allow plain `node_id`s as well, as we only need to know the public key. We've rejected some payments in the past months because they included an `outgoing_node_id` that didn't use the wallet format: by removing that limitation we ensure that those payments will be correctly relayed in the future.")[#2943](https://github.com/ACINQ/eclair/pull/2943)[)](/ACINQ/eclair/commit/02abc3a7e561529fab4c30606b7660e40650f80a "Allow plain `outgoing_node_id` in blinded `payment_relay` (#2943) When we're the introduction node of a trampoline blinded path, we previously only allowed our custom `wallet_node_id` format when a `short_channel_id` was not included. But we actually can allow plain `node_id`s as well, as we only need to know the public key. We've rejected some payments in the past months because they included an `outgoing_node_id` that didn't use the wallet format: by removing that limitation we ensure that those payments will be correctly relayed in the future.")

  Show description for 02abc3a[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[02abc3a](/ACINQ/eclair/commit/02abc3a7e561529fab4c30606b7660e40650f80a)Copy full SHA for 02abc3a
### Commits on Nov 21, 2024

* #### [Simplify trampoline test helpers (](/ACINQ/eclair/commit/47fdfaec9f6760962bb6f24d1e15c45b7ece7474 "Simplify trampoline test helpers (#2942) We previously supported sending arbitrary trampoline payments in eclair, which added a bunch of complexity to many of our payment components. This was necessary because the first version of Phoenix was based on the eclair codebase. But Phoenix isn't based on eclair anymore and is now using https://github.com/acinq/lightning-kmp, which is the library that mobile wallets should use. Eclair is only meant to be used for server nodes that relay payments and have access to the full network graph, so it doesn't make sense ever to send trampoline payments (full source-routing will always be better). We thus refactor our trampoline client code to only be used for tests (to ensure that trampoline relay and trampoline receive are implemented correctly). We isolate the test payment lifecycle in a dedicated actor (`TrampolinePaymentLifecycle`) which simplifies other payment components (such as `PaymentInitiator`). This refactoring will make it easier to support the official version of trampoline while maintaining backwards-compatibility for older Phoenix wallets that use the non-official trampoline version.")[#2942](https://github.com/ACINQ/eclair/pull/2942)[)](/ACINQ/eclair/commit/47fdfaec9f6760962bb6f24d1e15c45b7ece7474 "Simplify trampoline test helpers (#2942) We previously supported sending arbitrary trampoline payments in eclair, which added a bunch of complexity to many of our payment components. This was necessary because the first version of Phoenix was based on the eclair codebase. But Phoenix isn't based on eclair anymore and is now using https://github.com/acinq/lightning-kmp, which is the library that mobile wallets should use. Eclair is only meant to be used for server nodes that relay payments and have access to the full network graph, so it doesn't make sense ever to send trampoline payments (full source-routing will always be better). We thus refactor our trampoline client code to only be used for tests (to ensure that trampoline relay and trampoline receive are implemented correctly). We isolate the test payment lifecycle in a dedicated actor (`TrampolinePaymentLifecycle`) which simplifies other payment components (such as `PaymentInitiator`). This refactoring will make it easier to support the official version of trampoline while maintaining backwards-compatibility for older Phoenix wallets that use the non-official trampoline version.")

  Show description for 47fdfae[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[47fdfae](/ACINQ/eclair/commit/47fdfaec9f6760962bb6f24d1e15c45b7ece7474)Copy full SHA for 47fdfae
### Commits on Nov 20, 2024

* #### [Update Bitcoin Core to 27.2 (](/ACINQ/eclair/commit/a0b58344be9acd7d410edcec7f30f2ac42bbdd45 "Update Bitcoin Core to 27.2 (#2940) Bitcoin Core 27.2 is out with some bug fixes. None of the bugs fixed seem to impact us, but there's always a possibility that a security issue was also fixed, so it's better to upgrade!")[#2940](https://github.com/ACINQ/eclair/pull/2940)[)](/ACINQ/eclair/commit/a0b58344be9acd7d410edcec7f30f2ac42bbdd45 "Update Bitcoin Core to 27.2 (#2940) Bitcoin Core 27.2 is out with some bug fixes. None of the bugs fixed seem to impact us, but there's always a possibility that a security issue was also fixed, so it's better to upgrade!")

  Show description for a0b5834[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[a0b5834](/ACINQ/eclair/commit/a0b58344be9acd7d410edcec7f30f2ac42bbdd45)Copy full SHA for a0b5834
* #### [Add logs for balance estimate (](/ACINQ/eclair/commit/51defce453c39444062615b06a59fab9da6fbbfb "Add logs for balance estimate (#2939) The balance estimates are sometimes outside the range [0, 1] which should never happen. We add some logs to help debug it. We also stop calling `TimestampSecond.now()` multiple times during the computation and reuse the same value which may fix the issue.")[#2939](https://github.com/ACINQ/eclair/pull/2939)[)](/ACINQ/eclair/commit/51defce453c39444062615b06a59fab9da6fbbfb "Add logs for balance estimate (#2939) The balance estimates are sometimes outside the range [0, 1] which should never happen. We add some logs to help debug it. We also stop calling `TimestampSecond.now()` multiple times during the computation and reuse the same value which may fix the issue.")

  Show description for 51defce[![thomash-acinq](https://avatars.githubusercontent.com/u/81159533?v=4&size=32)](/thomash-acinq)[thomash-acinq](/ACINQ/eclair/commits?author=thomash-acinq)authored[51defce](/ACINQ/eclair/commit/51defce453c39444062615b06a59fab9da6fbbfb)Copy full SHA for 51defce
* #### [Add force-close notification (](/ACINQ/eclair/commit/541014680c3a57d3201ac33e269d839a585aba5c "Add force-close notification (#2935) Add a node operator notification when we force-close a channel.")[#2935](https://github.com/ACINQ/eclair/pull/2935)[)](/ACINQ/eclair/commit/541014680c3a57d3201ac33e269d839a585aba5c "Add force-close notification (#2935) Add a node operator notification when we force-close a channel.")

  Show description for 5410146[![rorp](https://avatars.githubusercontent.com/u/2314888?v=4&size=32)](/rorp)[rorp](/ACINQ/eclair/commits?author=rorp)authored[5410146](/ACINQ/eclair/commit/541014680c3a57d3201ac33e269d839a585aba5c)Copy full SHA for 5410146
### Commits on Nov 8, 2024

* #### [Make cluster serialization support unknown messages (](/ACINQ/eclair/commit/f02c98b3b3d5432032eedc2480d708ea3e267d95 "Make cluster serialization support unknown messages (#2938) The codec that we were using to serialize `LightningMessage`s in the eclair cluster didn't support `UnknownMessage`. This resulted in those messages being dropped by the front and never reaching the backend node.")[#2938](https://github.com/ACINQ/eclair/pull/2938)[)](/ACINQ/eclair/commit/f02c98b3b3d5432032eedc2480d708ea3e267d95 "Make cluster serialization support unknown messages (#2938) The codec that we were using to serialize `LightningMessage`s in the eclair cluster didn't support `UnknownMessage`. This resulted in those messages being dropped by the front and never reaching the backend node.")

  Show description for f02c98b[![pm47](https://avatars.githubusercontent.com/u/2028222?v=4&size=32)](/pm47)[pm47](/ACINQ/eclair/commits?author=pm47)authored[f02c98b](/ACINQ/eclair/commit/f02c98b3b3d5432032eedc2480d708ea3e267d95)Copy full SHA for f02c98b
* #### [Don't relay buggy extra payments (](/ACINQ/eclair/commit/f4efd64ae5a9775b5cabc552fe1665a48efc60b9 "Don't relay buggy extra payments (#2937) If a payer is buggy and tries to pay the same invoice multiple times, it can lead to an edge case where the recipient accepted the first one and purchased liquidity for it, but didn't purchase additional liquidity and thus cannot receive the duplicate payments. Also, when replaying parts that were waiting for an on-the-fly funding, we set `commit = false` to all parts, instead of just the last one. This optimization caused the payment to be stuck if the last part was unexpectedly rejected (which would for example happen in the buggy payer case described above, before we rejected those extra payments). --------- Co-authored-by: t-bast <bastien@acinq.fr>")[#2937](https://github.com/ACINQ/eclair/pull/2937)[)](/ACINQ/eclair/commit/f4efd64ae5a9775b5cabc552fe1665a48efc60b9 "Don't relay buggy extra payments (#2937) If a payer is buggy and tries to pay the same invoice multiple times, it can lead to an edge case where the recipient accepted the first one and purchased liquidity for it, but didn't purchase additional liquidity and thus cannot receive the duplicate payments. Also, when replaying parts that were waiting for an on-the-fly funding, we set `commit = false` to all parts, instead of just the last one. This optimization caused the payment to be stuck if the last part was unexpectedly rejected (which would for example happen in the buggy payer case described above, before we rejected those extra payments). --------- Co-authored-by: t-bast <bastien@acinq.fr>")

  Show description for f4efd64 ![pm47](https://avatars.githubusercontent.com/u/2028222?v=4&size=32)![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)[pm47](/ACINQ/eclair/commits?author=pm47)and[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[f4efd64](/ACINQ/eclair/commit/f4efd64ae5a9775b5cabc552fe1665a48efc60b9)Copy full SHA for f4efd64
### Commits on Oct 24, 2024

* #### [Use shared input's](/ACINQ/eclair/commit/4ca8ea025e68f5db389326ccfc883a356e8d5ea4 "Use shared input's `txOut` in `shouldSignFirst` (#2934) This is clearer that way and yields the same result: we only look at `txOut` amounts when computing each node's contributions.") `[txOut](/ACINQ/eclair/commit/4ca8ea025e68f5db389326ccfc883a356e8d5ea4 "Use shared input's `txOut` in `shouldSignFirst` (#2934) This is clearer that way and yields the same result: we only look at `txOut` amounts when computing each node's contributions.")` [in](/ACINQ/eclair/commit/4ca8ea025e68f5db389326ccfc883a356e8d5ea4 "Use shared input's `txOut` in `shouldSignFirst` (#2934) This is clearer that way and yields the same result: we only look at `txOut` amounts when computing each node's contributions.") `[shouldSignFirst](/ACINQ/eclair/commit/4ca8ea025e68f5db389326ccfc883a356e8d5ea4 "Use shared input's `txOut` in `shouldSignFirst` (#2934) This is clearer that way and yields the same result: we only look at `txOut` amounts when computing each node's contributions.")` [(](/ACINQ/eclair/commit/4ca8ea025e68f5db389326ccfc883a356e8d5ea4 "Use shared input's `txOut` in `shouldSignFirst` (#2934) This is clearer that way and yields the same result: we only look at `txOut` amounts when computing each node's contributions.")[#2934](https://github.com/ACINQ/eclair/pull/2934)[)](/ACINQ/eclair/commit/4ca8ea025e68f5db389326ccfc883a356e8d5ea4 "Use shared input's `txOut` in `shouldSignFirst` (#2934) This is clearer that way and yields the same result: we only look at `txOut` amounts when computing each node's contributions.")

  Show description for 4ca8ea0[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[4ca8ea0](/ACINQ/eclair/commit/4ca8ea025e68f5db389326ccfc883a356e8d5ea4)Copy full SHA for 4ca8ea0
### Commits on Oct 18, 2024

* #### [Add detailed error message when splice feerate is incorrect (](/ACINQ/eclair/commit/96d0c9a35b2291ecd9ad6cfb515a5d86c76e5e18 "Add detailed error message when splice feerate is incorrect (#2920) This can be helpful when troubleshooting cross-compatibility issues. Replaces #2911.")[#2920](https://github.com/ACINQ/eclair/pull/2920)[)](/ACINQ/eclair/commit/96d0c9a35b2291ecd9ad6cfb515a5d86c76e5e18 "Add detailed error message when splice feerate is incorrect (#2920) This can be helpful when troubleshooting cross-compatibility issues. Replaces #2911.")

  Show description for 96d0c9a[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[96d0c9a](/ACINQ/eclair/commit/96d0c9a35b2291ecd9ad6cfb515a5d86c76e5e18)Copy full SHA for 96d0c9a
* #### [Add support for RBF-ing splice transactions (](/ACINQ/eclair/commit/13d4c9f06c655867d95597359c8d78fbd3c87274 "Add support for RBF-ing splice transactions (#2925) If the latest splice transaction doesn't confirm, we allow exchanging `tx_init_rbf` and `tx_ack_rbf` to create another splice transaction to replace it. We use the same funding contribution as the previous splice. When 0-conf isn't used, we reject `splice_init` while the previous splice transaction hasn't confirmed. Our peer should either use RBF instead of creating a new splice, or they should wait for our node to receive the block that confirmed the previous transaction. This protects against chains of unconfirmed transactions. When using 0-conf, we reject `tx_init_rbf` and allow creating chains of unconfirmed splice transactions: using RBF with 0-conf can lead to one side stealing funds, which is why we prevent it. If our peer was buying liquidity but tries to cancel the purchase with an RBF attempt, we reject it: this prevents edge cases where the seller may end up adding liquidity to the channel without being paid in return.")[#2925](https://github.com/ACINQ/eclair/pull/2925)[)](/ACINQ/eclair/commit/13d4c9f06c655867d95597359c8d78fbd3c87274 "Add support for RBF-ing splice transactions (#2925) If the latest splice transaction doesn't confirm, we allow exchanging `tx_init_rbf` and `tx_ack_rbf` to create another splice transaction to replace it. We use the same funding contribution as the previous splice. When 0-conf isn't used, we reject `splice_init` while the previous splice transaction hasn't confirmed. Our peer should either use RBF instead of creating a new splice, or they should wait for our node to receive the block that confirmed the previous transaction. This protects against chains of unconfirmed transactions. When using 0-conf, we reject `tx_init_rbf` and allow creating chains of unconfirmed splice transactions: using RBF with 0-conf can lead to one side stealing funds, which is why we prevent it. If our peer was buying liquidity but tries to cancel the purchase with an RBF attempt, we reject it: this prevents edge cases where the seller may end up adding liquidity to the channel without being paid in return.")

  Show description for 13d4c9f[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[13d4c9f](/ACINQ/eclair/commit/13d4c9f06c655867d95597359c8d78fbd3c87274)Copy full SHA for 13d4c9f
### Commits on Oct 16, 2024

* #### [Fix comment (](/ACINQ/eclair/commit/f1e07353b934b69c65a16b5d8e251d31dbf7f352 "Fix comment (#2930)")[#2930](https://github.com/ACINQ/eclair/pull/2930)[)](/ACINQ/eclair/commit/f1e07353b934b69c65a16b5d8e251d31dbf7f352 "Fix comment (#2930)")

  [![thomash-acinq](https://avatars.githubusercontent.com/u/81159533?v=4&size=32)](/thomash-acinq)[thomash-acinq](/ACINQ/eclair/commits?author=thomash-acinq)authored[f1e0735](/ACINQ/eclair/commit/f1e07353b934b69c65a16b5d8e251d31dbf7f352)Copy full SHA for f1e0735
### Commits on Oct 15, 2024

* #### [Automatically disable](/ACINQ/eclair/commit/e09c830f103c75869e89470927aa3389a86eb1fc "Automatically disable `from_future_htlc` when abused (#2928) When providing on-the-fly funding with the `from_future_htlc` payment type, the liquidity provider is paying mining fees for the funding transaction while trusting that the remote node will accept the HTLCs afterwards and thus pay a liquidity fees. If the remote node fails the HTLCs, the liquidity provider doesn't get paid. At that point it can disable the channel and try to actively double-spend it. When we detect such behavior, we immediately disable `from_future_htlc` to limit the exposure to liquidity griefing: it can then be re-enabled by using the `enableFromFutureHtlc` RPC, or will be automatically re-enabled if the remote node fulfills the HTLCs after a retry.") `[from_future_htlc](/ACINQ/eclair/commit/e09c830f103c75869e89470927aa3389a86eb1fc "Automatically disable `from_future_htlc` when abused (#2928) When providing on-the-fly funding with the `from_future_htlc` payment type, the liquidity provider is paying mining fees for the funding transaction while trusting that the remote node will accept the HTLCs afterwards and thus pay a liquidity fees. If the remote node fails the HTLCs, the liquidity provider doesn't get paid. At that point it can disable the channel and try to actively double-spend it. When we detect such behavior, we immediately disable `from_future_htlc` to limit the exposure to liquidity griefing: it can then be re-enabled by using the `enableFromFutureHtlc` RPC, or will be automatically re-enabled if the remote node fulfills the HTLCs after a retry.")` [when abused (](/ACINQ/eclair/commit/e09c830f103c75869e89470927aa3389a86eb1fc "Automatically disable `from_future_htlc` when abused (#2928) When providing on-the-fly funding with the `from_future_htlc` payment type, the liquidity provider is paying mining fees for the funding transaction while trusting that the remote node will accept the HTLCs afterwards and thus pay a liquidity fees. If the remote node fails the HTLCs, the liquidity provider doesn't get paid. At that point it can disable the channel and try to actively double-spend it. When we detect such behavior, we immediately disable `from_future_htlc` to limit the exposure to liquidity griefing: it can then be re-enabled by using the `enableFromFutureHtlc` RPC, or will be automatically re-enabled if the remote node fulfills the HTLCs after a retry.")[#2928](https://github.com/ACINQ/eclair/pull/2928)[)](/ACINQ/eclair/commit/e09c830f103c75869e89470927aa3389a86eb1fc "Automatically disable `from_future_htlc` when abused (#2928) When providing on-the-fly funding with the `from_future_htlc` payment type, the liquidity provider is paying mining fees for the funding transaction while trusting that the remote node will accept the HTLCs afterwards and thus pay a liquidity fees. If the remote node fails the HTLCs, the liquidity provider doesn't get paid. At that point it can disable the channel and try to actively double-spend it. When we detect such behavior, we immediately disable `from_future_htlc` to limit the exposure to liquidity griefing: it can then be re-enabled by using the `enableFromFutureHtlc` RPC, or will be automatically re-enabled if the remote node fulfills the HTLCs after a retry.")

  Show description for e09c830[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[e09c830](/ACINQ/eclair/commit/e09c830f103c75869e89470927aa3389a86eb1fc)Copy full SHA for e09c830
* #### [Enforce recommended feerate for on-the-fly funding (](/ACINQ/eclair/commit/b8e6800e9d5e0ac4c4113f6a1207de840b4d86a7 "Enforce recommended feerate for on-the-fly funding (#2927) When using on-the-fly funding, we reject `open_channel2` and `splice_init` messages that use a smaller feerate than what we previously recommended.")[#2927](https://github.com/ACINQ/eclair/pull/2927)[)](/ACINQ/eclair/commit/b8e6800e9d5e0ac4c4113f6a1207de840b4d86a7 "Enforce recommended feerate for on-the-fly funding (#2927) When using on-the-fly funding, we reject `open_channel2` and `splice_init` messages that use a smaller feerate than what we previously recommended.")

  Show description for b8e6800[![t-bast](https://avatars.githubusercontent.com/u/31281497?v=4&size=32)](/t-bast)[t-bast](/ACINQ/eclair/commits?author=t-bast)authored[b8e6800](/ACINQ/eclair/commit/b8e6800e9d5e0ac4c4113f6a1207de840b4d86a7)Copy full SHA for b8e6800
## Pagination

[Previous](/ACINQ/eclair/commits/master?before=1c38591d0bb3bc8564a293a78538a06e2595b7bd+0)[Next](/ACINQ/eclair/commits/master?after=1c38591d0bb3bc8564a293a78538a06e2595b7bd+34)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0c8bc755_20250121_010708.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FACINQ%2Feclair%2Freleases)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FACINQ%2Feclair%2Freleases)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Findex&source=header-repo&source_repo=ACINQ%2Feclair)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ACINQ](/ACINQ)
/
**[eclair](/ACINQ/eclair)**
Public

* [Notifications](/login?return_to=%2FACINQ%2Feclair) You must be signed in to change notification settings
* [Fork
  267](/login?return_to=%2FACINQ%2Feclair)
* [Star
   1.3k](/login?return_to=%2FACINQ%2Feclair)

* [Code](/ACINQ/eclair)
* [Issues
  19](/ACINQ/eclair/issues)
* [Pull requests
  32](/ACINQ/eclair/pulls)
* [Discussions](/ACINQ/eclair/discussions)
* [Actions](/ACINQ/eclair/actions)
* [Projects
  0](/ACINQ/eclair/projects)
* [Security](/ACINQ/eclair/security)
* [Insights](/ACINQ/eclair/pulse)

Additional navigation options

* [Code](/ACINQ/eclair)
* [Issues](/ACINQ/eclair/issues)
* [Pull requests](/ACINQ/eclair/pulls)
* [Discussions](/ACINQ/eclair/discussions)
* [Actions](/ACINQ/eclair/actions)
* [Projects](/ACINQ/eclair/projects)
* [Security](/ACINQ/eclair/security)
* [Insights](/ACINQ/eclair/pulse)

# Releases: ACINQ/eclair

[Releases](/ACINQ/eclair/releases)
[Tags](/ACINQ/eclair/tags)

Releases · ACINQ/eclair
## Eclair v0.11.0

04 Dec 09:23

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.11.0](/ACINQ/eclair/tree/v0.11.0)

[`7e7ad45`](/ACINQ/eclair/commit/7e7ad4549eab8b7b5341225a7b5ba73a746c2b4d)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.

GPG key ID: B5690EEEBB952194

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.11.0)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.11.0](/ACINQ/eclair/releases/tag/v0.11.0)
[Latest](/ACINQ/eclair/releases/latest)

[Latest](/ACINQ/eclair/releases/latest)

This release adds official support for Bolt 12 offers and makes progress on liquidity management features (splicing, liquidity ads, on-the-fly funding). We also stop accepting channels that don't support anchor outputs and update our dependency on Bitcoin Core.

We're still actively working with other implementations to finalize the specification for some of these experimental features. You should only activate them if you know what you're doing, and are ready to handle backwards-incompatible changes!

This release also contains various performance improvements, more configuration options and minor bug fixes.

The detailed release notes can be found [here](https://github.com/ACINQ/eclair/blob/master/docs/release-notes/eclair-v0.11.0.md).

## Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
## Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 22.04
* AdoptOpenJDK 11.0.22
* Maven 3.9.2

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-<version>-XXXXXXX-bin.zip` with sha256 checksums that match the one we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not tried everything.

## Upgrading

This release is fully compatible with previous eclair versions. You don't need to close your channels, just stop eclair, upgrade and restart.

### Contributors

* [![@sstone](https://avatars.githubusercontent.com/u/1573866?s=64&v=4)](https://github.com/sstone)

sstone

 Assets
6

 Loading

All reactions

## Eclair v0.10.0

29 Feb 09:24

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.10.0](/ACINQ/eclair/tree/v0.10.0)

[`a63d2c2`](/ACINQ/eclair/commit/a63d2c2909804bd2a6b687a04c0c9a151a580570)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.

GPG key ID: B5690EEEBB952194

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.10.0)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.10.0](/ACINQ/eclair/releases/tag/v0.10.0)

This release adds official support for the dual-funding feature, an up-to-date implementation of Bolt 12 offers, and a fully working splicing prototype. We're waiting for the specification work to be finalized for some of those features, and other implementations to be ready for cross-compatibility tests. You should only activate them if you know what you're doing, and are ready to handle backwards-incompatible changes!

This release also contains various on-chain fee improvements, more configuration options, performance enhancements and various minor bug fixes.

The detailed release notes can be found [here](https://github.com/ACINQ/eclair/blob/master/docs/release-notes/eclair-v0.10.0.md).

## Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
## Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 22.04
* AdoptOpenJDK 11.0.22
* Maven 3.9.2

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-<version>-XXXXXXX-bin.zip` with sha256 checksums that match the one

we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not

tried everything.

## Upgrading

This release is fully compatible with previous eclair versions. You don't need to close your channels, just stop eclair,

upgrade and restart.

### Contributors

* [![@sstone](https://avatars.githubusercontent.com/u/1573866?s=64&v=4)](https://github.com/sstone)

sstone

 Assets
6

 Loading

 🚀
5
 remyers, DerEwige, ferib, edouardparis, and claddyy reacted with rocket emoji
 👀
1
 22388o reacted with eyes emoji

All reactions

* 🚀
  5 reactions
* 👀
  1 reaction

 6 people reacted

## v0.9.0

19 Jun 08:45

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.9.0](/ACINQ/eclair/tree/v0.9.0)

[`623f7e4`](/ACINQ/eclair/commit/623f7e4866679d0cf91dec3a0637c1ba266a3f81)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.9.0)

 Loading

[View all tags](/ACINQ/eclair/tags)

[v0.9.0](/ACINQ/eclair/releases/tag/v0.9.0)

This release contains a lot of preparatory work for important (and complex) lightning features: dual-funding, splicing and Bolt 12 offers.

These features are now fully implemented in `eclair`, but we're waiting for the specification work to be finalized and other implementations to be ready for cross-compatibility tests.

You should only activate them if you know what you're doing, and are ready to handle potential backwards-incompatible changes!

We also make plugins more powerful, introduce mitigations against various types of DoS, and improve performance in many areas of the codebase.

The detailed release notes can be found [here](https://github.com/ACINQ/eclair/blob/master/docs/release-notes/eclair-v0.9.0.md)

## Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
## Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 22.04
* AdoptOpenJDK 11.0.6
* Maven 3.9.2

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-<version>-XXXXXXX-bin.zip` with sha256 checksums that match the one

we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not

tried everything.

## Upgrading

This release is fully compatible with previous eclair versions. You don't need to close your channels, just stop eclair,

upgrade and restart.

### Contributors

* [![@sstone](https://avatars.githubusercontent.com/u/1573866?s=64&v=4)](https://github.com/sstone)

sstone

 Assets
6

 Loading

 🚀
11
 22388o, kaiwolfram, Rsync25, vafanassieff, claddyy, deadblackclover, theborakompanioni, crisdut, valentinewallace, saubyk, and christianwol-ff reacted with rocket emoji

All reactions

* 🚀
  11 reactions

 11 people reacted

## Eclair v0.8.0

01 Dec 14:09

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.8.0](/ACINQ/eclair/tree/v0.8.0)

[`0077471`](/ACINQ/eclair/commit/00774717f6b1fc89e75a8e49ab03229ecdcd892d)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.8.0)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.8.0](/ACINQ/eclair/releases/tag/v0.8.0)

This release adds official support for two important lightning features: zero-conf channels and channel aliases. It also adds experimental support for dual-funding and a lot of preparatory work for Bolt 12 offers.

⚠️ we also require at least Bitcoin Core 23.0: make sure to upgrade and reconfigure your node (see detailed instructions in the release notes)

The detailed release notes can be found [here](https://github.com/ACINQ/eclair/blob/master/docs/release-notes/eclair-v0.8.0.md)

## Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
## Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 20.04
* AdoptOpenJDK 11.0.6
* Maven 3.8.1

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-<version>-XXXXXXX-bin.zip` with sha256 checksums that match the one

we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not

tried everything.

## Upgrading

This release is fully compatible with previous eclair versions. You don't need to close your channels, just stop eclair,

upgrade and restart.

### Contributors

* [![@sstone](https://avatars.githubusercontent.com/u/1573866?s=64&v=4)](https://github.com/sstone)

sstone

 Assets
6

 Loading

 🚀
1
 MrHash reacted with rocket emoji
 👀
3
 22388o, DerEwige, and theborakompanioni reacted with eyes emoji

All reactions

* 🚀
  1 reaction
* 👀
  3 reactions

 4 people reacted

## Eclair v0.7.0-patch-disconnect

18 Jul 11:06

![@pm47](https://avatars.githubusercontent.com/u/2028222?s=40&v=4)
[pm47](/pm47)

[v0.7.0-patch-disconnect](/ACINQ/eclair/tree/v0.7.0-patch-disconnect)

[`cad88bf`](/ACINQ/eclair/commit/cad88bf933913f0dad5a3413e2c386b7be508303)

This commit was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/2028222?s=64&v=4)](/pm47)
[pm47](/pm47)
Pierre-Marie Padiou

GPG key ID: E434ED292E85643A

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.7.0-patch-disconnect)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.7.0-patch-disconnect](/ACINQ/eclair/releases/tag/v0.7.0-patch-disconnect)

# Eclair v0.7.0-patch-disconnect

This is a patch release which adds two commits:

* Add option to disable sending remote addr in init ([#2285](https://github.com/ACINQ/eclair/pull/2285))
* Resume reading after processing unknown messages ([#2332](https://github.com/ACINQ/eclair/pull/2332))

It addresses unwanted disconnections with peers that use unknown messages.

## Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
## Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 20.04
* AdoptOpenJDK 11.0.6
* Maven 3.8.1

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-0.7.0-cad88bf-bin.zip` with sha256 checksums that match the one we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not tried everything.

## Upgrading

This release is fully compatible with previous eclair versions. You don't need to close your channels, just stop eclair, upgrade and restart.

### Contributors

* [![@sstone](https://avatars.githubusercontent.com/u/1573866?s=64&v=4)](https://github.com/sstone)

sstone

 Assets
4

 Loading

All reactions

## Eclair v0.7.0

01 Feb 09:15

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.7.0](/ACINQ/eclair/tree/v0.7.0)

[`a804905`](/ACINQ/eclair/commit/a804905c0bf68b7ed590475a07333f8c7060ae0e)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.7.0)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.7.0](/ACINQ/eclair/releases/tag/v0.7.0)

# Eclair v0.7.0

This release adds official support for two long-awaited lightning features: anchor outputs and onion messages.

Support for the PostreSQL database backend is also now production ready!

This release also includes a few bug fixes and many new (smaller) features.

It is fully compatible with 0.6.2 (and all previous versions of eclair).

Because this release changes the default type of channels that your node will use, make sure you read the release notes carefully!

The release notes can be found [here](https://github.com/ACINQ/eclair/blob/master/docs/release-notes/eclair-v0.7.0.md).

## Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
## Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 20.04
* AdoptOpenJDK 11.0.6
* Maven 3.8.1

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-0.7.0-a804905-bin.zip` with sha256 checksums that match the one we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not tried everything.

## Upgrading

This release is fully compatible with previous eclair versions. You don't need to close your channels, just stop eclair, upgrade and restart.

### Contributors

* [![@sstone](https://avatars.githubusercontent.com/u/1573866?s=64&v=4)](https://github.com/sstone)

sstone

 Assets
6

 Loading

 🎉
5
 pm47, t-bast, darosior, saubyk, and sstone reacted with hooray emoji
 ❤️
3
 t-bast, darosior, and saubyk reacted with heart emoji
 🚀
3
 t-bast, darosior, and saubyk reacted with rocket emoji

All reactions

* 🎉
  5 reactions
* ❤️
  3 reactions
* 🚀
  3 reactions

 5 people reacted

## Eclair v0.6.2

08 Oct 07:52

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.6.2](/ACINQ/eclair/tree/v0.6.2)

[`6817d6f`](/ACINQ/eclair/commit/6817d6f26ed500c6be39a260159820ce64591ccd)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.6.2)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.6.2](/ACINQ/eclair/releases/tag/v0.6.2)

# Eclair v0.6.2

This releases fixes a known vulnerability, makes several performance improvements, includes a few bug fixes and many new features.

It is fully compatible with 0.6.1 (and all previous versions of eclair).

This release requires a few actions from node operators when upgrading: make sure you read the release notes carefully!

The release notes can be found [here](https://github.com/ACINQ/eclair/blob/master/docs/release-notes/eclair-v0.6.2.md).

## Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
## Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 20.04
* AdoptOpenJDK 11.0.6
* Maven 3.8.1

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-0.6.2-6817d6f-bin.zip` with sha256 checksums that match the one we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not tried everything.

## Upgrading

This release is fully compatible with previous eclair versions. You don't need to close your channels, just stop eclair, upgrade and restart.

### Contributors

* [![@sstone](https://avatars.githubusercontent.com/u/1573866?s=64&v=4)](https://github.com/sstone)

sstone

 Assets
6

 Loading

 👍
2
 redshark03 and akumaigorodski reacted with thumbs up emoji
 ❤️
2
 dpad85 and saubyk reacted with heart emoji

All reactions

* 👍
  2 reactions
* ❤️
  2 reactions

 4 people reacted

## Eclair v0.6.1

19 Jul 14:33

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.6.1](/ACINQ/eclair/tree/v0.6.1)

[`d3ae323`](/ACINQ/eclair/commit/d3ae32326e78729390706998b899ea63a91ecb79)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.6.1)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.6.1](/ACINQ/eclair/releases/tag/v0.6.1)

# Eclair v0.6.1

This release makes major performance improvements, includes a few bug fixes and several new features.

It is fully compatible with 0.6.0 (and all previous versions of eclair).

# Major changes

### Performance improvements

#### Sqlite

Eclair now uses [write-ahead logging](https://sqlite.org/wal.html) in Sqlite ([#1871](https://github.com/ACINQ/eclair/pull/1871)). WAL is better suited to our DB access patterns, and is both much more performant and safer than the default [rollback journal](https://sqlite.org/lockingv3.html#rollback) that we were using previously.

> 1. WAL is significantly faster in most scenarios.
> 2. WAL provides more concurrency as readers do not block writers and a writer does not block readers.
> 3. Disk I/O operations tends to be more sequential using WAL.
> 4. WAL uses many fewer fsync() operations.

This small change improves performance by more than 5x.

#### Payment Handling

Invoice generation ([#1878](https://github.com/ACINQ/eclair/pull/1878)) and handling of incoming payments ([#1880](https://github.com/ACINQ/eclair/pull/1880)) are now processed in parallel, resulting in a higher throughput under load.

### Improved Postgres support

This is the continuation of an effort to make PosgreSQL production-ready. The database schema has been reworked ([#1866](https://github.com/ACINQ/eclair/pull/1866)) and is now better organized, with appropriate types for timestamps ([#1862](https://github.com/ACINQ/eclair/pull/1862)). There have been several concurrency-related bug fixes.

We have also added `JSONB` columns for local channels and for network announcements ([#1865](https://github.com/ACINQ/eclair/pull/1865)). All individual data fields can now be accessed from SQL and indexed, which is very convenient for advanced analysis and tuning of a routing node.

### Upfront shutdown script

This release adds support for `option_upfront_shutdown_script` (feature bits 4/5).

This feature lets you specify a closing address when you open a channel: your peer will ensure that when you close, your funds can only go to that address.

It can be useful to protect against future hacks of your node, because the attacker won't be able to close your channels and send the funds to an address that he controls. However, it doesn't prevent the attacker from exfiltrating funds by paying lightning invoices, so you shouldn't rely on this feature alone to make your node hack-proof.

This option is disabled by default, but can be enabled in your `eclair.conf`.

Note that if you enable it, the closing address will be automatically generated by your `bitcoind` node.

### Transaction publishing improvements

This release reworks our internal transaction publishing architecture (see [#1844](https://github.com/ACINQ/eclair/pull/1844) for details).

The new architecture is more flexible, provides better logging and makes it easy to add dynamic fee bumping in the future for anchor output channels.

It will also make it easier to automatically use CPFP to ensure funding transactions confirm before the [2016 blocks timeout](https://github.com/lightningnetwork/lightning-rfc/pull/839) is reached.

### API changes

This release updates a few APIs:

* `parseinvoice` displays Bolt 11 invoices routing hints ([#1833](https://github.com/ACINQ/eclair/pull/1833))
* Plugins can inject their own routes into the API instead of spawning a separate HTTP server ([#1805](https://github.com/ACINQ/eclair/pull/1805) and [#1819](https://github.com/ACINQ/eclair/pull/1819))

### Miscellaneous improvements and bug fixes

* Eclair now uses Bitcoin Core 0.21.1 by default (#taproot)
* Eclair now supports [warning messages](https://github.com/lightningnetwork/lightning-rfc/pull/834)
* Eclair uses additional entropy on top of the operating system RNG to mitigate random number generation failures ([#1774](https://github.com/ACINQ/eclair/pull/1774))

# Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
# Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 20.04
* AdoptOpenJDK 11.0.6
* Maven 3.8.1

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-0.6.1-XXXXXXX-bin.zip` with sha256 checksums that match the one we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not tried everything.

# Upgrading

This release is fully compatible with eclair v0.6.0. You don't need to close your channels, just stop eclair, upgrade and restart.

# Changelog

[a658fa2](https://github.com/ACINQ/eclair/commit/a658fa26f4ba359923f6e943547ec9a1c4980f54) Set version to 0.6.1-SNAPSHOT ([#1813](https://github.com/ACINQ/eclair/pull/1813))

[76894bd](https://github.com/ACINQ/eclair/commit/76894bd2e1cba226d618ffd28aa38f5da4228f97) Add additional PRNG ([#1774](https://github.com/ACINQ/eclair/pull/1774))

[9a20aad](https://github.com/ACINQ/eclair/commit/9a20aade0a00f6ef4ad01247e34bbc4cbe4101cd) Allow plugins to inject their own routes into API ([#1805](https://github.com/ACINQ/eclair/pull/1805))

[d437ea1](https://github.com/ACINQ/eclair/commit/d437ea1ed1e5dc013dec7b609b3ac4cb160a3116) Improve API plugin support ([#1819](https://github.com/ACINQ/eclair/pull/1819))

[98cae45](https://github.com/ACINQ/eclair/commit/98cae455fbe629cdce165647e19c76c8d2221157) Rename pending\_relay to pending\_commands ([#1822](https://github.com/ACINQ/eclair/pull/1822))

[e8c33ba](https://github.com/ACINQ/eclair/commit/e8c33baf5477c0fabd380e149b79c24dc1d7b9da) Various improvements and fixes ([#1817](https://github.com/ACINQ/eclair/pull/1817))

[f829a2e](https://github.com/ACINQ/eclair/commit/f829a2e8ca15ebcdbe162420921602fe031a9f68) Add json type hints on channel data ([#1824](https://github.com/ACINQ/eclair/pull/1824))

[4dc2910](https://github.com/ACINQ/eclair/commit/4dc2910c4e865d100de3ddb0d28616c6b201f6ed) Make result set an iterable ([#1823](https://github.com/ACINQ/eclair/pull/1823))

[6f6c458](https://github.com/ACINQ/eclair/commit/6f6c458a2d688c9a7ca638c1d957c88dc6c9e008) Add metrics on channels processing time ([#1826](https://github.com/ACINQ/eclair/pull/1826))

[43a89f8](https://github.com/ACINQ/eclair/commit/43a89f8659dff7859a9e496344dc3b719bff5be2) Add a random delay before processing blocks ([#1825](https://github.com/ACINQ/eclair/pull/1825))

[af618bc](https://github.com/ACINQ/eclair/commit/af618bc44fe6054957f65d77000a460c14b41f30) Symmetrical HTLC limits ([#1828](https://github.com/ACINQ/eclair/pull/1828))

[dbecb28](https://github.com/ACINQ/eclair/commit/dbecb28d96d780668fc006aeee2a043a1cc52d10) Include routing hints in parseinvoice API call response ([#1833](https://github.com/ACINQ/eclair/pull/1833))

[2b6d564](https://github.com/ACINQ/eclair/commit/2b6d564d2161176a851908b871d41961261b1a35) Expose eclair datadir to plugins ([#1837](https://github.com/ACINQ/eclair/pull/1837))

[bd6bad1](https://github.com/ACINQ/eclair/commit/bd6bad1bfd8185eea734a3ce29ce2e0d9f9da5a3) Fix eventually statements ([#1835](https://github.com/ACINQ/eclair/pull/1835))

[a7bb2c2](https://github.com/ACINQ/eclair/commit/a7bb2c2b24e6b2495bef98ccf9cc65219f4f40c3) Do not store `CannotAffordFees` errors ([#1834](https://github.com/ACINQ/eclair/pull/1834))

[d4b25d5](https://github.com/ACINQ/eclair/commit/d4b25d565d36627b87c608d474c2500f1f1ec50c) Udpate to Bitcoin Core 0.21.1 ([#1841](https://github.com/ACINQ/eclair/pull/1841))

[e750474](https://github.com/ACINQ/eclair/commit/e750474c727c679321691670150253e2165d35f2) Use bitcoin-lib 0.19 ([#1839](https://github.com/ACINQ/eclair/pull/1839))

[bbfbad5](https://github.com/ACINQ/eclair/commit/bbfbad5975925ed717ea423adb0a63b53f07ca65) Validate payment secret when decoding ([#1840](https://github.com/ACINQ/eclair/pull/1840))

[afb1b41](https://github.com/ACINQ/eclair/commit/afb1b41ea0cbc9aa85ca54b19e4b94bf50690622) Update bolt 3 spec test vectors ([#1669](https://github.com/ACINQ/eclair/pull/1669))

[d43d06f](https://github.com/ACINQ/eclair/commit/d43d06f6e263dc1212515c4f1b25a221adb18079) Rework TxPublisher ([#1844](https://github.com/ACINQ/eclair/pull/1844))

[45204e2](https://github.com/ACINQ/eclair/commit/45204e238052ca1691f9f6486eaf1863ae8836b2) Schedule backup at regular interval ([#1845](https://github.com/ACINQ/eclair/pull/1845))

[85ed433](https://github.com/ACINQ/eclair/commit/85ed4338a3e34d836897a434afa5353ba636e128) Reject 0-value trampoline payments ([#1851](https://github.com/ACINQ/eclair/pull/1851))

[f857368](https://github.com/ACINQ/eclair/commit/f857368ea052158e894568f620fff664a5f2f549) Make trampoline payments use per-channel fee and cltv ([#1853](https://github.com/ACINQ/eclair/pull/1853))

[f52c3dd](https://github.com/ACINQ/eclair/commit/f52c3dd3fca7b7f32a2740b9c866a237f4703c4f) Decode warning messages ([#1854](https://github.com/ACINQ/eclair/pull/1854))

[516929b](https://github.com/ACINQ/eclair/commit/516929b1a360bc62509b42fb5be91e1a6d378dd0) Fix default file backup config ([#1857](https://github.com/ACINQ/eclair/pull/1857))

[4ca5c62](https://github.com/ACINQ/eclair/commit/4ca5c62abbf38109a390b849c3b5a24a75e53c52) Remove println in tests ([#1861](https://github.com/ACINQ/eclair/pull/1861))

[291c128](https://github.com/ACINQ/eclair/commit/291c128cab5e0cd92aad5d48f721f92c3134c898) Reduce some log levels ([#1864](https://github.com/ACINQ/eclair/pull/1864))

[d9a03a5](https://github.com/ACINQ/eclair/commit/d9a03a52b83ad342f06c4eb2f11e7db7af2bcd0a) Use warning messages for connection issues ([#1863](https://github.com/ACINQ/eclair/pull/1863))

[af8394a](https://github.com/ACINQ/eclair/commit/af8394a28031117f0ebfbbdcfca1cf3d1633cdd0) Add support for dual db backend ([#1746](https://github.com/ACINQ/eclair/pull/1746))

[3a573e2](https://github.com/ACINQ/eclair/commit/3a573e267a71a4f1fe91b35065a8d0b96f7f6d69) Improve message for `CannotRetrieveFeerates` error ([#1859](https://github.com/ACINQ/eclair/pull/1859))

[bd57d41](https://github.com/ACINQ/eclair/commit/bd57d41ef3acb755cbb7039603071fec391e5d6a) Add a globalbalance api call ([#1737](https://github.com/ACINQ/eclair/pull/1737))

[08faf3b](https://github.com/ACINQ/eclair/commit/08faf3b7fd05876be358f5ddc2ef6b27d126fd6b) Add json columns in Postgres ([#1865](https://github.com/ACINQ/eclair/pull/1865))

[f8feb19](https://github.com/ACINQ/eclair/commit/f8feb19593a269e42f637c8f9bb8cb0843c9a2cd) Use schemas in Postgres ([#1866](https://github.com/ACINQ/eclair/pull/1866))

[cea3fc0](https://github.com/ACINQ/eclair/commit/cea3fc026da3cc53f0f210fe57501c9ffe8e0c41) Use proper data type for timestamps in Postgres 2 ([#1862](https://github.com/ACINQ/eclair/pull/1862))

[95fffe3](https://github.com/ACINQ/eclair/commit/95fffe348cbd42da70731fbf76f5cae48a97b678) Reduce pg transaction isolation ([#1860](https://github.com/ACINQ/eclair/pull/1860))

[547d7e7](https://github.com/ACINQ/eclair/commit/547d7e700f05960c0f52a79819a94686af186d96) Create chain directory ([#1872](https://github.com/ACINQ/eclair/pull/1872))

[e9df4ee](https://github.com/ACINQ/eclair/commit/e9df4eece09f8757d4e03405b70d1d551bdadff1) Channels data format migration ([#1849](https://github.com/ACINQ/eclair/pull/1849))

[733c6e7](https://github.com/ACINQ/eclair/commit/733c6e768890ef75e0766b5986431a3f2038390c) Refactor global balance tests ([#1874](https://github.com/ACINQ/eclair/pull/1874))

[ca51a2d](https://github.com/ACINQ/eclair/commit/ca51a2d16883d277da41258e527a4ac7a6894bb6) Enable WAL mode on Sqlite ([#1871](https://github.com/ACINQ/eclair/pull/1871))

[3ae9a4a](https://github.com/ACINQ/eclair/commit/3ae9a4ae37297e0527bb83f22135860bcc3e49b3) Additional reestablish test ([#1875](https://github.com/ACINQ/eclair/pull/1875))

[d02760d](https://github.com/ACINQ/eclair/commit/d02760d96fb5f353d9f82ae8582db9e7b67c9654) Fail unsigned outgoing htlcs on force-close ([#1832](https://github.com/ACINQ/eclair/pull/1832))

[3bb7ee8](https://github.com/ACINQ/eclair/commit/3bb7ee8a3eeff9811ff0d88365f0d6bc212bc822) Parallel payment request generation ([#1878](https://github.com/ACINQ/eclair/pull/1878))

[5182402](https://github.com/ACINQ/eclair/commit/51824028b303169be733c216c2f18c531d11887b) Fix flaky channel integration tests ([#1879](https://github.com/ACINQ/eclair/pull/1879))

[b4183ed](https://github.com/ACINQ/eclair/commit/b4183edfa130e81a3c0be624f9331fc9ae4caab1) Fetch incoming payments in parallel ([#1880](https://github.com/ACINQ/eclair/pull/1880))

[8c49f77](https://github.com/ACINQ/eclair/commit/8c49f779ada17ba2e3a061b14f5b54c148101b15) Fix payment handler tests ([#1882](https://github.com/ACINQ/eclair/pull/1882))

[01b4073](https://github.com/ACINQ/eclair/commit/01b40730fe6d58bfba9c37fcc0d6a32c772851e3) Implement option-upfront-shutdown-script ([#1846](https://github.com/ACINQ/eclair/pull/1846))

[79729c7](https://github.com/ACINQ/eclair/commit/79729c78c14fdd2ccea88619d4ed19272964c9b2) Update README ([#1881](https://github.com/ACINQ/eclair/pull/1881))

[c22596b](https://github.com/ACINQ/eclair/commit/c22596bb9243331c8195998738a89d1b0739bf60) Update dependencies and enable fatal warnings ([#1885](https://github.com/ACINQ/eclair/pull/1885))

[adf36de](https://github.com/ACINQ/eclair/commit/adf36de0e154950ef71caa5373a6e85410ab1789) Fix yet another flaky test ([#1886](https://github.com/ACINQ/eclair/pull/1886))

[3f1c250](https://github.com/ACINQ/eclair/commit/3f1c2506a6efe6563a890014b3fa3e4f1f34859b) Fix watcher flaky test ([#1883](https://github.com/ACINQ/eclair/pull/1883))

[c8c5e76](https://github.com/ACINQ/eclair/commit/c8c5e76d2428a37baa4654807275cd1db22af4ba) Update akka-http-json4s dependency ([#1889](https://github.com/ACINQ/eclair/pull/1889))

[5fa8fed](https://github.com/ACINQ/eclair/commit/5fa8fedb980fe034ac890161bd1a957ac0b6e2e3) Set version to 0.6.1 ([#1887](https://github.com/ACINQ/eclair/pull/1887))

 Assets
6

 Loading

 ❤️
4
 andrerfneves, CarlRayer, saubyk, and chewy917 reacted with heart emoji

All reactions

* ❤️
  4 reactions

 4 people reacted

## Eclair v0.6.0

19 May 13:05

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.6.0](/ACINQ/eclair/tree/v0.6.0)

[`f89b092`](/ACINQ/eclair/commit/f89b0925a78f41c059591b3bbabaf1e36078a499)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.6.0)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.6.0](/ACINQ/eclair/releases/tag/v0.6.0)

This release makes some core features mandatory, includes a few important bug fixes and several performance improvements.

It is fully compatible with 0.5.1 (and all previous versions of eclair).

# Major changes

### Mandatory payment secrets

This release makes two important features mandatory:

* `var_onion_optin` (added to the spec in [July 2019](https://github.com/lightningnetwork/lightning-rfc/pull/619))
* `payment_secret` (added to the spec in [December 2019](https://github.com/lightningnetwork/lightning-rfc/pull/643))

These features have been widely deployed and protect against privacy attacks and stealing payments to 0-value invoices (as described [here](https://github.com/lightningnetwork/lightning-rfc/pull/671)).

You won't be able to connect to nodes that don't support these features nor pay invoices that don't include a `payment_secret`.

### Improved detection of stale blocks

Eclair uses [ZMQ](https://zeromq.org/) to receive blocks and transactions from your bitcoin node.

While ZMQ is usually very reliable, we discovered that its pub/sub model has some limitations.

If a subscriber encounters network failures, it will silently disconnect without notifying the publisher.

This never happens when your bitcoin node is on the same machine as eclair, but may happen when bitcoin is running on a remote machine and a VPN is used between the two machines.

Eclair now sets a TCP keep-alive on the ZMQ socket to work around this limitation and quickly reconnect.

The blockchain watchdogs have also been improved to run at fixed intervals if no blocks are received.

They will poll secondary blockchain sources (bitcoinheaders.net, blockstream.info, mempool.space and blockcypher.com) to detect that your eclair node is missing blocks.

### Electrum support removed

This release removes support for using Electrum instead of Bitcoin Core for your bitcoin wallet.

Electrum support was necessary for mobile wallets, but wasn't recommended for server deployments.

Wallets are migrating to our [Kotlin lightning stack](https://github.com/acinq/lightning-kmp), so eclair can now target exclusively server deployments.

Eclair depends on many low-level `bitcoind` RPCs for fee bumping which aren't available yet in Electrum.

### Improved Postgres support

We previously introduced beta support for using [PostgreSQL](https://github.com/ACINQ/eclair/blob/master/docs/PostgreSQL.md) as database backend in eclair v0.4.1.

We've fixed some bugs since then and improved the integration, but please note that PostgreSQL support is still in beta.

We're actively working on finalizing this integration and making PostgreSQL production-ready in a future release.

### Support for future segwit versions

This release adds support for `option_shutdown_anysegwit` (spec PR available [here](https://github.com/lightningnetwork/lightning-rfc/pull/672)).

Current segwit bitcoin addresses (P2WPKH and P2WSH) only use segwit version 0, but this change lets nodes use bitcoin addresses with other version numbers (taproot will use version 1).

### API changes

This release updates a few APIs:

* Features are now displayed as a map (feature name -> support) in API responses ([#1715](https://github.com/ACINQ/eclair/pull/1715))
* Channel internal state tracking force-close scenarios has been enriched ([#1728](https://github.com/ACINQ/eclair/pull/1728))
* A `--blocking=<bool>` option has been added to the `payinvoice` API ([#1751](https://github.com/ACINQ/eclair/pull/1751))

We've also updated our internal API DSL, which paves the way for more plugin integration in a future release.

Head over to our [API documentation](https://acinq.github.io/eclair) for more details.

### Miscellaneous improvements and bug fixes

* Eclair now defaults to Bech32 addresses ([#1717](https://github.com/ACINQ/eclair/pull/1717))
* Anchor output commitment feerate is now configurable ([#1718](https://github.com/ACINQ/eclair/pull/1718))
* All outputs of revoked anchor output commitments are claimed (there is a subtle edge case, see [#1738](https://github.com/ACINQ/eclair/pull/1738))
* Internal codec packages and database versions have been reworked to improve future backwards-compatibility
* Several improvements have been made to our path-finding algorithms, improving tail latency
* A bug affecting reconnections to peers has been fixed ([#1760](https://github.com/ACINQ/eclair/pull/1760))
* A bug affecting transaction outputs ordering (which can lead to channel force-close) has been fixed ([#1806](https://github.com/ACINQ/eclair/pull/1806))

# Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
# Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 20.04
* AdoptOpenJDK 11.0.6
* Maven 3.8.1

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-0.6.0-XXXXXXX-bin.zip` with sha256 checksums that match the one we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not tried everything.

# Upgrading

This release is fully compatible with eclair v0.5.1. You don't need to close your channels, just stop eclair, upgrade and restart.

# Changelog

* [163700a](https://github.com/ACINQ/eclair/commit/163700a2320978120e0aa36c2e4b5a14612c153f) Set version to 0.5.2-SNAPSHOT ([#1714](https://github.com/ACINQ/eclair/pull/1714))
* [844829a](https://github.com/ACINQ/eclair/commit/844829a9b1c31625fc5b8d7651346ba1f049cd98) Features should be a Map ([#1715](https://github.com/ACINQ/eclair/pull/1715))
* [afa378f](https://github.com/ACINQ/eclair/commit/afa378fbb73c265da44856b4ad0f2128a88ae6c6) Fix Bolt 3 spec change that broke our test suite ([#1719](https://github.com/ACINQ/eclair/pull/1719))
* [c4c0248](https://github.com/ACINQ/eclair/commit/c4c0248ee3a1f3b1d76a3823c668ce43f0e5ceea) Use bech32 addresses by default ([#1717](https://github.com/ACINQ/eclair/pull/1717))
* [92e53dc](https://github.com/ACINQ/eclair/commit/92e53dc9a9b2d9f717ac45889ac954681d1da95b) Configurable anchor output max commitment feerate ([#1718](https://github.com/ACINQ/eclair/pull/1718))
* [ea8f940](https://github.com/ACINQ/eclair/commit/ea8f94022e734aaca189ae1288fc00197907a19f) Fix potential race condition in node-relay ([#1716](https://github.com/ACINQ/eclair/pull/1716))
* [9ff2f83](https://github.com/ACINQ/eclair/commit/9ff2f833e7c362ebb22098590fa5028033c2732d) Refactor and simplify API dsl ([#1690](https://github.com/ACINQ/eclair/pull/1690))
* [6364ae3](https://github.com/ACINQ/eclair/commit/6364ae33504f043b398f8444182545352596fa5c) Reject trampoline payments with expired outgoing cltv ([#1727](https://github.com/ACINQ/eclair/pull/1727))
* [2772138](https://github.com/ACINQ/eclair/commit/27721387553d2afa0b0ba2cb12ba8958987de3eb) Better handling of TemporaryChannelFailure ([#1726](https://github.com/ACINQ/eclair/pull/1726))
* [ded5ce0](https://github.com/ACINQ/eclair/commit/ded5ce0e1793315eb3ea5a679e28883773fe2b92) Add metadata to local\_channels table ([#1724](https://github.com/ACINQ/eclair/pull/1724))
* [8dc64db](https://github.com/ACINQ/eclair/commit/8dc64dbaa6e3553559f45feeb22a5e74b391168a) Fix API regression ([#1729](https://github.com/ACINQ/eclair/pull/1729))
* [4bc2dec](https://github.com/ACINQ/eclair/commit/4bc2dec66c806d3001ba5890fa73de8f684bf884) Reorganize internal codecs (master) ([#1732](https://github.com/ACINQ/eclair/pull/1732))
* [6d28cbc](https://github.com/ACINQ/eclair/commit/6d28cbc8e105f3e3d8a6aff5e0b84ae70606f559) Rework XxxCommitPublished types ([#1728](https://github.com/ACINQ/eclair/pull/1728))
* [6e72785](https://github.com/ACINQ/eclair/commit/6e72785d6c52edaeb4ed2e9942cce3dd743f95f6) fixup! Rework XxxCommitPublished types ([#1728](https://github.com/ACINQ/eclair/pull/1728)) ([#1735](https://github.com/ACINQ/eclair/pull/1735))
* [7819fae](https://github.com/ACINQ/eclair/commit/7819faec39083e455045363b0f36a7272e0623d8) Move protocol codecs to their own package ([#1736](https://github.com/ACINQ/eclair/pull/1736))
* [3d3766e](https://github.com/ACINQ/eclair/commit/3d3766ef5691a766fc69a36f83c6618df7739cf1) Clarify some comments and add tests ([#1734](https://github.com/ACINQ/eclair/pull/1734))
* [f39718a](https://github.com/ACINQ/eclair/commit/f39718a3828afa0e1d0d5b3658308d1f8455ea10) Add high-level architecture diagrams ([#1733](https://github.com/ACINQ/eclair/pull/1733))
* [f202587](https://github.com/ACINQ/eclair/commit/f202587e9c71b2106194c0e6cabc8032f6f67df4) Clarify commit tx fee anchor cost ([#1721](https://github.com/ACINQ/eclair/pull/1721))
* [c37eb1a](https://github.com/ACINQ/eclair/commit/c37eb1ad54fc01e013c8cec5ed90c8fdebaf36e2) Handle aggregated anchor outputs htlc txs ([#1738](https://github.com/ACINQ/eclair/pull/1738))
* [e5429eb](https://github.com/ACINQ/eclair/commit/e5429ebdf4f3cd083fb92d5e18af4e0d0c53770f) Avoid visiting vertices multiple times in Dijkstra's algorithm ([#1745](https://github.com/ACINQ/eclair/pull/1745))
* [c6a76af](https://github.com/ACINQ/eclair/commit/c6a76af9d3bfc81315436c9a4c26d9f38e768088) Introduce actor factories ([#1744](https://github.com/ACINQ/eclair/pull/1744))
* [75cb777](https://github.com/ACINQ/eclair/commit/75cb777c61e49afcc9351feeb4114268da9792bf) Prevent loops and improve shortest paths perf ([#1747](https://github.com/ACINQ/eclair/pull/1747))
* [936f36b](https://github.com/ACINQ/eclair/commit/936f36b9fc1679df41bebc1ce9b56fb6ba19fcbc) Refactor Postgres code ([#1743](https://github.com/ACINQ/eclair/pull/1743))
* [ac2b784](https://github.com/ACINQ/eclair/commit/ac2b7843736a04dafe8d2065b9f6a3318cf5a21e) Fix flaky relay-htlc-add test ([#1752](https://github.com/ACINQ/eclair/pull/1752))
* [5729b28](https://github.com/ACINQ/eclair/commit/5729b28912160ec09acd46b28bcc55c142b27f0e) Add blocking option to payinvoice API ([#1751](https://github.com/ACINQ/eclair/pull/1751))
* [89d2489](https://github.com/ACINQ/eclair/commit/89d248929606ce52b4529bc4252149e17a90d77c) Remove Electrum support ([#1750](https://github.com/ACINQ/eclair/pull/1750))
* [b25e552](https://github.com/ACINQ/eclair/commit/b25e5523e7c15c2fddd1f9bbc7fcbc5c8cb02754) Remove Docker test dependency ([#1753](https://github.com/ACINQ/eclair/pull/1753))
* [1321761](https://github.com/ACINQ/eclair/commit/13217610ae3469b0402d881f033163c679064316) Make signing payment requests faster ([#1754](https://github.com/ACINQ/eclair/pull/1754))
* [5f68bf9](https://github.com/ACINQ/eclair/commit/5f68bf92232152c6fd0e1b0a5ee88ed094bfd8c1) Database nits ([#1755](https://github.com/ACINQ/eclair/pull/1755))
* [1e2abae](https://github.com/ACINQ/eclair/commit/1e2abaed0c48f425b04e05ba3bfec50d8b7a6089) Index database metrics by backend ([#1758](https://github.com/ACINQ/eclair/pull/1758))
* [6518bb4](https://github.com/ACINQ/eclair/commit/6518bb47a0ecb3c6ff626891c159212da2c6318a) Posgres: fix concurrency in channels db ([#1762](https://github.com/ACINQ/eclair/pull/1762))
* [3da0b80](https://github.com/ACINQ/eclair/commit/3da0b80cb2b86fdddad24cca504cbd39ee64e9c9) Add a list of community plugins ([#1763](https://github.com/ACINQ/eclair/pull/1763))
* [48c0c4c](https://github.com/ACINQ/eclair/commit/48c0c4c98bcf5e9c41605c3457bb62e6e5e85cca) Extract tx publishing from watchers ([#1749](https://github.com/ACINQ/eclair/pull/1749))
* [357f7f9](https://github.com/ACINQ/eclair/commit/357f7f9942a7e4074e50bc50b3517df866789043) Catch all connection failures and reconnect ([#1760](https://github.com/ACINQ/eclair/pull/1760))
* [205653d](https://github.com/ACINQ/eclair/commit/205653d09293807ab18f84ce026d4d305cbbdc98) Make db errors fatal in channels ([#1764](https://github.com/ACINQ/eclair/pull/1764))
* [ccae92d](https://github.com/ACINQ/eclair/commit/ccae92d7dc4c2cb35119ac8b7e1695728338892d) (Minor) Minimize conflicts with feature branches ([#1765](https://github.com/ACINQ/eclair/pull/1765))
* [eb834e2](https://github.com/ACINQ/eclair/commit/eb834e2522eb71f410f05300f8937a862c4c83dd) Do not explicitly provide address for ServerSocket in tests ([#1766](https://github.com/ACINQ/eclair/pull/1766))
* [d0e79fa](https://github.com/ACINQ/eclair/commit/d0e79fa31a6f9efdf9ba0afa8eea5f336be135fc) Add shorter CI timeout ([#1769](https://github.com/ACINQ/eclair/pull/1769))
* [15ddc17](https://github.com/ACINQ/eclair/commit/15ddc17189b40be7a30969752847c9f70a5db722) Add trampoline info to auditDB ([#1767](https://github.com/ACINQ/eclair/pull/1767))
* [32a86a4](https://github.com/ACINQ/eclair/commit/32a86a476fb3ba4c8a59bffc498802c2eb74a7d0) Ignore tests with ServerSocket ([#1776](https://github.com/ACINQ/eclair/pull/1776))
* [33d52b6](https://github.com/ACINQ/eclair/commit/33d52b6535fa7373ec9e23e02c8316ecf8ed3565) More database nits ([#1773](https://github.com/ACINQ/eclair/pull/1773))
* [e092677](https://github.com/ACINQ/eclair/commit/e092677b9ab5a458db90574ac36f4c72f90f48e4) Rework the db version management ([#1775](https://github.com/ACINQ/eclair/pull/1775))
* [4a1dfd2](https://github.com/ACINQ/eclair/commit/4a1dfd2a27910bac65104f2bb84add6f5c85269a) Reenable ServerSocket tests ([#1777](https://github.com/ACINQ/eclair/pull/1777))
* [e14c40d](https://github.com/ACINQ/eclair/commit/e14c40d7c36d4fd19d84dfeddbd711a9c74b7516) Use proper data type for timestamps in Postgres ([#1778](https://github.com/ACINQ/eclair/pull/1778))
* [62dd393](https://github.com/ACINQ/eclair/commit/62dd3932ff1d60d37280db2b7a91320436ba67a8) Use bouncycastle instead of spongycastle ([#1772](https://github.com/ACINQ/eclair/pull/1772))
* [3669428](https://github.com/ACINQ/eclair/commit/3669428b539126b6d416c83e7dbfb9bf8471dc41) Don't log ClosingType object ([#1781](https://github.com/ACINQ/eclair/pull/1781))
* [223a14c](https://github.com/ACINQ/eclair/commit/223a14cb597d27b64d39c6ce8240aff4b30b0fda) Remove bintray ([#1785](https://github.com/ACINQ/eclair/pull/1785))
* [9e4042f](https://github.com/ACINQ/eclair/commit/9e4042fd4cada70698097837e00ffb0bbb82c129) Migrate ZmqWatcher to akka-typed ([#1759](https://github.com/ACINQ/eclair/pull/1759))
* [90fbcd3](https://github.com/ACINQ/eclair/commit/90fbcd32f34fa94f1585aa09bd9bbef613c04e3f) Index trampoline payments by hash and secret ([#1770](https://github.com/ACINQ/eclair/pull/1770))
* [3079cb4](https://github.com/ACINQ/eclair/commit/3079cb4fc617ad46164c9a47e4aae66e998cea5c) Remove unused class ([#1792](https://github.com/ACINQ/eclair/pull/1792))
* [a8d4e07](https://github.com/ACINQ/eclair/commit/a8d4e07bdde9b5f28ebad291ac3dbef9cc97c759) Use less strict isolation level for channel meta ([#1790](https://github.com/ACINQ/eclair/pull/1790))
* [55b50ec](https://github.com/ACINQ/eclair/commit/55b50ecf4a49adccb975b13f1cc81ee4ae33a566) ZMQ actors should subscribe to a single topic ([#1793](https://github.com/ACINQ/eclair/pull/1793))
* [c641549](https://github.com/ACINQ/eclair/commit/c6415493878d80ba16b6b3d3c38d972ef1d6ba53) Fix computation of path weight ([#1794](https://github.com/ACINQ/eclair/pull/1794))
* [340fd29](https://github.com/ACINQ/eclair/commit/340fd299bb83d747e812da8399a58c642a9b917e) Update default path-finding weight ratios ([#1796](https://github.com/ACINQ/eclair/pull/1796))
* [55a629f](https://github.com/ACINQ/eclair/commit/55a629f11de5fc10066016978eae8a417e427858) Update instructions for downloading Tor Bundle ([#1784](https://github.com/ACINQ/eclair/pull/1784))
* [898c17b](https://github.com/ACINQ/eclair/commit/898c17bc76c1af9077314958612ad96c019bd381) Remove ConnectionControlPlugin trait ([#1797](https://github.com/ACINQ/eclair/pull/1797))
* [0805d51](https://github.com/ACINQ/eclair/commit/0805d51af42c7851a6df0532c362c47f7ee80a45) Do not retry sending if payment gets confirmed on chain ([#1799](https://github.com/ACINQ/eclair/pull/1799))
* [ec276f8](https://github.com/ACINQ/eclair/commit/ec276f8e7827fd39b2998d223aa8795d3dfce5be) Use satoshi for htlc ordering ([#1806](https://github.com/ACINQ/eclair/pull/1806))
* [9c3ee59](https://github.com/ACINQ/eclair/commit/9c3ee59cf830acac0f4903d91fd2df14ab385bc7) Check blockchain watchdogs regularly ([#1808](https://github.com/ACINQ/eclair/pull/1808))
* [9141998](https://github.com/ACINQ/eclair/commit/91419980bd8f761be6177b9cec900a8b38ae5490) Make payment\_secret mandatory ([#1810](https://github.com/ACINQ/eclair/pull/1810))
* [1fbede7](https://github.com/ACINQ/eclair/commit/1fbede761854c15a71834c150db3a106d6199b57) Add TCP keep-alive on ZMQ socket ([#1807](https://github.com/ACINQ/eclair/pull/1807))
* [5a92f84](https://github.com/ACINQ/eclair/commit/5a92f847447f5bb6cb110228778bc4648788fe3b) Add support for option\_shutdown\_anysegwit ([#1801](https://github.com/ACINQ/eclair/pull/1801))
* [e2b3b47](https://github.com/ACINQ/eclair/commit/e2b3b4735d26c98561490422ccf162adb4e9e816) Update Tor doc for Windows ([#1811](https://github.com/ACINQ/eclair/pull/1811))
* [f746ade](https://github.com/ACINQ/eclair/commit/f746ade343b040b1dfae1c0bceeb177073befeb0) Set version to 0.6.0 ([#1812](https://github.com/ACINQ/eclair/pull/1812))

Special thanks to [@tompro](https://github.com/tompro) who reworked our internal API DSL.

 Assets
6

 Loading

All reactions

## Eclair v0.5.1

03 Mar 12:33

![@t-bast](https://avatars.githubusercontent.com/u/31281497?s=40&v=4)
[t-bast](/t-bast)

[v0.5.1](/ACINQ/eclair/tree/v0.5.1)

[`98bb7be`](/ACINQ/eclair/commit/98bb7be70a4fc96242409b90fbf1ec9c5ff470e6)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/ACINQ/eclair/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.5.1)

 Loading

[View all tags](/ACINQ/eclair/tags)

[Eclair v0.5.1](/ACINQ/eclair/releases/tag/v0.5.1)

This release includes many bug fixes and improvements, a new API and monitoring updates.

It is fully compatible with 0.5.0 (and all previous versions of eclair).

# Major changes

### Improved startup performance

When eclair starts up and restores channels, it makes a lot of calls to `bitcoind` to check the status of each channel.

We improved our calling pattern to greatly reduce the number of calls made when some channels are closing.

This is particularly noticeable when the mempool is quite full and you have many channels.

See [#1699](https://github.com/ACINQ/eclair/pull/1699) for details.

### Gossip sync improvements

Most of the bandwidth consumed by lightning nodes is due to gossip (syncing the network graph).

When your eclair node has a lot of peers and doesn't use a `sync-whitelist`, you may end up syncing with many different peers and obtaining redundant information, thus wasting bandwidth.

Eclair now only syncs with peers you have a channel with to reduce bandwidth usage.

### Anchor outputs

This release contains a lot of changes for the upcoming anchor outputs commitment format:

* the feerate of the commitment transaction is kept low to improve off-chain channel usage
* transactions with multiple inputs and outputs are now supported
* CPFP and RBF utilities have been added to increase the feerate of commitment and htlc transactions

While you can start experimenting with this commitment format, it is still not safe to activate in production.

Anchor outputs is a complex and subtle change that requires re-architecting most of our transaction broadcasting logic and utxo management.

We are making steady progress towards that, but we're not there yet.

### Monitoring changes

Kamon tracing has been removed in this release.

It was too invasive in the codebase, generally unused and was costing some bandwidth.

We've found that metrics and logs are enough to correctly monitor your eclair node.

Additional metrics to monitor transaction signing have been added.

The rate of transaction signatures is a good indicator of how busy your node is.

### API changes

This release adds a new path-finding API:

* `findroutebetweennodes` lets you inspect the network graph by looking for routes between two nodes (whereas `findroute` only allowed finding routes between your node and a remote node)

Head over to our [API documentation](https://acinq.github.io/eclair) for more details.

### Miscellaneous improvements and bug fixes

* Correctly sort addresses in its `node_announcement` ([#1693](https://github.com/ACINQ/eclair/pull/1693))
* Allow 2016 blocks before unconfirmed channels are forgotten ([#1692](https://github.com/ACINQ/eclair/pull/1692))
* Re-emit private channel updates more frequently, improving payments to mobile wallets ([#1671](https://github.com/ACINQ/eclair/pull/1671))
* Correctly handle channel failures in private routing hints, fixing an edge case for payments to mobile wallets ([#1675](https://github.com/ACINQ/eclair/pull/1675))
* Drop support for `initial_routing_sync`: this was bandwidth-heavy and now unnecessary ([#1683](https://github.com/ACINQ/eclair/pull/1683))
* Fix an MPP-send edge-case ([#1685](https://github.com/ACINQ/eclair/pull/1685))
* Fix race condition between outgoing payment and peer disconnection ([#1688](https://github.com/ACINQ/eclair/pull/1688))
* Fix race condition between `update_fee` and `shutdown`, which could lead to channels stuck in `shutdown` ([#1661](https://github.com/ACINQ/eclair/pull/1661))
* Ensure transactions we publish always meet bitcoin's `min_relay_fee` ([#1687](https://github.com/ACINQ/eclair/pull/1687))
* Fix an edge case where an HTLC failure was not correctly relayed upstream if `revoke_and_ack` had not been received ([#1706](https://github.com/ACINQ/eclair/pull/1706))

# Verifying signatures

You will need `gpg` and our release signing key 7A73FE77DE2C4027. Note that you can get it:

* from our website: <https://acinq.co/pgp/drouinf.asc>
* from github user [@sstone](https://github.com/sstone), a committer on eclair: <https://api.github.com/users/sstone/gpg_keys>

To import our signing key:

```
$ gpg --import drouinf.asc
```

To verify the release file checksums and signatures:

```
$ gpg -d SHA256SUMS.asc > SHA256SUMS.stripped
$ sha256sum -c SHA256SUMS.stripped
```
# Building

Eclair builds are deterministic. To reproduce our builds, please use the following environment (\*):

* Ubuntu 19.10
* AdoptOpenJDK 11.0.6
* Maven 3.6.3

Use the following command to generate the eclair-node package:

```
mvn clean install -DskipTests
```

That should generate `eclair-node/target/eclair-node-0.5.1-XXXXXXX-bin.zip` with sha256 checksums that match the one we provide and sign in `SHA256SUMS.asc`

(\*) You may be able to build the exact same artefacts with other operating systems or versions of JDK 11, we have not tried everything.

# Upgrading

This release is fully compatible with Eclair v0.5.0. You don't need to close your channels, just stop eclair, upgrade and restart.

# Changelog

* [923ca26](https://github.com/ACINQ/eclair/commit/923ca26fece3a2a47ea77e9af538f1550e7dbe69) Set version to 0.5.1-SNAPSHOT ([#1651](https://github.com/ACINQ/eclair/pull/1651))
* [b75f6c3](https://github.com/ACINQ/eclair/commit/b75f6c36e9bab8b77702e16f2514d9accc47cd8d) Fix duplicate commit id in awseb bundle ([#1650](https://github.com/ACINQ/eclair/pull/1650))
* [5f9d0d9](https://github.com/ACINQ/eclair/commit/5f9d0d9108b09110710bd4049e9c69423c220390) Relax cltv-expiry-delta requirement when selecting a channel to relay ([#1655](https://github.com/ACINQ/eclair/pull/1655))
* [dd8975a](https://github.com/ACINQ/eclair/commit/dd8975aebe5051028373a53998f503ac1008b6e9) Make ChannelVersion methods public ([#1656](https://github.com/ACINQ/eclair/pull/1656))
* [7343283](https://github.com/ACINQ/eclair/commit/7343283f9fe90773c6659d0ec35ceecafa6c3b9d) Add test for duplicate temporary channel id ([#1660](https://github.com/ACINQ/eclair/pull/1660))
* [629c2e6](https://github.com/ACINQ/eclair/commit/629c2e69cad54b07b602252b575e6a9203d498c3) Fix rare race conditions in integration tests ([#1653](https://github.com/ACINQ/eclair/pull/1653))
* [b477d17](https://github.com/ACINQ/eclair/commit/b477d179ea0572672d93849a9c260ca91130819f) Update build instructions for front ([#1658](https://github.com/ACINQ/eclair/pull/1658))
* [e369ba9](https://github.com/ACINQ/eclair/commit/e369ba9a1e419e7a3fe4af240fc5d38904ee1f58) More aggressively re-emit private channel updates ([#1671](https://github.com/ACINQ/eclair/pull/1671))
* [d40b321](https://github.com/ACINQ/eclair/commit/d40b321d92895ac09222de84ebd7dd9095c8af20) Blockchain watchdogs use unique actor name ([#1667](https://github.com/ACINQ/eclair/pull/1667))
* [9c4ab7d](https://github.com/ACINQ/eclair/commit/9c4ab7d923a8e6947689c0129a2bfc6169aff657) Fix HTLC fulfill race condition in integration spec ([#1666](https://github.com/ACINQ/eclair/pull/1666))
* [81f15aa](https://github.com/ACINQ/eclair/commit/81f15aabd99c8aaa0e6c418b9ff80ac7fb682bce) Refactor and improve some channel tests ([#1654](https://github.com/ACINQ/eclair/pull/1654))
* [54ca292](https://github.com/ACINQ/eclair/commit/54ca292209357f5b346efdd5bfb0c1fc55ca186f) Remove kamon tracing ([#1662](https://github.com/ACINQ/eclair/pull/1662))
* [34e901d](https://github.com/ACINQ/eclair/commit/34e901db75aa99799c7fd0530ad8ba013504fc0a) Clarify default relay fee change ([#1673](https://github.com/ACINQ/eclair/pull/1673))
* [c75d914](https://github.com/ACINQ/eclair/commit/c75d91436d32336930e5c8a2e5202f1a2ae478d1) Fix failing reconnection tests ([#1678](https://github.com/ACINQ/eclair/pull/1678))
* [0127ace](https://github.com/ACINQ/eclair/commit/0127ace4088d2c0a5829596f7c929df2d7352f23) Remote failure updating routing hint ([#1675](https://github.com/ACINQ/eclair/pull/1675))
* [ac054a2](https://github.com/ACINQ/eclair/commit/ac054a2bb26e8e765c4d41092ea1732169d211f2) Only sync with channel peers ([#1587](https://github.com/ACINQ/eclair/pull/1587))
* [d053188](https://github.com/ACINQ/eclair/commit/d05318832f054649d37ee7cc74ccf7686f9455e7) Truncate hex strings in front logs ([#1679](https://github.com/ACINQ/eclair/pull/1679))
* [4902362](https://github.com/ACINQ/eclair/commit/49023625b2f8702aa46d0315a16b5e1c26d5a9fe) Refactor channel test helpers ([#1682](https://github.com/ACINQ/eclair/pull/1682))
* [f241ef9](https://github.com/ACINQ/eclair/commit/f241ef933b9f0b731b0c9d23043f4328526126c5) Remove support for initial\_routing\_sync ([#1683](https://github.com/ACINQ/eclair/pull/1683))
* [63d972b](https://github.com/ACINQ/eclair/commit/63d972bdc6d648279d009c9c2b33dda3175976c6) Fix a few typos ([#1684](https://github.com/ACINQ/eclair/pull/1684))
* [5d3958d](https://github.com/ACINQ/eclair/commit/5d3958dd03a7cc6314e1b91182f14fa0e9fa12b6) Fix MPP path-finding edge case ([#1685](https://github.com/ACINQ/eclair/pull/1685))
* [15c1837](https://github.com/ACINQ/eclair/commit/15c1837d846f63b76f1320a5fe55b974c3d0a2de) Add tx signing metrics ([#1659](https://github.com/ACINQ/eclair/pull/1659))
* [72179de](https://github.com/ACINQ/eclair/commit/72179de0a459fcbc0b6b86972435b0e12b243ac0) PaymentLifecycle handle disconnected peers ([#1688](https://github.com/ACINQ/eclair/pull/1688))
* [fdeb3ce](https://github.com/ACINQ/eclair/commit/fdeb3ce7e13c5d9cfc1b73e208b6d2e8a1eec61f) Correctly set gossip sync\_complete ([#1668](https://github.com/ACINQ/eclair/pull/1668))
* [36e8c05](https://github.com/ACINQ/eclair/commit/36e8c056f19f30904a7a7e4bad68f7e0f7491420) Shutdown and UpdateFee should not be intertwined ([#1661](https://github.com/ACINQ/eclair/pull/1661))
* [2a359c6](https://github.com/ACINQ/eclair/commit/2a359c6a567a0fbec87010e77c91c17a3f3a8b7b) Publish txs with min-relay-fee met ([#1687](https://github.com/ACINQ/eclair/pull/1687))
* [82e5b59](https://github.com/ACINQ/eclair/commit/82e5b5968da8bc41c0e0a44303e65883ce4c9aa2) Sort addresses in node announcement ([#1693](https://github.com/ACINQ/eclair/pull/1693))
* [3a94a80](https://github.com/ACINQ/eclair/commit/3a94a8044738231e657e5cf9faec647af7ff7933) Reject unreasonable remote dust limit ([#1694](https://github.com/ACINQ/eclair/pull/1694))
* [fdb57b4](https://github.com/ACINQ/eclair/commit/fdb57b43d3c5a0ae6edfc09fe28ce263186bb6db) Find route between nodes ([#1695](https://github.com/ACINQ/eclair/pull/1695))
* [9618a6a](https://github.com/ACINQ/eclair/commit/9618a6a79c511817a424f648a9b599a9d42d8740) Add a maximum fee threshold for anchor outputs ([#1672](https://github.com/ACINQ/eclair/pull/1672))
* [ab89851](https://github.com/ACINQ/eclair/commit/ab89851cdf0dd18af73e71e3c5a6a0e0ceceab04) Relax single tx input requirements ([#1677](https://github.com/ACINQ/eclair/pull/1677))
* [0835150](https://github.com/ACINQ/eclair/commit/083515086fe23655bd0acda916d1918284577535) Update funding timeout fundee ([#1692](https://github.com/ACINQ/eclair/pull/1692))
* [d9c0b86](https://github.com/ACINQ/eclair/commit/d9c0b862bb9c97bedaa76c1a6bdce48a9e2dcc3c) Refactor bitcoin clients ([#1697](https://github.com/ACINQ/eclair/pull/1697))
* [5163749](https://github.com/ACINQ/eclair/commit/5163749a9aca6e0e3e295a1ff50b35d0abcd1af7) [eclair-cli] Use multiplatform escape sequence
* [fa759f1](https://github.com/ACINQ/eclair/commit/fa759f1e6b079ae381e5d5f245905d5279aa26d2) Fix PaymentLifecycle warning ([#1703](https://github.com/ACINQ/eclair/pull/1703))
* [c1bf9bd](https://github.com/ACINQ/eclair/commit/c1bf9bd100a620c439b65adc81556bcc7b66f2c2) Optimize watching for spending txs ([#1699](https://github.com/ACINQ/eclair/pull/1699))
* [d02b900](https://github.com/ACINQ/eclair/commit/d02b900a0c89e990194a5da00df47f1cf4c49f39) Fix annoying compiler warning ([#1704](https://github.com/ACINQ/eclair/pull/1704))
* [a3c477e](https://github.com/ACINQ/eclair/commit/a3c477e3f7de531686ed3d1195650aa2aaa75d2f) Address all intellij warnings for Channel.scala ([#1705](https://github.com/ACINQ/eclair/pull/1705))
* [bf2a35f](https://github.com/ACINQ/eclair/commit/bf2a35f74cf79ce4f76e095916db43d9b4345ec6) Relay partially failed htlcs when closing ([#1706](https://github.com/ACINQ/eclair/pull/1706))
* [5d662fc](https://github.com/ACINQ/eclair/commit/5d662fc3d7aa91ed7906aa21e0f9c2ffc5cf4b78) Set anchor output feerates when force-closing ([#1702](https://github.com/ACINQ/eclair/pull/1702))
* [8065d0b](https://github.com/ACINQ/eclair/commit/8065d0bb8072591d835d54d0b2454eeb84a00443) Add a serializer for `DoSync` ([#1708](https://github.com/ACINQ/eclair/pull/1708))
* [8d4da2f](https://github.com/ACINQ/eclair/commit/8d4da2faadb5966710e83e33736a946b1df93b9a) Improve channel state tests ([#1709](https://github.com/ACINQ/eclair/pull/1709))
* [2646886](https://github.com/ACINQ/eclair/commit/264688622fbfad0a998c0f29b301cc59c7490632) fixup! Improve channel state tests ([#1709](https://github.com/ACINQ/eclair/pull/1709)) ([#1712](https://github.com/ACINQ/eclair/pull/1712))
* [3479669](https://github.com/ACINQ/eclair/commit/347966912190bd49cf603365c50508d119aefee8) Disable jdbc instrumentation by default ([#1713](https://github.com/ACINQ/eclair/pull/1713))
* [98bb7be](https://github.com/ACINQ/eclair/commit/98bb7be70a4fc96242409b90fbf1ec9c5ff470e6) Set version to 0.5.1 ([#1707](https://github.com/ACINQ/eclair/pull/1707))

Thanks to our new contributors, [@tompro](https://github.com/tompro) and [@ariskk](https://github.com/ariskk)!

 Assets
6

 Loading

All reactions

Previous *1* [2](/ACINQ/eclair/releases?page=2) [3](/ACINQ/eclair/releases?page=3) [4](/ACINQ/eclair/releases?page=4) [Next](/ACINQ/eclair/releases?page=2)

Previous [Next](/ACINQ/eclair/releases?page=2)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


