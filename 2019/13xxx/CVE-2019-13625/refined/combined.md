=== Content from github.com_ab88d232_20250120_231354.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNationalSecurityAgency%2Fghidra%2Fissues%2F71)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNationalSecurityAgency%2Fghidra%2Fissues%2F71)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=NationalSecurityAgency%2Fghidra)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[NationalSecurityAgency](/NationalSecurityAgency)
/
**[ghidra](/NationalSecurityAgency/ghidra)**
Public

* [Notifications](/login?return_to=%2FNationalSecurityAgency%2Fghidra) You must be signed in to change notification settings
* [Fork
  6k](/login?return_to=%2FNationalSecurityAgency%2Fghidra)
* [Star
   53.2k](/login?return_to=%2FNationalSecurityAgency%2Fghidra)

* [Code](/NationalSecurityAgency/ghidra)
* [Issues
  1.4k](/NationalSecurityAgency/ghidra/issues)
* [Pull requests
  272](/NationalSecurityAgency/ghidra/pulls)
* [Discussions](/NationalSecurityAgency/ghidra/discussions)
* [Actions](/NationalSecurityAgency/ghidra/actions)
* [Wiki](/NationalSecurityAgency/ghidra/wiki)
* [Security](/NationalSecurityAgency/ghidra/security)
* [Insights](/NationalSecurityAgency/ghidra/pulse)

Additional navigation options

* [Code](/NationalSecurityAgency/ghidra)
* [Issues](/NationalSecurityAgency/ghidra/issues)
* [Pull requests](/NationalSecurityAgency/ghidra/pulls)
* [Discussions](/NationalSecurityAgency/ghidra/discussions)
* [Actions](/NationalSecurityAgency/ghidra/actions)
* [Wiki](/NationalSecurityAgency/ghidra/wiki)
* [Security](/NationalSecurityAgency/ghidra/security)
* [Insights](/NationalSecurityAgency/ghidra/pulse)

# Project handling is susceptible to XXE¬†#71

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Project handling is susceptible to XXE](#top)#71Copy linkAssignees [![nsadeveloper789](https://avatars.githubusercontent.com/u/46821332?s=64&v=4)](/nsadeveloper789)Labels[Type: BugSomething isn't working](https://github.com/NationalSecurityAgency/ghidra/issues?q=state%3Aopen%20label%3A%22Type%3A%20Bug%22)Something isn't workingMilestone[9.0.1](https://github.com/NationalSecurityAgency/ghidra/milestone/1)![@sghctoma](https://avatars.githubusercontent.com/u/214533?u=dd4017ef098ccebdbf1725e0106f97f2431a773e&v=4&size=80)
## Description

![@sghctoma](https://avatars.githubusercontent.com/u/214533?u=dd4017ef098ccebdbf1725e0106f97f2431a773e&v=4&size=48)[sghctoma](https://github.com/sghctoma)opened [on Mar 6, 2019](https://github.com/NationalSecurityAgency/ghidra/issues/71#issue-418014263)

**Describe the bug**

Project open/restore is susceptible to XML External Entity Expansion attacks. This can be exploited in various ways by getting someone to open/restore a project prepared by attacker.

**To Reproduce**

Steps to reproduce the behavior:

1. Create a project, and close it.
2. Put an XXE payload in any of the XML files in the project directory (see screenshot for example).
3. Open the project.
4. Observe your payload doing its thing.

The same concept works with archived projects (.gar files) too.

**Expected behavior**

The XML parser should ignore external entities. For bonus points, it should give an error/warning when they are present.

**Screenshots**

The following screenshot was made of a proof of concept that only issues an HTTP GET request to localhost.

[![Ghidra XXE PoC](https://camo.githubusercontent.com/3d1e9b5ff85f797814f7a4cd09bef8580934962b379938b76db1d962674fb1fd/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f44314149686d32586341414f627a4a2e6a70673a6c61726765)](https://camo.githubusercontent.com/3d1e9b5ff85f797814f7a4cd09bef8580934962b379938b76db1d962674fb1fd/68747470733a2f2f7062732e7477696d672e636f6d2f6d656469612f44314149686d32586341414f627a4a2e6a70673a6c61726765)

**Environment (please complete the following information):**

* OS: Kali Linux Rolling
* JDK Version: OpenJDK 11.0.2 (11.0.2+9-Debian-3)
* Ghidra Version 9.0
üëç24‚ù§Ô∏è1
## Metadata

### Assignees

* [![@nsadeveloper789](https://avatars.githubusercontent.com/u/46821332?s=64&v=4)nsadeveloper789](/nsadeveloper789)
### Labels

[Type: BugSomething isn't working](https://github.com/NationalSecurityAgency/ghidra/issues?q=state%3Aopen%20label%3A%22Type%3A%20Bug%22)Something isn't working
### Type

No type
### Projects

No projects
### Milestone

* [9.0.1](https://github.com/NationalSecurityAgency/ghidra/milestone/1)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from blog.fxiao.me_c658f1fd_20250120_231353.html ===


[Feng's Blog](/)
#

* [Home](http://fxiao.me)
* [Blog](/)
* [Archives](/archives/)

## Do Not Trust! Ghidra Arbitrary Command Execution Through Project Sharing

Posted on
2019-07-15

Archiving the intermediate analysis result and sharing with other researchers is a common practice in the field of binary analysis. Popular disassemblers such as IDA and Ghidra also provide the project archiving functionality to help researchers communicating their results. However, it turns out that such project sharing is not secure (at all). For example, researchers have found that an XXE vulnerability existed in the project parsing logic of Ghidra, which can be abused to achieve arbitrary file read or even command execution on a particular platform(i.e., Windows). In this post, we are presenting an even more powerful exploit chain discovered in Ghidra, which can be exploited via a malicious project archive to execute arbitrary code in the victim machine no matter what platform he is using.

## Vulnerablity Description

A path traversal vulnerability exists in RestoreTask.java from package ghidra.app.plugin.core.archive. This vulnerability allows attackers to overwrite arbitrary files on the system. To achieve arbitrary code execution, one of the solutions is to overwrite some critical ghidra modules, e.g., decompile module (In this case we need to know the installation path of ghidra).

## Exploit Analysis

The arbitrary code execution exploit chain consists of two nodes. The first node overwrites arbitrary files in the system, and the second node executes the malware containing in the crafted project file.

### Overwrite Arbitrary File

In Ghidra, every project is a jar archive file. When restoring a project, Ghidra will extract the project files and store them in the file system. However, Ghidra doesn‚Äôt check whether the file name of every archive entity is legal or not. By inserting a malicious binary with a file name starting with **../**, attackers are able to let ghidra overwrite arbitrary files on the system.

The vulnerability locates at Ghidra/Features/Base/src/main/java/ghidra/app/plugin/core/archive/RestoreTask.java
The **unjarArchive** method iterates every file entity in the project archive and stores it on the file system directly using its original filename recording in the archive.

| ``` 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152 ``` | ``` private void unjarArchive(TaskMonitor monitor) throws IOException {    JarInputStream jarIn = new JarInputStream(new FileInputStream(jarFile));    JarReader reader = new JarReader(jarIn);    // position input stream to the entry after the .gpr entry since    // we don't want to create that file    jarIn.getNextJarEntry();    // the next entry should be JAR_FORMAT    jarIn.getNextJarEntry();    File projectFile = projectLocator.getMarkerFile();    File projectDir = projectLocator.getProjectDir();    if (projectFile.exists()) {        throw new DuplicateFileException("Project already exists: " + projectFile);    }    if (projectDir.exists()) {        throw new DuplicateFileException("Project already exists: " + projectDir);    }    reader.createRecursively(projectDir.getAbsolutePath() + File.separator, monitor);    jarIn.close();    if (monitor.isCancelled()) {        return;    }    // Remove unwanted project properties file - will get re-created when project is opened    File file = new File(projectDir, ArchivePlugin.PROJECT_PROPERTY_FILE);    file.delete();    // Remove unwanted project state file    file = new File(projectDir, ArchivePlugin.PROJECT_STATE_FILE);    file.delete();    // Remove unwanted project state save directory    file = new File(projectDir, ArchivePlugin.OLD_PROJECT_SAVE_DIR);    FileUtilities.deleteDir(file);    // Remove unwanted project groups directory    file = new File(projectDir, ArchivePlugin.OLD_PROJECT_GROUPS_DIR);    FileUtilities.deleteDir(file);    // Remove unwanted folder property files    removeOldFolderProperties(projectDir);    // create the .gpr file for the new project    if (!projectFile.createNewFile()) {        throw new IOException("Couldn't create file " + projectFile.getAbsolutePath());    }} ``` |
| --- | --- |

### Code Execution

As demonstrated by the following code, the DecompileProcess.java locating in the ghidra.app.decompiler package will executes the **decompile** under GHIDRA\_INSTALL\_DIR/Ghidra/Features/Decompiler/os/YOUR\_ARCH/ folder. This method will be called when ghidra is initiated and start to decompile the binary.

| ``` 12345678910111213141516171819202122232425262728 ``` | ``` private void setup() throws IOException {    if (disposestate != DisposeState.NOT_DISPOSED) {        throw new IOException("Decompiler has been disposed");    }    if (nativeProcess != null) {        // Something bad happened to the process or the interface        // and now we try to restart                    nativeProcess.destroy(); // Make sure previous bad process is killed                            nativeProcess = null;    }    if (exepath == null) {        throw new IOException("Could not find decompiler executable");    }    try {        nativeProcess = runtime.exec(exepath);        nativeIn = nativeProcess.getInputStream();        nativeOut = nativeProcess.getOutputStream();        statusGood = true;    }    catch (IOException e) {        disposestate = DisposeState.DISPOSED_ON_STARTUP_FAILURE;        statusGood = false;        Msg.showError(this, null, "Problem launching decompiler",            "Please report this stack trace to the Ghidra Team", e);        throw e;    }} ``` |
| --- | --- |

## Attack Demo

Here is a demo of the attack behavior. [Youtube](https://youtu.be/RGqQMUd9hZM)

[How to heap?](/how-to-heap/ "How to heap?")

* Table of Contents
* Overview

![Feng Xiao](/images/avatar.jpg)

Feng Xiao

[5
posts](/archives/)

[GitHub](https://github.com/xiaofen9 "GitHub")

E-Mail

1. [1. Vulnerablity Description](#Vulnerablity-Description)
2. [2. Exploit Analysis](#Exploit-Analysis)
   1. [2.1. Overwrite Arbitrary File](#Overwrite-Arbitrary-File)
   2. [2.2. Code Execution](#Code-Execution)
3. [3. Attack Demo](#Attack-Demo)

¬© 2018 ‚Äî 2019

Feng Xiao



=== Content from xlab.tencent.com_30c4c76c_20250120_231356.html ===

[![Tencent Security Xuanwu Lab](/en/assest/XuanwuLogo.svg)](/en/.)

* [Home](/en/)
  [Advisories](/en/category/advisories/)
  [Disclosure Policy](/en/policy/)
  [About](/en/about/)
  [√§¬∏¬≠√¶¬ñ¬á√ß¬â¬à](/cn/)

# Ghidra From XXE to RCE

2019-03-18

Authors: tomato, salt of Tencent Security Xuanwu Lab

### 0x00 Background

Ghidra is a generic disassembler and decompiler released by the NSA. It attracted wide interest from the security community.
Security researchers have since found an XXE vulnerability in the Ghidra project loading process.
Based on our prior research on XXE vulnerability exploitation, we found that attackers can abuse Java features and weaknesses in NTLM protocol in Windows operating system to achieve remote code execution.

### 0x01 Technical Details

When sending HTTP requests using Java built-in class `sun.net.www.protocol.http.HttpURLConnection`, it will automatically determine authentication method when encounters a 401 status code.
If authentication method is NTLM, it will automatically authenticate using current user credentials.
The root cause is Java on Windows enables transparent NTLM authentication by default, and treats all URL as trusted, as shown in the following code block.
`sun.net.www.protocol.http.AuthScheme#NTLM`

| ``` 1234567891011 ``` | ``` if (tryTransparentNTLMServer) {    tryTransparentNTLMServer =            NTLMAuthenticationProxy.supportsTransparentAuth;    /* If the platform supports transparent authentication     * then check if we are in a secure environment     * whether, or not, we should try transparent authentication.*/    if (tryTransparentNTLMServer) {        tryTransparentNTLMServer =                NTLMAuthenticationProxy.isTrustedSite(url);    }} ``` |
| --- | --- |

Inside `NTLMAuthenticationProxy.isTrustedSite` method

| ``` 123456789 ``` | ``` public static boolean isTrustedSite(URL url) {    try {        return (Boolean)isTrustedSite.invoke(null, url);    } catch (ReflectiveOperationException roe) {        finest(roe);    }    return false;} ``` |
| --- | --- |

It calls `isTrustedSite` method in `sun.net.www.protocol.http.ntlm.NTLMAuthentication` using reflection, which trusts all URLs.
Attackers can deploy a HTTP Server with NTLM authentication to gather Net-NTLM Hash of current user.
The NTLM authentication protocol has weaknesses.

There is a well-known NTLM Relay attack, which has been widely discussed and not in the scope of this article.
In our scenario, we use a credential reflection attack, which relays victim√¢¬Ä¬ôs Net-NTLM Hash back to victim.

Let√¢¬Ä¬ôs look at the details.
Attacker first deploy a HTTP server with NTLM authentication enabled. And use an XXE/SSRF vulnerability to force a NTLM authentication from the victim.
It worth noticing that the NTLM has two versions, NTLMv1 and NTLMv2.
When authenticating with NTLMv1, attacker can directly relay the Net-NTLM Hash to the victim√¢¬Ä¬ôs SMB service.
In the SMBv2 case, attacker must first modify the Negotiate Flags in the Type 2 Message to unset Negotiate Always Sign and Negotiate 0x00004000 flags.
This transforms it from local authentication to network authentication, and also strips the signature.

We wrote a [proof of concept script](https://github.com/5alt/ultrarelay.git) to demonstrate this attack.

### 0x03 Reproduction

Victim
Oracle JDK 8u161, Windows 10, Administrator

Attacker
Ubuntu 16.04, IP 192.168.130.136

First execute script on attacker√¢¬Ä¬ôs machine

| ``` 1 ``` | ``` python ultrarelay.py -ip 192.168.130.136 -smb2support ``` |
| --- | --- |

The script will serve HTTP requests on port 80.

Make a new Ghidra project. Edit the project file project.prp to insert a XXE exploit, as shown below:
![](/en/uploads/2019/03/1552652887618.png)

When victim use Ghidra to open this malicious project, attacker can obtain NTLM Hash from the victim√¢¬Ä¬ôs machine, therefore execute arbitrary command on victim√¢¬Ä¬ôs machine.

### 0x04 Mitigations

1. Use Windows Firewall to block incoming SMB requests.
2. If SMB server is required, enable SMB Sign.
3. Upgrade to latest version of JDK

### 0x05 References

<https://twitter.com/sghctoma/status/1103392091009413120>

<https://conference.hitb.org/hitbsecconf2018dxb/materials/D2T2%20-%20NTLM%20Relay%20Is%20Dead%20Long%20Live%20NTLM%20Relay%20-%20Jianing%20Wang%20and%20Junyu%20Zhou.pdf>

[Deep Analysis of CVE-2019-8014: The Vulnerability Ignored 6 Years Ago
Prev](/en/2019/09/12/deep-analysis-of-cve-2019-8014/)
[Investigating WinRAR Code Execution Vulnerability (CVE-2018-20250) at Internet Scale
Next](/en/2019/02/22/investigating-winrar-code-execution-vulnerability-cve-2018-20250-at-internet-scale/)

¬©
2015 -
2024
Tencent Security Xuanwu Lab. All Rights Reserved.


