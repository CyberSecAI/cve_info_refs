=== Content from bugzilla.nasm.us_728c71c9_20250121_004105.html ===


Bugzilla – Bug 3392638
An StackOverflow was discovered in the function expr3 in asm/eval.c in nasm-2.14.02
Last modified: 2019-12-08 22:49:48 PST

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](docs/en/html/using/understanding.html)
* |
  [Log In](show_bug.cgi?id=3392638&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=3392638&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

Self-registration is disabled due to spam issue (mail gorcunov@gmail.com or hpa@zytor.com to create an account)

[**Bug 3392638**](show_bug.cgi?id=3392638)
- An StackOverflow was discovered in the function expr3 in asm/eval.c in nasm-2.14.02

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
An StackOverflow was discovered in the function expr3 in asm/eval.c in nasm-2...

| | [Status](page.cgi?id=fields.html#bug_status): | OPEN | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | NASM | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=NASM "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Assembler ([show other bugs](buglist.cgi?component=Assembler&product=NASM&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.14.xx | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | Medium normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | nobody | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2019-12-08 22:38 PST by libbin | | --- | --- | | Modified: | 2019-12-08 22:49 PST ([History](show_activity.cgi?id=3392638)) | | CC List: | 5 users (show)  binbinli.bit chang.seok.bae gorcunov hpa nasm-bugs | |  | | | [Obtained from:](page.cgi?id=fields.html#cf_build "Please indicate where you obtained and/or built your version of NASM.") | Build from source archive using configure | | [Generated by:](page.cgi?id=fields.html#cf_robot "Was this bug report generated by an automatic tool, such as a memory leak detector or fuzzer, *without* including a human validation description or analysis of the problem?") | --- | | [Bug category:](page.cgi?id=fields.html#cf_category "The general category of this bug oor request.") |  | | [Breaks existing code:](page.cgi?id=fields.html#cf_breaks "This bug report breaks existing code in production or under development.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**PoC to trigger the Segmentation fault**](attachment.cgi?id=411752 "View the content of the attachment") (24.92 KB, text/plain)  [2019-12-08 22:38 PST](#attach_411752 "Go to the comment associated with the attachment"), libbin | [Details](attachment.cgi?id=411752&action=edit) | | [Add an attachment](attachment.cgi?bugid=3392638&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=3392638&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=3392638#c0)  libbin    2019-12-08 22:38:43 PST  ``` Created [attachment 411752](attachment.cgi?id=411752 "PoC to trigger the Segmentation fault") [[details]](attachment.cgi?id=411752&action=edit "PoC to trigger the Segmentation fault") PoC to trigger the Segmentation fault  This stackoverflow was discovered in asm/eval.c when we were fuzzing nasm (releasebuilds 2.14.02).  (gdb) file nasm Reading symbols from nasm...done. (gdb) run -felf ./input/seed1 Starting program: /home/lbb/afl-experient/Tests/ASAN/nasm-2.14.02/nasm -felf ./input/seed1 Program received signal SIGSEGV, Segmentation fault. expr2 (critical=critical@entry=0) at asm/eval.c:482 482     e = expr3(critical);  (gdb) info stack #0  expr2 (critical=critical@entry=0) at asm/eval.c:482 #1  0x0000000000422941 in expr1 (critical=critical@entry=0) at asm/eval.c:456 #2  0x0000000000422cc1 in expr0 (critical=0) at asm/eval.c:430 #3  0x0000000000420233 in expr6 (critical=critical@entry=0) at asm/eval.c:857 #4  0x0000000000421139 in expr5 (critical=critical@entry=0) at asm/eval.c:567 #5  0x000000000042201c in expr4 (critical=critical@entry=0) at asm/eval.c:542 #6  0x0000000000422101 in expr3 (critical=critical@entry=0) at asm/eval.c:508 #7  0x00000000004225c1 in expr2 (critical=critical@entry=0) at asm/eval.c:482 #8  0x0000000000422941 in expr1 (critical=critical@entry=0) at asm/eval.c:456 #9  0x0000000000422cc1 in expr0 (critical=0) at asm/eval.c:430 ...   In addtion, we use Address Sanitizer print the stack information. ASAN dumps the stack trace as follows:  @root ./nasm -felf ./input/seed1 ASAN:SIGSEGV ================================================================= ==25297==ERROR: AddressSanitizer: stack-overflow on address 0x7ffd73117f78 (pc 0x000000453306 bp 0x0fffae622ff2 sp 0x7ffd73117f70 T0)     #0 0x453305 in stdscan asm/stdscan.c:130     #1 0x44c993 in expr6 asm/eval.c:856     #2 0x44e39e in expr5 asm/eval.c:567     #3 0x44fa8a in expr4 asm/eval.c:542     #4 0x44fbd0 in expr3 asm/eval.c:508     #5 0x45027a in expr2 asm/eval.c:482     #6 0x45072a in expr1 asm/eval.c:456     #7 0x450bda in expr0 asm/eval.c:430     #8 0x44c9a2 in expr6 asm/eval.c:857     #9 0x44e39e in expr5 asm/eval.c:567     #10 0x44fa8a in expr4 asm/eval.c:542     #11 0x44fbd0 in expr3 asm/eval.c:508     #12 0x45027a in expr2 asm/eval.c:482     #13 0x45072a in expr1 asm/eval.c:456     #14 0x450bda in expr0 asm/eval.c:430     #15 0x44c9a2 in expr6 asm/eval.c:857     #16 0x44e39e in expr5 asm/eval.c:567     ...     #249 0x44fbd0 in expr3 asm/eval.c:508     #250 0x45027a in expr2 asm/eval.c:482     #251 0x45072a in expr1 asm/eval.c:456  SUMMARY: AddressSanitizer: stack-overflow asm/stdscan.c:130 stdscan ==25297==ABORTING ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=3392638)
* - [XML](show_bug.cgi?ctype=xml&id=3392638)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=3392638)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [Log In](show_bug.cgi?id=3392638&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=3392638&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from bugzilla.nasm.us_4c0b3a99_20250121_004102.html ===


Bugzilla – Bug 3392548
Stack exhaustion problem resulting from infinite recursion in the functions expr6, expr5, expr4, expr3, expr2, expr1, expr0 in eval.c
Last modified: 2023-04-24 00:24:27 PDT

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](docs/en/html/using/understanding.html)
* |
  [Log In](show_bug.cgi?id=3392548&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=3392548&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

Self-registration is disabled due to spam issue (mail gorcunov@gmail.com or hpa@zytor.com to create an account)

[**Bug 3392548**](show_bug.cgi?id=3392548)
- Stack exhaustion problem resulting from infinite recursion in the functions expr6, expr5, expr4, expr3, expr2, expr1, expr0 in eval.c

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Stack exhaustion problem resulting from infinite recursion in the functions e...

| | [Status](page.cgi?id=fields.html#bug_status): | OPEN | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | NASM | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=NASM "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Assembler ([show other bugs](buglist.cgi?component=Assembler&product=NASM&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.14.xx | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | Medium normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | nobody | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2019-01-02 23:11 PST by Cheng Wen | | --- | --- | | Modified: | 2023-04-24 00:24 PDT ([History](show_activity.cgi?id=3392548)) | | CC List: | 8 users (show)  anselmo.melo Archana.Polampalli chang.seok.bae gorcunov hpa nasm-bugs rwmacleod wcventure | |  | | | [Obtained from:](page.cgi?id=fields.html#cf_build "Please indicate where you obtained and/or built your version of NASM.") | Build from source archive using configure | | [Generated by:](page.cgi?id=fields.html#cf_robot "Was this bug report generated by an automatic tool, such as a memory leak detector or fuzzer, *without* including a human validation description or analysis of the problem?") | --- | | [Bug category:](page.cgi?id=fields.html#cf_category "The general category of this bug oor request.") |  | | [Breaks existing code:](page.cgi?id=fields.html#cf_breaks "This bug report breaks existing code in production or under development.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**POC1**](attachment.cgi?id=411705 "View the content of the attachment") (2.22 KB, application/octet-stream)  [2019-01-02 23:11 PST](#attach_411705 "Go to the comment associated with the attachment"), Cheng Wen | [Details](attachment.cgi?id=411705&action=edit) | | [**POC2**](attachment.cgi?id=411706 "View the content of the attachment") (2.33 KB, application/octet-stream)  [2019-01-02 23:12 PST](#attach_411706 "Go to the comment associated with the attachment"), Cheng Wen | [Details](attachment.cgi?id=411706&action=edit) | | [Add an attachment](attachment.cgi?bugid=3392548&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=3392548&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=3392548#c0)  Cheng Wen    2019-01-02 23:11:32 PST  ``` Created [attachment 411705](attachment.cgi?id=411705 "POC1") [[details]](attachment.cgi?id=411705&action=edit "POC1") POC1  Hi there,  An infinite recursion was discovered in eval.c in Libasm, as distributed in Netwide Assembler (NASM) 2.14.03rc1. There is a stack exhaustion problem resulting from infinite recursion in the functions expr6, expr5, expr4, expr3, expr2, expr1, expr0 in eval.c, in certain scenarios involving lots of '{' characters.  Here is the POC file. Please use the “./nasm -f bin $POC -o /dev/null” to reproduce the bug. Command：“./nasm -f bin $POC -o /dev/null ”   $git log  > commit 81f98fe79be23174e2d6ddd9f17a5cfb9ca71ec7 > Author: H. Peter Anvin <hpa@zytor.com> > Date:   Thu Dec 27 11:34:12 2018 -0800 >  >     NASM 2.14.03rc1   The ASAN dumps the stack trace as follows:  > AddressSanitizer:DEADLYSIGNAL > ================================================================= > ==191091==ERROR: AddressSanitizer: stack-overflow on address 0x7ffeca6c9bb8 (pc 0x0000005d8ced bp 0x7ffeca6ca2b0 sp 0x7ffeca6c9bc0 T0) >     #0 0x5d8cec in stdscan /nasm/asm/stdscan.c:126 >     #1 0x5cba62 in scan /nasm/asm/eval.c:263:17 >     #2 0x5ccaa0 in expr6 /nasm/asm/eval.c:914:9 >     #3 0x5d3b20 in expr5 /nasm/asm/eval.c:627:9 >     #4 0x5d36fd in expr4 /nasm/asm/eval.c:602:9 >     #5 0x5d2fbd in expr3 /nasm/asm/eval.c:563:9 >     #6 0x5d2b4d in expr2 /nasm/asm/eval.c:537:9 >     #7 0x5d26dd in expr1 /nasm/asm/eval.c:511:9 >     #8 0x5d226d in expr0 /nasm/asm/eval.c:485:9 >     #9 0x5d1270 in rexp3 /nasm/asm/eval.c:422:9 >     #10 0x5d0d7d in rexp2 /nasm/asm/eval.c:396:9 >     #11 0x5d086d in rexp1 /nasm/asm/eval.c:369:9 >     #12 0x5d037d in rexp0 /nasm/asm/eval.c:342:9 >     #13 0x5cfe5d in cexpr /nasm/asm/eval.c:305:9 >     #14 0x5cbabd in bexpr /nasm/asm/eval.c:298:12 >     #15 0x5ccaab in expr6 /nasm/asm/eval.c:915:13 >     #16 0x5d3b20 in expr5 /nasm/asm/eval.c:627:9 >     #17 0x5d36fd in expr4 /nasm/asm/eval.c:602:9 >     #18 0x5d2fbd in expr3 /nasm/asm/eval.c:563:9 >     #19 0x5d2b4d in expr2 /nasm/asm/eval.c:537:9 >     #20 0x5d26dd in expr1 /nasm/asm/eval.c:511:9 >     #21 0x5d226d in expr0 /nasm/asm/eval.c:485:9 >     #22 0x5d1270 in rexp3 /nasm/asm/eval.c:422:9 >     #23 0x5d0d7d in rexp2 /nasm/asm/eval.c:396:9 >     #24 0x5d086d in rexp1 /nasm/asm/eval.c:369:9 >     #25 0x5d037d in rexp0 /nasm/asm/eval.c:342:9 >     #26 0x5cfe5d in cexpr /nasm/asm/eval.c:305:9 >     #27 0x5cbabd in bexpr /nasm/asm/eval.c:298:12 >     #28 0x5ccaab in expr6 /nasm/asm/eval.c:915:13 >     #29 0x5d3b20 in expr5 /nasm/asm/eval.c:627:9 >     #30 0x5d36fd in expr4 /nasm/asm/eval.c:602:9 >     #31 0x5d2fbd in expr3 /nasm/asm/eval.c:563:9 >     #32 0x5d2b4d in expr2 /nasm/asm/eval.c:537:9 >     #33 0x5d26dd in expr1 /nasm/asm/eval.c:511:9 >     ... >     ... >     #245 0x5d086d in rexp1 /nasm/asm/eval.c:369:9 >     #246 0x5d037d in rexp0 /nasm/asm/eval.c:342:9 >     #247 0x5cfe5d in cexpr /nasm/asm/eval.c:305:9 >     #248 0x5cbabd in bexpr /nasm/asm/eval.c:298:12 >     #249 0x5ccaab in expr6 /nasm/asm/eval.c:915:13 >  > SUMMARY: AddressSanitizer: stack-overflow /nasm/asm/stdscan.c:126 in stdscan > ==191091==ABORTING ```  [Comment 1](show_bug.cgi?id=3392548#c1)  Cheng Wen    2019-01-02 23:12:12 PST  ``` Created [attachment 411706](attachment.cgi?id=411706 "POC2") [[details]](attachment.cgi?id=411706&action=edit "POC2") POC2 ```  [Comment 2](show_bug.cgi?id=3392548#c2)  Cheng Wen    2019-01-02 23:20:08 PST  ``` This is simply running out of stack space. You can make the number of recursions go up by 11,000 or so by dynamically allocating variables instead of using stack space, but at the end of the day, you can work around this (for this test case) by doing:  > ulimit -s 8192  Of course, a much larger (deeper) ASM file will still make it crash. You can thus, make it happen far faster by doing:  > ulimit -s 256  The crash does not seem to happen due to any buffer overflows or memory corruption; it's simply the kernel saying "you're out of stack space, please die". One simple way to avoid the crash itself is to do a depth-check of the tree and compare it to some value related to the stack size returned and produce an error if the values are way out of whack.  A more complicated solution would involve removing recursion, which looks like it would not be a trivial fix. ```  [Comment 3](show_bug.cgi?id=3392548#c3)  Cheng Wen    2019-01-02 23:23:15 PST  ``` To fix such errors, there are some classic study cases.  Similar cases occur in binutils v2.31, too. Too fix this problem, for example, binutils v2.32 add a recursion limit to libiberty's demangling code. The limit is enabled by default, but can be disabled via a new demangling option.  See <https://gcc.gnu.org/bugzilla/show_bug.cgi?id=87336> ```  [Comment 4](show_bug.cgi?id=3392548#c4)  Randy MacLeod    2019-07-17 09:27:04 PDT  ``` Cheng,  Thanks for presenting your analysis of the defect. It is trivially handled by the user as you say but a default recursion limit would be nice. Do you plan to implement that feature to fight off the CVE hounds? Thanks, Randy ```  [Comment 5](show_bug.cgi?id=3392548#c5)  Polampalli, Archana    2023-04-24 00:24:27 PDT  ``` Hi Cheng,  Could you please confirm is this fixed on nasm-v2.16.01   Thanks in advance ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=3392548)
* - [XML](show_bug.cgi?ctype=xml&id=3392548)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=3392548)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [Log In](show_bug.cgi?id=3392548&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=3392548&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


