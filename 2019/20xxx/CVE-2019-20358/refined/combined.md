=== Content from nmap.org_9ba698e9_20250121_031830.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[Download](/download.html)
[Reference Guide](/book/man.html)
[Book](/book/)
[Docs](/docs.html)
[Zenmap GUI](/zenmap/)
[In the Movies](/movies/)

[Get Nmap 7.95 here](/download)
## News

* Nmap.org has been redesigned! Our new mobile-friendly layout is also on [Npcap.com](https://npcap.com),
  [Seclists.org](https://seclists.org),
  [Insecure.org](https://insecure.org), and
  [Sectools.org](https://sectools.org).* Nmap 7.90 has been released with Npcap 1.00 along with dozens of other performance improvements, bug fixes, and feature enhancements! [[Release Announcement](https://seclists.org/nmap-announce/2020/1) | [Download page](https://nmap.org/download.html)]* After more than 7 years of development and 170 public pre-releases, we're delighted to announce Npcap version 1.00! [[Release Announcement](https://seclists.org/nmap-announce/2020/0) | [Download page](https://nmap.org/npcap/)]* Nmap 7.80 was released for DEFCON 27! [[release notes](https://seclists.org/nmap-announce/2019/0) | [download](https://nmap.org/download.html)]* Nmap turned 20 years old on September 1, 2017! Celebrate by reading [the original Phrack #51 article](/p51-11.html). [#Nmap20](https://twitter.com/hashtag/Nmap20)!* Nmap 7.50 is now available! [[release notes](https://seclists.org/nmap-announce/2017/3) | [download](https://nmap.org/download.html)]* Nmap 7 is now available! [[release notes](/7/) | [download](https://nmap.org/download.html)]* We're pleased to release our new and Improved [Icons of the Web](/favicon/) project—a 5-gigapixel interactive collage of the top million sites on the Internet!* Nmap has been discovered in two new movies! It's used to [hack Matt Damon's brain in Elysium](movies/#elysium) and also to [launch nuclear missiles in G.I. Joe: Retaliation](movies/#gijoe)!* We're delighted to announce Nmap 6.40 with 14 new [NSE scripts](/book/nse.html), hundreds of new [OS](/book/osdetect.html) and [version detection](/book/vscan.html) signatures, and many great new features! [[Announcement/Details](https://seclists.org/nmap-announce/2013/1)], [[Download Site](https://nmap.org/download.html)]* We just released Nmap 6.25 with 85 new NSE scripts, performance improvements, better OS/version detection, and more! [[Announcement/Details](https://seclists.org/nmap-hackers/2012/4)], [[Download Site](https://nmap.org/download.html)]* Any release as big as Nmap 6 is bound to uncover a few bugs. We've now fixed them with [Nmap 6.01](https://seclists.org/nmap-hackers/2012/3)!* Nmap 6 is now available! [[release notes](/6/) | [download](https://nmap.org/download.html)]* The security community has spoken! 3,000 of you shared favorite security tools for our relaunched [SecTools.Org](https://sectools.org). It is sort of like Yelp for security tools. Are you familiar with all of the [49 new tools](https://sectools.org/tag/new/) in this edition?* [Nmap 5.50 Released](https://seclists.org/nmap-hackers/2011/0): Now with Gopher protocol support! Our first stable release in a year includes 177 NSE scripts, 2,982 OS fingerprints, and 7,319 version detection signatures. Release focuses were the Nmap Scripting Engine, performance, Zenmap GUI, and the Nping packet analysis tool. [[Download page](https://nmap.org/download) | [Release notes](https://seclists.org/nmap-hackers/2011/0)]* Those who missed Defcon can now watch Fyodor and David Fifield demonstrate the power of the Nmap Scripting Engine. They give an overview of NSE, use it to explore Microsoft's global network, write an NSE script from scratch, and hack a webcam--all in 38 minutes! ([Presentation video](/presentations/BHDC10/))* *Icons of the Web*: explore favicons for the top million web sites with our [new poster and online viewer](/favicon).* We're delighted to announce the immediate, free availability of the [Nmap Security Scanner version 5.00](/5/). Don't miss the [top 5 improvements in Nmap 5](/5/#5changes).* After years of effort, we are delighted to release [Nmap Network Scanning: The Official Nmap Project Guide to Network Discovery and Security Scanning](/book/)!* We now have an active Nmap [Facebook page](http://facebook.com/nmap) and [Twitter feed](http://twitter.com/nmap/) to augment the [mailing lists](#lists). All of these options offer RSS feeds as well.

# Nmap: Discover your network

Nmap ("Network Mapper") is a
[free and open source](/npsl/) utility for
network discovery and security auditing. Many systems and network
administrators also find it useful for tasks such as network
inventory, managing service upgrade schedules, and monitoring host or
service uptime. Nmap uses raw IP packets in novel ways to determine
what hosts are available on the network, what services (application
name and version) those hosts are offering, what operating systems
(and OS versions) they are running, what type of packet
filters/firewalls are in use, and dozens of other characteristics. It
was designed to rapidly scan large networks, but works fine against
single hosts. Nmap runs on all major computer operating systems, and
official binary packages are available for Linux, Windows, and Mac OS
X. In addition to the classic command-line Nmap executable, the Nmap
suite includes an advanced GUI and results viewer
([Zenmap](/zenmap/)), a flexible data
transfer, redirection, and debugging tool
([Ncat](/ncat/)), a utility for
comparing scan results ([Ndiff](/ndiff/)), and a packet generation and response analysis tool ([Nping](/nping/)).

Nmap was named “Security Product of the Year” by Linux
Journal, Info World, LinuxQuestions.Org, and Codetalker Digest. It
was even featured in [twelve
movies](/movies/), including
[The Matrix Reloaded](/movies/#matrix),
[Die Hard 4](/movies/#diehard4),
[Girl With the Dragon Tattoo](/movies/#gwtdt),
and
[The Bourne Ultimatum](/movies/#bourne).

Nmap is ...

* Nmap
  Security
  Port Scanner
* **Flexible**: Supports dozens of advanced techniques for
  mapping out networks filled with IP filters, firewalls, routers, and
  other obstacles. This includes many [port scanning](/book/man-port-scanning-techniques.html) mechanisms (both TCP &
  UDP), [OS
  detection](/book/osdetect.html), [version detection](/book/vscan.html), ping sweeps, and more. See the [documentation page](/docs.html).* **Powerful**: Nmap has been used to scan huge networks of
    literally hundreds of thousands of machines.* **Portable**: Most operating systems are supported, including
      Linux,
      Microsoft Windows,
      FreeBSD,
      OpenBSD,
      Solaris,
      IRIX,
      Mac OS X,
      HP-UX,
      NetBSD,
      Sun OS,
      Amiga,
      and more.* **Easy**: While Nmap offers a rich set of advanced features for
        power users, you can start out as simply as "nmap -v -A *targethost*". Both traditional command line and graphical (GUI)
        versions are available to suit your preference. Binaries are
        available for those who do not wish to compile Nmap from source.* **Free**: The primary goals of the Nmap Project is to help make
          the Internet a little more secure and to provide
          administrators/auditors/hackers with an advanced tool for exploring
          their networks. Nmap is available for [free download](https://nmap.org/download.html), and also comes with full
          source code that you may modify and redistribute under the terms of
          the [license](data/COPYING).* **Well Documented**: Significant effort has been put into
            comprehensive and up-to-date man pages, whitepapers, tutorials, and
            even a whole book! Find them in multiple
            languages [here](/docs.html).* **Supported**: While Nmap comes with no warranty, it is well supported by a vibrant community of developers and users. Most of this interaction occurs on the [Nmap mailing lists](#lists). Most bug reports and questions should be sent to the [nmap-dev list](https://seclists.org/nmap-dev), but only after you read the [guidelines](/book/man-bugs.html). We recommend that all users subscribe to the low-traffic [nmap-hackers](https://seclists.org/nmap-hackers) announcement list. You can also find Nmap on [Facebook](http://facebook.com/nmap) and [Twitter](http://twitter.com/nmap). For real-time chat, join the #nmap channel on [Freenode](http://freenode.net/) or [EFNet](http://www.efnet.org/).* **Acclaimed**: Nmap has won numerous awards, including
                "Information Security Product of the Year" by Linux Journal, Info
                World and Codetalker Digest. It has been featured in hundreds of
                magazine articles, several movies, dozens of books, and one comic book
                series. Visit the [press page](nmap_inthenews.html)
                for further details.* **Popular**: Thousands of people download Nmap every day, and
                  it is included with many operating systems (Redhat Linux, Debian
                  Linux, Gentoo, FreeBSD, OpenBSD, etc). It is among the top ten (out of
                  30,000) programs at the Freshmeat.Net repository. This is important
                  because it lends Nmap its vibrant development and user support
                  communities.

## Communication

Nmap users are encouraged to subscribe to the *Nmap-hackers*
mailing list. It is a low volume (6 posts in 2017), moderated list
for the most important announcements about Nmap, Insecure.org, and
related projects. You can join more than 128,000 current subscribers
by submitting your email address here:

(or subscribe with custom options from the [Nmap-hackers list info page](https://nmap.org/mailman/listinfo/announce))

We also have a development list for more hardcore members
(especially programmers) who are interested in helping the project by
helping with coding, testing, feature ideas, etc. New (test/beta)
versions of Nmap are sometimes released here prior to general
availability for QA purposes. You can subscribe at the [Nmap-dev list
info page](https://nmap.org/mailman/listinfo/dev).

Both lists are archived (along with many other security lists) at [Seclists.org](https://seclists.org).

Though it isn't nearly as active as the mailing lists, the official IRC channel is #nmap on [Freenode](http://freenode.net/) (irc.freenode.net).

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from success.trendmicro.com_4304a3d7_20250121_011053.html ===


![web](https://content.powerapps.com/resource/powerappsportal/img/web.png)
You’re offline. This is a read only version of the page.
![close](https://content.powerapps.com/resource/powerappsportal/img/close.png)

[![Trend Micro Business Success Portal](/trendmicro_logo.webp)

Business Success](/)

* Products
* Resources
* [FAQ](/faq/)
* [Contact](/contactus/)

* [Log in](/SignIn)

#### Featured

Resources

---

* [Automation Center](https://automation.trendmicro.com/)
* [Education Portal](https://education.trendmicro.com/customer/learn)
* [Online Help Center](https://docs.trendmicro.com/en-US/documentation/)
* [Service Status](https://status.trendmicro.com/s/)
* [TrendConnect](https://success.trendmicro.com/trendconnect/)

---

### Automation Center

Trend Micro Automation Center is a central hub for APIs and documentation across Trend Micro products. It offers searchable cross-product APIs and use cases for IT and security teams to automate tasks and improve efficiency.

[Learn more](https://automation.trendmicro.com/)

### Education Portal

The Education Portal serves as a comprehensive resource for Trend Micro employees to develop their professional capabilities. Through a variety of curated training modules, employees can deepen their understanding of company culture, product knowledge, processes, and essential soft skills.

[Learn more](https://education.trendmicro.com/customer/learn)

### Online Help Center

The Trend Micro Online Help Center provides customers with comprehensive product information and troubleshooting guidance. It offers general product usage information and in-depth solutions for complex issues.

[Learn more](https://docs.trendmicro.com/en-US/documentation/%20)

### Service Status

Trend Micro Service Status Portal provides real-time information on the performance of Trend Micro products. It offers up-to-date incident reports and historical data for monitoring system health.

[Learn more](https://status.trendmicro.com/s/)

### TrendConnect

TrendConnect is a mobile application that provides users with real-time insights into their Trend Micro security environment, including threat alerts and system health assessments.

[Learn more](/trendconnect)

* Products
* Resources
* + [Service Status](https://status.trendmicro.com/s/)
  + [Education Portal](https://education.trendmicro.com/customer/learn)
  + [Automation Center](https://automation.trendmicro.com/)
  + [Online Help Center](https://docs.trendmicro.com/en-US/documentation/%20)
  + [TrendConnect](/trendconnect)
* [FAQ](/faq/)
* [Contact](/contactus/)
* [Log in](/Signin)
* + [Dashboard](/dashboard/)
  + [Profile](/profile/)
  + [Switch Account](/switch-account)
  + [Logout](/Account/Login/LogOff)

* [Home](/)
* Article unavailable

# Article unavailable

The requested knowledge article is unavailable. Please contact your portal administrator.

Feedback

Send us your feedback!
How was your experience on this website?

Satisfied

Neutral

Poor

Cancel

Submit

Thank you for your feedback

##### Support & Help

* [FAQ](/en-US/faq/)
* [Contact by Sales](https://www.trendmicro.com/en_us/business/get-info-form.html)

##### Resources

* [Automation Center](https://automation.trendmicro.com/)
* [Download Center](http://downloadcenter.trendmicro.com/)
* [Education Portal](https://education.trendmicro.com/customer/learn)
* [Online Help Center](https://docs.trendmicro.com/en-US/documentation/)
* [Service Status](https://status.trendmicro.com/s/%20)
* [TrendConnect Mobile App](/trendconnect)

##### Policies & Vulnerability

* [Support Policies](/en-US/support-policy/)
* [Legal Policies & Privacy](https://www.trendmicro.com/en_us/about/legal.html)
* [Vulnerability Response](/en-US/vulnerability-response/)

##### About Trend

* [Trend Micro](https://www.trendmicro.com/en_us/business.html)
* [Home & Home Office Support](https://helpcenter.trendmicro.com/en-us/)
* [Partner Portal](https://community-trendmicro.force.com/Gpartner/s/login/?language=en_US)
* [Trend Micro YouTube Channel](https://www.youtube.com/channel/UCyRUBssUwx5mpUM7ctVNr-A)

Copyright ©  Trend Micro Incorporated. All rights reserved.



=== Content from seclists.org_7412cb54_20250121_011051.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](49)
[By Date](date.html#50)
[![Next](/images/right-icon-16x16.png)](51)

[![Previous](/images/left-icon-16x16.png)](49)
[By Thread](index.html#50)
[![Next](/images/right-icon-16x16.png)](51)

![](/shared/images/nst-icons.svg#search)

# [CVE-2019-20358] CVE-2019-9491 in Trend Micro Anti-Threat Toolkit (ATTK) was NOT properly FIXED

---

*From*: "Stefan Kanthak" <stefan.kanthak () nexgo de>

*Date*: Thu, 30 Jan 2020 10:29:46 +0100

---

```
Hi @ll,

on September 29, 2019, John Page reported a remote code execution
with escalation of privilege in TrendMicro's Anti-Threat Toolkit
to its vendor.
TrendMicro assigned CVE-2019-9491 to this vulnerability and told
the reporter, his dog and the world on October 18, 2019, that they
had fixed the vulnerable product.

See <<https://success.trendmicro.com/solution/000149878>>,
<<https://seclists.org/fulldisclosure/2019/Oct/42>> and
<<http://hyp3rlinx.altervista.org/advisories/TREND-MICRO-ANTI-THREAT-TOOLKIT->(ATTK)-REMOTE-CODE-EXECUTION.txt>

TrendMicro's claim was but wrong, the vulnerability was NOT FIXED!

The files attk_ScanCleanOffline_gui_x86.exe, attk_collector_cli_x86.exe,
attk_ScanCleanOffline_gui_x64.exe and attk_collector_cli_x64.exe
offered on <<https://spnsupport.trendmicro.com/>> were STILL vulnerable,
as was their payload!

Vulnerability #1:
~~~~~~~~~~~~~~~~~

On a fully patched Windows 7 SP1, the executable self-extractors
attk_ScanCleanOffline_gui_x86.exe, attk_collector_cli_x86.exe,
attk_ScanCleanOffline_gui_x64.exe and attk_collector_cli_x64.exe
loaded and executed at least the following DLLs from their
"application directory", typically the user's "Downloads" folder
%USERPROFILE%\Downloads\, instead from Windows' "system directory"
%SystemRoot%\System32\
    VERSION.dll, IPHLPAPI.dll, WINNSI.dll, WINHTTP.dll, WEBIO.dll,
    DHCPCSVC.dll, CRYPTSP.dll, BCRYPT.dll, NCRYPT.dll, DNSAPI.dll,
    RASADHLP.dll, PROPSYS.dll, APPHELP.dll

On other versions of Windows this list varied, but some DLLs were
ALWAYS loaded from the "application directory"!

This BEGINNER's error is well-known and well-documented since MORE
than 20 years:
see <<https://capec.mitre.org/data/definitions/471.html>>,
<<https://cwe.mitre.org/data/definitions/426.html>>,
<<https://cwe.mitre.org/data/definitions/427.html>>,
<<https://blogs.msdn.microsoft.com/david_leblanc/2008/02/20/dll-preloading-attacks/>>,
<<https://insights.sei.cmu.edu/cert/2008/09/carpet-bombing-and-directory-poisoning.html>>,
<<http://www.binaryplanting.com/index.htm>>,
<<https://attack.mitre.org/wiki/Technique/T1073>>,
<<https://skanthak.homepage.t-online.de/sentinel.html>>,
<<https://skanthak.homepage.t-online.de/verifier.html>>,
<[https://skanthak.homepage.t-online.de/!execute.html](https://skanthak.homepage.t-online.de/%21execute.html)>,
<<https://skanthak.homepage.t-online.de/minesweeper.html>>

Demonstration/Proof of concept:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Follow <<https://skanthak.homepage.t-online.de/minesweeper.html>>,
build a "minefield" of forwarder DLLs, then copy attk_*.exe into
the directory where you built the DLLs and execute it: enjoy the
multiple message boxes displayed from the forwarder DLLs.

Vulnerability #2:
~~~~~~~~~~~~~~~~~

On all versions of Windows, the batch script batCollector.bat,
unpacked from the executable extractors, which controls execution
of the TrendMicro AntiThreat Toolkit itself, executed
    findstr.com/findstr.exe/findstr.bat/findstr.cmd
plus
    REG.com/REG.exe/REG.bat/REG.cmd
(see the environment variable PATHEXT for the extensions) from
the directory
    "TrendMicro AntiThreat Toolkit\HC_ATTK"
where the batch script batCollector.bat lives:

--- batCollector.bat ---

| @echo off
| setlocal disableDelayedExpansion
| set wd=%~dp0
| cd /d %wd%
...
| for /f "tokens=*" %%a in ('findstr BatCollector= ..\..\config.ini') do (
...
| REG EXPORT ...
...

findstr and REG are called in the script without file extension and
without path (although BOTH are well-known), so CMD.exe runs
findstr.com/findstr.exe/findstr.bat/findstr.cmd and
REG.com/REG.exe/REG.bat/REG.cmd from its "current working directory"
"TrendMicro AntiThreat Toolkit\HC_ATTK"

The missing path and extension are BEGINNER'S error #2.

Again see <<https://cwe.mitre.org/data/definitions/426.html>>,
<<https://cwe.mitre.org/data/definitions/427.html>>
and <<https://capec.mitre.org/data/definitions/471.html>>

Vulnerability #3:
~~~~~~~~~~~~~~~~~

The executable self-extractors fail to restrict (at least write)
access to this directory for UNPRIVILEGED users, i.e. allow write
access only for members of the "Administrators" group: this is
BEGINNER'S error #3.

In standard installations of Windows, where the qUACkery-controlled
user account created during setup is used, this UNPROTECTED directory
is therefore writable by the UNPRIVILEGED user who can place a rogue
findstr.com/findstr.exe/findstr.bat/findstr.cmd and
REG.com/REG.exe/REG.bat/REG.cmd there ... and gains administrative
privileges!

Additionally an UNPRIVILEGED attacker can add arbitrary command
lines to the UNPROTECTED batch script batCollector.bat between its
creation and its execution, or replace it completely.

Again see <<https://cwe.mitre.org/data/definitions/426.html>>,
<<https://cwe.mitre.org/data/definitions/427.html>>
and <<https://capec.mitre.org/data/definitions/471.html>>,
plus <<https://cwe.mitre.org/data/definitions/732.html>>,
<<https://cwe.mitre.org/data/definitions/377.html>>,
<<https://cwe.mitre.org/data/definitions/379.html>>
and <<https://capec.mitre.org/data/definitions/29.html>>

stay tuned, and FAR AWAY from so-called security products:
their "security" is typically worse than that of the products
they claim to protect!

Stefan Kanthak

PS: the TrendMicro Anti-Threat Toolkit inspected in October 2019
    was built from scrap: the developers used VisualStudio 2008
    (end-of-life since two years), linked against an outdated and
    vulnerable LIBCMT, shipped an outdated and vulnerable cURL 7.48
    plus an outdated and vulnerable libeay32.dll 1.0.1.17 (OpenSSL
    1.0.1 is end-of-life since more than 3 years; the last version
    was 1.0.1.20).
    This POOR (really: TOTAL lack of proper) software engineering
    alone disqualifies this vendor and its "security" products!

JFTR: "they'll never come back" (really: developers SELDOM learn)
      <<https://seclists.org/fulldisclosure/2010/Sep/332>>
      <<https://seclists.org/fulldisclosure/2015/Dec/128>>

Timeline:
~~~~~~~~~

2019-10-23    sent reports for both vulnerabilities to vendor

2019-10-25    vendor acknowledged receipt

2020-01-07    CVE-2019-20358 assigned by vendor

2020-01-29    updated advisory published by vendor

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](49)
[By Date](date.html#50)
[![Next](/images/right-icon-16x16.png)](51)

[![Previous](/images/left-icon-16x16.png)](49)
[By Thread](index.html#50)
[![Next](/images/right-icon-16x16.png)](51)

### Current thread:

* **[CVE-2019-20358] CVE-2019-9491 in Trend Micro Anti-Threat Toolkit (ATTK) was NOT properly FIXED** *Stefan Kanthak (Jan 31)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_e58542d6_20250121_011051.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)
## [Bugtraq](/bugtraq/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](54)
[By Date](date.html#55)
[![Next](/images/right-icon-16x16.png)](56)

[![Previous](/images/left-icon-16x16.png)](54)
[By Thread](index.html#55)
[![Next](/images/right-icon-16x16.png)](56)

![](/shared/images/nst-icons.svg#search)

# [CVE-2019-20358] CVE-2019-9491 in Trend Micro Anti-Threat Toolkit (ATTK) was NOT properly FIXED

---

*From*: "Stefan Kanthak" <stefan.kanthak () nexgo de>

*Date*: Thu, 30 Jan 2020 10:29:46 +0100

---

```
Hi @ll,

on September 29, 2019, John Page reported a remote code execution
with escalation of privilege in TrendMicro's Anti-Threat Toolkit
to its vendor.
TrendMicro assigned CVE-2019-9491 to this vulnerability and told
the reporter, his dog and the world on October 18, 2019, that they
had fixed the vulnerable product.

See <<https://success.trendmicro.com/solution/000149878>>,
<<https://seclists.org/fulldisclosure/2019/Oct/42>> and
<<http://hyp3rlinx.altervista.org/advisories/TREND-MICRO-ANTI-THREAT-TOOLKIT->(ATTK)-REMOTE-CODE-EXECUTION.txt>

TrendMicro's claim was but wrong, the vulnerability was NOT FIXED!

The files attk_ScanCleanOffline_gui_x86.exe, attk_collector_cli_x86.exe,
attk_ScanCleanOffline_gui_x64.exe and attk_collector_cli_x64.exe
offered on <<https://spnsupport.trendmicro.com/>> were STILL vulnerable,
as was their payload!

Vulnerability #1:
~~~~~~~~~~~~~~~~~

On a fully patched Windows 7 SP1, the executable self-extractors
attk_ScanCleanOffline_gui_x86.exe, attk_collector_cli_x86.exe,
attk_ScanCleanOffline_gui_x64.exe and attk_collector_cli_x64.exe
loaded and executed at least the following DLLs from their
"application directory", typically the user's "Downloads" folder
%USERPROFILE%\Downloads\, instead from Windows' "system directory"
%SystemRoot%\System32\
    VERSION.dll, IPHLPAPI.dll, WINNSI.dll, WINHTTP.dll, WEBIO.dll,
    DHCPCSVC.dll, CRYPTSP.dll, BCRYPT.dll, NCRYPT.dll, DNSAPI.dll,
    RASADHLP.dll, PROPSYS.dll, APPHELP.dll

On other versions of Windows this list varied, but some DLLs were
ALWAYS loaded from the "application directory"!

This BEGINNER's error is well-known and well-documented since MORE
than 20 years:
see <<https://capec.mitre.org/data/definitions/471.html>>,
<<https://cwe.mitre.org/data/definitions/426.html>>,
<<https://cwe.mitre.org/data/definitions/427.html>>,
<<https://blogs.msdn.microsoft.com/david_leblanc/2008/02/20/dll-preloading-attacks/>>,
<<https://insights.sei.cmu.edu/cert/2008/09/carpet-bombing-and-directory-poisoning.html>>,
<<http://www.binaryplanting.com/index.htm>>,
<<https://attack.mitre.org/wiki/Technique/T1073>>,
<<https://skanthak.homepage.t-online.de/sentinel.html>>,
<<https://skanthak.homepage.t-online.de/verifier.html>>,
<[https://skanthak.homepage.t-online.de/!execute.html](https://skanthak.homepage.t-online.de/%21execute.html)>,
<<https://skanthak.homepage.t-online.de/minesweeper.html>>

Demonstration/Proof of concept:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Follow <<https://skanthak.homepage.t-online.de/minesweeper.html>>,
build a "minefield" of forwarder DLLs, then copy attk_*.exe into
the directory where you built the DLLs and execute it: enjoy the
multiple message boxes displayed from the forwarder DLLs.

Vulnerability #2:
~~~~~~~~~~~~~~~~~

On all versions of Windows, the batch script batCollector.bat,
unpacked from the executable extractors, which controls execution
of the TrendMicro AntiThreat Toolkit itself, executed
    findstr.com/findstr.exe/findstr.bat/findstr.cmd
plus
    REG.com/REG.exe/REG.bat/REG.cmd
(see the environment variable PATHEXT for the extensions) from
the directory
    "TrendMicro AntiThreat Toolkit\HC_ATTK"
where the batch script batCollector.bat lives:

--- batCollector.bat ---

| @echo off
| setlocal disableDelayedExpansion
| set wd=%~dp0
| cd /d %wd%
...
| for /f "tokens=*" %%a in ('findstr BatCollector= ..\..\config.ini') do (
...
| REG EXPORT ...
...

findstr and REG are called in the script without file extension and
without path (although BOTH are well-known), so CMD.exe runs
findstr.com/findstr.exe/findstr.bat/findstr.cmd and
REG.com/REG.exe/REG.bat/REG.cmd from its "current working directory"
"TrendMicro AntiThreat Toolkit\HC_ATTK"

The missing path and extension are BEGINNER'S error #2.

Again see <<https://cwe.mitre.org/data/definitions/426.html>>,
<<https://cwe.mitre.org/data/definitions/427.html>>
and <<https://capec.mitre.org/data/definitions/471.html>>

Vulnerability #3:
~~~~~~~~~~~~~~~~~

The executable self-extractors fail to restrict (at least write)
access to this directory for UNPRIVILEGED users, i.e. allow write
access only for members of the "Administrators" group: this is
BEGINNER'S error #3.

In standard installations of Windows, where the qUACkery-controlled
user account created during setup is used, this UNPROTECTED directory
is therefore writable by the UNPRIVILEGED user who can place a rogue
findstr.com/findstr.exe/findstr.bat/findstr.cmd and
REG.com/REG.exe/REG.bat/REG.cmd there ... and gains administrative
privileges!

Additionally an UNPRIVILEGED attacker can add arbitrary command
lines to the UNPROTECTED batch script batCollector.bat between its
creation and its execution, or replace it completely.

Again see <<https://cwe.mitre.org/data/definitions/426.html>>,
<<https://cwe.mitre.org/data/definitions/427.html>>
and <<https://capec.mitre.org/data/definitions/471.html>>,
plus <<https://cwe.mitre.org/data/definitions/732.html>>,
<<https://cwe.mitre.org/data/definitions/377.html>>,
<<https://cwe.mitre.org/data/definitions/379.html>>
and <<https://capec.mitre.org/data/definitions/29.html>>

stay tuned, and FAR AWAY from so-called security products:
their "security" is typically worse than that of the products
they claim to protect!

Stefan Kanthak

PS: the TrendMicro Anti-Threat Toolkit inspected in October 2019
    was built from scrap: the developers used VisualStudio 2008
    (end-of-life since two years), linked against an outdated and
    vulnerable LIBCMT, shipped an outdated and vulnerable cURL 7.48
    plus an outdated and vulnerable libeay32.dll 1.0.1.17 (OpenSSL
    1.0.1 is end-of-life since more than 3 years; the last version
    was 1.0.1.20).
    This POOR (really: TOTAL lack of proper) software engineering
    alone disqualifies this vendor and its "security" products!

JFTR: "they'll never come back" (really: developers SELDOM learn)
      <<https://seclists.org/fulldisclosure/2010/Sep/332>>
      <<https://seclists.org/fulldisclosure/2015/Dec/128>>

Timeline:
~~~~~~~~~

2019-10-23    sent reports for both vulnerabilities to vendor

2019-10-25    vendor acknowledged receipt

2020-01-07    CVE-2019-20358 assigned by vendor

2020-01-29    updated advisory published by vendor

```

---

[![Previous](/images/left-icon-16x16.png)](54)
[By Date](date.html#55)
[![Next](/images/right-icon-16x16.png)](56)

[![Previous](/images/left-icon-16x16.png)](54)
[By Thread](index.html#55)
[![Next](/images/right-icon-16x16.png)](56)

### Current thread:

* **[CVE-2019-20358] CVE-2019-9491 in Trend Micro Anti-Threat Toolkit (ATTK) was NOT properly FIXED** *Stefan Kanthak (Jan 30)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from seclists.org_83d28a8f_20250121_031831.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](127)
[By Date](date.html#128)
![Next](/images/right-icon-16x16.png)

[![Previous](/images/left-icon-16x16.png)](125)
[By Thread](index.html#128)
![Next](/images/right-icon-16x16.png)

![](/shared/images/nst-icons.svg#search)

# Executable installers are vulnerable^WEVIL (case 16): Trend Micro's installers allows arbitrary (remote) code execution

---

*From*: "Stefan Kanthak" <stefan.kanthak () nexgo de>

*Date*: Thu, 31 Dec 2015 07:37:20 +0100

---

```
Hi @ll,

TrendMicro_MAX_10.0_US-en_Downloader.exe (available from
<<http://trial.trendmicro.com/US/TM/2016/TrendMicro_MAX_10.0_US-en_Downloader.exe>>)
loads and executes ProfAPI.dll and UXTheme.dll (and other DLLs
too) eventually found in the directory it is started from
(the "application directory").

For software downloaded with a web browser the application
directory is typically the user's "Downloads" directory: see
<<https://insights.sei.cmu.edu/cert/2008/09/carpet-bombing-and-directory-poisoning.html>>,
<<http://blog.acrossecurity.com/2012/02/downloads-folder-binary-planting.html>>
and <<http://seclists.org/fulldisclosure/2012/Aug/134>>

If one of the DLLs named above gets planted in the user's
"Downloads" directory per "drive-by download" or "social
engineering" this vulnerability becomes a remote code execution.

Proof of concept/demonstration:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

1. visit <<http://home.arcor.de/skanthak/sentinel.html>>, download
   <<http://home.arcor.de/skanthak/download/SENTINEL.DLL>>, save it
   as UXTheme.dll in your "Downloads" directory, then copy it as
   ProfAPI.dll;

2. download TrendMicro_MAX_10.0_US-en_Downloader.exe and save it
   in your "Downloads" directory;

3. execute TrendMicro_MAX_10.0_US-en_Downloader.exe from your
   "Downloads" directory;

4. notice the message boxes displayed from the DLLs placed in step 1.

PWNED!

For a denial of service instead of arbitrary (remote) code execution
copy the downloaded UXTheme.dll as OLEAcc.dll and WinSpool.drv.
This is easily turned into arbitrary (remote) code execution too:
just add the exports OpenPrinterW, ClosePrinter and DocumentPropertiesW
respectively LresultFromObject and CreateStdAccessibleObject to the DLL.

See <<http://seclists.org/fulldisclosure/2015/Nov/101>> and
<<http://seclists.org/fulldisclosure/2015/Dec/86>> as well as
<<http://home.arcor.de/skanthak/sentinel.html>> and the still unfinished
<[http://home.arcor.de/skanthak/!execute.html](http://home.arcor.de/skanthak/%21execute.html)> for more details about
this well-known and well-documented BEGINNER'S error and why
executable installers (and self-extractors too) are bad.

Additionally, TrendMicro_MAX_10.0_US-en_Downloader.exe creates an
unsafe temporary directory where it unpacks its payload to and
executes it from.

...\TrendMicro_MAX_10.0_US-en_Downloader\Agent\TisEzIns.exe loads
and executes multiple DLLs too from its unsafe application directory:
ProfAPI.dll, NTMarta.dll, RASAdHlp.dll, NTShrUI.dll, UXTheme.dll and
Secur32.dll plus WinMM.dll, Version.dll, WinSpool.drv, WinHttp.dll
and OLEAcc.dll

Proof of concept/demonstration:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

5. unpack TrendMicro_MAX_10.0_US-en_Downloader.exe (basically a
   7-Zip self-extractor) into an arbitrary directory, say "%TEMP%"
   (this creates a subdirectory "%TEMP%\Agent" with the payload);

6. copy the downloaded UXTheme.dll from step 1 into "%TEMP%\Agent",
   then copy it as ProfAPI.dll, NTMarta.dll, RASAdHlp.dll, NTShrUI.dll,
   Secur32.dll plus WinMM.dll, Version.dll, WinSpool.drv, WinHttp.dll
   and OLEAcc.dll there;

7. execute "%TEMP%\Agent\TisEZIns.exe";

8. notice the message boxes displayed from the DLLs placed in steps 5
   and 6.

PWNED!

stay tuned
Stefan Kanthak

Timeline:
~~~~~~~~~

2015-12-20    multiple reports sent to vendor

2015-12-20    one report bounced due to braindead mail setup by vendor

2015-12-20    resent bounced report via alternative provider

2015-12-21    vendor acknowledges receipt and names further contact

2015-12-28    vendor verifies reports, can reproduce it on Windows 7

2015-12-30    vendor asks for verification:
              "We did not reproduce the vulnerability relating to
               ProfAPI.dll and UXTheme.dll on Windows 7."

2015-12-31    sent verification to vendor

2015-12-31    bounced due to braindead mail setup by vendor

<GCC_CONSRECEIVE () support trendmicro com>: host
    support.trendmicro.com.e0018.g0009.ng0090.im.emailsecurity.trendmicro.com[150.70.178.57]
    said: 554 5.7.1 <GCC_CONSRECEIVE () support trendmicro com>: Recipient address
    rejected: ERS-RBL. (in reply to RCPT TO command)

<tm-csirt () trendmicro com>: host sjdc-itpf-04.udc.trendmicro.com[66.180.82.132]
    said: 550 5.7.1 Service unavailable; Client host [151.189.21.43] blocked
    using Trend Micro RBL+. Please see
    <http://www.mail-abuse.com/cgi-bin/lookup?ip_address=151.189.21.43>; Mail
    from 151.189.21.43 blocked using Trend Micro Email Reputation database.
    Please see <<http://www.mail-abuse.com/cgi-bin/lookup?151.189.21.43>>;
    from=<<stefan.kanthak () nexgo de> ; SIZE=8184> to=<<tm-csirt () trendmicro com>
    ; ORCPT=rfc822;tm-csirt () trendmicro com> proto=ESMTP
    helo=<mail-in-03.arcor-online.net> (in reply to end of DATA command)

2015-12-31    report published: vendor is obviously not interested in
              communication

_______________________________________________
Sent through the Full Disclosure mailing list
<https://nmap.org/mailman/listinfo/fulldisclosure>
Web Archives & RSS: <http://seclists.org/fulldisclosure/>

```

---

[![Previous](/images/left-icon-16x16.png)](127)
[By Date](date.html#128)
![Next](/images/right-icon-16x16.png)

[![Previous](/images/left-icon-16x16.png)](125)
[By Thread](index.html#128)
![Next](/images/right-icon-16x16.png)

### Current thread:

* **Executable installers are vulnerable^WEVIL (case 16): Trend Micro's installers allows arbitrary (remote) code execution** *Stefan Kanthak (Dec 31)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


