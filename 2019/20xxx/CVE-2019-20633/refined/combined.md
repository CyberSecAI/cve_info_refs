=== Content from savannah.gnu.org_85069098_20250120_231354.html ===


* [![Back to Savannah Homepage](/images/Savannah.theme/floating.png)](/)
* Not Logged in
* [Login](/account/login.php?uri=%2Fbugs%2Findex.php%3F56683 "Login page - you must have registered an account first")
* [New User](/account/register.php "Account registration form")
* This Page
* [Language](/i18n.php?lang_uri=%2Fbugs%2Findex.php%3F56683 "Choose website language")
* [Clean Reload](/bugs/index.php?reload=1&func=detailitem&item_id=56683 "Reload the page without risk of reposting data")
* Search
* Area to search in
  Groups
  People
  Support
  Bugs
  Tasks
  Patches
* Hosted Projects
* [Hosting requirements](/register/requirements.php)
* [Register New Project](/register/ "Register your project at Savannah")
* [Full List](/search/index.php?type_of_search=soft&words=%%% "Browse the full list of hosted projects")
* [Contributors Wanted](/people/ "Browse the list of request for contributions")
* [Statistics](/stats/ "Browse statistics about Savannah")
* Site Help
* [User Docs: FAQ](/maintenance/FrontPage/)
* [User Docs: In Depth Guide](/maintenance/back-page/ "In-depth Documentation dedicated to any users, including group admins")
* [Get Support](/support/?group=administration "Get help from the Admins of Savannah, when documentation is not enough")
* [Contact Savannah](/contact.php "Contact address of Savannah Admins")
* GNU Project
* [Help GNU](//www.gnu.org/help/help.html)
* [All GNU Packages](//www.gnu.org/software/software.html)
* [Dev Resources](//www.gnu.org/software/devel.html)
* [License List](//www.gnu.org/licenses/license-list.html)
* [GNU Mirrors](//www.gnu.org/prep/ftp.html)
* [![Support freedom](/images/Savannah.theme/thin-image.png)

  Help us protect your freedom and the rights of computer
  users everywhere by becoming a member of the FSF.

  **Join Now!**](//www.fsf.org/associate/support_freedom/join_fsf?referrer=2442)
* Free Software Foundation
* [Coming Events](//www.fsf.org/events/)
* [Free Software Directory](//www.fsf.org/directory/)
* [Cryptographic software legal notice](//savannah.gnu.org/maintenance/SavannahCryptographicRestrictions)
* [Copyright infringement notification](//www.fsf.org/about/dmca-notice)
* Related Forges
* [Savannah Non-GNU](//savannah.nongnu.org/)
* [Puszcza](//puszcza.gnu.org.ua/)

# bugGNU patch - Bugs: bug #56683, Double free in pch.c:1187

 Group

* [Main](/projects/patch/ "Group main page at Savannah")
  + [Main](/projects/patch/)
  + [View members](/project/memberlist.php?group=patch)
  + [Search](/project/search.php?group=patch)
* [Download](/files/?group=patch "Visit download area: files released")
* [Mailing lists](/mail/?group=patch "List existing mailing lists")
* [Source code](/git/?group=patch "Source code management")
  + [Use Git](/git/?group=patch "Git Repository")
  + [Browse Git repository](//git.savannah.gnu.org/cgit/patch.git)
* [Bugs](/bugs/?group=patch "Bug Tracker: report, search and track bugs")
  + [Submit new](/bugs/?group=patch&func=additem)
  + [Browse](/bugs/?group=patch)
  + [Reset to open](/bugs/?group=patch&func=browse&set=open)
  + [Digest](/bugs/?group=patch&func=digest)
  + [Dependencies](/bugs/dependencies.php?group=patch)
  + ~~Export~~
  + [Get statistics](/bugs/reporting.php?group=patch)
  + [Search](/bugs/?group=patch&func=search)
* [News](/news/?group=patch "Read latest News, post News")
  + [Browse](/news/?group=patch)
  + [Atom feed](/news/atom.php?group=patch)
  + ~~Submit~~
  + ~~Manage~~

# *[bug #56683](?56683)*: Double free in pch.c:1187

| Submitter: | [Manh-Dung Nguyen <strongcourage>](/users/strongcourage) |  | |
| --- | --- | --- | --- |
| Submitted: | Sun 28 Jul 2019 07:01:53 AM UTC |  | |
|  |  |  | |
|  | | | |
| Category: | Parser / Internal Representation | Severity: | 3 - Normal |
| Item Group: | None | Status: | None |
| Privacy: | Public | Assigned to: | None |
| Open/Closed: | Open |

\* Mandatory Fields
## [Post a Comment](#postcomment)

 Add a New Comment [![](/images/Savannah.theme/misc/edit.png)Rich Markup](/markup-test.php)

## [Discussion](#discussion)

|
|  |
| [Wed 07 Dec 2022 11:45:17 AM UTC, comment #1:](#comment1) Quote  After the pointer is released, we need to clear the length and pointer.  Like this:       while (p\_end >= 0) {          if (p\_end == p\_efake)              p\_end = p\_bfake;            /\* don't free twice \*/          else {              free(p\_line[p\_end]);              p\_line[p\_end] = NULL;              p\_len[p\_end] = 0;          }          p\_end--;      } | [yixiangzhike <yixiangzhike>](/users/yixiangzhike) |
| [Sun 28 Jul 2019 07:01:53 AM UTC, **original submission:**](#comment0) Quote  Hi,   I found a double free in pch.c:1187 (the latest commit 76e7758 on master). This bug causes the program patch to crash.   PoC: <https://github.com/strongcourage/PoCs/blob/master/patch_76e7758/PoC_df>  Command: patch -Rf < $PoC   ASAN says:  ==2576==ERROR: AddressSanitizer: attempting double-free on 0x60200000ed90 in thread T0:      #0 0x7f237fe6832a in \_\_interceptor\_free (/usr/lib/x86\_64-linux-gnu/libasan.so.2+0x9832a)      #1 0x414188 in another\_hunk ../../src/pch.c:1187      #2 0x406ce2 in main ../../src/patch.c:408      #3 0x7f237fa2682f in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x2082f)      #4 0x4037e8 in \_start (/home/dungnguyen/PoCs/patch\_76e7758/patch-asan+0x4037e8)   0x60200000ed90 is located 0 bytes inside of 4-byte region [0x60200000ed90,0x60200000ed94)  freed by thread T0 here:      #0 0x7f237fe6832a in \_\_interceptor\_free (/usr/lib/x86\_64-linux-gnu/libasan.so.2+0x9832a)      #1 0x414188 in another\_hunk ../../src/pch.c:1187      #2 0x406ce2 in main ../../src/patch.c:408      #3 0x7f237fa2682f in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x2082f)   previously allocated by thread T0 here:      #0 0x7f237fe68662 in malloc (/usr/lib/x86\_64-linux-gnu/libasan.so.2+0x98662)      #1 0x421b71 in savebuf ../../src/util.c:869      #2 0x415595 in another\_hunk ../../src/pch.c:1443      #3 0x406ce2 in main ../../src/patch.c:408      #4 0x7f237fa2682f in \_\_libc\_start\_main (/lib/x86\_64-linux-gnu/libc.so.6+0x2082f)   Thanks,  Manh Dung | [Manh-Dung Nguyen <strongcourage>](/users/strongcourage) |

## [Attached Files](#attached)

(Note: upload size limit is set to 16384 kB, after insertion of
the required escape characters.)

 Attach Files:

Comment:

Attached Files
[file #54067:  Clear-the-length-and-pointer-after-the-pointer-is-released.patch](https://file.savannah.gnu.org/file/Clear-the-length-and-pointer-after-the-pointer-is-released.patch?file_id=54067) added by [yixiangzhike](/users/yixiangzhike) (2KiB - application/octet-stream - Patch for double free in pch.c)
[file #47273:  PoC\_df](https://file.savannah.gnu.org/file/PoC_df?file_id=47273) added by [strongcourage](/users/strongcourage) (769B - application/octet-stream)

## [Dependencies](#dependencies)

Depends on the following items: None found

Items that depend on this one: None found

## [Mail Notification Carbon-Copy List](#cc)

Carbon-Copy List- -email is unavailable- added by [yixiangzhike](/users/yixiangzhike) (Posted a comment)- -email is unavailable- added by [agruen](/users/agruen) (Updated the item)- -email is unavailable- added by [strongcourage](/users/strongcourage) (Submitted the item)- -email is unavailable- added by [strongcourage](/users/strongcourage)
## [Votes](#votes)

There are 0 votes so far. Votes easily highlight which items people would like to see resolved
in priority, independently of the priority of the item set by tracker
managers.

Only logged-in users can vote.

Please enter the title of [George Orwell](https://en.wikipedia.org/wiki/George_Orwell)'s famous
dystopian book (it's a date):

## [History](#history)

Follow 4 latest changes.

| Date | Changed by | Updated Field | Previous Value | => | Replaced by |
| --- | --- | --- | --- | --- | --- |
| 2022-12-07 | [yixiangzhike](/users/yixiangzhike) | Attached File | - |  | Added Clear-the-length-and-pointer-after-the-pointer-is-released.patch, #54067 |
| 2019-07-28 | [agruen](/users/agruen) | Category | None |  | Parser / Internal Representation |
| 2019-07-28 | [strongcourage](/users/strongcourage) | Attached File | - |  | Added PoC\_df, #47273 |
|  |  | Carbon-Copy | - |  | Added -email is unavailable- |

[![Back to the top](/images/Savannah.theme/arrows/top.orig.png)](#top)

Copyright © 2025 Free Software Foundation, Inc.

Verbatim copying and distribution of this entire article
is permitted in any medium, provided this notice is preserved.

The [Levitating,
Meditating, Flute-playing Gnu](//www.gnu.org/graphics/meditate.html) logo is a GNU GPL'ed image provided
by the Nevrax Design Team.

[Page source code](//git.savannah.nongnu.org/cgit/administration/savane.git/plain//frontend/php/bugs/index.php?id=04e1be7c5875649835636cff39891da2b16ab95a)

Powered by Savane 3.14-04e1.
[Corresponding source code](https://savannah.gnu.org/source/savane-04e1be7c5875649835636cff39891da2b16ab95a.tar.gz)


