=== Content from usn.ubuntu.com_d10e6e51_20250120_234257.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4157-1: Linux kernel vulnerabilities

17 October 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 19.04](/security/notices?release=disco)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi 2
* [linux-snapdragon](/security/cves?package=linux-snapdragon) - Linux kernel for Snapdragon processors

## Details

Wen Huang discovered that the Marvell Wi-Fi device driver in the Linux

kernel did not properly perform bounds checking, leading to a heap

overflow. A local attacker could use this to cause a denial of service

(system crash) or possibly execute arbitrary code. ([CVE-2019-14814](/security/CVE-2019-14814),

[CVE-2019-14815](/security/CVE-2019-14815), [CVE-2019-14816](/security/CVE-2019-14816))

Matt Delco discovered that the KVM hypervisor implementation in the Linux

kernel did not properly perform bounds checking when handling coalesced

MMIO write operations. A local attacker with write access to /dev/kvm could

use this to cause a denial of service (system crash). ([CVE-2019-14821](/security/CVE-2019-14821))

Hui Peng and Mathias Payer discovered that the 91x Wi-Fi driver in the

Linux kernel did not properly handle error conditions on initialization,

leading to a double-free vulnerability. A physically proximate attacker

could use this to cause a denial of service (system crash).

([CVE-2019-15504](/security/CVE-2019-15504))

It was discovered that the Technisat DVB-S/S2 USB device driver in the

Linux kernel contained a buffer overread. A physically proximate attacker

could use this to cause a denial of service (system crash) or possibly

expose sensitive information. ([CVE-2019-15505](/security/CVE-2019-15505))

Brad Spengler discovered that a Spectre mitigation was improperly

implemented in the ptrace susbsystem of the Linux kernel. A local attacker

could possibly use this to expose sensitive information. ([CVE-2019-15902](/security/CVE-2019-15902))

It was discovered that the IPv6 RDS implementation in the Linux kernel did

not properly initialize fields in a data structure returned to user space.

A local attacker could use this to expose sensitive information (kernel

memory). Please note that the RDS protocol is disabled via blocklist in

Ubuntu by default. ([CVE-2019-16714](/security/CVE-2019-16714))

It was discovered that an integer overflow existed in the Binder

implementation of the Linux kernel, leading to a buffer overflow. A local

attacker could use this to escalate privileges. ([CVE-2019-2181](/security/CVE-2019-2181))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 19.04

* [linux-image-5.0.0-1019-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [5.0.0-1019.21](https://launchpad.net/ubuntu/%2Bsource/linux-aws/5.0.0-1019.21)
* [linux-image-5.0.0-1020-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [5.0.0-1020.21](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/5.0.0-1020.21)
* [linux-image-5.0.0-1020-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [5.0.0-1020.20](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/5.0.0-1020.20)
* [linux-image-5.0.0-1021-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-gcp)
  -
  [5.0.0-1021.21](https://launchpad.net/ubuntu/%2Bsource/linux-gcp/5.0.0-1021.21)
* [linux-image-5.0.0-1023-azure](https://launchpad.net/ubuntu/%2Bsource/linux-azure)
  -
  [5.0.0-1023.24](https://launchpad.net/ubuntu/%2Bsource/linux-azure/5.0.0-1023.24)
* [linux-image-5.0.0-1024-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon)
  -
  [5.0.0-1024.25](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon/5.0.0-1024.25)
* [linux-image-5.0.0-32-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.0.0-32.34](https://launchpad.net/ubuntu/%2Bsource/linux/5.0.0-32.34)
* [linux-image-5.0.0-32-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.0.0-32.34](https://launchpad.net/ubuntu/%2Bsource/linux/5.0.0-32.34)
* [linux-image-5.0.0-32-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [5.0.0-32.34](https://launchpad.net/ubuntu/%2Bsource/linux/5.0.0-32.34)
* linux-image-aws
  -
  5.0.0.1019.20
* linux-image-azure
  -
  5.0.0.1023.22
* linux-image-gcp
  -
  5.0.0.1021.47
* linux-image-generic
  -
  5.0.0.32.33
* linux-image-generic-lpae
  -
  5.0.0.32.33
* linux-image-gke
  -
  5.0.0.1021.47
* linux-image-kvm
  -
  5.0.0.1020.20
* linux-image-lowlatency
  -
  5.0.0.32.33
* linux-image-raspi2
  -
  5.0.0.1020.17
* linux-image-snapdragon
  -
  5.0.0.1024.17
* linux-image-virtual
  -
  5.0.0.32.33

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2019-14814](/security/CVE-2019-14814)
* [CVE-2019-14815](/security/CVE-2019-14815)
* [CVE-2019-14816](/security/CVE-2019-14816)
* [CVE-2019-14821](/security/CVE-2019-14821)
* [CVE-2019-15504](/security/CVE-2019-15504)
* [CVE-2019-15505](/security/CVE-2019-15505)
* [CVE-2019-15902](/security/CVE-2019-15902)
* [CVE-2019-16714](/security/CVE-2019-16714)
* [CVE-2019-2181](/security/CVE-2019-2181)

## Related notices

* [USN-4157-2](/security/notices/USN-4157-2)
* [USN-4162-1](/security/notices/USN-4162-1)
* [USN-4162-2](/security/notices/USN-4162-2)
* [USN-4163-2](/security/notices/USN-4163-2)
* [USN-4163-1](/security/notices/USN-4163-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from github.com_03ef418e_20250121_014855.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F7d0a06586b2686ba80c4a2da5f91cb10ffbea736)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F7d0a06586b2686ba80c4a2da5f91cb10ffbea736)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.8k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  436](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/7d0a06586b2686ba80c4a2da5f91cb10ffbea736)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

net/rds: Fix info leak in rds6\_inc\_info\_copy()

[Browse files](/torvalds/linux/tree/7d0a06586b2686ba80c4a2da5f91cb10ffbea736)
Browse the repository at this point in the history

```
The rds6_inc_info_copy() function has a couple struct members which
are leaking stack information.  The ->tos field should hold actual
information and the ->flags field needs to be zeroed out.

Fixes: [3eb4503](https://github.com/torvalds/linux/commit/3eb450367d0823226515ee24712ed08eccb33eb9) ("rds: add type of service(tos) infrastructure")
Fixes: [b7ff8b1](https://github.com/torvalds/linux/commit/b7ff8b1036f0b0df1390ba6b5e9bc7ec458e857a) ("rds: Extend RDS API for IPv6 support")
Reported-by: 黄ID蝴蝶 <butterflyhuangxx@gmail.com>
Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com>
Signed-off-by: Ka-Cheong Poon <ka-cheong.poon@oracle.com>
Acked-by: Santosh Shilimkar <santosh.shilimkar@oracle.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
```

* Loading branch information

[![@kcp-git](https://avatars.githubusercontent.com/u/38694969?s=40&v=4)](/kcp-git) [![@davem330](https://avatars.githubusercontent.com/u/1053866?s=40&v=4)](/davem330)

[kcp-git](/torvalds/linux/commits?author=kcp-git "View all commits by kcp-git")
authored and
[davem330](/torvalds/linux/commits?author=davem330 "View all commits by davem330")
committed
Aug 28, 2019

1 parent
[2c1644c](/torvalds/linux/commit/2c1644cf6d46a8267d79ed95cb9b563839346562)

commit 7d0a065

Showing
**1 changed file**
with
**4 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

5 changes: 4 additions & 1 deletion

5
[net/rds/recv.c](#diff-4f659d28f820ade76c164a27992dbc851f334686da12e448abd636b055ec870b "net/rds/recv.c")

Show comments

[View file](/torvalds/linux/blob/7d0a06586b2686ba80c4a2da5f91cb10ffbea736/net/rds/recv.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,5 @@ |
|  |  | /\* |
|  |  | \* Copyright (c) 2006, 2018 Oracle and/or its affiliates. All rights reserved. |
|  |  | \* Copyright (c) 2006, 2019 Oracle and/or its affiliates. All rights reserved. |
|  |  | \* |
|  |  | \* This software is available to you under a choice of one of two |
|  |  | \* licenses. You may choose to be licensed under the terms of the GNU |
| Expand Down  Expand Up | | @@ -811,6 +811,7 @@ void rds6\_inc\_info\_copy(struct rds\_incoming \*inc, |
|  |  |  |
|  |  | minfo6.seq = be64\_to\_cpu(inc->i\_hdr.h\_sequence); |
|  |  | minfo6.len = be32\_to\_cpu(inc->i\_hdr.h\_len); |
|  |  | minfo6.tos = inc->i\_conn->c\_tos; |
|  |  |  |
|  |  | if (flip) { |
|  |  | minfo6.laddr = \*daddr; |
| Expand All | | @@ -824,6 +825,8 @@ void rds6\_inc\_info\_copy(struct rds\_incoming \*inc, |
|  |  | minfo6.fport = inc->i\_hdr.h\_dport; |
|  |  | } |
|  |  |  |
|  |  | minfo6.flags = 0; |
|  |  |  |
|  |  | rds\_info\_copy(iter, &minfo6, sizeof(minfo6)); |
|  |  | } |
|  |  | #endif |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `7d0a065`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F7d0a06586b2686ba80c4a2da5f91cb10ffbea736) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from usn.ubuntu.com_77db2cb0_20250120_234257.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4157-2: Linux kernel (HWE) vulnerabilities

22 October 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)

## Packages

* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-gke-5.0](/security/cves?package=linux-gke-5.0) - Linux kernel for Google Container Engine (GKE) systems
* [linux-hwe](/security/cves?package=linux-hwe) - Linux hardware enablement (HWE) kernel

## Details

USN-4157-1 fixed vulnerabilities in the Linux kernel for Ubuntu 19.04.

This update provides the corresponding updates for the Linux

Hardware Enablement (HWE) kernel from Ubuntu 19.04 for Ubuntu

18.04 LTS.

Wen Huang discovered that the Marvell Wi-Fi device driver in the Linux

kernel did not properly perform bounds checking, leading to a heap

overflow. A local attacker could use this to cause a denial of service

(system crash) or possibly execute arbitrary code. ([CVE-2019-14814](/security/CVE-2019-14814),

[CVE-2019-14815](/security/CVE-2019-14815), [CVE-2019-14816](/security/CVE-2019-14816))

Matt Delco discovered that the KVM hypervisor implementation in the Linux

kernel did not properly perform bounds checking when handling coalesced

MMIO write operations. A local attacker with write access to /dev/kvm could

use this to cause a denial of service (system crash). ([CVE-2019-14821](/security/CVE-2019-14821))

Hui Peng and Mathias Payer discovered that the 91x Wi-Fi driver in the

Linux kernel did not properly handle error conditions on initialization,

leading to a double-free vulnerability. A physically proximate attacker

could use this to cause a denial of service (system crash).

([CVE-2019-15504](/security/CVE-2019-15504))

It was discovered that the Technisat DVB-S/S2 USB device driver in the

Linux kernel contained a buffer overread. A physically proximate attacker

could use this to cause a denial of service (system crash) or possibly

expose sensitive information. ([CVE-2019-15505](/security/CVE-2019-15505))

Brad Spengler discovered that a Spectre mitigation was improperly

implemented in the ptrace susbsystem of the Linux kernel. A local attacker

could possibly use this to expose sensitive information. ([CVE-2019-15902](/security/CVE-2019-15902))

It was discovered that the IPv6 RDS implementation in the Linux kernel did

not properly initialize fields in a data structure returned to user space.

A local attacker could use this to expose sensitive information (kernel

memory). Please note that the RDS protocol is disabled via blocklist in

Ubuntu by default. ([CVE-2019-16714](/security/CVE-2019-16714))

It was discovered that an integer overflow existed in the Binder

implementation of the Linux kernel, leading to a buffer overflow. A local

attacker could use this to escalate privileges. ([CVE-2019-2181](/security/CVE-2019-2181))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

* [linux-image-5.0.0-1021-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp)
  -
  [5.0.0-1021.21~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp/5.0.0-1021.21~18.04.1)
* [linux-image-5.0.0-1023-azure](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure)
  -
  [5.0.0-1023.24~18.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure/5.0.0-1023.24~18.04.1)
* [linux-image-5.0.0-1023-gke](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gke-5.0)
  -
  [5.0.0-1023.23~18.04.2](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gke-5.0/5.0.0-1023.23~18.04.2)
* [linux-image-5.0.0-32-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [5.0.0-32.34~18.04.2](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/5.0.0-32.34~18.04.2)
* [linux-image-5.0.0-32-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [5.0.0-32.34~18.04.2](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/5.0.0-32.34~18.04.2)
* [linux-image-5.0.0-32-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [5.0.0-32.34~18.04.2](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/5.0.0-32.34~18.04.2)
* [linux-image-azure](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure)
  -
  [5.0.0.1023.33](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure/5.0.0.1023.33)
* [linux-image-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [5.0.0.1021.26](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/5.0.0.1021.26)
* [linux-image-generic-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.0.0.32.89](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.0.0.32.89)
* [linux-image-generic-lpae-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.0.0.32.89](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.0.0.32.89)
* [linux-image-gke-5.0](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-5.0)
  -
  [5.0.0.1023.12](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-5.0/5.0.0.1023.12)
* [linux-image-lowlatency-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.0.0.32.89](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.0.0.32.89)
* [linux-image-snapdragon-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.0.0.32.89](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.0.0.32.89)
* [linux-image-virtual-hwe-18.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [5.0.0.32.89](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/5.0.0.32.89)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2019-14814](/security/CVE-2019-14814)
* [CVE-2019-14815](/security/CVE-2019-14815)
* [CVE-2019-14816](/security/CVE-2019-14816)
* [CVE-2019-14821](/security/CVE-2019-14821)
* [CVE-2019-15504](/security/CVE-2019-15504)
* [CVE-2019-15505](/security/CVE-2019-15505)
* [CVE-2019-15902](/security/CVE-2019-15902)
* [CVE-2019-16714](/security/CVE-2019-16714)
* [CVE-2019-2181](/security/CVE-2019-2181)

## Related notices

* [USN-4162-1](/security/notices/USN-4162-1)
* [USN-4162-2](/security/notices/USN-4162-2)
* [USN-4163-2](/security/notices/USN-4163-2)
* [USN-4163-1](/security/notices/USN-4163-1)
* [USN-4157-1](/security/notices/USN-4157-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from security.netapp.com_d4a7096b_20250120_234254.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [October 2019 Linux Kernel Vulnerabilities in NetApp Products](https://security.netapp.com/advisory/ntap-20191031-0005)

## October 2019 Linux Kernel Vulnerabilities in NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20191031-0005 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20191031-0005 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20191031-0005 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20191031-0005 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20191031-0005
**Version:**
23.0

**Last updated:**
05/27/2022

**Status:**
Final.

**CVEs:** CVE-2019-16714, CVE-2019-14814, CVE-2019-14816, CVE-2019-16746, CVE-2019-16994, CVE-2019-16995, CVE-2019-14835, CVE-2019-17133, CVE-2019-17351, CVE-2019-18198, CVE-2019-17666, CVE-2019-2215

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions through 5.3.6 are susceptible to vulnerabilities which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of these vulnerabilities could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2019-14814](https://nvd.nist.gov/vuln/detail/CVE-2019-14814) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-14816](https://nvd.nist.gov/vuln/detail/CVE-2019-14816) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-14835](https://nvd.nist.gov/vuln/detail/CVE-2019-14835) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-16714](https://nvd.nist.gov/vuln/detail/CVE-2019-16714) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N |
| [CVE-2019-16746](https://nvd.nist.gov/vuln/detail/CVE-2019-16746) | 9.8 (CRITICAL) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-16994](https://nvd.nist.gov/vuln/detail/CVE-2019-16994) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-16995](https://nvd.nist.gov/vuln/detail/CVE-2019-16995) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-17133](https://nvd.nist.gov/vuln/detail/CVE-2019-17133) | 9.8 (CRITICAL) | CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-17351](https://nvd.nist.gov/vuln/detail/CVE-2019-17351) | 6.5 (MEDIUM) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:N/I:N/A:H |
| [CVE-2019-17666](https://nvd.nist.gov/vuln/detail/CVE-2019-17666) | 8.8 (HIGH) | CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-18198](https://nvd.nist.gov/vuln/detail/CVE-2019-18198) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-2215](https://nvd.nist.gov/vuln/detail/CVE-2019-2215) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

Affected Products
#### Affected Products

* AFF Baseboard Management Controller (BMC) - A700s
* FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800
* NetApp Cloud Backup (formerly AltaVault)
* NetApp Data Availability Services
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire Baseboard Management Controller (BMC)
* NetApp SteelStore Cloud Integrated Storage
* Service Processor

#### Products Not Affected

* 7-Mode Transition Tool
* ATTO FibreBridge - 6500N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Trident
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Insights Telegraf Agent
* Cloud Manager
* Cloud Secure Agent
* Cloud Volumes ONTAP Mediator
* Clustered Data ONTAP
* Clustered Data ONTAP Antivirus Connector
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Storage Manager
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element HealthTools
* Element Plug-in for vCenter Server
* FAS/AFF BIOS
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp Cloud Backup OST Plug-in (formerly AltaVault OST Plug-in)
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Performance Analyzer
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Nodes
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp SANtricity SMI-S Provider
* NetApp SMI-S Provider
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp VASA Provider for Clustered Data ONTAP 9.7 and above
* ONTAP Select Deploy administration utility
* OnCommand Insight
* OnCommand Workflow Automation
* Open Systems SnapVault Agent
* SAS Firmware
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere
* SnapManager for Hyper-V
* SnapManager for SAP
* SolidFire Storage Replication Adapter
* Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 9.7 and above
* Storage Services Connector
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID Baseboard Management Controller (BMC)
* StorageGRID9 (9.x and prior)
* System Manager 9.x
* Virtual Storage Console for VMware vSphere 9.7 and above

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H610S** | <https://mysupport.netapp.com/site/products/all/details/5d9f1108e01d9c0001ee51dd/downloads-tab/download/62542/Compute_Firmware_Bundle> <https://mysupport.netapp.com/site/products/all/details/element-software/downloads-tab/download/62654/Storage_Firmware_Bundle> First included in Compute Firmware Bundle version 2.27 |
| **NetApp SteelStore Cloud Integrated Storage** | NetApp SteelStore Cloud Integrated Storage has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2397079.html) for more information. |
| **AFF Baseboard Management Controller (BMC) - A700s** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> The first fixed version is 1.81. To download the patch, choose âService Imageâ from the AFF\_A700s âSystem Firmware + Diagnostics Downloadâ page. |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **Service Processor** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1278293. First fixed versions include the following: 1.6.1P2, 2.11, 3.10, 4.8, 5.8 |
| **NetApp SolidFire Baseboard Management Controller (BMC)** | NetApp SolidFire Baseboard Management Controller (BMC) has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2847476.html%20) for more information. |
| **NetApp SolidFire & HCI Management Node** | <https://mysupport.netapp.com/site/products/all/details/element-software/downloads-tab/download/62654/12.5> <https://mysupport.netapp.com/site/products/all/details/netapp-hci/downloads-tab/download/62542/1.10> |
| **NetApp Cloud Backup (formerly AltaVault)** | NetApp Cloud Backup (formerly AltaVault) has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2880179.html) for more information. |
| **NetApp Data Availability Services** | NetApp Data Availability Services has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2870808.html) for more information. |
| **FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1278284 First fixed versions include the following: 10.4, 11.5, 12.3 |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20191031-0005>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20191031 | Initial Public Release |
| 2.0 | 20191101 | Active IQ Performance Analytics Services moved to Affected Products and StorageGRID Baseboard Management Controller (BMC),StorageGRID9 (9.x and prior) and StorageGRID (formerly StorageGRID Webscale) moved to Products Not Affected |
| 3.0 | 20191105 | NetApp VASA Provider for Clustered Data ONTAP 7.2 and above, StorageGRID Webscale NAS Bridge, Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 7.2 and above and Virtual Storage Console for VMware vSphere 7.2 and above moved to Products Not Affected |
| 4.0 | 20191112 | AFF Baseboard Management Controller (BMC) - A700s and Service Processor moved to Affected Products |
| 5.0 | 20191113 | Element Software (formerly SolidFire Element OS), NetApp HCI Compute Nodes, NetApp HCI Storage Nodes moved to Products Not Affected and Element Software Management Node moved to Affected Products |
| 6.0 | 20191114 | Active IQ Unified Manager (formerly OnCommand Unified Manager) for VMware vSphere 9.5 and above moved to Products Not Affected |
| 7.0 | 20191119 | FAS/AFF Baseboard Management Controller (BMC) moved to Affected Products |
| 8.0 | 20200103 | NetApp Data Availability Services moved to Products Not Affected |
| 9.0 | 20200106 | On additional review, NetApp Data Availability Services moved to Affected Products |
| 10.0 | 20200311 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S moved to Affected Products |
| 11.0 | 20200313 | NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Affected Products |
| 12.0 | 20200327 | Active IQ Performance Analytics Services added to Software Versions and Fixes |
| 13.0 | 20200605 | FAS/AFF Baseboard Management Controller (BMC), and Service Processor added to Software Versions and Fixes |
| 14.0 | 20200724 | NetApp Data Availability Services moved to Won't Fix status |
| 15.0 | 20200901 | NetApp SteelStore Cloud Integrated Storage moved to Won't Fix status |
| 16.0 | 20201012 | NetApp HCI Baseboard Management Controller (BMC) - H610S added to Software Versions and Fixes |
| 17.0 | 20201013 | Updated Service Processor first fixed versions |
| 18.0 | 20201112 | AFF Baseboard Management Controller (BMC) - A700s added to Software Versions and Fixes |
| 19.0 | 20211012 | NetApp HCI Baseboard Management Controller (BMC) - H410C and NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S moved to Won't Fix status |
| 20.0 | 20211101 | NetApp SolidFire Baseboard Management Controller (BMC) moved to Won't Fix status |
| 21.0 | 20220106 | NetApp Cloud Backup (formerly AltaVault) moved to Won't Fix status |
| 22.0 | 20220225 | FAS/AFF Baseboard Management Controller (BMC) - A250/500f moved to Products Not Affected |
| 23.0 | 20220527 | NetApp SolidFire & HCI Management Node added to Software Versions and Fixes, Final status |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from cdn.kernel.org_742df352_20250120_234250.html ===
commit 997fee5473ce59c9b1461f54dd2975c57b258a6e
Author: Greg Kroah-Hartman
Date: Tue Sep 10 10:35:27 2019 +0100
Linux 5.2.14
commit 0ccc5c227f888185576b804a074c39334fde821a
Author: Jan Kaisrlik
Date: Tue Aug 20 13:42:29 2019 +0200
Revert "mmc: core: do not retry CMD6 in \_\_mmc\_switch()"
commit 8ad8e02c2fa70cfddc1ded53ba9001c9d444075d upstream.
Turns out the commit 3a0681c7448b ("mmc: core: do not retry CMD6 in
\_\_mmc\_switch()") breaks initialization of a Toshiba THGBMNG5 eMMC card,
when using the meson-gx-mmc.c driver on a custom board based on Amlogic
A113D.
The CMD6 that switches the card into HS200 mode is then one that fails and
according to the below printed messages from the log:
[ 1.648951] mmc0: mmc\_select\_hs200 failed, error -84
[ 1.648988] mmc0: error -84 whilst initialising MMC card
After some analyze, it turns out that adding a delay of ~5ms inside
mmc\_select\_bus\_width() but after mmc\_compare\_ext\_csds() has been executed,
also fixes the problem. Adding yet some more debug code, trying to figure
out if potentially the card could be in a busy state, both by using CMD13
and ->card\_busy() ops concluded that this was not the case.
Therefore, let's simply revert the commit that dropped support for retrying
of CMD6, as this also fixes the problem.
Fixes: 3a0681c7448b ("mmc: core: do not retry CMD6 in \_\_mmc\_switch()")
Cc: stable@vger.kernel.org
Signed-off-by: Jan Kaisrlik
Signed-off-by: Ulf Hansson
Signed-off-by: Greg Kroah-Hartman
commit 317a66e24b4608564c70eaa941a815b5ceadbcba
Author: John S. Gruber
Date: Mon Sep 2 00:00:54 2019 +0200
x86/boot: Preserve boot\_params.secure\_boot from sanitizing
commit 29d9a0b50736768f042752070e5cdf4e4d4c00df upstream.
Commit
a90118c445cc ("x86/boot: Save fields explicitly, zero out everything else")
now zeroes the secure boot setting information (enabled/disabled/...)
passed by the boot loader or by the kernel's EFI handover mechanism.
The problem manifests itself with signed kernels using the EFI handoff
protocol with grub and the kernel loses the information whether secure
boot is enabled in the firmware, i.e., the log message "Secure boot
enabled" becomes "Secure boot could not be determined".
efi\_main() arch/x86/boot/compressed/eboot.c sets this field early but it
is subsequently zeroed by the above referenced commit.
Include boot\_params.secure\_boot in the preserve field list.
[ bp: restructure commit message and massage. ]
Fixes: a90118c445cc ("x86/boot: Save fields explicitly, zero out everything else")
Signed-off-by: John S. Gruber
Signed-off-by: Borislav Petkov
Reviewed-by: John Hubbard
Cc: "H. Peter Anvin"
Cc: Ingo Molnar
Cc: Juergen Gross
Cc: Mark Brown
Cc: stable
Cc: Thomas Gleixner
Cc: x86-ml
Link: https://lkml.kernel.org/r/CAPotdmSPExAuQcy9iAHqX3js\_fc4mMLQOTr5RBGvizyCOPcTQQ@mail.gmail.com
Signed-off-by: Greg Kroah-Hartman
commit 1a7fd193e9d85d2a6b11f16e19bbaf28f75ff11b
Author: Linus Torvalds
Date: Sat Sep 7 14:25:54 2019 -0700
Revert "x86/apic: Include the LDR when clearing out APIC registers"
[ Upstream commit 950b07c14e8c59444e2359f15fd70ed5112e11a0 ]
This reverts commit 558682b5291937a70748d36fd9ba757fb25b99ae.
Chris Wilson reports that it breaks his CPU hotplug test scripts. In
particular, it breaks offlining and then re-onlining the boot CPU, which
we treat specially (and the BIOS does too).
The symptoms are that we can offline the CPU, but it then does not come
back online again:
smpboot: CPU 0 is now offline
smpboot: Booting Node 0 Processor 0 APIC 0x0
smpboot: do\_boot\_cpu failed(-1) to wakeup CPU#0
Thomas says he knows why it's broken (my personal suspicion: our magic
handling of the "cpu0\_logical\_apicid" thing), but for 5.3 the right fix
is to just revert it, since we've never touched the LDR bits before, and
it's not worth the risk to do anything else at this stage.
[ Hotpluging of the boot CPU is special anyway, and should be off by
default. See the "BOOTPARAM\_HOTPLUG\_CPU0" config option and the
cpu0\_hotplug kernel parameter.
In general you should not do it, and it has various known limitations
(hibernate and suspend require the boot CPU, for example).
But it should work, even if the boot CPU is special and needs careful
treatment - Linus ]
Link: https://lore.kernel.org/lkml/156785100521.13300.14461504732265570003@skylake-alporthouse-com/
Reported-by: Chris Wilson
Acked-by: Thomas Gleixner
Cc: Bandan Das
Signed-off-by: Linus Torvalds
Signed-off-by: Sasha Levin
commit ae96cf9e1e3196eecde327a6efc9e30b70537741
Author: Luis Henriques
Date: Fri Jul 19 15:32:19 2019 +0100
libceph: allow ceph\_buffer\_put() to receive a NULL ceph\_buffer
[ Upstream commit 5c498950f730aa17c5f8a2cdcb903524e4002ed2 ]
Signed-off-by: Luis Henriques
Reviewed-by: Jeff Layton
Signed-off-by: Ilya Dryomov
Signed-off-by: Sasha Levin
commit 8d50b82ea79b57d53164d60d5bd6f44248b436f0
Author: Kirill A. Shutemov
Date: Mon Aug 26 16:26:01 2019 +0300
x86/boot/compressed/64: Fix missing initialization in find\_trampoline\_placement()
[ Upstream commit c96e8483cb2da6695c8b8d0896fe7ae272a07b54 ]
Gustavo noticed that 'new' can be left uninitialized if 'bios\_start'
happens to be less or equal to 'entry->addr + entry->size'.
Initialize the variable at the begin of the iteration to the current value
of 'bios\_start'.
Fixes: 0a46fff2f910 ("x86/boot/compressed/64: Fix boot on machines with broken E820 table")
Reported-by: "Gustavo A. R. Silva"
Signed-off-by: Kirill A. Shutemov
Signed-off-by: Thomas Gleixner
Link: https://lkml.kernel.org/r/20190826133326.7cxb4vbmiawffv2r@box
Signed-off-by: Sasha Levin
commit 852a051ef22bc8e6dd2d4bd5f3e90509c770beb6
Author: Andre Przywara
Date: Fri Aug 23 11:34:16 2019 +0100
KVM: arm/arm64: VGIC: Properly initialise private IRQ affinity
[ Upstream commit 2e16f3e926ed48373c98edea85c6ad0ef69425d1 ]
At the moment we initialise the target \*mask\* of a virtual IRQ to the
VCPU it belongs to, even though this mask is only defined for GICv2 and
quickly runs out of bits for many GICv3 guests.
This behaviour triggers an UBSAN complaint for more than 32 VCPUs:
------
[ 5659.462377] UBSAN: Undefined behaviour in virt/kvm/arm/vgic/vgic-init.c:223:21
[ 5659.471689] shift exponent 32 is too large for 32-bit type 'unsigned int'
------
Also for GICv3 guests the reporting of TARGET in the "vgic-state" debugfs
dump is wrong, due to this very same problem.
Because there is no requirement to create the VGIC device before the
VCPUs (and QEMU actually does it the other way round), we can't safely
initialise mpidr or targets in kvm\_vgic\_vcpu\_init(). But since we touch
every private IRQ for each VCPU anyway later (in vgic\_init()), we can
just move the initialisation of those fields into there, where we
definitely know the VGIC type.
On the way make sure we really have either a VGICv2 or a VGICv3 device,
since the existing code is just checking for "VGICv3 or not", silently
ignoring the uninitialised case.
Signed-off-by: Andre Przywara
Reported-by: Dave Martin
Tested-by: Julien Grall
Signed-off-by: Marc Zyngier
Signed-off-by: Sasha Levin
commit 44dfa46aaf7cf594ac89bc1a0c0e56c498b31269
Author: Linus Walleij
Date: Tue Aug 20 10:05:27 2019 +0200
gpio: Fix irqchip initialization order
[ Upstream commit 48057ed1840fde9239b1e000bea1a0a1f07c5e99 ]
The new API for registering a gpio\_irq\_chip along with a
gpio\_chip has a different semantic ordering than the old
API which added the irqchip explicitly after registering
the gpio\_chip.
Move the calls to add the gpio\_irq\_chip \*last\* in the
function, so that the different hooks setting up OF and
ACPI and machine gpio\_chips are called \*before\* we try
to register the interrupts, preserving the elder semantic
order.
This cropped up in the PL061 driver which used to work
fine with no special ACPI quirks, but started to misbehave
using the new API.
Fixes: e0d897289813 ("gpio: Implement tighter IRQ chip integration")
Cc: Thierry Reding
Cc: Grygorii Strashko
Cc: Andy Shevchenko
Reported-by: Wei Xu
Tested-by: Wei Xu
Reported-by: Andy Shevchenko
Signed-off-by: Linus Walleij
Link: https://lore.kernel.org/r/20190820080527.11796-1-linus.walleij@linaro.org
Signed-off-by: Sasha Levin
commit 157ec0a3f834ba449a2fa1c1c9075862a614ed52
Author: Selvin Xavier
Date: Thu Aug 22 03:02:50 2019 -0700
RDMA/bnxt\_re: Fix stack-out-of-bounds in bnxt\_qplib\_rcfw\_send\_message
[ Upstream commit d37b1e534071ab1983e7c85273234b132c77591a ]
Driver copies FW commands to the HW queue as units of 16 bytes. Some
of the command structures are not exact multiple of 16. So while copying
the data from those structures, the stack out of bounds messages are
reported by KASAN. The following error is reported.
[ 1337.530155] ==================================================================
[ 1337.530277] BUG: KASAN: stack-out-of-bounds in bnxt\_qplib\_rcfw\_send\_message+0x40a/0x850 [bnxt\_re]
[ 1337.530413] Read of size 16 at addr ffff888725477a48 by task rmmod/2785
[ 1337.530540] CPU: 5 PID: 2785 Comm: rmmod Tainted: G OE 5.2.0-rc6+ #75
[ 1337.530541] Hardware name: Dell Inc. PowerEdge R730/0599V5, BIOS 1.0.4 08/28/2014
[ 1337.530542] Call Trace:
[ 1337.530548] dump\_stack+0x5b/0x90
[ 1337.530556] ? bnxt\_qplib\_rcfw\_send\_message+0x40a/0x850 [bnxt\_re]
[ 1337.530560] print\_address\_description+0x65/0x22e
[ 1337.530568] ? bnxt\_qplib\_rcfw\_send\_message+0x40a/0x850 [bnxt\_re]
[ 1337.530575] ? bnxt\_qplib\_rcfw\_send\_message+0x40a/0x850 [bnxt\_re]
[ 1337.530577] \_\_kasan\_report.cold.3+0x37/0x77
[ 1337.530581] ? \_raw\_write\_trylock+0x10/0xe0
[ 1337.530588] ? bnxt\_qplib\_rcfw\_send\_message+0x40a/0x850 [bnxt\_re]
[ 1337.530590] kasan\_report+0xe/0x20
[ 1337.530592] memcpy+0x1f/0x50
[ 1337.530600] bnxt\_qplib\_rcfw\_send\_message+0x40a/0x850 [bnxt\_re]
[ 1337.530608] ? bnxt\_qplib\_creq\_irq+0xa0/0xa0 [bnxt\_re]
[ 1337.530611] ? xas\_create+0x3aa/0x5f0
[ 1337.530613] ? xas\_start+0x77/0x110
[ 1337.530615] ? xas\_clear\_mark+0x34/0xd0
[ 1337.530623] bnxt\_qplib\_free\_mrw+0x104/0x1a0 [bnxt\_re]
[ 1337.530631] ? bnxt\_qplib\_destroy\_ah+0x110/0x110 [bnxt\_re]
[ 1337.530633] ? bit\_wait\_io\_timeout+0xc0/0xc0
[ 1337.530641] bnxt\_re\_dealloc\_mw+0x2c/0x60 [bnxt\_re]
[ 1337.530648] bnxt\_re\_destroy\_fence\_mr+0x77/0x1d0 [bnxt\_re]
[ 1337.530655] bnxt\_re\_dealloc\_pd+0x25/0x60 [bnxt\_re]
[ 1337.530677] ib\_dealloc\_pd\_user+0xbe/0xe0 [ib\_core]
[ 1337.530683] srpt\_remove\_one+0x5de/0x690 [ib\_srpt]
[ 1337.530689] ? \_\_srpt\_close\_all\_ch+0xc0/0xc0 [ib\_srpt]
[ 1337.530692] ? xa\_load+0x87/0xe0
...
[ 1337.530840] do\_syscall\_64+0x6d/0x1f0
[ 1337.530843] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
[ 1337.530845] RIP: 0033:0x7ff5b389035b
[ 1337.530848] Code: 73 01 c3 48 8b 0d 2d 0b 2c 00 f7 d8 64 89 01 48 83 c8 ff c3 66 2e 0f 1f 84 00 00 00 00 00 90 f3 0f 1e fa b8 b0 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d fd 0a 2c 00 f7 d8 64 89 01 48
[ 1337.530849] RSP: 002b:00007fff83425c28 EFLAGS: 00000206 ORIG\_RAX: 00000000000000b0
[ 1337.530852] RAX: ffffffffffffffda RBX: 00005596443e6750 RCX: 00007ff5b389035b
[ 1337.530853] RDX: 000000000000000a RSI: 0000000000000800 RDI: 00005596443e67b8
[ 1337.530854] RBP: 0000000000000000 R08: 00007fff83424ba1 R09: 0000000000000000
[ 1337.530856] R10: 00007ff5b3902960 R11: 0000000000000206 R12: 00007fff83425e50
[ 1337.530857] R13: 00007fff8342673c R14: 00005596443e6260 R15: 00005596443e6750
[ 1337.530885] The buggy address belongs to the page:
[ 1337.530962] page:ffffea001c951dc0 refcount:0 mapcount:0 mapping:0000000000000000 index:0x0
[ 1337.530964] flags: 0x57ffffc0000000()
[ 1337.530967] raw: 0057ffffc0000000 0000000000000000 ffffffff1c950101 0000000000000000
[ 1337.530970] raw: 0000000000000000 0000000000000000 00000000ffffffff 0000000000000000
[ 1337.530970] page dumped because: kasan: bad access detected
[ 1337.530996] Memory state around the buggy address:
[ 1337.531072] ffff888725477900: 00 00 00 00 f1 f1 f1 f1 00 00 00 00 00 f2 f2 f2
[ 1337.531180] ffff888725477980: 00 00 00 00 00 00 00 00 00 00 00 f1 f1 f1 f1 00
[ 1337.531288] >ffff888725477a00: 00 f2 f2 f2 f2 f2 f2 00 00 00 f2 00 00 00 00 00
[ 1337.531393] ^
[ 1337.531478] ffff888725477a80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[ 1337.531585] ffff888725477b00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[ 1337.531691] ==================================================================
Fix this by passing the exact size of each FW command to
bnxt\_qplib\_rcfw\_send\_message as req->cmd\_size. Before sending
the command to HW, modify the req->cmd\_size to number of 16 byte units.
Fixes: 1ac5a4047975 ("RDMA/bnxt\_re: Add bnxt\_re RoCE driver")
Signed-off-by: Selvin Xavier
Link: https://lore.kernel.org/r/1566468170-489-1-git-send-email-selvin.xavier@broadcom.com
Signed-off-by: Doug Ledford
Signed-off-by: Sasha Levin
commit cf9ec2e9056cb7407d72c68b8346bf5a30225122
Author: YueHaibing
Date: Mon Aug 19 16:05:31 2019 +0100
afs: use correct afs\_call\_type in yfs\_fs\_store\_opaque\_acl2
[ Upstream commit 7533be858f5b9a036b9f91556a3ed70786abca8e ]
It seems that 'yfs\_RXYFSStoreOpaqueACL2' should be use in
yfs\_fs\_store\_opaque\_acl2().
Fixes: f5e4546347bc ("afs: Implement YFS ACL setting")
Signed-off-by: YueHaibing
Signed-off-by: David Howells
Signed-off-by: Sasha Levin
commit 3f66858358891311582a179d3443cfcdde476e86
Author: Marc Dionne
Date: Thu Aug 22 13:28:43 2019 +0100
afs: Fix possible oops in afs\_lookup trace event
[ Upstream commit c4c613ff08d92e72bf64a65ec35a2c3aa1cfcd06 ]
The afs\_lookup trace event can cause the following:
[ 216.576777] BUG: kernel NULL pointer dereference, address: 000000000000023b
[ 216.576803] #PF: supervisor read access in kernel mode
[ 216.576813] #PF: error\_code(0x0000) - not-present page
...
[ 216.576913] RIP: 0010:trace\_event\_raw\_event\_afs\_lookup+0x9e/0x1c0 [kafs]
If the inode from afs\_do\_lookup() is an error other than ENOENT, or if it
is ENOENT and afs\_try\_auto\_mntpt() returns an error, the trace event will
try to dereference the error pointer as a valid pointer.
Use IS\_ERR\_OR\_NULL to only pass a valid pointer for the trace, or NULL.
Ideally the trace would include the error value, but for now just avoid
the oops.
Fixes: 80548b03991f ("afs: Add more tracepoints")
Signed-off-by: Marc Dionne
Signed-off-by: David Howells
Signed-off-by: Sasha Levin
commit c231241d83b960ec7b57f172921d223c28dce014
Author: David Howells
Date: Thu Aug 22 13:28:43 2019 +0100
afs: Fix leak in afs\_lookup\_cell\_rcu()
[ Upstream commit a5fb8e6c02d6a518fb2b1a2b8c2471fa77b69436 ]
Fix a leak on the cell refcount in afs\_lookup\_cell\_rcu() due to
non-clearance of the default error in the case a NULL cell name is passed
and the workstation default cell is used.
Also put a bit at the end to make sure we don't leak a cell ref if we're
going to be returning an error.
This leak results in an assertion like the following when the kafs module is
unloaded:
AFS: Assertion failed
2 == 1 is false
0x2 == 0x1 is false
------------[ cut here ]------------
kernel BUG at fs/afs/cell.c:770!
...
RIP: 0010:afs\_manage\_cells+0x220/0x42f [kafs]
...
process\_one\_work+0x4c2/0x82c
? pool\_mayday\_timeout+0x1e1/0x1e1
? do\_raw\_spin\_lock+0x134/0x175
worker\_thread+0x336/0x4a6
? rescuer\_thread+0x4af/0x4af
kthread+0x1de/0x1ee
? kthread\_park+0xd4/0xd4
ret\_from\_fork+0x24/0x30
Fixes: 989782dcdc91 ("afs: Overhaul cell database management")
Signed-off-by: David Howells
Signed-off-by: Sasha Levin
commit 7f134d569e1ab172d37de5c22e5bb000a036ac4c
Author: Andrew Jones
Date: Thu Aug 22 13:03:05 2019 +0200
KVM: arm/arm64: Only skip MMIO insn once
[ Upstream commit 2113c5f62b7423e4a72b890bd479704aa85c81ba ]
If after an MMIO exit to userspace a VCPU is immediately run with an
immediate\_exit request, such as when a signal is delivered or an MMIO
emulation completion is needed, then the VCPU completes the MMIO
emulation and immediately returns to userspace. As the exit\_reason
does not get changed from KVM\_EXIT\_MMIO in these cases we have to
be careful not to complete the MMIO emulation again, when the VCPU is
eventually run again, because the emulation does an instruction skip
(and doing too many skips would be a waste of guest code :-) We need
to use additional VCPU state to track if the emulation is complete.
As luck would have it, we already have 'mmio\_needed', which even
appears to be used in this way by other architectures already.
Fixes: 0d640732dbeb ("arm64: KVM: Skip MMIO insn after emulation")
Acked-by: Mark Rutland
Signed-off-by: Andrew Jones
Signed-off-by: Marc Zyngier
Signed-off-by: Sasha Levin
commit 39c62cdaa2d41ea9007b80b6a4bf04a69d5ba32c
Author: Luis Henriques
Date: Fri Jul 19 15:32:22 2019 +0100
ceph: fix buffer free while holding i\_ceph\_lock in fill\_inode()
[ Upstream commit af8a85a41734f37b67ba8ce69d56b685bee4ac48 ]
Calling ceph\_buffer\_put() in fill\_inode() may result in freeing the
i\_xattrs.blob buffer while holding the i\_ceph\_lock. This can be fixed by
postponing the call until later, when the lock is released.
The following backtrace was triggered by fstests generic/070.
BUG: sleeping function called from invalid context at mm/vmalloc.c:2283
in\_atomic(): 1, irqs\_disabled(): 0, pid: 3852, name: kworker/0:4
6 locks held by kworker/0:4/3852:
#0: 000000004270f6bb ((wq\_completion)ceph-msgr){+.+.}, at: process\_one\_work+0x1b8/0x5f0
#1: 00000000eb420803 ((work\_completion)(&(&con->work)->work)){+.+.}, at: process\_one\_work+0x1b8/0x5f0
#2: 00000000be1c53a4 (&s->s\_mutex){+.+.}, at: dispatch+0x288/0x1476
#3: 00000000559cb958 (&mdsc->snap\_rwsem){++++}, at: dispatch+0x2eb/0x1476
#4: 000000000d5ebbae (&req->r\_fill\_mutex){+.+.}, at: dispatch+0x2fc/0x1476
#5: 00000000a83d0514 (&(&ci->i\_ceph\_lock)->rlock){+.+.}, at: fill\_inode.isra.0+0xf8/0xf70
CPU: 0 PID: 3852 Comm: kworker/0:4 Not tainted 5.2.0+ #441
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.12.1-0-ga5cab58-prebuilt.qemu.org 04/01/2014
Workqueue: ceph-msgr ceph\_con\_workfn
Call Trace:
dump\_stack+0x67/0x90
\_\_\_might\_sleep.cold+0x9f/0xb1
vfree+0x4b/0x60
ceph\_buffer\_release+0x1b/0x60
fill\_inode.isra.0+0xa9b/0xf70
ceph\_fill\_trace+0x13b/0xc70
? dispatch+0x2eb/0x1476
dispatch+0x320/0x1476
? \_\_mutex\_unlock\_slowpath+0x4d/0x2a0
ceph\_con\_workfn+0xc97/0x2ec0
? process\_one\_work+0x1b8/0x5f0
process\_one\_work+0x244/0x5f0
worker\_thread+0x4d/0x3e0
kthread+0x105/0x140
? process\_one\_work+0x5f0/0x5f0
? kthread\_park+0x90/0x90
ret\_from\_fork+0x3a/0x50
Signed-off-by: Luis Henriques
Reviewed-by: Jeff Layton
Signed-off-by: Ilya Dryomov
Signed-off-by: Sasha Levin
commit c4e28be29a456fce5a96c1ce57642f78699948f0
Author: Luis Henriques
Date: Fri Jul 19 15:32:21 2019 +0100
ceph: fix buffer free while holding i\_ceph\_lock in \_\_ceph\_build\_xattrs\_blob()
[ Upstream commit 12fe3dda7ed89c95cc0ef7abc001ad1ad3e092f8 ]
Calling ceph\_buffer\_put() in \_\_ceph\_build\_xattrs\_blob() may result in
freeing the i\_xattrs.blob buffer while holding the i\_ceph\_lock. This can
be fixed by having this function returning the old blob buffer and have
the callers of this function freeing it when the lock is released.
The following backtrace was triggered by fstests generic/117.
BUG: sleeping function called from invalid context at mm/vmalloc.c:2283
in\_atomic(): 1, irqs\_disabled(): 0, pid: 649, name: fsstress
4 locks held by fsstress/649:
#0: 00000000a7478e7e (&type->s\_umount\_key#19){++++}, at: iterate\_supers+0x77/0xf0
#1: 00000000f8de1423 (&(&ci->i\_ceph\_lock)->rlock){+.+.}, at: ceph\_check\_caps+0x7b/0xc60
#2: 00000000562f2b27 (&s->s\_mutex){+.+.}, at: ceph\_check\_caps+0x3bd/0xc60
#3: 00000000f83ce16a (&mdsc->snap\_rwsem){++++}, at: ceph\_check\_caps+0x3ed/0xc60
CPU: 1 PID: 649 Comm: fsstress Not tainted 5.2.0+ #439
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.12.1-0-ga5cab58-prebuilt.qemu.org 04/01/2014
Call Trace:
dump\_stack+0x67/0x90
\_\_\_might\_sleep.cold+0x9f/0xb1
vfree+0x4b/0x60
ceph\_buffer\_release+0x1b/0x60
\_\_ceph\_build\_xattrs\_blob+0x12b/0x170
\_\_send\_cap+0x302/0x540
? \_\_lock\_acquire+0x23c/0x1e40
? \_\_mark\_caps\_flushing+0x15c/0x280
? \_raw\_spin\_unlock+0x24/0x30
ceph\_check\_caps+0x5f0/0xc60
ceph\_flush\_dirty\_caps+0x7c/0x150
? \_\_ia32\_sys\_fdatasync+0x20/0x20
ceph\_sync\_fs+0x5a/0x130
iterate\_supers+0x8f/0xf0
ksys\_sync+0x4f/0xb0
\_\_ia32\_sys\_sync+0xa/0x10
do\_syscall\_64+0x50/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
RIP: 0033:0x7fc6409ab617
Signed-off-by: Luis Henriques
Reviewed-by: Jeff Layton
Signed-off-by: Ilya Dryomov
Signed-off-by: Sasha Levin
commit f41cd559f1f3412db8e0acdede05ecf990ebfd8a
Author: Luis Henriques
Date: Fri Jul 19 15:32:20 2019 +0100
ceph: fix buffer free while holding i\_ceph\_lock in \_\_ceph\_setxattr()
[ Upstream commit 86968ef21596515958d5f0a40233d02be78ecec0 ]
Calling ceph\_buffer\_put() in \_\_ceph\_setxattr() may end up freeing the
i\_xattrs.prealloc\_blob buffer while holding the i\_ceph\_lock. This can be
fixed by postponing the call until later, when the lock is released.
The following backtrace was triggered by fstests generic/117.
BUG: sleeping function called from invalid context at mm/vmalloc.c:2283
in\_atomic(): 1, irqs\_disabled(): 0, pid: 650, name: fsstress
3 locks held by fsstress/650:
#0: 00000000870a0fe8 (sb\_writers#8){.+.+}, at: mnt\_want\_write+0x20/0x50
#1: 00000000ba0c4c74 (&type->i\_mutex\_dir\_key#6){++++}, at: vfs\_setxattr+0x55/0xa0
#2: 000000008dfbb3f2 (&(&ci->i\_ceph\_lock)->rlock){+.+.}, at: \_\_ceph\_setxattr+0x297/0x810
CPU: 1 PID: 650 Comm: fsstress Not tainted 5.2.0+ #437
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.12.1-0-ga5cab58-prebuilt.qemu.org 04/01/2014
Call Trace:
dump\_stack+0x67/0x90
\_\_\_might\_sleep.cold+0x9f/0xb1
vfree+0x4b/0x60
ceph\_buffer\_release+0x1b/0x60
\_\_ceph\_setxattr+0x2b4/0x810
\_\_vfs\_setxattr+0x66/0x80
\_\_vfs\_setxattr\_noperm+0x59/0xf0
vfs\_setxattr+0x81/0xa0
setxattr+0x115/0x230
? filename\_lookup+0xc9/0x140
? rcu\_read\_lock\_sched\_held+0x74/0x80
? rcu\_sync\_lockdep\_assert+0x2e/0x60
? \_\_sb\_start\_write+0x142/0x1a0
? mnt\_want\_write+0x20/0x50
path\_setxattr+0xba/0xd0
\_\_x64\_sys\_lsetxattr+0x24/0x30
do\_syscall\_64+0x50/0x1c0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
RIP: 0033:0x7ff23514359a
Signed-off-by: Luis Henriques
Reviewed-by: Jeff Layton
Signed-off-by: Ilya Dryomov
Signed-off-by: Sasha Levin
commit 3ebab463e9f42a186389e490bc199476db2a14d5
Author: Nicolai Hähnle
Date: Tue Aug 20 15:39:53 2019 +0200
drm/amdgpu: prevent memory leaks in AMDGPU\_CS ioctl
[ Upstream commit 1a701ea924815b0518733aa8d5d05c1f6fa87062 ]
Error out if the AMDGPU\_CS ioctl is called with multiple SYNCOBJ\_OUT and/or
TIMELINE\_SIGNAL chunks, since otherwise the last chunk wins while the
allocated array as well as the reference counts of sync objects are leaked.
Signed-off-by: Nicolai Hähnle
Reviewed-by: Christian König
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
commit 23da8e9ef69bc9af8f542edcf2123441edb45071
Author: Vitaly Kuznetsov
Date: Mon Jun 10 19:22:55 2019 +0200
selftests/kvm: make platform\_info\_test pass on AMD
[ Upstream commit e4427372398c31f57450565de277f861a4db5b3b ]
test\_msr\_platform\_info\_disabled() generates EXIT\_SHUTDOWN but VMCB state
is undefined after that so an attempt to launch this guest again from
test\_msr\_platform\_info\_enabled() fails. Reorder the tests to make test
pass.
Signed-off-by: Vitaly Kuznetsov
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit 666a41848d72bed82ef323d5139a651569fc0e27
Author: Paolo Bonzini
Date: Tue Aug 20 17:35:52 2019 +0200
selftests: kvm: fix state save/load on processors without XSAVE
[ Upstream commit 54577e5018a8c0cb79c9a0fa118a55c68715d398 ]
state\_test and smm\_test are failing on older processors that do not
have xcr0. This is because on those processor KVM does provide
support for KVM\_GET/SET\_XSAVE (to avoid having to rely on the older
KVM\_GET/SET\_FPU) but not for KVM\_GET/SET\_XCRS.
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit dd53d830bb30fe1164e49a8c4677144fbd10940c
Author: Wenwen Wang
Date: Sun Aug 18 13:54:46 2019 -0500
infiniband: hfi1: fix memory leaks
[ Upstream commit 2323d7baab2b18d87d9bc267452e387aa9f0060a ]
In fault\_opcodes\_write(), 'data' is allocated through kcalloc(). However,
it is not deallocated in the following execution if an error occurs,
leading to memory leaks. To fix this issue, introduce the 'free\_data' label
to free 'data' before returning the error.
Signed-off-by: Wenwen Wang
Reviewed-by: Leon Romanovsky
Acked-by: Dennis Dalessandro
Link: https://lore.kernel.org/r/1566154486-3713-1-git-send-email-wenwen@cs.uga.edu
Signed-off-by: Doug Ledford
Signed-off-by: Sasha Levin
commit bcb3211656fa24090a828cc2ee13cf8f3b95f08d
Author: Wenwen Wang
Date: Sun Aug 18 14:29:31 2019 -0500
infiniband: hfi1: fix a memory leak bug
[ Upstream commit b08afa064c320e5d85cdc27228426b696c4c8dae ]
In fault\_opcodes\_read(), 'data' is not deallocated if debugfs\_file\_get()
fails, leading to a memory leak. To fix this bug, introduce the 'free\_data'
label to free 'data' before returning the error.
Signed-off-by: Wenwen Wang
Reviewed-by: Leon Romanovsky
Acked-by: Dennis Dalessandro
Link: https://lore.kernel.org/r/1566156571-4335-1-git-send-email-wenwen@cs.uga.edu
Signed-off-by: Doug Ledford
Signed-off-by: Sasha Levin
commit 1e93149659ccd7a427a73788b96b2e8d922688a0
Author: Wenwen Wang
Date: Sun Aug 18 15:23:01 2019 -0500
IB/mlx4: Fix memory leaks
[ Upstream commit 5c1baaa82cea2c815a5180ded402a7cd455d1810 ]
In mlx4\_ib\_alloc\_pv\_bufs(), 'tun\_qp->tx\_ring' is allocated through
kcalloc(). However, it is not always deallocated in the following execution
if an error occurs, leading to memory leaks. To fix this issue, free
'tun\_qp->tx\_ring' whenever an error occurs.
Signed-off-by: Wenwen Wang
Acked-by: Leon Romanovsky
Link: https://lore.kernel.org/r/1566159781-4642-1-git-send-email-wenwen@cs.uga.edu
Signed-off-by: Doug Ledford
Signed-off-by: Sasha Levin
commit fc38afc0434394e48d6170fd303e1dc99bb08989
Author: zhengbin
Date: Mon Aug 19 12:27:39 2019 +0800
RDMA/cma: fix null-ptr-deref Read in cma\_cleanup
[ Upstream commit a7bfb93f0211b4a2f1ffeeb259ed6206bac30460 ]
In cma\_init, if cma\_configfs\_init fails, need to free the
previously memory and return fail, otherwise will trigger
null-ptr-deref Read in cma\_cleanup.
cma\_cleanup
cma\_configfs\_exit
configfs\_unregister\_subsystem
Fixes: 045959db65c6 ("IB/cma: Add configfs for rdma\_cm")
Reported-by: Hulk Robot
Signed-off-by: zhengbin
Reviewed-by: Parav Pandit
Link: https://lore.kernel.org/r/1566188859-103051-1-git-send-email-zhengbin13@huawei.com
Signed-off-by: Doug Ledford
Signed-off-by: Sasha Levin
commit d61a256fece284909132d7e8eb6b7d385b864eac
Author: Guilherme G. Piccoli
Date: Wed Aug 14 11:26:10 2019 -0300
nvme: Fix cntlid validation when not using NVMEoF
[ Upstream commit a89fcca8185633993018dc081d6b021d005e6d0b ]
Commit 1b1031ca63b2 ("nvme: validate cntlid during controller initialisation")
introduced a validation for controllers with duplicate cntlid that runs
on nvme\_init\_subsystem(). The problem is that the validation relies on
ctrl->cntlid, and this value is assigned (from id\_ctrl value) after the
call for nvme\_init\_subsystem() in nvme\_init\_identify() for non-fabrics
scenario. That leads to ctrl->cntlid always being 0 in case we have a
physical set of controllers in the same subsystem.
This patch fixes that by loading the discovered cntlid id\_ctrl value into
ctrl->cntlid before the subsystem initialization, only for the non-fabrics
case. The patch was tested with emulated nvme devices (qemu) having two
controllers in a single subsystem. Without the patch, we couldn't make
it work failing in the duplicate check; when running with the patch, we
could see the subsystem holding both controllers.
For the fabrics case we see ctrl->cntlid has a more intricate relation
with the admin connect, so we didn't change that.
Fixes: 1b1031ca63b2 ("nvme: validate cntlid during controller initialisation")
Signed-off-by: Guilherme G. Piccoli
Reviewed-by: Sagi Grimberg
Signed-off-by: Sagi Grimberg
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit e1031b6c8100dba0da0d672f98db3a03139a3f93
Author: Anton Eidelman
Date: Mon Aug 12 23:00:36 2019 +0300
nvme-multipath: fix possible I/O hang when paths are updated
[ Upstream commit 504db087aaccdb32af61539916409f7dca31ceb5 ]
nvme\_state\_set\_live() making a path available triggers requeue\_work
in order to resubmit requests that ended up on requeue\_list when no
paths were available.
This requeue\_work may race with concurrent nvme\_ns\_head\_make\_request()
that do not observe the live path yet.
Such concurrent requests may by made by either:
- New IO submission.
- Requeue\_work triggered by nvme\_failover\_req() or another ana\_work.
A race may cause requeue\_work capture the state of requeue\_list before
more requests get onto the list. These requests will stay on the list
forever unless requeue\_work is triggered again.
In order to prevent such race, nvme\_state\_set\_live() should
synchronize\_srcu(&head->srcu) before triggering the requeue\_work and
prevent nvme\_ns\_head\_make\_request referencing an old snapshot of the
path list.
Reviewed-by: Christoph Hellwig
Signed-off-by: Anton Eidelman
Signed-off-by: Sagi Grimberg
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 6950d5b64a15407f10959f8a2e634ee65c576aea
Author: Vitaly Kuznetsov
Date: Mon Aug 19 16:44:09 2019 +0200
Tools: hv: kvp: eliminate 'may be used uninitialized' warning
[ Upstream commit 89eb4d8d25722a0a0194cf7fa47ba602e32a6da7 ]
When building hv\_kvp\_daemon GCC-8.3 complains:
hv\_kvp\_daemon.c: In function ‘kvp\_get\_ip\_info.constprop’:
hv\_kvp\_daemon.c:812:30: warning: ‘ip\_buffer’ may be used uninitialized in this function [-Wmaybe-uninitialized]
struct hv\_kvp\_ipaddr\_value \*ip\_buffer;
this seems to be a false positive: we only use ip\_buffer when
op == KVP\_OP\_GET\_IP\_INFO and it is only unset when op == KVP\_OP\_ENUMERATE.
Silence the warning by initializing ip\_buffer to NULL.
Signed-off-by: Vitaly Kuznetsov
Signed-off-by: Sasha Levin
commit 195b5aa923ecbd69ff8893166f18f37e024b896e
Author: Dexuan Cui
Date: Tue Aug 20 03:01:23 2019 +0000
Input: hyperv-keyboard: Use in-place iterator API in the channel callback
[ Upstream commit d09bc83640d524b8467a660db7b1d15e6562a1de ]
Simplify the ring buffer handling with the in-place API.
Also avoid the dynamic allocation and the memory leak in the channel
callback function.
Signed-off-by: Dexuan Cui
Acked-by: Dmitry Torokhov
Signed-off-by: Sasha Levin
commit 31b60e5c604c99766bd6f5692ed954eee585807b
Author: James Smart
Date: Thu Aug 15 19:36:49 2019 -0700
scsi: lpfc: Mitigate high memory pre-allocation by SCSI-MQ
[ Upstream commit 77ffd3465ba837e9dc714e17b014e77b2eae765a ]
When SCSI-MQ is enabled, the SCSI-MQ layers will do pre-allocation of MQ
resources based on shost values set by the driver. In newer cases of the
driver, which attempts to set nr\_hw\_queues to the cpu count, the
multipliers become excessive, with a single shost having SCSI-MQ
pre-allocation reaching into the multiple GBytes range. NPIV, which
creates additional shosts, only multiply this overhead. On lower-memory
systems, this can exhaust system memory very quickly, resulting in a system
crash or failures in the driver or elsewhere due to low memory conditions.
After testing several scenarios, the situation can be mitigated by limiting
the value set in shost->nr\_hw\_queues to 4. Although the shost values were
changed, the driver still had per-cpu hardware queues of its own that
allowed parallelization per-cpu. Testing revealed that even with the
smallish number for nr\_hw\_queues for SCSI-MQ, performance levels remained
near maximum with the within-driver affiinitization.
A module parameter was created to allow the value set for the nr\_hw\_queues
to be tunable.
Signed-off-by: Dick Kennedy
Signed-off-by: James Smart
Reviewed-by: Ming Lei
Reviewed-by: Ewan D. Milne
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit aa4bc3a352535c68a3625ad0d57d23748b4166a4
Author: Kirill A. Shutemov
Date: Tue Aug 13 16:16:54 2019 +0300
x86/boot/compressed/64: Fix boot on machines with broken E820 table
[ Upstream commit 0a46fff2f9108c2c44218380a43a736cf4612541 ]
BIOS on Samsung 500C Chromebook reports very rudimentary E820 table that
consists of 2 entries:
BIOS-e820: [mem 0x0000000000000000-0x0000000000000fff] usable
BIOS-e820: [mem 0x00000000fffff000-0x00000000ffffffff] reserved
It breaks logic in find\_trampoline\_placement(): bios\_start lands on the
end of the first 4k page and trampoline start gets placed below 0.
Detect underflow and don't touch bios\_start for such cases. It makes
kernel ignore E820 table on machines that doesn't have two usable pages
below BIOS\_START\_MAX.
Fixes: 1b3a62643660 ("x86/boot/compressed/64: Validate trampoline placement against E820")
Signed-off-by: Kirill A. Shutemov
Signed-off-by: Borislav Petkov
Cc: "H. Peter Anvin"
Cc: Ingo Molnar
Cc: Thomas Gleixner
Cc: x86-ml
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=203463
Link: https://lkml.kernel.org/r/20190813131654.24378-1-kirill.shutemov@linux.intel.com
Signed-off-by: Sasha Levin
commit 3091859b0b5e5f3c03d809dd7f1b915355b24076
Author: Benjamin Tissoires
Date: Mon Aug 12 18:04:44 2019 +0200
HID: cp2112: prevent sleeping function called from invalid context
[ Upstream commit 2d05dba2b25ecb0f8fc3a0b4eb2232da6454a47b ]
When calling request\_threaded\_irq() with a CP2112, the function
cp2112\_gpio\_irq\_startup() is called in a IRQ context.
Therefore we can not sleep, and we can not call
cp2112\_gpio\_direction\_input() there.
Move the call to cp2112\_gpio\_direction\_input() earlier to have a working
driver.
Signed-off-by: Benjamin Tissoires
Signed-off-by: Jiri Kosina
Signed-off-by: Sasha Levin
commit e8fd4f47b22470e2c1f01f8defce0f4147a4d342
Author: Even Xu
Date: Fri Aug 9 21:18:29 2019 +0800
HID: intel-ish-hid: ipc: add EHL device id
[ Upstream commit b640be5bc8e4673dc8049cf74176ddedecea5597 ]
EHL is a new platform using ishtp solution, add its device id
to support list.
Signed-off-by: Even Xu
Acked-by: Srinivas Pandruvada
Signed-off-by: Jiri Kosina
Signed-off-by: Sasha Levin
commit d58500c6fcb4485f3cee50eb09b308adc37fd0f4
Author: Andrea Righi
Date: Mon Aug 12 20:43:02 2019 +0200
kprobes: Fix potential deadlock in kprobe\_optimizer()
[ Upstream commit f1c6ece23729257fb46562ff9224cf5f61b818da ]
lockdep reports the following deadlock scenario:
WARNING: possible circular locking dependency detected
kworker/1:1/48 is trying to acquire lock:
000000008d7a62b2 (text\_mutex){+.+.}, at: kprobe\_optimizer+0x163/0x290
but task is already holding lock:
00000000850b5e2d (module\_mutex){+.+.}, at: kprobe\_optimizer+0x31/0x290
which lock already depends on the new lock.
the existing dependency chain (in reverse order) is:
-> #1 (module\_mutex){+.+.}:
\_\_mutex\_lock+0xac/0x9f0
mutex\_lock\_nested+0x1b/0x20
set\_all\_modules\_text\_rw+0x22/0x90
ftrace\_arch\_code\_modify\_prepare+0x1c/0x20
ftrace\_run\_update\_code+0xe/0x30
ftrace\_startup\_enable+0x2e/0x50
ftrace\_startup+0xa7/0x100
register\_ftrace\_function+0x27/0x70
arm\_kprobe+0xb3/0x130
enable\_kprobe+0x83/0xa0
enable\_trace\_kprobe.part.0+0x2e/0x80
kprobe\_register+0x6f/0xc0
perf\_trace\_event\_init+0x16b/0x270
perf\_kprobe\_init+0xa7/0xe0
perf\_kprobe\_event\_init+0x3e/0x70
perf\_try\_init\_event+0x4a/0x140
perf\_event\_alloc+0x93a/0xde0
\_\_do\_sys\_perf\_event\_open+0x19f/0xf30
\_\_x64\_sys\_perf\_event\_open+0x20/0x30
do\_syscall\_64+0x65/0x1d0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
-> #0 (text\_mutex){+.+.}:
\_\_lock\_acquire+0xfcb/0x1b60
lock\_acquire+0xca/0x1d0
\_\_mutex\_lock+0xac/0x9f0
mutex\_lock\_nested+0x1b/0x20
kprobe\_optimizer+0x163/0x290
process\_one\_work+0x22b/0x560
worker\_thread+0x50/0x3c0
kthread+0x112/0x150
ret\_from\_fork+0x3a/0x50
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0 CPU1
---- ----
lock(module\_mutex);
lock(text\_mutex);
lock(module\_mutex);
lock(text\_mutex);
\*\*\* DEADLOCK \*\*\*
As a reproducer I've been using bcc's funccount.py
(https://github.com/iovisor/bcc/blob/master/tools/funccount.py),
for example:
# ./funccount.py '\*interrupt\*'
That immediately triggers the lockdep splat.
Fix by acquiring text\_mutex before module\_mutex in kprobe\_optimizer().
Signed-off-by: Andrea Righi
Acked-by: Masami Hiramatsu
Cc: Anil S Keshavamurthy
Cc: David S. Miller
Cc: Linus Torvalds
Cc: Naveen N. Rao
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Fixes: d5b844a2cf50 ("ftrace/x86: Remove possible deadlock between register\_kprobe() and ftrace\_run\_update\_code()")
Link: http://lkml.kernel.org/r/20190812184302.GA7010@xps-13
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit 9ad89d579c01cc6449d4fc503f00914caa4bcc7e
Author: Sebastian Andrzej Siewior
Date: Fri Aug 16 18:06:26 2019 +0200
sched/core: Schedule new worker even if PI-blocked
[ Upstream commit b0fdc01354f45d43f082025636ef808968a27b36 ]
If a task is PI-blocked (blocking on sleeping spinlock) then we don't want to
schedule a new kworker if we schedule out due to lock contention because !RT
does not do that as well. A spinning spinlock disables preemption and a worker
does not schedule out on lock contention (but spin).
On RT the RW-semaphore implementation uses an rtmutex so
tsk\_is\_pi\_blocked() will return true if a task blocks on it. In this case we
will now start a new worker which may deadlock if one worker is waiting on
progress from another worker. Since a RW-semaphore starts a new worker on !RT,
we should do the same on RT.
XFS is able to trigger this deadlock.
Allow to schedule new worker if the current worker is PI-blocked.
Signed-off-by: Sebastian Andrzej Siewior
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Link: http://lkml.kernel.org/r/20190816160626.12742-1-bigeasy@linutronix.de
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit 086ddc5e71721ce385382e926b8112148c2ad58a
Author: Tho Vu
Date: Fri Aug 16 17:17:02 2019 +0200
ravb: Fix use-after-free ravb\_tstamp\_skb
[ Upstream commit cfef46d692efd852a0da6803f920cc756eea2855 ]
When a Tx timestamp is requested, a pointer to the skb is stored in the
ravb\_tstamp\_skb struct. This was done without an skb\_get. There exists
the possibility that the skb could be freed by ravb\_tx\_free (when
ravb\_tx\_free is called from ravb\_start\_xmit) before the timestamp was
processed, leading to a use-after-free bug.
Use skb\_get when filling a ravb\_tstamp\_skb struct, and add appropriate
frees/consumes when a ravb\_tstamp\_skb struct is freed.
Fixes: c156633f1353 ("Renesas Ethernet AVB driver proper")
Signed-off-by: Tho Vu
Signed-off-by: Kazuya Mizuguchi
Signed-off-by: Simon Horman
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 37f12b89544605b6a4683b58b22bbc2e630735fa
Author: Wenwen Wang
Date: Thu Aug 15 15:29:51 2019 -0500
wimax/i2400m: fix a memory leak bug
[ Upstream commit 44ef3a03252844a8753479b0cea7f29e4a804bdc ]
In i2400m\_barker\_db\_init(), 'options\_orig' is allocated through kstrdup()
to hold the original command line options. Then, the options are parsed.
However, if an error occurs during the parsing process, 'options\_orig' is
not deallocated, leading to a memory leak bug. To fix this issue, free
'options\_orig' before returning the error.
Signed-off-by: Wenwen Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 461f5b613b4d3d890eb83f6773d93298220d3a43
Author: Stephen Hemminger
Date: Thu Aug 15 12:49:49 2019 -0700
net: cavium: fix driver name
[ Upstream commit 3434341004a380f4e47c3a03d4320d43982162a0 ]
The driver name gets exposed in sysfs under /sys/bus/pci/drivers
so it should look like other devices. Change it to be common
format (instead of "Cavium PTP").
This is a trivial fix that was observed by accident because
Debian kernels were building this driver into kernel (bug).
Signed-off-by: Stephen Hemminger
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 1915dd1826be7a7f538945b87b655629272fc9ef
Author: Thomas Falcon
Date: Wed Aug 14 14:57:05 2019 -0500
ibmvnic: Unmap DMA address of TX descriptor buffers after use
[ Upstream commit 80f0fe0934cd3daa13a5e4d48a103f469115b160 ]
There's no need to wait until a completion is received to unmap
TX descriptor buffers that have been passed to the hypervisor.
Instead unmap it when the hypervisor call has completed. This patch
avoids the possibility that a buffer will not be unmapped because
a TX completion is lost or mishandled.
Reported-by: Abdul Haleem
Tested-by: Devesh K. Singh
Signed-off-by: Thomas Falcon
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 895a07a5a03abb77a226cf6e311895ea22d9e62b
Author: Wenwen Wang
Date: Wed Aug 14 13:56:43 2019 -0500
net: kalmia: fix memory leaks
[ Upstream commit f1472cb09f11ddb41d4be84f0650835cb65a9073 ]
In kalmia\_init\_and\_get\_ethernet\_addr(), 'usb\_buf' is allocated through
kmalloc(). In the following execution, if the 'status' returned by
kalmia\_send\_init\_packet() is not 0, 'usb\_buf' is not deallocated, leading
to memory leaks. To fix this issue, add the 'out' label to free 'usb\_buf'.
Signed-off-by: Wenwen Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 241a735f5f68c9d909d72ac062a18c64945e3f40
Author: Wenwen Wang
Date: Wed Aug 14 13:03:38 2019 -0500
cx82310\_eth: fix a memory leak bug
[ Upstream commit 1eca92eef18719027d394bf1a2d276f43e7cf886 ]
In cx82310\_bind(), 'dev->partial\_data' is allocated through kmalloc().
Then, the execution waits for the firmware to become ready. If the firmware
is not ready in time, the execution is terminated. However, the allocated
'dev->partial\_data' is not deallocated on this path, leading to a memory
leak bug. To fix this issue, free 'dev->partial\_data' before returning the
error.
Signed-off-by: Wenwen Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit e8f8411a8deffc743abc7a322b4289acb78ac13d
Author: Darrick J. Wong
Date: Sun Aug 11 15:52:25 2019 -0700
vfs: fix page locking deadlocks when deduping files
[ Upstream commit edc58dd0123b552453a74369bd0c8d890b497b4b ]
When dedupe wants to use the page cache to compare parts of two files
for dedupe, we must be very careful to handle locking correctly. The
current code doesn't do this. It must lock and unlock the page only
once if the two pages are the same, since the overlapping range check
doesn't catch this when blocksize < pagesize. If the pages are distinct
but from the same file, we must observe page locking order and lock them
in order of increasing offset to avoid clashing with writeback locking.
Fixes: 876bec6f9bbfcb3 ("vfs: refactor clone/dedupe\_file\_range common functions")
Signed-off-by: Darrick J. Wong
Reviewed-by: Bill O'Donnell
Reviewed-by: Matthew Wilcox (Oracle)
Signed-off-by: Sasha Levin
commit a4234e27ed053eee92c83bd91cf10adb8bab2154
Author: Wenwen Wang
Date: Wed Aug 14 11:23:13 2019 -0500
lan78xx: Fix memory leaks
[ Upstream commit b9cbf8a64865b50fd0f4a3915fa00ac7365cdf8f ]
In lan78xx\_probe(), a new urb is allocated through usb\_alloc\_urb() and
saved to 'dev->urb\_intr'. However, in the following execution, if an error
occurs, 'dev->urb\_intr' is not deallocated, leading to memory leaks. To fix
this issue, invoke usb\_free\_urb() to free the allocated urb before
returning from the function.
Signed-off-by: Wenwen Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 96ece5798677ae26b3a1c9d315b6ccd9836e1287
Author: Martin Blumenstingl
Date: Fri Aug 16 00:31:55 2019 +0200
clk: Fix potential NULL dereference in clk\_fetch\_parent\_index()
[ Upstream commit 24876f09a7dfe36a82f53d304d8c1bceb3257a0f ]
Don't compare the parent clock name with a NULL name in the
clk\_parent\_map. This prevents a kernel crash when passing NULL
core->parents[i].name to strcmp().
An example which triggered this is a mux clock with four parents when
each of them is referenced in the clock driver using
clk\_parent\_data.fw\_name and then calling clk\_set\_parent(clk, 3rd\_parent)
on this mux.
In this case the first parent is also the HW default so
core->parents[i].hw is populated when the clock is registered. Calling
clk\_set\_parent(clk, 3rd\_parent) will then go through all parents and
skip the first parent because it's hw pointer doesn't match. For the
second parent no hw pointer is cached yet and clk\_core\_get(core, 1)
returns a non-matching pointer (which is correct because we are comparing
the second with the third parent). Comparing the result of
clk\_core\_get(core, 2) with the requested parent gives a match. However
we don't reach this point because right after the clk\_core\_get(core, 1)
mismatch the old code tried to !strcmp(parent->name, NULL) (where the
second argument is actually core->parents[i].name, but that was never
populated by the clock driver).
Signed-off-by: Martin Blumenstingl
Link: https://lkml.kernel.org/r/20190815223155.21384-1-martin.blumenstingl@googlemail.com
Fixes: fc0c209c147f ("clk: Allow parents to be specified without string names")
Signed-off-by: Stephen Boyd
Signed-off-by: Sasha Levin
commit a6cb8dd3664ee3fec0626e74fdf0291fce00f9c8
Author: Stephen Boyd
Date: Tue Aug 13 14:41:47 2019 -0700
clk: Fix falling back to legacy parent string matching
[ Upstream commit 4f8c6aba37da199155a121c6cdc38505a9eb0259 ]
Calls to clk\_core\_get() will return ERR\_PTR(-EINVAL) if we've started
migrating a clk driver to use the DT based style of specifying parents
but we haven't made any DT updates yet. This happens when we pass a
non-NULL value as the 'name' argument of of\_parse\_clkspec(). That
function returns -EINVAL in such a situation, instead of -ENOENT like we
expected. The return value comes back up to clk\_core\_fill\_parent\_index()
which proceeds to skip calling clk\_core\_lookup() because the error
pointer isn't equal to -ENOENT, it's -EINVAL.
Furthermore, we blindly overwrite the error pointer returned by
clk\_core\_get() with NULL when there isn't a legacy .name member
specified in the parent map. This isn't too bad right now because we
don't really care to differentiate NULL from an error, but in the future
we should only try to do a legacy lookup if we know we might find
something. This way DT lookups that fail don't try to lookup based on
strings when there isn't any string to match, hiding the error from DT
parsing.
Fix both these problems so that clk provider drivers can use the new
style of parent mapping without having to also update their DT at the
same time. This patch is based on an earlier patch from Taniya Das which
checked for -EINVAL in addition to -ENOENT return values from
clk\_core\_get().
Fixes: 601b6e93304a ("clk: Allow parents to be specified via clkspec index")
Cc: Taniya Das
Cc: Jerome Brunet
Cc: Chen-Yu Tsai
Reported-by: Taniya Das
Signed-off-by: Stephen Boyd
Link: https://lkml.kernel.org/r/20190813214147.34394-1-sboyd@kernel.org
Tested-by: Taniya Das
Signed-off-by: Sasha Levin
commit 7da16490e5a5dc596ae17062f93fe273c86e556d
Author: Wenwen Wang
Date: Wed Aug 14 01:38:39 2019 -0500
net: myri10ge: fix memory leaks
[ Upstream commit 20fb7c7a39b5c719e2e619673b5f5729ee7d2306 ]
In myri10ge\_probe(), myri10ge\_alloc\_slices() is invoked to allocate slices
related structures. Later on, myri10ge\_request\_irq() is used to get an irq.
However, if this process fails, the allocated slices related structures are
not deallocated, leading to memory leaks. To fix this issue, revise the
target label of the goto statement to 'abort\_with\_slices'.
Signed-off-by: Wenwen Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 0f1c537cf09c687b57c15ce5e9309b7103592a38
Author: Wenwen Wang
Date: Wed Aug 14 00:14:49 2019 -0500
liquidio: add cleanup in octeon\_setup\_iq()
[ Upstream commit 6f967f8b1be7001b31c46429f2ee7d275af2190f ]
If oct->fn\_list.enable\_io\_queues() fails, no cleanup is executed, leading
to memory/resource leaks. To fix this issue, invoke
octeon\_delete\_instr\_queue() before returning from the function.
Signed-off-by: Wenwen Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 101743ca02841cc0784006af32c2b3ee6bffffae
Author: Paolo Bonzini
Date: Wed Aug 14 12:07:34 2019 -0400
selftests: kvm: fix vmx\_set\_nested\_state\_test
[ Upstream commit c930e19790bbbff31c018009907c813fa0925f63 ]
vmx\_set\_nested\_state\_test is trying to use the KVM\_STATE\_NESTED\_EVMCS without
enabling enlightened VMCS first. Correct the outcome of the test, and actually
test that it succeeds after the capability is enabled.
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit 5aac82ac9c7c073b0f165d5cfabb85239add642f
Author: Paolo Bonzini
Date: Wed Aug 14 12:02:41 2019 -0400
selftests: kvm: provide common function to enable eVMCS
[ Upstream commit 65efa61dc0d536d5f0602c33ee805a57cc07e9dc ]
There are two tests already enabling eVMCS and a third is coming.
Add a function that enables the capability and tests the result.
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit 926a6e9efce95977f31699249ec1d89e0460c6ff
Author: Paolo Bonzini
Date: Wed Aug 14 18:18:55 2019 +0200
selftests: kvm: do not try running the VM in vmx\_set\_nested\_state\_test
[ Upstream commit 92cd0f0be3d7adb63611c28693ec0399beded837 ]
This test is only covering various edge cases of the
KVM\_SET\_NESTED\_STATE ioctl. Running the VM does not really
add anything.
Signed-off-by: Paolo Bonzini
Signed-off-by: Sasha Levin
commit bf31a46ead594390566032fae80fd1f66485bd68
Author: Wenwen Wang
Date: Tue Aug 13 04:18:52 2019 -0500
cxgb4: fix a memory leak bug
[ Upstream commit c554336efa9bbc28d6ec14efbee3c7d63c61a34f ]
In blocked\_fl\_write(), 't' is not deallocated if bitmap\_parse\_user() fails,
leading to a memory leak bug. To fix this issue, free t before returning
the error.
Signed-off-by: Wenwen Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 46bf670f44551801f36733d275a3c9bb5c9a03f5
Author: Dmitry Fomichev
Date: Sun Aug 11 11:25:10 2019 -0700
scsi: target: tcmu: avoid use-after-free after command timeout
[ Upstream commit a86a75865ff4d8c05f355d1750a5250aec89ab15 ]
In tcmu\_handle\_completion() function, the variable called read\_len is
always initialized with a value taken from se\_cmd structure. If this
function is called to complete an expired (timed out) out command, the
session command pointed by se\_cmd is likely to be already deallocated by
the target core at that moment. As the result, this access triggers a
use-after-free warning from KASAN.
This patch fixes the code not to touch se\_cmd when completing timed out
TCMU commands. It also resets the pointer to se\_cmd at the time when the
TCMU\_CMD\_BIT\_EXPIRED flag is set because it is going to become invalid
after calling target\_complete\_cmd() later in the same function,
tcmu\_check\_expired\_cmd().
Signed-off-by: Dmitry Fomichev
Acked-by: Mike Christie
Reviewed-by: Damien Le Moal
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit 8e639df33729149bbb50caf152ef55d2f25962c3
Author: Bill Kuzeja
Date: Wed Aug 14 10:24:41 2019 -0400
scsi: qla2xxx: Fix gnl.l memory leak on adapter init failure
[ Upstream commit 26fa656e9a0cbccddf7db132ea020d2169dbe46e ]
If HBA initialization fails unexpectedly (exiting via probe\_failed:), we
may fail to free vha->gnl.l. So that we don't attempt to double free, set
this pointer to NULL after a free and check for NULL at probe\_failed: so we
know whether or not to call dma\_free\_coherent.
Signed-off-by: Bill Kuzeja
Acked-by: Himanshu Madhani
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit 6fe444e60cdabe814876a4599e5bd8c2472c1108
Author: Alexandre Courbot
Date: Mon Jul 29 14:33:35 2019 +0900
drm/mediatek: set DMA max segment size
[ Upstream commit 070955558e820b9a89c570b91b1f21762f62b288 ]
This driver requires imported PRIME buffers to appear contiguously in
its IO address space. Make sure this is the case by setting the maximum
DMA segment size to a more suitable value than the default 64KB.
Signed-off-by: Alexandre Courbot
Reviewed-by: Tomasz Figa
Signed-off-by: CK Hu
Signed-off-by: Sasha Levin
commit 1e12afb4c60a4b99904326fceca47aef8dfdf8c0
Author: Alexandre Courbot
Date: Mon Jul 29 14:33:34 2019 +0900
drm/mediatek: use correct device to import PRIME buffers
[ Upstream commit 4c6f3196e6ea111c456c6086dc3f57d4706b0b2d ]
PRIME buffers should be imported using the DMA device. To this end, use
a custom import function that mimics drm\_gem\_prime\_import\_dev(), but
passes the correct device.
Fixes: 119f5173628aa ("drm/mediatek: Add DRM Driver for Mediatek SoC MT8173.")
Signed-off-by: Alexandre Courbot
Signed-off-by: CK Hu
Signed-off-by: Sasha Levin
commit 2b4a29f0453394ab1870674feca29559badeceed
Author: Pablo Neira Ayuso
Date: Tue Aug 13 17:41:13 2019 +0200
netfilter: nft\_flow\_offload: skip tcp rst and fin packets
[ Upstream commit dfe42be15fde16232340b8b2a57c359f51cc10d9 ]
TCP rst and fin packets do not qualify to place a flow into the
flowtable. Most likely there will be no more packets after connection
closure. Without this patch, this flow entry expires and connection
tracking picks up the entry in ESTABLISHED state using the fixup
timeout, which makes this look inconsistent to the user for a connection
that is actually already closed.
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 1dcb0d4eaf85e9c2173b21c3f23a2e9ef324ecd7
Author: YueHaibing
Date: Wed Jul 31 20:38:14 2019 +0800
gpio: Fix build error of function redefinition
[ Upstream commit 68e03b85474a51ec1921b4d13204782594ef7223 ]
when do randbuilding, I got this error:
In file included from drivers/hwmon/pmbus/ucd9000.c:19:0:
./include/linux/gpio/driver.h:576:1: error: redefinition of gpiochip\_add\_pin\_range
gpiochip\_add\_pin\_range(struct gpio\_chip \*chip, const char \*pinctl\_name,
^~~~~~~~~~~~~~~~~~~~~~
In file included from drivers/hwmon/pmbus/ucd9000.c:18:0:
./include/linux/gpio.h:245:1: note: previous definition of gpiochip\_add\_pin\_range was here
gpiochip\_add\_pin\_range(struct gpio\_chip \*chip, const char \*pinctl\_name,
^~~~~~~~~~~~~~~~~~~~~~
Reported-by: Hulk Robot
Fixes: 964cb341882f ("gpio: move pincontrol calls to ")
Signed-off-by: YueHaibing
Link: https://lore.kernel.org/r/20190731123814.46624-1-yuehaibing@huawei.com
Signed-off-by: Linus Walleij
Signed-off-by: Sasha Levin
commit f6bd80bc62231a281b757059f8a7b1d8663d586a
Author: Thomas Falcon
Date: Mon Aug 12 16:13:06 2019 -0500
ibmveth: Convert multicast list size for little-endian system
[ Upstream commit 66cf4710b23ab2adda11155684a2c8826f4fe732 ]
The ibm,mac-address-filters property defines the maximum number of
addresses the hypervisor's multicast filter list can support. It is
encoded as a big-endian integer in the OF device tree, but the virtual
ethernet driver does not convert it for use by little-endian systems.
As a result, the driver is not behaving as it should on affected systems
when a large number of multicast addresses are assigned to the device.
Reported-by: Hangbin Liu
Signed-off-by: Thomas Falcon
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit d45c33d890bc2fbe5485c2b0e964485e86dd4f66
Author: Julian Wiedmann
Date: Mon Aug 12 16:44:35 2019 +0200
s390/qeth: serialize cmd reply with concurrent timeout
[ Upstream commit 072f79400032f74917726cf76f4248367ea2b5b8 ]
Callbacks for a cmd reply run outside the protection of card->lock, to
allow for additional cmds to be issued & enqueued in parallel.
When qeth\_send\_control\_data() bails out for a cmd without having
received a reply (eg. due to timeout), its callback may concurrently be
processing a reply that just arrived. In this case, the callback
potentially accesses a stale reply->reply\_param area that eg. was
on-stack and has already been released.
To avoid this race, add some locking so that qeth\_send\_control\_data()
can (1) wait for a concurrently running callback, and (2) zap any
pending callback that still wants to run.
Signed-off-by: Julian Wiedmann
Signed-off-by: Jakub Kicinski
Signed-off-by: Sasha Levin
commit b12691c24ea93a10ee66c457b9ca786b193e1777
Author: Harish Bandi
Date: Fri Jul 12 10:39:40 2019 +0530
Bluetooth: hci\_qca: Send VS pre shutdown command.
[ Upstream commit a2780889e247561744dd8efbd3478a1999b72ae3 ]
WCN399x chips are coex chips, it needs a VS pre shutdown
command while turning off the BT. So that chip can inform
BT is OFF to other active clients.
Signed-off-by: Harish Bandi
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit 113d5ca748661634a7ce02773a1e5dc552d8c62f
Author: Matthias Kaehlcke
Date: Tue Jul 9 15:44:50 2019 -0700
Bluetooth: btqca: Add a short delay before downloading the NVM
[ Upstream commit 8059ba0bd0e4694e51c2ee6438a77b325f06c0d5 ]
On WCN3990 downloading the NVM sometimes fails with a "TLV response
size mismatch" error:
[ 174.949955] Bluetooth: btqca.c:qca\_download\_firmware() hci0: QCA Downloading qca/crnv21.bin
[ 174.958718] Bluetooth: btqca.c:qca\_tlv\_send\_segment() hci0: QCA TLV response size mismatch
It seems the controller needs a short time after downloading the
firmware before it is ready for the NVM. A delay as short as 1 ms
seems sufficient, make it 10 ms just in case. No event is received
during the delay, hence we don't just silently drop an extra event.
Signed-off-by: Matthias Kaehlcke
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
commit ab0f749707eadafe0b8ad9e3efb53f4aaf956599
Author: Nathan Chancellor
Date: Sun Aug 11 20:13:45 2019 -0700
net: tc35815: Explicitly check NET\_IP\_ALIGN is not zero in tc35815\_rx
[ Upstream commit 125b7e0949d4e72b15c2b1a1590f8cece985a918 ]
clang warns:
drivers/net/ethernet/toshiba/tc35815.c:1507:30: warning: use of logical
'&&' with constant operand [-Wconstant-logical-operand]
if (!HAVE\_DMA\_RXALIGN(lp) && NET\_IP\_ALIGN)
^ ~~~~~~~~~~~~
drivers/net/ethernet/toshiba/tc35815.c:1507:30: note: use '&' for a
bitwise operation
if (!HAVE\_DMA\_RXALIGN(lp) && NET\_IP\_ALIGN)
^~
&
drivers/net/ethernet/toshiba/tc35815.c:1507:30: note: remove constant to
silence this warning
if (!HAVE\_DMA\_RXALIGN(lp) && NET\_IP\_ALIGN)
~^~~~~~~~~~~~~~~
1 warning generated.
Explicitly check that NET\_IP\_ALIGN is not zero, which matches how this
is checked in other parts of the tree. Because NET\_IP\_ALIGN is a build
time constant, this check will be constant folded away during
optimization.
Fixes: 82a9928db560 ("tc35815: Enable StripCRC feature")
Link: https://github.com/ClangBuiltLinux/linux/issues/608
Signed-off-by: Nathan Chancellor
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 37a0be861375c41d31c2579e4a223738f8f26be7
Author: Dexuan Cui
Date: Fri Aug 9 01:58:08 2019 +0000
hv\_netvsc: Fix a warning of suspicious RCU usage
[ Upstream commit 6d0d779dca73cd5acb649c54f81401f93098b298 ]
This fixes a warning of "suspicious rcu\_dereference\_check() usage"
when nload runs.
Fixes: 776e726bfb34 ("netvsc: fix RCU warning in get\_stats")
Signed-off-by: Dexuan Cui
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 936315c0c94e2659ad48899e11da83c33f58bfe0
Author: Taehee Yoo
Date: Thu Aug 8 09:37:56 2019 -0700
ixgbe: fix possible deadlock in ixgbe\_service\_task()
[ Upstream commit 8b6381600d59871fbe44d36522272f961ab42410 ]
ixgbe\_service\_task() calls unregister\_netdev() under rtnl\_lock().
But unregister\_netdev() internally calls rtnl\_lock().
So deadlock would occur.
Fixes: 59dd45d550c5 ("ixgbe: firmware recovery mode")
Signed-off-by: Taehee Yoo
Tested-by: Andrew Bowers
Signed-off-by: Jeff Kirsher
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 1dc961de773378a22be8d36f24e777d371921d43
Author: Jakub Kicinski
Date: Tue Aug 6 17:19:22 2019 -0700
tools: bpftool: fix error message (prog -> object)
[ Upstream commit b3e78adcbf991a4e8b2ebb23c9889e968ec76c5f ]
Change an error message to work for any object being
pinned not just programs.
Fixes: 71bb428fe2c1 ("tools: bpf: add bpftool")
Signed-off-by: Jakub Kicinski
Reviewed-by: Quentin Monnet
Signed-off-by: Daniel Borkmann
Signed-off-by: Sasha Levin
commit ea3c243ce799eefc93a81f866f941e34a156d5c3
Author: Pablo Neira Ayuso
Date: Fri Aug 9 11:01:35 2019 +0200
netfilter: nf\_flow\_table: teardown flow timeout race
[ Upstream commit 1e5b2471bcc4838df298080ae1ec042c2cbc9ce9 ]
Flows that are in teardown state (due to RST / FIN TCP packet) still
have their offload flag set on. Hence, the conntrack garbage collector
may race to undo the timeout adjustment that the fixup routine performs,
leaving the conntrack entry in place with the internal offload timeout
(one day).
Update teardown flow state to ESTABLISHED and set tracking to liberal,
then once the offload bit is cleared, adjust timeout if it is more than
the default fixup timeout (conntrack might already have set a lower
timeout from the packet path).
Fixes: da5984e51063 ("netfilter: nf\_flow\_table: add support for sending flows back to the slow path")
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 96a517d0ba5f6251e0602047348f1a073f2044c1
Author: Pablo Neira Ayuso
Date: Fri Aug 9 11:01:33 2019 +0200
netfilter: nf\_flow\_table: conntrack picks up expired flows
[ Upstream commit 3e68db2f6422d711550a32cbc87abd97bb6efab3 ]
Update conntrack entry to pick up expired flows, otherwise the conntrack
entry gets stuck with the internal offload timeout (one day). The TCP
state also needs to be adjusted to ESTABLISHED state and tracking is set
to liberal mode in order to give conntrack a chance to pick up the
expired flow.
Fixes: ac2a66665e23 ("netfilter: add generic flow table infrastructure")
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 586f00143091aeaea0905bb02dd37da22b801f22
Author: Pablo Neira Ayuso
Date: Fri Aug 9 11:01:27 2019 +0200
netfilter: nf\_tables: use-after-free in failing rule with bound set
[ Upstream commit 6a0a8d10a3661a036b55af695542a714c429ab7c ]
If a rule that has already a bound anonymous set fails to be added, the
preparation phase releases the rule and the bound set. However, the
transaction object from the abort path still has a reference to the set
object that is stale, leading to a use-after-free when checking for the
set->bound field. Add a new field to the transaction that specifies if
the set is bound, so the abort path can skip releasing it since the rule
command owns it and it takes care of releasing it. After this update,
the set->bound field is removed.
[ 24.649883] Unable to handle kernel paging request at virtual address 0000000000040434
[ 24.657858] Mem abort info:
[ 24.660686] ESR = 0x96000004
[ 24.663769] Exception class = DABT (current EL), IL = 32 bits
[ 24.669725] SET = 0, FnV = 0
[ 24.672804] EA = 0, S1PTW = 0
[ 24.675975] Data abort info:
[ 24.678880] ISV = 0, ISS = 0x00000004
[ 24.682743] CM = 0, WnR = 0
[ 24.685723] user pgtable: 4k pages, 48-bit VAs, pgdp=0000000428952000
[ 24.692207] [0000000000040434] pgd=0000000000000000
[ 24.697119] Internal error: Oops: 96000004 [#1] SMP
[...]
[ 24.889414] Call trace:
[ 24.891870] \_\_nf\_tables\_abort+0x3f0/0x7a0
[ 24.895984] nf\_tables\_abort+0x20/0x40
[ 24.899750] nfnetlink\_rcv\_batch+0x17c/0x588
[ 24.904037] nfnetlink\_rcv+0x13c/0x190
[ 24.907803] netlink\_unicast+0x18c/0x208
[ 24.911742] netlink\_sendmsg+0x1b0/0x350
[ 24.915682] sock\_sendmsg+0x4c/0x68
[ 24.919185] \_\_\_sys\_sendmsg+0x288/0x2c8
[ 24.923037] \_\_sys\_sendmsg+0x7c/0xd0
[ 24.926628] \_\_arm64\_sys\_sendmsg+0x2c/0x38
[ 24.930744] el0\_svc\_common.constprop.0+0x94/0x158
[ 24.935556] el0\_svc\_handler+0x34/0x90
[ 24.939322] el0\_svc+0x8/0xc
[ 24.942216] Code: 37280300 f9404023 91014262 aa1703e0 (f9401863)
[ 24.948336] ---[ end trace cebbb9dcbed3b56f ]---
Fixes: f6ac85858976 ("netfilter: nf\_tables: unbind set in rule from commit path")
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 830b5c3760ff05a78c60202a7cff1d067cb25577
Author: Fuqian Huang
Date: Fri Aug 9 13:35:39 2019 +0800
net: tundra: tsi108: use spin\_lock\_irqsave instead of spin\_lock\_irq in IRQ context
[ Upstream commit 8c25d0887a8bd0e1ca2074ac0c6dff173787a83b ]
As spin\_unlock\_irq will enable interrupts.
Function tsi108\_stat\_carry is called from interrupt handler tsi108\_irq.
Interrupts are enabled in interrupt handler.
Use spin\_lock\_irqsave/spin\_unlock\_irqrestore instead of spin\_(un)lock\_irq
in IRQ context to avoid this.
Signed-off-by: Fuqian Huang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 60a4f2b2b6b85b4638766a87a3822f3216005048
Author: Marek Szyprowski
Date: Thu Aug 8 14:18:39 2019 +0200
clk: samsung: exynos542x: Move MSCL subsystem clocks to its sub-CMU
[ Upstream commit baf7b79e1ad79a41fafd8ab8597b9a96962d822d ]
M2M scaler clocks require special handling of their parent bus clock during
power domain on/off sequences. MSCL clocks were not initially added to the
sub-CMU handler, because that time there was no driver for the M2M scaler
device and it was not possible to test it.
This patch fixes this issue. Parent clock for M2M scaler devices is now
properly preserved during MSC power domain on/off sequence. This gives M2M
scaler devices proper performance: fullHD XRGB32 image 1000 rotations test
takes 3.17s instead of 45.08s.
Fixes: b06a532bf1fa ("clk: samsung: Add Exynos5 sub-CMU clock driver")
Signed-off-by: Marek Szyprowski
Link: https://lkml.kernel.org/r/20190808121839.23892-1-m.szyprowski@samsung.com
Acked-by: Sylwester Nawrocki
Signed-off-by: Stephen Boyd
Signed-off-by: Sasha Levin
commit c65a2b20a934fcdc95b875077062d5da4261796f
Author: Sylwester Nawrocki
Date: Thu Aug 8 16:49:29 2019 +0200
clk: samsung: exynos5800: Move MAU subsystem clocks to MAU sub-CMU
[ Upstream commit b6adeb6bc61c2567b9efd815d61a61b34a2e51a6 ]
This patch fixes broken sound on Exynos5422/5800 platforms after
system/suspend resume cycle in cases where the audio root clock
is derived from MAU\_EPLL\_CLK.
In order to preserve state of the USER\_MUX\_MAU\_EPLL\_CLK clock mux
during system suspend/resume cycle for Exynos5800 we group the MAU
block input clocks in "MAU" sub-CMU and add the clock mux control
bit to .suspend\_regs. This ensures that user configuration of the mux
is not lost after the PMU block changes the mux setting to OSC\_DIV
when switching off the MAU power domain.
Adding the SRC\_TOP9 register to exynos5800\_clk\_regs[] array is not
sufficient as at the time of the syscore\_ops suspend call MAU power
domain is already turned off and we already save and subsequently
restore an incorrect register's value.
Fixes: b06a532bf1fa ("clk: samsung: Add Exynos5 sub-CMU clock driver")
Reported-by: Jaafar Ali
Suggested-by: Marek Szyprowski
Tested-by: Jaafar Ali
Signed-off-by: Sylwester Nawrocki
Link: https://lkml.kernel.org/r/20190808144929.18685-2-s.nawrocki@samsung.com
Signed-off-by: Stephen Boyd
Signed-off-by: Sasha Levin
commit f7bd5e9fe13f5504d5ddcfc771a16bccefd19ee1
Author: Sylwester Nawrocki
Date: Thu Aug 8 16:49:28 2019 +0200
clk: samsung: Change signature of exynos5\_subcmus\_init() function
[ Upstream commit bf32e7dbfce87d518c0ca77af890eae9ab8d6ab9 ]
In order to make it easier in subsequent patch to create different subcmu
lists for exynos5420 and exynos5800 SoCs the code is rewritten so we pass
an array of pointers to the subcmus initialization function.
Fixes: b06a532bf1fa ("clk: samsung: Add Exynos5 sub-CMU clock driver")
Tested-by: Jaafar Ali
Signed-off-by: Sylwester Nawrocki
Link: https://lkml.kernel.org/r/20190808144929.18685-1-s.nawrocki@samsung.com
Reviewed-by: Marek Szyprowski
Signed-off-by: Stephen Boyd
Signed-off-by: Sasha Levin
commit 8f37477964e920c90392965a90f3a9ddebe0b7e0
Author: Aya Levin
Date: Tue Aug 6 15:19:19 2019 +0300
net/mlx5e: Fix error flow of CQE recovery on tx reporter
[ Upstream commit 276d197e70bcc47153592f4384675b51c7d83aba ]
CQE recovery function begins with test and set of recovery bit. Add an
error flow which ensures clearing of this bit when leaving the recovery
function, to allow further recoveries to take place. This allows removal
of clearing recovery bit on sq activate.
Fixes: de8650a82071 ("net/mlx5e: Add tx reporter support")
Signed-off-by: Aya Levin
Reviewed-by: Tariq Toukan
Signed-off-by: Saeed Mahameed
Signed-off-by: Sasha Levin
commit 701b89908ba1cf65929dee667a982b325fc2d372
Author: Florian Westphal
Date: Tue Jul 30 14:57:19 2019 +0200
netfilter: nf\_flow\_table: fix offload for flows that are subject to xfrm
[ Upstream commit 589b474a4b7ce409d6821ef17234a995841bd131 ]
This makes the previously added 'encap test' pass.
Because its possible that the xfrm dst entry becomes stale while such
a flow is offloaded, we need to call dst\_check() -- the notifier that
handles this for non-tunneled traffic isn't sufficient, because SA or
or policies might have changed.
If dst becomes stale the flow offload entry will be tagged for teardown
and packets will be passed to 'classic' forwarding path.
Removing the entry right away is problematic, as this would
introduce a race condition with the gc worker.
In case flow is long-lived, it could eventually be offloaded again
once the gc worker removes the entry from the flow table.
Signed-off-by: Florian Westphal
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit b8a132a4c4b6e97c8f157623167c8d5a5b75c1ab
Author: Andrii Nakryiko
Date: Thu Aug 1 00:24:05 2019 -0700
libbpf: set BTF FD for prog only when there is supported .BTF.ext data
[ Upstream commit 3415ec643e7bd644b03026efbe2f2b36cbe9b34b ]
5d01ab7bac46 ("libbpf: fix erroneous multi-closing of BTF FD")
introduced backwards-compatibility issue, manifesting itself as -E2BIG
error returned on program load due to unknown non-zero btf\_fd attribute
value for BPF\_PROG\_LOAD sys\_bpf() sub-command.
This patch fixes bug by ensuring that we only ever associate BTF FD with
program if there is a BTF.ext data that was successfully loaded into
kernel, which automatically means kernel supports func\_info/line\_info
and associated BTF FD for progs (checked and ensured also by BTF
sanitization code).
Fixes: 5d01ab7bac46 ("libbpf: fix erroneous multi-closing of BTF FD")
Reported-by: Andrey Ignatov
Signed-off-by: Andrii Nakryiko
Signed-off-by: Alexei Starovoitov
Signed-off-by: Sasha Levin
commit a65fb2895af4a11b2ca0457926ae24c5feeaab6b
Author: Andrii Nakryiko
Date: Fri Jul 26 14:24:38 2019 -0700
libbpf: fix erroneous multi-closing of BTF FD
[ Upstream commit 5d01ab7bac467edfc530e6ccf953921def935c62 ]
Libbpf stores associated BTF FD per each instance of bpf\_program. When
program is unloaded, that FD is closed. This is wrong, because leads to
a race and possibly closing of unrelated files, if application
simultaneously opens new files while bpf\_programs are unloaded.
It's also unnecessary, because struct btf "owns" that FD, and
btf\_\_free(), called from bpf\_object\_\_close() will close it. Thus the fix
is to never have per-program BTF FD and fetch it from obj->btf, when
necessary.
Fixes: 2993e0515bb4 ("tools/bpf: add support to read .BTF.ext sections")
Reported-by: Andrey Ignatov
Signed-off-by: Andrii Nakryiko
Signed-off-by: Alexei Starovoitov
Signed-off-by: Sasha Levin
commit fa689968da499a6094228d9409e1cf100290de8a
Author: Sven Eckelmann
Date: Sun Jul 7 22:15:13 2019 +0200
batman-adv: Fix netlink dumping of all mcast\_flags buckets
[ Upstream commit fa3a03da549a889fc9dbc0d3c5908eb7882cac8f ]
The bucket variable is only updated outside the loop over the mcast\_flags
buckets. It will only be updated during a dumping run when the dumping has
to be interrupted and a new message has to be started.
This could result in repeated or missing entries when the multicast flags
are dumped to userspace.
Fixes: d2d489b7d851 ("batman-adv: Add inconsistent multicast netlink dump detection")
Signed-off-by: Sven Eckelmann
Signed-off-by: Simon Wunderlich
Signed-off-by: Sasha Levin
commit a4c88340b3ea8caefa1b5d3422bd9925c74b566e
Author: Ka-Cheong Poon
Date: Mon Aug 26 02:39:12 2019 -0700
net/rds: Fix info leak in rds6\_inc\_info\_copy()
[ Upstream commit 7d0a06586b2686ba80c4a2da5f91cb10ffbea736 ]
The rds6\_inc\_info\_copy() function has a couple struct members which
are leaking stack information. The ->tos field should hold actual
information and the ->flags field needs to be zeroed out.
Fixes: 3eb450367d08 ("rds: add type of service(tos) infrastructure")
Fixes: b7ff8b1036f0 ("rds: Extend RDS API for IPv6 support")
Reported-by: 黄ID蝴蝶
Signed-off-by: Dan Carpenter
Signed-off-by: Ka-Cheong Poon
Acked-by: Santosh Shilimkar
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit fdd2bc365fc6ea577db40f7f6566e6f3cdea0181
Author: Davide Caratti
Date: Tue Aug 27 12:29:09 2019 +0200
net/sched: pfifo\_fast: fix wrong dereference when qdisc is reset
[ Upstream commit 04d37cf46a773910f75fefaa9f9488f42bfe1fe2 ]
Now that 'TCQ\_F\_CPUSTATS' bit can be cleared, depending on the value of
'TCQ\_F\_NOLOCK' bit in the parent qdisc, we need to be sure that per-cpu
counters are present when 'reset()' is called for pfifo\_fast qdiscs.
Otherwise, the following script:
# tc q a dev lo handle 1: root htb default 100
# tc c a dev lo parent 1: classid 1:100 htb \
> rate 95Mbit ceil 100Mbit burst 64k
[...]
# tc f a dev lo parent 1: protocol arp basic classid 1:100
[...]
# tc q a dev lo parent 1:100 handle 100: pfifo\_fast
[...]
# tc q d dev lo root
can generate the following splat:
Unable to handle kernel paging request at virtual address dfff2c01bd148000
Mem abort info:
ESR = 0x96000004
Exception class = DABT (current EL), IL = 32 bits
SET = 0, FnV = 0
EA = 0, S1PTW = 0
Data abort info:
ISV = 0, ISS = 0x00000004
CM = 0, WnR = 0
[dfff2c01bd148000] address between user and kernel address ranges
Internal error: Oops: 96000004 [#1] SMP
[...]
pstate: 80000005 (Nzcv daif -PAN -UAO)
pc : pfifo\_fast\_reset+0x280/0x4d8
lr : pfifo\_fast\_reset+0x21c/0x4d8
sp : ffff800d09676fa0
x29: ffff800d09676fa0 x28: ffff200012ee22e4
x27: dfff200000000000 x26: 0000000000000000
x25: ffff800ca0799958 x24: ffff1001940f332b
x23: 0000000000000007 x22: ffff200012ee1ab8
x21: 0000600de8a40000 x20: 0000000000000000
x19: ffff800ca0799900 x18: 0000000000000000
x17: 0000000000000002 x16: 0000000000000000
x15: 0000000000000000 x14: 0000000000000000
x13: 0000000000000000 x12: ffff1001b922e6e2
x11: 1ffff001b922e6e1 x10: 0000000000000000
x9 : 1ffff001b922e6e1 x8 : dfff200000000000
x7 : 0000000000000000 x6 : 0000000000000000
x5 : 1fffe400025dc45c x4 : 1fffe400025dc357
x3 : 00000c01bd148000 x2 : 0000600de8a40000
x1 : 0000000000000007 x0 : 0000600de8a40004
Call trace:
pfifo\_fast\_reset+0x280/0x4d8
qdisc\_reset+0x6c/0x370
htb\_reset+0x150/0x3b8 [sch\_htb]
qdisc\_reset+0x6c/0x370
dev\_deactivate\_queue.constprop.5+0xe0/0x1a8
dev\_deactivate\_many+0xd8/0x908
dev\_deactivate+0xe4/0x190
qdisc\_graft+0x88c/0xbd0
tc\_get\_qdisc+0x418/0x8a8
rtnetlink\_rcv\_msg+0x3a8/0xa78
netlink\_rcv\_skb+0x18c/0x328
rtnetlink\_rcv+0x28/0x38
netlink\_unicast+0x3c4/0x538
netlink\_sendmsg+0x538/0x9a0
sock\_sendmsg+0xac/0xf8
\_\_\_sys\_sendmsg+0x53c/0x658
\_\_sys\_sendmsg+0xc8/0x140
\_\_arm64\_sys\_sendmsg+0x74/0xa8
el0\_svc\_handler+0x164/0x468
el0\_svc+0x10/0x14
Code: 910012a0 92400801 d343fc03 11000c21 (38fb6863)
Fix this by testing the value of 'TCQ\_F\_CPUSTATS' bit in 'qdisc->flags',
before dereferencing 'qdisc->cpu\_qstats'.
Changes since v1:
- coding style improvements, thanks to Stefano Brivio
Fixes: 8a53e616de29 ("net: sched: when clearing NOLOCK, clear TCQ\_F\_CPUSTATS, too")
CC: Paolo Abeni
Reported-by: Li Shuang
Signed-off-by: Davide Caratti
Acked-by: Paolo Abeni
Reviewed-by: Stefano Brivio
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit e9cc0513248f7ab4e4ab099fbde3bd9e5d262fa2
Author: Davide Caratti
Date: Tue Aug 27 23:18:53 2019 +0200
net/sched: pfifo\_fast: fix wrong dereference in pfifo\_fast\_enqueue
[ Upstream commit 092e22e586236bba106a82113826a68080a03506 ]
Now that 'TCQ\_F\_CPUSTATS' bit can be cleared, depending on the value of
'TCQ\_F\_NOLOCK' bit in the parent qdisc, we can't assume anymore that
per-cpu counters are there in the error path of skb\_array\_produce().
Otherwise, the following splat can be seen:
Unable to handle kernel paging request at virtual address 0000600dea430008
Mem abort info:
ESR = 0x96000005
Exception class = DABT (current EL), IL = 32 bits
SET = 0, FnV = 0
EA = 0, S1PTW = 0
Data abort info:
ISV = 0, ISS = 0x00000005
CM = 0, WnR = 0
user pgtable: 64k pages, 48-bit VAs, pgdp = 000000007b97530e
[0000600dea430008] pgd=0000000000000000, pud=0000000000000000
Internal error: Oops: 96000005 [#1] SMP
[...]
pstate: 10000005 (nzcV daif -PAN -UAO)
pc : pfifo\_fast\_enqueue+0x524/0x6e8
lr : pfifo\_fast\_enqueue+0x46c/0x6e8
sp : ffff800d39376fe0
x29: ffff800d39376fe0 x28: 1ffff001a07d1e40
x27: ffff800d03e8f188 x26: ffff800d03e8f200
x25: 0000000000000062 x24: ffff800d393772f0
x23: 0000000000000000 x22: 0000000000000403
x21: ffff800cca569a00 x20: ffff800d03e8ee00
x19: ffff800cca569a10 x18: 00000000000000bf
x17: 0000000000000000 x16: 0000000000000000
x15: 0000000000000000 x14: ffff1001a726edd0
x13: 1fffe4000276a9a4 x12: 0000000000000000
x11: dfff200000000000 x10: ffff800d03e8f1a0
x9 : 0000000000000003 x8 : 0000000000000000
x7 : 00000000f1f1f1f1 x6 : ffff1001a726edea
x5 : ffff800cca56a53c x4 : 1ffff001bf9a8003
x3 : 1ffff001bf9a8003 x2 : 1ffff001a07d1dcb
x1 : 0000600dea430000 x0 : 0000600dea430008
Process ping (pid: 6067, stack limit = 0x00000000dc0aa557)
Call trace:
pfifo\_fast\_enqueue+0x524/0x6e8
htb\_enqueue+0x660/0x10e0 [sch\_htb]
\_\_dev\_queue\_xmit+0x123c/0x2de0
dev\_queue\_xmit+0x24/0x30
ip\_finish\_output2+0xc48/0x1720
ip\_finish\_output+0x548/0x9d8
ip\_output+0x334/0x788
ip\_local\_out+0x90/0x138
ip\_send\_skb+0x44/0x1d0
ip\_push\_pending\_frames+0x5c/0x78
raw\_sendmsg+0xed8/0x28d0
inet\_sendmsg+0xc4/0x5c0
sock\_sendmsg+0xac/0x108
\_\_sys\_sendto+0x1ac/0x2a0
\_\_arm64\_sys\_sendto+0xc4/0x138
el0\_svc\_handler+0x13c/0x298
el0\_svc+0x8/0xc
Code: f9402e80 d538d081 91002000 8b010000 (885f7c03)
Fix this by testing the value of 'TCQ\_F\_CPUSTATS' bit in 'qdisc->flags',
before dereferencing 'qdisc->cpu\_qstats'.
Fixes: 8a53e616de29 ("net: sched: when clearing NOLOCK, clear TCQ\_F\_CPUSTATS, too")
CC: Paolo Abeni
CC: Stefano Brivio
Reported-by: Li Shuang
Signed-off-by: Davide Caratti
Acked-by: Paolo Abeni
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0b003edac850ee96653f2005b8ae27fd92ba32d2
Author: Vladimir Oltean
Date: Sun Aug 25 21:32:12 2019 +0300
net: dsa: tag\_8021q: Future-proof the reserved fields in the custom VID
[ Upstream commit bcccb0a535bb99616e4b992568371efab1ab14e8 ]
After witnessing the discussion in https://lkml.org/lkml/2019/8/14/151
w.r.t. ioctl extensibility, it became clear that such an issue might
prevent that the 3 RSV bits inside the DSA 802.1Q tag might also suffer
the same fate and be useless for further extension.
So clearly specify that the reserved bits should currently be
transmitted as zero and ignored on receive. The DSA tagger already does
this (and has always did), and is the only known user so far (no
Wireshark dissection plugin, etc). So there should be no incompatibility
to speak of.
Fixes: 0471dd429cea ("net: dsa: tag\_8021q: Create a stable binary format")
Signed-off-by: Vladimir Oltean
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c7f05c1d9bf477d6f3a3067ec74505f88dfda2f3
Author: Marco Hartmann
Date: Wed Aug 21 11:00:46 2019 +0000
Add genphy\_c45\_config\_aneg() function to phy-c45.c
[ Upstream commit 2ebb991641d3f64b70fec0156e2b6933810177e9 ]
Commit 34786005eca3 ("net: phy: prevent PHYs w/o Clause 22 regs from calling
genphy\_config\_aneg") introduced a check that aborts phy\_config\_aneg()
if the phy is a C45 phy.
This causes phy\_state\_machine() to call phy\_error() so that the phy
ends up in PHY\_HALTED state.
Instead of returning -EOPNOTSUPP, call genphy\_c45\_config\_aneg()
(analogous to the C22 case) so that the state machine can run
correctly.
genphy\_c45\_config\_aneg() closely resembles mv3310\_config\_aneg()
in drivers/net/phy/marvell10g.c, excluding vendor specific
configurations for 1000BaseT.
Fixes: 22b56e827093 ("net: phy: replace genphy\_10g\_driver with genphy\_c45\_driver")
Signed-off-by: Marco Hartmann
Reviewed-by: Andrew Lunn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 98ded313ffda65bcd47556270143eaaea9e27e0f
Author: Vladimir Oltean
Date: Fri Aug 30 04:07:23 2019 +0300
net/sched: cbs: Set default link speed to 10 Mbps in cbs\_set\_port\_rate
The discussion to be made is absolutely the same as in the case of
previous patch ("taprio: Set default link speed to 10 Mbps in
taprio\_set\_picos\_per\_byte"). Nothing is lost when setting a default.
Cc: Leandro Dorileo
Fixes: e0a7683d30e9 ("net/sched: cbs: fix port\_rate miscalculation")
Acked-by: Vinicius Costa Gomes
Signed-off-by: Vladimir Oltean
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 622f16b3051986775591fcc8c99b19a118205045
Author: Vladimir Oltean
Date: Fri Aug 30 04:07:22 2019 +0300
taprio: Set default link speed to 10 Mbps in taprio\_set\_picos\_per\_byte
The taprio budget needs to be adapted at runtime according to interface
link speed. But that handling is problematic.
For one thing, installing a qdisc on an interface that doesn't have
carrier is not illegal. But taprio prints the following stack trace:
[ 31.851373] ------------[ cut here ]------------
[ 31.856024] WARNING: CPU: 1 PID: 207 at net/sched/sch\_taprio.c:481 taprio\_dequeue+0x1a8/0x2d4
[ 31.864566] taprio: dequeue() called with unknown picos per byte.
[ 31.864570] Modules linked in:
[ 31.873701] CPU: 1 PID: 207 Comm: tc Not tainted 5.3.0-rc5-01199-g8838fe023cd6 #1689
[ 31.881398] Hardware name: Freescale LS1021A
[ 31.885661] [] (unwind\_backtrace) from [] (show\_stack+0x10/0x14)
[ 31.893368] [] (show\_stack) from [] (dump\_stack+0xb4/0xc8)
[ 31.900555] [] (dump\_stack) from [] (\_\_warn+0xe0/0xf8)
[ 31.907395] [] (\_\_warn) from [] (warn\_slowpath\_fmt+0x48/0x6c)
[ 31.914841] [] (warn\_slowpath\_fmt) from [] (taprio\_dequeue+0x1a8/0x2d4)
[ 31.923150] [] (taprio\_dequeue) from [] (\_\_qdisc\_run+0x90/0x61c)
[ 31.930856] [] (\_\_qdisc\_run) from [] (net\_tx\_action+0x12c/0x2bc)
[ 31.938560] [] (net\_tx\_action) from [] (\_\_do\_softirq+0x130/0x3c8)
[ 31.946350] [] (\_\_do\_softirq) from [] (irq\_exit+0xbc/0xd8)
[ 31.953536] [] (irq\_exit) from [] (\_\_handle\_domain\_irq+0x60/0xb4)
[ 31.961328] [] (\_\_handle\_domain\_irq) from [] (gic\_handle\_irq+0x58/0x9c)
[ 31.969638] [] (gic\_handle\_irq) from [] (\_\_irq\_svc+0x6c/0x90)
[ 31.977076] Exception stack(0xe8167b20 to 0xe8167b68)
[ 31.982100] 7b20: e9d4bd80 00000cc0 000000cf 00000000 e9d4bd80 c1f38958 00000cc0 c1f38960
[ 31.990234] 7b40: 00000001 000000cf 00000004 e9dc0800 00000000 e8167b70 c0f478ec c0f46d94
[ 31.998363] 7b60: 60070013 ffffffff
[ 32.001833] [] (\_\_irq\_svc) from [] (netlink\_trim+0x18/0xd8)
[ 32.009104] [] (netlink\_trim) from [] (netlink\_broadcast\_filtered+0x34/0x414)
[ 32.017930] [] (netlink\_broadcast\_filtered) from [] (netlink\_broadcast+0x20/0x28)
[ 32.027102] [] (netlink\_broadcast) from [] (rtnetlink\_send+0x34/0x88)
[ 32.035238] [] (rtnetlink\_send) from [] (notify\_and\_destroy+0x2c/0x44)
[ 32.043461] [] (notify\_and\_destroy) from [] (qdisc\_graft+0x398/0x470)
[ 32.051595] [] (qdisc\_graft) from [] (tc\_modify\_qdisc+0x3a4/0x724)
[ 32.059470] [] (tc\_modify\_qdisc) from [] (rtnetlink\_rcv\_msg+0x260/0x2ec)
[ 32.067864] [] (rtnetlink\_rcv\_msg) from [] (netlink\_rcv\_skb+0xb8/0x110)
[ 32.076172] [] (netlink\_rcv\_skb) from [] (netlink\_unicast+0x1b4/0x22c)
[ 32.084392] [] (netlink\_unicast) from [] (netlink\_sendmsg+0x33c/0x380)
[ 32.092614] [] (netlink\_sendmsg) from [] (sock\_sendmsg+0x14/0x24)
[ 32.100403] [] (sock\_sendmsg) from [] (\_\_\_sys\_sendmsg+0x214/0x228)
[ 32.108279] [] (\_\_\_sys\_sendmsg) from [] (\_\_sys\_sendmsg+0x50/0x8c)
[ 32.116068] [] (\_\_sys\_sendmsg) from [] (ret\_fast\_syscall+0x0/0x54)
[ 32.123938] Exception stack(0xe8167fa8 to 0xe8167ff0)
[ 32.128960] 7fa0: b6fa68c8 000000f8 00000003 bea142d0 00000000 00000000
[ 32.137093] 7fc0: b6fa68c8 000000f8 0052154c 00000128 5d6468a2 00000000 00000028 00558c9c
[ 32.145224] 7fe0: 00000070 bea14278 00530d64 b6e17e64
[ 32.150659] ---[ end trace 2139c9827c3e5177 ]---
This happens because the qdisc ->dequeue callback gets called. Which
again is not illegal, the qdisc will dequeue even when the interface is
up but doesn't have carrier (and hence SPEED\_UNKNOWN), and the frames
will be dropped further down the stack in dev\_direct\_xmit().
And, at the end of the day, for what? For calculating the initial budget
of an interface which is non-operational at the moment and where frames
will get dropped anyway.
So if we can't figure out the link speed, default to SPEED\_10 and move
along. We can also remove the runtime check now.
Cc: Leandro Dorileo
Fixes: 7b9eba7ba0c1 ("net/sched: taprio: fix picos\_per\_byte miscalculation")
Acked-by: Vinicius Costa Gomes
Signed-off-by: Vladimir Oltean
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4f15d0e51268376155951c11d58190e4026d062d
Author: Vladimir Oltean
Date: Fri Aug 30 04:07:21 2019 +0300
taprio: Fix kernel panic in taprio\_destroy
taprio\_init may fail earlier than this line:
list\_add(&q->taprio\_list, &taprio\_list);
i.e. due to the net device not being multi queue.
Attempting to remove q from the global taprio\_list when it is not part
of it will result in a kernel panic.
Fix it by matching list\_add and list\_del better to one another in the
order of operations. This way we can keep the deletion unconditional
and with lower complexity - O(1).
Cc: Leandro Dorileo
Fixes: 7b9eba7ba0c1 ("net/sched: taprio: fix picos\_per\_byte miscalculation")
Signed-off-by: Vladimir Oltean
Acked-by: Vinicius Costa Gomes
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 61f10b1bb84d7c21e64cf4d6ebf274a829fc850d
Author: Hayes Wang
Date: Wed Aug 28 09:51:42 2019 +0800
r8152: remove calling netif\_napi\_del
[ Upstream commit 973dc6cfc0e2c43ff29ca5645ceaf1ae694ea110 ]
Remove unnecessary use of netif\_napi\_del. This also avoids to call
napi\_disable() after netif\_napi\_del().
Signed-off-by: Hayes Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5a9ceccb638580c5d720dff0902d4c0c33d39a89
Author: Hayes Wang
Date: Wed Aug 28 09:51:41 2019 +0800
Revert "r8152: napi hangup fix after disconnect"
[ Upstream commit 49d4b14113cae1410eb4654ada5b9583bad971c4 ]
This reverts commit 0ee1f4734967af8321ecebaf9c74221ace34f2d5.
The commit 0ee1f4734967 ("r8152: napi hangup fix after
disconnect") adds a check about RTL8152\_UNPLUG to determine
if calling napi\_disable() is invalid in rtl8152\_close(),
when rtl8152\_disconnect() is called. This avoids to use
napi\_disable() after calling netif\_napi\_del().
Howver, commit ffa9fec30ca0 ("r8152: set RTL8152\_UNPLUG
only for real disconnection") causes that RTL8152\_UNPLUG
is not always set when calling rtl8152\_disconnect().
Therefore, I have to revert commit 0ee1f4734967 ("r8152:
napi hangup fix after disconnect"), first. And submit
another patch to fix it.
Signed-off-by: Hayes Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7e21536433d054c229c9c100f5f1c135fd57f2fa
Author: John Hurley
Date: Tue Aug 27 22:56:30 2019 -0700
nfp: flower: handle neighbour events on internal ports
[ Upstream commit e8024cb483abb2b0290b3ef5e34c736e9de2492f ]
Recent code changes to NFP allowed the offload of neighbour entries to FW
when the next hop device was an internal port. This allows for offload of
tunnel encap when the end-point IP address is applied to such a port.
Unfortunately, the neighbour event handler still rejects events that are
not associated with a repr dev and so the firmware neighbour table may get
out of sync for internal ports.
Fix this by allowing internal port neighbour events to be correctly
processed.
Fixes: 45756dfedab5 ("nfp: flower: allow tunnels to output to internal port")
Signed-off-by: John Hurley
Reviewed-by: Simon Horman
Reviewed-by: Jakub Kicinski
Signed-off-by: Jakub Kicinski
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f7ec32a4ae5cb6b78359de1afc37ba7d3ada60ee
Author: John Hurley
Date: Tue Aug 27 22:56:29 2019 -0700
nfp: flower: prevent ingress block binds on internal ports
[ Upstream commit 739d7c5752b255e89ddbb1b0474f3b88ef5cd343 ]
Internal port TC offload is implemented through user-space applications
(such as OvS) by adding filters at egress via TC clsact qdiscs. Indirect
block offload support in the NFP driver accepts both ingress qdisc binds
and egress binds if the device is an internal port. However, clsact sends
bind notification for both ingress and egress block binds which can lead
to the driver registering multiple callbacks and receiving multiple
notifications of new filters.
Fix this by rejecting ingress block bind callbacks when the port is
internal and only adding filter callbacks for egress binds.
Fixes: 4d12ba42787b ("nfp: flower: allow offloading of matches on 'internal' ports")
Signed-off-by: John Hurley
Reviewed-by: Jakub Kicinski
Signed-off-by: Jakub Kicinski
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 64a2a93ba3856d16765e5c8a00c133fa8750879a
Author: Eric Dumazet
Date: Mon Aug 26 09:19:15 2019 -0700
tcp: remove empty skb from write queue in error cases
[ Upstream commit fdfc5c8594c24c5df883583ebd286321a80e0a67 ]
Vladimir Rutsky reported stuck TCP sessions after memory pressure
events. Edge Trigger epoll() user would never receive an EPOLLOUT
notification allowing them to retry a sendmsg().
Jason tested the case of sk\_stream\_alloc\_skb() returning NULL,
but there are other paths that could lead both sendmsg() and sendpage()
to return -1 (EAGAIN), with an empty skb queued on the write queue.
This patch makes sure we remove this empty skb so that
Jason code can detect that the queue is empty, and
call sk->sk\_write\_space(sk) accordingly.
Fixes: ce5ec440994b ("tcp: ensure epoll edge trigger wakeup when write queue is empty")
Signed-off-by: Eric Dumazet
Cc: Jason Baron
Reported-by: Vladimir Rutsky
Cc: Soheil Hassas Yeganeh
Cc: Neal Cardwell
Acked-by: Soheil Hassas Yeganeh
Acked-by: Neal Cardwell
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5cef2bfc9e3f9896e6e27fc6316b9819d5b046c4
Author: Willem de Bruijn
Date: Tue Aug 27 15:09:33 2019 -0400
tcp: inherit timestamp on mtu probe
[ Upstream commit 888a5c53c0d8be6e98bc85b677f179f77a647873 ]
TCP associates tx timestamp requests with a byte in the bytestream.
If merging skbs in tcp\_mtu\_probe, migrate the tstamp request.
Similar to MSG\_EOR, do not allow moving a timestamp from any segment
in the probe but the last. This to avoid merging multiple timestamps.
Tested with the packetdrill script at
https://github.com/wdebruij/packetdrill/commits/mtu\_probe-1
Link: http://patchwork.ozlabs.org/patch/1143278/#2232897
Fixes: 4ed2d765dfac ("net-timestamp: TCP timestamping")
Signed-off-by: Willem de Bruijn
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 939cc35d5f8179ec7de7ef765a41ae161349f247
Author: Chen-Yu Tsai
Date: Thu Aug 29 11:17:24 2019 +0800
net: stmmac: dwmac-rk: Don't fail if phy regulator is absent
[ Upstream commit 3b25528e1e355c803e73aa326ce657b5606cda73 ]
The devicetree binding lists the phy phy as optional. As such, the
driver should not bail out if it can't find a regulator. Instead it
should just skip the remaining regulator related code and continue
on normally.
Skip the remainder of phy\_power\_on() if a regulator supply isn't
available. This also gets rid of the bogus return code.
Fixes: 2e12f536635f ("net: stmmac: dwmac-rk: Use standard devicetree property for phy regulator")
Signed-off-by: Chen-Yu Tsai
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 505aac7f4e48fbdb7fe405103368261a7a84f3c7
Author: Cong Wang
Date: Sun Aug 25 10:01:32 2019 -0700
net\_sched: fix a NULL pointer deref in ipt action
[ Upstream commit 981471bd3abf4d572097645d765391533aac327d ]
The net pointer in struct xt\_tgdtor\_param is not explicitly
initialized therefore is still NULL when dereferencing it.
So we have to find a way to pass the correct net pointer to
ipt\_destroy\_target().
The best way I find is just saving the net pointer inside the per
netns struct tcf\_idrinfo, which could make this patch smaller.
Fixes: 0c66dc1ea3f0 ("netfilter: conntrack: register hooks in netns when needed by ruleset")
Reported-and-tested-by: itugrok@yahoo.com
Cc: Jamal Hadi Salim
Cc: Jiri Pirko
Signed-off-by: Cong Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 3c6dfd2adb7a71915ff2fb8e40e466d748078103
Author: Vlad Buslov
Date: Tue Aug 27 21:49:38 2019 +0300
net: sched: act\_sample: fix psample group handling on overwrite
[ Upstream commit dbf47a2a094edf58983265e323ca4bdcdb58b5ee ]
Action sample doesn't properly handle psample\_group pointer in overwrite
case. Following issues need to be fixed:
- In tcf\_sample\_init() function RCU\_INIT\_POINTER() is used to set
s->psample\_group, even though we neither setting the pointer to NULL, nor
preventing concurrent readers from accessing the pointer in some way.
Use rcu\_swap\_protected() instead to safely reset the pointer.
- Old value of s->psample\_group is not released or deallocated in any way,
which results resource leak. Use psample\_group\_put() on non-NULL value
obtained with rcu\_swap\_protected().
- The function psample\_group\_put() that released reference to struct
psample\_group pointed by rcu-pointer s->psample\_group doesn't respect rcu
grace period when deallocating it. Extend struct psample\_group with rcu
head and use kfree\_rcu when freeing it.
Fixes: 5c5670fae430 ("net/sched: Introduce sample tc action")
Signed-off-by: Vlad Buslov
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5038bd027ac331879445bfff36e9003f3fbfb007
Author: Feng Sun
Date: Mon Aug 26 14:46:04 2019 +0800
net: fix skb use after free in netpoll
[ Upstream commit 2c1644cf6d46a8267d79ed95cb9b563839346562 ]
After commit baeababb5b85d5c4e6c917efe2a1504179438d3b
("tun: return NET\_XMIT\_DROP for dropped packets"),
when tun\_net\_xmit drop packets, it will free skb and return NET\_XMIT\_DROP,
netpoll\_send\_skb\_on\_dev will run into following use after free cases:
1. retry netpoll\_start\_xmit with freed skb;
2. queue freed skb in npinfo->txq.
queue\_process will also run into use after free case.
hit netpoll\_send\_skb\_on\_dev first case with following kernel log:
[ 117.864773] kernel BUG at mm/slub.c:306!
[ 117.864773] invalid opcode: 0000 [#1] SMP PTI
[ 117.864774] CPU: 3 PID: 2627 Comm: loop\_printmsg Kdump: loaded Tainted: P OE 5.3.0-050300rc5-generic #201908182231
[ 117.864775] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Ubuntu-1.8.2-1ubuntu1 04/01/2014
[ 117.864775] RIP: 0010:kmem\_cache\_free+0x28d/0x2b0
[ 117.864781] Call Trace:
[ 117.864781] ? tun\_net\_xmit+0x21c/0x460
[ 117.864781] kfree\_skbmem+0x4e/0x60
[ 117.864782] kfree\_skb+0x3a/0xa0
[ 117.864782] tun\_net\_xmit+0x21c/0x460
[ 117.864782] netpoll\_start\_xmit+0x11d/0x1b0
[ 117.864788] netpoll\_send\_skb\_on\_dev+0x1b8/0x200
[ 117.864789] \_\_br\_forward+0x1b9/0x1e0 [bridge]
[ 117.864789] ? skb\_clone+0x53/0xd0
[ 117.864790] ? \_\_skb\_clone+0x2e/0x120
[ 117.864790] deliver\_clone+0x37/0x50 [bridge]
[ 117.864790] maybe\_deliver+0x89/0xc0 [bridge]
[ 117.864791] br\_flood+0x6c/0x130 [bridge]
[ 117.864791] br\_dev\_xmit+0x315/0x3c0 [bridge]
[ 117.864792] netpoll\_start\_xmit+0x11d/0x1b0
[ 117.864792] netpoll\_send\_skb\_on\_dev+0x1b8/0x200
[ 117.864792] netpoll\_send\_udp+0x2c6/0x3e8
[ 117.864793] write\_msg+0xd9/0xf0 [netconsole]
[ 117.864793] console\_unlock+0x386/0x4e0
[ 117.864793] vprintk\_emit+0x17e/0x280
[ 117.864794] vprintk\_default+0x29/0x50
[ 117.864794] vprintk\_func+0x4c/0xbc
[ 117.864794] printk+0x58/0x6f
[ 117.864795] loop\_fun+0x24/0x41 [printmsg\_loop]
[ 117.864795] kthread+0x104/0x140
[ 117.864795] ? 0xffffffffc05b1000
[ 117.864796] ? kthread\_park+0x80/0x80
[ 117.864796] ret\_from\_fork+0x35/0x40
Signed-off-by: Feng Sun
Signed-off-by: Xiaojun Zhao
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit baa513580b252aaffa1233e1a3716e2c1b0ca2e8
Author: Eric Dumazet
Date: Tue Aug 27 03:33:12 2019 -0700
mld: fix memory leak in mld\_del\_delrec()
[ Upstream commit a84d016479896b5526a2cc54784e6ffc41c9d6f6 ]
Similar to the fix done for IPv4 in commit e5b1c6c6277d
("igmp: fix memory leak in igmpv3\_del\_delrec()"), we need to
make sure mca\_tomb and mca\_sources are not blindly overwritten.
Using swap() then a call to ip6\_mc\_clear\_src() will take care
of the missing free.
BUG: memory leak
unreferenced object 0xffff888117d9db00 (size 64):
comm "syz-executor247", pid 6918, jiffies 4294943989 (age 25.350s)
hex dump (first 32 bytes):
00 00 00 00 00 00 00 00 fe 88 00 00 00 00 00 00 ................
00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
backtrace:
[<000000005b463030>] kmemleak\_alloc\_recursive include/linux/kmemleak.h:43 [inline]
[<000000005b463030>] slab\_post\_alloc\_hook mm/slab.h:522 [inline]
[<000000005b463030>] slab\_alloc mm/slab.c:3319 [inline]
[<000000005b463030>] kmem\_cache\_alloc\_trace+0x145/0x2c0 mm/slab.c:3548
[<00000000939cbf94>] kmalloc include/linux/slab.h:552 [inline]
[<00000000939cbf94>] kzalloc include/linux/slab.h:748 [inline]
[<00000000939cbf94>] ip6\_mc\_add1\_src net/ipv6/mcast.c:2236 [inline]
[<00000000939cbf94>] ip6\_mc\_add\_src+0x31f/0x420 net/ipv6/mcast.c:2356
[<00000000d8972221>] ip6\_mc\_source+0x4a8/0x600 net/ipv6/mcast.c:449
[<000000002b203d0d>] do\_ipv6\_setsockopt.isra.0+0x1b92/0x1dd0 net/ipv6/ipv6\_sockglue.c:748
[<000000001f1e2d54>] ipv6\_setsockopt+0x89/0xd0 net/ipv6/ipv6\_sockglue.c:944
[<00000000c8f7bdf9>] udpv6\_setsockopt+0x4e/0x90 net/ipv6/udp.c:1558
[<000000005a9a0c5e>] sock\_common\_setsockopt+0x38/0x50 net/core/sock.c:3139
[<00000000910b37b2>] \_\_sys\_setsockopt+0x10f/0x220 net/socket.c:2084
[<00000000e9108023>] \_\_do\_sys\_setsockopt net/socket.c:2100 [inline]
[<00000000e9108023>] \_\_se\_sys\_setsockopt net/socket.c:2097 [inline]
[<00000000e9108023>] \_\_x64\_sys\_setsockopt+0x26/0x30 net/socket.c:2097
[<00000000f4818160>] do\_syscall\_64+0x76/0x1a0 arch/x86/entry/common.c:296
[<000000008d367e8f>] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
Fixes: 1666d49e1d41 ("mld: do not remove mld souce list info when set link down")
Fixes: 9c8bb163ae78 ("igmp, mld: Fix memory leak in igmpv3/mld\_del\_delrec()")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman


=== Content from www.openwall.com_4f5f117f_20250120_234249.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2019/09/24/2) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAFcO6XP-YkHxuJWBRYWKYSne+WmvSd8E1t1doo5Xe=Bw+rGvNQ@mail.gmail.com>
Date: Wed, 25 Sep 2019 18:53:14 +0800
From: butt3rflyh4ck <butterflyhuangxx@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2019-16714: Linux kernel net/rds: info leak
 vulnerability in rds6_inc_info_copy

Hi, there is a info leak vulnerability in rds modules in linux kernel.

CVE-2019-16714
================
description:

In the Linux kernel before 5.2.14, rds6_inc_info_copy in net/rds/recv.c
allows attackers to obtain sensitive information from kernel stack memory
because tos and flags fields are not initialized.

=================
some more details in <https://nvd.nist.gov/vuln/detail/CVE-2019-16714>

Fixed in
<https://github.com/torvalds/linux/commit/7d0a06586b2686ba80c4a2da5f91cb10ffbea736>
================

Credit :

This issue was discovered by the ADLab of venustech.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_80973c4f_20250120_234249.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](../../../2019/09/25/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAFcO6XOjcW7g=sS6DbjRY983i1nteHyA2nNBK_+Gbj6OmFVNXQ@mail.gmail.com>
Date: Tue, 24 Sep 2019 18:28:40 +0800
From: butt3rflyh4ck <butterflyhuangxx@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2019-16714: info leak in RDS rds6_inc_info_copy

Hi, there is a info leak vulnerability in rds modules in linux kernel.

CVE-2019-16714
================
description:

In the Linux kernel before 5.2.14, rds6_inc_info_copy in net/rds/recv.c
allows attackers to obtain sensitive information from kernel stack memory
because tos and flags fields are not initialized.

Fixed in
<https://github.com/torvalds/linux/commit/7d0a06586b2686ba80c4a2da5f91cb10ffbea736>

================

credit by :

the ADLab of venustech.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from support.f5.com_30dfab9b_20250120_234255.html ===
Loading×Sorry to interruptCSS ErrorRefresh
