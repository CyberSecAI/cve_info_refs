=== Content from blog.appicaptor.com_ef0b6ccc_20250121_001525.html ===

[Skip to content](#content)
![](https://blog.appicaptor.com/wp-content/uploads/2022/08/cropped-Appicaptor1920.jpg)

[Appicaptor Blog](https://blog.appicaptor.com/)

Framework for App Security Tests

Posted on [4th October 20199th October 2023](https://blog.appicaptor.com/2019/10/04/vulnerable-library-warning-twitterkit-for-ios/) by [Appicaptor](https://blog.appicaptor.com/author/appicaptor/)
# Vulnerable Library Warning: TwitterKit for iOS

![](https://blog.appicaptor.com/wp-content/uploads/2019/10/twitterkit.png)The Twitter Kit framework through 3.4.2 for iOS does not properly validate the TLS certificate for `api.twitter.com`. That’s a [finding](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-16263) found with our static binary analysis and reported to Twitter.

There will be no fixed version, as this library is no longer supported by Twitter, but this vulnerable library was still found in many apps. It is urgently advised that their app developers switch to [alternative APIs](https://blog.twitter.com/developer/en_us/topics/tools/2018/discontinuing-support-for-twitter-kit-sdk.html).

Such issues are likewise common, which illustrates the need to check for vulnerable or outdated 3rd party code.

What makes this issue a bit special is the way the developers broke the validation of TLS certificates. Apparently, they wanted to increase the security by implementing a public key pinning of trusted root certificate authorities (CA), such as VeriSign, DigiCert and GeoTrust. So they created the following array with entries of [21 public key hashes](https://hackerone.com/redirect?signature=472780f54bbfcc4dc9770d84a4004ac0c6ef6eb4&url=https%3A%2F%2Fgithub.com%2Ftwitter%2Ftwitter-kit-ios%2Fblob%2Fmaster%2FTwitterCore%2FTwitterCore%2FNetworking%2FSecurity%2FTWTRServerTrustEvaluator.m) for the CAs:

```
"1a21b4952b6293ce18b365ec9c0e934cb381e6d4",  // "VERISIGN_CLASS3_G2"
"2343d148a255899b947d461a797ec04cfed170b7",  // "VERISIGN_CLASS1"
"5519b278acb281d7eda7abc18399c3bb690424b5",  // "VERISIGN_CLASS1_G3"
"1237ba4517eead2926fdc1cdfebeedf2ded9145c",  // "VERISIGN_CLASS2_G2"
"5abec575dcaef3b08e271943fc7f250c3df661e3",  // "VERISIGN_CLASS2_G3"
"22f19e2ec6eaccfc5d2346f4c2e8f6c554dd5e07",  // "VERISIGN_CLASS3_G3"
"ed663135d31bd4eca614c429e319069f94c12650",  // "VERISIGN_CLASS3_G4"
"b181081a19a4c0941ffae89528c124c99b34acc7",  // "VERISIGN_CLASS3_G5"
"3c03436868951cf3692ab8b426daba8fe922e5bd",  // "VERISIGN_CLASS4_G3"
"bbc23e290bb328771dad3ea24dbdf423bd06b03d",  // "VERISIGN_UNIVERSAL"
"c07a98688d89fbab05640c117daa7d65b8cacc4e",  // "GEOTRUST_GLOBAL"
"713836f2023153472b6eba6546a9101558200509",  // "GEOTRUST_GLOBAL2"
"b01989e7effb4aafcb148f58463976224150e1ba",  // "GEOTRUST_PRIMARY"
"bdbea71bab7157f9e475d954d2b727801a822682",  // "GEOTRUST_PRIMARY_G2"
"9ca98d00af740ddd8180d21345a58b8f2e9438d6",  // "GEOTRUST_PRIMARY_G3"
"87e85b6353c623a3128cb0ffbbf551fe59800e22",  // "GEOTRUST_UNIVERAL"
"5e4f538685dd4f9eca5fdc0d456f7d51b1dc9b7b",  // "GEOTRUST_UNIVERSAL2"
"d52e13c1abe349dae8b49594ef7c3843606466bd",  // "DIGICERT_GLOBAL_ROOT"
"83317e62854253d6d7783190ec919056e991b9e3",  // "DIGICERT_EV_ROOT"
"68330e61358521592983a3c8d2d2e1406e7ab3c1",  // "DIGICERT_ASSUREDID_ROOT"
"56fef3c2147d4ed38837fdbd3052387201e5778d",  // "TWITTER1"
```

On every new connection, TwitterKit for iOS checks in method [`evaluateServerTrust`](https://github.com/twitter-archive/twitter-kit-ios/blob/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore/Networking/Security/TWTRServerTrustEvaluator.m#L68-L85) whether the received certificate chain contains a certificate with a fitting public key of the list above. This way, certificates for `api.twitter.com` issued by possibly untrusted CAs should be blocked. However, this approach lacks a very important verification: The domain name of the leaf certificate is not verified by iOS, as TwitterKit for iOS implemented an own delegate method for its public key pinning functionality. In this case, iOS only verifies, that the certificate chain is valid regarding signatures. All other checks have to be performed by the delegate method, to provide the flexibility for alternative verification methods. A simple fix would have been additionally calling the iOS method [secTrustEvaluate](https://hackerone.com/redirect?signature=e3002065300dfcf74bf016d7df0d9d418737cda2&url=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fsecurity%2F1394363-sectrustevaluate%3Flanguage%3Dobjc) and utilize its result value to reject certificates for other domains.

Because of the missing domain name verification, any valid certificate chain containing a certificate with a public key hash of that list is accepted by the app. An attacker with a valid certificate for his own domain, issued by one of these CAs, can use this certificate for man-in-the-middle-attacks against apps communicating via the Twitter Kit for iOS with `api.twitter.com`. As the implementation does not check the position inside the chain, the matching public key could also be in the middle of the chain, such as in case of an intermediate certificate.

* ![](https://blog.appicaptor.com/wp-content/uploads/2019/10/mitm_EN-2.png)

We used a matching legitimate certificate, issued by DigiCert for a domain under our control to verify the impact of the vulnerability. So we redirected the traffic for `api.twitter.com` to our server, that answers the request with our own certificate. The received content is logged and transmitted to the ‘real’ Twitter servers. The server’s response is also logged and transmitted back to the app. However, as the login process for Twitter involves a WebView, which does not use the vulnerable pinning functionality, it would not accept our certificate. As the WebView loads its content via the same domain name, we had to distinguish TLS connections based on differences in [ALPN](https://en.wikipedia.org/wiki/Application-Layer_Protocol_Negotiation) extension of the TLS [Client Hello](https://tools.ietf.org/html/rfc5246#section-7.4.1.2) and route WebView connections without interception, to create a fully working proof of concept attack.

During the **Login with Twitter** process, our man-in-the-middle proxy recorded for a vulnerable news app the [OAuth 1.0](https://en.wikipedia.org/wiki/OAuth) `oauth_token_secret` together with the authorized `oauh_token`. This enabled us to fully use the provided Twitter API with these long term secrets. Attackers could perform actions like changing content of the profile, creating fake tweets and direct messages or abusing the account to push tweets via fake likes. It would also be possible to read private direct messages sentor received within the last 30 days. We could not retrieve the password nor set it to a known value, so an attacker could not use the vulnerability to lock out a user from his account. However, by changing the Twitter password a victim would also not be able to invalidate the sniffed OAuth tokens. For this it is required to revoke the app’s authorization within the Twitter settings.

Further, on every app start the vulnerable app checks the validity of the Twitter account by invoking the Twitter API `[account/verify_credentials.json](https://developer.twitter.com/en/docs/accounts-and-users/manage-account-settings/api-reference/get-account-verify_credentials)`. In case the credentials are valid, the response contains detailed information about the victims Twitter profile, such as ID, name, location and last activities. As the response can be read in our attack scenario, the information can be used to collect information about the victim to track him or dynamically create targeted phishing attacks.

We will demonstrate the vulnerability and its detection at [it-sa 2019](https://www.it-sa.de/en) fair in Nuremberg, Germany at Hall 9, Booth 234.

  Tags[iOS](https://blog.appicaptor.com/tag/ios/), [Results](https://blog.appicaptor.com/tag/results/), [Security](https://blog.appicaptor.com/tag/security/)

## Post navigation

[Previous PostPrevious   Unwanted Functionality Apps in Google Play Store](https://blog.appicaptor.com/2019/06/07/unwanted-functionality-apps-in-google-play-store/)[Next PostNext Appicaptor Security Index 2019](https://blog.appicaptor.com/2019/10/04/appicaptor-security-index-2019/)

## App Testing Technology provided by

![](https://blog.appicaptor.com/wp-content/uploads/2017/09/sit_internet.gif)
Search for:

Search

## Recent Posts

* [Visit us at it-sa 2024: Threats of Device Fingerprinting for Enterprises](https://blog.appicaptor.com/2024/10/07/device-fingerprinting-it-sa-2024/)
* [iOS Privacy Manifest: Data Collection and Usage in Top Free iOS Apps](https://blog.appicaptor.com/2024/07/05/ios-privacy-manifest-data-collection-and-usage-in-top-free-ios-apps/)
* [Vulnerable Third-Party Libraries in Mobile Apps](https://blog.appicaptor.com/2024/05/17/vulnerable-third-party-libraries-in-mobile-apps/)
* [iOS Privacy Manifest: Empowering Data Privacy Evaluation](https://blog.appicaptor.com/2024/04/16/ios-privacy-manifest-empowering-data-privacy-evaluation/)
* [Security Implications of Apple ID Switching and Keychain Merging in COPE Mobile Environments](https://blog.appicaptor.com/2024/02/13/security-implications-of-apple-id-switching-and-keychain-merging-in-cope-mobile-environments/)
## Archives

* [October 2024](https://blog.appicaptor.com/2024/10/)
* [July 2024](https://blog.appicaptor.com/2024/07/)
* [May 2024](https://blog.appicaptor.com/2024/05/)
* [April 2024](https://blog.appicaptor.com/2024/04/)
* [February 2024](https://blog.appicaptor.com/2024/02/)
* [November 2023](https://blog.appicaptor.com/2023/11/)
* [October 2023](https://blog.appicaptor.com/2023/10/)
* [June 2023](https://blog.appicaptor.com/2023/06/)
* [March 2023](https://blog.appicaptor.com/2023/03/)
* [October 2022](https://blog.appicaptor.com/2022/10/)
* [February 2022](https://blog.appicaptor.com/2022/02/)
* [December 2021](https://blog.appicaptor.com/2021/12/)
* [July 2021](https://blog.appicaptor.com/2021/07/)
* [March 2021](https://blog.appicaptor.com/2021/03/)
* [February 2021](https://blog.appicaptor.com/2021/02/)
* [April 2020](https://blog.appicaptor.com/2020/04/)
* [February 2020](https://blog.appicaptor.com/2020/02/)
* [December 2019](https://blog.appicaptor.com/2019/12/)
* [October 2019](https://blog.appicaptor.com/2019/10/)
* [June 2019](https://blog.appicaptor.com/2019/06/)
* [May 2019](https://blog.appicaptor.com/2019/05/)
* [December 2018](https://blog.appicaptor.com/2018/12/)
* [October 2018](https://blog.appicaptor.com/2018/10/)
* [September 2018](https://blog.appicaptor.com/2018/09/)
* [August 2018](https://blog.appicaptor.com/2018/08/)
* [April 2018](https://blog.appicaptor.com/2018/04/)
* [November 2017](https://blog.appicaptor.com/2017/11/)
* [October 2017](https://blog.appicaptor.com/2017/10/)
* [September 2017](https://blog.appicaptor.com/2017/09/)
* [August 2017](https://blog.appicaptor.com/2017/08/)
* [April 2017](https://blog.appicaptor.com/2017/04/)
* [September 2016](https://blog.appicaptor.com/2016/09/)
* [July 2016](https://blog.appicaptor.com/2016/07/)
* [May 2016](https://blog.appicaptor.com/2016/05/)
* [January 2016](https://blog.appicaptor.com/2016/01/)
© Fraunhofer-Gesellschaft

[Imprint](https://www.sit.fraunhofer.de/en/imprint/)

[Privacy Statement](https://blog.appicaptor.com/data-protection-information/)

[Proudly powered by WordPress](https://en-gb.wordpress.org/)



=== Content from github.com_0cc0bd7e_20250121_001526.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftwitter-archive%2Ftwitter-kit-ios%2Fblob%2Fac42e1351a66afa5ff7718d04d64a905dafe1f41%2FTwitterCore%2FTwitterCore%2FNetworking%2FSecurity%2FTWTRServerTrustEvaluator.m)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftwitter-archive%2Ftwitter-kit-ios%2Fblob%2Fac42e1351a66afa5ff7718d04d64a905dafe1f41%2FTwitterCore%2FTwitterCore%2FNetworking%2FSecurity%2FTWTRServerTrustEvaluator.m)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=twitter-archive%2Ftwitter-kit-ios)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Oct 5, 2019. It is now read-only.

[twitter-archive](/twitter-archive)
/
**[twitter-kit-ios](/twitter-archive/twitter-kit-ios)**
Public archive

* [Notifications](/login?return_to=%2Ftwitter-archive%2Ftwitter-kit-ios) You must be signed in to change notification settings
* [Fork
  448](/login?return_to=%2Ftwitter-archive%2Ftwitter-kit-ios)
* [Star
   693](/login?return_to=%2Ftwitter-archive%2Ftwitter-kit-ios)

* [Code](/twitter-archive/twitter-kit-ios)
* [Issues
  40](/twitter-archive/twitter-kit-ios/issues)
* [Pull requests
  5](/twitter-archive/twitter-kit-ios/pulls)
* [Actions](/twitter-archive/twitter-kit-ios/actions)
* [Projects
  0](/twitter-archive/twitter-kit-ios/projects)
* [Wiki](/twitter-archive/twitter-kit-ios/wiki)
* [Security](/twitter-archive/twitter-kit-ios/security)
* [Insights](/twitter-archive/twitter-kit-ios/pulse)

Additional navigation options

* [Code](/twitter-archive/twitter-kit-ios)
* [Issues](/twitter-archive/twitter-kit-ios/issues)
* [Pull requests](/twitter-archive/twitter-kit-ios/pulls)
* [Actions](/twitter-archive/twitter-kit-ios/actions)
* [Projects](/twitter-archive/twitter-kit-ios/projects)
* [Wiki](/twitter-archive/twitter-kit-ios/wiki)
* [Security](/twitter-archive/twitter-kit-ios/security)
* [Insights](/twitter-archive/twitter-kit-ios/pulse)

## Files

 ac42e13
## Breadcrumbs

1. [twitter-kit-ios](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41)
2. /[TwitterCore](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore)
3. /[TwitterCore](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore)
4. /[Networking](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore/Networking)
5. /[Security](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore/Networking/Security)
/
# TWTRServerTrustEvaluator.m

Copy path Blame  Blame
## Latest commit

## History

[History](/twitter-archive/twitter-kit-ios/commits/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore/Networking/Security/TWTRServerTrustEvaluator.m)137 lines (118 loc) · 4.62 KB ac42e13
## Breadcrumbs

1. [twitter-kit-ios](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41)
2. /[TwitterCore](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore)
3. /[TwitterCore](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore)
4. /[Networking](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore/Networking)
5. /[Security](/twitter-archive/twitter-kit-ios/tree/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore/Networking/Security)
/
# TWTRServerTrustEvaluator.m

Top
## File metadata and controls

* Code
* Blame

137 lines (118 loc) · 4.62 KB[Raw](https://github.com/twitter-archive/twitter-kit-ios/raw/ac42e1351a66afa5ff7718d04d64a905dafe1f41/TwitterCore/TwitterCore/Networking/Security/TWTRServerTrustEvaluator.m)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137/\* \* Copyright (C) 2017 Twitter, Inc. \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \* \*/
#import "TWTRServerTrustEvaluator.h"#import <CommonCrypto/CommonDigest.h>#import "TWTRX509Certificate.h"
static const int TWTR\_DIGEST\_HEX\_STRING\_LENGTH = 41;static char TWTR\_TWITTER\_PINS[][TWTR\_DIGEST\_HEX\_STRING\_LENGTH] = { "1a21b4952b6293ce18b365ec9c0e934cb381e6d4", "2343d148a255899b947d461a797ec04cfed170b7", "5519b278acb281d7eda7abc18399c3bb690424b5", "1237ba4517eead2926fdc1cdfebeedf2ded9145c", "5abec575dcaef3b08e271943fc7f250c3df661e3", "22f19e2ec6eaccfc5d2346f4c2e8f6c554dd5e07", "ed663135d31bd4eca614c429e319069f94c12650", "b181081a19a4c0941ffae89528c124c99b34acc7", "3c03436868951cf3692ab8b426daba8fe922e5bd", "bbc23e290bb328771dad3ea24dbdf423bd06b03d", "c07a98688d89fbab05640c117daa7d65b8cacc4e", "713836f2023153472b6eba6546a9101558200509", "b01989e7effb4aafcb148f58463976224150e1ba", "bdbea71bab7157f9e475d954d2b727801a822682", "9ca98d00af740ddd8180d21345a58b8f2e9438d6", "87e85b6353c623a3128cb0ffbbf551fe59800e22", "5e4f538685dd4f9eca5fdc0d456f7d51b1dc9b7b", "d52e13c1abe349dae8b49594ef7c3843606466bd", "83317e62854253d6d7783190ec919056e991b9e3", "68330e61358521592983a3c8d2d2e1406e7ab3c1", "56fef3c2147d4ed38837fdbd3052387201e5778d",};static const int TWTR\_NUM\_PINNED\_CERTS = sizeof(TWTR\_TWITTER\_PINS) / TWTR\_DIGEST\_HEX\_STRING\_LENGTH;
static NSCache \*TWTRCertificateCache;
@interface TWTRServerTrustEvaluator ()
@property (nonatomic, strong, readwrite) NSArray \*pinnedPublicKeys;
@end
@implementation TWTRServerTrustEvaluator
+ (void)initialize{ if (self == [TWTRServerTrustEvaluator class]) { static dispatch\_once\_t onceToken; dispatch\_once(&onceToken, ^{ TWTRCertificateCache = [[NSCache alloc] init]; }); }}
- (BOOL)evaluateServerTrust:(SecTrustRef)serverTrust forDomain:(NSString \*)domain{ if ([TWTRServerTrustEvaluator isCertificateChainCached:serverTrust]) { return YES; }
 CFIndex chainLength = SecTrustGetCertificateCount(serverTrust); for (int i = 0; i < chainLength; i++) { SecCertificateRef certificate = SecTrustGetCertificateAtIndex(serverTrust, i); TWTRX509Certificate \*x509 = [[TWTRX509Certificate alloc] initWithCertificate:certificate]; NSData \*publicKeyBytes = [x509 publicKey]; if ([TWTRServerTrustEvaluator isPinnedSPKI:publicKeyBytes]) { [TWTRServerTrustEvaluator cacheValidCertificateChain:serverTrust]; return YES; } } return NO;}
+ (BOOL)isPinnedSPKI:(NSData \*)encodedSpki{ unsigned char digest[CC\_SHA1\_DIGEST\_LENGTH]; unsigned char pin[CC\_SHA1\_DIGEST\_LENGTH];
 if (CC\_SHA1([encodedSpki bytes], (CC\_LONG)[encodedSpki length], digest)) { for (int i = 0; i < TWTR\_NUM\_PINNED\_CERTS; i++) { [self hexDecode:TWTR\_TWITTER\_PINS[i] decoded:pin];
 if (memcmp(digest, pin, CC\_SHA1\_DIGEST\_LENGTH) == 0) { return TRUE; } } } return FALSE;}
+ (void)hexDecode:(const char \*)hexString decoded:(unsigned char \*)decoded{ size\_t length = strlen(hexString);
 for (size\_t i = 0; i < length; i += 2) { char hexByte[3]; hexByte[0] = hexString[i]; hexByte[1] = hexString[i + 1]; hexByte[2] = '\0';
 decoded[i / 2] = (unsigned char)strtoul(hexByte, NULL, 16); }}
+ (BOOL)isCertificateChainCached:(SecTrustRef)serverTrust{ SecCertificateRef certificate = SecTrustGetCertificateAtIndex(serverTrust, 0); TWTRX509Certificate \*x509 = [[TWTRX509Certificate alloc] initWithCertificate:certificate]; NSString \*fingerprint = [x509 fingerprint]; if ([TWTRCertificateCache objectForKey:fingerprint]) { return YES; } return NO;}
+ (void)cacheValidCertificateChain:(SecTrustRef)serverTrust{ SecCertificateRef certificate = SecTrustGetCertificateAtIndex(serverTrust, 0); TWTRX509Certificate \*x509 = [[TWTRX509Certificate alloc] initWithCertificate:certificate]; NSString \*fingerprint = [x509 fingerprint]; [TWTRCertificateCache setObject:[NSNull null] forKey:fingerprint];}
@end

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.sit.fraunhofer.de_d3dc874c_20250121_001527.html ===
1.  Summary

Vendor: Twitter Inc.

Product:  TwitterKit for iOS

Affected Version: <= 3.4.2

CVSS Score: 8.1 (High)
(https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:N)

Severity: high

Remote exploitable: yes

The Twitter Kit framework through 3.4.2 for iOS does not properly validate the api.twitter.com SSL
certificate. Although the certificate chain must contain one of a set of pinned certificates, there are certain
implementation errors such as a lack of hostname verification. NOTE: this is an end-of-life product.

Description

The vulnerability was acknowledged by Twitter via HackerOne on July 9th, 2019 (Report #560584).
However, no fix will be supplied, as TwitterKit is end of life affective October 31, 2018. This leaves
thousands of apps vulnerable. A quick scan of the German top 2000 apps revealed at least 45 affected
apps (May 2019).

The Twitter Kit for iOS framework uses a vulnerable certificate validation implementation. The certificate
validation only verifies that the received certificate chain contains one of the 21 pinned root certificates.
The domain name it NOT verified. So any valid certificate that was issued by one of the 21 pinned CAs is
accepted by the implemented trust evaluator. An attacker with a valid certificate for his own domain,
issued by one of these CAs, can use this certificate for man-in-the-middle-attacks against app
communicating via the Twitter Kit for iOS with api.twitter.com.

The TWTRServerTrustEvaluator class contains the following SHA-1 Hashes of the pinned public keys:

"1a21b4952b6293ce18b365ec9c0e934cb381e6d4",  // "VERISIGN_CLASS3_G2"
"2343d148a255899b947d461a797ec04cfed170b7",  // "VERISIGN_CLASS1"
“5519b278acb281d7eda7abc18399c3bb690424b5",  // "VERISIGN_CLASS1_G3"
“1237ba4517eead2926fdc1cdfebeedf2ded9145c",  // "VERISIGN_CLASS2_G2"
"5abec575dcaef3b08e271943fc7f250c3df661e3",  // "VERISIGN_CLASS2_G3"
"22f19e2ec6eaccfc5d2346f4c2e8f6c554dd5e07",  // "VERISIGN_CLASS3_G3"
"ed663135d31bd4eca614c429e319069f94c12650",  // "VERISIGN_CLASS3_G4"
"b181081a19a4c0941ffae89528c124c99b34acc7",  // "VERISIGN_CLASS3_G5"
"3c03436868951cf3692ab8b426daba8fe922e5bd",  // "VERISIGN_CLASS4_G3"
"bbc23e290bb328771dad3ea24dbdf423bd06b03d",  // "VERISIGN_UNIVERSAL"
"c07a98688d89fbab05640c117daa7d65b8cacc4e",  // "GEOTRUST_GLOBAL"
"713836f2023153472b6eba6546a9101558200509",  // "GEOTRUST_GLOBAL2"
"b01989e7effb4aafcb148f58463976224150e1ba",  // "GEOTRUST_PRIMARY"
"bdbea71bab7157f9e475d954d2b727801a822682",  // "GEOTRUST_PRIMARY_G2"
"9ca98d00af740ddd8180d21345a58b8f2e9438d6",  // "GEOTRUST_PRIMARY_G3"
"87e85b6353c623a3128cb0ffbbf551fe59800e22",  // "GEOTRUST_UNIVERAL"
"5e4f538685dd4f9eca5fdc0d456f7d51b1dc9b7b",  // "GEOTRUST_UNIVERSAL2"
"d52e13c1abe349dae8b49594ef7c3843606466bd",  // "DIGICERT_GLOBAL_ROOT"
"83317e62854253d6d7783190ec919056e991b9e3",  // "DIGICERT_EV_ROOT"
"68330e61358521592983a3c8d2d2e1406e7ab3c1",  // "DIGICERT_ASSUREDID_ROOT"
"56fef3c2147d4ed38837fdbd3052387201e5778d",  // "TWITTER1"

see https://github.com/twitter/twitter-kit-ios/blob/master/TwitterCore/TwitterCore/Networking/Security/TWTRServerTrustEvaluator.m

In method evaluateServerTrust:(SecTrustRef)serverTrust forDomain:(NSString
*)domain each certificate of the received certificate chain is checked against the above list. If one fits,
the connection is accepted. So for example any valid certificate chain signed with a VeriSign_Class1 root
certificate is accepted, as no further checks are performed that verify the domain name.

This certificate validator is called by TWTRURLSessionDelegate.
see: https://github.com/twitter/twitter-kit-
ios/blob/v3.2.1/TwitterCore/TwitterCore/Networking/Pipeline/TWTRURLSessionDelegate.m

However, this delegate does not invoke secTrustEvaluate, which would evaluate trust for the
specified certificate and policies. Additionally, the host name is not verified.
see https://developer.apple.com/documentation/security/1394363-sectrustevaluate?language=objc

Steps To Reproduce

The vulnerability was practically verified with apps using TwitterKit for iOS.

An http-proxy was used to redirect requests for api.twitter.com to a server with a certificate signed
by one of the pinned CAs. This was done by assigning api.twitter.com an IP of a server under our
control. As long as the certificate of this server was signed by a pinned CA, the connection was
established successfully, although we should not be able to establish a secured connecting for domain
api.twitter.com. On this server, we receive the transmitted http data and proxy it to a connection
established to the real Twitter server.

Impact

We are aware that Twitter has discontinued support for Twitter Kit. However, we have still detected
vulnerable versions of this framework in many apps, as the framework is also included in other 3rd party
frameworks like Google Fabric.

Users of these apps are exposed to the risk of identity theft, account abusage and loss of privacy.

A quick scan of the German top 2000 apps revealed at least 45 affected apps (May 2019).

2.  Workaround

In affected apps, the feature to use Twitter should not be used.

3.  Possible fix

Twitter has acknowledged the vulnerability, but no fix for TwitterKit for iOS will be released by Twitter, as
TwitterKit reached end of life October 31, 2018.

Developers need to switch to alternative APIs, see:
https://blog.twitter.com/developer/en_us/topics/tools/2018/discontinuing-support-for-twitter-kit-sdk.html


