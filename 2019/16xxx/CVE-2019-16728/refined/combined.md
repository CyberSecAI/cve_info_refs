=== Content from research.securitum.com_7d4694c9_20250121_005313.html ===

[Skip to content](#content)

[research.securitum.com](https://research.securitum.com/)

securitum.com vulnerabilities researches and cyber security education publications

Primary Menu

* [Research blog](https://research.securitum.com)
* [Penetration Testing](https://securitum.com)
* [Contact us](https://www.securitum.com/contact.html)
* [About us](https://www.securitum.com/company-about-us.html)

# Write-up of DOMPurify 2.0.0 bypass using mutation XSS

[Michał Bentkowski](/authors/michal-bentkowski) | September 20, 2019September 30, 2019 | [Research](https://research.securitum.com/category/research/)

Yesterday, [a new version of DOMPurify](https://github.com/cure53/DOMPurify/releases/tag/2.0.1) (very popular XSS sanitization library) was released, that fixed a bypass reported by us. In this post I’ll show how exactly the bypass looked like preceded by general information about DOMPurify and how it works. If you are aware of how purifiers work and what mXSS is – you can skip directly to the paragraph [mXSS in Chromium (and Safari)](#mxss-in-chromium-and-safari).

## HTML sanitizers – why we need them and how they work

A quite common use case in web applications is that users are allowed to enter some HTML, mainly in form of rich editors, meant to make it possible to include formatting in text (like **bold**, *italic* etc.). This function is usually possible in webmails, blog platforms etc. The main security problem arising here is that the user might include malicious HTML/JavaScript code and introduce XSS. So the main question that creators of such applications need to ask themselves is: “how can we make sure that HTML provided by the user is safe and won’t expose us to XSS?”.

This is where HTML sanitizers/purifies come into play. Their main goal is to take untrusted input, sanitize it and produce safe HTML (HTML with all dangerous tags stripped).

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/Untitled-Diagram-1.png)

Idea of HTML Sanitizers

Purifiers usually perform sanitizing by parsing the input (there is a few ways to do that from JavaScript, one example being to use `[DOMParser.prototype.parseFromString](https://developer.mozilla.org/en-US/docs/Web/API/DOMParser)` method). Then purifiers have a list of allowed elements and attributes, traverses the DOM tree and delete everything that is not in the list (this is a bit simplified, because real sanitizers are often more complicated than that but for the sake of the example, it is enough).

So let’s suppose that we have a purifier with the following allow-list:

* Elements: `<div>`, `<b>`, `<i>` and `<img>`.
* Attribute: only `src`.

and user enters the following HTML:

Python

<div>I am trying to be <i>malicious</i> <u>here</u>! <img src=1 onerror=alert(1)></div>

| 1 | <div>I am trying to be <i>malicious</i> <u>here</u>! <img src=1 onerror=alert(1)></div> |
| --- | --- |

After parsing we’ll get the following DOM tree:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image.png)

Unsafe HTML

So there are two things that should be deleted:

1. The `<u>` element that is not in the allow-list,
2. The `onerror` attribute not in in the allow-list.

So after traversing the DOM tree, the purifier should leave only the following:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-1.png)

Safe, sanitized HTML

Now we have a “safe” DOM tree with all not-allowed elements or attributes stripped. Hence, the purifier would yield the following string after performing sanitization:

Python

<div>I am trying to be <i>malicious</i> here! <img src="1"></div>

| 1 | <div>I am trying to be <i>malicious</i> here! <img src="1"></div> |
| --- | --- |

This is now a safe HTML fragment that could be inserted into our DOM tree without fear, right? This is basically true with one important caveat: so-called **mutation XSS**.

## What is mutation XSS?

The main learning source about mutation XSS (mXSS) is still a paper from 2013 by Mario Heiderich et al called [mXSS Attacks: Attacking well-secured Web-Applications by using innerHTML Mutations](https://cure53.de/fp170.pdf). In next paragraphs, I’ll give you a short overview of what mXSS is and why it was necessary to bypass DOMPurify.

`innerHTML` is a very convenient method in DOM elements with which we can just enter some HTML and it gets automatically parsed and inserted into the DOM tree. For instance, if we do the following assignment:

Python

element.innerHTML = '<u>Some <i>HTML'

| 1 | element.innerHTML = '<u>Some <i>HTML' |
| --- | --- |

the right part of the assignment gets automatically parsed and inserted into DOM tree as children of `element`. The thing about `innerHTML`, though, is that browser can *mutate* the string we wanted to insert. For instance, if I try to read the `element.innerHTML` from above, I’ll get the following result:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-2.png)

Writing and reading from innerHTML

As you can see, immediately after writing to `innerHTML`, the value that I get back is different. This is not that surprising and I would say that it’s actually expected. The user can enter a broken HTML after all and the browser has to fix it.

But we open Pandora’s box when we figure out that sometimes the input can mutate a few times. Suppose we have the following expression:

Python

element.innerHTML = element.innerHTML

| 1 | element.innerHTML = element.innerHTML |
| --- | --- |

At first sight, assigning `innerHTML` to itself shouldn’t matter. But the thing is that because of bugs in browsers sometimes it does. And this is exactly when mXSS happen.

## mXSS in Chromium

So the DOMPurify bypass could happen because I found a new vector of mXSS in current version of Chrome (77). Let’s start with an example:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-3.png)

Trying to put <p> within <svg>

I’m assigning an `<svg>` tag with `<p>` apparently being its child. However, as you can see in the DOM tree, the `<p>` element actually “jumped out” of `<svg>`. This happened because it is not a valid tag inside `<svg>`, thus the browser decided to close it and open `<p>` after it.

But let’s see what happens when I try to put a closing `</p>` tag in the SVG:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-4.png)

Trying to put </p> in <svg>

In a perhaps surprising turn of events, the `<p>` element is now a child of `<svg>`. Furthermore, as you can see at the bottom, Chrome automatically added the opening `<p>` tag. Which means that if I try to assign `innerHTML` to itself, it will mutate!

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-5.png)

mXSS in Chrome

So a payload of `<svg></p>whatever` is a base for mXSS, because it mutates when assigned to `innerHTML`; the content that is initially within `<svg>`, jumps out of it. The question that remains is that how to exploit it.

## Abusing mXSS to bypass DOMPurify

Let’s try to assign the following string to `innerHTML` of a DOM element:

Python

<svg></p><style><a id="</style><img src=1 onerror=alert(1)>">

| 1 | <svg></p><style><a id="</style><img src=1 onerror=alert(1)>"> |
| --- | --- |

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-6.png)

There is nothing inherently wrong with this DOM snippet. All tags (`<div>`, `<svg>`, `<p>`, `<style>` and `<a>`) and attribute `id` are allowed by DOMPurify in default configuration. So it doesn’t change anything in this code. However, when we try to assign `innerHTML` to itself…

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-7.png)

… suddenly a wild `alert` appears!

What happens here is the abuse of specific behavior of `<svg>` element. Basically, when you open a `<svg>` in your HTML, the browser parsing rules change and are closer to XML parsing than to HTML parsing. One of the main difference is that certain tags in HTML cannot have children when being deserialized from text. An example being `[<style>](https://html.spec.whatwg.org/multipage/semantics.html#the-style-element)`. If you look at the HTML spec, you’ll find out that its content model is Text. Even if you try to put an element within a `<style>`, it is treated as text:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-9.png)

The same thing is not true for SVG. Let’s try exactly the same example but with `<style>` being a child of `<svg>`:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-10.png)

As you can see, now `<style>` has a child element.

So now let’s see example with DOMPurify:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-14.png)

In this case, the browser assumes that both `</p>` and `<style>` are children of `<svg>`, which results in `<a>` element being a child of `<style>`. However, the code mutates a bit and now there’s also an opening `<p>` within `<svg>`. The code is theoretically harmless since the dangerous `<img>` element is actually within a value of `id` attribute.

However, when we try to assign the resulting HTML to `innerHTML`, the code will mutate to the following form:

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-15.png)

Now the `<svg>` element is closed immediately and everything that follows is plain HTML. This means that the `<style>` element is closed on `</style>` and the `<img>` tag containing `onerror` attribute is written to the DOM tree.

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/image-16.png)

And that’s it! That is the mXSS in Chrome abused to perform DOMPurify bypass. The same trick would probably be helpful in bypassing other sanitizers as well.

You can play around with the bypass in [a jsbin I prepared](https://jsbin.com/yomabutoze/edit?html,output).

## Summary

In the article, I described a recently found DOMPurify bypass because of mXSS behavior in Chrome. The issue was that `<svg></p>` was rewritten to `<svg><p></p></svg>` by the browser and then rewritten to `<svg></svg><p></p>` after assigning it to `innerHTML`. This could be abused in such a way that the initial HTML parsing assumes that some elements are within `<svg>` while in the subsequent ones, they are outside of `<svg>`, allowing to add arbitrary HTML tags.

So the bypass itself was:

Python

<svg></p><style><a id="</style><img src=1 onerror=alert(1)>">

| 1 | <svg></p><style><a id="</style><img src=1 onerror=alert(1)>"> |
| --- | --- |

## Afterthoughts

After reporting the bypass to DOMPurify, I noticed a few more issues worth mentioning. First of all, the mXSS works not only in Chrome but also in Safari. Second of all, the are a few more variants of it:

* Instead of `<svg>`, you could also use `<math>`,
* Instead of `</p>`, you could also use `</br>`.

If you use DOMPurify, you should update it immediately to version 2.0.1 or newer. If, for some reason, you cannot do it, consider altering its default configuration to disallow both `<math>` and `<svg>` with:

Python

DOMPurify.sanitize(input, {
FORBID\_TAGS: ['svg', 'math']
});

| 123 | DOMPurify.sanitize(input, {     FORBID\_TAGS: ['svg', 'math'] }); |
| --- | --- |

Author: [Michał Bentkowski](/authors/michal-bentkowski)

Tagged: [dompurify](https://research.securitum.com/tag/dompurify/), [mxss](https://research.securitum.com/tag/mxss/), [XSS](https://research.securitum.com/tag/xss/)

## Next posts:

[Server Side Template Injection – on the example of Pebble](https://research.securitum.com/server-side-template-injection-on-the-example-of-pebble/)[JWT (JSON Web Token) (in)security](https://research.securitum.com/jwt-json-web-token-security/)

![](https://research.securitum.com/wp-content/uploads/sites/2/2019/02/michal-bentkowski.jpg)

Michał Bentkowski

Chief Security Researcher, **Securitum**

8+ years of penetration testing and bounty hunting. Listed on Google's [**hall of fame**](https://www.google.com/about/appsecurity/hall-of-fame/) at place 0x08. Numerous publications in English and Polish (distinguished https://sekurak.pl/ author).

He speaks XSS.

[All posts by author](/authors/michal-bentkowski)

## Find us on Linkedin!

[![](https://research.securitum.com/wp-content/uploads/sites/2/2022/11/linkedin_icon.png)](https://www.linkedin.com/company/securitum/)

## Research updates?

Please leave this field emptyE-mail address \*
We keep your data private and use it only for research updates newsletter. We also hate spam! [Read our Privacy Policy.](privacy-policy)

Check your inbox or spam folder to confirm your subscription.

## Categories

* [Education](https://research.securitum.com/category/education/) 44
* [Research](https://research.securitum.com/category/research/) 35
* [Uncategorized](https://research.securitum.com/category/uncategorized/) 1
## Tags

[Active Directory](https://research.securitum.com/tag/active-directory/) · [Analysis](https://research.securitum.com/tag/analysis/) · [Apache](https://research.securitum.com/tag/apache/) · [Browser security](https://research.securitum.com/tag/browser-security/) · [Bug Bounty](https://research.securitum.com/tag/bug-bounty/) · [Bypass](https://research.securitum.com/tag/bypass/) · [CA](https://research.securitum.com/tag/ca/) · [Camera](https://research.securitum.com/tag/camera/) · [CCTV](https://research.securitum.com/tag/cctv/) · [Cryptography](https://research.securitum.com/tag/cryptography/) · [CSS](https://research.securitum.com/tag/css/) · [Desktop](https://research.securitum.com/tag/desktop/) · [dompurify](https://research.securitum.com/tag/dompurify/) · [FDE](https://research.securitum.com/tag/fde/) · [Google](https://research.securitum.com/tag/google/) · [Hack](https://research.securitum.com/tag/hack/) · [hacking](https://research.securitum.com/tag/hacking/) · [HTTP](https://research.securitum.com/tag/http/) · [HTTP/2](https://research.securitum.com/tag/http-2/) · [IDS](https://research.securitum.com/tag/ids/) · [IoT](https://research.securitum.com/tag/iot/) · [javascript](https://research.securitum.com/tag/javascript/) · [json web token](https://research.securitum.com/tag/json-web-token/) · [jwt](https://research.securitum.com/tag/jwt/) · [kibana](https://research.securitum.com/tag/kibana/) · [Linux](https://research.securitum.com/tag/linux/) · [lsass](https://research.securitum.com/tag/lsass/) · [Malware](https://research.securitum.com/tag/malware/) · [Mozilla Firefox](https://research.securitum.com/tag/mozilla-firefox/) · [mxss](https://research.securitum.com/tag/mxss/) · [NMAP](https://research.securitum.com/tag/nmap/) · [OSINT](https://research.securitum.com/tag/osint/) · [pebble](https://research.securitum.com/tag/pebble/) · [RCE](https://research.securitum.com/tag/rce/) · [Reconnaissance](https://research.securitum.com/tag/reconnaissance/) · [SSL](https://research.securitum.com/tag/ssl/) · [ssti](https://research.securitum.com/tag/ssti/) · [Takeover](https://research.securitum.com/tag/takeover/) · [Upload](https://research.securitum.com/tag/upload/) · [Vulnerability](https://research.securitum.com/tag/vulnerability/) · [Web Hacking](https://research.securitum.com/tag/web-hacking/) · [WiFi](https://research.securitum.com/tag/wifi/) · [windows](https://research.securitum.com/tag/windows/) · [Wordpress](https://research.securitum.com/tag/wordpress/) · [XSS](https://research.securitum.com/tag/xss/)
## Archives

* [2023](https://research.securitum.com/2023/) 3
* [2022](https://research.securitum.com/2022/) 8
* [2021](https://research.securitum.com/2021/) 3
* [2020](https://research.securitum.com/2020/) 10
* [2019](https://research.securitum.com/2019/) 8
* [2018](https://research.securitum.com/2018/) 10
* [2017](https://research.securitum.com/2017/) 18
* [2016](https://research.securitum.com/2016/) 8
* [2015](https://research.securitum.com/2015/) 5

#### Follow us on:

* [LinkedIn](https://www.linkedin.com/company/securitum/)
* [Facebook](https://www.facebook.com/securitum/)
* [Twitter](https://twitter.com/securitum_com)
* [GitHub](https://github.com/securitum/research/)
![](https://research.securitum.com/wp-content/uploads/sites/2/2019/09/Securitum-logo_footer.png)
### Pages

* [Research Home Page](/)
* [Penetration testing](https://www.securitum.com)
* [Privacy Policy](https://research.securitum.com/privacy-policy/)
* [About us](https://www.securitum.com/company-about-us.html)
* [Contact us](https://www.securitum.com/contact.html)

### Recent Posts

* [How Private Cache Can Lead to Mass Account Takeover – pentest case](https://research.securitum.com/how-private-cache-can-lead-to-mass-account-takeover-pentest-case/)
  July 12, 2023
* [XSS in WordPress via open embed auto discovery](https://research.securitum.com/xss-in-wordpress-via-open-embed-auto-discovery/)
  May 29, 2023
* [How to access data secured with BitLocker? Do a system update](https://research.securitum.com/how-to-access-data-secured-with-bitlocker-do-a-system-update/)
  January 12, 2023
* [Amazon once again lost control (for 3 hours) over the IP pool in a BGP Hijacking attack](https://research.securitum.com/amazon-once-again-lost-control-for-3-hours-over-the-ip-pool-in-a-bgp-hijacking-attack/)
  October 28, 2022
* [SOCMINT – or rather OSINT of social media](https://research.securitum.com/socmint-or-rather-osint-of-social-media/)
  October 15, 2022

©2025 research.securitum.com

We use cookies to ensure that we give you the best experience on our website. If you continue to use this site we will assume that you are happy with it. You can read more at our Privacy Policy (link below).Ok



=== Content from wiki.debian.org_8d48714b_20250121_030351.html ===

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")

[Wiki](/FrontPage "Debian Wiki Homepage")

[Login](/LTS?action=login)

* [FrontPage](/FrontPage)
* [RecentChanges](/RecentChanges)
* [FindPage](/FindPage)
* [HelpContents](/HelpContents)
* [LTS](/LTS)

Search:

[![Debian](https://www.debian.org/Pics/openlogo-50.png)](https://www.debian.org "Debian Homepage")
[Wiki](/FrontPage "Debian Wiki Homepage")/

* [Login](/LTS?action=login)
* Comments
* [Info](/LTS?action=info)
* [Attachments](/LTS?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  ------------------------
  Load
  Save
  SlideShow

# * [LTS](/LTS)

[Translation(s)](/DebianWiki/EditorGuide#translation): [English](/LTS) - [Deutsch](/de/LTS) - [Español](/es/LTS) - [Français](/fr/LTS) - [Italiano](/it/LTS) - [한국어](/ko/LTS) - [Português](/pt/LTS) - [Português (Brasil)](/pt_BR/LTS) - [Русский](/ru/LTS)

# Debian Long Term Support

Debian Long Term Support (LTS) is a project to extend the lifetime of all Debian stable releases to (at least) 5 years. Debian LTS is not handled by the Debian Security and Release teams, but by a separate group of volunteers and companies interested in making it a success.

Thus the Debian LTS team takes over security maintenance of the various releases once the Debian Security team stops its work.

![/!\](/htdocs/debwiki/img/alert.png "/!\")

LTS ([last modified 2024-08-15 02:46:47](/LTS?action=info))

* Debian [privacy policy](https://www.debian.org/legal/privacy), Wiki [team](/Teams/DebianWiki), [bugs](https://bugs.debian.org/wiki.debian.org) and [config](https://salsa.debian.org/debian/wiki.debian.org).
* Powered by [MoinMoin](https://moinmo.in/ "This site uses the MoinMoin Wiki software.") and [Python](https://moinmo.in/Python "MoinMoin is written in Python."), with hosting provided by [Metropolitan Area Network Darmstadt](https://www.man-da.de/).



=== Content from lists.debian.org_191e1020_20250121_005312.html ===


---

[[Date Prev](msg00028.html)][[Date Next](msg00030.html)]
[[Thread Prev](msg00028.html)][[Thread Next](msg00030.html)]
[[Date Index](maillist.html#00029)]
[[Thread Index](threads.html#00029)]

# [SECURITY] [DLA 2419-1] dompurify.js security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2419-1] dompurify.js security update
* *From*: Thorsten Alteholz <debian@alteholz.de>
* *Date*: Thu, 29 Oct 2020 16:03:08 +0000 (UTC)
* *Message-id*: <[[🔎]](/msgid-search/alpine.DEB.2.21.2010291601410.21534%40postfach.intern.alteholz.me) [alpine.DEB.2.21.2010291601410.21534@postfach.intern.alteholz.me](msg00029.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2419-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                    Thorsten Alteholz
October 29, 2020                              <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : dompurify.js
Version        : 0.8.2~dfsg1-1+deb9u1
CVE ID         : CVE-2019-16728 CVE-2020-26870

```
Two issues have been found in dompurify.js, an XSS sanitizer for HTML,
MathML and SVG.
```

Both issues are related to mXSS issues in SVG- or MATH-elements.

For Debian 9 stretch, these problems have been fixed in version
0.8.2~dfsg1-1+deb9u1.

We recommend that you upgrade your dompurify.js packages.

For the detailed security status of dompurify.js please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/dompurify.js>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEEYgH7/9u94Hgi6ruWlvysDTh7WEcFAl+a57xfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDYy
MDFGQkZGREJCREUwNzgyMkVBQkI5Njk2RkNBQzBEMzg3QjU4NDcACgkQlvysDTh7
WEempRAAvMBLziFgol96wtGHi9uI50pVQmRpsRzPfvwwnHWGofmBRoD08XZ7+94q
e0bFGMpzg3NGWTcguNoASFWuwXtKLvhCWzmqJiGEbxLa5n7AKwpbQuOD49EDzMWx
s+qL2yAtyBa160m/lxLEoDniEE9fUV59njJvlt5oFxeYAg6dZvmBJdzXre8GOlNU
CT3Gh71ndeIistRkzNtEFlR4DnvcjtWyO10G7tMNkTnCcfoTxS+lY1/XcfEvYlmw
6DuGK4K+/lFGFp7xZl7rSmfWUWE87cK8l/p7rjOx6/KG53w7sswMY8Bvy41S1qrV
vW3qjut48GpifNmUKpNuKwLcu3sMJnwya/eXHGbpBHh99Sn5Q8+zTMouBMGLeP6M
i5kQiArTbLZnmLftO/ZVU/h1Bmv+vMtEttcI0vRrGxpIunKD+OJMHh54ApXx3vyk
JCFrOxEstwfN5rR3D+fxGcz7yroqRZqgI6FXaiMgd7QmwRDRixYu22WZ7UUJXrQL
I2t7PpG6Z+K9MCqizDIx2lfwV+86zzOkNZIwPaQLxleFdeHlpygrPRuoCpLZcJJa
5+QsVPDGXgBBB0VvOxmI6bF+FSEH/CkgsrzEjxtUHFxDlTlN8r9RlgQRb3GGlw7q
OdnyKX/6Nko1jNEe/wOFUjEtJjrqDCMNWen2ruT0VBQTHCoWspU=
=cANo
-----END PGP SIGNATURE-----

```

---


