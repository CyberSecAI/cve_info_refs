=== Content from github.com_5500644d_20250121_000657.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxiomatic-systems%2FBento4%2Fissues%2F374)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxiomatic-systems%2FBento4%2Fissues%2F374)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=axiomatic-systems%2FBento4)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[axiomatic-systems](/axiomatic-systems)
/
**[Bento4](/axiomatic-systems/Bento4)**
Public

* [Notifications](/login?return_to=%2Faxiomatic-systems%2FBento4) You must be signed in to change notification settings
* [Fork
  491](/login?return_to=%2Faxiomatic-systems%2FBento4)
* [Star
   2.1k](/login?return_to=%2Faxiomatic-systems%2FBento4)

* [Code](/axiomatic-systems/Bento4)
* [Issues
  515](/axiomatic-systems/Bento4/issues)
* [Pull requests
  32](/axiomatic-systems/Bento4/pulls)
* [Actions](/axiomatic-systems/Bento4/actions)
* [Projects
  0](/axiomatic-systems/Bento4/projects)
* [Wiki](/axiomatic-systems/Bento4/wiki)
* [Security](/axiomatic-systems/Bento4/security)
* [Insights](/axiomatic-systems/Bento4/pulse)

Additional navigation options

* [Code](/axiomatic-systems/Bento4)
* [Issues](/axiomatic-systems/Bento4/issues)
* [Pull requests](/axiomatic-systems/Bento4/pulls)
* [Actions](/axiomatic-systems/Bento4/actions)
* [Projects](/axiomatic-systems/Bento4/projects)
* [Wiki](/axiomatic-systems/Bento4/wiki)
* [Security](/axiomatic-systems/Bento4/security)
* [Insights](/axiomatic-systems/Bento4/pulse)

# Out of bound write in AP4\_CttsTableEntry::AP4\_CttsTableEntry() #374

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkOpenOpen[Out of bound write in AP4\_CttsTableEntry::AP4\_CttsTableEntry()](#top)#374Copy link![@SegfaultMasters](https://avatars.githubusercontent.com/u/42465102?u=da03c64e56d570a6401fd3deb2ae3d126f804179&v=4&size=80)
## Description

![@SegfaultMasters](https://avatars.githubusercontent.com/u/42465102?u=da03c64e56d570a6401fd3deb2ae3d126f804179&v=4&size=48)[SegfaultMasters](https://github.com/SegfaultMasters)opened [on Feb 28, 2019](https://github.com/axiomatic-systems/Bento4/issues/374#issue-415682606)

**Description** - we observed a Out of bound write occured in function AP4\_Array<AP4\_CttsTableEntry>::SetItemCount() located in Ap4Array.h.The same be triggered by sending a crafted file to the [mp42hls.exe(windows)] [mp42hls(ubuntu)] binary. It allows an attacker to cause Denial of Service (Segmentation fault) or possibly have unspecified other impact.

**Command in linux** - mp42hls --hls-version 3 --pmt-pid 0x100 --video-pid 0x102 --video-track-id 1 --segment-duration 6 --segment-duration-threshold 15 --pcr-offset 10000 --index-filename stream.m3u8 --segment-filename-template stream.mp4 --output-single-file $POC

**Command in windows** - mp42hls.exe --hls-version 3 --pmt-pid 0x100 --video-pid 0x102 --video-track-id 1 --segment-duration 6 --segment-duration-threshold 15 --pcr-offset 10000 --index-filename stream.m3u8 --segment-filename-template stream.mp4 --output-single-file $POC

**POC** - [REPRODUCER](https://github.com/SegfaultMasters/covering360/blob/master/BENTO4/HOB_POC1?raw=true)

**Degub** -

**ASAN REPORT** -

```
ASAN report:
WARNING: forcing version to 4 in order to support single file output
=================================================================
==9911==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xb4303d10 at pc 0x08187f87 bp 0xbfffd008 sp 0xbfffcff8
WRITE of size 4 at 0xb4303d10 thread T0
    #0 0x8187f86 in AP4_CttsTableEntry::AP4_CttsTableEntry() /Bento4/Source/C++/Core/Ap4CttsAtom.h:51
    #1 0x8188428 in AP4_Array<AP4_CttsTableEntry>::SetItemCount(unsigned int) /Bento4/Source/C++/Core/Ap4Array.h:215
    #2 0x8187441 in AP4_CttsAtom::AP4_CttsAtom(unsigned int, unsigned char, unsigned int, AP4_ByteStream&) /Bento4/Source/C++/Core/Ap4CttsAtom.cpp:79
    #3 0x81870aa in AP4_CttsAtom::Create(unsigned int, AP4_ByteStream&) /Bento4/Source/C++/Core/Ap4CttsAtom.cpp:52
    #4 0x8196e9a in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned int, unsigned int, unsigned long long, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:469
    #5 0x81950ee in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned long long&, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:231
    #6 0x80c376f in AP4_ContainerAtom::ReadChildren(AP4_AtomFactory&, AP4_ByteStream&, unsigned long long) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:194
    #7 0x80c31a1 in AP4_ContainerAtom::AP4_ContainerAtom(unsigned int, unsigned long long, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:139
    #8 0x80c2c79 in AP4_ContainerAtom::Create(unsigned int, unsigned long long, bool, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:88
    #9 0x81987d0 in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned int, unsigned int, unsigned long long, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:774
    #10 0x81950ee in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned long long&, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:231
    #11 0x80c376f in AP4_ContainerAtom::ReadChildren(AP4_AtomFactory&, AP4_ByteStream&, unsigned long long) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:194
    #12 0x80c31a1 in AP4_ContainerAtom::AP4_ContainerAtom(unsigned int, unsigned long long, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:139
    #13 0x80c2c79 in AP4_ContainerAtom::Create(unsigned int, unsigned long long, bool, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:88
    #14 0x81987d0 in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned int, unsigned int, unsigned long long, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:774
SUMMARY: AddressSanitizer: heap-buffer-overflow /Bento4/Source/C++/Core/Ap4CttsAtom.h:51 AP4_CttsTableEntry::AP4_CttsTableEntry()
Shadow bytes around the buggy address:
  0x36860750: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860760: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860770: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860780: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860790: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x368607a0: 00 00[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Heap right redzone:      fb
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack partial redzone:   f4
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
==9911==ABORTING

```

**GDB** -

```
source:/home/loginsoft/ACE/sources/himanshu_sources/Bento4/Source/C++/Core/Ap4Array.h+215 ────
   210      AP4_Result result = EnsureCapacity(item_count);
   211      if (AP4_FAILED(result)) return result;
   212
   213      // construct the new items
   214      for (unsigned int i=m_ItemCount; i<item_count; i++) {
               // i=0x27ae
→  215          new ((void*)&m_Items[i]) T();
   216      }
   217      m_ItemCount = item_count;
   218      return AP4_SUCCESS;
   219  }
   220
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
[#0] Id 1, Name: "mp42hls", stopped, reason: SIGSEGV
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
[#0] 0x810429f → AP4_Array<AP4_SbgpAtom::Entry>::SetItemCount(this=0x8165278, item_count=0x80000001)
[#1] 0x8103d92 → AP4_SbgpAtom::AP4_SbgpAtom(this=0x8165250, size=0x1c, version=0x0, flags=0x0, stream=@0x8159ea0)
[#2] 0x8103bf5 → AP4_SbgpAtom::Create(size=0x1c, stream=@0x8159ea0)
[#3] 0x80f59da → AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, type=0x73626770, size_32=0x1c, size_64=0x1c, atom=@0xbfffe72c)
[#4] 0x80f412a → AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, bytes_available=@0xbfffe730, atom=@0xbfffe72c)
[#5] 0x80a4cd5 → AP4_ContainerAtom::ReadChildren(this=0x815ea10, atom_factory=@0xbffff1c4, stream=@0x8159ea0, size=0x4a40)
[#6] 0x80a4a44 → AP4_ContainerAtom::AP4_ContainerAtom(this=0x815ea10, type=0x7374626c, size=0x4a48, force_64=0x0, stream=@0x8159ea0, atom_factory=@0xbffff1c4)
[#7] 0x80a47e5 → AP4_ContainerAtom::Create(type=0x7374626c, size=0x4a48, is_full=0x0, force_64=0x0, stream=@0x8159ea0, atom_factory=@0xbffff1c4)
[#8] 0x80f5bbf → AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, type=0x7374626c, size_32=0x4a48, size_64=0x4a48, atom=@0xbfffe93c)
[#9] 0x80f412a → AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, bytes_available=@0xbfffe940, atom=@0xbfffe93c)
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

gef➤  p/d entry_count
$3 = 1073742722
gef➤  p/d item_count
$4 = 1073742722
gef➤  ptype i
type = unsigned int
gef➤  p/d i
$13 = 15468
gef➤  p/d m_Items
$14 = 135638176
gef➤  ptype m_Items
type = class AP4_CttsTableEntry {
  public:
    AP4_UI32 m_SampleCount;
    AP4_UI32 m_SampleOffset;

    AP4_CttsTableEntry(void);
    AP4_CttsTableEntry(AP4_UI32, AP4_UI32);
} *
gef➤  x m_Items[i]
Cannot access memory at address 0x8179000
gef➤  p m_Items[15468]
Cannot access memory at address 0x8179000
gef➤  i r
eax            0x8179000           0x8179000
ecx            0xb7df3780          0xb7df3780
edx            0x1e360             0x1e360
ebx            0x815ac60           0x815ac60
esp            0xbfffe528          0xbfffe528
ebp            0xbfffe528          0xbfffe528
esi            0x1c20              0x1c20
edi            0xb7df3000          0xb7df3000
eip            0x80ef168           0x80ef168 <AP4_CttsTableEntry::AP4_CttsTableEntry()+6>
eflags         0x10292             [ AF SF IF RF ]
cs             0x73                0x73
ss             0x7b                0x7b
ds             0x7b                0x7b
es             0x7b                0x7b
fs             0x0                 0x0
gs             0x33                0x33

```

**DEBUG ON WINDOWS** -

```
STACK_TEXT:
004be750 000d6b2d 0074f000 00000551 00000000 Mp42Hls!AP4_CttsTableEntry::AP4_CttsTableEntry+0x11
004be76c 000d60e3 40000382 15981e17 004be928 Mp42Hls!AP4_Array<AP4_CttsTableEntry>::SetItemCount+0xbd
004be7bc 000d668b 00001c20 00000000 00000000 Mp42Hls!AP4_CttsAtom::AP4_CttsAtom+0xa3
004be808 000a1fb9 00001c20 00749810 1598109f Mp42Hls!AP4_CttsAtom::Create+0xab
004be934 000a08dd 00749810 63747473 00001c20 Mp42Hls!AP4_AtomFactory::CreateAtomFromStream+0x14c9
004be9e8 000ae0b9 00749810 004bea08 004bea18 Mp42Hls!AP4_AtomFactory::CreateAtomFromStream+0x26d
FAILURE_BUCKET_ID:  INVALID_POINTER_WRITE_c0000005_Mp42Hls.exe!AP4_CttsTableEntry::AP4_CttsTableEntry

BUCKET_ID:  APPLICATION_FAULT_INVALID_POINTER_WRITE_Mp42Hls!AP4_CttsTableEntry::AP4_CttsTableEntry+11

ExceptionCode: c0000005 (Access violation)
FAULTING_SOURCE_FILE:  \bento4-master\source\c++\core\ap4cttsatom.h
FAILURE_FUNCTION_NAME:  AP4_CttsTableEntry::AP4_CttsTableEntry
Registers:
eax=0074f000 ebx=7efde000 ecx=0074f000 edx=00000001 esi=004be954 edi=004be7b0
eip=000d62f1 esp=004be74c ebp=004be750 iopl=0         nv up ei pl nz na po nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010202

```
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from cdn.prod.website-files.com_5a36c2ef_20250121_021512.html ===




=== Content from research.loginsoft.com_3f5a4e97_20250121_000658.html ===
[![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/660b22ba452b20ebeb6450c5_Loginsoft%20Logo%20Black.svg)](/)Services[![mask icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3211ce586a1a3fb192b_Vul%20Int.svg)Vulnerability Intelligence](/vulnerability-intelligence)[![notepad with code icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3218ade7b335b90e760_Threat%20Intel.svg)Security & Threat Intelligence Integrations](/security-and-threat-intelligence-integrations)[![gear icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3217b8073f736c27bcc_Vul%20COnfig.svg)Vulnerability & Configuration Management](/vulnerability-management-configuration)Threat Research & Intelligence Services[![Radar icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3227b8073f736c27c37_Threat%20Intel-1.svg)Threat Intelligence](/threat-research-and-intelligence/threat-intelligence)[![secure world icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3220e7bc0108161dfa1_Ext%20Attack.svg)External Attack Surface Discovery](/threat-research-and-intelligence/external-attack-surface-discovery)Software Supply Chain Security Services[![pin icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3218abe17623f5d26ba_SCA.svg)OSS - Software Composition Analysis](/software-supply-chain-security/software-composition-analysis)[![Shield icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321d9e29bda15d8af2b_Depend.svg)OSS - Dependency Defense](/software-supply-chain-security/dependency-defense)[![threat person icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d32192fa5d30ad6518cf_Zero%20Day.svg)OSS - Zero-Day Discovery](/software-supply-chain-security/zero-day-discovery)Cloud Native Security Services[![secure cloud icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321fff4e2af0d5f5709_CSPM.svg)Cloud Security Posture Management](/cloud-native-security/cloud-security-posture-management)[![lock icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3218f8825f699cfca67_Cloud%20Workload.svg)Cloud Workload Protection](/cloud-native-security/cloud-workload-protection-management)ITÂ Solutions[![eye lock icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d323f945aaa8acf48859_Data%20sci.svg)Data Science &Â AI](/data-science-and-ai)[![person with box icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321263244d81f6c6f91_Software%20Dev.svg)Software Development &Â Support](/software-development-and-support)[![tick sticker icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d32160db9b9278e0d4a3_QA%20Automation.svg)QA Automation](/qa-automation)[![personal file icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321a69422a50f566b09_Staff%20Aug.svg)Staff Augmentation](/staff-augmentation)ServicesCybersecurity Solutions[![mask icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3211ce586a1a3fb192b_Vul%20Int.svg)Vulnerability Intelligence![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/vulnerability-intelligence)[![notepad with code icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3218ade7b335b90e760_Threat%20Intel.svg)Security & Threat Intelligence Integrations![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/security-and-threat-intelligence-integrations)[![gear icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3217b8073f736c27bcc_Vul%20COnfig.svg)Vulnerability & Configuration Management![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/vulnerability-management-configuration)SOFTWARE SUPPLY CHAIN SECURITY[![pin icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3218abe17623f5d26ba_SCA.svg)OSS - Software Composition Analysis![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/software-supply-chain-security/software-composition-analysis)[![Shield icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321d9e29bda15d8af2b_Depend.svg)OSS - Dependency Defense![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/software-supply-chain-security/dependency-defense)[![threat person icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d32192fa5d30ad6518cf_Zero%20Day.svg)OSS - Zero Day Discovery![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/software-supply-chain-security/zero-day-discovery)THREAT RESEARCH & INTELLIGENCE[![Radar icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3227b8073f736c27c37_Threat%20Intel-1.svg)Threat Intelligence![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/threat-research-and-intelligence/threat-intelligence)[![secure world icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3220e7bc0108161dfa1_Ext%20Attack.svg)External Attack Surface Discovery![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/threat-research-and-intelligence/external-attack-surface-discovery)CLOUDÂ NATIVEÂ SECURITY[![secure cloud icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321fff4e2af0d5f5709_CSPM.svg)Cloud Security Posture Management![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/cloud-native-security/cloud-security-posture-management)[![lock icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d3218f8825f699cfca67_Cloud%20Workload.svg)Cloud Workload Protection![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/cloud-native-security/cloud-workload-protection-management)ITÂ Solutions[![eye lock icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d323f945aaa8acf48859_Data%20sci.svg)Data Science & AI![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/data-science-and-ai)[![person with box icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321263244d81f6c6f91_Software%20Dev.svg)Software Dev & Support![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/software-development-and-support)[![tick sticker icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d32160db9b9278e0d4a3_QA%20Automation.svg)QA Automation![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/qa-automation)[![personal file icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/6620d321a69422a50f566b09_Staff%20Aug.svg)Staff Augmentation![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/staff-augmentation)Platforms[LOVI![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/lovi)[Cytellite![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/cytellite)[Research-as-a-Service](/research-as-a-service)Research[Zero-Day Discovery![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/security-advisories)[Our Research![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](https://research.loginsoft.com/)Company[Blog![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/blogs)[Reports![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/reports)[Case Studies![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/case-studies)[About us![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/about-us)[Careers![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/659d6af44c73e2c9a57888b7_Right%20Arrow.svg)](/careers)[Talk to us](/contact)[Talk to us](/contact)By using this website, you agree to the storing of cookies on your device to enhance site navigation, analyze site usage, and assist in our marketing efforts. View our [Privacy Policy](/privacy-policy) for more information.Accept![Green Plus icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/65cde7d5fe78a54970c7984e_Green-Plus.svg)[Home](/)/Research/[Zero Day Discovery](/security-advisories)/CVE-2019-9544: Out of bounds write in function AP4\_CttsTableEntry::AP4\_CttsTableEntry() - Bento4-1.5.1.0
## CVE-2019-9544: Out of bounds write in function AP4\_CttsTableEntry::AP4\_CttsTableEntry() - Bento4-1.5.1.0

Vulnerability ReportsMarch 1, 2019![Profile Icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/65a91b500b759f07aaa89823_Blog%20Author%20DP%20Placeholder.png)

Jason Franscisco

### Out of bound write in function AP4\_CttsTableEntry::AP4\_CttsTableEntry() - Bento4-1.5.1.0

Loginsoft-2019-1101

February 13, 2019

##### CVE Number

CVE-2019-9544

##### CWE

CWE-787: Out-of-bounds Write

##### Product Details

Bento4/AP4 is a C++ class library designed to read and write ISO-MP4 files. Where Aac2Mp4 converts an AAC ADTS file into an MP4 file.**URL:**<https://github.com/axiomatic-systems/Bento4.git>

##### Vulnerable Versions

4-1.5.1.0

##### Vulnerability Details

We observed a Out of bounds write occurred in AP4\_CttsTableEntry::AP4\_CttsTableEntry() located in Ap4Array.h.The same be triggered by sending a crafted file to the mp42hls binary. It allows an attacker to cause Denial of Service (Segmentation fault) or possibly have unspecified other impact.

##### SYNOPSIS

In progress

##### Vulnerable code

```

AP4_Result result = EnsureCapacity(item_count);
if (AP4_FAILED(result)) return result;

      // construct the new items
     for (unsigned int i=m_ItemCount; i less than item_count; i++) {
               // i=0x27ae
         new ((void*)&m_Items[i]) T();
      }
     m_ItemCount = item_count;
     return AP4_SUCCESS;
 }

```

##### Analysis

Debug in Linux

GDB

```

AP4_Array::SetItemCount
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ source:/home/loginsoft/ACE/sources/himanshu_sources/Bento4/Source/C++/Core/Ap4Array.h+215 ââââ
   210      AP4_Result result = EnsureCapacity(item_count);
   211      if (AP4_FAILED(result)) return result;
   212
   213      // construct the new items
   214      for (unsigned int i=m_ItemCount; iless than item_count; i++) {
               // i=0x27ae
â  215          new ((void*)&m_Items[i]) T();
   216      }
   217      m_ItemCount = item_count;
   218      return AP4_SUCCESS;
   219  }
   220
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ threads ââââ
[#0] Id 1, Name: "mp42hls", stopped, reason: SIGSEGV
ââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ trace ââââ
[#0] 0x810429f â AP4_Array::SetItemCount(this=0x8165278, item_count=0x80000001)
[#1] 0x8103d92 â AP4_SbgpAtom::AP4_SbgpAtom(this=0x8165250, size=0x1c, version=0x0, flags=0x0, stream=@0x8159ea0)
[#2] 0x8103bf5 â AP4_SbgpAtom::Create(size=0x1c, stream=@0x8159ea0)
[#3] 0x80f59da â AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, type=0x73626770, size_32=0x1c, size_64=0x1c, atom=@0xbfffe72c)
[#4] 0x80f412a â AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, bytes_available=@0xbfffe730, atom=@0xbfffe72c)
[#5] 0x80a4cd5 â AP4_ContainerAtom::ReadChildren(this=0x815ea10, atom_factory=@0xbffff1c4, stream=@0x8159ea0, size=0x4a40)
[#6] 0x80a4a44 â AP4_ContainerAtom::AP4_ContainerAtom(this=0x815ea10, type=0x7374626c, size=0x4a48, force_64=0x0, stream=@0x8159ea0, atom_factory=@0xbffff1c4)
[#7] 0x80a47e5 â AP4_ContainerAtom::Create(type=0x7374626c, size=0x4a48, is_full=0x0, force_64=0x0, stream=@0x8159ea0, atom_factory=@0xbffff1c4)
[#8] 0x80f5bbf â AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, type=0x7374626c, size_32=0x4a48, size_64=0x4a48, atom=@0xbfffe93c)
[#9] 0x80f412a â AP4_AtomFactory::CreateAtomFromStream(this=0xbffff1c4, stream=@0x8159ea0, bytes_available=@0xbfffe940, atom=@0xbfffe93c)
âââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââââ

```

**ASAN REPORT**

```

WARNING: forcing version to 4 in order to support single file output
=================================================================
==9911==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xb4303d10 at pc 0x08187f87 bp 0xbfffd008 sp 0xbfffcff8
WRITE of size 4 at 0xb4303d10 thread T0
    #0 0x8187f86 in AP4_CttsTableEntry::AP4_CttsTableEntry() /Bento4/Source/C++/Core/Ap4CttsAtom.h:51
    #1 0x8188428 in AP4_Array::SetItemCount(unsigned int) /Bento4/Source/C++/Core/Ap4Array.h:215
    #2 0x8187441 in AP4_CttsAtom::AP4_CttsAtom(unsigned int, unsigned char, unsigned int, AP4_ByteStream&) /Bento4/Source/C++/Core/Ap4CttsAtom.cpp:79
    #3 0x81870aa in AP4_CttsAtom::Create(unsigned int, AP4_ByteStream&) /Bento4/Source/C++/Core/Ap4CttsAtom.cpp:52
    #4 0x8196e9a in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned int, unsigned int, unsigned long long, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:469
    #5 0x81950ee in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned long long&, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:231
    #6 0x80c376f in AP4_ContainerAtom::ReadChildren(AP4_AtomFactory&, AP4_ByteStream&, unsigned long long) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:194
    #7 0x80c31a1 in AP4_ContainerAtom::AP4_ContainerAtom(unsigned int, unsigned long long, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:139
    #8 0x80c2c79 in AP4_ContainerAtom::Create(unsigned int, unsigned long long, bool, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:88
    #9 0x81987d0 in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned int, unsigned int, unsigned long long, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:774
    #10 0x81950ee in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned long long&, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:231
    #11 0x80c376f in AP4_ContainerAtom::ReadChildren(AP4_AtomFactory&, AP4_ByteStream&, unsigned long long) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:194
    #12 0x80c31a1 in AP4_ContainerAtom::AP4_ContainerAtom(unsigned int, unsigned long long, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:139
    #13 0x80c2c79 in AP4_ContainerAtom::Create(unsigned int, unsigned long long, bool, bool, AP4_ByteStream&, AP4_AtomFactory&) /Bento4/Source/C++/Core/Ap4ContainerAtom.cpp:88
    #14 0x81987d0 in AP4_AtomFactory::CreateAtomFromStream(AP4_ByteStream&, unsigned int, unsigned int, unsigned long long, AP4_Atom*&) /Bento4/Source/C++/Core/Ap4AtomFactory.cpp:774
SUMMARY: AddressSanitizer: heap-buffer-overflow /Bento4/Source/C++/Core/Ap4CttsAtom.h:51 AP4_CttsTableEntry::AP4_CttsTableEntry()
Shadow bytes around the buggy address:
  0x36860750: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860760: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860770: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860780: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x36860790: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x368607a0: 00 00[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607c0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607d0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607e0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x368607f0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Heap right redzone:      fb
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack partial redzone:   f4
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
==9911==ABORTING

```

#### **Debug in windows**

```

STACK_TEXT:
004be750 000d6b2d 0074f000 00000551 00000000 Mp42Hls!AP4_CttsTableEntry::AP4_CttsTableEntry+0x11
004be76c 000d60e3 40000382 15981e17 004be928 Mp42Hls!AP4_Array::SetItemCount+0xbd
004be7bc 000d668b 00001c20 00000000 00000000 Mp42Hls!AP4_CttsAtom::AP4_CttsAtom+0xa3
004be808 000a1fb9 00001c20 00749810 1598109f Mp42Hls!AP4_CttsAtom::Create+0xab
004be934 000a08dd 00749810 63747473 00001c20 Mp42Hls!AP4_AtomFactory::CreateAtomFromStream+0x14c9
004be9e8 000ae0b9 00749810 004bea08 004bea18 Mp42Hls!AP4_AtomFactory::CreateAtomFromStream+0x26d
FAILURE_BUCKET_ID:  INVALID_POINTER_WRITE_c0000005_Mp42Hls.exe!AP4_CttsTableEntry::AP4_CttsTableEntry

BUCKET_ID:  APPLICATION_FAULT_INVALID_POINTER_WRITE_Mp42Hls!AP4_CttsTableEntry::AP4_CttsTableEntry+11

ExceptionCode: c0000005 (Access violation)
FAULTING_SOURCE_FILE:  \bento4-master\source\c++\core\ap4cttsatom.h
FAILURE_FUNCTION_NAME:  AP4_CttsTableEntry::AP4_CttsTableEntry
Registers:
eax=0074f000 ebx=7efde000 ecx=0074f000 edx=00000001 esi=004be954 edi=004be7b0
eip=000d62f1 esp=004be74c ebp=004be750 iopl=0         nv up ei pl nz na po nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010202

```

##### Tested environment

`64-bit ubuntu 16.04 LTS`

##### Proof of Concept

Windows - `mp42hls.exe --hls-version 3 --pmt-pid 0x100 --video-pid 0x102 --video-track-id 1 --segment-duration 6 --segment-duration-threshold 15 --pcr-offset 10000 --index-filename stream.m3u8 --segment-filename-template stream.mp4 --output-single-file $POC` Linux - `mp42hls --hls-version 3 --pmt-pid 0x100 --video-pid 0x102 --video-track-id 1 --segment-duration 6 --segment-duration-threshold 15 --pcr-offset 10000 --index-filename stream.m3u8 --segment-filename-template stream.mp4 --output-single-file $POC`

##### Timeline

Vendor Disclosure: 2019-2-28

Public Disclosure:2019-3-2

##### Credit

Discovered by ACE Team - [Loginsoft](https://www.loginsoft.com/)

Explore Cybersecurity Platforms

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse varius enim in eros.

Discover Lovi
## Sign up to our Newsletter

Thank you! Your submission has been received!Oops! Something went wrong while submitting the form.Cybersecurity Solutions[Vulnerability Intelligence](/vulnerability-intelligence)[Security & Threat Intelligence Integrations](/security-and-threat-intelligence-integrations)[Vulnerability & Configuration Management](/vulnerability-management-configuration)[OSS - Software Composition Analysis](/software-supply-chain-security/software-composition-analysis)[OSS - Dependancy Defence](/software-supply-chain-security/dependency-defense)[OSS - Zero-Day Discovery](/software-supply-chain-security/zero-day-discovery)[Threat Intelligence](/threat-research-and-intelligence/threat-intelligence)[External Attack Surface Discovery](/threat-research-and-intelligence/external-attack-surface-discovery)[Cloud Security Posture Management](/cloud-native-security/cloud-security-posture-management)[Cloud Workload Protection](/cloud-native-security/cloud-workload-protection-management)ITÂ Solutions[Data Science &Â AI](/data-science-and-ai)[Software Development Â & Support](/software-development-and-support)[QA Automation](/qa-automation)[Staff Augmentation](/staff-augmentation)Platforms[LOVI](/lovi)[Cytellite](/cytellite)Company[Blogs](/blogs)[Reports](/reports)[About us](/about-us)[Careers](/careers)Research[Research-as-a -Service](/research-as-a-service)[Zero-Day Discovery](/security-advisories)![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/660b22b99ceecda456b052cd_Loginsoft%20Logo%20White.svg)1-703-956-7410info@loginsoft.com[![Linkedin Icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/65b777d02956967bd81ab620_LinkedIn.svg)](https://www.linkedin.com/company/loginsoft/)[![X icon](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/65b777d0e8e8f3e5866a563b_X.svg)](https://twitter.com/Loginsoft_Inc)[![](https://cdn.prod.website-files.com/65952a9c6bd758cb3a53eebd/65b8dafdc42d3397ec72e17c_github-mark-white%201.svg)](https://github.com/Loginsoft-Research)Â© 2024 - Copyright[Privacy policy](/privacy-policy)

![](https://px.ads.linkedin.com/collect/?pid=562737&fmt=gif)


