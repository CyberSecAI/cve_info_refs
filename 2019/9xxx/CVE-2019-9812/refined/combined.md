=== Content from wiki.mozilla.org_c35f51aa_20250121_022334.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_c2a767aa_20250121_001603.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1538008)
* [XML](/show_bug.cgi?ctype=xml&id=1538008)

Closed
[Bug 1538008](/show_bug.cgi?id=1538008)
(CVE-2019-9812)

Opened 6 years ago
Closed 5 years ago

# [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)

## Categories

### (Firefox :: Sync, defect, P1)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Sync#Sync)

Sync
▾

Firefox :: Sync
Bugs and feature requests for Sync in Firefox Desktop.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Sync&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Sync&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Sync)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

blocker

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | [69+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=69%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified) |
| firefox-esr68 | [69+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=69%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=verified) |
| firefox66 | [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix) |
| firefox67 | [+](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix) |
| firefox68 | [+](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=verified) |
| firefox69 | [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr60 | 69+ | verified |
| firefox-esr68 | 69+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox66 | + | wontfix |
| firefox67 | + | wontfix |
| firefox68 | + | verified |
| firefox69 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: Alex\_Gaynor, Assigned: tjr)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/6822db445808be789b12cfae22d118dc?d=mm&size=40)  [tjr](/user_profile?user_id=578488)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=40)  [Alex\_Gaynor](/user_profile?user_id=537703)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/8a64a23302de3acb7fc99848978088ad?d=mm&size=40)  [lougenia](/user_profile?user_id=649193)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

33 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2019-11741](/show_bug.cgi?id=1539595 "VERIFIED FIXED - Consider an origin-whitelist for early site isolation for AMO and accounts.firefox.com"), [1557074](/show_bug.cgi?id=1557074 "VERIFIED FIXED - Re-Enable Mozilla Content Process Isolation"), [1557651](/show_bug.cgi?id=1557651 "RESOLVED INVALID - Apply security checks to synced addons when pulling down from the server, not just when pushing up")

[CVE-2019-11732](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"), [1578742](/show_bug.cgi?id=1578742 "VERIFIED FIXED - Ship Mozilla Content Process Isolation to Beta/Release")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[pwn2own-2019](/show_bug.cgi?id=1539818 "RESOLVED FIXED - [meta] pwn2own 2019")

Dependency [tree](/showdependencytree.cgi?id=1538008&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1538008)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-priv-escalation, csectype-sandbox-escape, sec-high, Whiteboard: [adv-main69+][adv-esr68.1+][adv-esr60.9+][do not publish until Bug 1538015 is shipped.])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2019-9812

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main69+][adv-esr68.1+][adv-esr60.9+][do not publish until Bug 1538015 is shipped.]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1538008#c0)• 6 years ago |
|  | |

# UXSS -> privesc via sync (install arbitrary extensions & set arbitrary preferences)

RCE in the Firefox renderer can be turned into UXSS via renderer patches (see

my Pwn2Own exploit).

Now login in to sync via UXSS on

<https://accounts.firefox.com/signin?service=sync&context=fx_desktop_v3&entrypoint=menupanel>

(this can probably be achieved via XPCOM but this is the easiest way to

do it). This lets you sync the victim browser with an attacker-controlled

account, leading immediately to:

1. Privesc to web extension
2. Arbitrary preference write by setting services.sync.prefs.sync.<pref> = true
   * On Linux: security.sandbox.content.level = 0 -> Boom, no sandbox!

     (on Windows + macOS we are capped at 1, but we can at least bypass the

     desktop & job lockdown)
   * browser.tabs.remote.autostart -> turning this off disables e10s, but only after a restart
   * browser.download.{dir,useDownloadDir} -> probably arbitrary file write, have not tested this
   * network.proxy.autoconfig\_url = <path to PAC file>, network.proxy.type = 2,

     This script will be evaluated in browser process, so we can chain with a

     Spidermonkey exploit (such as the one I used at Pwn2Own)

I'm sure there is other interesting settings which lead to a full sandbox escape.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a337_451704)• 6 years ago |

[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected)
[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a590_1689)• 6 years ago |

Summary: ZDI-CAN-8375 → [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a1395_434339)• 6 years ago |

Blocks: [CVE-2019-11732](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a1455_280903)• 6 years ago |

Alias: CVE-2019-9812No longer blocks: [CVE-2019-11732](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a1480_280903)• 6 years ago |

Blocks: [CVE-2019-11732](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector")

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a2218_495955)• 6 years ago |

Severity: normal → blockerPriority: -- → P1

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a2364_537703)• 6 years ago |

Component: General → SyncProduct: Core → Firefox

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a3462_451704)• 6 years ago |

[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
--- → [blocking](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=blocking)
[tracking-firefox67](/buglist.cgi?f1=cf_tracking_firefox67&o1=isnotempty):
--- → [blocking](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=blocking)
[tracking-firefox68](/buglist.cgi?f1=cf_tracking_firefox68&o1=isnotempty):
--- → [blocking](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=blocking)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a4458_537703)• 6 years ago |

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1538008#c1)• 6 years ago |
|  | |

> Arbitrary preference write by setting services.sync.prefs.sync.<pref> = true

Noting this because it wasn't obvious to me from reading the STR: when Firefox syncs prefs, it also syncs the list of prefs to sync, which is why this can be used to write to arbitrary prefs.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a6117_406194)• 6 years ago |

Group: core-security → firefox-core-security

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1538008#c2)• 6 years ago |
|  | |

Ugh. I've been trying to think of any short-term mitigations we could apply here, but haven't come up with much of anything; this is basically the different parts of Sync all working as designed.

For the "install a web extension via sync" case, the addons sync engine already has some basic checks to protect against installing things from disreputable sources, see e.g.:

<https://dxr.mozilla.org/mozilla-central/rev/b2f1edb41241d3da6ded54edf38cca1d2d08325b/services/sync/modules/engines/addons.js#619>

They wouldn't protect against installing a webextension that's available properly from AMO though. And from a glance at the code, these checks may only be applied when writing data *to* sync, not when pulling down data *from* sync, so I don't know if they would help in this case where the sync server has been filled with malicious data.

We probably have a followup here to ensure those checks apply on read instead of on write, but it's not obvious there would be any more checks we could do to prevent syncing down "bad" webextensions.

For the "arbitrary preference write via sync" case, I guess we could try to allowlist/blocklist certain classes of pref, but I'd expect a long tail of either discovering new prefs that aren't safe (if we try to blocklist) or getting bugs from users whose custom workflow we broke (if we try to allowlist). :pauljt filed [Bug 1538015](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") to dig through this in more detail.

The underlying problem here is that <https://accounts.firefox.com> has the special ability to silently sign the browser in to sync, by sending a WebChannel message of type "login". We should find a way to stop doing that, and I filed [Bug 1538024](/show_bug.cgi?id=1538024 "NEW") to investigate.

I don't know enough about the internals of the browser to know whether there are things we could do prevent that from happening in "suspicious" cases without breaking the various sync onboarding flows that rely on it. For example, I wonder if we have enough information when dispatching the WebChannel message here:

<https://dxr.mozilla.org/mozilla-central/rev/b2f1edb41241d3da6ded54edf38cca1d2d08325b/toolkit/modules/WebChannel.jsm#66>

To detect that it's coming from an iframe or other unexpected source, rather than from a top-level tab opened to accounts.firefox.com. I also don't know whether that would have helped in this case.

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1538008#c3)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1538008&comment_id=14003884 "1 revision") |
|  | |

> I wonder if we have enough information when dispatching the WebChannel message
>
> here [...] to detect that it's coming from an iframe or other unexpected source

:pauljt talked through this with me a bit, and it doesn't sound like there's much we could do here; if the child process is sufficiently compromised then it can make itself indistinguishable from a "good" login page.

I think the right path forward on the FxA front is [Bug 1538024](/show_bug.cgi?id=1538024 "NEW"), removing the ability for web content to sign the browser in to sync.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1538008#c4)• 6 years ago |
|  | |

Shouldn't opening <https://accounts.firefox.com> always to a new process help?

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1538008#c5)• 6 years ago |
|  | |

> Shouldn't opening <https://accounts.firefox.com> always to a new process help?

Yes, I believe it would, basically do "site isolation" for accounts.firefox.com (and maybe for other privileged mozilla domains).

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1538008#c6)• 6 years ago |
|  | |

Well, we should be able to do that, similarly as what we do for file:// urls (at least top level page loads).

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1538008#c7)• 6 years ago |
|  | |

I guess we'd need to simply block iframing accounts.firefox.com for the time being? Would that break anything?

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1538008#c8)• 6 years ago |
|  | |

This was a bonus vulnerability from Niklas Baumstark at pwn2own (not actually used in any entries though).

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1538008#c9)• 6 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #7](/show_bug.cgi?id=1538008#c7 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> I guess we'd need to simply block iframing accounts.firefox.com for the time being? Would that break anything?

I'm confused, what does this have to do with iframing? Any load of accounts.firefox.com in a compromised content process would be sufficient for the described attack, no?

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1538008#c10)• 6 years ago |
|  | |

Right, it's not iframing specific -- I just meant there's always two pieces: 1) loading the origin in it's own process, 2) *not* loading it in any other process :-)

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1538008#c11)• 6 years ago |
|  | |

> I guess we'd need to simply block iframing accounts.firefox.com for the time being? Would that break anything?

We used to allow certain trusted origins to iframe accounts.firefox.com (via some awful code to generate X-Frame-Options and friends on-the-fly) but I believe all those integrations have been removed. I can't think of any legitimate reason for a site to be loading accounts.firefox.com in an iframe. Shane?

Flags: needinfo?(stomlinson)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1538008#c12)• 6 years ago |
|  | |

(In reply to Ryan Kelly [:rfkelly] from [comment #11](/show_bug.cgi?id=1538008#c11 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> > I guess we'd need to simply block iframing accounts.firefox.com for the time being? Would that break anything?
>
> We used to allow certain trusted origins to iframe accounts.firefox.com (via some awful code to generate X-Frame-Options and friends on-the-fly) but I believe all those integrations have been removed. I can't think of any legitimate reason for a site to be loading accounts.firefox.com in an iframe. Shane?

Note that I expect X-FRAME-OPTIONS/CSP will not be relevant here. In a compromised child process, the attacker can subvert any security checks internal to that process, which I believe these are. (correct me if Im wrong, but I think they hang off the document object in the child process?).

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #10](/show_bug.cgi?id=1538008#c10 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> Right, it's not iframing specific -- I just meant there's always two pieces: 1) loading the origin in it's own process, 2) *not* loading it in any other process :-)

Actually I think there might be THREE things here (*cue spanish inquistion intro*) :

1. loading the origin in it's own process
2. Not loading the the origin in another process
3. Not loading ANY other web content in the Firefox accounts process

Because we have to make sure not to load untrusted content into our trusted process.

And then FOUR (*amongst our diverse weaponary...*), make sure that either our IPC model ensures that FxA privileges are ONLY granted to this blessed process. That is either done by:

* ensuring that the parent process will only listen for FxA web channel message FROM our blessed process
* adding a check in the FxA which checks the message.target to ensure it corresponds to the correct process (im not sure if this is possible though with current messaging architecture, maybe it depends on Fission pieces).

My understanding is that these privileges are provided by [FxAccountsWebChannel.jsm](https://dxr.mozilla.org/mozilla-central/source/services/fxaccounts/FxAccountsWebChannel.jsm) ( and the mobile version [here](https://searchfox.org/mozilla-central/source/mobile/android/modules/FxAccountsWebChannel.jsm)). Assuming we force isolation of accounts.firefox.com in a seperate process, we need to ensure that the parent process will only act upon FxA messages from this process.

WebChannel architecture may provides this already though? I'm not sure if the approprate listeners are only created for a process that is loading accounts.firefox.com, or if this listener is setup for every process. IE can any content process just synthesize a login message, and not worry about loading accounts.firefox.com at all?.

And finally FIVE (*...I'll come in again...*): what about things like cookies/localStorage/Indexeddb etc. Even if a process can't load accounts.firefox.com, do we actually prevent it from setting origin specific data? (I dont think we do, yet, as this is a Fission thing IIRC) From a quick check, it looks like FxA stores a bunch of data in LocalStorage, but changing it doesn't seem to affect state. So maybe this one is not a requirement, but this is an attack to consider.

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1538008#c13)• 6 years ago |
|  | |

> what about things like cookies/localStorage/Indexeddb

FxA uses localStorage to manage state for signins on the web, but offhand I can't think of a way to use read/write of localStorage for accounts.firefox.com to affect the signed-in state of the browser. I won't 100% rule it out though, there are a lot of different paths through the FxA signin flow.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1538008#c14)• 6 years ago |
|  | |

BTW in [comment 12](/show_bug.cgi?id=1538008#c12 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"), I'm focusing solve on the "isolate accounts.firefox.com" solution. Taking a step back, I think there are two high level solutions here:

* isolate accounts.firefox.com so that compromised child process
* change the security model of Sync, so that accounts.firefox.com can't change the logged in sync user. Ryan's written more along those lines in 1538024)

We might want to consider aligning the solution to 1538007, which is fundamentally the same issue (web origins which have dangerous privileges)

|  | [Shane Tomlinson [:stomlinson]](/user_profile?user_id=417707) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1538008#c15)• 6 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #0](/show_bug.cgi?id=1538008#c0 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> # UXSS -> privesc via sync (install arbitrary extensions & set arbitrary preferences)

> I'm sure there is other interesting settings which lead to a full sandbox escape.

Not a sandbox escape, but rather if a signin can be forced by an attacker, then the attacker can exfiltrate any data already saved on the device that would be synced, e.g., bookmarks and passwords.

---

(In reply to Ryan Kelly [:rfkelly] from [comment #11](/show_bug.cgi?id=1538008#c11 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> > I guess we'd need to simply block iframing accounts.firefox.com for the time being? Would that break anything?
>
> We used to allow certain trusted origins to iframe accounts.firefox.com (via some awful code to generate X-Frame-Options and friends on-the-fly) but I believe all those integrations have been removed. I can't think of any legitimate reason for a site to be loading accounts.firefox.com in an iframe. Shane?

Firefox <= 60 still uses the iframe on the firstrun page. See <https://github.com/mozilla/bedrock/issues/6837>. We can ask :agibson and team to prioritize switching to the new page.

---

(In reply to Ryan Kelly [:rfkelly] from [comment #3](/show_bug.cgi?id=1538008#c3 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> > I wonder if we have enough information when dispatching the WebChannel message
> >
> > here [...] to detect that it's coming from an iframe or other unexpected source
>
> :pauljt talked through this with me a bit, and it doesn't sound like there's much we could do here; if the child process is sufficiently compromised then it can make itself indistinguishable from a "good" login page.
>
> I think the right path forward on the FxA front is [Bug 1538024](/show_bug.cgi?id=1538024 "NEW"), removing the ability for web content to sign the browser in to sync.

As the referred to bug title says, the key is not barring web content from being part of the signin process, but rather allowing FxA to modify the signed in state of Sync "silently". If FxA is in an isolated process and WebChannel messages are sent back to a trusted process, then it seems like the trusted process should be able to show the user some UX confirming the user wants to connect to Sync as user XXX@YYY.ZZZ.

(In reply to Paul Theriault [:pauljt] from [comment #12](/show_bug.cgi?id=1538008#c12 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> (In reply to Ryan Kelly [:rfkelly] from [comment #11](/show_bug.cgi?id=1538008#c11 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))
>
> > Right, it's not iframing specific -- I just meant there's always two pieces: 1) loading the origin in it's own process, 2) *not* loading it in any other process :-)
>
> Actually I think there might be THREE things here (*cue spanish inquistion intro*) :
>
> 1. loading the origin in it's own process
> 2. Not loading the the origin in another process
> 3. Not loading ANY other web content in the Firefox accounts process

Do I understand correctly that this means only allowing connections to <https://accounts.firefox.com> from the privileged process? If so, we are going to have to undertake a re-architecture of FxA to move everything to a single domain. Currently <https://accounts.firefox.com> is only used to serve HTML and do a bit of metrics gathering. Static JS is served from a CDN at <https://accounts-static.cdn.mozilla.net>. Authentication related calls are made to <https://api.accounts.firefox.com>, OAuth related calls go to <https://oauth.accounts.firefox.com>, a user's profile is stored at <https://profile.accounts.firefox.com>, a user's profile photo is stored at <https://firefoxusercontent.com> so that invalid images cannot be used as an attack vector.

> WebChannel architecture may provides this already though? I'm not sure if the approprate listeners are only created for a process that is loading accounts.firefox.com, or if this listener is setup for every process. IE can any content process just synthesize a login message, and not worry about loading accounts.firefox.com at all?.

IIRC, WebChannel listeners are created at startup and can be sent from any page, however every WebChannel has to specify an originOrPermission from which to accept messages [1]. If a WebChannel message is sent from an unrecognized origin, it's ignored. WebChannels are created on startup to prevent race conditions in channel creation whenever a tab to <https://accounts.firefox.com> is loaded. I may have this wrong though and WebChannels are created on a per-tab basis. :markh should be able to chim in more here.

> From a quick check, it looks like FxA stores a bunch of data in LocalStorage, but changing it doesn't seem to affect state

We do store a user's session state in localStorage, for Firefox Desktop's < 55 [2] and any non-Firefox desktop browser. In Firefox Desktop >= 55, whenever FxA loads we send a WebChannel request to the browser to ask which user is signed in to Sync. If a user is signed in to Sync, then that info will be shared with FxA for subsequent signings. If no user is signed in, then we read the last signed in user from localStorage. For Firefox < 55 and any non Firefox Desktop browser, we always read a user's session state from localStorage.

We also store "verification state" in localStorage, this is used to customize the UX depending on whether a user verifies their email in the same browser in which they sign up in. For OAuth flows, the same verification info is used to help redirect the appropriate tab back to an OAuth relying party whenever a user verifies their email address.

[1] - <https://searchfox.org/mozilla-central/rev/56705678f5fc363be5e0237e1686f619b0d23009/toolkit/modules/WebChannel.jsm#155>

[2] - <https://github.com/mozilla/fxa-content-server/blob/da94f530c8b5bb7477e207944ea0c6623af2f710/app/scripts/lib/channels/web.js#L18>

Flags: needinfo?(stomlinson) → needinfo?(markh)

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1538008#c16)• 6 years ago |
|  | |

> seems like the trusted process should be able to show the user some UX confirming the user wants to connect
>
> to Sync as user XXX@YYY.ZZZ.

We may be able to take this even further, and only show the confirmation for "spontaneous" login attempts that originate from web content, while not showing it when the user is logging in via UI in the browser.

I suspect some users would just click "ok" to this warning message though.

> We do store a user's session state in localStorage [...]

Since it's not always clear to folks not steeped in how FxA works, I just want to clarify that the "we" in that last paragraph is "the web content running on accounts.firefox.com".

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1538008#c17)• 6 years ago |
|  | |

To be clear, in a site-isolation world, loading JS and other resources from other origins is totally fine, the only thing that'd be problematic is iframes, where you have different contexts code is running in.

I think the ideal outcome here would be to pursue *both* the site-isolation style special case, and also the changes to prompt if these messages come from web content. That provides us the most resillience.

|  | [Shane Tomlinson [:stomlinson]](/user_profile?user_id=417707) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1538008#c18)• 6 years ago |
|  | |

(In reply to Ryan Kelly [:rfkelly] from [comment #16](/show_bug.cgi?id=1538008#c16 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> > seems like the trusted process should be able to show the user some UX confirming the user wants to connect
> >
> > to Sync as user XXX@YYY.ZZZ.
>
> We may be able to take this even further, and only show the confirmation for "spontaneous" login attempts that originate from web content, while not showing it when the user is logging in via UI in the browser.

Your idea in [Bug 1538024](/show_bug.cgi?id=1538024 "NEW") could work well here. If we are going down the OAuth route in the long run, we could go so far as to open FxA with a state token. Pass the state token back to the browser in the `login` message, and let the browser decide what to do. I'm not sure whether that's any better than tracking principals from which a `login` message should be accepted w/o extra UI, but hey.. OAuth.

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #17](/show_bug.cgi?id=1538008#c17 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> To be clear, in a site-isolation world, loading JS and other resources from other origins is totally fine, the only thing that'd be problematic is iframes, where you have different contexts code is running in.

Great! That's much less work than I feared.

> I think the ideal outcome here would be to pursue *both* the site-isolation style special case, and also the changes to prompt if these messages come from web content. That provides us the most resillience.

cc'ing :agibson from mozilla.org to help prioritize removing the last vestiges of the iframe.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1538008#c19)• 6 years ago |
|  | |

(In reply to Shane Tomlinson [:stomlinson] from [comment #15](/show_bug.cgi?id=1538008#c15 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> IIRC, WebChannel listeners are created at startup and can be sent from any page, however every WebChannel has to specify an originOrPermission from which to accept messages [1]. If a WebChannel message is sent from an unrecognized origin, it's ignored. WebChannels are created on startup to prevent race conditions in channel creation whenever a tab to <https://accounts.firefox.com> is loaded. I may have this wrong though and WebChannels are created on a per-tab basis. :markh should be able to chim in more here.

That's completely correct.

Flags: needinfo?(markh)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a509672_537703)• 6 years ago |

Blocks: [CVE-2019-11741](/show_bug.cgi?id=1539595 "VERIFIED FIXED - Consider an origin-whitelist for early site isolation for AMO and accounts.firefox.com")

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a510961_537703)• 6 years ago |

No longer blocks: [CVE-2019-11741](/show_bug.cgi?id=1539595 "VERIFIED FIXED - Consider an origin-whitelist for early site isolation for AMO and accounts.firefox.com")Depends on: [CVE-2019-11741](/show_bug.cgi?id=1539595 "VERIFIED FIXED - Consider an origin-whitelist for early site isolation for AMO and accounts.firefox.com")

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1538008#c20)• 6 years ago |
|  | |

(In reply to Mark Hammond [:markh] from [comment #19](/show_bug.cgi?id=1538008#c19 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> (In reply to Shane Tomlinson [:stomlinson] from [comment #15](/show_bug.cgi?id=1538008#c15 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))
>
> > IIRC, WebChannel listeners are created at startup and can be sent from any page, however every WebChannel has to specify an originOrPermission from which to accept messages [1]. If a WebChannel message is sent from an unrecognized origin, it's ignored. WebChannels are created on startup to prevent race conditions in channel creation whenever a tab to <https://accounts.firefox.com> is loaded. I may have this wrong though and WebChannels are created on a per-tab basis. :markh should be able to chim in more here.
>
> That's completely correct.

So digging into the code to see how this is actually enforced, it looks like this sets up a callback ["WebChannelMessageToChrome"](https://searchfox.org/mozilla-central/rev/56705678f5fc363be5e0237e1686f619b0d23009/toolkit/modules/WebChannel.jsm#92) which compares the origin that was used for setup against `event.principal`. This is start, but event in this case is the `message` (in the messageManager sense), and `message.principal`. As far as I know, until we do something like fission, there is no way we can trust this, since the data is sent from the child ([here](https://searchfox.org/mozilla-central/source/dom/ipc/ContentParent.cpp#3967) maybe? - I might be wrong here, as I would guess webchannel is build on FrameMessageManager not process message manager, but I think its same problem in both.)

So while we do check that the message comes "<https://accounts.firefox.com>", we just check that against what the child tell us. Until we have some map in place which maps content processes to the set of origins which are supposed to be loaded in that process (which I think is 1491018).

SO for isolation to be of any effect, we either need to do that, and check that the message is coming from a process that should contain '<https://accounts.firefox.com>'. OR we need to do process isolation of the blessed loading of accounts.firefox.com, and somehow ONLY listen for `WebChannelMessageToChrome` that relate to firefox accounts on from this blessed process.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1538008#c21)• 6 years ago |
|  | |

(BTW I hope im wrong here, previously I thought the parent *was* able to trust `message.principal`, but now, looking at the code, I cant see how that is true.)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1538008#c22)• 6 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #21](/show_bug.cgi?id=1538008#c21 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> (BTW I hope im wrong here, previously I thought the parent *was* able to trust `message.principal`, but now, looking at the code, I cant see how that is true.)

Confirmed with Nika, I wasn't wrong, the child process can lie about `message.principal`.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1538008#c23)• 6 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #20](/show_bug.cgi?id=1538008#c20 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> OR we need to do process isolation of the blessed loading of accounts.firefox.com, and somehow ONLY listen for `WebChannelMessageToChrome` that relate to firefox accounts on from this blessed process.

Nika's suggestion for how we do this without [bug 1491018](/show_bug.cgi?id=1491018 "NEW - Create Authoritative 'This Origin to this Content Process' Infrastructure") was to put accounts.firefox.com into a separate process type, and just check that the message comes from the correct process type (ie these [types](https://searchfox.org/mozilla-central/source/toolkit/modules/E10SUtils.jsm#45).

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a579924_537703)• 6 years ago |

Blocks: [pwn2own-2019](/show_bug.cgi?id=1539818 "RESOLVED FIXED - [meta] pwn2own 2019")

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a590312_537703)• 6 years ago |

No longer blocks: [CVE-2019-11732](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector")Depends on: [CVE-2019-11732](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector")

|  | [Selena Deckelmann :selenamarie :selena](/user_profile?user_id=452035) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1538008#c24)• 6 years ago |
|  | |

Neha - per [comment #23](/show_bug.cgi?id=1538008#c23 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)") can your team lead decision making on what the best mitigation for this issue would be?

Flags: needinfo?(nkochar)

|  | [Neha Kochar [:neha]](/user_profile?user_id=627348) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1538008#c25)• 6 years ago |
|  | |

(In reply to Selena Deckelmann :selenamarie :selena use ni? pronoun: she from [comment #24](/show_bug.cgi?id=1538008#c24 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> Neha - per [comment #23](/show_bug.cgi?id=1538008#c23 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)") can your team lead decision making on what the best mitigation for this issue would be?

Discussed this over emails and calls and we believe putting accounts.firefox.com and addonz.mozilla.org in a content process separate from the web content is the best mitigation and this is doable by adding any remote type (like the existing types of 'web', 'file', 'extension',..). Jim's team can work on this while Nika can help with pointers, if needed.

Flags: needinfo?(nkochar)

|  | [Selena Deckelmann :selenamarie :selena](/user_profile?user_id=452035) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1538008#c26)• 6 years ago |
|  | |

Jim -- can you prioritize this work, please?

Flags: needinfo?(jmathies)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1538008#c27)• 6 years ago |
|  | |

Seems unlikely to be something we want to uplift to 66. Can we aim for 68/67 here?

[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
[blocking](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=blocking) → [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1538008#c28)• 6 years ago |
|  | |

(In reply to Liz Henry (:lizzard) (use needinfo) from [comment #27](/show_bug.cgi?id=1538008#c27 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> Seems unlikely to be something we want to uplift to 66. Can we aim for 68/67
>
> here?

We're still trying to get a feel for what's involved.

Flags: needinfo?(jmathies)

|  | [Shane Tomlinson [:stomlinson]](/user_profile?user_id=417707) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1538008#c29)• 6 years ago |
|  | |

I have opened [1] to remove all traces of iframe support in FxA. :agibson and team have opened (and merged) [2] to stop using the iframe in Bedrock. Once bedrock ships their change to prod, we can merge [1], and from our side there should be no more blockers to enabling site isolation for accounts.firefox.com

[1] - <https://github.com/mozilla/fxa/pull/773/>

[2] - <https://github.com/mozilla/bedrock/pull/7023>

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1538008#c30)• 6 years ago |
|  | |

Great. From the Firefox side we're still trying to get a handle on how much lift that would be, versus just waiting for fission down the line.

I think [bug 1538024](/show_bug.cgi?id=1538024 "NEW") is probably the next piece that we should figure out how to make into reality.

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a3341688_580382)• 6 years ago |

[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix)
[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix)
[tracking-firefox67](/buglist.cgi?f1=cf_tracking_firefox67&o1=isnotempty):
[blocking](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=blocking) → [+](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=%2B)
[tracking-firefox68](/buglist.cgi?f1=cf_tracking_firefox68&o1=isnotempty):
[blocking](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=blocking) → [+](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1538008#c31)• 6 years ago |
|  | |

Going through this bug I saw the following items that didn't have explicit followups:

From [Comment 2](/show_bug.cgi?id=1538008#c2 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"): addons.trustedSourceHostnames is used to ensure we don't install addons via sync from skethy sources... but this is a pref and can be overwritten by sync. So.... that seems bypassable. I imagine the correct fix for this is something in [Bug 1538015](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") land though.

Also from [Comment 2](/show_bug.cgi?id=1538008#c2 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"): these checks only apply on write; not when pulling data from the sync server. This seems like we should take this on as an enhancement, right Ryan?

From [Comment 13](/show_bug.cgi?id=1538008#c13 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)")/15: A malicious content process manipulating localStorage for accounts.firefox.com to affect the Sync signin process. This is the case for < 55 but otherwise seems like a remote possibility right now; but the fix for this is really over in [Bug 1484019](/show_bug.cgi?id=1484019 "NEW - [meta] Enforce Content Process Restrictions in IPC") rather than hacking on additional checks today. If we can find a specific attack vector for this though we should close it.

[Comment 15](/show_bug.cgi?id=1538008#c15 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"), 16: We could show a confirmation popup for web content-based sign-ins; even when it comes from the trusted content process. This is what [Bug 1538024](/show_bug.cgi?id=1538024 "NEW") is about.

Flags: needinfo?(rfkelly)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a6554520_1689)• 6 years ago |

Depends on: [1557074](/show_bug.cgi?id=1557074 "VERIFIED FIXED - Re-Enable Mozilla Content Process Isolation")

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a6693122_424102)• 6 years ago |

Depends on: [1557651](/show_bug.cgi?id=1557651 "RESOLVED INVALID - Apply security checks to synced addons when pulling down from the server, not just when pushing up")

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1538008#c32)• 6 years ago |
|  | |

> Also from [Comment 2](/show_bug.cgi?id=1538008#c2 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"): these checks only apply on write; not when pulling data from the sync server.
>
> This seems like we should take this on as an enhancement, right Ryan?

Yes, thanks for the reminder; I filed [Bug 1557651](/show_bug.cgi?id=1557651 "RESOLVED INVALID - Apply security checks to synced addons when pulling down from the server, not just when pushing up") to follow up on this.

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a6693197_424102)• 6 years ago |

Flags: needinfo?(rfkelly)

|  | [janet [:janet]](/user_profile?user_id=624105) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1538008#c33)• 6 years ago |
|  | |

Spoke to Tom Ritter this morning. He's going to be the assignee for this issue. The related issue: <https://bugzilla.mozilla.org/show_bug.cgi?id=1538015> is being worked on by Mark and the goal is to get it into FF69.

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a8260468_580382)• 6 years ago |

[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix)
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected)
[tracking-firefox69](/buglist.cgi?f1=cf_tracking_firefox69&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a8959279_75935)• 6 years ago |

Assignee: nobody → tom
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [69+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=69%2B)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
--- → [69+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=69%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1538008#c34)• 6 years ago |
|  | |

The fix for [Bug 1538015](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") was put into 60(68), 68, and 69. We're going to leave this bug open until [Bug 1557074](/show_bug.cgi?id=1557074 "VERIFIED FIXED - Re-Enable Mozilla Content Process Isolation") is resolved at least.

[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix) → [verified](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=verified)
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected) → [verified](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=verified)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [verified](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=verified)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
[69+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=69%2B) → ---

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a13904113_280903)• 5 years ago |

[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
--- → [69+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=69%2B)Whiteboard: [adv-main69+][adv-esr68.1+][adv-esr60.9+]

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1538008#c35)• 5 years ago |
|  | |

[Bug 1557074](/show_bug.cgi?id=1557074 "VERIFIED FIXED - Re-Enable Mozilla Content Process Isolation") is fixed in 71 now - do we wait till 71 hits release or can we close this now?

Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1538008#c36)• 5 years ago |
|  | |

(In reply to Liz Henry (:lizzard) from [comment #35](/show_bug.cgi?id=1538008#c35 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)"))

> [Bug 1557074](/show_bug.cgi?id=1557074 "VERIFIED FIXED - Re-Enable Mozilla Content Process Isolation") is fixed in 71 now - do we wait till 71 hits release or can we close this now?

While we deployed this in Nightly, it relies on a lot of in-progress Fission work and the underlying code is actually going to be swapped out soon when DocumentChannel is deployed. So we've restricted it to Nightly only at least until DocumentChannel lands. [Bug 1578742](/show_bug.cgi?id=1578742 "VERIFIED FIXED - Ship Mozilla Content Process Isolation to Beta/Release") is for shipping it out of Nightly, I've added that as a blocker.

Depends on: [1578742](/show_bug.cgi?id=1578742 "VERIFIED FIXED - Ship Mozilla Content Process Isolation to Beta/Release")Flags: needinfo?(tom)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1538008#c37)• 5 years ago |
|  | |

We're going to call this Resolved. [Bug 1578742](/show_bug.cgi?id=1578742 "VERIFIED FIXED - Ship Mozilla Content Process Isolation to Beta/Release") will significantly improve our situation here; but the vulnerability this is about was solved in [Bug 1538015](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector").

Status: NEW → RESOLVEDClosed: 5 years agoResolution: --- → FIXEDWhiteboard: [adv-main69+][adv-esr68.1+][adv-esr60.9+] → [adv-main69+][adv-esr68.1+][adv-esr60.9+][do not publish until Bug 1538015 is shipped.]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a31545395_1689)• 5 years ago |

Group: firefox-core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a38134880_1689)• 5 years ago |

Group: core-security-release

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538008#a81557683_578488)• 3 years ago |

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---)
You need to [log in](/show_bug.cgi?id=1538008&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from www.mozilla.org_7c24d70f_20250121_001607.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-27

## Security vulnerabilities fixed in Firefox ESR 60.9

Announced
September 3, 2019
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 60.9

#### [#CVE-2019-11746: Use-after-free while manipulating video](#CVE-2019-11746)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur while manipulating video elements if the body is freed while still in use. This results in a potentially exploitable crash.

##### References

* [Bug 1564449](https://bugzilla.mozilla.org/show_bug.cgi?id=1564449)

#### [#CVE-2019-11744: XSS by breaking out of title and textarea elements using innerHTML](#CVE-2019-11744)

Reporter
Rakesh Mane
Impact
high
##### Description

Some HTML elements, such as `<title>` and `<textarea>`, can contain literal angle brackets without treating them as markup. It is possible to pass a literal closing tag to `.innerHTML` on these elements, and subsequent content after that will be parsed as if it were outside the tag. This can lead to XSS if a site does not filter user input as strictly for these elements as it does for other elements.

##### References

* [Bug 1562033](https://bugzilla.mozilla.org/show_bug.cgi?id=1562033)

#### [#CVE-2019-11742: Same-origin policy violation with SVG filters and canvas to steal cross-origin images](#CVE-2019-11742)

Reporter
Paul Stone
Impact
high
##### Description

A same-origin policy violation occurs allowing the theft of cross-origin images through a combination of SVG filters and a `<canvas>` element due to an error in how same-origin policy is applied to cached image content. The resulting same-origin policy violation could allow for data theft.

##### References

* [Bug 1559715](https://bugzilla.mozilla.org/show_bug.cgi?id=1559715)

#### [#CVE-2019-11753: Privilege escalation with Mozilla Maintenance Service in custom Firefox installation location](#CVE-2019-11753)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Firefox installer allows Firefox to be installed to a custom user writable location, leaving it unprotected from manipulation by unprivileged users or malware. If the Mozilla Maintenance Service is manipulated to update this unprotected location and the updated maintenance service in the unprotected location has been altered, the altered maintenance service can run with elevated privileges during the update process due to a lack of integrity checks. This allows for privilege escalation if the executable has been replaced locally.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1574980](https://bugzilla.mozilla.org/show_bug.cgi?id=1574980)

#### [#CVE-2019-11752: Use-after-free while extracting a key value in IndexedDB](#CVE-2019-11752)

Reporter
Zhanjia Song
Impact
high
##### Description

It is possible to delete an IndexedDB key value and subsequently try to extract it during conversion. This results in a use-after-free and a potentially exploitable crash.

##### References

* [Bug 1501152](https://bugzilla.mozilla.org/show_bug.cgi?id=1501152)

#### [#CVE-2019-9812: Sandbox escape through Firefox Sync](#CVE-2019-9812)

Reporter
Niklas Baumstark via TrendMicro's Zero Day Initiative
Impact
high
##### Description

Given a compromised sandboxed content process due to a separate vulnerability, it is possible to escape that sandbox by loading `accounts.firefox.com` in that process and forcing a log-in to a malicious Firefox Sync account. Preference settings that disable the sandbox are then synchronized to the local machine and the compromised browser would restart without the sandbox if a crash is triggered.

##### References

* [Bug 1538008](https://bugzilla.mozilla.org/show_bug.cgi?id=1538008)
* [Bug 1538015](https://bugzilla.mozilla.org/show_bug.cgi?id=1538015)

#### [#CVE-2019-11743: Cross-origin access to unload event attributes](#CVE-2019-11743)

Reporter
Yoav Weiss
Impact
moderate
##### Description

Navigation events were not fully adhering to the W3C's "Navigation-Timing Level 2" draft specification in some instances for the `unload` event, which restricts access to detailed timing attributes to only be same-origin. This resulted in potential cross-origin information exposure of history through timing side-channel attacks.

##### References

* [Bug 1560495](https://bugzilla.mozilla.org/show_bug.cgi?id=1560495)
* [Navigation-Timing Level 2 specification](https://w3c.github.io/navigation-timing)

#### [#CVE-2019-11740: Memory safety bugs fixed in Firefox 69, Firefox ESR 68.1, and Firefox ESR 60.9](#CVE-2019-11740)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Tyson Smith and Nathan Froyd reported memory safety bugs present in Firefox 68, Firefox ESR 68, and Firefox 60.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 69, Firefox ESR 68.1, and Firefox ESR 60.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1563133%2C1573160)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_bc08579c_20250121_001606.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-25

## Security vulnerabilities fixed in Firefox 69

Announced
September 3, 2019
Impact
critical
Products
Firefox
Fixed in

* Firefox 69

#### [#CVE-2019-11751: Malicious code execution through command line parameters](#CVE-2019-11751)

Reporter
Ping Fan (Zetta) Ke of VXRL working with iDefense Labs
Impact
critical
##### Description

Logging-related command line parameters are not properly sanitized when Firefox is launched by another program, such as when a user clicks on malicious links in a chat application. This can be used to write a log file to an arbitrary location such as the Windows 'Startup' folder.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1572838](https://bugzilla.mozilla.org/show_bug.cgi?id=1572838)

#### [#CVE-2019-11746: Use-after-free while manipulating video](#CVE-2019-11746)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur while manipulating video elements if the body is freed while still in use. This results in a potentially exploitable crash.

##### References

* [Bug 1564449](https://bugzilla.mozilla.org/show_bug.cgi?id=1564449)

#### [#CVE-2019-11744: XSS by breaking out of title and textarea elements using innerHTML](#CVE-2019-11744)

Reporter
Rakesh Mane
Impact
high
##### Description

Some HTML elements, such as `<title>` and `<textarea>`, can contain literal angle brackets without treating them as markup. It is possible to pass a literal closing tag to `.innerHTML` on these elements, and subsequent content after that will be parsed as if it were outside the tag. This can lead to XSS if a site does not filter user input as strictly for these elements as it does for other elements.

##### References

* [Bug 1562033](https://bugzilla.mozilla.org/show_bug.cgi?id=1562033)

#### [#CVE-2019-11742: Same-origin policy violation with SVG filters and canvas to steal cross-origin images](#CVE-2019-11742)

Reporter
Paul Stone
Impact
high
##### Description

A same-origin policy violation occurs allowing the theft of cross-origin images through a combination of SVG filters and a `<canvas>` element due to an error in how same-origin policy is applied to cached image content. The resulting same-origin policy violation could allow for data theft.

##### References

* [Bug 1559715](https://bugzilla.mozilla.org/show_bug.cgi?id=1559715)

#### [#CVE-2019-11736: File manipulation and privilege escalation in Mozilla Maintenance Service](#CVE-2019-11736)

Reporter
Seb Patane
Impact
high
##### Description

The Mozilla Maintenance Service does not guard against files being hardlinked to another file in the `updates` directory, allowing for the replacement of local files, including the Maintenance Service executable, which is run with privileged access. Additionally, there was a race condition during checks for junctions and symbolic links by the Maintenance Service, allowing for potential local file and directory manipulation to be undetected in some circumstances. This allows for potential privilege escalation by a user with unprivileged local access.
*Note: These attacks requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1551913](https://bugzilla.mozilla.org/show_bug.cgi?id=1551913)
* [Bug 1552206](https://bugzilla.mozilla.org/show_bug.cgi?id=1552206)

#### [#CVE-2019-11753: Privilege escalation with Mozilla Maintenance Service in custom Firefox installation location](#CVE-2019-11753)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Firefox installer allows Firefox to be installed to a custom user writable location, leaving it unprotected from manipulation by unprivileged users or malware. If the Mozilla Maintenance Service is manipulated to update this unprotected location and the updated maintenance service in the unprotected location has been altered, the altered maintenance service can run with elevated privileges during the update process due to a lack of integrity checks. This allows for privilege escalation if the executable has been replaced locally.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1574980](https://bugzilla.mozilla.org/show_bug.cgi?id=1574980)

#### [#CVE-2019-11752: Use-after-free while extracting a key value in IndexedDB](#CVE-2019-11752)

Reporter
Zhanjia Song
Impact
high
##### Description

It is possible to delete an IndexedDB key value and subsequently try to extract it during conversion. This results in a use-after-free and a potentially exploitable crash.

##### References

* [Bug 1501152](https://bugzilla.mozilla.org/show_bug.cgi?id=1501152)

#### [#CVE-2019-9812: Sandbox escape through Firefox Sync](#CVE-2019-9812)

Reporter
Niklas Baumstark via TrendMicro's Zero Day Initiative
Impact
high
##### Description

Given a compromised sandboxed content process due to a separate vulnerability, it is possible to escape that sandbox by loading `accounts.firefox.com` in that process and forcing a log-in to a malicious Firefox Sync account. Preference settings that disable the sandbox are then synchronized to the local machine and the compromised browser would restart without the sandbox if a crash is triggered.

##### References

* [Bug 1538008](https://bugzilla.mozilla.org/show_bug.cgi?id=1538008)
* [Bug 1538015](https://bugzilla.mozilla.org/show_bug.cgi?id=1538015)

#### [#CVE-2019-11741: Isolate addons.mozilla.org and accounts.firefox.com](#CVE-2019-11741)

Reporter
Niklas Baumstark via TrendMicro's Zero Day Initiative
Impact
high
##### Description

A compromised sandboxed content process can perform a Universal Cross-site Scripting (UXSS) attack on content from any site it can cause to be loaded in the same process. Because `addons.mozilla.org` and `accounts.firefox.com` have close ties to the Firefox product, malicious manipulation of these sites within the browser can potentially be used to modify a user's Firefox configuration. These two sites will now be isolated into their own process and not allowed to be loaded in a standard content process.

##### References

* [Bug 1539595](https://bugzilla.mozilla.org/show_bug.cgi?id=1539595)

#### [#CVE-2019-11743: Cross-origin access to unload event attributes](#CVE-2019-11743)

Reporter
Yoav Weiss
Impact
moderate
##### Description

Navigation events were not fully adhering to the W3C's "Navigation-Timing Level 2" draft specification in some instances for the `unload` event, which restricts access to detailed timing attributes to only be same-origin. This resulted in potential cross-origin information exposure of history through timing side-channel attacks.

##### References

* [Bug 1560495](https://bugzilla.mozilla.org/show_bug.cgi?id=1560495)
* [Navigation-Timing Level 2 specification](https://w3c.github.io/navigation-timing)

#### [#CVE-2019-11748: Persistence of WebRTC permissions in a third party context](#CVE-2019-11748)

Reporter
Jan-Ivar Bruaroey
Impact
moderate
##### Description

WebRTC in Firefox will honor persisted permissions given to sites for access to microphone and camera resources even when in a third-party context. In light of recent high profile vulnerabilities in other software, a decision was made to no longer persist these permissions. This avoids the possibility of trusted WebRTC resources being invisibly embedded in web content and abusing permissions previously given by users. Users will now be prompted for permissions on each use.

##### References

* [Bug 1564588](https://bugzilla.mozilla.org/show_bug.cgi?id=1564588)

#### [#CVE-2019-11749: Camera information available without prompting using getUserMedia](#CVE-2019-11749)

Reporter
Andreas Pehrson
Impact
moderate
##### Description

A vulnerability exists in WebRTC where malicious web content can use probing techniques on the `getUserMedia` API using constraints to reveal device properties of cameras on the system without triggering a user prompt or notification. This allows for the potential fingerprinting of users.

##### References

* [Bug 1565374](https://bugzilla.mozilla.org/show_bug.cgi?id=1565374)

#### [#CVE-2019-5849: Out-of-bounds read in Skia](#CVE-2019-5849)

Reporter
Zhen Zhou of NSFOCUS Security Team
Impact
moderate
##### Description

An out-of-bounds read vulnerability exists in the Skia graphics library, allowing for the possible leaking of data from memory.

##### References

* [Bug 1555838](https://bugzilla.mozilla.org/show_bug.cgi?id=1555838)

#### [#CVE-2019-11750: Type confusion in Spidermonkey](#CVE-2019-11750)

Reporter
Qixun Zhao of Qihoo 360 Vulcan Team
Impact
moderate
##### Description

A type confusion vulnerability exists in Spidermonkey, which results in a non-exploitable crash.

##### References

* [Bug 1568397](https://bugzilla.mozilla.org/show_bug.cgi?id=1568397)

#### [#CVE-2019-11737: Content security policy directives ignore port and path if host is a wildcard](#CVE-2019-11737)

Reporter
Xiaoyin Liu
Impact
low
##### Description

If a wildcard ('\*') is specified for the host in Content Security Policy (CSP) directives, any port or path restriction of the directive will be ignored, leading to CSP directives not being properly applied to content.

##### References

* [Bug 1388015](https://bugzilla.mozilla.org/show_bug.cgi?id=1388015)

#### [#CVE-2019-11738: Content security policy bypass through hash-based sources in directives](#CVE-2019-11738)

Reporter
Wladimir Palant
Impact
low
##### Description

If a Content Security Policy (CSP) directive is defined that uses a hash-based source that takes the empty string as input, execution of any `javascript:` URIs will be allowed. This could allow for malicious JavaScript content to be run, bypassing CSP permissions.

##### References

* [Bug 1452037](https://bugzilla.mozilla.org/show_bug.cgi?id=1452037)

#### [#CVE-2019-11747: 'Forget about this site' removes sites from pre-loaded HSTS list](#CVE-2019-11747)

Reporter
Thomas Henlich
Impact
low
##### Description

The "Forget about this site" feature in the History pane is intended to remove all saved user data that indicates a user has visited a site. This includes removing any HTTP Strict Transport Security (HSTS) settings received from sites that use it. Due to a bug, sites on the pre-load list also have their HSTS setting removed. On the next visit to that site if the user specifies an `http:` URL rather than secure `https:` they will not be protected by the pre-loaded HSTS setting. After that visit the site's HSTS setting will be restored.

##### References

* [Bug 1564481](https://bugzilla.mozilla.org/show_bug.cgi?id=1564481)

#### [#CVE-2019-11734: Memory safety bugs fixed in Firefox 69](#CVE-2019-11734)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Randell Jesup, Philipp, Cosmin Sabou, and Natalia Csoregi reported memory safety bugs present in Firefox 68. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 69](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1352875%2C1557208%2C1560641)

#### [#CVE-2019-11758: Potentially exploitable crash due to 360 Total Security](#CVE-2019-11758)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developer Philipp reported a memory safety bug present in Firefox 68 when 360 Total Security was installed. This bug showed evidence of memory corruption in the accessibility engine and we presume that with enough effort that it could be exploited to run arbitrary code.

##### References

* [Bug 1536227](https://bugzilla.mozilla.org/show_bug.cgi?id=1536227)

#### [#CVE-2019-11735: Memory safety bugs fixed in Firefox 69 and Firefox ESR 68.1](#CVE-2019-11735)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Mikhail Gavrilov, Tyson Smith, Marcia Knous, Tom Ritter, Philipp, and Bob Owens reported memory safety bugs present in Firefox 68 and Firefox ESR 68. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 69 and Firefox ESR 68.1](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1561404%2C1561484%2C1568047%2C1561912%2C1565744%2C1568858%2C1570358)

#### [#CVE-2019-11740: Memory safety bugs fixed in Firefox 69, Firefox ESR 68.1, and Firefox ESR 60.9](#CVE-2019-11740)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Tyson Smith and Nathan Froyd reported memory safety bugs present in Firefox 68, Firefox ESR 68, and Firefox 60.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 69, Firefox ESR 68.1, and Firefox ESR 60.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1563133%2C1573160)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_52b27a00_20250121_001606.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-26

## Security vulnerabilities fixed in Firefox ESR 68.1

Announced
September 3, 2019
Impact
critical
Products
Firefox ESR
Fixed in

* Firefox ESR 68.1

#### [#CVE-2019-11751: Malicious code execution through command line parameters](#CVE-2019-11751)

Reporter
Ping Fan (Zetta) Ke of VXRL working with iDefense Labs
Impact
critical
##### Description

Logging-related command line parameters are not properly sanitized when Firefox is launched by another program, such as when a user clicks on malicious links in a chat application. This can be used to write a log file to an arbitrary location such as the Windows 'Startup' folder.
*Note: this issue only affects Firefox on Windows operating systems.*

##### References

* [Bug 1572838](https://bugzilla.mozilla.org/show_bug.cgi?id=1572838)

#### [#CVE-2019-11746: Use-after-free while manipulating video](#CVE-2019-11746)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur while manipulating video elements if the body is freed while still in use. This results in a potentially exploitable crash.

##### References

* [Bug 1564449](https://bugzilla.mozilla.org/show_bug.cgi?id=1564449)

#### [#CVE-2019-11744: XSS by breaking out of title and textarea elements using innerHTML](#CVE-2019-11744)

Reporter
Rakesh Mane
Impact
high
##### Description

Some HTML elements, such as `<title>` and `<textarea>`, can contain literal angle brackets without treating them as markup. It is possible to pass a literal closing tag to `.innerHTML` on these elements, and subsequent content after that will be parsed as if it were outside the tag. This can lead to XSS if a site does not filter user input as strictly for these elements as it does for other elements.

##### References

* [Bug 1562033](https://bugzilla.mozilla.org/show_bug.cgi?id=1562033)

#### [#CVE-2019-11742: Same-origin policy violation with SVG filters and canvas to steal cross-origin images](#CVE-2019-11742)

Reporter
Paul Stone
Impact
high
##### Description

A same-origin policy violation occurs allowing the theft of cross-origin images through a combination of SVG filters and a `<canvas>` element due to an error in how same-origin policy is applied to cached image content. The resulting same-origin policy violation could allow for data theft.

##### References

* [Bug 1559715](https://bugzilla.mozilla.org/show_bug.cgi?id=1559715)

#### [#CVE-2019-11736: File manipulation and privilege escalation in Mozilla Maintenance Service](#CVE-2019-11736)

Reporter
Seb Patane
Impact
high
##### Description

The Mozilla Maintenance Service does not guard against files being hardlinked to another file in the `updates` directory, allowing for the replacement of local files, including the Maintenance Service executable, which is run with privileged access. Additionally, there was a race condition during checks for junctions and symbolic links by the Maintenance Service, allowing for potential local file and directory manipulation to be undetected in some circumstances. This allows for potential privilege escalation by a user with unprivileged local access.
*Note: These attacks requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1551913](https://bugzilla.mozilla.org/show_bug.cgi?id=1551913)
* [Bug 1552206](https://bugzilla.mozilla.org/show_bug.cgi?id=1552206)

#### [#CVE-2019-11753: Privilege escalation with Mozilla Maintenance Service in custom Firefox installation location](#CVE-2019-11753)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

The Firefox installer allows Firefox to be installed to a custom user writable location, leaving it unprotected from manipulation by unprivileged users or malware. If the Mozilla Maintenance Service is manipulated to update this unprotected location and the updated maintenance service in the unprotected location has been altered, the altered maintenance service can run with elevated privileges during the update process due to a lack of integrity checks. This allows for privilege escalation if the executable has been replaced locally.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1574980](https://bugzilla.mozilla.org/show_bug.cgi?id=1574980)

#### [#CVE-2019-11752: Use-after-free while extracting a key value in IndexedDB](#CVE-2019-11752)

Reporter
Zhanjia Song
Impact
high
##### Description

It is possible to delete an IndexedDB key value and subsequently try to extract it during conversion. This results in a use-after-free and a potentially exploitable crash.

##### References

* [Bug 1501152](https://bugzilla.mozilla.org/show_bug.cgi?id=1501152)

#### [#CVE-2019-9812: Sandbox escape through Firefox Sync](#CVE-2019-9812)

Reporter
Niklas Baumstark via TrendMicro's Zero Day Initiative
Impact
high
##### Description

Given a compromised sandboxed content process due to a separate vulnerability, it is possible to escape that sandbox by loading `accounts.firefox.com` in that process and forcing a log-in to a malicious Firefox Sync account. Preference settings that disable the sandbox are then synchronized to the local machine and the compromised browser would restart without the sandbox if a crash is triggered.

##### References

* [Bug 1538008](https://bugzilla.mozilla.org/show_bug.cgi?id=1538008)
* [Bug 1538015](https://bugzilla.mozilla.org/show_bug.cgi?id=1538015)

#### [#CVE-2019-11743: Cross-origin access to unload event attributes](#CVE-2019-11743)

Reporter
Yoav Weiss
Impact
moderate
##### Description

Navigation events were not fully adhering to the W3C's "Navigation-Timing Level 2" draft specification in some instances for the `unload` event, which restricts access to detailed timing attributes to only be same-origin. This resulted in potential cross-origin information exposure of history through timing side-channel attacks.

##### References

* [Bug 1560495](https://bugzilla.mozilla.org/show_bug.cgi?id=1560495)
* [Navigation-Timing Level 2 specification](https://w3c.github.io/navigation-timing)

#### [#CVE-2019-11748: Persistence of WebRTC permissions in a third party context](#CVE-2019-11748)

Reporter
Jan-Ivar Bruaroey
Impact
moderate
##### Description

WebRTC in Firefox will honor persisted permissions given to sites for access to microphone and camera resources even when in a third-party context. In light of recent high profile vulnerabilities in other software, a decision was made to no longer persist these permissions. This avoids the possibility of trusted WebRTC resources being invisibly embedded in web content and abusing permissions previously given by users. Users will now be prompted for permissions on each use.

##### References

* [Bug 1564588](https://bugzilla.mozilla.org/show_bug.cgi?id=1564588)

#### [#CVE-2019-11749: Camera information available without prompting using getUserMedia](#CVE-2019-11749)

Reporter
Andreas Pehrson
Impact
moderate
##### Description

A vulnerability exists in WebRTC where malicious web content can use probing techniques on the `getUserMedia` API using constraints to reveal device properties of cameras on the system without triggering a user prompt or notification. This allows for the potential fingerprinting of users.

##### References

* [Bug 1565374](https://bugzilla.mozilla.org/show_bug.cgi?id=1565374)

#### [#CVE-2019-11750: Type confusion in Spidermonkey](#CVE-2019-11750)

Reporter
Qixun Zhao of Qihoo 360 Vulcan Team
Impact
moderate
##### Description

A type confusion vulnerability exists in Spidermonkey, which results in a non-exploitable crash.

##### References

* [Bug 1568397](https://bugzilla.mozilla.org/show_bug.cgi?id=1568397)

#### [#CVE-2019-11738: Content security policy bypass through hash-based sources in directives](#CVE-2019-11738)

Reporter
Wladimir Palant
Impact
low
##### Description

If a Content Security Policy (CSP) directive is defined that uses a hash-based source that takes the empty string as input, execution of any `javascript:` URIs will be allowed. This could allow for malicious JavaScript content to be run, bypassing CSP permissions.

##### References

* [Bug 1452037](https://bugzilla.mozilla.org/show_bug.cgi?id=1452037)

#### [#CVE-2019-11747: 'Forget about this site' removes sites from pre-loaded HSTS list](#CVE-2019-11747)

Reporter
Thomas Henlich
Impact
low
##### Description

The "Forget about this site" feature in the History pane is intended to remove all saved user data that indicates a user has visited a site. This includes removing any HTTP Strict Transport Security (HSTS) settings received from sites that use it. Due to a bug, sites on the pre-load list also have their HSTS setting removed. On the next visit to that site if the user specifies an `http:` URL rather than secure `https:` they will not be protected by the pre-loaded HSTS setting. After that visit the site's HSTS setting will be restored.

##### References

* [Bug 1564481](https://bugzilla.mozilla.org/show_bug.cgi?id=1564481)

#### [#CVE-2019-11735: Memory safety bugs fixed in Firefox 69 and Firefox ESR 68.1](#CVE-2019-11735)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Mikhail Gavrilov, Tyson Smith, Marcia Knous, Tom Ritter, Philipp, and Bob Owens reported memory safety bugs present in Firefox 68 and Firefox ESR 68. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 69 and Firefox ESR 68.1](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1561404%2C1561484%2C1568047%2C1561912%2C1565744%2C1568858%2C1570358)

#### [#CVE-2019-11740: Memory safety bugs fixed in Firefox 69, Firefox ESR 68.1, and Firefox ESR 60.9](#CVE-2019-11740)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Tyson Smith and Nathan Froyd reported memory safety bugs present in Firefox 68, Firefox ESR 68, and Firefox 60.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 69, Firefox ESR 68.1, and Firefox ESR 60.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1563133%2C1573160)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_31ea2af7_20250121_022333.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1501152)
* [XML](/show_bug.cgi?ctype=xml&id=1501152)

Closed
[Bug 1501152](/show_bug.cgi?id=1501152)
(CVE-2019-11752)

Opened 6 years ago
Closed 5 years ago

# Use after free in KeyPath::ExtractKey

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Use after free in KeyPath::ExtractKey

## Categories

### (Core :: Storage: IndexedDB, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Storage%3A%20IndexedDB#Storage%3A%20IndexedDB)

Storage: IndexedDB
▾

Core :: Storage: IndexedDB
[IndexedDB](https://w3c.github.io/IndexedDB/) implementation, exposed through self.indexedDB.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Storage%3A%20IndexedDB)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

65 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla70

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | [69+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=69%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified) |
| firefox-esr68 | [69+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=69%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=verified) |
| firefox65 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=wontfix) |
| firefox66 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix) |
| firefox67 | [-](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix) |
| firefox68 | [+](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix) |
| firefox69 | [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=verified) |
| firefox70 | [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 | 69+ | verified |
| firefox-esr68 | 69+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox65 |  | wontfix |
| firefox66 |  | wontfix |
| firefox67 | - | wontfix |
| firefox68 | + | wontfix |
| firefox69 | + | verified |
| firefox70 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: zhanjiasong45, Assigned: ytausky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ce4b8df294aef146c65ea1a5a2fca66c?d=mm&size=40)  [ytausky](/user_profile?user_id=621888)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/3c10788660c0b5ff64ab9183c51c1882?d=mm&size=40)  [zhanjiasong45](/user_profile?user_id=615701)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

25 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1554989](/show_bug.cgi?id=1554989 "RESOLVED FIXED - Inheriting constructors whose inherited constructors are implicit are always rejected")

[1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1501152&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1501152)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form][fixed in bug 1544750][post-critsmash-triage][adv-main69+][adv-esr68.1+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2019-11752

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form][fixed in bug 1544750][post-critsmash-triage][adv-main69+][adv-esr68.1+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a26570886_1689 "6 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (8 files, 2 obsolete files)

| [FireFox\_IndexedDB\_UAF3.html](/attachment.cgi?id=9019240)  [6 years ago](#c0)  [zhanjiasong45](/user_profile?user_id=615701)   1.10 KB, text/html |  | [Details](/attachment.cgi?id=9019240&action=edit) |
| --- | --- | --- |
| [ASan.txt](/attachment.cgi?id=9019241)  [6 years ago](#c1)  [zhanjiasong45](/user_profile?user_id=615701)   27.15 KB, text/plain |  | [Details](/attachment.cgi?id=9019241&action=edit) |
| [patch for spidermonkey](/attachment.cgi?id=9023990)  [6 years ago](#c11)  [Jan Varga [:janv]](/user_profile?user_id=8340)   2.26 KB, patch | tcampbell : [review-](#c17 "6 years ago") | [Details](/attachment.cgi?id=9023990&action=edit) | [Diff](/attachment.cgi?id=9023990&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023990) |
| [patch for indexeddb](/attachment.cgi?id=9023991)  [6 years ago](#c12)  [Jan Varga [:janv]](/user_profile?user_id=8340)   17.93 KB, patch | asuth : [review+](#c13 "6 years ago") | [Details](/attachment.cgi?id=9023991&action=edit) | [Diff](/attachment.cgi?id=9023991&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023991) |
| [Bug 1501152 - Have a function to get elements from JS array;](/attachment.cgi?id=9078768)  [6 years ago](#c38)  [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9078768&action=edit) | [Review](/attachment.cgi?id=9078768) |
| [Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell](/attachment.cgi?id=9087003)  [5 years ago](#c53)  [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)   47 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c58 "5 years ago")  abillings : [sec-approval+](#c60 "5 years ago") | [Details](/attachment.cgi?id=9087003&action=edit) | [Review](/attachment.cgi?id=9087003) |
| [Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell](/attachment.cgi?id=9087298)  [5 years ago](#c54)  [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)   47 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr68+](#c63 "5 years ago") | [Details](/attachment.cgi?id=9087298&action=edit) | [Review](/attachment.cgi?id=9087298) |
| [Bug 1554989 - Fix implicit checker on inheriting constructors r=andi](/attachment.cgi?id=9088091)  [5 years ago](#c67)  [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)   47 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9088091&action=edit) | [Review](/attachment.cgi?id=9088091) |
| [patch for esr60](/attachment.cgi?id=9089466)  [5 years ago](#c74)  [Julien Cristau [:jcristau]](/user_profile?user_id=580382)   44.34 KB, patch | asuth : [feedback+](#c75 "5 years ago")  jcristau : [approval-mozilla-esr60+](#c78 "5 years ago") | [Details](/attachment.cgi?id=9089466&action=edit) | [Diff](/attachment.cgi?id=9089466&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9089466) |
| [Matcher fix](/attachment.cgi?id=9089512)  [5 years ago](#c76)  [Jan Varga [:janv]](/user_profile?user_id=8340)   2.10 KB, patch |  | [Details](/attachment.cgi?id=9089512&action=edit) | [Diff](/attachment.cgi?id=9089512&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9089512) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [zhanjiasong45](/user_profile?user_id=615701)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1501152#c0)• 6 years ago |
|  | |

Attached file
[FireFox\_IndexedDB\_UAF3.html](attachment.cgi?id=9019240)
— [Details](attachment.cgi?id=9019240&action=edit)

nsresult
KeyPath::ExtractKey(JSContext\* aCx, const JS::Value& aValue, Key& aKey) const
{
uint32\_t len = mStrings.Length();
JS::Rooted<JS::Value> value(aCx);
aKey.Unset();
for (uint32\_t i = 0; i < len; ++i) {
nsresult rv = GetJSValFromKeyPathString(aCx, aValue, mStrings[i],
value.address(),
DoNotCreateProperties, nullptr,
nullptr);
if (NS\_FAILED(rv)) {
return rv;
}
if (NS\_FAILED(aKey.AppendItem(aCx, IsArray() && i == 0, value))) { // aKey.AppendItem can execute js getter (AppendItem => EncodeJSVal => EncodeJSValInternal => JS\_GetElement)
NS\_ASSERTION(aKey.IsUnset(), "Encoding error should unset");
return NS\_ERROR\_DOM\_INDEXEDDB\_DATA\_ERR;
}
}
aKey.FinishArray();
return NS\_OK;
}
aKey.AppendItem can execute js getter, call deleteIndex in the getter will cause UAF.Flags: sec-bounty?

|  | [zhanjiasong45](/user_profile?user_id=615701)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a58_615701)• 6 years ago |

Version: unspecified → 65 Branch

|  | [zhanjiasong45](/user_profile?user_id=615701)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1501152#c1)• 6 years ago |
|  | |

Attached file
[ASan.txt](attachment.cgi?id=9019241)
— [Details](attachment.cgi?id=9019241&action=edit)

test with [https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Firefox\_and\_Address\_Sanitizer,65.0a1](https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Firefox_and_Address_Sanitizer%2C65.0a1) (2018-10-22) (64-bit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1501152#c2)• 6 years ago |
|  | |

Jan/Andrew, can you look at this or redirect to the right person? Thank you!Group: firefox-core-security → dom-core-securityComponent: Security → DOM: IndexedDBFlags: needinfo?(jvarga)Flags: needinfo?(bugmail)Product: Firefox → Core

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1501152#c3)• 6 years ago |
|  | |

We fixed this by cloning the object before calling ExtractKey. However, there may be still some corner cases.Assignee: nobody → jvargaFlags: needinfo?(jvarga)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1501152#c4)• 6 years ago |
|  | |

So, restating my understanding, the issue is now that when we are encoding a value into the key (which has a custom encoding mechanism) we have special handling for JS Arrays. At <https://searchfox.org/mozilla-central/rev/fcfb479e6ff63aea017d063faa17877ff750b4e5/dom/indexedDB/Key.cpp#265> we manually traverse the array using JS\_GetElement. This is impacted by the prototype chain because we don't do any "own" magic and we lose. And because we didn't make deleteIndex() throw when there's an IDB operation on the stack, we have a use-after-free.
Xray wrappers thoughts on the subject are found in the comment above the Array special-case here:
<https://searchfox.org/mozilla-central/rev/fcfb479e6ff63aea017d063faa17877ff750b4e5/js/xpconnect/wrappers/XrayWrapper.cpp#536>
It looks like this is the only dangerous call for encoding given that JS\_GetArrayLength has already checked the internal class of the object and so it should not reach the dangerous GetProperty call at <https://searchfox.org/mozilla-central/rev/fcfb479e6ff63aea017d063faa17877ff750b4e5/js/src/builtin/Array.cpp#142> but let's involve :sfink because maybe he wants to write a bunch of cool static analyses that can help C++ code ensure that it's not triggering content-controlled JS when it doesn't want to.
:sfink, for extra context, I suggest reading the comment at <https://searchfox.org/mozilla-central/source/dom/indexedDB/Key.cpp#33> which describes how IndexedDB cleverly encodes the keys defined by the spec at <https://www.w3.org/TR/IndexedDB/#key-construct>. We cleverly encode the keys into a binary representation so SQLite can just do its binary comparison thing without us needing to provide a custom collation function. (Structured Clone can't do that for us... yet... ;)Flags: needinfo?(bugmail) → needinfo?(sphink)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a220979_486634)• 6 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a221333_451704)• 6 years ago |

[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=%3F)

|  | [Tyson Smith [:tsmith] (PTO)](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a224052_486634)• 6 years ago |

Status: UNCONFIRMED → NEW
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected)Ever confirmed: true

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a823086_359004)• 6 years ago |

Flags: needinfo?(sphink)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1501152#c5)• 6 years ago |
|  | |

Oops, I didn't mean to un-needinfo myself.Flags: needinfo?(sphink)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1501152#c6)• 6 years ago |
|  | |

This really ought to be caught by the static rooting hazard analysis. It currently is not.
aValue is kept live across GC calls: it's live upon entry, live across both GC calls GetJSValFromKeyPathString() and AppendItem() during the first iteration of the loop, and then consumed at the top of the second iteration. It's not reported by the analysis because the analysis sees const Value& as Value\*, and that's a pointer to a pointer encoded in a Value. Pointers to pointers don't get invalidated by GC. It \*should\* be reported as a warning in the caller, but it won't because of [bug 1497593](/show_bug.cgi?id=1497593 "NEW") (not that we're good about warnings.)
(In reply to Jan Varga [:janv] from [comment #3](/show_bug.cgi?id=1501152#c3 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey"))
> We fixed this by cloning the object before calling ExtractKey. However,
> there may be still some corner cases.
That would fix the problem where the getter removes the value or some property of it, but cloning by itself wouldn't solve the rooting problem. But I see that it's done with ValueWrapper, which contains mValue in a Rooted, so that fixes the rooting hazard.
This bug makes me think that perhaps [bug 1497593](/show_bug.cgi?id=1497593 "NEW") is not enough; that would only produce warnings in the caller that we would almost certainly ignore. (We periodically sweep through those looking for real problems, but rarely.) Conceptually, this passing of a const Value& ought to be analyzed as if we were passing a plain Value. We're only passing by reference because (1) alignment constraints make passing by value problematic, and (2) it is more efficient on 32-bit (though I'm not wholly convinced that's really true, but it makes life easier on the JIT so I won't argue.)
Then again, if I \*did\* make this change to the analysis, it would turn this case into a false positive. But it really does smell like a problem if you only look at it locally. What would be better, and would survive the intended analysis change, would be if ExtractKey took a Handle<JS::Value> instead of a const Value&. I think that should just work, since ValueWrapper hands out its Value as a Rooted<Value>&. Which, by the way, is kind of weird -- I would prefer that to be returning a Handle<Value> instead.Flags: needinfo?(sphink)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1501152#c7)• 6 years ago |
|  | |

Filed [bug 1504075](/show_bug.cgi?id=1504075 "NEW") for treating const Value& as a GC pointer.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1501152#c8)• 6 years ago |
|  | |

It seems, we can just replace:
if (!JS\_GetElement(aCx, obj, index, &val)) {
IDB\_REPORT\_INTERNAL\_ERR();
return NS\_ERROR\_DOM\_INDEXEDDB\_UNKNOWN\_ERR;
}
with:
JS::RootedId id(aCx);
if (!JS\_IndexToId(aCx, index, &id)) {
IDB\_REPORT\_INTERNAL\_ERR();
return NS\_ERROR\_DOM\_INDEXEDDB\_UNKNOWN\_ERR;
}
JS::Rooted<JS::PropertyDescriptor> desc(aCx);
if (!JS\_GetOwnPropertyDescriptorById(aCx, obj, id, &desc)) {
IDB\_REPORT\_INTERNAL\_ERR();
return NS\_ERROR\_DOM\_INDEXEDDB\_UNKNOWN\_ERR;
}
if (!desc.object()) {
return NS\_ERROR\_DOM\_INDEXEDDB\_DATA\_ERR;
}
I'll submit a patch once I finish testing.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1501152#c9)• 6 years ago |
|  | |

I have a patch and all tests pass except key-conversion-exceptions.htm, trying to fix that.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1501152#c10)• 6 years ago |
|  | |

testing on try:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=c29d5448a8a63b464e04680b0be7894cf59bc753>

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1501152#c11)• 6 years ago |
|  | |

Attached patch

[patch for spidermonkey](attachment.cgi?id=9023990&action=diff)
— [Details](attachment.cgi?id=9023990&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023990)

Maybe there's a better way (more efficient), but this works good enough.
[Attachment #9023990](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") -
Flags: review?(jwalden+bmo)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1501152#c12)• 6 years ago |
|  | |

Attached patch

[patch for indexeddb](attachment.cgi?id=9023991&action=diff)
— [Details](attachment.cgi?id=9023991&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023991)

Andrew, I checked if JS\_GetArrayLength() and I believe it's safe. This JS code:
arr1.\_\_proto\_\_.\_\_defineGetter\_\_("length", function() {
objectStore.deleteIndex("index\_name");
return "ID\_002";
});
doesn't work, because the "length" property is not configurable.
However, the patch is a bit more complicated because of testing/web-platform/tests/IndexedDB/key-conversion-exceptions.htm
I had to add the aCallGetters argument all over to make this test pass.
[Attachment #9023991](/attachment.cgi?id=9023991&action=edit "patch for indexeddb") -
Flags: review?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1501152#c13)• 6 years ago |
|  | |

Comment on [attachment 9023991](/attachment.cgi?id=9023991 "patch for indexeddb") [[details]](/attachment.cgi?id=9023991&action=edit "patch for indexeddb") [[diff]](/attachment.cgi?id=9023991&action=diff "patch for indexeddb") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023991)
patch for indexeddb
Review of [attachment 9023991](/attachment.cgi?id=9023991 "patch for indexeddb") [[details]](/attachment.cgi?id=9023991&action=edit "patch for indexeddb") [[diff]](/attachment.cgi?id=9023991&action=diff "patch for indexeddb") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023991):
-----------------------------------------------------------------
Looks great! (And I'm glad you put the helper method in JS space so it can be used by all!)
Restating:
- The semantics for IDB and getters is that we want to evaluate a getter at most once when there's a getter involved \*per argument\*. The spec is aware of the impact of this and so has specified that the structured clone algorithm be invoked in the cases where multiple traversals that could trigger. For efficiency reasons, we somewhat complicate this so that add()/put()/update() do not need to perform a wasteful clone when out-of-line keys are used.
- Accordingly, the basic invariants we are trying to maintain are:
- We never call getters when we're building the key from an already-evaluated value. We require that the arrays are raw, actual arrays/whatever, not crazy getter things.
- We do not call getters on a cloned value, AKA: (aCallGetters == !valueWrapper.mCloned)
- We make at most one of the following invocations per value from content (which may mean multiples calls for multiple values in the case of IDBKeyRange, and both the value and the out-of-line key when out-of-line keys are in use): blah(...aCallGetters==true), valueWrapper.Clone().
- GetAddInfo is the interesting case because the state of ValueWrapper.mCloned can vary, and in the case where mCloned is not expected to be true at entry because we currently allow createIndex/deleteIndex to be invoked by re-entrant code and the evaluation of the out-of-line key and the value BOTH can trigger getters, whether mCloned will be invoked can change!
::: dom/indexedDB/IDBCursor.cpp
@@ +727,5 @@
>
> + aRv = keyPath.ExtractKey(aCx,
> + valueWrapper.Value(),
> + key,
> + /\* aCallGetters \*/ false);
(This is right because this is the payload value and we cloned it above so we don't call getters because they've already been called.)
::: dom/indexedDB/IDBObjectStore.cpp
@@ +1554,5 @@
> nsresult rv;
>
> if (!HasValidKeyPath()) {
> // Out-of-line keys must be passed in.
> + rv = aKey.SetFromJSVal(aCx, aKeyVal, /\* aCallGetters \*/ true);
(This is right because the out-of-line key should be evaluated with getters invoked because the out-of-line key is logically distinct from the payload value.)
@@ +1566,5 @@
>
> + rv = GetKeyPath().ExtractKey(aCx,
> + aValueWrapper.Value(),
> + aKey,
> + /\* aCallGetters \*/ false);
(This is right because this is the payload value and we just ensured we cloned it.)
@@ +1622,5 @@
> aValueWrapper.Value(),
> aKey,
> &GetAddInfoCallback,
> + &data,
> + /\* aCallGetters \*/ false);
(This is right because this is the payload value and we just ensured we cloned it.)
[Attachment #9023991](/attachment.cgi?id=9023991&action=edit "patch for indexeddb") -
Flags: review?(bugmail) → review+

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1501152#c14)• 6 years ago |
|  | |

Waldo, can you take a look at the spidermonkey patch ?Flags: needinfo?(jwalden+bmo)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a2473346_8340)• 6 years ago |

Flags: needinfo?(jwalden+bmo)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1501152#c15)• 6 years ago |
|  | |

Comment on [attachment 9023990](/attachment.cgi?id=9023990 "patch for spidermonkey") [[details]](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") [[diff]](/attachment.cgi?id=9023990&action=diff "patch for spidermonkey") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023990)
patch for spidermonkey
I was told Waldo is super busy.
[Attachment #9023990](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") -
Flags: review?(jwalden+bmo) → review?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1501152#c16)• 6 years ago |
|  | |

Comment on [attachment 9023990](/attachment.cgi?id=9023990 "patch for spidermonkey") [[details]](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") [[diff]](/attachment.cgi?id=9023990&action=diff "patch for spidermonkey") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023990)
patch for spidermonkey
Review of [attachment 9023990](/attachment.cgi?id=9023990 "patch for spidermonkey") [[details]](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") [[diff]](/attachment.cgi?id=9023990&action=diff "patch for spidermonkey") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023990):
-----------------------------------------------------------------
This patch looks fine, as far as the code goes. But (being unfamiliar with IndexedDB) the API looks a bit like a wrong thing to want.
I'm out of the office Wednesday through Friday, so I'm forwarding this review to tcampbell; or maybe sfink will chime in.
::: js/src/jsapi.cpp
@@ +2107,5 @@
> + return false;
> + }
> +
> + if (desc.object()) {
> + vp.set(desc.value());
Style nit: Please write
if (desc.object() && desc.isDataDescriptor()) {
instead of
if (desc.object()) {
[Attachment #9023990](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") -
Flags: review?(jorendorff) → review?(tcampbell)

|  | [Ted Campbell [:tcampbell]](/user_profile?user_id=586681) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1501152#c17)• 6 years ago |
|  | |

Comment on [attachment 9023990](/attachment.cgi?id=9023990 "patch for spidermonkey") [[details]](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") [[diff]](/attachment.cgi?id=9023990&action=diff "patch for spidermonkey") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023990)
patch for spidermonkey
Review of [attachment 9023990](/attachment.cgi?id=9023990 "patch for spidermonkey") [[details]](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") [[diff]](/attachment.cgi?id=9023990&action=diff "patch for spidermonkey") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023990):
-----------------------------------------------------------------
Unfortunately |GetOwnElement| is not a general purpose API. Depending on context one should prefer JS\_GetElement/JS\_GetProperty family or the GetOwnPropertyDescriptor family of APIs and avoid any sort of hybrid. I think for your case here you should continue to directly call GetOwnPropertyDescriptor and be explicit. Note that GetOwnPropertyDescriptor may still invoke arbitrary code if the object is a property.
If you explicitly check JS\_IsArrayObject before calling GetOwnPropertyDescriptor\* then you should be in safe territory. We can arrange a chat is at all-hands with some JS people to give some guidance on how IndexedDB code should in general interact with SpiderMonkey.
[Attachment #9023990](/attachment.cgi?id=9023990&action=edit "patch for spidermonkey") -
Flags: review?(tcampbell) → review-

|  | [Ted Campbell [:tcampbell]](/user_profile?user_id=586681) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1501152#c18)• 6 years ago |
|  | |

Comment on [attachment 9023991](/attachment.cgi?id=9023991 "patch for indexeddb") [[details]](/attachment.cgi?id=9023991&action=edit "patch for indexeddb") [[diff]](/attachment.cgi?id=9023991&action=diff "patch for indexeddb") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023991)
patch for indexeddb
Review of [attachment 9023991](/attachment.cgi?id=9023991 "patch for indexeddb") [[details]](/attachment.cgi?id=9023991&action=edit "patch for indexeddb") [[diff]](/attachment.cgi?id=9023991&action=diff "patch for indexeddb") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9023991):
-----------------------------------------------------------------
::: dom/indexedDB/IDBObjectStore.cpp
@@ +1075,5 @@
> }
>
> for (uint32\_t arrayIndex = 0; arrayIndex < arrayLength; arrayIndex++) {
> JS::Rooted<JS::Value> arrayItem(aCx);
> + if (NS\_WARN\_IF(!JS\_GetOwnElement(aCx, array, arrayIndex, &arrayItem))) {
Instead, you probably want a helper function that asserts array is JS\_IsArrayObject, then use JS\_GetOwnPropertyDescriptorById. The helper should probably have a comment explaining why undefined is a the appropriate result to use for a non-data PropertyDescriptor.
::: dom/indexedDB/Key.cpp
@@ +265,5 @@
>
> for (uint32\_t index = 0; index < length; index++) {
> JS::Rooted<JS::Value> val(aCx);
> + bool ok = aCallGetters ? JS\_GetElement(aCx, obj, index, &val)
> + : JS\_GetOwnElement(aCx, obj, index, &val);
I wonder if |aCanCallGetters| is a better description of what this represents.

|  | [Ted Campbell [:tcampbell]](/user_profile?user_id=586681) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1501152#c19)• 6 years ago |
|  | |

One part that isn't clear to me when I look at this code versus the spec is..
<https://www.w3.org/TR/IndexedDB/#convert-a-value-to-a-key> -> IsArray -> Step 5.1
The property must be checked by HasOwnProperty or return invalid so the prototype chain should never be involved.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1501152#c20)• 6 years ago |
|  | |

(In reply to Ted Campbell [:tcampbell] from [comment #19](/show_bug.cgi?id=1501152#c19 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey"))
> One part that isn't clear to me when I look at this code versus the spec is..
>
> <https://www.w3.org/TR/IndexedDB/#convert-a-value-to-a-key> -> IsArray -> Step
> 5.1
>
> The property must be checked by HasOwnProperty or return invalid so the
> prototype chain should never be involved.
You mean that there shouldn't be aCanCallGetters and just always avoid searching the prototype chain ?
Well, there is a wpt test - testing/web-platform/tests/IndexedDB/key-conversion-exceptions.htm and that proofs that sometimes we need to search the prototype chain.
You may want to look at [comment 12](/show_bug.cgi?id=1501152#c12 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey") and [comment 13](/show_bug.cgi?id=1501152#c13 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey").
I don't know maybe the spec should be updated or the test fixed, but the patch should be safe because we don't allow calling getters for values logically distinct from the payload value.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1501152#c21)• 6 years ago |
|  | |

Thanks for the eagle eyes on the spec, Ted! I absolutely missed that, as was probably clear from my explicitly stating in vidyo that I thought we needed to have the same side-effect semantics as structured clone for key evaluation of out-of-line keys.
(In reply to Jan Varga [:janv] from [comment #20](/show_bug.cgi?id=1501152#c20 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey"))
> Well, there is a wpt test -
> testing/web-platform/tests/IndexedDB/key-conversion-exceptions.htm and that
> proofs that sometimes we need to search the prototype chain.
I think the test is wrong. "Convert a value to a key" is very explicit. That getter should never be invoked. DataCloneError should be thrown. I suggest we change the WPT test to be correct, citing the spec.

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1501152#c22)• 6 years ago |
|  | |

(In reply to Andrew Sutherland [:asuth] from [comment #21](/show_bug.cgi?id=1501152#c21 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey"))
> I think the test is wrong. "Convert a value to a key" is very explicit.
> That getter should never be invoked. DataCloneError should be thrown. I
> suggest we change the WPT test to be correct, citing the spec.
Note, I was wrong here. After talking with Ted it turns out I missed that the test is defining a property on the test object, not the Object prototype. So HasOwnProperty will pass, and the getter will be invoked and explode with its custom exception. So the test is legit. And then there are some other nuances that Ted is writing up for our benefit that we'll receive via email soon! I just wanted to update the bug before this falls out of my brain, or in case other people reading the bug get misled.

|  | [Ted Campbell [:tcampbell]](/user_profile?user_id=586681) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1501152#c23)• 6 years ago |
|  | |

Jan, I'm organizing a few notes to try and motivate some of the subtlety here. For this bug, I think having leaving jsapi.h alone is best. We should use JS\_GetOwnPropertyDescriptorById in the code for the |aCanCallGetters| case, but please include |MOZ\_ASSERT(JS\_IsArrayObject(...))| check for documentation.
The JS teams experience with algorithms like <https://www.w3.org/TR/IndexedDB/#convert-a-value-to-a-key> is to go step by step tracking the spec as comments, and if there are optimizations to justify why they are valid. See <https://searchfox.org/mozilla-central/rev/55895c49f55073d82d977cb74ec1d3a71ae4b25f/js/src/builtin/Stream.cpp#753> for an example of the detailed steps.
For this bug, I think we can focus on the sec issue by preventing the getter from being called in the specific case. I can help review a helper method (put in indexeddb) that uses JS\_GetOwnPropertyDescriptorById to avoid calling getters and combines the HasOwnProperty and Get steps from the spec.

|  | [Ted Campbell [:tcampbell]](/user_profile?user_id=586681) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1501152#c24)• 6 years ago |
|  | |

Something vaguely like so we can be explicit about not handling getters and about why HasOwnProperty itself isn't triggering code.
> MOZ\_ASSERT(JS\_IsArrayObject(input));
>
> // 1. Let hop = ? HasOwnProperty(input, index)
> // NOTE: Array uses OrdinaryGetOwnProperty so we can get the descriptor
> // directly.
> Rooted<PropertyDescriptor> desc(cx);
> Rooted<jsid> id(cx, INT\_TO\_JSID(index));
> JS\_GetPropertyDescriptorById(cx, input, id, &desc);
>
> // 2. If hop is false, return invalid.
> if (!desc.object()) {
> return invalid;
> }
>
> // 3. Let entry be ? Get(input, index)
> if (!desc.isDataDescriptor()) {
> // Has a getter
> ???
> // Note, if you wanted to evaluate the getter, you'd call
> // JS\_GetElement. This won't have any issues with the
> // JS\_GetPropertyDescriptById call above.
> }
>
> // The array element
> Rooted<Value> elem(cx, desc.value());

|  | [Andrew Overholt [:overholt]](/user_profile?user_id=442218) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a7471314_442218)• 6 years ago |

Priority: -- → P2

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1501152#c25)• 6 years ago |
|  | |

Any change you can look at this again, Jan? Thanks.

Flags: needinfo?(jvarga)

|  | [zhanjiasong45](/user_profile?user_id=615701)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1501152#c26)• 6 years ago |
|  | |

Is this bug fixed? I wonder when can I disclose it.

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1501152#c27)• 6 years ago |
|  | |

We'd appreciate if you hold off disclosure until the bug is fixed, as I just learned that a fix for this is imminent.

Thank you for reporting the bug and for your patience so far.

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1501152#c28)• 6 years ago |
|  | |

I'll take this over.

First thing, I'll try to refactor the code to be more similar to the spec's control flow and add corresponding excerpts (probably under a different bug number, since it shouldn't look too suspicious). Then I'll fix the wrong JS object accesses here, and finally, see if there's a way to avoid creating a cloned JS object while still maintaining the correctness of the whole thing. I suspect that by weaving key path traversal into the serialization code this would be possible, but let's only do that once correctness and safety are established.

Assignee: jvarga → ytauskyStatus: NEW → ASSIGNED

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1501152#c29)• 6 years ago |
|  | |

FWIW, I did propose weaving key path traversal into the serialization, but it added a lot of complexity and potentially required performance-hindering alterations to the JS engine's structured clone logic.

(Specifically, if there was a mechanism for something to listen to the the serialization process, say using the visitor idiom, it could maintain an understanding of the current "path" and capture values at the right path points. Where capturing values could entail listening to further nested traversal. However, I believe I was erroneously assuming that the existing structured clone ops already provided the visibility we needed. I believe reality is that the hooks are not called during normal plain object serialization, and so would need to be made more generic. This was deemed undesirable for complexity reasons and because structured cloning is generally performance-sensitive.)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1501152#c30)• 6 years ago |
|  | |

Yeah, let's fix it first and then check the performance implications.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1501152#c31)• 6 years ago |
|  | |

This security vulnerability affects ESR-60 as well.

[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=wontfix)
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=wontfix)
[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=affected)
[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[tracking-firefox67](/buglist.cgi?f1=cf_tracking_firefox67&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=%2B)
[tracking-firefox68](/buglist.cgi?f1=cf_tracking_firefox68&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=%2B)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [67+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=67%2B)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a14015557_8340)• 6 years ago |

Flags: needinfo?(jvarga)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1501152#c32)• 6 years ago |
|  | |

Small update: I'm still working on this; making control flow as close as possible to the spec without touching the lower-level implementation details is a little tricky here.

We would probably need to consider more hooks into the structured clone algorithm, though. It seems to be used as a basic building block for optimization-ripe spec operations. There are ways to mitigate potential performance problems for non-specialized use cases (e.g. have versions with and without hooks instantiated from a template), so it would probably boil down to the trade-off between implementation complexity and some DOM components' performance.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1501152#c33)• 6 years ago |
|  | |

This is going to miss the 67/60.7.0esr releases. If you think we may come up with a fix and it would drive a dot release, we can keep tracking for 67. Otherwise we should wontfix it and move the flags to 68.

Flags: needinfo?(ytausky)Flags: needinfo?(dveditz)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1501152#c34)• 6 years ago |
|  | |

I'm following tcampbell's recommendations concerning this bug, and they necessitate a bigger-ish refactoring of the surrounding code, including iteration on the design of several classes. I'm not sure it would make sense as a point release.

Flags: needinfo?(ytausky)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1501152#c35)• 6 years ago |
|  | |

That makes sense. Thanks!

[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix)
[tracking-firefox67](/buglist.cgi?f1=cf_tracking_firefox67&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox67&o1=equals&v1=-)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
[67+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=67%2B) → [68+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=68%2B)Flags: needinfo?(dveditz)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1501152#c36)• 6 years ago |
|  | |

Too late now for 68.

[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix)
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)
[tracking-firefox69](/buglist.cgi?f1=cf_tracking_firefox69&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
[68+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=68%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=%3F)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1501152#c37)• 6 years ago |
|  | |

Tom is helping here while Yaron is on leave. Thanks, Tom!

Assignee: ytausky → shes050117

|  | [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1501152#c38)• 6 years ago |
|  | |

Attached file
[Bug 1501152 - Have a function to get elements from JS array;](attachment.cgi?id=9078768) (obsolete)
— [Details](attachment.cgi?id=9078768&action=edit)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1501152#c39)• 6 years ago |
|  | |

To clarify, I was under the impression that Yaron's work on [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") was basically ready to land, modulo the one line: "Blockers: The missing SupressExceptions and calling aRv.Throw without checking it isn't already having an Exception." in <https://phabricator.services.mozilla.com/D28976#1020675> with the rest able to be follow-ups. Is there a reason not to land that?

(I realize there may have been some confusion since we didn't explicitly establish a "see also" relationship between [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") and this one because it would make it clear that [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") is a security fix pretending to be a cleanup.)

Flags: needinfo?(shes050117)

|  | [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1501152#c40)• 6 years ago |
|  | |

(In reply to Andrew Sutherland [:asuth] (he/him) from [comment #39](/show_bug.cgi?id=1501152#c39 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey"))

> To clarify, I was under the impression that Yaron's work on [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") was basically ready to land, modulo the one line: "Blockers: The missing SupressExceptions and calling aRv.Throw without checking it isn't already having an Exception." in <https://phabricator.services.mozilla.com/D28976#1020675> with the rest able to be follow-ups. Is there a reason not to land that?
>
> (I realize there may have been some confusion since we didn't explicitly establish a "see also" relationship between [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") and this one because it would make it clear that [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") is a security fix pretending to be a cleanup.)

Ah, I somehow couldn't connect these two tickets with each other. I'll rebase and try to address the patch in [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer").

Flags: needinfo?(shes050117)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a23169297_600971)• 6 years ago |

[Attachment #9078768](/attachment.cgi?id=9078768&action=edit "Bug 1501152 - Have a function to get elements from JS array;") -
Attachment is obsolete: true

|  | [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1501152#c41)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1501152&comment_id=14269449 "1 revision") |
|  | |

Hi Daniel,

The fix for this issue has been landed by pretending itself to be a cleanup in [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer"). Since this is not the general procedure for security issue (at least I couldn't find a document for this), I have a few questions for the status of this bug. Would you mind giving me some feedback? Thanks!

My questions here are:

* Can we close this bug now? And would it be safe if we set any dependency between this and [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") now? (e.g. duplicate or see also)
* Should we uplift the patches in [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") to Beta since this is a sec-high issue from your perspective? (I wouldn't recommend doing that since the patches also refactor surrounding code)
Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1501152#c42)• 5 years ago |
|  | |

One problem with with hiding security fixes in unrelated bugs is that it completely bypasses the [sec-approval process](https://wiki.mozilla.org/Security/Bug_Approval_Process) which would have answered some of those questions, as well as explored potential solutions to problems such as "if we can't uplift this to Beta, how the heck are we going to secure ESR-68 for the next year it's supported?" This process is linked to in the warning text "sec-approval required on patches before landing" in the attachments area of this bug.

> Can we close this bug now? And would it be safe if we set any dependency between this and [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") now? (e.g. duplicate or see also)

We need to mark this bug FIXED so it triggers the proper advisory and bug bounty treatment. Linking them now is OK.

So now what? If we wait until Firefox 70 ships that's late October which is pretty long for a sec-high fix to sit in the tree. We've done that before but this patch looks fairly straightforward, if large, so maybe it's safe to backport? We definitely need to backport to ESR-68 branch anyway.

We're also still supporting ESR-60. How complex would it be to backport to that? I can't imagine IndexedDB has changed much.

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=fixed)
[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=%3F) → [69+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=69%2B)Depends on: [1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer")Flags: needinfo?(dveditz) → needinfo?(shes050117)Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form][fixed in bug 1544750]

|  | [Ted Campbell [:tcampbell]](/user_profile?user_id=586681) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1501152#c43)• 5 years ago |
|  | |

Tom, are we sure that [Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") covered all the cases for this bug? For example, [1] still can run arbitrary JS which is what the spec allows. This fixes the prototype stuff (and we now better follow spec), but is the re-entrancy issue addressed in other ways?

[1] <https://hg.mozilla.org/integration/autoland/rev/b14b8efda186#l8.169>

|  | [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1501152#c44)• 5 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #42](/show_bug.cgi?id=1501152#c42 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey"))

> One problem with with hiding security fixes in unrelated bugs is that it completely bypasses the [sec-approval process](https://wiki.mozilla.org/Security/Bug_Approval_Process) which would have answered some of those questions, as well as explored potential solutions to problems such as "if we can't uplift this to Beta, how the heck are we going to secure ESR-68 for the next year it's supported?" This process is linked to in the warning text "sec-approval required on patches before landing" in the attachments area of this bug.

I see. Thanks for the explanation! I will try to ask the sec-approval in the security bug for the patches in the unrelated bugs if I have similar condition next time. So that, we can also cover this problem.

> So now what? If we wait until Firefox 70 ships that's late October which is pretty long for a sec-high fix to sit in the tree. We've done that before but this patch looks fairly straightforward, if large, so maybe it's safe to backport? We definitely need to backport to ESR-68 branch anyway.

It makes sense to backport it to ESR-68, but it's better to observe the status for the patch on the Nightly for a while (a week). If the patch is stable (there is no new issues related to that for a week), then I will check and try to uplift the patch to ESR-68.

> We're also still supporting ESR-60. How complex would it be to backport to that? I can't imagine IndexedDB has changed much.

I rebased both part1 and part2 on [Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer"). There are some conflicts on dom/indexedDB/ActorsParent.cpp and dom/indexedDB/Key.cpp. I'll take a closer look (checking the changes on IDBKey after ESR60 til now since patches on [Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") refactor the code there) next week when I rebase the patches to ESR68.

Also, we still need to check the performance impact after applying the patches on [Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer").

Keep the ni flag to remind me of checking the complexity of backporting to 60 next week.

|  | [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1501152#c45)• 5 years ago |
|  | |

(In reply to Ted Campbell [:tcampbell] from [comment #43](/show_bug.cgi?id=1501152#c43 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey"))

> Tom, are we sure that [Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") covered all the cases for this bug? For example, [1] still can run arbitrary JS which is what the spec allows. This fixes the prototype stuff (and we now better follow spec), but is the re-entrancy issue addressed in other ways?
>
> [1] <https://hg.mozilla.org/integration/autoland/rev/b14b8efda186#l8.169>

Ah, sorry for the confusion. I was thinking this bug is mainly for the prototype stuff and the rest of the works should be taken care of in other bugs. And I was wrong. I'll ensure that we have taken all the cases before closing this security bug. Thanks for the notice!

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a24363596_75935)• 5 years ago |

Status: ASSIGNED → RESOLVEDClosed: 5 years agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a24413342_75935)• 5 years ago |

Status: RESOLVED → REOPENED
[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected)Resolution: FIXED → ---

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a24413355_75935)• 5 years ago |

Status: REOPENED → ASSIGNED

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1501152#c46)• 5 years ago |
|  | |

In the strictest sense, the re-entrancy issue is already addressed by cloning the value, which strips getters. By avoiding the prototype chain, I believe the security hole is plugged. The PoC posted on this issue doesn't produce an ASan message for me any more.

Assignee: shes050117 → ytausky

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1501152#c47)• 5 years ago |
|  | |

I think there are still some theoretical edge cases in spidermonkey, I don't remember exactly, maybe when some wrappers or proxies are involved, so long term it would be safer to fix [bug 1570585](/show_bug.cgi?id=1570585 "RESOLVED WORKSFORME").

|  | [Tom Tung [:tt, :ttung]](/user_profile?user_id=552411) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1501152#c48)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1501152&comment_id=14297432 "3 revisions") |
|  | |

Quick update: the plan for uplift is that if I/Yaron can implement a quick & simple fix for [bug 1570585](/show_bug.cgi?id=1570585 "RESOLVED WORKSFORME") (I have a naive plan for fixing that in mind, but it need to be verified), then maybe it's better to uplift the patch there to Beta or ESR since I expect the patch there would be smaller and should also fix the issue here. If we cannot make it, I would suggest just uplifting patches here.

Flags: needinfo?(shes050117)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1501152#c49)• 5 years ago |
|  | |

Jan (and Ted, privately) are correct, I forgot about the possibility of using proxies. So this is not fixed yet.

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1501152#c50)• 5 years ago |
|  | |

Back-flipping yet again, step 23 of [StructuredSerializeInternal](https://html.spec.whatwg.org/multipage/structured-data.html#structuredserializeinternal) makes clones of objects with proxies impossible, so I once again think this is actually fixed in m-c. I think this highlights the need for a systematic approach to dealing with [bug 1570585](/show_bug.cgi?id=1570585 "RESOLVED WORKSFORME").

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1501152#c51)• 5 years ago |
|  | |

We have one beta left before 69 goes to RC next week. If we plan to do something for Fx69/68.1esr, that needs to be sorted out ASAP.

Flags: needinfo?(ytausky)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1501152#c52)• 5 years ago |
|  | |

I'm compiling the patches from [bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") for beta, when that's done I'll do it for the ESR as well.

Flags: needinfo?(ytausky)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1501152#c53)• 5 years ago |
|  | |

Attached file
[Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell](attachment.cgi?id=9087003)
— [Details](attachment.cgi?id=9087003&action=edit)

This commit adds the text of the spec as inline comments and refactors

the code such that it directly corresponds to the spec's steps. This

makes it easier to understand how the spec's algorithm is implemented.

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1501152#c54)• 5 years ago |
|  | |

Attached file
[Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell](attachment.cgi?id=9087298)
— [Details](attachment.cgi?id=9087298&action=edit)

This commit adds the text of the spec as inline comments and refactors

the code such that it directly corresponds to the spec's steps. This

makes it easier to understand how the spec's algorithm is implemented.

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1501152#c55)• 5 years ago |
|  | |

Comment on [attachment 9087003](/attachment.cgi?id=9087003 "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") [[details]](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell")

[Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell

### Beta/Release Uplift Approval Request

* **User impact if declined**: Potentially exploitable use-after-free
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: It's been on nightly and we haven't seen regressions.
* **String changes made/needed**: None

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Easy to trigger UAF, not sure how easy it is to exploit
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: esr68
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: It's possible that it introduces regressions since it's a new implementation of existing functionality, but it's been on nightly and we haven't seen any regressions.
[Attachment #9087003](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: sec-approval?
[Attachment #9087003](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: approval-mozilla-beta?

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26214601_621888)• 5 years ago |

[Attachment #9087298](/attachment.cgi?id=9087298&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: sec-approval?

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1501152#c56)• 5 years ago |
|  | |

Comment on [attachment 9087298](/attachment.cgi?id=9087298 "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") [[details]](/attachment.cgi?id=9087298&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell")

[Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**: Potentially exploitable UAF
* **Fix Landed on Version**: 70
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: It's been tested on nightly and we haven't seen regressions.
* **String or UUID changes made by this patch**: None
[Attachment #9087298](/attachment.cgi?id=9087298&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: approval-mozilla-esr68?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1501152#c57)• 5 years ago |
|  | |

Can you clarify the status for esr60? The sec-approval says this only goes back as far as esr68, but [comment 31](/show_bug.cgi?id=1501152#c31 "VERIFIED FIXED - Use after free in KeyPath::ExtractKey") says esr60 is also affected. Also, updating the flags to reflect that this is fixed in 70 already.

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 5 years ago → 5 years ago
[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=fixed)Flags: needinfo?(ytausky)Resolution: --- → FIXEDTarget Milestone: --- → mozilla70

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1501152#c58)• 5 years ago |
|  | |

Comment on [attachment 9087003](/attachment.cgi?id=9087003 "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") [[details]](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell")

[Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell

This has baked on Nightly for awhile now, let's take it for 69.0b16 also.

[Attachment #9087003](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1501152#c59)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/db9bda005eff>

[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1501152#c60)• 5 years ago |
|  | |

Comment on [attachment 9087003](/attachment.cgi?id=9087003 "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") [[details]](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell")

[Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell

Giving sec-approval+ since it is already in all the things. :-)

[Attachment #9087003](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: sec-approval? → sec-approval+

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1501152#c61)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1501152&comment_id=14317582 "1 revision") |
|  | |

I forgot about esr60, I'll backport it now.

Update: it does not apply cleanly, so this may require more work and testing.

Flags: needinfo?(ytausky)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26281583_600971)• 5 years ago |

[Attachment #9087003](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Attachment is obsolete: true

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1501152#c62)• 5 years ago |
|  | |

Comment on [attachment 9087003](/attachment.cgi?id=9087003 "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") [[details]](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell")

[Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell

This isn't obsolete just because it was uplifted already.

[Attachment #9087003](/attachment.cgi?id=9087003&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Attachment is obsolete: false

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1501152#c63)• 5 years ago |
|  | |

Comment on [attachment 9087298](/attachment.cgi?id=9087298 "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") [[details]](/attachment.cgi?id=9087298&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell")

[Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell

Approved for 68.1esr.

[Attachment #9087298](/attachment.cgi?id=9087298&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: sec-approval?
[Attachment #9087298](/attachment.cgi?id=9087298&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: approval-mozilla-esr68?
[Attachment #9087298](/attachment.cgi?id=9087298&action=edit "Bug 1544750 - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell") -
Flags: approval-mozilla-esr68+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1501152#c64)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr68/rev/ebb385dc5c27434ca6e1b951fa57492bdc1e1d62>

[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1501152#c65)• 5 years ago |
| backout | |

Backed out for from ESR68 bustage in IDBResult.h:

<https://hg.mozilla.org/releases/mozilla-esr68/rev/9fd0d4493c77bfed937299c2b7fd3843f8543a3a>

Push with bustage: <https://treeherder.mozilla.org/#/jobs?repo=mozilla-esr68&revision=091473bf2727d37a4107cfca1185ef99c3f2eeff>

Failure log: <https://treeherder.mozilla.org/logviewer.html#?job_id=263243122&repo=mozilla-esr68>

[task 2019-08-23T20:05:13.369Z] 20:05:13 INFO - In file included from /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/IDBCursor.h:14:

[task 2019-08-23T20:05:13.369Z] 20:05:13 INFO - In file included from /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/indexedDB/Key.h:10:

[task 2019-08-23T20:05:13.369Z] 20:05:13 ERROR - /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/indexedDB/IDBResult.h:164:35: error: bad implicit conversion constructor for 'IDBResult'

[task 2019-08-23T20:05:13.369Z] 20:05:13 INFO - using IDBResult::IDBResultBase::IDBResultBase;

[task 2019-08-23T20:05:13.369Z] 20:05:13 INFO - ^

[task 2019-08-23T20:05:13.370Z] 20:05:13 INFO - /builds/worker/workspace/build/src/obj-firefox/dist/include/mozilla/dom/indexedDB/IDBResult.h:164:35: note: consider adding the explicit keyword to the constructor

[task 2019-08-23T20:05:13.370Z] 20:05:13 INFO - using IDBResult::IDBResultBase::IDBResultBase;

[task 2019-08-23T20:05:13.370Z] 20:05:13 INFO - ^

[task 2019-08-23T20:05:13.370Z] 20:05:13 INFO - explicit

[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)Flags: needinfo?(ytausky)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26326656_75935)• 5 years ago |

[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F) → [69+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=69%2B)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1501152#c66)• 5 years ago |
|  | |

Right, that patch triggered a bug in the static analysis, which was fixed in [bug 1554989](/show_bug.cgi?id=1554989 "RESOLVED FIXED - Inheriting constructors whose inherited constructors are implicit are always rejected"). I'll have to uplift that one as well.

Flags: needinfo?(ytausky)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1501152#c67)• 5 years ago |
|  | |

Attached file
[Bug 1554989 - Fix implicit checker on inheriting constructors r=andi](attachment.cgi?id=9088091) (obsolete)
— [Details](attachment.cgi?id=9088091&action=edit)

Inheriting constructors are implicitly introduced via a using-declaration.

Since the C++ grammar doesn't allow attributes on using-declarations, it

is currently impossible to add MOZ\_IMPLICIT to implicit inheriting

constructors.

This commit changes the AST matcher such that it ignores inheriting

constructors altogether. If they are inheriting from an implicit inherited

constructor, that constructor's check should be enough to ensure that no

constructors are unintentionally implicit.

[Bug 1544750](/show_bug.cgi?id=1544750 "RESOLVED FIXED - Refactor IndexedDB's add() and put() operations to make correspondence to spec clearer") - Part 2: Refactor Key::EncodeJSValInternal to show direct correspondence to spec r=asuth,tcampbell a=RyanVM

This commit adds the text of the spec as inline comments and refactors

the code such that it directly corresponds to the spec's steps. This

makes it easier to understand how the spec's algorithm is implemented.

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26554951_458188)• 5 years ago |

Flags: qe-verify+Whiteboard: [reporter-external] [client-bounty-form][fixed in bug 1544750] → [reporter-external] [client-bounty-form][fixed in bug 1544750][post-critsmash-triage]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1501152#c68)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr68/rev/80175938fbd8>

[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26569843_280903)• 5 years ago |

Alias: CVE-2019-11752Whiteboard: [reporter-external] [client-bounty-form][fixed in bug 1544750][post-critsmash-triage] → [reporter-external] [client-bounty-form][fixed in bug 1544750][post-critsmash-triage][adv-main69+][adv-esr68.1+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26570886_1689)• 5 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26622617_458188)• 5 years ago |

QA Whiteboard: [qa-triaged]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1501152#c69)• 5 years ago |
|  | |

Hi Yaron, any updates on the ESR60 patch?

Flags: needinfo?(ytausky)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1501152#c70)• 5 years ago |
|  | |

I'm slowed down with it because my local build of esr60 fails and there are some merge conflicts that need to be solved and tested.

Flags: needinfo?(ytausky)

|  | [Cristian Baica [:cbaica], Release Desktop QA](/user_profile?user_id=614785) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1501152#c71)• 5 years ago |
|  | |

I've used Fx65.0a1 (2018-10-22) asan build and tried loading the test-case to reproduce the issue, but the tabs keep crashing so I cannot run the test-case.

Is there anything that can be done by QA to verify this?

|  | [Cristian Baica [:cbaica], Release Desktop QA](/user_profile?user_id=614785) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26728278_614785)• 5 years ago |

Flags: needinfo?(ytausky)

|  | [Yaron Tausky [:ytausky]](/user_profile?user_id=621888)  Assignee |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1501152#c72)• 5 years ago |
|  | |

You could verify that there are no crashes with the newest builds for ESR68 and Beta; all other versions are known to be affected (I'm still working on ESR60).

Flags: needinfo?(ytausky)

|  | [Cristian Baica [:cbaica], Release Desktop QA](/user_profile?user_id=614785) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1501152#c73)• 5 years ago |
|  | |

Verified with the fixed Fx70.0a1, Fx69.0b16 and ESR68 builds. The tabs no longer crash when loading the test-case. Waiting for the fix on ESR60.

[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=verified)
[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=verified)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a26828558_1689)• 5 years ago |

Depends on: [1554989](/show_bug.cgi?id=1554989 "RESOLVED FIXED - Inheriting constructors whose inherited constructors are implicit are always rejected")

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1501152#c74)• 5 years ago |
|  | |

Attached patch

[patch for esr60](attachment.cgi?id=9089466&action=diff)
— [Details](attachment.cgi?id=9089466&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9089466)

Andrew, can you sanity-check this?

There were some conflicts in Key.cpp around [bug 1499854](/show_bug.cgi?id=1499854 "RESOLVED FIXED - Assertion failure: (typeOffset % eArray == 0) && (typeOffset / eArray <= 2), at /builds/worker/workspace/build/src/dom/indexedDB/Key.cpp:195"), and a dependency on [bug 1429613](/show_bug.cgi?id=1429613 "RESOLVED FIXED - Variant::match accepting lambdas, or one generic lambda") for IDBResult (the latter fixed by janv with <https://paste.mozilla.org/1CY8myH6>). This applies on top of <https://hg.mozilla.org/mozilla-central/rev/e8c59393c809> (which grafts cleanly to esr60).

[Attachment #9089466](/attachment.cgi?id=9089466&action=edit "patch for esr60") -
Flags: feedback?(bugmail)

|  | [Andrew Sutherland [:asuth] (he/him)](/user_profile?user_id=151407) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1501152#c75)• 5 years ago |
|  | |

Comment on [attachment 9089466](/attachment.cgi?id=9089466 "patch for esr60") [[details]](/attachment.cgi?id=9089466&action=edit "patch for esr60") [[diff]](/attachment.cgi?id=9089466&action=diff "patch for esr60") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9089466)
patch for esr60
Review of [attachment 9089466](/attachment.cgi?id=9089466 "patch for esr60") [[details]](/attachment.cgi?id=9089466&action=edit "patch for esr60") [[diff]](/attachment.cgi?id=9089466&action=diff "patch for esr60") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9089466):
-----------------------------------------------------------------
So, it turns out I also can't actually build esr60 on my machine, but I can certify this as sane and resembling the code I previously reviewed. (It seems like rustc 1.36.0 is probably too recent, but I'm very wary of messing with any default build toolchains right now because it might invalidate some of my other-secbug rr traces.)
[Attachment #9089466](/attachment.cgi?id=9089466&action=edit "patch for esr60") -
Flags: feedback?(bugmail) → feedback+

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1501152#c76)• 5 years ago |
|  | |

Attached patch

[Matcher fix](attachment.cgi?id=9089512&action=diff)
— [Details](attachment.cgi?id=9089512&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9089512)

Sorry, the pastebin lasted just one hour.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1501152#c77)• 5 years ago |
|  | |

I have rustc 1.36.0 too and I can build it. However, one need to do this before configure/build:

export RUSTFLAGS="--cap-lints warn"

to workaround [bug 1519629](/show_bug.cgi?id=1519629 "RESOLVED FIXED - Stylo fails with --enable-warnings-as-errors using Rust 1.33"), this was all discovered by Julien (thanks for the investigation).

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1501152#c78)• 5 years ago |
|  | |

Comment on [attachment 9089466](/attachment.cgi?id=9089466 "patch for esr60") [[details]](/attachment.cgi?id=9089466&action=edit "patch for esr60") [[diff]](/attachment.cgi?id=9089466&action=diff "patch for esr60") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1501152&attachment=9089466)
patch for esr60
taking this for 60.9.
[Attachment #9089466](/attachment.cgi?id=9089466&action=edit "patch for esr60") -
Flags: approval-mozilla-esr60+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=1501152#c79)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/2ce17180fd4dd8828caa964ba55205a51c313355>

<https://hg.mozilla.org/releases/mozilla-esr60/rev/d8dd10ac54302e4bd9cf6c537f790933b149099d>

[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [Cristian Baica [:cbaica], Release Desktop QA](/user_profile?user_id=614785) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=1501152#c80)• 5 years ago |
|  | |

Confirming the tabs no longer crash on Fx 60.9.0ESR buildID: 20190901094603. Marking the entire ticket as verified fixed.

Status: RESOLVED → VERIFIED
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified)Flags: qe-verify+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a51074809_1689)• 5 years ago |

Group: core-security-release

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a99399619_600971)• 3 years ago |

[Attachment #9088091](/attachment.cgi?id=9088091&action=edit "Bug 1554989 - Fix implicit checker on inheriting constructors r=andi") -
Attachment is obsolete: true

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1501152#a176820825_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1501152&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [zhanjiasong45](/user_profile?user_id=615701)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_73f8d6fa_20250121_022321.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_40585956_20250121_022334.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_fbf60f70_20250121_001605.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1538015)
* [XML](/show_bug.cgi?ctype=xml&id=1538015)

Closed
[Bug 1538015](/show_bug.cgi?id=1538015)
(CVE-2019-11732)

Opened 6 years ago
Closed 6 years ago

# Revisit pref sync in to mitigate sandbox escape vector

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Revisit pref sync in to mitigate sandbox escape vector

## Categories

### (Firefox :: Sync, enhancement)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=Sync#Sync)

Sync
▾

Firefox :: Sync
Bugs and feature requests for Sync in Firefox Desktop.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=Sync&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=Sync&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=Sync)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

enhancement

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Firefox 69

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox | --- | [68+](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=68%2B) |
| firefox-esr60 | [68+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=68%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified) |
| firefox67 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix) |
| firefox68 | [+](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=verified) |
| firefox69 | [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | 68+ |
| firefox-esr60 | 68+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox67 |  | wontfix |
| firefox68 | + | verified |
| firefox69 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: pauljt, Assigned: markh)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/90befef2df2066c3deff0d97cdaa6916?d=mm&size=40)  [markh](/user_profile?user_id=16943)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=40)  [pauljt](/user_profile?user_id=434339)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/8a64a23302de3acb7fc99848978088ad?d=mm&size=40)  [lougenia](/user_profile?user_id=649193)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

21 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[CVE-2019-9812](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)")

[1854698](/show_bug.cgi?id=1854698 "RESOLVED FIXED - Remove ability to sync arbitrary preferences not locally whitelisted, and tweak logging output")

Dependency [tree](/showdependencytree.cgi?id=1538015&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1538015)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: [adv-main68-][adv-esr60.8-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2019-11732

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main68-][adv-esr60.8-]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c36 "6 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [Bug 1538015 (part 1) - test only change to tighten up the checks being made.](/attachment.cgi?id=9062380)  [6 years ago](#c20)  [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)   47 bytes, text/x-phabricator-request | jcristau : [approval-mozilla-beta+](#c35 "6 years ago") | [Details](/attachment.cgi?id=9062380&action=edit) | [Review](/attachment.cgi?id=9062380) |
| --- | --- | --- |
| [Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.](/attachment.cgi?id=9062381)  [6 years ago](#c21)  [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)   47 bytes, text/x-phabricator-request | jcristau : [approval-mozilla-beta+](#a8417601_580382 "6 years ago") | [Details](/attachment.cgi?id=9062381&action=edit) | [Review](/attachment.cgi?id=9062381) |
| [rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch](/attachment.cgi?id=9075456)  [6 years ago](#c41)  [Thom Chiovoloni [:tcsc] (ex-moco)](/user_profile?user_id=567427)   7.98 KB, patch | RyanVM : [approval-mozilla-esr60+](#c44 "6 years ago") | [Details](/attachment.cgi?id=9075456&action=edit) | [Diff](/attachment.cgi?id=9075456&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1538015&attachment=9075456) |
| [rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch](/attachment.cgi?id=9075457)  [6 years ago](#c42)  [Thom Chiovoloni [:tcsc] (ex-moco)](/user_profile?user_id=567427)   16.18 KB, patch | RyanVM : [approval-mozilla-esr60+](#a8899976_75935 "6 years ago") | [Details](/attachment.cgi?id=9075457&action=edit) | [Diff](/attachment.cgi?id=9075457&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1538015&attachment=9075457) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1538015#c0)• 6 years ago |
|  | |

In light of [bug 1538008](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)") we should re-think the way we sync preferences. See [bug 1538008](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)") for more details.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a13_434339)• 6 years ago |

Component: Security → SyncProduct: Core → Firefox

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a60_280903)• 6 years ago |

No longer depends on: [CVE-2019-9812](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a85_280903)• 6 years ago |

Depends on: [CVE-2019-9812](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1538015#c1)• 6 years ago |
|  | |

In particular, process and debugging prefs that are often platform dependent anyway are dangerous to sync.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1538015#c2)• 6 years ago |
|  | |

Seems like an initial first step would be to limit the synced prefs to pref roots starting with:

```
accessibility.
browser.
lightweightThemes.
privacy.
network.cookie.
services.sync.syncedTabs.showRemoteIcons
signon.rememberSignons
spellchecker.dictionary

```

with explicit blocks for anything under `browser.remote` and `browser.safebrowsing`, perhaps with followup bugs to move those prefs somewhere else so we can remove the blocklist approach.

Could also do with a follow-up that allows syncing privacy.resistFingerprinting.\* to turn it **on**, but doesn't allow syncing to turn it **off**, though how we'd implement that, I dunno.

This isn't a panacea because people adding security-sensitive prefs under browser. can still create holes, but it's better than nothing (and we can't really prevent people adding these, sadly?).

Note that there's a few synced-by-default things that I'm deliberately not including (some `security.` , `xpinstall.whitelist.required`, for one) that I think just need removing from the list of default synced items. I think that's the right tradeoff; people can still set these prefs themselves and enterprises have other ways of enforcing them that don't involve sync.

Johann, does that sound sane? Am I missing a better plan?

Flags: needinfo?(jhofmann)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1538015#c3)• 6 years ago |
|  | |

I think limiting like that makes some sense, but, to take a step back, what makes us use preferences for this instead of a hard-coded list anyway? Has anyone ever needed to modify this on the fly, without touching m-c code? Could there be a chrome (parent) only API that stores these in memory for testing, then?

I'm trying to understand where the requirement for a pref list of things to sync comes from. Maybe that will also help us design the right security model for it.

Flags: needinfo?(jhofmann)

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1538015#c4)• 6 years ago |
|  | |

So, to answer my own question, the requirement may come from the fact that the user can choose different categories of settings to sync in about:preferences. Could we just make prefs for these (on my Nightly 8) categories and hard code their pref values?

Ryan, do you have any thoughts/further insights on that? :)

Flags: needinfo?(rfkelly)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1538015#c5)• 6 years ago |
|  | |

(In reply to Johann Hofmann [:johannh] from [comment #4](/show_bug.cgi?id=1538015#c4 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

No, these prefs are all specifically about syncing preferences, so "sub items" as it were of the "Preferences" checkbox that shows up in the 6/7/8 checkboxes in the, uh, preferences. To keep it confusing.

That is, when you sync preferences, we don't sync **all** preferences. That would be a Bad Idea. Instead, we sync a subset.

The subset is/was user-alterable, with some sensible defaults defined.

Removing the ability for users to alter these and keep the list in a jsm or whatever would be possible, but people do modify these lists themselves on an ad-hoc basis when people add new preferences and forget to add them to sync's list, or when there are longstanding / hidden preferences that they want to sync themselves but that we'd never sync from a product perspective. We could decide not to are about that usecase in favour of security, I guess, but I'm not convinced that really buys us much beside user outrage.

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1538015#c6)• 6 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #5](/show_bug.cgi?id=1538015#c5 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> (In reply to Johann Hofmann [:johannh] from [comment #4](/show_bug.cgi?id=1538015#c4 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))
>
> No, these prefs are all specifically about syncing preferences, so "sub items" as it were of the "Preferences" checkbox that shows up in the 6/7/8 checkboxes in the, uh, preferences. To keep it confusing.

Ah!

> That is, when you sync preferences, we don't sync **all** preferences. That would be a Bad Idea. Instead, we sync a subset.
>
> The subset is/was user-alterable, with some sensible defaults defined.
>
> Removing the ability for users to alter these and keep the list in a jsm or whatever would be possible, but people do modify these lists themselves on an ad-hoc basis when people add new preferences and forget to add them to sync's list, or when there are longstanding / hidden preferences that they want to sync themselves but that we'd never sync from a product perspective. We could decide not to are about that usecase in favour of security, I guess, but I'm not convinced that really buys us much beside user outrage.

How about allowing users to continue using these prefs to turn syncing a pref *off*, but not add new prefs? I.e. only support the "false" state of the sync prefs?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1538015#c7)• 6 years ago |
|  | |

(In reply to Johann Hofmann [:johannh] from [comment #6](/show_bug.cgi?id=1538015#c6 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> How about allowing users to continue using these prefs to turn syncing a pref *off*, but not add new prefs? I.e. only support the "false" state of the sync prefs?

I mean, the default is false unless we ship a value true for it, so this amounts to restricting the list to items for which we ship a default "sync this" pref, right?

As additional context, I suppose part of the raison d'etre of the existing system is that old-style add-ons could define prefs of their own that they might want synced. That's obviously not a concern anymore now that we're webextensions only.

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1538015#c8)• 6 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #7](/show_bug.cgi?id=1538015#c7 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> (In reply to Johann Hofmann [:johannh] from [comment #6](/show_bug.cgi?id=1538015#c6 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))
>
> > How about allowing users to continue using these prefs to turn syncing a pref *off*, but not add new prefs? I.e. only support the "false" state of the sync prefs?

Yeah, that's the idea, my suggestion was simply to dampen the impact on folks who would like to be able to turn off syncing certain prefs.

|  | [Haik Aftandilian [:haik]](/user_profile?user_id=558190) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1538015#c9)• 6 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #1](/show_bug.cgi?id=1538015#c1 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> In particular, process and debugging prefs that are often platform dependent anyway are dangerous to sync.

I agree. Some sandboxing prefs might be valid on Windows, but break the browser on Mac (for example.)

Can we limit the sync'd prefs to just those settable via about:preferences?

People manually setting things in about:config are the more rare advanced users right? And we can add a note in the about:config warning that only prefs set via about:preferences are synced.

|  | [Ryan Kelly [:rfkelly]](/user_profile?user_id=424102) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1538015#c10)• 6 years ago |
|  | |

[Comment 5](/show_bug.cgi?id=1538015#c5 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") answers my needinfo, likely better than I would have done; thanks :Gijs!

Flags: needinfo?(rfkelly)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a91885_1689)• 6 years ago |

Group: core-security → firefox-core-security

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a588917_537703)• 6 years ago |

Blocks: [CVE-2019-9812](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)")No longer depends on: [CVE-2019-9812](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1538015#c11)• 6 years ago |
|  | |

in addition to the list in [comment 2](/show_bug.cgi?id=1538015#c2 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"), extensions or extension users want some of those settings to be sync'd as well. In the shorter term maybe we could skip those while locking this down, or add the extensions.\* tree, but might be nice to add a WebExtension API or manifest.json section that lets an extension declare which settings are reasonable to sync and which are instance-specific.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a589262_1689)• 6 years ago |

Keywords: [sec-want](/buglist.cgi?keywords=sec-want&resolution=---)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1538015#c12)• 6 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #11](/show_bug.cgi?id=1538015#c11 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> in addition to the list in [comment 2](/show_bug.cgi?id=1538015#c2 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"), extensions or extension users want some of those settings to be sync'd as well. In the shorter term maybe we could skip those while locking this down, or add the extensions.\* tree, but might be nice to add a WebExtension API or manifest.json section that lets an extension declare which settings are reasonable to sync and which are instance-specific.

My understanding is that webextension prefs aren't stored in the regular preference infrastructure, but elsewhere, so this is no longer a concern. Rob, can you confirm?

Flags: needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1538015#c13)• 6 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #12](/show_bug.cgi?id=1538015#c12 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> My understanding is that webextension prefs aren't stored in the regular preference infrastructure, but elsewhere, so this is no longer a concern. Rob, can you confirm?

This is correct. Extensions cannot directly access any pref; they have to use the [`browser.storage.sync`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage/sync) API to save data that needs to be synchronized across devices.

Some extension APIs also change well-known prefs (see <https://searchfox.org/mozilla-central/search?q=symbol:ExtensionPreferencesManager%23addSetting&redirect=false> ), but all of these preference names are static.

Thunderbird will receive the ability to *read* prefs for the sake of migrating prefs to extension storage ([bug 1538590](/show_bug.cgi?id=1538590 "RESOLVED WONTFIX - Webextensions API to migrate legacy prefs")), but sync is probably not relevant there.

Flags: needinfo?(rob)

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1538015#c14)• 6 years ago |
|  | |

Paul, can you offer some guidance how we should proceed here?

Flags: needinfo?(ptheriault)

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1538015#c15)• 6 years ago |
|  | |

(In reply to Mark Hammond [:markh] from [comment #14](/show_bug.cgi?id=1538015#c14 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> Paul, can you offer some guidance how we should proceed here?

Well if we are in agreement that only allowing syncing a subset of prefs is a acceptable mitigation, then we just need to define what the list is, and then change the sync code such that we sync a whitelist of pref branches. IIUC, we currently only sync preferences that are listed under services.sync.prefs.sync.\* [1]. So I assume the way forward here would be to:

a) create a new pref like `services.sync.engine.pref.whitelist` which is a whitelist of pref branches that are allowed to be sync

b) when we load prefs from sync, filter the list of prefs to be load to only those which match the whitelist (and of course, prohibit loading of `services.sync.engine.pref.whitelist` itself

So then we just need a whitelist. Gijs posted a start in [comment 2](/show_bug.cgi?id=1538015#c2 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"), but I started going through browser.\* and actually there seem to be a lot of preferences which would potentially be dangerous in the content process. For example, I assume change browser.hiddenWindowChromeURL would change the URL which is loaded when you start Firefox on OSX. Any pref that has a chrome: URI as its value would surely be dangerous to allow the child process to set.

HOWEVER! The bigger problem for me is 1538024. The fundamental issue is that that the content process should NOT be allowed to set preferences. And therefore the child process must not be allowed to login to sync (or otherwise change sync state in such a way that causes pref changes). We will always have risks when the content process can set arbitrary prefs (even under a whitelist of branches).

So what I am saying here is that if we can implement this filter in a relatively simple way (using the list from [comment 2](/show_bug.cgi?id=1538015#c2 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector")) that we don't think will cause breakage, then it might be worth it as a defense in depth control, but its only a secondary control. But if I had to choose I'd say we should focus on 1538024 as the fix for this issue.

[1] What is services.engine.sync.prefs though?

Flags: needinfo?(ptheriault)

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1538015#c16)• 6 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #15](/show_bug.cgi?id=1538015#c15 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> Well if we are in agreement that only allowing syncing a subset of prefs is a acceptable mitigation,

Sorry Paul, I should have been clearer. I'm not really in agreement about this - many people find this useful and there are many articles on the internet explaining how to customize this so any pref you choose can be synced.

That said though, I understand we want to keep users safe. So I guess I'm asking whether we feel the risks here outweigh the benefits this facility offers to a small-but-vocal subset of our users? Should some of the "dangerous" prefs mentioned in [bug 1538008](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)") be unavailable in the release channel instead, thereby also avoiding social-engineering attacks?

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1538015#c17)• 6 years ago |
|  | |

(In reply to Mark Hammond [:markh] from [comment #16](/show_bug.cgi?id=1538015#c16 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> (In reply to Paul Theriault [:pauljt] from [comment #15](/show_bug.cgi?id=1538015#c15 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))
>
> > Well if we are in agreement that only allowing syncing a subset of prefs is a acceptable mitigation,
>
> Sorry Paul, I should have been clearer. I'm not really in agreement about this - many people find this useful and there are many articles on the internet explaining how to customize this so any pref you choose can be synced.
>
> That said though, I understand we want to keep users safe. So I guess I'm asking whether we feel the risks here outweigh the benefits this facility offers to a small-but-vocal subset of our users? Should some of the "dangerous" prefs mentioned in [bug 1538008](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)") be unavailable in the release channel instead, thereby also avoiding social-engineering attacks?

We need to do *something* in the short term. I think that the only way that we could justify NOT doing something in this bug, is if we have a short term solution for the either the "move privileged content to a trusted process" ([bug 1538008](/show_bug.cgi?id=1538008 "RESOLVED FIXED - [ ZDI-CAN-8375] UXSS priv-esc via sync (install arbitrary extensions & set arbitrary preferences)")) , or the "prompt the user when a sync change is triggered from web content ([bug 1538024](/show_bug.cgi?id=1538024 "NEW")).

Note the solution I was proposing in [comment 15](/show_bug.cgi?id=1538015#c15 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") is something where power users could still disable the whitelist if they REALLY want to sync obscure prefs. They might still complain as would need to remove the whitelist manually (since we wouldn't sync `services.sync.engine.pref.whitelist` or whatever we call it) but they technically still COULD.

Implementing a blacklist I guess is better that *nothing* (like blocking `security.*`, for example) but I'm sure there are many other vectors. If you know of pref branches that people like to set, then perhaps we could expand the whitelist from [comment 2](/show_bug.cgi?id=1538015#c2 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"), but I think it needs to be a whitelist to be at all effective as a control.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1538015#c18)• 6 years ago |
|  | |

PS it might be worth taking the question back up to 1538008, since the choice of doing this bug or not depends on the other solutions somewhat. Though ultimately, I really feel that pissing off a few vocal users is worth protecting our wider userbase.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1538015#c19)• 6 years ago |
|  | |

(In reply to Paul Theriault [:pauljt] from [comment #17](/show_bug.cgi?id=1538015#c17 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> Note the solution I was proposing in [comment 15](/show_bug.cgi?id=1538015#c15 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") is something where power users could still disable the whitelist if they REALLY want to sync obscure prefs. They might still complain as would need to remove the whitelist manually (since we wouldn't sync `services.sync.engine.pref.whitelist` or whatever we call it) but they technically still COULD.

Right, I missed that. I agree that's reasonable, thanks.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1538015#c20)• 6 years ago |
|  | |

Attached file
[Bug 1538015 (part 1) - test only change to tighten up the checks being made.](attachment.cgi?id=9062380)
— [Details](attachment.cgi?id=9062380&action=edit)

This is a test-only change to make the existing synced prefs tests more

explicit about values being checked and moves a couple of prefs around to make

things a bit clearer, which should make the test changes in part 2 clearer.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1538015#c21)• 6 years ago |
|  | |

Attached file
[Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.](attachment.cgi?id=9062381)
— [Details](attachment.cgi?id=9062381&action=edit)

This also removes a few preferences from the set we sync by default based

due to potential harm which can be caused syncing inappropriate values.

Depends on D29774

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1538015#c22)• 6 years ago |
|  | |

I've got a patch which I just put up for initial feedback, but thought I should discuss the approach here too.

It combines the allowlist-in-a-pref from Paul and the general approach of Gijs. Specifically:

* There's a "blocklist" which is hard-coded in javascript, so can't be changed by the user.
* There's a "allowlist" which is stored in a preference, so can be changed by the user. However, this preference itself is not synced, so the user must make adjustments to this preference manually on each device.
* The blocklist is consulted first, and the allowlist next.
* The default for the allowlist is such that all preferences we setup to sync by default are allowed.

So what's in these lists?

* The blocklist has the allowlist preference, plus "browser.safebrowsing." and "browser.remote." - I added the latter because Gijs mentioned it in [comment 2](/show_bug.cgi?id=1538015#c2 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"), although I couldn't find any "browser.remote." preferences?

Note also that this means removing the following preferences:

> pref("services.sync.prefs.sync.browser.safebrowsing.phishing.enabled", true);
>
> pref("services.sync.prefs.sync.browser.safebrowsing.malware.enabled", true);
>
> pref("services.sync.prefs.sync.browser.safebrowsing.downloads.enabled", true);
>
> pref("services.sync.prefs.sync.browser.safebrowsing.passwords.enabled", true);

so not only are these prefs no longer synced by default, they simply can not be synced. Some sites recommend setting these prefs to false for privacy reasons. However, I think it's easy to make a case that they should be blocklisted.

* While creating the allowlist I ended up deleting a few preference which don't seem to be used these days, along with `xpinstall.whitelist.required` due to potential harm. These deletions are:

> pref("services.sync.prefs.sync.xpinstall.whitelist.required", true);
>
> pref("services.sync.prefs.sync.addons.ignoreUserEnabledChanges", true);
>
> pref("services.sync.prefs.sync.extensions.personas.current", true);
>
> pref("services.sync.prefs.sync.pref.advanced.images.disable\_button.view\_image", true);
>
> pref("services.sync.prefs.sync.pref.advanced.javascript.disable\_button.advanced", true);

which results in the following allowlist:

> accessibility.
>
> browser.
>
> dom.disable media.
>
> dom.event.contextmenu.
>
> layout.spellcheckDefault
>
> network.cookie.
>
> extensions.update.enabled
>
> intl.accept\_languages
>
> permissions.default.image
>
> pref.downloads.disable\_button.
>
> pref.privacy.disable\_button.
>
> privacy.
>
> security.default\_personal\_cert
>
> security.OCSP.
>
> security.tls.version.
>
> services.sync.syncedTabs.
>
> signon.rememberSignons
>
> spellchecker.

which is a bit longer than ideal and what Gijs offered, but reducing it any further means also preventing the syncing of preferences which we sync *by default* now, which I'm a little reluctant to do without concrete harm being identified so we avoid annoying our users any more than we must. However, it's all obviously on the table for discussion.

> Could also do with a follow-up that allows syncing privacy.resistFingerprinting.\* to turn it **on**, but doesn't allow syncing to turn it **off**, though how we'd implement that, I dunno.

TBH I'm really not that bothered by that - it doesn't seem likely someone would attempt to use what we are fixing here simply to enable fingerprinting.

> Note that there's a few synced-by-default things that I'm deliberately not including (some `security.` , `xpinstall.whitelist.required`, for one)

As above, I left the existing `security` prefs, but didn't allowlist the entire `security.` branch.

The patch is a little larger than it needs to be because I chose to console.warn() when there's a pref that would have been synced before this patch but no longer is - users who haven't enabled custom prefs will never see this warning and users who have might appreciate an indication of what's going on.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1538015#c23)• 6 years ago |
|  | |

(In reply to Mark Hammond [:markh] from [comment #22](/show_bug.cgi?id=1538015#c22 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> * The blocklist has the allowlist preference, plus "browser.safebrowsing." and "browser.remote." - I added the latter because Gijs mentioned it in [comment 2](/show_bug.cgi?id=1538015#c2 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"), although I couldn't find any "browser.remote." preferences?

I meant `browser.tabs.remote`, apologies for the confusion.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a4071634_16943)• 6 years ago |

Assignee: nobody → markh

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1538015#c24)• 6 years ago |
|  | |

So Ive had a quick look through the prefs we allow here - there are some semi-dangerous ones I think, but we a never going to be fully safe here. One thing to note however is that Tom has been able to develop the patch to isolate accounts.firefox.com into a separate process. See <https://bugzilla.mozilla.org/show_bug.cgi?id=1539595#c9>

But in light of that, we should have a think about whether we should still do this - since this was always considered a stopgap measure. On one hand, I would prefer we did this, as an additional control for this type of issue (assuming that it doesn't break use cases). On the other hand, maybe its not worth the added engineering complexity that this change adds.

Or maybe we might just implement a less severe version of the block/allow list.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1538015#c25)• 6 years ago |
|  | |

Just a note: Ive been chatting with Mark on irc and I realised that the current patch misses some of the "dangerous" prefs from the original PoC in 1538008 [comment 0](/show_bug.cgi?id=1538015#c0 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector")

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1538015#c26)• 6 years ago |
|  | |

In that chat, we came up with a far simpler proposal.

* A new preference, say "services.sync.prefs.dangerously\_allow\_arbitrary" has a default value of false.
* If that preference is false, we treat the "services.sync.prefs.sync." branch as a whitelist - if that pref doesn't already exist locally, we refuse to take the preference. This is different to how it works now - we now happily take new incoming "control" prefs.
* If that new preference is true, we work as we work now - trust anything, block nothing.
* There's no blacklist - we don't even need to blacklist that new preference, we just need to ensure we never enable it by default or create a "control" pref for it (although if we want to guard against accidents we could treat it as a 1-item blocklist)

This means that by default, we only sync prefs that we've shipped as being OK to sync (ie, [these prefs](https://searchfox.org/mozilla-central/source/browser/app/profile/firefox.js#1179-1280))

Most users will see no change and the tiny fraction of users who leverage this have 2 options:

1. Manually create control preferences for the prefs they want to sync on both devices. For users who have many custom prefs, this will be a PITA and effectively kills the feature for them. However, it would allow (say) enterprises to expand that list fairly easily in a safe way.
2. Manually flip "services.sync.prefs.dangerously\_allow\_arbitrary" on each of their devices. Once flipped, things work for them exactly like they do now.

We'd recommend people use (1) and strongly advise against using (2) (and hopefully the pref name kinda speaks for itself)

Thoughts?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1538015#c27)• 6 years ago |
|  | |

Would it be possible to make the behavior of dangerously\_allow\_arbitrary to create services.sync.prefs.sync.foo entries for incoming prefs? This would allow users to turn it on, sync, and then turn it off without having to create custom prefs.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1538015#c28)• 6 years ago |
|  | |

(In reply to Tom Ritter [:tjr] from [comment #27](/show_bug.cgi?id=1538015#c27 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> Would it be possible to make the behavior of dangerously\_allow\_arbitrary to create services.sync.prefs.sync.foo entries for incoming prefs? This would allow users to turn it on, sync, and then turn it off without having to create custom prefs.

Yep, that's what would happen in the proposal above.

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1538015#c29)• 6 years ago |
|  | |

(In reply to Mark Hammond [:markh] from [comment #26](/show_bug.cgi?id=1538015#c26 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> In that chat, we came up with a far simpler proposal.
>
> * A new preference, say "services.sync.prefs.dangerously\_allow\_arbitrary" has a default value of false.
> * If that preference is false, we treat the "services.sync.prefs.sync." branch as a whitelist - if that pref doesn't already exist locally, we refuse to take the preference. This is different to how it works now - we now happily take new incoming "control" prefs.
> * If that new preference is true, we work as we work now - trust anything, block nothing.
> * There's no blacklist - we don't even need to blacklist that new preference, we just need to ensure we never enable it by default or create a "control" pref for it (although if we want to guard against accidents we could treat it as a 1-item blocklist)
>
> This means that by default, we only sync prefs that we've shipped as being OK to sync (ie, [these prefs](https://searchfox.org/mozilla-central/source/browser/app/profile/firefox.js#1179-1280))
>
> Most users will see no change and the tiny fraction of users who leverage this have 2 options:
>
> 1. Manually create control preferences for the prefs they want to sync on both devices. For users who have many custom prefs, this will be a PITA and effectively kills the feature for them. However, it would allow (say) enterprises to expand that list fairly easily in a safe way.
> 2. Manually flip "services.sync.prefs.dangerously\_allow\_arbitrary" on each of their devices. Once flipped, things work for them exactly like they do now.
>
> We'd recommend people use (1) and strongly advise against using (2) (and hopefully the pref name kinda speaks for itself)
>
> Thoughts?

Sorry for the delay Mark, lost this bug when traveling (Im behind in bugmail). As discussed I think this is a nice solution - basically it just means an even stricter whitelist for regular users. I've done a quick review of the list of prefs and I can't see any obvious attack vectors - some avenue for inconvenience, but if you have a compromised sync account, you are already in a world of inconvenience. So sounds like a good plan to me. Some things to keep in mind is how we prevent people from adding dangerous prefs to this list (but I expect thats just a part of regular review process). Let do it.

|  | [Thom Chiovoloni [:tcsc] (ex-moco)](/user_profile?user_id=567427) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1538015#c30)• 6 years ago |
|  | |

> Manually flip "services.sync.prefs.dangerously\_allow\_arbitrary" on each of their devices. Once flipped, things work for them exactly like they do now.

This would be a pretty substantial change to how the current system works, and at a minimum would deserve mentioning in the release notes.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a7117643_600971)• 6 years ago |

[Attachment #9062381](/attachment.cgi?id=9062381&action=edit "Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.") -
Attachment description: Bug 1538015 (part 2) - implement an allowlist for preferences which can sync. → Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1538015#c31)• 6 years ago |
|  | |

Release Note Request (optional, but appreciated)

[Why is this notable]: This is a change in behaviour for advanced users of sync. The old behaviour is documented on various sites which we don't control.

[Affects Firefox for Android]: No

[Suggested wording]: The way non-default preferences are synced has changed. Please see [sumo link] for more.

[Links (documentation, blog post, etc)]: I'm currently working with sumo to get a link, but thought I'd get this flag set asap.

[relnote-firefox](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=%3F)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1538015#c32)• 6 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/643214222e38498bbd795d70890f0e6b9ac581b0>

<https://hg.mozilla.org/mozilla-central/rev/e36730a6d5898a03b25439a75340e46c8240848c>

Group: firefox-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 6 years ago
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → Firefox 69

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1538015#c33)• 6 years ago |
|  | |

(In reply to Mark Hammond [:markh] from [comment #31](/show_bug.cgi?id=1538015#c31 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector"))

> Release Note Request (optional, but appreciated)
>
> [Why is this notable]: This is a change in behaviour for advanced users of sync. The old behaviour is documented on various sites which we don't control.
>
> [Affects Firefox for Android]: No
>
> [Suggested wording]: The way non-default preferences are synced has changed. Please see [sumo link] for more.
>
> [Links (documentation, blog post, etc)]: I'm currently working with sumo to get a link, but thought I'd get this flag set asap.

Sumo link is <https://support.mozilla.org/kb/sync-custom-preferences> - not yet live but that's where it will be.

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1538015#c34)• 6 years ago |
|  | |

Comment on [attachment 9062381](/attachment.cgi?id=9062381 "Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.") [[details]](/attachment.cgi?id=9062381&action=edit "Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.")

[Bug 1538015](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") (part 2) - restrict when incoming synced prefs are applied.

### Beta/Release Uplift Approval Request

* **User impact if declined**: Mitigation for sandbox escape will not exist.

It's my understanding that this patch is desired in esr68, so I'm requesting beta uplift now. If the risk is too great, then maybe this could be considered an esr68 request? (Apologies for not being sure about the correct process here)

* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: Ideally some QA to ensure preferences syncing still works correctly
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Risk is limited to preferences syncing.
* **String changes made/needed**:
[Attachment #9062381](/attachment.cgi?id=9062381&action=edit "Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.") -
Flags: approval-mozilla-beta?

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8318407_16943)• 6 years ago |

[Attachment #9062380](/attachment.cgi?id=9062380&action=edit "Bug 1538015 (part 1) - test only change to tighten up the checks being made.") -
Flags: approval-mozilla-beta?

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8318410_16943)• 6 years ago |

Flags: qe-verify+

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8327053_458188)• 6 years ago |

QA Whiteboard: [qa-triaged]

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8417537_580382)• 6 years ago |

[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix)
[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1538015#c35)• 6 years ago |
|  | |

Comment on [attachment 9062380](/attachment.cgi?id=9062380 "Bug 1538015 (part 1) - test only change to tighten up the checks being made.") [[details]](/attachment.cgi?id=9062380&action=edit "Bug 1538015 (part 1) - test only change to tighten up the checks being made.")

[Bug 1538015](/show_bug.cgi?id=1538015 "VERIFIED FIXED - Revisit pref sync in to mitigate sandbox escape vector") (part 1) - test only change to tighten up the checks being made.

If we're going to want this on esr68 then might as well get it in now since it's a behaviour change. Approved for 68.0b14

[Attachment #9062380](/attachment.cgi?id=9062380&action=edit "Bug 1538015 (part 1) - test only change to tighten up the checks being made.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8417601_580382)• 6 years ago |

[Attachment #9062381](/attachment.cgi?id=9062381&action=edit "Bug 1538015 (part 2) - restrict when incoming synced prefs are applied.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1538015#c36)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/cb236393456baab3546acbe92f397cb48648cd4f>

<https://hg.mozilla.org/releases/mozilla-beta/rev/61169eb427180be0b3b8fbbd9c2ef2e7f185a2ae>

[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=fixed)Flags: in-testsuite+

|  | [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1538015#c37)• 6 years ago |
|  | |

<https://support.mozilla.org/en-US/kb/sync-custom-preferences> is now live.

|  | [ovidiu boca[:Ovidiu]](/user_profile?user_id=551038) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1538015#c38)• 6 years ago |
|  | |

I verified this on Mac OS X 10.14, Ubuntu 16.04, Windows 10 with FF Nightly 69.0a1(2019-06-29) and FF Beta 68.0b14 and I can confirm the fact that the sync between the prefs works as expected.

Status: RESOLVED → VERIFIED
[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=verified)
[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=verified)Flags: qe-verify+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8824995_280903)• 6 years ago |

Whiteboard: [adv-main68-]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1538015#c39)• 6 years ago |
|  | |

[Tracking Requested - why for this release]:

Julien: why was this wontfixed for esr-60? this is one of the ways to break/hinder one of the pwn2own sandbox-escapes that ZDI is going to blog about. Resetting tracking flags to see if there was more behind this or if it was just a reflexive response to "not sec-high".

[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F)Flags: needinfo?(jcristau)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1538015#c40)• 6 years ago |
|  | |

It was a response to "not sec-high, behaviour change that might break stuff for people, late in the esr60 lifecycle". If we want to take it anyway because it's going to go public, that's fine.

Flags: needinfo?(jcristau)

|  | [Thom Chiovoloni [:tcsc] (ex-moco)](/user_profile?user_id=567427) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1538015#c41)• 6 years ago |
|  | |

Attached patch

[rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch](attachment.cgi?id=9075456&action=diff)
— [Details](attachment.cgi?id=9075456&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1538015&attachment=9075456)

At request from :gijs, I've rebased these patches against `bookmarks/esr60`. 1/2 because I'm unsure if there's an easy way for me to attach multiple patches at once (My bugzilla-fu is rather rusty 😓)

|  | [Thom Chiovoloni [:tcsc] (ex-moco)](/user_profile?user_id=567427) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1538015#c42)• 6 years ago |
|  | |

Attached patch

[rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch](attachment.cgi?id=9075457&action=diff)
— [Details](attachment.cgi?id=9075457&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1538015&attachment=9075457)

Rebased patch 2/2

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1538015#c43)• 6 years ago |
|  | |

Comment on [attachment 9075457](/attachment.cgi?id=9075457 "rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch") [[details]](/attachment.cgi?id=9075457&action=edit "rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch") [[diff]](/attachment.cgi?id=9075457&action=diff "rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1538015&attachment=9075457)

rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: mitigating sec-high/crit sandbox escaping paths
* **User impact if declined**: see above
* **Fix Landed on Version**: 69, uplift to 68
* **Risk to taking this patch**: Medium
* **Why is the change risky/not risky? (and alternatives if risky)**: I mean, it's late in the cycle, yada yada, but at least there's some automated testing, it won't affect anyone except people who use sync, and even there I wouldn't expect it to affect anyone unless they rely on syncing unknown prefs, and there the impact is pretty much what we want it to be - or so we hope. It's had a good amount of baking on nightly/beta and I'm not aware of any issues. Plus, there are easy workarounds (ie pref flips) that we could deploy quickly if things really did go pearshaped. Last but not least, green trypush!
* **String or UUID changes made by this patch**: nope
[Attachment #9075457](/attachment.cgi?id=9075457&action=edit "rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch") -
Flags: approval-mozilla-esr60?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8894656_159069)• 6 years ago |

[Attachment #9075456](/attachment.cgi?id=9075456&action=edit "rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch") -
Flags: approval-mozilla-esr60?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8895889_75935)• 6 years ago |

[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F) → [68+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=68%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8897619_280903)• 6 years ago |

Whiteboard: [adv-main68-] → [adv-main68-][adv-esr60.8-]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1538015#c44)• 6 years ago |
|  | |

Comment on [attachment 9075456](/attachment.cgi?id=9075456 "rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch") [[details]](/attachment.cgi?id=9075456&action=edit "rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch") [[diff]](/attachment.cgi?id=9075456&action=diff "rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1538015&attachment=9075456)
rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch
Helps mitigate a sandbox escape. Approved for 60.8esr.
[Attachment #9075456](/attachment.cgi?id=9075456&action=edit "rebased vs ESR60: 0001-Bug-1538015-part-1-test-only-change-to-tighten-up-th.patch") -
Flags: approval-mozilla-esr60? → approval-mozilla-esr60+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8899976_75935)• 6 years ago |

[Attachment #9075457](/attachment.cgi?id=9075457&action=edit "rebased vs ESR60: 0002-Bug-1538015-part-2-restrict-when-incoming-synced-pre.patch") -
Flags: approval-mozilla-esr60? → approval-mozilla-esr60+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1538015#c45)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/9d066208192089152b2f58379e6acd3e5360c242>

<https://hg.mozilla.org/releases/mozilla-esr60/rev/cbdd37ea216336ed423014d5607a8a26dfece5a8>

[tracking-firefox68](/buglist.cgi?f1=cf_tracking_firefox68&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox68&o1=equals&v1=%2B)
[tracking-firefox69](/buglist.cgi?f1=cf_tracking_firefox69&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox69&o1=equals&v1=%2B)Flags: qe-verify+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a8900123_75935)• 6 years ago |

[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [ovidiu boca[:Ovidiu]](/user_profile?user_id=551038) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1538015#c46)• 6 years ago |
|  | |

I verified this on Firefox ESR 60.8.0 with Mac OS X 10.14, Windows 10 and Ubuntu 16.04 and I can confirm the fix.

[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified)Flags: qe-verify+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1538015#c47)• 6 years ago |
|  | |

NI Julien for the relnote request since this is shipping in 68.

Flags: needinfo?(jcristau)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1538015#c48)• 6 years ago |
|  | |

Added to the draft release notes for 68. I'll also include it for 60.8.0esr.

[relnote-firefox](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=%3F) → [68+](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=68%2B)Flags: needinfo?(jcristau)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a10277058_1689)• 6 years ago |

Keywords: [sec-want](/buglist.cgi?keywords=sec-want&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a10949888_1689)• 5 years ago |

Alias: CVE-2019-11732

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a38133522_1689)• 5 years ago |

Group: core-security-release

|  | [Mathew Hodson](/user_profile?user_id=515012) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1538015#a143688930_515012)• 1 year ago |

Blocks: [1854698](/show_bug.cgi?id=1854698 "RESOLVED FIXED - Remove ability to sync arbitrary preferences not locally whitelisted, and tweak logging output")
You need to [log in](/show_bug.cgi?id=1538015&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Mark Hammond [:markh] [:mhammond]](/user_profile?user_id=16943)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


