=== Content from github.com_0d81e9d2_20250121_010632.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fpull%2F66)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fpull%2F66)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=doorkeeper-gem%2Fdoorkeeper-openid_connect)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[doorkeeper-gem](/doorkeeper-gem)
/
**[doorkeeper-openid\_connect](/doorkeeper-gem/doorkeeper-openid_connect)**
Public

* [Notifications](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect) You must be signed in to change notification settings
* [Fork
  117](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect)
* [Star
   176](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect)

* [Code](/doorkeeper-gem/doorkeeper-openid_connect)
* [Issues
  22](/doorkeeper-gem/doorkeeper-openid_connect/issues)
* [Pull requests
  2](/doorkeeper-gem/doorkeeper-openid_connect/pulls)
* [Actions](/doorkeeper-gem/doorkeeper-openid_connect/actions)
* [Projects
  0](/doorkeeper-gem/doorkeeper-openid_connect/projects)
* [Wiki](/doorkeeper-gem/doorkeeper-openid_connect/wiki)
* [Security](/doorkeeper-gem/doorkeeper-openid_connect/security)
* [Insights](/doorkeeper-gem/doorkeeper-openid_connect/pulse)

Additional navigation options

* [Code](/doorkeeper-gem/doorkeeper-openid_connect)
* [Issues](/doorkeeper-gem/doorkeeper-openid_connect/issues)
* [Pull requests](/doorkeeper-gem/doorkeeper-openid_connect/pulls)
* [Actions](/doorkeeper-gem/doorkeeper-openid_connect/actions)
* [Projects](/doorkeeper-gem/doorkeeper-openid_connect/projects)
* [Wiki](/doorkeeper-gem/doorkeeper-openid_connect/wiki)
* [Security](/doorkeeper-gem/doorkeeper-openid_connect/security)
* [Insights](/doorkeeper-gem/doorkeeper-openid_connect/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Validate redirect\_uri when handling custom params #66

 Merged

[toupeira](/toupeira)
merged 1 commit into
[master](/doorkeeper-gem/doorkeeper-openid_connect/tree/master "doorkeeper-gem/doorkeeper-openid_connect:master")
from
[bug/invalid-redirect-uri](/doorkeeper-gem/doorkeeper-openid_connect/tree/bug/invalid-redirect-uri "doorkeeper-gem/doorkeeper-openid_connect:bug/invalid-redirect-uri")

Feb 15, 2019

 Merged

# [Validate redirect\_uri when handling custom params](#top) #66

[toupeira](/toupeira)
merged 1 commit into
[master](/doorkeeper-gem/doorkeeper-openid_connect/tree/master "doorkeeper-gem/doorkeeper-openid_connect:master")
from
[bug/invalid-redirect-uri](/doorkeeper-gem/doorkeeper-openid_connect/tree/bug/invalid-redirect-uri "doorkeeper-gem/doorkeeper-openid_connect:bug/invalid-redirect-uri")

Feb 15, 2019

[Conversation
2](/doorkeeper-gem/doorkeeper-openid_connect/pull/66)
[Commits
1](/doorkeeper-gem/doorkeeper-openid_connect/pull/66/commits)
[Checks
0](/doorkeeper-gem/doorkeeper-openid_connect/pull/66/checks)
[Files changed](/doorkeeper-gem/doorkeeper-openid_connect/pull/66/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![toupeira](https://avatars.githubusercontent.com/u/6501?s=60&v=4)](/toupeira)

Copy link

Member

### @toupeira **[toupeira](/toupeira)** commented [Feb 8, 2019](#issue-408252887)

Fixes [#61](https://github.com/doorkeeper-gem/doorkeeper-openid_connect/issues/61)

Sorry, something went wrong.

All reactions

[![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)
[toupeira](/toupeira)
added
the
[bug](/doorkeeper-gem/doorkeeper-openid_connect/labels/bug)
label
[Feb 8, 2019](#event-2127704207)

[![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)
[toupeira](/toupeira)
self-assigned this
[Feb 8, 2019](#event-2127704228)

[![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)
[toupeira](/toupeira)
mentioned this pull request
[Feb 8, 2019](#ref-issue-407501699)

[Open redirect vulnerability when `prompt=none`
#61](/doorkeeper-gem/doorkeeper-openid_connect/issues/61)

Closed

 [![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)
[toupeira](/toupeira)
requested review from
[nashby](/nashby) and
[nbulaj](/nbulaj)
[February 8, 2019 17:38](#event-2127713473)

[![toupeira](https://avatars.githubusercontent.com/u/6501?s=60&v=4)](/toupeira)

**[toupeira](/toupeira)**
commented
[Feb 8, 2019](#pullrequestreview-201701062)

 [View reviewed changes](/doorkeeper-gem/doorkeeper-openid_connect/pull/66/files)

[spec/controllers/doorkeeper/authorizations\_controller\_spec.rb](/doorkeeper-gem/doorkeeper-openid_connect/pull/66/files#diff-799de45b431974eaf1a04a4a7e8f4d747eef01bc1a79b09bd94f7d236ffd3cb4)

Show resolved

Hide resolved

[![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)

`[Validate pre_authorization when handling custom params](/doorkeeper-gem/doorkeeper-openid_connect/pull/66/commits/801d1d7a42bc293dce48f0a871be1b88d42c9ef9 "Validate pre_authorization when handling custom params

This fixes an open redirect vulnerability when being passed an invalid
redirect_uri, and also prioritizes any other pre-authorization
validation errors from Doorkeeper.")`
 …

`[801d1d7](/doorkeeper-gem/doorkeeper-openid_connect/pull/66/commits/801d1d7a42bc293dce48f0a871be1b88d42c9ef9)`

```
This fixes an open redirect vulnerability when being passed an invalid
redirect_uri, and also prioritizes any other pre-authorization
validation errors from Doorkeeper.
```

 [![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)
[toupeira](/toupeira)
[force-pushed](/doorkeeper-gem/doorkeeper-openid_connect/compare/41687cb422e5c2466bec9f8c7546b2cfbb4a2697..801d1d7a42bc293dce48f0a871be1b88d42c9ef9)
the
bug/invalid-redirect-uri

branch
from
[`41687cb`](/doorkeeper-gem/doorkeeper-openid_connect/commit/41687cb422e5c2466bec9f8c7546b2cfbb4a2697) to
[`801d1d7`](/doorkeeper-gem/doorkeeper-openid_connect/commit/801d1d7a42bc293dce48f0a871be1b88d42c9ef9)  [Compare](/doorkeeper-gem/doorkeeper-openid_connect/compare/41687cb422e5c2466bec9f8c7546b2cfbb4a2697..801d1d7a42bc293dce48f0a871be1b88d42c9ef9)
[February 15, 2019 08:49](#event-2141862641)

[![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)
[toupeira](/toupeira)
merged commit [`0267515`](/doorkeeper-gem/doorkeeper-openid_connect/commit/0267515452c33e0432971b03f4252d391c00ef07)
into
master

[Feb 15, 2019](https://github.com/doorkeeper-gem/doorkeeper-openid_connect/pull/66#event-2141939484)

 [![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira)
[toupeira](/toupeira)
deleted the
bug/invalid-redirect-uri

branch
[February 15, 2019 09:24](#event-2141939555)

[![@rschultheis](https://avatars.githubusercontent.com/u/774398?s=40&v=4)](/rschultheis)
[rschultheis](/rschultheis)
mentioned this pull request
[Jun 18, 2019](#ref-pullrequest-457618352)

[Add CVE-2019-9837 for doorkeeper-openid\_connect
rubysec/ruby-advisory-db#393](/rubysec/ruby-advisory-db/pull/393)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fpull%2F66)

Reviewers

[![@nashby](https://avatars.githubusercontent.com/u/200500?s=40&v=4)](/nashby) [nashby](/nashby)

 Awaiting requested review from nashby

[![@nbulaj](https://avatars.githubusercontent.com/u/1443426?s=40&v=4)](/nbulaj) [nbulaj](/nbulaj)

 Awaiting requested review from nbulaj

Assignees

[![@toupeira](https://avatars.githubusercontent.com/u/6501?s=40&v=4)](/toupeira) [toupeira](/toupeira)

Labels

[bug](/doorkeeper-gem/doorkeeper-openid_connect/labels/bug)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

1 participant

[![@toupeira](https://avatars.githubusercontent.com/u/6501?s=52&v=4)](/toupeira)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6b07831e_20250121_010631.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fissues%2F61)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fissues%2F61)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=doorkeeper-gem%2Fdoorkeeper-openid_connect)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[doorkeeper-gem](/doorkeeper-gem)
/
**[doorkeeper-openid\_connect](/doorkeeper-gem/doorkeeper-openid_connect)**
Public

* [Notifications](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect) You must be signed in to change notification settings
* [Fork
  117](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect)
* [Star
   176](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect)

* [Code](/doorkeeper-gem/doorkeeper-openid_connect)
* [Issues
  22](/doorkeeper-gem/doorkeeper-openid_connect/issues)
* [Pull requests
  2](/doorkeeper-gem/doorkeeper-openid_connect/pulls)
* [Actions](/doorkeeper-gem/doorkeeper-openid_connect/actions)
* [Projects
  0](/doorkeeper-gem/doorkeeper-openid_connect/projects)
* [Wiki](/doorkeeper-gem/doorkeeper-openid_connect/wiki)
* [Security](/doorkeeper-gem/doorkeeper-openid_connect/security)
* [Insights](/doorkeeper-gem/doorkeeper-openid_connect/pulse)

Additional navigation options

* [Code](/doorkeeper-gem/doorkeeper-openid_connect)
* [Issues](/doorkeeper-gem/doorkeeper-openid_connect/issues)
* [Pull requests](/doorkeeper-gem/doorkeeper-openid_connect/pulls)
* [Actions](/doorkeeper-gem/doorkeeper-openid_connect/actions)
* [Projects](/doorkeeper-gem/doorkeeper-openid_connect/projects)
* [Wiki](/doorkeeper-gem/doorkeeper-openid_connect/wiki)
* [Security](/doorkeeper-gem/doorkeeper-openid_connect/security)
* [Insights](/doorkeeper-gem/doorkeeper-openid_connect/pulse)

# Open redirect vulnerability when `prompt=none` #61

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Open redirect vulnerability when `prompt=none`](#top)#61Copy link![@meagar](https://avatars.githubusercontent.com/u/242474?v=4&size=80)
## Description

![@meagar](https://avatars.githubusercontent.com/u/242474?v=4&size=48)[meagar](https://github.com/meagar)opened [on Feb 7, 2019](https://github.com/doorkeeper-gem/doorkeeper-openid_connect/issues/61#issue-407501699)

tl;dr Doorkeeper OIDC can be provoked to blindly redirect the browser to whatever site is sent in `redirect_uri` paramter when `prompt=none`.

---

Given an otherwise valid authorization attempt with `prompt=none`, if an error can be provoked, the user is redirected to whatever redirect URI is passed in through the `redirect_uri` parameter with an error message in the query string.

For example, assume I have a Doorkeeper-backed Identity provider at `identity-provider.com`. It has an application with a client ID of `123` and a redirect-URI of `https://real-site.com/callback`.

If I have previously authorized with `identity-provider.com` with the `openid profile` claims, and I issue a new authorization request with only the `openid` scope, and `prompt=none`, an error is raised because the claims I'm requesting don't match the claims I previously authorized, but `prompt=none` prevents me from reauthorizing.

The error causes me to be redirected to whatever `redirect_uri` is included in the request, **even if it's not a valid whitelisted redirect URI for the subject application**.

A sample request, assuming I'm already authorized (newlines added for clarity):

```
https://identity-provider.com/oauth/authorize?
  client_id=123
  redirect_uri=https%3A%2F%2Fattacksite.com&
  response_type=code&
  scope=openid&
  prompt=none

```

This request sends me to (again, newlines added for clarity):

```
https://attacksite.com/?
  error=consent_required&
  error_description=The+authorization+server+requires+end-user+consent

```

At this point, `attacksite.com` can display a phishing form; given that I clicked on a link that started with `identity-provider.com` to start the authorization flow, it's possible that I can be tricked into entering my credentials into the attacking site. This is (I believe) an example of a [Dangerous URL Redirect](https://www.owasp.org/index.php/Unvalidated_Redirects_and_Forwards_Cheat_Sheet#Dangerous_URL_Redirects).

The problem seems to be in how exceptions are rescued:

<https://github.com/meagar/doorkeeper-openid_connect/blob/12685b19af46e0e1abcf6c74efe919268fec34f8/lib/doorkeeper/openid_connect/helpers/controller.rb#L22>

```
error = ::Doorkeeper::OAuth::ErrorResponse.new(
  name: exception.error_name,
  state: params[:state],
  redirect_uri: params[:redirect_uri])

```

This line extracts `redirect_uri` directly from the incoming parameters, and does nothing to validate it before redirecting the browser there on subsequent lines.

I think the correct behaviour here is to render a 422 error, rather than redirect the browser, regardless of the `prompt=none`.

👍2👀1
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_76f79a6e_20250121_010630.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fblob%2Fmaster%2FCHANGELOG.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect%2Fblob%2Fmaster%2FCHANGELOG.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=doorkeeper-gem%2Fdoorkeeper-openid_connect)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[doorkeeper-gem](/doorkeeper-gem)
/
**[doorkeeper-openid\_connect](/doorkeeper-gem/doorkeeper-openid_connect)**
Public

* [Notifications](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect) You must be signed in to change notification settings
* [Fork
  117](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect)
* [Star
   176](/login?return_to=%2Fdoorkeeper-gem%2Fdoorkeeper-openid_connect)

* [Code](/doorkeeper-gem/doorkeeper-openid_connect)
* [Issues
  22](/doorkeeper-gem/doorkeeper-openid_connect/issues)
* [Pull requests
  2](/doorkeeper-gem/doorkeeper-openid_connect/pulls)
* [Actions](/doorkeeper-gem/doorkeeper-openid_connect/actions)
* [Projects
  0](/doorkeeper-gem/doorkeeper-openid_connect/projects)
* [Wiki](/doorkeeper-gem/doorkeeper-openid_connect/wiki)
* [Security](/doorkeeper-gem/doorkeeper-openid_connect/security)
* [Insights](/doorkeeper-gem/doorkeeper-openid_connect/pulse)

Additional navigation options

* [Code](/doorkeeper-gem/doorkeeper-openid_connect)
* [Issues](/doorkeeper-gem/doorkeeper-openid_connect/issues)
* [Pull requests](/doorkeeper-gem/doorkeeper-openid_connect/pulls)
* [Actions](/doorkeeper-gem/doorkeeper-openid_connect/actions)
* [Projects](/doorkeeper-gem/doorkeeper-openid_connect/projects)
* [Wiki](/doorkeeper-gem/doorkeeper-openid_connect/wiki)
* [Security](/doorkeeper-gem/doorkeeper-openid_connect/security)
* [Insights](/doorkeeper-gem/doorkeeper-openid_connect/pulse)

## Files

 master
## Breadcrumbs

1. [doorkeeper-openid\_connect](/doorkeeper-gem/doorkeeper-openid_connect/tree/master)
/
# CHANGELOG.md

Copy path Blame  Blame
## Latest commit

## History

[History](/doorkeeper-gem/doorkeeper-openid_connect/commits/master/CHANGELOG.md)294 lines (175 loc) · 9.82 KB master
## Breadcrumbs

1. [doorkeeper-openid\_connect](/doorkeeper-gem/doorkeeper-openid_connect/tree/master)
/
# CHANGELOG.md

Top
## File metadata and controls

* Preview
* Code
* Blame

294 lines (175 loc) · 9.82 KB[Raw](https://github.com/doorkeeper-gem/doorkeeper-openid_connect/raw/refs/heads/master/CHANGELOG.md)
## Unreleased

* [#PR ID] Add your changelog entry here.
* [#216] Test against Rails 7.1, 7.2, 8.0.

## v1.8.10 (2024-11-29)

* [#215] Drop support for Ruby 2.7, 3.0 and Rails 6.
* [#209] Configuration per IdToken expiration (thanks to @martinezcoder)

## v1.8.9 (2024-05-07)

* Support Doorkeeper 5.7

## v1.8.8 (2024-02-26)

* [#201] Add back typ=JWT to header

## v1.8.7 (2023-05-18)

* [#198] Fully qualify `JWT::JWK::Thumbprint` constant with :: (thanks to @stanhu)

## v1.8.6 (2023-05-12)

* [#194] Default to RFC 7638 kid fingerprint generation (thanks to @stanhu).

## v1.8.5 (2023-02-02)

* [#186] Simplify gem configuration reusing Doorkeeper configuration option DSL (thanks to @nbulaj).
* [#182] Drop support for Ruby 2.6 and Rails 5 (thanks to @sato11).
* [#188] Fix dookeeper-jwt compatibility (thanks to @zavan).

## v1.8.4 (2023-02-01)

Note that v1.8.4 changed the default kid fingerprint generation from RFC 7638 to a format
based on the SHA256 digest of the key element. To restore the previous behavior, upgrade to v1.8.6.

* [#177] Replace `json-jwt` with `ruby-jwt` to align with doorkeeper-jwt (thanks to @kristof-mattei).
* [#185] Don't call active\_record\_options for Doorkeeper >= 5.6.3 (thanks to @zavan).
* [#183] Stop render consent screen when user is not logged-in (thanks to @nov).

## v1.8.3 (2022-12-02)

* [#180] Add PKCE support to OpenID discovery endpoint (thanks to @stanhu).

## v1.8.2 (2022-07-13)

* [#168] Allow to use custom doorkeeper access grant model (thanks @nov).
* [#170] Controllers inherit `Doorkeeper::AppliactionMetalController` (thanks @sato11).
* [#171] Correctly override `AuthorizationsController` params (thanks to @nbulaj).

## v1.8.1 (2022-02-09)

* [#153] Fix ArgumentError caused by client credential validation introduced in Doorkeeper 5.5.1 (thanks to @CircumnavigatingFlatEarther)
* [#161] Fix .well-known/openid-connect issuer (respond to block if provided) (thanks to @fkowal).
* [#152] Expose oauth-authorization-server in routes (thanks to @mitar)

## v1.8.0 (2021-05-11)

No changes from v1.8.0-rc1.

## v1.8.0-rc1 (2021-04-20)

### Upgrading

This gem now requires Doorkeeper 5.5 and Ruby 2.5.

### Changes

* [#138] Support form\_post response mode (thanks to @linhdangduy)
* [#144] Support block syntax for `issuer` configuration (thanks to @maxxsnake)
* [#145] Register token flows with the strategy instead of the token class (thanks to @paukul)

## v1.7.5 (2020-12-15)

### Changes

* [#126] Add discovery\_url\_options option for discovery endpoints URL generation (thanks to @phlegx)

### Bugfixes

* [#123] Remove reference to ApplicationRecord (thanks to @wheeyls)
* [#124] Clone doorkeeper.grant\_flows array before appending 'refresh\_token' (thanks to @davidbasalla)
* [#129] Avoid to use the config alias while supporting Doorkeeper 5.2 (thanks to @kymmt90)

## v1.7.4 (2020-07-06)

* [#119] Execute end\_session\_endpoint in the controllers context (thanks to @joeljunstrom)

## v1.7.3 (2020-07-06)

* [#111] Add configuration callback `select_account_for_resource_owner` to support the `prompt=select_account` param
* [#112] Add grant\_types\_supported to discovery response
* [#114] Fix user\_info endpoint when used in api mode
* [#116] Support Doorkeeper API (> 5.4) for registering custom grant flows.
* [#117] Fix migration template to use Rails migrations DSL for association.
* [#118] Use fragment urls for implicit flow error redirects (thanks to @joeljunstrom)

## v1.7.2 (2020-05-20)

### Changes

* [#108] Add support for Doorkeeper 5.4
* [#103] Add support for end\_session\_endpoint
* [#109] Test against Ruby 2.7 & Rails 6.x

## v1.7.1 (2020-02-07)

### Upgrading

This version adds `on_delete: :cascade` to the migration template for the `oauth_openid_requests` table, in order to fix #82.

For existing installations, you should add a new migration in your application to drop the existing foreign key and replace it with a new one with `on_delete: :cascade` included. Depending on the database you're using and the size of your application this might bring up some concerns, but in most cases the following should be sufficient:

```
class UpdateOauthOpenIdRequestsForeignKeys < ActiveRecord::Migration[5.2]
  def up
    remove_foreign_key(:oauth_openid_requests, column: :access_grant_id)
    add_foreign_key(:oauth_openid_requests, :oauth_access_grants, column: :access_grant_id, on_delete: :cascade)
  end

  def down
    remove_foreign_key(:oauth_openid_requests, column: :access_grant_id)
    add_foreign_key(:oauth_openid_requests, :oauth_access_grants, column: :access_grant_id)
  end
end
```

### Bugfixes

* [#96] Bump `json-jwt` because of CVE-2019-18848 (thanks to @leleabhinav)
* [#97] Fixes for compatibility with Doorkeeper 5.2 (thanks to @linhdangduy)
* [#98] Cascade deletes from `oauth_openid_requests` to `oauth_access_grants` (thanks to @manojmj92)
* [#99] Fix `audience` claim when application is not set on access token (thanks to @ionut998)

## v1.7.0 (2019-11-04)

### Changes

* [#85] This gem now requires Doorkeeper 5.2, Rails 5, and Ruby 2.4

## v1.6.3 (2019-09-24)

### Changes

* [#81] Allow silent authentication without user consent (thanks to @jarosan)
* Don't support Doorkeeper >= 5.2 due to breaking changes

## v1.6.2 (2019-08-09)

### Bugfixes

* [#80] Check for client presence in controller, fixes a 500 error when `client_id` is missing (thanks to @cincospenguinos @urnf @isabellechalhoub)

## v1.6.1 (2019-06-07)

### Bugfixes

* [#75] Fix return value for `after_successful_response` (thanks to @daveed)

### Changes

* [#72] Add `revocation_endpoint` and `introspection_endpoint` to discovery response (thanks to @scarfacedeb)

## v1.6.0 (2019-03-06)

### Changes

* [#70] This gem now requires Doorkeeper 5.0, and actually has done so since v1.5.4 (thanks to @michaelglass)

## v1.5.5 (2019-03-03)

* [#69] Return `crv` parameter for EC keys (thanks to @marco-nicola)

## v1.5.4 (2019-02-15)

### Bugfixes

* [#66] Fix an open redirect vulnerability ([CVE-2019-9837](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9837), thanks to @meagar)
* [#67] Don't delete existing tokens with `prompt=consent` (thanks to @nov)

### Changes

* [#62] Support customization of redirect params in `id_token` and `id_token token` responses (thanks to @meagar)

## v1.5.3 (2019-01-19)

### Bugfixes

* [#60] Don't break native authorization in Doorkeeper 5.x

### Changes

* [#58] Use versioned migrations for Rails 5.x (thanks to @tvongaza)

## v1.5.2 (2018-09-04)

### Changes

* [#56] The previous release was a bit premature, this fixes some compatibility issues with Doorkeeper 5.x

## v1.5.1 (2018-09-04)

### Changes

* [#55] This gem is now compatible with Doorkeeper 5.x

## v1.5.0 (2018-06-27)

### Features

* [#52] Custom claims can now also be returned directly in the ID token, see the updated README for usage instructions

## v1.4.0 (2018-05-31)

### Upgrading

* Support for Ruby versions older than 2.3 was dropped

### Features

* Redirect errors per Section 3.1.2.6 of OpenID Connect 1.0 (by @ryands)
* Set `id_token` when it's nil in token response (it's used in `refresh_token` requests) (by @Miouge1)

## v1.3.0 (2018-03-05)

### Features

* Support for Implicit Flow (`response_type=id_token` and `response_type=id_token token`),
  see the updated README for usage instructions (by @nashby, @nhance and @stevenvegt)

## v1.2.0 (2017-08-31)

### Upgrading

* The configuration setting `jws_private_key` was renamed to `signing_key`, you can still use the old name until it's removed in the next major release

### Features

* Support for pairwise subject identifiers (by @travisofthenorth)
* Support for EC and HMAC signing algorithms (by @110y)
* Claims now receive an optional third `access_token` argument which allow you to dynamically adjust claim values based on the client's token (by @gigr)

### Bugfixes

## v1.1.2 (2017-01-18)

### Bugfixes

* Fixes the `undefined local variable or method 'pre_auth'` error

## v1.1.1 (2017-01-18)

#### Upgrading

* The configuration setting `jws_public_key` wasn't actually used, it's deprecated now and will be removed in the next major release
* The undocumented shorthand `to_proc` syntax for defining claims (`claim :user, &:name`) is not supported anymore

#### Features

* Claims now receive an optional second `scopes` argument which allow you to dynamically adjust claim values based on the requesting applications' scopes (by @nbibler)
* The `prompt` parameter values `login` and `consent` are now supported
* The configuration setting `protocol` was added (by @gigr)

#### Bugfixes

* Standard Claims are now mapped correctly to their default scopes (by @tylerhunt)
* Blank `nonce` parameters are now ignored

#### Changes

* `nil` values and empty strings are now removed from the UserInfo and IdToken responses
* Allow `json-jwt` dependency at ~> 1.6. (by @nbibler)
* Configuration blocks no longer internally use `instance_eval` which previously gave undocumented and unexpected `self` access to the caller (by @nbibler)

## v1.1.0 (2016-11-30)

This release is a general clean-up and adds support for some advanced OpenID Connect features.

#### Upgrading

* This version adds a table to store temporary nonces, use the generator `doorkeeper:openid_connect:migration` to create a migration
* Implement the new configuration callbacks `auth_time_from_resource_owner` and `reauthenticate_resource_owner` to support advanced features

#### Features

* Add discovery endpoint ([a16caa8](/doorkeeper-gem/doorkeeper-openid_connect/commit/a16caa8))
* Add webfinger and keys endpoints for discovery ([f70898b](/doorkeeper-gem/doorkeeper-openid_connect/commit/f70898b))
* Add supported claims to discovery response ([1d8f9ea](/doorkeeper-gem/doorkeeper-openid_connect/commit/1d8f9ea))
* Support prompt=none parameter ([c775d8b](/doorkeeper-gem/doorkeeper-openid_connect/commit/c775d8b))
* Store and return nonces in IdToken responses ([d28ca8c](/doorkeeper-gem/doorkeeper-openid_connect/commit/d28ca8c))
* Add generator for initializer ([80399fd](/doorkeeper-gem/doorkeeper-openid_connect/commit/80399fd))
* Support max\_age parameter ([aabe3aa](/doorkeeper-gem/doorkeeper-openid_connect/commit/aabe3aa))
* Respect scope grants in UserInfo response ([25f2170](/doorkeeper-gem/doorkeeper-openid_connect/commit/25f2170))

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_1aaefd7e_20250121_031525.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  ( (" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? ���r=;F��kfoe�X�˹?19�c�E�Yƚl�:+\�LI'�#'�����A��֑�K���vp�Gkd���f��"�C8�#��s�OdJW8s��ogz���&�\*�%yoQ���V��mt,���H�-s���8�~���K},r\�Gu����?�k�ұoṢ&5�bR5$�$�{n?�\_2h�S�efy��3�NG�� Z���� �\_�jꤶP<ǐrq����L�<�� �b��Z�4Ă&��p��h��#�޵��Y���1:m�i�`FzwՃ��o��"�j�ސr�w$k���Ͽ�0I�˩)��G���>��Q�+���\_�8 q�ӎ���.���{nd@Byr�lz��+۫�{��s?���ci��x���M>cq5�(o#Eh�>2  �Ѻ�ʮ4�V��k��b��i�i�T�D��W�7�����,���ʹI�ĎF �A�h� �荒 ������00�X� � 3�֜��7Q׮MQn�?��[O�򊐌�`�H���oC��X��\_Ɉ��?/Pzs�U]\_�t\_���i?����~�%�u�O��nf�<��������������Y42.���
