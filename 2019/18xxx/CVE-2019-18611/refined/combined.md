=== Content from phabricator.wikimedia.org_a2a45aad_20250121_010116.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT234862)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T234862
# Do not show oversighted edit summaries in CheckUser API (CVE-2019-18611)Closed, Resolved[Public](/policy/explain/PHID-TASK-rllidl7bdryavdppuea3/view/)Actions

* [Edit Task](/maniphest/task/edit/234862/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/234862/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-rllidl7bdryavdppuea3/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-rllidl7bdryavdppuea3/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-rllidl7bdryavdppuea3/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-rllidl7bdryavdppuea3/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-rllidl7bdryavdppuea3/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-rllidl7bdryavdppuea3/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-rllidl7bdryavdppuea3/)
* [Protect as security issue](/wmf/escalate-task/234862/)
* [Award Token](/token/give/PHID-TASK-rllidl7bdryavdppuea3/)
* [Flag For Later](/flag/edit/PHID-TASK-rllidl7bdryavdppuea3/)

Assigned To

|  | [Urbanecm](/p/Urbanecm/) |
| --- | --- |

Authored By

|  | [sbassett](/p/sbassett/) |
| --- | --- |
| Oct 7 2019, 9:23 PM2019-10-07 21:23:45 (UTC+0) |

Tags

* [CheckUser](/tag/checkuser/) [(Inbox)](/project/board/203/)
* [MediaWiki-Action-API](/tag/mediawiki-action-api/) [(Non-core-API stuff)](/project/board/200/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [User-Urbanecm](/tag/user-urbanecm/) [(Waiting on review)](/project/board/2098/)
* [MW-1.35-notes (1.35.0-wmf.4; 2019-10-29)](/project/view/4331/)
* [Security](/tag/security/)
Referenced Files

|  | [F30602966: 01-T234862.patch](/F30602966) |
| --- | --- |
| Oct 9 2019, 10:21 AM2019-10-09 10:21:55 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [Amorymeltzer](/p/Amorymeltzer/) |
| --- | --- |

|  | [Daimona](/p/Daimona/) |
| --- | --- |

|  | [Niharika](/p/Niharika/) |
| --- | --- |

|  | [Reedy](/p/Reedy/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

|  | [Umherirrender](/p/Umherirrender/) |
| --- | --- |

[View All 9 Subscribers](/subscriptions/list/PHID-TASK-rllidl7bdryavdppuea3/)
# Description

Per, [@Umherirrender](/p/Umherirrender/)'s comment at T207094#5553504: we need to verify whether or not the API is leaking the same information as the issue within the parent task and, if it is, create and deploy a security patch.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Do not show oversighted edit summaries in CheckUser API](https://gerrit.wikimedia.org/r/c/546741) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/master) | +29 -2 |
|  | [SECURITY: Do not show oversighted edit summaries in CheckUser API](https://gerrit.wikimedia.org/r/c/546742) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [REL1\_34](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/REL1_34) | +29 -2 |
|  | [SECURITY: Do not show oversighted edit summaries in CheckUser API](https://gerrit.wikimedia.org/r/c/546743) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [REL1\_33](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/REL1_33) | +29 -2 |
|  | [SECURITY: Do not show oversighted edit summaries in CheckUser API](https://gerrit.wikimedia.org/r/c/546746) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [REL1\_31](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/REL1_31) | +29 -2 |
|  | [SECURITY: Do not show oversighted edit summaries in CheckUser API](https://gerrit.wikimedia.org/r/c/546745) | [mediawiki/extensions/CheckUser](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser) | [REL1\_32](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/CheckUser/%2B/REL1_32) | +29 -2 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T234862)
# Related ObjectsSearch...

* Task Graph
* Mentions

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  |  |  |  | Restricted Task |
|  |  | Resolved |  | [Urbanecm](/p/Urbanecm/) | T234862 [Do not show oversighted edit summaries in CheckUser API (CVE-2019-18611)](/T234862) |

Mentioned In [T250446: CheckUser internal API error](/T250446)
[T234983: Write and send supplementary release announcement for extensions and skins with security patches (MediaWiki 1.31.6/1.32.6/1.33.2)](/T234983) Mentioned Here [T234983: Write and send supplementary release announcement for extensions and skins with security patches (MediaWiki 1.31.6/1.32.6/1.33.2)](/T234983)
### Event Timeline

[sbassett](/p/sbassett/) created this task.[Oct 7 2019, 9:23 PM2019-10-07 21:23:45 (UTC+0)](#5553784)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/3335448/)[Oct 7 2019, 9:23 PM2019-10-07 21:23:47 (UTC+0)](#5553796)[sbassett](/p/sbassett/) triaged this task as Medium priority.[Oct 7 2019, 9:25 PM2019-10-07 21:25:15 (UTC+0)](#5553800)[sbassett](/p/sbassett/) added projects: [CheckUser](/tag/checkuser/), [MediaWiki-Action-API](/tag/mediawiki-action-api/), [Vuln-Infoleak](/tag/vuln-infoleak/).[sbassett](/p/sbassett/) added subscribers: [Daimona](/p/Daimona/), [Reedy](/p/Reedy/), [Anomie](/p/Anomie/), [Urbanecm](/p/Urbanecm/).Restricted Application added a project: [Platform Engineering](/tag/platform_engineering/).  · [View Herald Transcript](/herald/transcript/3335454/)[Oct 7 2019, 9:26 PM2019-10-07 21:26:14 (UTC+0)](#5553804)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ehc4lghmmgdeuh5/)[Oct 7 2019, 9:26 PM2019-10-07 21:26:42 (UTC+0)](#5553805)[Anomie](/p/Anomie/) moved this task from [Unsorted](/project/board/200/) to [Non-core-API stuff](/project/board/200/) on the [MediaWiki-Action-API](/tag/mediawiki-action-api/) board.[Oct 7 2019, 9:59 PM2019-10-07 21:59:09 (UTC+0)](#5553870)[Niharika](/p/Niharika/) subscribed.[Oct 8 2019, 2:56 AM2019-10-08 02:56:17 (UTC+0)](#5554225)[Anomie](/p/Anomie/) moved this task from [Inbox](/project/board/3654/) to [Triage Meeting Inbox](/project/board/3654/) on the [Platform Engineering](/tag/platform_engineering/) board.[Oct 8 2019, 1:18 PM2019-10-08 13:18:37 (UTC+0)](#5555457)[• WDoranWMF](/p/WDoranWMF/) edited projects, added [Platform Team Workboards (Clinic Duty Team)](/project/view/4149/); removed [Platform Engineering](/tag/platform_engineering/).[Oct 8 2019, 6:41 PM2019-10-08 18:41:09 (UTC+0)](#5557088)[• WDoranWMF](/p/WDoranWMF/) subscribed.Comment Actions

[@Daimona](/p/Daimona/) or [@Urbanecm](/p/Urbanecm/) Would you have any thoughts on investigating this?

[• WDoranWMF](/p/WDoranWMF/) moved this task from [Inbox](/project/board/4149/) to [Discussing](/project/board/4149/) on the [Platform Team Workboards (Clinic Duty Team)](/project/view/4149/) board.[Oct 8 2019, 6:41 PM2019-10-08 18:41:20 (UTC+0)](#5557091)[Urbanecm](/p/Urbanecm/) claimed this task.[Oct 8 2019, 10:01 PM2019-10-08 22:01:51 (UTC+0)](#5557803)Restricted Application added a project: [User-Urbanecm](/tag/user-urbanecm/).  · [View Herald Transcript](/herald/transcript/3337644/)[Oct 8 2019, 10:01 PM2019-10-08 22:01:52 (UTC+0)](#5557804)

[Urbanecm](/p/Urbanecm/) added a comment.[Oct 9 2019, 10:21 AM2019-10-09 10:21:55 (UTC+0)](#5558854)Comment Actions

Basically duplicated my code from the previous patch to the API module, thanks for spotting this. Not sure how to incorporate [@Umherirrender](/p/Umherirrender/)'s edits made in [https://gerrit.wikimedia.org/r/c/mediawiki/extensions/CheckUser/+/541606](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/CheckUser/%2B/541606), any suggestions?

01-T234862.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/ye3fwcxh5esqjbvimqcf/PHID-FILE-32nmsz37cl4vkh3732ft/01-T234862.patch)

[Urbanecm](/p/Urbanecm/) moved this task from [Backlog](/project/board/2098/) to [Working on](/project/board/2098/) on the [User-Urbanecm](/tag/user-urbanecm/) board.[Oct 11 2019, 11:39 AM2019-10-11 11:39:52 (UTC+0)](#5566247)[sbassett](/p/sbassett/) added a comment.[Oct 16 2019, 9:01 PM2019-10-16 21:01:31 (UTC+0)](#5582124)Comment Actions

[@Urbanecm](/p/Urbanecm/) -

1. + 1 to the patch above ([T234862#5558854](/T234862#5558854)) **as-is**. It mostly mirrors the patch for T207094, which should be fine.
2. To incorporate [@Umherirrender](/p/Umherirrender/)'s changes from [r541606](https://gerrit.wikimedia.org/r/541606), I think we could do something like [this](https://gerrit.wikimedia.org/r/c/mediawiki/extensions/CheckUser/%2B/541606/2/includes/specials/SpecialCheckUser.php#1867) in includes/api/ApiQueryCheckUser.php. Once [r541606](https://gerrit.wikimedia.org/r/541606) is merged, we could maybe make loadRevisionRecords() static, add the appropriate use statements and do:

```
// around line 112 w/ T234862#5558854 applied
$revisionRecord = SpecialCheckUser::loadRevisionRecords( $result )
```

```
// around lines 126 to 149 w/ T234862#5558854 applied
$revisionRecord = $revisionRecords[$row->cuc_this_oldid] ?? false;
if ( $revisionRecord !== false &&
    $revisionRecord->audienceCan(
        RevisionRecord::DELETED_COMMENT, RevisionRecord::FOR_THIS_USER, $this->getUser()
    )
)
```

We might just want to get this security-deployed **as-is** for now (with the patch from [T234862#5558854](/T234862#5558854)) and push the improvements through gerrit as is being done for the parent patch, as I believe this version of the code shouldn't have any performance issues.

[Urbanecm](/p/Urbanecm/) moved this task from [Discussing](/project/board/4149/) to [Waiting for deployment](/project/board/4149/) on the [Platform Team Workboards (Clinic Duty Team)](/project/view/4149/) board.[Oct 18 2019, 4:02 PM2019-10-18 16:02:00 (UTC+0)](#5587213)[Urbanecm](/p/Urbanecm/) moved this task from [Backlog / Other](/project/board/30/) to [Pending deployment / release](/project/board/30/) on the [acl\*security](/tag/acl_security/) board.[sbassett](/p/sbassett/) added a comment.[Oct 18 2019, 6:35 PM2019-10-18 18:35:01 (UTC+0)](#5587738)Comment Actions

[@Urbanecm](/p/Urbanecm/) - did you want to deploy your patch from [T234862#5558854](/T234862#5558854)? If not, I'm happy to deploy it on Monday (2019-10-21) during the [security deployment window](https://wikitech.wikimedia.org/wiki/Deployments#deploycal-item-20191021T2100).

[sbassett](/p/sbassett/) mentioned this in [T234983: Write and send supplementary release announcement for extensions and skins with security patches (MediaWiki 1.31.6/1.32.6/1.33.2)](/T234983).[Oct 18 2019, 6:36 PM2019-10-18 18:36:49 (UTC+0)](#5587743)[sbassett](/p/sbassett/) added a project: [user-sbassett](/tag/user-sbassett/).[sbassett](/p/sbassett/) moved this task from [Backlog](/project/board/3979/) to [Waiting](/project/board/3979/) on the [user-sbassett](/tag/user-sbassett/) board.

[Urbanecm](/p/Urbanecm/) added a comment.[Oct 18 2019, 8:53 PM2019-10-18 20:53:01 (UTC+0)](#5588020)Comment Actions

i can do so :)

[Urbanecm](/p/Urbanecm/) added a comment.[Oct 21 2019, 12:14 PM2019-10-21 12:14:04 (UTC+0)](#5591510)Comment Actions

Patch was deployed today.

[sbassett](/p/sbassett/) added a comment.[Oct 21 2019, 10:02 PM2019-10-21 22:02:13 (UTC+0)](#5593268)Comment Actions
> In [T234862#5591510](/T234862#5591510), [@Urbanecm](/p/Urbanecm/) wrote:
>
> Patch was deployed today.

Thanks, I'll request a CVE soon. Also tracking in [T234983](/T234983).

[Urbanecm](/p/Urbanecm/) moved this task from [Working on](/project/board/2098/) to [Waiting on review](/project/board/2098/) on the [User-Urbanecm](/tag/user-urbanecm/) board.[Oct 23 2019, 7:03 AM2019-10-23 07:03:33 (UTC+0)](#5597500)[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-fk6sjd7xxcrfkni/)" to "Public (No Login Required)".[Oct 28 2019, 9:24 PM2019-10-28 21:24:21 (UTC+0)](#5613485)[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:24 PM2019-10-28 21:24:45 (UTC+0)](#5613486)Comment Actions

Change 546741 had a related patch set uploaded (by SBassett; owner: Urbanecm):

[mediawiki/extensions/CheckUser@master] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546741>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Oct 28 2019, 9:24 PM2019-10-28 21:24:46 (UTC+0)](#5613487)Comment Actions

Change 546742 had a related patch set uploaded (by SBassett; owner: Urbanecm):

[mediawiki/extensions/CheckUser@REL1\_34] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546742>

[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:26 PM2019-10-28 21:26:02 (UTC+0)](#5613491)Comment Actions

Change 546743 had a related patch set uploaded (by SBassett; owner: Urbanecm):

[mediawiki/extensions/CheckUser@REL1\_33] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546743>

[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:26 PM2019-10-28 21:26:22 (UTC+0)](#5613492)Comment Actions

Change 546745 had a related patch set uploaded (by SBassett; owner: Urbanecm):

[mediawiki/extensions/CheckUser@REL1\_32] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546745>

[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:26 PM2019-10-28 21:26:37 (UTC+0)](#5613493)Comment Actions

Change 546746 had a related patch set uploaded (by SBassett; owner: Urbanecm):

[mediawiki/extensions/CheckUser@REL1\_31] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546746>

[Amorymeltzer](/p/Amorymeltzer/) subscribed.[Oct 28 2019, 9:30 PM2019-10-28 21:30:24 (UTC+0)](#5613499)[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:38 PM2019-10-28 21:38:23 (UTC+0)](#5613514)Comment Actions

Change 546746 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@REL1\_31] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546746>

[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:38 PM2019-10-28 21:38:43 (UTC+0)](#5613515)Comment Actions

Change 546745 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@REL1\_32] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546745>

[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:38 PM2019-10-28 21:38:45 (UTC+0)](#5613516)Comment Actions

Change 546742 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@REL1\_34] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546742>

[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:39 PM2019-10-28 21:39:26 (UTC+0)](#5613519)Comment Actions

Change 546743 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@REL1\_33] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546743>

[gerritbot](/p/gerritbot/) added a comment.[Oct 28 2019, 9:47 PM2019-10-28 21:47:56 (UTC+0)](#5613542)Comment Actions

Change 546741 **merged** by jenkins-bot:

[mediawiki/extensions/CheckUser@master] SECURITY: Do not show oversighted edit summaries in CheckUser API

<https://gerrit.wikimedia.org/r/546741>

[sbassett](/p/sbassett/) added a comment.Edited · [Oct 28 2019, 9:53 PM2019-10-28 21:53:29 (UTC+0)](#5613565)Comment Actions

Backports to [supported release branches](https://www.mediawiki.org/wiki/Version_lifecycle) merged, CVE requested. I'll update this task and [T234983](/T234983) once I have the CVE ID.

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.35-notes (1.35.0-wmf.4; 2019-10-29)](/project/view/4331/).[Oct 28 2019, 10:00 PM2019-10-28 22:00:59 (UTC+0)](#5613583)[Maintenance\_bot](/p/Maintenance_bot/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Oct 28 2019, 10:10 PM2019-10-28 22:10:36 (UTC+0)](#5613614)[• WDoranWMF](/p/WDoranWMF/) removed a project: [Platform Team Workboards (Clinic Duty Team)](/project/view/4149/).[Oct 29 2019, 3:18 PM2019-10-29 15:18:52 (UTC+0)](#5615596)[sbassett](/p/sbassett/) renamed this task from Verify that the MediaWiki API is not leaking Oversighted edit summaries within CheckUser results to Verify that the MediaWiki API is not leaking Oversighted edit summaries within CheckUser results (CVE-2019-18611).[Oct 29 2019, 3:48 PM2019-10-29 15:48:39 (UTC+0)](#5615775)[sbassett](/p/sbassett/) closed this task as Resolved.[Oct 29 2019, 3:50 PM2019-10-29 15:50:44 (UTC+0)](#5615782)[sbassett](/p/sbassett/) moved this task from [Waiting](/project/board/3979/) to [Done](/project/board/3979/) on the [user-sbassett](/tag/user-sbassett/) board.[Oct 29 2019, 3:52 PM2019-10-29 15:52:58 (UTC+0)](#5615789)[sbassett](/p/sbassett/) removed a project: [user-sbassett](/tag/user-sbassett/).[sbassett](/p/sbassett/) renamed this task from Verify that the MediaWiki API is not leaking Oversighted edit summaries within CheckUser results (CVE-2019-18611) to Do not show oversighted edit summaries in CheckUser API (CVE-2019-18611).[Dec 19 2019, 6:10 PM2019-12-19 18:10:21 (UTC+0)](#5754880)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:56 PM2020-02-10 22:56:39 (UTC+0)](#5868933) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:16 PM2020-02-20 20:16:25 (UTC+0)](#5904404) · [DannyS712](/p/DannyS712/) mentioned this in [T250446: CheckUser internal API error](/T250446).[Apr 16 2020, 10:44 PM2020-04-16 22:44:13 (UTC+0)](#6064510)[Aklapper](/p/Aklapper/) removed a subscriber: [Anomie](/p/Anomie/).[Oct 16 2020, 5:41 PM2020-10-16 17:41:36 (UTC+0)](#6554651) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from gerrit.wikimedia.org_4f84d897_20250121_010115.html ===



