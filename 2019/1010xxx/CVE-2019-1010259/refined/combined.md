=== Content from github.com_4e904d43_20250120_232553.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fblob%2Ff22de0887cd7167887f113bf394244b74fb36b6b%2Fsalt%2Fmodules%2Fmysql.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fblob%2Ff22de0887cd7167887f113bf394244b74fb36b6b%2Fsalt%2Fmodules%2Fmysql.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=saltstack%2Fsalt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saltstack](/saltstack)
/
**[salt](/saltstack/salt)**
Public

* [Notifications](/login?return_to=%2Fsaltstack%2Fsalt) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaltstack%2Fsalt)
* [Star
   14.3k](/login?return_to=%2Fsaltstack%2Fsalt)

* [Code](/saltstack/salt)
* [Issues
  2.7k](/saltstack/salt/issues)
* [Pull requests
  250](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects
  4](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

Additional navigation options

* [Code](/saltstack/salt)
* [Issues](/saltstack/salt/issues)
* [Pull requests](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

## Files

 f22de08
## Breadcrumbs

1. [salt](/saltstack/salt/tree/f22de0887cd7167887f113bf394244b74fb36b6b)
2. /[salt](/saltstack/salt/tree/f22de0887cd7167887f113bf394244b74fb36b6b/salt)
3. /[modules](/saltstack/salt/tree/f22de0887cd7167887f113bf394244b74fb36b6b/salt/modules)
/
# mysql.py

Copy path Blame  Blame
## Latest commit

## History

[History](/saltstack/salt/commits/f22de0887cd7167887f113bf394244b74fb36b6b/salt/modules/mysql.py)2339 lines (1924 loc) · 69.6 KB f22de08
## Breadcrumbs

1. [salt](/saltstack/salt/tree/f22de0887cd7167887f113bf394244b74fb36b6b)
2. /[salt](/saltstack/salt/tree/f22de0887cd7167887f113bf394244b74fb36b6b/salt)
3. /[modules](/saltstack/salt/tree/f22de0887cd7167887f113bf394244b74fb36b6b/salt/modules)
/
# mysql.py

Top
## File metadata and controls

* Code
* Blame

2339 lines (1924 loc) · 69.6 KB[Raw](https://github.com/saltstack/salt/raw/f22de0887cd7167887f113bf394244b74fb36b6b/salt/modules/mysql.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000# -\*- coding: utf-8 -\*-'''Module to provide MySQL compatibility to salt.
:depends: - MySQLdb Python module
.. note::
 On CentOS 5 (and possibly RHEL 5) both MySQL-python and python26-mysqldb need to be installed.
:configuration: In order to connect to MySQL, certain configuration is required in /etc/salt/minion on the relevant minions. Some sample configs might look like::
 mysql.host: 'localhost' mysql.port: 3306 mysql.user: 'root' mysql.pass: '' mysql.db: 'mysql' mysql.unix\_socket: '/tmp/mysql.sock' mysql.charset: 'utf8'
 You can also use a defaults file::
 mysql.default\_file: '/etc/mysql/debian.cnf'
.. versionchanged:: 2014.1.0 \'charset\' connection argument added. This is a MySQL charset, not a python one... versionchanged:: 0.16.2 Connection arguments from the minion config file can be overridden on the CLI by using the arguments defined :mod:`here <salt.states.mysql\_user>`. Additionally, it is now possible to setup a user with no password.'''
# Import python libsfrom \_\_future\_\_ import absolute\_import, print\_function, unicode\_literalsimport timeimport loggingimport reimport sysimport shleximport os
# Import salt libsimport salt.utils.dataimport salt.utils.filesimport salt.utils.stringutils
# Import third party libsfrom salt.ext import six# pylint: disable=import-errorfrom salt.ext.six.moves import range, zip # pylint: disable=no-name-in-module,redefined-builtin
try: # Trying to import MySQLdb import MySQLdb import MySQLdb.cursors import MySQLdb.converters from MySQLdb.constants import FIELD\_TYPE, FLAG from MySQLdb import OperationalErrorexcept ImportError: try: # MySQLdb import failed, try to import PyMySQL import pymysql pymysql.install\_as\_MySQLdb() import MySQLdb import MySQLdb.cursors import MySQLdb.converters from MySQLdb.constants import FIELD\_TYPE, FLAG from MySQLdb import OperationalError except ImportError: MySQLdb = None
log = logging.getLogger(\_\_name\_\_)
# TODO: this is not used anywhere in the code?\_\_opts\_\_ = {}
\_\_grants\_\_ = [ 'ALL PRIVILEGES', 'ALTER', 'ALTER ROUTINE', 'BACKUP\_ADMIN', 'BINLOG\_ADMIN', 'CONNECTION\_ADMIN', 'CREATE', 'CREATE ROLE', 'CREATE ROUTINE', 'CREATE TABLESPACE', 'CREATE TEMPORARY TABLES', 'CREATE USER', 'CREATE VIEW', 'DELETE', 'DROP', 'DROP ROLE', 'ENCRYPTION\_KEY\_ADMIN', 'EVENT', 'EXECUTE', 'FILE', 'GRANT OPTION', 'GROUP\_REPLICATION\_ADMIN', 'INDEX', 'INSERT', 'LOCK TABLES', 'PERSIST\_RO\_VARIABLES\_ADMIN', 'PROCESS', 'REFERENCES', 'RELOAD', 'REPLICATION CLIENT', 'REPLICATION SLAVE', 'REPLICATION\_SLAVE\_ADMIN', 'RESOURCE\_GROUP\_ADMIN', 'RESOURCE\_GROUP\_USER', 'ROLE\_ADMIN', 'SELECT', 'SET\_USER\_ID', 'SHOW DATABASES', 'SHOW VIEW', 'SHUTDOWN', 'SUPER', 'SYSTEM\_VARIABLES\_ADMIN', 'TRIGGER', 'UPDATE', 'USAGE', 'XA\_RECOVER\_ADMIN']
\_\_ssl\_options\_parameterized\_\_ = [ 'CIPHER', 'ISSUER', 'SUBJECT']\_\_ssl\_options\_\_ = \_\_ssl\_options\_parameterized\_\_ + [ 'SSL', 'X509']
\_\_all\_privileges\_\_ = [ 'ALTER', 'ALTER ROUTINE', 'BACKUP\_ADMIN', 'BINLOG\_ADMIN', 'CONNECTION\_ADMIN', 'CREATE', 'CREATE ROLE', 'CREATE ROUTINE', 'CREATE TABLESPACE', 'CREATE TEMPORARY TABLES', 'CREATE USER', 'CREATE VIEW', 'DELETE', 'DROP', 'DROP ROLE', 'ENCRYPTION\_KEY\_ADMIN', 'EVENT', 'EXECUTE', 'FILE', 'GROUP\_REPLICATION\_ADMIN', 'INDEX', 'INSERT', 'LOCK TABLES', 'PERSIST\_RO\_VARIABLES\_ADMIN', 'PROCESS', 'REFERENCES', 'RELOAD', 'REPLICATION CLIENT', 'REPLICATION SLAVE', 'REPLICATION\_SLAVE\_ADMIN', 'RESOURCE\_GROUP\_ADMIN', 'RESOURCE\_GROUP\_USER', 'ROLE\_ADMIN', 'SELECT', 'SET\_USER\_ID', 'SHOW DATABASES', 'SHOW VIEW', 'SHUTDOWN', 'SUPER', 'SYSTEM\_VARIABLES\_ADMIN', 'TRIGGER', 'UPDATE', 'XA\_RECOVER\_ADMIN']
r'''DEVELOPER NOTE: ABOUT arguments management, escapes, formats, arguments andsecurity of SQL.
A general rule of SQL security is to use queries with \_execute call in thiscode using args parameter to let MySQLdb manage the arguments proper escaping.Another way of escaping values arguments could be '{0!r}'.format(), using\_\_repr\_\_ to ensure things get properly used as strings. But this could leadto three problems:
 \* In ANSI mode, which is available on MySQL, but not by default, doublequotes " should not be used as a string delimiters, in ANSI mode this is anidentifier delimiter (like `).
 \* Some rare exploits with bad multibytes management, either on python orMySQL could defeat this barrier, bindings internal escape functionsshould manage theses cases.
 \* Unicode strings in Python 2 will include the 'u' before the repr'ed string, like so:
 Python 2.7.10 (default, May 26 2015, 04:16:29) [GCC 5.1.0] on linux2 Type "help", "copyright", "credits" or "license" for more information. >>> u'something something {0!r}'.format(u'foo') u"something something u'foo'"
So query with arguments should use a paramstyle defined in PEP249:
http://www.python.org/dev/peps/pep-0249/#paramstyleWe use pyformat, which means 'SELECT \* FROM foo WHERE bar=%(myval)s'used with {'myval': 'some user input'}
So far so good. But this cannot be used for identifier escapes. Identifiersare database names, table names and column names. Theses names are not valuesand do not follow the same escape rules (see quote\_identifier function fordetails on `\_ and % escape policies on identifiers). Using value escaping onidentifier could fool the SQL engine (badly escaping quotes and not doubling` characters. So for identifiers a call to quote\_identifier should be done andtheses identifiers should then be added in strings with format, but without\_\_repr\_\_ filter.
Note also that when using query with arguments in \_execute all '%' charactersused in the query should get escaped to '%%' fo MySQLdb, but should not beescaped if the query runs without arguments. This is managed by \_execute() andquote\_identifier. This is not the same as escaping '%' to '\%' or '\_' to '\%'when using a LIKE query (example in db\_exists), as this escape is there toavoid having \_ or % characters interpreted in LIKE queries. The string partedof the first query could become (still used with args dictionary for myval):'SELECT \* FROM {0} WHERE bar=%(myval)s'.format(quote\_identifier('user input'))
Check integration tests if you find a hole in theses strings and escapes rules
Finally some examples to sum up.
Given a name f\_o%o`b'a"r, in python that would be """f\_o%o`b'a"r""". I'llavoid python syntax for clarity:
The MySQL way of writing this name is:
value : 'f\_o%o`b\'a"r' (managed by MySQLdb)identifier : `f\_o%o``b'a"r`db identifier in general GRANT: `f\\_o\%o``b'a"r`db identifier in table GRANT : `f\_o%o``b'a"r`in mySQLdb, query with args : `f\_o%%o``b'a"r` (as identifier)in mySQLdb, query without args: `f\_o%o``b'a"r` (as identifier)value in a LIKE query : 'f\\_o\%o`b\'a"r' (quotes managed by MySQLdb)
And theses could be mixed, in a like query value with args: 'f\\_o\%%o`b\'a"r''''
def \_\_virtual\_\_(): ''' Confirm that a python mysql client is installed. ''' return bool(MySQLdb), 'No python mysql client installed.' if MySQLdb is None else ''
def \_\_check\_table(name, table, \*\*connection\_args): dbc = \_connect(\*\*connection\_args) if dbc is None: return {} cur = dbc.cursor(MySQLdb.cursors.DictCursor) s\_name = quote\_identifier(name) s\_table = quote\_identifier(table) # identifiers cannot be used as values qry = 'CHECK TABLE {0}.{1}'.format(s\_name, s\_table) \_execute(cur, qry) results = cur.fetchall() log.debug(results) return results
def \_\_repair\_table(name, table, \*\*connection\_args): dbc = \_connect(\*\*connection\_args) if dbc is None: return {} cur = dbc.cursor(MySQLdb.cursors.DictCursor) s\_name = quote\_identifier(name) s\_table = quote\_identifier(table) # identifiers cannot be used as values qry = 'REPAIR TABLE {0}.{1}'.format(s\_name, s\_table) \_execute(cur, qry) results = cur.fetchall() log.debug(results) return results
def \_\_optimize\_table(name, table, \*\*connection\_args): dbc = \_connect(\*\*connection\_args) if dbc is None: return {} cur = dbc.cursor(MySQLdb.cursors.DictCursor) s\_name = quote\_identifier(name) s\_table = quote\_identifier(table) # identifiers cannot be used as values qry = 'OPTIMIZE TABLE {0}.{1}'.format(s\_name, s\_table) \_execute(cur, qry) results = cur.fetchall() log.debug(results) return results
def \_\_password\_column(\*\*connection\_args): dbc = \_connect(\*\*connection\_args) if dbc is None: return 'Password' cur = dbc.cursor() qry = ('SELECT column\_name from information\_schema.COLUMNS ' 'WHERE table\_schema=%(schema)s and table\_name=%(table)s ' 'and column\_name=%(column)s') args = { 'schema': 'mysql', 'table': 'user', 'column': 'Password' } \_execute(cur, qry, args) if int(cur.rowcount) > 0: return 'Password' else: return 'authentication\_string'
def \_connect(\*\*kwargs): ''' wrap authentication credentials here ''' connargs = dict()
 def \_connarg(name, key=None, get\_opts=True): ''' Add key to connargs, only if name exists in our kwargs or, if get\_opts is true, as mysql.<name> in \_\_opts\_\_ or \_\_pillar\_\_
 If get\_opts is true, evaluate in said order - kwargs, opts then pillar. To avoid collision with other functions, kwargs-based connection arguments are prefixed with 'connection\_' (i.e. 'connection\_host', 'connection\_user', etc.). ''' if key is None: key = name
 if name in kwargs: connargs[key] = kwargs[name] elif get\_opts: prefix = 'connection\_' if name.startswith(prefix): try: name = name[len(prefix):] except IndexError: return val = \_\_salt\_\_['config.option']('mysql.{0}'.format(name), None) if val is not None: connargs[key] = val
 # If a default file is explicitly passed to kwargs, don't grab the # opts/pillar settings, as it can override info in the defaults file if 'connection\_default\_file' in kwargs: get\_opts = False else: get\_opts = True
 \_connarg('connection\_host', 'host', get\_opts) \_connarg('connection\_user', 'user', get\_opts) \_connarg('connection\_pass', 'passwd', get\_opts) \_connarg('connection\_port', 'port', get\_opts) \_connarg('connection\_db', 'db', get\_opts) \_connarg('connection\_conv', 'conv', get\_opts) \_connarg('connection\_unix\_socket', 'unix\_socket', get\_opts) \_connarg('connection\_default\_file', 'read\_default\_file', get\_opts) \_connarg('connection\_default\_group', 'read\_default\_group', get\_opts) # MySQLdb states that this is required for charset usage # but in fact it's more than it's internally activated # when charset is used, activating use\_unicode here would # retrieve utf8 strings as unicode() objects in salt # and we do not want that. #\_connarg('connection\_use\_unicode', 'use\_unicode') connargs['use\_unicode'] = False \_connarg('connection\_charset', 'charset') # Ensure MySQldb knows the format we use for queries with arguments MySQLdb.paramstyle = 'pyformat'
 if connargs.get('passwd', True) is None: # If present but set to None. (Extreme edge case.) log.warning('MySQL password of None found. Attempting passwordless login.') connargs.pop('passwd') try: dbc = MySQLdb.connect(\*\*connargs) except OperationalError as exc: err = 'MySQL Error {0}: {1}'.format(\*exc.args) \_\_context\_\_['mysql.error'] = err log.error(err) return None
 dbc.autocommit(True) return dbc
def \_grant\_to\_tokens(grant): '''
 This should correspond fairly closely to the YAML rendering of a mysql\_grants state which comes out as follows:
 OrderedDict([ ('whatever\_identifier', OrderedDict([ ('mysql\_grants.present', [ OrderedDict([('database', 'testdb.\*')]), OrderedDict([('user', 'testuser')]), OrderedDict([('grant', 'ALTER, SELECT, LOCK TABLES')]), OrderedDict([('host', 'localhost')]) ] ) ]) ) ])
 :param grant: An un-parsed MySQL GRANT statement str, like "GRANT SELECT, ALTER, LOCK TABLES ON `mydb`.\* TO 'testuser'@'localhost'" or a dictionary with 'qry' and 'args' keys for 'user' and 'host'. :return: A Python dict with the following keys/values: - user: MySQL User - host: MySQL host - grant: [grant1, grant2] (ala SELECT, USAGE, etc) - database: MySQL DB ''' log.debug('\_grant\_to\_tokens entry \'%s\'', grant) dict\_mode = False if isinstance(grant, dict): dict\_mode = True # Everything coming in dictionary form was made for a MySQLdb execute # call and contain a '%%' escaping of '%' characters for MySQLdb # that we should remove here. grant\_sql = grant.get('qry', 'undefined').replace('%%', '%') sql\_args = grant.get('args', {}) host = sql\_args.get('host', 'undefined') user = sql\_args.get('user', 'undefined') else: grant\_sql = grant user = '' # the replace part is for presence of ` character in the db name # the shell escape is \` but mysql escape is ``. Spaces should not be # exploded as users or db names could contain spaces. # Examples of splitting: # "GRANT SELECT, LOCK TABLES, UPDATE, CREATE ON `test ``(:=saltdb)`.\* # TO 'foo'@'localhost' WITH GRANT OPTION" # ['GRANT', 'SELECT', ',', 'LOCK', 'TABLES', ',', 'UPDATE', ',', 'CREATE', # 'ON', '`test `', '`(:=saltdb)`', '.', '\*', 'TO', "'foo'", '@', # "'localhost'", 'WITH', 'GRANT', 'OPTION'] # # 'GRANT SELECT, INSERT, UPDATE, CREATE ON `te s.t\'"sa;ltdb`.`tbl ``\'"xx` # TO \'foo \' bar\'@\'localhost\'' # ['GRANT', 'SELECT', ',', 'INSERT', ',', 'UPDATE', ',', 'CREATE', 'ON', # '`te s.t\'"sa;ltdb`', '.', '`tbl `', '`\'"xx`', 'TO', "'foo '", "bar'", # '@', "'localhost'"] # # "GRANT USAGE ON \*.\* TO 'user \";--,?:&/\\'@'localhost'" # ['GRANT', 'USAGE', 'ON', '\*', '.', '\*', 'TO', '\'user ";--,?:&/\\\'', # '@', "'localhost'"] lex = shlex.shlex(grant\_sql) lex.quotes = '\'`' lex.whitespace\_split = False lex.commenters = '' lex.wordchars += '\"' exploded\_grant = list(lex) grant\_tokens = [] multiword\_statement = [] position\_tracker = 1 # Skip the initial 'GRANT' word token database = '' phrase = 'grants'
 for token in exploded\_grant[position\_tracker:]:
 if token == ',' and phrase == 'grants': position\_tracker += 1 continue
 if token == 'ON' and phrase == 'grants': phrase = 'db' position\_tracker += 1 continue
 elif token == 'TO' and phrase == 'tables': phrase = 'user' position\_tracker += 1 continue
 elif token == '@' and phrase == 'pre-host': phrase = 'host' position\_tracker += 1 continue
 if phrase == 'grants': # Read-ahead if exploded\_grant[position\_tracker + 1] == ',' \ or exploded\_grant[position\_tracker + 1] == 'ON': # End of token detected if multiword\_statement: multiword\_statement.append(token) grant\_tokens.append(' '.join(multiword\_statement)) multiword\_statement = [] else: grant\_tokens.append(token) else: # This is a multi-word, ala LOCK TABLES multiword\_statement.append(token)
 elif phrase == 'db': # the shlex splitter may have split on special database characters ` database += token # Read-ahead try: if exploded\_grant[position\_tracker + 1] == '.': phrase = 'tables' except IndexError: break
 elif phrase == 'tables': database += token
 elif phrase == 'user': if dict\_mode: break else: user += token # Read-ahead if exploded\_grant[position\_tracker + 1] == '@': phrase = 'pre-host'
 elif phrase == 'host': host = token break
 position\_tracker += 1
 try: if not dict\_mode: user = user.strip("'") host = host.strip("'") log.debug( 'grant to token \'%s\'::\'%s\'::\'%s\'::\'%s\'', user, host, grant\_tokens, database ) except UnboundLocalError: host = ''
 return dict(user=user, host=host, grant=grant\_tokens, database=database)
def quote\_identifier(identifier, for\_grants=False): r''' Return an identifier name (column, table, database, etc) escaped for MySQL
 This means surrounded by "`" character and escaping this character inside. It also means doubling the '%' character for MySQLdb internal usage.
 :param identifier: the table, column or database identifier
 :param for\_grants: is False by default, when using database names on grant queries you should set it to True to also escape "\_" and "%" characters as requested by MySQL. Note that theses characters should only be escaped when requesting grants on the database level (`my\\_\%db`.\*) but not for table level grants (`my\_%db`.`foo`)
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.quote\_identifier 'foo`bar' ''' if for\_grants: return '`' + identifier.replace('`', '``').replace('\_', r'\\_') \ .replace('%', r'\%%') + '`' else: return '`' + identifier.replace('`', '``').replace('%', '%%') + '`'
def \_execute(cur, qry, args=None): ''' Internal wrapper around MySQLdb cursor.execute() function
 MySQLDb does not apply the same filters when arguments are used with the query. For example '%' characters on the query must be encoded as '%%' and will be restored as '%' when arguments are applied. But when there're no arguments the '%%' is not managed. We cannot apply Identifier quoting in a predictable way if the query are not always applying the same filters. So this wrapper ensure this escape is not made if no arguments are used. ''' if args is None or args == {}: qry = qry.replace('%%', '%') log.debug('Doing query: %s', qry) return cur.execute(qry) else: log.debug('Doing query: %s args: %s ', qry, repr(args)) return cur.execute(qry, args)
def query(database, query, \*\*connection\_args): ''' Run an arbitrary SQL query and return the results or the number of affected rows.
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.query mydb "UPDATE mytable set myfield=1 limit 1"
 Return data:
 .. code-block:: python
 {'query time': {'human': '39.0ms', 'raw': '0.03899'}, 'rows affected': 1L}
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.query mydb "SELECT id,name,cash from users limit 3"
 Return data:
 .. code-block:: python
 {'columns': ('id', 'name', 'cash'), 'query time': {'human': '1.0ms', 'raw': '0.001'}, 'results': ((1L, 'User 1', Decimal('110.000000')), (2L, 'User 2', Decimal('215.636756')), (3L, 'User 3', Decimal('0.040000'))), 'rows returned': 3L}
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.query mydb 'INSERT into users values (null,"user 4", 5)'
 Return data:
 .. code-block:: python
 {'query time': {'human': '25.6ms', 'raw': '0.02563'}, 'rows affected': 1L}
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.query mydb 'DELETE from users where id = 4 limit 1'
 Return data:
 .. code-block:: python
 {'query time': {'human': '39.0ms', 'raw': '0.03899'}, 'rows affected': 1L}
 Jinja Example: Run a query on ``mydb`` and use row 0, column 0's data.
 .. code-block:: jinja
 {{ salt['mysql.query']('mydb', 'SELECT info from mytable limit 1')['results'][0][0] }} ''' # Doesn't do anything about sql warnings, e.g. empty values on an insert. # I don't think it handles multiple queries at once, so adding "commit" # might not work.
 # The following 3 lines stops MySQLdb from converting the MySQL results # into Python objects. It leaves them as strings. orig\_conv = MySQLdb.converters.conversions conv\_iter = iter(orig\_conv) conv = dict(zip(conv\_iter, [str] \* len(orig\_conv)))
 # some converters are lists, do not break theses conv\_mysqldb = {'MYSQLDB': True} if conv\_mysqldb.get(MySQLdb.\_\_package\_\_.upper()): conv[FIELD\_TYPE.BLOB] = [ (FLAG.BINARY, str), ] conv[FIELD\_TYPE.STRING] = [ (FLAG.BINARY, str), ] conv[FIELD\_TYPE.VAR\_STRING] = [ (FLAG.BINARY, str), ] conv[FIELD\_TYPE.VARCHAR] = [ (FLAG.BINARY, str), ]
 connection\_args.update({'connection\_db': database, 'connection\_conv': conv}) dbc = \_connect(\*\*connection\_args) if dbc is None: return {} cur = dbc.cursor() start = time.time() log.debug('Using db: %s to run query %s', database, query) try: affected = \_execute(cur, query) except OperationalError as exc: err = 'MySQL Error {0}: {1}'.format(\*exc.args) \_\_context\_\_['mysql.error'] = err log.error(err) return False results = cur.fetchall() elapsed = (time.time() - start) if elapsed < 0.200: elapsed\_h = str(round(elapsed \* 1000, 1)) + 'ms' else: elapsed\_h = str(round(elapsed, 2)) + 's'
 ret = {} ret['query time'] = {'human': elapsed\_h, 'raw': str(round(elapsed, 5))} select\_keywords = ["SELECT", "SHOW", "DESC"] select\_query = False for keyword in select\_keywords: if query.upper().strip().startswith(keyword): select\_query = True break if select\_query: ret['rows returned'] = affected columns = () for column in cur.description: columns += (column[0],) ret['columns'] = columns ret['results'] = results return ret else: ret['rows affected'] = affected return ret
def file\_query(database, file\_name, \*\*connection\_args): ''' Run an arbitrary SQL query from the specified file and return the the number of affected rows.
 .. versionadded:: 2017.7.0
 database
 database to run script inside
 file\_name
 File name of the script. This can be on the minion, or a file that is reachable by the fileserver
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.file\_query mydb file\_name=/tmp/sqlfile.sql salt '\*' mysql.file\_query mydb file\_name=salt://sqlfile.sql
 Return data:
 .. code-block:: python
 {'query time': {'human': '39.0ms', 'raw': '0.03899'}, 'rows affected': 1L}
 ''' if any(file\_name.startswith(proto) for proto in ('salt://', 'http://', 'https://', 'swift://', 's3://')): file\_name = \_\_salt\_\_['cp.cache\_file'](file\_name)
 if os.path.exists(file\_name): with salt.utils.files.fopen(file\_name, 'r') as ifile: contents = salt.utils.stringutils.to\_unicode(ifile.read()) else: log.error('File "%s" does not exist', file\_name) return False
 query\_string = "" ret = {'rows returned': 0, 'columns': [], 'results': [], 'rows affected': 0, 'query time': {'raw': 0}} for line in contents.splitlines(): if re.match(r'--', line): # ignore sql comments continue if not re.search(r'[^-;]+;', line): # keep appending lines that don't end in ; query\_string = query\_string + line else: query\_string = query\_string + line # append lines that end with ; and run query query\_result = query(database, query\_string, \*\*connection\_args) query\_string = ""
 if query\_result is False: # Fail out on error return False
 if 'query time' in query\_result: ret['query time']['raw'] += float(query\_result['query time']['raw']) if 'rows returned' in query\_result: ret['rows returned'] += query\_result['rows returned'] if 'columns' in query\_result: ret['columns'].append(query\_result['columns']) if 'results' in query\_result: ret['results'].append(query\_result['results']) if 'rows affected' in query\_result: ret['rows affected'] += query\_result['rows affected'] ret['query time']['human'] = six.text\_type(round(float(ret['query time']['raw']), 2)) + 's' ret['query time']['raw'] = round(float(ret['query time']['raw']), 5)
 # Remove empty keys in ret ret = {k: v for k, v in six.iteritems(ret) if v}
 return ret
def status(\*\*connection\_args): ''' Return the status of a MySQL server using the output from the ``SHOW STATUS`` query.
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.status ''' dbc = \_connect(\*\*connection\_args) if dbc is None: return {} cur = dbc.cursor() qry = 'SHOW STATUS' try: \_execute(cur, qry) except OperationalError as exc: err = 'MySQL Error {0}: {1}'.format(\*exc.args) \_\_context\_\_['mysql.error'] = err log.error(err) return {}
 ret = {} for \_ in range(cur.rowcount): row = cur.fetchone() ret[row[0]] = row[1] return ret
def version(\*\*connection\_args): ''' Return the version of a MySQL server using the output from the ``SELECT VERSION()`` query.
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.version ''' dbc = \_connect(\*\*connection\_args) if dbc is None: return '' cur = dbc.cursor() qry = 'SELECT VERSION()' try: \_execute(cur, qry) except MySQLdb.OperationalError as exc: err = 'MySQL Error {0}: {1}'.format(\*exc.args) \_\_context\_\_['mysql.error'] = err log.error(err) return ''
 try: return salt.utils.data.decode(cur.fetchone()[0]) except IndexError: return ''
def slave\_lag(\*\*connection\_args): ''' Return the number of seconds that a slave SQL server is lagging behind the master, if the host is not a slave it will return -1. If the server is configured to be a slave for replication but slave IO is not running then -2 will be returned. If there was an error connecting to the database or checking the slave status, -3 will be returned.
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.slave\_lag ''' dbc = \_connect(\*\*connection\_args) if dbc is None: return -3 cur = dbc.cursor(MySQLdb.cursors.DictCursor) qry = 'show slave status' try: \_execute(cur, qry) except MySQLdb.OperationalError as exc: err = 'MySQL Error {0}: {1}'.format(\*exc.args) \_\_context\_\_['mysql.error'] = err log.error(err) return -3
 results = cur.fetchone() if cur.rowcount == 0: # Server is not a slave if master is not defined. Return empty tuple # in this case. Could probably check to see if Slave\_IO\_Running and # Slave\_SQL\_Running are both set to 'Yes' as well to be really really # sure that it is a slave. return -1 else: if results['Slave\_IO\_Running'] == 'Yes': return results['Seconds\_Behind\_Master'] else: # Replication is broken if you get here. return -2
def free\_slave(\*\*connection\_args): ''' Frees a slave from its master. This is a WIP, do not use.
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.free\_slave ''' slave\_db = \_connect(\*\*connection\_args) if slave\_db is None: return '' slave\_cur = slave\_db.cursor(MySQLdb.cursors.DictCursor) slave\_cur.execute('show slave status') slave\_status = slave\_cur.fetchone() master = {'host': slave\_status['Master\_Host']}
 try: # Try to connect to the master and flush logs before promoting to # master. This may fail if the master is no longer available. # I am also assuming that the admin password is the same on both # servers here, and only overriding the host option in the connect # function. master\_db = \_connect(\*\*master) if master\_db is None: return '' master\_cur = master\_db.cursor() master\_cur.execute('flush logs') master\_db.close() except MySQLdb.OperationalError: pass
 slave\_cur.execute('stop slave') slave\_cur.execute('reset master') slave\_cur.execute('change master to MASTER\_HOST=''') slave\_cur.execute('show slave status') results = slave\_cur.fetchone()
 if results is None: return 'promoted' else: return 'failed'
# Database related actionsdef db\_list(\*\*connection\_args): ''' Return a list of databases of a MySQL server using the output from the ``SHOW DATABASES`` query.
 CLI Example:
 .. code-block:: bash
 salt '\*' mysql.db\_list ''' dbc = \_connect(\*\*connection\_args) if dbc is None: return [] cur = dbc.cursor() qry = 'SHOW DATABASES' try: \_execute(cur, qry) except MySQLdb.OperationalError as exc: err = 'MySQL Error {0}: {1}'.format(\*exc.args) \_\_context\_\_['mysql.error'] = err log.error(err) return []
 ret = [] results = cur.fetchall() for dbs in results: ret.append(dbs[0])
 log.debug(ret) return ret
def alter\_db(name, character\_set=None, collate=None, \*\*connection\_args): ''' Modify database using ``ALTER DATABASE %(dbname)s CHARACTER SET %(charset)s[View remainder of file in raw view](https://github.com/saltstack/salt/raw/f22de0887cd7167887f113bf394244b74fb36b6b/salt/modules/mysql.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_342c93a0_20250120_232554.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fpull%2F51462)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fpull%2F51462)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=saltstack%2Fsalt)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saltstack](/saltstack)
/
**[salt](/saltstack/salt)**
Public

* [Notifications](/login?return_to=%2Fsaltstack%2Fsalt) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaltstack%2Fsalt)
* [Star
   14.3k](/login?return_to=%2Fsaltstack%2Fsalt)

* [Code](/saltstack/salt)
* [Issues
  2.7k](/saltstack/salt/issues)
* [Pull requests
  250](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects
  4](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

Additional navigation options

* [Code](/saltstack/salt)
* [Issues](/saltstack/salt/issues)
* [Pull requests](/saltstack/salt/pulls)
* [Discussions](/saltstack/salt/discussions)
* [Actions](/saltstack/salt/actions)
* [Projects](/saltstack/salt/projects)
* [Wiki](/saltstack/salt/wiki)
* [Security](/saltstack/salt/security)
* [Insights](/saltstack/salt/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsaltstack%2Fsalt%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsaltstack%2Fsalt%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix insecure SQL queries in MySQL module #51462

 Merged

[dwoz](/dwoz)
merged 3 commits into
[saltstack:2018.3.4](/saltstack/salt/tree/2018.3.4 "saltstack/salt:2018.3.4")
from
unknown repository
Feb 1, 2019

 Merged

# [Fix insecure SQL queries in MySQL module](#top) #51462

[dwoz](/dwoz)
merged 3 commits into
[saltstack:2018.3.4](/saltstack/salt/tree/2018.3.4 "saltstack/salt:2018.3.4")
from
unknown repository
Feb 1, 2019

[Conversation
7](/saltstack/salt/pull/51462)
[Commits
3](/saltstack/salt/pull/51462/commits)
[Checks
0](/saltstack/salt/pull/51462/checks)
[Files changed](/saltstack/salt/pull/51462/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![ghost](https://avatars.githubusercontent.com/u/10137?s=60&v=4)](/ghost)

Copy link

### @ghost **[ghost](/ghost)** commented [Feb 1, 2019](#issue-405633897)

All the details have been sent to security@saltstack.com.

Sorry, something went wrong.

All reactions

`[Fix insecure SQL queries in mysql.user_chpass](/saltstack/salt/pull/51462/commits/ed62a2f87312ced2bc555cad2d756a2228f1987d "Fix insecure SQL queries in mysql.user_chpass")`

`[ed62a2f](/saltstack/salt/pull/51462/commits/ed62a2f87312ced2bc555cad2d756a2228f1987d)`

 ![@ghost](https://avatars.githubusercontent.com/u/10137?s=40&v=4)
**ghost**
self-requested a review
as a [code owner](/saltstack/salt/blob/f22de0887cd7167887f113bf394244b74fb36b6b/.github/CODEOWNERS#L21)
[February 1, 2019 10:09](#event-2111774598)

![@ghost](https://avatars.githubusercontent.com/u/10137?s=32&v=4)
**ghost**
changed the title
~~Fix insecure sql queries in mysql module~~
Fix insecure SQL queries in MySQL module
[Feb 1, 2019](#event-2111775822)

 ![@ghost](https://avatars.githubusercontent.com/u/10137?s=40&v=4)

[![@garethgreenaway](https://avatars.githubusercontent.com/u/718525?s=80&u=bac2cf347107e6aaa0dd08332dd13e9065a2c248&v=4)](/garethgreenaway)

Copy link

Contributor

### **[garethgreenaway](/garethgreenaway)** commented [Feb 1, 2019](#issuecomment-459683630)

| @shantonru looks like there are some lint issues. |
| --- |

All reactions

Sorry, something went wrong.

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

Author

### **[ghost](/ghost)** commented [Feb 1, 2019](#issuecomment-459685944)

| [@garethgreenaway](https://github.com/garethgreenaway), as it was requested [here](https://docs.saltstack.com/en/latest/security/) i sent all details of security issue to security@saltstack.com. |
| --- |

All reactions

Sorry, something went wrong.

[![@garethgreenaway](https://avatars.githubusercontent.com/u/718525?s=80&u=bac2cf347107e6aaa0dd08332dd13e9065a2c248&v=4)](/garethgreenaway)

Copy link

Contributor

### **[garethgreenaway](/garethgreenaway)** commented [Feb 1, 2019](#issuecomment-459690177)

| @shantonru yup! I saw that and we definitely appreciate the PR, but it looks like the lint test failed which means there are likely some coding standard violation. If you check the results of the test you should see what's wrong along with suggestions on fixing it. |
| --- |

All reactions

Sorry, something went wrong.

[![@garethgreenaway](https://avatars.githubusercontent.com/u/718525?s=80&u=bac2cf347107e6aaa0dd08332dd13e9065a2c248&v=4)](/garethgreenaway)

Copy link

Contributor

### **[garethgreenaway](/garethgreenaway)** commented [Feb 1, 2019](#issuecomment-459690637)

| @shantonru looking closer it seems like it might not be a failure in your part. I'll attempt to rerun the tests. |
| --- |

All reactions

Sorry, something went wrong.

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

Author

### **[ghost](/ghost)** commented [Feb 1, 2019](#issuecomment-459697780) • edited by ghost Loading

| [@garethgreenaway](https://github.com/garethgreenaway), sorry, I read 'init issues' instead of 'lint issues' =) Tests failed because i firstly made pull request to 'develop' branch instead of '2018.3.4' . Can you rerun tests please? |
| --- |

All reactions

Sorry, something went wrong.

 Anton Zhabolenko
and others
added 2 commits
[February 1, 2019 16:52](#commits-pushed-f47dda6)

`[Fix improper use of socket authentication in mysql.user_chpass](/saltstack/salt/pull/51462/commits/f47dda61e651ea1e38fbc0bf6ab5272380b1491e "Fix improper use of socket authentication in mysql.user_chpass")`

`[f47dda6](/saltstack/salt/pull/51462/commits/f47dda61e651ea1e38fbc0bf6ab5272380b1491e)`

`[Merge branch '2018.3.4' into fix-insecure-sql-queries-in-mysql-module-1](/saltstack/salt/pull/51462/commits/d3ef2cb8e6ad189dc3fa33d54c23afac1069c104 "Merge branch '2018.3.4' into fix-insecure-sql-queries-in-mysql-module-1")`

`[d3ef2cb](/saltstack/salt/pull/51462/commits/d3ef2cb8e6ad189dc3fa33d54c23afac1069c104)`

[![dwoz](https://avatars.githubusercontent.com/u/1527763?s=60&v=4)](/dwoz)

**[dwoz](/dwoz)**
approved these changes
[Feb 1, 2019](#pullrequestreview-199271914)

 [View reviewed changes](/saltstack/salt/pull/51462/files/d3ef2cb8e6ad189dc3fa33d54c23afac1069c104)

[![@dwoz](https://avatars.githubusercontent.com/u/1527763?s=80&u=0857803b97c0b7500b4756f760942a51daa18541&v=4)](/dwoz)

Copy link

Contributor

### **[dwoz](/dwoz)** commented [Feb 1, 2019](#issuecomment-459871051)

| @ShantonRU Thank you for the contribution. |
| --- |

All reactions

Sorry, something went wrong.

[![@dwoz](https://avatars.githubusercontent.com/u/1527763?s=40&u=0857803b97c0b7500b4756f760942a51daa18541&v=4)](/dwoz)
[dwoz](/dwoz)
merged commit [`a05305d`](/saltstack/salt/commit/a05305dce35f22ba89dbd96acf4deee95a96a4c3)
into
saltstack:2018.3.4

[Feb 1, 2019](https://github.com/saltstack/salt/pull/51462#event-2113269710)

[![@ghost](https://avatars.githubusercontent.com/u/10137?s=80&v=4)](/ghost)

Copy link

Author

### **[ghost](/ghost)** commented [Feb 19, 2019](#issuecomment-465043835) • edited by ghost Loading

| This issue has been assigned **[CVE-2019-1010259](https://github.com/advisories/GHSA-h8xp-h3jf-wv4v "CVE-2019-1010259")**. |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaltstack%2Fsalt%2Fpull%2F51462)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@garethgreenaway](https://avatars.githubusercontent.com/u/718525?s=52&v=4)](/garethgreenaway) [![@dwoz](https://avatars.githubusercontent.com/u/1527763?s=52&v=4)](/dwoz) [![@poofyteddy](https://avatars.githubusercontent.com/u/33599733?s=52&v=4)](/poofyteddy)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c2f12116_20250121_013205.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-h8xp-h3jf-wv4v)

**CVE-2019-1010259**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-h8xp-h3jf-wv4v)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2019-1010259](/advisories/GHSA-h8xp-h3jf-wv4v)

## SaltStack Salt SQL Injection vulnerability in mysql.user\_chpass function

Critical severity

GitHub Reviewed

Published
May 24, 2022
to the GitHub Advisory Database
•
Updated Oct 25, 2024

[Vulnerability details](/advisories/GHSA-h8xp-h3jf-wv4v)
[Dependabot alerts
0](/advisories/GHSA-h8xp-h3jf-wv4v/dependabot)

## Package

pip

salt
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>= 2018.3.0, < 2018.3.4

## Patched versions

2018.3.4

## Description

SaltStack Salt 2018.3 is affected by: SQL Injection. The impact is: An attacker could escalate privileges on MySQL server deployed by cloud provider. It leads to RCE. The component is: The `mysql.user_chpass` function from the MySQL module for Salt (<https://github.com/saltstack/salt/blob/develop/salt/modules/mysql.py#L1462>). The attack vector is: specially crafted password string. The fixed version is: 2018.3.4.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2019-1010259>
* [saltstack/salt#51462](https://github.com/saltstack/salt/pull/51462)
* <https://github.com/ShantonRU/salt/commit/a46c86a987c78e74e87969d8d3b27094e6544b7a>
* <https://github.com/saltstack/salt/blob/f22de0887cd7167887f113bf394244b74fb36b6b/salt/modules/mysql.py#L1534>
* <https://github.com/pypa/advisory-database/tree/main/vulns/salt/PYSEC-2019-119.yaml>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2019-1010259)
Jul 18, 2019

Published to the GitHub Advisory Database
May 24, 2022

Reviewed
Apr 22, 2024

Last updated
Oct 25, 2024

### Severity

Critical

9.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H

### [EPSS score](https://www.first.org/epss/user-guide)

0.234%
 (61st percentile)

### Weaknesses

[CWE-89](/advisories?query=cwe%3A89)

### CVE ID

CVE-2019-1010259

### GHSA ID

GHSA-h8xp-h3jf-wv4v

### Source code

[saltstack/salt](https://github.com/saltstack/salt)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-h8xp-h3jf-wv4v/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


