=== Content from github.com_ee7e3572_20250120_233727.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOISF%2Fsuricata%2Fpull%2F3590%2Fcommits%2F8357ef3f8ffc7d99ef6571350724160de356158b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOISF%2Fsuricata%2Fpull%2F3590%2Fcommits%2F8357ef3f8ffc7d99ef6571350724160de356158b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fpull_requests%2Fshow%2Fcommits&source=header-repo&source_repo=OISF%2Fsuricata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OISF](/OISF)
/
**[suricata](/OISF/suricata)**
Public

* [Notifications](/login?return_to=%2FOISF%2Fsuricata) You must be signed in to change notification settings
* [Fork
  1.5k](/login?return_to=%2FOISF%2Fsuricata)
* [Star
   4.9k](/login?return_to=%2FOISF%2Fsuricata)

* [Code](/OISF/suricata)
* [Pull requests
  86](/OISF/suricata/pulls)
* [Actions](/OISF/suricata/actions)
* [Security](/OISF/suricata/security)
* [Insights](/OISF/suricata/pulse)

Additional navigation options

* [Code](/OISF/suricata)
* [Pull requests](/OISF/suricata/pulls)
* [Actions](/OISF/suricata/actions)
* [Security](/OISF/suricata/security)
* [Insights](/OISF/suricata/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOISF%2Fsuricata%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOISF%2Fsuricata%2Fissues%2Fnew%2Fchoose)
to your account

# Next/20181218/v8 #3590

 Merged

[inliniac](/inliniac)
merged 8 commits into
[OISF:master](/OISF/suricata/tree/master "OISF/suricata:master")
from
[victorjulien:next/20181218/v8](/victorjulien/suricata/tree/next/20181218/v8 "victorjulien/suricata:next/20181218/v8")

Dec 20, 2018

[Conversation
0](/OISF/suricata/pull/3590)
[Commits
8](/OISF/suricata/pull/3590/commits)
[Checks
0](/OISF/suricata/pull/3590/checks)
[Files changed](/OISF/suricata/pull/3590/files)

 Merged

# [Next/20181218/v8](#top) #3590

Changes from **1 commit**

Commits

[Show all changes

8 commits](/OISF/suricata/pull/3590/files)
Select commit
Hold shift + click to select a range

[`fa6b73d`
offloading: don't set multiple times per interface

victorjulien Dec 15, 2018](/OISF/suricata/pull/3590/commits/fa6b73d1c9f88d5ee534f5d85cb29d9426b78e20)
[`4c8f6b2`
offloading: on bsd, disable rxcsum and v6 variants

victorjulien Dec 15, 2018](/OISF/suricata/pull/3590/commits/4c8f6b22466e882e217a6278e026ef5beaf41979)
[`9dd925a`
userguide/install: add rust, python-yaml to ubuntu

victorjulien Dec 18, 2018](/OISF/suricata/pull/3590/commits/9dd925a46a9800000f8139f12fde0c57791a53d7)
[`e30212c`
detect: fix crash during startup with malformed yaml

victorjulien Dec 18, 2018](/OISF/suricata/pull/3590/commits/e30212c5d8b536f351927d943580b1fcac920fe9)
[`11f3659`
teredo: be stricter on what to consider valid teredo

victorjulien Dec 19, 2018](/OISF/suricata/pull/3590/commits/11f3659f64a4e42e90cb3c09fcef66894205aefe)
[`8357ef3`
proto/detect: workaround dns misdetected as dcerpc

victorjulien Dec 19, 2018](/OISF/suricata/pull/3590/commits/8357ef3f8ffc7d99ef6571350724160de356158b)
[`447c104`
smtp: improve pipelining support

catenacyber Dec 5, 2018](/OISF/suricata/pull/3590/commits/447c1042f476cb01d1020da47de4a33db113ebcb)
[`7fca771`
Fixes other affected tests for smtp pipelining

catenacyber Dec 5, 2018](/OISF/suricata/pull/3590/commits/7fca771ef4d1467a07f7df5fdf508056243a2aeb)

**File filter**

### Filter by extension

Filter by extension

.c
(1)

All 1 file type selected

---

Viewed files

[Clear filters](/OISF/suricata/pull/3590/commits/8357ef3f8ffc7d99ef6571350724160de356158b)

 **Conversations**

Failed to load comments.  Retry

 Loading

 **Jump to**

Jump to file

Failed to load files.  Retry

 Loading

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

Show whitespace

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

 [Prev](/OISF/suricata/pull/3590/commits/11f3659f64a4e42e90cb3c09fcef66894205aefe)Previous commit

 [Next](/OISF/suricata/pull/3590/commits/447c1042f476cb01d1020da47de4a33db113ebcb)Next commit

proto/detect: workaround dns misdetected as dcerpc

```
The DCERPC UDP detection would misfire on DNS with transaction
ID 0x0400. This would happen as the protocol detection engine
gives preference to pattern based detection over probing parsers for
performance reasons.

This hack/workaround fixes this specific case by still running the
probing parser if DCERPC has been detected on UDP. The probing
parser result will take precedence.

Bug [#2736](https://github.com/OISF/suricata/pull/2736).
```

* Loading branch information

[![@victorjulien](https://avatars.githubusercontent.com/u/32410611?s=40&v=4)](/victorjulien)

[victorjulien](/OISF/suricata/commits?author=victorjulien "View all commits by victorjulien")
committed
Dec 19, 2018

commit 8357ef3f8ffc7d99ef6571350724160de356158b

## There are no files selected for viewing

14 changes: 13 additions & 1 deletion

14
[src/app-layer-detect-proto.c](#diff-828364efb39780c8edef35141add91767c48a8774c2935f38a75c8eda4e33c25 "src/app-layer-detect-proto.c")

Show comments

[View file](/victorjulien/suricata/blob/8357ef3f8ffc7d99ef6571350724160de356158b/src/app-layer-detect-proto.c)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1361,6 +1361,7 @@ AppProto AppLayerProtoDetectGetProto(AppLayerProtoDetectThreadCtx \*tctx, |
|  |  | (direction & STREAM\_TOSERVER) ? "toserver" : "toclient"); |
|  |  |  |
|  |  | AppProto alproto = ALPROTO\_UNKNOWN; |
|  |  | AppProto pm\_alproto = ALPROTO\_UNKNOWN; |
|  |  |  |
|  |  | if (!FLOW\_IS\_PM\_DONE(f, direction)) { |
|  |  | AppProto pm\_results[ALPROTO\_MAX]; |
| Expand All | | @@ -1371,7 +1372,15 @@ AppProto AppLayerProtoDetectGetProto(AppLayerProtoDetectThreadCtx \*tctx, |
|  |  | pm\_results); |
|  |  | if (pm\_matches > 0) { |
|  |  | alproto = pm\_results[0]; |
|  |  | goto end; |
|  |  |  |
|  |  | /\* HACK: if detected protocol is dcerpc/udp, we run PP as well |
|  |  | \* to avoid misdetecting DNS as DCERPC. \*/ |
|  |  | if (!(ipproto == IPPROTO\_UDP && alproto == ALPROTO\_DCERPC)) |
|  |  | goto end; |
|  |  |  |
|  |  | pm\_alproto = alproto; |
|  |  |  |
|  |  | /\* fall through \*/ |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand All | | @@ -1388,6 +1397,9 @@ AppProto AppLayerProtoDetectGetProto(AppLayerProtoDetectThreadCtx \*tctx, |
|  |  | } |
|  |  |  |
|  |  | end: |
|  |  | if (alproto == ALPROTO\_UNKNOWN) |
|  |  | alproto = pm\_alproto; |
|  |  |  |
|  |  | SCReturnUInt(alproto); |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from redmine.openinfosecfoundation.org_31639e1d_20250120_233728.html ===


⚲

### Project

### General

### Profile

* [Sign in](/login)
* [Register](/account/register)

* [Home](/)
* [Projects](/projects)
* [Help](https://www.redmine.org/guide)

[Search](/projects/suricata/search?scope=subprojects):

 Suricata[All Projects](/projects?jump=issues)
# Suricata

* [Overview](/projects/suricata)
* [Activity](/projects/suricata/activity)
* [Roadmap](/projects/suricata/roadmap)
* [Issues](/projects/suricata/issues)
* [Wiki](/projects/suricata/wiki)
* [Files](/projects/suricata/files)

### Custom queries

* [8.0.0 Stories](/projects/suricata/issues?query_id=90)
* [Good First Issues](/projects/suricata/issues?query_id=41)
* [OISF community](/projects/suricata/issues?query_id=3)

Actions
Copy link
## Security #2736

closed

### DNS Golden Transaction ID - detection bypass

Added by [Alexey Vishnyakov](/users/2284) [about 6 years](/projects/suricata/activity?from=2018-12-11 "12/11/2018 03:26 PM") ago.
Updated [almost 2 years](/projects/suricata/activity?from=2023-03-15 "03/15/2023 05:20 AM") ago.

Status:ClosedPriority:HighAssignee:[Victor Julien](/users/4)Target version:[4.1.2](/versions/124 "12/21/2018")
Affected Versions:[4.0.2/4.0.3](/versions/104 "12/06/2017"), [4.1beta1](/versions/105 "03/23/2018"), [4.0.5](/versions/111 "07/18/2018")Label:CVE:[2019-1010251](https://nvd.nist.gov/vuln/detail/CVE-2019-1010251)Git IDs:

8357ef3f8ffc7d99ef6571350724160de356158b

Severity:Disclosure Date:

---

**Description**

Hello, team!

I've found an interesting problem in DNS protocol related to Transaction ID header field

I made a signature:

*alert dns any any -> any 53 ( \
msg:"DNS - Transaction ID problem, DDNS"; \
content:"|04|ddns|03|net|00|"; \
classtype:trojan-activity; \
sid:1; rev:1;)*

Please, find a pcap dump in attached archive: **23\_6594.pcap**
It contains only one packet extracted from a public sandbox.
A signature doesn't match!

I investigated this case a bit and found that for a specific range of Transaction ID values (0x6000, 0x6001, ..., 0x6010, ... 0x6594, 0x6595 and maybe more) detection still absent.
But if we choose something like 0x5FFF as example - detection will be.

I tried some another domain (as example, which is longer on 1 symbol) - and for previous Transaction ID values detection appears.
So, seems that some kind of Transaction ID influence happened.
I made a following game:

* I've generated 65536 different pcaps for a domain in **23\_6594.pcap** with all possible Transaction ID values
* I've scanned them all... and found one more magic Transaction ID value: 0x0400. More than that:
   - pcap with Transaction ID = 0x03FF - detected (**23\_03FF.pcap**)
   - pcap with Transaction ID = 0x0400 - not detected (**23\_0400.pcap**)
   - pcap with Transaction ID = 0x0401 - detected (**23\_0401.pcap**)
* Then I've reduced an original domain length, generated 65535 pcaps, scanned them... and found the same magic ID: 0x0400. And:
   - pcap with Transaction ID = 0x03FF - detected (**22\_03FF.pcap**)
   - pcap with Transaction ID = 0x0400 - not detected (**22\_0400.pcap**)
   - pcap with Transaction ID = 0x0401 - detected (**22\_0401.pcap**)
* Then I've increased an original domain length, again generated 65535 pcaps, again scanned them... and again :) found the same magic ID: 0x0400. And:
   - pcap with Transaction ID = 0x03FF - detected (**24\_03FF.pcap**)
   - pcap with Transaction ID = 0x0400 - not detected (**24\_0400.pcap**)
   - pcap with Transaction ID = 0x0401 - detected (**24\_0401.pcap**)

Finally I just made the nslookup of "suricata-ids.org" domain (**suricata.original.pcap**). Fortunately, the Transaction ID was small and I reproduced a detection with following rule:

*alert dns any any -> any 53 ( \
msg:"DNS - Transaction ID problem, suricata"; \
content:"suricata"; \
classtype:trojan-activity; \
sid:2; rev:1;)*

Than I changed the Transaction ID to 0x4000 - no detection (**suricata.0400.pcap**)
I changed it to 0x4001 - detection appears again (**suricata.0401.pcap**)

I've tested the 0x4000 magic Transaction ID with different domains (DGA - situation is the same)
Seems that we have a reliable approach to perform an information transport via the DNS tunneling without detection in DNS protocol

Could you confirm that?

Thank you
Sincerely yours, Alexey Vishnyakov

---

**Files**

| [dns.zip](/attachments/1602) (3.36 KB) [dns.zip](/attachments/download/1602/dns.zip "Download") |  | Alexey Vishnyakov, 12/11/2018 03:29 PM |  |
| --- | --- | --- | --- |

---

**Related issues**
[1](/issues?issue_id=2827&set_filter=true&status_id=%2A) (0 open — [1 closed](/issues?issue_id=2827&set_filter=true&status_id=c))

|  | Copied to Suricata - [Bug #2827](/issues/2827): DNS Golden Transaction ID - detection bypass (4.0.x) | Closed | [Victor Julien](/users/4) |  |  |  | Actions |
| --- | --- | --- | --- | --- | --- | --- | --- |

Related to
Is duplicate of
Has duplicate
Blocks
Blocked by
Precedes
Follows
Copied to
Copied from
Issue #
Delay:  days

Cancel

* [History](/issues/2736?tab=history)
* [Notes](/issues/2736?tab=notes)
* [Property changes](/issues/2736?tab=properties)

ActionsCopy link
[#1](#note-1)
#### Updated by [Alexey Vishnyakov](/users/2284) [about 6 years](/projects/suricata/activity?from=2018-12-11 "12/11/2018 03:29 PM") ago

* **File** [dns.zip](/attachments/1602) [dns.zip](/attachments/download/1602/dns.zip "Download") added

ActionsCopy link
[#2](#note-2)
#### Updated by [Victor Julien](/users/4) [about 6 years](/projects/suricata/activity?from=2018-12-19 "12/19/2018 08:58 AM") ago

* **Assignee** set to *Victor Julien*

Both are known weaknesses in protocol detection. The magic 0x4000 triggers the dcerpc protocol detection, so Suricata then considers it dcerpc. This really requires a rewrite/upgrade of the protocol detection engine. This is something we hope to do for 5.0. I'll see if I can create some hack to fix this specific issue.

The 6594 pcap triggers the teredo detection. We've had issues with this before. I'm trying to see if I can make the teredo probing stricter.

ActionsCopy link
[#3](#note-3)
#### Updated by [Victor Julien](/users/4) [about 6 years](/projects/suricata/activity?from=2018-12-19 "12/19/2018 07:34 PM") ago

* **Status** changed from *New* to *Assigned*
* **Target version** set to *4.1.2*

ActionsCopy link
[#4](#note-4)
#### Updated by [Victor Julien](/users/4) [about 6 years](/projects/suricata/activity?from=2018-12-20 "12/20/2018 09:14 AM") ago

* **Status** changed from *Assigned* to *Closed*

Fixes/workarounds in <https://github.com/OISF/suricata/pull/3590>

ActionsCopy link
[#5](#note-5)
#### Updated by [Victor Julien](/users/4) [almost 6 years](/projects/suricata/activity?from=2019-02-16 "02/16/2019 03:03 PM") ago

* **Copied to** *[Bug #2827](/issues/2827): DNS Golden Transaction ID - detection bypass (4.0.x)* added

ActionsCopy link
[#6](#note-6)
#### Updated by [Victor Julien](/users/4) [over 4 years](/projects/suricata/activity?from=2020-09-01 "09/01/2020 09:00 AM") ago

* **Tracker** changed from *Bug* to *Security*
* **CVE** set to *2019-1010251*
* **Git IDs** updated ([diff](/journals/17293/diff?detail_id=17815 "View differences"))

Actions
Copy link

Also available in: [Atom](/issues/2736.atom)
[PDF](/issues/2736.pdf)

Powered by [Redmine](https://www.redmine.org/) © 2006-2024 Jean-Philippe Lang

Loading...



=== Content from github.com_062ab47e_20250120_233726.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOISF%2Fsuricata%2Fpull%2F3590%2Fcommits%2F11f3659f64a4e42e90cb3c09fcef66894205aefe)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOISF%2Fsuricata%2Fpull%2F3590%2Fcommits%2F11f3659f64a4e42e90cb3c09fcef66894205aefe)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fpull_requests%2Fshow%2Fcommits&source=header-repo&source_repo=OISF%2Fsuricata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OISF](/OISF)
/
**[suricata](/OISF/suricata)**
Public

* [Notifications](/login?return_to=%2FOISF%2Fsuricata) You must be signed in to change notification settings
* [Fork
  1.5k](/login?return_to=%2FOISF%2Fsuricata)
* [Star
   4.9k](/login?return_to=%2FOISF%2Fsuricata)

* [Code](/OISF/suricata)
* [Pull requests
  86](/OISF/suricata/pulls)
* [Actions](/OISF/suricata/actions)
* [Security](/OISF/suricata/security)
* [Insights](/OISF/suricata/pulse)

Additional navigation options

* [Code](/OISF/suricata)
* [Pull requests](/OISF/suricata/pulls)
* [Actions](/OISF/suricata/actions)
* [Security](/OISF/suricata/security)
* [Insights](/OISF/suricata/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOISF%2Fsuricata%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOISF%2Fsuricata%2Fissues%2Fnew%2Fchoose)
to your account

# Next/20181218/v8 #3590

 Merged

[inliniac](/inliniac)
merged 8 commits into
[OISF:master](/OISF/suricata/tree/master "OISF/suricata:master")
from
[victorjulien:next/20181218/v8](/victorjulien/suricata/tree/next/20181218/v8 "victorjulien/suricata:next/20181218/v8")

Dec 20, 2018

[Conversation
0](/OISF/suricata/pull/3590)
[Commits
8](/OISF/suricata/pull/3590/commits)
[Checks
0](/OISF/suricata/pull/3590/checks)
[Files changed](/OISF/suricata/pull/3590/files)

 Merged

# [Next/20181218/v8](#top) #3590

 Show file tree

 Hide file tree

Changes from **1 commit**

Commits

[Show all changes

8 commits](/OISF/suricata/pull/3590/files)
Select commit
Hold shift + click to select a range

[`fa6b73d`
offloading: don't set multiple times per interface

victorjulien Dec 15, 2018](/OISF/suricata/pull/3590/commits/fa6b73d1c9f88d5ee534f5d85cb29d9426b78e20)
[`4c8f6b2`
offloading: on bsd, disable rxcsum and v6 variants

victorjulien Dec 15, 2018](/OISF/suricata/pull/3590/commits/4c8f6b22466e882e217a6278e026ef5beaf41979)
[`9dd925a`
userguide/install: add rust, python-yaml to ubuntu

victorjulien Dec 18, 2018](/OISF/suricata/pull/3590/commits/9dd925a46a9800000f8139f12fde0c57791a53d7)
[`e30212c`
detect: fix crash during startup with malformed yaml

victorjulien Dec 18, 2018](/OISF/suricata/pull/3590/commits/e30212c5d8b536f351927d943580b1fcac920fe9)
[`11f3659`
teredo: be stricter on what to consider valid teredo

victorjulien Dec 19, 2018](/OISF/suricata/pull/3590/commits/11f3659f64a4e42e90cb3c09fcef66894205aefe)
[`8357ef3`
proto/detect: workaround dns misdetected as dcerpc

victorjulien Dec 19, 2018](/OISF/suricata/pull/3590/commits/8357ef3f8ffc7d99ef6571350724160de356158b)
[`447c104`
smtp: improve pipelining support

catenacyber Dec 5, 2018](/OISF/suricata/pull/3590/commits/447c1042f476cb01d1020da47de4a33db113ebcb)
[`7fca771`
Fixes other affected tests for smtp pipelining

catenacyber Dec 5, 2018](/OISF/suricata/pull/3590/commits/7fca771ef4d1467a07f7df5fdf508056243a2aeb)

**File filter**

### Filter by extension

Filter by extension

.c
(3)

.h
(1)

All 2 file types selected

---

Viewed files

[Clear filters](/OISF/suricata/pull/3590/commits/11f3659f64a4e42e90cb3c09fcef66894205aefe)

 **Conversations**

Failed to load comments.  Retry

 Loading

 **Jump to**

Jump to file

Failed to load files.  Retry

 Loading

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

Show whitespace

##### Diff view

![Unified Diff View](https://github.githubassets.com/assets/unified-6de447b07fd7.svg)

Unified

![Split Diff View](https://github.githubassets.com/assets/split-b930d4a1df45.svg)

Split

Hide whitespace

 Apply and reload

* src

  + src/decode-ipv6.c
    [decode-ipv6.c](#diff-52137ec7f91aa7529a3fddb0654a03660508c3bea88282e792f317bbd215b6e2)
  + src/decode-teredo.c
    [decode-teredo.c](#diff-3062352ade35d00d3568b1b47f7c2fb47a087f36c379eb80a614b66e43a9a075)
  + src/decode.c
    [decode.c](#diff-74993c6ec05bc7a8378cd2fedce778be7a7ea6746016dd329e5c79674f2b0603)
  + src/decode.h
    [decode.h](#diff-48e701cfe9e2223cedaa68c2dad70955a5b41c803cc1a3feba33d75a18d35533)

 [Prev](/OISF/suricata/pull/3590/commits/e30212c5d8b536f351927d943580b1fcac920fe9)Previous commit

 [Next](/OISF/suricata/pull/3590/commits/8357ef3f8ffc7d99ef6571350724160de356158b)Next commit

teredo: be stricter on what to consider valid teredo

```
Invalid Teredo can lead to valid DNS traffic (or other UDP traffic)
being misdetected as Teredo. This leads to false negatives in the
UDP payload inspection.

Make the teredo code only consider a packet teredo if the encapsulated
data was decoded without any 'invalid' events being set.

Bug [#2736](https://github.com/OISF/suricata/pull/2736).
```

* Loading branch information

[![@victorjulien](https://avatars.githubusercontent.com/u/32410611?s=40&v=4)](/victorjulien)

[victorjulien](/OISF/suricata/commits?author=victorjulien "View all commits by victorjulien")
committed
Dec 19, 2018

commit 11f3659f64a4e42e90cb3c09fcef66894205aefe

## There are no files selected for viewing

40 changes: 20 additions & 20 deletions

40
[src/decode-ipv6.c](#diff-52137ec7f91aa7529a3fddb0654a03660508c3bea88282e792f317bbd215b6e2 "src/decode-ipv6.c")

Show comments

[View file](/victorjulien/suricata/blob/11f3659f64a4e42e90cb3c09fcef66894205aefe/src/decode-ipv6.c)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -150,28 +150,28 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | SCEnter(); |
|  |  |  |
|  |  | uint8\_t \*orig\_pkt = pkt; |
|  |  | uint8\_t nh = 0; /\* careful, 0 is actually a real type \*/ |
|  |  | uint8\_t nh = IPV6\_GET\_NH(p); /\* careful, 0 is actually a real type \*/ |
|  |  | uint16\_t hdrextlen = 0; |
|  |  | uint16\_t plen; |
|  |  | uint16\_t plen = len; |
|  |  | char dstopts = 0; |
|  |  | char exthdr\_fh\_done = 0; |
|  |  | int hh = 0; |
|  |  | int rh = 0; |
|  |  | int eh = 0; |
|  |  | int ah = 0; |
|  |  |  |
|  |  | nh = IPV6\_GET\_NH(p); |
|  |  | plen = len; |
|  |  |  |
|  |  | while(1) |
|  |  | { |
|  |  | /\* No upper layer, but we do have data. Suspicious. \*/ |
|  |  | if (nh == IPPROTO\_NONE && plen > 0) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_DATA\_AFTER\_NONE\_HEADER); |
|  |  | if (nh == IPPROTO\_NONE) { |
|  |  | if (plen > 0) { |
|  |  | /\* No upper layer, but we do have data. Suspicious. \*/ |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_DATA\_AFTER\_NONE\_HEADER); |
|  |  | } |
|  |  | SCReturn; |
|  |  | } |
|  |  |  |
|  |  | if (plen < 2) { /\* minimal needed in a hdr \*/ |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | SCReturn; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -204,7 +204,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | SCLogDebug("hdrextlen %"PRIu8, hdrextlen); |
|  |  |  |
|  |  | if (hdrextlen > plen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | SCReturn; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -243,7 +243,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | IPV6\_SET\_L4PROTO(p,nh); |
|  |  | hdrextlen = (\*(pkt+1) + 1) << 3; |
|  |  | if (hdrextlen > plen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | SCReturn; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -288,7 +288,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | if (optslen > plen) { |
|  |  | /\* since the packet is long enough (we checked |
|  |  | \* plen against hdrlen, the optlen must be malformed. \*/ |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | /\* skip past this extension so we can continue parsing the rest |
|  |  | \* of the packet \*/ |
|  |  | nh = \*pkt; |
| Expand All | | @@ -311,7 +311,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | } |
|  |  |  |
|  |  | if (offset + 1 >= optslen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | break; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -320,7 +320,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  |  |
|  |  | /\* see if the optlen from the packet fits the total optslen \*/ |
|  |  | if ((offset + 1 + ip6\_optlen) > optslen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | break; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -339,7 +339,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | ra->ip6ra\_len = ip6\_optlen; |
|  |  |  |
|  |  | if (ip6\_optlen < sizeof(ra->ip6ra\_value)) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | break; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -355,7 +355,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | jumbo->ip6j\_len = ip6\_optlen; |
|  |  |  |
|  |  | if (ip6\_optlen < sizeof(jumbo->ip6j\_payload\_len)) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | break; |
|  |  | } |
|  |  |  |
| Expand All | | @@ -370,7 +370,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | hao->ip6hao\_len = ip6\_optlen; |
|  |  |  |
|  |  | if (ip6\_optlen < sizeof(hao->ip6hao\_hoa)) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_EXTHDR\_INVALID\_OPTLEN); |
|  |  | break; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -422,7 +422,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | uint16\_t prev\_hdrextlen = hdrextlen; |
|  |  | hdrextlen = sizeof(IPV6FragHdr); |
|  |  | if (hdrextlen > plen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | SCReturn; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -468,7 +468,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | IPV6\_SET\_L4PROTO(p,nh); |
|  |  | hdrextlen = sizeof(IPV6EspHdr); |
|  |  | if (hdrextlen > plen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | SCReturn; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -497,7 +497,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | SCLogDebug("hdrextlen %"PRIu8, hdrextlen); |
|  |  |  |
|  |  | if (hdrextlen > plen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | SCReturn; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -538,7 +538,7 @@ DecodeIPV6ExtHdrs(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt |
|  |  | case IPPROTO\_SHIM6: |
|  |  | hdrextlen = 8 + (\*(pkt+1) \* 8); /\* 8 bytes + length in 8 octet units \*/ |
|  |  | if (hdrextlen > plen) { |
|  |  | ENGINE\_SET\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | ENGINE\_SET\_INVALID\_EVENT(p, IPV6\_TRUNC\_EXTHDR); |
|  |  | SCReturn; |
|  |  | } |
|  |  | nh = \*pkt; |
| Expand Down | |  |

18 changes: 16 additions & 2 deletions

18
[src/decode-teredo.c](#diff-3062352ade35d00d3568b1b47f7c2fb47a087f36c379eb80a614b66e43a9a075 "src/decode-teredo.c")

Show comments

[View file](/victorjulien/suricata/blob/11f3659f64a4e42e90cb3c09fcef66894205aefe/src/decode-teredo.c)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,20 +96,34 @@ int DecodeTeredo(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, uint8\_t \*pkt, |
|  |  | /\* There is no specific field that we can check to prove that the packet |
|  |  | \* is a Teredo packet. We've zapped here all the possible Teredo header |
|  |  | \* and we should have an IPv6 packet at the start pointer. |
|  |  | \* We then can only do two checks before sending the encapsulated packets |
|  |  | \* We then can only do a few checks before sending the encapsulated packets |
|  |  | \* to decoding: |
|  |  | \* - The packet has a protocol version which is IPv6. |
|  |  | \* - The IPv6 length of the packet matches what remains in buffer. |
|  |  | \* - HLIM is 0. This would technically be valid, but still weird. |
|  |  | \* - NH 0 (HOP) and not enough data. |
|  |  | \* |
|  |  | \* If all these conditions are met, the tunnel decoder will be called. |
|  |  | \* If the packet gets an invalid event set, it will still be rejected. |
|  |  | \*/ |
|  |  | if (IP\_GET\_RAW\_VER(start) == 6) { |
|  |  | IPV6Hdr \*thdr = (IPV6Hdr \*)start; |
|  |  |  |
|  |  | /\* ignore hoplimit 0 packets, most likely an artifact of bad detection \*/ |
|  |  | if (IPV6\_GET\_RAW\_HLIM(thdr) == 0) |
|  |  | return TM\_ECODE\_FAILED; |
|  |  |  |
|  |  | /\* if nh is 0 (HOP) with little data we have a bogus packet \*/ |
|  |  | if (IPV6\_GET\_RAW\_NH(thdr) == 0 && IPV6\_GET\_RAW\_PLEN(thdr) < 8) |
|  |  | return TM\_ECODE\_FAILED; |
|  |  |  |
|  |  | if (len == IPV6\_HEADER\_LEN + |
|  |  | IPV6\_GET\_RAW\_PLEN(thdr) + (start - pkt)) { |
|  |  | if (pq != NULL) { |
|  |  | int blen = len - (start - pkt); |
|  |  | /\* spawn off tunnel packet \*/ |
|  |  | Packet \*tp = PacketTunnelPktSetup(tv, dtv, p, start, blen, |
|  |  | DECODE\_TUNNEL\_IPV6, pq); |
|  |  | DECODE\_TUNNEL\_IPV6\_TEREDO, pq); |
|  |  | if (tp != NULL) { |
|  |  | PKT\_SET\_SRC(tp, PKT\_SRC\_DECODER\_TEREDO); |
|  |  | /\* add the tp to the packet queue. \*/ |
| Expand Down | |  |

11 changes: 8 additions & 3 deletions

11
[src/decode.c](#diff-74993c6ec05bc7a8378cd2fedce778be7a7ea6746016dd329e5c79674f2b0603 "src/decode.c")

Show comments

[View file](/victorjulien/suricata/blob/11f3659f64a4e42e90cb3c09fcef66894205aefe/src/decode.c)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -79,6 +79,7 @@ int DecodeTunnel(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, |
|  |  | case DECODE\_TUNNEL\_IPV4: |
|  |  | return DecodeIPV4(tv, dtv, p, pkt, len, pq); |
|  |  | case DECODE\_TUNNEL\_IPV6: |
|  |  | case DECODE\_TUNNEL\_IPV6\_TEREDO: |
|  |  | return DecodeIPV6(tv, dtv, p, pkt, len, pq); |
|  |  | case DECODE\_TUNNEL\_VLAN: |
|  |  | return DecodeVLAN(tv, dtv, p, pkt, len, pq); |
| Expand All | | @@ -87,7 +88,7 @@ int DecodeTunnel(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*p, |
|  |  | case DECODE\_TUNNEL\_ERSPAN: |
|  |  | return DecodeERSPAN(tv, dtv, p, pkt, len, pq); |
|  |  | default: |
|  |  | SCLogInfo("FIXME: DecodeTunnel: protocol %" PRIu32 " not supported.", proto); |
|  |  | SCLogDebug("FIXME: DecodeTunnel: protocol %" PRIu32 " not supported.", proto); |
|  |  | break; |
|  |  | } |
|  |  | return TM\_ECODE\_OK; |
| Expand Down  Expand Up | | @@ -303,8 +304,12 @@ Packet \*PacketTunnelPktSetup(ThreadVars \*tv, DecodeThreadVars \*dtv, Packet \*pare |
|  |  | ret = DecodeTunnel(tv, dtv, p, GET\_PKT\_DATA(p), |
|  |  | GET\_PKT\_LEN(p), pq, proto); |
|  |  |  |
|  |  | if (unlikely(ret != TM\_ECODE\_OK)) { |
|  |  | /\* Not a tunnel packet, just a pseudo packet \*/ |
|  |  | if (unlikely(ret != TM\_ECODE\_OK) || |
|  |  | (proto == DECODE\_TUNNEL\_IPV6\_TEREDO && (p->flags & PKT\_IS\_INVALID))) |
|  |  | { |
|  |  | /\* Not a (valid) tunnel packet \*/ |
|  |  | SCLogDebug("tunnel packet is invalid"); |
|  |  |  |
|  |  | p->root = NULL; |
|  |  | UNSET\_TUNNEL\_PKT(p); |
|  |  | TmqhOutputPacketpool(tv, p); |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[src/decode.h](#diff-48e701cfe9e2223cedaa68c2dad70955a5b41c803cc1a3feba33d75a18d35533 "src/decode.h")

Show comments

[View file](/victorjulien/suricata/blob/11f3659f64a4e42e90cb3c09fcef66894205aefe/src/decode.h)
Edit file

Delete file

[Open in desktop](https://desktop.github.com)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -905,6 +905,7 @@ enum DecodeTunnelProto { |
|  |  | DECODE\_TUNNEL\_VLAN, |
|  |  | DECODE\_TUNNEL\_IPV4, |
|  |  | DECODE\_TUNNEL\_IPV6, |
|  |  | DECODE\_TUNNEL\_IPV6\_TEREDO, /\*\*< separate protocol for stricter error handling \*/ |
|  |  | DECODE\_TUNNEL\_PPP, |
|  |  | }; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


