=== Content from metalamin.github.io_c6626ff7_20250120_232357.html ===
  [Metalamin Blog](/)

* [About](https://www.linkedin.com/in/amine-taouirsa/)

     Toggle Menu

 ![Amine Taouirsa](/assets/images/Bio.jpg)
### Amine Taouirsa

How about ... 'xchg eax, eax'!!

 Follow

* Madrid, Spain
* [Website](http://metalamin.github.io)
* [Twitter](https://twitter.com/metalamin)
* [GitHub](https://github.com/metalamin)
* [Telegram](http://t.me/metalamin)
# Quick Chat(WordPress) - Multiple SQL Injections

#### Index

* [Summary](#summary)
* [SQL Injection 1 (CVE-2018-12535)](#sql-injection-1-cve-2018-12535)
* [SQL Injection 2 (CVE-2018-12534)](#sql-injection-2-cve-2018-12534)
* [Dorks](#dorks)
## Summary

This story starts with a head-hunter offering me a job for a major company. No need to say I always screen the employer as I expect they would do to me. If we add the fact that I was a little bored, I ended up finding a 0-day in a WordPress plugin used in one of their servers.

Even not a being security company they take it very seriously. Kudos for their security team as they managed it blazingly fast.

Let’s take a look at this vulnerability found on the plugin [‘Quick Chat’](https://wordpress.org/plugins/quick-chat/) for WordPress.

## SQL Injection 1 (CVE-2018-12535)

**Status: still not patched**

The plugin is subject to SQL injections through the ajax call **quick-chat-ajax-username-check**. As we may appreciate in this vulnerable code:

 ![](https://metalamin.github.io/assets/images/Quick-Chat-SQLi/like_escape.png)

The function **like\_escape()** is not meant to act as security measure against SQL injections. In fact, it only escapes special characters related to the LIKE statement. Even the newer **wpdb::esc\_like** is not safe as stated on the official documentation: [“The output is not SQL safe.”](https://developer.wordpress.org/reference/classes/wpdb/esc_like/)

The vulnerable parameter is **username\_check** as we can appreciate on the following POC where the SQL injection is *Blind Boolean Based*.

  [![SQLi True statment request](/assets/images/Quick-Chat-SQLi/SQL1_true_req.png)](/assets/images/Quick-Chat-SQLi/SQL1_true_req.png "SQLi True statment request")   [![SQLi True statment response](/assets/images/Quick-Chat-SQLi/SQL1_true_rsp.png)](/assets/images/Quick-Chat-SQLi/SQL1_true_rsp.png "SQLi True statment response")   [![SQLi False statment request](/assets/images/Quick-Chat-SQLi/SQL1_false_req.png)](/assets/images/Quick-Chat-SQLi/SQL1_false_req.png "SQLi False statment request")   [![SQLi False statment response](/assets/images/Quick-Chat-SQLi/SQL1_false_rsp.png)](/assets/images/Quick-Chat-SQLi/SQL1_false_rsp.png "SQLi False statment response")

*Note: if “no\_participation” is set to 1, login is required to proceed with the injection.*

# Mitigation

Even if the best way to mitigate SQL injection is to use **wpdb::prepare()**, in this case **esc\_sql()** may be used as it escapes values to be included in strings in the query.

On line 399:

```
 $sql = 'SELECT COUNT(*) FROM '.$quick_chat_users_table_name.' WHERE alias like "%' . like_escape($_POST['username_check']) . '";';

```

change to:

```
 $sql = 'SELECT COUNT(*) FROM '.$quick_chat_users_table_name.' WHERE alias like "%' . esc_sql(like_escape($_POST['username_check'])) . '";';

```
## SQL Injection 2 (CVE-2018-12534)

**Status: patched on version 4.0**

The plugin was subject to SQL injections through the ajax call. This SQLi can be found on the **to\_delete\_ids** parameter when using the action **quick-chat-ajax-delete**.

Proof of concept to get the current database name using an error based technique:

```
action=quick-chat-ajax-delete&to_delete_ids[]=666,(select 1 from(select count(*),concat((select (select concat(0x7e,0x27,Hex(cast(database() as char)),0x27,0x7e)) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)

```
  [![SQLi Error based request](/assets/images/Quick-Chat-SQLi/SQL2_error_req.png)](/assets/images/Quick-Chat-SQLi/SQL2_error_req.png "SQLi Error based request")   [![SQLi Error based response](/assets/images/Quick-Chat-SQLi/SQL2_error_rsp.png)](/assets/images/Quick-Chat-SQLi/SQL2_error_rsp.png "SQLi Error based response")
## Dorks

The plugin sets the cookie “quick\_chat\_alias” so it can be easily tracked searching for it on [shodan.io](https://www.shodan.io/) or [fofa.so](https://fofa.so)

 ![](https://metalamin.github.io/assets/images/Quick-Chat-SQLi/Fofa.png)

FOFA Dork

 **Updated:** June 12, 2018

  [Twitter](https://twitter.com/intent/tweet?via=metalamin&text=Quick+Chat%28WordPress%29+-+Multiple+SQL+Injections%20https%3A%2F%2Fmetalamin.github.io%2FQuick-Chat-SQLi-EN%2F "Share on Twitter")  [Facebook](https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmetalamin.github.io%2FQuick-Chat-SQLi-EN%2F "Share on Facebook")  [Google+](https://plus.google.com/share?url=https%3A%2F%2Fmetalamin.github.io%2FQuick-Chat-SQLi-EN%2F "Share on Google Plus")  [LinkedIn](https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmetalamin.github.io%2FQuick-Chat-SQLi-EN%2F "Share on LinkedIn") [Previous](/MachForm-not-0-day-EN/ "Ceci n’est pas un 0-Day (MachForm) ") Next

* [Twitter](https://twitter.com/metalamin)
* [GitHub](https://github.com/metalamin)
* [Feed](/feed.xml)
© 2018 Metalamin Labs. Powered by [Jekyll](https://jekyllrb.com) & [Minimal Mistakes](https://mademistakes.com/work/minimal-mistakes-jekyll-theme/).
