```text
Relevant to CVE-2019-5087

Root cause:
Integer overflow in the `flattenIncrementally` function when calculating the row's allocation size, leading to heap corruption.

Vulnerability:
Integer overflow when allocating memory for rows, specifically in the line `rows[y] = xcfmalloc(4*(spec->dim.c.r-spec->dim.c.l));`. A large width value (greater than 0x3fffffff) can cause the multiplication by 4 to overflow.

Impact:
Heap corruption, potentially leading to arbitrary code execution.

Attack vector:
Opening a specially crafted XCF file that triggers a large width value during row allocation.

Attacker capability:
The attacker needs to create a malicious XCF file. The victim needs to open this file using `xcf2png` or `xcf2pnm`.
```