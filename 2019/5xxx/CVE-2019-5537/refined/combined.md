=== Content from kb.vmware.com_c583bfe6_20250121_021201.html ===


search

cancel

Search

### Enabling secure backup and restore in the vCenter Server Appliance

book
#### Article ID: 310399

calendar\_today
#### Updated On:

#### Products

VMware vCenter Server 7.0
VMware vCenter Server 6.0

Show More
Show Less

#### Issue/Introduction

This article provides information to configure file based backup and restore of the vCenter Server Appliance with secure file transfer.

#### Environment

VMware vCenter Server Appliance 6.7.x
VMware vCenter Server 7.0.x
VMware vCenter Server Appliance 6.5.x

#### Resolution

**Note**: By default, strict certificate validation is not enabled.

To enable strict certificate validation follow these steps to configure VCSA with the certificate for HTTPS / FTPS File-Based Backup or Restore features.

### Backup

1. Connect to the vCenter Server Appliance using SSH with root credentials
2. Backup the /etc/applmgmt/appliance/appliance.conf file.

root@vcsa1 [ ~ ]# cp /etc/applmgmt/appliance/appliance.conf /etc/applmgmt/appliance/appliance.conf.backup
root@vcsa1 [ ~ ]# cd /etc/applmgmt/appliance
root@vcsa1 [ /etc/applmgmt/appliance ]# ls -lh
total 60K
-rwxr-xr-x 1 root root  841 Oct 12 09:45 appliance.conf
-rwxr-xr-x 1 root root  841 Feb 24 14:30 appliance.conf.backup

3. Open the /etc/applmgmt/appliance/appliance.conf file:

vi /etc/applmgmt/appliance/appliance.conf

4. Search for the key validateCerts
   * if the key exists, change it to "validateCerts": true
   * If the key does not exist, add "validateCerts": true under the backupRestore section.
5. Restart the appliance management service with these commands:

**Caution**: Running these commands will cause vCenter Server downtime.

service-control --stop applmgmt
service-control --start applmgmt

6. Add the CA cert or SSH host key thumb print of the target server depending on the transfer method:
   * For FTPS or HTTPS transfers, copy the CA cert to /etc/applmgmt/appliance/br\_servercert.crt on the VCSA.
   * For SCP or SFTP based backup restore, copy the ssh host key thumb print of the backup server to /etc/applmgmt/appliance/br\_known\_hosts on the VCSA.
   * Entries should be in: IP,FQDN *algorithm* *Key* format. You may have both IP and FQDN on the same line or have two line entries one for IP and one for FQDN.
7. Start the backup of vCenter
   * Reference: [\* VMware DOCS: VMware vSphere - Manually Back up vCenter Server by Using the vCenter Server Management Interface](https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-vcenter-installation/GUID-8C9D5260-291C-44EB-A79C-BFFF506F2216.html)

### Restore

1. Begin a restore operation stopping at Stage 1.
2. Open the /etc/applmgmt/appliance/appliance.conf file with a text editor
3. Search for the key validateCerts
   * if the key exists, change it to "validateCerts": true
   * If the key does not exist, add "validateCerts": true under the backupRestore section.
4. Restart the appliance management service with these commands:

**Caution**: Running these commands will cause vCenter Server downtime.
service-control --stop applmgmt
service-control --start applmgmt

5. Add the CA cert or SSH host key thumb print depending on the transfer method:

* For FTPS or HTTPS transfers, copy the CA cert to /etc/applmgmt/appliance/br\_servercert.crt on the VCSA.
* For SCP or SFTP based backup restore, copy the ssh host key thumb print of the backup server to /etc/applmgmt/appliance/br\_known\_hosts on the VCSA.
  + Copy the ssh host key thumb print of the backup server to /etc/applmgmt/appliance/br\_known\_hosts on the VCSA by running command: $ ssh -q -p 22 -i /root/.ssh/id\_rsa -o UserKnownHostsFile=/root/.ssh/br\_temp\_known\_hosts [[email protected]](/cdn-cgi/l/email-protection) echo ~
  + Now copy this file to the directory as shown : $  cp /root/.ssh/br\_temp\_known\_hosts /etc/applmgmt/appliance/br\_known\_hosts
  + Remove the temp\_known host file :$  rm /root/.ssh/br\_temp\_known\_hosts /

6. Start the Restore operation with the VAMI UI on port 5480: *vCenter FQDN or IP*:5480 or alternatively  using the command appliancesh

#### Additional Information

For more information on VMware Native File Based Backup/Restore:

* [Overview of Backup and Restore options in vCenter Server 6.x (2149237)](https://kb.vmware.com/s/article/2149237)
* [Considerations and Limitations for File-Based Backup and Restore](https://docs.vmware.com/en/VMware-vSphere/7.0/com.vmware.vcenter.install.doc/GUID-AFF34FA6-B7CF-4AE0-9C12-C674F160682C.html)
* [Backup and Restore options in vCenter Server 6.x/7.0.x - Overview](https://kb.vmware.com/s/article/2149237)
* [Back up and restore vCenter Server Appliance/vCenter Server 6.x vPostgres database](https://kb.vmware.com/s/article/2091961)

**Note:**

* If a custom certificate it to be used for FTPS site.
* Then it is required to provide the entire chain (root + Intermediate + FTPS\_ cert ) and name it "br\_servercert.crt" as mentioned in Step 5 of KB article.

Impact/Risks:
Warning:
Before making any changes to certificates, ensure you have taken proper snapshots of your SSO domain. This means that you must shut down all vCenter Servers or PSCs that are in the SSO domain at the same time, then snapshot them, and power them on again.  If you need to revert to one of these snapshots, shut all the nodes down, and revert all nodes to the snapshot. Failure to perform these steps will lead to replication problems across the PSC databases.

#### Feedback

thumb\_up
Yes

thumb\_down
No

Powered by
[![Wolken Software](https://cdn.wolkenservicedesk.com/wolken-footer-image.png)](https://www.wolkensoftware.com/)



=== Content from www.vmware.com_a213c783_20250121_000212.html ===


Menu

* [Products](https://www.broadcom.com/products/)
* [Solutions](https://www.broadcom.com/solutions)
* [Support and Services](https://www.broadcom.com/support)
* [Company](https://www.broadcom.com/company/about-us/)
* [How To Buy](https://www.broadcom.com/how-to-buy/#sales)

* Log in

  [Log In](/c/portal/login)
  [Register](https://profile.broadcom.com/web/registration)

[Register](https://profile.broadcom.com/web/registration)
[Login](/c/portal/login)

VMSA-2019-0018:VMware vCenter Server Appliance updates address sensitive information disclosure vulnerability in backup and restore functions

Product/Component

VMware

0 more products

List of Products

1 Products

* VMware

Notification Id

23563

Last Updated

22 October 2019

Initial Publication Date

22 October 2019

Status

CLOSED

Severity

MEDIUM

CVSS Base Score

6.8

WorkAround

Affected CVE

CVE-2019-5537,CVE-2019-5538

## VMware Security Advisories

| Advisory ID | VMSA-2019-0018 |
| --- | --- |
| Advisory Severity | Moderate |
| CVSSv3 Range | 6.8 |
| Synopsis | VMware vCenter Server Appliance updates address sensitive information disclosure vulnerability in backup and restore functions (CVE-2019-5537, CVE-2019-5538) |
| Issue Date | 2019-10-24 |
| Updated On | 2019-10-24 (Initial Advisory) |
| CVE(s) | CVE-2019-5537, CVE-2019-5538 |

#####

##### **1. Impacted Products**

VMware vCenter Server Appliance

#####

##### **2. Introduction**

###### Vulnerabilities in the File-Based Backup and Restore functions of vCenter Server Appliance were privately reported to the VMware Security Response Center. Updates are available which allow enablement of strict certificate validation to remediate these vulnerabilities.

#####

##### **3. VMware vCenter Server Appliance sensitive information disclosure vulnerabilities in File-Based Backup and Restore functions (CVE-2019-5537 and CVE-2019-5538)**

**Description:**

Sensitive information disclosure vulnerabilities resulting from a lack of certificate validation during the File-Based Backup and Restore operations of VMware vCenter Server Appliance may allow a malicious actor to intercept sensitive data in transit over FTPS and HTTPS (CVE-2019-5537) as well as SCP (CVE-2019-5538). VMware has evaluated the severity of these issues to be in the [Moderate severity range](https://www.vmware.com/support/policies/security_response.html) with a maximum CVSSv3 base score of [6.8](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:N/A:N).

**Known Attack Vectors:**

A malicious actor with man-in-the-middle positioning between vCenter Server Appliance and a backup target may be able to intercept sensitive data in transit during File-Based Backup and Restore operations.

**Resolution:**

To remediate CVE-2019-5537 and CVE-2019-5538 first apply the patches listed in the 'Fixed Version' column and then follow the instructions documented in [KB75156](https://kb.vmware.com/s/article/75156) listed in the 'Additional Documentation' column found in the 'Resolution Matrix' below to enforce strict certificate validation.

**Workarounds:**

None.

**Additional Documentation:**

To avoid breaking currently configured File-Based Backup and Restore workflows, remediation of CVE-2019-5537 and CVE-2019-5538 is not enabled by default. After upgrading vCenter Server Appliance, follow the steps in [KB75156](https://kb.vmware.com/s/article/75156) to enforce strict certificate validation.

**Notes:**

None.

**Acknowledgements:**

VMware would like to thank Thorsten Tüllmann, Karlsruhe Institute of Technology and James Renken for independently reporting these issues to us.

**Response Matrix:**

| Product | Version | Running On | CVE Identifier | CVSSV3 | Severity | Fixed Version | Workarounds | Additional Documents |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| vCenter Server Appliance | 6.7 | Virtual Appliance | CVE-2019-5537, CVE-2019-5538 | [6.8](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:N/A:N) | [Moderate](https://www.vmware.com/support/policies/security_response.html) | [6.7u3a](https://my.vmware.com/web/vmware/details?productId=742&rPId=38207&downloadGroup=VC67U3a) | None | [KB75156](https://kb.vmware.com/s/article/75156) |
| vCenter Server Appliance | 6.5 | Virtual Appliance | CVE-2019-5537, CVE-2019-5538 | [6.8](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:N/A:N) | [Moderate](https://www.vmware.com/support/policies/security_response.html) | [6.5u3d](https://my.vmware.com/web/vmware/details?productId=614&rPId=38398&downloadGroup=ESXI65U3D) | None | [KB75156](https://kb.vmware.com/s/article/75156) |
| vCenter Server Appliance | 6.0 | Virtual Appliance | CVE-2019-5537, CVE-2019-5538 | N/A | N/A | Unaffected | None | None |

**4. References**

 **Fixed Version(s) and Release Notes:**

VMware vCenter Server Appliance 6.7u3a
<https://my.vmware.com/web/vmware/details?productId=742&rPId=38207&downloadGroup=VC67U3a>

VMware vCenter Server Appliance 6.5u3d
<https://my.vmware.com/web/vmware/details?productId=614&rPId=38398&downloadGroup=ESXI65U3D>

**Additional Documentation:**

<https://kb.vmware.com/s/article/75156>

**FIRST CVSSv3 Calculator:**
<https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:N/A:N>

**Mitre CVE Dictionary Links:**

<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5537>

<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-5538>

##### **5. Change log**

**2019-10-24: VMSA-2019-0018**

Initial security advisory detailing remediations for CVE-2019-5537 and CVE-2019-5538 in VMware vCenter Server Appliance 6.7u3a and 6.5u3d.

##### **6. Contact**

E-mail list for product security notifications and announcements:

<https://lists.vmware.com/cgi-bin/mailman/listinfo/security-announce>

This Security Advisory is posted to the following lists:

[[email protected]](/cdn-cgi/l/email-protection#2053454355524954590d414e4e4f554e4345604c495354530e564d574152450e434f4d)

[[email protected]](/cdn-cgi/l/email-protection#6103140615130010211204021413081518070e0214124f020e0c)

[[email protected]](/cdn-cgi/l/email-protection#bfd9cad3d3dbd6ccdcd3d0cccacddaffccdadcd3d6cccbcc91d0cdd8)

E-mail: [[email protected]](/cdn-cgi/l/email-protection)

PGP key at:

<https://kb.vmware.com/kb/1055>

VMware Security Advisories

<https://www.vmware.com/security/advisories>

VMware Security Response Policy

<https://www.vmware.com/support/policies/security_response.html>

VMware Lifecycle Support Phases

<https://www.vmware.com/support/policies/lifecycle.html>

VMware Security & Compliance Blog

<https://blogs.vmware.com/security>

Twitter

<https://twitter.com/VMwareSRC>

Copyright 2019 VMware Inc. All rights reserved.

Hidden

#####

×

It appears your Broadcom Products and Services are

supported by one of our certified Support partners

Click below to be redirected to the appropriate Support

Partner Portal to request support

For non-product related issues (Support Portal / Licensing) Click HERE

Continue

#####

×

For **Technical Support** (issues with products or services)

1. Select **Technical** to be redirected to the My Entitlements page
2. Expand the product you require support on
3. Select the case icon from the case column
4. You will be redirected to the appropriate vendor portal where you can raise your technical request

For **Non-Technical Support** (issues with portal access, license keys, software downloads)

1. Select **Non-Technical** to be redirected to Broadcom's case management portal

Technical
Non-Technical

#####

×

# Access Denied

This feature has been disabled by your administrator.

#####

×

To prevent this message from showing again, please enable pop-up blockers for [support.broadcom.com](https://support.broadcom.com/)
or click Continue to proceed.

Continue

Top

* [Products](https://www.broadcom.com/products)
* [Solutions](https://www.broadcom.com/solutions)
* [Support and Services](https://www.broadcom.com/support)
* [Company](https://www.broadcom.com/)
* [How to Buy](https://www.broadcom.com/how-to-buy)

 Copyright © 2005-2024 Broadcom. All Rights Reserved. The term “Broadcom” refers to Broadcom Inc. and/or its subsidiaries.

* [Accessibility](https://www.broadcom.com/company/legal/accessibility)
* [Privacy](https://www.broadcom.com/company/legal/privacy)
* [Supplier Responsibility](https://www.broadcom.com/company/citizenship/supplier-responsibility)
* [Terms of Use](https://www.broadcom.com/company/legal/terms-of-use)
* [Site Map](https://www.broadcom.com/sitemap)


