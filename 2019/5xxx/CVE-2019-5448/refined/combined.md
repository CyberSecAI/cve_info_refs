=== Content from github.com_6ef06f19_20250121_004730.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FChALkeR%2Fnotes%2Fblob%2Fmaster%2FYarn-vuln.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FChALkeR%2Fnotes%2Fblob%2Fmaster%2FYarn-vuln.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=ChALkeR%2Fnotes)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ChALkeR](/ChALkeR)
/
**[notes](/ChALkeR/notes)**
Public

* [Notifications](/login?return_to=%2FChALkeR%2Fnotes) You must be signed in to change notification settings
* [Fork
  75](/login?return_to=%2FChALkeR%2Fnotes)
* [Star
   1.3k](/login?return_to=%2FChALkeR%2Fnotes)

* [Code](/ChALkeR/notes)
* [Issues
  0](/ChALkeR/notes/issues)
* [Pull requests
  1](/ChALkeR/notes/pulls)
* [Actions](/ChALkeR/notes/actions)
* [Security](/ChALkeR/notes/security)
* [Insights](/ChALkeR/notes/pulse)

Additional navigation options

* [Code](/ChALkeR/notes)
* [Issues](/ChALkeR/notes/issues)
* [Pull requests](/ChALkeR/notes/pulls)
* [Actions](/ChALkeR/notes/actions)
* [Security](/ChALkeR/notes/security)
* [Insights](/ChALkeR/notes/pulse)

## Files

 master
## Breadcrumbs

1. [notes](/ChALkeR/notes/tree/master)
/
# Yarn-vuln.md

Copy path Blame  Blame
## Latest commit

## History

[History](/ChALkeR/notes/commits/master/Yarn-vuln.md)118 lines (81 loc) · 7.84 KB master
## Breadcrumbs

1. [notes](/ChALkeR/notes/tree/master)
/
# Yarn-vuln.md

Top
## File metadata and controls

* Preview
* Code
* Blame

118 lines (81 loc) · 7.84 KB[Raw](https://github.com/ChALkeR/notes/raw/refs/heads/master/Yarn-vuln.md)

*First of all, an affiliation change notice (this is recent):

I am currently working for [Exodus](https://www.exodus.io/) and am sponsored by them to perform security research.*

# Yarn transferred npm credentials over unencrypted http connection

This was reported by me through the [Node.js third-party modules](https://hackerone.com/nodejs-ecosystem) program
and was fixed in the just-released yarn v1.17.3. See also [yarn blog post](https://yarnpkg.com/blog/2019/07/12/recommended-security-update/) on this.

## Vulnerability description

For scoped packages that are listed as `resolved "http://registry.npmjs.org/@`... in `yarn.lock`, affected [yarn](https://www.npmjs.com/package/yarn) versions
transfer npm credentials (i.e. `_authToken`) over unencrypted http connection.
This allows any MitM (for example, a proxy or a VPN, or a cafeteria Wi-Fi) to sniff out npm credentials,
given that the developer performs `yarn install` on such a `yarn.lock` file.

## Timeline

* 2019-07-12 - Found
* 2019-07-12 11:31 UTC - Reported to [Node.js third-party modules](https://hackerone.com/nodejs-ecosystem) program
* 2019-07-12 12:12 UTC - Triaged
* 2019-07-12 12:19 UTC - Yarn dev joined the conversation
* 2019-07-12 12:47 UTC - Initial response and confirmation from Yarn dev
* 2019-07-12 13:22 UTC - [Fix PR](https://github.com/yarnpkg/yarn/pull/7393) created by Yarn devs
* 2019-07-12 14:19 UTC - Fix landed
* 2019-07-12 15:28 UTC - Fixed version (v1.17.3) released as `rc`
* 2019-07-12 21:42 UTC - Fixed version (v1.17.3) released as `latest`
* 2019-07-13 08:40 UTC - Yarn blog post published

The timeline was really good on this, this was found, accepted, fixed, and deployed in the same day.

## Impact

Attacker (MitM) being able to:

* Impersonate the affected account
* Publish packages (including those containing malicious code) from the affected account that could also get used by the affected account/company in the future (for protected packages) and by anyone in the ecosystem (for public packages)
* Perform logout and break installs of protected packages
* Unpublish packages from the registry (with limitations)

## Exploitability

A quick search shows that there is a large number of `yarn.lock` files affected by this on GitHub, [some](https://github.com/EC-Nordbund/ec-verwaltungs-app/blob/ab961352d5dd53834a51793d6e2c4bc69a2b22d4/packages/api/yarn.lock#L36) [examples](https://github.com/nujabes403/boilerplate2/blob/61613e526aec02c5dd4227457deb8676d66780d0/yarn.lock#L7).

There seem to be many of those.

Looks like not only it was possible to craft a `yarn.lock` with a malicious intent, but also this seems to be a common pattern that yarn created itself at some point or under some circumstances and that gets persistent from older versions.

Yarn explanation (from their [blog post](https://yarnpkg.com/blog/2019/07/12/recommended-security-update/)):

> For a few months in 2018, the npm registry [returned http urls instead of the regular https ones](https://npm.community/t/some-packages-have-dist-tarball-as-http-and-not-https/285/40). Although the problem seems to have been corrected earlier this year, the lockfile entries generated during this period may still reference http urls and cause Yarn to send authentication data unencrypted.

This looks very common, mostly coming from `@babel` and `@types` scopes.

This could also be exploited with malicious intent -- i.e. an attacker could construct/modify a `yarn.lock` manually to exploit this vuln, not only as a result of that incident in 2018.

I do not think that these deps are something that is likely to be catched by PR review unless one knows what to look for (examples above show that it was not noticed), so anything in line with "users should have reviewed `yarn.lock` files for this not to happen" does not work as a solution here. The problem is that users probably won't catch that packages being resolved to `http://` could mean that the yarn lock is "compromised". A lot of such existing `yarn.lock` files that no one noticed (even with scoped packages) indicate that.

Some historic examples in facebook repos: [docusaurus](https://github.com/facebook/docusaurus/blob/v1.4.0/yarn.lock#L7) (same file [here](https://github.com/facebook/docusaurus/blob/v1.6.0/v1/yarn.lock#L7)), [jest](https://github.com/facebook/jest/blob/v23.4.0/yarn.lock#L101). Moreover, [yarnpkg/yarn](https://github.com/yarnpkg/yarn) lockfile itself has a `http://`-resolved dep: <https://github.com/yarnpkg/yarn/blob/v1.17.3/yarn.lock#L5646>. It's not scoped, but that difference might also be subtle while reviewing a PR. There are more of those in git history.

## What should I do?

* Update yarn to v1.17.3 or later in all your environments.
* Go to [Settings -> Tokens](https://www.npmjs.com/settings/~/tokens) on [npmjs.com](https://www.npmjs.com/) and delete all listed tokens. Relogin where you need.
* Make sure that your `yarn.lock` files do not have entries resolved to `http://` registries.
* Enable 2FA on npm for logins and publishes, if you haven't done so already.

As a side note: periodically rotating your npm tokens (i.e. revoking them and doing a re-login) is a good idea in general.
Also, don't forget to keep track of your tokens through the [Settings -> Tokens](https://www.npmjs.com/settings/~/tokens) page.

## How to check if a certain repo was affected?

Use the following command, for example:

```
git log --pretty=format:"%h" -- yarn.lock | xargs -n1 -I{} git show {} -- yarn.lock | grep 'http:.*/@'
```

Example output that indicates that `http://registry.npmjs.org/@types/node` has been used in `jest` at some point:

```
jest chalker$ git log --pretty=format:"%h" -- yarn.lock | xargs -n1 -I{} git show {} -- yarn.lock | grep 'http:.*/@'
-  resolved "http://registry.npmjs.org/@types/node/-/node-9.4.7.tgz#57d81cd98719df2c9de118f2d5f3b1120dcd7275"
   resolved "http://registry.npmjs.org/@types/node/-/node-9.4.7.tgz#57d81cd98719df2c9de118f2d5f3b1120dcd7275"
   resolved "http://registry.npmjs.org/@types/node/-/node-9.4.7.tgz#57d81cd98719df2c9de118f2d5f3b1120dcd7275"
+  resolved "http://registry.npmjs.org/@types/node/-/node-9.4.7.tgz#57d81cd98719df2c9de118f2d5f3b1120dcd7275"
```

## Steps to reproduce

It is not wise to do that with your active token, and you probably won't need this section, but here it is for anyone
who is interested:

1. Perform an npm login or just write `//registry.npmjs.org/:_authToken=38bb8d1f-a39b-47d1-a78e-3bf0626ff77e` (which is the format npm uses) to ~/.npmrc. Doing this from your own account would leak your npm credentials on next steps, so better just use a placeholder.
2. Create an empty package with a single dependency on `"@babel/core": "^7.5.4"`
3. Perform `yarn install`
4. Replace all occurrences of `https://registry.yarnpkg.com` with `http://registry.npmjs.org/` in the generated `yarn.lock`

   Alternatively to steps 2-4 -- just use an already existing yarn.lock with `resolved "http://registry.npmjs.org/@` in it (lots of those on GitHub), but be careful with that.
5. Clear yarn cache and node\_modules: `rm -rf ~/.cache/yarn/ node_modules`. Let's assume you just downloaded an affected `yarn.lock` on your clean machine.
6. Start wireshark with `tcp dst port 80` filter.
7. Run `yarn install`

Observed result is attached on a screenshot below:
[![](/ChALkeR/notes/raw/master/media/yarn.http.png)](/ChALkeR/notes/blob/master/media/yarn.http.png)

## Suggestions

Apart from the applied fix in yarn v1.17.3, I would ideally like to see the following changes:

* Disallowing `http://` for all repositories by default -- looks like planned for yarn v2.
* Yarn fixing `yarn.lock` files automatically to replace `http://` links to npm registry with `https://` links.
* Automatic revocation of all tokens that were transfered to npm registry via unencrypted connection on npm registry side.

## Footnote

Don't forget to enable 2FA on npm (and everywhere else). Do it now. For both logins and publishes.

---

Published: 2019-07-13 10:30 UTC.

If you have any questions to me, contact me over Gitter ([@ChALkeR](https://gitter.im/ChALkeR)).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from yarnpkg.com_76d599ae_20250121_004730.html ===


Important: This documentation covers Yarn 1 (Classic).

For Yarn 2+ docs and migration guide, see yarnpkg.com.

[Yarn](/)

* [Getting Started](/docs/getting-started)
* [Docs](/docs)
* [Packages](/packages)
* [Blog](/blog)

* [Discord

  Discord](https://discord.gg/yarnpkg)
* [Twitter

  Twitter](https://twitter.com/yarnpkg)
* [Facebook

  Facebook](https://www.facebook.com/yarnpkg)
* [GitHub

  GitHub](https://github.com/yarnpkg)

# Recommended security update

Posted Jul 12, 2019 by
[Maël Nison](https://twitter.com/arcanis)

We’ve been made aware of a potential attack vector in the way some data are stored in the lockfile. We recommend to [upgrade](https://yarnpkg.com/en/docs/install) Yarn to the latest 1.17.3 release as soon as you get the chance. We also recommend you to edit your lockfiles to replace any reference to the `http:` protocol:

```
$ sed -i '' 's/http:/https:/g' yarn.lock

```
## What happened?

The Yarn registry is just a DNS alias to the npm registry. For a few months in 2018, the npm registry [returned http urls instead of the regular https ones](https://npm.community/t/some-packages-have-dist-tarball-as-http-and-not-https/285/40). Although the problem seems to have been corrected earlier this year, the lockfile entries generated during this period may still reference http urls and cause Yarn to send unencrypted authentication data over the network.

## What’s the mitigation?

Starting from the 1.17.3, regardless of what the registries return, we’ll enforce https on the three most common hostnames: `*.yarnpkg.com`, `*.npmjs.org`, and `*.npmjs.com`. Additionally, starting from the v2, we’ll rethink our default policies to make using http [require an explicit acknowledgement](https://github.com/yarnpkg/berry/issues/293) of some form.

–

Thanks to [@skovorodan](https://twitter.com/skovorodan) (operating on behalf of [Exodus](https://www.exodus.io/)) for the heads-up.

---

Yarn
[Distributed under BSD License](https://github.com/yarnpkg/yarn/blob/master/LICENSE)
[Code of Conduct](/org/code-of-conduct)

[Edit this page](https://github.com/yarnpkg/website/edit/master/_posts/2019-07-12-recommended-security-update.md)


