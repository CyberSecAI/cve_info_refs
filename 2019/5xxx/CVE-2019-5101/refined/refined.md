- **Root cause of vulnerability:** The `ustream-ssl` library in OpenWrt does not properly handle SSL certificate verification when using OpenSSL or mbed TLS. Specifically, the library proceeds with the connection and data transfer even if the server's certificate is invalid.
- **Weaknesses/vulnerabilities present:** Improper Certificate Validation (CWE-295). The `ustream-ssl` library checks the SSL certificate but does not enforce its validity before proceeding with the connection. The `ustream_ssl_verify_cert` function returns early without setting `us->valid_cert` to true if the certificate is invalid, but the connection is still considered valid, allowing data transfer.
- **Impact of exploitation:** An attacker can perform a man-in-the-middle (MitM) attack, providing any certificate to the client. This allows the attacker to intercept and steal all data sent by the client during the initial request, effectively compromising the client's communication.
- **Attack vectors:** Man-in-the-middle attack. An attacker needs to intercept the network traffic between the client (OpenWrt device) and the server.
- **Required attacker capabilities/position:** The attacker must be positioned to intercept network traffic between the vulnerable OpenWrt device and the server it is connecting to. They need to be able to act as a man-in-the-middle and present a forged or invalid SSL certificate to the client.

**Additional details:**

*   The vulnerability affects OpenWrt versions 18.06.4 and 15.05.1, when using the `libustream-openssl` or `libustream-mbedtls` packages.
*   The `wget` command uses `uclient-fetch` on OpenWrt 18.06.4 and `busybox` on OpenWrt 15.05.1, both relying on `ustream-ssl` for SSL support.
*   The vulnerability occurs because, after the SSL handshake, the `ustream-ssl` library does not properly check if the certificate is valid before marking the connection as established, allowing data to be sent over the insecure connection.
*   The report also mentions that the code will terminate shortly after the initial data transfer because the underlying `SSL_read` function will error out, but the initial request data will have already been sent and potentially compromised.
*   The vulnerability is present in both `libustream-openssl` and `libustream-mbedtls` packages.