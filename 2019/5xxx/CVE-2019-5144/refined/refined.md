```text
### Talos Vulnerability Report
**TALOS-2019-0933**

#### Kakadu Software SDK ATK marker code execution vulnerability

##### CVE Number
CVE-2019-5144

### Summary
A heap underflow vulnerability exists in the `derive_taps_and_gains` function in `kdu_v7ar.dll` of Kakadu Software SDK 7.10.2. A specially crafted jp2 file can cause a heap overflow, which can result in remote code execution. An attacker could provide a malformed file to the victim to trigger this vulnerability.

### Tested Versions
Kakadu Software SDK 7.10.2 - Windows

### CVSSv3 Score
8.1 - CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H

### CWE
CWE-191: Integer Underflow (Wrap or Wraparound)

### Details
The vulnerability lies within the `derive_taps_and_gains` function. A malformed `jp2` file can trigger a heap overflow, potentially leading to remote code execution.

The root cause is traced to how the `number_of_object` variable is handled within the `derive_taps_and_gains` function. This variable, initialized to 1, determines the size of a buffer allocated by `enlarge_work_buffers`. Due to an integer overflow during a signed comparison involving `step_info_n`, a value read from the ATK marker segment (0xff79) of the JP2 file, the `number_of_object` is not updated as expected. Consequently, the allocated buffer remains at a fixed size (16 bytes).

When the value of `step_info_n` exceeds 16, a heap overflow occurs. The `step_info_n` is controllable via the ATK marker segment in the JP2 file. The ATK marker includes a `Satk` value, which acts as a bitwise indicator for filter category and reversible/irreversible criteria. The presence of specific bits in `Satk` determines if an extra field (`Latk`) is included before the `step_info_n` value in the byte stream.

**Impact:**
Successful exploitation leads to a heap overflow, which could result in remote code execution.

**Attack vector:**
The vulnerability is triggered by processing a specially crafted `jp2` file containing a malformed ATK marker segment.

**Required attacker capabilities:**
An attacker needs to be able to deliver a malicious `jp2` file to a victim application using the Kakadu Software SDK to render the image.
```