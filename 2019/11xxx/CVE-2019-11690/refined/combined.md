=== Content from patchwork.ozlabs.org_0a89e698_20250121_001057.html ===

Toggle navigation

[Patchwork](/)
U-Boot

* [Patches](/project/uboot/list/)
* [Bundles](/project/uboot/bundles/)
* [About this project](/project/uboot/)

* [Login](/user/login/)
* [Register](/register/)
* [Mail settings](/mail/)

1092945

[diff](/project/uboot/patch/20190430025347.3097-5-erosca%40de.adit-jv.com/raw/ "Download patch diff")
[mbox](/project/uboot/patch/20190430025347.3097-5-erosca%40de.adit-jv.com/mbox/ "Download patch mbox")
[series](/series/105294/mbox/ "Download patch mbox with dependencies")
# [U-Boot,4/4] lib: uuid: Improve randomness of uuid values on RANDOM\_UUID=y

| Message ID | 20190430025347.3097-5-erosca@de.adit-jv.com |
| --- | --- |
| State | Superseded |
| Delegated to: | Heinrich Schuchardt |
| Headers | show ``` Return-Path: <u-boot-bounces@lists.denx.de> X-Original-To: incoming@patchwork.ozlabs.org Delivered-To: patchwork-incoming@bilbo.ozlabs.org Authentication-Results: ozlabs.org; 	spf=none (mailfrom) smtp.mailfrom=lists.denx.de 	(client-ip=81.169.180.215; helo=lists.denx.de; 	envelope-from=u-boot-bounces@lists.denx.de; 	receiver=<UNKNOWN>) Authentication-Results: ozlabs.org; dmarc=none (p=none dis=none) 	header.from=de.adit-jv.com Received: from lists.denx.de (dione.denx.de [81.169.180.215]) 	by ozlabs.org (Postfix) with ESMTP id 44tR5425wgz9s9N 	for <incoming@patchwork.ozlabs.org>; 	Tue, 30 Apr 2019 12:56:56 +1000 (AEST) Received: by lists.denx.de (Postfix, from userid 105) 	id 0D1ECC21E13; Tue, 30 Apr 2019 02:55:52 +0000 (UTC) X-Spam-Checker-Version: SpamAssassin 3.4.0 (2014-02-07) on lists.denx.de X-Spam-Level:  X-Spam-Status: No, score=0.0 required=5.0 tests=none autolearn=unavailable 	autolearn_force=no version=3.4.0 Received: from lists.denx.de (localhost [IPv6:::1]) 	by lists.denx.de (Postfix) with ESMTP id C6B77C21DFB; 	Tue, 30 Apr 2019 02:55:49 +0000 (UTC) Received: by lists.denx.de (Postfix, from userid 105) 	id 8E8ADC21DFA; Tue, 30 Apr 2019 02:55:25 +0000 (UTC) Received: from smtp1.de.adit-jv.com (smtp1.de.adit-jv.com [93.241.18.167]) 	by lists.denx.de (Postfix) with ESMTPS id A4EF5C21DA1 	for <u-boot@lists.denx.de>; Tue, 30 Apr 2019 02:55:24 +0000 (UTC) Received: from localhost (smtp1.de.adit-jv.com [127.0.0.1]) 	by smtp1.de.adit-jv.com (Postfix) with ESMTP id 838C73C013A; 	Tue, 30 Apr 2019 04:55:24 +0200 (CEST) Received: from smtp1.de.adit-jv.com ([127.0.0.1]) 	by localhost (smtp1.de.adit-jv.com [127.0.0.1]) (amavisd-new, 	port 10024) 	with ESMTP id ek0voy46TSnZ; Tue, 30 Apr 2019 04:55:17 +0200 (CEST) Received: from HI2EXCH01.adit-jv.com (hi2exch01.adit-jv.com [10.72.92.24]) 	(using TLSv1.2 with cipher ECDHE-RSA-AES256-SHA384 (256/256 bits)) 	(No client certificate requested) 	by smtp1.de.adit-jv.com (Postfix) with ESMTPS id D04A33C00DD; 	Tue, 30 Apr 2019 04:55:17 +0200 (CEST) Received: from vmlxhi-102.adit-jv.com (10.72.93.184) by HI2EXCH01.adit-jv.com 	(10.72.92.24) with Microsoft SMTP Server (TLS) id 14.3.439.0; 	Tue, 30 Apr 2019 04:55:17 +0200 From: Eugeniu Rosca <erosca@de.adit-jv.com> To: Lukasz Majewski <lukma@denx.de>, Heinrich Schuchardt <xypron.glpk@gmx.de>, 	Simon Glass <sjg@chromium.org>, Marek Vasut <marek.vasut@gmail.com>,  	Stephen Warren <swarren@nvidia.com>, Roman Stratiienko 	<roman.stratiienko@globallogic.com>, <u-boot@lists.denx.de> Date: Tue, 30 Apr 2019 04:53:47 +0200 Message-ID: <20190430025347.3097-5-erosca@de.adit-jv.com> X-Mailer: git-send-email 2.21.0 In-Reply-To: <20190430025347.3097-1-erosca@de.adit-jv.com> References: <20190430025347.3097-1-erosca@de.adit-jv.com> MIME-Version: 1.0 X-Originating-IP: [10.72.93.184] Cc: Eugeniu Rosca <erosca@de.adit-jv.com>, 	Eugeniu Rosca <roscaeugeniu@gmail.com> Subject: [U-Boot] [PATCH 4/4] lib: uuid: Improve randomness of uuid values 	on RANDOM_UUID=y X-BeenThere: u-boot@lists.denx.de X-Mailman-Version: 2.1.18 Precedence: list List-Id: U-Boot discussion <u-boot.lists.denx.de> List-Unsubscribe: <https://lists.denx.de/options/u-boot>, 	<mailto:u-boot-request@lists.denx.de?subject=unsubscribe> List-Archive: <http://lists.denx.de/pipermail/u-boot/> List-Post: <mailto:u-boot@lists.denx.de> List-Help: <mailto:u-boot-request@lists.denx.de?subject=help> List-Subscribe: <https://lists.denx.de/listinfo/u-boot>, 	<mailto:u-boot-request@lists.denx.de?subject=subscribe> Content-Type: text/plain; charset="utf-8" Content-Transfer-Encoding: base64 Errors-To: u-boot-bounces@lists.denx.de Sender: "U-Boot" <u-boot-bounces@lists.denx.de> ``` |
| Series | [Misc EFI/GPT/UUID fixes](/project/uboot/list/?series=105294) | expand  * [[U-Boot,0/4] Misc EFI/GPT/UUID fixes](/project/uboot/cover/20190430025347.3097-1-erosca%40de.adit-jv.com/) * [[U-Boot,1/4] disk: efi: Fix memory leak on 'gpt guid'](/project/uboot/patch/20190430025347.3097-2-erosca%40de.adit-jv.com/) * [[U-Boot,2/4] disk: efi: Fix memory leak on 'gpt verify'](/project/uboot/patch/20190430025347.3097-3-erosca%40de.adit-jv.com/) * [[U-Boot,3/4] cmd: gpt: fix and tidy up help message](/project/uboot/patch/20190430025347.3097-4-erosca%40de.adit-jv.com/) * [U-Boot,4/4] lib: uuid: Improve randomness of uuid values on RANDOM\_UUID=y |

## Commit Message

[Eugeniu Rosca](/project/uboot/list/?submitter=71744)
April 30, 2019, 2:53 a.m. UTC
```

The random uuid values (enabled via CONFIG_RANDOM_UUID=y) on our
platform are always the same. Below is consistent on each cold boot:

 => ### interrupt autoboot
 => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
 ...
 uuid_gpt_misc=d117f98e-6f2c-d04b-a5b2-331a19f91cb2
 => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
 ...
 uuid_gpt_misc=ad5ec4b6-2d9f-8544-9417-fe3bd1c9b1b3
 => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
 ...
 uuid_gpt_misc=cceb0b18-39cb-d547-9db7-03b405fa77d4
 => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
 ...
 uuid_gpt_misc=d4981a2b-0478-544e-9607-7fd3c651068d
 => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
 ...
 uuid_gpt_misc=6d6c9a36-e919-264d-a9ee-bd00379686c7

While the uuids do change on every 'gpt write' command, the values
appear to be taken from the same pool, in the same order.

As a user, I expect a trully random uuid value in the above example.
Otherwise, system/RFS designers and OS people might assume they have
a reliable/consistent uuid passed by the bootloader, while the truth
is U-Boot simply lacks entropy to generate a random string.

In its first attempt [1] to improve the uuid randomness, this patch
updated the seed based on the output of get_timer(), similar to [2].

There are two problems with this approach:
 - get_timer() has a poor _ms_ resolution
 - when gen_rand_uuid() is called in a loop, get_timer() returns the
   same result, leading to the same seed being passed to srand(),
   leading to the same uuid being generated for several partitions
   with different names

This second patch addresses both drawbacks.

My R-Car3 testing [3] consists of running 'gpt write mmc 1 $partitions'
in a loop for several minutes collecting 8844 randomly generated UUIDS.
Two consecutive cold boots are concatenated in the log. As a result,
all uuid values are unique (scripted check).

Thanks to Roman, who reported the issue and provided support in fixing.

[1] https://patchwork.ozlabs.org/patch/1091802/
[2] commit da384a9d7628 ("net: rename and refactor eth_rand_ethaddr() function")
[3] https://gist.github.com/erosca/2820be9d554f76b982edd48474d0e7ca
 => while true; do \
    env default -a; \
    gpt write mmc 1 $partitions; \
    print; done

Reported-by: Roman Stratiienko <roman.stratiienko@globallogic.com>
Signed-off-by: Eugeniu Rosca <erosca@de.adit-jv.com>
---
v2:
 - Replaced get_timer(0) with get_ticks() and added rand() to seed value
 - Performed extensive testing on R-Car3 (ARMv8)
v1:
 - https://patchwork.ozlabs.org/patch/1091802/
---
 lib/uuid.c | 2 ++
 1 file changed, 2 insertions(+)

```
## Comments

[Heinrich Schuchardt](/project/uboot/list/?submitter=61270)
April 30, 2019, 7:07 p.m. UTC | [#1](/comment/2163061/)
```

On 4/30/19 4:53 AM, Eugeniu Rosca wrote:
> The random uuid values (enabled via CONFIG_RANDOM_UUID=y) on our
> platform are always the same. Below is consistent on each cold boot:
>
>   => ### interrupt autoboot
>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>   ...
>   uuid_gpt_misc=d117f98e-6f2c-d04b-a5b2-331a19f91cb2
>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>   ...
>   uuid_gpt_misc=ad5ec4b6-2d9f-8544-9417-fe3bd1c9b1b3
>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>   ...
>   uuid_gpt_misc=cceb0b18-39cb-d547-9db7-03b405fa77d4
>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>   ...
>   uuid_gpt_misc=d4981a2b-0478-544e-9607-7fd3c651068d
>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>   ...
>   uuid_gpt_misc=6d6c9a36-e919-264d-a9ee-bd00379686c7
>
> While the uuids do change on every 'gpt write' command, the values
> appear to be taken from the same pool, in the same order.
>
> As a user, I expect a trully random uuid value in the above example.
> Otherwise, system/RFS designers and OS people might assume they have
> a reliable/consistent uuid passed by the bootloader, while the truth
> is U-Boot simply lacks entropy to generate a random string.
>
> In its first attempt [1] to improve the uuid randomness, this patch
> updated the seed based on the output of get_timer(), similar to [2].
>
> There are two problems with this approach:
>   - get_timer() has a poor _ms_ resolution
>   - when gen_rand_uuid() is called in a loop, get_timer() returns the
>     same result, leading to the same seed being passed to srand(),
>     leading to the same uuid being generated for several partitions
>     with different names
>
> This second patch addresses both drawbacks.
>
> My R-Car3 testing [3] consists of running 'gpt write mmc 1 $partitions'
> in a loop for several minutes collecting 8844 randomly generated UUIDS.
> Two consecutive cold boots are concatenated in the log. As a result,
> all uuid values are unique (scripted check).
>
> Thanks to Roman, who reported the issue and provided support in fixing.
>
> [1] https://patchwork.ozlabs.org/patch/1091802/
> [2] commit da384a9d7628 ("net: rename and refactor eth_rand_ethaddr() function")
> [3] https://gist.github.com/erosca/2820be9d554f76b982edd48474d0e7ca
>   => while true; do \
>      env default -a; \
>      gpt write mmc 1 $partitions; \
>      print; done
>
> Reported-by: Roman Stratiienko <roman.stratiienko@globallogic.com>
> Signed-off-by: Eugeniu Rosca <erosca@de.adit-jv.com>

This patch may ameliorate the situation for GUIDs a bit. But I dislike:

- This patch is a uuid only solution to introduce time ticks as source
   of entropy.
- With timer ticks you possibly introduce very little entropy.
- Our random number generator with only 32 state bits remains
   sub-standard.

This is the current situation:

net/bootp.c uses the MAC address to seed the random number generator and
uses random numbers for defining waits.

lib/uuid.c is using it for UUID generation.

In the UEFI sub-system I would like to implement the EFI_RNG_PROTOCOL.
Linux uses it for randomizing memory layout. iPXE needs it for secure
network connections. This requires a good random number generator with
sufficient entropy.

We already have implemented a single hardware random number generator in
drivers/crypto/ace_sha.c (CONFIG_EXYNOS_ACE_SHA).

Many other CPUs come with a hardware random number generator. In Linux's
drivers/char/hw_random/ I found, e.g.

- meson-rng.c (Amlogic)
- mtk-rng.c (MediaTek)
- st-rng.c (STMicroelectronics)
- imx-rng.c (Freescale)

I think we should have a u-class for hardware RNGs as one source of entropy.

I would like a random number generator with a high number of state bits
(> 127) that we initialize with hardware RNG bits and other sources of
entropy. A nice discussion of how Linux does it can be found in [1].

Best regards

Heinrich

[1]
https://www.bsi.bund.de/SharedDocs/Downloads/EN/BSI/Publications/Studies/LinuxRNG/LinuxRNG_EN.pdf

> ---
> v2:
>   - Replaced get_timer(0) with get_ticks() and added rand() to seed value
>   - Performed extensive testing on R-Car3 (ARMv8)
> v1:
>   - https://patchwork.ozlabs.org/patch/1091802/
> ---
>   lib/uuid.c | 2 ++
>   1 file changed, 2 insertions(+)
>
> diff --git a/lib/uuid.c b/lib/uuid.c
> index fa20ee39fc32..2d4d6ef7e461 100644
> --- a/lib/uuid.c
> +++ b/lib/uuid.c
> @@ -238,6 +238,8 @@ void gen_rand_uuid(unsigned char *uuid_bin)
>   	unsigned int *ptr = (unsigned int *)&uuid;
>   	int i;
>
> +	srand(get_ticks() + rand());
> +
>   	/* Set all fields randomly */
>   	for (i = 0; i < sizeof(struct uuid) / sizeof(*ptr); i++)
>   		*(ptr + i) = cpu_to_be32(rand());
>

```

[Eugeniu Rosca](/project/uboot/list/?submitter=73898)
May 1, 2019, 7:08 p.m. UTC | [#2](/comment/2163692/)
```

Hi Heinrich,

Thank you for reviewing this series.

On Tue, Apr 30, 2019 at 09:07:09PM +0200, Heinrich Schuchardt wrote:
[..]
> This patch may ameliorate the situation for GUIDs a bit. But I dislike:

In general, we can find reasons to dislike anything, since there is room
for improvement in virtually anything.
>
> - This patch is a uuid only solution to introduce time ticks as source
>   of entropy.

I would like to clarify once again what this patch is about. It _fixes_
(hence I will rewrite the summary line in the next patch revision) a
concrete real-life problem of providing repeatable (not predictable -
which implies some effort in my mind - but literally repeatable) uuid
values on enabling CONFIG_RANDOM_UUID.

It is my understanding that CONFIG_RANDOM_UUID (based on its name
and help message) does promise random uuids to the user. If so, then
U-Boot simply breaks this promise.

While doing additional research on PRNG, it looks to me that there is
an established class of PRNG-specific problems, commonly known as
"unseeded randomness" for which I am also able to find below CVE/CWE:
 - https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2015-0285
   ("CVE-2015-0285 openssl: handshake with unseeded PRNG")
 - https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2015-9019
   ("CVE-2015-9019 libxslt: math.random() in xslt uses unseeded randomness")
 - https://cwe.mitre.org/data/definitions/336.html
   ("CWE-336: Same Seed in Pseudo-Random Number Generator (PRNG)")

The above tells me that using the same seed yields the same sequence
of random numbers. That's precisely the topic of this patch: simply
switching from unseeded PRNG to seeded PRNG.

And yes, this patch is deliberately limited to UUID naming function,
since it is lib/uuid's responsibility to seed the PRNG. The same is
true for other callers of rand() and rand_r(). All of them seed the
PRNG prior to getting a random value from it.
> - With timer ticks you possibly introduce very little entropy.

Theoretically, yes. Practically, the improvement to the current state
of affairs is huge and this has been testified by the test results
linked in the description.

Again, this patch is not about improving the random pattern of the UUID
values (sorry for the misleading title). It is really about _enabling_
any kind of randomness in those values at all.
> - Our random number generator with only 32 state bits remains
>   sub-standard.

I believe this is orthogonal to my patch and can be improved
independently. In addition, whatever is the bit-width of U-Boot PRNG
(I can find shootouts between various 64/128/256-bit PRNG) its essence
will not change. It will remain a deterministic number generator,
whose randomness will still be dictated by the seed.
>
> This is the current situation:
>
> net/bootp.c uses the MAC address to seed the random number generator and
> uses random numbers for defining waits.
>
> lib/uuid.c is using it for UUID generation.

I can see that rfc4122 suggests including MAC address in the UUID, but
it also warns that MAC address could be unavailable:

 -----------
   For systems with no IEEE address, a randomly or pseudo-randomly
   generated value may be used;
 -----------

The guess is right. Some SoCs like R-Car3 (in contrast to e.g. i.MX6)
don't provide any OTP memory/register containing their unique MAC
address. Needless to say some machines would never connect to IEEE
network. So, it looks to me that MAC address cannot be taken as
consistent source of entropy for UUID in U-Boot.
>
> In the UEFI sub-system I would like to implement the EFI_RNG_PROTOCOL.
> Linux uses it for randomizing memory layout. iPXE needs it for secure
> network connections. This requires a good random number generator with
> sufficient entropy.
>
> We already have implemented a single hardware random number generator in
> drivers/crypto/ace_sha.c (CONFIG_EXYNOS_ACE_SHA).
>
> Many other CPUs come with a hardware random number generator. In Linux's
> drivers/char/hw_random/ I found, e.g.
>
> - meson-rng.c (Amlogic)
> - mtk-rng.c (MediaTek)
> - st-rng.c (STMicroelectronics)
> - imx-rng.c (Freescale)

To the best of my knowledge, there is no HW RNG on R-Car3, so our only
option is currently U-Boot PRNG.
>
> I think we should have a u-class for hardware RNGs as one source of entropy.
>
> I would like a random number generator with a high number of state bits
> (> 127) that we initialize with hardware RNG bits and other sources of
> entropy. A nice discussion of how Linux does it can be found in [1].

All sound like future topics to me, orthogonal to this patch.
Let me know if I misunderstood anything. TIA!
>
> Best regards
>
> Heinrich
>
> [1]
> https://www.bsi.bund.de/SharedDocs/Downloads/EN/BSI/Publications/Studies/LinuxRNG/LinuxRNG_EN.pdf
>

--
Best Regards,
Eugeniu.

```

[Tom Rini](/project/uboot/list/?submitter=65875)
May 1, 2019, 7:51 p.m. UTC | [#3](/comment/2163723/)
```

On Wed, May 01, 2019 at 09:08:31PM +0200, Eugeniu Rosca wrote:
> Hi Heinrich,
>
> Thank you for reviewing this series.
>
> On Tue, Apr 30, 2019 at 09:07:09PM +0200, Heinrich Schuchardt wrote:
> [..]
> > This patch may ameliorate the situation for GUIDs a bit. But I dislike:
>
> In general, we can find reasons to dislike anything, since there is room
> for improvement in virtually anything.
>
> >
> > - This patch is a uuid only solution to introduce time ticks as source
> >   of entropy.
>
> I would like to clarify once again what this patch is about. It _fixes_
> (hence I will rewrite the summary line in the next patch revision) a
> concrete real-life problem of providing repeatable (not predictable -
> which implies some effort in my mind - but literally repeatable) uuid
> values on enabling CONFIG_RANDOM_UUID.
>
> It is my understanding that CONFIG_RANDOM_UUID (based on its name
> and help message) does promise random uuids to the user. If so, then
> U-Boot simply breaks this promise.
>
> While doing additional research on PRNG, it looks to me that there is
> an established class of PRNG-specific problems, commonly known as
> "unseeded randomness" for which I am also able to find below CVE/CWE:
>  - https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2015-0285
>    ("CVE-2015-0285 openssl: handshake with unseeded PRNG")
>  - https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2015-9019
>    ("CVE-2015-9019 libxslt: math.random() in xslt uses unseeded randomness")
>  - https://cwe.mitre.org/data/definitions/336.html
>    ("CWE-336: Same Seed in Pseudo-Random Number Generator (PRNG)")
>
> The above tells me that using the same seed yields the same sequence
> of random numbers. That's precisely the topic of this patch: simply
> switching from unseeded PRNG to seeded PRNG.
>
> And yes, this patch is deliberately limited to UUID naming function,
> since it is lib/uuid's responsibility to seed the PRNG. The same is
> true for other callers of rand() and rand_r(). All of them seed the
> PRNG prior to getting a random value from it.
>
> > - With timer ticks you possibly introduce very little entropy.
>
> Theoretically, yes. Practically, the improvement to the current state
> of affairs is huge and this has been testified by the test results
> linked in the description.
>
> Again, this patch is not about improving the random pattern of the UUID
> values (sorry for the misleading title). It is really about _enabling_
> any kind of randomness in those values at all.
>
> > - Our random number generator with only 32 state bits remains
> >   sub-standard.
>
> I believe this is orthogonal to my patch and can be improved
> independently. In addition, whatever is the bit-width of U-Boot PRNG
> (I can find shootouts between various 64/128/256-bit PRNG) its essence
> will not change. It will remain a deterministic number generator,
> whose randomness will still be dictated by the seed.
>
> >
> > This is the current situation:
> >
> > net/bootp.c uses the MAC address to seed the random number generator and
> > uses random numbers for defining waits.
> >
> > lib/uuid.c is using it for UUID generation.
>
> I can see that rfc4122 suggests including MAC address in the UUID, but
> it also warns that MAC address could be unavailable:
>
>  -----------
>    For systems with no IEEE address, a randomly or pseudo-randomly
>    generated value may be used;
>  -----------
>
> The guess is right. Some SoCs like R-Car3 (in contrast to e.g. i.MX6)
> don't provide any OTP memory/register containing their unique MAC
> address. Needless to say some machines would never connect to IEEE
> network. So, it looks to me that MAC address cannot be taken as
> consistent source of entropy for UUID in U-Boot.

Indeed, we have a lot of platforms where the MAC is not a great source.
> > In the UEFI sub-system I would like to implement the EFI_RNG_PROTOCOL.
> > Linux uses it for randomizing memory layout. iPXE needs it for secure
> > network connections. This requires a good random number generator with
> > sufficient entropy.
> >
> > We already have implemented a single hardware random number generator in
> > drivers/crypto/ace_sha.c (CONFIG_EXYNOS_ACE_SHA).
> >
> > Many other CPUs come with a hardware random number generator. In Linux's
> > drivers/char/hw_random/ I found, e.g.
> >
> > - meson-rng.c (Amlogic)
> > - mtk-rng.c (MediaTek)
> > - st-rng.c (STMicroelectronics)
> > - imx-rng.c (Freescale)
>
> To the best of my knowledge, there is no HW RNG on R-Car3, so our only
> option is currently U-Boot PRNG.

And we have a lot of systems without HW RNG.
> > I think we should have a u-class for hardware RNGs as one source of entropy.
> >
> > I would like a random number generator with a high number of state bits
> > (> 127) that we initialize with hardware RNG bits and other sources of
> > entropy. A nice discussion of how Linux does it can be found in [1].
>
> All sound like future topics to me, orthogonal to this patch.
> Let me know if I misunderstood anything. TIA!

Agreed, this patch sounds like it addresses a number of problems today
that are real problems (I await someone filing a CVE now for our PRNG
problem) and can be iteratively improved on, once merged rather than
having a fundamental problem that needs to be addressed.

```

[Eugeniu Rosca](/project/uboot/list/?submitter=73898)
May 1, 2019, 10:32 p.m. UTC | [#4](/comment/2163802/)
```

Hi Tom,

On Wed, May 01, 2019 at 03:51:49PM -0400, Tom Rini wrote:
[..]
>
> Agreed, this patch sounds like it addresses a number of problems today
> that are real problems (I await someone filing a CVE now for our PRNG
> problem)

A new CVE has been submitted via https://cveform.mitre.org/.
Will keep this thread posted with any updates from the CVE Team.
> and can be iteratively improved on, once merged rather than
> having a fundamental problem that needs to be addressed.
>
> --
> Tom

--
Best regards,
Eugeniu.

```

[Eugeniu Rosca](/project/uboot/list/?submitter=71744)
May 3, 2019, 4:09 p.m. UTC | [#5](/comment/2165138/)
```

On Thu, May 02, 2019 at 12:32:53AM +0200, Eugeniu Rosca wrote:
> Hi Tom,
>
> On Wed, May 01, 2019 at 03:51:49PM -0400, Tom Rini wrote:
> [..]
> >
> > Agreed, this patch sounds like it addresses a number of problems today
> > that are real problems (I await someone filing a CVE now for our PRNG
> > problem)
>
> A new CVE has been submitted via https://cveform.mitre.org/.
> Will keep this thread posted with any updates from the CVE Team.

The CVE has been published as:
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11690
https://nvd.nist.gov/vuln/detail/CVE-2019-11690

It looks like it is still WIP.
>
> > and can be iteratively improved on, once merged rather than
> > having a fundamental problem that needs to be addressed.
> >
> > --
> > Tom
>
> --
> Best regards,
> Eugeniu.

```

[Eugeniu Rosca](/project/uboot/list/?submitter=71744)
May 7, 2019, 12:25 p.m. UTC | [#6](/comment/2167356/)
```

On Fri, May 03, 2019 at 06:09:28PM +0200, Eugeniu Rosca wrote:
> On Thu, May 02, 2019 at 12:32:53AM +0200, Eugeniu Rosca wrote:
> > Hi Tom,
> >
> > On Wed, May 01, 2019 at 03:51:49PM -0400, Tom Rini wrote:
> > [..]
> > >
> > > Agreed, this patch sounds like it addresses a number of problems today
> > > that are real problems (I await someone filing a CVE now for our PRNG
> > > problem)
> >
> > A new CVE has been submitted via https://cveform.mitre.org/.
> > Will keep this thread posted with any updates from the CVE Team.
>
> The CVE has been published as:
> https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11690
> https://nvd.nist.gov/vuln/detail/CVE-2019-11690
>
> It looks like it is still WIP.

jFTR, https://nvd.nist.gov/vuln/detail/CVE-2019-11690 has been populated
with some "Severity and Metrics".
>
> >
> > > and can be iteratively improved on, once merged rather than
> > > having a fundamental problem that needs to be addressed.
> > >
> > > --
> > > Tom
> >
> > --
> > Best regards,
> > Eugeniu.

```

[Matthias Brugger](/project/uboot/list/?submitter=68056)
May 16, 2019, 3:13 p.m. UTC | [#7](/comment/2172926/)
```

On 30/04/2019 21:07, Heinrich Schuchardt wrote:
> On 4/30/19 4:53 AM, Eugeniu Rosca wrote:
>> The random uuid values (enabled via CONFIG_RANDOM_UUID=y) on our
>> platform are always the same. Below is consistent on each cold boot:
>>
>>   => ### interrupt autoboot
>>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>>   ...
>>   uuid_gpt_misc=d117f98e-6f2c-d04b-a5b2-331a19f91cb2
>>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>>   ...
>>   uuid_gpt_misc=ad5ec4b6-2d9f-8544-9417-fe3bd1c9b1b3
>>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>>   ...
>>   uuid_gpt_misc=cceb0b18-39cb-d547-9db7-03b405fa77d4
>>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>>   ...
>>   uuid_gpt_misc=d4981a2b-0478-544e-9607-7fd3c651068d
>>   => env default -a; gpt write mmc 1 $partitions; print uuid_gpt_misc
>>   ...
>>   uuid_gpt_misc=6d6c9a36-e919-264d-a9ee-bd00379686c7
>>
>> While the uuids do change on every 'gpt write' command, the values
>> appear to be taken from the same pool, in the same order.
>>
>> As a user, I expect a trully random uuid value in the above example.
>> Otherwise, system/RFS designers and OS people might assume they have
>> a reliable/consistent uuid passed by the bootloader, while the truth
>> is U-Boot simply lacks entropy to generate a random string.
>>
>> In its first attempt [1] to improve the uuid randomness, this patch
>> updated the seed based on the output of get_timer(), similar to [2].
>>
>> There are two problems with this approach:
>>   - get_timer() has a poor _ms_ resolution
>>   - when gen_rand_uuid() is called in a loop, get_timer() returns the
>>     same result, leading to the same seed being passed to srand(),
>>     leading to the same uuid being generated for several partitions
>>     with different names
>>
>> This second patch addresses both drawbacks.
>>
>> My R-Car3 testing [3] consists of running 'gpt write mmc 1 $partitions'
>> in a loop for several minutes collecting 8844 randomly generated UUIDS.
>> Two consecutive cold boots are concatenated in the log. As a result,
>> all uuid values are unique (scripted check).
>>
>> Thanks to Roman, who reported the issue and provided support in fixing.
>>
>> [1] https://patchwork.ozlabs.org/patch/1091802/
>> [2] commit da384a9d7628 ("net: rename and refactor eth_rand_ethaddr() function")
>> [3] https://gist.github.com/erosca/2820be9d554f76b982edd48474d0e7ca
>>   => while true; do \
>>      env default -a; \
>>      gpt write mmc 1 $partitions; \
>>      print; done
>>
>> Reported-by: Roman Stratiienko <roman.stratiienko@globallogic.com>
>> Signed-off-by: Eugeniu Rosca <erosca@de.adit-jv.com>
>
> This patch may ameliorate the situation for GUIDs a bit. But I dislike:
>
> - This patch is a uuid only solution to introduce time ticks as source
>   of entropy.
> - With timer ticks you possibly introduce very little entropy.
> - Our random number generator with only 32 state bits remains
>   sub-standard.
>
> This is the current situation:
>
> net/bootp.c uses the MAC address to seed the random number generator and
> uses random numbers for defining waits.
>
> lib/uuid.c is using it for UUID generation.
>
> In the UEFI sub-system I would like to implement the EFI_RNG_PROTOCOL.
> Linux uses it for randomizing memory layout. iPXE needs it for secure
> network connections. This requires a good random number generator with
> sufficient entropy.
>
> We already have implemented a single hardware random number generator in
> drivers/crypto/ace_sha.c (CONFIG_EXYNOS_ACE_SHA).
>
> Many other CPUs come with a hardware random number generator. In Linux's
> drivers/char/hw_random/ I found, e.g.
>
> - meson-rng.c (Amlogic)
> - mtk-rng.c (MediaTek)
> - st-rng.c (STMicroelectronics)
> - imx-rng.c (Freescale)
>
> I think we should have a u-class for hardware RNGs as one source of entropy.
>

Anyone working on this already? If not I can have a look. It could be used for
RPi3 as well (drivers/char/hw_random/bcm2835-rng.c in the Linux kernel). :)

Regards,
Matthias
> I would like a random number generator with a high number of state bits
> (> 127) that we initialize with hardware RNG bits and other sources of
> entropy. A nice discussion of how Linux does it can be found in [1].
>
> Best regards
>
> Heinrich
>
> [1]
> https://www.bsi.bund.de/SharedDocs/Downloads/EN/BSI/Publications/Studies/LinuxRNG/LinuxRNG_EN.pdf
>
>
>
>> ---
>> v2:
>>   - Replaced get_timer(0) with get_ticks() and added rand() to seed value
>>   - Performed extensive testing on R-Car3 (ARMv8)
>> v1:
>>   - https://patchwork.ozlabs.org/patch/1091802/
>> ---
>>   lib/uuid.c | 2 ++
>>   1 file changed, 2 insertions(+)
>>
>> diff --git a/lib/uuid.c b/lib/uuid.c
>> index fa20ee39fc32..2d4d6ef7e461 100644
>> --- a/lib/uuid.c
>> +++ b/lib/uuid.c
>> @@ -238,6 +238,8 @@ void gen_rand_uuid(unsigned char *uuid_bin)
>>       unsigned int *ptr = (unsigned int *)&uuid;
>>       int i;
>>
>> +    srand(get_ticks() + rand());
>> +
>>       /* Set all fields randomly */
>>       for (i = 0; i < sizeof(struct uuid) / sizeof(*ptr); i++)
>>           *(ptr + i) = cpu_to_be32(rand());
>>
>
> _______________________________________________
> U-Boot mailing list
> U-Boot@lists.denx.de
> https://lists.denx.de/listinfo/u-boot

```

[Eugeniu Rosca](/project/uboot/list/?submitter=73898)
May 16, 2019, 3:54 p.m. UTC | [#8](/comment/2172950/)
```

On Thu, May 16, 2019 at 5:14 PM Matthias Brugger <mbrugger@suse.com> wrote:
> On 30/04/2019 21:07, Heinrich Schuchardt wrote:
> >
> > I think we should have a u-class for hardware RNGs as one source of entropy.
>
> Anyone working on this already?

Not me.
> If not I can have a look.

green_light_on(); // :)
> It could be used for
> RPi3 as well (drivers/char/hw_random/bcm2835-rng.c in the Linux kernel). :)
>
> Regards,
> Matthias

```

1092945

[diff](/project/uboot/patch/20190430025347.3097-5-erosca%40de.adit-jv.com/raw/ "Download patch diff")
[mbox](/project/uboot/patch/20190430025347.3097-5-erosca%40de.adit-jv.com/mbox/ "Download patch mbox")
[series](/series/105294/mbox/ "Download patch mbox with dependencies")
## Patch

```

diff --git a/lib/uuid.c b/lib/uuid.c
index fa20ee39fc32..2d4d6ef7e461 100644
--- a/lib/uuid.c
+++ b/lib/uuid.c
@@ -238,6 +238,8 @@  void gen_rand_uuid(unsigned char *uuid_bin)
 	unsigned int *ptr = (unsigned int *)&uuid;
 	int i;

+	srand(get_ticks() + rand());
+
 	/* Set all fields randomly */
 	for (i = 0; i < sizeof(struct uuid) / sizeof(*ptr); i++)
 		*(ptr + i) = cpu_to_be32(rand());

```

[patchwork](http://jk.ozlabs.org/projects/patchwork/)
patch tracking system | version 2.2.0. | [about patchwork](/about/)



=== Content from cveform.mitre.org_c3616b63_20250121_021829.html ===


[![CVE logo](Content/cveLogoR.svg)](https://cve.org/)

[CVE Records
![CVE Record search](Content/search_icon.png)](https://cve.mitre.org/cve/search_cve_list.html)

[Search CVE Records](https://cve.mitre.org/cve/search_cve_list.html)

## Submit a CVE Request

\* Required

![errors](Content/exclamation.jpg)

\* Select a request type

- Please choose an action -
Report Vulnerability/Request CVE ID
Notify CVE about a publication
Request an update to an existing CVE Entry
Request information on the CVE Numbering Authority (CNA) Program
Other

![errors](Content/exclamation.jpg)

\* Enter your e-mail address

![alert](Content/info.jpg)

IMPORTANT: Please add cve-request@mitre.org and cve@mitre.org as
safe senders in your email client before completing this form.

Enter a PGP Key (to encrypt)

Processing....

#### Legal

* [Terms of Use](https://cve.org/Legal/TermsOfUse)
* [Privacy Policy](https://cve.org/Legal/PrivacyPolicy)

#### Media

* [News](https://cve.org/Media/News)
* [Events](https://cve.org/Media/Events)
* [Sign up for e-newsletter](https://cve.mitre.org/news/newsletter.html)

##### Social Media

[github

![](Content/github.png)](https://github.com/CVEProject)
[linkedin

![](Content/linkedin.png)](https://www.linkedin.com/showcase/cve-cwe-capec)
[youtube

![](Content/youtube.png)](https://www.youtube.com/channel/UCUHd2XFDsKH8kjMZQaSKpDQ/)
[twitter for CVE New

![](Content/twitter.png)
New CVE Records](https://twitter.com/CVEnew/)
[twitter for CVE announce

![](Content/twitter.png)
 CVE Announce](https://twitter.com/CVEannounce/)

#### Contact

* [CVE Program Support](https://cveform.mitre.org)
* [CNA](https://cve.org/PartnerInformation/ListofPartners)
* [CVE Website Support](https://cveform.mitre.org)

Use of the CVE® List and the associated references from this website are subject to the
[terms of use](https://cve.org/Legal/TermsOfUse). CVE is sponsored by the
[U.S. Department of Homeland Security (DHS)](https://www.dhs.gov/)
 [Cybersecurity and Infrastructure Security Agency (CISA)](https://www.dhs.gov/cisa/cybersecurity-division/). Copyright © 1999-2023,
[The MITRE Corporation](https://www.mitre.org/). CVE and the CVE logo are registered trademarks of The MITRE Corporation.

×
#### Vulnerability Information

Vulnerability Type

CWE-ID

Definition

Buffer Overflow

[CWE-119](http://cwe.mitre.org/data/definitions/119.html)

The software performs operations on a memory buffer, but it can read from or write to a memory location that is outside of the intended boundary of the buffer.

Cross Site Scripting (XSS)

[CWE-79](http://cwe.mitre.org/data/definitions/79.html)

The software does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.

SQL Injection

[CWE-89](http://cwe.mitre.org/data/definitions/89.html)

The software constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component.

Directory Traversal

[CWE-22](http://cwe.mitre.org/data/definitions/22.html)

The software uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the software does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.

XML External Entity (XXE)

[CWE-611](http://cwe.mitre.org/data/definitions/611.html)

The software processes an XML document that can contain XML entities with URIs that resolve to documents outside of the intended sphere of control, causing the product to embed incorrect documents into its output.

Insecure Permissions

[CWE-276](http://cwe.mitre.org/data/definitions/276.html)

The software, upon installation, sets incorrect permissions for an object that exposes it to an unintended actor.

Incorrect Access Control

[CWE-284](http://cwe.mitre.org/data/definitions/284.html)

The software does not restrict or incorrectly restricts access to a resource from an unauthorized actor.

Integer Overflow

[CWE-190](http://cwe.mitre.org/data/definitions/190.html)

The software performs a calculation that can produce an integer overflow or wraparound, when the logic assumes that the resulting value will always be larger than the original value. This can introduce other weaknesses when the calculation is used for resource management or execution control.

Cross Site Request Forgery (CSRF)

[CWE-352](http://cwe.mitre.org/data/definitions/352.html)

The web application does not, or can not, sufficiently verify whether a well-formed, valid, consistent request was intentionally provided by the user who submitted the request.

Missing SSL certification verification

[CWE-599](http://cwe.mitre.org/data/definitions/599.html)

The software uses OpenSSL and trusts or uses a certificate without using the SSL\_get\_verify\_result() function to ensure that the certificate satisfies all necessary security requirements.

Other or Unknown

N/A

The software contains a mistake other than above which can be directly used by a hacker to gain access to a system or network.

×
#### Other Vulnerability Information

You can find more information at [cwe.mitre.org](http://cwe.mitre.org)

* Algorithm complexity
* Array index error
* Auth bypass using cookie
* Buffer Overflow
* Cross-Site Request Forgery (CSRF)
* Cross-Site Scripting (XSS)
* Directory Traversal
* Double free
* Eval injection
* File Upload
* Format String
* HTTP Response Splitting

* HTTP Request Splitting
* Incomplete blacklist
* Integer Overflow
* Integer Signedness
* Memory Leak
* Shell Metacharacter Injectoin
* Open Redirect
* Redirect without Exit
* Path Disclosure
* Insecure Permissions
* PHP remote file inclusion
* Session Fixation

* SQL Injection
* Symbolic Link Following
* Untrusted Search Path
* Unquoted Windows search path
* Use after free
* Default user/password
* Large or infinite loop
* Exposed insecure/unsafe method in ActiveX control
* Generation of insufficiently random numbers
* XML Extneral Entity (XXE)
* Incorrect Access Control
* Missing SSL certificate validation

×
#### Vulnerability Information

Attack Type

Definition

Remote

The vulnerability can be exploited through a network. The attacker may be either on the adjacent or remote network.

Local

To exploit the vulnerability, the attacker needs to be logged into the operating system on a local machine or a guest operating system.

Physical

The attacker needs to be located near the victim or have physical access to the vulnerable system to exploit the vulnerability. Examples include touching a workstation keyboard or USB device, "shoulder surfing" to see a workstation's display, and touching the screen of a mobile device.

Context-dependent

The type of access needed to exploit the vulnerability is dependent on how the vulnerable product is used. This is most often used for libraries.

×
#### Vulnerability Information

Update Type

Definition

Duplicate

More than one CVE ID has been assigned to a single vulnerability.

Rejection

Vendor rejects the assignment of a particular CVE ID.

Split/Merge

A single CVE Entry should be split into two or more CVE Entries OR Two or more existing CVE Entries should be merged into a single CVE Entry.

Update Description

Update the description in an existing CVE Entry.

Update References

Add, remove, or change a reference for an existing CVE Entry.

Other

Any request related to an existing CVE Entry that does not fall within one of the other categories.


