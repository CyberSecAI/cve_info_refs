Based on the provided content, here's an analysis of CVE-2019-11503:

**Root cause of vulnerability:**

The vulnerability stems from how `snap-confine` handles the current working directory (CWD) when setting up namespace-based containers for snap packages. Specifically, `snap-confine` would remember the CWD of the calling user outside the container and attempt to restore it inside the container. This restoration was done with root privileges.

**Weaknesses/vulnerabilities present:**

- **Privileged chdir():** The `chdir()` operation to restore the CWD was performed with root privileges, making it vulnerable to symlink attacks. An attacker could manipulate the CWD to point to a location they don't have permissions to access directly, and `snap-confine` would follow the symlink due to its root privileges.

**Impact of exploitation:**

- **Arbitrary directory access:** By exploiting this vulnerability, an unprivileged user could enter arbitrary directories within the container, potentially accessing sensitive files. Examples include private directories of other users or system directories like /root or /var/lib/snapd/hostfs/root/.config.

**Attack vectors:**

- **Symlink manipulation:** An attacker would create a symlink in a publicly accessible directory (e.g., /tmp) that points to the desired private location.
- **`snap run` command:** The attacker would then use `snap run --shell` command to enter the snap container, triggering `snap-confine` to restore the manipulated CWD.

**Required attacker capabilities/position:**

- **Local access:** The attacker needs local access to the system to create symlinks and run snap commands.
- **Unprivileged user:** The attack can be performed by an unprivileged user on a multi-user system.
- **Knowledge of snap usage:** The attacker needs to know how to use the `snap run` command and the implications of the vulnerability within a snap container environment.
- **Ability to create symlinks:** The attacker must be able to create symlinks within a shared location such as `/tmp`.

**Mitigation:**

The vulnerability was mitigated by changing how `snap-confine` restores the CWD. The fix involves:

1.  **Centralized CWD handling**: The code for handling the CWD was moved to a central location.
2.  **Late execution:** The CWD restoration is now done after the original user and group IDs have been restored (i.e., no longer as a privileged user).
3.  **Inode check:** The code now checks if the original working directory can be represented in the execution environment and if it points to the same inode. If the inode is different, a file system permission check is performed by the kernel. If the original working directory cannot be represented, the process is moved to `/var/lib/snapd/void`.
4.  **Void directory permissions**: Changed permissions of the void directory to 111 to allow `snap-confine` to access it.
5. **O_PATH flag**: Uses the `O_PATH` flag when opening the current working directory to avoid needing permissions on the target directory, only execute permissions on directories in the path prefix.
6. **Create void on demand:** If the void directory does not exist, it is created by `snap-confine` on demand.
7. **Move to void on errors**: if there are permission errors while opening the original working directory, the process is moved to the void directory

This new method prevents the symlink attack by ensuring that the CWD restoration is not done with root privileges, and that proper checks are made to see if the CWD can be properly represented in the container environment. The process is moved to the void directory when permission issues occur.

**Additional Notes:**

- The provided content also includes discussion about issues with the `/tmp` directory ownership (CVE-2019-11502), and parsing of `/proc/self/mountinfo` which are not directly related to CVE-2019-11503.
- The fix was implemented in the snapd codebase, as seen through multiple commits and code review comments in the Github pull request.
- The fix was also included in the `snapd-glib` package for Fedora, as noted in the Fedora update notifications.