=== Content from www.wordfence.com_2380c03d_20250120_232337.html ===


![](https://www.wordfence.com/wp-content/uploads/2019/05/wccm-featured.png)

[![](https://secure.gravatar.com/avatar/d46b866dba15e07748d03fe68187c62c?s=80&d=mm&r=g)Wordfence Author](https://www.wordfence.com/blog/author/wfauthor/)

May 2, 2019

# Unauthenticated Media Deletion Vulnerability Patched In WooCommerce Checkout Manager Plugin

Earlier this week, a security update was released for the WooCommerce Checkout Manager plugin for WordPress. This update fixes two distinct vulnerabilities: an arbitrary file upload flaw present in certain configurations, and a flaw allowing attackers to delete media files from affected sites. The pluginâ€™s users are advised to install the latest available version (4.3 at the time of this writing) as soon as possible to prevent exploitation of the flaws patched in this update.

The file upload vulnerability was initially made public in a report by an unnamed security researcher, which was irresponsibly published on April 23rd without privately notifying the pluginâ€™s author. In the process of verifying the report, our team identified an additional media deletion flaw which needed to be patched. We reached out to the pluginâ€™s developer the same day to begin the disclosure process, and have deployed a firewall rule to protect our users from these exploits.

In this post weâ€™ll be sharing details regarding both of these flaws, with particular focus on the media deletion flaw which has yet to be reported.

## Conditional Arbitrary File Upload

The initially disclosed flaw in [WooCommerce Checkout Manager](https://wordpress.org/plugins/woocommerce-checkout-manager/)Â allowed unauthenticated users to upload arbitrary files to affected sites in certain configurations. Specifically, the pluginâ€™s â€œCategorize Uploaded Filesâ€ option needed to be active for this flaw to be exploitable.

With the plugin active, a siteâ€™s customers have the ability to upload files associated with their orders during the checkout process. Without the â€œCategorize Uploaded Filesâ€ option enabled, the plugin made use of WordPressâ€™s built-in media upload handler, which is generally effective at keeping out malicious scripts. However, when the option is enabled, it directly uploads the file without any security checks, allowing dangerous files to be uploaded.

Wordfence firewall users, both premium and free, are protected from malicious script uploads.

## Unauthenticated Media Deletion Flaw

While testing reports of the file upload flaw above, our team discovered a flaw which would allow attackers to delete media files from the affected site.

Alongside the file upload feature, the plugin is able to delete the attachments users have uploaded at checkout. In unpatched versions, this deletion feature allowed unauthenticated users to delete any media file, not just those associated with a userâ€™s checkout uploads.

```
function update_attachment_wccm_callback() {

	global $post, $wpdb, $woocommerce;

	$array1 = explode( ',', sanitize_text_field( isset( $_POST['wccm_default_keys_load'] ) ? $_POST['wccm_default_keys_load'] : '' ) );
	$array2 = explode( ',', sanitize_text_field( isset( $_POST['product_image_gallery'] ) ? $_POST['product_image_gallery'] : '' ) );
	$attachment_ids = array_diff( $array1, $array2 );

	if( isset( $_POST['wccm_default_keys_load'] ) ) {
		if( !empty( $attachment_ids ) ) {
			foreach( $attachment_ids as $key => $values ) {
				wp_delete_attachment( $attachment_ids[$key] );
			}
		}
		echo __('Deleted successfully.','woocommerce-checkout-manager');
	}
	die();

}
add_action( 'wp_ajax_update_attachment_wccm', 'update_attachment_wccm_callback' );
add_action( 'wp_ajax_nopriv_update_attachment_wccm', 'update_attachment_wccm_callback' );
```

The above function,Â `update_attachment_wccm_callback`, is hooked into theÂ `update_attachment_wccm` AJAX action. The function is only intended for Administrator and Shop Manager users, but was available to unauthenticated users due to its additionalÂ `nopriv_`Â registration and a lack of capabilities checks. In the function, two POST body parameters are converted to arrays and then compared. Any media attachments with IDs present inÂ `$_POST['wccm_default_keys_load']`Â but not inÂ `$_POST['product_image_gallery']`Â are deleted via the built-inÂ `wp_delete_attachment`Â function. This not only deletes the associated file, but removes its metadata from the WordPress media library.

An attacker with motivation to take down a siteâ€™s images and other media could do so by identifying a set of media IDs, or simply iterating over a wide range of values, and assigning them toÂ `wccm_default_keys_load`Â as a comma-delimited string. Because the ternary operation on line 2176 returns an empty string by default, we donâ€™t need to set aÂ `product_image_gallery` parameter for comparison unless we wanted to exclude specific IDs for some reason.

For example, to delete any media files with IDs from 1 to 10, youâ€™d send a POST request toÂ `http://example[.]com/wp-admin/admin-ajax.php?action=update_attachment_wccm` with the POST bodyÂ `wccm_default_keys_load=1,2,3,4,5,6,7,8,9,10`.

## Next Steps

The pluginâ€™s author, Visser Labs, has patched these issues in version 4.3 of WooCommerce Checkout Manager. It is advised that all sites making use of the plugin update as soon as possible. For sites which havenâ€™t patched, a new Wordfence firewall rule has been deployed to prevent abuse of the media deletion flaw. Premium users have immediate access to this new rule, and free users will gain access in thirty days. Both free and premium users already benefit from built-in rules which offer protection from the file upload vulnerability as well.

At this time, we have not identified significant exploitation of either of these vulnerabilities. We will continue to monitor for related activity and issue further reports if necessary.

*Thanks to Ram Gall from the Defiant QA team for the discovery of the media deletion vulnerability.*

Search

### Trust Your Site to the Leader in WordPress Security

Wordfence includes an endpoint firewall, malware scanner, robust login security features, live traffic views, and more. Discover why over 5 million WordPress sites put their trust in Wordfence.

[Protect Your Site](/products/pricing/)

**Did you enjoy this post? Share it!**

[*Facebook*](http://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2019%2F05%2Funauthenticated-media-deletion-vulnerability-patched-in-woocommerce-checkout-manager-plugin%2F)
[*Twitter*](https://twitter.com/share?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2019%2F05%2Funauthenticated-media-deletion-vulnerability-patched-in-woocommerce-checkout-manager-plugin%2F&text=Unauthenticated%20Media%20Deletion%20Vulnerability%20Patched%20In%20WooCommerce%20Checkout%20Manager%20Plugin&via=wordfence)
[*LinkedIn*](https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwww.wordfence.com%2Fblog%2F2019%2F05%2Funauthenticated-media-deletion-vulnerability-patched-in-woocommerce-checkout-manager-plugin%2F)

## Comments

2 Comments

* ![](https://secure.gravatar.com/avatar/290ded97dc1ac8b52472b5ae34c880f9?s=96&d=mm&r=g)
  chandrasekaran rajamani
  May 2, 2019
   10:06 pm

  Good job.Thanks for your timely intervention
* ![](https://secure.gravatar.com/avatar/4ed134601552de65b1516370529a96cc?s=96&d=mm&r=g)
  hsalo
  May 6, 2019
   11:13 am

  MITRE assigned CVE-2019-11807 for this vulnerability.

### Breaking WordPress Security Research in your inbox as it happens.

![Example of a news story](/img/footer-news-example.jpg)

This site uses cookies in accordance with our [Privacy Policy](/privacy-policy).

Cookie Settings
Accept All

## Cookie Options

For additional information on how this site uses cookies, please review our [Privacy Policy](/privacy-policy). The cookies used by this site are classified into the following categories and can be configured below.

### Strictly Necessary

These Cookies are necessary for the Sites and Services to work properly. They include any essential authentication and authorization cookies for the Services.

\* Cookies of this category are necessary for the site to function and cannot be disabled.

### Performance/Analytical

These Cookies allow us to collect certain information about how you navigate the Sites or utilize the Services running on your device. They help us understand which areas you use and what we can do to improve them.

### Targeting

These Cookies are used to deliver relevant information related to the Services to an identified machine or other device (not a named or otherwise identifiable person) which has previously been used to visit our Sites. Some of these types of Cookies on our Sites are operated by third parties with our permission and are used to identify advertising sources that are effectively driving customers to our Sites.

Cancel
Save



=== Content from secure.gravatar.com_d30e8021_20250121_012937.html ===
ï¿½ï¿½ï¿½ï¿½ JFIF  ` `  ï¿½ï¿½ ;CREATOR: gd-jpeg v1.0 (using IJG JPEG v62), quality = 90
ï¿½ï¿½ C 



ï¿½ï¿½ C  

ï¿½ï¿½  ` `" ï¿½ï¿½           
ï¿½ï¿½ ï¿½   } !1AQa"q2ï¿½ï¿½ï¿½#Bï¿½ï¿½Rï¿½ï¿½$3brï¿½
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½        
ï¿½ï¿½ ï¿½  w !1AQaq"2ï¿½Bï¿½ï¿½ï¿½ï¿½ #3Rï¿½brï¿½
$4ï¿½%ï¿½&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½   ? ï¿½ï¿½ï¿½j;Q@ï¿½Pï¿½Qï¿½QE ï¿½{Qï¿½ï¿½ï¿½ï¿½Çµï¿½/ï¿½Iï¿½ï¿½Çµ{Qï¿½ï¿½ï¿½4 ï¿½ï¿½ï¿½ï¿½ (ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½zï¿½g]ï¿½vï¿½I(=ï¿½ 
ï¿½?ï¿½ ï¿½ï¿½ofï¿½ï¿½Ïˆï¿½OkKugtï¿½ï¿½ï¿½ï¿½Ä¿ï¿½?ï¿½rT ï¿½Rï¿½ï¿½PEï¿½ ï¿½ï¿½?mV/O0<ï¿½
ï¿½ï¿½  ?Î¼zï¿½kï¿½ï¿½ï¿½ï¿½ï¿½ï¿½dï¿½2ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Aï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½J?ï¿½J ï¿½-Ú¬ï¿½IHï¿½ï¿½ï¿½H>ï¿½Gï¿½?\*ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½[Z<ï¿½ï¿½İï¿½Tï¿½ï¿½Wï¿½Pï¿½ï¿½Rï¿½@ Eï¿½ï¿½ï¿½<'ï¿½)<3ï¿½Evï¿½ï¿½Gï¿½0~ï¿½ï¿½ï¿½qï¿½ï¿½ï¿½ï¿½Ğ¼;}ï¿½;ï¿½"ï¿½ï¿½}ï¿½ï¿½Aï¿½M }ï¿½j6ï¿½ï¿½ï¿½wVï¿½ï¿½ï¿½H2ï¿½ï¿½}
Xï¿½ =kï¿½ï¿½oï¿½ï¿½Uï¿½ï¿½ï¿½<ï¿½>tSï¿½/ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½/ï¿½ï¿½ï¿½ï¿½I.neX`ï¿½eï¿½ï¿½Xï¿½\_ï¿½^
ï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½IÜï¿½ï¿½ï¿½Wï¿½Ş€<ï¿½ï¿½ï¿½$ï¿½ï¿½ï¿½Ä—Dï¿½Fï¿½c?Â£ï¿½ï¿½ï¿½ï¿½Jï¿½ï¿½|;}ï¿½Ë¯"ï¿½ï¿½ï¿½ï¿½ï¿½qï¿½
fï¿½EP(ï¿½ï¿½M kï¿½[ï¿½w'ï¿½ï¿½ï¿½1ï¿½K.8Eï¿½ A^ï¿½ï¿½hï¿½ï¿½ï¿½vï¿½qï¿½OÍï¿½=ï¿½exÃ‹ï¿½ï¿½
(ï¿½@ï¿½ï¿½ '=ï¿½z/ï¿½8ï¿½ï¿½ï¿½ =h ï¿½ =(ï¿½ï¿½ =i?ï¿½Z (ï¿½ =(ï¿½ =iï¿½Z ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½^D$ï¿½ï¿½5=ï¿½=ï¿½xWï¿½<7?ï¿½5Gï¿½ï¿½ï¿½ï¿½ï¿½Kï¿½ï¿½ï¿½Wï¿½?ï¿½sï¿½9ï¿½ï¿½ï¿½ï¿½Cï¿½4Pnï¿½H|ï¿½ï¿½ï¿½ï¿½?\* ï¿½z(#ï¿½ Nï¿½ï¿½ï¿½Jï¿½ï¿½ï¿½ï¿½uï¿½mï¿½8ï¿½^ï¿½ï¿½\ï¿½Cï¿½7lTï¿½n1ï¿½q\*ï¿½ï¿½ï¿½ï¿½ï¿½@ï¿½E% ï¿½Rï¿½ï¿½Pï¿½IGï¿½ï¿½@E%ï¿½ï¿½<Ò†ï¿½ï¿½Ø‘vï¿½#yï¿½=ï¿½ï¿½ï¿½ï¿½W?^ï¿½ï¿½ï¿½&ï¿½ï¿½ï¿½cï¿½!d'ï¿½ÓŸï¿½ï¿½ï¿½ï¿½?ï¿½ï¿½
