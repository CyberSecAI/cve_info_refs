## Analysis of CVE-2019-11189

Based on the provided document, here's a breakdown of the vulnerability related to CVE-2019-11189:

**1. Verification of CVE Relevance:**

The document explicitly mentions CVE-2019-11189 as a vulnerability discovered by their tool EVENTSCOPE:

> Additionally, we were able to leverage ONOS’s host mobility app to remove the access control app’s existing ﬂow rules (CVE-2019-11189).

Therefore, the content is directly related to the specified CVE.

**2. Root Cause of Vulnerability:**

The root cause is the lack of proper event handling in the access control app (`acl`) within the ONOS SDN controller. Specifically, the `acl` app does not handle the `HOST_MOVED` event type. This allows other applications, like the `mobility` app, to inadvertently cause `acl` to lose track of network policy. The `acl` app is responsible for enforcing access control, but it doesn't react when hosts change locations, leading to a bypass of the intended policy.

**3. Weaknesses/Vulnerabilities Present:**

-   **Missing Event Handling:** The `acl` app subscribes to `HostEvent` events, but fails to implement a handler for the `HOST_MOVED` event type.
-   **Conflicting App Behaviors:** The `mobility` app is designed to clean up flow rules when a host moves. It correctly removes rules related to a moved host but does not consider that other apps might rely on these rules for security.
-   **Lack of Coordinated Policy Enforcement:**  The apps are not aware of each other's intended functionality and do not maintain consistency across policy changes.

**4. Impact of Exploitation:**

-   **Bypassing Access Control Policies:** An attacker can exploit this vulnerability to bypass the access control policies set by `acl`. By spoofing a host’s location, an attacker can cause the `mobility` app to remove the `acl`’s deny flow rules.
-   **Unauthorized Network Access:** After removing the deny rules, an attacker can then communicate with the target host without the intended access control restrictions. This allows lateral movement within the network.
-   **Compromise of Security Segmentation:** If hosts are segmented for regulatory or compliance reasons, the attacker is able to bypass such protections.

**5. Attack Vectors:**

-   **Data Plane Packet Injection:** The vulnerability is triggered by manipulating data plane packets.  Specifically, the attacker uses ARP reply packets to spoof the location of a legitimate host.
-   **Host Spoofing:** The attacker spoofs the identity of a legitimate host, making it appear as if the host has moved to a new network location.

**6. Required Attacker Capabilities/Position:**

-   **Control of at Least One Host:** The attacker needs to control at least one host on the network (e.g., `h1`). This gives them the ability to inject malicious ARP reply packets.
-   **Knowledge of Network Topology:** The attacker needs knowledge of the network topology to spoof the location of a legitimate host using the ARP reply packets.

**Technical Details from the Text:**

-   **Exploit Steps:** The exploit consists of two stages:
    1.  The attacker spoofs the location of the host by sending ARP reply packets, leading the `mobility` app to remove the `acl`'s flow rules.
    2.  The attacker, now with the access rules removed, sends traffic to the target.
-   **Event Flow:** The document provides a partial event flow graph that illustrates the code path involved in the attack. The `HOST_MOVED` event, when triggered, leads to the `mobility` app removing flow rules and `acl` being unaware of such removal.
-   **Contextual Apps:** The `acl` app is vulnerable due to an unhandled `HOST_MOVED` event. The `mobility` app provides the context necessary to exploit the vulnerability. The `fwd` app is in the absent context which means it might be used after the exploit to allow the unauthorized access.

In summary, the vulnerability arises from the fact that the `acl` app doesn't react to host location changes and is not consistent with the network changes being done by the `mobility` app. The attacker takes advantage of this gap to gain unauthorized network access. This vulnerability highlights the need for comprehensive event handling and better coordination between different applications in SDN environments.