=== Content from blog.mirch.io_cc9c50f0_20250121_023059.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability — December 18, 2019](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability")

## [CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)

[December 18, 2019August 6, 2020](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "7:25 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

Signal Desktop v1.29 on Windows is vulnerable to an elevation of privilege vulnerability. During the startup the application will execute the c:\node\_modules\.bin\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. A low privileged user can create a malicious wmic.exe which will be executed every time Signal Desktop starts by any user of the system. The malicious binary is executed in the background without the users knowledge. This is an example of horizontal [privilege escalation](https://en.wikipedia.org/wiki/Privilege_escalation).

The vulnerability has been patched in v1.29.1 in commit [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688) which was released 12/17/2019. Kudos to the Signal security team for fixing in less than two weeks! Unfortunately, at this time the they do not feel this warrants an advisory or CVE so the vulnerability was silently fixed. **12/24/2019 Update:** Mitre assigned CVE-2019-19954

## Steps To Reproduce

In a cmd window

```
mkdir c:\node_modules\.bin
copy c:\windows\system32\calc.exe c:\node_modules\.bin\wmic.exe

```

Now any user that opens Signal, the Windows calculator will be popped.

## PoC

![signal-lpe-3](https://blog.mirch.io/wp-content/uploads/2020/08/signal-lpe-3.png?w=712)

## Timeline

* 2019-12-05: Report sent to Signal security team
* 2019-12-11: Reached out to Signal to verify report was received
* 2019-12-16: Signal acknowledges report
* 2019-12-17: Signal v1.29.1 released
* 2019-12-18: Published this blog post
* 2019-12-24: MITRE assigned CVE-2019-19954

## References

* Commit: [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
* Vulnerable version: <https://updates.signal.org/desktop/signal-desktop-win-1.29.0.exe>

### Share this:

* [Twitter](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/?share=twitter "Click to share on Twitter")
* [Facebook](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

Categories: [Uncategorized](https://blog.mirch.io/category/uncategorized/)

## Post navigation

[CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/)[CVE-2020-3950 VMware Fusion Elevation of Privilege](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/)

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* Reblog
* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2019%252F12%252F18%252Fsignal-desktop-windows-lpe%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2019%252F12%252F18%252Fsignal-desktop-windows-lpe%252F)
  + [Copy shortlink](https://wp.me/paoR5j-5W)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)
  + [View post in Reader](https://wordpress.com/read/blogs/153687293/posts/368)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from blog.mirch.io_4edb92c7_20250121_023101.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability — December 18, 2019](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability")

## [CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)

[December 18, 2019August 6, 2020](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "7:25 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

Signal Desktop v1.29 on Windows is vulnerable to an elevation of privilege vulnerability. During the startup the application will execute the c:\node\_modules\.bin\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. A low privileged user can create a malicious wmic.exe which will be executed every time Signal Desktop starts by any user of the system. The malicious binary is executed in the background without the users knowledge. This is an example of horizontal [privilege escalation](https://en.wikipedia.org/wiki/Privilege_escalation).

The vulnerability has been patched in v1.29.1 in commit [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688) which was released 12/17/2019. Kudos to the Signal security team for fixing in less than two weeks! Unfortunately, at this time the they do not feel this warrants an advisory or CVE so the vulnerability was silently fixed. **12/24/2019 Update:** Mitre assigned CVE-2019-19954

## Steps To Reproduce

In a cmd window

```
mkdir c:\node_modules\.bin
copy c:\windows\system32\calc.exe c:\node_modules\.bin\wmic.exe

```

Now any user that opens Signal, the Windows calculator will be popped.

## PoC

![signal-lpe-3](https://blog.mirch.io/wp-content/uploads/2020/08/signal-lpe-3.png?w=712)

## Timeline

* 2019-12-05: Report sent to Signal security team
* 2019-12-11: Reached out to Signal to verify report was received
* 2019-12-16: Signal acknowledges report
* 2019-12-17: Signal v1.29.1 released
* 2019-12-18: Published this blog post
* 2019-12-24: MITRE assigned CVE-2019-19954

## References

* Commit: [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
* Vulnerable version: <https://updates.signal.org/desktop/signal-desktop-win-1.29.0.exe>

### Share this:

* [Twitter](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/?share=twitter "Click to share on Twitter")
* [Facebook](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

Categories: [Uncategorized](https://blog.mirch.io/category/uncategorized/)

## Post navigation

[CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/)[CVE-2020-3950 VMware Fusion Elevation of Privilege](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/)

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* Reblog
* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2019%252F12%252F18%252Fsignal-desktop-windows-lpe%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2019%252F12%252F18%252Fsignal-desktop-windows-lpe%252F)
  + [Copy shortlink](https://wp.me/paoR5j-5W)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)
  + [View post in Reader](https://wordpress.com/read/blogs/153687293/posts/368)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from blog.mirch.io_876decba_20250121_023100.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[Exploiting Kaseya Unitrends Backup Appliance – Part 1 — May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "Exploiting Kaseya Unitrends Backup Appliance – Part 1")

## [Exploiting Kaseya Unitrends Backup Appliance – Part 1](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/)

[May 20, 2022May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "9:50 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

![](https://blog.mirch.io/wp-content/uploads/2022/05/unitrends-woot.png?w=889)

In 2021 I discovered several high and critical vulnerabilities in the [Kaseya Unitrends](https://www.unitrends.com/products/unitrends-backup-appliances) backup appliance. This research was conducted and published as part of my day job. Part one details a chain of vulnerabilities by leveraging an insecure [PostgreSQL](https://www.postgresql.org/) database to ultimately gain shell access to the remote server. Visit <https://www.cyberonesecurity.com/blog/exploiting-kaseya-unitrends-backup-appliance-part-1> for the the full write-up. Stay tuned for part two.

[sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability — January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=712)](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

## [sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability](https://blog.mirch.io/2021/01/25/sudoedit-lpe/)

[January 25, 2021January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "8:43 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I noticed the following changelog entry in sudo [1.9.5p1.](https://www.sudo.ws/stable.html#1.9.5p1) This caught my attention so I decided to look further. I was unable to find an advisory, PoC, or CVE for this vulnerability. Using the details from the changelog message and fix, I decided to write an exploit for it.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image.png?w=1024)

Using an Ubuntu 20.04.1 VM, I created a low privileged user named “lowpriv” and added a sudoedit rule for a root owned file /etc/test.txt. I also downloaded the [source](https://github.com/sudo-project/sudo/archive/SUDO_1_9_5.tar.gz) for sudo 1.9.5, compiled it, and installed it to /opt/sudo.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-3.png?w=1024)

Show sudoedit rule.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-1.png?w=1024)

Show the sudo version is 1.9.5.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-2.png?w=1024)

With the test environment ready I ran sudoedit /etc/test.txt. I executed !id as a quick test which executes the id command in a shell however privileges are dropped by bash when the UID != EUID. Back to the drawing board.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-5.png?w=1024)

I was able to successfully edit arbitrary files simply using the :e /etc/sudoers or :e /etc/shadow commands to escalate privileges, however that was too easy.

Looking for esoteric features that could potentially be leveraged, I discovered the libcall and libcallnr functions which allow you to execute a function from an external library. The one caveat is there can only be a single argument. There are a crazy amount of functions available to vim that I never realized. Check out <https://vim.help/41-write-a-vim-script#41.6> for the full listing.

I tried calling a variety of functions with varying degrees of success but found a simple method by calling [setuid()](https://man7.org/linux/man-pages/man2/setuid.2.html) directly.

`call libcallnr("libc.so.6","setuid",0)`

After running sudoedit, use the following vim/ex command to change the UID to zero. This will ensure that shelling out will retain privileges because now UID==EUID.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-8.png?w=1024)

Execute a bash shell with !bash.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-9.png?w=198)

Interactive root shell obtained. Woot!

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=1024)

I tested the same proof of concept with 1.9.5p1 and sudoedit properly drops privileges as expected.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-11.png?w=1024)

**Summary**

If you upgraded to sudo 1.9.5 to fix [CVE-2021-23240](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23240) or [CVE-2021-23239](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23239), a new privilege escalation vulnerability was introduced in sudoedit and you should upgrade to 1.9.5p1.

Once in a while I look at recently fixed vulnerabilities to see if I can bypass the fix. In this case, the sudo project knew about this vulnerably but to my knowledge no advisory or CVE was created. I think this is odd that the issue was not communicated since a valid privilege escalation was patched. It’s unclear if another researcher reported it or if maintainers discovered it during their own testing. I also could not find a proof of concept so I decided to write one as a fun exercise.

I hope you enjoyed the short write up. Hit me me up on Twitter [@0xm1rch](https://twitter.com/0xm1rch) if you have any questions or comments.

[Pi-hole Patches Critical Stored XSS Vulnerability — December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2020/12/piholexss.png?w=641)](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

## [Pi-hole Patches Critical Stored XSS Vulnerability](https://blog.mirch.io/2020/12/24/pihole-xss/)

[December 24, 2020December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "10:03 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Pi-hole v5.2.1 is vulnerable to a critical stored cross site scripting vulnerability. An attacker with the ability to directly or indirectly query DNS with a malicious hostname can cause arbitrary JavaScript to execute when the Pi-hole administrator accesses the Query Log or Long-term Query Log pages on the web portal.

The Pi-hole project released a fix on 12/24/2020 in v5.2.2. Shodan reports over 7,500 Pi-hole instances. This could be remotely exploited if these instances permit external DNS queries. Other possibilities may exist if a malformed DNS query is allowed.

No payloads are being published at this time to give users time to patch.

**References**

* <https://github.com/pi-hole/AdminLTE/pull/1665>

**Timeline**

* 12/16/2020 Vulnerability reported to vendor
* 12/18/2020 Vendor acknowledged receipt of report
* 12/22/2020 Discovered a second XSS payload that would fire on the Long-term Queries Page
* 12/23/2020 Mitre assigns CVE-2020-35659
* 12/24/2020 Vendor released fix in v5.2.2

[Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation — September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation")

## [Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/)

[September 25, 2020September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "3:52 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Today, a Metasploit module was merged for a vulnerability I found in 2018 with [VyOS](https://www.vyos.io/). This vulnerability was my first public InfoSec blog post. I appreciate [bcoles](https://github.com/bcoles) for developing the [exploit/linux/ssh/vyos\_restricted\_shell\_privesc](https://github.com/rapid7/metasploit-framework/pull/14123) module. Read the [Metasploit Wrapup for 9/25/2020](https://blog.rapid7.com/2020/09/25/metasploit-wrap-up-80/). The full write-up can can be found on this blog at [C](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)[VE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/).

[Critical Vulnerabilities Discovered in MoFi Routers — September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "Critical Vulnerabilities Discovered in MoFi Routers")

## [Critical Vulnerabilities Discovered in MoFi Routers](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/)

[September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "1:08 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I discovered several vulnerabilities in the MoFi4500 LTE router. Several vulnerabilities have not been patched, including an unauthenticated remote command injection and several undocumented backdoors. The full write-up can be viewed at <https://www.criticalstart.com/critical-vulnerabilities-discovered-in-mofi-routers/>.

Media Coverage

* <https://www.cyberscoop.com/mofi-networks-routers-zero-day-critical-start/>
* <https://www.zdnet.com/article/backdoors-left-unpatched-in-mofi-routers/>

Follow the conversation on Twitter

> The team is at it again! This time with 10 [#0days](https://twitter.com/hashtag/0days?src=hash&ref_src=twsrc%5Etfw) found by [@0xm1rch](https://twitter.com/0xm1rch?ref_src=twsrc%5Etfw) for routers from [@MoFiNetwork](https://twitter.com/MoFiNetwork?ref_src=twsrc%5Etfw). After coordinating with others to reduce impact there still appears to be over 6,860 vulnerable devices externally facing.[#Infosec](https://twitter.com/hashtag/Infosec?src=hash&ref_src=twsrc%5Etfw) [#redteam](https://twitter.com/hashtag/redteam?src=hash&ref_src=twsrc%5Etfw)<https://t.co/1A1UgRmJrq> [pic.twitter.com/YKPiF4LFMq](https://t.co/YKPiF4LFMq)
>
> — TeamARES (@TeamAresSec) [September 2, 2020](https://twitter.com/TeamAresSec/status/1301200248417775618?ref_src=twsrc%5Etfw)

[CVE-2020-3950 VMware Fusion Elevation of Privilege — March 17, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

[![](https://blog.mirch.io/wp-content/uploads/2020/03/vmware-fusion-cve-2020-3950-cropped.png?w=712)](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

## [CVE-2020-3950 VMware Fusion Elevation of Privilege](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/)

[March 17, 2020April 3, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "10:55 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

VMware Fusion 11.5.~~1~~2 and prior are vulnerable to an elevation of privilege vulnerability. For more details please review the advisory and proof of concept on my Github page [CVE-2020-3950.sh](https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2020-3950.sh). VMware released a the patch last week and a public advisory [VMSA-2020-0005](https://www.vmware.com/security/advisories/VMSA-2020-0005.html) today however it has been determined that the patch does not properly fix the vulnerability. I reached out to the VMware security team and received a response at 10:31 UTC 2020-03-18 – “We are aware of the situation and working on the next steps”.

I also learned today that [Jeff Ball](https://twitter.com/jeffball55) at [GRIMM](https://twitter.com/grimmcyber) also independently discovered and reported the vulnerability to VMware.  This is a first for me. Make sure to read their excellent detailed write-up <https://blog.grimm-co.com/post/analyzing-suid-binaries/>. You can also follow the thread on Twitter.

> PoC for CVE-2020-3950 VMware Fusion EoP. <https://t.co/F0jGnE9BZu> Vendor Advisory: <https://t.co/28f3aoAFsG> [pic.twitter.com/5WYG9xg5cv](https://t.co/5WYG9xg5cv)
>
> — Rich Mirch (@0xm1rch) [March 17, 2020](https://twitter.com/0xm1rch/status/1240030085450731521?ref_src=twsrc%5Etfw)

### **Related Articles**

* BleepingComputer [VMware Fixes High Severity Privilege Escalation Bug in Fusion](https://www.bleepingcomputer.com/news/security/vmware-fixes-high-severity-privilege-escalation-bug-in-fusion/)
* ZDNet [VMware patches privilege escalation vulnerability in Fusion, Horizon](https://www.zdnet.com/article/vmware-patches-privilege-escalation-vulnerability-in-workstation-fusion-horizon/)
* SecurityWeek [VMware Fixes Privilege Escalation Vulnerability in Fusion for Mac](https://www.securityweek.com/vmware-fixes-privilege-escalation-vulnerability-fusion-mac)
* SecurityWeek [Patch for Recently Disclosed VMware Fusion Vulnerability Incomplete](https://www.securityweek.com/recent-patch-vmware-fusion-vulnerability-incomplete)
* SecurityWeek [VMware Again Fails to Patch Privilege Escalation Vulnerability in Fusion](https://www.securityweek.com/vmware-again-fails-patch-privilege-escalation-vulnerability-fusion)
* Metasploit Module [Blown up by your own Fusion bomb](https://blog.rapid7.com/2020/04/03/metasploit-wrap-up-58/)

[CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability — December 18, 2019](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability")

## [CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)

[December 18, 2019August 6, 2020](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "7:25 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

Signal Desktop v1.29 on Windows is vulnerable to an elevation of privilege vulnerability. During the startup the application will execute the c:\node\_modules\.bin\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. A low privileged user can create a malicious wmic.exe which will be executed every time Signal Desktop starts by any user of the system. The malicious binary is executed in the background without the users knowledge. This is an example of horizontal [privilege escalation](https://en.wikipedia.org/wiki/Privilege_escalation).

The vulnerability has been patched in v1.29.1 in commit [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688) which was released 12/17/2019. Kudos to the Signal security team for fixing in less than two weeks! Unfortunately, at this time the they do not feel this warrants an advisory or CVE so the vulnerability was silently fixed. **12/24/2019 Update:** Mitre assigned CVE-2019-19954

## Steps To Reproduce

In a cmd window

```
mkdir c:\node_modules\.bin
copy c:\windows\system32\calc.exe c:\node_modules\.bin\wmic.exe

```

Now any user that opens Signal, the Windows calculator will be popped.

## PoC

![signal-lpe-3](https://blog.mirch.io/wp-content/uploads/2020/08/signal-lpe-3.png)

## Timeline

* 2019-12-05: Report sent to Signal security team
* 2019-12-11: Reached out to Signal to verify report was received
* 2019-12-16: Signal acknowledges report
* 2019-12-17: Signal v1.29.1 released
* 2019-12-18: Published this blog post
* 2019-12-24: MITRE assigned CVE-2019-19954

## References

* Commit: [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
* Vulnerable version: <https://updates.signal.org/desktop/signal-desktop-win-1.29.0.exe>

[CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster — November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

[![](https://blog.mirch.io/wp-content/uploads/2019/11/debian-buster-postgres-root.png?w=712)](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

## [CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/)

[November 15, 2019November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "6:54 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

The [pg\_ctlcluster](https://manpages.debian.org/buster/postgresql-common/pg_ctlcluster.1.en.html) script in the postgresql-common package in Debian and Ubuntu is vulnerable to a local privilege escalation attack. pg\_ctlcluster is a script used to manage PostgreSQL instances. A malicious actor with access to the postgres account can create arbitrary directories during startup or reload when called via systemd. This vulnerability can be leveraged to escalate privileges to root.

It’s important to note this is not a vulnerability in PostgreSQL and is specific to Debian, Ubuntu, or any system that consumes the Debian postgresql-common package.

A [fix](https://salsa.debian.org/postgresql/postgresql-common/commit/ec9d984b62ed79f61be97b786a9ff4381309979c) is now available. Administrators should upgrade to the latest version of the postgresql-common package. See the Debian [security tracker](https://security-tracker.debian.org/tracker/source-package/postgresql-common) for details.

The vulnerability appears to have existed since 2013 based on the Debian Git history ([9dc97b,](https://salsa.debian.org/postgresql/postgresql-common/commit/9dc97be33f1f116ae6e2f17bd05cb6a2baf274a9) [e97d16](https://salsa.debian.org/postgresql/postgresql-common/commit/e97d163c85c6df7e30ecc346eec007da2cd7e688)). I attempted to reproduce it on Wheezy but was unable to verify it due to unrelated technical issues standing up a test environment.

This proof of concept will show the ability to gain root privileges using the default

installation of  postgresql-common v200+deb10u2 along with postgresql-11 on Debian Buster. I have also verified the vulnerability on Ubuntu 19.04 with version 199 of the postgresql-common package.

---

## Walkthrough

The postgresql init script(/etc/init.d/postgresql) sources [init.d-functions](https://salsa.debian.org/postgresql/postgresql-common/blob/master/debian/init.d-functions) which contain functions that call the pg\_ctlcluster script. pg\_ctlcluster loads the following configuration files determined by the [Pgcommon](https://salsa.debian.org/postgresql/postgresql-common/blob/master/PgCommon.pm) module.

* /etc/postgresql/cluster-version/cluster-name/pg\_ctl.conf
* /etc/postgresql/cluster-version/cluster-name/postgresql.conf
* /var/lib/postgresql/cluster-version/cluster-name/postgresql.auto.conf

These files are owned by the postgres user. The postgresql.auto.conf file will override the settings from /etc/postgresql. This file is created when the [alter system](https://www.postgresql.org/docs/current/sql-altersystem.html) command is executed.

pg\_ctlcluster contains logic to create directories for socketdir(defined in pg\_ctl.conf) and stats\_temp\_directory(defined in postgresql.conf). During a start or reload, if the directories defined in either of these variables do not exist, pg\_ctlcluster will create it and set the owner to the postgres user.

[Continue reading →](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/#more-333)

[CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH — August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

[![](https://blog.mirch.io/wp-content/uploads/2019/08/mqm-woot-4.png?w=712)](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

## [CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/)

[August 25, 2019August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "11:37 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[Leave a comment](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#respond)

# Vulnerability Summary

[IBM MQ](https://en.wikipedia.org/wiki/IBM_MQ) for Linux and UNIX systems is vulnerable to a privilege escalation attack by forcing a setuid root binary to load a malicious library. A local attacker with access to the mqm account can execute arbitrary code as root. In October 2018 IBM published an [advisory](https://www-01.ibm.com/support/docview.wss?uid=ibm10734447) along with patches for several versions.

The goal of this post is to show how the [RPATH/RUNPATH](https://en.wikipedia.org/wiki/Rpath) value could potentially be leveraged for privilege escalation. When specified at compile time this path is embedded in the binary and is the first path searched when searching for a library if the dependent library specified does contain a slash. Details on how this works can be found in the [ld.so](http://man7.org/linux/man-pages/man8/ld.so.8.html) man page.

As with most file path type vulnerabilities, if you control the path, you may control the application in some way. In this case the mqm user is the owner of the directories listed in the RUNPATH.

---

## Walkthrough

List setuid root applications.

```
[mqm@localhost]$ find /opt/mqm -perm -4000 -user root|xargs ls -l
-r-sr-x---. 1 root mqm 13384 Jul 9 07:09 /opt/mqm/bin/security/amqoamax
-r-sr-x---. 1 root mqm 13704 Jul 9 07:09 /opt/mqm/bin/security/amqoampx

```

Use [readelf](http://man7.org/linux/man-pages/man1/readelf.1.html) to read the dynamic section to extract the RPATH/RUNPATH.

```
[mqm@localhost ~]$ readelf -d /opt/mqm/bin/security/amqoamax |grep -e RPATH -e RUNPATH
0x000000000000001d (RUNPATH) Library runpath: [/opt/mqm/lib64:/opt/mqm/gskit8/lib64:/

```

Using my favorite utility [strace](http://man7.org/linux/man-pages/man1/strace.1.html), we can see the open() calls for libm.so.6 fails with ENOENT under /opt/mqm/lib64 and /opt/mqm/gskit8.  We’re using libm.so.6 for this PoC but other libraries can be used. The dependency is ultimately resolved at /usr/lib64/libm.so.6. This gets interesting because the mqm user owns the directories under /opt/mqm.

```
[mqm@localhost ~]$ strace -f /opt/mqm/bin/security/amqoamax 2>&1|grep libm.so
open("/opt/mqm/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/opt/mqm/gskit8/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/usr/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = 3

```

[Continue reading →](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#more-165)

[CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine — June 10, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

[![](https://blog.mirch.io/wp-content/uploads/2019/06/woot-cmd.png?w=659)](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

## [CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/)

[June 10, 2019June 20, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "7:13 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[1 Comment](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#comments)

## **Vulnerability Summary**

During startup the PIA Windows service(pia-service.exe) loads the OpenSSL library from C:\Program Files\Private Internet Access\libeay32.dll. This library attempts to load the C:\etc\ssl\openssl.cnf configuration file. By default on Windows systems, authenticated users can create directories under C:\. A low privileged user can create a openssl.cnf configuration file to load a malicious OpenSSL engine library resulting in the arbitrary code execution as SYSTEM when the service starts.

The root cause is when the OpenSSL libraries were built, the [OPENSSLDIR](https://wiki.openssl.org/index.php/Compilation_and_Installation#PREFIX_and_OPENSSLDIR) parameter was set to a path which a low privileged user can modify or create. I believe this issue is lurking in many Window applications that bundle OpenSSL libraries. I have discovered the same vulnerability in several other Windows applications and will be disclosing those findings when patches are available.

I created a simple tool to help identify potentially vulnerable OpenSSL libraries –<https://github.com/mirchr/openssldir_check>.

CVE-2019-12572 has been patched in v1.2.1. The latest Windows desktop client can be upgraded automatically via the application or manually from the download page at [Private Internet Access](https://www.privateinternetaccess.com/pages/download).

---

### **Walkthrough**

While hunting for potential vulnerabilities in the Windows Private Internet Access desktop application I noticed a failed call to open the c:\etc\ssl\openssl.cnf file during the service startup.

![pia-openssl-failed-open](https://blog.mirch.io/wp-content/uploads/2019/06/pia-openssl-failed-open.png)

This caught my attention and I needed to research this further. But before I get into the details of that, let’s take a step back and see how I arrived there.

[Continue reading →](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#more-259)

## Posts navigation

[Older posts](https://blog.mirch.io/page/2/)

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io)
  + [View site in Reader](https://wordpress.com/read/feeds/161645119)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from github.com_39b45ab6_20250121_023101.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsignalapp%2FSignal-Desktop%2Fcommit%2F2da39cca673cc11be3c6d70d4fb95889f9ab6688)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsignalapp%2FSignal-Desktop%2Fcommit%2F2da39cca673cc11be3c6d70d4fb95889f9ab6688)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=signalapp%2FSignal-Desktop)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[signalapp](/signalapp)
/
**[Signal-Desktop](/signalapp/Signal-Desktop)**
Public

* [Notifications](/login?return_to=%2Fsignalapp%2FSignal-Desktop) You must be signed in to change notification settings
* [Fork
  2.7k](/login?return_to=%2Fsignalapp%2FSignal-Desktop)
* [Star
   14.8k](/login?return_to=%2Fsignalapp%2FSignal-Desktop)

* [Code](/signalapp/Signal-Desktop)
* [Issues
  738](/signalapp/Signal-Desktop/issues)
* [Pull requests
  27](/signalapp/Signal-Desktop/pulls)
* [Actions](/signalapp/Signal-Desktop/actions)
* [Security](/signalapp/Signal-Desktop/security)
* [Insights](/signalapp/Signal-Desktop/pulse)

Additional navigation options

* [Code](/signalapp/Signal-Desktop)
* [Issues](/signalapp/Signal-Desktop/issues)
* [Pull requests](/signalapp/Signal-Desktop/pulls)
* [Actions](/signalapp/Signal-Desktop/actions)
* [Security](/signalapp/Signal-Desktop/security)
* [Insights](/signalapp/Signal-Desktop/pulse)

## Commit

[Permalink](/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

os-locale: Include 'preferLocal: false' option when using execa

[Browse files](/signalapp/Signal-Desktop/tree/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
Browse the repository at this point in the history

```
Thanks to Rich Mirch for pointing this out.
```

* Loading branch information

[![@scottnonnenberg-signal](https://avatars.githubusercontent.com/u/36971246?s=40&v=4)](/scottnonnenberg-signal)

[scottnonnenberg-signal](/signalapp/Signal-Desktop/commits?author=scottnonnenberg-signal "View all commits by scottnonnenberg-signal")
committed
Dec 16, 2019

1 parent
[991d7f9](/signalapp/Signal-Desktop/commit/991d7f9336bbad7fa5d35f4a4ec24b509e998bb6)

commit 2da39cc

Showing
**1 changed file**
with
**46 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

46 changes: 46 additions & 0 deletions

46
[patches/os-locale+2.1.0.patch](#diff-0b483bfc106e8b0fe2e8ebf63aad6dec69ceecdd049fc2c99cc71ba466678f7e "patches/os-locale+2.1.0.patch")

Show comments

[View file](/signalapp/Signal-Desktop/blob/2da39cca673cc11be3c6d70d4fb95889f9ab6688/patches/os-locale%2B2.1.0.patch)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,46 @@ |
|  |  | diff --git a/node\_modules/os-locale/index.js b/node\_modules/os-locale/index.js |
|  |  | index 1ada7a4..1304aa1 100644 |
|  |  | --- a/node\_modules/os-locale/index.js |
|  |  | +++ b/node\_modules/os-locale/index.js |
|  |  | @@ -25,11 +25,11 @@ function getLocale(str) { |
|  |  | } |
|  |  |  |
|  |  | function getAppleLocale() { |
|  |  | - return execa.stdout('defaults', ['read', '-g', 'AppleLocale']); |
|  |  | + return execa.stdout('defaults', ['read', '-g', 'AppleLocale'], { preferLocal: false }); |
|  |  | } |
|  |  |  |
|  |  | function getAppleLocaleSync() { |
|  |  | - return execa.sync('defaults', ['read', '-g', 'AppleLocale']).stdout; |
|  |  | + return execa.sync('defaults', ['read', '-g', 'AppleLocale'], { preferLocal: false }).stdout; |
|  |  | } |
|  |  |  |
|  |  | function getUnixLocale() { |
|  |  | @@ -37,7 +37,8 @@ function getUnixLocale() { |
|  |  | return getAppleLocale(); |
|  |  | } |
|  |  |  |
|  |  | - return execa.stdout('locale') |
|  |  | + const args = null; |
|  |  | + return execa.stdout('locale', args, { preferLocal: false }) |
|  |  | .then(stdout => getLocale(parseLocale(stdout))); |
|  |  | } |
|  |  |  |
|  |  | @@ -50,7 +51,7 @@ function getUnixLocaleSync() { |
|  |  | } |
|  |  |  |
|  |  | function getWinLocale() { |
|  |  | - return execa.stdout('wmic', ['os', 'get', 'locale']) |
|  |  | + return execa.stdout('wmic', ['os', 'get', 'locale'], { preferLocal: false }) |
|  |  | .then(stdout => { |
|  |  | const lcidCode = parseInt(stdout.replace('Locale', ''), 16); |
|  |  | return lcid.from(lcidCode); |
|  |  | @@ -58,7 +59,7 @@ function getWinLocale() { |
|  |  | } |
|  |  |  |
|  |  | function getWinLocaleSync() { |
|  |  | - const stdout = execa.sync('wmic', ['os', 'get', 'locale']).stdout; |
|  |  | + const stdout = execa.sync('wmic', ['os', 'get', 'locale'], { preferLocal: false }).stdout; |
|  |  | const lcidCode = parseInt(stdout.replace('Locale', ''), 16); |
|  |  | return lcid.from(lcidCode); |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2da39cc`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsignalapp%2FSignal-Desktop%2Fcommit%2F2da39cca673cc11be3c6d70d4fb95889f9ab6688) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from blog.mirch.io_13739932_20250121_023100.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[Exploiting Kaseya Unitrends Backup Appliance – Part 1 — May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "Exploiting Kaseya Unitrends Backup Appliance – Part 1")

## [Exploiting Kaseya Unitrends Backup Appliance – Part 1](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/)

[May 20, 2022May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "9:50 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

![](https://blog.mirch.io/wp-content/uploads/2022/05/unitrends-woot.png?w=889)

In 2021 I discovered several high and critical vulnerabilities in the [Kaseya Unitrends](https://www.unitrends.com/products/unitrends-backup-appliances) backup appliance. This research was conducted and published as part of my day job. Part one details a chain of vulnerabilities by leveraging an insecure [PostgreSQL](https://www.postgresql.org/) database to ultimately gain shell access to the remote server. Visit <https://www.cyberonesecurity.com/blog/exploiting-kaseya-unitrends-backup-appliance-part-1> for the the full write-up. Stay tuned for part two.

[sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability — January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=712)](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

## [sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability](https://blog.mirch.io/2021/01/25/sudoedit-lpe/)

[January 25, 2021January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "8:43 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I noticed the following changelog entry in sudo [1.9.5p1.](https://www.sudo.ws/stable.html#1.9.5p1) This caught my attention so I decided to look further. I was unable to find an advisory, PoC, or CVE for this vulnerability. Using the details from the changelog message and fix, I decided to write an exploit for it.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image.png?w=1024)

Using an Ubuntu 20.04.1 VM, I created a low privileged user named “lowpriv” and added a sudoedit rule for a root owned file /etc/test.txt. I also downloaded the [source](https://github.com/sudo-project/sudo/archive/SUDO_1_9_5.tar.gz) for sudo 1.9.5, compiled it, and installed it to /opt/sudo.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-3.png?w=1024)

Show sudoedit rule.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-1.png?w=1024)

Show the sudo version is 1.9.5.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-2.png?w=1024)

With the test environment ready I ran sudoedit /etc/test.txt. I executed !id as a quick test which executes the id command in a shell however privileges are dropped by bash when the UID != EUID. Back to the drawing board.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-5.png?w=1024)

I was able to successfully edit arbitrary files simply using the :e /etc/sudoers or :e /etc/shadow commands to escalate privileges, however that was too easy.

Looking for esoteric features that could potentially be leveraged, I discovered the libcall and libcallnr functions which allow you to execute a function from an external library. The one caveat is there can only be a single argument. There are a crazy amount of functions available to vim that I never realized. Check out <https://vim.help/41-write-a-vim-script#41.6> for the full listing.

I tried calling a variety of functions with varying degrees of success but found a simple method by calling [setuid()](https://man7.org/linux/man-pages/man2/setuid.2.html) directly.

`call libcallnr("libc.so.6","setuid",0)`

After running sudoedit, use the following vim/ex command to change the UID to zero. This will ensure that shelling out will retain privileges because now UID==EUID.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-8.png?w=1024)

Execute a bash shell with !bash.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-9.png?w=198)

Interactive root shell obtained. Woot!

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=1024)

I tested the same proof of concept with 1.9.5p1 and sudoedit properly drops privileges as expected.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-11.png?w=1024)

**Summary**

If you upgraded to sudo 1.9.5 to fix [CVE-2021-23240](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23240) or [CVE-2021-23239](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23239), a new privilege escalation vulnerability was introduced in sudoedit and you should upgrade to 1.9.5p1.

Once in a while I look at recently fixed vulnerabilities to see if I can bypass the fix. In this case, the sudo project knew about this vulnerably but to my knowledge no advisory or CVE was created. I think this is odd that the issue was not communicated since a valid privilege escalation was patched. It’s unclear if another researcher reported it or if maintainers discovered it during their own testing. I also could not find a proof of concept so I decided to write one as a fun exercise.

I hope you enjoyed the short write up. Hit me me up on Twitter [@0xm1rch](https://twitter.com/0xm1rch) if you have any questions or comments.

[Pi-hole Patches Critical Stored XSS Vulnerability — December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2020/12/piholexss.png?w=641)](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

## [Pi-hole Patches Critical Stored XSS Vulnerability](https://blog.mirch.io/2020/12/24/pihole-xss/)

[December 24, 2020December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "10:03 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Pi-hole v5.2.1 is vulnerable to a critical stored cross site scripting vulnerability. An attacker with the ability to directly or indirectly query DNS with a malicious hostname can cause arbitrary JavaScript to execute when the Pi-hole administrator accesses the Query Log or Long-term Query Log pages on the web portal.

The Pi-hole project released a fix on 12/24/2020 in v5.2.2. Shodan reports over 7,500 Pi-hole instances. This could be remotely exploited if these instances permit external DNS queries. Other possibilities may exist if a malformed DNS query is allowed.

No payloads are being published at this time to give users time to patch.

**References**

* <https://github.com/pi-hole/AdminLTE/pull/1665>

**Timeline**

* 12/16/2020 Vulnerability reported to vendor
* 12/18/2020 Vendor acknowledged receipt of report
* 12/22/2020 Discovered a second XSS payload that would fire on the Long-term Queries Page
* 12/23/2020 Mitre assigns CVE-2020-35659
* 12/24/2020 Vendor released fix in v5.2.2

[Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation — September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation")

## [Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/)

[September 25, 2020September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "3:52 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Today, a Metasploit module was merged for a vulnerability I found in 2018 with [VyOS](https://www.vyos.io/). This vulnerability was my first public InfoSec blog post. I appreciate [bcoles](https://github.com/bcoles) for developing the [exploit/linux/ssh/vyos\_restricted\_shell\_privesc](https://github.com/rapid7/metasploit-framework/pull/14123) module. Read the [Metasploit Wrapup for 9/25/2020](https://blog.rapid7.com/2020/09/25/metasploit-wrap-up-80/). The full write-up can can be found on this blog at [C](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)[VE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/).

[Critical Vulnerabilities Discovered in MoFi Routers — September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "Critical Vulnerabilities Discovered in MoFi Routers")

## [Critical Vulnerabilities Discovered in MoFi Routers](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/)

[September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "1:08 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I discovered several vulnerabilities in the MoFi4500 LTE router. Several vulnerabilities have not been patched, including an unauthenticated remote command injection and several undocumented backdoors. The full write-up can be viewed at <https://www.criticalstart.com/critical-vulnerabilities-discovered-in-mofi-routers/>.

Media Coverage

* <https://www.cyberscoop.com/mofi-networks-routers-zero-day-critical-start/>
* <https://www.zdnet.com/article/backdoors-left-unpatched-in-mofi-routers/>

Follow the conversation on Twitter

> The team is at it again! This time with 10 [#0days](https://twitter.com/hashtag/0days?src=hash&ref_src=twsrc%5Etfw) found by [@0xm1rch](https://twitter.com/0xm1rch?ref_src=twsrc%5Etfw) for routers from [@MoFiNetwork](https://twitter.com/MoFiNetwork?ref_src=twsrc%5Etfw). After coordinating with others to reduce impact there still appears to be over 6,860 vulnerable devices externally facing.[#Infosec](https://twitter.com/hashtag/Infosec?src=hash&ref_src=twsrc%5Etfw) [#redteam](https://twitter.com/hashtag/redteam?src=hash&ref_src=twsrc%5Etfw)<https://t.co/1A1UgRmJrq> [pic.twitter.com/YKPiF4LFMq](https://t.co/YKPiF4LFMq)
>
> — TeamARES (@TeamAresSec) [September 2, 2020](https://twitter.com/TeamAresSec/status/1301200248417775618?ref_src=twsrc%5Etfw)

[CVE-2020-3950 VMware Fusion Elevation of Privilege — March 17, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

[![](https://blog.mirch.io/wp-content/uploads/2020/03/vmware-fusion-cve-2020-3950-cropped.png?w=712)](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

## [CVE-2020-3950 VMware Fusion Elevation of Privilege](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/)

[March 17, 2020April 3, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "10:55 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

VMware Fusion 11.5.~~1~~2 and prior are vulnerable to an elevation of privilege vulnerability. For more details please review the advisory and proof of concept on my Github page [CVE-2020-3950.sh](https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2020-3950.sh). VMware released a the patch last week and a public advisory [VMSA-2020-0005](https://www.vmware.com/security/advisories/VMSA-2020-0005.html) today however it has been determined that the patch does not properly fix the vulnerability. I reached out to the VMware security team and received a response at 10:31 UTC 2020-03-18 – “We are aware of the situation and working on the next steps”.

I also learned today that [Jeff Ball](https://twitter.com/jeffball55) at [GRIMM](https://twitter.com/grimmcyber) also independently discovered and reported the vulnerability to VMware.  This is a first for me. Make sure to read their excellent detailed write-up <https://blog.grimm-co.com/post/analyzing-suid-binaries/>. You can also follow the thread on Twitter.

> PoC for CVE-2020-3950 VMware Fusion EoP. <https://t.co/F0jGnE9BZu> Vendor Advisory: <https://t.co/28f3aoAFsG> [pic.twitter.com/5WYG9xg5cv](https://t.co/5WYG9xg5cv)
>
> — Rich Mirch (@0xm1rch) [March 17, 2020](https://twitter.com/0xm1rch/status/1240030085450731521?ref_src=twsrc%5Etfw)

### **Related Articles**

* BleepingComputer [VMware Fixes High Severity Privilege Escalation Bug in Fusion](https://www.bleepingcomputer.com/news/security/vmware-fixes-high-severity-privilege-escalation-bug-in-fusion/)
* ZDNet [VMware patches privilege escalation vulnerability in Fusion, Horizon](https://www.zdnet.com/article/vmware-patches-privilege-escalation-vulnerability-in-workstation-fusion-horizon/)
* SecurityWeek [VMware Fixes Privilege Escalation Vulnerability in Fusion for Mac](https://www.securityweek.com/vmware-fixes-privilege-escalation-vulnerability-fusion-mac)
* SecurityWeek [Patch for Recently Disclosed VMware Fusion Vulnerability Incomplete](https://www.securityweek.com/recent-patch-vmware-fusion-vulnerability-incomplete)
* SecurityWeek [VMware Again Fails to Patch Privilege Escalation Vulnerability in Fusion](https://www.securityweek.com/vmware-again-fails-patch-privilege-escalation-vulnerability-fusion)
* Metasploit Module [Blown up by your own Fusion bomb](https://blog.rapid7.com/2020/04/03/metasploit-wrap-up-58/)

[CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability — December 18, 2019](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability")

## [CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)

[December 18, 2019August 6, 2020](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "7:25 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

Signal Desktop v1.29 on Windows is vulnerable to an elevation of privilege vulnerability. During the startup the application will execute the c:\node\_modules\.bin\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. A low privileged user can create a malicious wmic.exe which will be executed every time Signal Desktop starts by any user of the system. The malicious binary is executed in the background without the users knowledge. This is an example of horizontal [privilege escalation](https://en.wikipedia.org/wiki/Privilege_escalation).

The vulnerability has been patched in v1.29.1 in commit [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688) which was released 12/17/2019. Kudos to the Signal security team for fixing in less than two weeks! Unfortunately, at this time the they do not feel this warrants an advisory or CVE so the vulnerability was silently fixed. **12/24/2019 Update:** Mitre assigned CVE-2019-19954

## Steps To Reproduce

In a cmd window

```
mkdir c:\node_modules\.bin
copy c:\windows\system32\calc.exe c:\node_modules\.bin\wmic.exe

```

Now any user that opens Signal, the Windows calculator will be popped.

## PoC

![signal-lpe-3](https://blog.mirch.io/wp-content/uploads/2020/08/signal-lpe-3.png)

## Timeline

* 2019-12-05: Report sent to Signal security team
* 2019-12-11: Reached out to Signal to verify report was received
* 2019-12-16: Signal acknowledges report
* 2019-12-17: Signal v1.29.1 released
* 2019-12-18: Published this blog post
* 2019-12-24: MITRE assigned CVE-2019-19954

## References

* Commit: [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
* Vulnerable version: <https://updates.signal.org/desktop/signal-desktop-win-1.29.0.exe>

[CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster — November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

[![](https://blog.mirch.io/wp-content/uploads/2019/11/debian-buster-postgres-root.png?w=712)](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

## [CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/)

[November 15, 2019November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "6:54 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

The [pg\_ctlcluster](https://manpages.debian.org/buster/postgresql-common/pg_ctlcluster.1.en.html) script in the postgresql-common package in Debian and Ubuntu is vulnerable to a local privilege escalation attack. pg\_ctlcluster is a script used to manage PostgreSQL instances. A malicious actor with access to the postgres account can create arbitrary directories during startup or reload when called via systemd. This vulnerability can be leveraged to escalate privileges to root.

It’s important to note this is not a vulnerability in PostgreSQL and is specific to Debian, Ubuntu, or any system that consumes the Debian postgresql-common package.

A [fix](https://salsa.debian.org/postgresql/postgresql-common/commit/ec9d984b62ed79f61be97b786a9ff4381309979c) is now available. Administrators should upgrade to the latest version of the postgresql-common package. See the Debian [security tracker](https://security-tracker.debian.org/tracker/source-package/postgresql-common) for details.

The vulnerability appears to have existed since 2013 based on the Debian Git history ([9dc97b,](https://salsa.debian.org/postgresql/postgresql-common/commit/9dc97be33f1f116ae6e2f17bd05cb6a2baf274a9) [e97d16](https://salsa.debian.org/postgresql/postgresql-common/commit/e97d163c85c6df7e30ecc346eec007da2cd7e688)). I attempted to reproduce it on Wheezy but was unable to verify it due to unrelated technical issues standing up a test environment.

This proof of concept will show the ability to gain root privileges using the default

installation of  postgresql-common v200+deb10u2 along with postgresql-11 on Debian Buster. I have also verified the vulnerability on Ubuntu 19.04 with version 199 of the postgresql-common package.

---

## Walkthrough

The postgresql init script(/etc/init.d/postgresql) sources [init.d-functions](https://salsa.debian.org/postgresql/postgresql-common/blob/master/debian/init.d-functions) which contain functions that call the pg\_ctlcluster script. pg\_ctlcluster loads the following configuration files determined by the [Pgcommon](https://salsa.debian.org/postgresql/postgresql-common/blob/master/PgCommon.pm) module.

* /etc/postgresql/cluster-version/cluster-name/pg\_ctl.conf
* /etc/postgresql/cluster-version/cluster-name/postgresql.conf
* /var/lib/postgresql/cluster-version/cluster-name/postgresql.auto.conf

These files are owned by the postgres user. The postgresql.auto.conf file will override the settings from /etc/postgresql. This file is created when the [alter system](https://www.postgresql.org/docs/current/sql-altersystem.html) command is executed.

pg\_ctlcluster contains logic to create directories for socketdir(defined in pg\_ctl.conf) and stats\_temp\_directory(defined in postgresql.conf). During a start or reload, if the directories defined in either of these variables do not exist, pg\_ctlcluster will create it and set the owner to the postgres user.

[Continue reading →](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/#more-333)

[CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH — August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

[![](https://blog.mirch.io/wp-content/uploads/2019/08/mqm-woot-4.png?w=712)](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

## [CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/)

[August 25, 2019August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "11:37 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[Leave a comment](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#respond)

# Vulnerability Summary

[IBM MQ](https://en.wikipedia.org/wiki/IBM_MQ) for Linux and UNIX systems is vulnerable to a privilege escalation attack by forcing a setuid root binary to load a malicious library. A local attacker with access to the mqm account can execute arbitrary code as root. In October 2018 IBM published an [advisory](https://www-01.ibm.com/support/docview.wss?uid=ibm10734447) along with patches for several versions.

The goal of this post is to show how the [RPATH/RUNPATH](https://en.wikipedia.org/wiki/Rpath) value could potentially be leveraged for privilege escalation. When specified at compile time this path is embedded in the binary and is the first path searched when searching for a library if the dependent library specified does contain a slash. Details on how this works can be found in the [ld.so](http://man7.org/linux/man-pages/man8/ld.so.8.html) man page.

As with most file path type vulnerabilities, if you control the path, you may control the application in some way. In this case the mqm user is the owner of the directories listed in the RUNPATH.

---

## Walkthrough

List setuid root applications.

```
[mqm@localhost]$ find /opt/mqm -perm -4000 -user root|xargs ls -l
-r-sr-x---. 1 root mqm 13384 Jul 9 07:09 /opt/mqm/bin/security/amqoamax
-r-sr-x---. 1 root mqm 13704 Jul 9 07:09 /opt/mqm/bin/security/amqoampx

```

Use [readelf](http://man7.org/linux/man-pages/man1/readelf.1.html) to read the dynamic section to extract the RPATH/RUNPATH.

```
[mqm@localhost ~]$ readelf -d /opt/mqm/bin/security/amqoamax |grep -e RPATH -e RUNPATH
0x000000000000001d (RUNPATH) Library runpath: [/opt/mqm/lib64:/opt/mqm/gskit8/lib64:/

```

Using my favorite utility [strace](http://man7.org/linux/man-pages/man1/strace.1.html), we can see the open() calls for libm.so.6 fails with ENOENT under /opt/mqm/lib64 and /opt/mqm/gskit8.  We’re using libm.so.6 for this PoC but other libraries can be used. The dependency is ultimately resolved at /usr/lib64/libm.so.6. This gets interesting because the mqm user owns the directories under /opt/mqm.

```
[mqm@localhost ~]$ strace -f /opt/mqm/bin/security/amqoamax 2>&1|grep libm.so
open("/opt/mqm/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/opt/mqm/gskit8/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/usr/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = 3

```

[Continue reading →](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#more-165)

[CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine — June 10, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

[![](https://blog.mirch.io/wp-content/uploads/2019/06/woot-cmd.png?w=659)](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

## [CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/)

[June 10, 2019June 20, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "7:13 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[1 Comment](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#comments)

## **Vulnerability Summary**

During startup the PIA Windows service(pia-service.exe) loads the OpenSSL library from C:\Program Files\Private Internet Access\libeay32.dll. This library attempts to load the C:\etc\ssl\openssl.cnf configuration file. By default on Windows systems, authenticated users can create directories under C:\. A low privileged user can create a openssl.cnf configuration file to load a malicious OpenSSL engine library resulting in the arbitrary code execution as SYSTEM when the service starts.

The root cause is when the OpenSSL libraries were built, the [OPENSSLDIR](https://wiki.openssl.org/index.php/Compilation_and_Installation#PREFIX_and_OPENSSLDIR) parameter was set to a path which a low privileged user can modify or create. I believe this issue is lurking in many Window applications that bundle OpenSSL libraries. I have discovered the same vulnerability in several other Windows applications and will be disclosing those findings when patches are available.

I created a simple tool to help identify potentially vulnerable OpenSSL libraries –<https://github.com/mirchr/openssldir_check>.

CVE-2019-12572 has been patched in v1.2.1. The latest Windows desktop client can be upgraded automatically via the application or manually from the download page at [Private Internet Access](https://www.privateinternetaccess.com/pages/download).

---

### **Walkthrough**

While hunting for potential vulnerabilities in the Windows Private Internet Access desktop application I noticed a failed call to open the c:\etc\ssl\openssl.cnf file during the service startup.

![pia-openssl-failed-open](https://blog.mirch.io/wp-content/uploads/2019/06/pia-openssl-failed-open.png)

This caught my attention and I needed to research this further. But before I get into the details of that, let’s take a step back and see how I arrived there.

[Continue reading →](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#more-259)

## Posts navigation

[Older posts](https://blog.mirch.io/page/2/)

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io)
  + [View site in Reader](https://wordpress.com/read/feeds/161645119)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from blog.mirch.io_c203ce40_20250121_023059.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability — December 18, 2019](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability")

## [CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)

[December 18, 2019August 6, 2020](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "7:25 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

Signal Desktop v1.29 on Windows is vulnerable to an elevation of privilege vulnerability. During the startup the application will execute the c:\node\_modules\.bin\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. A low privileged user can create a malicious wmic.exe which will be executed every time Signal Desktop starts by any user of the system. The malicious binary is executed in the background without the users knowledge. This is an example of horizontal [privilege escalation](https://en.wikipedia.org/wiki/Privilege_escalation).

The vulnerability has been patched in v1.29.1 in commit [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688) which was released 12/17/2019. Kudos to the Signal security team for fixing in less than two weeks! Unfortunately, at this time the they do not feel this warrants an advisory or CVE so the vulnerability was silently fixed. **12/24/2019 Update:** Mitre assigned CVE-2019-19954

## Steps To Reproduce

In a cmd window

```
mkdir c:\node_modules\.bin
copy c:\windows\system32\calc.exe c:\node_modules\.bin\wmic.exe

```

Now any user that opens Signal, the Windows calculator will be popped.

## PoC

![signal-lpe-3](https://blog.mirch.io/wp-content/uploads/2020/08/signal-lpe-3.png?w=712)

## Timeline

* 2019-12-05: Report sent to Signal security team
* 2019-12-11: Reached out to Signal to verify report was received
* 2019-12-16: Signal acknowledges report
* 2019-12-17: Signal v1.29.1 released
* 2019-12-18: Published this blog post
* 2019-12-24: MITRE assigned CVE-2019-19954

## References

* Commit: [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
* Vulnerable version: <https://updates.signal.org/desktop/signal-desktop-win-1.29.0.exe>

### Share this:

* [Twitter](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/?share=twitter "Click to share on Twitter")
* [Facebook](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

Categories: [Uncategorized](https://blog.mirch.io/category/uncategorized/)

## Post navigation

[CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/)[CVE-2020-3950 VMware Fusion Elevation of Privilege](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/)

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* Reblog
* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2019%252F12%252F18%252Fsignal-desktop-windows-lpe%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2019%252F12%252F18%252Fsignal-desktop-windows-lpe%252F)
  + [Copy shortlink](https://wp.me/paoR5j-5W)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)
  + [View post in Reader](https://wordpress.com/read/blogs/153687293/posts/368)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)


