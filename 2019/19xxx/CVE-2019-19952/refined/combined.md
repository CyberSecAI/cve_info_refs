=== Content from github.com_28cba14b_20250120_234602.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FImageMagick%2FImageMagick%2Fissues%2F1791)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FImageMagick%2FImageMagick%2Fissues%2F1791)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=ImageMagick%2FImageMagick)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[ImageMagick](/ImageMagick)
/
**[ImageMagick](/ImageMagick/ImageMagick)**
Public

* [Notifications](/login?return_to=%2FImageMagick%2FImageMagick) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2FImageMagick%2FImageMagick)
* [Star
   12.6k](/login?return_to=%2FImageMagick%2FImageMagick)

* [Code](/ImageMagick/ImageMagick)
* [Issues
  120](/ImageMagick/ImageMagick/issues)
* [Pull requests
  4](/ImageMagick/ImageMagick/pulls)
* [Discussions](/ImageMagick/ImageMagick/discussions)
* [Actions](/ImageMagick/ImageMagick/actions)
* [Security](/ImageMagick/ImageMagick/security)
* [Insights](/ImageMagick/ImageMagick/pulse)

Additional navigation options

* [Code](/ImageMagick/ImageMagick)
* [Issues](/ImageMagick/ImageMagick/issues)
* [Pull requests](/ImageMagick/ImageMagick/pulls)
* [Discussions](/ImageMagick/ImageMagick/discussions)
* [Actions](/ImageMagick/ImageMagick/actions)
* [Security](/ImageMagick/ImageMagick/security)
* [Insights](/ImageMagick/ImageMagick/pulse)

# heap-use-after-free in MngInfoDiscardObject of coders/png.cÂ #1791

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[heap-use-after-free in MngInfoDiscardObject of coders/png.c](#top)#1791Copy linkLabels[bug](https://github.com/ImageMagick/ImageMagick/issues?q=state%3Aopen%20label%3A%22bug%22)Milestone[7.0.9-7](https://github.com/ImageMagick/ImageMagick/milestone/29)![@galycannon](https://avatars.githubusercontent.com/u/20147567?u=34f392af2bf54d4b32cf8ece9fdc09ab2c9f9b8b&v=4&size=80)
## Description

![@galycannon](https://avatars.githubusercontent.com/u/20147567?u=34f392af2bf54d4b32cf8ece9fdc09ab2c9f9b8b&v=4&size=48)[galycannon](https://github.com/galycannon)opened [on Nov 27, 2019](https://github.com/ImageMagick/ImageMagick/issues/1791#issue-529151827)
### Prerequisites

* I have written a descriptive issue title
* I have verified that I am using the latest version of ImageMagick
* I have searched [open](https://github.com/ImageMagick/ImageMagick/issues) and [closed](https://github.com/ImageMagick/ImageMagick/issues?q=is%3Aissue+is%3Aclosed) issues to ensure it has not already been reported

### Description

There is a heap-use-after-free vulnerability in function MngInfoDiscardObject of coders/png.c whick can be reproduced as below.

### Steps to Reproduce

[poc](https://drive.google.com/open?id=1z31pFLCb5tluwW_n_l7Dh9C_YWBs_IvX)

magick convert $poc /dev/null

`=================================================================`

`==21864==ERROR: AddressSanitizer: heap-use-after-free on address 0xf0a2c1ad at pc 0x083e0eb3 bp 0xffafc948 sp 0xffafc938`

`READ of size 1 at 0xf0a2c1ad thread T0`

 `#0 0x83e0eb2 in MngInfoDiscardObject coders/png.c:1569`

 `#1 0x83e1237 in MngInfoFreeStruct coders/png.c:1609`

 `#2 0x84021f5 in ReadMNGImage coders/png.c:7790`

 `#3 0x84fccbf in ReadImage MagickCore/constitute.c:553`

 `#4 0x810a116 in ReadStream MagickCore/stream.c:1043`

 `#5 0x84fbcd1 in PingImage MagickCore/constitute.c:273`

 `#6 0x84fc2e3 in PingImages MagickCore/constitute.c:374`

 `#7 0x8991f79 in IdentifyImageCommand MagickWand/identify.c:304`

 `#8 0x8a26ba8 in MagickCommandGenesis MagickWand/mogrify.c:185`

 `#9 0x8053b31 in MagickMain utilities/magick.c:149`

 `#10 0x8053d72 in main utilities/magick.c:180`

 `#11 0xf60c5636 in __libc_start_main (/lib/i386-linux-gnu/libc.so.6+0x18636)`

 `#12 0x80535a0 (/home/ImageMagick/utilities/magick+0x80535a0)`

`0xf0a2c1ad is located 8365 bytes inside of 12368-byte region [0xf0a2a100,0xf0a2d150)`

`freed by thread T0 here:`

 `#0 0xf7241a84 in free (/usr/lib/i386-linux-gnu/libasan.so.2+0x96a84)`

 `#1 0x808a8e4 in RelinquishMagickMemory MagickCore/memory.c:1089`

 `#2 0x83e12de in MngInfoFreeStruct coders/png.c:1614`

 `#3 0x8401702 in ReadOneMNGImage coders/png.c:7681`

 `#4 0x84021e4 in ReadMNGImage coders/png.c:7789`

 `#5 0x84fccbf in ReadImage MagickCore/constitute.c:553`

 `#6 0x810a116 in ReadStream MagickCore/stream.c:1043`

 `#7 0x84fbcd1 in PingImage MagickCore/constitute.c:273`

 `#8 0x84fc2e3 in PingImages MagickCore/constitute.c:374`

 `#9 0x8991f79 in IdentifyImageCommand MagickWand/identify.c:304`

 `#10 0x8a26ba8 in MagickCommandGenesis MagickWand/mogrify.c:185`

 `#11 0x8053b31 in MagickMain utilities/magick.c:149`

 `#12 0x8053d72 in main utilities/magick.c:180`

 `#13 0xf60c5636 in __libc_start_main (/lib/i386-linux-gnu/libc.so.6+0x18636)`

`previously allocated by thread T0 here:`

 `#0 0xf7241dee in malloc (/usr/lib/i386-linux-gnu/libasan.so.2+0x96dee)`

 `#1 0x80899a2 in AcquireMagickMemory MagickCore/memory.c:488`

 `#2 0x8402117 in ReadMNGImage coders/png.c:7780`

 `#3 0x84fccbf in ReadImage MagickCore/constitute.c:553`

 `#4 0x810a116 in ReadStream MagickCore/stream.c:1043`

 `#5 0x84fbcd1 in PingImage MagickCore/constitute.c:273`

 `#6 0x84fc2e3 in PingImages MagickCore/constitute.c:374`

 `#7 0x8991f79 in IdentifyImageCommand MagickWand/identify.c:304`

 `#8 0x8a26ba8 in MagickCommandGenesis MagickWand/mogrify.c:185`

 `#9 0x8053b31 in MagickMain utilities/magick.c:149`

 `#10 0x8053d72 in main utilities/magick.c:180`

 `#11 0xf60c5636 in __libc_start_main (/lib/i386-linux-gnu/libc.so.6+0x18636)`

`SUMMARY: AddressSanitizer: heap-use-after-free coders/png.c:1569 MngInfoDiscardObject`

`Shadow bytes around the buggy address:`

 `0x3e1457e0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e1457f0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e145800: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e145810: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e145820: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

`=>0x3e145830: fd fd fd fd fd[fd]fd fd fd fd fd fd fd fd fd fd`

 `0x3e145840: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e145850: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e145860: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e145870: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

 `0x3e145880: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd`

`Shadow byte legend (one shadow byte represents 8 application bytes):`

 `Addressable: 00`

 `Partially addressable: 01 02 03 04 05 06 07`

 `Heap left redzone: fa`

 `Heap right redzone: fb`

 `Freed heap region: fd`

 `Stack left redzone: f1`

 `Stack mid redzone: f2`

 `Stack right redzone: f3`

 `Stack partial redzone: f4`

 `Stack after return: f5`

 `Stack use after scope: f8`

 `Global redzone: f9`

 `Global init order: f6`

 `Poisoned by user: f7`

 `Container overflow: fc`

 `Array cookie: ac`

 `Intra object redzone: bb`

 `ASan internal: fe`

`==21864==ABORTING`

### System Configuration

* ImageMagick version:

  Version: ImageMagick 7.0.9-7 Q16 x86\_64 2019-11-27 <https://imagemagick.org>

  Copyright: ? 1999-2020 ImageMagick Studio LLC

  License: <https://imagemagick.org/script/license.php>

  Features: Cipher DPC HDRI OpenMP(4.0)

  Delegates (built-in): bzlib djvu fftw fontconfig freetype jbig jng jpeg lcms lqr lzma openexr pangocairo png tiff wmf x xml zlib
* Environment (Operating system, version and so on):

  Distributor ID: Ubuntu

  Description: Ubuntu 16.04.5 LTS

  Release: 16.04

  Codename: xenial
* Additional information:
## Metadata

### Assignees

No one assigned

### Labels

[bug](https://github.com/ImageMagick/ImageMagick/issues?q=state%3Aopen%20label%3A%22bug%22)
### Type

No type
### Projects

No projects
### Milestone

* [7.0.9-7](https://github.com/ImageMagick/ImageMagick/milestone/29)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canât perform that action at this time.


