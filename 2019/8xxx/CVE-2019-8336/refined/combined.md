=== Content from github.com_8ae7bb22_20250121_011017.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhashicorp%2Fconsul%2Fissues%2F5423)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhashicorp%2Fconsul%2Fissues%2F5423)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=hashicorp%2Fconsul)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hashicorp](/hashicorp)
/
**[consul](/hashicorp/consul)**
Public

* [Notifications](/login?return_to=%2Fhashicorp%2Fconsul) You must be signed in to change notification settings
* [Fork
  4.4k](/login?return_to=%2Fhashicorp%2Fconsul)
* [Star
   28.6k](/login?return_to=%2Fhashicorp%2Fconsul)

* [Code](/hashicorp/consul)
* [Issues
  1.2k](/hashicorp/consul/issues)
* [Pull requests
  61](/hashicorp/consul/pulls)
* [Actions](/hashicorp/consul/actions)
* [Projects
  0](/hashicorp/consul/projects)
* [Security](/hashicorp/consul/security)
* [Insights](/hashicorp/consul/pulse)

Additional navigation options

* [Code](/hashicorp/consul)
* [Issues](/hashicorp/consul/issues)
* [Pull requests](/hashicorp/consul/pulls)
* [Actions](/hashicorp/consul/actions)
* [Projects](/hashicorp/consul/projects)
* [Security](/hashicorp/consul/security)
* [Insights](/hashicorp/consul/pulse)

# Consul CVE-2019-8336: Potential Privilege Escalation in ACL ReplicationÂ #5423

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Consul CVE-2019-8336: Potential Privilege Escalation in ACL Replication](#top)#5423Copy link![@mkeeler](https://avatars.githubusercontent.com/u/1641976?u=90426307c01b486279d2efd9c3726c2534882e42&v=4&size=80)
## Description

![@mkeeler](https://avatars.githubusercontent.com/u/1641976?u=90426307c01b486279d2efd9c3726c2534882e42&v=4&size=48)[mkeeler](https://github.com/mkeeler)opened [on Mar 4, 2019](https://github.com/hashicorp/consul/issues/5423#issue-416952376)

An internal investigation led to the discovery of an issue with the Consul 1.4 ACL system that, given a very specific set of conditions and events, can allow an unauthorized client to gain the privileges of one other arbitrary ACL token within secondary datacenters. This affects Consul versions 1.4.0, 1.4.1 and 1.4.2.

## Summary

You should take action if you utilize Consul 1.4.0+ with ACL token replication (multi-datacenter). Given this was introduced in version 1.4.0, we do recommend upgrading to the minor 1.4.3 release regardless of usage of the ACL replication features.

### Remediation steps with an upgrade to Consul 1.4.3:

1. Upgrade to version 1.4.3 of Consul in all datacenters. Only Consul servers must be upgraded as the clients are unaffected.
2. If the conditions outlined in the Background section had been met, the suspect token will automatically be invalidated and removed. Unless aware of this vulnerability, users will not be affected by this token removal as they were not aware of its existence.

### Remediation steps without an upgrade - disabling token replication:

Unless using local tokens the simplest way to remediate the problem without an upgrade is to disable token replication. If relying on local tokens this cannot be done as token replication is a prerequisite for local tokens.

1. Set the `acl.token_replication` configuration to `false` for Consul servers in the secondary datacenters.
2. Perform a rolling restart of the Consul servers within those secondary datacenters.

## Background

Privilege for a specific token can be achieved with the following conditions:

* Must have ACL token replication enabled in secondary datacenters
* Must have assigned replication tokens to the Consul servers in secondary datacenters.
* The assigned replication token must have read permissions on ACLs but not write permissions

When those conditions are met, the ACL token replication process in a secondary datacenter can end up injecting a token with a secret of `<hidden>` into the local state store. Then other clients could pass `<hidden>` as the token to various API calls instead of the tokens original/correct secret and gain access to whatever the token is allowed to access.

Note that the token will have the secret ID of the literal string `<hidden>`, and this is not obfuscation. This is due to the string `<hidden>` being used to redact the value of the token in some internal endpoints for security reasons. In this case, this led to a bug that caused the value to be the string `<hidden>`.

## Detection

It is possible to detect if a secondary datacenter is affected using the following Consul CLI command:

```
consul acl token read -token "<hidden>" -self

```

This assumes that you are running the `consul` command from within the secondary datacenter on a Consul node with the HTTP API enabled on `localhost:8500`. If these assumptions are not accurate other CLI options may be used to have the command use the correct HTTP and datacenter settings. These are documented [here](https://www.consul.io/docs/commands/acl/acl-token.html#common-subcommand-options) .

## Mitigations

Consul already prevents multiple tokens from having the same secret so this can only grant access to a single token, though it is not deterministic which token that will be. In the worst case it could be a privileged token capable of unrestricted access in the secondary datacenter.

The `<hidden>` secret is still invalid within the primary datacenter and therefore no new policies or globally valid tokens may be created (or any operation within the primary datacenter). The replication process updates tokens in secondary DCs in batches and will error out the whole batch if more than one token has an error inserting. So the bad token can only be injected when only a single token needs replicating from the primary datacenter.

Changes to token replication and the ACL system were made in 1.4.0. This vulnerability affects versions 1.4.0, 1.4.1, and 1.4.2. Version 1.4.3 fixes this and provides a mitigation for users coming from affected versions. If a token exists with the `<hidden>` value in these versions, after upgrading and when a Consul 1.4.3 server in the secondary datacenter has gained leadership, the offending token will be removed from the data store. This happens prior to replication being started and will allow the token to be fetched again and inserted locally with the correct secret ID.

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canât perform that action at this time.



=== Content from avatars.githubusercontent.com_6e15dd79_20250121_031802.html ===
ï¿½ï¿½ï¿½ï¿½ ï¿½  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222ï¿½ï¿½  P P" ï¿½ï¿½ï¿½          
   } !1AQa"q2ï¿½ï¿½ï¿½#Bï¿½ï¿½Rï¿½ï¿½$3brï¿½
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½       
  w !1AQaq"2ï¿½Bï¿½ï¿½ï¿½ï¿½ #3Rï¿½brï¿½
$4ï¿½%ï¿½&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½   ? ï¿½ï¿½|ï¿½ï¿½1ï¿½ï¿½Zï¿½sï¿½^]ï¿½\*}ï¿½Oqï¿½Ï¨ï¿½\*ï¿½zï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½nDï¿½1ï¿½ï¿½ï¿½[Oï¿½ÅºvÄï¿½/<ï¿½ï¿½ï¿½iÈeï¿½ï¿½WMï¿½qu,p&:ï¿½-Ï¦@ï¿½ï¿½3}+ï¿½ï¿½ï¿½ï¿½Mï¿½ï¿½Oï¿½?ï¿½ï¿½ï¿½Bï¿½ï¿½ï¿½Çµï¿½F\*1ï¿½ï¿½#ï¿½Pb:ï¿½ï¿½ï¿½ï¿½tCï¿½QRï¿½ï¿½ï¿½ï¿½4Pï¿½Aï¿½Zm!ï¿½V+ï¿½ï¿½~cÏ®\*Wn3ï¿½ï¿½ï¿½ï¿½ï¿½\_Dï¿½Gï¿½ï¿½hï¿½@ï¿½ï¿½ï¿½ï¿½Xï¿½'qï¿½Â¢Vrï¿½[êºï¿½ï¿½ uoï¿½ï¿½ï¿½ 
ï¿½ï¿½CSï¿½ï¿½Zï¿½ï¿½ ï¿½ï¿½UWmï¿½?Æ´ï¿½wqwcï¿½ï¿½ï¿½6ï¿½ï¿½-ï¿½ï¿½ï¿½wï¿½ï¿½kï¿½Ñ®lï¿½\_Bï¿½)ï¿½Bï¿½$ï¿½[#ï¿½%ï¿½tI3N}~ï¿½aï¿½ï¿½ï¿½Z7Mï¿½")!ï¿½ï¿½ï¿½r2ï¿½wï¿½ï¿½zï¿½ï¿½ErPï¿½Ezï¿½ï¿½mï¿½ï¿½ï¿½ï¿½Hï¿½AØï¿½\*<ï¿½É®wYï¿½`ï¿½ï¿½4Yï¿½1ï¿½ï¿½ï¿½ï¿½)ï¿½ï¿½ï¿½Eï¿½oï¿½ï¿½ï¿½ï¿½s\*ï¿½8ï¿½U ï¿½sÖºï¿½-sfï¿½ï¿½Çï¿½qï¿½qï¿½rï¿½ ï¿½ï¿½ï¿½ï¿½ï¿½Bï¿½sï¿½ï¿½7ï¿½qï¿½ï¿½ï¿½Ý·Hï¿½yï¿½ï¿½5sï¿½pm6XÕ¯Eï¿½$Ëï¿½\*ï¿½=ï¿½ï¿½{ï¿½ï¿½ï¿½K3ï¿½ï¿½tï¿½`0Vï¿½ï¿½cï¿½ï¿½jï¿½ï¿½ï¿½o)ï¿½hï¿½9ï¿½ï¿½ï¿½Gï¿½kxï¿½Öï¿½ï¿½ï¿½Ï®ï¿½ï¿½mtï¿½ï¿½%ï¿½Ô±ï¿½a\Nï¿½ï¿½ï¿½ï¿½ï¿½ï¿½[8ÉF;ï¿½ nï¿½ï¿½ï¿½ ï¿½ï¿½ï¿½Dï¿½ï¿½ï¿½ï¿½!ï¿½!ï¿½ï¿½ï¿½ï¿½{ï¿½É¨ï¿½>iï¿½Êºï¿½9ï¿½Eaï¿½ï¿½cRï¿½ï¿½ï¿½BMRï¿½iï¿½5p'9ï¿½yQg,ï¿½$ï¿½ï¿½
ï¿½ï¿½ï¿½<3ï¿½ï¿½]ï¿½ÉF=Gï¿½ï¿½ï¿½Vï¿½ï¿½ ï¿½Gï¿½fï¿½\_ï¿½ï¿½ï¿½ï¿½ï¿½Bï¿½ï¿½Yï¿½ ï¿½ï¿½#4rÆ®Ê+ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Gï¿½-ï¿½Wï¿½Zï¿½ï¿½/ï¿½ï¿½4ï¿½ï¿½ï¿½%ï¿½ï¿½ï¿½ï¿½ï¿½
ï¿½ï¿½ï¿½Nï¿½Íï¿½ï¿½ï¿½ï¿½9ï¿½ï¿½ï¿½Ï,ÉGï¿½oï¿½Xï¿½ÜÓï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½6ï¿½`ï¿½ï¿½ï¿½ï¿½z~T8yï¿½zÊ½ï¿½Úoï¿½ï¿½#ï¿½ï¿½rOï¿½ï¿½uw}ï¿½ï¿½ï¿½ï¿½Zï¿½ï¿½6G2;ï¿½ï¿½`ï¿½ï¿½ï¿½Iï¿½iVï¿½-ï¿½ï¿½'bï¿½'ï¿½ï¿½eï¿½Zï¿½ï¿½ï¿½ï¿½Lï¿½(ï¿½tQï¿½T7weï¿½ï¿½Ú]ï¿½dï¿½ï¿½ï¿½!ï¿½ P~ï¿½ï¿½gï¿½Gï¿½i&ï¿½ï¿½ï¿½;ï¿½ ï¿½1ï¿½ï¿½ï¿½ï¿½ï¿½zï¿½ÜWï¿½ï¿½ï¿½Vwï¿½ï¿½uï¿½4ï¿½ï¿½Êï¿½ï¿½
