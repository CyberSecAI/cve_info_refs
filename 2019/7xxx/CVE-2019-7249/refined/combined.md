=== Content from keybase.io_5623e302_20250121_003635.html ===


[![](/images/icons/icon-keybase-logo-48.png)](/)

Keybase Staging Server

| [Install](/download) | [Login](#_) |  |  |  |
| --- | --- | --- | --- | --- |

×

×

Docs > Security Advisories

### Security Updates

* •[KB 001 (2018.12.18)](/docs/secadv/kb001)
* •[KB 002 (2018.12.18)](/docs/secadv/kb002)
* •[KB 003 (2018.12.25)](/docs/secadv/kb003)
* •[KB 004 (2018.01.18)](/docs/secadv/kb004)

Docs > Security Advisories >
Security Updates > KB 001 (2018.12.18)
Security Updates > KB 002 (2018.12.18)
Security Updates > KB 003 (2018.12.25)
Security Updates > KB 004 (2018.01.18)

## Local Privilege Escalation in MacOS via Keybase Helper (KB004)

### Publication Date

2018 Jan 30

### Externals Links

* [HackerOne Report: macOS privilege escalation via keybase install](https://hackerone.com/reports/471739)
* [HackerOne Report: Privilege Escalation via Keybase Helper (incomplete security fix)](https://hackerone.com/reports/470003)
* [HackerOne Report: Local privilege escalation bug using Keybase redirector on macOS](https://hackerone.com/reports/470398)
* [HackerOne Report: Privilege Escalation through Keybase Installer via Helper](https://hackerone.com/reports/473252)

### Description

After our [previous security disclosure](./kb002), the Keybase update/installer system
has attracted additional scrutiny from security researchers. We collected reports from five
researchers who found further bugs in the Keybase Helper process and Keybase Installer
process, both of which are used to keep Keybase up-to-date without user intervention.

There were three bugs found in these reports: (1) there was a race condition
in code that checked that the Helper was talking to an authortized Installer,
primarily due to the fact that Apple does not publish the [secure APIs](https://github.com/keybase/client/commit/363e5462a0805db3fb5b5e31f9f5bc2d4d01964f#diff-6b38ec99df56270d10855aaf59ef8e4aR20) for so doing; (2)
there was a [time-to-check-time-to-use (TOCTOU)](https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use) bug in placing the `redirector` process into its run location, that would allow an attacker to fool the installer into
putting a symbolic link into a secure location, that could then be replaced; and
(3) the `move` RPC to the Helper was susceptible to TOCTOU bugs and
would also allow one users of the system (who didn't have root access) to tamper with another's installs.

Malicious software (outside of Keybase) running on the local computer could
have used such a bug to escalate privileges.

We thank the following HackerOne researchers for their excellent research, and their responsible and timely
reporting:

* [Rich Mirch](https://hackerone.com/mirchr)
* [0xCCCC](https://hackerone.com/0xcccc)
* [Jan Votava](https://hackerone.com/votava)
* [jinmo123](https://hackerone.com/jinmo123)
* [Nicolas Trippar](https://hackerone.com/ntrippar)

## The Fix

These reports prompted us to rearchitect our Helper, to signifcantly reduce the width
of its API. In particular, the [move RPC](https://github.com/keybase/client/commit/2be68d4bdcab931b49b3ecd5fbe21a4d4493f268#diff-83d62ffede33f42f62b99d98fee07152L103)
has been retired, and the install of the new application is done outside of
the privileged Helper, [without escalated privileges](https://github.com/keybase/client/commit/2be68d4bdcab931b49b3ecd5fbe21a4d4493f268#diff-80a111243b08af81f9acd05f5da18bb4R93).
Also, we're now careful to [check file types](https://github.com/keybase/client/commit/363e5462a0805db3fb5b5e31f9f5bc2d4d01964f#diff-83d62ffede33f42f62b99d98fee07152R204) when moving files to
privileged locations to avoid symlink-based-attacks.

### Affected Versions

Keybase versions release prior to 2.12.6, released on January 1, 2018.

### Remediation

Upgrade to [v2.13](https://keybase.io/docs/the_app/install_macos) or above. Almost all users received a patched version
via automatic upgrades shortly after the bug was discovered.

### Timeline

* 2018 Dec 19 through 29 — Vulnerabilities reported via HackerOne
* 2018 Dec 28 - Partial fix released in 2.12.4-20181228150844+7724569b6d
* 2019 Jan 01 - Complete fix released in 2.12.6-20190103194556+07470de987
* 2019 Jan 15 - Subsequent minor release in 2.13.0
* 2019 Jan 16 - E-mails sent out to all users still running affected versions, asking for upgrades
* 2019 Jan 30 - In-app message from [max](https://keybase.io/max) sent out to all users still running affected versions, asking for upgrades
* 2019 Jan 30 - This announcement, and disclosure on HackerOne

![](/images/walkthrough/footprints_transp.png)

Keybase, 2025
| Available within Tor at **http://keybase5wmilwokqirssclfnsqrjdsi7jdir5wy7y7iu3tanwmtp6oid.onion**

[install Keybase](/download)
| [read our blog](/blog)
| [documentation](/docs)
| [bug reporting](/docs/bug_reporting)
| [security advisories](/docs/secadv)

[terms](/docs/terms)
& [privacy](/docs/privacypolicy)
& [california ccpa](/docs/california-ccpa)
& [acceptable use](/docs/acceptable-use-policy)

[jobs @ keybase](/jobs)

[Please send us feedback & bug reports](https://github.com/keybase/client/issues).

Keybase, 2025
| [read our blog](/blog)

[terms](/docs/terms)
& [privacy](/docs/privacypolicy)
& [security advisories](/docs/secadv)
& [california ccpa](/docs/california-ccpa)
& [acceptable use](/docs/acceptable-use-policy)


