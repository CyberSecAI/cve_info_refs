=== Content from issues.openbravo.com_0d2236f1_20250120_233612.html ===

Anonymous | [Login](login_page.php?return=%2Fview.php%3Fid%3D41413)

Project: All Projects
ERP Extensions
 » Localization Pack: Spain
 » Modules
Openbravo ERP
Openbravo for Retail
 » POS2
 » Retail Modules
Openbravo Localizations
Tools
 » Infrastructure
 » Mantis @ OB

[![RSS](images/img-corp/icon/rss.gif)](https://issues.openbravo.com/issues_rss.php)

[News](/main_page.php) | [My View](/my_view_page.php) | [View Issues](/view_all_bug_page.php) | [Roadmap](/roadmap_page.php) | [Summary](/summary_page.php)

| View Issue Details[ [Jump to Notes](#bugnotes) ] | | | | [ [Issue History](view.php?id=41413&history=1#history) ] [ [Print](print_bug_page.php?bug_id=41413) ] | |
| --- | --- | --- | --- | --- | --- |
| ID |
| 0041413 |
| Type | Category | Severity | Reproducibility | Date Submitted | Last Update |
| backport | [Openbravo ERP] C. Security | major | always | 2019-07-18 17:51 | 2019-07-26 08:31 |
|  | | | | | |
| Reporter | dlescos | View Status | public |  | |
| Assigned To | alostale |  | | | |
| Priority | high | Resolution | fixed | Fixed in Version | 3.0PR19Q1.3 |
| Status | closed | Fix in branch |  | Fixed in SCM revision | [b2497eaf692d](http://code.openbravo.com/erp/backports/3.0PR19Q1.3/rev/b2497eaf692dc039e91863945515cb5888f55d25) |
| Projection | none | ETA | none | Target Version | 3.0PR19Q1.3 |
|  | | | | | |
| OS | Linux 64 bit | Database | PostgreSQL | Java version | 7.x |
| OS Version | Openbravo Appliance 14.04 | Database version | 9.3.x | Ant version | 1.9.x |
| Product Version | 3.0PR18Q3.5 | SCM revision |  |  | |
|  | | | | | |
| Review Assigned To | caristu | | | | |
| Web browser |  | | | | |
| Modules | User Interface Application | | | | |
| Regression level |  | | | | |
| Regression date |  | | | | |
| Regression introduced in release |  | | | | |
| Regression introduced by commit |  | | | | |
| Triggers an Emergency Pack | No | | | | |
|  | | | | | |
| Summary | 0041413: Security Issue - Path Traversal with Attachments | | | | |
| Description | Attachments are vulnerable to path traversal attack by modifiying the inpKey parameter while the file is submitted, letting the Openbravo user access the server file system and replace files.  The issue lies in the \_org.openbravo.client.application.attachment.getAttachmentDirectoryForNewAttachment\_ method which does not check the \_inpKeyId\_ value, used to create the subdirectories in attachments.   This value is later splitted in three-characters directories (\_splitPath\_ method, same class). This does not prevent the user from accessing large portions of the underlying file system.  Furthermore, informations on the attachments directory location on the server can be gained by providing a non existing path, which results in the user error message displaying the attachments directory absolute path.   This implies two immediate possibilities : - if the attachments directory is contained in the main Openbravo directory, then files in \_web\_ and \_web/js\_ and \_src/{build.xml, index.jsp,...}\_ can be replaced. - On UNIX, if the attachments directory is a subdirectory of \_$HOME\_, \_.bashrc\_ can be replaced. | | | | |
| Steps To Reproduce | The following has been tested on the last openbravo sourceforge appliance (3.0PR18Q3.5).  Open a transaction window that provides the attachments feature, let's say \_"Sales Order"\_.   ## Collect informations Click \_\_"[ Add ]"\_\_ in the Attachments section Choose you \_\_test\_file.txt\_\_ file with the \_\_"Choose File"\_\_ button.  Click \_\_"Submit"\_\_ and intercept the post request to \_\_businessUtility/TabAttachments\_FS.html\_\_ and manually update the json parameter \_\_paramValues.inpKey()\_\_ with some impossible path like \_\_../../../../../../../../../\_\_ which will become \_\_attachments/259/../../../../../../../../../\_\_  Then forward the updated request. This should display \_"Could not move report to final destination: /opt/OpenbravoERP/attachments/259/../../../../../../../../../test\_file.txt"\_ You have gained informations on the attachments path.  ## Replace a file on the file system Same as above but with a valid \_inpKey\_ path. For example on the test appliance: ../../webjs which will be expanded to attachments/259/../../web/js. | | | | |
| Proposed Solution | Set the \_SaveAttachmentsOldWay\_ to \_Y\_ is an immediate solution.  A possible patch would be to update the \_org.openbravo.client.application.attachment.getAttachmentDirectoryForNewAttachment\_ to check the whole path does not contain the ".." substring before \_FileUtils.copyFileToDirectory\_ is called. | | | | |
| Tags | No tags attached. | | | | |
|  | | | | | |
| Attached Files |  | | | | |
| |  |  |  | | --- | --- | --- | | | | | | |

| - Relationships [ [Relation Graph](bug_relationship_graph.php?bug_id=41413&graph=relation) ]  [ [Dependency Graph](bug_relationship_graph.php?bug_id=41413&graph=dependency) ] | |
| --- | --- |
| | blocks | defect | [0041401](view.php?id=41401) |  | closed | [alostale](https://issues.openbravo.com/view_user_page.php?id=19) | Security Issue - Path Traversal with Attachments | | --- | --- | --- | --- | --- | --- | --- | | |

| + Relationships |
| --- |

| -  Notes | |
| --- | --- |
| ([0113563)](view.php?id=41413#c113563 "Direct link to note") [hgbot](https://issues.openbravo.com/view_user_page.php?id=2414) (developer)  2019-07-22 13:29 | Repository: erp/backports/3.0PR19Q1.3 Changeset: b2497eaf692dc039e91863945515cb5888f55d25 Author: Asier Lostalé <asier.lostale <at> openbravo.com> Date: Mon Jul 22 13:10:02 2019 +0200 URL: <http://code.openbravo.com/erp/backports/3.0PR19Q1.3/rev/b2497eaf692dc039e91863945515cb5888f55d25> [[^](http://code.openbravo.com/erp/backports/3.0PR19Q1.3/rev/b2497eaf692dc039e91863945515cb5888f55d25)]  fixed issue 41413: incorrect attachment key management    The changeset includes:     \* Checking key sent from customer is a valid ID     \* Check the record is readable when uploading files     \* Check there is an acutal record for a given key  --- M modules/org.openbravo.client.application/src/org/openbravo/client/application/attachment/AttachImplementationManager.java M src/org/openbravo/erpCommon/businessUtility/TabAttachments.java --- |
|  | |
| ([0113659)](view.php?id=41413#c113659 "Direct link to note") [caristu](https://issues.openbravo.com/view_user_page.php?id=16231) (developer)  2019-07-26 08:31 | Reviewed + tested OK. |
|  | |

| +  Notes | |
| --- | --- |

| - Issue History | | | |
| --- | --- | --- | --- |
| Date Modified | Username | Field | Change |
| 2019-07-22 12:47 | [alostale](https://issues.openbravo.com/view_user_page.php?id=19) | Type | defect => backport |
| 2019-07-22 12:47 | [alostale](https://issues.openbravo.com/view_user_page.php?id=19) | Target Version | => 3.0PR19Q1.3 |
| 2019-07-22 12:49 | [alostale](https://issues.openbravo.com/view_user_page.php?id=19) | Review Assigned To | => caristu |
| 2019-07-22 12:49 | [alostale](https://issues.openbravo.com/view_user_page.php?id=19) | Assigned To | platform => alostale |
| 2019-07-22 13:29 | [hgbot](https://issues.openbravo.com/view_user_page.php?id=2414) | Checkin |  |
| 2019-07-22 13:29 | [hgbot](https://issues.openbravo.com/view_user_page.php?id=2414) | Note Added: 0113563 |  |
| 2019-07-22 13:29 | [hgbot](https://issues.openbravo.com/view_user_page.php?id=2414) | Status | scheduled => resolved |
| 2019-07-22 13:29 | [hgbot](https://issues.openbravo.com/view_user_page.php?id=2414) | Resolution | open => fixed |
| 2019-07-22 13:29 | [hgbot](https://issues.openbravo.com/view_user_page.php?id=2414) | Fixed in SCM revision | => <http://code.openbravo.com/erp/backports/3.0PR19Q1.3/rev/b2497eaf692dc039e91863945515cb5888f55d25> [[^](http://code.openbravo.com/erp/backports/3.0PR19Q1.3/rev/b2497eaf692dc039e91863945515cb5888f55d25)] |
| 2019-07-26 08:31 | [caristu](https://issues.openbravo.com/view_user_page.php?id=16231) | Note Added: 0113659 |  |
| 2019-07-26 08:31 | [caristu](https://issues.openbravo.com/view_user_page.php?id=16231) | Status | resolved => closed |
| 2019-07-26 08:31 | [caristu](https://issues.openbravo.com/view_user_page.php?id=16231) | Fixed in Version | => 3.0PR19Q1.3 |

| + Issue History | | | |
| --- | --- | --- | --- |

---

| Copyright © 2000 - 2009 MantisBT Group | [Powered by Mantis Bugtracker](http://www.mantisbt.org "Free Web Based Bug Tracker") |
| --- | --- |


