=== Content from www.pentestpartners.com_63a29080_20250120_235227.html ===


[![Pen Test Partners Logo](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/logo-ptp.png)

Security consulting and testing services](https://www.pentestpartners.com)

+44 20 3095 0500

+1 646 693 2501

* [About](https://www.pentestpartners.com/about-us/)
  + [PTP in the USA](https://www.pentestpartners.com/about-us/ptp-in-the-usa/)
  + [Careers](https://www.pentestpartners.com/about-us/careers/)
  + [Our Vision and Values](https://www.pentestpartners.com/our-vision-and-values/)
  + [In the news](https://www.pentestpartners.com/about-us/in-the-news/)
  + [Environmental Statement](https://www.pentestpartners.com/about-us/environmental-statement/)
  + [Vulnerability Disclosure Policy](https://www.pentestpartners.com/about-us/vulnerability-disclosure-policy/)
* [Services](https://www.pentestpartners.com/penetration-testing-services/)
  + [Red Teaming](https://www.pentestpartners.com/penetration-testing-services/red-teaming/)
  + [Purple Teaming](https://www.pentestpartners.com/penetration-testing-services/purple-teaming/)
  + [Penetration Testing](https://www.pentestpartners.com/penetration-testing-services/penetration-testing/)
  + [Agile Environment Testing](https://www.pentestpartners.com/penetration-testing-services/agile-environment-testing/)
  + [Aviation Cyber Security Testing](https://www.pentestpartners.com/penetration-testing-services/aviation-cyber-security-testing/)
  + [Automotive & IoT Testing](https://www.pentestpartners.com/penetration-testing-services/automotive-and-iot-testing/)
  + [Maritime Cyber Security Testing](https://www.pentestpartners.com/penetration-testing-services/maritime-cyber-security-testing/)
  + [Cloud Services Security](https://www.pentestpartners.com/penetration-testing-services/cloud-services-security/)
  + [DevOps Lifecycle Assurance](https://www.pentestpartners.com/devops-lifecycle-assurance/)
  + [Social Engineering](https://www.pentestpartners.com/penetration-testing-services/social-engineering/)
  + [Physical Security](https://www.pentestpartners.com/penetration-testing-services/physical-security/)
  + [Security Training](https://www.pentestpartners.com/penetration-testing-services/security-training/)
  + [Papa – Proactive Advanced Password Auditor](https://www.pentestpartners.com/penetration-testing-services/papa/)
  + [ICS, IIoT, SCADA Security Testing](https://www.pentestpartners.com/penetration-testing-services/ics-iiot-scada-security-testing/)
  + [CBEST Red Teaming](https://www.pentestpartners.com/penetration-testing-services/cbest-threat-intelligence-led-red-teaming/)
  + [CREST OVS Mobile & Apps](https://www.pentestpartners.com/crest-owasp-verification-standard-ovs-program/)
  + [TIBER-EU Assessments](https://www.pentestpartners.com/penetration-testing-services/tiber-eu-assessments/)
  + [CREST STAR-FS](https://www.pentestpartners.com/penetration-testing-services/crest-star-fs-assessments/)
  + [Cyber Essentials Testing](https://www.pentestpartners.com/penetration-testing-services/cyber-essentials-testing/)
  + [Cyber Security Consulting](https://www.pentestpartners.com/penetration-testing-services/cyber-security-consulting/)
  + [Compromise Assessment](https://www.pentestpartners.com/compromise-assessment/)
  + [Digital Forensics Services](https://www.pentestpartners.com/digital-forensics-services/)
  + [Incident Response Services](https://www.pentestpartners.com/incident-response-services/)
  + [Incident Response Retained Service](https://www.pentestpartners.com/incident-response-retained-service/)
  + [Incident Response Policy Assessment & Development](https://www.pentestpartners.com/incident-response-policy-assessment-development/)
  + [Attack Surface Assessment](https://www.pentestpartners.com/attack-surface-assessment/)
* [Events](https://www.pentestpartners.com/events-and-speaking/)
* [Security Blog](https://www.pentestpartners.com/security-blog/)
* [Demo Videos](https://www.pentestpartners.com/resources/hack-demo-videos/)
* [Contact Us](https://www.pentestpartners.com/contact-us/)

For the best user experience please upgrade your browser

Blog: Hardware Hacking

# Breaking (Bad) Cross-Site Request Forgery Protection – The Netgear Nighthawk M1

G Richter
10 Aug 2019

### What is CSRF?

Cross-site Request Forgery (CSRF) is a descriptive term, but pretty oblique if you don’t know exactly what it means. Broken down, it’s pretty simple:

* A malicious web page running in your browser can send requests to other sites.
* When it sends those requests, it’ll use the current session cookie stored in your browser.
* So if you’re logged into something (or even if you’re not), the malicious page can send requests from your browser context, with the privileges of your current session on that site.

Basically, the malicious web page can try to “forge” “requests” from its own site to another (“cross-site”). So it’s “Cross-Site Request Forgery”. Simple!

If you’re running a web application, and you haven’t implemented some kind of CSRF protection, then you’re not checking whether requests originated from pages you control. Baddies might rely on this to make requests to a site with the current session permissions of a logged-in user. They might try to change that user’s password, for instance, and steal their account.

However, a malicious page can’t usually **read data back** from another site. There’s a policy in all browsers called the *Same Origin Policy*. By default, if one page asks to read the contents of another site, the answer is a resounding **NO**.

![](https://www.pentestpartners.com/content/plugins/lazy-load/images/1x1.trans.gif)![](https://www.pentestpartners.com/content/uploads/2017/08/CSRKM1-1.png)

There are exceptions to this, but they can be discussed in depth another time. Regardless, the SOP stops one page from reading the contents of another.

So, usually, a CSRF-protection mechanism looks like this:

* A token is issued by a website.
* The token is checked when a request is parsed, and rejected if the token’s wrong.

The assumption is that since a malicious site can’t read back responses from another site, it can’t know the token, so it can’t send valid requests.

### There are (obvious?) exceptions

Let’s say you want to embed an image off another server. Unless the server application implements an extremely heavy cross-origin protection logic, or some other kind of authentication, then you’ll probably be allowed to do this. This would fall into the category of cross-origin *embedding*.

[Mozilla have a handy breakdown](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy#Cross-origin_network_access) of what’s allowed to be embedded:

![](https://www.pentestpartners.com/content/plugins/lazy-load/images/1x1.trans.gif)![](https://www.pentestpartners.com/content/uploads/2017/08/moz-richter.png)

Cross-origin embedding is fine. You can embed scripts, images, CSS, media, fonts – all kinds of web trash.

### What does this mean for routers?

CSRF is particularly interesting in the case of devices running on your LAN which might have web interfaces exposed – e.g. routers. While your router web interface might not be directly accessible over the “Internet”, it is accessible from your browser. And, as we know, since malicious websites can try to make requests anywhere, they can even try to make requests to your router.

So, it makes sense that routers would include CSRF protection mechanisms. That’s exactly what the Netgear Nighthawk M1 has.

### Netgear Nighthawk M1 CSRF Protection

The Netgear Nighthawk M1 web interface has a CSRF protection token mechanism. All requests to the API endpoints have to have a token parameter, and look a bit like this:

```
POST /Forms/config HTTP/1.1

Host: 192.168.1.1

User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0

Accept: */*

Accept-Language: en-GB,en;q=0.5

Accept-Encoding: gzip, deflate

Referer: http://192.168.1.1/index.html

Content-type: application/x-www-form-urlencoded

Content-Length: 113

Cookie: sessionId=0000000d-bW1XS27NZzc39egmHaPFXRP9vuZl3wp

Connection: close

general.shutdown=restart&err_redirect=/error.json&ok_redirect=/success.json&token=k8BKKSfEUxxMlrrFaCyQgGuTMGRSbnl
```

This token is retrieved under normal circumstances by reading the contents of a file at /api/model.json, which is a dynamically-generated file containing a JSON object of various configuration and session values, including the session.secToken.

```
[...snip...]

"session": {

"userRole": "Guest",

"lang": "en",

"hintDisplayPassword": "",

"secToken": "oEO6wjnuQWBQJmtAcrVCj8forV1MtnW",

"clientIP": "192.168.1.44",

"supportedLangList": [

{

"id": "en",

"isCurrent": true,

"label": "English"

},

[...snip...]
```

Now, we can’t simply embed this JSON object in JavaScript on a 3rd party page and read it back. Pure JSON’s not allowed. If it were JSONP, that would be different. JSONP wraps a JSON object in a function call, so you can embed it and access it like a normal script. Browsers allow that.

### You know what browsers also allow? Plain old JavaScript

Turns out the file at /js/NetgearStrings.js is also dynamically-generated. And contains this nice netgearLoadData variable at the top.

![](https://www.pentestpartners.com/content/plugins/lazy-load/images/1x1.trans.gif)![](https://www.pentestpartners.com/content/uploads/2017/08/CSRKM1-2.png)

Which happens to contain the session.secToken value as well.

### Conclusion

It’s not big, it’s not clever. But it’s definitely the easiest CSRF bypass I’ve seen. A bit like leaving the key under the mat. Or, just totally misunderstanding the reasoning for having a key for the house, and not locking the door.

I’m also not entirely sure how TODO code gets left on production devices by major US manufacturers. grep is a very easy tool to use.

This issue has been assigned CVE-2019-14526. A post-authentication command injection issue we found has also been assigned CVE-2019-14527.

### Share

### Categories

Show all
Android  (71)
Automotive Security  (24)
Aviation Cyber Security  (44)
Blockchain  (3)
Breach Handling  (1)
Careers At PTP  (1)
Cloud Security  (5)
Code Repository  (1)
Consultancy advice  (5)
Consumer Advice  (35)
Cyber Essentials  (1)
Cyber Liability Insurance  (5)
DFIR  (29)
Hardware Hacking  (19)
Heartbleed  (5)
Honeypots  (6)
How-Tos  (264)
In the news  (1)
Internet Of Things  (169)
Macs / Apple  (31)
Maritime Cyber Security  (47)
Medical Device Security  (3)
Opinions  (107)
OPSEC  (9)
OT, ICS, IIoT, SCADA  (22)
Passwords  (39)
PCI Advice  (2)
Ransomware  (2)
Red Teaming  (26)
Reverse Engineering  (12)
Security Blog  (808)
Shameless Self Promotion  (11)
Show on homepage  (6)
Social Engineering  (12)
Sustainability  (2)
Virtual Environments  (1)
Vulnerabilities that aren’t  (4)
Vulnerability Advisory  (45)
Vulnerability Disclosure  (20)

[# See the other cool stuff we've been doing…](/blog/)

[Consumer Advice

# Security flaws found in tiny phones promoted to children

15 Jan 2025](https://www.pentestpartners.com/security-blog/security-flaws-found-in-tiny-phones-promoted-to-children/)

[DFIR

# Tackling AI threats. Advanced DFIR methods and tools for deepfake detection

13 Jan 2025](https://www.pentestpartners.com/security-blog/tackling-ai-threats-advanced-dfir-methods-and-tools-for-deepfake-detection/)

[Aviation Cyber Security

# The unexpected effects of GPS spoofing on aviation safety

09 Jan 2025](https://www.pentestpartners.com/security-blog/the-unexpected-effects-of-gps-spoofing-on-aviation-safety/)

[DFIR

# 10 Non-tech things you wish you had done after being breached

07 Jan 2025](https://www.pentestpartners.com/security-blog/10-non-tech-things-you-wish-you-had-done-after-being-breached/)

[Aviation Cyber Security

# The surprising existence of the erase button on cockpit voice recorders

03 Jan 2025](https://www.pentestpartners.com/security-blog/the-surprising-existence-of-the-erase-button-on-cockpit-voice-recorders/)

[Services

### Automotive & IoT Testing

Find out more »](https://www.pentestpartners.com/penetration-testing-services/automotive-and-iot-testing/)

### Our People

Being introduced to, and getting to know your tester is an often overlooked part of the process. Yes, our work is über technical, but faceless relationships do nobody any good.

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/ic-alert.svg)](https://www.pentestpartners.com/penetration-testing-services/suffered-a-security-breach/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/ic-mobile-security.svg)
## Mobile Security](https://www.pentestpartners.com/penetration-testing-services/mobile-security/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/ic-social-engineering-grey.svg)
## Social Engineering](https://www.pentestpartners.com/penetration-testing-services/social-engineering/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/ic-webapp.svg)
## Web application testing](https://www.pentestpartners.com/penetration-testing-services/web-application-testing/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/ic-data-compliance-grey.svg)
## Security Consuting](https://www.pentestpartners.com/penetration-testing-services/security-consulting/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/ic-papa-grey.svg)
## Papa - PTP Advance Password Auditor](https://www.pentestpartners.com/penetration-testing-services/papa/)

### Get in touch

**UK Office:**

Pen Test Partners LLP

Unit 2, Verney Junction Business Park

Buckingham

MK18 2LB

United Kingdom

+44 20 3095 0500
[Contact Us »](/contact-us/)

###

**US Office:**

+1 646 693 2501
[[email protected]](/cdn-cgi/l/email-protection#b8d1d6ded7f8c8ddd6ccddcbccc8d9caccd6ddcacb96dbd7d5)

### Connect

[Twitter](https://twitter.com/PentestPartners)
[LinkedIn](https://www.linkedin.com/company/pen-test-partners)
[YouTube](https://www.youtube.com/channel/UC2HCAhj6JiOsV_PcMFrjykw)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/crest-logo-22.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/crest-pentest-logo-22.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/crest-star-logo-22.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/crest-star-fs-logo-22.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/csir-logo-22.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/crest-ovs-logo-22.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![logo-cbest](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/logo-cbest.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/logo-check-ncsc.png)](https://www.ncsc.gov.uk/organisations/pen-test-partners)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/crest-assure.png)](https://www.crest-approved.org/member_companies/pen-test-partners/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/logo-cyber-essentials2023.png)](https://iasme.co.uk/cyber-essentials/)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/bsi-iso27001-logo-22.png)](/content/uploads/2023/12/PTP-ISO27001-Certificate-2023.pdf)

[![](https://www.pentestpartners.com/content/themes/pentestpartners2019/dist/images/logo-pci-certified.png)](https://www.pcisecuritystandards.org/assessors_and_solutions/qualified_security_assessors)

[Privacy Policy](/privacy-policy/)

[Terms of Service](/terms-of-website-use/)

Manage Cookies

Company number: OC353362

VAT reg number: GB825526427

© 2025 Pen Test Partners


