=== Content from bugzilla.nasm.us_337db1e5_20250121_010125.html ===


Bugzilla – Bug 3392576
asm/pragma.c: NULL-ptr dereference in limit pragma parser
Last modified: 2019-08-16 01:14:19 PDT

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](docs/en/html/using/understanding.html)
* |
  [Log In](show_bug.cgi?id=3392576&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=3392576&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

Self-registration is disabled due to spam issue (mail gorcunov@gmail.com or hpa@zytor.com to create an account)

[**Bug 3392576**](show_bug.cgi?id=3392576)
- asm/pragma.c: NULL-ptr dereference in limit pragma parser

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
asm/pragma.c: NULL-ptr dereference in limit pragma parser

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | NASM | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=NASM "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Assembler ([show other bugs](buglist.cgi?component=Assembler&product=NASM&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.14.xx | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | Medium normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | nobody | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2019-06-18 18:16 PDT by Ren Kimura | | --- | --- | | Modified: | 2019-08-16 01:14 PDT ([History](show_activity.cgi?id=3392576)) | | CC List: | 5 users (show)  chang.seok.bae gorcunov hpa nasm-bugs ppadmana | |  | | | [Obtained from:](page.cgi?id=fields.html#cf_build "Please indicate where you obtained and/or built your version of NASM.") | Built from git using configure | | [Generated by:](page.cgi?id=fields.html#cf_robot "Was this bug report generated by an automatic tool, such as a memory leak detector or fuzzer, *without* including a human validation description or analysis of the problem?") | --- | | [Bug category:](page.cgi?id=fields.html#cf_category "The general category of this bug oor request.") |  | | [Breaks existing code:](page.cgi?id=fields.html#cf_breaks "This bug report breaks existing code in production or under development.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**Proof of Concept ASM file**](attachment.cgi?id=411720 "View the content of the attachment") (14 bytes, text/x-matlab)  [2019-06-18 18:16 PDT](#attach_411720 "Go to the comment associated with the attachment"), Ren Kimura | [Details](attachment.cgi?id=411720&action=edit) | | [Add an attachment](attachment.cgi?bugid=3392576&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=3392576&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=3392576#c0)  Ren Kimura    2019-06-18 18:16:48 PDT  ``` Created [attachment 411720](attachment.cgi?id=411720 "Proof of Concept ASM file") [[details]](attachment.cgi?id=411720&action=edit "Proof of Concept ASM file") Proof of Concept ASM file  If "%pragma limit" doesn't follow any words, asm parser reaches end of file  and nasm_get_word() returns NULL.  However process_pragma() still try to continue parse parameters of limit pragma,  that is intended to be located at next word.  As a result nasm_set_limit() is called with NULL pointer, cause NULL-ptr dereference.  ./nasm-2.14.02/nasm -felf64 ~/nullderef_nasm-2.14.02_pragma_limit Segmentation fault (core dumped)  (gdb) bt #0  __strcasecmp_l_avx () at ../sysdeps/x86_64/multiarch/strcmp-sse42.S:199 #1  0x000000000040268d in nasm_set_limit (limit=0x0, valstr=0x0) at asm/nasm.c:199 #2  0x0000000000442fd4 in search_pragma_list (list=<optimized out>, default_name=0x0, generic_handler=0x0,      pragma=0x7fffffffe0a0) at asm/pragma.c:137 #3  0x0000000000442b83 in process_pragma (str=<optimized out>) at asm/pragma.c:218 #4  0x000000000043f22d in process_directives (directive=0x7a4021 "pragma") at asm/directiv.c:503 #5  0x0000000000407eaa in assemble_file (fname=<optimized out>, depend_ptr=<optimized out>) at asm/nasm.c:1498 #6  main (argc=<optimized out>, argv=<optimized out>) at asm/nasm.c:617 (gdb) up #1  0x000000000040268d in nasm_set_limit (limit=0x0, valstr=0x0) at asm/nasm.c:199 199             if (!nasm_stricmp(limit, limit_info[i].name)) (gdb) p/x limit $1 = 0x0  Thanks Ren ```  [Comment 1](show_bug.cgi?id=3392576#c1)  Purushothama    2019-08-07 23:01:18 PDT  ``` I would like to know whether if this issue affects only version 2.14.xx? I use version 2.13.03. ```  [Comment 2](show_bug.cgi?id=3392576#c2)  Purushothama    2019-08-12 00:18:33 PDT  ``` (In reply to Ren Kimura from [comment #0](show_bug.cgi?id=3392576#c0)) > Created [attachment 411720](attachment.cgi?id=411720 "Proof of Concept ASM file") [[details]](attachment.cgi?id=411720&action=edit "Proof of Concept ASM file") > Proof of Concept ASM file >  > If "%pragma limit" doesn't follow any words, asm parser reaches end of file  > and nasm_get_word() returns NULL. >  > However process_pragma() still try to continue parse parameters of limit > pragma,  > that is intended to be located at next word. >  > As a result nasm_set_limit() is called with NULL pointer, cause NULL-ptr > dereference. >  > ./nasm-2.14.02/nasm -felf64 ~/nullderef_nasm-2.14.02_pragma_limit > Segmentation fault (core dumped) >  > (gdb) bt > #0  __strcasecmp_l_avx () at ../sysdeps/x86_64/multiarch/strcmp-sse42.S:199 > #1  0x000000000040268d in nasm_set_limit (limit=0x0, valstr=0x0) at > asm/nasm.c:199 > #2  0x0000000000442fd4 in search_pragma_list (list=<optimized out>, > default_name=0x0, generic_handler=0x0,  >     pragma=0x7fffffffe0a0) at asm/pragma.c:137 > #3  0x0000000000442b83 in process_pragma (str=<optimized out>) at > asm/pragma.c:218 > #4  0x000000000043f22d in process_directives (directive=0x7a4021 "pragma") > at asm/directiv.c:503 > #5  0x0000000000407eaa in assemble_file (fname=<optimized out>, > depend_ptr=<optimized out>) at asm/nasm.c:1498 > #6  main (argc=<optimized out>, argv=<optimized out>) at asm/nasm.c:617 > (gdb) up > #1  0x000000000040268d in nasm_set_limit (limit=0x0, valstr=0x0) at > asm/nasm.c:199 > 199             if (!nasm_stricmp(limit, limit_info[i].name)) > (gdb) p/x limit > $1 = 0x0 >  > Thanks > Ren  Hi Ren, Will this issue affect 2.13.03 ? ```  [Comment 3](show_bug.cgi?id=3392576#c3)  H. Peter Anvin    2019-08-16 01:14:19 PDT  ``` Fix checked into the master branch. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=3392576)
* - [XML](show_bug.cgi?ctype=xml&id=3392576)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=3392576)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [Log In](show_bug.cgi?id=3392576&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=3392576&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


