=== Content from github.com_46aad819_20250120_232127.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fissues%2F10739)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRIOT-OS%2FRIOT%2Fissues%2F10739)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=RIOT-OS%2FRIOT)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[RIOT-OS](/RIOT-OS)
/
**[RIOT](/RIOT-OS/RIOT)**
Public

* [Notifications](/login?return_to=%2FRIOT-OS%2FRIOT) You must be signed in to change notification settings
* [Fork
  2k](/login?return_to=%2FRIOT-OS%2FRIOT)
* [Star
   5.4k](/login?return_to=%2FRIOT-OS%2FRIOT)

* [Code](/RIOT-OS/RIOT)
* [Issues
  382](/RIOT-OS/RIOT/issues)
* [Pull requests
  393](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects
  0](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

Additional navigation options

* [Code](/RIOT-OS/RIOT)
* [Issues](/RIOT-OS/RIOT/issues)
* [Pull requests](/RIOT-OS/RIOT/pulls)
* [Actions](/RIOT-OS/RIOT/actions)
* [Projects](/RIOT-OS/RIOT/projects)
* [Wiki](/RIOT-OS/RIOT/wiki)
* [Security](/RIOT-OS/RIOT/security)
* [Insights](/RIOT-OS/RIOT/pulse)

# sock\_dns: Security issues (including remote code execution) #10739

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#10740](https://github.com/RIOT-OS/RIOT/pull/10740)Closed[sock\_dns: Security issues (including remote code execution)](#top)#10739[#10740](https://github.com/RIOT-OS/RIOT/pull/10740)Copy linkAssignees [![miri64](https://avatars.githubusercontent.com/u/675644?s=64&u=ddc0fa64e6b79aeadc94b7061bef6e052be4d8c7&v=4)](/miri64)[![kaspar030](https://avatars.githubusercontent.com/u/4679640?s=64&v=4)](/kaspar030)Labels[Area: networkArea: Networking](https://github.com/RIOT-OS/RIOT/issues?q=state%3Aopen%20label%3A%22Area%3A%20network%22)Area: Networking[Impact: majorThe PR changes a significant part of the code base. It should be reviewed carefully](https://github.com/RIOT-OS/RIOT/issues?q=state%3Aopen%20label%3A%22Impact%3A%20major%22)The PR changes a significant part of the code base. It should be reviewed carefully[Type: bugThe issue reports a bug / The PR fixes a bug (including spelling errors)](https://github.com/RIOT-OS/RIOT/issues?q=state%3Aopen%20label%3A%22Type%3A%20bug%22)The issue reports a bug / The PR fixes a bug (including spelling errors)Milestone[Release 2019.01](https://github.com/RIOT-OS/RIOT/milestone/25)![@nmeum](https://avatars.githubusercontent.com/u/2326560?u=ae33fc546193fdf0b7a25ae12df675e067e9882f&v=4&size=80)
## Description

![@nmeum](https://avatars.githubusercontent.com/u/2326560?u=ae33fc546193fdf0b7a25ae12df675e067e9882f&v=4&size=48)[nmeum](https://github.com/nmeum)opened [on Jan 9, 2019](https://github.com/RIOT-OS/RIOT/issues/10739#issue-397443273)
## Description

`gnrc_sock_dns` doesn't perform sufficient sanity checks on the DNS response it receives from the configured DNS server.

Here is a non-exhaustive list of issues:

1. The `QDCOUNT` contained in the DNS response is not verified. This causes an out-of-bounds buffer access in the `_skip_hostname` function if `QDCOUNT` is set to a value larger than the buf `len` supplied to `_parse_dns_reply`.
2. The `RDLENGTH` bounds-check for the answer section is incorrect for two reasons: (a) `buf + len` is the first invalid address, so `>=` needs to be used as a comparison operator (b) The result of `bufpos + addrlen` might cause a pointer overflow (especially due to the fact that `addrlen` is attacker controlled). If pointer overflows wrap around (undefined behaviour) this would allow an attacker to circumvent the bounds-check and exposes a buffer overflow vulnerability since the attacker controlled `addrlen` is later used in `memcpy(addr_out, bufpos, addrlen)`, potentially allowing a code execution.
3. The size of the caller allocated buffer `addr_out` is not passed to the `_parse_dns_reply` function at all. This makes checking whether the attacker controlled address actually fits in the buffer impossible and allows an easy buffer overflow and potential code execution.

All of these are especially critical due to the fact that DNS responses can easily be spoofed, especially since all spoofing protection mechanisms of DNS were not implemented. So an attacker doesn't even need to control the configured DNS server in order to exploit this.

## Steps to reproduce the issue

1. Flash an unmodified version of `tests/gnrc_sock_dns` to your RIOT node.
2. Adjust your radvd.conf on your border router and add a RDNSS definition.

### Causing a crash

Constantly send a DNS response with an excessive qdcount on the computer associated with the IP-Address you configured in the radvd RDNSS definition. For example

```
while sleep 1; do
    echo AACEAwkmAAAAAAAAKioqKioqKioqKioqKioqKioqKio= | \
        base64 -d | \
        socat fd:0 udp6-sendto:'[address-of-riot-node]':49152,sourceport=53
done
```
### Remote code execution

This is (obviously) highly platform specific. We did this with `BOARD=pba-d-01-kw2x`. We wrote some ARM assembler code which toggles the LED and stored the machine code for it in the `RDATA` field of the answer section in the DNS response, thereby overflowing the `addr` buffer in the `main` stack frame. Our payload exactly fits into the stack frame of the main function and overwrites the return address of that function, jumping to the `addr` buffer and executing our payload.

Exploit written by [@pyropeter](https://github.com/pyropeter). See: <https://github.com/beduino-project/exploit-riot-dns>

## Versions

RIOT-Version: [5e03f58](https://github.com/RIOT-OS/RIOT/commit/5e03f58746633404393413eb674c938b5e31c144)

Build environment:

```
Operating System Environment
-----------------------------
       Operating System: "Arch Linux"
                 Kernel: Linux 4.19.4-arch1-1-ARCH x86_64 unknown

Installed compiler toolchains
-----------------------------
             native gcc: gcc (GCC) 8.2.1 20181127
      arm-none-eabi-gcc: arm-none-eabi-gcc (Arch Repository) 8.2.0
                avr-gcc: avr-gcc (GCC) 8.2.0
       mips-mti-elf-gcc: missing
             msp430-gcc: missing
   riscv-none-embed-gcc: missing
                  clang: clang version 7.0.0 (tags/RELEASE_700/final)

Installed compiler libs
-----------------------
   arm-none-eabi-newlib: "3.0.0"
    mips-mti-elf-newlib: missing
riscv-none-embed-newlib: missing
               avr-libc: "2.0.0" ("20150208")

Installed development tools
---------------------------
                  cmake: cmake version 3.13.1
               cppcheck: missing
                doxygen: 1.8.14
                 flake8: missing
                    git: git version 2.19.2
                   make: GNU Make 4.2.1
                openocd: Open On-Chip Debugger 0.10.0+dev-00436-g0fdf48f1 (2018-06-18-18:19)
                 python: Python 3.7.1
                python2: Python 2.7.15
                python3: Python 3.7.1
             coccinelle: missing

```
❤️2
## Metadata

### Assignees

* [![@kaspar030](https://avatars.githubusercontent.com/u/4679640?s=64&v=4)kaspar030](/kaspar030)
* [![@miri64](https://avatars.githubusercontent.com/u/675644?s=64&u=ddc0fa64e6b79aeadc94b7061bef6e052be4d8c7&v=4)miri64](/miri64)
### Labels

[Area: networkArea: Networking](https://github.com/RIOT-OS/RIOT/issues?q=state%3Aopen%20label%3A%22Area%3A%20network%22)Area: Networking[Impact: majorThe PR changes a significant part of the code base. It should be reviewed carefully](https://github.com/RIOT-OS/RIOT/issues?q=state%3Aopen%20label%3A%22Impact%3A%20major%22)The PR changes a significant part of the code base. It should be reviewed carefully[Type: bugThe issue reports a bug / The PR fixes a bug (including spelling errors)](https://github.com/RIOT-OS/RIOT/issues?q=state%3Aopen%20label%3A%22Type%3A%20bug%22)The issue reports a bug / The PR fixes a bug (including spelling errors)
### Type

No type
### Projects

No projects
### Milestone

* [Release 2019.01](https://github.com/RIOT-OS/RIOT/milestone/25)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


