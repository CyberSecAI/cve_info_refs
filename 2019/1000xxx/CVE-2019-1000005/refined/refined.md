- **Root cause of vulnerability:** The `getImage()` method in the `ImageProcessor` class of the mPDF library passes the value of the `src` attribute of an `<img>` tag to the `fopen()` function without proper sanitization. This allows an attacker to use the `phar://` wrapper to trigger PHP deserialization.
- **Weaknesses/vulnerabilities present:** Insecure deserialization vulnerability, specifically through the use of the `phar://` stream wrapper. This bypasses the intended file access mechanism and allows for arbitrary code execution by leveraging the deserialization process.
- **Impact of exploitation:** An attacker can achieve arbitrary code execution by crafting a malicious image file containing serialized PHP objects within a PHAR archive. When the `fopen()` function is called with a `phar://` URL pointing to this archive, PHP will deserialize the objects, triggering the `__destruct()` method of a malicious class, leading to code execution.
- **Attack vectors:** The attacker needs to inject a crafted HTML document containing an `<img>` tag with a `src` attribute that uses the `phar://` wrapper, pointing to a malicious PHAR archive. This malicious HTML could be provided through user input that is not properly sanitized by the application using the vulnerable library.
- **Required attacker capabilities/position:** The attacker needs to control the input to the `WriteHTML()` function of the mPDF library, which is typically user-controlled in web applications. They also need to have access to create/host a malicious PHAR archive.