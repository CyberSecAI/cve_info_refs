=== Content from patchwork.kernel.org_18166ea7_20250120_232133.html ===

Toggle navigation

[Patchwork](/)
Linux FS Development

* [Patches](/project/linux-fsdevel/list/)
* [Bundles](/project/linux-fsdevel/bundles/)
* [About this project](/project/linux-fsdevel/)

* [Login](/user/login/)
* [Register](/register/)
* [Mail settings](/mail/)

10828359

[diff](/project/linux-fsdevel/patch/20190225090332.88640-1-houtao1%40huawei.com/raw/ "Download patch diff")
[mbox](/project/linux-fsdevel/patch/20190225090332.88640-1-houtao1%40huawei.com/mbox/ "Download patch mbox")
[series](/series/84563/mbox/ "Download patch mbox with dependencies")
# aio: take an extra file reference before call vfs\_poll()

| Message ID | 20190225090332.88640-1-houtao1@huawei.com ([mailing list archive](https://lore.kernel.org/r/20190225090332.88640-1-houtao1%40huawei.com)) |
| --- | --- |
| State | New, archived |
| Headers | show ``` Return-Path: <linux-fsdevel-owner@kernel.org> Received: from mail.wl.linuxfoundation.org (pdx-wl-mail.web.codeaurora.org  [172.30.200.125]) 	by pdx-korg-patchwork-2.web.codeaurora.org (Postfix) with ESMTP id D26521399 	for <patchwork-linux-fsdevel@patchwork.kernel.org>;  Mon, 25 Feb 2019 08:59:22 +0000 (UTC) Received: from mail.wl.linuxfoundation.org (localhost [127.0.0.1]) 	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id C1D5229F97 	for <patchwork-linux-fsdevel@patchwork.kernel.org>;  Mon, 25 Feb 2019 08:59:22 +0000 (UTC) Received: by mail.wl.linuxfoundation.org (Postfix, from userid 486) 	id B535729FA7; Mon, 25 Feb 2019 08:59:22 +0000 (UTC) X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on 	pdx-wl-mail.web.codeaurora.org X-Spam-Level:  X-Spam-Status: No, score=-7.9 required=2.0 tests=BAYES_00,MAILING_LIST_MULTI, 	RCVD_IN_DNSWL_HI autolearn=ham version=3.3.1 Received: from vger.kernel.org (vger.kernel.org [209.132.180.67]) 	by mail.wl.linuxfoundation.org (Postfix) with ESMTP id 660D329F97 	for <patchwork-linux-fsdevel@patchwork.kernel.org>;  Mon, 25 Feb 2019 08:59:21 +0000 (UTC) Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand         id S1726417AbfBYI7U (ORCPT         <rfc822;patchwork-linux-fsdevel@patchwork.kernel.org>);         Mon, 25 Feb 2019 03:59:20 -0500 Received: from szxga07-in.huawei.com ([45.249.212.35]:32916 "EHLO huawei.com"         rhost-flags-OK-OK-OK-FAIL) by vger.kernel.org with ESMTP         id S1725863AbfBYI7U (ORCPT <rfc822;linux-fsdevel@vger.kernel.org>);         Mon, 25 Feb 2019 03:59:20 -0500 Received: from DGGEMS408-HUB.china.huawei.com (unknown [172.30.72.58])         by Forcepoint Email with ESMTP id 0317D85C2ED8357D4B6C;         Mon, 25 Feb 2019 16:59:18 +0800 (CST) Received: from huawei.com (10.90.53.225) by DGGEMS408-HUB.china.huawei.com  (10.3.19.208) with Microsoft SMTP Server id 14.3.408.0; Mon, 25 Feb 2019  16:59:13 +0800 From: Hou Tao <houtao1@huawei.com> To: <linux-fsdevel@vger.kernel.org>, <linux-aio@kvack.org>,         Christoph Hellwig <hch@lst.de> CC: Alexander Viro <viro@zeniv.linux.org.uk>,         Benjamin LaHaise <bcrl@kvack.org> Subject: [PATCH] aio: take an extra file reference before call vfs_poll() Date: Mon, 25 Feb 2019 17:03:32 +0800 Message-ID: <20190225090332.88640-1-houtao1@huawei.com> X-Mailer: git-send-email 2.16.2.dirty MIME-Version: 1.0 Content-Type: text/plain X-Originating-IP: [10.90.53.225] X-CFilter-Loop: Reflected Sender: linux-fsdevel-owner@vger.kernel.org Precedence: bulk List-ID: <linux-fsdevel.vger.kernel.org> X-Mailing-List: linux-fsdevel@vger.kernel.org X-Virus-Scanned: ClamAV using ClamSMTP ``` |
| Series | [aio: take an extra file reference before call vfs\_poll()](/project/linux-fsdevel/list/?series=84563) | expand   * aio: take an extra file reference before call vfs\_poll() |

## Commit Message

[Hou Tao](/project/linux-fsdevel/list/?submitter=168965)
Feb. 25, 2019, 9:03 a.m. UTC
```

Taking an extra file reference before call vfs_poll(), else
the file may be released by aio_poll_wake() if an expected
event is triggered immediately (e.g., by the close of a
pair of pipes) after the return of vfs_poll(), and we may
hit a use-after-free splat as shown below:

 BUG: KASAN: use-after-free in perf_trace_lock_acquire+0x3ab/0x570
 Read of size 8 at addr ffff888379bfd4b0 by task syz-executor.1/4953

 CPU: 0 PID: 4953 Comm: syz-executor.1 Not tainted 4.19.24
 Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1
 Call Trace:
  __dump_stack lib/dump_stack.c:77 [inline]
  dump_stack+0xca/0x13e lib/dump_stack.c:113
  print_address_description+0x79/0x330 mm/kasan/report.c:256
  kasan_report_error mm/kasan/report.c:354 [inline]
  kasan_report+0x18a/0x2e0 mm/kasan/report.c:412
  trace_event_get_offsets_lock_acquire include/trace/events/lock.h:13 [inline]
  perf_trace_lock_acquire+0x3ab/0x570 include/trace/events/lock.h:13
  trace_lock_acquire include/trace/events/lock.h:13 [inline]
  lock_acquire+0x202/0x310 kernel/locking/lockdep.c:3899
  __raw_spin_lock include/linux/spinlock_api_smp.h:142 [inline]
  _raw_spin_lock+0x2c/0x40 kernel/locking/spinlock.c:144
  spin_lock include/linux/spinlock.h:329 [inline]
  aio_poll fs/aio.c:1750 [inline]
  io_submit_one+0xb90/0x1b30 fs/aio.c:1853
  __do_sys_io_submit fs/aio.c:1919 [inline]
  __se_sys_io_submit fs/aio.c:1890 [inline]
  __x64_sys_io_submit+0x19b/0x500 fs/aio.c:1890
  do_syscall_64+0xc8/0x580 arch/x86/entry/common.c:290
  entry_SYSCALL_64_after_hwframe+0x49/0xbe
  ......
  Allocated by task 4953:
  set_track mm/kasan/kasan.c:460 [inline]
  kasan_kmalloc+0xa0/0xd0 mm/kasan/kasan.c:553
  kmem_cache_alloc_trace+0x12f/0x2d0 mm/slub.c:2733
  kmalloc include/linux/slab.h:513 [inline]
  kzalloc include/linux/slab.h:707 [inline]
  alloc_pipe_info+0xdf/0x410 fs/pipe.c:633
  get_pipe_inode fs/pipe.c:712 [inline]
  create_pipe_files+0x98/0x780 fs/pipe.c:744
  __do_pipe_flags+0x35/0x230 fs/pipe.c:781
  do_pipe2+0x87/0x150 fs/pipe.c:829
  __do_sys_pipe2 fs/pipe.c:847 [inline]
  __se_sys_pipe2 fs/pipe.c:845 [inline]
  __x64_sys_pipe2+0x55/0x80 fs/pipe.c:845
  do_syscall_64+0xc8/0x580 arch/x86/entry/common.c:290
  entry_SYSCALL_64_after_hwframe+0x49/0xbe

 Freed by task 4952:
  set_track mm/kasan/kasan.c:460 [inline]
  __kasan_slab_free+0x12e/0x180 mm/kasan/kasan.c:521
  slab_free_hook mm/slub.c:1371 [inline]
  slab_free_freelist_hook mm/slub.c:1398 [inline]
  slab_free mm/slub.c:2953 [inline]
  kfree+0xeb/0x2f0 mm/slub.c:3906
  put_pipe_info+0xb0/0xd0 fs/pipe.c:556
  pipe_release+0x1ab/0x240 fs/pipe.c:577
  __fput+0x27f/0x7f0 fs/file_table.c:278
  task_work_run+0x136/0x1b0 kernel/task_work.c:113
  tracehook_notify_resume include/linux/tracehook.h:193 [inline]
  exit_to_usermode_loop+0x1a7/0x1d0 arch/x86/entry/common.c:166
  prepare_exit_to_usermode arch/x86/entry/common.c:197 [inline]
  syscall_return_slowpath arch/x86/entry/common.c:268 [inline]
  do_syscall_64+0x461/0x580 arch/x86/entry/common.c:293
  entry_SYSCALL_64_after_hwframe+0x49/0xbe

Fixes: bfe4037e722e ("aio: implement IOCB_CMD_POLL")
Cc: stable@vger.kernel.org [4.19+]
Signed-off-by: Hou Tao <houtao1@huawei.com>
---
 fs/aio.c | 8 ++++++++
 1 file changed, 8 insertions(+)

```
## Comments

[Hou Tao](/project/linux-fsdevel/list/?submitter=168965)
March 1, 2019, 10:09 a.m. UTC | [#1](/comment/22508757/)
```

ping ?

On 2019/2/25 17:03, Hou Tao wrote:
> Taking an extra file reference before call vfs_poll(), else
> the file may be released by aio_poll_wake() if an expected
> event is triggered immediately (e.g., by the close of a
> pair of pipes) after the return of vfs_poll(), and we may
> hit a use-after-free splat as shown below:
>
>  BUG: KASAN: use-after-free in perf_trace_lock_acquire+0x3ab/0x570
>  Read of size 8 at addr ffff888379bfd4b0 by task syz-executor.1/4953
>
>  CPU: 0 PID: 4953 Comm: syz-executor.1 Not tainted 4.19.24
>  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1
>  Call Trace:
>   __dump_stack lib/dump_stack.c:77 [inline]
>   dump_stack+0xca/0x13e lib/dump_stack.c:113
>   print_address_description+0x79/0x330 mm/kasan/report.c:256
>   kasan_report_error mm/kasan/report.c:354 [inline]
>   kasan_report+0x18a/0x2e0 mm/kasan/report.c:412
>   trace_event_get_offsets_lock_acquire include/trace/events/lock.h:13 [inline]
>   perf_trace_lock_acquire+0x3ab/0x570 include/trace/events/lock.h:13
>   trace_lock_acquire include/trace/events/lock.h:13 [inline]
>   lock_acquire+0x202/0x310 kernel/locking/lockdep.c:3899
>   __raw_spin_lock include/linux/spinlock_api_smp.h:142 [inline]
>   _raw_spin_lock+0x2c/0x40 kernel/locking/spinlock.c:144
>   spin_lock include/linux/spinlock.h:329 [inline]
>   aio_poll fs/aio.c:1750 [inline]
>   io_submit_one+0xb90/0x1b30 fs/aio.c:1853
>   __do_sys_io_submit fs/aio.c:1919 [inline]
>   __se_sys_io_submit fs/aio.c:1890 [inline]
>   __x64_sys_io_submit+0x19b/0x500 fs/aio.c:1890
>   do_syscall_64+0xc8/0x580 arch/x86/entry/common.c:290
>   entry_SYSCALL_64_after_hwframe+0x49/0xbe
>   ......
>   Allocated by task 4953:
>   set_track mm/kasan/kasan.c:460 [inline]
>   kasan_kmalloc+0xa0/0xd0 mm/kasan/kasan.c:553
>   kmem_cache_alloc_trace+0x12f/0x2d0 mm/slub.c:2733
>   kmalloc include/linux/slab.h:513 [inline]
>   kzalloc include/linux/slab.h:707 [inline]
>   alloc_pipe_info+0xdf/0x410 fs/pipe.c:633
>   get_pipe_inode fs/pipe.c:712 [inline]
>   create_pipe_files+0x98/0x780 fs/pipe.c:744
>   __do_pipe_flags+0x35/0x230 fs/pipe.c:781
>   do_pipe2+0x87/0x150 fs/pipe.c:829
>   __do_sys_pipe2 fs/pipe.c:847 [inline]
>   __se_sys_pipe2 fs/pipe.c:845 [inline]
>   __x64_sys_pipe2+0x55/0x80 fs/pipe.c:845
>   do_syscall_64+0xc8/0x580 arch/x86/entry/common.c:290
>   entry_SYSCALL_64_after_hwframe+0x49/0xbe
>
>  Freed by task 4952:
>   set_track mm/kasan/kasan.c:460 [inline]
>   __kasan_slab_free+0x12e/0x180 mm/kasan/kasan.c:521
>   slab_free_hook mm/slub.c:1371 [inline]
>   slab_free_freelist_hook mm/slub.c:1398 [inline]
>   slab_free mm/slub.c:2953 [inline]
>   kfree+0xeb/0x2f0 mm/slub.c:3906
>   put_pipe_info+0xb0/0xd0 fs/pipe.c:556
>   pipe_release+0x1ab/0x240 fs/pipe.c:577
>   __fput+0x27f/0x7f0 fs/file_table.c:278
>   task_work_run+0x136/0x1b0 kernel/task_work.c:113
>   tracehook_notify_resume include/linux/tracehook.h:193 [inline]
>   exit_to_usermode_loop+0x1a7/0x1d0 arch/x86/entry/common.c:166
>   prepare_exit_to_usermode arch/x86/entry/common.c:197 [inline]
>   syscall_return_slowpath arch/x86/entry/common.c:268 [inline]
>   do_syscall_64+0x461/0x580 arch/x86/entry/common.c:293
>   entry_SYSCALL_64_after_hwframe+0x49/0xbe
>
> Fixes: bfe4037e722e ("aio: implement IOCB_CMD_POLL")
> Cc: stable@vger.kernel.org [4.19+]
> Signed-off-by: Hou Tao <houtao1@huawei.com>
> ---
>  fs/aio.c | 8 ++++++++
>  1 file changed, 8 insertions(+)
>
> diff --git a/fs/aio.c b/fs/aio.c
> index aaaaf4d12c73..ea2f5de4feac 100644
> --- a/fs/aio.c
> +++ b/fs/aio.c
> @@ -1763,6 +1763,12 @@ static ssize_t aio_poll(struct aio_kiocb *aiocb, const struct iocb *iocb)
>  	/* one for removal from waitqueue, one for this function */
>  	refcount_set(&aiocb->ki_refcnt, 2);
>
> +	/*
> +	 * file may be released by aio_poll_wake() if an expected event
> +	 * is triggered immediately after the return of vfs_poll(), so
> +	 * an extra reference is needed here to prevent use-after-free.
> +	 */
> +	get_file(req->file);
>  	mask = vfs_poll(req->file, &apt.pt) & req->events;
>  	if (unlikely(!req->head)) {
>  		/* we did not manage to set up a waitqueue, done */
> @@ -1788,6 +1794,8 @@ static ssize_t aio_poll(struct aio_kiocb *aiocb, const struct iocb *iocb)
>  	spin_unlock_irq(&ctx->ctx_lock);
>
>  out:
> +	/* release the extra reference for vfs_poll() */
> +	fput(req->file);
>  	if (unlikely(apt.error)) {
>  		fput(req->file);
>  		return apt.error;
>

```

[Hou Tao](/project/linux-fsdevel/list/?submitter=168965)
March 5, 2019, 1:17 a.m. UTC | [#2](/comment/22513565/)
```

ping ?

On 2019/3/1 18:09, Hou Tao wrote:
> ping ?
>
> On 2019/2/25 17:03, Hou Tao wrote:
>> Taking an extra file reference before call vfs_poll(), else
>> the file may be released by aio_poll_wake() if an expected
>> event is triggered immediately (e.g., by the close of a
>> pair of pipes) after the return of vfs_poll(), and we may
>> hit a use-after-free splat as shown below:
>>
>>  BUG: KASAN: use-after-free in perf_trace_lock_acquire+0x3ab/0x570
>>  Read of size 8 at addr ffff888379bfd4b0 by task syz-executor.1/4953
>>
>>  CPU: 0 PID: 4953 Comm: syz-executor.1 Not tainted 4.19.24
>>  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1
>>  Call Trace:
>>   __dump_stack lib/dump_stack.c:77 [inline]
>>   dump_stack+0xca/0x13e lib/dump_stack.c:113
>>   print_address_description+0x79/0x330 mm/kasan/report.c:256
>>   kasan_report_error mm/kasan/report.c:354 [inline]
>>   kasan_report+0x18a/0x2e0 mm/kasan/report.c:412
>>   trace_event_get_offsets_lock_acquire include/trace/events/lock.h:13 [inline]
>>   perf_trace_lock_acquire+0x3ab/0x570 include/trace/events/lock.h:13
>>   trace_lock_acquire include/trace/events/lock.h:13 [inline]
>>   lock_acquire+0x202/0x310 kernel/locking/lockdep.c:3899
>>   __raw_spin_lock include/linux/spinlock_api_smp.h:142 [inline]
>>   _raw_spin_lock+0x2c/0x40 kernel/locking/spinlock.c:144
>>   spin_lock include/linux/spinlock.h:329 [inline]
>>   aio_poll fs/aio.c:1750 [inline]
>>   io_submit_one+0xb90/0x1b30 fs/aio.c:1853
>>   __do_sys_io_submit fs/aio.c:1919 [inline]
>>   __se_sys_io_submit fs/aio.c:1890 [inline]
>>   __x64_sys_io_submit+0x19b/0x500 fs/aio.c:1890
>>   do_syscall_64+0xc8/0x580 arch/x86/entry/common.c:290
>>   entry_SYSCALL_64_after_hwframe+0x49/0xbe
>>   ......
>>   Allocated by task 4953:
>>   set_track mm/kasan/kasan.c:460 [inline]
>>   kasan_kmalloc+0xa0/0xd0 mm/kasan/kasan.c:553
>>   kmem_cache_alloc_trace+0x12f/0x2d0 mm/slub.c:2733
>>   kmalloc include/linux/slab.h:513 [inline]
>>   kzalloc include/linux/slab.h:707 [inline]
>>   alloc_pipe_info+0xdf/0x410 fs/pipe.c:633
>>   get_pipe_inode fs/pipe.c:712 [inline]
>>   create_pipe_files+0x98/0x780 fs/pipe.c:744
>>   __do_pipe_flags+0x35/0x230 fs/pipe.c:781
>>   do_pipe2+0x87/0x150 fs/pipe.c:829
>>   __do_sys_pipe2 fs/pipe.c:847 [inline]
>>   __se_sys_pipe2 fs/pipe.c:845 [inline]
>>   __x64_sys_pipe2+0x55/0x80 fs/pipe.c:845
>>   do_syscall_64+0xc8/0x580 arch/x86/entry/common.c:290
>>   entry_SYSCALL_64_after_hwframe+0x49/0xbe
>>
>>  Freed by task 4952:
>>   set_track mm/kasan/kasan.c:460 [inline]
>>   __kasan_slab_free+0x12e/0x180 mm/kasan/kasan.c:521
>>   slab_free_hook mm/slub.c:1371 [inline]
>>   slab_free_freelist_hook mm/slub.c:1398 [inline]
>>   slab_free mm/slub.c:2953 [inline]
>>   kfree+0xeb/0x2f0 mm/slub.c:3906
>>   put_pipe_info+0xb0/0xd0 fs/pipe.c:556
>>   pipe_release+0x1ab/0x240 fs/pipe.c:577
>>   __fput+0x27f/0x7f0 fs/file_table.c:278
>>   task_work_run+0x136/0x1b0 kernel/task_work.c:113
>>   tracehook_notify_resume include/linux/tracehook.h:193 [inline]
>>   exit_to_usermode_loop+0x1a7/0x1d0 arch/x86/entry/common.c:166
>>   prepare_exit_to_usermode arch/x86/entry/common.c:197 [inline]
>>   syscall_return_slowpath arch/x86/entry/common.c:268 [inline]
>>   do_syscall_64+0x461/0x580 arch/x86/entry/common.c:293
>>   entry_SYSCALL_64_after_hwframe+0x49/0xbe
>>
>> Fixes: bfe4037e722e ("aio: implement IOCB_CMD_POLL")
>> Cc: stable@vger.kernel.org [4.19+]
>> Signed-off-by: Hou Tao <houtao1@huawei.com>
>> ---
>>  fs/aio.c | 8 ++++++++
>>  1 file changed, 8 insertions(+)
>>
>> diff --git a/fs/aio.c b/fs/aio.c
>> index aaaaf4d12c73..ea2f5de4feac 100644
>> --- a/fs/aio.c
>> +++ b/fs/aio.c
>> @@ -1763,6 +1763,12 @@ static ssize_t aio_poll(struct aio_kiocb *aiocb, const struct iocb *iocb)
>>  	/* one for removal from waitqueue, one for this function */
>>  	refcount_set(&aiocb->ki_refcnt, 2);
>>
>> +	/*
>> +	 * file may be released by aio_poll_wake() if an expected event
>> +	 * is triggered immediately after the return of vfs_poll(), so
>> +	 * an extra reference is needed here to prevent use-after-free.
>> +	 */
>> +	get_file(req->file);
>>  	mask = vfs_poll(req->file, &apt.pt) & req->events;
>>  	if (unlikely(!req->head)) {
>>  		/* we did not manage to set up a waitqueue, done */
>> @@ -1788,6 +1794,8 @@ static ssize_t aio_poll(struct aio_kiocb *aiocb, const struct iocb *iocb)
>>  	spin_unlock_irq(&ctx->ctx_lock);
>>
>>  out:
>> +	/* release the extra reference for vfs_poll() */
>> +	fput(req->file);
>>  	if (unlikely(apt.error)) {
>>  		fput(req->file);
>>  		return apt.error;
>>
>
>
> .
>

```

[Al Viro](/project/linux-fsdevel/list/?submitter=159)
March 5, 2019, 1:25 a.m. UTC | [#3](/comment/22513581/)
```

On Tue, Mar 05, 2019 at 09:17:07AM +0800, Hou Tao wrote:
> ping ?

Oh, hell...  I really wish I'd seen your mail back then ;-/
Would've avoided a lot of headache now (and essentially
duplicating your analysis + patch when a later report
got noticed - right before the -final, Murphy Law being what
it is).

Unfortunately, that approach (and I'd ended up with pretty
much the same patch) doesn't solve all problems in the
area; I think I have a sane fix, will post tomorrow morning...

Again, my apologies.  I probably need to do what Linus had
done years ago and unsubscribe from l-k - the traffic is
too high and stuff gets lost in the noise ;-/

```

10828359

[diff](/project/linux-fsdevel/patch/20190225090332.88640-1-houtao1%40huawei.com/raw/ "Download patch diff")
[mbox](/project/linux-fsdevel/patch/20190225090332.88640-1-houtao1%40huawei.com/mbox/ "Download patch mbox")
[series](/series/84563/mbox/ "Download patch mbox with dependencies")
## Patch

```

diff --git a/fs/aio.c b/fs/aio.c
index aaaaf4d12c73..ea2f5de4feac 100644
--- a/fs/aio.c
+++ b/fs/aio.c
@@ -1763,6 +1763,12 @@  static ssize_t aio_poll(struct aio_kiocb *aiocb, const struct iocb *iocb)
 	/* one for removal from waitqueue, one for this function */
 	refcount_set(&aiocb->ki_refcnt, 2);

+	/*
+	 * file may be released by aio_poll_wake() if an expected event
+	 * is triggered immediately after the return of vfs_poll(), so
+	 * an extra reference is needed here to prevent use-after-free.
+	 */
+	get_file(req->file);
 	mask = vfs_poll(req->file, &apt.pt) & req->events;
 	if (unlikely(!req->head)) {
 		/* we did not manage to set up a waitqueue, done */
@@ -1788,6 +1794,8 @@  static ssize_t aio_poll(struct aio_kiocb *aiocb, const struct iocb *iocb)
 	spin_unlock_irq(&ctx->ctx_lock);

 out:
+	/* release the extra reference for vfs_poll() */
+	fput(req->file);
 	if (unlikely(apt.error)) {
 		fput(req->file);
 		return apt.error;

```

[patchwork](http://jk.ozlabs.org/projects/patchwork/)
patch tracking system | version v2.2.6 | [about patchwork](/about/)



=== Content from security.netapp.com_e2acb835_20250120_232134.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [April 2019 Linux Kernel Vulnerabilities in NetApp Products](https://security.netapp.com/advisory/ntap-20190411-0003)

## April 2019 Linux Kernel Vulnerabilities in NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20190411-0003 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20190411-0003 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20190411-0003 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20190411-0003 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20190411-0003
**Version:**
10.0

**Last updated:**
05/22/2020

**Status:**
Final.

**CVEs:** CVE-2019-10125, CVE-2019-3874

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions through 5.0.2 are susceptible to vulnerabilities which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of these vulnerabilities could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2019-10125](https://nvd.nist.gov/vuln/detail/CVE-2019-10125) | 9.8 (CRITICAL) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-3874](https://nvd.nist.gov/vuln/detail/CVE-2019-3874) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=46612b751c4941c5c0472ddf04027e877ae5990f>
* <https://github.com/torvalds/linux/commit/46612b751c4941c5c0472ddf04027e877ae5990f>
* <https://patchwork.kernel.org/patch/10828359/>
* <https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2019-3874>

Affected Products
#### Affected Products

* Active IQ Unified Manager (formerly OnCommand Unified Manager) for VMware vSphere 9.5 and above
* Cluster Network Switch (NetApp CN1610)
* NetApp SolidFire & HCI Management Node
* SnapProtect

#### Products Not Affected

* 7-Mode Transition Tool
* ATTO FibreBridge
* Active IQ Unified Manager (formerly OnCommand Unified Manager) for Linux 7.3 and above
* Active IQ Unified Manager (formerly OnCommand Unified Manager) for Windows 7.3 and above
* Active IQ mobile app
* Brocade Fabric Operating System Firmware
* Brocade Network Advisor Software
* Clustered Data ONTAP
* Clustered Data ONTAP Antivirus Connector
* Data ONTAP operating in 7-Mode
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Storage Manager
* E-Series SANtricity Web Services (REST API) for Web Services Proxy
* Element Plug-in for vCenter Server
* FAS/AFF BIOS
* FAS/AFF Baseboard Management Controller (BMC)
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* MAX Data
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp Cloud Backup (formerly AltaVault)
* NetApp Cloud Backup OST Plug-in (formerly AltaVault OST Plug-in)
* NetApp Converged Systems Advisor Agent
* NetApp Element System Firmware
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Nodes
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp Plug-in for Symantec NetBackup
* NetApp SANtricity Cloud Connector
* NetApp SANtricity SMI-S Provider
* NetApp SMI-S Provider
* NetApp Service Level Manager
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Baseboard Management Controller (BMC)
* NetApp SteelStore Cloud Integrated Storage
* NetApp Storage Encryption
* NetApp VASA Provider for Clustered Data ONTAP 7.2 and above
* ONTAP Select Deploy administration utility
* OnCommand API Services
* OnCommand Cloud Manager
* OnCommand Insight
* OnCommand System Manager 3.x
* OnCommand System Manager 9.x
* OnCommand Unified Manager for 7-Mode (core package)
* OnCommand Workflow Automation
* Open Systems SnapVault Agent
* RAID Controller CTS2600 Legacy Engenio
* SAS Firmware
* Service Processor
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapDrive for Unix
* SnapDrive for Windows
* SnapManager for Exchange
* SnapManager for Hyper-V
* SnapManager for MS SQL
* SnapManager for Oracle
* SnapManager for SAP
* SnapManager for Sharepoint
* Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 7.2 and above
* Storage Replication Adapter for Clustered Data ONTAP for Windows 7.2 and above
* Storage Services Connector
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID Baseboard Management Controller (BMC)
* StorageGRID Webscale NAS Bridge
* StorageGRID9 (9.x and prior)
* System Setup
* Trident
* Virtual Storage Console for VMware vSphere 7.2 and above

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **Active IQ Unified Manager (formerly OnCommand Unified Manager) for VMware vSphere 9.5 and above** | <https://mysupport.netapp.com/products/oncommand_um/9.5P1/> <https://mysupport.netapp.com/products/activeiq_um/9.6/> |
| **NetApp SolidFire & HCI Management Node** | <https://mysupport.netapp.com/site/products/all/details/element-software/downloads-tab/download/62654/12.0> <https://mysupport.netapp.com/site/products/all/details/netapp-hci/downloads-tab/download/62542/1.8> |
| **Cluster Network Switch (NetApp CN1610)** | Cluster Network Switch (NetApp CN1610) has no plans to address this vulnerability. |
| **SnapProtect** | SnapProtect has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2426797.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20190411-0003>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20190411 | Initial Public Release |
| 2.0 | 20190426 | NetApp VASA Provider for Clustered Data ONTAP 7.2 and above, Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 7.2 and above and NetApp VASA Provider for Clustered Data ONTAP 7.2 and above moved to Products Not Affected |
| 3.0 | 20190531 | SnapProtect moved to Won't Fix status |
| 4.0 | 20190613 | FAS/AFF Baseboard Management Controller (BMC) moved to Products Not Affected |
| 5.0 | 20190617 | Service Processor moved to Products Not Affected |
| 6.0 | 20190625 | OnCommand Unified Manager for VMware vSphere 9.4 and above added to Software Versions and Fixes |
| 7.0 | 20190627 | Removed CVE-2019-10124 from the advisory, this candidate was withdrawn by its CNA. Further investigation showed that it was not a security issue |
| 8.0 | 20190731 | Cluster Network Switch (NetApp CN1610) moved to Won't Fix status |
| 9.0 | 20200327 | Active IQ Performance Analytics Services added to Software Versions and Fixes |
| 10.0 | 20200522 | NetApp SolidFire & HCI Management Node added to Software Versions and Fixes, Final status |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from support.f5.com_fd3b515e_20250120_232135.html ===
Loading×Sorry to interruptCSS ErrorRefresh
