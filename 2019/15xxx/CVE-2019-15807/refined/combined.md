=== Content from cdn.kernel.org_7b6fb4fe_20250120_231916.html ===
commit 7da3d9e6cd75cca48bfd99ba55c874900c0135d9
Author: Greg Kroah-Hartman
Date: Sat Jun 22 08:09:16 2019 +0200
Linux 5.1.13
commit d7dcfd25208d0d17f407cd09fc8aa4571cf50228
Author: Andrea Arcangeli
Date: Thu Jun 13 15:56:11 2019 -0700
coredump: fix race condition between collapse\_huge\_page() and core dumping
commit 59ea6d06cfa9247b586a695c21f94afa7183af74 upstream.
When fixing the race conditions between the coredump and the mmap\_sem
holders outside the context of the process, we focused on
mmget\_not\_zero()/get\_task\_mm() callers in 04f5866e41fb70 ("coredump: fix
race condition between mmget\_not\_zero()/get\_task\_mm() and core
dumping"), but those aren't the only cases where the mmap\_sem can be
taken outside of the context of the process as Michal Hocko noticed
while backporting that commit to older -stable kernels.
If mmgrab() is called in the context of the process, but then the
mm\_count reference is transferred outside the context of the process,
that can also be a problem if the mmap\_sem has to be taken for writing
through that mm\_count reference.
khugepaged registration calls mmgrab() in the context of the process,
but the mmap\_sem for writing is taken later in the context of the
khugepaged kernel thread.
collapse\_huge\_page() after taking the mmap\_sem for writing doesn't
modify any vma, so it's not obvious that it could cause a problem to the
coredump, but it happens to modify the pmd in a way that breaks an
invariant that pmd\_trans\_huge\_lock() relies upon. collapse\_huge\_page()
needs the mmap\_sem for writing just to block concurrent page faults that
call pmd\_trans\_huge\_lock().
Specifically the invariant that "!pmd\_trans\_huge()" cannot become a
"pmd\_trans\_huge()" doesn't hold while collapse\_huge\_page() runs.
The coredump will call \_\_get\_user\_pages() without mmap\_sem for reading,
which eventually can invoke a lockless page fault which will need a
functional pmd\_trans\_huge\_lock().
So collapse\_huge\_page() needs to use mmget\_still\_valid() to check it's
not running concurrently with the coredump... as long as the coredump
can invoke page faults without holding the mmap\_sem for reading.
This has "Fixes: khugepaged" to facilitate backporting, but in my view
it's more a bug in the coredump code that will eventually have to be
rewritten to stop invoking page faults without the mmap\_sem for reading.
So the long term plan is still to drop all mmget\_still\_valid().
Link: http://lkml.kernel.org/r/20190607161558.32104-1-aarcange@redhat.com
Fixes: ba76149f47d8 ("thp: khugepaged")
Signed-off-by: Andrea Arcangeli
Reported-by: Michal Hocko
Acked-by: Michal Hocko
Acked-by: Kirill A. Shutemov
Cc: Oleg Nesterov
Cc: Jann Horn
Cc: Hugh Dickins
Cc: Mike Rapoport
Cc: Mike Kravetz
Cc: Peter Xu
Cc: Jason Gunthorpe
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 3111e132f46e64440878d7b855fc1709d20ff7d8
Author: Sagi Grimberg
Date: Tue May 28 22:49:05 2019 -0700
nvme-tcp: fix queue mapping when queue count is limited
commit 6486199378a505c58fddc47459631235c9fb7638 upstream.
When the controller supports less queues than requested, we
should make sure that queue mapping does the right thing and
not assume that all queues are available. This fixes a crash
when the controller supports less queues than requested.
The rules are:
1. if no write queues are requested, we assign the available queues
to the default queue map. The default and read queue maps share the
existing queues.
2. if write queues are requested:
- first make sure that read queue map gets the requested
nr\_io\_queues count
- then grant the default queue map the minimum between the requested
nr\_write\_queues and the remaining queues. If there are no available
queues to dedicate to the default queue map, fallback to (1) and
share all the queues in the existing queue map.
Also, provide a log indication on how we constructed the different
queue maps.
Reported-by: Harris, James R
Tested-by: Jim Harris
Cc:  # v5.0+
Suggested-by: Roy Shterman
Signed-off-by: Sagi Grimberg
Signed-off-by: Greg Kroah-Hartman
commit d28c4813569c2a870978c39eb6769b19b9bc8a63
Author: Sagi Grimberg
Date: Mon Apr 29 16:25:48 2019 -0700
nvme-tcp: fix possible null deref on a timed out io queue connect
commit f34e25898a608380a60135288019c4cb6013bec8 upstream.
If I/O queue connect times out, we might have freed the queue socket
already, so check for that on the error path in nvme\_tcp\_start\_queue.
Signed-off-by: Sagi Grimberg
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit bd445693bef262bb9e02d44479027b3a0fc14ada
Author: Sagi Grimberg
Date: Wed Apr 24 11:53:19 2019 -0700
nvme-tcp: rename function to have nvme\_tcp prefix
commit efb973b19b88642bb7e08b8ce8e03b0bbd2a7e2a upstream.
usually nvme\_ prefix is for core functions.
While we're cleaning up, remove redundant empty lines
Signed-off-by: Sagi Grimberg
Reviewed-by: Minwoo Im
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit b936bac388e05f30794cc3b4e50fdf62203edcef
Author: Yang Shi
Date: Thu Jun 13 15:56:05 2019 -0700
mm: mmu\_gather: remove \_\_tlb\_reset\_range() for force flush
commit 7a30df49f63ad92318ddf1f7498d1129a77dd4bd upstream.
A few new fields were added to mmu\_gather to make TLB flush smarter for
huge page by telling what level of page table is changed.
\_\_tlb\_reset\_range() is used to reset all these page table state to
unchanged, which is called by TLB flush for parallel mapping changes for
the same range under non-exclusive lock (i.e. read mmap\_sem).
Before commit dd2283f2605e ("mm: mmap: zap pages with read mmap\_sem in
munmap"), the syscalls (e.g. MADV\_DONTNEED, MADV\_FREE) which may update
PTEs in parallel don't remove page tables. But, the forementioned
commit may do munmap() under read mmap\_sem and free page tables. This
may result in program hang on aarch64 reported by Jan Stancek. The
problem could be reproduced by his test program with slightly modified
below.
---8<---
static int map\_size = 4096;
static int num\_iter = 500;
static long threads\_total;
static void \*distant\_area;
void \*map\_write\_unmap(void \*ptr)
{
int \*fd = ptr;
unsigned char \*map\_address;
int i, j = 0;
for (i = 0; i < num\_iter; i++) {
map\_address = mmap(distant\_area, (size\_t) map\_size, PROT\_WRITE | PROT\_READ,
MAP\_SHARED | MAP\_ANONYMOUS, -1, 0);
if (map\_address == MAP\_FAILED) {
perror("mmap");
exit(1);
}
for (j = 0; j < map\_size; j++)
map\_address[j] = 'b';
if (munmap(map\_address, map\_size) == -1) {
perror("munmap");
exit(1);
}
}
return NULL;
}
void \*dummy(void \*ptr)
{
return NULL;
}
int main(void)
{
pthread\_t thid[2];
/\* hint for mmap in map\_write\_unmap() \*/
distant\_area = mmap(0, DISTANT\_MMAP\_SIZE, PROT\_WRITE | PROT\_READ,
MAP\_ANONYMOUS | MAP\_PRIVATE, -1, 0);
munmap(distant\_area, (size\_t)DISTANT\_MMAP\_SIZE);
distant\_area += DISTANT\_MMAP\_SIZE / 2;
while (1) {
pthread\_create(&thid[0], NULL, map\_write\_unmap, NULL);
pthread\_create(&thid[1], NULL, dummy, NULL);
pthread\_join(thid[0], NULL);
pthread\_join(thid[1], NULL);
}
}
---8<---
The program may bring in parallel execution like below:
t1 t2
munmap(map\_address)
downgrade\_write(&mm->mmap\_sem);
unmap\_region()
tlb\_gather\_mmu()
inc\_tlb\_flush\_pending(tlb->mm);
free\_pgtables()
tlb->freed\_tables = 1
tlb->cleared\_pmds = 1
pthread\_exit()
madvise(thread\_stack, 8M, MADV\_DONTNEED)
zap\_page\_range()
tlb\_gather\_mmu()
inc\_tlb\_flush\_pending(tlb->mm);
tlb\_finish\_mmu()
if (mm\_tlb\_flush\_nested(tlb->mm))
\_\_tlb\_reset\_range()
\_\_tlb\_reset\_range() would reset freed\_tables and cleared\_\* bits, but this
may cause inconsistency for munmap() which do free page tables. Then it
may result in some architectures, e.g. aarch64, may not flush TLB
completely as expected to have stale TLB entries remained.
Use fullmm flush since it yields much better performance on aarch64 and
non-fullmm doesn't yields significant difference on x86.
The original proposed fix came from Jan Stancek who mainly debugged this
issue, I just wrapped up everything together.
Jan's testing results:
v5.2-rc2-24-gbec7550cca10
--------------------------
mean stddev
real 37.382 2.780
user 1.420 0.078
sys 54.658 1.855
v5.2-rc2-24-gbec7550cca10 + "mm: mmu\_gather: remove \_\_tlb\_reset\_range() for force flush"
---------------------------------------------------------------------------------------\_
mean stddev
real 37.119 2.105
user 1.548 0.087
sys 55.698 1.357
[akpm@linux-foundation.org: coding-style fixes]
Link: http://lkml.kernel.org/r/1558322252-113575-1-git-send-email-yang.shi@linux.alibaba.com
Fixes: dd2283f2605e ("mm: mmap: zap pages with read mmap\_sem in munmap")
Signed-off-by: Yang Shi
Signed-off-by: Jan Stancek
Reported-by: Jan Stancek
Tested-by: Jan Stancek
Suggested-by: Will Deacon
Tested-by: Will Deacon
Acked-by: Will Deacon
Cc: Peter Zijlstra
Cc: Nick Piggin
Cc: "Aneesh Kumar K.V"
Cc: Nadav Amit
Cc: Minchan Kim
Cc: Mel Gorman
Cc:  [4.20+]
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit bb1313f8e3e009b327cb1a289c517a6291d44ca3
Author: Tobin C. Harding
Date: Fri May 31 22:30:29 2019 -0700
ocfs2: fix error path kobject memory leak
[ Upstream commit b9fba67b3806e21b98bd5a98dc3921a8e9b42d61 ]
If a call to kobject\_init\_and\_add() fails we should call kobject\_put()
otherwise we leak memory.
Add call to kobject\_put() in the error path of call to
kobject\_init\_and\_add(). Please note, this has the side effect that the
release method is called if kobject\_init\_and\_add() fails.
Link: http://lkml.kernel.org/r/20190513033458.2824-1-tobin@kernel.org
Signed-off-by: Tobin C. Harding
Reviewed-by: Greg Kroah-Hartman
Reviewed-by: Joseph Qi
Cc: Mark Fasheh
Cc: Joel Becker
Cc: Junxiao Bi
Cc: Changwei Ge
Cc: Gang He
Cc: Jun Piao
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Sasha Levin
commit f8d7891817dd2fd3ed983074f9631bf422ab00d1
Author: Amit Cohen
Date: Wed May 29 10:59:45 2019 +0300
mlxsw: spectrum: Prevent force of 56G
[ Upstream commit 275e928f19117d22f6d26dee94548baf4041b773 ]
Force of 56G is not supported by hardware in Ethernet devices. This
configuration fails with a bad parameter error from firmware.
Add check of this case. Instead of trying to set 56G with autoneg off,
return a meaningful error.
Fixes: 56ade8fe3fe1 ("mlxsw: spectrum: Add initial support for Spectrum ASIC")
Signed-off-by: Amit Cohen
Acked-by: Jiri Pirko
Signed-off-by: Ido Schimmel
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 16044c98e4d73f749e4afaa071618664d24b5da1
Author: Jason Yan
Date: Tue May 14 10:42:39 2019 +0800
scsi: libsas: delete sas port if expander discover failed
[ Upstream commit 3b0541791453fbe7f42867e310e0c9eb6295364d ]
The sas\_port(phy->port) allocated in sas\_ex\_discover\_expander() will not be
deleted when the expander failed to discover. This will cause resource leak
and a further issue of kernel BUG like below:
[159785.843156] port-2:17:29: trying to add phy phy-2:17:29 fails: it's
already part of another port
[159785.852144] ------------[ cut here ]------------
[159785.856833] kernel BUG at drivers/scsi/scsi\_transport\_sas.c:1086!
[159785.863000] Internal error: Oops - BUG: 0 [#1] SMP
[159785.867866] CPU: 39 PID: 16993 Comm: kworker/u96:2 Tainted: G
W OE 4.19.25-vhulk1901.1.0.h111.aarch64 #1
[159785.878458] Hardware name: Huawei Technologies Co., Ltd.
Hi1620EVBCS/Hi1620EVBCS, BIOS Hi1620 CS B070 1P TA 03/21/2019
[159785.889231] Workqueue: 0000:74:02.0\_disco\_q sas\_discover\_domain
[159785.895224] pstate: 40c00009 (nZcv daif +PAN +UAO)
[159785.900094] pc : sas\_port\_add\_phy+0x188/0x1b8
[159785.904524] lr : sas\_port\_add\_phy+0x188/0x1b8
[159785.908952] sp : ffff0001120e3b80
[159785.912341] x29: ffff0001120e3b80 x28: 0000000000000000
[159785.917727] x27: ffff802ade8f5400 x26: ffff0000681b7560
[159785.923111] x25: ffff802adf11a800 x24: ffff0000680e8000
[159785.928496] x23: ffff802ade8f5728 x22: ffff802ade8f5708
[159785.933880] x21: ffff802adea2db40 x20: ffff802ade8f5400
[159785.939264] x19: ffff802adea2d800 x18: 0000000000000010
[159785.944649] x17: 00000000821bf734 x16: ffff00006714faa0
[159785.950033] x15: ffff0000e8ab4ecf x14: 7261702079646165
[159785.955417] x13: 726c612073277469 x12: ffff00006887b830
[159785.960802] x11: ffff00006773eaa0 x10: 7968702079687020
[159785.966186] x9 : 0000000000002453 x8 : 726f702072656874
[159785.971570] x7 : 6f6e6120666f2074 x6 : ffff802bcfb21290
[159785.976955] x5 : ffff802bcfb21290 x4 : 0000000000000000
[159785.982339] x3 : ffff802bcfb298c8 x2 : 337752b234c2ab00
[159785.987723] x1 : 337752b234c2ab00 x0 : 0000000000000000
[159785.993108] Process kworker/u96:2 (pid: 16993, stack limit =
0x0000000072dae094)
[159786.000576] Call trace:
[159786.003097] sas\_port\_add\_phy+0x188/0x1b8
[159786.007179] sas\_ex\_get\_linkrate.isra.5+0x134/0x140
[159786.012130] sas\_ex\_discover\_expander+0x128/0x408
[159786.016906] sas\_ex\_discover\_dev+0x218/0x4c8
[159786.021249] sas\_ex\_discover\_devices+0x9c/0x1a8
[159786.025852] sas\_discover\_root\_expander+0x134/0x160
[159786.030802] sas\_discover\_domain+0x1b8/0x1e8
[159786.035148] process\_one\_work+0x1b4/0x3f8
[159786.039230] worker\_thread+0x54/0x470
[159786.042967] kthread+0x134/0x138
[159786.046269] ret\_from\_fork+0x10/0x18
[159786.049918] Code: 91322300 f0004402 91178042 97fe4c9b (d4210000)
[159786.056083] Modules linked in: hns3\_enet\_ut(OE) hclge(OE) hnae3(OE)
hisi\_sas\_test\_hw(OE) hisi\_sas\_test\_main(OE) serdes(OE)
[159786.067202] ---[ end trace 03622b9e2d99e196 ]---
[159786.071893] Kernel panic - not syncing: Fatal exception
[159786.077190] SMP: stopping secondary CPUs
[159786.081192] Kernel Offset: disabled
[159786.084753] CPU features: 0x2,a2a00a38
Fixes: 2908d778ab3e ("[SCSI] aic94xx: new driver")
Reported-by: Jian Luo
Signed-off-by: Jason Yan
CC: John Garry
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit 5a52460378085e943af6412118f60d7d89041cfd
Author: YueHaibing
Date: Mon May 27 22:22:09 2019 +0800
scsi: scsi\_dh\_alua: Fix possible null-ptr-deref
[ Upstream commit 12e750bc62044de096ab9a95201213fd912b9994 ]
If alloc\_workqueue fails in alua\_init, it should return -ENOMEM, otherwise
it will trigger null-ptr-deref while unloading module which calls
destroy\_workqueue dereference
wq->lock like this:
BUG: KASAN: null-ptr-deref in \_\_lock\_acquire+0x6b4/0x1ee0
Read of size 8 at addr 0000000000000080 by task syz-executor.0/7045
CPU: 0 PID: 7045 Comm: syz-executor.0 Tainted: G C 5.1.0+ #28
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.10.2-1ubuntu1
Call Trace:
dump\_stack+0xa9/0x10e
\_\_kasan\_report+0x171/0x18d
? \_\_lock\_acquire+0x6b4/0x1ee0
kasan\_report+0xe/0x20
\_\_lock\_acquire+0x6b4/0x1ee0
lock\_acquire+0xb4/0x1b0
\_\_mutex\_lock+0xd8/0xb90
drain\_workqueue+0x25/0x290
destroy\_workqueue+0x1f/0x3f0
\_\_x64\_sys\_delete\_module+0x244/0x330
do\_syscall\_64+0x72/0x2a0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Reported-by: Hulk Robot
Fixes: 03197b61c5ec ("scsi\_dh\_alua: Use workqueue for RTPG")
Signed-off-by: YueHaibing
Reviewed-by: Bart Van Assche
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit cc58a0b1b4fbc926dbf416cb2d3f3e40f17f49c6
Author: Lianbo Jiang
Date: Mon May 27 08:59:34 2019 +0800
scsi: smartpqi: properly set both the DMA mask and the coherent DMA mask
[ Upstream commit 1d94f06e7f5df4064ef336b7b710f50143b64a53 ]
When SME is enabled, the smartpqi driver won't work on the HP DL385 G10
machine, which causes the failure of kernel boot because it fails to
allocate pqi error buffer. Please refer to the kernel log:
....
[ 9.431749] usbcore: registered new interface driver uas
[ 9.441524] Microsemi PQI Driver (v1.1.4-130)
[ 9.442956] i40e 0000:04:00.0: fw 6.70.48768 api 1.7 nvm 10.2.5
[ 9.447237] smartpqi 0000:23:00.0: Microsemi Smart Family Controller found
Starting dracut initqueue hook...
[ OK ] Started Show Plymouth Boot Scre[ 9.471654] Broadcom NetXtreme-C/E driver bnxt\_en v1.9.1
en.
[ OK ] Started Forward Password Requests to Plymouth Directory Watch.
[[0;[ 9.487108] smartpqi 0000:23:00.0: failed to allocate PQI error buffer
....
[ 139.050544] dracut-initqueue[949]: Warning: dracut-initqueue timeout - starting timeout scripts
[ 139.589779] dracut-initqueue[949]: Warning: dracut-initqueue timeout - starting timeout scripts
Basically, the fact that the coherent DMA mask value wasn't set caused the
driver to fall back to SWIOTLB when SME is active.
For correct operation, lets call the dma\_set\_mask\_and\_coherent() to
properly set the mask for both streaming and coherent, in order to inform
the kernel about the devices DMA addressing capabilities.
Signed-off-by: Lianbo Jiang
Acked-by: Don Brace
Tested-by: Don Brace
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit f0638d50b319890165c6bff037a40db1e28a467b
Author: Varun Prakash
Date: Wed May 22 20:10:55 2019 +0530
scsi: libcxgbi: add a check for NULL pointer in cxgbi\_check\_route()
[ Upstream commit cc555759117e8349088e0c5d19f2f2a500bafdbd ]
ip\_dev\_find() can return NULL so add a check for NULL pointer.
Signed-off-by: Varun Prakash
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
commit b68f9cbff4448ee9bcddc91af7edbbfbaa2622ce
Author: Max Uvarov
Date: Tue May 28 13:00:52 2019 +0300
net: phy: dp83867: Set up RGMII TX delay
[ Upstream commit 2b892649254fec01678c64f16427622b41fa27f4 ]
PHY\_INTERFACE\_MODE\_RGMII\_RXID is less then TXID
so code to set tx delay is never called.
Fixes: 2a10154abcb75 ("net: phy: dp83867: Add TI dp83867 phy")
Signed-off-by: Max Uvarov
Cc: Florian Fainelli
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 8ee9f9c48f2d3944de54c2f0094157347230519b
Author: Max Uvarov
Date: Tue May 28 13:00:50 2019 +0300
net: phy: dp83867: increase SGMII autoneg timer duration
[ Upstream commit 1a97a477e666cbdededab93bd3754e508f0c09d7 ]
After reset SGMII Autoneg timer is set to 2us (bits 6 and 5 are 01).
That is not enough to finalize autonegatiation on some devices.
Increase this timer duration to maximum supported 16ms.
Signed-off-by: Max Uvarov
Cc: Heiner Kallweit
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 315cb046c6d37ce32d1f06c1a9af1004c5e38221
Author: Max Uvarov
Date: Tue May 28 13:00:49 2019 +0300
net: phy: dp83867: fix speed 10 in sgmii mode
[ Upstream commit 333061b924539c0de081339643f45514f5f1c1e6 ]
For supporting 10Mps speed in SGMII mode DP83867\_10M\_SGMII\_RATE\_ADAPT bit
of DP83867\_10M\_SGMII\_CFG register has to be cleared by software.
That does not affect speeds 100 and 1000 so can be done on init.
Signed-off-by: Max Uvarov
Cc: Heiner Kallweit
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 132a01b4dc554231c4143bc78ae5058b3ef7502c
Author: Russell King
Date: Tue May 28 10:27:21 2019 +0100
net: phylink: ensure consistent phy interface mode
[ Upstream commit c678726305b9425454be7c8a7624290b602602fc ]
Ensure that we supply the same phy interface mode to mac\_link\_down() as
we did for the corresponding mac\_link\_up() call. This ensures that MAC
drivers that use the phy interface mode in these methods can depend on
mac\_link\_down() always corresponding to a mac\_link\_up() call for the
same interface mode.
Signed-off-by: Russell King
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4c17461bff063b5fa2b71a4359cd83af8570cc29
Author: Jes Sorensen
Date: Fri Apr 19 16:35:44 2019 -0400
blk-mq: Fix memory leak in error handling
[ Upstream commit 41de54c64811bf087c8464fdeb43c6ad8be2686b ]
If blk\_mq\_init\_allocated\_queue() fails, make sure to free the poll
stat callback struct allocated.
Signed-off-by: Jes Sorensen
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit a6c6ea45529b8abd1b416f12de7914689d59de48
Author: Yoshihiro Shimoda
Date: Tue May 28 13:10:46 2019 +0900
net: sh\_eth: fix mdio access in sh\_eth\_close() for R-Car Gen2 and RZ/A1 SoCs
[ Upstream commit 315ca92dd863fecbffc0bb52ae0ac11e0398726a ]
The sh\_eth\_close() resets the MAC and then calls phy\_stop()
so that mdio read access result is incorrect without any error
according to kernel trace like below:
ifconfig-216 [003] .n.. 109.133124: mdio\_access: ee700000.ethernet-ffffffff read phy:0x01 reg:0x00 val:0xffff
According to the hardware manual, the RMII mode should be set to 1
before operation the Ethernet MAC. However, the previous code was not
set to 1 after the driver issued the soft\_reset in sh\_eth\_dev\_exit()
so that the mdio read access result seemed incorrect. To fix the issue,
this patch adds a condition and set the RMII mode register in
sh\_eth\_dev\_exit() for R-Car Gen2 and RZ/A1 SoCs.
Note that when I have tried to move the sh\_eth\_dev\_exit() calling
after phy\_stop() on sh\_eth\_close(), but it gets worse (kernel panic
happened and it seems that a register is accessed while the clock is
off).
Signed-off-by: Yoshihiro Shimoda
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 2750ffb4b5b817057c6d7e1d3820f89fd58e012c
Author: Sami Tolvanen
Date: Fri May 24 15:11:18 2019 -0700
arm64: use the correct function type for \_\_arm64\_sys\_ni\_syscall
[ Upstream commit 1e29ab3186e33c77dbb2d7566172a205b59fa390 ]
Calling sys\_ni\_syscall through a syscall\_fn\_t pointer trips indirect
call Control-Flow Integrity checking due to a function type
mismatch. Use SYSCALL\_DEFINE0 for \_\_arm64\_sys\_ni\_syscall instead and
remove the now unnecessary casts.
Signed-off-by: Sami Tolvanen
Signed-off-by: Will Deacon
Signed-off-by: Sasha Levin
commit 5d3c03a5064d4a871528bc42130771e6bcff63d4
Author: Sami Tolvanen
Date: Fri May 24 15:11:17 2019 -0700
arm64: use the correct function type in SYSCALL\_DEFINE0
[ Upstream commit 0e358bd7b7ebd27e491dabed938eae254c17fe3b ]
Although a syscall defined using SYSCALL\_DEFINE0 doesn't accept
parameters, use the correct function type to avoid indirect call
type mismatches with Control-Flow Integrity checking.
Signed-off-by: Sami Tolvanen
Signed-off-by: Will Deacon
Signed-off-by: Sasha Levin
commit 5a72ffd5d5a18e58d7ea1e7fcbf7936b843b9d4b
Author: Sami Tolvanen
Date: Fri May 24 15:11:16 2019 -0700
arm64: fix syscall\_fn\_t type
[ Upstream commit 8ef8f368ce72b5e17f7c1f1ef15c38dcfd0fef64 ]
Syscall wrappers in  use const struct pt\_regs \*
as the argument type. Use const in syscall\_fn\_t as well to fix indirect
call type mismatches with Control-Flow Integrity checking.
Signed-off-by: Sami Tolvanen
Reviewed-by: Mark Rutland
Signed-off-by: Will Deacon
Signed-off-by: Sasha Levin
commit 95f47c8a8b96c74657f94c70a6cd6aea885a078b
Author: Geert Uytterhoeven
Date: Tue May 28 16:24:23 2019 +0200
ALSA: fireface: Use ULL suffixes for 64-bit constants
[ Upstream commit 6954158a16404e7091cea494cd0a435ca2f90388 ]
With gcc 4.1:
sound/firewire/fireface/ff-protocol-latter.c: In function ‘latter\_switch\_fetching\_mode’:
sound/firewire/fireface/ff-protocol-latter.c:97: warning: integer constant is too large for ‘long’ type
sound/firewire/fireface/ff-protocol-latter.c: In function ‘latter\_begin\_session’:
sound/firewire/fireface/ff-protocol-latter.c:170: warning: integer constant is too large for ‘long’ type
sound/firewire/fireface/ff-protocol-latter.c:197: warning: integer constant is too large for ‘long’ type
sound/firewire/fireface/ff-protocol-latter.c:205: warning: integer constant is too large for ‘long’ type
sound/firewire/fireface/ff-protocol-latter.c: In function ‘latter\_finish\_session’:
sound/firewire/fireface/ff-protocol-latter.c:214: warning: integer constant is too large for ‘long’ type
Fix this by adding the missing "ULL" suffixes.
Add the same suffix to the last constant, to maintain consistency.
Fixes: fd1cc9de64c2ca6c ("ALSA: fireface: add support for Fireface UCX")
Signed-off-by: Geert Uytterhoeven
Reviewed-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Sasha Levin
commit b25820b9bc5ebd0bca8c7f21458df318fe5339e0
Author: Paul Mackerras
Date: Thu May 23 16:36:32 2019 +1000
KVM: PPC: Book3S HV: Don't take kvm->lock around kvm\_for\_each\_vcpu
[ Upstream commit 5a3f49364c3ffa1107bd88f8292406e98c5d206c ]
Currently the HV KVM code takes the kvm->lock around calls to
kvm\_for\_each\_vcpu() and kvm\_get\_vcpu\_by\_id() (which can call
kvm\_for\_each\_vcpu() internally). However, that leads to a lock
order inversion problem, because these are called in contexts where
the vcpu mutex is held, but the vcpu mutexes nest within kvm->lock
according to Documentation/virtual/kvm/locking.txt. Hence there
is a possibility of deadlock.
To fix this, we simply don't take the kvm->lock mutex around these
calls. This is safe because the implementations of kvm\_for\_each\_vcpu()
and kvm\_get\_vcpu\_by\_id() have been designed to be able to be called
locklessly.
Signed-off-by: Paul Mackerras
Reviewed-by: Cédric Le Goater
Signed-off-by: Paul Mackerras
Signed-off-by: Sasha Levin
commit 9b3bd09b6f57270f085788182ba1297cbf760b3b
Author: Paul Mackerras
Date: Wed May 29 11:54:00 2019 +1000
KVM: PPC: Book3S: Use new mutex to synchronize access to rtas token list
[ Upstream commit 1659e27d2bc1ef47b6d031abe01b467f18cb72d9 ]
Currently the Book 3S KVM code uses kvm->lock to synchronize access
to the kvm->arch.rtas\_tokens list. Because this list is scanned
inside kvmppc\_rtas\_hcall(), which is called with the vcpu mutex held,
taking kvm->lock cause a lock inversion problem, which could lead to
a deadlock.
To fix this, we add a new mutex, kvm->arch.rtas\_token\_lock, which nests
inside the vcpu mutexes, and use that instead of kvm->lock when
accessing the rtas token list.
This removes the lockdep\_assert\_held() in kvmppc\_rtas\_tokens\_free().
At this point we don't hold the new mutex, but that is OK because
kvmppc\_rtas\_tokens\_free() is only called when the whole VM is being
destroyed, and at that point nothing can be looking up a token in
the list.
Signed-off-by: Paul Mackerras
Signed-off-by: Sasha Levin
commit 818fab4491696728e51e3e0b249a448b59b690b4
Author: Paul Mackerras
Date: Thu May 23 16:35:34 2019 +1000
KVM: PPC: Book3S HV: Use new mutex to synchronize MMU setup
[ Upstream commit 0d4ee88d92884c661fcafd5576da243aa943dc24 ]
Currently the HV KVM code uses kvm->lock in conjunction with a flag,
kvm->arch.mmu\_ready, to synchronize MMU setup and hold off vcpu
execution until the MMU-related data structures are ready. However,
this means that kvm->lock is being taken inside vcpu->mutex, which
is contrary to Documentation/virtual/kvm/locking.txt and results in
lockdep warnings.
To fix this, we add a new mutex, kvm->arch.mmu\_setup\_lock, which nests
inside the vcpu mutexes, and is taken in the places where kvm->lock
was taken that are related to MMU setup.
Additionally we take the new mutex in the vcpu creation code at the
point where we are creating a new vcore, in order to provide mutual
exclusion with kvmppc\_update\_lpcr() and ensure that an update to
kvm->arch.lpcr doesn't get missed, which could otherwise lead to a
stale vcore->lpcr value.
Signed-off-by: Paul Mackerras
Signed-off-by: Sasha Levin
commit 560e20f2307aeac798fb52145199a36d751d3d8b
Author: Gen Zhang
Date: Tue May 28 09:12:39 2019 +0800
dfs\_cache: fix a wrong use of kfree in flush\_cache\_ent()
[ Upstream commit 50fbc13dc12666f3604dc2555a47fc8c4e29162b ]
In flush\_cache\_ent(), 'ce->ce\_path' is allocated by kstrdup\_const().
It should be freed by kfree\_const(), rather than kfree().
Signed-off-by: Gen Zhang
Reviewed-by: Paulo Alcantara
Signed-off-by: Steve French
Signed-off-by: Sasha Levin
commit 68a376d453bfd79f21bfb964eecfc13353eb8108
Author: Ross Lagerwall
Date: Mon May 13 14:56:35 2019 +0100
xenbus: Avoid deadlock during suspend due to open transactions
[ Upstream commit d10e0cc113c9e1b64b5c6e3db37b5c839794f3df ]
During a suspend/resume, the xenwatch thread waits for all outstanding
xenstore requests and transactions to complete. This does not work
correctly for transactions started by userspace because it waits for
them to complete after freezing userspace threads which means the
transactions have no way of completing, resulting in a deadlock. This is
trivial to reproduce by running this script and then suspending the VM:
import pyxs, time
c = pyxs.client.Client(xen\_bus\_path="/dev/xen/xenbus")
c.connect()
c.transaction()
time.sleep(3600)
Even if this deadlock were resolved, misbehaving userspace should not
prevent a VM from being migrated. So, instead of waiting for these
transactions to complete before suspending, store the current generation
id for each transaction when it is started. The global generation id is
incremented during resume. If the caller commits the transaction and the
generation id does not match the current generation id, return EAGAIN so
that they try again. If the transaction was instead discarded, return OK
since no changes were made anyway.
This only affects users of the xenbus file interface. In-kernel users of
xenbus are assumed to be well-behaved and complete all transactions
before freezing.
Signed-off-by: Ross Lagerwall
Reviewed-by: Juergen Gross
Signed-off-by: Boris Ostrovsky
Signed-off-by: Sasha Levin
commit 30e2039d6bf6a133265da020221c3a787f3b06c6
Author: YueHaibing
Date: Sat May 25 22:21:51 2019 +0800
xen/pvcalls: Remove set but not used variable
[ Upstream commit 41349672e3cbc2e8349831f21253509c3415aa2b ]
Fixes gcc '-Wunused-but-set-variable' warning:
drivers/xen/pvcalls-front.c: In function pvcalls\_front\_sendmsg:
drivers/xen/pvcalls-front.c:543:25: warning: variable bedata set but not used [-Wunused-but-set-variable]
drivers/xen/pvcalls-front.c: In function pvcalls\_front\_recvmsg:
drivers/xen/pvcalls-front.c:638:25: warning: variable bedata set but not used [-Wunused-but-set-variable]
They are never used since introduction.
Signed-off-by: YueHaibing
Reviewed-by: Juergen Gross
Signed-off-by: Boris Ostrovsky
Signed-off-by: Sasha Levin
commit b2d4f385490e30729a295f7fe3be101adf7ec4fc
Author: Madalin Bucur
Date: Mon May 27 15:24:05 2019 +0300
dpaa\_eth: use only online CPU portals
[ Upstream commit 7aae703f8096d21e34ce5f34f16715587bc30902 ]
Make sure only the portals for the online CPUs are used.
Without this change, there are issues when someone boots with
maxcpus=n, with n < actual number of cores available as frames
either received or corresponding to the transmit confirmation
path would be offered for dequeue to the offline CPU portals,
getting lost.
Signed-off-by: Madalin Bucur
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 71af3faddd52334c8adc5b8dbd67e9bb6fe95e74
Author: Randy Dunlap
Date: Tue May 28 09:14:30 2019 -0700
ia64: fix build errors by exporting paddr\_to\_nid()
[ Upstream commit 9a626c4a6326da4433a0d4d4a8a7d1571caf1ed3 ]
Fix build errors on ia64 when DISCONTIGMEM=y and NUMA=y by
exporting paddr\_to\_nid().
Fixes these build errors:
ERROR: "paddr\_to\_nid" [sound/core/snd-pcm.ko] undefined!
ERROR: "paddr\_to\_nid" [net/sunrpc/sunrpc.ko] undefined!
ERROR: "paddr\_to\_nid" [fs/cifs/cifs.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/video/fbdev/core/fb.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/usb/mon/usbmon.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/usb/core/usbcore.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/md/raid1.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/md/dm-mod.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/md/dm-crypt.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/md/dm-bufio.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/ide/ide-core.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/ide/ide-cd\_mod.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/gpu/drm/drm.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/char/agp/agpgart.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/block/nbd.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/block/loop.ko] undefined!
ERROR: "paddr\_to\_nid" [drivers/block/brd.ko] undefined!
ERROR: "paddr\_to\_nid" [crypto/ccm.ko] undefined!
Reported-by: kbuild test robot
Signed-off-by: Randy Dunlap
Cc: Tony Luck
Cc: Fenghua Yu
Cc: linux-ia64@vger.kernel.org
Signed-off-by: Tony Luck
Signed-off-by: Linus Torvalds
Signed-off-by: Sasha Levin
commit 15bac827297cede1c6b5cab62d6d124286a11226
Author: Thomas Richter
Date: Wed May 22 16:46:01 2019 +0200
perf record: Fix s390 missing module symbol and warning for non-root users
[ Upstream commit 6738028dd57df064b969d8392c943ef3b3ae705d ]
Command 'perf record' and 'perf report' on a system without kernel
debuginfo packages uses /proc/kallsyms and /proc/modules to find
addresses for kernel and module symbols. On x86 this works for root and
non-root users.
On s390, when invoked as non-root user, many of the following warnings
are shown and module symbols are missing:
proc/{kallsyms,modules} inconsistency while looking for
"[sha1\_s390]" module!
Command 'perf record' creates a list of module start addresses by
parsing the output of /proc/modules and creates a PERF\_RECORD\_MMAP
record for the kernel and each module. The following function call
sequence is executed:
machine\_\_create\_kernel\_maps
machine\_\_create\_module
modules\_\_parse
machine\_\_create\_module --> for each line in /proc/modules
arch\_\_fix\_module\_text\_start
Function arch\_\_fix\_module\_text\_start() is s390 specific. It opens
file /sys/module//sections/.text to extract the module's .text
section start address. On s390 the module loader prepends a header
before the first section, whereas on x86 the module's text section
address is identical the the module's load address.
However module section files are root readable only. For non-root the
read operation fails and machine\_\_create\_module() returns an error.
Command perf record does not generate any PERF\_RECORD\_MMAP record
for loaded modules. Later command perf report complains about missing
module maps.
To fix this function arch\_\_fix\_module\_text\_start() always returns
success. For root users there is no change, for non-root users
the module's load address is used as module's text start address
(the prepended header then counts as part of the text section).
This enable non-root users to use module symbols and avoid the
warning when perf report is executed.
Output before:
[tmricht@m83lp54 perf]$ ./perf report -D | fgrep MMAP
0 0x168 [0x50]: PERF\_RECORD\_MMAP ... x [kernel.kallsyms]\_text
Output after:
[tmricht@m83lp54 perf]$ ./perf report -D | fgrep MMAP
0 0x168 [0x50]: PERF\_RECORD\_MMAP ... x [kernel.kallsyms]\_text
0 0x1b8 [0x98]: PERF\_RECORD\_MMAP ... x /lib/modules/.../autofs4.ko.xz
0 0x250 [0xa8]: PERF\_RECORD\_MMAP ... x /lib/modules/.../sha\_common.ko.xz
0 0x2f8 [0x98]: PERF\_RECORD\_MMAP ... x /lib/modules/.../des\_generic.ko.xz
Signed-off-by: Thomas Richter
Reviewed-by: Hendrik Brueckner
Cc: Heiko Carstens
Link: http://lkml.kernel.org/r/20190522144601.50763-4-tmricht@linux.ibm.com
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Sasha Levin
commit 9b73f5b89ebbc8ae75409f9b9320a1d21e54d574
Author: Namhyung Kim
Date: Wed May 22 14:32:48 2019 +0900
perf namespace: Protect reading thread's namespace
[ Upstream commit 6584140ba9e6762dd7ec73795243289b914f31f9 ]
It seems that the current code lacks holding the namespace lock in
thread\_\_namespaces(). Otherwise it can see inconsistent results.
Signed-off-by: Namhyung Kim
Cc: Hari Bathini
Cc: Jiri Olsa
Cc: Krister Johansen
Link: http://lkml.kernel.org/r/20190522053250.207156-2-namhyung@kernel.org
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Sasha Levin
commit 4a705e5ce7206bf020401f0c7909060babe858ac
Author: Harald Freudenberger
Date: Tue May 21 13:50:09 2019 +0200
s390/zcrypt: Fix wrong dispatching for control domain CPRBs
[ Upstream commit 7379e652797c0b9b5f6caea1576f2dff9ce6a708 ]
The zcrypt device driver does not handle CPRBs which address
a control domain correctly. This fix introduces a workaround:
The domain field of the request CPRB is checked if there is
a valid domain value in there. If this is true and the value
is a control only domain (a domain which is enabled in the
crypto config ADM mask but disabled in the AQM mask) the
CPRB is forwarded to the default usage domain. If there is
no default domain, the request is rejected with an ENODEV.
This fix is important for maintaining crypto adapters. For
example one LPAR can use a crypto adapter domain ('Control
and Usage') but another LPAR needs to be able to maintain
this adapter domain ('Control'). Scenarios like this did
not work properly and the patch enables this.
Signed-off-by: Harald Freudenberger
Signed-off-by: Heiko Carstens
Signed-off-by: Sasha Levin
commit dc6c4cbde736bccd22287ee6f95375d6d59d428a
Author: Shawn Landden
Date: Sat May 18 15:32:38 2019 -0300
perf data: Fix 'strncat may truncate' build failure with recent gcc
[ Upstream commit 97acec7df172cd1e450f81f5e293c0aa145a2797 ]
This strncat() is safe because the buffer was allocated with zalloc(),
however gcc doesn't know that. Since the string always has 4 non-null
bytes, just use memcpy() here.
CC /home/shawn/linux/tools/perf/util/data-convert-bt.o
In file included from /usr/include/string.h:494,
from /home/shawn/linux/tools/lib/traceevent/event-parse.h:27,
from util/data-convert-bt.c:22:
In function ‘strncat’,
inlined from ‘string\_set\_value’ at util/data-convert-bt.c:274:4:
/usr/include/powerpc64le-linux-gnu/bits/string\_fortified.h:136:10: error: ‘\_\_builtin\_strncat’ output may be truncated copying 4 bytes from a string of length 4 [-Werror=stringop-truncation]
136 | return \_\_builtin\_\_\_strncat\_chk (\_\_dest, \_\_src, \_\_len, \_\_bos (\_\_dest));
| ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Signed-off-by: Shawn Landden
Cc: Adrian Hunter
Cc: Jiri Olsa
Cc: Namhyung Kim
Cc: Wang Nan
LPU-Reference: 20190518183238.10954-1-shawn@git.icu
Link: https://lkml.kernel.org/n/tip-289f1jice17ta7tr3tstm9jm@git.kernel.org
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Sasha Levin
commit 3f81d5ff634022c14b9f359f14698adeb1226a7a
Author: Sahitya Tummala
Date: Thu Jan 3 16:48:15 2019 +0530
configfs: Fix use-after-free when accessing sd->s\_dentry
[ Upstream commit f6122ed2a4f9c9c1c073ddf6308d1b2ac10e0781 ]
In the vfs\_statx() context, during path lookup, the dentry gets
added to sd->s\_dentry via configfs\_attach\_attr(). In the end,
vfs\_statx() kills the dentry by calling path\_put(), which invokes
configfs\_d\_iput(). Ideally, this dentry must be removed from
sd->s\_dentry but it doesn't if the sd->s\_count >= 3. As a result,
sd->s\_dentry is holding reference to a stale dentry pointer whose
memory is already freed up. This results in use-after-free issue,
when this stale sd->s\_dentry is accessed later in
configfs\_readdir() path.
This issue can be easily reproduced, by running the LTP test case -
sh fs\_racer\_file\_list.sh /config
(https://github.com/linux-test-project/ltp/blob/master/testcases/kernel/fs/racer/fs\_racer\_file\_list.sh)
Fixes: 76ae281f6307 ('configfs: fix race between dentry put and lookup')
Signed-off-by: Sahitya Tummala
Signed-off-by: Christoph Hellwig
Signed-off-by: Sasha Levin
commit 0cad0ddd2c766d2200214c4d00d2cbd644c05711
Author: Bard Liao
Date: Mon May 27 00:58:32 2019 +0800
ALSA: hda - Force polling mode on CNL for fixing codec communication
[ Upstream commit fa763f1b2858752e6150ffff46886a1b7faffc82 ]
We observed the same issue as reported by commit a8d7bde23e7130686b7662
("ALSA: hda - Force polling mode on CFL for fixing codec communication")
We don't have a better solution. So apply the same workaround to CNL.
Signed-off-by: Bard Liao
Signed-off-by: Takashi Iwai
Signed-off-by: Sasha Levin
commit bafddfd69436e264abd883f7e3c1a724bcbfd98d
Author: Yingjoe Chen
Date: Tue May 7 22:20:32 2019 +0800
i2c: dev: fix potential memory leak in i2cdev\_ioctl\_rdwr
[ Upstream commit a0692f0eef91354b62c2b4c94954536536be5425 ]
If I2C\_M\_RECV\_LEN check failed, msgs[i].buf allocated by memdup\_user
will not be freed. Pump index up so it will be freed.
Fixes: 838bfa6049fb ("i2c-dev: Add support for I2C\_M\_RECV\_LEN")
Signed-off-by: Yingjoe Chen
Signed-off-by: Wolfram Sang
Signed-off-by: Sasha Levin
commit 9385e669d4532aea92c0780da0be97ba1e23aaad
Author: Dmitry Bogdanov
Date: Sat May 25 09:58:03 2019 +0000
net: aquantia: fix LRO with FCS error
[ Upstream commit eaeb3b7494ba9159323814a8ce8af06a9277d99b ]
Driver stops producing skbs on ring if a packet with FCS error
was coalesced into LRO session. Ring gets hang forever.
Thats a logical error in driver processing descriptors:
When rx\_stat indicates MAC Error, next pointer and eop flags
are not filled. This confuses driver so it waits for descriptor 0
to be filled by HW.
Solution is fill next pointer and eop flag even for packets with FCS error.
Fixes: bab6de8fd180b ("net: ethernet: aquantia: Atlantic A0 and B0 specific functions.")
Signed-off-by: Igor Russkikh
Signed-off-by: Dmitry Bogdanov
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 4a6ff3e2df5cf1131d51a35c650f96928c248ebb
Author: Igor Russkikh
Date: Sat May 25 09:57:59 2019 +0000
net: aquantia: tx clean budget logic error
[ Upstream commit 31bafc49a7736989e4c2d9f7280002c66536e590 ]
In case no other traffic happening on the ring, full tx cleanup
may not be completed. That may cause socket buffer to overflow
and tx traffic to stuck until next activity on the ring happens.
This is due to logic error in budget variable decrementor.
Variable is compared with zero, and then post decremented,
causing it to become MAX\_INT. Solution is remove decrementor
from the `for` statement and rewrite it in a clear way.
Fixes: b647d3980948e ("net: aquantia: Add tx clean budget and valid budget handling logic")
Signed-off-by: Igor Russkikh
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 7251bb77528e14ba3e08fe7f0b5e4be6fd0cba0f
Author: Lucas Stach
Date: Tue May 21 14:53:40 2019 +0200
drm/etnaviv: lock MMU while dumping core
[ Upstream commit 1396500d673bd027683a0609ff84dca7eb6ea2e7 ]
The devcoredump needs to operate on a stable state of the MMU while
it is writing the MMU state to the coredump. The missing lock
allowed both the userspace submit, as well as the GPU job finish
paths to mutate the MMU state while a coredump is under way.
Fixes: a8c21a5451d8 (drm/etnaviv: add initial etnaviv DRM driver)
Reported-by: David Jander
Signed-off-by: Lucas Stach
Tested-by: David Jander
Reviewed-by: Philipp Zabel
Signed-off-by: Sasha Levin
commit cc8ba5f3b9755882555762a2c4fadc56f4517228
Author: Rafael J. Wysocki
Date: Thu May 16 12:42:20 2019 +0200
ACPI/PCI: PM: Add missing wakeup.flags.valid checks
[ Upstream commit 9a51c6b1f9e0239a9435db036b212498a2a3b75c ]
Both acpi\_pci\_need\_resume() and acpi\_dev\_needs\_resume() check if the
current ACPI wakeup configuration of the device matches what is
expected as far as system wakeup from sleep states is concerned, as
reflected by the device\_may\_wakeup() return value for the device.
However, they only should do that if wakeup.flags.valid is set for
the device's ACPI companion, because otherwise the wakeup.prepare\_count
value for it is meaningless.
Add the missing wakeup.flags.valid checks to these functions.
Signed-off-by: Rafael J. Wysocki
Reviewed-by: Mika Westerberg
Signed-off-by: Sasha Levin
commit ff6f3ec62db15bc8b8d07af351e0ffa50ea35acd
Author: Kees Cook
Date: Fri May 24 13:20:19 2019 -0700
net: tulip: de4x5: Drop redundant MODULE\_DEVICE\_TABLE()
[ Upstream commit 3e66b7cc50ef921121babc91487e1fb98af1ba6e ]
Building with Clang reports the redundant use of MODULE\_DEVICE\_TABLE():
drivers/net/ethernet/dec/tulip/de4x5.c:2110:1: error: redefinition of '\_\_mod\_eisa\_\_de4x5\_eisa\_ids\_device\_table'
MODULE\_DEVICE\_TABLE(eisa, de4x5\_eisa\_ids);
^
./include/linux/module.h:229:21: note: expanded from macro 'MODULE\_DEVICE\_TABLE'
extern typeof(name) \_\_mod\_##type##\_\_##name##\_device\_table \
^
:90:1: note: expanded from here
\_\_mod\_eisa\_\_de4x5\_eisa\_ids\_device\_table
^
drivers/net/ethernet/dec/tulip/de4x5.c:2100:1: note: previous definition is here
MODULE\_DEVICE\_TABLE(eisa, de4x5\_eisa\_ids);
^
./include/linux/module.h:229:21: note: expanded from macro 'MODULE\_DEVICE\_TABLE'
extern typeof(name) \_\_mod\_##type##\_\_##name##\_device\_table \
^
:85:1: note: expanded from here
\_\_mod\_eisa\_\_de4x5\_eisa\_ids\_device\_table
^
This drops the one further from the table definition to match the common
use of MODULE\_DEVICE\_TABLE().
Fixes: 07563c711fbc ("EISA bus MODALIAS attributes support")
Signed-off-by: Kees Cook
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 632ebf6d706070821e2fcf8a764e23adf4251d18
Author: Ioana Radulescu
Date: Fri May 24 18:15:16 2019 +0300
dpaa2-eth: Use PTR\_ERR\_OR\_ZERO where appropriate
[ Upstream commit bd8460fa4de46e9d6177af4fe33bf0763a7af4b7 ]
Use PTR\_ERR\_OR\_ZERO instead of PTR\_ERR in cases where
zero is a valid input. Reported by smatch.
Signed-off-by: Ioana Radulescu
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 399a7963f8b3d863f87405f1f4ef339be779ed69
Author: Ioana Radulescu
Date: Fri May 24 18:15:15 2019 +0300
dpaa2-eth: Fix potential spectre issue
[ Upstream commit 5a20a093d965560f632b2ec325f8876918f78165 ]
Smatch reports a potential spectre vulnerability in the dpaa2-eth
driver, where the value of rxnfc->fs.location (which is provided
from user-space) is used as index in an array.
Add a call to array\_index\_nospec() to sanitize the access.
Signed-off-by: Ioana Radulescu
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit fd670f49dd3054679d35f7da5ec9f31619f16dd0
Author: Pavel Begunkov
Date: Sun May 26 12:35:47 2019 +0300
io\_uring: Fix \_\_io\_uring\_register() false success
[ Upstream commit a278682dad37fd2f8d2f30d8e84e376a856ab472 ]
If io\_copy\_iov() fails, it will break the loop and report success,
albeit partially completed operation.
Signed-off-by: Pavel Begunkov
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
commit 84296dc648061f565ca99676aab575dd465c6d3c
Author: Biao Huang
Date: Fri May 24 14:26:09 2019 +0800
net: stmmac: dwmac-mediatek: modify csr\_clk value to fix mdio read/write fail
[ Upstream commit f4ca7a9260dfe700f2a16f0881825de625067515 ]
1. the frequency of csr clock is 66.5MHz, so the csr\_clk value should
be 0 other than 5.
2. the csr\_clk can be got from device tree, so remove initialization here.
Fixes: 9992f37e346b ("stmmac: dwmac-mediatek: add support for mt2712")
Signed-off-by: Biao Huang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 32e577bc4bb57fd5f5225adb229f7443ccaa74af
Author: Biao Huang
Date: Fri May 24 14:26:08 2019 +0800
net: stmmac: fix csr\_clk can't be zero issue
[ Upstream commit 5e7f7fc538d894b2d9aa41876b8dcf35f5fe11e6 ]
The specific clk\_csr value can be zero, and
stmmac\_clk is necessary for MDC clock which can be set dynamically.
So, change the condition from plat->clk\_csr to plat->stmmac\_clk to
fix clk\_csr can't be zero issue.
Fixes: cd7201f477b9 ("stmmac: MDC clock dynamically based on the csr clock input")
Signed-off-by: Biao Huang
Acked-by: Alexandre TORGUE
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit 88bf99a6fe9b824cf1f37610f48bcc26198a676a
Author: Biao Huang
Date: Fri May 24 14:26:07 2019 +0800
net: stmmac: update rx tail pointer register to fix rx dma hang issue.
[ Upstream commit 4523a5611526709ec9b4e2574f1bb7818212651e ]
Currently we will not update the receive descriptor tail pointer in
stmmac\_rx\_refill. Rx dma will think no available descriptors and stop
once received packets exceed DMA\_RX\_SIZE, so that the rx only test will fail.
Update the receive tail pointer in stmmac\_rx\_refill to add more descriptors
to the rx channel, so packets can be received continually
Fixes: 54139cf3bb33 ("net: stmmac: adding multiple buffers for rx")
Signed-off-by: Biao Huang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit fc113d17aedc4a7000a30c1d16fa358d8053c4f3
Author: Randy Dunlap
Date: Thu May 23 15:00:41 2019 -0700
gpio: fix gpio-adp5588 build errors
[ Upstream commit e9646f0f5bb62b7d43f0968f39d536cfe7123b53 ]
The gpio-adp5588 driver uses interfaces that are provided by
GPIOLIB\_IRQCHIP, so select that symbol in its Kconfig entry.
Fixes these build errors:
../drivers/gpio/gpio-adp5588.c: In function ‘adp5588\_irq\_handler’:
../drivers/gpio/gpio-adp5588.c:266:26: error: ‘struct gpio\_chip’ has no member named ‘irq’
dev->gpio\_chip.irq.domain, gpio));
^
../drivers/gpio/gpio-adp5588.c: In function ‘adp5588\_irq\_setup’:
../drivers/gpio/gpio-adp5588.c:298:2: error: implicit declaration of function ‘gpiochip\_irqchip\_add\_nested’ [-Werror=implicit-function-declaration]
ret = gpiochip\_irqchip\_add\_nested(&dev->gpio\_chip,
^
../drivers/gpio/gpio-adp5588.c:307:2: error: implicit declaration of function ‘gpiochip\_set\_nested\_irqchip’ [-Werror=implicit-function-declaration]
gpiochip\_set\_nested\_irqchip(&dev->gpio\_chip,
^
Fixes: 459773ae8dbb ("gpio: adp5588-gpio: support interrupt controller")
Reported-by: kbuild test robot
Signed-off-by: Randy Dunlap
Cc: linux-gpio@vger.kernel.org
Reviewed-by: Bartosz Golaszewski
Acked-by: Michael Hennerich
Signed-off-by: Linus Walleij
Signed-off-by: Sasha Levin
commit f808486448a2157a6254683822548c806312bde0
Author: Peter Zijlstra
Date: Fri May 17 13:52:33 2019 +0200
perf/ring-buffer: Always use {READ,WRITE}\_ONCE() for rb->user\_page data
[ Upstream commit 4d839dd9e4356bbacf3eb0ab13a549b83b008c21 ]
We must use {READ,WRITE}\_ONCE() on rb->user\_page data such that
concurrent usage will see whole values. A few key sites were missing
this.
Suggested-by: Yabin Cui
Signed-off-by: Peter Zijlstra (Intel)
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Cc: acme@kernel.org
Cc: mark.rutland@arm.com
Cc: namhyung@kernel.org
Fixes: 7b732a750477 ("perf\_counter: new output ABI - part 1")
Link: http://lkml.kernel.org/r/20190517115418.394192145@infradead.org
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit fc1b40e55d389e9c55a42ad88a796df4f5dbb1ac
Author: Peter Zijlstra
Date: Fri May 17 13:52:32 2019 +0200
perf/ring\_buffer: Add ordering to rb->nest increment
[ Upstream commit 3f9fbe9bd86c534eba2faf5d840fd44c6049f50e ]
Similar to how decrementing rb->next too early can cause data\_head to
(temporarily) be observed to go backward, so too can this happen when
we increment too late.
This barrier() ensures the rb->head load happens after the increment,
both the one in the 'goto again' path, as the one from
perf\_output\_get\_handle() -- albeit very unlikely to matter for the
latter.
Suggested-by: Yabin Cui
Signed-off-by: Peter Zijlstra (Intel)
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Cc: acme@kernel.org
Cc: mark.rutland@arm.com
Cc: namhyung@kernel.org
Fixes: ef60777c9abd ("perf: Optimize the perf\_output() path by removing IRQ-disables")
Link: http://lkml.kernel.org/r/20190517115418.309516009@infradead.org
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit 6421f2ef8525b9836971d3e17cd07fb4462a44c9
Author: Yabin Cui
Date: Fri May 17 13:52:31 2019 +0200
perf/ring\_buffer: Fix exposing a temporarily decreased data\_head
[ Upstream commit 1b038c6e05ff70a1e66e3e571c2e6106bdb75f53 ]
In perf\_output\_put\_handle(), an IRQ/NMI can happen in below location and
write records to the same ring buffer:
...
local\_dec\_and\_test(&rb->nest)
... <-- an IRQ/NMI can happen here
rb->user\_page->data\_head = head;
...
In this case, a value A is written to data\_head in the IRQ, then a value
B is written to data\_head after the IRQ. And A > B. As a result,
data\_head is temporarily decreased from A to B. And a reader may see
data\_head < data\_tail if it read the buffer frequently enough, which
creates unexpected behaviors.
This can be fixed by moving dec(&rb->nest) to after updating data\_head,
which prevents the IRQ/NMI above from updating data\_head.
[ Split up by peterz. ]
Signed-off-by: Yabin Cui
Signed-off-by: Peter Zijlstra (Intel)
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Namhyung Kim
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Cc: mark.rutland@arm.com
Fixes: ef60777c9abd ("perf: Optimize the perf\_output() path by removing IRQ-disables")
Link: http://lkml.kernel.org/r/20190517115418.224478157@infradead.org
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit 436b1cb41173c73a1768f2e23cb8bb09c5a6deea
Author: Frank van der Linden
Date: Wed May 22 22:17:45 2019 +0000
x86/CPU/AMD: Don't force the CPB cap when running under a hypervisor
[ Upstream commit 2ac44ab608705948564791ce1d15d43ba81a1e38 ]
For F17h AMD CPUs, the CPB capability ('Core Performance Boost') is forcibly set,
because some versions of that chip incorrectly report that they do not have it.
However, a hypervisor may filter out the CPB capability, for good
reasons. For example, KVM currently does not emulate setting the CPB
bit in MSR\_K7\_HWCR, and unchecked MSR access errors will be thrown
when trying to set it as a guest:
unchecked MSR access error: WRMSR to 0xc0010015 (tried to write 0x0000000001000011) at rIP: 0xffffffff890638f4 (native\_write\_msr+0x4/0x20)
Call Trace:
boost\_set\_msr+0x50/0x80 [acpi\_cpufreq]
cpuhp\_invoke\_callback+0x86/0x560
sort\_range+0x20/0x20
cpuhp\_thread\_fun+0xb0/0x110
smpboot\_thread\_fn+0xef/0x160
kthread+0x113/0x130
kthread\_create\_worker\_on\_cpu+0x70/0x70
ret\_from\_fork+0x35/0x40
To avoid this issue, don't forcibly set the CPB capability for a CPU
when running under a hypervisor.
Signed-off-by: Frank van der Linden
Acked-by: Borislav Petkov
Cc: Andy Lutomirski
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: bp@alien8.de
Cc: jiaxun.yang@flygoat.com
Fixes: 0237199186e7 ("x86/CPU/AMD: Set the CPB bit unconditionally on F17h")
Link: http://lkml.kernel.org/r/20190522221745.GA15789@dev-dsk-fllinden-2c-c1893d73.us-west-2.amazon.com
[ Minor edits to the changelog. ]
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit 9f9fb3a6bbde028236be007d688d02e91d812a5f
Author: Dan Carpenter
Date: Wed May 22 11:45:13 2019 +0300
mISDN: make sure device name is NUL terminated
[ Upstream commit ccfb62f27beb295103e9392462b20a6ed807d0ea ]
The user can change the device\_name with the IMSETDEVNAME ioctl, but we
need to ensure that the user's name is NUL terminated. Otherwise it
could result in a buffer overflow when we copy the name back to the user
with IMGETDEVINFO ioctl.
I also changed two strcpy() calls which handle the name to strscpy().
Hopefully, there aren't any other ways to create a too long name, but
it's nice to do this as a kernel hardening measure.
Signed-off-by: Dan Carpenter
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
commit fc0193f074635325859cab6ea59eb2cd1ef3da85
Author: Jia-Ju Bai
Date: Wed May 22 14:33:58 2019 +0300
usb: xhci: Fix a potential null pointer dereference in xhci\_debugfs\_create\_endpoint()
[ Upstream commit 5bce256f0b528624a34fe907db385133bb7be33e ]
In xhci\_debugfs\_create\_slot(), kzalloc() can fail and
dev->debugfs\_private will be NULL.
In xhci\_debugfs\_create\_endpoint(), dev->debugfs\_private is used without
any null-pointer check, and can cause a null pointer dereference.
To fix this bug, a null-pointer check is added in
xhci\_debugfs\_create\_endpoint().
This bug is found by a runtime fuzzing tool named FIZZER written by us.
[subjet line change change, add potential -Mathais]
Signed-off-by: Jia-Ju Bai
Reviewed-by: Greg Kroah-Hartman
Signed-off-by: Mathias Nyman
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit b53f68045b8b668660a8ccacbd2616589c1c4479
Author: Anju T Sudhakar
Date: Mon May 20 14:27:53 2019 +0530
powerpc/powernv: Return for invalid IMC domain
[ Upstream commit b59bd3527fe3c1939340df558d7f9d568fc9f882 ]
Currently init\_imc\_pmu() can fail either because we try to register an
IMC unit with an invalid domain (i.e an IMC node not supported by the
kernel) or something went wrong while registering a valid IMC unit. In
both the cases kernel provides a 'Register failed' error message.
For example when trace-imc node is not supported by the kernel, but
skiboot advertises a trace-imc node we print:
IMC Unknown Device type
IMC PMU (null) Register failed
To avoid confusion just print the unknown device type message, before
attempting PMU registration, so the second message isn't printed.
Fixes: 8f95faaac56c ("powerpc/powernv: Detect and create IMC device")
Reported-by: Pavaman Subramaniyam
Signed-off-by: Anju T Sudhakar
Reviewed-by: Madhavan Srinivasan
[mpe: Reword change log a bit]
Signed-off-by: Michael Ellerman
Signed-off-by: Sasha Levin
commit 85984f9ba6d62a10a7e1bc71e391c579425cdc09
Author: Tony Lindgren
Date: Mon May 6 14:08:54 2019 -0700
clk: ti: clkctrl: Fix clkdm\_clk handling
[ Upstream commit 1cc54078d104f5b4d7e9f8d55362efa5a8daffdb ]
We need to always call clkdm\_clk\_enable() and clkdm\_clk\_disable() even
the clkctrl clock(s) enabled for the domain do not have any gate register
bits. Otherwise clockdomains may never get enabled except when devices get
probed with the legacy "ti,hwmods" devicetree property.
Fixes: 88a172526c32 ("clk: ti: add support for clkctrl clocks")
Signed-off-by: Tony Lindgren
Signed-off-by: Stephen Boyd
Signed-off-by: Sasha Levin
commit 9141d4bfc8bb2ee2da9b5528d4e2c83d804bf77e
Author: Jeffrin Jose T
Date: Wed May 15 12:14:04 2019 +0530
selftests: netfilter: missing error check when setting up veth interface
[ Upstream commit 82ce6eb1dd13fd12e449b2ee2c2ec051e6f52c43 ]
A test for the basic NAT functionality uses ip command which needs veth
device. There is a condition where the kernel support for veth is not
compiled into the kernel and the test script breaks. This patch contains
code for reasonable error display and correct code exit.
Signed-off-by: Jeffrin Jose T
Acked-by: Florian Westphal
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 1a9e8e2e591080d1f358fd4f481b715ddec83ccc
Author: YueHaibing
Date: Fri May 17 22:31:49 2019 +0800
ipvs: Fix use-after-free in ip\_vs\_in
[ Upstream commit 719c7d563c17b150877cee03a4b812a424989dfa ]
BUG: KASAN: use-after-free in ip\_vs\_in.part.29+0xe8/0xd20 [ip\_vs]
Read of size 4 at addr ffff8881e9b26e2c by task sshd/5603
CPU: 0 PID: 5603 Comm: sshd Not tainted 4.19.39+ #30
Hardware name: Red Hat KVM, BIOS 0.5.1 01/01/2011
Call Trace:
dump\_stack+0x71/0xab
print\_address\_description+0x6a/0x270
kasan\_report+0x179/0x2c0
ip\_vs\_in.part.29+0xe8/0xd20 [ip\_vs]
ip\_vs\_in+0xd8/0x170 [ip\_vs]
nf\_hook\_slow+0x5f/0xe0
\_\_ip\_local\_out+0x1d5/0x250
ip\_local\_out+0x19/0x60
\_\_tcp\_transmit\_skb+0xba1/0x14f0
tcp\_write\_xmit+0x41f/0x1ed0
? \_copy\_from\_iter\_full+0xca/0x340
\_\_tcp\_push\_pending\_frames+0x52/0x140
tcp\_sendmsg\_locked+0x787/0x1600
? tcp\_sendpage+0x60/0x60
? inet\_sk\_set\_state+0xb0/0xb0
tcp\_sendmsg+0x27/0x40
sock\_sendmsg+0x6d/0x80
sock\_write\_iter+0x121/0x1c0
? sock\_sendmsg+0x80/0x80
\_\_vfs\_write+0x23e/0x370
vfs\_write+0xe7/0x230
ksys\_write+0xa1/0x120
? \_\_ia32\_sys\_read+0x50/0x50
? \_\_audit\_syscall\_exit+0x3ce/0x450
do\_syscall\_64+0x73/0x200
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
RIP: 0033:0x7ff6f6147c60
Code: 73 01 c3 48 8b 0d 28 12 2d 00 f7 d8 64 89 01 48 83 c8 ff c3 66 0f 1f 44 00 00 83 3d 5d 73 2d 00 00 75 10 b8 01 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 31 c3 48 83
RSP: 002b:00007ffd772ead18 EFLAGS: 00000246 ORIG\_RAX: 0000000000000001
RAX: ffffffffffffffda RBX: 0000000000000034 RCX: 00007ff6f6147c60
RDX: 0000000000000034 RSI: 000055df30a31270 RDI: 0000000000000003
RBP: 000055df30a31270 R08: 0000000000000000 R09: 0000000000000000
R10: 00007ffd772ead70 R11: 0000000000000246 R12: 00007ffd772ead74
R13: 00007ffd772eae20 R14: 00007ffd772eae24 R15: 000055df2f12ddc0
Allocated by task 6052:
kasan\_kmalloc+0xa0/0xd0
\_\_kmalloc+0x10a/0x220
ops\_init+0x97/0x190
register\_pernet\_operations+0x1ac/0x360
register\_pernet\_subsys+0x24/0x40
0xffffffffc0ea016d
do\_one\_initcall+0x8b/0x253
do\_init\_module+0xe3/0x335
load\_module+0x2fc0/0x3890
\_\_do\_sys\_finit\_module+0x192/0x1c0
do\_syscall\_64+0x73/0x200
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
Freed by task 6067:
\_\_kasan\_slab\_free+0x130/0x180
kfree+0x90/0x1a0
ops\_free\_list.part.7+0xa6/0xc0
unregister\_pernet\_operations+0x18b/0x1f0
unregister\_pernet\_subsys+0x1d/0x30
ip\_vs\_cleanup+0x1d/0xd2f [ip\_vs]
\_\_x64\_sys\_delete\_module+0x20c/0x300
do\_syscall\_64+0x73/0x200
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
The buggy address belongs to the object at ffff8881e9b26600 which belongs to the cache kmalloc-4096 of size 4096
The buggy address is located 2092 bytes inside of 4096-byte region [ffff8881e9b26600, ffff8881e9b27600)
The buggy address belongs to the page:
page:ffffea0007a6c800 count:1 mapcount:0 mapping:ffff888107c0e600 index:0x0 compound\_mapcount: 0
flags: 0x17ffffc0008100(slab|head)
raw: 0017ffffc0008100 dead000000000100 dead000000000200 ffff888107c0e600
raw: 0000000000000000 0000000080070007 00000001ffffffff 0000000000000000
page dumped because: kasan: bad access detected
while unregistering ipvs module, ops\_free\_list calls
\_\_ip\_vs\_cleanup, then nf\_unregister\_net\_hooks be called to
do remove nf hook entries. It need a RCU period to finish,
however net->ipvs is set to NULL immediately, which will
trigger NULL pointer dereference when a packet is hooked
and handled by ip\_vs\_in where net->ipvs is dereferenced.
Another scene is ops\_free\_list call ops\_free to free the
net\_generic directly while \_\_ip\_vs\_cleanup finished, then
calling ip\_vs\_in will triggers use-after-free.
This patch moves nf\_unregister\_net\_hooks from \_\_ip\_vs\_cleanup()
to \_\_ip\_vs\_dev\_cleanup(), where rcu\_barrier() is called by
unregister\_pernet\_device -> unregister\_pernet\_operations,
that will do the needed grace period.
Reported-by: Hulk Robot
Fixes: efe41606184e ("ipvs: convert to use pernet nf\_hook api")
Suggested-by: Julian Anastasov
Signed-off-by: YueHaibing
Acked-by: Julian Anastasov
Signed-off-by: Simon Horman
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 4e7ec2e90f45e85f69179658576e322f0b261403
Author: Phil Sutter
Date: Wed May 15 20:15:32 2019 +0200
netfilter: nft\_fib: Fix existence check support
[ Upstream commit e633508a95289489d28faacb68b32c3e7e68ef6f ]
NFTA\_FIB\_F\_PRESENT flag was not always honored since eval functions did
not call nft\_fib\_store\_result in all cases.
Given that in all callsites there is a struct net\_device pointer
available which holds the interface data to be stored in destination
register, simplify nft\_fib\_store\_result() to just accept that pointer
instead of the nft\_pktinfo pointer and interface index. This also
allows to drop the index to interface lookup previously needed to get
the name associated with given index.
Fixes: 055c4b34b94f6 ("netfilter: nft\_fib: Support existence check")
Signed-off-by: Phil Sutter
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit eaa5eb41f71600172ed1e76de26b7fe0a6902ad0
Author: Jagdish Motwani
Date: Mon May 13 23:47:40 2019 +0530
netfilter: nf\_queue: fix reinject verdict handling
[ Upstream commit 946c0d8e6ed43dae6527e878d0077c1e11015db0 ]
This patch fixes netfilter hook traversal when there are more than 1 hooks
returning NF\_QUEUE verdict. When the first queue reinjects the packet,
'nf\_reinject' starts traversing hooks with a proper hook\_index. However,
if it again receives a NF\_QUEUE verdict (by some other netfilter hook), it
queues the packet with a wrong hook\_index. So, when the second queue
reinjects the packet, it re-executes hooks in between.
Fixes: 960632ece694 ("netfilter: convert hook list to an array")
Signed-off-by: Jagdish Motwani
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 1159921769f280a7e96c1cf726b78ec4a05e6837
Author: Stephane Eranian
Date: Mon May 20 17:52:46 2019 -0700
perf/x86/intel/ds: Fix EVENT vs. UEVENT PEBS constraints
[ Upstream commit 23e3983a466cd540ffdd2bbc6e0c51e31934f941 ]
This patch fixes an bug revealed by the following commit:
6b89d4c1ae85 ("perf/x86/intel: Fix INTEL\_FLAGS\_EVENT\_CONSTRAINT\* masking")
That patch modified INTEL\_FLAGS\_EVENT\_CONSTRAINT() to only look at the event code
when matching a constraint. If code+umask were needed, then the
INTEL\_FLAGS\_UEVENT\_CONSTRAINT() macro was needed instead.
This broke with some of the constraints for PEBS events.
Several of them, including the one used for cycles:p, cycles:pp, cycles:ppp
fell in that category and caused the event to be rejected in PEBS mode.
In other words, on some platforms a cmdline such as:
$ perf top -e cycles:pp
would fail with -EINVAL.
This patch fixes this bug by properly using INTEL\_FLAGS\_UEVENT\_CONSTRAINT()
when needed in the PEBS constraint tables.
Reported-by: Ingo Molnar
Signed-off-by: Stephane Eranian
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Vince Weaver
Cc: kan.liang@intel.com
Link: http://lkml.kernel.org/r/20190521005246.423-1-eranian@google.com
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
commit ac453193740951d77f3e680c1d1049191317a35b
Author: Florian Westphal
Date: Tue Apr 30 14:53:11 2019 +0200
netfilter: nf\_tables: fix oops during rule dump
[ Upstream commit 2c82c7e724ff51cab78e1afd5c2aaa31994fe41e ]
We can oops in nf\_tables\_fill\_rule\_info().
Its not possible to fetch previous element in rcu-protected lists
when deletions are not prevented somehow: list\_del\_rcu poisons
the ->prev pointer value.
Before rcu-conversion this was safe as dump operations did hold
nfnetlink mutex.
Pass previous rule as argument, obtained by keeping a pointer to
the previous rule during traversal.
Fixes: d9adf22a291883 ("netfilter: nf\_tables: use call\_rcu in netlink dumps")
Signed-off-by: Florian Westphal
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Sasha Levin
commit 347f026eba70ecce85998fc48cad72f465911a52
Author: Kai-Heng Feng
Date: Tue Apr 30 16:37:53 2019 +0800
pinctrl: intel: Clear interrupt status in mask/unmask callback
[ Upstream commit 670784fb4ebe54434e263837390e358405031d9e ]
Commit a939bb57cd47 ("pinctrl: intel: implement gpio\_irq\_enable") was
added because clearing interrupt status bit is required to avoid
unexpected behavior.
Turns out the unmask callback also needs the fix, which can solve weird
IRQ triggering issues on I2C touchpad ELAN1200.
Signed-off-by: Kai-Heng Feng
Signed-off-by: Andy Shevchenko
Signed-off-by: Sasha Levin
commit 5c454589e0fc859300c4152a85fc88b6dc0c5315
Author: Dan Carpenter
Date: Wed May 15 12:52:23 2019 +0300
staging: wilc1000: Fix some double unlock bugs in wilc\_wlan\_cleanup()
[ Upstream commit fea69916360468e364a4988db25a5afa835f3406 ]
If ->hif\_read\_reg() or ->hif\_write\_reg() fail then the code unlocks
and keeps executing. It should just return.
Fixes: c5c77ba18ea6 ("staging: wilc1000: Add SDIO/SPI 802.11 driver")
Signed-off-by: Dan Carpenter
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 24e560bb1ba2c4192c6a23fc55c2eb888efc293e
Author: Dan Carpenter
Date: Mon May 13 14:07:18 2019 +0300
Staging: vc04\_services: Fix a couple error codes
[ Upstream commit ca4e4efbefbbdde0a7bb3023ea08d491f4daf9b9 ]
These are accidentally returning positive EINVAL instead of negative
-EINVAL. Some of the callers treat positive values as success.
Fixes: 7b3ad5abf027 ("staging: Import the BCM2835 MMAL-based V4L2 camera driver.")
Signed-off-by: Dan Carpenter
Acked-by: Stefan Wahren
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 41fa707720c9e71f79833c0960be2d01de65c1e7
Author: Chengguang Xu
Date: Mon May 6 19:01:02 2019 +0800
staging: erofs: set sb->s\_root to NULL when failing from \_\_getname()
[ Upstream commit f2dcb8841e6b155da098edae09125859ef7e853d ]
Set sb->s\_root to NULL when failing from \_\_getname(),
so that we can avoid double dput and unnecessary operations
in generic\_shutdown\_super().
Signed-off-by: Chengguang Xu
Reviewed-by: Chao Yu
Reviewed-by: Gao Xiang
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
commit 83907b7c58ddbf80574d154d12f5e4e1701989a2
Author: Steve Moskovchenko
Date: Tue Apr 2 23:28:56 2019 -0700
iio: imu: mpu6050: Fix FIFO layout for ICM20602
[ Upstream commit 1615fe41a1959a2ee2814ba62736b2bb54e9802a ]
The MPU6050 driver has recently gained support for the
ICM20602 IMU, which is very similar to MPU6xxx. However,
the ICM20602's FIFO data specifically includes temperature
readings, which were not present on MPU6xxx parts. As a
result, the driver will under-read the ICM20602's FIFO
register, causing the same (partial) sample to be returned
for all reads, until the FIFO overflows.
Fix this by adding a table of scan elements specifically
for the ICM20602, which takes the extra temperature data
into consideration.
While we're at it, fix the temperature offset and scaling
on ICM20602, since it uses different scale/offset constants
than the rest of the MPU6xxx devices.
Signed-off-by: Steve Moskovchenko
Fixes: 22904bdff978 ("iio: imu: mpu6050: Add support for the ICM 20602 IMU")
Signed-off-by: Jonathan Cameron
Signed-off-by: Sasha Levin
commit 6a8c94e6bdd026d57885f899333c04b01778535e
Author: Alaa Hleihel
Date: Sun May 26 11:56:27 2019 +0300
net/mlx5e: Avoid detaching non-existing netdev under switchdev mode
After introducing dedicated uplink representor, the netdev instance
set over the esw manager vport (PF) became no longer in use, so it was
removed in the cited commit once we're on switchdev mode.
However, the mlx5e\_detach function was not updated accordingly, and it
still tries to detach a non-existing netdev, causing a kernel crash.
This patch fixes this issue.
Fixes: aec002f6f82c ("net/mlx5e: Uninstantiate esw manager vport netdev on switchdev mode")
Signed-off-by: Alaa Hleihel
Reviewed-by: Roi Dayan
Signed-off-by: Saeed Mahameed
Signed-off-by: Greg Kroah-Hartman
commit 0ab34cf296c3c7d326e57a38f61a5a86686bdda1
Author: Willem de Bruijn
Date: Fri Jun 7 17:57:48 2019 -0400
net: correct udp zerocopy refcnt also when zerocopy only on append
[ Upstream commit 522924b583082f51b8a2406624a2f27c22119b20 ]
The below patch fixes an incorrect zerocopy refcnt increment when
appending with MSG\_MORE to an existing zerocopy udp skb.
send(.., MSG\_ZEROCOPY | MSG\_MORE); // refcnt 1
send(.., MSG\_ZEROCOPY | MSG\_MORE); // refcnt still 1 (bar frags)
But it missed that zerocopy need not be passed at the first send. The
right test whether the uarg is newly allocated and thus has extra
refcnt 1 is not !skb, but !skb\_zcopy.
send(.., MSG\_MORE); //
send(.., MSG\_ZEROCOPY); // refcnt 1
Fixes: 100f6d8e09905 ("net: correct zerocopy refcnt with udp MSG\_MORE")
Reported-by: syzbot
Signed-off-by: Willem de Bruijn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 284bc559f332f77a08cea0f0f23ff7024419e191
Author: Eli Britstein
Date: Sun Jun 2 13:47:59 2019 +0000
net/mlx5e: Support tagged tunnel over bond
Stacked devices like bond interface may have a VLAN device on top of
them. Detect lag state correctly under this condition, and return the
correct routed net device, according to it the encap header is built.
Fixes: e32ee6c78efa ("net/mlx5e: Support tunnel encap over tagged Ethernet")
Signed-off-by: Eli Britstein
Reviewed-by: Roi Dayan
Signed-off-by: Saeed Mahameed
Signed-off-by: Greg Kroah-Hartman
commit 1bb4eb4efe3afbd66d80168ce6968ecabc2ffab9
Author: Petr Machata
Date: Tue Jun 11 10:19:45 2019 +0300
mlxsw: spectrum\_buffers: Reduce pool size on Spectrum-2
Due to an issue on Spectrum-2, in front-panel ports split four ways, 2 out
of 32 port buffers cannot be used. To work around this, the next FW release
will mark them as unused, and will report correspondingly lower total
shared buffer size. mlxsw will pick up the new value through a query to
cap\_total\_buffer\_size resource. However the initial size for shared buffer
pool 0 is hard-coded and therefore needs to be updated.
Thus reduce the pool size by 2.7 MiB (which corresponds to 2/32 of the
total size of 42 MiB), and round down to the whole number of cells.
Fixes: fe099bf682ab ("mlxsw: spectrum\_buffers: Add Spectrum-2 shared buffer configuration")
Signed-off-by: Petr Machata
Acked-by: Jiri Pirko
Signed-off-by: Ido Schimmel
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b43417db5e3b932275692db1497a20619056d261
Author: Raed Salem
Date: Sun Jun 2 12:04:08 2019 +0300
net/mlx5e: Fix source port matching in fdb peer flow rule
The cited commit changed the initialization placement of the eswitch
attributes so it is done prior to parse tc actions function call,
including among others the in\_rep and in\_mdev fields which are mistakenly
reassigned inside the parse actions function.
This breaks the source port matching criteria of the peer redirect rule.
Fix by removing the now redundant reassignment of the already initialized
fields.
Fixes: 988ab9c7363a ("net/mlx5e: Introduce mlx5e\_flow\_esw\_attr\_init() helper")
Signed-off-by: Raed Salem
Reviewed-by: Roi Dayan
Signed-off-by: Saeed Mahameed
Signed-off-by: Greg Kroah-Hartman
commit acec2a3945117249dbf8909670036c73de16bc5c
Author: Jiri Pirko
Date: Tue Jun 11 10:19:43 2019 +0300
mlxsw: spectrum\_flower: Fix TOS matching
The TOS value was not extracted correctly. Fix it.
Fixes: 87996f91f739 ("mlxsw: spectrum\_flower: Add support for ip tos")
Reported-by: Alexander Petrovskiy
Signed-off-by: Jiri Pirko
Signed-off-by: Ido Schimmel
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit dd3690f21ac3fd4bd9b69428f1c5f274282f14ab
Author: Chris Mi
Date: Thu May 16 17:36:43 2019 +0800
net/mlx5e: Add ndo\_set\_feature for uplink representor
After we have a dedicated uplink representor, the new netdev ops
doesn't support ndo\_set\_feature. Because of that, we can't change
some features, eg. rxvlan. Now add it back.
In this patch, I also do a cleanup for the features flag handling,
eg. remove duplicate NETIF\_F\_HW\_TC flag setting.
Fixes: aec002f6f82c ("net/mlx5e: Uninstantiate esw manager vport netdev on switchdev mode")
Signed-off-by: Chris Mi
Reviewed-by: Roi Dayan
Reviewed-by: Vlad Buslov
Signed-off-by: Saeed Mahameed
Signed-off-by: Greg Kroah-Hartman
commit 01bf40c9cad61857b8058b666867ad83e6ff5fc9
Author: Ido Schimmel
Date: Tue Jun 11 10:19:41 2019 +0300
mlxsw: spectrum\_router: Refresh nexthop neighbour when it becomes dead
The driver tries to periodically refresh neighbours that are used to
reach nexthops. This is done by periodically calling neigh\_event\_send().
However, if the neighbour becomes dead, there is nothing we can do to
return it to a connected state and the above function call is basically
a NOP.
This results in the nexthop never being written to the device's
adjacency table and therefore never used to forward packets.
Fix this by dropping our reference from the dead neighbour and
associating the nexthop with a new neigbhour which we will try to
refresh.
Fixes: a7ff87acd995 ("mlxsw: spectrum\_router: Implement next-hop routing")
Signed-off-by: Ido Schimmel
Reported-by: Alex Veber
Tested-by: Alex Veber
Acked-by: Jiri Pirko
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 37afcc01660c17ce3ac1529cd55d7b7216a0aa0d
Author: Edward Srouji
Date: Thu May 23 19:45:38 2019 +0300
net/mlx5: Update pci error handler entries and command translation
Add missing entries for create/destroy UCTX and UMEM commands.
This could get us wrong "unknown FW command" error in flows
where we unbind the device or reset the driver.
Also the translation of these commands from opcodes to string
was missing.
Fixes: 6e3722baac04 ("IB/mlx5: Use the correct commands for UMEM and UCTX allocation")
Signed-off-by: Edward Srouji
Signed-off-by: Saeed Mahameed
Signed-off-by: Greg Kroah-Hartman
commit a21291c7a3ae13a6173d65990a9079aecfd27b2f
Author: Maxime Chevallier
Date: Wed Jun 12 17:18:38 2019 +0200
net: ethtool: Allow matching on vlan DEI bit
[ Upstream commit f0d2ca1531377e7da888913e277eefac05a59b6f ]
Using ethtool, users can specify a classification action matching on the
full vlan tag, which includes the DEI bit (also previously called CFI).
However, when converting the ethool\_flow\_spec to a flow\_rule, we use
dissector keys to represent the matching patterns.
Since the vlan dissector key doesn't include the DEI bit, this
information was silently discarded when translating the ethtool
flow spec in to a flow\_rule.
This commit adds the DEI bit into the vlan dissector key, and allows
propagating the information to the driver when parsing the ethtool flow
spec.
Fixes: eca4205f9ec3 ("ethtool: add ethtool\_rx\_flow\_spec to flow\_rule structure translator")
Reported-by: Michał Mirosław
Signed-off-by: Maxime Chevallier
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 02b6efb81f2ca80e95d801dab0516ef0075ec1f0
Author: Robert Hancock
Date: Wed Jun 12 14:33:32 2019 -0600
net: dsa: microchip: Don't try to read stats for unused ports
[ Upstream commit 6bb9e376c2a4cc5120c3bf5fd3048b9a0a6ec1f8 ]
If some of the switch ports were not listed in the device tree, due to
being unused, the ksz\_mib\_read\_work function ended up accessing a NULL
dp->slave pointer and causing an oops. Skip checking statistics for any
unused ports.
Fixes: 7c6ff470aa867f53 ("net: dsa: microchip: add MIB counter reading support")
Signed-off-by: Robert Hancock
Reviewed-by: Vivien Didelot
Reviewed-by: Andrew Lunn
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f61bd3c7c2d81f02bb1baf52f7aa5d219ce19dc8
Author: Maxime Chevallier
Date: Tue Jun 11 11:51:43 2019 +0200
net: mvpp2: prs: Use the correct helpers when removing all VID filters
[ Upstream commit 6b7a3430c163455cf8a514d636bda52b04654972 ]
When removing all VID filters, the mvpp2\_prs\_vid\_entry\_remove would be
called with the TCAM id incorrectly used as a VID, causing the wrong
TCAM entries to be invalidated.
Fix this by directly invalidating entries in the VID range.
Fixes: 56beda3db602 ("net: mvpp2: Add hardware offloading for VLAN filtering")
Suggested-by: Yuri Chipchev
Signed-off-by: Maxime Chevallier
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 60c653e2f1ac36bf2b2cde21c1baff337a18c9b3
Author: Maxime Chevallier
Date: Tue Jun 11 11:51:42 2019 +0200
net: mvpp2: prs: Fix parser range for VID filtering
[ Upstream commit 46b0090a6636cf34c0e856f15dd03e15ba4cdda6 ]
VID filtering is implemented in the Header Parser, with one range of 11
vids being assigned for each no-loopback port.
Make sure we use the per-port range when looking for existing entries in
the Parser.
Since we used a global range instead of a per-port one, this causes VIDs
to be removed from the whitelist from all ports of the same PPv2
instance.
Fixes: 56beda3db602 ("net: mvpp2: Add hardware offloading for VLAN filtering")
Suggested-by: Yuri Chipchev
Signed-off-by: Maxime Chevallier
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit af1c05e6c51fc92d43c3e0d911633f51c5b2c90b
Author: Stefano Brivio
Date: Tue Jun 11 00:27:06 2019 +0200
geneve: Don't assume linear buffers in error handler
[ Upstream commit eccc73a6b2cb6c04bfbc40a0769f3c428dfba232 ]
In commit a07966447f39 ("geneve: ICMP error lookup handler") I wrongly
assumed buffers from icmp\_socket\_deliver() would be linear. This is not
the case: icmp\_socket\_deliver() only guarantees we have 8 bytes of linear
data.
Eric fixed this same issue for fou and fou6 in commits 26fc181e6cac
("fou, fou6: do not assume linear skbs") and 5355ed6388e2 ("fou, fou6:
avoid uninit-value in gue\_err() and gue6\_err()").
Use pskb\_may\_pull() instead of checking skb->len, and take into account
the fact we later access the GENEVE header with udp\_hdr(), so we also
need to sum skb\_transport\_header() here.
Reported-by: Guillaume Nault
Fixes: a07966447f39 ("geneve: ICMP error lookup handler")
Signed-off-by: Stefano Brivio
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0cb7d3242192df201be97c61e394c87e18bf8a9d
Author: Stefano Brivio
Date: Tue Jun 11 00:27:05 2019 +0200
vxlan: Don't assume linear buffers in error handler
[ Upstream commit 8399a6930d12f5965230f4ff058228a4cc80c0b9 ]
In commit c3a43b9fec8a ("vxlan: ICMP error lookup handler") I wrongly
assumed buffers from icmp\_socket\_deliver() would be linear. This is not
the case: icmp\_socket\_deliver() only guarantees we have 8 bytes of linear
data.
Eric fixed this same issue for fou and fou6 in commits 26fc181e6cac
("fou, fou6: do not assume linear skbs") and 5355ed6388e2 ("fou, fou6:
avoid uninit-value in gue\_err() and gue6\_err()").
Use pskb\_may\_pull() instead of checking skb->len, and take into account
the fact we later access the VXLAN header with udp\_hdr(), so we also
need to sum skb\_transport\_header() here.
Reported-by: Guillaume Nault
Fixes: c3a43b9fec8a ("vxlan: ICMP error lookup handler")
Signed-off-by: Stefano Brivio
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 251c58f821872ba654b3e411c28ea7cc12a53e15
Author: Alaa Hleihel
Date: Sun May 19 11:11:49 2019 +0300
net/mlx5: Avoid reloading already removed devices
Prior to reloading a device we must first verify that it was not already
removed. Otherwise, the attempt to remove the device will do nothing, and
in that case we will end up proceeding with adding an new device that no
one was expecting to remove, leaving behind used resources such as EQs that
causes a failure to destroy comp EQs and syndrome (0x30f433).
Fix that by making sure that we try to remove and add a device (based on a
protocol) only if the device is already added.
Fixes: c5447c70594b ("net/mlx5: E-Switch, Reload IB interface when switching devlink modes")
Signed-off-by: Alaa Hleihel
Signed-off-by: Saeed Mahameed
Signed-off-by: Greg Kroah-Hartman
commit 8882d7e99b47cfdf880c3af701becff29718bec8
Author: Stephen Barber
Date: Fri Jun 14 23:42:37 2019 -0700
vsock/virtio: set SOCK\_DONE on peer shutdown
[ Upstream commit 42f5cda5eaf4396a939ae9bb43bb8d1d09c1b15c ]
Set the SOCK\_DONE flag to match the TCP\_CLOSING state when a peer has
shut down and there is nothing left to read.
This fixes the following bug:
1) Peer sends SHUTDOWN(RDWR).
2) Socket enters TCP\_CLOSING but SOCK\_DONE is not set.
3) read() returns -ENOTCONN until close() is called, then returns 0.
Signed-off-by: Stephen Barber
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 72788b8541deaab1fe13a95c958aa3da98618633
Author: Xin Long
Date: Sun Jun 16 17:24:07 2019 +0800
tipc: purge deferredq list for each grp member in tipc\_group\_delete
[ Upstream commit 5cf02612b33f104fe1015b2dfaf1758ad3675588 ]
Syzbot reported a memleak caused by grp members' deferredq list not
purged when the grp is be deleted.
The issue occurs when more(msg\_grp\_bc\_seqno(hdr), m->bc\_rcv\_nxt) in
tipc\_group\_filter\_msg() and the skb will stay in deferredq.
So fix it by calling \_\_skb\_queue\_purge for each member's deferredq
in tipc\_group\_delete() when a tipc sk leaves the grp.
Fixes: b87a5ea31c93 ("tipc: guarantee group unicast doesn't bypass group broadcast")
Reported-by: syzbot+78fbe679c8ca8d264a8d@syzkaller.appspotmail.com
Signed-off-by: Xin Long
Acked-by: Ying Xue
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit aecf98cd498f79a31fc91e5f239f9151ba524cac
Author: John Paul Adrian Glaubitz
Date: Tue Jun 11 17:38:37 2019 +0200
sunhv: Fix device naming inconsistency between sunhv\_console and sunhv\_reg
[ Upstream commit 07a6d63eb1b54b5fb38092780fe618dfe1d96e23 ]
In d5a2aa24, the name in struct console sunhv\_console was changed from "ttyS"
to "ttyHV" while the name in struct uart\_ops sunhv\_pops remained unchanged.
This results in the hypervisor console device to be listed as "ttyHV0" under
/proc/consoles while the device node is still named "ttyS0":
root@osaka:~# cat /proc/consoles
ttyHV0 -W- (EC p ) 4:64
tty0 -WU (E ) 4:1
root@osaka:~# readlink /sys/dev/char/4:64
../../devices/root/f02836f0/f0285690/tty/ttyS0
root@osaka:~#
This means that any userland code which tries to determine the name of the
device file of the hypervisor console device can not rely on the information
provided by /proc/consoles. In particular, booting current versions of debian-
installer inside a SPARC LDOM will fail with the installer unable to determine
the console device.
After renaming the device in struct uart\_ops sunhv\_pops to "ttyHV" as well,
the inconsistency is fixed and it is possible again to determine the name
of the device file of the hypervisor console device by reading the contents
of /proc/console:
root@osaka:~# cat /proc/consoles
ttyHV0 -W- (EC p ) 4:64
tty0 -WU (E ) 4:1
root@osaka:~# readlink /sys/dev/char/4:64
../../devices/root/f02836f0/f0285690/tty/ttyHV0
root@osaka:~#
With this change, debian-installer works correctly when installing inside
a SPARC LDOM.
Signed-off-by: John Paul Adrian Glaubitz
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9cb8eddfe7d65f6573dc76b64b9edc04aa042db7
Author: Neil Horman
Date: Thu Jun 13 06:35:59 2019 -0400
sctp: Free cookie before we memdup a new one
[ Upstream commit ce950f1050cece5e406a5cde723c69bba60e1b26 ]
Based on comments from Xin, even after fixes for our recent syzbot
report of cookie memory leaks, its possible to get a resend of an INIT
chunk which would lead to us leaking cookie memory.
To ensure that we don't leak cookie memory, free any previously
allocated cookie first.
Change notes
v1->v2
update subsystem tag in subject (davem)
repeat kfree check for peer\_random and peer\_hmacs (xin)
v2->v3
net->sctp
also free peer\_chunks
v3->v4
fix subject tags
v4->v5
remove cut line
Signed-off-by: Neil Horman
Reported-by: syzbot+f7e9153b037eac9b1df8@syzkaller.appspotmail.com
CC: Marcelo Ricardo Leitner
CC: Xin Long
CC: "David S. Miller"
CC: netdev@vger.kernel.org
Acked-by: Marcelo Ricardo Leitner
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4c85012ba97ae0ebb7c33922a38b64f1b98938cd
Author: Young Xiao <92siuyang@gmail.com>
Date: Fri Jun 14 15:13:02 2019 +0800
nfc: Ensure presence of required attributes in the deactivate\_target handler
[ Upstream commit 385097a3675749cbc9e97c085c0e5dfe4269ca51 ]
Check that the NFC\_ATTR\_TARGET\_INDEX attributes (in addition to
NFC\_ATTR\_DEVICE\_INDEX) are provided by the netlink client prior to
accessing them. This prevents potential unhandled NULL pointer dereference
exceptions which can be triggered by malicious user-mode programs,
if they omit one or both of these attributes.
Signed-off-by: Young Xiao <92siuyang@gmail.com>
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 20d3d270e5c2c2e159d6b9e3eeb992726fe8cea6
Author: John Fastabend
Date: Wed Jun 12 17:23:57 2019 +0000
net: tls, correctly account for copied bytes with multiple sk\_msgs
[ Upstream commit 648ee6cea7dde4a5cdf817e5d964fd60b22006a4 ]
tls\_sw\_do\_sendpage needs to return the total number of bytes sent
regardless of how many sk\_msgs are allocated. Unfortunately, copied
(the value we return up the stack) is zero'd before each new sk\_msg
is allocated so we only return the copied size of the last sk\_msg used.
The caller (splice, etc.) of sendpage will then believe only part
of its data was sent and send the missing chunks again. However,
because the data actually was sent the receiver will get multiple
copies of the same data.
To reproduce this do multiple sendfile calls with a length close to
the max record size. This will in turn call splice/sendpage, sendpage
may use multiple sk\_msg in this case and then returns the incorrect
number of bytes. This will cause splice to resend creating duplicate
data on the receiver. Andre created a C program that can easily
generate this case so we will push a similar selftest for this to
bpf-next shortly.
The fix is to \_not\_ zero the copied field so that the total sent
bytes is returned.
Reported-by: Steinar H. Gunderson
Reported-by: Andre Tomt
Tested-by: Andre Tomt
Fixes: d829e9c4112b ("tls: convert to generic sk\_msg interface")
Signed-off-by: John Fastabend
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 39ea88e3c0feef68dc416fa70e43fcde27a2437c
Author: Taehee Yoo
Date: Sun Jun 9 23:26:21 2019 +0900
net: openvswitch: do not free vport if register\_netdevice() is failed.
[ Upstream commit 309b66970ee2abf721ecd0876a48940fa0b99a35 ]
In order to create an internal vport, internal\_dev\_create() is used and
that calls register\_netdevice() internally.
If register\_netdevice() fails, it calls dev->priv\_destructor() to free
private data of netdev. actually, a private data of this is a vport.
Hence internal\_dev\_create() should not free and use a vport after failure
of register\_netdevice().
Test command
ovs-dpctl add-dp bonding\_masters
Splat looks like:
[ 1035.667767] kasan: GPF could be caused by NULL-ptr deref or user memory access
[ 1035.675958] general protection fault: 0000 [#1] SMP DEBUG\_PAGEALLOC KASAN PTI
[ 1035.676916] CPU: 1 PID: 1028 Comm: ovs-vswitchd Tainted: G B 5.2.0-rc3+ #240
[ 1035.676916] RIP: 0010:internal\_dev\_create+0x2e5/0x4e0 [openvswitch]
[ 1035.676916] Code: 48 c1 ea 03 80 3c 02 00 0f 85 9f 01 00 00 4c 8b 23 48 b8 00 00 00 00 00 fc ff df 49 8d bc 24 60 05 00 00 48 89 fa 48 c1 ea 03 <80> 3c 02 00 0f 85 86 01 00 00 49 8b bc 24 60 05 00 00 e8 e4 68 f4
[ 1035.713720] RSP: 0018:ffff88810dcb7578 EFLAGS: 00010206
[ 1035.713720] RAX: dffffc0000000000 RBX: ffff88810d13fe08 RCX: ffffffff84297704
[ 1035.713720] RDX: 00000000000000ac RSI: 0000000000000000 RDI: 0000000000000560
[ 1035.713720] RBP: 00000000ffffffef R08: fffffbfff0d3b881 R09: fffffbfff0d3b881
[ 1035.713720] R10: 0000000000000001 R11: fffffbfff0d3b880 R12: 0000000000000000
[ 1035.768776] R13: 0000607ee460b900 R14: ffff88810dcb7690 R15: ffff88810dcb7698
[ 1035.777709] FS: 00007f02095fc980(0000) GS:ffff88811b400000(0000) knlGS:0000000000000000
[ 1035.777709] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 1035.777709] CR2: 00007ffdf01d2f28 CR3: 0000000108258000 CR4: 00000000001006e0
[ 1035.777709] Call Trace:
[ 1035.777709] ovs\_vport\_add+0x267/0x4f0 [openvswitch]
[ 1035.777709] new\_vport+0x15/0x1e0 [openvswitch]
[ 1035.777709] ovs\_vport\_cmd\_new+0x567/0xd10 [openvswitch]
[ 1035.777709] ? ovs\_dp\_cmd\_dump+0x490/0x490 [openvswitch]
[ 1035.777709] ? \_\_kmalloc+0x131/0x2e0
[ 1035.777709] ? genl\_family\_rcv\_msg+0xa54/0x1030
[ 1035.777709] genl\_family\_rcv\_msg+0x63a/0x1030
[ 1035.777709] ? genl\_unregister\_family+0x630/0x630
[ 1035.841681] ? debug\_show\_all\_locks+0x2d0/0x2d0
[ ... ]
Fixes: cf124db566e6 ("net: Fix inconsistent teardown and release of private netdev state.")
Signed-off-by: Taehee Yoo
Reviewed-by: Greg Rose
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 22da034c885ff9ea6862780a9a1687630deb08f6
Author: Linus Walleij
Date: Fri Jun 14 00:25:20 2019 +0200
net: dsa: rtl8366: Fix up VLAN filtering
[ Upstream commit 760c80b70bed2cd01630e8595d1bbde910339f31 ]
We get this regression when using RTL8366RB as part of a bridge
with OpenWrt:
WARNING: CPU: 0 PID: 1347 at net/switchdev/switchdev.c:291
switchdev\_port\_attr\_set\_now+0x80/0xa4
lan0: Commit of attribute (id=7) failed.
(...)
realtek-smi switch lan0: failed to initialize vlan filtering on this port
This is because it is trying to disable VLAN filtering
on VLAN0, as we have forgot to add 1 to the port number
to get the right VLAN in rtl8366\_vlan\_filtering(): when
we initialize the VLAN we associate VLAN1 with port 0,
VLAN2 with port 1 etc, so we need to add 1 to the port
offset.
Fixes: d8652956cf37 ("net: dsa: realtek-smi: Add Realtek SMI driver")
Signed-off-by: Linus Walleij
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d97ce9c779ac98da71e2639cb13ea04e46c94912
Author: Eric Dumazet
Date: Sat Jun 15 16:28:48 2019 -0700
neigh: fix use-after-free read in pneigh\_get\_next
[ Upstream commit f3e92cb8e2eb8c27d109e6fd73d3a69a8c09e288 ]
Nine years ago, I added RCU handling to neighbours, not pneighbours.
(pneigh are not commonly used)
Unfortunately I missed that /proc dump operations would use a
common entry and exit point : neigh\_seq\_start() and neigh\_seq\_stop()
We need to read\_lock(tbl->lock) or risk use-after-free while
iterating the pneigh structures.
We might later convert pneigh to RCU and revert this patch.
sysbot reported :
BUG: KASAN: use-after-free in pneigh\_get\_next.isra.0+0x24b/0x280 net/core/neighbour.c:3158
Read of size 8 at addr ffff888097f2a700 by task syz-executor.0/9825
CPU: 1 PID: 9825 Comm: syz-executor.0 Not tainted 5.2.0-rc4+ #32
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:77 [inline]
dump\_stack+0x172/0x1f0 lib/dump\_stack.c:113
print\_address\_description.cold+0x7c/0x20d mm/kasan/report.c:188
\_\_kasan\_report.cold+0x1b/0x40 mm/kasan/report.c:317
kasan\_report+0x12/0x20 mm/kasan/common.c:614
\_\_asan\_report\_load8\_noabort+0x14/0x20 mm/kasan/generic\_report.c:132
pneigh\_get\_next.isra.0+0x24b/0x280 net/core/neighbour.c:3158
neigh\_seq\_next+0xdb/0x210 net/core/neighbour.c:3240
seq\_read+0x9cf/0x1110 fs/seq\_file.c:258
proc\_reg\_read+0x1fc/0x2c0 fs/proc/inode.c:221
do\_loop\_readv\_writev fs/read\_write.c:714 [inline]
do\_loop\_readv\_writev fs/read\_write.c:701 [inline]
do\_iter\_read+0x4a4/0x660 fs/read\_write.c:935
vfs\_readv+0xf0/0x160 fs/read\_write.c:997
kernel\_readv fs/splice.c:359 [inline]
default\_file\_splice\_read+0x475/0x890 fs/splice.c:414
do\_splice\_to+0x127/0x180 fs/splice.c:877
splice\_direct\_to\_actor+0x2d2/0x970 fs/splice.c:954
do\_splice\_direct+0x1da/0x2a0 fs/splice.c:1063
do\_sendfile+0x597/0xd00 fs/read\_write.c:1464
\_\_do\_sys\_sendfile64 fs/read\_write.c:1525 [inline]
\_\_se\_sys\_sendfile64 fs/read\_write.c:1511 [inline]
\_\_x64\_sys\_sendfile64+0x1dd/0x220 fs/read\_write.c:1511
do\_syscall\_64+0xfd/0x680 arch/x86/entry/common.c:301
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
RIP: 0033:0x4592c9
Code: fd b7 fb ff c3 66 2e 0f 1f 84 00 00 00 00 00 66 90 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 0f 83 cb b7 fb ff c3 66 2e 0f 1f 84 00 00 00 00
RSP: 002b:00007f4aab51dc78 EFLAGS: 00000246 ORIG\_RAX: 0000000000000028
RAX: ffffffffffffffda RBX: 0000000000000004 RCX: 00000000004592c9
RDX: 0000000000000000 RSI: 0000000000000004 RDI: 0000000000000005
RBP: 000000000075bf20 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000080000000 R11: 0000000000000246 R12: 00007f4aab51e6d4
R13: 00000000004c689d R14: 00000000004db828 R15: 00000000ffffffff
Allocated by task 9827:
save\_stack+0x23/0x90 mm/kasan/common.c:71
set\_track mm/kasan/common.c:79 [inline]
\_\_kasan\_kmalloc mm/kasan/common.c:489 [inline]
\_\_kasan\_kmalloc.constprop.0+0xcf/0xe0 mm/kasan/common.c:462
kasan\_kmalloc+0x9/0x10 mm/kasan/common.c:503
\_\_do\_kmalloc mm/slab.c:3660 [inline]
\_\_kmalloc+0x15c/0x740 mm/slab.c:3669
kmalloc include/linux/slab.h:552 [inline]
pneigh\_lookup+0x19c/0x4a0 net/core/neighbour.c:731
arp\_req\_set\_public net/ipv4/arp.c:1010 [inline]
arp\_req\_set+0x613/0x720 net/ipv4/arp.c:1026
arp\_ioctl+0x652/0x7f0 net/ipv4/arp.c:1226
inet\_ioctl+0x2a0/0x340 net/ipv4/af\_inet.c:926
sock\_do\_ioctl+0xd8/0x2f0 net/socket.c:1043
sock\_ioctl+0x3ed/0x780 net/socket.c:1194
vfs\_ioctl fs/ioctl.c:46 [inline]
file\_ioctl fs/ioctl.c:509 [inline]
do\_vfs\_ioctl+0xd5f/0x1380 fs/ioctl.c:696
ksys\_ioctl+0xab/0xd0 fs/ioctl.c:713
\_\_do\_sys\_ioctl fs/ioctl.c:720 [inline]
\_\_se\_sys\_ioctl fs/ioctl.c:718 [inline]
\_\_x64\_sys\_ioctl+0x73/0xb0 fs/ioctl.c:718
do\_syscall\_64+0xfd/0x680 arch/x86/entry/common.c:301
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
Freed by task 9824:
save\_stack+0x23/0x90 mm/kasan/common.c:71
set\_track mm/kasan/common.c:79 [inline]
\_\_kasan\_slab\_free+0x102/0x150 mm/kasan/common.c:451
kasan\_slab\_free+0xe/0x10 mm/kasan/common.c:459
\_\_cache\_free mm/slab.c:3432 [inline]
kfree+0xcf/0x220 mm/slab.c:3755
pneigh\_ifdown\_and\_unlock net/core/neighbour.c:812 [inline]
\_\_neigh\_ifdown+0x236/0x2f0 net/core/neighbour.c:356
neigh\_ifdown+0x20/0x30 net/core/neighbour.c:372
arp\_ifdown+0x1d/0x21 net/ipv4/arp.c:1274
inetdev\_destroy net/ipv4/devinet.c:319 [inline]
inetdev\_event+0xa14/0x11f0 net/ipv4/devinet.c:1544
notifier\_call\_chain+0xc2/0x230 kernel/notifier.c:95
\_\_raw\_notifier\_call\_chain kernel/notifier.c:396 [inline]
raw\_notifier\_call\_chain+0x2e/0x40 kernel/notifier.c:403
call\_netdevice\_notifiers\_info+0x3f/0x90 net/core/dev.c:1749
call\_netdevice\_notifiers\_extack net/core/dev.c:1761 [inline]
call\_netdevice\_notifiers net/core/dev.c:1775 [inline]
rollback\_registered\_many+0x9b9/0xfc0 net/core/dev.c:8178
rollback\_registered+0x109/0x1d0 net/core/dev.c:8220
unregister\_netdevice\_queue net/core/dev.c:9267 [inline]
unregister\_netdevice\_queue+0x1ee/0x2c0 net/core/dev.c:9260
unregister\_netdevice include/linux/netdevice.h:2631 [inline]
\_\_tun\_detach+0xd8a/0x1040 drivers/net/tun.c:724
tun\_detach drivers/net/tun.c:741 [inline]
tun\_chr\_close+0xe0/0x180 drivers/net/tun.c:3451
\_\_fput+0x2ff/0x890 fs/file\_table.c:280
\_\_\_\_fput+0x16/0x20 fs/file\_table.c:313
task\_work\_run+0x145/0x1c0 kernel/task\_work.c:113
tracehook\_notify\_resume include/linux/tracehook.h:185 [inline]
exit\_to\_usermode\_loop+0x273/0x2c0 arch/x86/entry/common.c:168
prepare\_exit\_to\_usermode arch/x86/entry/common.c:199 [inline]
syscall\_return\_slowpath arch/x86/entry/common.c:279 [inline]
do\_syscall\_64+0x58e/0x680 arch/x86/entry/common.c:304
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
The buggy address belongs to the object at ffff888097f2a700
which belongs to the cache kmalloc-64 of size 64
The buggy address is located 0 bytes inside of
64-byte region [ffff888097f2a700, ffff888097f2a740)
The buggy address belongs to the page:
page:ffffea00025fca80 refcount:1 mapcount:0 mapping:ffff8880aa400340 index:0x0
flags: 0x1fffc0000000200(slab)
raw: 01fffc0000000200 ffffea000250d548 ffffea00025726c8 ffff8880aa400340
raw: 0000000000000000 ffff888097f2a000 0000000100000020 0000000000000000
page dumped because: kasan: bad access detected
Memory state around the buggy address:
ffff888097f2a600: 00 00 00 00 00 00 00 00 fc fc fc fc fc fc fc fc
ffff888097f2a680: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
>ffff888097f2a700: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
^
ffff888097f2a780: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
ffff888097f2a800: fb fb fb fb fb fb fb fb fc fc fc fc fc fc fc fc
Fixes: 767e97e1e0db ("neigh: RCU conversion of struct neighbour")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit da930ec93201692aa9ff3b072985978fc6047006
Author: Jeremy Sowden
Date: Sun Jun 16 16:54:37 2019 +0100
lapb: fixed leak of control-blocks.
[ Upstream commit 6be8e297f9bcea666ea85ac7a6cd9d52d6deaf92 ]
lapb\_register calls lapb\_create\_cb, which initializes the control-
block's ref-count to one, and \_\_lapb\_insert\_cb, which increments it when
adding the new block to the list of blocks.
lapb\_unregister calls \_\_lapb\_remove\_cb, which decrements the ref-count
when removing control-block from the list of blocks, and calls lapb\_put
itself to decrement the ref-count before returning.
However, lapb\_unregister also calls \_\_lapb\_devtostruct to look up the
right control-block for the given net\_device, and \_\_lapb\_devtostruct
also bumps the ref-count, which means that when lapb\_unregister returns
the ref-count is still 1 and the control-block is leaked.
Call lapb\_put after \_\_lapb\_devtostruct to fix leak.
Reported-by: syzbot+afb980676c836b4a0afa@syzkaller.appspotmail.com
Signed-off-by: Jeremy Sowden
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a7f938c9af445559764a7714984fa43c5409b112
Author: Eric Dumazet
Date: Thu Jun 6 14:32:34 2019 -0700
ipv6: flowlabel: fl6\_sock\_lookup() must use atomic\_inc\_not\_zero
[ Upstream commit 65a3c497c0e965a552008db8bc2653f62bc925a1 ]
Before taking a refcount, make sure the object is not already
scheduled for deletion.
Same fix is needed in ipv6\_flowlabel\_opt()
Fixes: 18367681a10b ("ipv6 flowlabel: Convert np->ipv6\_fl\_list to RCU.")
Signed-off-by: Eric Dumazet
Cc: Willem de Bruijn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 3514df79eb234b2dfd17755086ebff794cbb7aba
Author: Haiyang Zhang
Date: Thu Jun 13 21:06:53 2019 +0000
hv\_netvsc: Set probe mode to sync
[ Upstream commit 9a33629ba6b26caebd73e3c581ba1e6068c696a7 ]
For better consistency of synthetic NIC names, we set the probe mode to
PROBE\_FORCE\_SYNCHRONOUS. So the names can be aligned with the vmbus
channel offer sequence.
Fixes: af0a5646cb8d ("use the new async probing feature for the hyperv drivers")
Signed-off-by: Haiyang Zhang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 1a976c6c586e4ba4ae1affd0aadba2cd56b5cefb
Author: Ivan Vecera
Date: Fri Jun 14 17:48:36 2019 +0200
be2net: Fix number of Rx queues used for flow hashing
[ Upstream commit 718f4a2537089ea41903bf357071306163bc7c04 ]
Number of Rx queues used for flow hashing returned by the driver is
incorrect and this bug prevents user to use the last Rx queue in
indirection table.
Let's say we have a NIC with 6 combined queues:
[root@sm-03 ~]# ethtool -l enp4s0f0
Channel parameters for enp4s0f0:
Pre-set maximums:
RX: 5
TX: 5
Other: 0
Combined: 6
Current hardware settings:
RX: 0
TX: 0
Other: 0
Combined: 6
Default indirection table maps all (6) queues equally but the driver
reports only 5 rings available.
[root@sm-03 ~]# ethtool -x enp4s0f0
RX flow hash indirection table for enp4s0f0 with 5 RX ring(s):
0: 0 1 2 3 4 5 0 1
8: 2 3 4 5 0 1 2 3
16: 4 5 0 1 2 3 4 5
24: 0 1 2 3 4 5 0 1
...
Now change indirection table somehow:
[root@sm-03 ~]# ethtool -X enp4s0f0 weight 1 1
[root@sm-03 ~]# ethtool -x enp4s0f0
RX flow hash indirection table for enp4s0f0 with 6 RX ring(s):
0: 0 0 0 0 0 0 0 0
...
64: 1 1 1 1 1 1 1 1
...
Now it is not possible to change mapping back to equal (default) state:
[root@sm-03 ~]# ethtool -X enp4s0f0 equal 6
Cannot set RX flow hash configuration: Invalid argument
Fixes: 594ad54a2c3b ("be2net: Add support for setting and getting rx flow hash options")
Reported-by: Tianhao
Signed-off-by: Ivan Vecera
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5f9c0c152eacfa182c4625d6f4e28554ac9e6e06
Author: Eric Dumazet
Date: Sat Jun 15 16:40:52 2019 -0700
ax25: fix inconsistent lock state in ax25\_destroy\_timer
[ Upstream commit d4d5d8e83c9616aeef28a2869cea49cc3fb35526 ]
Before thread in process context uses bh\_lock\_sock()
we must disable bh.
sysbot reported :
WARNING: inconsistent lock state
5.2.0-rc3+ #32 Not tainted
inconsistent {SOFTIRQ-ON-W} -> {IN-SOFTIRQ-W} usage.
blkid/26581 [HC0[0]:SC1[1]:HE1:SE0] takes:
00000000e0da85ee (slock-AF\_AX25){+.?.}, at: spin\_lock include/linux/spinlock.h:338 [inline]
00000000e0da85ee (slock-AF\_AX25){+.?.}, at: ax25\_destroy\_timer+0x53/0xc0 net/ax25/af\_ax25.c:275
{SOFTIRQ-ON-W} state was registered at:
lock\_acquire+0x16f/0x3f0 kernel/locking/lockdep.c:4303
\_\_raw\_spin\_lock include/linux/spinlock\_api\_smp.h:142 [inline]
\_raw\_spin\_lock+0x2f/0x40 kernel/locking/spinlock.c:151
spin\_lock include/linux/spinlock.h:338 [inline]
ax25\_rt\_autobind+0x3ca/0x720 net/ax25/ax25\_route.c:429
ax25\_connect.cold+0x30/0xa4 net/ax25/af\_ax25.c:1221
\_\_sys\_connect+0x264/0x330 net/socket.c:1834
\_\_do\_sys\_connect net/socket.c:1845 [inline]
\_\_se\_sys\_connect net/socket.c:1842 [inline]
\_\_x64\_sys\_connect+0x73/0xb0 net/socket.c:1842
do\_syscall\_64+0xfd/0x680 arch/x86/entry/common.c:301
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
irq event stamp: 2272
hardirqs last enabled at (2272): [] trace\_hardirqs\_on\_thunk+0x1a/0x1c
hardirqs last disabled at (2271): [] trace\_hardirqs\_off\_thunk+0x1a/0x1c
softirqs last enabled at (1522): [] \_\_do\_softirq+0x654/0x94c kernel/softirq.c:320
softirqs last disabled at (2267): [] invoke\_softirq kernel/softirq.c:374 [inline]
softirqs last disabled at (2267): [] irq\_exit+0x180/0x1d0 kernel/softirq.c:414
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0
----
lock(slock-AF\_AX25);
lock(slock-AF\_AX25);
\*\*\* DEADLOCK \*\*\*
1 lock held by blkid/26581:
#0: 0000000010fd154d ((&ax25->dtimer)){+.-.}, at: lockdep\_copy\_map include/linux/lockdep.h:175 [inline]
#0: 0000000010fd154d ((&ax25->dtimer)){+.-.}, at: call\_timer\_fn+0xe0/0x720 kernel/time/timer.c:1312
stack backtrace:
CPU: 1 PID: 26581 Comm: blkid Not tainted 5.2.0-rc3+ #32
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:77 [inline]
dump\_stack+0x172/0x1f0 lib/dump\_stack.c:113
print\_usage\_bug.cold+0x393/0x4a2 kernel/locking/lockdep.c:2935
valid\_state kernel/locking/lockdep.c:2948 [inline]
mark\_lock\_irq kernel/locking/lockdep.c:3138 [inline]
mark\_lock+0xd46/0x1370 kernel/locking/lockdep.c:3513
mark\_irqflags kernel/locking/lockdep.c:3391 [inline]
\_\_lock\_acquire+0x159f/0x5490 kernel/locking/lockdep.c:3745
lock\_acquire+0x16f/0x3f0 kernel/locking/lockdep.c:4303
\_\_raw\_spin\_lock include/linux/spinlock\_api\_smp.h:142 [inline]
\_raw\_spin\_lock+0x2f/0x40 kernel/locking/spinlock.c:151
spin\_lock include/linux/spinlock.h:338 [inline]
ax25\_destroy\_timer+0x53/0xc0 net/ax25/af\_ax25.c:275
call\_timer\_fn+0x193/0x720 kernel/time/timer.c:1322
expire\_timers kernel/time/timer.c:1366 [inline]
\_\_run\_timers kernel/time/timer.c:1685 [inline]
\_\_run\_timers kernel/time/timer.c:1653 [inline]
run\_timer\_softirq+0x66f/0x1740 kernel/time/timer.c:1698
\_\_do\_softirq+0x25c/0x94c kernel/softirq.c:293
invoke\_softirq kernel/softirq.c:374 [inline]
irq\_exit+0x180/0x1d0 kernel/softirq.c:414
exiting\_irq arch/x86/include/asm/apic.h:536 [inline]
smp\_apic\_timer\_interrupt+0x13b/0x550 arch/x86/kernel/apic/apic.c:1068
apic\_timer\_interrupt+0xf/0x20 arch/x86/entry/entry\_64.S:806

RIP: 0033:0x7f858d5c3232
Code: 8b 61 08 48 8b 84 24 d8 00 00 00 4c 89 44 24 28 48 8b ac 24 d0 00 00 00 4c 8b b4 24 e8 00 00 00 48 89 7c 24 68 48 89 4c 24 78 <48> 89 44 24 58 8b 84 24 e0 00 00 00 89 84 24 84 00 00 00 8b 84 24
RSP: 002b:00007ffcaf0cf5c0 EFLAGS: 00000206 ORIG\_RAX: ffffffffffffff13
RAX: 00007f858d7d27a8 RBX: 00007f858d7d8820 RCX: 00007f858d3940d8
RDX: 00007ffcaf0cf798 RSI: 00000000f5e616f3 RDI: 00007f858d394fee
RBP: 0000000000000000 R08: 00007ffcaf0cf780 R09: 00007f858d7db480
R10: 0000000000000000 R11: 0000000009691a75 R12: 0000000000000005
R13: 00000000f5e616f3 R14: 0000000000000000 R15: 00007ffcaf0cf798
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f51ec54da907ffca5de7cd645f28a4d9224d0c93
Author: Florian Westphal
Date: Mon May 20 13:48:10 2019 +0200
netfilter: nat: fix udp checksum corruption
commit 6bac76db1da3cb162c425d58ae421486f8e43955 upstream.
Due to copy&paste error nf\_nat\_mangle\_udp\_packet passes IPPROTO\_TCP,
resulting in incorrect udp checksum when payload had to be mangled.
Fixes: dac3fe72596f9 ("netfilter: nat: remove csum\_recalc hook")
Reported-by: Marc Haber
Tested-by: Marc Haber
Signed-off-by: Florian Westphal
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Greg Kroah-Hartman


=== Content from support.f5.com_c19d002e_20250120_231920.html ===
Loading×Sorry to interruptCSS ErrorRefresh

=== Content from lists.debian.org_61974bd0_20250120_231917.html ===


---

[[Date Prev](msg00014.html)][[Date Next](msg00016.html)]
[[Thread Prev](msg00014.html)][[Thread Next](msg00016.html)]
[[Date Index](maillist.html#00015)]
[[Thread Index](threads.html#00015)]

# [SECURITY] [DLA 1919-2] linux-4.9 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1919-2] linux-4.9 security update
* *From*: Ben Hutchings <ben@decadent.org.uk>
* *Date*: Sun, 15 Sep 2019 18:51:06 +0100
* *Message-id*: <[[🔎]](/msgid-search/bc49db280404892b5da67f24686f152b67609ca5.camel%40decadent.org.uk) [bc49db280404892b5da67f24686f152b67609ca5.camel@decadent.org.uk](msg00015.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : linux-4.9
Version        : 4.9.189-3~deb8u1
CVE ID         : CVE-2019-0136 CVE-2019-9506 CVE-2019-11487 CVE-2019-15211
                 CVE-2019-15212 CVE-2019-15215 CVE-2019-15216 CVE-2019-15218
                 CVE-2019-15219 CVE-2019-15220 CVE-2019-15221 CVE-2019-15292
                 CVE-2019-15538 CVE-2019-15666 CVE-2019-15807 CVE-2019-15924
                 CVE-2019-15926
Debian Bug     : 930904

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

This updated advisory text mentions the additional non-security
changes and notes the need to install new binary packages.

CVE-2019-0136

    It was discovered that the wifi soft-MAC implementation (mac80211)
    did not properly authenticate Tunneled Direct Link Setup (TDLS)
    messages.  A nearby attacker could use this for denial of service
    (loss of wifi connectivity).

CVE-2019-9506

    Daniele Antonioli, Nils Ole Tippenhauer, and Kasper Rasmussen
    discovered a weakness in the Bluetooth pairing protocols, dubbed
    the "KNOB attack".  An attacker that is nearby during pairing
    could use this to weaken the encryption used between the paired
    devices, and then to eavesdrop on and/or spoof communication
    between them.

    This update mitigates the attack by requiring a minimum encryption
    key length of 56 bits.

CVE-2019-11487

    Jann Horn discovered that the FUSE (Filesystem-in-Userspace)
    facility could be used to cause integer overflow in page reference
    counts, leading to a use-after-free.  On a system with sufficient
    physical memory, a local user permitted to create arbitrary FUSE
    mounts could use this for privilege escalation.

    By default, unprivileged users can only mount FUSE filesystems
    through fusermount, which limits the number of mounts created and
    should completely mitigate the issue.

CVE-2019-15211

    The syzkaller tool found a bug in the radio-raremono driver that
    could lead to a use-after-free.  An attacker able to add and
    remove USB devices could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-15212

    The syzkaller tool found that the rio500 driver does not work
    correctly if more than one device is bound to it.  An attacker
    able to add USB devices could use this to cause a denial of
    service (memory corruption or crash) or possibly for privilege
    escalation.

CVE-2019-15215

    The syzkaller tool found a bug in the cpia2_usb driver that leads
    to a use-after-free.  An attacker able to add and remove USB
    devices could use this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2019-15216

    The syzkaller tool found a bug in the yurex driver that leads to
    a use-after-free.  An attacker able to add and remove USB
    devices could use this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2019-15218

    The syzkaller tool found that the smsusb driver did not validate
    that USB devices have the expected endpoints, potentially leading
    to a null pointer dereference.  An attacker able to add USB
    devices could use this to cause a denial of service (BUG/oops).

CVE-2019-15219

    The syzkaller tool found that a device initialisation error in the
    sisusbvga driver could lead to a null pointer dereference.  An
    attacker able to add USB devices could use this to cause a denial
    of service (BUG/oops).

CVE-2019-15220

    The syzkaller tool found a race condition in the p54usb driver
    which could lead to a use-after-free.  An attacker able to add and
    remove USB devices could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-15221

    The syzkaller tool found that the line6 driver did not validate
    USB devices' maximum packet sizes, which could lead to a heap
    buffer overrun.  An attacker able to add USB devices could use
    this to cause a denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2019-15292

    The Hulk Robot tool found missing error checks in the Appletalk
    protocol implementation, which could lead to a use-after-free.
    The security impact of this is unclear.

CVE-2019-15538

    Benjamin Moody reported that operations on XFS hung after a
    chgrp command failed due to a disk quota.  A local user on a
    system using XFS and disk quotas could use this for denial of
    service.

CVE-2019-15666

    The Hulk Robot tool found an incorrect range check in the network
    transformation (xfrm) layer, leading to out-of-bounds memory
    accesses.  A local user with CAP_NET_ADMIN capability (in any user
    namespace) could use this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2019-15807

    Jian Luo reported that the Serial Attached SCSI library (libsas)
    did not correctly handle failure to discover devices beyond a SAS
    expander.  This could lead to a resource leak and crash (BUG).
    The security impact of this is unclear.

CVE-2019-15924

    The Hulk Robot tool found a missing error check in the fm10k
    Ethernet driver, which could lead to a null pointer dereference
    and crash (BUG/oops).  The security impact of this is unclear.

CVE-2019-15926

    It was found that the ath6kl wifi driver did not consistently
    validate traffic class numbers in received control packets,
    leading to out-of-bounds memory accesses.  A nearby attacker on
    the same wifi network could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

For Debian 8 "Jessie", these problems have been fixed in version
4.9.189-3~deb8u1.  This version also includes a fix for Debian bug
#930904, and other fixes included in upstream stable updates.

We recommend that you upgrade your linux-4.9 and linux-latest-4.9
packages.  You will need to use "apt-get upgrade --with-new-pkgs"
or "apt upgrade" as the binary package names have changed.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgpeHgSxAz6B7.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from lists.debian.org_56cfed4e_20250120_231917.html ===


---

[[Date Prev](msg00024.html)][[Date Next](msg00026.html)]
[[Thread Prev](msg00024.html)][[Thread Next](msg00026.html)]
[[Date Index](maillist.html#00025)]
[[Thread Index](threads.html#00025)]

# [SECURITY] [DLA 1930-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1930-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 25 Sep 2019 11:49:28 +0200
* *Message-id*: <[[🔎]](/msgid-search/ba52dac8da9b7e2344f715a5c45d7b094f1440ec.camel%40debian.org) [ba52dac8da9b7e2344f715a5c45d7b094f1440ec.camel@debian.org](msg00025.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : linux
Version        : 3.16.74-1
CVE ID         : CVE-2016-10905 CVE-2018-20976 CVE-2018-21008 CVE-2019-0136
                 CVE-2019-9506 CVE-2019-14814 CVE-2019-14815 CVE-2019-14816
                 CVE-2019-14821 CVE-2019-14835 CVE-2019-15117 CVE-2019-15118
                 CVE-2019-15211 CVE-2019-15212 CVE-2019-15215 CVE-2019-15218
                 CVE-2019-15219 CVE-2019-15220 CVE-2019-15221 CVE-2019-15292
                 CVE-2019-15807 CVE-2019-15917 CVE-2019-15926

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2016-10905

    A race condition was discovered in the GFS2 file-system
    implementation, which could lead to a use-after-free.  On a system
    using GFS2, a local attacker could use this for denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2018-20976

    It was discovered that the XFS file-system implementation did not
    correctly handle some mount failure conditions, which could lead
    to a use-after-free.  The security impact of this is unclear.

CVE-2018-21008

    It was discovered that the rsi wifi driver did not correctly
    handle some failure conditions, which could lead to a use-after-
    free.  The security impact of this is unclear.

CVE-2019-0136

    It was discovered that the wifi soft-MAC implementation (mac80211)
    did not properly authenticate Tunneled Direct Link Setup (TDLS)
    messages.  A nearby attacker could use this for denial of service
    (loss of wifi connectivity).

CVE-2019-9506

    Daniele Antonioli, Nils Ole Tippenhauer, and Kasper Rasmussen
    discovered a weakness in the Bluetooth pairing protocols, dubbed
    the "KNOB attack".  An attacker that is nearby during pairing
    could use this to weaken the encryption used between the paired
    devices, and then to eavesdrop on and/or spoof communication
    between them.

    This update mitigates the attack by requiring a minimum encryption
    key length of 56 bits.

CVE-2019-14814, CVE-2019-14815, CVE-2019-14816

    Multiple bugs were discovered in the mwifiex wifi driver, which
    could lead to heap buffer overflows.  A local user permitted to
    configure a device handled by this driver could probably use this
    for privilege escalation.

CVE-2019-14821

    Matt Delco reported a race condition in KVM's coalesced MMIO
    facility, which could lead to out-of-bounds access in the kernel.
    A local attacker permitted to access /dev/kvm could use this to
    cause a denial of service (memory corruption or crash) or possibly
    for privilege escalation.

CVE-2019-14835

    Peter Pi of Tencent Blade Team discovered a missing bounds check
    in vhost_net, the network back-end driver for KVM hosts, leading
    to a buffer overflow when the host begins live migration of a VM.
    An attacker in control of a VM could use this to cause a denial of
    service (memory corruption or crash) or possibly for privilege
    escalation on the host.

CVE-2019-15117

    Hui Peng and Mathias Payer reported a missing bounds check in the
    usb-audio driver's descriptor parsing code, leading to a buffer
    over-read.  An attacker able to add USB devices could possibly use
    this to cause a denial of service (crash).

CVE-2019-15118

    Hui Peng and Mathias Payer reported unbounded recursion in the
    usb-audio driver's descriptor parsing code, leading to a stack
    overflow.  An attacker able to add USB devices could use this to
    cause a denial of service (memory corruption or crash) or possibly
    for privilege escalation.

CVE-2019-15211

    The syzkaller tool found a bug in the radio-raremono driver that
    could lead to a use-after-free.  An attacker able to add and
    remove USB devices could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-15212

    The syzkaller tool found that the rio500 driver does not work
    correctly if more than one device is bound to it.  An attacker
    able to add USB devices could use this to cause a denial of
    service (memory corruption or crash) or possibly for privilege
    escalation.

CVE-2019-15215

    The syzkaller tool found a bug in the cpia2_usb driver that leads
    to a use-after-free.  An attacker able to add and remove USB
    devices could use this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2019-15218

    The syzkaller tool found that the smsusb driver did not validate
    that USB devices have the expected endpoints, potentially leading
    to a null pointer dereference.  An attacker able to add USB
    devices could use this to cause a denial of service (BUG/oops).

CVE-2019-15219

    The syzkaller tool found that a device initialisation error in the
    sisusbvga driver could lead to a null pointer dereference.  An
    attacker able to add USB devices could use this to cause a denial
    of service (BUG/oops).

CVE-2019-15220

    The syzkaller tool found a race condition in the p54usb driver
    which could lead to a use-after-free.  An attacker able to add and
    remove USB devices could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-15221

    The syzkaller tool found that the line6 driver did not validate
    USB devices' maximum packet sizes, which could lead to a heap
    buffer overrun.  An attacker able to add USB devices could use
    this to cause a denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2019-15292

    The Hulk Robot tool found missing error checks in the Appletalk
    protocol implementation, which could lead to a use-after-free.
    The security impact of this is unclear.

CVE-2019-15807

    Jian Luo reported that the Serial Attached SCSI library (libsas)
    did not correctly handle failure to discover devices beyond a SAS
    expander.  This could lead to a resource leak and crash (BUG).
    The security impact of this is unclear.

CVE-2019-15917

    The syzkaller tool found a race condition in code supporting
    UART-attached Bluetooth adapters, which could lead to a use-
    after-free.  A local user with access to a pty device or other
    suitable tty device could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-15926

    It was found that the ath6kl wifi driver did not consistently
    validate traffic class numbers in received control packets,
    leading to out-of-bounds memory accesses.  A nearby attacker on
    the same wifi network could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

For Debian 8 "Jessie", these problems have been fixed in version
3.16.74-1.

We recommend that you upgrade your linux packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgpQkeQQtaRsA.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from git.kernel.org_1a54dbec_20250120_231917.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=3b0541791453fbe7f42867e310e0c9eb6295364d)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=3b0541791453fbe7f42867e310e0c9eb6295364d)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3b0541791453fbe7f42867e310e0c9eb6295364d)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3b0541791453fbe7f42867e310e0c9eb6295364d)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jason Yan <yanaijie@huawei.com> | 2019-05-14 10:42:39 +0800 |
| --- | --- | --- |
| committer | Martin K. Petersen <martin.petersen@oracle.com> | 2019-05-29 22:09:10 -0400 |
| commit | [3b0541791453fbe7f42867e310e0c9eb6295364d](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3b0541791453fbe7f42867e310e0c9eb6295364d) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=3b0541791453fbe7f42867e310e0c9eb6295364d)) | |
| tree | [720bc787776555b5d3fd324b8271443aa8bc6c88](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=3b0541791453fbe7f42867e310e0c9eb6295364d) | |
| parent | [04cf8b32bc6d3fbc640d5f62b3a14df207d3e1db](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=04cf8b32bc6d3fbc640d5f62b3a14df207d3e1db) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3b0541791453fbe7f42867e310e0c9eb6295364d&id2=04cf8b32bc6d3fbc640d5f62b3a14df207d3e1db)) | |
| download | [linux-3b0541791453fbe7f42867e310e0c9eb6295364d.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-3b0541791453fbe7f42867e310e0c9eb6295364d.tar.gz) | |

scsi: libsas: delete sas port if expander discover failedThe sas\_port(phy->port) allocated in sas\_ex\_discover\_expander() will not be
deleted when the expander failed to discover. This will cause resource leak
and a further issue of kernel BUG like below:
[159785.843156] port-2:17:29: trying to add phy phy-2:17:29 fails: it's
already part of another port
[159785.852144] ------------[ cut here ]------------
[159785.856833] kernel BUG at drivers/scsi/scsi\_transport\_sas.c:1086!
[159785.863000] Internal error: Oops - BUG: 0 [#1] SMP
[159785.867866] CPU: 39 PID: 16993 Comm: kworker/u96:2 Tainted: G
W OE 4.19.25-vhulk1901.1.0.h111.aarch64 #1
[159785.878458] Hardware name: Huawei Technologies Co., Ltd.
Hi1620EVBCS/Hi1620EVBCS, BIOS Hi1620 CS B070 1P TA 03/21/2019
[159785.889231] Workqueue: 0000:74:02.0\_disco\_q sas\_discover\_domain
[159785.895224] pstate: 40c00009 (nZcv daif +PAN +UAO)
[159785.900094] pc : sas\_port\_add\_phy+0x188/0x1b8
[159785.904524] lr : sas\_port\_add\_phy+0x188/0x1b8
[159785.908952] sp : ffff0001120e3b80
[159785.912341] x29: ffff0001120e3b80 x28: 0000000000000000
[159785.917727] x27: ffff802ade8f5400 x26: ffff0000681b7560
[159785.923111] x25: ffff802adf11a800 x24: ffff0000680e8000
[159785.928496] x23: ffff802ade8f5728 x22: ffff802ade8f5708
[159785.933880] x21: ffff802adea2db40 x20: ffff802ade8f5400
[159785.939264] x19: ffff802adea2d800 x18: 0000000000000010
[159785.944649] x17: 00000000821bf734 x16: ffff00006714faa0
[159785.950033] x15: ffff0000e8ab4ecf x14: 7261702079646165
[159785.955417] x13: 726c612073277469 x12: ffff00006887b830
[159785.960802] x11: ffff00006773eaa0 x10: 7968702079687020
[159785.966186] x9 : 0000000000002453 x8 : 726f702072656874
[159785.971570] x7 : 6f6e6120666f2074 x6 : ffff802bcfb21290
[159785.976955] x5 : ffff802bcfb21290 x4 : 0000000000000000
[159785.982339] x3 : ffff802bcfb298c8 x2 : 337752b234c2ab00
[159785.987723] x1 : 337752b234c2ab00 x0 : 0000000000000000
[159785.993108] Process kworker/u96:2 (pid: 16993, stack limit =
0x0000000072dae094)
[159786.000576] Call trace:
[159786.003097] sas\_port\_add\_phy+0x188/0x1b8
[159786.007179] sas\_ex\_get\_linkrate.isra.5+0x134/0x140
[159786.012130] sas\_ex\_discover\_expander+0x128/0x408
[159786.016906] sas\_ex\_discover\_dev+0x218/0x4c8
[159786.021249] sas\_ex\_discover\_devices+0x9c/0x1a8
[159786.025852] sas\_discover\_root\_expander+0x134/0x160
[159786.030802] sas\_discover\_domain+0x1b8/0x1e8
[159786.035148] process\_one\_work+0x1b4/0x3f8
[159786.039230] worker\_thread+0x54/0x470
[159786.042967] kthread+0x134/0x138
[159786.046269] ret\_from\_fork+0x10/0x18
[159786.049918] Code: 91322300 f0004402 91178042 97fe4c9b (d4210000)
[159786.056083] Modules linked in: hns3\_enet\_ut(OE) hclge(OE) hnae3(OE)
hisi\_sas\_test\_hw(OE) hisi\_sas\_test\_main(OE) serdes(OE)
[159786.067202] ---[ end trace 03622b9e2d99e196 ]---
[159786.071893] Kernel panic - not syncing: Fatal exception
[159786.077190] SMP: stopping secondary CPUs
[159786.081192] Kernel Offset: disabled
[159786.084753] CPU features: 0x2,a2a00a38
Fixes: 2908d778ab3e ("[SCSI] aic94xx: new driver")
Reported-by: Jian Luo <luojian5@huawei.com>
Signed-off-by: Jason Yan <yanaijie@huawei.com>
CC: John Garry <john.garry@huawei.com>
Signed-off-by: Martin K. Petersen <martin.petersen@oracle.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=3b0541791453fbe7f42867e310e0c9eb6295364d)

| -rw-r--r-- | [drivers/scsi/libsas/sas\_expander.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/scsi/libsas/sas_expander.c?id=3b0541791453fbe7f42867e310e0c9eb6295364d) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/scsi/libsas/sas\_expander.c b/drivers/scsi/libsas/sas\_expander.cindex 83f2fd70ce76b4..9f7e2457360e2d 100644--- a/[drivers/scsi/libsas/sas\_expander.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/scsi/libsas/sas_expander.c?id=04cf8b32bc6d3fbc640d5f62b3a14df207d3e1db)+++ b/[drivers/scsi/libsas/sas\_expander.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/scsi/libsas/sas_expander.c?id=3b0541791453fbe7f42867e310e0c9eb6295364d)@@ -1019,6 +1019,8 @@ static struct domain\_device \*sas\_ex\_discover\_expander( list\_del(&child->dev\_list\_node); spin\_unlock\_irq(&parent->port->dev\_list\_lock); sas\_put\_device(child);+ sas\_port\_delete(phy->port);+ phy->port = NULL; return NULL; } list\_add\_tail(&child->siblings, &parent->ex\_dev.children); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-20 23:17:54 +0000



=== Content from security.netapp.com_779b0a22_20250120_231918.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [September 2019 Linux Kernel Vulnerabilities in NetApp Products](https://security.netapp.com/advisory/ntap-20191004-0001)

## September 2019 Linux Kernel Vulnerabilities in NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20191004-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20191004-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20191004-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20191004-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20191004-0001
**Version:**
18.0

**Last updated:**
05/27/2022

**Status:**
Final.

**CVEs:** CVE-2019-15666, CVE-2019-15538, CVE-2019-15807, CVE-2018-21008, CVE-2019-15921, CVE-2019-15922, CVE-2019-15923, CVE-2019-15924, CVE-2019-15902, CVE-2019-15916, CVE-2019-15917, CVE-2019-15918, CVE-2019-15919, CVE-2019-15920, CVE-2019-15925, CVE-2019-15926, CVE-2019-15927, CVE-2019-16089, CVE-2019-16229, CVE-2019-16230, CVE-2019-16231, CVE-2019-16232, CVE-2019-16233, CVE-2019-16234, CVE-2019-15031, CVE-2019-15030, CVE-2019-16413, CVE-2019-14821

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions through 5.2.14 are susceptible to vulnerabilities which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of these vulnerabilities could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2018-21008](https://nvd.nist.gov/vuln/detail/CVE-2018-21008) | 5.5 (MEDIUM) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-14821](https://nvd.nist.gov/vuln/detail/CVE-2019-14821) | 8.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H |
| [CVE-2019-15030](https://nvd.nist.gov/vuln/detail/CVE-2019-15030) | 7.1 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H |
| [CVE-2019-15031](https://nvd.nist.gov/vuln/detail/CVE-2019-15031) | 7.1 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H |
| [CVE-2019-15538](https://nvd.nist.gov/vuln/detail/CVE-2019-15538) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-15666](https://nvd.nist.gov/vuln/detail/CVE-2019-15666) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-15807](https://nvd.nist.gov/vuln/detail/CVE-2019-15807) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-15902](https://nvd.nist.gov/vuln/detail/CVE-2019-15902) | 9.8 (CRITICAL) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-15916](https://nvd.nist.gov/vuln/detail/CVE-2019-15916) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-15917](https://nvd.nist.gov/vuln/detail/CVE-2019-15917) | 7.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-15918](https://nvd.nist.gov/vuln/detail/CVE-2019-15918) | 7.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-15919](https://nvd.nist.gov/vuln/detail/CVE-2019-15919) | 7.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-15920](https://nvd.nist.gov/vuln/detail/CVE-2019-15920) | 7.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-15921](https://nvd.nist.gov/vuln/detail/CVE-2019-15921) | 7.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-15922](https://nvd.nist.gov/vuln/detail/CVE-2019-15922) | 5.5 (MEDIUM) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-15923](https://nvd.nist.gov/vuln/detail/CVE-2019-15923) | 5.5 (MEDIUM) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-15924](https://nvd.nist.gov/vuln/detail/CVE-2019-15924) | 5.5 (MEDIUM) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-15925](https://nvd.nist.gov/vuln/detail/CVE-2019-15925) | 7.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-15926](https://nvd.nist.gov/vuln/detail/CVE-2019-15926) | 9.1 (CRITICAL) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:H |
| [CVE-2019-15927](https://nvd.nist.gov/vuln/detail/CVE-2019-15927) | 7.8 (HIGH) | CVSS:3.0/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-16089](https://nvd.nist.gov/vuln/detail/CVE-2019-16089) | 9.8 (CRITICAL) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2019-16229](https://nvd.nist.gov/vuln/detail/CVE-2019-16229) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-16230](https://nvd.nist.gov/vuln/detail/CVE-2019-16230) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-16231](https://nvd.nist.gov/vuln/detail/CVE-2019-16231) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-16232](https://nvd.nist.gov/vuln/detail/CVE-2019-16232) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-16233](https://nvd.nist.gov/vuln/detail/CVE-2019-16233) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-16234](https://nvd.nist.gov/vuln/detail/CVE-2019-16234) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2019-16413](https://nvd.nist.gov/vuln/detail/CVE-2019-16413) | 7.5 (HIGH) | CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

Affected Products
#### Affected Products

* AFF Baseboard Management Controller (BMC) - A700s
* FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800
* NetApp Data Availability Services
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire Baseboard Management Controller (BMC)

#### Products Not Affected

* 7-Mode Transition Tool
* ATTO FibreBridge - 6500N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Trident
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Manager
* Cloud Secure Agent
* Cloud Volumes ONTAP Mediator
* Clustered Data ONTAP
* Clustered Data ONTAP Antivirus Connector
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Storage Manager
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element HealthTools
* Element Plug-in for vCenter Server
* FAS/AFF BIOS
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* MetroCluster Tiebreaker for clustered Data ONTAP
* NetApp Cloud Backup (formerly AltaVault)
* NetApp Cloud Backup OST Plug-in (formerly AltaVault OST Plug-in)
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Performance Analyzer
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Nodes
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp SANtricity SMI-S Provider
* NetApp SMI-S Provider
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp SteelStore Cloud Integrated Storage
* NetApp VASA Provider for Clustered Data ONTAP 9.7 and above
* ONTAP Select Deploy administration utility
* OnCommand Insight
* OnCommand Workflow Automation
* Open Systems SnapVault Agent
* SAS Firmware
* Service Processor
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere
* SnapManager for Hyper-V
* SnapManager for SAP
* SolidFire Storage Replication Adapter
* Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 9.7 and above
* Storage Services Connector
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID Baseboard Management Controller (BMC)
* StorageGRID9 (9.x and prior)
* System Manager 9.x
* Virtual Storage Console for VMware vSphere 9.7 and above

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H610S** | <https://mysupport.netapp.com/site/products/all/details/5d9f1108e01d9c0001ee51dd/downloads-tab/download/62542/Compute_Firmware_Bundle> <https://mysupport.netapp.com/site/products/all/details/element-software/downloads-tab/download/62654/Storage_Firmware_Bundle> First included in version 2.27 of the Compute and Storage Firmware Bundles. |
| **AFF Baseboard Management Controller (BMC) - A700s** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1272306 First fixed versions include the following: 1.81 |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2884466.html) for more information. |
| **NetApp SolidFire & HCI Management Node** | <https://mysupport.netapp.com/site/products/all/details/element-software/downloads-tab/download/62654/12.5> <https://mysupport.netapp.com/site/products/all/details/netapp-hci/downloads-tab/download/62542/1.10> |
| **NetApp SolidFire Baseboard Management Controller (BMC)** | NetApp SolidFire Baseboard Management Controller (BMC) has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2847476.html%20) for more information. |
| **NetApp Data Availability Services** | NetApp Data Availability Services has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2870808.html) for more information. |
| **FAS/AFF Baseboard Management Controller (BMC) - A320/C190/A220/FAS2720/FAS2750/A800** | <https://mysupport.netapp.com/site/downloads/firmware/system-firmware-diagnostics> Fixed by bug 1272307 First fixed versions include the following: 10.4, 11.5, 12.2 |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20191004-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20191004 | Initial Public Release |
| 2.0 | 20191015 | AFF Baseboard Management Controller (BMC) - A700s moved to Affected Products |
| 3.0 | 20191022 | Storage Replication Adapter for Clustered Data ONTAP for VMware vSphere 7.2 and above, NetApp VASA Provider for Clustered Data ONTAP 7.2 and above, Virtual Storage Console for VMware vSphere 7.2 and above moved to Products Not Affected |
| 4.0 | 20191024 | Active IQ Unified Manager (formerly OnCommand Unified Manager) for VMware vSphere 9.5 and above moved to Affected Products |
| 5.0 | 20191028 | NetApp Data Availability Services moved to Affected Products |
| 6.0 | 20191101 | Element Software Management Node moved to Affected Products |
| 7.0 | 20191108 | After additional review, Service Processor moved to Products Not Affected |
| 8.0 | 20191121 | After additional review, Active IQ Unified Manager (formerly OnCommand Unified Manager) for VMware vSphere 9.5 and above moved to Products Not Affected |
| 9.0 | 20200311 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S moved to Affected Products |
| 10.0 | 20200313 | NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Affected Products |
| 11.0 | 20200327 | Active IQ Performance Analytics Services added to Software Versions and Fixes |
| 12.0 | 20200605 | FAS/AFF Baseboard Management Controller (BMC) added to Software Versions and Fixes |
| 13.0 | 20200724 | NetApp Data Availability Services moved to Won't Fix status |
| 14.0 | 20201012 | NetApp HCI Baseboard Management Controller (BMC) - H610S added to Software Versions and Fixes |
| 15.0 | 20210722 | AFF Baseboard Management Controller (BMC) - A700s added to Software Versions and Fixes |
| 16.0 | 20211012 | NetApp HCI Baseboard Management Controller (BMC) - H410C and NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H300E/H500E/H700E/H410S moved to Won't Fix status |
| 17.0 | 20211101 | NetApp SolidFire Baseboard Management Controller (BMC) moved to Won't Fix status |
| 18.0 | 20220527 | NetApp SolidFire & HCI Management Node added to Software Versions and Fixes, Final status |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from lists.debian.org_ee6ad7bd_20250120_231917.html ===


---

[[Date Prev](msg00013.html)][[Date Next](msg00015.html)]
[[Thread Prev](msg00013.html)][[Thread Next](msg00015.html)]
[[Date Index](maillist.html#00014)]
[[Thread Index](threads.html#00014)]

# [SECURITY] [DLA 1919-1] linux-4.9 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1919-1] linux-4.9 security update
* *From*: Ben Hutchings <ben@decadent.org.uk>
* *Date*: Sat, 14 Sep 2019 01:21:38 +0100
* *Message-id*: <[[🔎]](/msgid-search/10d9388cef36a0b5589338f8eac9f45e0e609eeb.camel%40decadent.org.uk) [10d9388cef36a0b5589338f8eac9f45e0e609eeb.camel@decadent.org.uk](msg00014.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : linux-4.9
Version        : 4.9.189-3~deb8u1
CVE ID         : CVE-2019-0136 CVE-2019-9506 CVE-2019-11487 CVE-2019-15211
                 CVE-2019-15212 CVE-2019-15215 CVE-2019-15216 CVE-2019-15218
                 CVE-2019-15219 CVE-2019-15220 CVE-2019-15221 CVE-2019-15292
                 CVE-2019-15538 CVE-2019-15666 CVE-2019-15807 CVE-2019-15924
                 CVE-2019-15926
Debian Bug     : 930904

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2019-0136

    It was discovered that the wifi soft-MAC implementation (mac80211)
    did not properly authenticate Tunneled Direct Link Setup (TDLS)
    messages.  A nearby attacker could use this for denial of service
    (loss of wifi connectivity).

CVE-2019-9506

    Daniele Antonioli, Nils Ole Tippenhauer, and Kasper Rasmussen
    discovered a weakness in the Bluetooth pairing protocols, dubbed
    the "KNOB attack".  An attacker that is nearby during pairing
    could use this to weaken the encryption used between the paired
    devices, and then to eavesdrop on and/or spoof communication
    between them.

    This update mitigates the attack by requiring a minimum encryption
    key length of 56 bits.

CVE-2019-11487

    Jann Horn discovered that the FUSE (Filesystem-in-Userspace)
    facility could be used to cause integer overflow in page reference
    counts, leading to a use-after-free.  On a system with sufficient
    physical memory, a local user permitted to create arbitrary FUSE
    mounts could use this for privilege escalation.

    By default, unprivileged users can only mount FUSE filesystems
    through fusermount, which limits the number of mounts created and
    should completely mitigate the issue.

CVE-2019-15211

    The syzkaller tool found a bug in the radio-raremono driver that
    could lead to a use-after-free.  An attacker able to add and
    remove USB devices could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-15212

    The syzkaller tool found that the rio500 driver does not work
    correctly if more than one device is bound to it.  An attacker
    able to add USB devices could use this to cause a denial of
    service (memory corruption or crash) or possibly for privilege
    escalation.

CVE-2019-15215

    The syzkaller tool found a bug in the cpia2_usb driver that leads
    to a use-after-free.  An attacker able to add and remove USB
    devices could use this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2019-15216

    The syzkaller tool found a bug in the yurex driver that leads to
    a use-after-free.  An attacker able to add and remove USB
    devices could use this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2019-15218

    The syzkaller tool found that the smsusb driver did not validate
    that USB devices have the expected endpoints, potentially leading
    to a null pointer dereference.  An attacker able to add USB
    devices could use this to cause a denial of service (BUG/oops).

CVE-2019-15219

    The syzkaller tool found that a device initialisation error in the
    sisusbvga driver could lead to a null pointer dereference.  An
    attacker able to add USB devices could use this to cause a denial
    of service (BUG/oops).

CVE-2019-15220

    The syzkaller tool found a race condition in the p54usb driver
    which could lead to a use-after-free.  An attacker able to add and
    remove USB devices could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

CVE-2019-15221

    The syzkaller tool found that the line6 driver did not validate
    USB devices' maximum packet sizes, which could lead to a heap
    buffer overrun.  An attacker able to add USB devices could use
    this to cause a denial of service (memory corruption or crash) or
    possibly for privilege escalation.

CVE-2019-15292

    The Hulk Robot tool found missing error checks in the Appletalk
    protocol implementation, which could lead to a use-after-free.
    The security impact of this is unclear.

CVE-2019-15538

    Benjamin Moody reported that operations on XFS hung after a
    chgrp command failed due to a disk quota.  A local user on a
    system using XFS and disk quotas could use this for denial of
    service.

CVE-2019-15666

    The Hulk Robot tool found an incorrect range check in the network
    transformation (xfrm) layer, leading to out-of-bounds memory
    accesses.  A local user with CAP_NET_ADMIN capability (in any user
    namespace) could use this to cause a denial of service (memory
    corruption or crash) or possibly for privilege escalation.

CVE-2019-15807

    Jian Luo reported that the Serial Attached SCSI library (libsas)
    did not correctly handle failure to discover devices beyond a SAS
    expander.  This could lead to a resource leak and crash (BUG).
    The security impact of this is unclear.

CVE-2019-15924

    The Hulk Robot tool found a missing error check in the fm10k
    Ethernet driver, which could lead to a null pointer dereference
    and crash (BUG/oops).  The security impact of this is unclear.

CVE-2019-15926

    It was found that the ath6kl wifi driver did not consistently
    validate traffic class numbers in received control packets,
    leading to out-of-bounds memory accesses.  A nearby attacker on
    the same wifi network could use this to cause a denial of service
    (memory corruption or crash) or possibly for privilege escalation.

For Debian 8 "Jessie", these problems have been fixed in version
4.9.189-3~deb8u1.

We recommend that you upgrade your linux-4.9 packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgpwtBv6UP835.pgp)**

*Description:* This is a digitally signed message part

---


