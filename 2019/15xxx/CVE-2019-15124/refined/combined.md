=== Content from phabricator.wikimedia.org_a34df4e5_20250120_231850.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT230576)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T230576
# XSS in edit summary for ex:MobileFrontend Special:Watchlist (CVE-2019-15124)Closed, Resolved[Public](/policy/explain/PHID-TASK-leqfydprwx3yiczl7qoo/view/)Actions

* [Edit Task](/maniphest/task/edit/230576/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/230576/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-leqfydprwx3yiczl7qoo/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-leqfydprwx3yiczl7qoo/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-leqfydprwx3yiczl7qoo/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-leqfydprwx3yiczl7qoo/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-leqfydprwx3yiczl7qoo/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-leqfydprwx3yiczl7qoo/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-leqfydprwx3yiczl7qoo/)
* [Protect as security issue](/wmf/escalate-task/230576/)
* [Award Token](/token/give/PHID-TASK-leqfydprwx3yiczl7qoo/)
* [Flag For Later](/flag/edit/PHID-TASK-leqfydprwx3yiczl7qoo/)

Assigned To

|  | [sbassett](/p/sbassett/) |
| --- | --- |

Authored By

|  | [sbassett](/p/sbassett/) |
| --- | --- |
| Aug 15 2019, 8:32 PM2019-08-15 20:32:30 (UTC+0) |

Tags

* [Vuln-XSS](/tag/vuln-xss/)
* [MW-1.34-notes (1.34.0-wmf.20; 2019-08-27)](/project/view/4136/)
* [Security](/tag/security/)
* [MobileFrontend (MobileFrontend Special Pages)](/project/view/3707/) [(Backlog)](/project/board/3707/)
Referenced Files

|  | [F30041338: T230576.patch](/F30041338) |
| --- | --- |
| Aug 15 2019, 8:45 PM2019-08-15 20:45:57 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [MarcoAurelio](/p/MarcoAurelio/) |
| --- | --- |

|  | [MaxSem](/p/MaxSem/) |
| --- | --- |

|  | [Reedy](/p/Reedy/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

|  | [tstarling](/p/tstarling/) |
| --- | --- |

# Description

After [T229541](/T229541) was reported and resolved, I checked [MobileFrontend](https://www.mediawiki.org/wiki/Extension%3AMobileFrontend) for more instances of Sanitizer::stripAllTags() and found another one in [includes/specials/SpecialMobileWatchlist.php](https://gerrit.wikimedia.org/g/mediawiki/extensions/MobileFrontend/%2B/737fda853af38fbc3bc62f964af606d7033ebc65/includes/specials/SpecialMobileWatchlist.php#391) and confirmed it also renders an XSS.

**Steps to reproduce:**

1. Create a test page or edit any wiki page
2. Enter some JavaScript within the edit summary field, e.g. <script>alert('xss')</script>
3. Add this page to your watchlist
4. Visit the mobile version of your watchlist feed, e.g. <https://en.m.wikipedia.org/w/index.php?title=Special:Watchlist&watchlistview=feed&filter=all>

**n.b.** there are a few more calls to Sanitizer::stripAllTags [within other extensions](https://codesearch.wmflabs.org/extensions/?q=Sanitizer%3A%3AstripAllTags&i=nope&files=&repos=) and it's probably worth auditing these. I think we're also hoping to catch more issues like this by [setting Sanitizer::stripAllTags' @return-taint to tainted](https://gerrit.wikimedia.org/r/c/mediawiki/core/%2B/530009) for phan-taint-check.

# Details

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: escape edit summaries in mobile watchlist page](https://gerrit.wikimedia.org/r/c/531568) | [mediawiki/extensions/MobileFrontend](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend) | [REL1\_31](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend/%2B/REL1_31) | +1 -1 |
|  | [SECURITY: escape edit summaries in mobile watchlist page](https://gerrit.wikimedia.org/r/c/531567) | [mediawiki/extensions/MobileFrontend](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend) | [REL1\_32](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend/%2B/REL1_32) | +1 -1 |
|  | [SECURITY: escape edit summaries in mobile watchlist page](https://gerrit.wikimedia.org/r/c/531566) | [mediawiki/extensions/MobileFrontend](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend) | [REL1\_33](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend/%2B/REL1_33) | +1 -1 |
|  | [SECURITY: escape edit summaries in mobile watchlist page](https://gerrit.wikimedia.org/r/c/531565) | [mediawiki/extensions/MobileFrontend](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/MobileFrontend/%2B/master) | +1 -1 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T230576)
# Related Objects

* Mentions

Mentioned In [T232113: Write and send supplementary release announcement for extensions with security patches (MediaWiki 1.31.4/1.32.4/1.33.1)](/T232113) Mentioned Here [T229541: Javascript injection in edit summary on mobile site (CVE-2019-14807)](/T229541)
### Event Timeline

[sbassett](/p/sbassett/) created this task.[Aug 15 2019, 8:32 PM2019-08-15 20:32:30 (UTC+0)](#5417112)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/3255299/)[Aug 15 2019, 8:32 PM2019-08-15 20:32:32 (UTC+0)](#5417123)[MarcoAurelio](/p/MarcoAurelio/) added projects: [MobileFrontend](/tag/mobilefrontend/), [Vuln-XSS](/tag/vuln-xss/).[Aug 15 2019, 8:33 PM2019-08-15 20:33:45 (UTC+0)](#5417127)[sbassett](/p/sbassett/) triaged this task as Unbreak Now! priority.[Aug 15 2019, 8:34 PM2019-08-15 20:34:03 (UTC+0)](#5417138)[sbassett](/p/sbassett/) added subscribers: [MarcoAurelio](/p/MarcoAurelio/), [MaxSem](/p/MaxSem/), [Reedy](/p/Reedy/), [tstarling](/p/tstarling/).[sbassett](/p/sbassett/) added a comment.[Aug 15 2019, 8:45 PM2019-08-15 20:45:57 (UTC+0)](#5417187)Comment Actions

Proposed patch, same mitigation as [T229541](/T229541):

T230576.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/yukdxs52t42eklfwn76s/PHID-FILE-dsj3hxvxp57cmzerssgc/T230576.patch)

[sbassett](/p/sbassett/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Aug 15 2019, 8:46 PM2019-08-15 20:46:58 (UTC+0)](#5417189)[sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-ghlzt5hvlspto6x/)[Aug 16 2019, 2:02 PM2019-08-16 14:02:45 (UTC+0)](#5418075)[sbassett](/p/sbassett/) added a comment.[Aug 16 2019, 7:50 PM2019-08-16 19:50:50 (UTC+0)](#5418678)Comment Actions

Patch tested locally, worked fine. [Deployed](https://tools.wmflabs.org/sal/log/AWyb-VTCOwpQ-3Pksgks) patch to wmf/1.34.0-wmf.17 and tested. I'll request another CVE for this one. Once I have the id, I'll make this task public and backport to master and supported release branches in gerrit.

[sbassett](/p/sbassett/) lowered the priority of this task from Unbreak Now! to High.[Aug 16 2019, 7:51 PM2019-08-16 19:51:02 (UTC+0)](#5418679)[sbassett](/p/sbassett/) removed a project: [Patch-For-Review](/tag/patch-for-review/).[Aug 16 2019, 7:59 PM2019-08-16 19:59:28 (UTC+0)](#5418700)[sbassett](/p/sbassett/) added a comment.[Aug 16 2019, 9:42 PM2019-08-16 21:42:58 (UTC+0)](#5418894)Comment Actions

**Update:** [CVE-2019-15124](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-15124).

[sbassett](/p/sbassett/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-jvqn3rnlnewz3xr/)" to "Public (No Login Required)".[Aug 21 2019, 9:30 PM2019-08-21 21:30:11 (UTC+0)](#5429777)[gerritbot](/p/gerritbot/) added a comment.[Aug 21 2019, 9:30 PM2019-08-21 21:30:37 (UTC+0)](#5429780)Comment Actions

Change 531565 had a related patch set uploaded (by SBassett; owner: SBassett):

[mediawiki/extensions/MobileFrontend@master] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531565>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Aug 21 2019, 9:30 PM2019-08-21 21:30:38 (UTC+0)](#5429781)Comment Actions

Change 531566 had a related patch set uploaded (by SBassett; owner: SBassett):

[mediawiki/extensions/MobileFrontend@REL1\_33] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531566>

[gerritbot](/p/gerritbot/) added a comment.[Aug 21 2019, 9:31 PM2019-08-21 21:31:58 (UTC+0)](#5429786)Comment Actions

Change 531567 had a related patch set uploaded (by SBassett; owner: SBassett):

[mediawiki/extensions/MobileFrontend@REL1\_32] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531567>

[gerritbot](/p/gerritbot/) added a comment.[Aug 21 2019, 9:32 PM2019-08-21 21:32:16 (UTC+0)](#5429787)Comment Actions

Change 531568 had a related patch set uploaded (by SBassett; owner: SBassett):

[mediawiki/extensions/MobileFrontend@REL1\_31] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531568>

[gerritbot](/p/gerritbot/) added a comment.[Aug 21 2019, 10:10 PM2019-08-21 22:10:38 (UTC+0)](#5429846)Comment Actions

Change 531565 **merged** by jenkins-bot:

[mediawiki/extensions/MobileFrontend@master] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531565>

[ReleaseTaggerBot](/p/ReleaseTaggerBot/) added a project: [MW-1.34-notes (1.34.0-wmf.20; 2019-08-27)](/project/view/4136/).[Aug 21 2019, 11:00 PM2019-08-21 23:00:35 (UTC+0)](#5429925)[gerritbot](/p/gerritbot/) added a comment.[Aug 22 2019, 2:09 PM2019-08-22 14:09:53 (UTC+0)](#5431566)Comment Actions

Change 531568 **merged** by SBassett:

[mediawiki/extensions/MobileFrontend@REL1\_31] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531568>

[gerritbot](/p/gerritbot/) added a comment.[Aug 22 2019, 2:10 PM2019-08-22 14:10:09 (UTC+0)](#5431569)Comment Actions

Change 531566 **merged** by SBassett:

[mediawiki/extensions/MobileFrontend@REL1\_33] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531566>

[gerritbot](/p/gerritbot/) added a comment.[Aug 22 2019, 2:10 PM2019-08-22 14:10:21 (UTC+0)](#5431570)Comment Actions

Change 531567 **merged** by SBassett:

[mediawiki/extensions/MobileFrontend@REL1\_32] SECURITY: escape edit summaries in mobile watchlist page

<https://gerrit.wikimedia.org/r/531567>

[sbassett](/p/sbassett/) closed this task as Resolved.[Aug 22 2019, 2:18 PM2019-08-22 14:18:17 (UTC+0)](#5431586)[sbassett](/p/sbassett/) claimed this task.[sbassett](/p/sbassett/) removed a project: [Patch-For-Review](/tag/patch-for-review/).Comment Actions

Backports complete in gerrit, resolving task for now.

[sbassett](/p/sbassett/) renamed this task from XSS in edit summary for ex:MobileFrontend Special:Watchlist to XSS in edit summary for ex:MobileFrontend Special:Watchlist (CVE-2019-15124).[Sep 3 2019, 6:05 PM2019-09-03 18:05:45 (UTC+0)](#5462604)[sbassett](/p/sbassett/) mentioned this in [T232113: Write and send supplementary release announcement for extensions with security patches (MediaWiki 1.31.4/1.32.4/1.33.1)](/T232113).[Sep 5 2019, 3:38 PM2019-09-05 15:38:14 (UTC+0)](#5468427)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:54 PM2020-02-10 22:54:03 (UTC+0)](#5868227) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:14 PM2020-02-20 20:14:44 (UTC+0)](#5903915) · [sbassett](/p/sbassett/) updated the task description. [(Show Details)](/transactions/detail/PHID-XACT-TASK-squbelzbdjc6u5y/)[Mar 24 2020, 2:07 AM2020-03-24 02:07:32 (UTC+0)](#5993909)[Jdlrobson](/p/Jdlrobson/) edited projects, added [MobileFrontend (MobileFrontend Special Pages)](/project/view/3707/); removed [MobileFrontend](/tag/mobilefrontend/).[Jan 20 2022, 1:22 AM2022-01-20 01:22:35 (UTC+0)](#7635305)[Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
