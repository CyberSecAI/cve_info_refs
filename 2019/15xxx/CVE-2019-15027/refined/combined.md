=== Content from github.com_400b67cf_20250121_001735.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fandr3jx%2FMTK6577%2Fblob%2F238012ebf18e3751397884d1742ff7ab6417e80d%2Fmediatek%2Fplatform%2Fmt6577%2Fexternal%2Fmeta%2Femmc%2Fmeta_clr_emmc.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fandr3jx%2FMTK6577%2Fblob%2F238012ebf18e3751397884d1742ff7ab6417e80d%2Fmediatek%2Fplatform%2Fmt6577%2Fexternal%2Fmeta%2Femmc%2Fmeta_clr_emmc.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=andr3jx%2FMTK6577)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[andr3jx](/andr3jx)
/
**[MTK6577](/andr3jx/MTK6577)**
Public

forked from [tpruvot/MTK6577](/tpruvot/MTK6577)

* [Notifications](/login?return_to=%2Fandr3jx%2FMTK6577) You must be signed in to change notification settings
* [Fork
  37](/login?return_to=%2Fandr3jx%2FMTK6577)
* [Star
   60](/login?return_to=%2Fandr3jx%2FMTK6577)

* [Code](/andr3jx/MTK6577)
* [Pull requests
  1](/andr3jx/MTK6577/pulls)
* [Actions](/andr3jx/MTK6577/actions)
* [Projects
  0](/andr3jx/MTK6577/projects)
* [Wiki](/andr3jx/MTK6577/wiki)
* [Security](/andr3jx/MTK6577/security)
* [Insights](/andr3jx/MTK6577/pulse)

Additional navigation options

* [Code](/andr3jx/MTK6577)
* [Pull requests](/andr3jx/MTK6577/pulls)
* [Actions](/andr3jx/MTK6577/actions)
* [Projects](/andr3jx/MTK6577/projects)
* [Wiki](/andr3jx/MTK6577/wiki)
* [Security](/andr3jx/MTK6577/security)
* [Insights](/andr3jx/MTK6577/pulse)

## Files

 238012e
## Breadcrumbs

1. [MTK6577](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d)
2. /[mediatek](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek)
3. /[platform](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform)
4. /[mt6577](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577)
5. /[external](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external)
6. /[meta](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external/meta)
7. /[emmc](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external/meta/emmc)
/
# meta\_clr\_emmc.c

Copy path Blame  Blame
## Latest commit

## History

[History](/andr3jx/MTK6577/commits/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external/meta/emmc/meta_clr_emmc.c)449 lines (404 loc) · 12.4 KB 238012e
## Breadcrumbs

1. [MTK6577](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d)
2. /[mediatek](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek)
3. /[platform](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform)
4. /[mt6577](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577)
5. /[external](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external)
6. /[meta](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external/meta)
7. /[emmc](/andr3jx/MTK6577/tree/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external/meta/emmc)
/
# meta\_clr\_emmc.c

Top
## File metadata and controls

* Code
* Blame

449 lines (404 loc) · 12.4 KB[Raw](https://github.com/andr3jx/MTK6577/raw/238012ebf18e3751397884d1742ff7ab6417e80d/mediatek/platform/mt6577/external/meta/emmc/meta_clr_emmc.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* Copyright Statement:\* --------------------\* This software is protected by Copyright and the information contained\* herein is confidential. The software may not be copied and the information\* contained herein may not be used or disclosed except with the written\* permission of MediaTek Inc. (C) 2008\*\* BY OPENING THIS FILE, BUYER HEREBY UNEQUIVOCALLY ACKNOWLEDGES AND AGREES\* THAT THE SOFTWARE/FIRMWARE AND ITS DOCUMENTATIONS ("MEDIATEK SOFTWARE")\* RECEIVED FROM MEDIATEK AND/OR ITS REPRESENTATIVES ARE PROVIDED TO BUYER ON\* AN "AS-IS" BASIS ONLY. MEDIATEK EXPRESSLY DISCLAIMS ANY AND ALL WARRANTIES,\* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE IMPLIED WARRANTIES OF\* MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE OR NONINFRINGEMENT.\* NEITHER DOES MEDIATEK PROVIDE ANY WARRANTY WHATSOEVER WITH RESPECT TO THE\* SOFTWARE OF ANY THIRD PARTY WHICH MAY BE USED BY, INCORPORATED IN, OR\* SUPPLIED WITH THE MEDIATEK SOFTWARE, AND BUYER AGREES TO LOOK ONLY TO SUCH\* THIRD PARTY FOR ANY WARRANTY CLAIM RELATING THERETO. MEDIATEK SHALL ALSO\* NOT BE RESPONSIBLE FOR ANY MEDIATEK SOFTWARE RELEASES MADE TO BUYER'S\* SPECIFICATION OR TO CONFORM TO A PARTICULAR STANDARD OR OPEN FORUM.\*\* BUYER'S SOLE AND EXCLUSIVE REMEDY AND MEDIATEK'S ENTIRE AND CUMULATIVE\* LIABILITY WITH RESPECT TO THE MEDIATEK SOFTWARE RELEASED HEREUNDER WILL BE,\* AT MEDIATEK'S OPTION, TO REVISE OR REPLACE THE MEDIATEK SOFTWARE AT ISSUE,\* OR REFUND ANY SOFTWARE LICENSE FEES OR SERVICE CHARGE PAID BY BUYER TO\* MEDIATEK FOR SUCH MEDIATEK SOFTWARE AT ISSUE.\*\* THE TRANSACTION CONTEMPLATED HEREUNDER SHALL BE CONSTRUED IN ACCORDANCE\* WITH THE LAWS OF THE STATE OF CALIFORNIA, USA, EXCLUDING ITS CONFLICT OF\* LAWS PRINCIPLES. ANY DISPUTES, CONTROVERSIES OR CLAIMS ARISING THEREOF AND\* RELATED THERETO SHALL BE SETTLED BY ARBITRATION IN SAN FRANCISCO, CA, UNDER\* THE RULES OF THE INTERNATIONAL CHAMBER OF COMMERCE (ICC).\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*//\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* \* \* Filename: \* --------- \* meta\_fm.h \* \* Project: \* -------- \* YUSU \* \* Description: \* ------------ \* FM meta implement. \* \* Author: \* ------- \* LiChunhui (MTK80143) \* \*============================================================================ \* HISTORY \* Below this line, this part is controlled by CC/CQ. DO NOT MODIFY!! \*------------------------------------------------------------------------------ \* $Revision:$ \* $Modtime:$ \* $Log:$ \* \* 07 03 2012 vend\_am00076 \* [ALPS00269605] [MP Feature Patch Back]Shared sdcard feature support \* shared sdcard --meta mode \* \* 03 12 2012 vend\_am00076 \* [ALPS00251394] [Patch Request] \* . \* \* 03 02 2012 vend\_am00076 \* NULL \* . \* \* 01 26 2011 hongcheng.xia \* [ALPS00030208] [Need Patch] [Volunteer Patch][MT6620 FM]enable FM Meta mode \* . \* \* 11 18 2010 hongcheng.xia \* [ALPS00135614] [Need Patch] [Volunteer Patch]MT6620 FM Radio code check in \* . \* \* 11 16 2010 hongcheng.xia \* [ALPS00135614] [Need Patch] [Volunteer Patch]MT6620 FM Radio code check in \* . \* \* 11 15 2010 hongcheng.xia \* [ALPS00135614] [Need Patch] [Volunteer Patch]MT6620 FM Radio code check in \* . \* \* 11 15 2010 hongcheng.xia \* [ALPS00135614] [Need Patch] [Volunteer Patch]MT6620 FM Radio code check in \* . \* \* 08 28 2010 chunhui.li \* [ALPS00123709] [Bluetooth] meta mode check in \* for FM meta enable
 \* \*------------------------------------------------------------------------------ \* Upper this line, this part is controlled by CC/CQ. DO NOT MODIFY!! \*============================================================================ \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/#include <stdio.h> /\* Standard input/output definitions \*/#include <string.h> /\* String function definitions \*/#include <unistd.h> /\* UNIX standard function definitions \*/#include <fcntl.h> /\* File control definitions \*/#include <errno.h> /\* Error number definitions \*/#include <termios.h> /\* POSIX terminal control definitions \*/#include <time.h>#include <pthread.h>#include <stdlib.h>#include <signal.h>#include <sys/types.h>#include <sys/wait.h>#include <sys/socket.h>#include <sys/epoll.h>#include <sys/reboot.h>#include <sys/mount.h>#include <utils/Log.h>#include <dirent.h>#include "FT\_Public.h"#include "meta\_common.h"#include "mounts.h"#include "meta\_clr\_emmc\_para.h"#include "make\_ext4fs.h"
#undef LOG\_TAG#define LOG\_TAG "CLR\_EMMC\_META"#define DATA\_PARTITION "/data"#define CACHE\_PARTITION "/cache"
extern BOOL WriteDataToPC(void \*Local\_buf,unsigned short Local\_len,void \*Peer\_buf,unsigned short Peer\_len);
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*//FUNCTION:// META\_CLR\_EMMC\_init//DESCRIPTION:// EMMC Init for META test.////PARAMETERS:// void//RETURN VALUE:// true : success// false: failed//\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/bool META\_CLR\_EMMC\_init(){ LOGD("META\_CLR\_EMMC\_INIT ...\n"); return 1;}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*//FUNCTION:// META\_CLR\_EMMC\_deinit//DESCRIPTION:// EMMC deinit for META test.////PARAMETERS:// void//RETURN VALUE:// void// \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/void META\_CLR\_EMMC\_deinit(){ LOGD("META\_CLR\_EMMC\_DEINIT ...\n"); return; }#if 0int ensure\_path\_mounted(const char\* path) { int result; result = scan\_mounted\_volumes(); if (result < 0) { LOGE("failed to scan mounted volumes\n"); return -1; }
 const MountedVolume\* mv = find\_mounted\_volume\_by\_mount\_point("/data"); const MountedVolume\* m\_v = find\_mounted\_volume\_by\_mount\_point("/cache"); if (mv && m\_v) { // volume is already mounted return 0; }
 if (!mv) { result = mount("/emmc@userdata", "/data", "ext4", MS\_NOATIME | MS\_NODEV | MS\_NODIRATIME, ""); if (result < 0) { LOGE("failed to mount /data (%s)\n", strerror(errno)); return -1; } } if (!m\_v) { result = mount("/emmc@cache", "/cache", "ext4", MS\_NOATIME | MS\_NODEV | MS\_NODIRATIME, ""); if (result < 0) { LOGE("failed to mount /cache (%s)\n", strerror(errno)); return -1; } } if (result == 0)  return 0;}#endif
int ensure\_root\_path\_unmounted(const char \*root\_path){ /\* See if this root is already mounted. \*/ int ret = scan\_mounted\_volumes();  if (ret < 0)  { return ret; }
 const MountedVolume \*volume; volume = find\_mounted\_volume\_by\_mount\_point(root\_path);
 if (volume == NULL)  { /\* It's not mounted. \*/ LOGD(LOG\_TAG "The path %s is unmounted\n", root\_path); return 0; }
 return unmount\_mounted\_volume(volume);}
int format\_root\_device(const char \*root){ /\* Don't try to format a mounted device. \*/ int ret = ensure\_root\_path\_unmounted(root);  if (ret < 0) { LOGD(LOG\_TAG "format\_root\_device: can't unmount \"%s\"\n", root); return -1; }
 if (!strcmp(root, "/data")) { int result = make\_ext4fs("/emmc@usrdata", 0); if (result != 0) {  LOGE("format\_volume: make\_extf4fs failed on /emmc@usrdata\n"); return -1; } } else if (!strcmp(root, "/cache")) {  int result = make\_ext4fs("/emmc@cache", 0); if (result != 0) {  LOGE("format\_volume: make\_extf4fs failed on /emmc@cache\n"); return -1; }
 }
 return 0;}
int clear\_emmc\_entry(){ int result = 0; LOGD("before clear emmc ...\n"); result = format\_root\_device(DATA\_PARTITION);  sync(); LOGD("after clear DATA %s, %d...\n", DATA\_PARTITION, result); result = format\_root\_device(CACHE\_PARTITION);
 LOGD("after clear CACHE %s, %d...\n", DATA\_PARTITION, result);  sync(); return result;}
int clear\_emmc\_nomedia\_entry(char \*path){ int result = 0; DIR\* d; struct dirent\* de; d = opendir(path); if (d == NULL) { LOGE("error opening %s: %s\n", path, strerror(errno)); } int alloc\_len = 10; char \*files = malloc(alloc\_len + 30);  while ((de = readdir(d)) != NULL) { int name\_len = strlen(de->d\_name);  if (de->d\_type == DT\_DIR) { // skip "." and ".." entries if (name\_len == 1 && de->d\_name[0] == '.') continue; if (name\_len == 2 && de->d\_name[0] == '.' && de->d\_name[1] == '.') continue; if (name\_len == 5 && strcmp(de->d\_name, "media") == 0) continue; } if (name\_len >= alloc\_len) { files = realloc(files, (name\_len + 30) \* sizeof(char)); } strcpy(files, "/system/bin/rm -r /data/"); strcat(files, de->d\_name);  LOGD("the file is %s\n", de->d\_name); if (system(files)) { LOGE("cant rm file %s,error %s\n", de->d\_name, strerror(errno)); return -1; }  }
 closedir(d);  result = format\_root\_device(CACHE\_PARTITION);  LOGD("after clear CACHE %s, %d...\n", CACHE\_PARTITION, result);  sync(); return 0;
}#ifdef MTK\_SHARED\_SDCARDint format\_internal\_sd\_partition(){ int result = 0; result = system("/system/bin/rm -r /data/media");  if (result) { LOGE("can NOT rm /data/media\n"); return result; } sync(); return result;}
#else
int format\_internal\_sd\_partition(){ pid\_t pid; if ((pid = fork()) < 0)  { LOGE("eMMC: fork fails: %d (%s)\n", errno, strerror(errno)); return (-2); }  else if (pid == 0) /\*child process\*/ { int err; err = execl("/system/bin/newfs\_msdos", "newfs\_msdos", "/emmc@fat", NULL); exit(-3) ; }  else /\*parent process\*/ { int child\_stat ; waitpid(pid, &child\_stat, 0) ; sync(); if (WIFEXITED(child\_stat) && (WEXITSTATUS(child\_stat) == 0)) { LOGD("eMMC: pid = %d\n", pid); } else { LOGE("eMMC: execl error: %s\n", strerror(errno)); return -1; } } return 0;
}#endif
int clear\_emmc\_internal\_sd(){ int result = 0; LOGD("before clear internal sd ...\n"); result = format\_internal\_sd\_partition();  LOGD("after clear internal sd, %d...\n", result);  sync(); return result;}
/\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*//FUNCTION:// META\_FM\_OP//DESCRIPTION:// META FM test main process function.////PARAMETERS:// req: FM Req struct// peer\_buff: peer buffer pointer// peer\_len: peer buffer length//RETURN VALUE:// void// \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/void META\_CLR\_EMMC\_OP(FT\_EMMC\_REQ \*req) { LOGD("req->op:%d\n", req->op);  int ret = 0; FT\_EMMC\_CNF emmc\_cnf; memcpy(&emmc\_cnf, req, sizeof(FT\_H) + sizeof(FT\_EMMC\_OP)); emmc\_cnf.header.id ++;  switch (req->op) { case FT\_EMMC\_OP\_CLEAR: ret = clear\_emmc\_entry(); LOGD("clr emmc clear ret is %d\n", ret); emmc\_cnf.m\_status = META\_SUCCESS; if (!ret) {  emmc\_cnf.result.clear\_cnf.status = 1; } else { emmc\_cnf.result.clear\_cnf.status = 0; } WriteDataToPC(&emmc\_cnf, sizeof(FT\_EMMC\_CNF), NULL, 0); reboot(RB\_AUTOBOOT);  break;
 case FT\_EMMC\_OP\_FORMAT\_TCARD: ret = clear\_emmc\_internal\_sd(); LOGD("clr emmc clear internal sd ret is %d\n", ret); emmc\_cnf.m\_status = META\_SUCCESS; if (!ret) {  emmc\_cnf.result.form\_tcard\_cnf.status = 1; } else { emmc\_cnf.result.form\_tcard\_cnf.status = 0; } WriteDataToPC(&emmc\_cnf, sizeof(FT\_EMMC\_CNF), NULL, 0); break;
 case FT\_EMMC\_OP\_CLEAR\_WITHOUT\_TCARD: ret = clear\_emmc\_nomedia\_entry("/data");
 LOGD("clear emmc no mediaret is %d\n", ret); emmc\_cnf.m\_status = META\_SUCCESS; if (!ret) {  emmc\_cnf.result.clear\_without\_tcard\_cnf.status = 1; } else { emmc\_cnf.result.clear\_without\_tcard\_cnf.status = 0; } WriteDataToPC(&emmc\_cnf, sizeof(FT\_EMMC\_CNF), NULL, 0); reboot(RB\_AUTOBOOT);   LOGD("success to call 143 op 3\n"); break; default: emmc\_cnf.m\_status = META\_SUCCESS; emmc\_cnf.result.clear\_cnf.status = META\_STATUS\_FAILED; WriteDataToPC(&emmc\_cnf, sizeof(FT\_EMMC\_CNF), NULL, 0); break; } }

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


