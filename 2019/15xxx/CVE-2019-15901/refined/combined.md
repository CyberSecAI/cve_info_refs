=== Content from github.com_a9d7f61f_20250120_231836.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fcompare%2F6.1p1...6.2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fcompare%2F6.1p1...6.2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcompare%2Fshow&source=header-repo&source_repo=slicer69%2Fdoas)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[slicer69](/slicer69)
/
**[doas](/slicer69/doas)**
Public

* [Notifications](/login?return_to=%2Fslicer69%2Fdoas) You must be signed in to change notification settings
* [Fork
  54](/login?return_to=%2Fslicer69%2Fdoas)
* [Star
   773](/login?return_to=%2Fslicer69%2Fdoas)

* [Code](/slicer69/doas)
* [Issues
  3](/slicer69/doas/issues)
* [Pull requests
  0](/slicer69/doas/pulls)
* [Actions](/slicer69/doas/actions)
* [Projects
  0](/slicer69/doas/projects)
* [Security](/slicer69/doas/security)
* [Insights](/slicer69/doas/pulse)

Additional navigation options

* [Code](/slicer69/doas)
* [Issues](/slicer69/doas/issues)
* [Pull requests](/slicer69/doas/pulls)
* [Actions](/slicer69/doas/actions)
* [Projects](/slicer69/doas/projects)
* [Security](/slicer69/doas/security)
* [Insights](/slicer69/doas/pulse)

[Permalink](https://github.com/slicer69/doas/compare/slicer69%3A6886689...slicer69%3A1c2858c)
# Comparing changes

 Choose two branches to see what’s changed or to start a new pull request.
If you need to, you can also  compare across forks
 or
[learn more about diff comparisons](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

# Open a pull request

 Create a new pull request by comparing changes across two branches. If you need to, you can also  compare across forks
.
[Learn more about diff comparisons here](https://docs.github.com/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-comparing-branches-in-pull-requests#three-dot-and-two-dot-git-diff-comparisons).

*base repository:*
slicer69/doas

Failed to load repositories. Confirm that selected base ref is valid, then try again.

 Loading

*base:*
6.1p1

Choose a base ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/slicer69/doas/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...6.2)

Could not load tags

Nothing to show

[{{ refName }}
default](/slicer69/doas/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...6.2)

 Loading

...

*head repository:*
slicer69/doas

Failed to load repositories. Confirm that selected head ref is valid, then try again.

 Loading

*compare:*
6.2

Choose a head ref

Branches
Tags

Could not load branches

Nothing to show

 Loading

[{{ refName }}
default](/slicer69/doas/compare/6.1p1...%7B%7B%20urlEncodedRefName%20%7D%7D)

Could not load tags

Nothing to show

[{{ refName }}
default](/slicer69/doas/compare/6.1p1...%7B%7B%20urlEncodedRefName%20%7D%7D)

 Loading

* 4

  commits
* 3

  files changed
* 3

  contributors

### Commits on Sep 3, 2019

1. [fix the setusercontext(3) workaround](/slicer69/doas/commit/6cf0236184ff6304bf5e267ccf7ef02874069697)
    …

   ```
   Seeing this being used on even more system like Illumos with this ugly
   and security critical bug open makes me cringe every time I check if it
   was finally fixed.

   I reported it directly to the maintainer in 2017. I reported it to
   pkgsrc-security@netbsd.org without a response.
   ```

   Duncan Overbruck
   committed
   Sep 3, 2019

   Configuration menu

   * [View commit details](/slicer69/doas/commit/6cf0236184ff6304bf5e267ccf7ef02874069697)
   * Copy full SHA for 6cf0236
   * [Browse repository at this point](/slicer69/doas/tree/6cf0236184ff6304bf5e267ccf7ef02874069697)

   Copy the full SHA

    [6cf0236](/slicer69/doas/commit/6cf0236184ff6304bf5e267ccf7ef02874069697)View commit details

   Browse the repository at this point in the history
2. [Merge pull request](/slicer69/doas/commit/79c6c61a7320947fd4015d5f87e6de6e01e5f76b) [#23](https://github.com/slicer69/doas/pull/23) [from Duncaen/setusercontext](/slicer69/doas/commit/79c6c61a7320947fd4015d5f87e6de6e01e5f76b)
    …

   ```
   fix the setusercontext(3) workaround
   ```

   [![@slicer69](https://avatars.githubusercontent.com/u/7461921?s=40&v=4)](/slicer69)

   [slicer69](/slicer69/doas/commits?author=slicer69 "View all commits by slicer69")
   authored
   Sep 3, 2019

   Configuration menu

   * [View commit details](/slicer69/doas/commit/79c6c61a7320947fd4015d5f87e6de6e01e5f76b)
   * Copy full SHA for 79c6c61
   * [Browse repository at this point](/slicer69/doas/tree/79c6c61a7320947fd4015d5f87e6de6e01e5f76b)

   Copy the full SHA

    [79c6c61](/slicer69/doas/commit/79c6c61a7320947fd4015d5f87e6de6e01e5f76b)View commit details

   Browse the repository at this point in the history
3. [Added optimization to Makefile (can be set/overruled using OPT).](/slicer69/doas/commit/2f83222829448e5bc4c9391d607ec265a1e06531)
    …

   ```
   Added flag to display all warnings during compiling.
   Added status checks when parsing user/group IDs for Linux.
   Make sure Linux drops original user's groups when running as another user.
   ```

   Jesse Smith
   committed
   Sep 3, 2019

   Configuration menu

   * [View commit details](/slicer69/doas/commit/2f83222829448e5bc4c9391d607ec265a1e06531)
   * Copy full SHA for 2f83222
   * [Browse repository at this point](/slicer69/doas/tree/2f83222829448e5bc4c9391d607ec265a1e06531)

   Copy the full SHA

    [2f83222](/slicer69/doas/commit/2f83222829448e5bc4c9391d607ec265a1e06531)View commit details

   Browse the repository at this point in the history
4. [Removed unused login\_style variable on Linux. Is only](/slicer69/doas/commit/1c2858c681935a040cd2313e599b05a5dd40be95)
    …

   ```
   used when using BSD authorization.
   ```

   Jesse Smith
   committed
   Sep 3, 2019

   Configuration menu

   * [View commit details](/slicer69/doas/commit/1c2858c681935a040cd2313e599b05a5dd40be95)
   * Copy full SHA for 1c2858c
   * [Browse repository at this point](/slicer69/doas/tree/1c2858c681935a040cd2313e599b05a5dd40be95)

   Copy the full SHA

    [1c2858c](/slicer69/doas/commit/1c2858c681935a040cd2313e599b05a5dd40be95)View commit details

   Browse the repository at this point in the history

 Loading

### This comparison is taking too long to generate.

Unfortunately it looks like we can’t render this comparison for you right now. It might be too big, or there might be something weird with your repository.

You can try running this command locally to see the comparison on your machine:

`git diff 6.1p1...6.2`

  Retry

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3406243a_20250120_231835.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fcommit%2F6cf0236184ff6304bf5e267ccf7ef02874069697)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fcommit%2F6cf0236184ff6304bf5e267ccf7ef02874069697)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=slicer69%2Fdoas)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[slicer69](/slicer69)
/
**[doas](/slicer69/doas)**
Public

* [Notifications](/login?return_to=%2Fslicer69%2Fdoas) You must be signed in to change notification settings
* [Fork
  54](/login?return_to=%2Fslicer69%2Fdoas)
* [Star
   773](/login?return_to=%2Fslicer69%2Fdoas)

* [Code](/slicer69/doas)
* [Issues
  3](/slicer69/doas/issues)
* [Pull requests
  0](/slicer69/doas/pulls)
* [Actions](/slicer69/doas/actions)
* [Projects
  0](/slicer69/doas/projects)
* [Security](/slicer69/doas/security)
* [Insights](/slicer69/doas/pulse)

Additional navigation options

* [Code](/slicer69/doas)
* [Issues](/slicer69/doas/issues)
* [Pull requests](/slicer69/doas/pulls)
* [Actions](/slicer69/doas/actions)
* [Projects](/slicer69/doas/projects)
* [Security](/slicer69/doas/security)
* [Insights](/slicer69/doas/pulse)

## Commit

[Permalink](/slicer69/doas/commit/6cf0236184ff6304bf5e267ccf7ef02874069697)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix the setusercontext(3) workaround

[Browse files](/slicer69/doas/tree/6cf0236184ff6304bf5e267ccf7ef02874069697)
Browse the repository at this point in the history

```
Seeing this being used on even more system like Illumos with this ugly
and security critical bug open makes me cringe every time I check if it
was finally fixed.

I reported it directly to the maintainer in 2017. I reported it to
pkgsrc-security@netbsd.org without a response.
```

* Loading branch information

Duncan Overbruck
committed
Sep 3, 2019

1 parent
[6886689](/slicer69/doas/commit/6886689b6bee217a74fc1cc4e01e341fee015a06)

commit 6cf0236

Showing
**1 changed file**
with
**17 additions**
and
**8 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

25 changes: 17 additions & 8 deletions

25
[doas.c](#diff-7ea37791fb833311c42839877b8451c57a5b1d966c3909ccf60db95f286e7ea3 "doas.c")

Show comments

[View file](/slicer69/doas/blob/6cf0236184ff6304bf5e267ccf7ef02874069697/doas.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -542,6 +542,23 @@ main(int argc, char \*\*argv) |
|  |  | LOGIN\_SETPRIORITY | LOGIN\_SETRESOURCES | LOGIN\_SETUMASK | |
|  |  | LOGIN\_SETUSER) != 0) |
|  |  | errx(1, "failed to set user context for target"); |
|  |  | #else |
|  |  | #if defined(\_\_linux\_\_) || defined(\_\_FreeBSD\_\_) || defined(\_\_NetBSD\_\_) |
|  |  | if (setresgid(target\_pw->pw\_gid, target\_pw->pw\_gid, target\_pw->pw\_gid) == -1) |
|  |  | err(1, "setresgid"); |
|  |  | #else |
|  |  | if (setregid(target\_pw->pw\_gid, target\_pw->pw\_gid) == -1) |
|  |  | err(1, "setregid"); |
|  |  | #endif |
|  |  | if (initgroups(target\_pw->pw\_name, target\_pw->pw\_gid) == -1) |
|  |  | err(1, "initgroups"); |
|  |  | #if defined(\_\_linux\_\_) || defined(\_\_FreeBSD\_\_) || defined(\_\_NetBSD\_\_) |
|  |  | if (setresuid(target, target, target) == -1) |
|  |  | err(1, "setresuid"); |
|  |  | #else |
|  |  | if (setreuid(target, target) == -1) |
|  |  | err(1, "setreuid"); |
|  |  | #endif |
|  |  | #endif |
|  |  | /\* |
|  |  | if (pledge("stdio rpath exec", NULL) == -1) |
| Expand All | | @@ -557,14 +574,6 @@ main(int argc, char \*\*argv) |
|  |  | if (pledge("stdio exec", NULL) == -1) |
|  |  | err(1, "pledge"); |
|  |  | \*/ |
|  |  | #ifndef HAVE\_LOGIN\_CAP\_H |
|  |  | /\* If we effectively are root, set the UID to actually be root to avoid |
|  |  | permission errors. \*/ |
|  |  | if (target != 0) |
|  |  | setuid(target); |
|  |  | if ( geteuid() == ROOT\_UID ) |
|  |  | setuid(ROOT\_UID); |
|  |  | #endif |
|  |  |  |
|  |  | syslog(LOG\_AUTHPRIV | LOG\_INFO, "%s ran command %s as %s from %s", |
|  |  | myname, cmdline, target\_pw->pw\_name, cwd); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6cf0236`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fcommit%2F6cf0236184ff6304bf5e267ccf7ef02874069697) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b214e62d_20250120_231837.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fpull%2F23)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fpull%2F23)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=slicer69%2Fdoas)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[slicer69](/slicer69)
/
**[doas](/slicer69/doas)**
Public

* [Notifications](/login?return_to=%2Fslicer69%2Fdoas) You must be signed in to change notification settings
* [Fork
  54](/login?return_to=%2Fslicer69%2Fdoas)
* [Star
   773](/login?return_to=%2Fslicer69%2Fdoas)

* [Code](/slicer69/doas)
* [Issues
  3](/slicer69/doas/issues)
* [Pull requests
  0](/slicer69/doas/pulls)
* [Actions](/slicer69/doas/actions)
* [Projects
  0](/slicer69/doas/projects)
* [Security](/slicer69/doas/security)
* [Insights](/slicer69/doas/pulse)

Additional navigation options

* [Code](/slicer69/doas)
* [Issues](/slicer69/doas/issues)
* [Pull requests](/slicer69/doas/pulls)
* [Actions](/slicer69/doas/actions)
* [Projects](/slicer69/doas/projects)
* [Security](/slicer69/doas/security)
* [Insights](/slicer69/doas/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fslicer69%2Fdoas%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fslicer69%2Fdoas%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# fix the setusercontext(3) workaround #23

 Merged

[slicer69](/slicer69)
merged 1 commit into
[slicer69:master](/slicer69/doas/tree/master "slicer69/doas:master")
from
Duncaen:setusercontext

Sep 3, 2019

 Merged

# [fix the setusercontext(3) workaround](#top) #23

[slicer69](/slicer69)
merged 1 commit into
[slicer69:master](/slicer69/doas/tree/master "slicer69/doas:master")
from
Duncaen:setusercontext

Sep 3, 2019

[Conversation
3](/slicer69/doas/pull/23)
[Commits
1](/slicer69/doas/pull/23/commits)
[Checks
0](/slicer69/doas/pull/23/checks)
[Files changed](/slicer69/doas/pull/23/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![Duncaen](https://avatars.githubusercontent.com/u/2813151?s=60&v=4)](/Duncaen)

Copy link

Contributor

### @Duncaen **[Duncaen](/Duncaen)** commented [Sep 2, 2019](#issue-488332503)

Seeing this being used on even more system like Illumos with this ugly

and security critical bug open makes me cringe every time I check if it

was finally fixed.

I reported it directly to the maintainer in 2017. I reported it to

pkgsrc-security@netbsd.org without a response.

Sorry, something went wrong.

All reactions

`[fix the setusercontext(3) workaround](/slicer69/doas/pull/23/commits/6cf0236184ff6304bf5e267ccf7ef02874069697 "fix the setusercontext(3) workaround

Seeing this being used on even more system like Illumos with this ugly
and security critical bug open makes me cringe every time I check if it
was finally fixed.

I reported it directly to the maintainer in 2017. I reported it to
pkgsrc-security@netbsd.org without a response.")`
 …

`[6cf0236](/slicer69/doas/pull/23/commits/6cf0236184ff6304bf5e267ccf7ef02874069697)`

```
Seeing this being used on even more system like Illumos with this ugly
and security critical bug open makes me cringe every time I check if it
was finally fixed.

I reported it directly to the maintainer in 2017. I reported it to
pkgsrc-security@netbsd.org without a response.
```

[![@Duncaen](https://avatars.githubusercontent.com/u/2813151?s=40&u=620b48a4064158bc5e28912b20d1c16087eb3484&v=4)](/Duncaen)
[Duncaen](/Duncaen)
changed the title
~~fix the stupid setusercontext(3) workaround~~
fix the setusercontext(3) workaround
[Sep 3, 2019](#event-2601972680)

[![@slicer69](https://avatars.githubusercontent.com/u/7461921?s=80&u=a92f15cb32371a710841afd635c59c1186e1bc30&v=4)](/slicer69)

Copy link

Owner

### **[slicer69](/slicer69)** commented [Sep 3, 2019](#issuecomment-527270999)

| Thanks for submitting the patch. Would you care to explain what it is you are trying to fix and why you feel it is a security issue? How is this an improvement over existing behaviour? |
| --- |

All reactions

Sorry, something went wrong.

[![@Duncaen](https://avatars.githubusercontent.com/u/2813151?s=80&u=620b48a4064158bc5e28912b20d1c16087eb3484&v=4)](/Duncaen)

Copy link

Contributor

Author

### **[Duncaen](/Duncaen)** commented [Sep 3, 2019](#issuecomment-527274633) • edited Loading

| doas uses [setusercontext(3)](http://man.openbsd.org/setusercontext.3) with the `LOGIN_SETUSER` flag which does `setresuid(3)` and the `LOGIN_SETGROUP` flag which does `initgroups(3)` and `setresgid(2)`. The codepath that is used when `HAVE_LOGIN_CAP_H` is not set, only does `setuid(2)` which only sets the uid, the `LOGIN_SETGROUP` path is completely left out.  This means your doas port does not drop the groups of the executing user.   1. This is a big problem if you use doas to run a command with less privileges, which is very security critical, this is not the intended behavior as it is on openbsd, this drastically changes what doas actually does in those cases. (Last time I used a crontab entry to switch from root to a different user as example for such a use case.) 2. If you run a script or program which creates files or directory user and group editable, it will use the executing users group id, which could lead to unintended user writable files. 3. When you have a umask set that would make it group writable, its not as expected root:root, its root:user.   The whole point I make is that this is wrong. Both openbsd doas and sudo change the group ids and making this port differ from this behavior without documenting and warning users is very very bad. |
| --- |

All reactions

Sorry, something went wrong.

[![@slicer69](https://avatars.githubusercontent.com/u/7461921?s=40&u=a92f15cb32371a710841afd635c59c1186e1bc30&v=4)](/slicer69)
[slicer69](/slicer69)
merged commit [`79c6c61`](/slicer69/doas/commit/79c6c61a7320947fd4015d5f87e6de6e01e5f76b)
into
slicer69:master

[Sep 3, 2019](https://github.com/slicer69/doas/pull/23#event-2603620864)

[![@slicer69](https://avatars.githubusercontent.com/u/7461921?s=80&u=a92f15cb32371a710841afd635c59c1186e1bc30&v=4)](/slicer69)

Copy link

Owner

### **[slicer69](/slicer69)** commented [Sep 3, 2019](#issuecomment-527467382)

| I have a point of contention with the overall view. One being that I'm not sure this qualifies as a security concern. Having the group of the calling user is arguably expected, or at least certainly useful. However, I can see why, in some cases it would also be dangerous. I'm going to commit this patch and test it. Thank you for putting it together.  On a side note, I'd like to point out that my testing shows this issue, keeping the group of the original user, appears to only affect Linux. On FreeBSD group permissions were already dropped, as they were on OpenBSD, and (I think) NetBSD. Linux was the odd one out for keeping the calling user's groups. And I think this patch is worthwhile to bring Linux into the fold so it is no longer an exception. |
| --- |

All reactions

Sorry, something went wrong.

Repository owner
deleted a comment from
[Duncaen](/Duncaen)
[Sep 3, 2019](#event-2603818158)

Repository owner
deleted a comment from
[Duncaen](/Duncaen)
[Sep 3, 2019](#event-2603818689)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fslicer69%2Fdoas%2Fpull%2F23)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@Duncaen](https://avatars.githubusercontent.com/u/2813151?s=52&v=4)](/Duncaen) [![@slicer69](https://avatars.githubusercontent.com/u/7461921?s=52&v=4)](/slicer69)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


