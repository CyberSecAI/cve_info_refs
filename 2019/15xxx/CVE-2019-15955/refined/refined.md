```
[+] Author/Discoverer: Riccardo Krauter @CertimeterGroup
[+] Title: Totaljs CMS Insecure Admin Session cookie
[+] Affected software: Totaljs CMS 12.0
[+] Description:
A low privilege user can easily crack the owned cookie to obtain the “random” values inside it. If this user can leak a session cookie owned by another admin, then it’s possible to brute force it with O(n)=2n instead of O(n)=n^x complexity and steal the admin password. In such way he break the admin password.

[+] Step to reproduce:
In the file schemas/settings.js we have that the value for the session cookie is equivalent as:
```
var key = (user.login + ':' + user.password + ':' + F.config.secret +
string\_hash(user.login + ':' + user.password).hash()).md5();
```
where
Os = require(“os”);
```
F.config.secret = (Os.hostname()'-' + Os.platform() + '-' + Os.arch() +
'-' + Os.release() + '-' + Os.tmpdir());
```
and string_hash() is a custom function.
All of this Os variables are easily guessable or brute-forceable.

An attacker can enumerate the machine server with nmap scan to evaluate the architecture behind (linux, windows...) in this way he escape the randomness for Os.platform() parameter.
The Os.arch() parameter can be ‘x32’ or ‘x64’, then not so much random in it.
The Os.release() can be easily listed because are common and public (e.g. 4.15.0-45-generic), also it will be influenced from the recon of the Os.platform() in such way if the attacker enumerated a linux machine he can use a list of all linux version.
The Os.tmpdir() param is totally guessable. For example in linux systems is /tmp by default.
The Os.hostname() is probably the more random parameter here but a dictionary based attack can be efficacious to retrieve it.

[+] POC Script:
The provided script demonstrates how to brute-force the session cookie. It attempts to recover the hostname, and subsequently, the password.

[+] Root cause of vulnerability:
The session cookie is generated using easily guessable and brute-forceable system information (hostname, OS platform, architecture, OS release, temp directory). This allows an attacker to determine the secret used in cookie generation.

[+] Weaknesses/vulnerabilities present:
- Insecure session cookie generation.
- Reliance on easily predictable system information for secret generation.
- Custom hashing function.
- Use of MD5 hash

[+] Impact of exploitation:
- An attacker can crack the session cookie of a low-privilege user.
- If the attacker obtains an admin's session cookie, they can brute-force it to obtain the admin's password.
- Full system access.

[+] Attack vectors:
- Network reconnaissance to determine OS platform and architecture.
- Dictionary-based attacks to guess the hostname.
- Brute-force attacks on the session cookie to recover password.

[+] Required attacker capabilities/position:
- Low privilege access to the system.
- Ability to intercept or obtain a valid session cookie.
- Ability to run custom scripts.
```