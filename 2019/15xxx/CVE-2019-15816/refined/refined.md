```text
## Analysis of CVE-2019-15816

Based on the provided content, here's an analysis of CVE-2019-15816:

**Vulnerability:** Unauthenticated options change

**Affected Plugin:** WordPress WP Private Content Plus plugin (version 1.31 and below)

**Root Cause:** The plugin registers the `save_settings_page` function to the `init` hook without proper capability checks or security nonces. This allows unauthenticated users to access and modify plugin settings. The code checks if a “save\_ . `$_POST['wppcp_tab']`” function exists and calls it, relying solely on `is_admin()` which doesn't validate administrator status. Several "save\_\*" functions lack capability checks.

**Attack Vectors:**

*   **Unauthenticated Option Change:** The primary attack vector is sending a POST request with a `wppcp_tab` parameter to trigger the execution of various `save_*` functions.

**Impact of Exploitation:**

*   **Information Disclosure:** Gaining access to protected content by modifying settings.
*   **Redirection:** Redirecting visitors to external websites by modifying security settings to enable redirection (via the "Location:" header).
*   **Denial of Service (DoS):** Setting `$_POST['wppcp_tab']` to "settings\_page" causes the `save_settings_page` function to call itself recursively, leading to memory exhaustion and a crash.
*   **Stored XSS:** Injecting malicious JavaScript code into the blog's front-end and back-end by exploiting the "Password Settings" option, specifically the `$protected_form_header`, `$protected_form_message`, `$password_form_title`, and `$protected_form_message` variables, which are echoed without sanitization.

**Required Attacker Capabilities:**

*   The attacker needs to be able to send POST requests to the WordPress site. No authentication is required.

**Vulnerable Code Snippets:**

*   `add_action('init', array($this,'save_settings_page') );` (Registers the vulnerable function)
*   The `save_settings_page` function itself, particularly the section that calls `method_exists` and then executes the function:

    ```php
    if(method_exists($this,$func))
        $this->$func();
    ```

*   The lack of sanitization in "templates/global-password-form.php":

    ```php
    <div class="wppcp_panel_title"><?php echo $protected_form_header; ?></div>
    <div class="wppcp_panel_message"><?php echo $protected_form_message; ?></div>
    ```

*   The lack of sanitization in "admin/templates/password-global-settings.php":

    ```php
    <input type='text' name="wppcp_password_global[password_form_title]" id="wppcp_password_form_title"  value="<?php echo $password_form_title; ?>" />
    <textarea style='width:100%;min-height:100px;' name="wppcp_password_global[password_form_message]" id="wppcp_password_form_message"  ><?php echo $password_form_message; ?></textarea>
    ```

**Mitigation:**

*   Update to a version greater than 1.31.
*   Using a web application firewall like NinjaFirewall can provide protection.
```