## CVE-2019-15913

This entry provides a detailed analysis and proof-of-concept for CVE-2019-15913, an insecure key transport vulnerability affecting Xiaomi smart home devices using ZigBee communication.

**Vulnerability Description:**

*   **Affected Devices:** Xiaomi DGNWG03LM, ZNCZ03LM, MCCGQ01LM, WSDCGQ01LM, RTCGQ01LM.
*   **Root Cause:** Insecure key transport in ZigBee communication. The devices use the default trust center link key to encrypt the transmission of the network key. This default key has been publicly disclosed, allowing attackers to decrypt the network key.
*   **Weakness:** The vulnerability lies in the usage of a default, publicly known trust center link key for encrypting the network key during ZigBee communication.
*   **Attack Vector:** Attackers can sniff ZigBee communication, either passively or actively, to intercept the network key.
    *   **Passive Sniffing:** Sniffing messages during device pairing and using the default trust center link key to decrypt the key transport message, obtaining the network key.
    *   **Active Sniffing:** Triggering a trust center rejoin procedure (e.g., for ZNCZ03LM), intercepting the rejoin network information, and decrypting the message with the default trust center link key to obtain the network key.
*   **Attacker Capabilities:**
    *   Requires a laptop with tools like Ubuntu, Atmel RZ Raven USB sticks, KillerBee, Zigdiggity, and Wireshark.
    *   Needs to be within the ZigBee network range to sniff communication.
*   **Impact:**
    *   **Sensitive Information Disclosure:** Attackers can gain access to the ZigBee network key, allowing them to understand all ZigBee communication within the network.
    *   **Message Tampering:** Attackers can craft fake messages by modifying the frame counter and adding security level information, then encrypting them.
    *   **Device Takeover:** With the network key, attackers can potentially control smart home devices.
    *   **Denial of Service (DoS):**
        *   Attackers can send fake encrypted packets with a frame counter value close to the maximum, causing the coordinator to become unresponsive to legitimate packets from end devices.
        *   Attackers can send a fake encrypted "leave network" packet, preventing the user's smart device from receiving updated messages from the affected end device.