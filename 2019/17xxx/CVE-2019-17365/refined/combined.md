=== Content from www.openwall.com_fbbae406_20250121_004659.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2019/10/09/7) [[next>]](../../../2019/10/13/1) [[<thread-prev]](../../../2019/10/09/6) [[thread-next>]](../../../2019/10/17/3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <f7d528a3-5cd3-6f8c-9492-61b2a9851d91@orlitzky.com>
Date: Thu, 10 Oct 2019 19:01:25 -0400
From: Michael Orlitzky <michael@...itzky.com>
To: oss-security@...ts.openwall.com
Subject: Re: CVE-2019-17365: Nix per-user profile directory
 hijack

> Hello Michael and oss-security,
>
> As soon as we are comfortable with a fix, we will release a new
> version of Nix.
>
> We will also examine how we handle security issues, and publish a
> post-mortem of how this happened and how our processes will be changed
> to prevent this from happening again.

I don't think you handled it unusually badly (shit happens), but the
desire to improve is admirable nonetheless.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_34626e48_20250121_004659.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](../../../2019/10/22/1) [[<thread-prev]](../../../2019/10/10/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <87d0evjd41.fsf@gnu.org>
Date: Thu, 17 Oct 2019 23:06:38 +0200
From: Ludovic Courtès <ludo@....org>
To: oss-security@...ts.openwall.com
Cc: Michael Orlitzky <michael@...itzky.com>
Subject: CVE-2019-18192: Insecure permissions on Guix profile directory

Hello,

GNU Guix is a transactional package manager and associated GNU/Linux
distribution.

Similar to what Michael Orlitzky reported for Nix (CVE-2019-17365),
the profile directory in GNU Guix would be world-writable, allowing a
malicious user to populate the profile of a user that has never logged
in on the machine.

This issue has been assigned CVE-2019-18192 and affects all versions of
Guix up to 1.0.1 included.  The fix is similar to that written for Nix
by Eelco Dolstra (the build daemon of Guix derives from that of Nix).
It can be deployed via ‘guix pull’ as specified in the announcement below.

Announcement:
<https://guix.gnu.org/blog/2019/insecure-permissions-on-profile-directory-cve-2019-18192/>

Issue:
<https://issues.guix.gnu.org/issue/37744>

Commit:
<https://git.savannah.gnu.org/cgit/guix.git/commit/?id=81c580c8664bfeeb767e2c47ea343004e88223c7>

Ludo’.

Download attachment "[signature.asc](3/1)" of type "application/pgp-signature" (833 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_9d3957a2_20250121_004658.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](3) [[next>]](5) [[thread-next>]](6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <e758e2d9-3c1f-c006-4ad2-f0f38ec7e669@orlitzky.com>
Date: Wed, 9 Oct 2019 10:14:30 -0400
From: Michael Orlitzky <michael@...itzky.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2019-17365: Nix per-user profile directory hijack

Product: Nix
Versions affected: 2.3 and earlier
Author: Michael Orlitzky
Bug report: Reported privately to the NixOS security team on 2019-08-19.

== Summary ==

Out of the box, Nix creates an empty, world-writable, per-user profile
directory. After Nix is installed but before a victim has (re)logged in,
the victim's personal profile directory can be hijacked by an attacker
on on the system who has no other special privileges. Thenceforth, the
attacker controls that profile directory and can take over the target
account.

== Details ==

Nix is a package manager that can install software both globally (for
the system) and locally (for each user). One critical aspect of the
per-user support is that each user has a unique local "Nix profile"
directory. After installing Nix, the intent is that the next time a
user logs in, her per-user profile directory is created automatically
and some tweaks are made to allow her to use Nix right away.

The automatic profile-directory creation involves two key things.
First, the Nix installation script (scripts/install-multi-user.sh)
modifies /etc/bashrc, /etc/zshrc, and /etc/profile.d/nix.sh to include
the upstream file scripts/nix-profile-daemon.sh.in every time a user
logs in. That script, in turn, is supposed to create the user's Nix
profile directory if it does not exist:

  # Set up the per-user profile.
  mkdir -m 0755 -p $NIX_USER_PROFILE_DIR
  if ! test -O "$NIX_USER_PROFILE_DIR"; then
    echo "WARNING: bad ownership on $NIX_USER_PROFILE_DIR" >&2
  fi

If the directory does not exist, then when the user creates it, he
will own it and everything is fine.

However the second key aspect of this process is that, for the user to
be able to create $NIX_USER_PROFILE_DIR, he must be able to write to
its parent directory. That parent directory is shared by all users on
the system, and as a result, is world-writable (so that everyone can
create his own subdirectory thereof). This is enforced by the
installation script scripts/install-multi-user.sh...

  _sudo "to make the basic directory structure of Nix (part 2)" \
    mkdir -pv -m 1777 /nix/var/nix/{gcroots,profiles}/per-user

by the RPM spec file nix.spec.in...

  # make per-user directories
  for d in profiles gcroots;
  do
    mkdir -p $RPM_BUILD_ROOT/nix/var/nix/$d/per-user
    chmod 1777 $RPM_BUILD_ROOT/nix/var/nix/$d/per-user
  done

and even in one place by the Nix "LocalStore" class in
src/libstore/local-store.cc,

  Path perUserDir = profilesDir + "/per-user";
  createDirs(perUserDir);
  if (chmod(perUserDir.c_str(), 01777) == -1) ...

The sticky bit here is better than nothing, but is ultimately
insufficient. The problem with this approach is that after Nix is
installed, _any_ user on the system can create and thereafter own
_any_ local profile directory. I can't overwrite an existing one, but
I can create your profile directory before you have ever logged in.
Since the global hacks above load code from your Nix profile
directory, this lets me run code when you log in.

To make the situation a bit worse, the very last thing that gets
executed by scripts/nix-profile-daemon.sh.in when you log in is,

  export PATH="$HOME/.nix-profile/bin:...:$PATH"

where $HOME/.nix-profile is a symlink to your Nix local profile directory,

  if test "$USER" != root; then
    ln -s $NIX_USER_PROFILE_DIR/profile $HOME/.nix-profile
  else

Since I can write to your local profile directory, and since that
location is prepended to your path, I can override all of your system
executables with my own copies. Putting everything together, this
allows any user on the system to escalate his privileges to that of
any other non-root user. The root user is probably safe since he does
not use a local profile directory; however, on many systems, "root" is
not the only super-user account.

== Exploitation ==

The following example takes over the "toor" account using an
unprivileged "user" account.

  1. Install Nix as root.

  2. As "user", create the directory that "toor" would like to use for
     his per-user profile:

       user $ cd /nix/var/nix/profiles/per-user
       user $ mkdir toor

     At this point, "user" owns toor's profile directory; the end is
     nigh.

  3. To make matters worse, the unprivileged "user" can inject programs
     into toor's PATH:

       user $ mkdir -p toor/profile/bin
       user $ cp /path/to/exploit toor/profile/bin/cd
       user $ cp /path/to/exploit toor/profile/bin/cp
       user $ cp /path/to/exploit toor/profile/bin/ls
       user $ cp /path/to/exploit toor/profile/bin/exit
       user $ ...

  4. Log in as toor; a warning is issued:

       Nix: WARNING: bad ownership on /nix/var/nix/profiles/per-
       user/toor, should be toor
       toor $

     This is better than nothing, but it's too late.

  5. Anything "toor" does (cd, cp, ls, exit,...) gives the unprivileged
     user control of his account.

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


