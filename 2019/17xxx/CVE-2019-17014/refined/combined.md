=== Content from bugzilla.mozilla.org_49bde01b_20250121_023255.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1586176)
* [XML](/show_bug.cgi?ctype=xml&id=1586176)

Closed
[Bug 1586176](/show_bug.cgi?id=1586176)
(CVE-2019-11745)

Opened 5 years ago
Closed 5 years ago

# Out-of-bounds write when passing an output buffer smaller than the block size to NSC\_EncryptUpdate

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Out-of-bounds write when passing an output buffer smaller than the block size to NSC\_EncryptUpdate

## Categories

### (NSS :: Libraries, defect, P1)

[Product:](/describecomponents.cgi?product=NSS)

NSS
▾

NSS
Network Security Services - a cross-platform
security library ([more info](http://www.mozilla.org/projects/security/pki/nss/))
[See Open Bugs in This Product](/buglist.cgi?product=NSS&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=NSS)
Watch This Product

[Component:](/describecomponents.cgi?product=NSS&component=Libraries#Libraries)

Libraries
▾

NSS :: Libraries
Libraries for client support of SSL v2 and v3, TLS, PKCS #5,
PKCS #7, PKCS #11, PKCS #12, S/MIME, X.509 v3 certificates,
and other security standards
[See Open Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=NSS&component=Libraries&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=NSS&component=Libraries)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (firefox-esr60 wontfix, firefox-esr6871+ fixed, firefox67 wontfix, firefox68 wontfix, firefox69 wontfix, firefox70- wontfix, firefox71+ fixed, firefox72+ fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

3.48

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix) |
| firefox-esr68 | [71+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=71%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed) |
| firefox67 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix) |
| firefox68 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix) |
| firefox69 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix) |
| firefox70 | [-](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix) |
| firefox71 | [+](/buglist.cgi?f1=cf_tracking_firefox71&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=fixed) |
| firefox72 | [+](/buglist.cgi?f1=cf_tracking_firefox72&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr60 |  | wontfix |
| firefox-esr68 | 71+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox67 |  | wontfix |
| firefox68 |  | wontfix |
| firefox69 |  | wontfix |
| firefox70 | - | wontfix |
| firefox71 | + | fixed |
| firefox72 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: cdisselk, Assigned: franziskus)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e88a0cf1ef97addf85e6d83bb76b33d1?d=mm&size=40)  [franziskus](/user_profile?user_id=397236)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/078db09f952a32d7a60ed0a6d149c40d?d=mm&size=40)  [jcj](/user_profile?user_id=520206)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1a368bfdd3377044104dcfc6a56f212d?d=mm&size=40)  [cdisselk](/user_profile?user_id=648471)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/38f561698d679a724938d4600c0f8b52?d=mm&size=40)  [beurdouche](/user_profile?user_id=622637)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1588558](/show_bug.cgi?id=1588558 "RESOLVED FIXED - Upgrade Firefox ESR 68 to use NSS 3.44.3"), [1588559](/show_bug.cgi?id=1588559 "RESOLVED FIXED - Upgrade Firefox 71 to use NSS 3.47.1")

Dependency [tree](/showdependencytree.cgi?id=1586176&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1586176)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-bounds, reporter-external, sec-high, Whiteboard: [adv-main71+][adv-esr68.3+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2019-11745

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main71+][adv-esr68.3+]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a4535767_1689 "5 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [jcj](/user_profile?user_id=520206) | [in-testsuite](#a324805_520206 "5 years ago") | ? |
| --- | --- | --- |
| [jcj](/user_profile?user_id=520206) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 4 obsolete files)

| [0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch](/attachment.cgi?id=9098741)  [5 years ago](#c1)  [Craig Disselkoen](/user_profile?user_id=648471)   1005 bytes, patch | franziskus : [review+](#c10 "5 years ago") | [Details](/attachment.cgi?id=9098741&action=edit) | [Diff](/attachment.cgi?id=9098741&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9098741) |
| --- | --- | --- |
| [0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch](/attachment.cgi?id=9099058)  [5 years ago](#c5)  [Deian Stefan](/user_profile?user_id=637163)   1.67 KB, patch | franziskus : [review+](#c9 "5 years ago") | [Details](/attachment.cgi?id=9099058&action=edit) | [Diff](/attachment.cgi?id=9099058&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9099058) |
| [0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch](/attachment.cgi?id=9100044)  [5 years ago](#c12)  [Deian Stefan](/user_profile?user_id=637163)   1.00 KB, patch | lizzard : [approval-mozilla-beta-](#c22 "5 years ago")  lizzard : [approval-mozilla-release-](#a999975_451704 "5 years ago")  RyanVM : [approval-mozilla-esr68-](#c28 "5 years ago")  tjr : [sec-approval+](#c29 "5 years ago") | [Details](/attachment.cgi?id=9100044&action=edit) | [Diff](/attachment.cgi?id=9100044&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044) |
| [0002-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test..patch](/attachment.cgi?id=9100045)  [5 years ago](#c13)  [Deian Stefan](/user_profile?user_id=637163)   1.67 KB, patch | lizzard : [approval-mozilla-release-](#a999960_451704 "5 years ago") | [Details](/attachment.cgi?id=9100045&action=edit) | [Diff](/attachment.cgi?id=9100045&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100045) |
| [advisory.txt](/attachment.cgi?id=9111828)  [5 years ago](#c33)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   313 bytes, text/plain |  | [Details](/attachment.cgi?id=9111828&action=edit) |
| [advisory.txt](/attachment.cgi?id=9111855)  [5 years ago](#c34)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   316 bytes, text/plain |  | [Details](/attachment.cgi?id=9111855&action=edit) |
| [advisory.txt](/attachment.cgi?id=9111857)  [5 years ago](#c35)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   329 bytes, text/plain |  | [Details](/attachment.cgi?id=9111857&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Craig Disselkoen](/user_profile?user_id=648471)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1586176#c0)• 5 years ago |
|  | |

In `NSC_EncryptUpdate`, suppose that the `*pulEncryptedPartLen` parameter is smaller than the block size.

We assume the following path through the function:

```
...
if (crv != CKR_OK)  // false
...
if (!pEncryptedPart) {  // false
...
if (context->doPad) {  // true
    /* deal with previous buffered data */
    if (context->padDataLength != 0) {  // true
        /* fill in the padded to a full block size */
        for (...) {
            // this loop continues until context->padDataLength == context->blockSize
            // for this to happen, it's sufficient that ulPartLen >= context->blockSize
            //   i.e., that there are at least context->blockSize bytes of input
            // or more precisely, this will happen when
            //   ulPartLen + context->padDataLength >= context->blockSize
        }
        /* not enough data to encrypt yet? then return */
        if (context->padDataLength != context->blockSize) {  // false, due to above
          ...
        }
        /* encrypt the current padded data */
        rv = (*context->update)(context->cipherInfo, pEncryptedPart,
                                &padoutlen, context->blockSize, context->padBuf,
                                context->blockSize);

```

In the call to `context->update`, the fourth parameter indicates the maximum length which can be written to the output buffer `pEncryptedPart`. This parameter is set to be `context->blockSize`, even though only `*pulEncryptedPartLen` bytes remain in the output buffer, and we were assuming that `*pulEncryptedPartLen` was less than the block size.

There are two ramifications of this: first, we can have a small out-of-bounds write here. The call to `context->update` can write up to about `context->blockSize` bytes off of the end of the output buffer.

Second, `context->update` will write to the variable `padoutlen` indicating the number of bytes written. Supposing `context->update` does write the allowed maximum of `context->blockSize` bytes to the buffer, we will have `padoutlen == context->blockSize`. Then:

```
pEncryptedPart += padoutlen;  // advancing the pEncryptedPart pointer beyond the end of the buffer
maxout -= padoutlen;

```

Since `maxout` was initialized to be `*pulEncryptedPartLen` and is thus smaller than the block size in this case, the subtraction will wrap around and give a very large positive value for `maxout` due to its unsigned type.

The subsequent use of `maxout` here:

```
/* do it: NOTE: this assumes buf size in is >= buf size out! */
rv = (*context->update)(context->cipherInfo, pEncryptedPart,
                        &outlen, maxout, pPart, ulPartLen);

```

will allow `context->update` to write up to `maxout` many bytes, that is, effectively arbitrarily many bytes to `pEncryptedPart`. This is an out-of-bounds write arbitrarily far beyond the buffer.

I think the first call to `context->update` should pass `maxout` rather than `context->blockSize` as the fourth parameter, so that the maximum output length is `maxout` rather than `context->blockSize`. I.e.,

```
        rv = (*context->update)(context->cipherInfo, pEncryptedPart,
-                               &padoutlen, context->blockSize, context->padBuf,
+                               &padoutlen, maxout, context->padBuf,
                                context->blockSize);

```

The related function `NSC_DecryptUpdate` already does this: it uses `maxout` for the maximum-output-length parameter to `context->update` every time it calls `context->update`.

Flags: sec-bounty?

|  | [Craig Disselkoen](/user_profile?user_id=648471)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1586176#c1)• 5 years ago |
|  | |

Attached patch

[0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch](attachment.cgi?id=9098741&action=diff) (obsolete)
— [Details](attachment.cgi?id=9098741&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9098741)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1586176#c2)• 5 years ago |
|  | |

Kevin, please provide the first-pass security classification.

Severity: normal → criticalStatus: UNCONFIRMED → NEWEver confirmed: trueFlags: needinfo?(kjacobs.bugzilla)Keywords: [csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---)Priority: -- → P1

|  | [Deian Stefan](/user_profile?user_id=637163) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1586176#c3)• 5 years ago |
|  | |

I wanted to write a test for this last night, but couldn't find tests that consume the APIs directly. If ya'll point me to a sane example I'm happy to take a stab at adding a test.

|  | [Kevin Jacobs [:kjacobs]](/user_profile?user_id=636914) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1586176#c4)• 5 years ago |
|  | |

I didn't get as far into this today as I was hoping. However, the sanest example I see is [pk11\_cbc\_unittest.cc](https://searchfox.org/mozilla-central/source/security/nss/gtests/pk11_gtest/pk11_cbc_unittest.cc#101), which uses CKM\_AES\_CBC\_PAD to call `NSC_EncryptUpdate` via `PK11_Encrypt`.

The trick seems to be getting `if (context->padDataLength != 0)` to be true, because on the first invocation, the context (and `padDataLength`) is fresh. From an initial pass, this doesn't seem to be possible in `PK11_Encrypt`, but there are other paths that will need to be checked. [PK11\_CipherOp](https://searchfox.org/mozilla-central/source/security/nss/lib/pk11wrap/pk11cxt.c#698) looks to be more flexible.

I'll continue looking into this next week. Thanks!

|  | [Deian Stefan](/user_profile?user_id=637163) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1586176#c5)• 5 years ago |
|  | |

Attached patch

[0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch](attachment.cgi?id=9099058&action=diff) (obsolete)
— [Details](attachment.cgi?id=9099058&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9099058)

Test case to trigger the bug

|  | [Kevin Jacobs [:kjacobs]](/user_profile?user_id=636914) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1586176#c6)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1586176&comment_id=14409968 "1 revision") |
|  | |

Thanks. I confirmed both outcomes from the report.

To exploit we need two things then: 1) multi-part encryption, and 2) the property that a call can be made with `*pulEncryptedPartLen` (`maxout`) of less than one block, via attacker-control or a programming error. Webcrypto is not affected as neither condition holds. This leaves the following notable paths (among others that are more trivially unexploitable).

1. [ssl3\_MACEncryptRecord](https://searchfox.org/mozilla-central/source/security/nss/lib/ssl/ssl3con.c#2186): If `p1Len` is less than 256, it is moved to `oddLen` and encrypted with `p2` (where `maxout` will be at least "MAC bytes" long). This should be safe.
2. [SRTP](https://searchfox.org/mozilla-central/source/netwerk/srtp/src/crypto/cipher/aes_icm_nss.c#308) calls this function for both encrypt and decrypt, but uses in-place operations (where outLen == inLen), so the arbitrary overwrite is not possible (`*pulEncryptedPartLen < BLOCK_SIZE && *pulEncryptedPartLen == ulPartLen`). This still leaves the potential for an *up-to-blocksize* overrun.

I'm only seeing a Firefox exploit path through #2, but I'd label this sec-high as: 1) #2 suggests this is remotely exploitable since it's called to decrypt, and 2) the bug lies in a general-purpose function with many callers. If one fails to protect (or session is inappropriately reused), we could well be vulnerable to the arbitrary overwrite case.

Let me know if my analysis missed anything.

Flags: needinfo?(kjacobs.bugzilla)

|  | [Kevin Jacobs [:kjacobs]](/user_profile?user_id=636914) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a309435_636914)• 5 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Craig Disselkoen](/user_profile?user_id=648471)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1586176#c7)• 5 years ago |
|  | |

If y'all are interested, this bug was found with Pitchfork, a symbolic execution tool we're working on to detect constant-time violations. In this case, Pitchfork found inputs that triggered the arbitrary write and then used that power to trivially violate constant-time (e.g. by overwriting some pointer to point to a secret key - I don't remember the precise details at this moment). I believe Deian has already mentioned the tool to some of you.

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1586176#c8)• 5 years ago |
|  | |

Franziskus, can you take a first pass at this patch?

Assignee: nobody → franziskuskiefer

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a324780_520206)• 5 years ago |

[Attachment #9098741](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: review?(franziskuskiefer)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a324794_520206)• 5 years ago |

[Attachment #9099058](/attachment.cgi?id=9099058&action=edit "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") -
Flags: review?(franziskuskiefer)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a324805_520206)• 5 years ago |

Flags: in-testsuite?

|  | [Franziskus Kiefer [:franziskus]](/user_profile?user_id=397236)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1586176#c9)• 5 years ago |
|  | |

Comment on [attachment 9099058](/attachment.cgi?id=9099058 "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") [[details]](/attachment.cgi?id=9099058&action=edit "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") [[diff]](/attachment.cgi?id=9099058&action=diff "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9099058)
0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch
Review of [attachment 9099058](/attachment.cgi?id=9099058 "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") [[details]](/attachment.cgi?id=9099058&action=edit "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") [[diff]](/attachment.cgi?id=9099058&action=diff "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9099058):
-----------------------------------------------------------------
::: gtests/pk11\_gtest/pk11\_cbc\_unittest.cc
@@ +205,5 @@
> EXPECT\_EQ(0, memcmp(kInput, decrypted, input\_len));
> }
>
> +TEST\_P(Pkcs11CbcPadTest, ContextEncryptTwoBadParts) {
> + uint8\_t encrypted[block\_size() - 2]; // Output is less than block size
This won't compile on Windows. Maybe just do 14?
[Attachment #9099058](/attachment.cgi?id=9099058&action=edit "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") -
Flags: review?(franziskuskiefer) → review+

|  | [Franziskus Kiefer [:franziskus]](/user_profile?user_id=397236)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1586176#c10)• 5 years ago |
|  | |

Comment on [attachment 9098741](/attachment.cgi?id=9098741 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9098741&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9098741)
0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch
Review of [attachment 9098741](/attachment.cgi?id=9098741 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9098741&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9098741):
-----------------------------------------------------------------
Looks like the right fix to me, thanks!
[Attachment #9098741](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: review?(franziskuskiefer) → review+

|  | [Kevin Jacobs [:kjacobs]](/user_profile?user_id=636914) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1586176#c11)• 5 years ago |
|  | |

Comment on [attachment 9098741](/attachment.cgi?id=9098741 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9098741&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9098741)

0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Moderate difficulty. The change highlights the problem, but an attacker has to trigger a moderately-complex set of conditions to exploit. The tests will not be landed until a later date.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: Little risk and clean application to all branches.
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely. It's a single line change and the corresponding Decrypt function already uses `maxout` as in this patch.
[Attachment #9098741](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: sec-approval?

|  | [Deian Stefan](/user_profile?user_id=637163) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1586176#c12)• 5 years ago |
|  | |

Attached patch

[0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch](attachment.cgi?id=9100044&action=diff)
— [Details](attachment.cgi?id=9100044&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044)

rebased, r=me

[Attachment #9098741](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Attachment is obsolete: true
[Attachment #9098741](/attachment.cgi?id=9098741&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: sec-approval?

|  | [Deian Stefan](/user_profile?user_id=637163) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1586176#c13)• 5 years ago |
|  | |

Attached patch

[0002-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test..patch](attachment.cgi?id=9100045&action=diff)
— [Details](attachment.cgi?id=9100045&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100045)

rebased + addressed comment, r=me

[Attachment #9099058](/attachment.cgi?id=9099058&action=edit "0001-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test.patch") -
Attachment is obsolete: true

|  | [Deian Stefan](/user_profile?user_id=637163) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1586176#c14)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1586176&comment_id=14415535 "1 revision") |
|  | |

Sorry didn't mean to remove the sec-approval request; should i re-flag and just point to :kjacobs' comment?

|  | [Kevin Jacobs [:kjacobs]](/user_profile?user_id=636914) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1586176#c15)• 5 years ago |
|  | |

Comment on [attachment 9100044](/attachment.cgi?id=9100044 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9100044&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044)

0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Moderate difficulty. The change highlights the problem, but an attacker has to trigger a moderately-complex set of conditions to exploit. The tests will not be landed until a later date.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: Ally
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: Little risk and clean application to all branches.
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely. It's a single line change and the corresponding Decrypt function already uses `maxout` as in this patch.
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1586176#c16)• 5 years ago |
|  | |

Comment on [attachment 9100044](/attachment.cgi?id=9100044 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9100044&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044)

0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch

### Beta/Release Uplift Approval Request

* **User impact if declined**: sec-high in network code sits around for another release.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Per kjacobs: "Unlikely. It's a single line change and the corresponding Decrypt function already uses maxout as in this patch."
* **String changes made/needed**:
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: approval-mozilla-beta?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1586176#c17)• 5 years ago |
|  | |

I'm requesting uplift to beta; but leaving the sec-approval flag so it stays in-queue.

This has me nervous since it's in networking code (outside the sandbox.) I don't think we should land this in Nightly without also landing it in beta. So if Beta gets approved; we'll land it in both, and if it doesn't, we'll re-evaluate.

Either way we should not land the test until the normal 4-weeks after the release train gets the fix.

[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected)
[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected)
[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected)
[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%3F)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1586176#c18)• 5 years ago |
|  | |

Comment on [attachment 9100044](/attachment.cgi?id=9100044 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9100044&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044)

0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: When we go to Beta, we'll want to catch ESR as well. If it's just up to me, I'd be OK on waiting to land this one for next cycle though (Beta 71, ESR 68.3), though patch risk is indeed low.
* **User impact if declined**: sec-high in network code sits around for ESR
* **Fix Landed on Version**: n/a
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Per kjacobs: "Unlikely. It's a single line change and the corresponding Decrypt function already uses maxout as in this patch."
* **String or UUID changes made by this patch**:
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: approval-mozilla-esr68?

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1586176#c19)• 5 years ago |
|  | |

Dan what do you think about the riskiness here? The build is tomorrow so I have to decide by Sunday night.

I'm inclined to go for it, since folks seem to agree the patch risk is low even though last minute changes in network code always feel a bit scary.

Flags: needinfo?(dveditz)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1586176#c20)• 5 years ago |
|  | |

After more discussion with Tom I'm going to go ahead and uplift, but a bit later today after the merge.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1586176#c21)• 5 years ago |
|  | |

After even more discussion: This would need an NSS release as well so we may hold off till either a point release in mid-70, or till 71.

[status-firefox69](/buglist.cgi?f1=cf_status_firefox69&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox69&o1=equals&v1=wontfix)
[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B)Flags: needinfo?(dveditz)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1586176#c22)• 5 years ago |
|  | |

Comment on [attachment 9100044](/attachment.cgi?id=9100044 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9100044&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044)

0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch

### Beta/Release Uplift Approval Request

* **User impact if declined**:
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**:
* **String changes made/needed**:
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: approval-mozilla-release?
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: approval-mozilla-beta?
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: approval-mozilla-beta-

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a902373_451704)• 5 years ago |

[Attachment #9100045](/attachment.cgi?id=9100045&action=edit "0002-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test..patch") -
Flags: approval-mozilla-release?

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1586176#c23)• 5 years ago |
|  | |

Tom, can you allocate a CVE for this?

Flags: needinfo?(tom)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a902862_520206)• 5 years ago |

Blocks: [1588558](/show_bug.cgi?id=1588558 "RESOLVED FIXED - Upgrade Firefox ESR 68 to use NSS 3.44.3")

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a902879_520206)• 5 years ago |

Blocks: [1588559](/show_bug.cgi?id=1588559 "RESOLVED FIXED - Upgrade Firefox 71 to use NSS 3.47.1")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1586176#c24)• 5 years ago |
|  | |

Keep in mind that if we point release Fx70, we'll need to do the same for 68.2esr. Is there a particularly-urgent reason this can't ship in Fx71/68.3esr in early December?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a903385_75935)• 5 years ago |

[status-firefox67](/buglist.cgi?f1=cf_status_firefox67&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox67&o1=equals&v1=wontfix)
[status-firefox68](/buglist.cgi?f1=cf_status_firefox68&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox68&o1=equals&v1=wontfix)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=wontfix)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)
[tracking-firefox71](/buglist.cgi?f1=cf_tracking_firefox71&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox71&o1=equals&v1=%2B)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=%3F)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1586176#c25)• 5 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #24](/show_bug.cgi?id=1586176#c24 "RESOLVED FIXED - Out-of-bounds write when passing an output buffer smaller than the block size to NSC_EncryptUpdate"))

> Keep in mind that if we point release Fx70, we'll need to do the same for 68.2esr. Is there a particularly-urgent reason this can't ship in Fx71/68.3esr in early December?

I filed a bug for ESR, too ([bug 1588558](/show_bug.cgi?id=1588558 "RESOLVED FIXED - Upgrade Firefox ESR 68 to use NSS 3.44.3")), but while this issue is severe, I don't see any reason to consider it critical -- or critical enough for a point release on its own.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a915781_578488)• 5 years ago |

Alias: CVE-2019-11745Flags: needinfo?(tom)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1586176#c26)• 5 years ago |
|  | |

OK, calling it wontfix for 70.

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a999960_451704)• 5 years ago |

[Attachment #9100045](/attachment.cgi?id=9100045&action=edit "0002-Bug-1586176-Edge-case-multi-part-EncryptUpdate-test..patch") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a999975_451704)• 5 years ago |

[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a1117847_1689)• 5 years ago |

[tracking-firefox70](/buglist.cgi?f1=cf_tracking_firefox70&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox70&o1=equals&v1=-)
[tracking-firefox-esr68](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=%3F) → [71+](/buglist.cgi?f1=cf_tracking_firefox_esr68&o1=equals&v1=71%2B)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1586176#c27)• 5 years ago |
|  | |

Daiki, a heads-up for you on this one. We're deferring it for up to a cycle here and it might have wider impacts for you and your customers than Firefox.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1586176#c28)• 5 years ago |
|  | |

Comment on [attachment 9100044](/attachment.cgi?id=9100044 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9100044&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044)
0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch
Uplift approval for this patch will run through the various dependent "Update NSS" bugs on file rather than through this bug directly.
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: approval-mozilla-esr68? → approval-mozilla-esr68-

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1586176#c29)• 5 years ago |
|  | |

Comment on [attachment 9100044](/attachment.cgi?id=9100044 "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[details]](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[diff]](/attachment.cgi?id=9100044&action=diff "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1586176&attachment=9100044)
0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch
Plan is NSS 3.46.2 for a potential 70 dot release, 3.47.1 for 71 beta, and 3.44.3 for 68 ESR. If we get a dot release, we'd probably want to land this sooner rather than later so we know it's stable for that. But otherwise I'd be inclined to land it later.... But cutting NSS releases is tricky and we don't want to do it before releng is ready to take it. So I think the conclusion is: JC, you can land this when you think is best and it fits the NSS schedule.
[Attachment #9100044](/attachment.cgi?id=9100044&action=edit "0001-Bug-1586176-EncryptUpdate-should-use-maxout-not-bloc.patch") -
Flags: sec-approval? → sec-approval+

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1586176#c30)• 5 years ago |
|  | |

<https://hg.mozilla.org/projects/nss/rev/1e22a0c93afe9f46545560c86caedef9dab6cfda>

Status: NEW → RESOLVEDClosed: 5 years agoResolution: --- → FIXEDTarget Milestone: --- → 3.48

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a4022007_75935)• 5 years ago |

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fixed)
[tracking-firefox72](/buglist.cgi?f1=cf_tracking_firefox72&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox72&o1=equals&v1=%2B)

|  | [J.C. Jones [:jcj] (he/they)](/user_profile?user_id=520206) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1586176#c31)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/4b6cb17b74d9>

[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1586176#c32)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr68/rev/ea1bc0fb2dda>

[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a4182996_75935)• 5 years ago |

Group: crypto-core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a4535767_1689)• 5 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a4625839_578488)• 5 years ago |

Whiteboard: [adv-main71+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1586176#c33)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9111828) (obsolete)
— [Details](attachment.cgi?id=9111828&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a4656548_578488)• 5 years ago |

Whiteboard: [adv-main71+] → [adv-main71+][adv-esr68.3+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1586176#c34)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9111855) (obsolete)
— [Details](attachment.cgi?id=9111855&action=edit)

[Attachment #9111828](/attachment.cgi?id=9111828&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1586176#c35)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9111857)
— [Details](attachment.cgi?id=9111857&action=edit)

[Attachment #9111855](/attachment.cgi?id=9111855&action=edit "advisory.txt") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a21173261_1689)• 5 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1586176#a146919777_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1586176&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Craig Disselkoen](/user_profile?user_id=648471)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_79aae8af_20250121_002548.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1322864)
* [XML](/show_bug.cgi?ctype=xml&id=1322864)

Closed
[Bug 1322864](/show_bug.cgi?id=1322864)

Opened 8 years ago
Closed 5 years ago

# SOP bypass using drag and drop of image.

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

SOP bypass using drag and drop of image.

## Categories

### (Core :: DOM: Copy & Paste and Drag & Drop, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop#DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop)

DOM: Copy & Paste and Drag & Drop
▾

Core :: DOM: Copy & Paste and Drag & Drop
All issues with copy-and-paste and drag-and-drop can be reported here, be it with the web API or the platform backends. This includes clipboard issues.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

52 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla72

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr68 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed) |
| firefox70 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix) |
| firefox71 | --- | [verified](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=verified) |
| firefox72 | --- | [verified](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr68 |  | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox70 |  | wontfix |
| firefox71 |  | verified |
| firefox72 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: qab, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=40)  [qab](/user_profile?user_id=550582)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-moderate, Whiteboard: [post-critsmash-triage][adv-main71+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main71+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a24343928_1689 "8 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [PoC-SOPB.html](/attachment.cgi?id=8817834)  [8 years ago](#c0)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   1.23 KB, text/html |  | [Details](/attachment.cgi?id=8817834&action=edit) |
| --- | --- | --- |
| [poc.html](/attachment.cgi?id=8819529)  [8 years ago](#c13)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   266 bytes, text/html |  | [Details](/attachment.cgi?id=8819529&action=edit) |
| [thing.html](/attachment.cgi?id=9104483)  [5 years ago](#c31)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   1.26 KB, text/html |  | [Details](/attachment.cgi?id=9104483&action=edit) |
| [tester.mp4](/attachment.cgi?id=9104622)  [5 years ago](#c33)  [Abdulrahman Alqabandi](/user_profile?user_id=550582)   4.81 MB, video/mp4 |  | [Details](/attachment.cgi?id=9104622&action=edit) |
| [Bug 1322864, r?NeilDeakin](/attachment.cgi?id=9104890)  [5 years ago](#c36)  [:Gijs (he/him)](/user_profile?user_id=159069)   47 bytes, text/x-phabricator-request | pascalc : [approval-mozilla-beta+](#c42 "5 years ago")  RyanVM : [approval-mozilla-esr68+](#c47 "5 years ago") | [Details](/attachment.cgi?id=9104890&action=edit) | [Review](/attachment.cgi?id=9104890) |
| [advisory.txt](/attachment.cgi?id=9111722)  [5 years ago](#c49)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   313 bytes, text/plain |  | [Details](/attachment.cgi?id=9111722&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1322864#c0)• 8 years ago |
|  | |

Attached file
[PoC-SOPB.html](attachment.cgi?id=8817834)
— [Details](attachment.cgi?id=8817834&action=edit)

User Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.99 Safari/537.36
Steps to reproduce:
When closing opened popups whilst dragging an image from that popups the dragged object contains a File object once dropped on cross origin document.
1. Open attached PoC
2. Press button to open window
3. Attempt to drag the box as instructed
4. After popup closes, drop the 'image' anywhere on the document
We end up with full contents of a cross origin website.
Actual results:
A file object is created for some reason with the contents of a cross origin image, despite the image being invalid.
Expected results:
Same as when we don't close the window, no File object should be created unless the image loads, even then we should block it if the image is cross origin.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1322864#c1)• 8 years ago |
|  | |

Works on latest nightly, not latest stable.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1322864#c2)• 8 years ago |
|  | |

Ran moz regression. Build '2015-04-10' is first bad (where PoC works) occurrence, couldn't dig deeper, mozreggresion kept crashing.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1322864#c3)• 8 years ago |
|  | |

Does not work on nightly if multi-process is disabled.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1322864#c4)• 8 years ago |
|  | |

Also, it's possible to view arbitrary files on local disk if you open PoC within file URI scheme and change the image on the popup to the random file on disk.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a64190_550582)• 8 years ago |

Summary: SOP bypass using drag and drop of invalid image. → SOP bypass using drag and drop of image.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1322864#c5)• 8 years ago |
|  | |

Given that this is e10s-specific, I suspect this is basically the same problem as [bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop").Depends on: [1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop")

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1322864#c6)• 8 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #5](/show_bug.cgi?id=1322864#c5 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> Given that this is e10s-specific, I suspect this is basically the same
> problem as [bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop").
To be specific, I think this is the same bug as [Comment 18](/show_bug.cgi?id=1322864#c18 "VERIFIED FIXED - SOP bypass using drag and drop of image.") in [Bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop"). I don't see a connection with the initial address bar spoof since it uses anchor tags. We can still open arbitrary file:// urls if we use the PoC here. We just set the image within popups src to be 'file:///C://' and then instead of dropping the image into document we try to open new tab, we bypass restrictions.
I think there is atleast something to be said about the behavior of dragging objects from closed windows. Chrome for example removes any dragged objects once a popup closes.

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a414055_452604)• 8 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1322864#c7)• 8 years ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

(In reply to Abdulrahman Alqabandi[test] from [comment #6](/show_bug.cgi?id=1322864#c6 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> (In reply to :Gijs Kruitbosch from [comment #5](/show_bug.cgi?id=1322864#c5 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> > Given that this is e10s-specific, I suspect this is basically the same
> > problem as [bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop").
>
> To be specific, I think this is the same bug as [Comment 18](/show_bug.cgi?id=1322864#c18 "VERIFIED FIXED - SOP bypass using drag and drop of image.") in [Bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop"). I
> don't see a connection with the initial address bar spoof since it uses
> anchor tags. We can still open arbitrary file:// urls if we use the PoC
> here. We just set the image within popups src to be 'file:///C://' and then
> instead of dropping the image into document we try to open new tab, we
> bypass restrictions.
>
> I think there is atleast something to be said about the behavior of dragging
> objects from closed windows. Chrome for example removes any dragged objects
> once a popup closes.
I don't see why the window being closed matters in this specific case. I believe that the thing that's going wrong here is origin checks for the source of the drag. I pretty much told you this verbatim in [bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop"). Your non-local webpage shouldn't be able to link to file:///. This check is used in more places than just the URL bar, so I believe addressing that check in [bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop") will also fix this bug.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1322864#c8)• 8 years ago |
|  | |

Actually, looking at this again, maybe I'm wrong and something else fishy is going on here. Also, this crashes on beta on OS X...
<https://crash-stats.mozilla.com/report/index/84b678a9-820e-4065-9cb5-4aa322161215>Group: firefox-core-security → core-securityComponent: Untriaged → Drag and DropNo longer depends on: [1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop")Product: Firefox → Core

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a511927_1689)• 8 years ago |

Group: core-security → dom-core-security

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1322864#c9)• 8 years ago |
|  | |

I would like to just clarify [Comment 6](/show_bug.cgi?id=1322864#c6 "VERIFIED FIXED - SOP bypass using drag and drop of image."), even with multi-process off we can still open file:// uri schemes by drag and dropping an image from a closed popup into a new tab.
Also, shouldn't this be sec-high given the ability to read cross-origin websites (with credentials)? Or will the main SOP bypass here be dealt with in [Bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop") and this report will deal with drag and drop from closed windows?

|  | [Neil Deakin](/user_profile?user_id=6102) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1322864#c10)• 8 years ago |
|  | |

Isn't the real bug here that we should be validating that the content is really an image? Dragging an image from one origin to another isn't a security issue.
That the source has closed doesn't seem particularly concerning either.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1322864#c11)• 8 years ago |
|  | |

(In reply to Neil Deakin from [comment #10](/show_bug.cgi?id=1322864#c10 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> Isn't the real bug here that we should be validating that the content is
> really an image? Dragging an image from one origin to another isn't a
> security issue.
>
> That the source has closed doesn't seem particularly concerning either.
Potentially, yes. Hector, are we 'just' missing similar checks to the ones you added in [bug 1318736](/show_bug.cgi?id=1318736 "VERIFIED FIXED - Tricking user into creating an executable when copy pasting an image into folder") here?Flags: needinfo?(bzhao)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1322864#c12)• 8 years ago |
|  | |

(In reply to Abdulrahman Alqabandi[test] from [comment #9](/show_bug.cgi?id=1322864#c9 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> I would like to just clarify [Comment 6](/show_bug.cgi?id=1322864#c6 "VERIFIED FIXED - SOP bypass using drag and drop of image."), even with multi-process off we can
> still open file:// uri schemes by drag and dropping an image from a closed
> popup into a new tab.
Can you reconcile this with [comment #3](/show_bug.cgi?id=1322864#c3 "VERIFIED FIXED - SOP bypass using drag and drop of image.") ? What are the exact steps that produce something problematic with e10s off, and/or can you upload a new testcase for this problem?Flags: needinfo?(qab)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1322864#c13)• 8 years ago |
|  | |

Attached file
[poc.html](attachment.cgi?id=8819529)
— [Details](attachment.cgi?id=8819529&action=edit)

(In reply to Neil Deakin from [comment #10](/show_bug.cgi?id=1322864#c10 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> Isn't the real bug here that we should be validating that the content is
> really an image? Dragging an image from one origin to another isn't a
> security issue.
>
> That the source has closed doesn't seem particularly concerning either.
The security issue is that we can read full content of external documents with full credentials which can only be achieved if we drag n drop an image from a closed popup.
(In reply to :Gijs Kruitbosch from [comment #12](/show_bug.cgi?id=1322864#c12 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> Can you reconcile this with [comment #3](/show_bug.cgi?id=1322864#c3 "VERIFIED FIXED - SOP bypass using drag and drop of image.") ?
[Comment #3](/show_bug.cgi?id=1322864#c3 "VERIFIED FIXED - SOP bypass using drag and drop of image.") is in reference to the behavior here, ability to read external documents using drag and drop of an image that points to an external website.
Initially you thought this may be related to [Bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop") which is a bug where alongside spoofing, you could also open file:// URI schemes by drag and dropping anchor tags to a new tab, but its e10s specific, as in if multi-process is turned off it wont work.
In [comment #5](/show_bug.cgi?id=1322864#c5 "VERIFIED FIXED - SOP bypass using drag and drop of image.") I tried to prove that this main bug (SOP bypass) is not related to [Bug 1317023](/show_bug.cgi?id=1317023 "RESOLVED FIXED - e10s - Address bar spoof using privileged URI schemes in drag n drop") (the e10s specific spoof/open file uri scheme), but I failed at mentioning something which I clarified in [comment #9](/show_bug.cgi?id=1322864#c9 "VERIFIED FIXED - SOP bypass using drag and drop of image."). I was trying to say that we can still open file:// URLS (not read them) even if e10s was off, again, to prove that its not related to the e10s specific bug where we can open file: urls only with e10s enabled.
> What are the exact steps that
> produce something problematic with e10s off, and/or can you upload a new
> testcase for this problem?
I attached the testcase that will result in opening file:///C:// (by opening I mean navigate to the URL and not read it) with multi-process off.
1. Open attached PoC, click button
2. Once popup appears, attempt to drag and drop the image into a new tab on your main window
3. 'file:' url opened with multi-process off.Flags: needinfo?(qab)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1322864#c14)• 8 years ago |
|  | |

Here are the different DnD objects (with e10s and without) note that this has to do with this bug (reading external documents) which does not work with e10s off, might shed some light at the issue.
I am basically grabbing a dropped object and trying to grab all the content types within it as well as checking if a file object exists.
---------------With e10s OFF---------------------------------------------------------------------
text/x-moz-url>>><https://www.mozilla.org/en-US/test>
<https://www.mozilla.org/en-US/test>
text/x-moz-url-data>>><https://www.mozilla.org/en-US/test>
text/x-moz-url-desc>>><https://www.mozilla.org/en-US/test>
text/uri-list>>><https://www.mozilla.org/en-US/test>
text/\_moz\_htmlcontext>>><html><body></body></html>
text/\_moz\_htmlinfo>>>0,0
text/html>>><img id="q" src="<https://www.mozilla.org/en-US/test>" style="border:1px solid red;width:100px;height:100px;">
text/plain>>><https://www.mozilla.org/en-US/test>
application/x-moz-file-promise-url>>><https://www.mozilla.org/en-US/test>
application/x-moz-file-promise-dest-filename>>>test.htm
-----------------
fileLen:0
---------------With e10s ON---------------------------------------------------------------------
text/uri-list>>><https://www.mozilla.org/en-US/test>
application/x-moz-file>>>
Files>>>
-----------------
fileLen:1 <-- this is the object where the contents of '<https://www.mozilla.org/en-US/test>' reside.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1322864#c15)• 8 years ago |
|  | |

One last thought, I think there is a feature that handles drag and dropping things from cross-applications, specifically from the Firefox browser to things like Word documents or anything else.
I noticed that there is a big difference between dragged objects dropping from and to the same Firefox window and from Firefox to say Google Chrome, this bug here essentially (I assume) tricks Firefox into thinking the dropped object came from an external source.
<https://www.mozilla.org/en-US/security/advisories/mfsa2016-81/> According to the description of that bug (cant access the actual report yet) there is in fact something happening during cross-application DnD's

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1322864#c16)• 8 years ago |
|  | |

Hrmm, I just realized its possible to read valid images from cross-origin (in the form of a file object) with multi-process disabled... Can't read webpages though
So it seems there is still an SOP bypass with or without e10s.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1322864#c17)• 8 years ago |
|  | |

(In reply to Abdulrahman Alqabandi[test] from [comment #16](/show_bug.cgi?id=1322864#c16 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> Hrmm, I just realized its possible to read valid images from cross-origin
> (in the form of a file object) with multi-process disabled... Can't read
> webpages though
>
> So it seems there is still an SOP bypass with or without e10s.
I would expect that to work with Chrome, Edge and other browsers as well. As Neil said in [comment #10](/show_bug.cgi?id=1322864#c10 "VERIFIED FIXED - SOP bypass using drag and drop of image."), dragging an image from one origin to another isn't a security issue - as a user, I should be able to say, open an image in one tab, and drag it into a google doc in another tab, irrespective of the origin of the image.
It becomes a security issue if you can do this with non-image data and trick the user into disclosing data other than a valid image (an image which they can see, of course).

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1322864#c18)• 8 years ago |
|  | |

Ah, I was under the impression reading valid cross-origin images was an SOP violation. I believe Google gave me this impression from this bug <https://bugs.chromium.org/p/chromium/issues/detail?id=380885>

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1322864#c19)• 8 years ago |
|  | |

Also, I do agree that dragging an image from one place to another should be allowed and is not a security issue. But I think (correct me if im wrong) that usually there is a server in the middle that requests the images data without the users credentials and then serves it. Or if we are talking about 'contentEditable' elements having images in them, usually its an img tag copy pasted. I think the fact that the request to receive the image is done with credentials is whats bothersome.
Say a website serves your profile picture using a fixed file like 'profile.php' and it reads off from your cookies to see who you are. If one wants to save this picture to an external application like word then fine, but to drag and drop it within firefox and still allows us to get the full data as if we were you? I think thats problematic.
When I drag and drop an image from one tab to another (in chrome) I get the following dropped object:
-----------------
text/plain>>><http://i.imgur.com/W7FBWyM.jpg>
text/uri-list>>><http://i.imgur.com/W7FBWyM.jpg>
text/html>>><img style="-webkit-user-select: none" src="<http://i.imgur.com/W7FBWyM.jpg>">
-----------------
fileLen:0
--------------------------
Now the same using firefox:
text/x-moz-url>>><http://i.imgur.com/W7FBWyM.jpg>
<http://i.imgur.com/W7FBWyM.jpg>
text/x-moz-url-data>>><http://i.imgur.com/W7FBWyM.jpg>
text/x-moz-url-desc>>><http://i.imgur.com/W7FBWyM.jpg>
text/uri-list>>><http://i.imgur.com/W7FBWyM.jpg>
text/\_moz\_htmlcontext>>><html><body></body></html>
text/\_moz\_htmlinfo>>>0,0
text/html>>><img src="<http://i.imgur.com/W7FBWyM.jpg>" alt="<http://i.imgur.com/W7FBWyM.jpg>">
text/plain>>><http://i.imgur.com/W7FBWyM.jpg>
application/x-moz-file-promise-url>>><http://i.imgur.com/W7FBWyM.jpg>
application/x-moz-file-promise-dest-filename>>>W7FBWyM.jpg
-----------------
fileLen:0
-----------------------------------------
Notice there is never a File object. Only when we drag an image from a closed popup do we get a file object.
I understand it is normal to drag and drop an image from Firefox to a word document, but within Firefox itself it should not be allowed.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1322864#c20)• 8 years ago |
|  | |

Was looking at the crash in [comment #8](/show_bug.cgi?id=1322864#c8 "VERIFIED FIXED - SOP bypass using drag and drop of image."), looks like its a UaF? Should that be a separate bug report, or?

|  | [Hector Zhao [:hectorz]](/user_profile?user_id=424852) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1322864#c21)• 8 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #11](/show_bug.cgi?id=1322864#c11 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> (In reply to Neil Deakin from [comment #10](/show_bug.cgi?id=1322864#c10 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> > Isn't the real bug here that we should be validating that the content is
> > really an image? Dragging an image from one origin to another isn't a
> > security issue.
> >
> > That the source has closed doesn't seem particularly concerning either.
>
> Potentially, yes. Hector, are we 'just' missing similar checks to the ones
> you added in [bug 1318736](/show_bug.cgi?id=1318736 "VERIFIED FIXED - Tricking user into creating an executable when copy pasting an image into folder") here?
My guess is additional check would be helpful, but I'm not really familiar with the involved code to provide meaningful feedback here. Sorry.Flags: needinfo?(bzhao)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a4060536_280903)• 8 years ago |

Flags: sec-bounty?

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1322864#c22)• 8 years ago |
|  | |

Is there anyone who is willing to take this bug? I have no clue who is better at DnD mechanics.

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1322864#c23)• 8 years ago |
|  | |

<https://www.mozilla.org/en-US/security/advisories/mfsa2011-25/>
This bug (url above) steals images from remote websites, proving that grabbing images from cross-domain is a security issue.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1322864#c24)• 8 years ago |
|  | |

(In reply to Abdulrahman Alqabandi from [comment #23](/show_bug.cgi?id=1322864#c23 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> <https://www.mozilla.org/en-US/security/advisories/mfsa2011-25/>
>
> This bug (url above) steals images from remote websites, proving that
> grabbing images from cross-domain is a security issue.
I'm not familiar with that bug, but I would expect it to not involve user interaction. As has been explained repeatedly on this bug, it's expected that you can drag files and images into websites to allow them access to those files/images. So "grabbing images from cross-domain" is only a security issue if not explicitly done via user interaction.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1322864#c25)• 8 years ago |
|  | |

Andrew, do you know who could own this?Flags: needinfo?(continuation)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1322864#c26)• 8 years ago |
|  | |

Neil, is this something you could work on? Thanks.Flags: needinfo?(continuation) → needinfo?(enndeakin)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1322864#c27)• 8 years ago |
|  | |

(In reply to :Gijs from [comment #24](/show_bug.cgi?id=1322864#c24 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> (In reply to Abdulrahman Alqabandi from [comment #23](/show_bug.cgi?id=1322864#c23 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> > <https://www.mozilla.org/en-US/security/advisories/mfsa2011-25/>
> >
> > This bug (url above) steals images from remote websites, proving that
> > grabbing images from cross-domain is a security issue.
>
> I'm not familiar with that bug, but I would expect it to not involve user
> interaction. As has been explained repeatedly on this bug, it's expected
> that you can drag files and images into websites to allow them access to
> those files/images. So "grabbing images from cross-domain" is only a
> security issue if not explicitly done via user interaction.
Ah ok, that makes more sense now. Thank you

|  | [Neil Deakin](/user_profile?user_id=6102) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1322864#c28)• 8 years ago |
|  | |

To fix the invalid image issue one would likely need to add a check for this within nsContentUtils::GetImageFromContent. I don't know what such a check would be.
I don't think there is any other issue here.Flags: needinfo?(enndeakin)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1322864#c29)• 7 years ago |
| off-topic | |

| Comment hidden (off-topic) |  |
| --- | --- |

May I get an update on this bug, please?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1322864#c30)• 7 years ago |
| off-topic | |

| Comment hidden (off-topic) |  |
| --- | --- |

(In reply to Abdulrahman Alqabandi from [comment #29](/show_bug.cgi?id=1322864#c29 "VERIFIED FIXED - SOP bypass using drag and drop of image."))
> May I get an update on this bug, please?
There is no update. If there was, it would be here.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a24343928_1689)• 7 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1322864#c31)• 5 years ago |
|  | |

Attached file
[thing.html](attachment.cgi?id=9104483)
— [Details](attachment.cgi?id=9104483&action=edit)

Updated the original PoC since it was relying on the (now disabled) ability to programmatically navigate/open a data:text/html, url.

Modified it to work with latest FF (tested latest nightly). Replaced Data: with blob:

Hope someone can work on this soon.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1322864#c32)• 5 years ago |
|  | |

(In reply to Abdulrahman Alqabandi from [comment #31](/show_bug.cgi?id=1322864#c31 "VERIFIED FIXED - SOP bypass using drag and drop of image."))

> Created [attachment 9104483](/attachment.cgi?id=9104483 "thing.html") [[details]](/attachment.cgi?id=9104483&action=edit "thing.html")
>
> thing.html
>
> Updated the original PoC since it was relying on the (now disabled) ability to programmatically navigate/open a data:text/html, url.
>
> Modified it to work with latest FF (tested latest nightly). Replaced Data: with blob:
>
> Hope someone can work on this soon.

I can't reproduce with the new testcase on macOS, Firefox 71 beta or nightly 72a1, even after downloading and serving on localhost (to avoid potential for breakage due to bmo's CSP). The `files[0]` on the datatransfer is `undefined`. What OS did you test on? Is there somewhere specific I should be dropping the box? Is it possible closing the origin window is breaking this (maybe I'm too slow dropping the image?)

Flags: needinfo?(qab)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1322864#c33)• 5 years ago |
|  | |

Attached video
[tester.mp4](attachment.cgi?id=9104622)
— [Details](attachment.cgi?id=9104622&action=edit)

(In reply to :Gijs (he/him) from [comment #32](/show_bug.cgi?id=1322864#c32 "VERIFIED FIXED - SOP bypass using drag and drop of image."))

> I can't reproduce with the new testcase on macOS, Firefox 71 beta or nightly 72a1, even after downloading and serving on localhost (to avoid potential for breakage due to bmo's CSP). The `files[0]` on the datatransfer is `undefined`. What OS did you test on? Is there somewhere specific I should be dropping the box? Is it possible closing the origin window is breaking this (maybe I'm too slow dropping the image?)

I tested on Windows 10 home on Nightly 72.0a1 (2019-10-27) (64-bit). Attached video of it in action. Notice there is a little lag in the drag motion somewhere there, I believe its possible if you drop too soon it may not work.

But just to be sure, could you instead drag and drop the broken image (from popup) into the big 'O' located in <https://leucosite.com/dnds.html> (drop it on the top most O)

For me, I am getting an HTML file with name 'test.html' containing the content of Mozilla website. I would like to see what doing this looks on your OS. (if you dont manage to repro by adjusting steps)

Flags: needinfo?(qab) → needinfo?(gijskruitbosch+bugs)

|  | [Abdulrahman Alqabandi](/user_profile?user_id=550582)  Reporter |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1322864#c34)• 5 years ago |
|  | |

Forgot one thing

> Is there somewhere specific I should be dropping the box?

Make sure to drop it within document and outside of the textarea.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1322864#c35)• 5 years ago |
|  | |

I can repro on Windows. I get the same content on the leucosite thing, with two exceptions - one is that the `x-moz-file-promise-dest-filename` is `test.html` on Windows and just `test` on Mac. Making the target URL end in `test.html` fixes that, but doesn't make it work.

The other difference is that on mac, there's a `text/_moz_requestmime` type, which brought me to <https://searchfox.org/mozilla-central/source/dom/base/nsContentAreaDragDrop.cpp#248,256-257>, which makes me think something probably breaks there if we get a non-image response. So yay, mac is not affected, more or less by accident I guess?

Anyway, this has actually led me to some of the relevant code at <https://searchfox.org/mozilla-central/rev/74cc0f4dce444fe0757e2a6b8307d19e4d0e0212/dom/base/nsContentAreaDragDrop.cpp#680> so I will see if I can get a patch for this together.

Assignee: nobody → gijskruitbosch+bugsStatus: UNCONFIRMED → ASSIGNEDEver confirmed: trueFlags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1322864#c36)• 5 years ago |
|  | |

Attached file
[Bug 1322864, r?NeilDeakin](attachment.cgi?id=9104890)
— [Details](attachment.cgi?id=9104890&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1322864#c37)• 5 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/c955ff5ec94ad725d97c66bd01ae15214b475dc5>

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1322864#c38)• 5 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/c955ff5ec94a>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 5 years ago
[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla72

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a91131109_75935)• 5 years ago |

[status-firefox70](/buglist.cgi?f1=cf_status_firefox70&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox70&o1=equals&v1=wontfix)
[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected)
[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1322864#c39)• 5 years ago |
|  | |

I think we should uplift this but it seems sensible to wait at least a little bit to see if we've accidentally broken something people were relying on in terms of copying/dragging images. I'll request uplift for beta next week. Ni to remind myself.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a91207167_553429)• 5 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1322864#c40)• 5 years ago |
|  | |

Comment on [attachment 9104890](/attachment.cgi?id=9104890 "Bug 1322864, r?NeilDeakin") [[details]](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin")

[Bug 1322864](/show_bug.cgi?id=1322864 "VERIFIED FIXED - SOP bypass using drag and drop of image."), r?NeilDeakin

### Beta/Release Uplift Approval Request

* **User impact if declined**: security risk of dragging things that are pretending to be images but aren't
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: Yes
* **If yes, steps to reproduce**: See [comment 0](/show_bug.cgi?id=1322864#c0 "VERIFIED FIXED - SOP bypass using drag and drop of image.") with the attachment from [comment #31](/show_bug.cgi?id=1322864#c31 "VERIFIED FIXED - SOP bypass using drag and drop of image."). Drag the black square to the area to the left of the text input in the main window. We shouldn't get HTML output in the text area. AFAICT this was never reproducible on mac.
* **List of other uplifts needed**: n/a
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: I'm just moving a security check into a utility function to ensure checks we added for copy/paste also apply to drag/drop
* **String changes made/needed**: nope
Flags: needinfo?(gijskruitbosch+bugs)
[Attachment #9104890](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin") -
Flags: approval-mozilla-beta?

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a91531096_553429)• 5 years ago |

QA Whiteboard: [qa-triaged]

|  | [ovidiu boca[:Ovidiu]](/user_profile?user_id=551038) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1322864#c41)• 5 years ago |
|  | |

I verified this issue on Windows 10 x 64 with FF 72.0a1(2019-11-03) and I can't reproduce the issue from [comment 0](/show_bug.cgi?id=1322864#c0 "VERIFIED FIXED - SOP bypass using drag and drop of image.") using the attachment from [comment 31](/show_bug.cgi?id=1322864#c31 "VERIFIED FIXED - SOP bypass using drag and drop of image."). Based on this I will mark this issue as verified.

Note: I was able to reproduce the issue on FF Release 70, and I also tested the issue on Mac OS X 10.14 and Ubuntu 16.04 but I couldn't reproduce it, the only OS where this issue is repro is on Windows.

[status-firefox72](/buglist.cgi?f1=cf_status_firefox72&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox72&o1=equals&v1=verified)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1322864#c42)• 5 years ago |
|  | |

Comment on [attachment 9104890](/attachment.cgi?id=9104890 "Bug 1322864, r?NeilDeakin") [[details]](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin")

[Bug 1322864](/show_bug.cgi?id=1322864 "VERIFIED FIXED - SOP bypass using drag and drop of image."), r?NeilDeakin

Low risk, verified by QA on nightly, uplift approved for 71 beta 8, thanks.

[Attachment #9104890](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1322864#c43)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/788387ae855ea79a785632ae7506653f332a0f39>

[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=fixed)

|  | [ovidiu boca[:Ovidiu]](/user_profile?user_id=551038) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1322864#c44)• 5 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1322864&comment_id=14475775 "1 revision") |
|  | |

I verified this issue on Windows 10 x64 with FF Beta 71.0b8 and I can confirm the fix.

Status: RESOLVED → VERIFIEDQA Whiteboard: [qa-triaged]
[status-firefox71](/buglist.cgi?f1=cf_status_firefox71&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox71&o1=equals&v1=verified)Flags: qe-verify+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1322864#c45)• 5 years ago |
|  | |

Does this need an ESR68 approval request? It grafts cleanly as-landed.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1322864#c46)• 5 years ago |
|  | |

Comment on [attachment 9104890](/attachment.cgi?id=9104890 "Bug 1322864, r?NeilDeakin") [[details]](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin")

[Bug 1322864](/show_bug.cgi?id=1322864 "VERIFIED FIXED - SOP bypass using drag and drop of image."), r?NeilDeakin

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: sec-moderate, straightforward patch
* **User impact if declined**: sec-moderate security issue
* **Fix Landed on Version**: 72 uplifted to 71
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: It's a pretty small patch. Effectively, there were 2 callsites for 1 utility function, and we moved an extant security check from one of those 2 callsites into the utility function, so it now applies to both copy and drag/drop support.
* **String or UUID changes made by this patch**: nope
Flags: needinfo?(gijskruitbosch+bugs)
[Attachment #9104890](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin") -
Flags: approval-mozilla-esr68?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1322864#c47)• 5 years ago |
|  | |

Comment on [attachment 9104890](/attachment.cgi?id=9104890 "Bug 1322864, r?NeilDeakin") [[details]](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin")

[Bug 1322864](/show_bug.cgi?id=1322864 "VERIFIED FIXED - SOP bypass using drag and drop of image."), r?NeilDeakin

Moves a security check so it applies to both callers. Approved for 68.3esr.

[Attachment #9104890](/attachment.cgi?id=9104890&action=edit "Bug 1322864, r?NeilDeakin") -
Flags: approval-mozilla-esr68? → approval-mozilla-esr68+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1322864#c48)• 5 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr68/rev/30006ca3a1e1>

[status-firefox-esr68](/buglist.cgi?f1=cf_status_firefox_esr68&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr68&o1=equals&v1=fixed)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a93383295_578488)• 5 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main71+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1322864#c49)• 5 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9111722)
— [Details](attachment.cgi?id=9111722&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a109929360_1689)• 5 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1322864#a235673524_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1322864&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Abdulrahman Alqabandi](/user_profile?user_id=550582)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_cc6d1f25_20250121_002549.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-36

## Security Vulnerabilities fixed in - Firefox 71

Announced
December 3, 2019
Impact
high
Products
Firefox
Fixed in

* Firefox 71

#### [#CVE-2019-11756: Use-after-free of SFTKSession object](#CVE-2019-11756)

Reporter
J.C. Jones
Impact
high
##### Description

Improper refcounting of soft token session objects could cause a use-after-free and crash (likely limited to a denial of service).

##### References

* [Bug 1508776](https://bugzilla.mozilla.org/show_bug.cgi?id=1508776)

#### [#CVE-2019-17008: Use-after-free in worker destruction](#CVE-2019-17008)

Reporter
Looben Yang
Impact
high
##### Description

When using nested workers, a use-after-free could occur during worker destruction. This resulted in a potentially exploitable crash.

##### References

* [Bug 1546331](https://bugzilla.mozilla.org/show_bug.cgi?id=1546331)

#### [#CVE-2019-13722: Stack corruption due to incorrect number of arguments in WebRTC code](#CVE-2019-13722)

Reporter
Alexandru Michis
Impact
high
##### Description

When setting a thread name on Windows in WebRTC, an incorrect number of arguments could have been supplied, leading to stack corruption and a potentially exploitable crash.
*Note: this issue only occurs on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1580156](https://bugzilla.mozilla.org/show_bug.cgi?id=1580156)

#### [#CVE-2019-11745: Out of bounds write in NSS when encrypting with a block cipher](#CVE-2019-11745)

Reporter
Craig Disselkoen
Impact
high
##### Description

When encrypting with a block cipher, if a call to `NSC_EncryptUpdate` was made with data smaller than the block size, a small out of bounds write could occur. This could have caused heap corruption and a potentially exploitable crash.

##### References

* [Bug 1586176](https://bugzilla.mozilla.org/show_bug.cgi?id=1586176)

#### [#CVE-2019-17014: Dragging and dropping a cross-origin resource, incorrectly loaded as an image, could result in information disclosure](#CVE-2019-17014)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If an image had not loaded correctly (such as when it is not actually an image), it could be dragged and dropped cross-domain, resulting in a cross-origin information leak.

##### References

* [Bug 1322864](https://bugzilla.mozilla.org/show_bug.cgi?id=1322864)

#### [#CVE-2019-17009: Updater temporary files accessible to unprivileged processes](#CVE-2019-17009)

Reporter
Robert Strong
Impact
moderate
##### Description

When running, the updater service wrote status and log files to an unrestricted location; potentially allowing an unprivileged process to locate and exploit a vulnerability in file handling in the updater service.
*Note: This attack requires local system access and only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1510494](https://bugzilla.mozilla.org/show_bug.cgi?id=1510494)

#### [#CVE-2019-17010: Use-after-free when performing device orientation checks](#CVE-2019-17010)

Reporter
Nils
Impact
moderate
##### Description

Under certain conditions, when checking the Resist Fingerprinting preference during device orientation checks, a race condition could have caused a use-after-free and a potentially exploitable crash.

##### References

* [Bug 1581084](https://bugzilla.mozilla.org/show_bug.cgi?id=1581084)

#### [#CVE-2019-17005: Buffer overflow in plain text serializer](#CVE-2019-17005)

Reporter
Mirko Brodesser
Impact
moderate
##### Description

The plain text serializer used a fixed-size array for the number of

elements it could process; however it was possible to overflow the static-sized array leading to memory corruption and a potentially exploitable crash.

##### References

* [Bug 1584170](https://bugzilla.mozilla.org/show_bug.cgi?id=1584170)

#### [#CVE-2019-17011: Use-after-free when retrieving a document in antitracking](#CVE-2019-17011)

Reporter
Nils
Impact
moderate
##### Description

Under certain conditions, when retrieving a document from a DocShell in the antitracking code, a race condition could cause a use-after-free condition and a potentially exploitable crash.

##### References

* [Bug 1591334](https://bugzilla.mozilla.org/show_bug.cgi?id=1591334)

#### [#CVE-2019-17012: Memory safety bugs fixed in Firefox 71 and Firefox ESR 68.3](#CVE-2019-17012)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Christoph Diehl, Nathan Froyd, Jason Kratzer, Christian Holler, Karl Tomlinson, Tyson Smith reported memory safety bugs present in Firefox 70 and Firefox ESR 68.2. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 71 and Firefox ESR 68.3](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1449736%2C1533957%2C1560667%2C1567209%2C1580288%2C1585760%2C1592502)

#### [#CVE-2019-17013: Memory safety bugs fixed in Firefox 71](#CVE-2019-17013)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Philipp, Diego Calleja, Mikhail Gavrilov, Jason Kratzer, Christian Holler, Markus Stange, Tyson Smith reported memory safety bugs present in Firefox 70. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 71](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1298509%2C1472328%2C1577439%2C1577937%2C1580320%2C1584195%2C1585106%2C1586293%2C1593865%2C1594181)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


