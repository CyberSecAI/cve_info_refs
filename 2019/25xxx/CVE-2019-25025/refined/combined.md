=== Content from github.com_1e20b512_20250121_014957.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-cvw2-xj8r-mjf7)

**CVE-2019-25025**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-cvw2-xj8r-mjf7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2019-25025](/advisories/GHSA-cvw2-xj8r-mjf7)

## Activerecord-session\_store Vulnerable to Timing Attack

Moderate severity

GitHub Reviewed

Published
Mar 9, 2021
to the GitHub Advisory Database
•
Updated Sep 5, 2023

[Vulnerability details](/advisories/GHSA-cvw2-xj8r-mjf7)
[Dependabot alerts
0](/advisories/GHSA-cvw2-xj8r-mjf7/dependabot)

## Package

bundler

activerecord-session\_store
([RubyGems](/advisories?query=ecosystem%3Arubygems))

## Affected versions

<= 1.1.3

## Patched versions

2.0.0

## Description

The `activerecord-session_store` (aka Active Record Session Store) component through 1.1.3 for Ruby on Rails does not use a constant-time approach when delivering information about whether a guessed session ID is valid. Consequently, remote attackers can leverage timing discrepancies to achieve a correct guess in a relatively short amount of time. This is a related issue to [CVE-2019-16782](https://github.com/advisories/GHSA-hrqr-hxpp-chr3 "CVE-2019-16782").

## Recommendation

This has been fixed in version 2.0.0. All users are advised to update to this version or later.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2019-25025>
* [rails/activerecord-session\_store#151](https://github.com/rails/activerecord-session_store/pull/151)
* <https://rubygems.org/gems/activerecord-session_store>
* [rails/activerecord-session\_store@9d4dd11](https://github.com/rails/activerecord-session_store/commit/9d4dd113d3010b82daaadf0b0ee6b9fb2afb2160)
* <https://github.com/rails/activerecord-session_store/releases/tag/v2.0.0>
* <https://github.com/rubysec/ruby-advisory-db/blob/master/activerecord-session_store/CVE-2019-25025.yml>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2019-25025)
Mar 5, 2021

Reviewed
Mar 9, 2021

Published to the GitHub Advisory Database
Mar 9, 2021

Last updated
Sep 5, 2023

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
Low

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N

### [EPSS score](https://www.first.org/epss/user-guide)

0.120%
 (47th percentile)

### Weaknesses

[CWE-208](/advisories?query=cwe%3A208)

### CVE ID

CVE-2019-25025

### GHSA ID

GHSA-cvw2-xj8r-mjf7

### Source code

[rails/activerecord-session\_store](https://github.com/rails/activerecord-session_store)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-cvw2-xj8r-mjf7/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_d341006d_20250121_014958.html ===
�PNG

   
IHDR   (   (   ���m    pHYs  �  ��+  xIDATX�]�ُd�Y��r�Nm]K�����=3���Nbv���?!�"�'�.܀�&p�A�HD��;�Ƴ�giw�tO�[�Ug�.NuϘ�>�s��U}O=�r��9�W���G� �������&��M<�g�ޟ�@
�b�N���\_K1:J��F6?Zy���6�x����x�u��}���QJ�O'�������7 �8���g(�{/ <���V�Ԥx?bg4N�#�)���Z7S�!\_�(I|�b���Ij��!(�C�sXg�R�s!�#��"R�!�;�{Ol��2���VJ���s�pr� 3C����.>�q����O���>�������2v��R ���~)ZI��Z���D)�E�Rx���)��rA�k�����(��z@�3�$!���ZÃ�?fsc��N��Z�\���8�����x���%��oƴN(O԰�a��9FG�V�`���;�Th��c��x�qg�$cw�;��'NR��6n�a�y�,�ȕ��F �#6�'G�|��C��%�~�2ӵ\*�0��Gw�􇿃��XO`3���#��:�v�\ Щ�П�ԺSF�W�{��nӞ���j�h�秸��\*c�q��zd�pv���+��찳����������~�=�\���^�V�Q)h
�v��G7��`hCB�(K8�I-bG�:t�2�����9h�V��bç�P\*��Uo4�ϟ����-�|����眿�2��x�?�����'$c������;n�����o}���G�MO�$�N2L=�A�V�r`h��J`�Q�eGv��g�Qg������>{�T��`,G�\���/����z���W����[��`g��� �m#����Q����O �`�9���G;���^d�}�{"+F��0���A��q�J�����z}���R�q7�`m���
����k�}�mr$�������ӻ\_���C\*�=���mm�\o��8��#��H!��,�Ky�6R+p�������R�c変��TP�,�4��5$��rȷ.L����d��K��%�v�0�1�� A(����e�lmS��GH����@E+��C�6eF���4�@��E�\�z��s��׈
�>��^&К�`H|����S�/-!�dve����3=;��9�n����,U�\���� q�2�h���AM�"�  ���R0�c�G;���e����9-�Ρ��PR������o�ָ��o U R�����%A"������W��z��۔�\_������]�ZQ\*��qj�J��'I=�D"��B�.g,�uy�<�:���+��R�TPR�nvhw{D�&��S���O�N�9ra���͊بO���~�I�?�y�B)E)�J�H�!MJ�1�V/�34�if�S����q��b���f���q� '�q̃'O���3{X!����O�S���;G�:�?��<:�V.�9<����း?$����^�ăHS��DXA��B�x�N�ǌ�c-��uX�X9i����Z��p���>�\_̡W��|Bߥ<\\_#\*��X����ڟ~��R�\*���'�rB.�ͱ����T1i���45(�F5(�9����b�EA�8똪�9�>L(���acg�$�P��F;Oa�N 0����[ �]��T
c&���u��GS3S����F�w?��}�m|���:H��.�T��:�1�4I��'��s���8&���wr���8{ǇXcH��X)"S���4�NUP�J
�561�9wu�w�V5�YV���Lsuj�vqOi�tk-�0��$I���F��!�����`��Y��G���S|�l����<|��MS�V�v�ϕ��~�"���g{YE#%�R�B�^����V�0�9�&4I���I~��g�W�h�0I��ᩏ)�I>k5d4#���h8�% ��ހ�? N
�<�Q����x�\>�":'mZр;+�(��dk���nq��
l~I>�x��ͳ�C��t����,^���SU��w޸�IL�
#���XcI��4IQ/���?H��$�I��%���1i�IRa����yq���]�%(�ǘ�� �3t ��j�r}��R����]�"L�j��׮�w9hd�p}�y7�3)�{w���8�2�Q�IS"�h�gmք����P�Z��7.^���59? ]:O�?`~n�n���\*c)���n��P·��x���<����K��>�!�D�:H�թr�L�x��1I�FqFy���b�e�/�6���8?9�I
��&��7(�A�¹y����$MY}�Et�&&��L����!V8k��bL�?;c��9�Ә�4M�i��D16�fm���;녽���w�~|�����:<$\_)q������� �Cַw��ܣP��\*�y�U~z���J
�WH�i3:' � 6f�AzT��Σ�]y����C'X�,�,�����G�Jt\*
��F�O��W^f������4Ai�0����6﯐�ۋ�������.�e53/�3
�
?�g��LzA�&Nh6���:�sR2?U�\ȓ�3^/��!R
�|���&�7[�}�\*���|�f��#�x��kr��2��\��G�!?9���o���a��k�)7�3r���R���;�DưX����5�V0��鞴�&�wW�����o�Q���ӏ�[�L�M3~���F��.���w��V�,b��^?"ʕ8���|�aaf
�r8$�ˡ�'���]B�Y��x����b�{Ð�2ca�?�n����[�dnv�P J9�L���A���<�f�!�y��R��1q05����;79�r���
��O�\_�����J�E-�|H��N�̎����>�
��c I�ӂ���<��c�8F(,��\_�w�s!K�"}�s�5�b��F(h�Wi9�Z!�� 9��g>P4.�c���帗+Q7�k3
v�1B�J��f�\*P�T������Ǝ�$�I�V!���3ԇ]?�!�>Ǚ��A�,���A���u��$�A�A.@)E�ϡ���B-4�xH�$C �p�а1W�'�4U�wrº�ӒRJܰ���5�UT�F.���\FJ��ð��o�F����A��LmB�;��v�,^��r��Z�L�G���y�J��֚B�D�6���>��<�:�!s/]�ܥe�v��kU��m�<iқ��P)h=� %�L�WJ���x��{�W\_c1i��G�,�a�w9X�̠?�X�٧i�������c!�b�X)Z�>�~��T�'A�On�Ez�ZP�z�QрV��ju�|���U�8{ ���x���?$�\ ��I���l��O�[�    IEND�B`�

=== Content from github.com_6d5a6e99_20250120_234359.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frails%2Factiverecord-session_store%2Fpull%2F151)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frails%2Factiverecord-session_store%2Fpull%2F151)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=rails%2Factiverecord-session_store)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rails](/rails)
/
**[activerecord-session\_store](/rails/activerecord-session_store)**
Public

* [Notifications](/login?return_to=%2Frails%2Factiverecord-session_store) You must be signed in to change notification settings
* [Fork
  188](/login?return_to=%2Frails%2Factiverecord-session_store)
* [Star
   548](/login?return_to=%2Frails%2Factiverecord-session_store)

* [Code](/rails/activerecord-session_store)
* [Issues
  34](/rails/activerecord-session_store/issues)
* [Pull requests
  14](/rails/activerecord-session_store/pulls)
* [Actions](/rails/activerecord-session_store/actions)
* [Wiki](/rails/activerecord-session_store/wiki)
* [Security](/rails/activerecord-session_store/security)
* [Insights](/rails/activerecord-session_store/pulse)

Additional navigation options

* [Code](/rails/activerecord-session_store)
* [Issues](/rails/activerecord-session_store/issues)
* [Pull requests](/rails/activerecord-session_store/pulls)
* [Actions](/rails/activerecord-session_store/actions)
* [Wiki](/rails/activerecord-session_store/wiki)
* [Security](/rails/activerecord-session_store/security)
* [Insights](/rails/activerecord-session_store/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frails%2Factiverecord-session_store%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frails%2Factiverecord-session_store%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Address CVE-2019-16782 #151

 Merged

[sikachu](/sikachu)
merged 4 commits into
[rails:master](/rails/activerecord-session_store/tree/master "rails/activerecord-session_store:master")
from
[rails-lts:secure-session-store](/rails-lts/activerecord-session_store/tree/secure-session-store "rails-lts/activerecord-session_store:secure-session-store")

Mar 10, 2021

 Merged

# [Address CVE-2019-16782](#top) #151

[sikachu](/sikachu)
merged 4 commits into
[rails:master](/rails/activerecord-session_store/tree/master "rails/activerecord-session_store:master")
from
[rails-lts:secure-session-store](/rails-lts/activerecord-session_store/tree/secure-session-store "rails-lts/activerecord-session_store:secure-session-store")

Mar 10, 2021

[Conversation
21](/rails/activerecord-session_store/pull/151)
[Commits
4](/rails/activerecord-session_store/pull/151/commits)
[Checks
0](/rails/activerecord-session_store/pull/151/checks)
[Files changed](/rails/activerecord-session_store/pull/151/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![kratob](https://avatars.githubusercontent.com/u/115590?s=60&v=4)](/kratob)

Copy link

Contributor

### @kratob **[kratob](/kratob)** commented [Dec 22, 2019](#issue-541452228)

`rack` and `rails` have fixed vulnerability [CVE-2019-16782](https://github.com/rack/rack/security/advisories/GHSA-hrqr-hxpp-chr3) by introducing secure variants of their session stores.

This PR makes `ActiveRecord::SessionStore` use the new `ActionDispatch::Session::AbstractSecureStore`, preventing the same attack.

Sorry, something went wrong.

 👍
18
 willnet, hamadata, mexelout, ta1kt0me, borama, jvenezia, breckenedge, jimeh, oleksii-leonov, jimbali, and 8 more reacted with thumbs up emoji

All reactions

* 👍
  18 reactions

 [kratob](/kratob)
added 2 commits
[December 21, 2019 15:10](#commits-pushed-81f551a)

[![@kratob](https://avatars.githubusercontent.com/u/115590?s=40&v=4)](/kratob)

`[secure session store [](/rails/activerecord-session_store/pull/151/commits/81f551ac040ee64ad6048bd4eea6a1da5f1d5ca3 "secure session store [CVE-2019-16782]")[CVE-2019-16782](https://github.com/advisories/GHSA-hrqr-hxpp-chr3 "CVE-2019-16782")[]](/rails/activerecord-session_store/pull/151/commits/81f551ac040ee64ad6048bd4eea6a1da5f1d5ca3 "secure session store [CVE-2019-16782]")`

`[81f551a](/rails/activerecord-session_store/pull/151/commits/81f551ac040ee64ad6048bd4eea6a1da5f1d5ca3)`

[![@kratob](https://avatars.githubusercontent.com/u/115590?s=40&v=4)](/kratob)

`[prevent unnecessary database writes](/rails/activerecord-session_store/pull/151/commits/7564029ff5a549ae485d00914d46972d732e8f83 "prevent unnecessary database writes")`

`[7564029](/rails/activerecord-session_store/pull/151/commits/7564029ff5a549ae485d00914d46972d732e8f83)`

[![rafaelfranca](https://avatars.githubusercontent.com/u/47848?s=60&v=4)](/rafaelfranca)

**[rafaelfranca](/rafaelfranca)**
reviewed
[Dec 27, 2019](#pullrequestreview-336867334)

 [View reviewed changes](/rails/activerecord-session_store/pull/151/files/7564029ff5a549ae485d00914d46972d732e8f83)

[lib/action\_dispatch/session/active\_record\_store.rb](/rails/activerecord-session_store/pull/151/files/7564029ff5a549ae485d00914d46972d732e8f83#diff-bcfcdaa3736589da92efab162f418e7febd6bbd38f8ef419b581c2179d443d49)

|  |  | end |
| --- | --- | --- |
|  |  |  |
|  |  | def get\_session\_with\_fallback(sid) |
|  |  | if sid && !self.class.private\_session\_id?(sid.public\_id) |

Copy link

Member

### @rafaelfranca **[rafaelfranca](/rafaelfranca)** [Dec 27, 2019](#discussion_r361742900)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Why this check? How the user will get access to a private id?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @kratob **[kratob](/kratob)** [Dec 30, 2019](#discussion_r361961349)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

If we don't add this protection, the fallback mechanism allows an attacker to guess the private id with a timing attack similar to the original vulnerability.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @thorsteneckel **[thorsteneckel](/thorsteneckel)** [Mar 9, 2021](#discussion_r590555048) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Imagine `public_id` just being a `private_id` in disguise. The attacker would send an `public_key` which is in fact a `private_id`! Line 136 will fail because `public_id` (aka "evil private\_id") will be a double hashed `private_id`. This will cause line 139 to be executed. Which is basically the same insecure behaviour is as it is right now.

This line prevents this. If `public_id` is in fact a `private_id` it won't get used at all and no lookup will be performed.

Instead a new and secure key/session will be generated and used ✅

Sorry, something went wrong.

 👍
1
 davidalejandroaguilar reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[lib/active\_record/session\_store/session.rb](/rails/activerecord-session_store/pull/151/files/7564029ff5a549ae485d00914d46972d732e8f83#diff-7e2eb75dbc32c1dba9a2aab0a1cea9ee555e176825cfab2c9e20c91a91d8140c)

|  |  | @@ -71,6 +71,21 @@ def loaded? | |
| --- | --- | --- | --- |
|  |  | @data |
|  |  | end |
|  |  |  |
|  |  | def secure! |

Copy link

Member

### @rafaelfranca **[rafaelfranca](/rafaelfranca)** [Dec 27, 2019](#discussion_r361742937)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Why this method was added?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @kratob **[kratob](/kratob)** [Dec 30, 2019](#discussion_r361961650)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I guess this should probably be documented.

Normally, sessions are only upgraded to secure sessions, when a user makes a request using the insecure session. This allows existing user sessions to be upgraded to secure sessions while the users are offline.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @thorsteneckel **[thorsteneckel](/thorsteneckel)** [Mar 9, 2021](#discussion_r590557875) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This will allow maintainers to create a migration which basically performs a `ActionDispatch::Session::ActiveRecordStore.session_class.find_each(&:secure!)` to migrate all existing insecure sessions to secure ones. The next lookup with the `private_id` will find the secured value in the DB and just work as for new secure sessions. The fallback case won't be executed and no additional DB query will be performed (faster/lower load).

An remark in the README.md would be great though 💡

Sorry, something went wrong.

All reactions

[![@kratob](https://avatars.githubusercontent.com/u/115590?s=40&v=4)](/kratob)

`[add documentation for a new method](/rails/activerecord-session_store/pull/151/commits/d091c7ea819350bbb9433d4dd065379832d593a3 "add documentation for a new method")`

`[d091c7e](/rails/activerecord-session_store/pull/151/commits/d091c7ea819350bbb9433d4dd065379832d593a3)`

[![@borama](https://avatars.githubusercontent.com/u/462701?s=80&v=4)](/borama)

Copy link

### **[borama](/borama)** commented [Jan 10, 2020](#issuecomment-573175573) • edited Loading

| May I add a little bit of our own context to this PR? I got here while searching for a fix for a [Sidekiq web interface](https://github.com/mperham/sidekiq/wiki/Monitoring#web-ui) issue which started after upgrading rack to 2.0.8 (a release [addressing the CVE](https://github.com/rack/rack/blob/master/CHANGELOG.md#208---2019-12-08)). Mounting the sidekiq UI in Rails routes now triggers a rack exception in ActiveRecordStorage:  ``` ActiveRecord::StatementInvalid (can't quote Rack::Session::SessionId):  activerecord (6.0.2.1) lib/active_record/core.rb:206:in `rescue in find_by' activerecord (6.0.2.1) lib/active_record/core.rb:203:in `find_by' activerecord (6.0.2.1) lib/active_record/dynamic_matchers.rb:66:in `find_by_session_id' activerecord-session_store (1.1.3) lib/action_dispatch/session/active_record_store.rb:124:in `block in get_session_model' activerecord-session_store (1.1.3) lib/active_record/session_store/extension/logger_silencer.rb:47:in `silence_logger' activerecord-session_store (1.1.3) lib/action_dispatch/session/active_record_store.rb:123:in `get_session_model' activerecord-session_store (1.1.3) lib/action_dispatch/session/active_record_store.rb:83:in `block in write_session' activerecord-session_store (1.1.3) lib/active_record/session_store/extension/logger_silencer.rb:47:in `silence_logger' activerecord-session_store (1.1.3) lib/action_dispatch/session/active_record_store.rb:82:in `write_session' rack (2.0.8) lib/rack/session/abstract/id.rb:381:in `commit_session' rack (2.0.8) lib/rack/session/abstract/id.rb:261:in `context' rack (2.0.8) lib/rack/session/abstract/id.rb:253:in `call' actionpack (6.0.2.1) lib/action_dispatch/middleware/cookies.rb:648:in `call' activerecord (6.0.2.1) lib/active_record/migration.rb:567:in `call' actionpack (6.0.2.1) lib/action_dispatch/middleware/callbacks.rb:27:in `block in call' activesupport (6.0.2.1) lib/active_support/callbacks.rb:101:in `run_callbacks' actionpack (6.0.2.1) lib/action_dispatch/middleware/callbacks.rb:26:in `call'  ...  ```  Some most relevant info about the rack breaking change can be found in this [comment by Tenderlove](https://github.com/rack/rack/issues/1432#issuecomment-571688819) (and the whole thread).  This PR is very similar to the [Redis session store fix](https://github.com/redis-store/redis-rack/pull/50) which fixes a [problem very similar to ours](https://github.com/redis-store/redis-store/issues/324). I tried to test this PR with Sidekiq Web UI and rack 2.0.8 and I would like to confirm that **this PR indeed fixes our issue** and the web GUI runs just fine. We would thus certainly appreciate if this PR was merged. :) Thank you all!  **update:** the exact same problem now occurs in the [Flipper gem UI](https://github.com/jnunemaker/flipper/blob/master/docs/ui/README.md), too, which is also mounted in routes. And this PR fixes the Flipper issue, too. |
| --- |

 👍
4
 kaspergrubbe, jimeh, gatopanx, and joshmfrankel reacted with thumbs up emoji
 👀
1
 Yadnyawalkya reacted with eyes emoji

All reactions

* 👍
  4 reactions
* 👀
  1 reaction

Sorry, something went wrong.

[![@borama](https://avatars.githubusercontent.com/u/462701?s=40&v=4)](/borama)
[borama](/borama)
mentioned this pull request
[Jan 10, 2020](#ref-issue-544412506)

[Sidekiq web failed to start with Ruby 2.7 when using active\_record\_store
#152](/rails/activerecord-session_store/issues/152)

Closed

[![@thegcat](https://avatars.githubusercontent.com/u/22835?s=80&v=4)](/thegcat)

Copy link

### **[thegcat](/thegcat)** commented [Jan 22, 2020](#issuecomment-577360294)

| We are interested in an `AR::SessionStore` solution that uses the Rack `AbstractSecureStore`, but we would prefer an upstream solution rather than using the Rails LTS fork.  Is a fix intended in `AR::SessionStore`, and is there any help we could provide, for example by testing this or another Pull Request? |
| --- |

All reactions

Sorry, something went wrong.

[![@thegcat](https://avatars.githubusercontent.com/u/22835?s=80&v=4)](/thegcat)

Copy link

### **[thegcat](/thegcat)** commented [Mar 10, 2020](#issuecomment-596962697)

| Any news? Or should we just go ahead and use the rails-lts fork and/or maintain our own fork? |
| --- |

 👍
4
 jimeh, jimbali, tonydehnke, and Bonias reacted with thumbs up emoji

All reactions

* 👍
  4 reactions

Sorry, something went wrong.

[![@kalivara](https://avatars.githubusercontent.com/u/11858928?s=80&u=12062b40d022dc0301da4cf80749cd4a48b8b72b&v=4)](/kalivara)

Copy link

### **[kalivara](/kalivara)** commented [Mar 25, 2020](#issuecomment-603913406)

| [@rafaelfranca](https://github.com/rafaelfranca), is this fix advancing? I think is very important and should be addressed. Thanks! |
| --- |

 👍
9
 jimeh, gunyoki, oleksii-leonov, joshmfrankel, tmandke, jimbali, denny, tonydehnke, and Bonias reacted with thumbs up emoji

All reactions

* 👍
  9 reactions

Sorry, something went wrong.

[![@gatopanx](https://avatars.githubusercontent.com/u/1445068?s=80&u=25f18ff84c89224e59b4f2990311e0623538c63e&v=4)](/gatopanx)

Copy link

### **[gatopanx](/gatopanx)** commented [May 20, 2020](#issuecomment-631693316)

| Bump |
| --- |

 👍
5
 joshmfrankel, jimbali, tonydehnke, schinery, and Bonias reacted with thumbs up emoji

All reactions

* 👍
  5 reactions

Sorry, something went wrong.

[![@gatopanx](https://avatars.githubusercontent.com/u/1445068?s=80&u=25f18ff84c89224e59b4f2990311e0623538c63e&v=4)](/gatopanx)

Copy link

### **[gatopanx](/gatopanx)** commented [May 20, 2020](#issuecomment-631705247)

| Short term fix: `gem 'activerecord-session_store', github: 'rails-lts/activerecord-session_store', branch: 'secure-session-store'` |
| --- |

All reactions

Sorry, something went wrong.

[![@zofrex](https://avatars.githubusercontent.com/u/22220?s=40&v=4)](/zofrex)
[zofrex](/zofrex)
mentioned this pull request
[Mar 5, 2021](#ref-pullrequest-822888126)

[Add CVE-2019-25025 for activerecord-session\_store
rubysec/ruby-advisory-db#462](/rubysec/ruby-advisory-db/pull/462)
 Closed

[![@nevinera](https://avatars.githubusercontent.com/u/366133?s=80&u=10ab182683d9022f2f6beb89cf04a38e1dabd87b&v=4)](/nevinera)

Copy link

### **[nevinera](/nevinera)** commented [Mar 9, 2021](#issuecomment-793839363)

| bundle-audit is now flagging this gem:  Updated ruby-advisory-db ruby-advisory-db: 485 advisories Name: activerecord-session\_store Version: 1.1.3 Advisory: CVE-2019-25025 Criticality: Medium URL: [GHSA-cvw2-xj8r-mjf7](https://github.com/advisories/GHSA-cvw2-xj8r-mjf7 "GHSA-cvw2-xj8r-mjf7") Title: activerecord-session\_store Timing Attack Solution: remove or disable this gem until a patch is available!  I hate to point at a fork's branch in git for a production dependency :-( |
| --- |

 👍
17
 pezholio, zmariscal, DanielGilchrist, SeanLF, jeremyburks-sikich, denny, Bonias, zurbergram, stevebissett, thorsteneckel, and 7 more reacted with thumbs up emoji

All reactions

* 👍
  17 reactions

Sorry, something went wrong.

[pezholio](/pezholio)
added a commit
to dxw/transition
that referenced
this pull request
[Mar 9, 2021](#ref-commit-cfe1cc8)
[![@pezholio](https://avatars.githubusercontent.com/u/109774?s=40&u=edb63f0965639f08e2ea85a0f8d8e57098431694&v=4)](/pezholio)

`[Use the fork of ActiverecordSessionStore](/dxw/transition/commit/cfe1cc8ddf2b04efdc4f3b387bde29b962e9e0f6 "Use the fork of ActiverecordSessionStore

This addresses CVE-2019-16782

There has been a vulnerability in the wild[1] around session hijacks in Rack and
related frameworks for a while now, but this has been fixed in Rack and Rails for a
while now. There's a fix for the upstream version of ActiverecordSessionStore
since late 2019[2], but this hasn't been merged yet.

We weren't aware of this issue until recently, as it's only just been added to the
Ruby Advisory DB[3]

This uses a fork of the upstream gem, as suggested in the original PR[4] to fix the
immediate issue.

[1] https://nvd.nist.gov/vuln/detail/CVE-2019-16782
[2] https://github.com/rails/activerecord-session_store/pull/151
[3] https://github.com/rubysec/ruby-advisory-db/pull/462
[4] https://github.com/rails/activerecord-session_store/pull/151#issuecomment-631705247")`
…

`[cfe1cc8](/dxw/transition/commit/cfe1cc8ddf2b04efdc4f3b387bde29b962e9e0f6)`

```
This addresses [CVE-2019-16782](https://github.com/advisories/GHSA-hrqr-hxpp-chr3 "CVE-2019-16782")

There has been a vulnerability in the wild[1] around session hijacks in Rack and
related frameworks for a while now, but this has been fixed in Rack and Rails for a
while now. There's a fix for the upstream version of ActiverecordSessionStore
since late 2019[2], but this hasn't been merged yet.

We weren't aware of this issue until recently, as it's only just been added to the
Ruby Advisory DB[3]

This uses a fork of the upstream gem, as suggested in the original PR[4] to fix the
immediate issue.

[1] <https://nvd.nist.gov/vuln/detail/CVE-2019-16782>
[2] [rails/activerecord-session_store#151](https://github.com/rails/activerecord-session_store/pull/151)
[3] [rubysec/ruby-advisory-db#462](https://github.com/rubysec/ruby-advisory-db/pull/462)
[4] [rails/activerecord-session_store#151 (comment)](https://github.com/rails/activerecord-session_store/pull/151#issuecomment-631705247)
```

[pezholio](/pezholio)
added a commit
to dxw/transition
that referenced
this pull request
[Mar 9, 2021](#ref-commit-848d3b1)
[![@pezholio](https://avatars.githubusercontent.com/u/109774?s=40&u=edb63f0965639f08e2ea85a0f8d8e57098431694&v=4)](/pezholio)

`[Use the fork of ActiverecordSessionStore](/dxw/transition/commit/848d3b1b52331f4a6f52b276774f1bb7ddbc4343 "Use the fork of ActiverecordSessionStore

This addresses CVE-2019-16782

There has been a [vulnerability in the wild][1] around session hijacks in Rack and
related frameworks for a while now, but this has been fixed in Rack and Rails for a
while now. There's a [fix for the upstream version of ActiverecordSessionStore
since late 2019][2], but this hasn't been merged yet.

We weren't aware of this issue until recently, as it's only [just been added to the
Ruby Advisory DB][3]

This uses a fork of the upstream gem, [as suggested in the original PR][4] to fix
the immediate issue.

[1] https://nvd.nist.gov/vuln/detail/CVE-2019-16782
[2] https://github.com/rails/activerecord-session_store/pull/151
[3] https://github.com/rubysec/ruby-advisory-db/pull/462
[4] https://github.com/rails/activerecord-session_store/pull/151#issuecomment-631705247")`
…

`[848d3b1](/dxw/transition/commit/848d3b1b52331f4a6f52b276774f1bb7ddbc4343)`

```
This addresses [CVE-2019-16782](https://github.com/advisories/GHSA-hrqr-hxpp-chr3 "CVE-2019-16782")

There has been a [vulnerability in the wild][1] around session hijacks in Rack and
related frameworks for a while now, but this has been fixed in Rack and Rails for a
while now. There's a [fix for the upstream version of ActiverecordSessionStore
since late 2019][2], but this hasn't been merged yet.

We weren't aware of this issue until recently, as it's only [just been added to the
Ruby Advisory DB][3]

This uses a fork of the upstream gem, [as suggested in the original PR][4] to fix
the immediate issue.

[1] <https://nvd.nist.gov/vuln/detail/CVE-2019-16782>
[2] [rails/activerecord-session_store#151](https://github.com/rails/activerecord-session_store/pull/151)
[3] [rubysec/ruby-advisory-db#462](https://github.com/rubysec/ruby-advisory-db/pull/462)
[4] [rails/activerecord-session_store#151 (comment)](https://github.com/rails/activerecord-session_store/pull/151#issuecomment-631705247)
```

[![@pezholio](https://avatars.githubusercontent.com/u/109774?s=40&u=edb63f0965639f08e2ea85a0f8d8e57098431694&v=4)](/pezholio)
[pezholio](/pezholio)
mentioned this pull request
[Mar 9, 2021](#ref-pullrequest-825924118)

[Address CVE-2019-16782
dxw/transition#155](/dxw/transition/pull/155)
 Closed

[pezholio](/pezholio)
added a commit
to dxw/transition
that referenced
this pull request
[Mar 9, 2021](#ref-commit-e98f987)
[![@pezholio](https://avatars.githubusercontent.com/u/109774?s=40&u=edb63f0965639f08e2ea85a0f8d8e57098431694&v=4)](/pezholio)

`[Use the fork of ActiverecordSessionStore](/dxw/transition/commit/e98f98725fd7bbd7bdde8ee753e6cb38f015edde "Use the fork of ActiverecordSessionStore

This addresses CVE-2019-16782

There has been a [vulnerability in the wild][1] around session hijacks in Rack and
related frameworks for a while now, but this has been fixed in Rack and Rails for a
while now. There's a [fix for the upstream version of ActiverecordSessionStore
since late 2019][2], but this hasn't been merged yet.

We weren't aware of this issue until recently, as it's only [just been added to the
Ruby Advisory DB][3]

This uses a fork of the upstream gem, [as suggested in the original PR][4] to fix
the immediate issue.

[1]:https://nvd.nist.gov/vuln/detail/CVE-2019-16782
[2]:https://github.com/rails/activerecord-session_store/pull/151
[3]:https://github.com/rubysec/ruby-advisory-db/pull/462
[4]:https://github.com/rails/activerecord-session_store/pull/151#issuecomment-631705247")`
…

`[e98f987](/dxw/transition/commit/e98f98725fd7bbd7bdde8ee753e6cb38f015edde)`

```
This addresses [CVE-2019-16782](https://github.com/advisories/GHSA-hrqr-hxpp-chr3 "CVE-2019-16782")

There has been a [vulnerability in the wild][1] around session hijacks in Rack and
related frameworks for a while now, but this has been fixed in Rack and Rails for a
while now. There's a [fix for the upstream version of ActiverecordSessionStore
since late 2019][2], but this hasn't been merged yet.

We weren't aware of this issue until recently, as it's only [just been added to the
Ruby Advisory DB][3]

This uses a fork of the upstream gem, [as suggested in the original PR][4] to fix
the immediate issue.

[1]:<https://nvd.nist.gov/vuln/detail/CVE-2019-16782>
[2]:[rails/activerecord-session_store#151](https://github.com/rails/activerecord-session_store/pull/151)
[3]:[rubysec/ruby-advisory-db#462](https://github.com/rubysec/ruby-advisory-db/pull/462)
[4]:[rails/activerecord-session_store#151 (comment)](https://github.com/rails/activerecord-session_store/pull/151#issuecomment-631705247)
```

[![@denny](https://avatars.githubusercontent.com/u/86243?s=80&u=43d8c6cc5ec9ee5460bc486e95ceb18aa25b6140&v=4)](/denny)

Copy link

### **[denny](/denny)** commented [Mar 9, 2021](#issuecomment-794037849) • edited Loading

| I hate to point at a fork's branch in git for a production dependency :-(  I can't point at the above fork, it doesn't work with Ruby 3.0:  ```       RuntimeError:         class variable @@silencer of ActiveSupport::Logger is overtaken by Logger ```  ( Fixed in master last year, but not released so far: [#159](https://github.com/rails/activerecord-session_store/pull/159) ) |
| --- |

 👍
1
 klutch reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@ghiculescu](https://avatars.githubusercontent.com/u/509837?s=80&u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4)](/ghiculescu)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Frails%2Factiverecord-session_store%2Fpull%2F151)

[![@kratob](https://avatars.githubusercontent.com/u/115590?s=40&v=4)](/kratob)

`[Merge remote-tracking branch 'upstream/master' into secure-session-store](/rails/activerecord-session_store/pull/151/commits/532a9a5df550f78a31d9e99f010c94b4c9ca364f "Merge remote-tracking branch 'upstream/master' into secure-session-store")`

`[532a9a5](/rails/activerecord-session_store/pull/151/commits/532a9a5df550f78a31d9e99f010c94b4c9ca364f)`

[![@kratob](https://avatars.githubusercontent.com/u/115590?s=80&v=4)](/kratob)

Copy link

Contributor

Author

### **[kratob](/kratob)** commented [Mar 9, 2021](#issuecomment-794120516)

| [@kratob](https://github.com/kratob) are you able to fix merge conflicts? (if you are busy and don't have time, I can volunteer, just need access to your fork)  I wasn't aware this has become unmergable. I've resolved the conflicts. |
| --- |

 ❤️
6
 ghiculescu, pezholio, thorsteneckel, AndrewHYi, denny, and klutch reacted with heart emoji

All reactions

* ❤️
  6 reactions

Sorry, something went wrong.

[![@ghiculescu](https://avatars.githubusercontent.com/u/509837?s=80&u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4)](/ghiculescu)

Copy link

Member

### **[ghiculescu](/ghiculescu)** commented [Mar 9, 2021](#issuecomment-794121894)

| nice, that should also fix [@denny](https://github.com/denny)'s issue. |
| --- |

 ❤️
1
 denny reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[![@ghiculescu](https://avatars.githubusercontent.com/u/509837?s=80&u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4)](/ghiculescu)

Copy link

Member

### **[ghiculescu](/ghiculescu)** commented [Mar 9, 2021](#issuecomment-794122836)

| [@rafaelfranca](https://github.com/rafaelfranca) or [@sikachu](https://github.com/sikachu) are you able to take another look? |
| --- |

All reactions

Sorry, something went wrong.

[![thorsteneckel](https://avatars.githubusercontent.com/u/3873515?s=60&v=4)](/thorsteneckel)

**[thorsteneckel](/thorsteneckel)**
reviewed
[Mar 9, 2021](#pullrequestreview-607650261)

 [View reviewed changes](/rails/activerecord-session_store/pull/151/files/532a9a5df550f78a31d9e99f010c94b4c9ca364f)

Copy link

Contributor

### @thorsteneckel **[thorsteneckel](/thorsteneckel)** left a comment • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I had some troubles to reason about the changes too. However, after spending some time these look good to me ❤️ I added some comments in the hope to make it easier for the maintainers to reason about the changes as well. LGTM 🚢

Sorry, something went wrong.

All reactions

[lib/action\_dispatch/session/active\_record\_store.rb](/rails/activerecord-session_store/pull/151/files/7564029ff5a549ae485d00914d46972d732e8f83#diff-bcfcdaa3736589da92efab162f418e7febd6bbd38f8ef419b581c2179d443d49)

|  |  | end |
| --- | --- | --- |
|  |  |  |
|  |  | def get\_session\_with\_fallback(sid) |
|  |  | if sid && !self.class.private\_session\_id?(sid.public\_id) |

Copy link

Contributor

### @thorsteneckel **[thorsteneckel](/thorsteneckel)** [Mar 9, 2021](#discussion_r590555048) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Imagine `public_id` just being a `private_id` in disguise. The attacker would send an `public_key` which is in fact a `private_id`! Line 136 will fail because `public_id` (aka "evil private\_id") will be a double hashed `private_id`. This will cause line 139 to be executed. Which is basically the same insecure behaviour is as it is right now.

This line prevents this. If `public_id` is in fact a `private_id` it won't get used at all and no lookup will be performed.

Instead a new and secure key/session will be generated and used ✅

Sorry, something went wrong.

 👍
1
 davidalejandroaguilar reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[lib/active\_record/session\_store/session.rb](/rails/activerecord-session_store/pull/151/files/7564029ff5a549ae485d00914d46972d732e8f83#diff-7e2eb75dbc32c1dba9a2aab0a1cea9ee555e176825cfab2c9e20c91a91d8140c)

|  |  | @@ -71,6 +71,21 @@ def loaded? | |
| --- | --- | --- | --- |
|  |  | @data |
|  |  | end |
|  |  |  |
|  |  | def secure! |

Copy link

Contributor

### @thorsteneckel **[thorsteneckel](/thorsteneckel)** [Mar 9, 2021](#discussion_r590557875) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This will allow maintainers to create a migration which basically performs a `ActionDispatch::Session::ActiveRecordStore.session_class.find_each(&:secure!)` to migrate all existing insecure sessions to secure ones. The next lookup with the `private_id` will find the secured value in the DB and just work as for new secure sessions. The fallback case won't be executed and no additional DB query will be performed (faster/lower load).

An remark in the README.md would be great though 💡

Sorry, something went wrong.

All reactions

[![@zurbergram](https://avatars.githubusercontent.com/u/1094999?s=40&v=4)](/zurbergram)
[zurbergram](/zurbergram)
mentioned this pull request
[Mar 9, 2021](#ref-pullrequest-826479997)

[Remove Activerecord session store
department-of-veterans-affairs/gibct-data-service#798](/department-of-veterans-affairs/gibct-data-service/pull/798)
 Merged

4 tasks

[![sikachu](https://avatars.githubusercontent.com/u/4912?s=60&v=4)](/sikachu)

**[sikachu](/sikachu)**
approved these changes
[Mar 10, 2021](#pullrequestreview-608318558)

 [View reviewed changes](/rails/activerecord-session_store/pull/151/files/532a9a5df550f78a31d9e99f010c94b4c9ca364f)

Copy link

Member

### @sikachu **[sikachu](/sikachu)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This looks good to me.

As [@thorsteneckel](https://github.com/thorsteneckel) [said](https://github.com/rails/activerecord-session_store/pull/151/files#r590557875), [@kratob](https://github.com/kratob) would you mind submitting another PR documenting the `secure!` method and how to use it in the README.md?

I'm going to merge this one in since it's been so long going back and forth. Once we get the documentation for `secure!` method in then we can cut a new version.

Sorry, something went wrong.

 👍
2
 tonydehnke and kalivara reacted with thumbs up emoji
 ❤️
1
 thorsteneckel reacted with heart emoji

All reactions

* 👍
  2 reactions
* ❤️
  1 reaction

[![@sikachu](https://avatars.githubusercontent.com/u/4912?s=40&u=eb3c70ddbc9885d49affd65ed2f468c2f5e36c3b&v=4)](/sikachu)
[sikachu](/sikachu)
merged commit [`9d4dd11`](/rails/activerecord-session_store/commit/9d4dd113d3010b82daaadf0b0ee6b9fb2afb2160)
into
rails:master

[Mar 10, 2021](https://github.com/rails/activerecord-session_store/pull/151#event-4433305401)

[![@sikachu](https://avatars.githubusercontent.com/u/4912?s=40&u=eb3c70ddbc9885d49affd65ed2f468c2f5e36c3b&v=4)](/sikachu)
[sikachu](/sikachu)
mentioned this pull request
[Mar 10, 2021](#ref-issue-825836076)

[Vulnerabilities found activerecord-session\_store Timing Attack
#174](/rails/activerecord-session_store/issues/174)

Closed

[![@thorsteneckel](https://avatars.githubusercontent.com/u/3873515?s=40&u=314c9807d5feb9b101148d9cd38f8c9709d54dc2&v=4)](/thorsteneckel)
[thorsteneckel](/thorsteneckel)
mentioned this pull request
[Mar 10, 2021](#ref-pullrequest-827363676)

[Added documentation on how to mitigate CVE-2015-9284.
#175](/rails/activerecord-session_store/pull/175)
 Merged

[![@thorsteneckel](https://avatars.githubusercontent.com/u/3873515?s=80&u=314c9807d5feb9b101148d9cd38f8c9709d54dc2&v=4)](/thorsteneckel)

Copy link

Contributor

### **[thorsteneckel](/thorsteneckel)** commented [Mar 10, 2021](#issuecomment-795100611)

| Thanks a ton [@sikachu](https://github.com/sikachu) ! My proposal for the README change can be found in [#175](https://github.com/rails/activerecord-session_store/pull/175). Would be great if [@kratob](https://github.com/kratob) could give his thumb up. I'd love to see a soonish release 🙏 |
| --- |

All reactions

Sorry, something went wrong.

[![@sikachu](https://avatars.githubusercontent.com/u/4912?s=40&u=eb3c70ddbc9885d49affd65ed2f468c2f5e36c3b&v=4)](/sikachu)
[sikachu](/sikachu)
mentioned this pull request
[Mar 10, 2021](#ref-pullrequest-827696384)

[Update activerecord-session\_store advisory info
rubysec/ruby-advisory-db#463](/rubysec/ruby-advisory-db/pull/463)
 Merged

This was referenced Mar 10, 2021

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
RTEYL/ServiceProvider#3](/RTEYL/ServiceProvider/pull/3)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
DFE-Digital/teaching-vacancies#3057](/DFE-Digital/teaching-vacancies/pull/3057)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
NEU-Libraries/charon#27](/NEU-Libraries/charon/pull/27)
 Closed

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
fcrozatier/facebook\_app#4](/fcrozatier/facebook_app/pull/4)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
yshmarov/xlplan#1](/yshmarov/xlplan/pull/1)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
nay/kozuchi#263](/nay/kozuchi/pull/263)
 Merged

[Bump activerecord-session\_store from 1.1.1 to 2.0.0
seek4science/seek#543](/seek4science/seek/pull/543)
 Closed

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
sharetribe/sharetribe#4359](/sharetribe/sharetribe/pull/4359)
 Closed

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
dignityplatform/gigfunding#102](/dignityplatform/gigfunding/pull/102)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
Adrian-Hirt/l4n#4](/Adrian-Hirt/l4n/pull/4)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
thecartercenter/nemo#821](/thecartercenter/nemo/pull/821)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
alphagov/transition#1045](/alphagov/transition/pull/1045)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
dxw/transition#158](/dxw/transition/pull/158)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
aspc/aspc-website#197](/aspc/aspc-website/pull/197)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
PecanProject/bety#713](/PecanProject/bety/pull/713)
 Closed

[Bump activerecord-session\_store, rails and rspec-rails
PecanProject/bety#715](/PecanProject/bety/pull/715)
 Closed

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
PaystackOSS/pay-lender#14](/PaystackOSS/pay-lender/pull/14)
 Merged

[Bump activerecord-session\_store from 1.1.3 to 2.0.0
quintel/etmodel#3667](/quintel/etmodel/pull/3667)
 Closed

[suhiltzaile](/suhiltzaile)
pushed a commit
to bebanjo/activerecord-session\_store
that referenced
this pull request
[Apr 12, 2021](#ref-commit-e7f6309)

`[Merge pull request](/bebanjo/activerecord-session_store/commit/e7f63099e2f37b8c74bf7220758c7c1e0faaee89 "Merge pull request #151 from rails-lts/secure-session-store

Address CVE-2019-16782") [rails#151](https://github.com/rails/activerecord-session_store/pull/151) [from rails-lts/secure-session-store](/bebanjo/activerecord-session_store/commit/e7f63099e2f37b8c74bf7220758c7c1e0faaee89 "Merge pull request #151 from rails-lts/secure-session-store

Address CVE-2019-16782")`
…

`[e7f6309](/bebanjo/activerecord-session_store/commit/e7f63099e2f37b8c74bf7220758c7c1e0faaee89)`

```
Address [CVE-2019-16782](https://github.com/advisories/GHSA-hrqr-hxpp-chr3 "CVE-2019-16782")
```

[suhiltzaile](/suhiltzaile)
pushed a commit
to bebanjo/activerecord-session\_store
that referenced
this pull request
[Apr 12, 2021](#ref-commit-c81ddfd)

`[Merge pull request](/bebanjo/activerecord-session_store/commit/c81ddfd996974818eaf10e9c4552343d918774c6 "Merge pull request #151 from rails-lts/secure-session-store") [rails#151](https://github.com/rails/activerecord-session_store/pull/151) [from rails-lts/secure-session-store](/bebanjo/activerecord-session_store/commit/c81ddfd996974818eaf10e9c4552343d918774c6 "Merge pull request #151 from rails-lts/secure-session-store")`

`[c81ddfd](/bebanjo/activerecord-session_store/commit/c81ddfd996974818eaf10e9c4552343d918774c6)`

[![@stevenharman](https://avatars.githubusercontent.com/u/48658?s=40&v=4)](/stevenharman)
[stevenharman](/stevenharman)
mentioned this pull request
[Mar 28, 2023](#ref-pullrequest-1642852821)

[Allow use of secure session only
docsend/activerecord-session\_store#1](/docsend/activerecord-session_store/pull/1)
 Open

[![@tmandke](https://avatars.githubusercontent.com/u/565033?s=40&v=4)](/tmandke)
[tmandke](/tmandke)
mentioned this pull request
[Mar 28, 2023](#ref-pullrequest-1644280934)

[Allow use of secure session only
#199](/rails/activerecord-session_store/pull/199)
 Open

[![@biinari](https://avatars.githubusercontent.com/u/148009?s=40&v=4)](/biinari)
[biinari](/biinari)
mentioned this pull request
[May 12, 2023](#ref-issue-1708266527)

[Incomplete fix to secure session store CVE-2019-16782
roidrage/redis-session-store#145](/roidrage/redis-session-store/issues/145)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frails%2Factiverecord-session_store%2Fpull%2F151)

Reviewers

[![@thorsteneckel](https://avatars.githubusercontent.com/u/3873515?s=40&v=4)](/thorsteneckel) [thorsteneckel](/thorsteneckel)

thorsteneckel left review comments

[![@rafaelfranca](https://avatars.githubusercontent.com/u/47848?s=40&v=4)](/rafaelfranca) [rafaelfranca](/rafaelfranca)

rafaelfranca left review comments

[![@sikachu](https://avatars.githubusercontent.com/u/4912?s=40&v=4)](/sikachu) [sikachu](/sikachu)

sikachu approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

11 participants

[![@kratob](https://avatars.githubusercontent.com/u/115590?s=52&v=4)](/kratob) [![@borama](https://avatars.githubusercontent.com/u/462701?s=52&v=4)](/borama) [![@thegcat](https://avatars.githubusercontent.com/u/22835?s=52&v=4)](/thegcat) [![@kalivara](https://avatars.githubusercontent.com/u/11858928?s=52&v=4)](/kalivara) [![@gatopanx](https://avatars.githubusercontent.com/u/1445068?s=52&v=4)](/gatopanx) [![@nevinera](https://avatars.githubusercontent.com/u/366133?s=52&v=4)](/nevinera) [![@denny](https://avatars.githubusercontent.com/u/86243?s=52&v=4)](/denny) [![@ghiculescu](https://avatars.githubusercontent.com/u/509837?s=52&v=4)](/ghiculescu) [![@thorsteneckel](https://avatars.githubusercontent.com/u/3873515?s=52&v=4)](/thorsteneckel) [![@sikachu](https://avatars.githubusercontent.com/u/4912?s=52&v=4)](/sikachu) [![@rafaelfranca](https://avatars.githubusercontent.com/u/47848?s=52&v=4)](/rafaelfranca)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from avatars.githubusercontent.com_4c9184c5_20250121_014956.html ===
���� �  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222��  P P" ���          
   } !1AQa"q2���#B��R��$3br�
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz�������������������������������������������������������������������������       
  w !1AQaq"2�B���� #3R�br�
$4�%�&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz��������������������������������������������������������������������������   ? �5�[뤑p@� r�ĸ�S� ��U�k���Sޠ��R)l�0rs�� �\�yyՌ!�����;|$�� r��C{�G���(m�D�.�Ҹ8nnu�&tL�z�w:m�PB��e;hvӥ�`�6�0���1��T��үi�&�B$��;syj� 0���}=��,��m�Xm�Z>s�ۏ�� ��~�M�<�k-J4Wa�\q ��߭
��4���=�ڥ��:n� �BkÏ�Y4��,OZ�巸��Sc1�c��� �Yn��6,>D�Ĵj0��{¬�k��յ(Y�[[�<��֭$��'������� ���8��O�=����c2� ��.pMgG�1M�h�rC1�'=H�u��� zW��}}���{��y%S�$��U��uX�I�Cv���?]N7w=\*U��&X�
ǭL����⼲�[� [V�K[xn".���x��s�T+�V����%sgV'{���U�T�\��T�R:i�{��վd�?��ޮ���'��{=A��#ޛ�[�
���n���^)��� ���'��Z;2\*�Ѻ-i�"�IE��q��}1����Gt
�"`Ў�V��Ϊ�C�(�����9�6�T�K�f�F���v\*\*�68\*��يhE�\_0)�u�Ci�%�p�W�~\*����ɟ'ޟ;�%�zf�;���R;kI�G��Sp�7�w�Uk�"��Ť�$r7�@�\�y �N\*��$c�ڃ-ӊ��Ķ�So��iFK���{J�H�=�t���\_i6���ʤ�p�W���\�iZ
���H��2Ki$����ke|s�C-��L�Sֱum]�u�f-.#V�{��II�5� �f�z�}l����P���aas�����Ҷ�N�g�� 1/ �v�FG�Y�7��I��Z�)�E\Fa�Y�Vi���ZmQD�Ln1�\*��k�q�0rrp;խy�!
��
�Π瞝
��� ��3D����4��b��%�ܬU��P���i �K&��"Q��s�[N����F���K$L��=sU����ڴ��H���x�Į!��yF��Ol�ϵk���i� �H5��G�NJn�8<={-�^N�;��(��KU�j�\ku�}<C 2]N��4�mPB�3���5y4�boa�f��[N�T[���V�#t�nS���cus��4͍������/2�ݣ�3��3Ҷuͥ���`a�2:�Y�gfj4��Mfi�F�`18��([�ֻW�=kmt�Y �5Q�F�aսY�h�1o��[ao$�П��`����챒B�����ne���rdWo,c�4��h�o-2A��rߌ���ii���a
�̙<�I�AϽp6:�C�EWU�ɜ��L���Gc��<V��ay�wO׿`+6���d���۹E&{>��z����)/BL+g��=��.���2Kiw�:a�`�a��۷Z鬣]F�+�\\�6ynx�'����H�Ue=ͭ'3��q���z�G{����O˼J�J̇
�P���ؤ"I8l�@�s>,�r��t��8��O���\*�Qs�h�\х+Ț���4k�I�1�@2�}H�n\*��sd9H� �����s�]ˬg����
�-��Z�yS)�p =px��P����?��
