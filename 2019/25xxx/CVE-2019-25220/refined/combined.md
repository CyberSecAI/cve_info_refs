=== Content from lists.linuxfoundation.org_d89ea159_20250121_000717.html ===

```
[public inbox for bitcoindev@googlegroups.com](../?t=20191004003838)
 [help](../_/text/help/) / [color](../_/text/color/) / [mirror](../_/text/mirror/) / [Atom feed](../new.atom)
```
```
From: Braydon Fuller <braydon@purse•io>
To: bitcoin-dev@lists•linuxfoundation.org
Subject: [[bitcoin-dev] Chain width expansion](#r)
Date: Thu, 3 Oct 2019 17:38:36 -0700	[[thread overview]](#r)
Message-ID: <42cd5ffd-63e8-b738-c4ea-13d0699b1268@purse.io> (<raw>)

Hi everyone,

We would like to share a paper for broad discussion, it is titled
"Bitcoin Chain Width Expansion Denial-of-Service Attacks".

From the abstract: The attacks leverage unprotected resources for a
denial-of-service by filling the disk and exhausting the CPU with
unnecessary header and block data. This forces the node to halt
operation. The attack difficulty ranges from difficult to easy. There
are currently limited guards for some of the attacks that require
checkpoints to be enabled. This paper describes a solution that does not
require enabling or maintaining checkpoints and provides improved security.

As the checkpoints in Bitcoin Core have not been maintained or updated
since mid 2014, this is especially relevant. Bitcoin Core implements
headers-first synchronization, since 2014, that provides the base for
the further improvements upon that design.

The paper is available at:
<https://bcoin.io/papers/bitcoin-chain-expansion.pdf>

The proposed solution has been implemented in Bcoin and is available at:
<https://github.com/bcoin-org/bcoin/tree/chain-expansion>

Best,
Braydon Fuller

```

---

```
[next](../20191004082031.ns3pgzwh2zz2mxyc%40ganymede/)             [reply](#R)	other threads:[[~2019-10-04  0:38 UTC](../?t=20191004003838)|[newest](../)]

Thread overview: 17+ messages / expand[[flat](T/#u)|[nested](t/#u)]  [mbox.gz](t.mbox.gz)  [Atom feed](t.atom)  [top](#b)
2019-10-04  0:38 [Braydon Fuller [this message]](#t)
2019-10-04  8:20 ` [David A. Harding](../20191004082031.ns3pgzwh2zz2mxyc%40ganymede/)
2019-10-04 19:51   ` [Braydon Fuller](../e9b9c972-7357-690c-2522-1928e6f84d48%40purse.io/)
2019-10-11 21:24   ` [Braydon Fuller](../69e6c777-ae56-0f33-85a6-84108a38e1ab%40purse.io/)
2019-10-04 23:31 ` [Tier Nolan](../CAE-z3OV_LL%2BJww3e%3DgO6t%3D02VW7m9PK%2B8EaYoEVLy9NKNMiSaQ%40mail.gmail.com/)
2019-10-10 16:16   ` [Braydon Fuller](../e9c5e519-ea8a-f0e2-d8fb-c955b5c2de40%40purse.io/)
2019-10-12 16:27     ` [Tier Nolan](../CAE-z3OXyTc0aoJJVNLS5MReE7%2BNhckyrjf22%2ByCSjXF8%3DbNbXQ%40mail.gmail.com/)
2019-10-12 17:56       ` [Joachim Strömbergson](../H_Yq1W3SffFweLPPXiUiA4EeU2yU7c8LVcqw5AbajovWTWMt5hKQARKglEQwCjPpXvjiBfvmTnaXJwivkGkT8BDha8k303DNbFB-ECes0d4%3D%40protonmail.com/)
2019-10-12 20:46         ` [Tier Nolan](../CAE-z3OVqU5n8H9vKj9Pn7k80guMTsxt_CkN9qwpfCK8HB4PDgQ%40mail.gmail.com/)
2019-10-16 19:07           ` [Braydon Fuller](../8d1e2696-0245-638a-61fa-8f79845136d5%40purse.io/)
2019-10-15  0:42         ` [Braydon Fuller](../93649df9-27ab-abaf-00f3-da6c528344cc%40purse.io/)
2019-10-15  7:20           ` [Joachim Strömbergson](../yKuDn4LKCA9-olIsgnJO7VqN3RE9BgZWEzLu6-k4wG30iHYDIJa6wjTBoYXU0zWCRyNCEvBb4xQw7qp0BDGBCR4zccI6kJ_4AnlsB9vc9L4%3D%40protonmail.com/)
2019-10-15  8:12             ` [Braydon Fuller](../7b0d0bff-d898-10ff-5fdb-c982b82054a1%40purse.io/)
2019-10-15 15:50               ` [Joachim Strömbergson](../V_DCmFvCt-jxYr-fmfwy9JvDApaJWrBz9_QESEs85FkBjiq579w8SOSex7I_aJyL_cN2idZ3SuR9qt0Eer456GD6eV7BAlq0k9Em5JIOPmM%3D%40protonmail.com/)
2019-10-16 19:25                 ` [Braydon Fuller](../9e42533b-aac6-1438-068b-d02a13db53f5%40purse.io/)
2019-10-15 18:30           ` [Tier Nolan](../CAE-z3OWRv1aw4_meRRon%2B5OA1rxerTr9%3D0DLWC5d7Xhyg8veBQ%40mail.gmail.com/)
2019-10-15  0:38       ` [Braydon Fuller](../e71301df-dd2b-c30c-129e-430d344fa6c4%40purse.io/)

```

---

```
Reply instructions:

You may reply publicly to [this message](#t) via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: [mbox](raw)

  Avoid top-posting and favor interleaved quoting:
  <https://en.wikipedia.org/wiki/Posting_style#Interleaved_style>

* Reply using the --to, --cc, and --in-reply-to
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=42cd5ffd-63e8-b738-c4ea-13d0699b1268@purse.io \
    --to=braydon@purse$(echo .)io \
    --cc=bitcoin-dev@lists$(echo .)linuxfoundation.org \
    /path/to/YOUR_REPLY

  <https://kernel.org/pub/software/scm/git/docs/git-send-email.html>

```
Be sure your reply has a **Subject:** header at the top and a blank line
before the message body.

---

```
This is a public inbox, see [mirroring instructions](../_/text/mirror/)
for how to clone and mirror all data and code used for this inbox
```


=== Content from bitcoincore.org_005f6861_20250121_000642.html ===


[![bitcoin core logo](/assets/images/bitcoin_core_logo_colored_reversed.png)](/)

* [About](/en/about/)
* [Download](/en/download)
* [blog](/en/blog/)
* [releases](/en/releases/)
* Development
  + [contribute](/en/contribute/)
  + [contributing code](/en/faq/contributing-code/)
  + [meetings](/en/meetings/)
  + [Lifecycle](/en/lifecycle)
  + [Security Advisories](/en/security-advisories/)
  + [RPC Docs](/en/doc/)
    - [28.0.0](/en/doc/28.0.0/)
    - [27.0.0](/en/doc/27.0.0/)
    - [26.0.0](/en/doc/26.0.0/)
    - [25.0.0](/en/doc/25.0.0/)
    - [24.0.0](/en/doc/24.0.0/)
    - [23.0.0](/en/doc/23.0.0/)
    - [22.0.0](/en/doc/22.0.0/)
    - [0.21.0](/en/doc/0.21.0/)
    - [0.20.0](/en/doc/0.20.0/)
    - [0.19.0](/en/doc/0.19.0/)
    - [0.18.0](/en/doc/0.18.0/)
    - [0.17.0](/en/doc/0.17.0/)
    - [0.16.3](/en/doc/0.16.3/)
    - [0.16.2](/en/doc/0.16.2/)
    - [0.16.1](/en/doc/0.16.1/)
    - [0.16.0](/en/doc/0.16.0/)
* Contact
  + [Contact Us](/en/contact/)
  + [Announcements](/en/list/announcements/join/)
  + [Twitter impersonation](/en/twitter-impersonation)
* English
  æ¥æ¬èª

# [Disclosure of memory DoS due to headers spam](/en/2024/09/18/disclose-headers-oom/ "Disclosure of memory DoS due to headers spam")

by .

Before Bitcoin Core v24.0.1, attackers could spam nodes with low-difficulty headers chains, which
could be used to remotely crash peers.

This issue is considered **High** severity.

## Details

Bitcoin Core stores the blockchain headers in memory. This makes it susceptible to being DoSed, by
having it download and store extremely long chains of headers, even if they are of low difficulty.
It is important to note that once crafted, an attack chain could be reused to crash any node on the
network.

The possibility of using this to attack nodes has long been known, and was the primary reason why
the checkpoint system was still in place: making an attacker start an attack at the last checkpoint
makes it far more costly than starting at the genesis block. However, over time, with decreasing
hashrate costs, even this mitigation became less effective.

This attack was independently discovered and reported to the Bitcoin Core project in January 2019 by
David Jaenson, who suggested introducing newer checkpoints as a practical mitigation. However:

1. This still leaves nodes performing IBD with no protection before they receive checkpoint blocks.
2. It relies on the ecosystem semi-regularly adopting updated software with new checkpoints, a
   practice which Bitcoin Core contributors have long been uncomfortable with.

It later got increased attention when Braydon Fuller [posted his âChain width expansionâ
writeup](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-October/017354.html) to the
bitcoin-dev mailing list in October 2019. He had previously responsibly reported it to the Bitcoin
Core security list. The suggested approach was not adopted in Bitcoin Core due to concerns about
network convergence when limiting the number of parallel chains.

At the time, the computational cost of creating a huge low-difficulty headers chain was equal to
about 32.28% of mining one block at the tip. That is a cost of about 4.12 BTC since the block reward
then was about 12.77 BTC.

By February 2022, the cost of the attack had dropped further to around 14.73% of the cost of mining
a block, and this prompted investigation of alternative solutions. If unaddressed, the cost today
(September 2024) would just be 4.44% of a block. These figures translate to a cost of about 1.07 BTC
and 0.14 BTC respectively, given the block reward at these dates.

A protection against this DoS was implemented in Bitcoin Core PR
[#25717](https://github.com/bitcoin/bitcoin/pull/25717), whereby the node will first verify a
presented chain has enough work before committing to store it. With that, Bitcoin Core no longer
relies on having checkpoints to protect against any known attacks.

## Attribution

Credit goes to David Jaenson and Braydon Fuller for independently re-discovering the attack,
estimating its cost and suggesting modifications.

Credit goes to Suhas Daftuar and Pieter Wuille for researching a satisfying fix and implementing it.

## Timeline

* 2010-07-17 - Bitcoin 0.3.2 is released, which introduces checkpoints. They protect among other
  things against low-difficulty block spam.
* 2011-11-21 - Bitcoin 0.5.0 is released, which skips script validation for blocks before the last
  checkpoint. This makes the role of checkpoints even more security-critical.
* 2014-04-09 - Block 295000 is mined, which becomes the last Bitcoin Core checkpoint. The protection
  offered by checkpoints against block spam starts eroding from this point on as hashrate costs
  decrease.
* 2015-02-16 - Bitcoin Core 0.10.0 is released, with headers-first synchronization. This weakens the
  low-difficulty block spam attack to a block *header* spam attack.
* 2017-03-08 - Bitcoin Core 0.14.0 is released, which disentangles the skipping of script validation
  from checkpoints, leaving them only relevant for protecting against block header spam.
* 2019-01-28 - David Jaenson reports this issue to the Bitcoin Core security mailing list.
* 2019-09-18 - Braydon Fuller emails the Bitcoin Core security list with a paper titled â[Bitcoin
  Chain Width Expansion Denial-of-Service
  Attacks](https://bcoin.io/papers/bitcoin-chain-expansion.pdf)â, which discusses the dangers of
  block and block header spam, a cost analysis, and a proposed solution.
* 2019-09-26 - Suhas Daftuar replies to Braydon Fuller that itâs a known issue, and invites him to
  post his writeup to the bitcoin-dev mailing list.
* 2019-10-04 - Braydon Fuller sends his paper to the bitcoin-dev mailing list.
* 2019-10-31 - In response to the above events, Suhas Daftuar opens PR
  [#17332](https://github.com/bitcoin/bitcoin/pull/17332) with an earlier but impractical proof of
  concept he worked on to improve the situation, with the hope of causing more discussion on the
  topic.
* 2022-02 - Suhas Daftuar and Pieter Wuille discuss this issue and estimate that the cost of this
  attack has now actually become so low that it warrants immediate action, and the need to avoid
  talking about it publicly.
* 2022-06-22 - Suhas Daftuar opens PR [#25454](https://github.com/bitcoin/bitcoin/pull/25454) as
  preparatory work toward implementing a fix.
* 2022-06-22 - Suhas Daftuar messages a group of long-term contributors detailing the attack, its
  cost and the fix Pieter Wuille and him have been working on.
* 2022-07-26 - Suhas Daftuar opens PR [#25717](https://github.com/bitcoin/bitcoin/pull/25717),
  co-authored with Pieter Wuille, which implements the fix.
* 2022-08-30 - PR #25717 is merged.
* 2022-10-21 - Niklas GÃ¶ggeâs PR [#26355](https://github.com/bitcoin/bitcoin/pull/26355) is merged,
  which fixes a bug in the headers pre-synchronization step that was introduced in PR #25717.
  Without this, it would still have been possible to spam block headers. The discovery of this bug,
  and the possibility of potential undiscovered ones, is the reason why the old checkpoints have not
  been removed entirely yet.
* 2022-12-12 - Bitcoin Core 24.0.1 is released with the fix.
* 2023-12-07 - The last vulnerable version of Bitcoin Core (23.2) goes end of life.
* 2024-09-18 - Public disclosure.

---

**Disclosure of memory DoS due to headers spam**
was published on
September 18, 2024

.

#### Recommended ([View all posts](/en/blog/))

* [Bitcoin Core 28.1 released](/en/2025/01/09/release-28.1/ "Bitcoin Core 28.1 released")
* [Bitcoin Core 27.2 released](/en/2024/11/04/release-27.2/ "Bitcoin Core 27.2 released")

---

[Twitter](https://twitter.com/bitcoincoreorg)

[Legal](/en/legal/) | [Privacy Policy](/en/legal/privacy) | [RSS ![rss feeds](/assets/images/rss-24x24.png)](/en/rss/)

![bitcoin core logo](/assets/images/bitcoin_core_logo.png)

© 2025 Bitcoin Core


