=== Content from bugzilla.nasm.us_a00f065f_20250121_003944.html ===


Bugzilla – Bug 3392549
Stack Exhaustion Problem Caused By the expr6 Function Making Recursive Calls to Itself
Last modified: 2023-06-26 01:56:49 PDT

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](docs/en/html/using/understanding.html)
* |
  [Log In](show_bug.cgi?id=3392549&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=3392549&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

Self-registration is disabled due to spam issue (mail gorcunov@gmail.com or hpa@zytor.com to create an account)

[**Bug 3392549**](show_bug.cgi?id=3392549)
- Stack Exhaustion Problem Caused By the expr6 Function Making Recursive Calls to Itself

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Stack Exhaustion Problem Caused By the expr6 Function Making Recursive Calls ...

| | [Status](page.cgi?id=fields.html#bug_status): | OPEN | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | NASM | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=NASM "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Assembler ([show other bugs](buglist.cgi?component=Assembler&product=NASM&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.14.xx | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | Medium normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | nobody | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2019-01-02 23:14 PST by Cheng Wen | | --- | --- | | Modified: | 2023-06-26 01:56 PDT ([History](show_activity.cgi?id=3392549)) | | CC List: | 6 users (show)  Archana.Polampalli chang.seok.bae gorcunov hpa nasm-bugs wcventure | |  | | | [Obtained from:](page.cgi?id=fields.html#cf_build "Please indicate where you obtained and/or built your version of NASM.") | Build from source archive using configure | | [Generated by:](page.cgi?id=fields.html#cf_robot "Was this bug report generated by an automatic tool, such as a memory leak detector or fuzzer, *without* including a human validation description or analysis of the problem?") | --- | | [Bug category:](page.cgi?id=fields.html#cf_category "The general category of this bug oor request.") |  | | [Breaks existing code:](page.cgi?id=fields.html#cf_breaks "This bug report breaks existing code in production or under development.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**POC**](attachment.cgi?id=411707 "View the content of the attachment") (23.68 KB, application/octet-stream)  [2019-01-02 23:14 PST](#attach_411707 "Go to the comment associated with the attachment"), Cheng Wen | [Details](attachment.cgi?id=411707&action=edit) | | [**POC2**](attachment.cgi?id=411708 "View the content of the attachment") (25.02 KB, text/plain)  [2019-01-03 04:28 PST](#attach_411708 "Go to the comment associated with the attachment"), Cheng Wen | [Details](attachment.cgi?id=411708&action=edit) | | [**POC3**](attachment.cgi?id=411709 "View the content of the attachment") (13.46 KB, text/plain)  [2019-01-03 04:28 PST](#attach_411709 "Go to the comment associated with the attachment"), Cheng Wen | [Details](attachment.cgi?id=411709&action=edit) | | [Add an attachment](attachment.cgi?bugid=3392549&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=3392549&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=3392549#c0)  Cheng Wen    2019-01-02 23:14:35 PST  ``` Created [attachment 411707](attachment.cgi?id=411707 "POC") [[details]](attachment.cgi?id=411707&action=edit "POC") POC  Hi there,  An issue was discovered in function expr6 in eval.c in Libasm, as distributed in Netwide Assembler (NASM) 2.14.03rc1. There is a stack exhaustion problem caused by the expr6 function making recursive calls to itself in certain scenarios involving lots of '!' characters.  Here is the POC file. Please use the “./nasm -f bin $POC -o /dev/null” to reproduce the bug. Command：“./nasm -f bin $POC -o /dev/null ”  $git log  > commit 81f98fe79be23174e2d6ddd9f17a5cfb9ca71ec7 > Author: H. Peter Anvin <hpa@zytor.com> > Date:   Thu Dec 27 11:34:12 2018 -0800 >  >     NASM 2.14.03rc1   The ASAN dumps the stack trace as follows:  > AddressSanitizer:DEADLYSIGNAL > ================================================================= > ==128567==ERROR: AddressSanitizer: stack-overflow on address 0x7ffe35316fa8 (pc 0x000000529378 bp 0x7ffe35317010 sp 0x7ffe35316fb0 T0) >     #0 0x529377 in nasm_skip_spaces nasm/nasmlib/string.c:135 >     #1 0x5dfd60 in stdscan /nasm/asm/stdscan.c:135:22 >     #2 0x5d4083 in expr6 /nasm/asm/eval.c:805:13 >     #3 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #4 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #5 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #6 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #7 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #8 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #9 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #10 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #11 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #12 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #13 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #14 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #15 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #16 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #17 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #18 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #19 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #20 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #21 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #22 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #23 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #24 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #25 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #26 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #27 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #28 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #29 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #30 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #31 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #32 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #33 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #34 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #35 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #36 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #37 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #38 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #39 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #40 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #41 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #42 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #43 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #44 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #45 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #46 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #47 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     ... >     ... >     #240 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #241 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #242 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #243 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #244 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #245 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #246 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #247 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #248 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >     #249 0x5d4095 in expr6 /nasm/asm/eval.c:806:13 >  > SUMMARY: AddressSanitizer: stack-overflow nasm/nasmlib/string.c:135 in nasm_skip_spaces  > ==128567==ABORTING ```  [Comment 1](show_bug.cgi?id=3392549#c1)  Cheng Wen    2019-01-02 23:20:07 PST  ``` This is simply running out of stack space. You can make the number of recursions go up by 11,000 or so by dynamically allocating variables instead of using stack space, but at the end of the day, you can work around this (for this test case) by doing:  > ulimit -s 8192  Of course, a much larger (deeper) ASM file will still make it crash. You can thus, make it happen far faster by doing:  > ulimit -s 256  The crash does not seem to happen due to any buffer overflows or memory corruption; it's simply the kernel saying "you're out of stack space, please die". One simple way to avoid the crash itself is to do a depth-check of the tree and compare it to some value related to the stack size returned and produce an error if the values are way out of whack.  A more complicated solution would involve removing recursion, which looks like it would not be a trivial fix. ```  [Comment 2](show_bug.cgi?id=3392549#c2)  Cheng Wen    2019-01-02 23:23:19 PST  ``` Different from #3392548, this issue caused by the expr6 function making recursive calls to itself.  To fix such errors, Similar study case see <https://gcc.gnu.org/bugzilla/show_bug.cgi?id=87336> ```  [Comment 3](show_bug.cgi?id=3392549#c3)  Cheng Wen    2019-01-03 04:28:26 PST  ``` Created [attachment 411708](attachment.cgi?id=411708 "POC2") [[details]](attachment.cgi?id=411708&action=edit "POC2") POC2  Another POC file Continuous "-" and "+" symbols can also trigger this problem. ```  [Comment 4](show_bug.cgi?id=3392549#c4)  Cheng Wen    2019-01-03 04:28:41 PST  ``` Created [attachment 411709](attachment.cgi?id=411709 "POC3") [[details]](attachment.cgi?id=411709&action=edit "POC3") POC3 ```  [Comment 5](show_bug.cgi?id=3392549#c5)  Polampalli, Archana    2023-06-26 01:56:49 PDT  ``` Hi,  CVE-2019-6291 has been created for this bug,  Could anyone please confirm is the bug still exists in nasm-2.15.05 and nasm-2.16.01.  I have tried reproduce the bug on nasm-2.15.05 and nasm-2.16.01 from my side but it is not reproducible. and on nasm-2.14.02 ./autogen.sh is failing with below error configure.ac: error: required file 'config.sub' not found configure.ac: error: required file 'config.guess' not found configure.ac:   try running autoreconf --install    Thanks in advance ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=3392549)
* - [XML](show_bug.cgi?ctype=xml&id=3392549)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=3392549)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [Log In](show_bug.cgi?id=3392549&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=3392549&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


