=== Content from safebreach.com_c7abb817_20250121_001203.html ===


* [Support Portal](https://support.safebreach.com/)
* [SafeBreach Labs](https://www.safebreach.com/safebreach-labs/)
* search
* [![Speak With An Expert](https://no-cache.hubspot.com/cta/default/43692056/32eed7d4-0369-42a8-96b6-6ed6cdf63f21.png)](https://cta-redirect.hubspot.com/cta/redirect/43692056/32eed7d4-0369-42a8-96b6-6ed6cdf63f21%20)

[![SafeBreach](https://www.safebreach.com/wp-content/uploads/2022/02/safebreach-logo-newbrand-large-01.svg)

![SafeBreach](https://www.safebreach.com/wp-content/uploads/2022/02/sb-logo-white-copy.svg)](https://www.safebreach.com "SafeBreach")

* [Why SafeBreach](https://www.safebreach.com/why-safebreach/)
* Solutions
  + - * Solutions
        + [Breach and Attack Simulation Platform](https://www.safebreach.com/breach-and-attack-simulation-platform/)
        + [No-Code Red Team Platform](https://www.safebreach.com/safebreach-studio/)
        + [Service & Support](https://www.safebreach.com/service-and-support/)
        + [SafeBreach-as-a-Service](https://www.safebreach.com/safebreach-as-a-service/)
        + [RansomwareRx Assessment](https://www.safebreach.com/ransomware-rx/)
    - * ##### Resource

        #### SafeBreach Breach and Attack Simulation (BAS) Platform

        See how the SafeBreach breach and attack simulation platform provides a holistic view of your security posture to enhance cyber resilience and minimize business risk.

        [Read More](https://www.safebreach.com/solution-brief/improve-cyber-readiness-with-the-safebreach-breach-and-attack-simulation-platform/)
      * ![](https://www.safebreach.com/wp-content/uploads/2021/12/menu-img-one.png)
* Use Cases
  + - * #### Use Cases
  + - * By Need
        + [Threat Assessment](https://www.safebreach.com/usecases/use-case-threat-assessment/)
        + [Security Control Validation](https://www.safebreach.com/security-control-validation/)
        + [Cloud Security Assessment](https://www.safebreach.com/cloud-security-assessment/)
    - * By Industry
        + [Finance](https://www.safebreach.com/financial_cybersecurity_solution/)
        + [Healthcare](https://www.safebreach.com/healthcare_cybersecurity_solution/)
        + [Life Sciences](https://www.safebreach.com/life-sciences-cybersecurity-solution/)
        + [IT/OT Environments](https://www.safebreach.com/integrated-it-ot-cybersecurity-solution/)
    - * ##### Resource

        #### SafeBreach Security Control Validation: Minimize Risk, Maximize the Return on Your Security Investments

        [Read More](https://www.safebreach.com/solution-brief/security-control-validation-solution-brief/)
      * ![](https://www.safebreach.com/wp-content/uploads/2021/12/menu-img-two.png)
* Resources
  + - * Resources
        + [Resource Center](https://www.safebreach.com/resources/)
          - [Blog](https://www.safebreach.com/blog/)
          - [Reports & White Papers](https://www.safebreach.com/white-papers/)
          - [Solution Briefs](https://www.safebreach.com/solution-brief/)
          - [Videos & Podcasts](https://www.safebreach.com/videos/)
          - [Case Studies](https://www.safebreach.com/case-studies/)
          - [On-Demand Webinars](https://www.safebreach.com/webinars/)
          - [Breach and Attack Simulation](https://www.safebreach.com/breach-and-attack-simulation/)
          - [MITRE ATT&CK®: The Complete Guide](https://www.safebreach.com/mitre-attack/)
        + [Research Hub](https://www.safebreach.com/breach-and-attack-simulation-research-and-news/)
        + [CVE Discoveries](https://www.safebreach.com/cve-discoveries/)
        + [Events & Webinars](https://www.safebreach.com/events/)
    - * ##### GUIDE

        #### Breach and Attack Simulation

        What is breach and attack simulation? Learn all about this powerful cybersecurity solution, including use cases, comparisons, and benefits.

        [Read More](https://www.safebreach.com/breach-and-attack-simulation/)
      * ![](https://www.safebreach.com/wp-content/uploads/2021/12/menu-img-three.png)
* Our Partners
  + - * [Our Partners](https://www.safebreach.com/partners/)
        + [Explore Technology Partners](https://www.safebreach.com/technology-partners/)
        + [Explore Channel Partners](https://www.safebreach.com/channel-partners/)
        + [For Partners](https://www.safebreach.com/partners/)
    - * ##### Resource

        #### SafeBreach & Zscaler Internet Access™

        [Read More](https://www.safebreach.com/solution-brief/joint-solution-safebreach-zscaler/)
      * ![](https://www.safebreach.com/wp-content/uploads/2022/05/Group-90.png)
* Company
  + - * About SafeBreach
        + [About Us](https://www.safebreach.com/about-safebreach/)
        + [Leadership](https://www.safebreach.com/breach-and-attack-simulation-leadership-team/)
        + [Newsroom](https://www.safebreach.com/newsroom/)
        + [Careers](https://www.safebreach.com/careers/)
        + [Contact Us](https://www.safebreach.com/contact-us/)
        + [Security Portal](https://security.safebreach.com/)
    - * ##### Resource

        #### Four Pillars of Breach and Attack Simulation (BAS)

        Gain a better understanding of the continuous security validation processes and outcomes enabled by an automated BAS solution in this SafeBreach white paper.

        [Read More](https://www.safebreach.com/white-papers/four-pillars-of-breach-and-attack-simulation/)
      * ![](https://www.safebreach.com/wp-content/uploads/2021/12/menu-img-one.png)
* [Support Portal](https://support.safebreach.com/)
* [SafeBreach Labs](https://www.safebreach.com/safebreach-labs/)
* [![Speak With An Expert](https://no-cache.hubspot.com/cta/default/43692056/32eed7d4-0369-42a8-96b6-6ed6cdf63f21.png)](https://cta-redirect.hubspot.com/cta/redirect/43692056/32eed7d4-0369-42a8-96b6-6ed6cdf63f21%20)

Research

Oct 10, 2019

## HP Touchpoint Analytics – DLL Search-Order Hijacking – Potential Abuses (CVE-2019-6333)

Author:
Peleg Hadar

---

# Introduction

SafeBreach Labs discovered a new vulnerability in HP Touchpoint Analytics software.

In this post, we will demonstrate how this vulnerability can be used in order to achieve **privilege escalation and persistence** by loading an **arbitrary unsigned DLL** into a service that runs as SYSTEM.

Additionally, we will present some of the potential malicious actions that could be undertaken by exploiting this vulnerability in the HP Touchpoint Analytics software.

This post provides a proof-of-concept for reading physical memory using a 3rd party, signed driver named [**“WinRing0”**](https://github.com/QCute/WinRing0), which is deployed with the Touchpoint Analytics software.

## HP Touchpoint Analytics

HP Touchpoint Analytics is a service which is preinstalled on most HP PCs. The service anonymously collects diagnostic information about hardware performance.

The service is executed as “NT AUTHORITY\SYSTEM,” which provides it with very powerful permissions.

## Open Hardware Monitor

The components which allow HP Touchpoint Analytics to access sensitive, low-level hardware (such as physical memory, MSRs and SMBios) are provided by an open source hardware monitoring library which is called “Open Hardware Monitor” [1].

The Open Hardware Monitor library provides a signed kernel driver named [**“WinRing0,”**](https://github.com/QCute/WinRing0) which is extracted and installed during runtime.

In this post, we describe the vulnerability we found in the HP Touchpoint Analytics and Open Hardware Monitor components. We then demonstrate how this vulnerability can be exploited to achieve privilege escalation, gaining access with SYSTEM level privileges.

# Vulnerability Discovery

In our initial exploration, we targeted the HP Touchpoint Analytics service based on the assumption that such a critical service would have high-permission-level access to the PC hardware as well as the capability to induce privilege escalation.

After the HP Touchpoint Analytics service started, it executed **TouchpointAnalyticsClientService.exe** as **NT AUTHORITY\SYSTEM**.

Once executed, the PerformanceMonitor class of the service loaded the signed **OpenHardwareMonitor** 3rd-party library (mentioned above), enabling three diagnostic checks: GPU, CPU and RAM:

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image1_hfpcyp.png)

Next, the service loaded the OpenHardwareMonitorLib.dll 3rd-party library.

This library has the ability to collect information from different hardware sources.

Once the library was loaded, we noticed the following activity in ProcMon:

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image2_c2z373.png)

**Note**: We filtered the irrelevant events from the above screenshot.

As you can see, the service was trying to load three missing DLL files, which eventually were loaded from the c:\python27 directory – our PATH environment variable:

1. atiadlxx.dll
2. atiadlxy.dll
3. Nvapi64.dll

*Stay with us, we will analyze the root cause in the next section of the article.*

**Demonstrating a DLL hijacking vulnerability:**

In our VM, the c:\python27 has an ACL which allows any authenticated user to write files onto the ACL. This makes the privilege escalation simple and allows a regular user to write the missing DLL file and **achieve code execution as NT AUTHORITY\SYSTEM**.

It is important to note that an administrative user or process must (1) set the directory ACLs to allow access to non-admin user accounts, and (2) modify the system’s PATH variable to include that directory.

In order to test this privilege escalation vulnerability, we compiled a DLL (unsigned) which writes the following to the filename of a txt file:

1. The username which executed it.
2. The name of the DLL file.

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image3_ek2pth.png)

**![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image4_mbwyx8.png)
We were able to load three arbitrary DLLs and execute our code as NT AUTHORITY\SYSTEM.**

## Root Cause Analysis

Once the OpenHardwareMonitor library is loaded, it initializes GPU check classes, then it tries to load Nvidia and ATI DLL libraries in order to use their APIs.

### The ATI Logic

Here you can see the system loading the ATI DLL libraries – atiadlxx.dll and atiadlxy.dll in order to use their APIs.

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image6_c0gbnp.png)

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image7_b0yqba.png)

**The Nvidia Logic**

Here you can see the system loading the Nvidia DLL library – NVApi64.dll in order to use its APIs.

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image8_ery7vg.png)

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image9_kn3lue.png)

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image10_jc4r3p.png)

As we can see in the screenshots, there are two root causes for the vulnerability:

* **Uncontrolled Search Path – The lack of safe unmanaged DLL loading**.
  The library tried to load the mentioned unmanaged DLL files using [**DllImportAttribute**](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.dllimportattribute). The problem is that it used only the filename of the DLL, instead of an absolute path. In this case, it’s necessary to use the [**DefaultDllImportSearchPathsAttribute**](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.interopservices.defaultdllimportsearchpathsattribute) class in order to control the paths from which the DLL can be loaded.
* **No digital certificate validation** is made against the binary. The program doesn’t validate whether the DLL that it is loading is signed. Therefore, it can load an arbitrary unsigned DLL.

# Exploitation (R/W to Physical Memory)

## Open Hardware Monitor Signed Driver

As mentioned above, HP deploys the Touchpoint Analytics software with the Open Hardware Monitor library for hardware diagnostic purposes, which uses a 3rd-party **signed driver** in order to perform some of the low-level operations.

We will demonstrate how after we used this vulnerability to gain NT AUTHORITY\SYSTEM privileges. We also managed to read data from the physical memory using the signed driver.

## PoC – Reading Physical Memory

The Open Hardware Monitor library is fully open-source, which means that its driver is also open-source.

Among the functionality which is exposed by the driver, there’s an option to read/write to/from the physical memory by sending a specific IOCTL. We used the code snippet that implements the appropriate structs, sends an IOCTL to the driver, and returns the content of a physical memory address.

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image12_uekrl6.png)

Afterwards, we compiled it into a DLL and loaded it as SYSTEM using the vulnerability.

**Let’s read some arbitrary address from the physical memory.**

For this particular example, we used address 0xC00F0. The driver allows access to read between 0xC0000 and 0xFFFFF.

First of all, let’s check the content of this physical address with WinDbg, the kernel-mode debugger:

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image13_m2zi3q.png)Now let’s load our unsigned DLL using the vulnerability and write the output to a txt file:

![](https://www.safebreach.com/wp-content/uploads/blog-images/hp_image14_w45hqy.png)

As you can see, we were able to print the content of an arbitrary physical memory address easily, using the vulnerability.

# Potential Malicious Uses and Impact

HP Touchpoint Analytics is preinstalled on most HP devices running Windows.

Below we show two possible ways that an attacker can leverage the vulnerability we discovered and documented above, some using the OpenHardwareMonitor’s signed driver.

## Signed Execution and Whitelisting Bypass

The CVE-2019-6333 vulnerability gives attackers the ability to **load and execute malicious payloads using a signed service.** This ability might be abused by an attacker for different purposes such as execution and evasion, for example:

* Application Whitelisting Bypass
* Signature Validation Bypassing

## Driver Signature Enforcement (DSE) Bypass

In order to load a kernel-mode driver into Windows 10, it must be digitally signed[4] by a vendor which is authorized by Microsoft. In order to enforce that, Microsoft implemented a mechanism called **Driver Signature Enforcement (DSE)** which crashes the OS if an unsigned kernel-mode driver is loaded.

An attacker can get R/W primitives, provided by the WinRing0 driver which is a signed **kernel-mode driver.** In fact, the attacker might not need to load a driver because the previously-loaded driver already gives them considerable control.

[![Download the Skeptic’s Guide to Buying Security Tools](https://no-cache.hubspot.com/cta/default/43692056/22ed64ee-6786-455e-b1c8-91cf1dd335b8.png)](https://cta-redirect.hubspot.com/cta/redirect/43692056/22ed64ee-6786-455e-b1c8-91cf1dd335b8)

# Affected Products

* HP Touchpoint Analytics Client – All versions below 4.1.4.2827

# Timeline

**July 4th, 2019** – Vulnerability reported to [[email protected]](/cdn-cgi/l/email-protection#94fce4b9e7f1f7e1e6fde0edb9f5f8f1e6e0d4fce4baf7fbf9)

**July 11th, 2019** – Initial response from HP PSRT: Assigned case number PSR-2019-0143.

**July 25th, 2019** – We asked for a status update

**Aug 2nd, 2019** – HP PSRT confirmed the vulnerability and wanted to thank us by “assigning a CVE-ID and stating your name in the security bulletin”.

**Aug 2nd, 2019** – We asked for the CVE ID, date of fix and patched version to include in our public advisory.

**Aug 2nd, 2019** – HP PSRT said they will respond with the requested information on August 6th, and asked for a draft copy of the blog post.

**Aug 3rd, 2019** – We asked if HP is going to release the security bulletin on August 6th, and asked for details of the patch again.

**Aug 7th –** HP deployed a patch to customers.

**Aug 8th, 2019** – We mentioned our disclosure policy to HP PSRT: “Our responsible disclosure policy is inspired by Google Project Zero: Bugs found by the SafeBreach Lab team are reported to the manufacturer and only made publicly visible once a patch has been released or if 90 days have passed without a patch being released.”

**Sep 4th, 2019** – We sent a 60 days (out of 90 days) alert to HP PSRT, saying that we prefer to work together with the PSRT team in order to release our public advisory after the problem will be fixed.

**Sep 5th, 2019** – HP PSRT said that:

1. They are working with the product team on the details of the security bulletin, and that they will provide an update.
2. They mentioned that their intention is to do a coordinated disclosure with us.
3. They appreciate our 90 days policy and would like to stick to that.

**Sep 14th, 2019** – HP PSRT provided us with CVE ID: **CVE-2019-6333**, and asked for a copy of the blog post.

**Sep 14th, 2019** – We sent an encrypted copy of the blog post. We asked again for the remaining details for our public advisory (date of fix, affected products and versions).

**Sep 21th, 2019** – We sent a 77 days (out of 90 days) alert to HP PSRT, asked for the details again, and mentioned that we would like to work in good coordination but the lack of communication makes it very difficult for us.

**Sep 26th, 2019** – We sent a 83 days alert to HP PSRT, and mentioned that:

1. We haven’t heard you back for 12 days.
2. We are going to publish our public advisory in 7 days, sticking to the 90-days disclosure policy.
3. We would like to work in good coordination with you, but the lack of communication makes it very difficult for us.

**Sep 26th, 2019** – HP PSRT said that they are still finalizing the bulletin details and that their plan is to publish the security bulletin on Oct. 4th, 2019.

**Sep 26th, 2019** – I asked for the details once they are finalized so we can use them in our advisory.

**Oct 04th, 2019 –** HP has published a security advisory [2]

# References

[1] [**https://github.com/openhardwaremonitor/openhardwaremonitor**](https://github.com/openhardwaremonitor/openhardwaremonitor "https://github.com/openhardwaremonitor/openhardwaremonitor")

[2] [**https://support.hp.com/us-en/document/c06463166**](https://support.hp.com/us-en/document/c06463166 "https://support.hp.com/us-en/document/c06463166")

[![CTA-Skeptics-Guide](https://no-cache.hubspot.com/cta/default/43692056/f6db6e2a-e1bc-4eca-b0d1-8c010f0d0e5a.png)](https://cta-redirect.hubspot.com/cta/redirect/43692056/f6db6e2a-e1bc-4eca-b0d1-8c010f0d0e5a)

## You Might Also Be Interested In

 [Blog
### How Breach & Attack Simulation Tools Can Help You Prepare for Ransomware Attacks

Read More](https://www.safebreach.com/blog/how-breach-attack-simulation-tools-can-help-you-prepare-for-ransomware-attacks/)

 [Blog
### Cloud Security Assessment: Pen Testing vs Breach and Attack Simulation

Read More](https://www.safebreach.com/blog/cloud-security-assessment-pen-testing-vs-breach-and-attack-simulation/)

 [Blog
### 2021 In Review – We Couldn’t Have Done it Without You!

Read More](https://www.safebreach.com/blog/2021-in-review-we-couldnt-have-done-it-without-you/)

## Get the latestresearch and news

[![SafeBreach](https://www.safebreach.com/wp-content/uploads/2021/12/sb-logo-white.png)](https://www.safebreach.com "SafeBreach")

Leverage the Attack to Improve Your Defenses

* [Why SafeBreach](https://www.safebreach.com/why-safebreach/)
* Solutions
  + [Breach and Attack Simulation Platform](https://www.safebreach.com/breach-and-attack-simulation-platform/)
  + [No-Code Red Team Platform](https://www.safebreach.com/safebreach-studio/)
  + [Service & Support](https://www.safebreach.com/service-and-support/)
  + [SafeBreach-as-a-Service](https://www.safebreach.com/safebreach-as-a-service/)
  + [RansomwareRx](https://www.safebreach.com/ransomware-rx/)

* Use Cases
  + [Threat Assessment](https://www.safebreach.com/usecases/use-case-threat-assessment/)
  + [Security Control Validation](https://www.safebreach.com/security-control-validation/)
  + [Cloud Security Assessment](https://www.safebreach.com/cloud-security-assessment/)
* Verticals
  + [Healthcare](https://www.safebreach.com/healthcare_cybersecurity_solution/)
  + [Finance](https://www.safebreach.com/financial_cybersecurity_solution/)
  + [Life Sciences](https://www.safebreach.com/life-sciences-cybersecurity-solution/)
  + [IT/OT Environments](https://www.safebreach.com/integrated-it-ot-cybersecurity-solution/)

* SafeBreach Labs
  + [Labs](https://www.safebreach.com/safebreach-labs/)
  + [Research Hub](https://www.safebreach.com/breach-and-attack-simulation-research-and-news/)
  + [CVE Discoveries](https://www.safebreach.com/cve-discoveries/)
* [Resources](https://www.safebreach.com/resources/)
  + [Blog](https://www.safebreach.com/blog/)
  + [Reports & White Papers](https://www.safebreach.com/white-papers/)
  + [Solution Briefs](https://www.safebreach.com/solution-brief/)
  + [Videos & Podcasts](https://www.safebreach.com/videos/)
  + [Case Studies](https://www.safebreach.com/case-studies/)
  + [On-Demand Webinars](https://www.safebreach.com/webinars/)
  + [Events & Webinars](https://www.safebreach.com/events/)
  + [Breach and Attack Simulation](https://www.safebreach.com/breach-and-attack-simulation/)
  + [MITRE ATT&CK®: The Complete Guide](https://www.safebreach.com/mitre-attack/)

* Partners
  + [Our Partners](https://www.safebreach.com/partners/)
  + [Partner Portal](https://partners.safebreach.com/English/)
* Company
  + [About](https://www.safebreach.com/about-safebreach/)
  + [Leadership](https://www.safebreach.com/breach-and-attack-simulation-leadership-team/)
  + [Newsroom](https://www.safebreach.com/newsroom/)
  + [Careers](https://www.safebreach.com/careers/)
  + [Contact Us](https://www.safebreach.com/contact-us/)
  + [Security Portal](https://security.safebreach.com/)

* [Support Portal](https://support.safebreach.com/s/login/?ec=302&startURL=%2Fs%2F)
* [SafeBreach Labs](https://www.safebreach.com/safebreach-labs/)
* [Request a Demo](https://www.safebreach.com/request-a-demo/)

[![Facebook-logo](https://www.safebreach.com/wp-content/uploads/2021/12/facebook.svg)](https://www.facebook.com/safebreach)[![LinkedIn-logo](https://www.safebreach.com/wp-content/uploads/2021/12/linkedin.svg)](https://www.linkedin.com/company/safebreach/)[![Twitter-logo](https://www.safebreach.com/wp-content/uploads/2021/12/twitter.svg)](https://twitter.com/safebreach)[![Github-logo](https://www.safebreach.com/wp-content/uploads/2021/12/github.svg)](https://github.com/SafeBreach-Labs)[![YouTube-logo](https://www.safebreach.com/wp-content/uploads/2022/01/You.svg)](https://www.youtube.com/channel/UCTosJ2lQCmPW9Y9hJmLf6TA)

© Copyrights SafeBreach Inc. 2025

* [Privacy Policy](https://www.safebreach.com/privacy-policy/)
* [Terms of Use](https://www.safebreach.com/terms-of-use/)
* [Request a Demo](https://www.safebreach.com/request-a-demo/)
* [Support Portal](https://support.safebreach.com/)


