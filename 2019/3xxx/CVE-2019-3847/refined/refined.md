Based on the provided content, here's a breakdown of the vulnerability described in CVE-2019-3847:

**Root Cause:**
The vulnerability stems from the lack of proper sanitization of JavaScript code when a user with "login as other users" permission (e.g., administrators or managers) accesses another user's dashboard. Specifically, when an administrator uses the "Log in as" function to view another user's dashboard, any JavaScript that the target user had added to their dashboard was not being escaped or sanitized.

**Weaknesses/Vulnerabilities Present:**
- **Cross-Site Scripting (XSS):** The core issue is a stored XSS vulnerability. Malicious JavaScript code added to a user's dashboard could be executed in the context of another user (the administrator) who views that dashboard through the "Log in as" feature.

**Impact of Exploitation:**
- **Account Takeover:** An attacker could inject malicious JavaScript into a regular user's dashboard. An administrator or any user with the "Log in as other users" privilege who views the affected dashboard would then execute that injected malicious script. This could result in the attacker potentially gaining access to the administrator's session, cookies, or performing actions with the administrator’s privileges.
- **Data Theft/Manipulation:** Through the injected JavaScript, an attacker could potentially steal sensitive information or manipulate data accessible to the administrator.
- **Malicious Actions:**  The injected script could be designed to perform various actions without the administrator’s consent, such as modifying settings, creating new accounts, or deleting data.

**Attack Vectors:**
- An attacker would first need to compromise or control a regular user account.
- The compromised user account would then inject malicious JavaScript into their dashboard.
-  An administrator or another user with "login as" rights would then trigger the vulnerability by using the "log in as" feature to view the compromised user's dashboard.

**Required Attacker Capabilities/Position:**
- The attacker needs to have an account on the affected Moodle instance.
- The attacker must be able to modify their user's dashboard to include malicious javascript.
- The attacker must know or find an administrator or other user with the "login as other users" privilege who they can trick into viewing the compromised dashboard.
- The attacker does not necessarily need any privileged access to the system initially, only a standard user account.

**Additional Notes:**
- Moodle versions 3.5 and 3.6 had a fix implemented to sanitize this issue while still allowing access to the dashboards via "Log in as" functionality. Moodle versions 3.1 and 3.4, the fix removed access to dashboards during “Log in as”.
- The vulnerability is fixed in Moodle versions 3.6.3, 3.5.5, 3.4.8, and 3.1.17.
- A temporary workaround for users is to use incognito/private browsing while using "Log in as" and closing the window before logging back in as themselves. Another workaround is to avoid using the dashboard when logged in as another user until a patch is applied.