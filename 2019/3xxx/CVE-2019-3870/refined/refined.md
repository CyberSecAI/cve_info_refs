```
{
  "CVE-2019-3870": {
    "description": "During the creation of a new Samba AD DC, files are created in a the private/ subdirectory of our install location. This directory is typically mode 0700, that is owner (root) only access. However in some upgraded installations it will have other permissions, such as 0755, because this was the default before Samba 4.8. Within this directory files are created with mode 0666, that is world-writable, including a sample krb5.conf and the list of DNS names and servicePrincipalName values to update.",
    "root_cause": "The `set_nt_acl_conn()` function in `source3/smbd/pysmbd.c` calls `init_files_struct()` which sets the umask to 0 using `saved_umask = umask(0);` but does not restore the original umask in non-error cases using `umask(saved_umask)`. This results in files being created with world-writable permissions.",
    "weaknesses": [
      "Missing restoration of the original umask after setting it to 0.",
      "Creation of files with mode 0666, making them world-writable."
    ],
    "impact": "The vulnerability leads to the creation of world-writable files in the private directory of the Samba AD DC install location. This can lead to unauthorized modification or disclosure of sensitive information contained in these files, such as krb5.conf and lists of DNS names and servicePrincipalName values.",
    "attack_vectors": [
      "Exploitation occurs during the provisioning of a new Samba AD DC. An attacker may leverage the world writeable files to gain unauthorized access or information. "
    ],
    "required_capabilities": "An attacker needs to have the ability to access the files created during the provisioning of a new Samba AD DC. This typically requires local access or the ability to exploit another vulnerability to gain access to the affected system.",
        "affected_versions": "Samba versions 4.9 and later, specifically before 4.9.6 and 4.10.2"
  }
}
```