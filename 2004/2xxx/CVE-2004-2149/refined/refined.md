The content relates to CVE-2004-2149.

**Root Cause of Vulnerability:**

1. **SIGBUS crash:** Bulk inserts with prepared statements, when the parameter data starts at 16KB or more, trigger a SIGBUS crash due to an unaligned address error. This is caused by a network buffer overrun in the libmysql client library.
2. **Parameter Limit Truncation:** There's a limit of 65536 parameters in prepared statements. The server and client-side structures use a 32-bit integer to track parameters, but only the lower 16 bits (2 bytes) are transferred without bounds checking, causing a truncation. This results in incorrect parameter counts.

**Weaknesses/Vulnerabilities Present:**

1.  **Memory corruption:** The network buffer overrun leads to memory corruption, causing a crash.
2.  **Incorrect parameter handling:** The truncation of parameter count leads to incorrect binding of parameters, causing errors during statement execution.

**Impact of Exploitation:**

1.  **Denial of Service:** The SIGBUS crash leads to a denial of service.
2.  **Incorrect query execution**: The parameter truncation leads to incorrect prepared statements with mismatched parameter counts, which can result in unexpected behavior or errors during statement execution.

**Attack Vectors:**

1.  **Crafted prepared statements with large parameter data:** Sending prepared statements with parameter data starting at 16KB or more will trigger the SIGBUS crash.
2.  **Prepared statements with more than 65535 parameters:** Sending prepared statements with a number of parameters exceeding 65535 can lead to the truncation bug.

**Required Attacker Capabilities/Position:**

*   The attacker needs the ability to execute queries with prepared statements.
*   The attacker needs to be able to control the size and number of parameters in the prepared statements.

**Additional Details:**

*   The vulnerability is present in MySQL 4.1.3-beta, and likely other versions in the 4.1.x branch.
*   The issue is reproducible on Solaris, Linux, and Windows.
*   The parameter limit of 65535 was intentional, but the lack of checks and error messages led to the vulnerability.
*   The issues were fixed in MySQL 4.1.5.