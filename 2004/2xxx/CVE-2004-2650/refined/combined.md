=== Content from issues.apache.org_cb257396_20250125_191404.html ===


[Log in](/jira/login.jsp?os_destination=%2Fbrowse%2FJAMES-268)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![ASF JIRA](/jira/s/xd97tr/820010/13pdxe5/_/jira-logo-scaled.png)](https://issues.apache.org/jira/secure/MyJiraHome.jspa)

* [Dashboards](/jira/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/jira/browse/JAMES "View recent projects and browse a list of projects")
* [Issues](/jira/issues/ "Search for issues and view recent issues")

* [Help](https://docs.atlassian.com/jira/jcore-docs-0820/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-0820/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/jira/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/jira/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/jira/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/jira/login.jsp?os_destination=%2Fbrowse%2FJAMES-268)

Public signup for this instance is **disabled**. Go to our [Self serve sign up page](https://selfserve.apache.org/jira-account.html) to request an account. Report potential security issues [privately](https://apache.org/security/#reporting-a-vulnerability)

![Uploaded image for project: 'James Server'](https://issues.apache.org/jira/secure/projectavatar?pid=10411&avatarId=47513)

1. [James Server](/jira/browse/JAMES)
2. [JAMES-268](/jira/browse/JAMES-268)

# Spooler.accept(...) can leave locked messages and leak memory

[Log In](/jira/login.jsp?os_destination=%2Fbrowse%2FJAMES-268 "Log In")Export

XMLWordPrintableJSON
#### Details

* **Type:**
  ![](/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Status:**
  Closed
* **Priority:**
  ![](/jira/images/icons/priorities/major.svg "Major - Major loss of function.") Major
* **Resolution:**
  Fixed
* **Affects Version/s:**
  2.2.0
* **Fix Version/s:**
  [2.2.0](/jira/issues/?jql=project+%3D+JAMES+AND+fixVersion+%3D+2.2.0 "2.2.0 The second release of new features to James v2")
* **Component/s:**
  [MailStore & MailRepository](/jira/issues/?jql=project+%3D+JAMES+AND+component+%3D+%22MailStore+%26+MailRepository%22 "MailStore & MailRepository Mail storage system")
* **Labels:**
  None
#### Description

I believe there is a memory leak under an error condition in the spooler that I'll be fixing, but that should be able to wait for a 2.2.1. If I am correct, the nature of the error is here:

if (lock(s)) {

MailImpl mail = null;

try

{
mail = retrieve(s);
}

catch (javax.mail.MessagingException e)

{
...
}

if (mail == null)

{
continue;
}

If retrieve returns null or throws an exception, the lock is kept, and we leak memory. Also ...

if (filter.accept (mail.getName(),

mail.getState(),

mail.getLastUpdated().getTime(),

mail.getErrorMessage()))

{
return mail;
}

If the filter doesn't accept, we leak the lock info, although we'll eventually clean it up. The problem here is that the message is forever locked for this specific thread.

#### Attachments

#### Activity

#### People

Assignee:

![Unassigned](https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10453)
Unassigned

Reporter:

![noel](https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452)
Noel J. Bergman

Votes:
0
Vote for this issue

Watchers:
0
Start watching this issue

#### Dates

Created:

22/Apr/04 00:42

Updated:

05/Jun/04 19:29

Resolved:

22/Apr/04 01:50

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/jira/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/jira/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for Apache Software Foundation. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)


