=== Content from lists.jammed.com_82a91a7e_20250124_181920.html ===

# [ISN] The mysteriously persistently exploitable program explained.

**From:** InfoSec News (*isn@private*)

**Date:** Mon Dec 15 2003 - 03:16:10 PST

- **Next message:** [InfoSec News: "[ISN] Linux Advisory Watch - December 12th 2003"](0057.html)
  * **Previous message:** [InfoSec News: "[ISN] Phone war declared on Shanghai ads"](0055.html)

    * **Messages sorted by:**
      [[ date ]](date.html#56)
      [[ thread ]](index.html#56)
      [[ subject ]](subject.html#56)
      [[ author ]](author.html#56)

  ---

  ```

  +------------------------------------------------------------------+
  |  Linux Security: Tips, Tricks, and Hackery                       |
  |  Published by Onsight, Inc.                                      |
  |                                                                  |
  |  14-December-2003                                                |
  |  <http://www.hackinglinuxexposed.com/articles/20031214.html>       |
  +------------------------------------------------------------------+

  This issue sponsored by Building Linux VPNs

  Building Linux Virtual Private Networks offers concise, step-by-step
  instructions for building VPNs based on both standard protocols
  (IPSec, SSL, SSH, PPTP) and popular Linux VPN solutions (VTun, cIPe,
  tinc). Through numerous examples and proven practices, you will gain
  important insights into choosing a VPN solution, installing and
  configuring it, setting up routing, configuring firewalls, measuring
  performance, and much more.

  For more information, visit <http://www.buildinglinuxvpns.net/>

  --------------------------------------------------------------------

  The mysteriously persistently exploitable program explained.
  By Brian Hatch

  Summary: /bin/rm doesn't mean remove, it means unlink, and it has
  security repercussions.
                                 ------

  In a previous article[1] I described a machine compromise that
  initially would seemed to have been impossible. A vulnerable suid
  root program, /usr/sbin/buggy, was upgraded to a non vulnerable
  version, and yet crackers still were exploiting it. In fact, even
  after the program was removed entirely, it was still being exploited.

  So, how can it be that a program can be accessed even after it's been
  removed? The problem is that it wasn't removed.

  When we access a file on disk, we do so by providing a filename for
  it. The filesystem uses filenames, which are simply entries in
  directories, to look up the file's inode. An inode is a uniq numeric
  identifier, essentially a file number, which identifies the file on
  that filesystem. You can see the inode with the -i option to ls:

  $ ls -il /bin/cat
  32689 -rwxr-xr-x   1 root   root  13912 Sep 17 06:54 /bin/cat

  That first number in the second line is the inode number, here 32689.
  Note also the third field in the line, '1'. That's the link count,
  the number of directory references to the file. Now, compare /bin/cat
  to, say, /bin/gzip:

  $ ls -il /bin/gzip
  32755 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/gzip

  Note that link count of 4 in this case. How can we find the other
  filenames that point to this same file? First, let's determine which
  filesystem /bin lives on, and then use find:

  $ cd /bin

  $ df .
  Filesystem          1K-blocks     Used Available Use% Mounted on
  /dev/hda5            10766920  8325216    1894740  82% /

  $ find / -inum 32755 -xdev -ls 2>/dev/null
   32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/gzip
   32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/gunzip
   32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/zcat
   32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/uncompress

  Here we can see that the four files, /bin/gzip, /bin/gunzip, /bin/
  zcat, and /bin/uncompress are four different filenames, pointing to
  the same actual file on disk, inode number 32755.[2]

  We call these hard links -- when a file on disk is available via
  separate filenames. Compare these to symlinks/softlinks, which are
  separate files that point to a filename, rather than an inode:

  $ ls -il /bin/nc /bin/netcat
  32502 -rwxr-xr-x   1 root   root  19352 Oct 13 15:20 /bin/nc
  51222 lrwxrwxrwx   1 root   root      2 Oct 13 15:20 /bin/netcat -> nc

  Now anyone can make a hard link or symlink, assuming they have write
  permission to a directory. While symlinks can cross filesystem
  boundaries (they point to file names, not inodes) a hard link can
  only be created on the filesystem where the target file resides.

  Thus to create a hard link to /usr/sbin/buggy, the attacker needed to
  have write access to some directory that was on the same filesystem
  as /usr/sbin/buggy. Unfortunately, this machine was created with one
  big huge root (/) filesystem, which contained all the directories,
  including /tmp and /home.

  So what happened? The attacker created a link to /usr/sbin/buggy long
  before anyone knew it had a vulnerability:

  attacker$ cd $HOME
  attacker$ ls -il /usr/sbin/buggy
  18824 -rwsr-xr-x   1 root   root  19352 Feb  5 08:12 /usr/sbin/buggy

  attacker$ ln /usr/sbin/buggy mybuggy.hardlink
  attacker$ ls -il /usr/sbin/buggy mybuggy.hardlink
  18824 -rwsr-xr-x   2 root   root  19352 Feb  5 08:12 /usr/sbin/buggy
  18824 -rwsr-xr-x   2 root   root  19352 Feb  5 08:12 mybuggy.hardlink

  Note how the link count has changed to 2 now -- this file on disk is
  now referenced by two filenames.

  Later on, when the bug in /usr/sbin/buggy came to light, the
  administrators upgraded the package. The upgrade automatically
  deleted the old /usr/sbin/buggy and then copied the new one from the
  binary package into /usr/sbin. But when the upgrade deleted /usr/sbin
  /buggy, the kernel merely decremented the link count (from 2 to 1) of
  that inode, and didn't actually free up the disk space, because the
  file was still referenced by a different filename on the filesystem.
  The original program still existed on disk, with the original suid
  permissions.

  attacker$ ls -il /usr/sbin/buggy mybuggy.hardlink
  45110 -rwsr-xr-x   1 root   root  17889 Nov 29 12:13 /usr/sbin/buggy
  18824 -rwsr-xr-x   1 root   root  19352 Feb  5 08:12 mybuggy.hardlink

  That first file is the new, non-vulnerable /usr/sbin/buggy program.
  The second is the old version, which the attacker had linked, and is
  still hanging around, and which he used to gain root access
  periodically.[3]

  So, how should the administrators have known that this link was still
  hanging around? There are several precautions that would have
  indicated or prevented the problematic situation:

    * Many file integrity tools include link count as one of the
      attributes that they watch for. These would have noticed the link
      count go up by one, and they could have gone searching for the
      new link.

    * If they ran suid program scanners, they would have picked up this
      'new' suid program.

    * If they'd put user-accessible directories on separate partitions,
      then the attacker would not have been able to create a hardlink
      in the first place. I prefer at a minimum to have /tmp, /var/tmp
      and /home on separate partitions for this reason. It's always
      best to have separate partitions for system use vs user use.

  Several readers had other ideas of how this could have been caused.
  I'll cover some of them in following articles, as they are all
  interesting.

  Congrats go to Jim Richardson of Seattle, WA for solving the contest,
  thus winning a signed copy of Hacking Linux Exposed Second Edition.

  NOTES:

  [1] See <http://www.hackinglinuxexposed.com/articles/20031111.html>.

  [2] -xdev was used to make sure we didn't look for files with inode
  number 32755 on other filesystems, such as /home for example. An
  inode is uniq on a filesystem, not across separate filesystems.

  [3] Yeah, it would have made much more sense for the attacker to put
  other backdoors into the system. I'm just concentrating on this one
  hole because anything else would be extraneous.

                              -------------
  Brian Hatch is Chief Hacker at Onsight, Inc and author of Hacking
  Linux Exposed and Building Linux VPNs. He was pleasantly surprised
  that the contest winner was a fellow Seattlite. Besides, then he was
  able to save money on postage. Brian can be reached at
  brian@private

  --------------------------------------------------------------------
  This newsletter is distributed by Onsight, Inc.

  The list is managed with MailMan (<http://www.list.org>). You can
  subscribe, unsubscribe, or change your password by visiting
  <http://lists.onsight.com/> or by sending email to
  linux_security-request@private

  Archives of this and previous newsletters are available at
  <http://www.hackinglinuxexposed.com/articles/>

  --------------------------------------------------------------------

  Copyright 2003, Brian Hatch.

  -
  ISN is currently hosted by Attrition.org

  To unsubscribe email majordomo@private with 'unsubscribe isn'
  in the BODY of the mail.

  ```

  ---

  * **Next message:** [InfoSec News: "[ISN] Linux Advisory Watch - December 12th 2003"](0057.html)* **Previous message:** [InfoSec News: "[ISN] Phone war declared on Shanghai ads"](0055.html)

      * **Messages sorted by:**
        [[ date ]](date.html#56)
        [[ thread ]](index.html#56)
        [[ subject ]](subject.html#56)
        [[ author ]](author.html#56)

  ---

  *This archive was generated by [hypermail 2b30](http://www.hypermail.org/)
  : *Mon Dec 15 2003 - 06:01:40 PST**



=== Content from bugzilla.redhat.com_0d7af318_20250124_181925.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D598775)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D598775)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D598775)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 598775

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 598775**](show_bug.cgi?id=598775)
(CVE-2010-2059)
- [CVE-2010-2059](https://access.redhat.com/security/cve/CVE-2010-2059) rpm: fails to drop SUID/SGID bits on package upgrade

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2010-2059 rpm: fails to drop SUID/SGID bits on package upgrade

| | [Keywords](describekeywords.cgi): | Reopened  Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2010-2059 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [598832](show_bug.cgi?id=598832) [598934](show_bug.cgi?id=598934 "CLOSED ERRATA - rpm: Fails to remove the SUID/SGID bits on package upgrade [Fedora all]") [626707](show_bug.cgi?id=626707) [626708](show_bug.cgi?id=626708) [626709](show_bug.cgi?id=626709) [626710](show_bug.cgi?id=626710) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=598775&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=598775&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2010-06-02 02:37 UTC by Matt McCutchen | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2019-09-29 12:36 UTC ([History](show_activity.cgi?id=598775)) | | [CC List:](page.cgi?id=fields.html#cclist) | 8 users (show)  ffesti jlieskov jnovy ksrot mls pinto.elia pmatilai vdanen | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Clones: | [598832](show_bug.cgi?id=598832)  ([view as bug list](buglist.cgi?bug_id=598832)) | | | Environment: |  | | | Last Closed: | 2012-02-14 13:57:11 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | | [**SRPM for testing this bug**](attachment.cgi?id=418879 "View the content of the attachment") (2.14 KB, application/x-rpm)  [2010-06-02 02:37 UTC](#attach_418879 "Go to the comment associated with the attachment"), Matt McCutchen | *no flags* | [Details](attachment.cgi?id=418879&action=edit) | | [**SRPM reproducer, compatible also with older RHELs/Fedoras**](attachment.cgi?id=418968 "View the content of the attachment") (1.94 KB, application/x-rpm)  [2010-06-02 09:10 UTC](#attach_418968 "Go to the comment associated with the attachment"), Jindrich Novy | *no flags* | [Details](attachment.cgi?id=418968&action=edit) | | [Show Obsolete](#a0) (1) [View All](attachment.cgi?bugid=598775&action=viewall&hide_obsolete=1) | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2010:0678](https://access.redhat.com/errata/RHSA-2010%3A0678) | 0 | normal | SHIPPED\_LIVE | Moderate: rpm security update | 2010-09-07 14:35:00 UTC | | Red Hat Product Errata | [RHSA-2010:0679](https://access.redhat.com/errata/RHSA-2010%3A0679) | 0 | normal | SHIPPED\_LIVE | Moderate: rpm security and bug fix update | 2010-09-07 14:32:33 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=598775#c0)  Matt McCutchen    2010-06-02 02:37:02 UTC  ``` Created [attachment 418879](attachment.cgi?id=418879 "SRPM for testing this bug") [[details]](attachment.cgi?id=418879&action=edit "SRPM for testing this bug") SRPM for testing this bug  Description of problem: When RPM replaces an executable, it does not clear the setuid and setgid bits of the old file.  Thus, if a user made a hard link to the old executable, he/she will still be able to run it with elevated privileges.  This is bad if it was replaced because it had a vulnerability.  The problem seems to occur only when executables are replaced, not when they are erased.  This is the same bug that was previously noted in dpkg: <http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=225692>  Version-Release number of selected component (if applicable): rpm-4.8.0-14.fc13.x86_64  How reproducible: Always  Steps to Reproduce: 1. Rebuild the attached SRPM twice, once with -D 'rel 1' and once with -D 'rel 2'. 2. mkdir /tmp/rpm-setuid-test 3. rpm -i rpm-setuid-test-0-1.fc13.$(rpm -E '%{_build_arch}').rpm 4. ln /usr/bin/rpm-setuid-test /tmp/rpm-setuid-test/ 5. rpm -U rpm-setuid-test-0-2.fc13.$(rpm -E '%{_build_arch}').rpm 6. ls -l /tmp/rpm-setuid-test/rpm-setuid-test  Actual results: The old executable is setuid.  Expected results: The old executable is not setuid.   ```  [Comment 1](show_bug.cgi?id=598775#c1)  Panu Matilainen    2010-06-02 05:04:52 UTC  ``` Ah, good catch. Rpm does actually remove the SUID/SGID bits when removing packages, but not on upgrade. Will fix...   ```  [Comment 2](show_bug.cgi?id=598775#c2)  Panu Matilainen    2010-06-02 06:31:54 UTC  ``` Fixed upstream + building for rawhide now, updates to released versions to follow (AFAIK this affects every single released rpm version out there...)   ```  [Comment 3](show_bug.cgi?id=598775#c3)  Jan Lieskovsky    2010-06-02 08:44:04 UTC  ``` Upstream patch for the SUID/SGID bits removal part:   [1] <http://rpm.org/gitweb?p=rpm.git;a=commit;h=ca2d6b2b484f1501eafdde02e1688409340d2383>  Upstream patch for the POSIX file capabilities removal part:   [2] <http://rpm.org/gitweb?p=rpm.git;a=commitdiff;h=4d172a194addc49851e558ea390d3045894e3230>   ```  [Comment 5](show_bug.cgi?id=598775#c5)  Jindrich Novy    2010-06-02 09:10:04 UTC  ``` Created [attachment 418968](attachment.cgi?id=418968 "SRPM reproducer, compatible also with older RHELs/Fedoras") [[details]](attachment.cgi?id=418968&action=edit "SRPM reproducer, compatible also with older RHELs/Fedoras") SRPM reproducer, compatible also with older RHELs/Fedoras  This src.rpm is the same as the original one but recreated with md5 digests and gz payload so that it is installable even on older RHELs/Fedoras.   ```  [Comment 10](show_bug.cgi?id=598775#c10)  Jan Lieskovsky    2010-06-02 11:23:31 UTC  ``` Information about vulnerable package versions:    1, SUID/SGID bits removal part:     This issue affects the versions of the rpm package,     as shipped with Red Hat Enterprise Linux 3, 4, and 5.      This issue affects the versions of the rpm package,     as shipped with Fedora releases of 11, 12, and 13.    2, POSIX file capabilities removal part:     This issue DO not affect the versions of the rpm package,     as shipped with Red Hat Enterprise Linux 3, 4, and 5     (POSIX file capabilities were introduced starting      from v2.6.24 version of the Linux kernel).      This issue affects (in sense of vulnerable code part     presence) the versions of the rpm package, as shipped     with Fedora releases of 11, 12, and 13. Though the     file capability support is NOT used in these rpm     versions yet.   ```  [Comment 11](show_bug.cgi?id=598775#c11)  Jan Lieskovsky    2010-06-02 11:45:04 UTC  ``` CVE Request:   [1] <http://www.openwall.com/lists/oss-security/2010/06/02/2>   ```  [Comment 12](show_bug.cgi?id=598775#c12)  Michael Schröder    2010-06-02 13:03:40 UTC  ``` Sigh, my original patch from 2005 ([bug #125517](show_bug.cgi?id=125517 "CLOSED UPSTREAM - CVE-2005-4889 rpm: Updates leave hardlinked copies untouched.")) already had that change for the FSM_RENAME case, but the chunk somehow was lost when the patch was integrated...   ```  [Comment 13](show_bug.cgi?id=598775#c13)  Jan Lieskovsky    2010-06-04 08:34:45 UTC  ``` This is [CVE-2010-2059](https://access.redhat.com/security/cve/CVE-2010-2059).   ```  [Comment 14](show_bug.cgi?id=598775#c14)  Panu Matilainen    2010-06-04 08:45:32 UTC  ``` (In reply to [comment #12](show_bug.cgi?id=598775#c12)) > Sigh, my original patch from 2005 ([bug #125517](show_bug.cgi?id=125517 "CLOSED UPSTREAM - CVE-2005-4889 rpm: Updates leave hardlinked copies untouched.")) already had that change for the > FSM_RENAME case, but the chunk somehow was lost when the patch was > integrated...      I get access denied for [bug 125517](show_bug.cgi?id=125517 "CLOSED UPSTREAM - CVE-2005-4889 rpm: Updates leave hardlinked copies untouched.") for whatever reason... But regardless of where, how and when the chunk got lost, AFAICT there's no FSM_RENAME chunk in rpm-4.4.2 based OpenSUSE (sbitcheck.diff, which is probably the one that got applied to current rpm.org tree) and SLED versions (in rpm-4.4.2.diff). So you'll at least want to double-check the situation in your distros too.   ```  [Comment 15](show_bug.cgi?id=598775#c15)  Jan Lieskovsky    2010-06-04 09:19:50 UTC  ``` (In reply to [comment #14](show_bug.cgi?id=598775#c14)) > (In reply to [comment #12](show_bug.cgi?id=598775#c12)) > I get access denied for [bug 125517](show_bug.cgi?id=125517 "CLOSED UPSTREAM - CVE-2005-4889 rpm: Updates leave hardlinked copies untouched.") for whatever reason... But regardless of  Added you to that bug.  > where, how and when the chunk got lost, AFAICT there's no FSM_RENAME chunk in > rpm-4.4.2 based OpenSUSE (sbitcheck.diff, which is probably the one that got > applied to current rpm.org tree) and SLED versions (in rpm-4.4.2.diff). So > you'll at least want to double-check the situation in your distros too.   ```  [Comment 16](show_bug.cgi?id=598775#c16)  Panu Matilainen    2010-06-04 09:28:47 UTC  ``` (In reply to [comment #10](show_bug.cgi?id=598775#c10)) > Information about vulnerable package versions: > >   2, POSIX file capabilities removal part: >     This issue DO not affect the versions of the rpm package, >     as shipped with Red Hat Enterprise Linux 3, 4, and 5 >     (POSIX file capabilities were introduced starting >      from v2.6.24 version of the Linux kernel). >  >     This issue affects (in sense of vulnerable code part >     presence) the versions of the rpm package, as shipped >     with Fedora releases of 11, 12, and 13. Though the >     file capability support is NOT used in these rpm >     versions yet.      A slight correction/clarification: rpm in Fedora >= 11 comes with file capability packaging support enabled, but to my knowledge this feature is not /used/ by any packages in any distribution (Fedora or otherwise) yet.   Another twist is that the file capability support is a compile-time optional feature, and rpm will only be able to drop capabilities from hardlinks IFF capability support is enabled in rpm itself by --with-cap option to configure. Thus it's recommended that rpm is always built with --with-cap option on distributions with filesystem level support for POSIX file capabilities to enable rpm to drop capabilities potentially set by administrators/package scriptlets.   ```  [Comment 17](show_bug.cgi?id=598775#c17)  Michael Schröder    2010-06-04 09:42:12 UTC  ``` #14: Yes, all suse versions with have rpm >= 4.4.2.3 are vulnerable, too. The ones with 4.1.1 are not vulnerable, as they use the original patch.  I wonder why it's not in rpm-4.4.2.diff, I can't remember how I generated the diff. Maybe I didn't apply the hunk and Paul took the patch from our rpm-4.4.2 diff, so maybe I'm to blame for this mess.   ```  [Comment 18](show_bug.cgi?id=598775#c18)  Panu Matilainen    2010-06-04 11:06:01 UTC  ``` (In reply to [comment #17](show_bug.cgi?id=598775#c17)) > #14: Yes, all suse versions with have rpm >= 4.4.2.3 are vulnerable, too. The > ones with 4.1.1 are not vulnerable, as they use the original patch.  AFAICT not just rpm >= 4.4.2.3 but rpm >= 4.4.2.  > I wonder why it's not in rpm-4.4.2.diff, I can't remember how I generated the > diff. Maybe I didn't apply the hunk and Paul took the patch from our rpm-4.4.2 > diff, so maybe I'm to blame for this mess.      No fingerpointing intended. You reported the issue with a complete patch in bugzilla, at that point a wrong patch ending up in the rpm.org tree (years after the fact) is hardly your fault either.   ```  [Comment 21](show_bug.cgi?id=598775#c21)  Vincent Danen    2010-06-08 22:49:06 UTC  ``` See [bug #601955](show_bug.cgi?id=601955 "CLOSED ERRATA - CVE-2010-2198 rpm: fails to drop POSIX file capabilities on package upgrade or removal") for [CVE-2010-2198](https://access.redhat.com/security/cve/CVE-2010-2198) (rpm: fails to drop POSIX file capabilities/SELinux context information on package upgrade or removal)  See [bug #601956](show_bug.cgi?id=601956 "CLOSED NOTABUG - CVE-2010-2199 rpm: fails to drop POSIX ACLs on package upgrade or removal") for [CVE-2010-2199](https://access.redhat.com/security/cve/CVE-2010-2199) (rpm: fails to drop POSIX ACLs on package upgrade or removal)   ```  [Comment 22](show_bug.cgi?id=598775#c22)  Panu Matilainen    2010-06-09 09:10:25 UTC  ``` Err, this is getting rather mixed up.  The issues at hand are 1) RPM fails to drop SUID/SGID bits on package upgrade (and removal for rpm < 4.4.2.1) 2) RPM fails to drop POSIX file capabilities on package upgrade and removal, which is simply the more fine-grained analogue of case 1). This only affects systems with filesystem-level support for POSIX file capabilities.  IMO there's little point having separate CVE's for the cases but if we must ... at least lets get the descriptions straight. POSIX ACL's and SELinux contexts aren't involved as they dont have additional means to gain extra privileges through execution AFAICT.   ```  [Comment 23](show_bug.cgi?id=598775#c23)  Fedora Update System    2010-06-11 11:41:59 UTC  ``` rpm-4.8.1-1.fc13 has been submitted as an update for Fedora 13. <http://admin.fedoraproject.org/updates/rpm-4.8.1-1.fc13>   ```  [Comment 24](show_bug.cgi?id=598775#c24)  Fedora Update System    2010-06-11 12:35:17 UTC  ``` rpm-4.8.1-1.fc13 has been submitted as an update for Fedora 13. <http://admin.fedoraproject.org/updates/rpm-4.8.1-1.fc13>   ```  [Comment 25](show_bug.cgi?id=598775#c25)  Matt McCutchen    2010-06-11 20:11:26 UTC  ``` I realized that hard links are not the only way to retain access to an old executable.  The attacker can simply open it and later exec it via /proc/self/fd.  On some filesystems (in my testing, ext2 but not reiserfs), the attacker can even resurrect the file using linkat(2) with AT_SYMLINK_FOLLOW.  So, Panu, your commit 89be57ad9239c9ada0cba94a5003876b456d46bf is wrong; please revert it.   ```  [Comment 26](show_bug.cgi?id=598775#c26)  Vincent Danen    2010-06-12 01:28:56 UTC  ``` MITRE also assigned [CVE-2005-4889](https://access.redhat.com/security/cve/CVE-2005-4889) to this issue:  lib/fsm.c in RPM before 4.4.3 does not properly reset the metadata of an executable file during deletion of the file in an RPM package removal, which might allow local users to gain privileges by creating a hard link to a vulnerable (1) setuid or (2) setgid file, a related issue to [CVE-2010-2059](https://access.redhat.com/security/cve/CVE-2010-2059).  This is because [CVE-2010-2059](https://access.redhat.com/security/cve/CVE-2010-2059) specifically refers to RPM package upgrades, whereas [CVE-2005-4889](https://access.redhat.com/security/cve/CVE-2005-4889) specifically refers to RPM package removals (because SUSE had addressed the removal aspect previously, but not the upgrade aspect).   ```  [Comment 27](show_bug.cgi?id=598775#c27)  Matt McCutchen    2010-06-12 02:27:45 UTC  ``` The failure to clear set[ug]id bits on package removal ([CVE-2005-4889](https://access.redhat.com/security/cve/CVE-2005-4889)) was addressed a long time ago in [bug 125517](show_bug.cgi?id=125517 "CLOSED UPSTREAM - CVE-2005-4889 rpm: Updates leave hardlinked copies untouched.").  It is not within the scope of this bug.   ```  [Comment 28](show_bug.cgi?id=598775#c28)  Panu Matilainen    2010-06-14 07:53:15 UTC  ``` (In reply to [comment #25](show_bug.cgi?id=598775#c25)) > I realized that hard links are not the only way to retain access to an old > executable.  The attacker can simply open it and later exec it via > /proc/self/fd.  On some filesystems (in my testing, ext2 but not reiserfs), the > attacker can even resurrect the file using linkat(2) with AT_SYMLINK_FOLLOW.  > So, Panu, your commit 89be57ad9239c9ada0cba94a5003876b456d46bf is wrong; please > revert it.      Mm... open() requires read (or write, duh) permission on the file, which no program with SUID/SGID bits enabled should have. Sure the link count test could be removed, it's there only to avoid unnecessary work in the common case. This just raises the question: how far should rpm go babysitting packagers/admins? Disallow creating packages with SUID/SGID on readable/writable files? If an admin changes permissions of an executable to something "vulnerable", is it rpm's job to try and mop it under the carpet?   ```  [Comment 29](show_bug.cgi?id=598775#c29)  Matt McCutchen    2010-06-14 12:45:53 UTC  ``` (In reply to [comment #28](show_bug.cgi?id=598775#c28)) > (In reply to [comment #25](show_bug.cgi?id=598775#c25)) > > I realized that hard links are not the only way to retain access to an old > > executable.  The attacker can simply open it and later exec it via > > /proc/self/fd.  On some filesystems (in my testing, ext2 but not reiserfs), the > > attacker can even resurrect the file using linkat(2) with AT_SYMLINK_FOLLOW.  > > So, Panu, your commit 89be57ad9239c9ada0cba94a5003876b456d46bf is wrong; please > > revert it.     >  > Mm... open() requires read (or write, duh) permission on the file, which no > program with SUID/SGID bits enabled should have.  Where is that documented?  Feel free to file bugs on all the packages that don't comply:  $ find / -xdev -type f -perm /004 -perm +6000 -ls 2>/dev/null -rwsr-xr-x   1 root     root        32472 Feb 13 20:40 /bin/su -rwsr-xr-x   1 root     root        37864 Mar  5 03:58 /bin/ping -rwsr-xr-x   1 root     root        74680 May 19 07:50 /bin/mount -rwsr-xr-x   1 root     root        32504 Mar  5 03:58 /bin/ping6 -rwsr-xr-x   1 root     root        49280 May 19 07:50 /bin/umount -rwsr-xr-x   1 root     root        28744 Jun  8 01:13 /bin/fusermount -rwsr-xr-x   1 root     root        57728 Mar 19 02:56 /usr/bin/at -r-xr-sr-x   1 root     tty         11104 Apr 26 06:00 /usr/bin/wall -rwsr-sr-x   1 root     root        49416 Feb 19 03:42 /usr/bin/crontab -rwsr-xr-x   1 root     root        59440 Apr 28 09:34 /usr/bin/chage -rwxr-sr-x   1 root     tty         12024 May 19 07:50 /usr/bin/write [...]  > Sure the link count test could > be removed, it's there only to avoid unnecessary work in the common case.  Clearing the set[ug]id bits is conditioned on the executable being set[ug]id in the first place, which is not the common case, so the unnecessary work there should be minimal.  This concern applies more to file capabilities.   ```  [Comment 30](show_bug.cgi?id=598775#c30)  Fedora Update System    2010-06-30 10:43:37 UTC  ``` rpm-4.7.2-2.fc12 has been submitted as an update for Fedora 12. <http://admin.fedoraproject.org/updates/rpm-4.7.2-2.fc12>   ```  [Comment 31](show_bug.cgi?id=598775#c31)  Fedora Update System    2010-07-06 17:10:16 UTC  ``` rpm-4.7.2-2.fc12 has been pushed to the Fedora 12 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 32](show_bug.cgi?id=598775#c32)  Fedora Update System    2010-07-07 17:42:52 UTC  ``` rpm-4.8.1-2.fc13 has been pushed to the Fedora 13 stable repository.  If problems still persist, please make note of it in this bug report.   ```  [Comment 33](show_bug.cgi?id=598775#c33)  Matt McCutchen    2010-08-14 07:21:02 UTC  ``` As per [bug 598934 comment #4](show_bug.cgi?id=598934#c4 "CLOSED ERRATA - rpm: Fails to remove the SUID/SGID bits on package upgrade [Fedora all]"), this is fixed in Fedora.   ```  [Comment 37](show_bug.cgi?id=598775#c37)  Matt McCutchen    2010-08-24 19:01:56 UTC  ``` Tomas, why did you change the "whiteboard" field to values that do not match <https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2010-2059> ?   ```  [Comment 38](show_bug.cgi?id=598775#c38)  Tomas Hoger    2010-08-25 08:23:02 UTC  ``` Whiteboard contains our score, it's not just a copy-n-paste of NVD one.  In this case, NVD score does not follow 3.1.1 #1 scoring guide guideline.   ```  [Comment 39](show_bug.cgi?id=598775#c39)  errata-xmlrpc    2010-09-07 14:32:38 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 5  Via RHSA-2010:0679 <https://rhn.redhat.com/errata/RHSA-2010-0679.html>   ```  [Comment 40](show_bug.cgi?id=598775#c40)  errata-xmlrpc    2010-09-07 14:35:23 UTC  ``` This issue has been addressed in following products:    Red Hat Enterprise Linux 4  Via RHSA-2010:0678 <https://rhn.redhat.com/errata/RHSA-2010-0678.html>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=598775&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugs.debian.org_02bc070f_20250124_181923.html ===

# Debian Bug report logs - #225692 dpkg: Allows users to stash away vulnerable versions of setuid binaries

[![version graph](version.cgi?fixed=dpkg%2F1.10.19;width=2;height=2;collapse=1;found=1.9.21;absolute=0;package=dpkg)](version.cgi?absolute=0;info=1;package=dpkg;collapse=1;found=1.9.21;fixed=dpkg%2F1.10.19)

Package:
[dpkg](pkgreport.cgi?package=dpkg);
Maintainer for [dpkg](pkgreport.cgi?package=dpkg) is [Dpkg Developers <debian-dpkg@lists.debian.org>](pkgreport.cgi?maint=debian-dpkg%40lists.debian.org); Source for [dpkg](pkgreport.cgi?package=dpkg) is [src:dpkg](pkgreport.cgi?src=dpkg) ([PTS](https://tracker.debian.org/pkg/dpkg), [buildd](https://buildd.debian.org/dpkg), [popcon](https://qa.debian.org/popcon.php?package=dpkg)).

Reported by: [Erno Kuusela <erno-debbugs@erno.iki.fi>](pkgreport.cgi?submitter=erno-debbugs%40erno.iki.fi)

Date: Wed, 31 Dec 2003 17:48:10 UTC

Severity: *grave*

Tags: fixed, patch

Found in version 1.9.21

Fixed in version dpkg/1.10.19

**Done:** Scott James Remnant <scott@netsplit.com>

Bug is archived. No further changes may be made.

Display info messages

View this report as an [mbox folder](bugreport.cgi?bug=225692;mbox=yes), [status mbox](bugreport.cgi?bug=225692;mbox=yes;mboxstatus=yes), [maintainer mbox](bugreport.cgi?bug=225692;mbox=yes;mboxmaint=yes)

---

**Report forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=2), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=2), [link](#1)).

---

**Acknowledgement sent** to `Erno Kuusela <erno-debbugs@erno.iki.fi>`:

New Bug report received and forwarded. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=4), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=4), [link](#3)).

---

[Message #5](#5) received at submit@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=5), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=5), reply):

![](/cgi-bin/libravatar.cgi?email=erno-debbugs%40erno.iki.fi)
From: Erno Kuusela <erno-debbugs@erno.iki.fi>
To: Debian Bug Tracking System <submit@bugs.debian.org>
Subject: dpkg: Allows users to stash away vulnerable versions of setuid binaries
Date: Wed, 31 Dec 2003 18:30:19 +0200
```
Package: dpkg
Version: 1.9.21
Severity: grave
Tags: security

see <http://lists.jammed.com/ISN/2003/12/0056.html>

users can make hardlinks to root owned setuid binaries in the usual
partitioning configurations, so unlinking them is not a reliable way
to get rid of them.

with the current dpkg behaviour it's not enough to upgrade the package
before malicious local users get their hands on the exploit, since they
can stash the binary away and wait for an exploit to become available.

i think a fix for this might be to open() the binary, unlink() it,
and then use fchmod() to remove the setuid and setgid bits.
(optionally check link count to see if someone is trying this
and print a warning)

truncate() is out since running copies of the binaries
won't like it, and a normal chmod() would be racy...

-- System Information:
Debian Release: 3.0
Architecture: i386
Kernel: Linux fabulous 2.6.0 #2 Sun Dec 21 10:27:12 EET 2003 i686
Locale: LANG=C, LC_CTYPE=fi_FI

Versions of packages dpkg depends on:
ii  libc6                     2.3.2.ds1-10   GNU C Library: Shared libraries an
ii  libncurses5               5.3.20030719-2 Shared libraries for terminal hand
ii  libstdc++2.10-glibc2.2    1:2.95.4-15    The GNU stdc++ library

-- no debconf information

```

---

**Message sent on** to `Erno Kuusela <erno-debbugs@erno.iki.fi>`:

Bug#225692.
([full text](bugreport.cgi?bug=225692;msg=7), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=7), [link](#6)).

---

[Message #8](#8) received at 225692-submitter@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=8), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=8), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: 225692-submitter@bugs.debian.org
Subject: A common setuid symlink issue, and possible patch to the bug
Date: Sat, 3 Jan 2004 21:41:06 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=8) (text/plain, inline)]
```
```
This is really a common setuid problem, and, just for reference the
article you mention was published after a contest:

Contest - The mysteriously persistently exploitable program.
<http://www.hackinglinuxexposed.com/articles/20031111.html>
(Notice that the incident is Debian-related)

The mysteriously persistently exploitable program explained.
<http://www.hackinglinuxexposed.com/articles/20031214.html>

I'm not sure if this bug should qualify as 'grave' since it's not dpkg
task to control who symlinks to potentially dangerous binaries. As
described in the Securing Debian Manual (Mounting partitions the right way
[1]) it is the administrator task to avoid symlink attacks (as well as DoS
attacks due to system partitions filling up) by separating user-writable
directories (these include /home, /tmp and /var/tmp). These directories
should be nosuid, and nodev (and maybe noexec too even though it provides
little protection).

Notably, though, I just reviewed dpkg's code, and found this:

(dpkg-1.10.18/main/remove.c)
    259       {
    260         /*
    261          * If file to remove is a device or s[gu]id, change its mode
    262          * so that a malicious user cannot use it even if it's linked
    263          * to another file
    264          */
    265         struct stat stat_buf;
    266         if (stat(fnvb.buf,&stat_buf)==0) {
    267           if (S_ISCHR(stat_buf.st_mode) || S_ISBLK(stat_buf.st_mode)) {
    268             chmod(fnvb.buf,0);
    269           }
    270           if (stat_buf.st_mode & (S_ISUID|S_ISGID)) {
    271             chmod(fnvb.buf,stat_buf.st_mode & ~(S_ISUID|S_ISGID));
    272           }
    273         }
    274       }
    275       if (unlink(fnvb.buf)) ohshite(_("cannot remove file `%.250s'"),fnv    275 b.buf);

Now, I believe this is done when removing a package (it's under
removal_bulk()), but _not_ when upgrading (is it done with
process_archive()):

dpkg-1.10.18/main/processarc.c
  /*
   * Now we unpack the archive, backing things up as we go.
   * For each file, we check to see if it already exists.
   * There are several possibilities:
   * + We are trying to install a non-directory ...
   *  - It doesn't exist.  In this case we simply extract it.
   *  - It is a plain file, device, symlink, &c.  We do an `atomic
   *    overwrite' using link() and rename(), but leave a backup copy.
   *    Later, when we delete the backup, we remove it from any other
   *    packages' lists.

As far as I understand the code (which I might get it wrong), it will just
get unlinked:

641:      if (donotrm) continue;
642:      if (!unlink(fnamevb.buf)) continue;

and is not modified as per removal.

Shouldn't it be better if the code used in removal.c was re-used in
processarc.c. As I understand it, dpkg is vulnerable to symlink attacks to
suid binaries _only_ when a package is upgraded but not when it's removed.

If my assessment is accurate maybe this bug could be tagged 'patch' by the
dpkg team (the code from lines 259-274 of remove.c should be copied
verbatim between lines 641 and 642 of processarc and probably then
's/fnvb/fnamevb'). In any case IMHO this bug should be re-prioried as
'wishlist' (but keeping the security tag).

Regards

Javier Fernandez-Sanguino

[1]
<http://www.debian.org/doc/manuals/securing-debian-howto/ch4.en.html#s4.9>

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=8) (application/pgp-signature, inline)]
```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=10), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=10), [link](#9)).

---

**Acknowledgement sent** to `Erno Kuusela <erno@iki.fi>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=12), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=12), [link](#11)).

---

[Message #13](#13) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=13), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=13), reply):

![](/cgi-bin/libravatar.cgi?email=erno%40iki.fi)
From: Erno Kuusela <erno@iki.fi>
To: Javier Fernández-Sanguino Peña <jfs@computer.org>
Cc: 225692@bugs.debian.org
Subject: Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug
Date: Sun, 4 Jan 2004 03:24:09 +0200
```
hello,

the issue is specifically hard links, there is no problem with symlinks.

| I'm not sure if this bug should qualify as 'grave' since it's not dpkg
| task to control who symlinks to potentially dangerous binaries. As

no, but dpkg could handle the upgrade / safe neutralization of old setuid
binaries in the manner i described, and it doesn't.

| described in the Securing Debian Manual (Mounting partitions the right way
| [1]) it is the administrator task to avoid symlink attacks (as well as DoS
| attacks due to system partitions filling up) by separating user-writable
| directories (these include /home, /tmp and /var/tmp). These directories
| should be nosuid, and nodev (and maybe noexec too even though it provides
| little protection).

then the installer should make sure the system gets partitioned and
configured this way, or warn the user in big friendly letters. but
solving the problem with partitions is not as good solution in my
opinion, since fragmenting disks to multiple partitions can lead to
inflexibility and other problems.

the rest of your mail regarding dpkg code looks good to me although
i'm no expert on dpkg.

  -- erno

```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=15), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=15), [link](#14)).

---

**Acknowledgement sent** to `Erno Kuusela <erno@iki.fi>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=17), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=17), [link](#16)).

---

[Message #18](#18) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=18), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=18), reply):

![](/cgi-bin/libravatar.cgi?email=erno%40iki.fi)
From: Erno Kuusela <erno@iki.fi>
To: Javier Fernández-Sanguino Peña <jfs@computer.org>
Cc: 225692@bugs.debian.org
Subject: Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug
Date: Sun, 4 Jan 2004 05:58:08 +0200
```
| Shouldn't it be better if the code used in removal.c was re-used in

after turning my brain on i remember what my original point about
needing to use fchmod was... the usual way to upgrade binaries in unix
is to use link() or rename() to replace them atomically. there also you
can use fchmod to change the permissions of the old inode (which might
still other links). if you just chmod the setuid bit away before doing
the replacement, there's window of time where you have a nonfunctional
binary in place.

  -- erno

```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=20), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=20), [link](#19)).

---

**Acknowledgement sent** to `Javier Fernández-Sanguino Peña <jfs@computer.org>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=22), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=22), [link](#21)).

---

[Message #23](#23) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=23), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=23), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: Erno Kuusela <erno@iki.fi>
Cc: 225692@bugs.debian.org
Subject: Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug
Date: Sun, 4 Jan 2004 16:40:43 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=23) (text/plain, inline)]
```
```
On Sun, Jan 04, 2004 at 03:24:09AM +0200, Erno Kuusela wrote:
> hello,
>
> the issue is specifically hard links, there is no problem with symlinks.

Sorry, I meant hard links [1]

>
> | I'm not sure if this bug should qualify as 'grave' since it's not dpkg
> | task to control who symlinks to potentially dangerous binaries. As
>
> no, but dpkg could handle the upgrade / safe neutralization of old setuid
> binaries in the manner i described, and it doesn't.

Still, it's a wishlist bug, you are asking for an improvement to solve a
security situation.

>
> | described in the Securing Debian Manual (Mounting partitions the right way
> | [1]) it is the administrator task to avoid symlink attacks (as well as DoS
> | attacks due to system partitions filling up) by separating user-writable
> | directories (these include /home, /tmp and /var/tmp). These directories
> | should be nosuid, and nodev (and maybe noexec too even though it provides
> | little protection).
>
> then the installer should make sure the system gets partitioned and
> configured this way, or warn the user in big friendly letters. but
> solving the problem with partitions is not as good solution in my
> opinion, since fragmenting disks to multiple partitions can lead to
> inflexibility and other problems.

Notice that proper partitions _are_ one way to fix this issue [2]. Even if
you fix dpkg you are still prone to DoS attacks and hardlink attacks to
local binaries (/usr/local) not handled by dpkg (or even by installation of
local binaries if you do it in /usr/ but do not use debian packages)

>
> the rest of your mail regarding dpkg code looks good to me although
> i'm no expert on dpkg.

I'm not either :-)

Javi

[1] This is a "UNIX feature" BTW.
Sample references include:
<http://lists.insecure.org/lists/vuln-dev/1999/Dec/0027.html>
and
<http://cr.yp.to/maildisasters/postfix.19981221> (see Technical Notes)
and
<http://www.cs.uml.edu/~acahalan/linux/obstacles.html>
and
<http://www.ussg.iu.edu/hypermail/linux/kernel/9612.1/0378.html>

[2] Another way to fix this issue is doing it on the kernel, like Openwall
does: <http://www.openwall.com/linux/README.shtml> (see "Restricted links in
/tmp.")

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=23) (application/pgp-signature, inline)]
```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=25), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=25), [link](#24)).

---

**Acknowledgement sent** to `Erno Kuusela <erno@iki.fi>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=27), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=27), [link](#26)).

---

[Message #28](#28) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=28), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=28), reply):

![](/cgi-bin/libravatar.cgi?email=erno%40iki.fi)
From: Erno Kuusela <erno@iki.fi>
To: Javier Fernández-Sanguino Peña <jfs@computer.org>
Cc: 225692@bugs.debian.org
Subject: Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug
Date: Sun, 4 Jan 2004 20:08:43 +0200
```
hello,

On Sun, 04 Jan 2004, Javier Fernández-Sanguino Peña wrote:

| > | I'm not sure if this bug should qualify as 'grave' since it's not dpkg
| > | task to control who symlinks to potentially dangerous binaries. As
| >
| > no, but dpkg could handle the upgrade / safe neutralization of old setuid
| > binaries in the manner i described, and it doesn't.
|
| Still, it's a wishlist bug, you are asking for an improvement to solve a
| security situation.

well, the current situation yields local root vulnerabilities, thus it
is clearly a bug in the system. from my laymans point of view this is
dpkg's responsibility since it's replacing the binaries on upgrade.
i don't see why it would be a "wishlist" bug.

| Notice that proper partitions _are_ one way to fix this issue [2]. Even if
| you fix dpkg you are still prone to DoS attacks and hardlink attacks to
| local binaries (/usr/local) not handled by dpkg (or even by installation of
| local binaries if you do it in /usr/ but do not use debian packages)

i guess install(1) should be fixed as well. /usr/local stuff and other
third party stuff is beyond debian's control anyhow, responsibility
is on the third party packages.

[from the next mail]
| Notice that my proposal is to chmod the setuid bit just before it's
| unlinked in the dpkg code. When a binary is substituted it's first renamed
| (link/rename) and then removed, the chmod bit should be removed before the
| file itself is removed

ah ok, if you do
"ln foo foo.old && mv foo.new foo && chmod -s foo.old && rm foo.old",
that works too.

 -- erno

```

---

**Tags removed: security**
Request was from `Matt Zimmerman <mdz@debian.org>`
to `control@bugs.debian.org`.
([full text](bugreport.cgi?bug=225692;msg=30), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=30), [link](#29)).

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=32), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=32), [link](#31)).

---

**Acknowledgement sent** to `Javier Fernández-Sanguino Peña <jfs@computer.org>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=34), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=34), [link](#33)).

---

[Message #35](#35) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=35), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=35), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: Erno Kuusela <erno@iki.fi>
Cc: 225692@bugs.debian.org
Subject: Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug
Date: Sun, 4 Jan 2004 16:46:22 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=35) (text/plain, inline)]
```
```
On Sun, Jan 04, 2004 at 05:58:08AM +0200, Erno Kuusela wrote:
> | Shouldn't it be better if the code used in removal.c was re-used in
>
> after turning my brain on i remember what my original point about
> needing to use fchmod was... the usual way to upgrade binaries in unix
> is to use link() or rename() to replace them atomically. there also you
> can use fchmod to change the permissions of the old inode (which might
> still other links). if you just chmod the setuid bit away before doing
> the replacement, there's window of time where you have a nonfunctional
> binary in place.

Notice that my proposal is to chmod the setuid bit just before it's
unlinked in the dpkg code. When a binary is substituted it's first renamed
(link/rename) and then removed, the chmod bit should be removed before the
file itself is removed IMHO, that shouldn't result on having a
nonfunctional binary.

Regards

Javi

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=35) (application/pgp-signature, inline)]
```

---

**Tags added: patch**
Request was from `Javier Fernández-Sanguino Peña <jfs@computer.org>`
to `control@bugs.debian.org`.
([full text](bugreport.cgi?bug=225692;msg=37), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=37), [link](#36)).

---

**Message sent on** to `Erno Kuusela <erno-debbugs@erno.iki.fi>`:

Bug#225692.
([full text](bugreport.cgi?bug=225692;msg=39), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=39), [link](#38)).

---

[Message #40](#40) received at 225692-submitter@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=40), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=40), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: 225692-submitter@bugs.debian.org
Cc: control@bugs.debian.org
Subject: Patch for dpkg RC bug (avoids stashing symlinks)
Date: Wed, 7 Jan 2004 21:35:32 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=40) (text/plain, inline)]
```
```
tags 225692 patch
thanks

The following (yet untested) patch should provide the same mechanism for
upgrades as for removes in order to avoid the hard link attacks described
in the bug report.

I will try to test this in a limited environment to see if it fulfills the
needs (avoids these attacks) but wider testing would be good.

Regards

Javi

```
```
[[stash-suid-fix.diff](bugreport.cgi?att=1;bug=225692;filename=stash-suid-fix.diff;msg=40) (text/plain, attachment)]
```
```
[[signature.asc](bugreport.cgi?att=2;bug=225692;filename=signature.asc;msg=40) (application/pgp-signature, inline)]
```

---

**Message sent on** to `Erno Kuusela <erno-debbugs@erno.iki.fi>`:

Bug#225692.
([full text](bugreport.cgi?bug=225692;msg=42), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=42), [link](#41)).

---

[Message #43](#43) received at 225692-submitter@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=43), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=43), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: 225692-submitter@bugs.debian.org
Subject: Just a note: works as expected
Date: Wed, 7 Jan 2004 23:12:41 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=43) (text/plain, inline)]
```
```
Just a note to let bug readers now that the bug works as expected OK when
upgrading packages. I've just tried in a minimal (debootsrap) sid
environment to upgrade from woody's to sid's pppd version (script below).
Notice this is minimal testing, I would prefer if other people test the
change and reviewed the code to ensure that it won't introduce any bugs.

Regards

Javi

PS: If anyone wants pre-compiled binaries/packages, please ask.

[ As root ]
# dpkg -i dpkg_1.10.18.1_i386.deb
(Reading database ... 7293 files and directories currently installed.)
Preparing to replace dpkg 1.10.18 (using dpkg_1.10.18.1_i386.deb) ...
Unpacking replacement dpkg ...
Setting up dpkg (1.10.18.1) ...
# dpkg -i ppp_2.4.2+20031002-4_i386.deb
Preparing to replace ppp 2.4.2+20031002-4 (using ppp_2.4.2+20031002-4_i386.deb) ...
Unpacking replacement ppp ...
Setting up ppp (2.4.2+20031002-4) ...

[ As a rogue user ]
test@localhost:/tmp$ ln  /usr/sbin/pppd ..pppd_vulnerable
test@localhost:/tmp$ ls -la ..pp*
-rwsr-xr--    2 root     dip        277624 Oct 30 21:44 ..pppd_vulnerable

[ Root upgrades the package ]
# dpkg -i ppp_2.4.2+20031127-2_i386.deb
(Reading database ... 7293 files and directories currently installed.)
Preparing to replace ppp 2.4.2+20031002-4 (using
ppp_2.4.2+20031127-2_i386.deb) ...
Unpacking replacement ppp ...
Setting up ppp (2.4.2+20031127-2) ...
Installing new version of config file /etc/ppp/ip-up.d/0000usepeerdns ...
Installing new version of config file /etc/apm/event.d/ppp ...

# md5sum /usr/sbin/pppd
b70e5c63b5080b2701921a5e42669f73  /usr/sbin/pppd
# md5sum /tmp/..pppd_vulnerable
c32f54f2021e7fcbf9c033d1866a4766  /tmp/..pppd_vulnerable
# ls -la /tmp/..pppd_vulnerable
-rw-------    1 root     dip        277624 Oct 30 21:44 /tmp/..pppd_vulnerable

Which renders the vulnerable hardlink copy of the binary useless to the
attacker.

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=43) (application/pgp-signature, inline)]
```

---

**Information stored**:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=45), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=45), [link](#44)).

---

**Acknowledgement sent** to `Erno Kuusela <erno@iki.fi>`:

Extra info received and filed, but not forwarded.
([full text](bugreport.cgi?bug=225692;msg=47), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=47), [link](#46)).

---

[Message #48](#48) received at 225692-quiet@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=48), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=48), reply):

![](/cgi-bin/libravatar.cgi?email=erno%40iki.fi)
From: Erno Kuusela <erno@iki.fi>
To: Javier Fernández-Sanguino Peña <jfs@computer.org>,
225692-quiet@bugs.debian.org
Subject: Re: Bug#225692: Just a note: works as expected
Date: Sat, 10 Jan 2004 17:57:47 +0200
```

hello,

On Wed, 07 Jan 2004, Javier Fernández-Sanguino Peña wrote:

| Just a note to let bug readers now that the bug works as expected OK when
| upgrading packages. I've just tried in a minimal (debootsrap) sid
| environment to upgrade from woody's to sid's pppd version (script below).

cool. i hope there will be a security update for woody?

| Notice this is minimal testing, I would prefer if other people test the
| change and reviewed the code to ensure that it won't introduce any bugs.

| PS: If anyone wants pre-compiled binaries/packages, please ask.

i am willing to test if you have ready to go packages.

  -- erno

```

---

**Information stored**:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=50), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=50), [link](#49)).

---

**Acknowledgement sent** to `Javier Fernández-Sanguino Peña <jfs@computer.org>`:

Extra info received and filed, but not forwarded.
([full text](bugreport.cgi?bug=225692;msg=52), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=52), [link](#51)).

---

[Message #53](#53) received at 225692-quiet@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=53), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=53), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: Erno Kuusela <erno@iki.fi>
Cc: 225692-quiet@bugs.debian.org
Subject: Re: Bug#225692: Just a note: works as expected
Date: Mon, 12 Jan 2004 23:49:51 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=53) (text/plain, inline)]
```
```
On Sat, Jan 10, 2004 at 05:57:47PM +0200, Erno Kuusela wrote:
>
> i am willing to test if you have ready to go packages.

Available now at people.debian.org/~jfs/dpkg

Javi

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=53) (application/pgp-signature, inline)]
```

---

**Information stored**:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=55), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=55), [link](#54)).

---

**Acknowledgement sent** to `Erno Kuusela <erno@iki.fi>`:

Extra info received and filed, but not forwarded.
([full text](bugreport.cgi?bug=225692;msg=57), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=57), [link](#56)).

---

[Message #58](#58) received at 225692-quiet@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=58), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=58), reply):

![](/cgi-bin/libravatar.cgi?email=erno%40iki.fi)
From: Erno Kuusela <erno@iki.fi>
To: Javier Fernández-Sanguino Peña <jfs@computer.org>
Cc: 225692-quiet@bugs.debian.org
Subject: Re: Bug#225692: Just a note: works as expected
Date: Sun, 18 Jan 2004 02:53:31 +0200
```
hello,

On Mon, 12 Jan 2004, Javier Fernández-Sanguino Peña wrote:

| On Sat, Jan 10, 2004 at 05:57:47PM +0200, Erno Kuusela wrote:
| >
| > i am willing to test if you have ready to go packages.
|
| Available now at people.debian.org/~jfs/dpkg

seems to work as advertised.

  -- erno

```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=60), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=60), [link](#59)).

---

**Acknowledgement sent** to `Erno Kuusela <erno@iki.fi>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=62), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=62), [link](#61)).

---

[Message #63](#63) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=63), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=63), reply):

![](/cgi-bin/libravatar.cgi?email=erno%40iki.fi)
From: Erno Kuusela <erno@iki.fi>
To: Javier Fernández-Sanguino Peña <jfs@computer.org>
Cc: 225692@bugs.debian.org
Subject: Re: Bug#225692: Just a note: works as expected
Date: Tue, 20 Jan 2004 15:41:12 +0200
```
On Sun, 18 Jan 2004, Erno Kuusela wrote:
| | Available now at people.debian.org/~jfs/dpkg
|
| seems to work as advertised.

correction... the link i made no longer has the setuid bit,
but neither has the newly installde binary.

# apt-get --reinstall install traceroute-nanog
Reading Package Lists... Done
Building Dependency Tree... Done
0 upgraded, 0 newly installed, 1 reinstalled, 0 to remove and 32 not upgraded.
Need to get 0B/33.2kB of archives.
After unpacking 0B of additional disk space will be used.
Do you want to continue? [Y/n]
(Reading database ... 35179 files and directories currently installed.)
Preparing to replace traceroute-nanog 6.3.9-3 (using .../traceroute-nanog_6.3.9-3_i386.deb) ...
Unpacking replacement traceroute-nanog ...
Setting up traceroute-nanog (6.3.9-3) ...

# ls -l /usr/sbin/traceroute-nanog
-rwxr-xr-x    1 root     root        24408 Dec  5 19:51 /usr/sbin/traceroute-nanog

```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=65), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=65), [link](#64)).

---

**Acknowledgement sent** to `Scott James Remnant <scott@netsplit.com>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=67), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=67), [link](#66)).

---

[Message #68](#68) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=68), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=68), reply):

![](/cgi-bin/libravatar.cgi?email=scott%40netsplit.com)
From: Scott James Remnant <scott@netsplit.com>
To: Erno Kuusela <erno@iki.fi>, 225692@bugs.debian.org
Subject: Re: Bug#225692: Just a note: works as expected
Date: Thu, 26 Feb 2004 01:59:04 +0000
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=68) (text/plain, inline)]
```
```
On Tue, Jan 20, 2004 at 03:41:12PM +0200, Erno Kuusela wrote:

> On Sun, 18 Jan 2004, Erno Kuusela wrote:
> | | Available now at people.debian.org/~jfs/dpkg
> |
> | seems to work as advertised.
>
> correction... the link i made no longer has the setuid bit,
> but neither has the newly installde binary.
>
> # apt-get --reinstall install traceroute-nanog
>
traceroute-nanog doesn't contain a setuid binary...

-rwxr-xr-x root/root     24408 2003-12-05 17:51:19 ./usr/sbin/traceroute-nanog

Tested with at instead:

descent:~# ls -l /usr/bin/at
-rwsr-xr-x    1 root     root        34488 Jan 18  2002 /usr/bin/at
descent:~# ln /usr/bin/at foo
descent:~# ls -l foo
-rwsr-xr-x    2 root     root        34488 Jan 18  2002 foo

descent:~# dpkg -i at_3.1.8-11_i386.deb
(Reading database ... 11564 files and directories currently installed.)
Preparing to replace at 3.1.8-11 (using at_3.1.8-11_i386.deb) ...
Stopping deferred execution scheduler: atd.
Stopping deferred execution scheduler: atd.
Unpacking replacement at ...
Setting up at (3.1.8-11) ...
Starting deferred execution scheduler: atd.

descent:~# ls -l /usr/bin/at
-rwsr-xr-x    1 root     root        34488 Jan 18  2002 /usr/bin/at
descent:~# ls -l foo
-rw-------    1 root     root        34488 Jan 18  2002 foo

Scott
--
Have you ever, ever felt like this?
Had strange things happen?  Are you going round the twist?

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=68) (application/pgp-signature, inline)]
```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=70), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=70), [link](#69)).

---

**Acknowledgement sent** to `Scott James Remnant <scott@netsplit.com>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=72), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=72), [link](#71)).

---

[Message #73](#73) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=73), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=73), reply):

![](/cgi-bin/libravatar.cgi?email=scott%40netsplit.com)
From: Scott James Remnant <scott@netsplit.com>
To: 225692@bugs.debian.org
Subject: Bug#225692: dpkg: Allows users to stash away vulnerable versions of setuid binaries
Date: Fri, 27 Feb 2004 18:53:43 +0000
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=73) (text/plain, inline)]
```
```
Here's a patch that just copies the code from main/remove.c which is
known to work.

Scott
--
Have you ever, ever felt like this?
Had strange things happen?  Are you going round the twist?

```
```
[[dpkg-3-stashed-hardlink.patch](bugreport.cgi?att=1;bug=225692;filename=dpkg-3-stashed-hardlink.patch;msg=73) (text/plain, attachment)]
```

---

**Tags added: fixed**
Request was from `Scott James Remnant <scott@netsplit.com>`
to `control@bugs.debian.org`.
([full text](bugreport.cgi?bug=225692;msg=75), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=75), [link](#74)).

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=77), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=77), [link](#76)).

---

**Acknowledgement sent** to `Javier Fernández-Sanguino Peña <jfs@computer.org>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=79), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=79), [link](#78)).

---

[Message #80](#80) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=80), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=80), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: Scott James Remnant <scott@netsplit.com>, 225692@bugs.debian.org
Subject: (Bug 225692) The patch provided is just like the one I provided (!?)
Date: Fri, 27 Feb 2004 23:19:26 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=80) (text/plain, inline)]
```
```

Hi, I'm just curious because reviewing this bug it looks like the patch
provided by Scoot is _precisely_ the same patch I provided (albeit with the
comments describing the behaviour removed). As I mentioned in the bug
report, the code I provided was taken verbatim from remove.c (well, it has
been reindented but it's exaclty the same code).

Reviewing the NMU I can see that the applied patch does not include any of
the comments I provided (nor references) which, I believe, gave appropiate
credit. After all, Brian Hatch found this issue first (even if he did not
report it himself).

Is there any reason why my comments (and the debug line I added) have been
removed from the patch?

Regards

Javier

PS: Giving credit would have been also a nice thing, BTW.
PPS: I would have liked to hear dpkg-dev's team input in this issue,
changes in this package are of significant importance that I did not want
to risk doing an NMU.
PPS: CCing me in the replies to Erno would have been nice too.

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=80) (application/pgp-signature, inline)]
```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=82), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=82), [link](#81)).

---

**Acknowledgement sent** to `Scott James Remnant <scott@netsplit.com>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=84), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=84), [link](#83)).

---

[Message #85](#85) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=85), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=85), reply):

![](/cgi-bin/libravatar.cgi?email=scott%40netsplit.com)
From: Scott James Remnant <scott@netsplit.com>
To: Javier Fernández-Sanguino Peña <jfs@computer.org>
Cc: 225692@bugs.debian.org
Subject: Re: (Bug 225692) The patch provided is just like the one I
provided (!?)
Date: Fri, 27 Feb 2004 23:02:08 +0000
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=85) (text/plain, inline)]
```
```
On Fri, 2004-02-27 at 22:19, Javier Fernández-Sanguino Peña wrote:

> Reviewing the NMU I can see that the applied patch does not include any of
> the comments I provided (nor references) which, I believe, gave appropiate
> credit. After all, Brian Hatch found this issue first (even if he did not
> report it himself).
>
> Is there any reason why my comments (and the debug line I added) have been
> removed from the patch?
>
A ~60 line comment in the middle of a ~1,000 line function isn't really
a great place to put that kind of thing.  What the code does is fairly
obvious, and why it does it is documented in the ChangeLog entry for the
patch.

I dislike, in general, long-winded discussions of code in the middle of
functions.  Various articles and papers are interesting to the security
expert, but not to the maintainer of the code.

The *right* place for such discussions, and provision of relevant papers
and articles is the bug tracking system.  The change to the code is then
accompanied by a reference to the bug number (in debian/changelog) for
the interested reader.

So whilst the full history of a bug/change, who first noticed it,
suggested it and/or found it, etc. etc. are all interesting -- the BTS
is what keeps that information, not comments above every single block of
code in the source.

Scott
--
Have you ever, ever felt like this?
Had strange things happen?  Are you going round the twist?

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=85) (application/pgp-signature, inline)]
```

---

**Information forwarded** to `debian-bugs-dist@lists.debian.org, Dpkg Development <debian-dpkg@lists.debian.org>`:

`Bug#225692`; Package `dpkg`.
([full text](bugreport.cgi?bug=225692;msg=87), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=87), [link](#86)).

---

**Acknowledgement sent** to `Javier Fernández-Sanguino Peña <jfs@computer.org>`:

Extra info received and forwarded to list. Copy sent to `Dpkg Development <debian-dpkg@lists.debian.org>`.
([full text](bugreport.cgi?bug=225692;msg=89), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=89), [link](#88)).

---

[Message #90](#90) received at 225692@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=90), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=90), reply):

![](/cgi-bin/libravatar.cgi?email=jfs%40computer.org)
From: Javier Fernández-Sanguino Peña <jfs@computer.org>
To: Scott James Remnant <scott@netsplit.com>
Cc: 225692@bugs.debian.org
Subject: Re: (Bug 225692) The patch provided is just like the one I provided (!?)
Date: Sat, 28 Feb 2004 16:08:37 +0100
```
[[Message part 1](bugreport.cgi?att=0;bug=225692;msg=90) (text/plain, inline)]
```
```
On Fri, Feb 27, 2004 at 11:02:08PM +0000, Scott James Remnant wrote:
> > Is there any reason why my comments (and the debug line I added) have been
> > removed from the patch?
> >
> A ~60 line comment in the middle of a ~1,000 line function isn't really
> a great place to put that kind of thing.  What the code does is fairly
> obvious, and why it does it is documented in the ChangeLog entry for the
> patch.

Ok. But you didn't move my comments to the Changelog entry either.

> I dislike, in general, long-winded discussions of code in the middle of
> functions.  Various articles and papers are interesting to the security
> expert, but not to the maintainer of the code.

Of course, you are entitled to your own opinion. In any case, you dropped
what I believe is a good source of information on _why_ was the change
introduced.

> The *right* place for such discussions, and provision of relevant papers
> and articles is the bug tracking system.  The change to the code is then
> accompanied by a reference to the bug number (in debian/changelog) for
> the interested reader.

I disagree. Software developers do not necessarily need to go to the BTS,
they use the documentation provided in the package or the source code
itself.

> So whilst the full history of a bug/change, who first noticed it,
> suggested it and/or found it, etc. etc. are all interesting -- the BTS
> is what keeps that information, not comments above every single block of
> code in the source.

It's important enough to give credit where credit is due, and you have
neglected that. Giving credit (to Brian Hatch for example) encourages
positive feedback. If you disliked the comment in the source code, you
could have moved it to the Changelog entry, if you did not find that was
the place either you could have updated dpkg's documentation that describes
_how_ it is supposed to behave.

Even if it was a fix for a security issue, It's worth documenting it
further, "stashing away" is not a good enough description. As far as I see
from your NMU this was the only bug which was a significant change in
dpkg's behaviour, I don't believe any other programs rely on this, but
documenting more why it's being introduced would be of benefit both to
casual observers of the Changelog and to other package manager's software
developers.

Just my 2c.

Regards

Javier

```
```
[[signature.asc](bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=90) (application/pgp-signature, inline)]
```

---

**Reply sent** to `Scott James Remnant <scott@netsplit.com>`:

You have taken responsibility.
([full text](bugreport.cgi?bug=225692;msg=92), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=92), [link](#91)).

---

**Notification sent** to `Erno Kuusela <erno-debbugs@erno.iki.fi>`:

Bug acknowledged by developer.
([full text](bugreport.cgi?bug=225692;msg=94), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=94), [link](#93)).

---

[Message #95](#95) received at 225692-close@bugs.debian.org ([full text](bugreport.cgi?bug=225692;msg=95), [mbox](bugreport.cgi?bug=225692;mbox=yes;msg=95), reply):

![](/cgi-bin/libravatar.cgi?email=scott%40netsplit.com)
From: Scott James Remnant <scott@netsplit.com>
To: 225692-close@bugs.debian.org
Subject: Bug#225692: fixed in dpkg 1.10.19
Date: Mon, 08 Mar 2004 14:47:04 -0500
```
Source: dpkg
Source-Version: 1.10.19

We believe that the bug you reported is fixed in the latest version of
dpkg, which is due to be installed in the Debian FTP archive:

dpkg-dev_1.10.19_all.deb
  to pool/main/d/dpkg/dpkg-dev_1.10.19_all.deb
dpkg-doc_1.10.19_all.deb
  to pool/main/d/dpkg/dpkg-doc_1.10.19_all.deb
dpkg_1.10.19.dsc
  to pool/main/d/dpkg/dpkg_1.10.19.dsc
dpkg_1.10.19.tar.gz
  to pool/main/d/dpkg/dpkg_1.10.19.tar.gz
dpkg_1.10.19_i386.deb
  to pool/main/d/dpkg/dpkg_1.10.19_i386.deb
dselect_1.10.19_i386.deb
  to pool/main/d/dpkg/dselect_1.10.19_i386.deb

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 225692@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Scott James Remnant <scott@netsplit.com> (supplier of updated dpkg package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@debian.org)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Format: 1.7
Date: Mon,  8 Mar 2004 19:05:32 +0000
Source: dpkg
Binary: dpkg-doc dpkg dselect dpkg-dev dpkg-static
Architecture: source all i386
Version: 1.10.19
Distribution: unstable
Urgency: high
Maintainer: Dpkg Development <debian-dpkg@lists.debian.org>
Changed-By: Scott James Remnant <scott@netsplit.com>
Description:
 dpkg       - Package maintenance system for Debian
 dpkg-dev   - Package building tools for Debian
 dpkg-doc   - Dpkg Internals Documentation
 dselect    - a user tool to manage Debian packages
Closes: [139781](bugreport.cgi?bug=139781) [157437](bugreport.cgi?bug=157437) [168443](bugreport.cgi?bug=168443) [170953](bugreport.cgi?bug=170953) [190611](bugreport.cgi?bug=190611) [199489](bugreport.cgi?bug=199489) [199693](bugreport.cgi?bug=199693) [211566](bugreport.cgi?bug=211566) [213038](bugreport.cgi?bug=213038) [213543](bugreport.cgi?bug=213543) [213846](bugreport.cgi?bug=213846) [217286](bugreport.cgi?bug=217286) [217943](bugreport.cgi?bug=217943) [221989](bugreport.cgi?bug=221989) [222760](bugreport.cgi?bug=222760) [225692](bugreport.cgi?bug=225692) [228253](bugreport.cgi?bug=228253) [228379](bugreport.cgi?bug=228379) [232025](bugreport.cgi?bug=232025) [232916](bugreport.cgi?bug=232916) [235266](bugreport.cgi?bug=235266)
Changes:
 dpkg (1.10.19) unstable; urgency=high
 .
   * Distinguish unmet build dependencies from build conflicts.
     Closes: #[217943](bugreport.cgi?bug=217943), #[235266](bugreport.cgi?bug=235266).
   * Force NULL-termination of all tar file entry names.  Closes: #[232025](bugreport.cgi?bug=232025).
   * Allow dselect to use the full window width.  Closes: #[139781](bugreport.cgi?bug=139781).
   * Pass correct number of arguments for format string when out of disk
     space.  Closes: #[213038](bugreport.cgi?bug=213038), #[217286](bugreport.cgi?bug=217286), #[213543](bugreport.cgi?bug=213543), #[213846](bugreport.cgi?bug=213846).
   * Remove duplicated entries from ChangeLog.  Closes: #[157437](bugreport.cgi?bug=157437).
   * Fix dpkg-buildpackage when used with PGP.  Closes: #[232916](bugreport.cgi?bug=232916).
   * Update support for Debian FreeBSD.  Closes: #[211566](bugreport.cgi?bug=211566).
   * Store Architecture in the status file.  Closes: #[228253](bugreport.cgi?bug=228253).
   * Don't print offending lines in md5sum.  Closes: #[170953](bugreport.cgi?bug=170953).
   * Check bounds of md5sum lines.  Closes: #[168443](bugreport.cgi?bug=168443), #[199489](bugreport.cgi?bug=199489), #[199693](bugreport.cgi?bug=199693).
 .
 dpkg (1.10.18.1) unstable; urgency=medium
 .
   * Non-maintainer upload to fix release-critical bugs.
   * Terminate string buffer in main/remove.c.  Closes: #[228379](bugreport.cgi?bug=228379).
   * Prevent stashing of hardlinked devices and setuid or setgid binaries
     by removing permissions on upgrade as well as on remove.
     Closes: #[225692](bugreport.cgi?bug=225692).
   * Update dpkg conflicts to << 1.10, instead of 1.9.
     Closes: #[190611](bugreport.cgi?bug=190611), #[221989](bugreport.cgi?bug=221989), #[222760](bugreport.cgi?bug=222760).
Files:
 5a4c39cb6903694ec7ff0ebcd5afc33d 798 base required dpkg_1.10.19.dsc
 a735a1f14cc985ad083b46bce425001b 1547265 base required dpkg_1.10.19.tar.gz
 86386707c685a60c4132def2494b3657 1086080 base required dpkg_1.10.19_i386.deb
 5bf8ab50684b58b8619f2c7d982ac47f 95024 base required dselect_1.10.19_i386.deb
 088fe395e33835351e2ccdc3f8122a31 114618 utils standard dpkg-dev_1.10.19_all.deb
 294b7c2bf86172671a91b050c6db8a1a 10636 doc optional dpkg-doc_1.10.19_all.deb

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFATMchIexP3IStZ2wRAoQRAJ0Q5CxELST85r5oNEY3nnZE6TB/mgCggxyX
0sfA6HaAPzloTBPKab+L3nw=
=R85a
-----END PGP SIGNATURE-----

```

---

Send a report that [this bug log contains spam](https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=225692).

---

Debian bug tracking system administrator <owner@bugs.debian.org>.
Last modified:
Fri Jan 24 18:19:23 2025;
Machine Name:
buxtehude

[Debian Bug tracking system](https://www.debian.org/Bugs/)

Debbugs is free software and licensed under the terms of the GNU General
Public License version 2. The current version can be obtained
from <https://bugs.debian.org/debbugs-source/>.

Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.



=== Content from www.hackinglinuxexposed.com_9568d5ef_20250124_181921.html ===


|  |
| --- |

| [Hacking Linux Exposed](..)    [About](../about/)[Authors](../authors/)[Contents](../contents/)[Reviews](../reviews/)[Foreword](../foreword/)[Purchase](../purchase/) [Articles](../articles/)[Books](../books/)[Sourcecode](../sourcecode/)[Tools](../tools/)[Errata](../errata/) [Home](/) |  | [previous article](20031204.html)[index](./)[next article](20031231.html)**The mysteriously persistently exploitable program explained.**By Bri Hatch. **Summary:** */bin/rm doesn't mean remove, it means unlink, and it has security repercussions.* In a previous article[[1]](#footnote-1) I described a machine compromise that initially would seemed to have been impossible. A vulnerable suid root program, `/usr/sbin/buggy`, was upgraded to a non vulnerable version, and yet crackers still were exploiting it. In fact, even after the program was removed entirely, it was still being exploited. So, how can it be that a program can be accessed even after it's been removed? The problem is that it wasn't removed. When we access a file on disk, we do so by providing a filename for it. The filesystem uses filenames, which are simply entries in directories, to look up the file's inode. An inode is a uniq numeric identifier, essentially a file number, which identifies the file on that filesystem. You can see the inode with the `-i` option to `ls`: ```  $ ls -il /bin/cat 32689 -rwxr-xr-x   1 root   root  13912 Sep 17 06:54 /bin/cat  ```  That first number in the second line is the inode number, here `32689`. Note also the third field in the line, '1'. That's the link count, the number of directory references to the file. Now, compare `/bin/cat` to, say, `/bin/gzip`: ```  $ ls -il /bin/gzip 32755 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/gzip  ```  Note that link count of 4 in this case. How can we find the other filenames that point to this same file? First, let's determine which filesystem `/bin` lives on, and then use find: ```  $ cd /bin  $ df . Filesystem          1K-blocks     Used Available Use% Mounted on /dev/hda5            10766920  8325216    1894740  82% /  $ find / -inum 32755 -xdev -ls 2>/dev/null   32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/gzip  32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/gunzip  32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/zcat  32755   56 -rwxr-xr-x   4 root   root  13912 Apr 19 04:43 /bin/uncompress  ```  Here we can see that the four files, `/bin/gzip`, `/bin/gunzip`, `/bin/zcat`, and `/bin/uncompress` are four different filenames, pointing to the same actual file on disk, inode number `32755`.[[2]](#footnote-2) We call these hard links -- when a file on disk is available via separate filenames. Compare these to symlinks/softlinks, which are separate files that point to a filename, rather than an inode: ```  $ ls -il /bin/nc /bin/netcat 32502 -rwxr-xr-x   1 root   root  19352 Oct 13 15:20 /bin/nc 51222 lrwxrwxrwx   1 root   root      2 Oct 13 15:20 /bin/netcat -> nc  ```  Now anyone can make a hard link or symlink, assuming they have write permission to a directory. While symlinks can cross filesystem boundaries (they point to file names, not inodes) a hard link can only be created on the filesystem where the target file resides. Thus to create a hard link to `/usr/sbin/buggy`, the attacker needed to have write access to some directory that was on the same filesystem as `/usr/sbin/buggy`. Unfortunately, this machine was created with one big huge root (`/`) filesystem, which contained all the directories, including `/tmp` and `/home`. So what happened? The attacker created a link to `/usr/sbin/buggy` long before anyone knew it had a vulnerability: ```  attacker$ cd $HOME attacker$ ls -il /usr/sbin/buggy 18824 -rwsr-xr-x   1 root   root  19352 Feb  5 08:12 /usr/sbin/buggy  attacker$ ln /usr/sbin/buggy mybuggy.hardlink attacker$ ls -il /usr/sbin/buggy mybuggy.hardlink 18824 -rwsr-xr-x   2 root   root  19352 Feb  5 08:12 /usr/sbin/buggy 18824 -rwsr-xr-x   2 root   root  19352 Feb  5 08:12 mybuggy.hardlink  ```  Note how the link count has changed to 2 now -- this file on disk is now referenced by two filenames. Later on, when the bug in `/usr/sbin/buggy` came to light, the administrators upgraded the package. The upgrade automatically deleted the old `/usr/sbin/buggy` and then copied the new one from the binary package into `/usr/sbin`. But when the upgrade deleted `/usr/sbin/buggy`, the kernel merely decremented the link count (from 2 to 1) of that inode, and didn't actually free up the disk space, because the file was still referenced by a different filename on the filesystem. The original program still existed on disk, with the original suid permissions. ```  attacker$ ls -il /usr/sbin/buggy mybuggy.hardlink 45110 -rwsr-xr-x   1 root   root  17889 Nov 29 12:13 /usr/sbin/buggy 18824 -rwsr-xr-x   1 root   root  19352 Feb  5 08:12 mybuggy.hardlink  ```  That first file is the new, non-vulnerable `/usr/sbin/buggy` program. The second is the old version, which the attacker had linked, and is still hanging around, and which he used to gain root access periodically.[[3]](#footnote-3) So, how should the administrators have known that this link was still hanging around? There are several precautions that would have indicated or prevented the problematic situation: * Many file integrity tools include link count as one of the   attributes that they watch for. These would have noticed the   link count go up by one, and they could have gone searching for the   new link. * If they ran suid program scanners, they would have picked up     this 'new' suid program. * If they'd put user-accessible directories on separate partitions,       then the attacker would not have been able to create a hardlink in       the first place. I prefer at a minimum to have `/tmp`,       `/var/tmp` and `/home` on separate partitions       for this reason. It's always best to have separate partitions for       system use vs user use.   Several readers had other ideas of how this could have been caused. I'll cover some of them in following articles, as they are all interesting. Congrats go to Jim Richardson of Seattle, WA for solving the contest, thus winning a signed copy of Hacking Linux Exposed Second Edition. NOTES: [[1]](#footback-1) See <http://www.hackinglinuxexposed.com/articles/20031111.html>. [[2]](#footback-2) `-xdev` was used to make sure we didn't look for files with inode number `32755` on other filesystems, such as `/home` for example. An inode is uniq on a filesystem, not across separate filesystems. [[3]](#footback-3) Yeah, it would have made much more sense for the attacker to put other backdoors into the system. I'm just concentrating on this one hole because anything else would be extraneous. ---   Bri Hatch is Chief Hacker at [Onsight, Inc](http://www.onsight.com/) and author of ***Hacking Linux Exposed*** and [Building Linux VPNs](http://www.buildinglinuxvpns.net/). He was pleasantly surprised that the contest winner was a fellow Seattlite. Besides, then he was able to save money on postage. Bri can be reached at bri@hackinglinuxexposed.com. ---   Copyright Bri Hatch, 2003 ---   This is the December 14, 2003 issue of the *Linux Security: Tips, Tricks, and Hackery* newsletter. If you wish to subscribe, visit [http://lists.onsight.com/](http://lists.onsight.com) or send email to Linux\_Security-request@lists.onsight.com.[previous article](20031204.html)[index[next article](20031231.html)](./) |  |  |
| --- | --- | --- | --- | --- |


