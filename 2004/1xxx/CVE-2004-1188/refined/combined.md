=== Content from www.mplayerhq.hu_50a636b1_20250125_224608.html ===
--- MPlayer-1.0pre5/libmpdemux/pnm.c 2003-10-04 19:29:01.000000000 +0200
+++ MPlayer-1.0pre5try2/libmpdemux/pnm.c 2004-12-15 21:37:11.000000000 +0100
@@ -307,9 +307,12 @@
char \*data, int \*need\_response) {
unsigned int chunk\_size;
- int n;
+ unsigned int n;
char \*ptr;
+ if (max < PREAMBLE\_SIZE)
+ return -1;
+
/\* get first PREAMBLE\_SIZE bytes and ignore checksum \*/
rm\_read (p->s, data, CHECKSUM\_SIZE);
if (data[0] == 0x72)
@@ -317,6 +320,8 @@
else
rm\_read (p->s, data+CHECKSUM\_SIZE, PREAMBLE\_SIZE-CHECKSUM\_SIZE);
+ max -= PREAMBLE\_SIZE;
+
\*chunk\_type = BE\_32(data);
chunk\_size = BE\_32(data+4);
@@ -324,18 +329,30 @@
case PNA\_TAG:
\*need\_response=0;
ptr=data+PREAMBLE\_SIZE;
+ if (max < 1)
+ return -1;
rm\_read (p->s, ptr++, 1);
+ max -= 1;
while(1) {
/\* expecting following chunk format: 0x4f   \*/
+ if (max < 2)
+ return -1;
rm\_read (p->s, ptr, 2);
+ max -= 2;
if (\*ptr == 'X') /\* checking for server message \*/
{
printf("input\_pnm: got a message from server:\n");
+ if (max < 1)
+ return -1;
rm\_read (p->s, ptr+2, 1);
+ max = -1;
n=BE\_16(ptr+1);
+ if (max < n)
+ return -1;
rm\_read (p->s, ptr+3, n);
+ max -= n;
ptr[3+n]=0;
printf("%s\n",ptr+3);
return -1;
@@ -354,10 +371,15 @@
}
if (\*ptr != 0x4f) break;
n=ptr[1];
+ if (max < n)
+ return -1;
rm\_read (p->s, ptr+2, n);
+ max -= n;
ptr+=(n+2);
}
/\* the checksum of the next chunk is ignored here \*/
+ if (max < 1)
+ return -1;
rm\_read (p->s, ptr+2, 1);
ptr+=3;
chunk\_size=ptr-data;
@@ -367,10 +389,12 @@
case PROP\_TAG:
case MDPR\_TAG:
case CONT\_TAG:
- if (chunk\_size > max) {
+ if (chunk\_size > max || chunk\_size < PREAMBLE\_SIZE) {
printf("error: max chunk size exeeded (max was 0x%04x)\n", max);
+#ifdef LOG
n=rm\_read (p->s, &data[PREAMBLE\_SIZE], 0x100 - PREAMBLE\_SIZE);
hexdump(data,n+PREAMBLE\_SIZE);
+#endif
return -1;
}
rm\_read (p->s, &data[PREAMBLE\_SIZE], chunk\_size-PREAMBLE\_SIZE);


=== Content from www.mandriva.com_975da518_20250125_224607.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us


