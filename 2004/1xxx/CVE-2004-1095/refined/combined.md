=== Content from www.gentoo.org_235cf38c_20250125_173317.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# zgv: Multiple buffer overflows — GLSA **200411-12**

zgv contains multiple buffer overflows that can potentially lead to the
execution of arbitrary code.

### Affected packages

| Package | **media-gfx/zgv** on all architectures |
| --- | --- |
| Affected versions | < **5.8** |
| Unaffected versions | >= **5.8** |

### Background

zgv is a console image viewer based on svgalib.

### Description

Multiple arithmetic overflows have been detected in the image
processing code of zgv.

### Impact

An attacker could entice a user to open a specially-crafted image file,
potentially resulting in execution of arbitrary code with the rights of
the user running zgv.

### Workaround

There is no known workaround at this time.

### Resolution

All zgv users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=media-gfx/zgv-5.8"
```
### References

* [BugTraq Advisory](http://www.securityfocus.com/archive/1/379472)
* [CVE-2004-1095](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-1095)

**Release date**

November 07, 2004

**Latest revision**

May 22, 2006: 02

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [69150](https://bugs.gentoo.org/show_bug.cgi?id=69150)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from marc.info_a5dfd6aa_20250125_173316.html ===

```
[[prev in list](?l=bugtraq&m=109885074513940&w=2)] [[next in list](?l=bugtraq&m=109886945528588&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=109898111915661&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [zgv image viewing heap overflows](?t=109886227700002&r=1&w=2)
From:       [infamous41md () hotpop ! com](?a=108761245000001&r=1&w=2)
Date:       [2004-10-26 1:07:17](?l=bugtraq&r=1&w=2&b=200410)
Message-ID: [20041025210717.2799d9c1.infamous41md () hotpop ! com](?i=20041025210717.2799d9c1.infamous41md%20()%20hotpop%20!%20com)
[Download RAW [message](?l=bugtraq&m=109886210702781&q=mbox) or [body](?l=bugtraq&m=109886210702781&q=raw)]

++++++++++++++++++++++++++++++++++++++++++++

Subject:

zgv multiple heap overflows

++++++++++++++++++++++++++++++++++++++++++++

Product:

zgv is a picture viewer with a thumbnail-based file selector, for the Linux and
FreeBSD console (it uses svgalib). It's pretty featureful, and is probably the
best svgalib-based viewer. (It can also be built to use SDL if you prefer.) Lots
of people have told me they like it, where "lots" = "oh, it must be at least two
or three", and you can't ask for a more ringing endorsement than that. Well, you
could, but I'm not sure you'd get it. :-)

zgv supports most popular formats, and allows panning and fit-to-screen methods
of viewing, slideshows, scaling, gamma adjustment, etc.

<http://www.svgalib.org/rus/zgv/>

++++++++++++++++++++++++++++++++++++++++++++

Vulnerable:

I tested latest, zgv-5.5.orig.

++++++++++++++++++++++++++++++++++++++++++++

Summary:

zgv uses malloc() frequently to allocate memory for storing image data.  When
calculating how much to allocate, user supplied data from image headers is
multiplied and/or added without any checks for arithmetic overflows.  We can
overflow numerous calculations, and cause small buffers to be allocated.  Then
we can overflow the buffer, and eventually execute code.  There are a total of
11 overflows that are exploitable to execute arbitrary code.

++++++++++++++++++++++++++++++++++++++++++++

Details:

01]readbmp.c:180:  if ((work_bmap = *bmap =
                            calloc (w * (h + 2) * bytepp,1)) == NULL)

02]readgif.c:498:  if((im->image=(byte *)malloc(width*height))==NULL)

03]readgif.c:606:if((*theimageptr=
                        (byte *)malloc(ginfo->width*ginfo->height))==NULL)

04]readmrf.c:107:   (image=calloc(w64*h64*64*64,1))==NULL)

05]readpcx.c:130:if((*bmap=malloc(w*(h+2)*bytepp))==NULL)

06]readpng.c:225:theimage=(byte *)malloc(pixelsize*width*(height+2));

07]readpnm.c:147:if((*bmap=malloc(w*(h+2)*bytepp))==NULL)

08]readprf.c:205:if((*bmap=work_bmap=malloc(width*(height+2)*planes))==NULL)

09]readtiff.c:89:if((image=*bmap=work_bmap=
                        malloc(numpix*sizeof(uint32)+width*3*2))==NULL)

10]readxpm.c:183:if((colchars=malloc(ncols*sizeof(struct colchars_tag)))==NULL)

11]readxpm.c:372:if((*bmap=malloc(w*(h+2)*bytepp))==NULL)

++++++++++++++++++++++++++++++++++++++++++++

Exploits:

There is a C file for each hole above.  The exploit for the first xpm hole,
#10, demonstrates code execution,  the rest just crash zgv.  The only one I
couldn't get working is the second gif hole, #3 from above.  That is in the
file ximage_other_gif.c.  However, all are suitable for code execution with
some work.  I just didn't have the time.

++++++++++++++++++++++++++++++++++++++++++++

Note:

There was also a hole in:

01]readpcd.c:42:if((*bmap=malloc(w*(h+3-*output_type)*(*output_type)))==NULL)

I couldn't find the PCD file format anywhere for free on the web, and didn't
pursue this further.  I didn't see anything that would make it not exploitable
though, so it looks valid to me.

++++++++++++++++++++++++++++++++++++++++++++

Vendor:

Was not contacted.

++++++++++++++++++++++++++++++++++++++++++++

--
-sean

[["ximage_zgv.tar.gz" (application/octet-stream)]](?l=bugtraq&m=109886210702781&q=p3)

[[prev in list](?l=bugtraq&m=109885074513940&w=2)] [[next in list](?l=bugtraq&m=109886945528588&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=109898111915661&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from bugs.gentoo.org_7d8e399f_20250126_103919.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 69
test for tutorial
Last modified: 2003-02-04 19:42:18 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=69&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=69&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 69**](show_bug.cgi?id=69)
- test for tutorial

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
test for tutorial

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED INVALID | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Linux | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Linux "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | New packages ([show other bugs](buglist.cgi?component=New%20packages&product=Gentoo%20Linux&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | x86 Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Mikael Hallendal (hallski) (RETIRED) | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2002-01-07 11:57 UTC by Matt Butcher | | --- | --- | | Modified: | 2003-02-04 19:42 UTC ([History](show_activity.cgi?id=69)) | | CC List: | 1 user (show)  mbutcher | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=69&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=69&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Matt Butcher    2002-01-07 11:57:21 UTC  ``` If this gets submitted, I'm very sorry. Please delete. ```  [Comment 1](#c1)  Grant Goodyear (RETIRED)   gentoo-dev  2002-01-07 12:09:52 UTC  ``` It was a test message.  Deleting.  ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=69)
* - [XML](show_bug.cgi?ctype=xml&id=69)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=69)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=69&product=Gentoo%20Linux)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=69&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=69&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from www.svgalib.org_c61c7d8d_20250125_173318.html ===
diff -urN zgv-5.8/ChangeLog zgv/ChangeLog
--- zgv-5.8/ChangeLog Mon Mar 29 05:34:03 2004
+++ zgv/ChangeLog Sun Oct 31 15:23:27 2004
@@ -1,3 +1,27 @@
+2004-10-31 Russell Marks
+
+ \* Added width/height limits to all picture readers, 32767x32767 is
+ now the maximum image size supported (consistent with xzgv). This
+ is a crude (albeit effective) fix for heap overflow bugs - there
+ may yet be more subtle problems, but I can't really fix them until
+ I know they're there. :-) Thanks to Luke Macken for letting me
+ know about the heap overflow problems. I suppose I should also
+ thank "infamous41md" for publishing the original exploit (for the
+ XPM colours bug), even if he didn't bother emailing me or
+ anything.
+
+ \* src/readxpm.c (read\_xpm\_file): fix for exploitable malloc() arg
+ overflow. There are several more of these in zgv, but this is the
+ easiest to fix.
+
+2004-07-08 Russell Marks
+
+ \* src/readgif.c (read\_gif\_file): added more multiple-image (e.g.
+ animated) GIF brokenness checks than before. Previously it was
+ possible to get a segfault with the `right' file, despite there
+ already being various range checks. Thanks to Mikulas Patocka for
+ spotting this.
+
2004-03-29 Russell Marks
\* Version 5.8.
diff -urN zgv-5.8/src/readbmp.c zgv/src/readbmp.c
--- zgv-5.8/src/readbmp.c Thu Oct 4 16:48:36 2001
+++ zgv/src/readbmp.c Sun Oct 31 14:32:44 2004
@@ -177,7 +177,8 @@
bytepp=1;
if ((pp->bpp == 24) && (\*output\_type == 3))
bytepp = 3;
- if ((work\_bmap = \*bmap = calloc (w \* (h + 2) \* bytepp,1)) == NULL)
+ if (WH\_BAD(w,h) ||
+ (work\_bmap = \*bmap = calloc (w \* (h + 2) \* bytepp,1)) == NULL)
CLOSE\_AND\_RET(\_PICERR\_NOMEM);
bytes\_in\_image=w\*h\*bytepp;
diff -urN zgv-5.8/src/readgif.c zgv/src/readgif.c
--- zgv-5.8/src/readgif.c Sat Mar 15 02:39:42 2003
+++ zgv/src/readgif.c Sun Oct 31 14:31:48 2004
@@ -491,7 +491,7 @@
readcolmap(in,im->cmap,lnumcols);
}
- if((im->image=(byte \*)malloc(width\*height))==NULL)
+ if(WH\_BAD(width,height) || (im->image=(byte \*)malloc(width\*height))==NULL)
{
fclose(in);
return(\_PICERR\_NOMEM);
@@ -599,7 +599,8 @@
/\* allocate main image and palette \*/
-if((\*theimageptr=(byte \*)malloc(ginfo->width\*ginfo->height))==NULL)
+if(WH\_BAD(ginfo->width,ginfo->height) ||
+ (\*theimageptr=(byte \*)malloc(ginfo->width\*ginfo->height))==NULL)
{
images\_cleanup();
return(\_PICERR\_NOMEM);
@@ -668,7 +669,11 @@
for(i=0;iwidth>swidth) images[i]->width=swidth;
+ if(images[i]->height>sheight) images[i]->height=sheight;
/\* for images after the first, we need to set the initial contents
\* (as far as GIF is concerned, the `screen' contents) as directed
@@ -708,20 +713,28 @@
\*/
}
}
-
- ptr1=ptr+images[i]->left+images[i]->top\*swidth;
- ptr2=images[i]->image;
-
- for(y=0;yheight;y++)
+
+ /\* an image with left or top offscreen is broken, but relying
+ \* unknowingly on the image not appearing at all. So skip it.
+ \*/
+ if(images[i]->lefttopwidth;x++)
- if(!(images[i]->gcb\_control&1) || /\* if no transparent col defined \*/
- images[i]->transparent\_col!=\*ptr2)
- \*ptr1++=\*ptr2++;
- else
- ptr1++,ptr2++;
+ ptr1=ptr+images[i]->left+images[i]->top\*swidth;
- ptr1+=swidth-images[i]->width;
+ for(y=0;yheight && images[i]->top+yimage+y\*images[i]->width;
+
+ for(x=0;xwidth && images[i]->left+xgcb\_control&1) || /\* if no transparent col defined \*/
+ images[i]->transparent\_col!=\*ptr2)
+ \*ptr1++=\*ptr2++;
+ else
+ ptr1++,ptr2++;
+
+ ptr1=oldptr1+swidth;
+ }
}
ptr+=swidth\*sheight;
diff -urN zgv-5.8/src/readjpeg.c zgv/src/readjpeg.c
--- zgv-5.8/src/readjpeg.c Wed Sep 27 17:28:30 2000
+++ zgv/src/readjpeg.c Sun Oct 31 14:54:26 2004
@@ -190,10 +190,10 @@
height=cinfo.output\_height;
}
-theimage=(byte \*)malloc(pixelsize\*width\*height);
-if(theimage==NULL)
+if(WH\_BAD(width,height) ||
+ (theimage=(byte \*)malloc(pixelsize\*width\*height))==NULL)
{
- jpegerr("Out of memory");
+ jpegerr("Out of memory"); /\* XXX misleading if width/height are bad \*/
longjmp(jerr.setjmp\_buffer,1);
}
diff -urN zgv-5.8/src/readmrf.c zgv/src/readmrf.c
--- zgv-5.8/src/readmrf.c Wed Oct 21 07:28:23 1998
+++ zgv/src/readmrf.c Sun Oct 31 14:56:33 2004
@@ -103,7 +103,8 @@
w64=(w+63)/64;
h64=(h+63)/64;
-if((\*bmap=malloc(w\*h))==NULL ||
+if(WH\_BAD(w64\*64,h64\*64) || WH\_BAD(w,h) ||
+ (\*bmap=malloc(w\*h))==NULL ||
(image=calloc(w64\*h64\*64\*64,1))==NULL)
CLOSE\_AND\_RET(\_PICERR\_NOMEM);
diff -urN zgv-5.8/src/readpcd.c zgv/src/readpcd.c
--- zgv-5.8/src/readpcd.c Thu Sep 30 01:56:59 1999
+++ zgv/src/readpcd.c Sun Oct 31 14:57:37 2004
@@ -39,7 +39,7 @@
if((\*output\_type)!=1)\*output\_type=3;
-if((\*bmap=malloc(w\*(h+3-\*output\_type)\*(\*output\_type)))==NULL)
+if(WH\_BAD(w,h) || (\*bmap=malloc(w\*(h+3-\*output\_type)\*(\*output\_type)))==NULL)
return(\_PICERR\_NOMEM);
if((\*pal=malloc(768))==NULL)
diff -urN zgv-5.8/src/readpcx.c zgv/src/readpcx.c
--- zgv-5.8/src/readpcx.c Wed Mar 31 00:11:36 1999
+++ zgv/src/readpcx.c Sun Oct 31 14:59:30 2004
@@ -127,7 +127,7 @@
bytemax=(1<<30); /\* we use a 'y(1<<24) || (colchars=malloc(ncols\*sizeof(struct colchars\_tag)))==NULL)
CLOSE\_AND\_RET(\_PICERR\_NOMEM);
@@ -369,7 +369,7 @@
\*/
/\* extra lines are in case we're dithering. \*/
-if((\*bmap=malloc(w\*(h+2)\*bytepp))==NULL)
+if(WH\_BAD(w,h) || (\*bmap=malloc(w\*(h+2)\*bytepp))==NULL)
CLOSE\_AND\_RET(\_PICERR\_NOMEM);
ptr=\*bmap;
diff -urN zgv-5.8/src/zgv.h zgv/src/zgv.h
--- zgv-5.8/src/zgv.h Sat Feb 21 16:31:29 2004
+++ zgv/src/zgv.h Sun Oct 31 14:58:34 2004
@@ -66,3 +66,12 @@
/\* make 15/16-bit colours, used in a few different places \*/
#define GET15BITCOLOUR(r,g,b) ((((r)&0xf8)<<7)|(((g)&0xf8)<<2)|((b)>>3))
#define GET16BITCOLOUR(r,g,b) ((((r)&0xf8)<<8)|(((g)&0xfc)<<3)|((b)>>3))
+
+/\* range check on width and height as a crude way of avoiding overflows
+ \* when calling malloc/calloc. The maximum we can allow is around 37000,
+ \* but 32767 at least makes it consistent with xzgv. :-)
+ \* Adds an extra 2 to height for max-height check, as we usually allocate
+ \* 2 more lines to allow for dithering.
+ \*/
+#define WH\_MAX 32767
+#define WH\_BAD(w,h) ((w)<=0 || (w)>WH\_MAX || (h)<=0 || ((h)+2)>WH\_MAX)


=== Content from marc.info_e74f94ed_20250125_173317.html ===

```
[[prev in list](?l=bugtraq&m=109898080902641&w=2)] [[next in list](?l=bugtraq&m=109897890612340&w=2)] [[prev in thread](?l=bugtraq&m=109886210702781&w=2)] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Re: zgv image viewing heap overflows](?t=109886227700002&r=1&w=2)
From:       [Chris Frey <cdfrey () netdirect ! ca>](?a=93294417200014&r=1&w=2)
Date:       [2004-10-28 3:39:07](?l=bugtraq&r=1&w=2&b=200410)
Message-ID: [20041027233907.A3678 () netdirect ! ca](?i=20041027233907.A3678%20()%20netdirect%20!%20ca)
[Download RAW [message](?l=bugtraq&m=109898111915661&q=mbox) or [body](?l=bugtraq&m=109898111915661&q=raw)]

On Mon, Oct 25, 2004 at 09:07:17PM -0400, infamous41md@hotpop.com wrote:
> 06]readpng.c:225:theimage=(byte *)malloc(pixelsize*width*(height+2));

Similar bugs appear to be in the X version as well.  The one I have
on my system is xzgv-0.7.  Homepage: <http://rus.members.beeb.net/xzgv.html>

- Chris

[[prev in list](?l=bugtraq&m=109898080902641&w=2)] [[next in list](?l=bugtraq&m=109897890612340&w=2)] [[prev in thread](?l=bugtraq&m=109886210702781&w=2)] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from www.svgalib.org_62150d6a_20250125_173318.html ===


[Description](#desc)
|
[Download](#download)
|
[Changes](#changes)
|
[Svgalib home](/)

# zgv

![(zgv screenshot)](zgv.gif)

## Description

zgv is a picture viewer with a thumbnail-based file selector, for the
Linux and FreeBSD console (it uses
[svgalib](http://www.svgalib.org/)). It's pretty
featureful, and is probably the best svgalib-based viewer. (It can
also be built to use SDL if you prefer.) Lots of people have told me
they like it, where "lots" = "oh, it must be at least two or three",
and you can't ask for a more ringing endorsement than that. Well, you
could, but I'm not sure you'd get it. :-)

zgv supports most popular formats, and allows panning and
fit-to-screen methods of viewing, slideshows, scaling, gamma
adjustment, etc.

If you prefer to use X, you may want to check out
[xzgv](http://rus.members.beeb.net/xzgv.html).

---

## Download

The current version is 5.9, here as
<zgv-5.9.tar.gz>. It's also available from
ibiblio.

**WARNING:** There is a known vulnerability in zgv 5.8
(and all previous versions) such that suitably-constructed images can
be made to run arbitrary commands when viewed with zgv - not as root,
but as the user running zgv. This still has the potential to cause
serious trouble, so I strongly recommend that existing users upgrade
to the current version.

---

## Changes

This excerpt from NEWS lists the changes from zgv 5.4 onwards.
### Changes in zgv 5.9

#### New features

Added SDL mouse support. Thanks to Dimitar Zhekov for this.

#### Bugfixes

Added width/height limits to all picture readers, 32767x32765 is now
the maximum image size supported (essentially consistent with xzgv).
This is a crude (albeit effective) fix for several reported overflow
bugs, which had previously meant that zgv could be exploited to run
commands as the user when viewing a maliciously-formatted file. Thanks
to Luke Macken for letting me know about the problems. I suppose I
should also thank "infamous41md" for publishing the original
advisory/exploit, even if he didn't bother emailing me or anything.

Added more multiple-image GIF brokenness checks than before.
Previously it was possible to get a segfault with the `right' file,
despite there already being various range checks. Thanks to Mikulas
Patocka for spotting this.

Fixed a problem with freeing memory when a GIF fails to load. Thanks
to Mikulas Patocka for the fix.

Fixed a possible hang when reading GIF files with corrupted extension
blocks. Thanks to Mikulas Patocka for finding this.

Fixed a possible hang when reading corrupted non-raw PBM files.

The SDL backend previously had a timer-related bug which could cause
some odd problems. Thanks to Dimitar Zhekov for spotting this one.

#### Other changes

The `fullscreen' option now defaults to on, so you now have to use
`--fullscreen=off' (or similar config file option) to disable it. This
keeps the SDL backend's behaviour closer to the svgalib one.

### Changes in zgv 5.8

#### New features

Added FreeBSD support, thanks to Radim Kolar for contributing this. Be
sure to read INSTALL in full before building zgv on FreeBSD, there's a
minor problem with it at the moment (nothing too horrible though :-)).

Added support for dithering in 15/16-bit modes. It's slower than I'd
hoped, so it's not enabled by default, but it seems to work well
enough. You can toggle it in the viewer by pressing `F', or add
`dither-hicol on' to a config file. Thanks to Stephane ODUL for
suggesting this.

Added `fullscreen' option, to override possible use of a windowed
display with non-svgalib backends in some situations, the obvious
example being the SDL backend running under X. This isn't necessarily
what you'd want, and has problems like not being able to fill the
screen in modes it doesn't support natively under svgalib. (And SDL
can cause further problems, from what I've seen.)

#### Bugfixes

Fixed long-standing bug with interpolation (fix ported from xzgv). In
xzgv the bug could have caused segfaults, but I don't believe this was
the case in zgv due to the way it allocates memory.

Added SDL getbox routine, fixing one of the display glitches when
using that (dialogs not restoring previous screen contents).

Fixed missing-picture-update bug when doing certain mode changes under
SDL.

The SDL backend will now only ever use SDL's non-native-depth mode
emulation for 8-bit modes. This should improve picture quality when
only 8-bit modes are available, and make all modes other than
24/32-bit quite a bit faster. Thanks to David Matthews for inspiring
this change.

The SDL backend is now a lot more sensible about automatically picking
a file selector mode, and should have a better chance of working when
using a single-mode VESA framebuffer. Thanks to David Matthews for
indirectly spotting this problem.

Added timer start/stop to backend code, so now timer-based stuff (most
notably GIF animation) works ok under SDL.

Fixed colour glitches in dialogs under SDL.

#### Other changes

Finally changed default installation prefix to /usr/local. `make
install' now removes any old version (both program and documentation)
in the old default locations.

Removed embedded LFs from src/bdf2h.c, which were causing compilation
errors with newer versions of gcc. Not strictly a bug - blame the gcc
folks :-), though to be fair there had been plenty of advance warning.
Thanks to Dimitar Zhekov for the patch.

Moved `fake-cols' toggle key from `F' to `G'.

Removed support for a repeat-timer setting of "-1" (i.e. constantly
reload the image), which had been broken previously anyway.

`x' now aborts GIF animation like Esc does. Thanks to Thomas M. Ott
for pointing out the inconsistency. Note that I don't consider
supporting this slightly pointless alternative to Esc to be terribly
important (e.g. dialogs don't support it and never have, and they've
been in zgv since 1993), and couldn't add it everywhere even if I
wanted to (e.g. change-to-arbitrary-directory dialog).

### Changes in zgv 5.7

#### New features

Added support for display backends other than svgalib; currently SDL
is supported. (There are still problems with this - e.g. graphical
glitches with dialog boxes, and broken GIF animation - but it seems to
be mostly working.) Alternative backends are by definition never going
to be \*better\* than native svgalib, but if you somehow can't use
svgalib then at least this gives you a way of running zgv. Note that
you have to compile a separate zgv executable for each backend, and
only the svgalib one is compiled by default.

New `--auto-mode-fit-diff' option, allows you to specify a pixel
width/height to be disregarded when zgv picks a mode to use and
auto-mode-fit is enabled. So e.g. a 330x250 image would be shown in
320x240 mode if auto-mode-fit-diff is 10. Thanks to Dimitar Zhekov for
this.

#### Bugfixes

32-bit modes can now be specified on the command-line (they couldn't
previously). Thanks to "kscott" for spotting this one.

Fixed mouse cursor appearance in 32-bit modes. Thanks to Dimitar
Zhekov for the patch.

No longer sets background colour to black for 1-bit mono PNG files,
where this sometimes caused problems. Thanks to Morten Bo Johansen for
spotting this.

#### Other changes

Restored documentation for `-r', `-s', and `-w' options, which was
mistakenly dropped when I added long-option support.

### Changes in zgv 5.6

#### New features

New `-A' or `--auto-animate' option, forces the viewer to
automatically animate multiple-image GIF files. Thanks to John
Fitzgerald for suggesting this (more or less). It limits your viewing
options greatly, of course (since it's like pressing `e' every time
you view one, and exiting the image when you exit the animation), but
can be handy for slideshows etc. When this option is enabled, you can
use Backspace/Enter/Space for file navigation/tagging during an
animation. (The skip-to-next-frame key (previously Enter) is now `n'.)

Added multi-file delete. This is on `D', by analogy with `C' and `M'
for copy/move (since it works the same way) - the single-file-only
delete remains available on the Delete key. A new config variable
`delete-tagged-prompt' says whether to prompt before deleting all
tagged files (enabled by default). Thanks to Max Drozdoff for prodding
me into action on this. :-)

#### Bugfixes

In the very unusual case of both global and local GIF colourmaps being
present, they were applied in the wrong order. Thanks to Michal Svec
for spotting this.

Should now support 16-bit RGB TGA files. 16-bit palette-based files
\*may\* also work now, but are untested - it's not all that easy to find
samples of these rather unusual types of TGA file. Thanks to Michal
Svec for spotting the problem.

If a 32-bit mode existed without a corresponding 24-bit mode, and it
was one of the modes which are listed on the viewer right-button menu,
then it was incorrectly `greyed out', i.e. made unavailable from the
menu. Thanks for Dimitar Zhekov for spotting this.

When using `delete-single-prompt off', it previously didn't update the
screen after the deletion. Thanks to Max Drozdoff for spotting this
one.

#### Other changes

Added 15/16/24/32-bit 320x240 modes. Thanks to Michal Svec for
suggesting this. Currently only the 24/32-bit mode is selectable
directly (using `^', on the assumption that it's shift-6 - unshifted 6
selects 320x240x8).

Removed `--version-svgalib' option, this was causing trouble when
compiling with old versions of svgalib.

### Changes in zgv 5.5

#### New features

Recursive thumbnail update, ported from xzgv. This updates thumbnails
for the current dir and all subdirs (being careful to avoid symlink
loops).

The selector looks different in various ways. Most obviously, the logo
is gone (replaced with a sort of `title bar' with similar content to
xzgv's), the scrollbar is enabled by default, and 20 thumbnails are
visible by default rather than 12 - but there are other changes, like
losing the `raised border' look in most cases, and buttons looking
roughly like they do in GTK+.

GIF animation speed is now much, much more accurate; it previously
tended to run rather slowly.

Now supports GIF animation with the same orientation as the normal
picture. So for example you can flip the picture, and the animation
will be of similarly flipped frames.

The file info dialog (on `:') is much improved - it's now roughly the
same as the one in xzgv.

Added GNU-style long-option support, and changed/reorganised config
file option names to suit this; see `Invoking zgv' in info file or
`OPTIONS' in man page. Essentially things are a lot more xzgv-like now
(and just about everything can be messed about with on the
command-line). Note that most old option names are still supported in
config files, so it shouldn't break things.

Optional black background in 8-bit modes, disabled by default (use the
`black-background' config file option to enable). It works by swapping
the nearest-to-black palette index with the zero index, and altering
the in-memory image to match. This can be rather nice for consistency
with high-colour images, but means that 8-bit images which need such a
`fix' will take longer to appear.

#### Bugfixes

Fixed three buffer overruns. Given the nature of these, I suspect they
weren't exploitable for a DoS (i.e. leaving the console in graphics
mode), but it's difficult to be certain.

More BMP fixes - thanks to Jakub Bogusz for most of these.

Finally generates correct height comment for animated GIFs. (Be sure
to remove any old `.xvpics' dir if you want to fix this for existing
files.)

GIF animation with zoom mode enabled no longer pointlessly clears the
screen for each frame.

It previously drew entire pixel lines unnecessarily for images which
remained smaller than the screen width when scaled up.

It didn't previously do the required redraw when toggling fakecols
(with `F') when in 16-colour mode.

No longer undraws/redraws scrollbar unnecessarily during thumbnail
update.

The progress report bar now says "Reading" rather than
"Decompressing". At last. :-)

#### Other changes

Message boxes can now pop up over the existing viewer screen in most
cases (i.e. in any mode which is 640x480 or higher and has 256 or more
colours), using much the same approach as the mouse menu does. This
means that e.g. doing `:' in the viewer to get file info generally
doesn't need a mode switch any more.

The old `fullsel', `hicolmodes', and `hicontrol' settings have been
dropped, as they're now obsolete. You get a warning if you try to use
them.

The `centre' setting can no longer be toggled on the command-line with
the `-c' option. (You can use `--centre=off' if you still want to
disable this from the command-line.)

### Changes in zgv 5.4

#### New features

Added equivalent of xzgv's zoom-reduce-only option, which lets you
reduce big pictures in zoom mode without it also enlarging small ones.
The toggle is on Alt-r, and the config file option is
`zoom\_reduce\_only'. Thanks to Jan Blasiak for this.

You can now optionally use a magic-number-based scheme to choose which
files to list in the selector (Alt-m toggles it, and `fsmagic' is the
relevant config file option). This approach is much slower, but useful
when you have files lacking extensions. Thanks to Dank� Mikl�s for
suggesting this.

Added optional error-diffused dithering in 640x480x4 mode (enable with
Alt-c or `fastdither16col off' in config file) - this usually looks
better, but is much too slow to be the default.

#### Bugfixes

A fix for `restore to background colour' replacement method in
animated GIFs - it previously trusted the left/top/width/height values
for the GIF images to be sane (i.e. to fit within the defined
`screen'), which was a pretty stupid mistake. Thanks to Michal Svec
for spotting the problem.

Several significant BMP-reading fixes, particularly affecting some
16-colour and 24-bit files. Thanks to Matan Ziv-Av and Vlad Harchev
for spotting the problems.

Previously, when you deleted a file, or a file-move wasn't successful,
all tags were lost. This could be extremely annoying at times, but
it's finally fixed. Thanks to Dank� Mikl�s for reminding me about this
one (I'd noticed it before).

Animated GIFs now have thumbnails showing only the first image, though
the current implementation is... less efficient than it could be (it
reads the lot, then ignores everything after the first :-)).

The 640x480x4 (16-colour) mode-select key was still listed as `4' on
the mode help page, when it's been `0' for a while. (A similar problem
with the mouse menu meant the 640x480x4 option on that wasn't working,
either.) Thanks to Wim Osterholt for spotting this.

#### Other changes

Improved 640x480x4 mode's colour dithering slightly, and changed so it
now transparently adjusts base gamma adjustment (without changing the
effect of user-specified gamma). Essentially, it tends to look a bit
more like it does in proper 8-bit modes now. :-)

The GIF reader didn't previously read a certain form of broken
animated GIF (those with multiple image block terminators, which
breaks the GIF spec) - it stopped after one image. This was \*not\* a
bug, but it now tolerates such bogosity anyway. Thanks to Daniel
Biddle for spotting this.

Now allows `1' and `0' as alternatives to `on'/`off' and `yes'/`no'
for boolean option setting in config files. Also made the
documentation a bit clearer about how bools can be set. Thanks to
Johannes Zellner for indirectly noticing the problem.

The man page's OPTIONS section now has the right name again.

---

Last updated on 2005 Feb 12


