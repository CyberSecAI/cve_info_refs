=== Content from security.gentoo.org_957d9378_20250125_005948.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# FreeS/WAN, Openswan, strongSwan: Vulnerabilities in certificate handling — GLSA **200406-20**

FreeS/WAN, Openswan, strongSwan and Super-FreeS/WAN contain two bugs when
authenticating PKCS#7 certificates. This could allow an attacker to
authenticate with a fake certificate.

### Affected packages

| Package | **net-misc/freeswan** on all architectures |
| --- | --- |
| Affected versions | < **2.04-r1** |
| Unaffected versions | >= **2.04-r1**= **1.99-r1** |

| Package | **net-misc/openswan** on all architectures |
| --- | --- |
| Affected versions | < **2.1.4** |
| Unaffected versions | >= **2.1.4**= **1.0.6\_rc1** |

| Package | **net-misc/strongswan** on all architectures |
| --- | --- |
| Affected versions | < **2.1.3** |
| Unaffected versions | >= **2.1.3** |

| Package | **net-misc/super-freeswan** on all architectures |
| --- | --- |
| Affected versions | <= **1.99.7.3** |
| Unaffected versions |  |

### Background

FreeS/WAN, Openswan, strongSwan and Super-FreeS/WAN are Open Source
implementations of IPsec for the Linux operating system. They are all
based on the discontinued FreeS/WAN project.

### Description

All these IPsec implementations have several bugs in the
verify\_x509cert() function, which performs certificate validation, that
make them vulnerable to malicious PKCS#7 wrapped objects.

### Impact

With a carefully crafted certificate payload an attacker can
successfully authenticate against FreeS/WAN, Openswan, strongSwan or
Super-FreeS/WAN, or make the daemon go into an endless loop.

### Workaround

There is no known workaround at this time. All users are encouraged to
upgrade to the latest available version.

### Resolution

All FreeS/WAN 1.9x users should upgrade to the latest stable version:

```
 # emerge sync

 # emerge -pv "=net-misc/freeswan-1.99-r1"
 # emerge "=net-misc/freeswan-1.99-r1"
```

All FreeS/WAN 2.x users should upgrade to the latest stable version:

```
 # emerge sync

 # emerge -pv ">=net-misc/freeswan-2.04-r1"
 # emerge ">=net-misc/freeswan-2.04-r1"
```

All Openswan 1.x users should upgrade to the latest stable version:

```
 # emerge sync

 # emerge -pv "=net-misc/openswan-1.0.6_rc1"
 # emerge "=net-misc/openswan-1.0.6_rc1"
```

All Openswan 2.x users should upgrade to the latest stable version:

```
 # emerge sync

 # emerge -pv ">=net-misc/openswan-2.1.4"
 # emerge ">=net-misc/openswan-2.1.4"
```

All strongSwan users should upgrade to the latest stable version:

```
 # emerge sync

 # emerge -pv ">=net-misc/strongswan-2.1.3"
 # emerge ">=net-misc/strongswan-2.1.3"
```

All Super-FreeS/WAN users should migrate to the latest stable version
of Openswan. Note that Portage will force a move for Super-FreeS/WAN
users to Openswan.

```
 # emerge sync

 # emerge -pv "=net-misc/openswan-1.0.6_rc1"
 # emerge "=net-misc/openswan-1.0.6_rc1"
```
### References

* [Openswan/strongSwan Authentication Bug](https://lists.openswan.org/pipermail/dev/2004-June/000370.html)
* [CVE-2004-0590](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0590)

**Release date**

June 25, 2004

**Latest revision**

May 22, 2006: 02

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from lists.openswan.org_3350d187_20250126_045623.html ===

# [Openswan dev] Re: [strongSwan] potential authentication bug in strongSwan/Openswan

**Andreas Steffen**
andreas.steffen at strongsec.net

*Wed Jun 16 20:31:55 CEST 2004*

* Previous message: [[Openswan dev] potential authentication bug in strongSwan/Openswan](000369.html)
* Next message: [[Openswan dev] CheckPoint SecureClient Hybrid mode authentication](000371.html)
* **Messages sorted by:**
  [[ date ]](date.html#370)
  [[ thread ]](thread.html#370)
  [[ subject ]](subject.html#370)
  [[ author ]](author.html#370)

---

```
Hello Thomas,

you are right. The support of PKCS#7 wrapped certificates as required
e.g. by Windows XP with multi-tier trust chains introduced the
vulnerability that you describe in your posting. The proposed fix is simple.
We will not accept any end certificates with identical subject and
issuer distinguished names before the trust chain verification loop
is entered.

I have appended a patch which fixes the vulnerability for openswan-2.x,
strongswan-2.x and all X.509 patches for freeswan-2.x. A similar patch
will be made available for freeswan-1.99 based releases. The most
recent versions of openswan, strongswan and the X.509 patches will be
updated.

Thanks for making me aware of this serious vulnerability.

Andreas

Thomas Walpuski wrote:
> It looks like there is an authentication bug in strongSwan/Openswan.
> (I've not verified the issue on a running system, yet.)
>
> If an attacker sends a his (fake) CA certificate with issuer A and
> subject B and user certificate with issuer B and subject B signed by his
> CA wrapped in PKCS#7 as certificate payload the following happens:
>
>   0 ...
>   1 decode_cert() lets parse_pkcs7_cert() parse the certificate payload
>     and passes the result to store_x509certs().
>   2.1 store_x509certs() walks through the CA certificate(s), ensures
>       that it is no root CA (subject /= issuer) and enters it to the CA
>       certificate storage. => The attacker's CA certificate makes it way
>       into the CA certificate storage.
>   2.2 store_x509certs() walks through all certificates and adds their
>       public key and identity to the key storage _if_ they can be
>       verified:
>
>         verify_x509cert() checks whether the user certificate is in its
> 	validity period, gets the issuer's certificate and checks the
> 	user certificate's signature. => The attacker gets his user
> 	certificate verified, because he already got his CA certificate
> 	in.
> 	If the user certificates issuer and subject are the same,
> 	verify_x509cert() returns TRUE indicating successful certificate
> 	verification, otherwise the issuer certificate is checked. =>
> 	In the attacker's user certificate subject = issuer, ...
>
> With a carefully crafted certificate payload anyone can "authenticate"
> against strongSwan/Openswan.
>
> What do you think? Have I missed something substantial?
>
> BTW: Sorry for posting you mailing lists. I didn't found any security
> contact information.
>
> Thomas Walpuski

=======================================================================
Andreas Steffen                   e-mail: [andreas.steffen at strongsec.com](http://lists.openswan.org/mailman/listinfo/dev)
strongSec GmbH                    home:   <http://www.strongsec.com>
Alter Zürichweg 20                phone:  +41 1 730 80 64
CH-8952 Schlieren (Switzerland)   fax:    +41 1 730 80 65
==========================================[strong internet security]===
-------------- next part --------------
diff -urN strongswan-2.1.1/programs/pluto/x509.c strongswan-2.1.2/programs/pluto/x509.c
--- strongswan-2.1.1/programs/pluto/x509.c	Thu Apr  1 20:44:38 2004
+++ strongswan-2.1.2/programs/pluto/x509.c	Wed Jun 16 18:22:43 2004
@@ -1852,6 +1852,12 @@
 {
     *until = cert->notAfter;

+    if (same_dn(cert->issuer, cert->subject))
+    {
+	plog("end certificate with identical subject and issuer not accepted");
+	return FALSE;
+    }
+
     for (;;)
     {
 	x509cert_t *issuer_cert;

```

---

* Previous message: [[Openswan dev] potential authentication bug in strongSwan/Openswan](000369.html)
* Next message: [[Openswan dev] CheckPoint SecureClient Hybrid mode authentication](000371.html)
* **Messages sorted by:**
  [[ date ]](date.html#370)
  [[ thread ]](thread.html#370)
  [[ subject ]](subject.html#370)
  [[ author ]](author.html#370)

---

[More information about the Dev
mailing list](http://lists.openswan.org/mailman/listinfo/dev)


