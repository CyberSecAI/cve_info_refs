=== Content from aluigi.altervista.org_6fe721db_20250125_091955.html ===
#######################################################################
Luigi Auriemma
Application: Unreal Engine
http://unreal.epicgames.com
Vulnerable games:
- DeusEx <= 1.112fm
- Devastation <= 390
- Mobile Forces <= 20000
- Nerf Arena Blast <= 1.2
- Postal 2 <= 1337
- Rune <= 107
- Tactical Ops <= 3.4.0
- TNN Pro Hunter (?)
- Unreal 1 <= 226f
- Unreal II XMP <= 7710
- Unreal Tournament <= 451b
- Unreal Tournament 2003 <= 2225
- Unreal Tournament 2004 < 3236
- Wheel of Time <= 333b
- X-com Enforcer
NOT vulnerables:
- America's Army
- Dead man's hand
- Magic Battlegrounds
- Rainbow Six: Raven Shield
- Splinter Cell: Pandora tomorrow
- Star Trek: Klingon Honor Guard
- Unreal Tournament 2004 >= 3236
- XIII
Platforms: Windows, Linux and MacOS
Bug: memory overwriting with possible code execution
Exploitation: remote, versus servers
Date: 18 June 2004
Author: Luigi Auriemma
e-mail: aluigi@autistici.org
web: aluigi.org
#######################################################################
1) Introduction
2) Bug
3) The Code
4) Fix
#######################################################################
===============
1) Introduction
===============
The Unreal engine is the famous game engine developed by EpicGames and
currently is the most used in the videogames world.
Who doesn't know the great Unreal series???
#######################################################################
======
2) Bug
======
Almost all the games based on the Unreal engine support the "secure"
query.
This type of query is part of the so called Gamespy query protocol and
is used to know if the game server is able to calculate an exact
response using a provided string:
http://unreal.epicgames.com/IpServer.htm
http://aluigi.org/papers/gsmsalg.h
The query is a simple UDP packet like \secure\ABCDEF
If an attacker uses a long value in his secure query, in the Unreal
based game server will be overwritten some important memory zones.
Both remote code execution and spoofing are possibles.
#######################################################################
===========
3) The Code
===========
http://aluigi.org/poc/unsecure.zip
or send a similar UDP packet to the query port of the game server:
\secure\aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa...aaaa
#######################################################################
======
4) Fix
======
The bug has been noticed to EpicGames the 24 May 2004.
Currently only UnrealTournament 2004 has been fixed with the recent
3236 patch.
Check the homepages of the other vulnerable games for possible future
fixes.
However fixing the problem should be enough simple, at least for who
has experience with the UnrealScript language.
In fact the instructions that manage the \secure\ query and pass its
value to the bugged function are written in UnrealScript code and are
located in the files IpDrv.u or IpServer.u (they depend by the used
engine version).
#######################################################################


=== Content from www.gentoo.org_9c39c36d_20250125_092056.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Unreal Tournament 2003/2004: Buffer overflow in 'secure' queries — GLSA **200407-14**

Game servers based on the Unreal engine are vulnerable to remote code
execution through malformed 'secure' queries.

### Affected packages

| Package | **games-fps/ut2003** on all architectures |
| --- | --- |
| Affected versions | <= **2225-r2** |
| Unaffected versions | >= **2225-r3** |

| Package | **games-server/ut2003-ded** on all architectures |
| --- | --- |
| Affected versions | <= **2225-r1** |
| Unaffected versions | >= **2225-r2** |

| Package | **games-fps/ut2004** on all architectures |
| --- | --- |
| Affected versions | < **3236** |
| Unaffected versions | >= **3236** |

| Package | **games-fps/ut2004-demo** on all architectures |
| --- | --- |
| Affected versions | <= **3120-r3** |
| Unaffected versions | >= **3120-r4** |

### Background

Unreal Tournament 2003 and 2004 are popular first-person-shooter games.
They are both based on the Unreal engine, and can be used in a game server
/ client setup.

### Description

The Unreal-based game servers support a specific type of query called
'secure'. Part of the Gamespy protocol, this query is used to ask if the
game server is able to calculate an exact response using a provided string.
Luigi Auriemma found that sending a long 'secure' query triggers a buffer
overflow in the game server.

### Impact

By sending a malicious UDP-based 'secure' query, an attacker could execute
arbitrary code on the game server.

### Workaround

Users can avoid this vulnerability by not using Unreal Tournament to host
games as a server. All users running a server should upgrade to the latest
versions.

### Resolution

All Unreal Tournament users should upgrade to the latest available
versions:

```
 # emerge sync

 # emerge -pv ">=games-fps/ut2003-2225-r3"
 # emerge ">=games-fps/ut2003-2225-r3"

 # emerge -pv ">=games-server/ut2003-ded-2225-r2"
 # emerge ">=games-server/ut2003-ded-2225-r2"

 # emerge -pv ">=games-fps/ut2004-3236"
 # emerge ">=games-fps/ut2004-3236"

 # emerge -pv ">=games-fps/ut2004-demo-3120-r4"
 # emerge ">=games-fps/ut2004-demo-3120-r4"
```
### References

* [Luigi Auriemma advisory](http://aluigi.altervista.org/adv/unsecure-adv.txt)
* [CAN-2004-0608](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0608)

**Release date**

July 19, 2004

**Latest revision**

July 19, 2004: 01

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [54726](https://bugs.gentoo.org/show_bug.cgi?id=54726)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


