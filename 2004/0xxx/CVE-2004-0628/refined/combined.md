=== Content from marc.info_21956912_20250125_064521.html ===

```
[[prev in list](?l=bugtraq&m=108904813003166&w=2)] [[next in list](?l=bugtraq&m=108904522622549&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    MySQL Authentication Bypass
From:       [NGSSoftware Insight Security Research <nisr () nextgenss ! com>](?a=101614336100005&r=1&w=2)
Date:       [2004-07-05 12:21:41](?l=bugtraq&r=1&w=2&b=200407)
Message-ID: [Pine.WNT.4.58.0407051128060.1176 () alpha](?i=Pine.WNT.4.58.0407051128060.1176%20()%20alpha)
[Download RAW [message](?l=bugtraq&m=108904917528205&q=mbox) or [body](?l=bugtraq&m=108904917528205&q=raw)]

NGSSoftware Insight Security Research Advisory

Name: MySQL Authentication Bypass / Buffer Overflow
Systems Affected: MySQL 4.1 prior to 4.1.3, and MySQL 5.0.
Severity: High
Vendor URL: <http://www.mysql.com>
Author: Chris Anley [ chris@ngssoftware.com ]
Date of Advisory: 1st July 2004

Whitepaper
**********

We have written a paper that accompanies this advisory. The paper
provides details of various MySQL lockdown techniques, and a review of
common attacks on MySQL, including SQL injection. The paper can be found
at

<http://www.ngssoftware.com/papers/HackproofingMySQL.pdf>

Description
***********

"The MySQL database server is the world's most popular open source
database." [[www.mysql.com](http://www.mysql.com)].

This advisory details a bug that allows a remote user to entirely bypass
the MySQL password authentication mechanism, allowing them to authenticate
as a MySQL user without knowing that user's password. Using a similar
method, a stack buffer used in the authentication mechanism can be
overflowed, though exploitation of the overflow is not straightforward.

Details
*******

MySQL 4.1 Authentication Bypass

By submitting a carefully crafted authentication packet, it is possible
for an attacker to bypass password authentication in MySQL 4.1.

From check_connection (sql_parse.cpp), line ~837:

  /*
    Old clients send null-terminated string as password; new clients send
    the size (1 byte) + string (not null-terminated). Hence in case of
empty
    password both send '\0'.
  */
  uint passwd_len= thd->client_capabilities & CLIENT_SECURE_CONNECTION ?
    *passwd++ : strlen(passwd);

Provided 0x8000 is specified in the client capabilities flags, the use can
specify the passwd_len field of their choice. For this attack, we will
choose 0x14 (20) which is the expected SHA1 hash length.

Several checks are now carried out to ensure that the user is
authenticating from a host that is permitted to connect. Provided these
checks are passed, we reach:

        /* check password: it should be empty or valid */
        if (passwd_len == acl_user_tmp->salt_len)
        {
          if (acl_user_tmp->salt_len == 0 ||
              acl_user_tmp->salt_len == SCRAMBLE_LENGTH &&
              check_scramble(passwd, thd->scramble, acl_user_tmp->salt) == 0 ||
              check_scramble_323(passwd, thd->scramble,
                                 (ulong *) acl_user_tmp->salt) == 0)
          {
            acl_user= acl_user_tmp;
            res= 0;
          }
        }

the check_scramble function fails, but within the check_scramble_323
function we see:

my_bool
check_scramble_323(const char *scrambled, const char *message,
                   ulong *hash_pass)
{
  struct rand_struct rand_st;
  ulong hash_message[[2]](#2);
  char buff[[16]](#16),*to,extra;                      /* Big enough for check */
  const char *pos;

  hash_password(hash_message, message, SCRAMBLE_LENGTH_323);
  randominit(&rand_st,hash_pass[[0]](#0) ^ hash_message[[0]](#0),
             hash_pass[[1]](#1) ^ hash_message[[1]](#1));
  to=buff;
  for (pos=scrambled ; *pos ; pos++)
    *to++=(char) (floor(my_rnd(&rand_st)*31)+64);
  extra=(char) (floor(my_rnd(&rand_st)*31));
  to=buff;
  while (*scrambled)
  {
    if (*scrambled++ != (char) (*to++ ^ extra))
      return 1;                                 /* Wrong password */
  }
  return 0;
}

At this point, the user has specified a 'scrambled' string that is as long
as they wish. In the case of the straightforward authentication bypass,
this is a zero-length string. The final loop compares each character in
the 'scrambled' string against the string that mysql knows is the correct
response, until there are no more characters in 'scrambled'. Since there
are no characters *at all* in 'scrambled', the function returns '0'
immediately, allowing the user to authenticate with a zero-length string.

This bug is relatively easy to exploit, although it is necessary to write
a custom MySQL client in order to do so.

In addition to the zero-length string authentication bypass, the
stack-based buffer 'buff' can be overflowed by a long 'scramble' string.
The buffer is overflowed with characters output from my_rnd(), a pseudo
random number generator. The characters are in the range 0x40..0x5f. On
some platforms, arbitrary code execution is possible, though the exploit
is complex and requires either brute force, or knowledge of at least one
password hash.

Fix Information and workarounds
*******************************

MySQL AB were contacted on the 1st of June 2004 and the patch for this bug
was present in the source code by the 2nd of June. Since MySQL prefer
users to install via pre-built binary packages, NGS have delayed the
release of this advisory until appropriate 'patch' packages were
available.

MySQL AB have fixed this bug in version 4.1.3, and the most recent builds
of version 5.0.

In addition to patching, various workarounds are possible for this bug.
The attacker must know or be able to guess the name of a user in order
for this attack to work, so renaming the default MySQL 'root' account is
a reasonable precaution. Also, the account in question must be accessible
from the attacker's host, so applying ip-address based login restrictions
will also mitigate this bug.

A check for this vulnerability has been added to Typhon III, NGSSoftware's
advanced vulnerability assessment scanner. For more information please
visit the NGSSoftware website at <http://www.ngssoftware.com/>

About NGSSoftware
*****************

NGSSoftware design, research and develop intelligent, advanced application
security assessment scanners. Based in the United Kingdom, NGSSoftware
have offices in the South of London and the East Coast of Scotland.
NGSSoftware's sister company NGSConsulting, offers best of breed security
consulting services, specializing in application, host and network
security assessments.

<http://www.ngssoftware.com/>

Telephone +44 208 401 0070
Fax +44 208 401 0076

enquiries@ngssoftware.com

[[prev in list](?l=bugtraq&m=108904813003166&w=2)] [[next in list](?l=bugtraq&m=108904522622549&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from www.kb.cert.org_962c61a9_20250125_064522.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#645326

## MySQL fails to properly handle overly long "scramble" values

#### Vulnerability Note VU#645326

Original Release Date: 2004-07-12 | Last Revised: 2004-07-21

---

### Overview

There is a buffer overflow vulnerability in the way MySQL handles overly long "scramble" strings, which could allow an attacker to cause a denial of service or potentially execute arbitrary code.

### Description

| [MySQL](http://www.mysql.com/) is an open-source database system available for Microsoft Windows, Linux, and other UNIX-based operating systems. There is a vulnerability in MySQL in which an overly long "scramble" string generated by the my\_rnd() function could cause a buffer overflow to occur. It has been reported that versions 4.1 prior to 4.1.3 and version 5.0 are affected. |
| --- |

### Impact

| A remote, unauthenticated attacker could cause a denial of service or potentially execute code of the attacker's choice. |
| --- |

### Solution

| **Upgrade**  According to the [NGSSoftware Security Advisory](http://www.nextgenss.com/advisories/mysql-authbypass.txt), this vulnerability has been fixed in version 4.1.3 (Beta) and version 5.0 (Alpha).Note: Users should exercise caution before installing beta or alpha releases. |
| --- |

| **Restrict access**Block or restrict access to the MySQL service (typically 3306/tcp) from untrusted networks such as the Internet. |
| --- |

### Vendor Information

645326
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23645326/) to view vendors.**
### [MySQL](#DMOA-62TSQH) Affected

Updated:  July 12, 2004

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

The CERT/CC has no additional comments at this time.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://www.nextgenss.com/advisories/mysql-authbypass.txt>
* <http://secunia.com/advisories/12020/>
* <http://www.securitytracker.com/alerts/2004/Jul/1010645.html>
* <http://xforce.iss.net/xforce/xfdb/16612>
### Acknowledgements

This vulnerability was reported by Chris Anley of NGSSoftware.

This document was written by Damon Morda.

### Other Information

| **CVE IDs:** | [CVE-2004-0628](http://web.nvd.nist.gov/vuln/detail/CVE-2004-0628) |
| --- | --- |
| **Severity Metric:** | 2.23 |
| **Date Public:** | 2004-07-01 |
| **Date First Published:** | 2004-07-12 |
| **Date Last Updated:** | 2004-07-21 18:13 UTC |
| **Document Revision:** | 15 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800


