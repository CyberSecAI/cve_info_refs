=== Content from www.mozilla.org_07243e61_20250124_130229.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security
* Known Vulnerabilities

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Known Vulnerabilities in Mozilla Products

The links below list security vulnerabilities known to affect
particular versions of Mozilla products and instructions on what users
can do to protect themselves. The lists will be added to when new security
problems are found. For a complete list not sorted by product or version
please see the [Mozilla Foundation Security Advisories](/en-US/security/advisories/).

Please read
[Mozilla.org's security bug policy](/en-US/about/governance/policies/security-group/bugs/) for information on how we handle
security bugs. If you have found a security problem which is not on this
list and has not already been filed as a bug in
[Bugzilla](https://bugzilla.mozilla.org/query.cgi),
or if you find errors or inconsistencies in this list, please
mail us.
If needed our PGP key can be found on the main
[security](/en-US/security/#pgpkey) page.

## Product Advisories

* [Firefox](/en-US/security/known-vulnerabilities/firefox/)
* [Firefox ESR](/en-US/security/known-vulnerabilities/firefox-esr/)
* [Firefox for iOS](/en-US/security/known-vulnerabilities/firefox-for-ios/)
* [Firefox OS](/en-US/security/known-vulnerabilities/firefox-os/)
* [Mozilla VPN](/en-US/security/known-vulnerabilities/mozilla-vpn/)
* [Thunderbird](/en-US/security/known-vulnerabilities/thunderbird/)
* [Thunderbird ESR](/en-US/security/known-vulnerabilities/thunderbird-esr/)
* [SeaMonkey](/en-US/security/known-vulnerabilities/seamonkey/)

## Advisories for older products

### Firefox

* [Firefox 3.6](/en-US/security/known-vulnerabilities/firefox-3.6/)
* [Firefox 3.5](/en-US/security/known-vulnerabilities/firefox-3.5/)
* [Firefox 3.0](/en-US/security/known-vulnerabilities/firefox-3.0/)
* [Firefox 2.0](/en-US/security/known-vulnerabilities/firefox-2.0/)
* [Firefox 1.5](/en-US/security/known-vulnerabilities/firefox-1.5/)
* [Firefox 1.0](/en-US/security/known-vulnerabilities/firefox-1.0/)

### Thunderbird

* [Thunderbird 3.1](/en-US/security/known-vulnerabilities/thunderbird-3.1/)
* [Thunderbird 3.0](/en-US/security/known-vulnerabilities/thunderbird-3.0/)
* [Thunderbird 2.0](/en-US/security/known-vulnerabilities/thunderbird-2.0/)
* [Thunderbird 1.5](/en-US/security/known-vulnerabilities/thunderbird-1.5/)
* [Thunderbird 1.0](/en-US/security/known-vulnerabilities/thunderbird-1.0/)

### SeaMonkey

* [SeaMonkey 2.0](/en-US/security/known-vulnerabilities/seamonkey-2.0/)
* [SeaMonkey 1.1](/en-US/security/known-vulnerabilities/seamonkey-1.1/)
* [SeaMonkey 1.0](/en-US/security/known-vulnerabilities/seamonkey-1.0/)

### Older

* [Mozilla Suite 1.7](/en-US/security/known-vulnerabilities/mozilla-suite/)
* [Older vulnerabilities](/en-US/security/known-vulnerabilities/older-vulnerabilities/)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from security.gentoo.org_b6da5311_20250124_130216.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla, Firefox, Thunderbird, Epiphany: New releases fix vulnerabilities — GLSA **200409-26**

New releases of Mozilla, Epiphany, Mozilla Thunderbird, and Mozilla Firefox
fix several vulnerabilities, including the remote execution of arbitrary
code.

### Affected packages

| Package | **www-client/mozilla** on all architectures |
| --- | --- |
| Affected versions | < **1.7.3** |
| Unaffected versions | >= **1.7.3** |

| Package | **www-client/mozilla-firefox** on all architectures |
| --- | --- |
| Affected versions | < **1.0\_pre** |
| Unaffected versions | >= **1.0\_pre** |

| Package | **mail-client/mozilla-thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **0.8** |
| Unaffected versions | >= **0.8** |

| Package | **www-client/mozilla-bin** on all architectures |
| --- | --- |
| Affected versions | < **1.7.3** |
| Unaffected versions | >= **1.7.3** |

| Package | **www-client/mozilla-firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **1.0\_pre** |
| Unaffected versions | >= **1.0\_pre** |

| Package | **mail-client/mozilla-thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **0.8** |
| Unaffected versions | >= **0.8** |

| Package | **www-client/epiphany** on all architectures |
| --- | --- |
| Affected versions | < **1.2.9-r1** |
| Unaffected versions | >= **1.2.9-r1** |

### Background

Mozilla is a popular web browser that includes a mail and newsreader.
Epiphany is a web browser that uses Gecko, the Mozilla rendering
engine. Mozilla Firefox and Mozilla Thunderbird are respectively the
next-generation browser and mail client from the Mozilla project.

### Description

Mozilla-based products are vulnerable to multiple security issues.
Firstly routines handling the display of BMP images and VCards contain
an integer overflow and a stack buffer overrun. Specific pages with
long links, when sent using the "Send Page" function, and links with
non-ASCII hostnames could both cause heap buffer overruns.

Several issues were found and fixed in JavaScript rights handling:
untrusted script code could read and write to the clipboard, signed
scripts could build confusing grant privileges dialog boxes, and when
dragged onto trusted frames or windows, JavaScript links could access
information and rights of the target frame or window. Finally,
Mozilla-based mail clients (Mozilla and Mozilla Thunderbird) are
vulnerable to a heap overflow caused by invalid POP3 mail server
responses.

### Impact

An attacker might be able to run arbitrary code with the rights of the
user running the software by enticing the user to perform one of the
following actions: view a specially-crafted BMP image or VCard, use the
"Send Page" function on a malicious page, follow links with malicious
hostnames, drag multiple JavaScript links in a row to another window,
or connect to an untrusted POP3 mail server. An attacker could also use
a malicious page with JavaScript to disclose clipboard contents or
abuse previously-given privileges to request XPI installation
privileges through a confusing dialog.

### Workaround

There is no known workaround covering all vulnerabilities.

### Resolution

All users should upgrade to the latest stable version:

```
 # emerge sync

 # emerge -pv your-version
 # emerge your-version
```
### References

* [Mozilla Security Advisory](https://www.mozilla.org/projects/security/known-vulnerabilities.html#mozilla1.7.3)
* [US-CERT Security Alert TA04-261A](https://www.us-cert.gov/cas/techalerts/TA04-261A.html)
* [CVE-2004-0902](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0902)
* [CVE-2004-0903](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0903)
* [CVE-2004-0904](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0904)
* [CVE-2004-0905](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0905)
* [CVE-2004-0906](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0906)
* [CVE-2004-0907](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0907)
* [CVE-2004-0908](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0908)
* [CVE-2004-0909](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0909)

**Release date**

September 20, 2004

**Latest revision**

December 30, 2007: 03

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [63996](https://bugs.gentoo.org/show_bug.cgi?id=63996)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugzilla.mozilla.org_57433949_20250124_130016.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/255067)
* [XML](/show_bug.cgi?ctype=xml&id=255067)

Closed
[Bug 255067](/show_bug.cgi?id=255067)

Opened 20 years ago
Closed 20 years ago

# BMP integer overflow exploits

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

BMP integer overflow exploits

## Categories

### (Core :: Graphics: ImageLib, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20ImageLib#Graphics%3A%20ImageLib)

Graphics: ImageLib
▾

Core :: Graphics: ImageLib
ImageLib decodes GIF, JPEG and PNG images, and provides the decoded data to the Compositor for display. If Firefox or Seamonkey can display an image when loaded separately from the page, ImageLib is working, and the actual imaging bug exists elsewhere within Firefox or Seamonkey.

Examples of appropriate bugs: PNG gAMA chunk ignored; Crashes on GIF w/corrupted frame(merr-01.gif); or PNGs and JPEGs aren't displayed on FreeBSD.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20ImageLib)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: dveditz, Assigned: dveditz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=40)  [dveditz](/user_profile?user_id=1689)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=40)  [dveditz](/user_profile?user_id=1689)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[sbb+](/show_bug.cgi?id=256197 "RESOLVED WORKSFORME - Security Bug Bounty: awarded")

Dependency [tree](/showdependencytree.cgi?id=255067&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=255067)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, fixed-aviary1.0, fixed1.7.3, Whiteboard: [sg:fix])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[fixed-aviary1.0](/buglist.cgi?keywords=fixed-aviary1.0&resolution=---),
[fixed1.7.3](/buglist.cgi?keywords=fixed1.7.3&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:fix]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [blocking1.7.5](#c0 "20 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.7.5 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking-aviary1.0PR](#c1 "20 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking-aviary1.0PR | + |
| --- | --- | --- |
| [asa](/user_profile?user_id=5003) | [blocking1.8a3](#a616543_5003 "20 years ago") | - |
| --- | --- | --- |
| [asa](/user_profile?user_id=5003) | blocking1.8a3 | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [sample bmp mentioned in original report (CRASH, exploitable)](/attachment.cgi?id=156329)  [20 years ago](#c8)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   1.11 KB, image/bmp |  | [Details](/attachment.cgi?id=156329&action=edit) |
| --- | --- | --- |
| [Fix the overflows](/attachment.cgi?id=156339)  [20 years ago](#c9)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   2.86 KB, patch |  | [Details](/attachment.cgi?id=156339&action=edit) | [Diff](/attachment.cgi?id=156339&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=156339) |
| [incorporate review comments](/attachment.cgi?id=157135)  [20 years ago](#c19)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   2.73 KB, patch | dveditz : [review+](#c20 "20 years ago")  scc : [superreview+](#c22 "20 years ago")  dveditz : [approval-aviary+](#c23 "20 years ago")  dveditz : [approval1.7.5+](#c0 "20 years ago") | [Details](/attachment.cgi?id=157135&action=edit) | [Diff](/attachment.cgi?id=157135&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=157135) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=255067#c0)• 20 years ago |
|  | |

------------------------------------------------------------
Security Audit of Mozilla's .bmp image parsing (August 2004)
by Gael Delalleau <gael.delalleau+moz@m4x.org>
------------------------------------------------------------
Overview
--------
This report presents the results of a security audit of a part
of the Mozilla 1.7.2 C++ source code tree.
This security audit was done during my free time as an attempt
to promote and participate to the Mozilla Security Bug Bounty
Program (<http://www.mozilla.org/security/bug-bounty.html>).
Several integer overflows were found in the image parsing code
of Mozilla. Some of them leads to exploitable security bugs,
ranging from Denial of Service (crash of the Mozilla client)
to arbitrary code execution on the user's computer.
Source code files audited
-------------------------
mozilla/modules/libpr0n/decoders/bmp/nsBMPDecoder.cpp
mozilla/modules/libpr0n/decoders/bmp/nsBMPDecoder.h
+ parts of various related files
Details
-------
There are mutiple integer overflows in the code used to parse
and display .bmp images. Some of them leads to exploitable
security bugs.
These integer overflow can be found:
- in the .bmp decoder of the libpr0n module
- in the OS-specific code used to display images. For instance,
the following file is used on Windows systems:
mozilla/gfx/src/windows/nsImageWin.cpp
I will now highlight all the integer overflow issues
found during the audit, and try to show how these various
issues finally allow for arbitrary code execution.
(1) \*\*\* Denial Of Service while parsing a malformed .bmp
image \*\*\*
Vulnerable systems: Linux, Windows XP
Other systems: untested
\* in nsBMPDecoder.cpp line 287:
mRow = new PRUint8[(mBIH.width\*mBIH.bpp)/8 + 4];
mBIH.width\*mBIH.bpp can wrap around and thus the allocated
buffer can be made very small. On Linux (Mozilla 1.7.2
developpement version) a negative value in the new[] operator
will crash the client (uncatched exception?)
Then mFrame->Init() is called, followed by NS\_ENSURE\_SUCESS,
which ensures some sanity checks on the height, width and bpp
of the image. However, these checks are not strict enough
(they do not prevent mBIH.width\*mBIH.bpp from wrapping around).
~ Fortunately on systems using gtk to display images (like Linux)
an additional check is done in mImage->Init() which prevents
Mozilla to display the image if the width or height is greater
than 32767, thus preventing arbitrary code execution.
~ On Windows systems, there is no limit to the height and width
of the image. Denial of service and arbitrary code execution are
possible as shown below.
~ Other systems: untested.
\* in nsImageWin.cpp line 160:
mRowBytes = CalcBytesSpan(mBHead->biWidth);
with :
1498 nsImageWin :: CalcBytesSpan(PRUint32 aWidth)
1499 {
1500 PRInt32 spanBytes;
1503 spanBytes = (aWidth \* mBHead->biBitCount) >> 5;
(...)
1510 spanBytes <<= 2;
1513 return(spanBytes);
1514 }
aWidth \* mBHead->biBitCount is actually similar to
mBIH.width\*mBIH.bpp. It can wrap around, so mRowBytes
can be very small.
This value finds its way in nsBMPDecoder.cpp in the
mBpr variable, which is used in line 374 to allocate
a buffer (which can be very small due to the
integer wrap around we just explained):
mDecoded = (PRUint8\*)malloc(mBpr);
Thus at lines 420 to 428 we can end in a big loop
(lpos==width iterations) which writes bytes to memory
pointed by p, which is actually our small mDecoded
buffer:
421 while (lpos > 0) {
422 SetPixel(d, p[2], p[1], p[0]);
423 p += 2;
424 --lpos;
425 if (mBIH.bpp == 32)
426 p++; // Padding byte
427 ++p;
428 }
The SetPixel function writes the 3 bytes to d and increments
d by 3.
Thus, memory is being copied from the p buffer
allocated in the heap, to the mDecoded buffer allocated
later on the same heap. Both buffers can be made very small,
so the loop will soon copy a part of the heap to another part
of the heap.
Consequences:
~ the client will crash when this big loop reaches the end
of the allocated memory for the heap (write attempt to an
unmapped memory area).
~ it might be possible to trigger arbitrary code execution
if another thread uses the corrupted heap before the
crash happens, or if we can allocate enough memory on the same
heap to make it big enough to avoid the crash.
~ Consequences on systems other than Windows (32 bits): not
evaluated.
----------
Side Note: there are other suspicious pieces of code in
nsImageWin.cpp, without checks for integer overflows.
For instance at line 161:
mSizeImage = mRowBytes \* mBHead->biHeight;
(...)
mImageBits = new unsigned char[mSizeImage];
----------
(2) \*\*\* Arbitrary code execution while parsing a malformed .bmp
image \*\*\*
Vulnerable: Windows XP
Not vulnerable (?): Linux
Other systems: untested
With the same bugs, there is a better way to corrupt the heap
after the mDecoded pointer with arbitrary values, and without
crashing the client.
Indeed, we can use a RLE-encoded bitmap image (depth 8 bits,
encoded with RLE8, width big enough to make mBpr wrap around,
small height to pass the overflow check on width\*height. See
the sample image file attached to this report).
Line 464, the buffer is allocated (but too small!):
mDecoded = (PRUint8\*)calloc(mBpr, 1);
Then we can legitimately use the RLE decoder to write arbitrary
data in the mDecoded buffer, with the length limit being mBIH.width
which is a big value (much bigger than the size of the buffer).
Heap corruption with arbitrary data on the Windows OS is a common
situation, known to allow arbitrary code execution. See the two
screenshots showing a debugger attached to the mozilla.exe process after
the crash; they show that at least two exploitation techniques
may be used to get control of EIP and hijack the execution flow
of the program:
(a) overwriting C++ pointers to the methods of objects
stored on the heap. The screenshot shows that we can land in:
CALL [EAX+10] where EAX=0x42424242 (our arbitrary data)
(b) using standard heap overflow techniques. The screenshot
shows that we can land in ntdll.dll in:
MOV [ECX], EAX where EAX and ECX are arbitrary values supplied
by the attacker in the malicious image file.
---------
Side Note: in the RLE decoder of nsBMPDecoder.cpp at line 568,
there is: mDecoding += byte \* GFXBYTESPERPIXEL;
This can be abused to put the mDecoding pointer out of the
bounds of the mDecoded buffer. Even though this does not seems
to be exploitable with the current surrounding code, it deserves
to be fixed.
---------
Exploit code
------------
I did not wrote the actual exploit code because:
- it is outside the scope of a source code audit
- I gave enough information to show such an exploit can be written.
The issue is just the same kind as many other heap overflow
vulnerabilities, including previous Mozilla vulnerabilities like the
SOAPParameter overflow (236618).
- in France, the legal status of publishing exploit code is unknown
at the moment.
Further audit work on the same topic
------------------------------------
- Need to check other image parsers (.jpeg, .gif, .ico, icon,
.xpm...) in libpr0n for integer overflows.
- Need to check deeper the OS-dependent image display code,
for all operating systems (I audited only small parts of
the gtk and Win Image code).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=255067#c1)• 20 years ago |
|  | |

Presuming this will block everythingFlags: blocking1.8a3+Flags: blocking1.7.3+Flags: blocking-aviary1.0PR+

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=255067#c2)• 20 years ago |
|  | |

caillion, tor, pav can you help on this one?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=255067#c3)• 20 years ago |
|  | |

I'm working on a patch for the specificly enumerated spots. What would really
help is extra eyes looking for similar problems in the other decoders.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=255067#c4)• 20 years ago |
|  | |

I'm working on a patch for the specificly enumerated spots. What would really
help is extra eyes looking for similar problems in the other decoders.Assignee: jdunn → dveditz

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=255067#c5)• 20 years ago |
|  | |

btw, nsICODecoder.cpp has the same problems

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=255067#c6)• 20 years ago |
|  | |

could you lend some cycles to looking at other decoders

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=255067#c7)• 20 years ago |
|  | |

cbiesinger, can you help look at the other decoders too? going to try and get
dveditx and dbaron together tomorrow to come up with a plan.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=255067#c8)• 20 years ago |
|  | |

Attached image
[sample bmp mentioned in original report (CRASH, exploitable)](attachment.cgi?id=156329)
— [Details](attachment.cgi?id=156329&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a576632_1689)• 20 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Whiteboard: [sg:fix]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=255067#c9)• 20 years ago |
|  | |

Attached patch

[Fix the overflows](attachment.cgi?id=156339&action=diff) (obsolete)
— [Details](attachment.cgi?id=156339&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=156339)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a586428_1689)• 20 years ago |

[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: superreview?(tor)
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: review?(cbiesinger)
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: approval1.8a3?
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: approval1.7.3?
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: approval-aviary?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a586635_1689)• 20 years ago |

[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: review?(cbiesinger) → review?(pavlov)

|  | [Christopher Aillon (sabbatical, not receiving bugmail)](/user_profile?user_id=32335) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=255067#c10)• 20 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=255067#c5 "VERIFIED FIXED - BMP integer overflow exploits"))
> btw, nsICODecoder.cpp has the same problems
Your patch doesn't address this, does it?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=255067#c11)• 20 years ago |
|  | |

The patch doesn't touch ICO. At a closer look ICO files are limited to single
byte widths and heights so they don't really have the same overflow issue in
what looked like the analogous spot.
Not in the same place, anyway. I found [bug 245631](/show_bug.cgi?id=245631 "VERIFIED FIXED - Crash loading .ico file [@ nsICODecoder::ProcessData ]") that should be fixed just in
case it's a similar overflow of some kind.

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=255067#c12)• 20 years ago |
|  | |

Comment on [attachment 156339](/attachment.cgi?id=156339 "Fix the overflows") [[details]](/attachment.cgi?id=156339&action=edit "Fix the overflows") [[diff]](/attachment.cgi?id=156339&action=diff "Fix the overflows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=156339)
Fix the overflows
> // BMPs with negative width are invalid
>- if (mBIH.width < 0)
>+ // Reject extremely wide BMP's to prevent overflows
>+ if (mBIH.width < 0 || mBIH.width > 0xFFFFFF)
> return NS\_ERROR\_FAILURE;
>
> PRUint32 real\_height = (mBIH.height > 0) ? mBIH.height : -mBIH.height;
> rv = mImage->Init(mBIH.width, real\_height, mObserver);
> NS\_ENSURE\_SUCCESS(rv, rv);
Maybe I misunderstood, but I thought that you were limiting the image to 32K in
each direction, so that if you do need this test too then you might as well
check against 32K here too?

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a616543_5003)• 20 years ago |

Flags: blocking1.8a3+ → blocking1.8a3-

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=255067#c13)• 20 years ago |
|  | |

Comment on [attachment 156339](/attachment.cgi?id=156339 "Fix the overflows") [[details]](/attachment.cgi?id=156339&action=edit "Fix the overflows") [[diff]](/attachment.cgi?id=156339&action=diff "Fix the overflows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=156339)
Fix the overflows
unsetting 1.8a3 approval request. we've shipped already.
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: approval1.8a3?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a781486_1689)• 20 years ago |

Blocks: [sbb?](/show_bug.cgi?id=256195 "RESOLVED WORKSFORME - Security Bug Bounty: nominated")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=255067#c14)• 20 years ago |
|  | |

I \*do\* want to check in each place. The BMP code has a problem and needs to
protect itself, the upper level checks are belt-and-suspenders.
I think 32K is too small already, this 30K x 15K image is legit:
<http://visibleearth.nasa.gov/data/ev58/ev5826_nightearth.gif>
(Warning, you will probably crash from lack of memory)

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a1312151_2687)• 20 years ago |

Whiteboard: [sg:fix] → [sg:fix] have patch - need reviews pavlov tor

|  | [Stuart Parmenter](/user_profile?user_id=5756) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=255067#c15)• 20 years ago |
|  | |

I think we should support at least 64k values. 32k seems like it doesn't have
much room to grow..

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=255067#c16)• 20 years ago |
|  | |

OK, if I promise to change all the checks to 0xFFFF (including the BMP-specific
larger one) can I have r=? or do you want to see another patch?

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=255067#c17)• 20 years ago |
|  | |

pav said 64 is good yesterday.

|  | [Stuart Parmenter](/user_profile?user_id=5756) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=255067#c18)• 20 years ago |
|  | |

yeah, r='d with that

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=255067#c19)• 20 years ago |
|  | |

Attached patch

[incorporate review comments](attachment.cgi?id=157135&action=diff)
— [Details](attachment.cgi?id=157135&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=157135)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a1430268_1689)• 20 years ago |

[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=255067#c20)• 20 years ago |
|  | |

Comment on [attachment 157135](/attachment.cgi?id=157135 "incorporate review comments") [[details]](/attachment.cgi?id=157135&action=edit "incorporate review comments") [[diff]](/attachment.cgi?id=157135&action=diff "incorporate review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=157135)
incorporate review comments
adding r=pav from comment
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: superreview?
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: review+
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: approval1.7.3?
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: approval-aviary?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=255067#c21)• 20 years ago |
|  | |

Comment on [attachment 157135](/attachment.cgi?id=157135 "incorporate review comments") [[details]](/attachment.cgi?id=157135&action=edit "incorporate review comments") [[diff]](/attachment.cgi?id=157135&action=diff "incorporate review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=157135)
incorporate review comments
adding r=pav from comment

|  | [Scott Collins](/user_profile?user_id=15726) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=255067#c22)• 20 years ago |
|  | |

Comment on [attachment 157135](/attachment.cgi?id=157135 "incorporate review comments") [[details]](/attachment.cgi?id=157135&action=edit "incorporate review comments") [[diff]](/attachment.cgi?id=157135&action=diff "incorporate review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=157135)
incorporate review comments
sr=scc ... pending changing 0xFFFF limit test to a const that ensures
appropriate signedness
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: superreview+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=255067#c23)• 20 years ago |
|  | |

Comment on [attachment 157135](/attachment.cgi?id=157135 "incorporate review comments") [[details]](/attachment.cgi?id=157135&action=edit "incorporate review comments") [[diff]](/attachment.cgi?id=157135&action=diff "incorporate review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=157135)
incorporate review comments
Adding branch approvals from meeting earlier today
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: superreview?
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: approval1.7.3?
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: approval1.7.3+
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: approval-aviary?
[Attachment #157135](/attachment.cgi?id=157135&action=edit "incorporate review comments") -
Flags: approval-aviary+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=255067#c24)• 20 years ago |
|  | |

Fix checked in to trunk, aviary branch, 1.7 branch and 1.7.2 branch Status: NEW → RESOLVEDClosed: 20 years agoKeywords: [fixed-aviary1.0](/buglist.cgi?keywords=fixed-aviary1.0&resolution=---),
[fixed1.7.3](/buglist.cgi?keywords=fixed1.7.3&resolution=---)Resolution: --- → FIXEDWhiteboard: [sg:fix] have patch - need reviews pavlov tor → [sg:fix] fixed1.7.2+

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=255067#c25)• 20 years ago |
|  | |

Comment on [attachment 156339](/attachment.cgi?id=156339 "Fix the overflows") [[details]](/attachment.cgi?id=156339&action=edit "Fix the overflows") [[diff]](/attachment.cgi?id=156339&action=diff "Fix the overflows") [[review]](/page.cgi?id=splinter.html&ignore=&bug=255067&attachment=156339)
Fix the overflows
please don't request approval until you have a fully reviewed patch. thanks.
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: approval1.7.3?
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: approval-aviary?

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=255067#c26)• 20 years ago |
|  | |

(In reply to [comment #7](/show_bug.cgi?id=255067#c7 "VERIFIED FIXED - BMP integer overflow exploits"))
> cbiesinger, can you help look at the other decoders too? going to try and get
> dveditx and dbaron together tomorrow to come up with a plan.
I was on vacation w/o net access until today... I'll try to look at the other
decoders during the next few days

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=255067#c27)• 20 years ago |
|  | |

possible issues in other decoders-
(note: I only looked at issues like the one here, i.e. where too small a buffer
is allocated due to overflowing integers)
gif:
il\_BACat adds two size\_t and allocs that, and writes into the buffer. If that
overflows, data would be written to unallocated memory, possibly overwriting
other stuff; but I can't tell whether those two ints come from untrusted sources.
gs->gathered, one of the args, seems to be limited to (0xFFFFFFL), so that
should be safe.
imgContainerGIF.cpp has this code:
void imgContainerGIF::BlackenFrame(gfxIImageFrame \*aFrame,
PRInt32 aX, PRInt32 aY,
PRInt32 aWidth, PRInt32 aHeight)
[...]
const PRUint32 bprToWrite = width \* bpp;
[...]
PRUint8\* tmpRow = NS\_STATIC\_CAST(PRUint8\*, nsMemory::Alloc(bprToWrite));
If aWidth were large enough, this would overflow. But, only zeroes would be
written to that memory. (why does this not use calloc?). Also, the arguments
seem to come always from a gfxIImageFrame's rect, and the patch here limits
those sizes. that should be enough defense, I think...
jpeg:
here we have:
row\_stride = mInfo.output\_width \* 3;
...
mSamples = (\*mInfo.mem->alloc\_sarray)((j\_common\_ptr) &mInfo,
JPOOL\_IMAGE,
row\_stride, 1);
#if defined(XP\_WIN) || defined(XP\_OS2) || defined(XP\_BEOS) || defined(XP\_MAC) ||
defined(XP\_MACOSX) || defined(MOZ\_WIDGET\_PHOTON)
// allocate buffer to do byte flipping / padding
mRGBRow = (PRUint8\*) PR\_MALLOC(row\_stride);
if output\_width is sufficiently high, that int would overflow, and not enouhg
memory would be allocated. the previous patch's gfxImageFrame check prevents
reaching this code in that case, though.
(hm... these two allocations are never checked for success, so in out-of-memory
situations, the jpeg decoder owuld likely cause a crash)
later in this file:
PRUint32 new\_backtrack\_buflen = src->pub.bytes\_in\_buffer +
src->decoder->mBackBufferLen;
if (src->decoder->mBackBufferSize < new\_backtrack\_buflen) {
PRUint32 roundup\_buflen = ((new\_backtrack\_buflen + 15) >> 4) << 4;
src->decoder->mBackBuffer = (JOCTET\*)PR\_MALLOC(roundup\_buflen);
that addition looks safe, from the names of the variables, since bytes\_in\_buffer
is unlikely to be very high... I haven't verified this though.
PNG:
decoder->interlacebuf = (PRUint8 \*)nsMemory::Alloc(decoder->ibpr\*height);
looks like exactly the same issue. again, the gfxImageFrame patch in this bug
prevents reaching this code if height is too high.

|  | [Gaël Delalleau](/user_profile?user_id=151061) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=255067#c28)• 20 years ago |
|  | |

Hi,
You added a sanity check in nsImageWin.cpp in ::Init. Maybe you want to do the
same with the other OSes, and do some additional audit work on these source code
files.
For instance I just looked at nsImageMac.cpp, and I saw in
nsImageMac::CreateGWorldInternal (called by nsImageMac::Init), we have the same
problem :
PRInt32 imageSize = rowBytes \* aHeight;
char\* imageBits = (char\*)calloc(imageSize, 1);
where rowBytes can be ((aWidth \* aDepth + 31) / 32) \* 4
Even with the current 0xffff limit for the height and width, there is an integer
overflow here, which I bet may be a good candidate for arbitrary heap overwrite
(not verified, no time left today)... so maybe investigate that and other spots
like this before marking the bug as fixed.

|  | [Gaël Delalleau](/user_profile?user_id=151061) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=255067#c29)• 20 years ago |
|  | |

Another possibility is not doing any sanity check in the OS-dependent parts, and
to do all the sanity checks in gfxImageFrame.cpp (at first sight they seem good
enough to prevent this overflow).
With the hope gfxImageFrame::Init is always called before the OS-specific parts,
and that its failure is always fatal.

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=255067#c30)• 20 years ago |
|  | |

now that this bug as been marked fix and the first patch has landed might be
good to spin off the addition research and work into new bug(s). that will make
it easy to escalate and get on the radar of new releases if any addition al
problems are found.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a2993280_1689)• 20 years ago |

Group: securitySeverity: critical → enhancementWhiteboard: [sg:fix] fixed1.7.2+ → [sg:fix] fixed1.7.3

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a3027018_1689)• 20 years ago |

Severity: enhancement → critical

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a3036175_1689)• 20 years ago |

Blocks: [sbb+](/show_bug.cgi?id=256197 "RESOLVED WORKSFORME - Security Bug Bounty: awarded")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a3036288_1689)• 20 years ago |

No longer blocks: [sbb?](/show_bug.cgi?id=256195 "RESOLVED WORKSFORME - Security Bug Bounty: nominated")

|  | [Mike Kaply [:mkaply]](/user_profile?user_id=7313) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a4380268_7313)• 20 years ago |

[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: superreview?(tor)
[Attachment #156339](/attachment.cgi?id=156339&action=edit "Fix the overflows") -
Flags: review?(pavlov)

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=255067#c31)• 20 years ago |
|  | |

verified on windows 1.7.5 12/15Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=255067#a11675260_1689)• 20 years ago |

Keywords: [fixed1.7.5](/buglist.cgi?keywords=fixed1.7.5&resolution=---) → [fixed1.7.3](/buglist.cgi?keywords=fixed1.7.3&resolution=---)Whiteboard: [sg:fix] fixed1.7.3 → [sg:fix]
You need to [log in](/show_bug.cgi?id=255067&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.kb.cert.org_dd200e6c_20250124_130216.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#847200

## Mozilla contains integer overflows in bitmap image decoder

#### Vulnerability Note VU#847200

Original Release Date: 2004-09-17 | Last Revised: 2004-09-17

---

### Overview

A vulnerability in the way Mozilla and its derived programs handle certain bitmap images could allow a remote attacker to execute arbitrary code on a vulnerable system.

### Description

| The [Mozilla web browser](http://www.mozilla.org/products/mozilla1.x/) and related [Mozilla products](http://www.mozilla.org/products/) support the ability to natively display a number of image formats. Multiple integer overflow errors exist in the way that some versions of these products handle bitmap images (.bmp). These errors result in various vulnerabilities when the affected application handles overly wide bitmap files. An attacker with the ability to supply a specially crafted bitmap image to the affected application may be able to exploit these vulnerabilities. Such malicious images could be supplied remotely in a web page or in an email message. |
| --- |

### Impact

| The impacts of these vulnerabilities vary depending on what system the software is running on. In some cases, a remote attacker may be able to execute arbitrary code with the privileges of the user running an affected program. In other cases, an attacker may be able to cause the affected program to crash. |
| --- |

### Solution

| **Upgrade to a fixed version of the affected software**  [The Mozilla Project](http://www.mozilla.org/) has released new versions of the affected software that include patches for this vulnerability. Please see the Systems Affected section of this document for more information. |
| --- |

| **Workarounds**  Users who are unable to upgrade to a patched version of the software are encouraged to disable image loading in their affected product. |
| --- |

### Vendor Information

847200
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23847200/) to view vendors.**
### [Mozilla](#CRDY-64WKJX) Affected

Updated:  September 17, 2004

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

The Mozilla project has released the following versions of the affected software that contain a patch for this issue:

- [Mozilla 1.7.3](http://www.mozillazine.org/talkback.html?article=5269)
- [Firefox Preview Release](http://www.mozilla.org/products/firefox/)
- [Thunderbird 0.8](http://www.mozillazine.org/talkback.html?article=5270)

Users are strongly encouraged to upgrade to one of these versions.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://bugzilla.mozilla.org/show_bug.cgi?id=255067>
* <http://secunia.com/advisories/12526/>
### Acknowledgements

Information about this issue was originally published by the Mozilla Project. The Mozilla Project, in turn, credits Gaël Delalleau with the discovery and reporting of this issue.

This document was written by Chad R Dougherty.

### Other Information

| **CVE IDs:** | [None](http://web.nvd.nist.gov/vuln/detail/None) |
| --- | --- |
| **Severity Metric:** | 23.14 |
| **Date Public:** | 2004-09-14 |
| **Date First Published:** | 2004-09-17 |
| **Date Last Updated:** | 2004-09-17 18:09 UTC |
| **Document Revision:** | 10 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800


