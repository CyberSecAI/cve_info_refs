=== Content from www.kb.cert.org_7ce1d768_20250124_183206.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#784278

## Mozilla fails to validate the DN of X.509 certificates

#### Vulnerability Note VU#784278

Original Release Date: 2004-08-23 | Last Revised: 2004-08-25

---

### Overview

Mozilla fails to verify that the Distinguished Name (DN) of an X.509 certificate is unique when importing it. A denial of service occurs when Mozilla imports a specially crafted, self-signed certificate that has the same DN as an existing Certificate Authority (CA) root certificate.

### Description

| Mozilla version 1.7.1 and earlier can import a self-signed certificate with the same DN as an existing CA root certificate. When this occurs, the imported certificate will override the CA root certificate. Mozilla will return an error when attempting to create a secure connection to a website whose certificate is signed by a CA root certificate that has been overridden in this manner. A remote attacker can automate exploitation of this vulnerability using the "application/x-x509-email-cert" MIME type. This will permit Mozilla to import the certificate without any user intervention. |
| --- |

### Impact

| A remote attacker could cause a denial of service against the certificate store, preventing the user from accessing SSL websites. |
| --- |

### Solution

| This issue has been resolved in the following versions:  [Mozilla 1.7.2](http://www.mozilla.org/products/mozilla1.x/)[Firefox 0.9.3](http://www.mozilla.org/products/firefox/)[Thunderbird 0.7.3](http://www.mozilla.org/products/thunderbird/)For other Mozilla-based products, please check with your vendor for updates. |
| --- |

### Vendor Information

784278
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23784278/) to view vendors.**
### [Gentoo Linux](#WDON-646PME) Affected

Updated:  August 24, 2004

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

The CERT/CC has no additional comments at this time.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### [Mozilla](#WDON-63WNUZ) Affected

Updated:  August 23, 2004

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

Please see [Mozilla bug 249004](http://bugzilla.mozilla.org/show_bug.cgi?id=249004).

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://www.mozilla.org/projects/security/known-vulnerabilities.html>
* <http://bugzilla.mozilla.org/show_bug.cgi?id=249004>
* <http://xforce.iss.net/xforce/xfdb/16706>
* <http://secunia.com/advisories/12076/>
### Acknowledgements

This was reported on the Mozilla Known Vulnerabilities List. Mozilla attributes this report to Marcel Boesch.

This document was written by Will Dormann.

### Other Information

| **CVE IDs:** | [CVE-2004-0758](http://web.nvd.nist.gov/vuln/detail/CVE-2004-0758) |
| --- | --- |
| **Severity Metric:** | 5.18 |
| **Date Public:** | 2004-06-29 |
| **Date First Published:** | 2004-08-23 |
| **Date Last Updated:** | 2004-08-25 14:10 UTC |
| **Document Revision:** | 12 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from www.mozilla.org_20190b78_20250124_183207.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security
* Known Vulnerabilities

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Known Vulnerabilities in Mozilla Products

The links below list security vulnerabilities known to affect
particular versions of Mozilla products and instructions on what users
can do to protect themselves. The lists will be added to when new security
problems are found. For a complete list not sorted by product or version
please see the [Mozilla Foundation Security Advisories](/en-US/security/advisories/).

Please read
[Mozilla.org's security bug policy](/en-US/about/governance/policies/security-group/bugs/) for information on how we handle
security bugs. If you have found a security problem which is not on this
list and has not already been filed as a bug in
[Bugzilla](https://bugzilla.mozilla.org/query.cgi),
or if you find errors or inconsistencies in this list, please
mail us.
If needed our PGP key can be found on the main
[security](/en-US/security/#pgpkey) page.

## Product Advisories

* [Firefox](/en-US/security/known-vulnerabilities/firefox/)
* [Firefox ESR](/en-US/security/known-vulnerabilities/firefox-esr/)
* [Firefox for iOS](/en-US/security/known-vulnerabilities/firefox-for-ios/)
* [Firefox OS](/en-US/security/known-vulnerabilities/firefox-os/)
* [Mozilla VPN](/en-US/security/known-vulnerabilities/mozilla-vpn/)
* [Thunderbird](/en-US/security/known-vulnerabilities/thunderbird/)
* [Thunderbird ESR](/en-US/security/known-vulnerabilities/thunderbird-esr/)
* [SeaMonkey](/en-US/security/known-vulnerabilities/seamonkey/)

## Advisories for older products

### Firefox

* [Firefox 3.6](/en-US/security/known-vulnerabilities/firefox-3.6/)
* [Firefox 3.5](/en-US/security/known-vulnerabilities/firefox-3.5/)
* [Firefox 3.0](/en-US/security/known-vulnerabilities/firefox-3.0/)
* [Firefox 2.0](/en-US/security/known-vulnerabilities/firefox-2.0/)
* [Firefox 1.5](/en-US/security/known-vulnerabilities/firefox-1.5/)
* [Firefox 1.0](/en-US/security/known-vulnerabilities/firefox-1.0/)

### Thunderbird

* [Thunderbird 3.1](/en-US/security/known-vulnerabilities/thunderbird-3.1/)
* [Thunderbird 3.0](/en-US/security/known-vulnerabilities/thunderbird-3.0/)
* [Thunderbird 2.0](/en-US/security/known-vulnerabilities/thunderbird-2.0/)
* [Thunderbird 1.5](/en-US/security/known-vulnerabilities/thunderbird-1.5/)
* [Thunderbird 1.0](/en-US/security/known-vulnerabilities/thunderbird-1.0/)

### SeaMonkey

* [SeaMonkey 2.0](/en-US/security/known-vulnerabilities/seamonkey-2.0/)
* [SeaMonkey 1.1](/en-US/security/known-vulnerabilities/seamonkey-1.1/)
* [SeaMonkey 1.0](/en-US/security/known-vulnerabilities/seamonkey-1.0/)

### Older

* [Mozilla Suite 1.7](/en-US/security/known-vulnerabilities/mozilla-suite/)
* [Older vulnerabilities](/en-US/security/known-vulnerabilities/older-vulnerabilities/)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.redhat.com_1275c145_20250124_183211.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D127186)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D127186)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D127186)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 127186

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 127186**](show_bug.cgi?id=127186)
- [CAN-2004-0758](https://access.redhat.com/security/cve/CVE-2004-0758) Overriding built-in certificate leading to error -8182 (DoS), especially exploitable by email

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CAN-2004-0758 Overriding built-in certificate leading to error -8182 (DoS), e...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Red Hat Enterprise Linux 3 | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Red Hat | | [Component:](describecomponents.cgi?product=Red Hat Enterprise Linux 3 "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | mozilla | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 3.0 | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Christopher Aillon | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Ben Levenson | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://banquo.inf.ethz.ch:8080/> | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=127186&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=127186&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2004-07-03 14:16 UTC by Marcel Boesch | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2007-11-30 22:07 UTC ([History](show_activity.cgi?id=127186)) | | [CC List:](page.cgi?id=fields.html#cclist) | 4 users (show)  barryn bressers hauser mjc | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2004-08-04 21:49:25 UTC | | | Target Upstream Version: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2004:421](https://access.redhat.com/errata/RHSA-2004%3A421) | 0 | high | SHIPPED\_LIVE | Critical: mozilla security update | 2004-08-04 04:00:00 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=127186#c0)  Marcel Boesch    2004-07-03 14:16:03 UTC  ``` Description of problem:  /*(see <https://banquo.inf.ethz.ch:8080/> for a close description)*/ /*Mozilla.org has been informed and a bug has been filed*/   Importing a self-made certificate (call it x) with the same DN as a built-in CA root cert (called b) overrides the built-in one: trying to open a SSL page protected by a cert signed by b throws an error -8182 ('certificate presented by xyz.com is invalid or corrupt') -> Denial of Service.  This could be automated when importing x via mime type application/x-x509-email-cert, causing Mozilla to import the cert silently (bug Nr. 2).  This is also possible via email messages, calling the cert x link inside an <iframe> tag, leading to a silent import of x when opening or previewing the message (bug Nr. 3).  Conclusion: fully automatical DoS of the entire cert store via email is possible, no user interaction needed.   How reproducible: always. Tested with Mozilla 1.6 and 1.7 Mozilla 1.0.2 is NOT vulnerable.  Steps to Reproduce:  1. craft a self-signed cert (openssl) with the same DN as a built-in CA root cert. 2. import it into the cert store, either manually or by providing it as pem encoded using the mime content type application/x-x509-email-cert for _silent import_. 3. Your certificate store is "corrupted" from this time on: open a web site protected by an SSL certificate signed by the root CA cert you've been forging and you'll get an error -8182.   4. The same could be reached via email when including an <ifram> pointing to the certs' location, leading to fully automatical silent import of the cert.     Actual Results:   Mozilla imports the "forged" root cert  into the "authorities" tab of the cert manager as an untrusted root. You can identify it by the column "security device": its stored in the  "software security device" instead of the "Builtin Object Token". However your certificate store is "corrupted" from this time on: open a web site protected by an SSL certificate signed by the root CA cert you've been forging and you'll get an error -8182.    Expected Results:   Mozilla silently (without any warning/message!) imports the root cert into the "authorities" tab of the cert manager as an untrusted root when serving it as type application/x-x509-email-cert. According to the principles Visibility and Clarity for 'safe and secure CA-related UI-Dialogs' proposed in chapter 4.2. of my diploma thesis, instead of no user-feedback, an adequate treatment of this situation would be to show the import dialogue.  During my diploma thesis on Rogue CA's possibilities, one part of the work was to evaluate today's browsing software.   Contact me: This bug was found as part of my diploma thesis which is still going on. If you have any suggestions or ideas, contact me at  marboesc.ch (PGP Key: 0x0AA132A7141D27C8   ```  [Comment 1](show_bug.cgi?id=127186#c1)  Ralf Hauser    2004-07-03 14:40:47 UTC  ``` already reported as <http://bugzilla.mozilla.org/show_bug.cgi?id=249004> on 040629, but no reaction there ?!?! Also, no echo from reporting to cert.org 2 days ago...   ```  [Comment 2](show_bug.cgi?id=127186#c2)  Marcel Boesch    2004-07-04 18:50:41 UTC  ``` The bug is also tracked at  [Http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=257559](http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=257559)      ```  [Comment 4](show_bug.cgi?id=127186#c4)  Mark J. Cox    2004-08-04 08:16:02 UTC  ``` Will be part of a Mozilla 1.4.3 update for RHEL users shortly.   ```  [Comment 5](show_bug.cgi?id=127186#c5)  Mark J. Cox    2004-08-04 21:49:25 UTC  ```  An errata has been issued which should help the problem  described in this bug report. This report is therefore being  closed with a resolution of ERRATA. For more information on the solution and/or where to find the updated files,  please follow the link below. You may reopen this bug report  if the solution does not work for you.  <http://rhn.redhat.com/errata/RHSA-2004-421.html>    ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=127186&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_919b05f7_20250126_024758.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.redhat.com_a9c030f8_20250124_183209.html ===

[Skip to content](#rhb-main-content)
## Featured links

* [![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)](https://www.redhat.com/en/summit)
* [Support](https://access.redhat.com/)
* [Documentation](https://docs.redhat.com/en)
* [Console](https://cloud.redhat.com/)
* [Developers](https://developers.redhat.com/)
* [Start a trial](/en/products/trials)
* All Red Hat
  + For customers
    - [Customer support](https://access.redhat.com/)
    - [Subscription management](https://access.redhat.com/management)
    - [Support cases](https://access.redhat.com/support/cases)
    - [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
    - [Find a partner](https://catalog.redhat.com/partners)
  + For partners
    - [Partner portal](https://connect.redhat.com/partner-admin/dashboard)
    - [Partner support](https://connect.redhat.com/en/support)
    - [Become a partner](https://connect.redhat.com/)
  + Try, buy, & sell
    - [Red Hat Marketplace](https://marketplace.redhat.com/en-us)
    - [Red Hat Store](https://www.redhat.com/en/store)
    - [Contact sales](/en/contact)
    - [Start a trial](/en/products/trials)
  + Learning resources
    - [Documentation](https://docs.redhat.com/en)
    - [Training and certification](/en/services/training-and-certification)
    - [Hybrid cloud learning hub](https://cloud.redhat.com/learn)
    - [Interactive labs](/en/interactive-labs)
    - [Learning community](https://learn.redhat.com/)
    - [Red Hat TV](https://tv.redhat.com)
  + Open source communities
    - [Global advocacy](https://access.redhat.com/accelerators)
    - [How we contribute](/en/about/our-community-contributions)
[Red Hat](/en)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* Explore more
### Platform products

* [Red Hat Enterprise LinuxA flexible, stable operating system to support hybrid cloud innovation.](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShiftA container platform to build, modernize, and deploy applications at scale.](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation PlatformNew versionA foundation for implementing enterprise-wide automation.](/en/technologies/management/ansible)
### Try & buy

* [Start a trialAssess a product with a no-cost trial.](/en/products/trials)
* [Buy onlineBuy select products and services in the Red Hat Store.](https://www.redhat.com/en/store)
* [Integrate with major cloud providersBuy Red Hat solutions using committed spend from providers, including:
  ![Cloud providers: Amazon Web Services, Microsoft Azure, and Google Cloud](https://www.redhat.com/rhdc/managed-files/cloud-providers-2x.png)](/en/partners/certified-cloud-and-service-providers)
### Featured

* [Red Hat Enterprise Linux AI](/en/technologies/linux-platforms/enterprise-linux/ai)
* [Red Hat OpenShift AI](/en/technologies/cloud-computing/openshift/openshift-ai)
* [Red Hat OpenShift Virtualization](/en/technologies/cloud-computing/openshift/virtualization)
* [Red Hat OpenShift Service on AWS](/en/technologies/cloud-computing/openshift/aws)
* [Microsoft Azure Red Hat OpenShift](/en/technologies/cloud-computing/openshift/azure)
[See all products](/en/technologies/all-products)

* [Application platformSimplify the way you build, deploy, manage, and secure apps across the hybrid cloud.](/en/solutions/application-platform)
* [Artificial intelligenceBuild, deploy, and monitor AI models and apps with Red Hat's open source platforms.](/en/solutions/ai)
* [Edge computingDeploy workloads closer to the source with security-focused edge technology.](/en/products/edge)

* [IT automationUnite disparate tech, teams, and environments with 1 comprehensive automation platform.](/en/solutions/it-automation)
* [Linux standardizationGet consistency across operating environments with an open, flexible infrastructure.](/en/solutions/linux-standardization)

* [SecurityDeliver software using trusted platforms and real-time security scanning and remediation.](/en/solutions/trusted-software-supply-chain)
* [VirtualizationModernize operations using a single platform for virtualized and containerized workloads.](/en/solutions/virtualization)
### By industry

* [Automotive](/en/solutions/automotive)
* [Financial services](/en/solutions/financial-services)
* [Healthcare](/en/solutions/healthcare)
* [Industrial sector](/en/solutions/industrial-sector)
* [Media and entertainment](/en/solutions/media-entertainment)
* [Public sector](/en/solutions/public-sector)
* [Telecommunications](/en/solutions/telecommunications)
[Explore solutions](/en/solutions)
### [Services](/en/services)

* [Consulting](/en/services/consulting)
* [Services for AI](/en/services/consulting/red-hat-consulting-for-ai)
* [Technical Account Management](/en/services/support/technical-account-management)
### [Training & certification](/en/services/training-and-certification)

* [All courses and exams](/en/services/training/all-courses-exams)
* [All certifications](/en/services/certifications)
* [Verify a certification](https://www.redhat.com/rhtapps/services/verify/)
* [Skills assessment](https://skills.ole.redhat.com)
* [Learning subscription](/en/services/training/learning-subscription)
* [Learning community](https://learn.redhat.com/)
* [Red Hat Academy](/en/services/training/red-hat-academy)
* [FAQs](/en/services/training-and-certification/faq)
* [Connect with learning experts](/en/services/training-and-certification/contact-us)
### Featured

* [Ansible Basics: Automation Technical Overview (No cost)](/en/services/training/do007-ansible-essentials-simplicity-automation-technical-overview)
* [Containers, Kubernetes and Red Hat OpenShift Technical Overview (No cost)](/en/services/training/do080-deploying-containerized-applications-technical-overview)
* [Red Hat Enterprise Linux Technical Overview (No cost)](/en/services/training/rh024-red-hat-linux-technical-overview)
* [Red Hat Certified System Administrator exam](/en/services/training/ex200-red-hat-certified-system-administrator-rhcsa-exam)
* [Red Hat System Administration I](/en/services/training/rh124-red-hat-system-administration-i)
[Explore services](/en/services)
### Topics

* [AI](/en/topics/ai)
* [Application modernization](/en/topics/application-modernization)
* [Automation](/en/topics/automation)
* [Cloud computing](/en/topics/cloud-computing)
* [Cloud-native applications](/en/topics/cloud-native-apps)
* [Containers](/en/topics/containers)
* [DevOps](/en/topics/devops)
* [Edge computing](/en/topics/edge-computing)
* [Linux](/en/topics/linux)
* [Virtualization](/en/topics/virtualization)
* [See all topics](/en/topics)
### Articles

* [What is InstructLab?](/en/topics/ai/what-is-instructlab)
* [What are cloud services?](/en/topics/cloud-computing/what-are-cloud-services)
* [What is edge computing?](/en/topics/edge-computing/what-is-edge-computing)
* [What is hybrid cloud?](/en/topics/cloud-computing/what-is-hybrid-cloud)
* [Why build a Red Hat cloud?](/en/topics/cloud-computing/why-choose-red-hat-cloud)
* [Cloud vs. edge](/en/topics/cloud-computing/cloud-vs-edge)
* [Red Hat OpenShift vs. Kubernetes](/en/technologies/cloud-computing/openshift/red-hat-openshift-kubernetes)
* [Learning Ansible basics](/en/topics/automation/learning-ansible-tutorial)
* [What is Linux?](/en/topics/linux/what-is-linux)
### More to explore

* [Blog](/en/blog)
* [Customer success stories](/en/success-stories)
* [Events and webinars](/en/events)
* [Newsroom](/en/about/newsroom)
* [Podcasts and video series](/en/red-hat-original-series)
* [Documentation](https://docs.redhat.com/en)
* [Resource library](/en/resources)
* [Training and certification](/en/services/training-and-certification)
[Explore resources](/en/resources)
### For customers

* [Our partners](/en/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
### For partners

* [Partner Connect](https://connect.redhat.com)
* [Become a partner](https://connect.redhat.com/en/benefits-of-being-a-partner)
* [Training](https://connect.redhat.com/en/training)
* [Support](https://connect.redhat.com/en/support)
* [Access the partner portal](https://connect.redhat.com/partner-admin/dashboard)
### About us

* [Our company](/en/about/company)
* [How we work](/en/about/our-culture)
* [Our social impact](/en/about/community-social-responsibility)
* [Development model](/en/about/development-model)
* [Subscription model](/en/about/value-of-Red-Hat)
* [Product support](/en/services/support)
### Open source

* [Open source commitments](/en/about/open-source)
* [How we contribute](/en/about/our-community-contributions)
* [Red Hat on GitHub](https://github.com/RedHatOfficial)
### Company details

* [Analyst relations](/en/about/analysts)
* [Blog](/en/blog)
* [Locations](/en/about/office-locations)
* [Newsroom](/en/about/newsroom)
[Explore Red Hat](/en/about)[Contact us](/en/contact)For customers

* [Customer support](https://access.redhat.com/)* [Subscription management](https://access.redhat.com/management)* [Support cases](https://access.redhat.com/support/cases)* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)* [Find a partner](https://catalog.redhat.com/partners)
For partners

* [Partner portal](https://connect.redhat.com/partner-admin/dashboard)* [Partner support](https://connect.redhat.com/en/support)* [Become a partner](https://connect.redhat.com/)
Try, buy, & sell

* [Red Hat Marketplace](https://marketplace.redhat.com/en-us)* [Red Hat Store](https://www.redhat.com/en/store)* [Contact sales](/en/contact)* [Start a trial](/en/products/trials)
Learning resources

* [Documentation](https://docs.redhat.com/en)* [Training and certification](/en/services/training-and-certification) * [Hybrid cloud learning hub](https://cloud.redhat.com/learn)* [Interactive labs](/en/interactive-labs)* [Learning community](https://learn.redhat.com/)* [Red Hat TV](https://tv.redhat.com)
Open source communities

* [Global advocacy](https://access.redhat.com/accelerators)* [How we contribute](/en/about/our-community-contributions)
For you
New
### Recommendations

As you browse redhat.com, we'll recommend resources you may like. For now, try these.

---

* [All Red Hat products](/en/technologies/all-products)
* [Tech topics](/en/topics)
* [Red Hat resources](/en/resources)
![close](https://static.redhat.com/libs/redhat/rh-iconfont/latest/svg/web-icon-close.svg)[![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)Red Hat Summit](https://www.redhat.com/en/summit)[Support](https://access.redhat.com/)[Documentation](https://docs.redhat.com/en)[Console](https://cloud.redhat.com/)[Developers](https://developers.redhat.com/)[Start a trial](/en/products/trials)[Contact](/en/contact)Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol[Contact us](/en/contact)
English
### Select a language

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)
Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol![](/themes/custom/rh_base_ui/dist/img/talk-bubble.svg)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* [Contact us](/en/contact)

### Select a language

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)

# Red Hat Support

## Go beyond support by engaging with our experts

Our teams collaborate with you to ensure you accomplish your goals with Red Hat solutions. The relationship we build with you is designed to provide you with the tools and resources you need to find success on your IT journey.

![](/rhdc/managed-files/support-header.svg)

## Configured for your success

We develop a holistic understanding of your experience as a customer by ensuring our support and engineering teams work together.

Our support team works hand in hand with the best engineers in the industry to quickly turn customer feedback into product improvements. This direct line of communication allows us to hone in on proactive fixes that can impact your bottom line.

### Quick links

* Search our [Knowledgebase](https://access.redhat.com/search/#/?q=&p=1&sort=relevant&scoped&documentKind=Knowledgebase)
* Find [product documentation](https://access.redhat.com/documentation/en-us/)
* Access the [product security center](https://access.redhat.com/security/)
* Connect with [our support team](https://access.redhat.com/support)
* Team up with a [technical account manager](/en/services/support/technical-account-management "Technical account management")
* Take advantage of [partner support](https://connect.redhat.com/en/support)

## Find the right level of support

We have different tiers of support designed to meet your unique needs.

|  | Self-support | Standard | Premium |
| --- | --- | --- | --- |
| Access to Red Hat products | checkmark | checkmark | checkmark |
| Access to our knowledgebase and tools in our award-winning Customer Portal | checkmark | checkmark | checkmark |
| Access to support engineers during standard business hours |  | checkmark | checkmark |
| Access to support engineers 24x7 for high-severity issues |  |  | checkmark |

We also feature specialized support options that can be tailored to the unique needs of companies of all sizes and industries. The Red Hat® [Enhanced Solution Support](/en/resources/enhanced-solution-support-datasheet "Red Hat Enhanced Solution Support: 24x7 engineering support") offering reduces downtime and boosts confidence through access to senior level engineers, as well as resolution and restoration SLAs—helping you stay up and running as you innovate, scale, and deploy. Our engineers help restore your operations quickly and accelerate the path to final resolution, identifying the root cause which helps protect against recurrences in the future. Enhanced Solution Support engineers, who are already familiar with your environment, will be there to assist with critical issues in production environments so that you can consistently deliver the cloud services your customers demand. This offering is available for Red Hat OpenShift® and Red Hat OpenStack® Platform customers.

### Personalized support

Connect with a technical adviser for collaborative planning and specialized guidance. Our Technical Account Managers help you streamline deployments, resolve issues, and shape your technology strategy to meet your toughest business challenges.

[Explore Technical Account Management](/en/services/support/technical-account-management)

## Award winners since 2011

We’ve evolved the traditional software subscription model, combining the best elements of our services to exceed customer expectations. The Association of Support Professionals has honored Red Hat’s Customer Portal as one of “The Top Ten Best Support Websites” for 13 years running.

[See why the Customer Portal keeps earning industry recognition](https://access.redhat.com/)

![Gold and green star with text ASP best support websites of 2023](/rhdc/managed-files/ASP-Award-Design.jpg)

## What they're saying

![BSE logo](/rhdc/managed-files/bse-logo-2.png)

> Icon-Red\_Hat-Media\_and\_documents-Quotemark\_Open-B-Red-RGB
>
> We have found the support from Red Hat to be exemplary. Whenever we need anything from them, they have given it … Red Hat is now our backbone. Our business cannot run if Red Hat is not there.
>
> Ashishkumar Chauhan
>
> CEO, BSE

> Icon-Red\_Hat-Media\_and\_documents-Quotemark\_Open-B-Red-RGB
>
> I like the fact that they really dig into things and then provide answers. As the single Linux guy, I kind of need that second admin next to me sometimes to say, "Hey, what about this?" and I am able to do that through the portal. I get my questions answered and trouble tickets resolved.
>
> Erik Widholm
>
> Sr. Enterprise Engineer

[Read more user reviews](/en/technologies/linux-platforms/enterprise-linux/user-reviews)

## Have questions?

[Contact Support team](https://access.redhat.com/support)

[Visit the Customer Portal](https://access.redhat.com/)

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](/en)[LinkedIn](https://www.linkedin.com/company/red-hat)[YouTube](https://www.youtube.com/user/RedHatVideos)[Facebook](https://www.facebook.com/redhatinc)[X](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](/en/technologies/management/ansible)
* [Cloud services](/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](/en/technologies/all-products)

### Tools

* [Training and certification](/en/services/training-and-certification)
* [My account](https://www.redhat.com/wapps/ugc/protected/personalInfo.html)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Red Hat value calculator](/en/solutions/value-calculator)
* [Documentation](https://docs.redhat.com/en)

### Try, buy, & sell

* [Product trial center](/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Buy online (Japan)](https://www.redhat.com/en/about/japan-buy)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact sales](/en/contact/sales)
* [Contact customer service](/en/contact/customer-service)
* [Contact training](/en/services/training-and-certification/contact-us)
* [Social](/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Select a language

![](https://static.redhat.com/libs/redhat/rh-iconfont/4/svg/web-icon-globe.svg)

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)
### Red Hat legal and privacy links

* [About Red Hat](/en/about/company)
* [Jobs](/en/jobs)
* [Events](/en/events)
* [Locations](/en/about/office-locations)
* [Contact Red Hat](/en/contact)
* [Red Hat Blog](/en/blog)
* [Diversity, equity, and inclusion](/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](/en/about/privacy-policy)
* [Terms of use](/en/about/terms-use)
* [All policies and guidelines](/en/about/all-policies-guidelines)
* [Digital accessibility](/en/about/digital-accessibility)



=== Content from www.gentoo.org_1767ba6a_20250124_183205.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla, Firefox, Thunderbird, Galeon, Epiphany: New releases fix vulnerabilities — GLSA **200408-22**

New releases of Mozilla, Epiphany, Galeon, Mozilla Thunderbird, and Mozilla
Firefox fix several vulnerabilities, including remote DoS and buffer
overflows.

### Affected packages

| Package | **www-client/mozilla** on all architectures |
| --- | --- |
| Affected versions | < **1.7.2** |
| Unaffected versions | >= **1.7.2** |

| Package | **www-client/mozilla-firefox** on all architectures |
| --- | --- |
| Affected versions | < **0.9.3** |
| Unaffected versions | >= **0.9.3** |

| Package | **mail-client/mozilla-thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **0.7.3** |
| Unaffected versions | >= **0.7.3** |

| Package | **www-client/mozilla-bin** on all architectures |
| --- | --- |
| Affected versions | < **1.7.2** |
| Unaffected versions | >= **1.7.2** |

| Package | **www-client/mozilla-firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **0.9.3** |
| Unaffected versions | >= **0.9.3** |

| Package | **mail-client/mozilla-thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **0.7.3** |
| Unaffected versions | >= **0.7.3** |

| Package | **www-client/epiphany** on all architectures |
| --- | --- |
| Affected versions | < **1.2.7-r1** |
| Unaffected versions | >= **1.2.7-r1** |

| Package | **www-client/galeon** on all architectures |
| --- | --- |
| Affected versions | < **1.3.17** |
| Unaffected versions | >= **1.3.17** |

### Background

Mozilla is a popular web browser that includes a mail and newsreader.
Galeon and Epiphany are both web browsers that use gecko, the Mozilla
rendering engine. Mozilla Firefox is the next-generation browser from
the Mozilla project that incorporates advanced features that are yet to
be incorporated into Mozilla. Mozilla Thunderbird is the
next-generation mail client from the Mozilla project.

### Description

Mozilla, Galeon, Epiphany, Mozilla Firefox and Mozilla Thunderbird
contain the following vulnerabilities:

* All Mozilla tools use libpng for graphics. This library contains a
  buffer overflow which may lead to arbitrary code execution.
* If a user imports a forged Certificate Authority (CA) certificate,
  it may overwrite and corrupt the valid CA already installed on the
  machine.

Mozilla, Mozilla Firefox, and other gecko-based browsers also contain a
bug in their caching which may allow the SSL icon to remain visible,
even when the site in question is an insecure site.

### Impact

Users of Mozilla, Mozilla Firefox, and other gecko-based browsers are
susceptible to SSL certificate spoofing, a Denial of Service against
legitimate SSL sites, crashes, and arbitrary code execution. Users of
Mozilla Thunderbird are susceptible to crashes and arbitrary code
execution via malicious e-mails.

### Workaround

There is no known workaround for most of these vulnerabilities. All
users are advised to upgrade to the latest available version.

### Resolution

All users should upgrade to the latest stable version:

```
 # emerge sync

 # emerge -pv your-version
 # emerge your-version
```
### References

* [CAN-2004-0763](https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0763)
* [CAN-2004-0758](https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0758)
* [CAN-2004-0597](https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0597)
* [CAN-2004-0598](https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0598)
* [CAN-2004-0599](https://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0599)

**Release date**

August 23, 2004

**Latest revision**

December 30, 2007: 06

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [57380](https://bugs.gentoo.org/show_bug.cgi?id=57380)
* [59419](https://bugs.gentoo.org/show_bug.cgi?id=59419)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugzilla.mozilla.org_99dc2e50_20250124_183104.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/249004)
* [XML](/show_bug.cgi?ctype=xml&id=249004)

Closed
[Bug 249004](/show_bug.cgi?id=249004)

Opened 21 years ago
Closed 20 years ago

# Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email

## Categories

### (Core Graveyard :: Security: UI, defect, P2)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Security%3A%20UI#Security%3A%20UI)

Security: UI
▾

Core Graveyard :: Security: UI
PSM client library
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Security%3A%20UI&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Security%3A%20UI&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Security%3A%20UI)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Other Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (Not tracked)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

## People

### (Reporter: marboesc, Assigned: KaiE)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d11b5b0a468ed960df1fde3c304d3580?d=mm&size=40)  [KaiE](/user_profile?user_id=36541)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5258dc1056171ffe77ff56f403a7530a?d=mm&size=40)  [marboesc](/user_profile?user_id=134282)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

43 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[252271](/show_bug.cgi?id=252271 "RESOLVED FIXED - CERT_VerifyCert with param certUsageVerifyCA fails or asserts")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[sbb+](/show_bug.cgi?id=256197 "RESOLVED WORKSFORME - Security Bug Bounty: awarded")

Dependency [tree](/showdependencytree.cgi?id=249004&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=249004)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[174483](/show_bug.cgi?id=174483 "RESOLVED DUPLICATE - Enhance certificate import strategy on incoming messages to avoid bustage")

[184659](/show_bug.cgi?id=184659 "RESOLVED DUPLICATE - Add user dialog to processing of application/x-x509-email-cert")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:fix]blocking1.4.3+)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[fixed-aviary1.0](/buglist.cgi?keywords=fixed-aviary1.0&resolution=---),
[fixed1.4.3](/buglist.cgi?keywords=fixed1.4.3&resolution=---),
[fixed1.7.2](/buglist.cgi?keywords=fixed1.7.2&resolution=---),
[fixed1.7.5](/buglist.cgi?keywords=fixed1.7.5&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:fix]blocking1.4.3+

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

5

Bug Flags:

| [chofmann](/user_profile?user_id=2687) | [blocking-aviary1.0PR](#c0 "21 years ago") | + |
| --- | --- | --- |
| [chofmann](/user_profile?user_id=2687) | blocking-aviary1.0PR | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 10 obsolete files)

| [ditches some content types and seems to fix the problem. against 1.7](/attachment.cgi?id=153139)  [21 years ago](#c16)  [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768)   766 bytes, patch | wtc : [review-](#c30 "21 years ago") | [Details](/attachment.cgi?id=153139&action=edit) | [Diff](/attachment.cgi?id=153139&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153139) |
| --- | --- | --- |
| [testcase usage: nc -l -p 1234 <testcert](/attachment.cgi?id=153140)  [21 years ago](#c17)  [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768)   1.01 KB, text/plain |  | [Details](/attachment.cgi?id=153140&action=edit) |
| [Patch to ImportEmailCerts for discussion](/attachment.cgi?id=153518)  [21 years ago](#c40)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   2.57 KB, patch |  | [Details](/attachment.cgi?id=153518&action=edit) | [Diff](/attachment.cgi?id=153518&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153518) |
| [Patch v2 to ImportEmailCerts](/attachment.cgi?id=153584)  [21 years ago](#c49)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   3.98 KB, patch |  | [Details](/attachment.cgi?id=153584&action=edit) | [Diff](/attachment.cgi?id=153584&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153584) |
| [Patch v3](/attachment.cgi?id=153590)  [21 years ago](#c51)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   18.09 KB, patch |  | [Details](/attachment.cgi?id=153590&action=edit) | [Diff](/attachment.cgi?id=153590&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153590) |
| [( same as before but for moz 140 branch )](/attachment.cgi?id=153596)  [21 years ago](#c52)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   15.05 KB, patch |  | [Details](/attachment.cgi?id=153596&action=edit) | [Diff](/attachment.cgi?id=153596&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153596) |
| [Patch v4](/attachment.cgi?id=153698)  [21 years ago](#c63)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   14.54 KB, patch |  | [Details](/attachment.cgi?id=153698&action=edit) | [Diff](/attachment.cgi?id=153698&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153698) |
| [Patch v5](/attachment.cgi?id=153767)  [21 years ago](#c68)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   15.79 KB, patch |  | [Details](/attachment.cgi?id=153767&action=edit) | [Diff](/attachment.cgi?id=153767&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153767) |
| [Patch v6](/attachment.cgi?id=153783)  [21 years ago](#c79)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   14.75 KB, patch | rrelyea : [review-](#c81 "21 years ago") | [Details](/attachment.cgi?id=153783&action=edit) | [Diff](/attachment.cgi?id=153783&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153783) |
| [Patch v7](/attachment.cgi?id=153803)  [21 years ago](#c83)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   14.87 KB, patch | KaiE : [review+](#c84 "21 years ago")  jst : [superreview+](#a2454048_12352 "21 years ago")  chofmann : [approval1.7.5+](#c0 "20 years ago") | [Details](/attachment.cgi?id=153803&action=edit) | [Diff](/attachment.cgi?id=153803&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153803) |
| [Patch v7 with nits addressed](/attachment.cgi?id=154493)  [20 years ago](#c90)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   11.70 KB, patch | KaiE : [review+](#c91 "20 years ago")  KaiE : [superreview+](#c93 "20 years ago")  asa : [approval-aviary+](#c101 "20 years ago")  caillon : [approval1.4.3+](#c96 "20 years ago")  KaiE : [approval1.7.5+](#c0 "20 years ago") | [Details](/attachment.cgi?id=154493&action=edit) | [Diff](/attachment.cgi?id=154493&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154493) |
| [Patch v7, adjusted for OS/2](/attachment.cgi?id=154521)  [20 years ago](#c98)  [Kai Engert [:KaiE:]](/user_profile?user_id=36541)   11.70 KB, patch |  | [Details](/attachment.cgi?id=154521&action=edit) | [Diff](/attachment.cgi?id=154521&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154521) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=249004#c0)• 21 years ago |
|  | |

User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.6) Gecko/20040206 Firefox/0.8
Build Identifier: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.7) Gecko/20040608
Importing a self-made certificate (call it x) with the same DN (but different
serial nr) as a built-in CA root cert (called b) overrides the built-in one:
trying to open a SSL page protected by a cert signed by b throws an error -8182
('certificate presented by xyz.com is invalid or corrupt') -> Denial of Service.
This could be automated when importing x via mime type
application/x-x509-email-cert, causing Mozilla to import the cert silently (bug
Nr. 2).
This is also possible via email messages, calling the cert x link inside an
<iframe> tag, leading to a silent import of x when opening or previewing the
message (bug Nr. 3).
Conclusion: fully automatical DoS of the entire cert store via email is
possible, no user interaction needed.
Reproducible: Always
Steps to Reproduce:
1. craft a self-signed cert (openssl) with the same DN as a built-in CA root cert.
2. import it into the cert store, either manually or by providing it as pem
encoded using the mime content type application/x-x509-email-cert for \_silent
import\_.
3. Your certificate store is "corrupted" from this time on: open a web site
protected by an SSL certificate signed by the root CA cert you've been forging
(e.g. <https://www.thawte.com/>) and you'll get an error -8182.
4. The same could be reached via email when including an <ifram> pointing to the
certs' location, leading to fully automatical silent import of the cert.
Send me an email to get a link to a page showing it (passwort needed, for legal
reasons): marboesc@student.ethz.ch
Actual Results:
Mozilla imports the "forged" root cert into the "authorities" tab of the cert
manager as an untrusted root. You can identify it by the column "security
device": its stored in the "software security device" instead of the "Builtin
Object Token". However your certificate store is "corrupted" from this time on:
open a web site protected by an SSL certificate signed by the root CA cert
you've been forging (e.g. <https://www.thawte.com/>) and you'll get an error -8182.
Expected Results:
Mozilla silently (without any warning/message!) imports the root cert into the
"authorities" tab of the cert manager as an untrusted root when serving it as
type application/x-x509-email-cert. According to the principles Visibility and
Clarity for 'safe and secure CA-related UI-Dialogs' proposed in chapter 4.2. of
my diploma thesis, instead of no user-feedback, an adequate treatment of this
situation would be to show the import dialogue.
During my diploma thesis on Rogue CA's possibilities, one part of the work was
to evaluate today's browsing software.
Contact me: This bug was found as part of my diploma thesis which is still going
on. If you have any suggestions or ideas, contact me at
marboesc@student.ethz.ch (PGP Key: 0x0AA132A7141D27C8)

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=249004#c1)• 21 years ago |
|  | |

Vulnerability not only in Mozilla for Windows but also affecting Linux, tested
positively for Mozilla 1.6 and 1.7 on debian 3.0 stable.

|  | [Ralf Hauser](/user_profile?user_id=56971) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=249004#c2)• 21 years ago |
|  | |

since there is little echo here, marcel also posted that to cert.org and redhat:
<https://bugzilla.redhat.com/bugzilla/show_bug.cgi?id=127186>
is there a phone number or skype nickname to discuss the issue with anybody?
marcel is marboesc and I am "ralfhauser" on skype

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=249004#c3)• 21 years ago |
|  | |

The bug is also tracked at
<http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=257559>

|  | [Heikki Toivonen (remove -bugzilla when emailing directly)](/user_profile?user_id=4030) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=249004#c4)• 21 years ago |
|  | |

Confirming per comments. Removing security sensitive flag since this was also
posted to n.p.m.cryptoGroup: securityStatus: UNCONFIRMED → NEWEver confirmed: true

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=249004#c5)• 21 years ago |
|  | |

It seems that no-one works on PSM any more.
Here is an NSS-centric view of this.
Error -8182 is "Peer's certificate has an invalid signature."
PSM displays the wrong error code for it.
There is a difference between "importing" a cert and merely encountering it
in an email or on a web site. NSS does not store CA certs in any
"permanent" cert DB (e.g. on disk) merely because they were encountered
in a cert chain. NSS stores certs when the application (e.g. mozilla)
tells it do so. That is "importing" a cert.
In the past, the mozilla applications did not "import" a CA cert
automatically when such a cert was merely encountered.
It's not clear to me from the above description whether the reporter is
asserting that mozilla now DOES import a CA cert upon encountering it, or
if he is merely saying that once the bad CA cert is imported (e.g. by
manual user action) that it has a detrimental affect (which is expected).
It is also possible that a certificate reference leak has crept into PSM
somewhere, resulting in certs continuing to hang around in memory long
after they should have disappeared. That would make it appear to be
imported, until the client was stopped and restarted.

|  | [Ralf Hauser](/user_profile?user_id=56971) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=249004#c6)• 21 years ago |
|  | |

nelson, from what I saw, the wrong root certificate gets into the cert-store
without user interaction and it stays there even after client restart. So, if
you craft about 64 fake root certs (=~ the number of built-in root certs as
currently shipped with mozilla)and put 64 iframe tags into a html mail - a user
just previewing this mail (not even opening it) will essentially no longer be
able to use https with mozilla or netscape. The sample mail marcel has crafted
for proof of concept right now retrieves the rogue cert from a server. I am
sure, however, an ingenuous spammer will find a way to carry the certificates
within the mail like one can do with images (<img src="cid:image0"> tag and
corresponding image mime part) and thus not leave traces that can be easily
prosecuted.

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=249004#c7)• 21 years ago |
|  | |

This is a PSM bug. Enhancements to NSS \*may\* be needed to fix it.
PSM recognizes 3 (or more) different MIME content types for importing certs.
They (or most of them) are documented at
<http://wp.netscape.com/eng/security/comm4-cert-download.html#communicator>
(This is the old Communicator 4 spec, and mozilla still honors that spec.)
The idea is that the MIME type tells the client what type of cert is to
be imported, and the client selects the UI accordingly. What is missing,
apparently, is any enforcement that the type of cert being imported is
in fact the type indicated by the MIME content type.
There are at least 2 possible avenues of approach to fix this:
a) enforce what the MIME type says, or
b) forget the MIME type, and choose UI based on whatever type of cert
you find is actually being presented. I think IE does this.
NSS doesn't know about these MIME types, but PSM does. So, PSM needs to
take the lead in fixing this. If PSM cannot determine what it needs to
know using the existing NSS APIs, then enhancements to NSS's APIs can be
made.
However, the immediate problem is this: NO ONE works on PSM any more,
apparently, witness how long this bug sat before being looked at.
Until we get some staffing on PSM, I don't see how this will be fixed.

|  | [Ralf Hauser](/user_profile?user_id=56971) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=249004#c8)• 21 years ago |
|  | |

Chad form CERT Coordination Center <cert@cert.org> VU#160360

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=249004#c9)• 21 years ago |
|  | |

> There are at least 2 possible avenues of approach to fix this:
> a) enforce what the MIME type says, or
> b) forget the MIME type, and choose UI based on whatever type of cert
> you find is actually being presented. I think IE does this.
I'd propose
c) show a warning when encountering application/x-x509-email-cert mime type,
just as the other mime types do. Doing this at least stops the possibility to
\*silently\* change something in the local cert store, which isn't advisable in
any case in my opinion.

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=249004#c10)• 21 years ago |
|  | |

c is useless. it doesn't solve the problem at all, people would still have an
even chance at choosing the wrong button and becoming victims.Assignee: kaie → brendanOS: other → AllHardware: Other → All

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=249004#c11)• 21 years ago |
|  | |

c at least solves the possibility of a denial-of-service through scripted
importing hundred or thousands of certs.

|  | [Ralf Hauser](/user_profile?user_id=56971) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=249004#c12)• 21 years ago |
|  | |

\*\*\* [Bug 184659](/show_bug.cgi?id=184659 "RESOLVED DUPLICATE - Add user dialog to processing of application/x-x509-email-cert") has been marked as a duplicate of this bug. \*\*\*

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=249004#c13)• 21 years ago |
|  | |

\*\*\* When to warn the users? \*\*\*
Since there is basically no fix of this bug found at the usual places, neither
technical nor at least a resource explaining the cause of bug -8182, I'm scared
of the bad guys start exploiting it. According to my disposition to aid the
users I'd like to divulge this bug and its remedy to a greater audience (like
ZDNET and heise.de).
/marcel

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=249004#c14)• 21 years ago |
|  | |

It's obvious, Mozilla doesn't ask anything if the Content-Type is
application/x-x509-email-cert, the cert is imported silently. If over HTTP, it's
done automatically. If it's in an email attachment, one has to open the
attachment (but the iframe version as outlined by Marcel is possible too).
That alone is IMHO a bug ([bug 184659](/show_bug.cgi?id=184659 "RESOLVED DUPLICATE - Add user dialog to processing of application/x-x509-email-cert")).
I think Nelson is right in b. Currently the place where it's imported (self
signed certs go into "Authorities" even if type is email-cert) is based on the
content and so the UI should base on this too.
Nelson, re [comment #5](/show_bug.cgi?id=249004#c5 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email")
> Error -8182 is "Peer's certificate has an invalid signature."
> PSM displays the wrong error code for it."
True, a break is missing in nsNSSIOLayer.cpp at line 680.
But I think the message could be more informative. Currently I can't see a way
for a user to find out what exactly is wrong.
> that it has a detrimental affect (which is expected).
Is it possible that the preference for additional certs over the builtin with
same DN is by design (don't know if PSM or NSS does this)? I mean, for the case
one wants to insert a new cert from a Root CA if the old (build in) experies or so.

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=249004#c15)• 21 years ago |
|  | |

In response to the questions in [comment 14](/show_bug.cgi?id=249004#c14 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"):
Re the issue about informative error messages:
NSS has many unique error codes that are quite specific about error
problems. Unfortunately, PSM tends to lump many of them together
into a single error message "is invalid or corrupt". The more
specific error cause is programmatically available, but PSM discards
it and substitutes a generic error message. There is a LONG STANDING
bug about this (more than one, actually), and a contribution in the
area of error message handling would be most welcome for PSM.
Re the cert selection algorithm:
NSS's cert selection algorithm, that leads to the newest cert among
certs with the same names, key IDs, etc., is as designed. This bug
report shows no flaw in that algorithm. Only known and trusted
certs should be imported into the DBs.

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=249004#c16)• 21 years ago |
|  | |

Attached patch

[ditches some content types and seems to fix the problem. against 1.7](attachment.cgi?id=153139&action=diff) (obsolete)
— [Details](attachment.cgi?id=153139&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153139)

this seems to fix the problem in 1.7 on linux.
don't know what it breaks.
with it i am still able to browse secure sites and import certificates from
"privacy and security".
have not tested SMIME.

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=249004#c17)• 21 years ago |
|  | |

Attached file
[testcase usage: nc -l -p 1234 <testcert](attachment.cgi?id=153140)
— [Details](attachment.cgi?id=153140&action=edit)

usage:
in a terminal: nc -l -p 1234 <testcert
then from mozilla open: <http://localhost:1234/>
then examine your certicates. if "internet widgets......" certificate is
present, there is bug.

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=249004#c18)• 21 years ago |
|  | |

Your patch is a workaround for the moment, though no solution. It just disables
the MIME types.
Disabling ca-cert is necessary though the user gets asked whether a cert should
get importet. Unfortunately when submitting multiple certificates in a PKCS#7
structure (DER format), the user only gets asked for the first cert and the
following get importet silently when allowing the first one.
Disabling email-cert is necessary of course. But server-cert, user-cert and the
crl types? I wasn't able to import an illegal cert using these types.

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=249004#c19)• 21 years ago |
|  | |

>I wasn't able to import an illegal cert using these types.
"illegal cert" ?? this seems the expected behavior.

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=249004#c20)• 21 years ago |
|  | |

at least "application/x-pkcs7-crl" and "application/x-x509-crl" seem to try to
silently install themselves but give an error probably because i am not using
the correct cert.
"application/x-x509-ca-cert" ask the user for permission.

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=249004#c21)• 21 years ago |
|  | |

> "illegal cert" ?? this seems the expected behavior.
Sorry, let's say "unwanted". And I meant import without disabling server-cert,
user-cert or any crl.
> at least "application/x-pkcs7-crl" and "application/x-x509-crl" seem to try
> to silently install themselves but give an error probably because i am not
> using the correct cert.
I guess a crl is expected, no cert.
> "application/x-x509-ca-cert" ask the user for permission.
Yes, but only for the first cert. As I wrote one can send a dozend certs at once.

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=249004#c22)• 21 years ago |
|  | |

Problem seems to stem from:
<http://lxr.mozilla.org/seamonkey/source/security/manager/ssl/src/nsNSSComponent.cpp#2037>
<http://lxr.mozilla.org/seamonkey/source/security/manager/ssl/src/nsNSSCertificateDB.cpp#427>
=>
<http://lxr.mozilla.org/seamonkey/source/security/manager/ssl/src/nsNSSCertificateDB.cpp#254>
327 nsCOMPtr<nsICertificateDialogs> dialogs;
328 nsresult rv = ::getNSSDialogs(getter\_AddRefs(dialogs),
329 NS\_GET\_IID(nsICertificateDialogs),
330 NS\_CERTIFICATEDIALOGS\_CONTRACTID);
(presumably this is the case that works correctly)
<http://lxr.mozilla.org/seamonkey/source/security/manager/ssl/src/nsNSSCertificateDB.cpp#604>
649 /\* user wants to import the cert \*/
<http://lxr.mozilla.org/seamonkey/source/security/manager/ssl/src/nsNSSCertificateDB.cpp#482>
520 srv = CERT\_ImportCerts(CERT\_GetDefaultCertDB(), certUsageEmailSigner,
521 numcerts, rawCerts, NULL, PR\_TRUE, PR\_FALSE,
522 NULL);
<http://lxr.mozilla.org/seamonkey/source/security/manager/ssl/src/nsCRLManager.cpp#83>
136 crl = SEC\_NewCrl(CERT\_GetDefaultCertDB(), NS\_CONST\_CAST(char\*, url.get()),
&derCrl,
137 aType);

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=249004#c23)• 21 years ago |
|  | |

> (presumably this is the case that works correctly)
That works right if one cert is presented, yes.
> nsNSSCertificateDB.cpp#604
As I wrote, I can't see a problem for user-cert.
The cert doesn't get imported if the public key isn't associated to a private
key in the local db.
> 520 srv = CERT\_ImportCerts(CERT\_GetDefaultCertDB(), certUsageEmailSigner,
That's true. The whole list is thrown into this function without any question.

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=249004#c24)• 21 years ago |
|  | |

i am not sure more than web server certificates need to be managed from the web.
not all users understand how certificates work.
and users always can import the cert from "privacy and security".

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=249004#c25)• 21 years ago |
|  | |

(In reply to [comment #24](/show_bug.cgi?id=249004#c24 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> i am not sure more than web server certificates need to be managed from the web.
> not all users understand how certificates work.
but consider S/MIME certificates from other people, that you want to be able to
write encrypted mails to

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=249004#c26)• 21 years ago |
|  | |

(In reply to [comment #25](/show_bug.cgi?id=249004#c25 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> but consider S/MIME certificates from other people, that you want to be able to
> write encrypted mails to
Do you refer to disabling application/x-x509-email-cert would disable adding a
senders S/MIME certificate to "Other People's"?
In this case, don't mind, it still works.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1328256_1689)• 21 years ago |

Flags: blocking1.8a2?Flags: blocking1.7.2?Flags: blocking-aviary1.0RC1?Whiteboard: [sg:fix]

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=249004#c27)• 21 years ago |
|  | |

Comment on [attachment 153139](/attachment.cgi?id=153139 "ditches some content types and seems to fix the problem. against 1.7") [[details]](/attachment.cgi?id=153139&action=edit "ditches some content types and seems to fix the problem. against 1.7") [[diff]](/attachment.cgi?id=153139&action=diff "ditches some content types and seems to fix the problem. against 1.7") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153139)
ditches some content types and seems to fix the problem. against 1.7
This patch disables importing of all PKIX types.
It makes it impossible for a user to get certificate revocation
information from CAs that don't support OCSP (most CAs).
That would be considered introducing yet another vulnerability.
On that basis, I would give r- to any patch that disables CRL import.
It makes it impossible for a user to get his own new cert, and the
associated chain of CA certs.
It makes it impossible for users to add new CAs to their lists.
mozilla could arguably live with that for a short time.
Disabling application/x-x509-email-cert makes it impossible to
download another user's email from a CA's web site, for the
purpose of sending secure email to that user. But that is not
the primary way that users get the email certs for other users,
so mozilla could live without it for a SHORT time.
The ONE mime content type that seems to be quite unnecessary is
application/x-x509-server-cert, because users get those certs by visiting
the https server itself, not by visiting some other server.
All the others are necessary.
There are several possible solutions to the issue of importing
multiple CA certs at once. When certs are imported, They may be imported
as "temporary" or "permanent" certs. Temporary certs live only as long as
a reference is held in the process. Among the possible solutions are:
a) import the certs as temp certs, then
invoke UI for each new root CA cert that is not already in the perm DB,
then convert the approved temp root CA certs to perm certs, then
convert any intermediate CA certs that can be verified by the trusted
root CAs, and that are not already in the perm DB, into perm certs, then
drop the references to all those temp certs.
b) as a, except import the certs as perm certs, and then delete any
unapproved certs that were just imported.
Without more investigation, I'm not sure if any of those ideas require any
enhancement to NSS or not.

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=249004#c28)• 21 years ago |
|  | |

can someone give a verifiable testcase for which the patch is broken?
as far as i tested, importing certs from "privacy and security" works excelent.
https dialogs also works for web sites - both temporary and forever.
and i am against the web installing certs to users who have no idea what a cert is.

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=249004#c29)• 21 years ago |
|  | |

Georgi, you've tested that the importing of pkcs12 files works.
But users get certs by "enrolling" for them from CAs, over the web.
You've disabled that. You've also disabled all cert revocation info
from CAs in the form of CRLs.
Go get yourself a cert from cacert.org, and get their CRL too.

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=249004#c30)• 21 years ago |
|  | |

Comment on [attachment 153139](/attachment.cgi?id=153139 "ditches some content types and seems to fix the problem. against 1.7") [[details]](/attachment.cgi?id=153139&action=edit "ditches some content types and seems to fix the problem. against 1.7") [[diff]](/attachment.cgi?id=153139&action=diff "ditches some content types and seems to fix the problem. against 1.7") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153139)
ditches some content types and seems to fix the problem. against 1.7
Thanks for investigating this bug and submitting
a patch. Unfortunately, this patch disables key
PKI features in the Mozilla client. Therefore I
am marking it review-.
[Attachment #153139](/attachment.cgi?id=153139&action=edit "ditches some content types and seems to fix the problem. against 1.7") -
Flags: review-

|  | [Christopher Aillon (sabbatical, not receiving bugmail)](/user_profile?user_id=32335) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1339403_32335)• 21 years ago |

Whiteboard: [sg:fix] → [sg:fix]blocking1.4.3+

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=249004#c31)• 21 years ago |
|  | |

Timeless: thanks for the drive-by, but I am not PSM owner. That PSM's owners
have disowned it is a shame, but it doesn't qualify me to fix bugs in it. Are
you up for the job? It would be a big help.
Or maybe Christian? I'm looking for a few good hackers.
/beFlags: blocking1.8a2?

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=249004#c32)• 21 years ago |
|  | |

Just for information. I'm working on a patch that adds appropriate checks and
queries the user.
But I don't want and can't make any promises when it will be done resp. if I get
it managed.
Brendan, jumping in for PSM would be an honor. But since I've done nearly
nothing on PSM till now, I don't know if I'm qualified.

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=249004#c33)• 21 years ago |
|  | |

Christian, anyone: start patching righteously, you'll own something soon enough.
That's the best way open source works. Worse would be me trying to fill in, or
making a star-chamber appointment.
/be

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=249004#c34)• 21 years ago |
|  | |

let's try for aviary 1.0rc1Flags: blocking-aviary1.0RC1? → blocking-aviary1.0RC1+

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=249004#c35)• 21 years ago |
|  | |

First, thanks all for the work on this.
As this bug has been fished by the some sources now and there are more and more
people on the CC, I've planned to give out a short communique next week.
<http://banquo.inf.ethz.ch:8080/> is now the link a page set up during the diploma
thesis explaining the bug. The page is not secured by SSL (self-signed) any more
to not disturb visitors with "certificate errors" any more.

|  | [Franz](/user_profile?user_id=67532) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=249004#c36)• 21 years ago |
|  | |

Disable write access on
cert8.db and/or key3.db
is a possible workaround until the fix is present. Works OK on Mozilla 1.6
and Firefox 0.9.1. Only a warning is issued when you use ssl related features
for the first time.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=249004#c37)• 21 years ago |
|  | |

I'm trying to come up with a patch.
If I understand correctly, the primary problem is, we receive certs, assume they
are not CA certs, and therefore skip the application CA handling logic.
I'm currently trying to enhance the code paths, where we assume we are not
importing a CA cert, to ensure we are indeed not importing a CA cert. I saw
there is NSS function CERT\_IsCACert, sounds helpful for this purpose.
If you have suggestions or would like to discuss, or have already started on a
patch, please feel free to find me online on IRC.m.o.

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=249004#c38)• 21 years ago |
|  | |

--- Website with Error Informations? ---
I'v searched once more about the "error -8182" in mozilla browsing help file,
mozilla web site as well as google.com, and what I found is pretty interesting:
Nothing mentioning this problem and how to get rid of. The only resource is a
technical error list
(<http://www.mozilla.org/projects/security/pki/nss/ref/ssl/sslerr.html>) stating
that error -8182 means "Peer's certificate has an invalid signature".
I think it would be useful to have a resource where users can get infos for this
error codes (cf. MS knowledge base). I don't know if something exists in this
way, as part of my thesis I've also set up a page stating how to get rid of the
error in case you've tried the testing cases on my page:
<http://banquo.inf.ethz.ch:8080/Mozilla_Error_-8182.html>
If you want you can link to it or copy parts of it, altough the page won't live
for a long time after I'll have finished my thesis.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=249004#c39)• 21 years ago |
|  | |

Thanks to Christian Eyrich for discussing the issues on IRC and providing very
helpful input.
BTW, thanks to Marcel for coming up with the report, and for giving me access to
the testcases.
To explain my thoughts from the prevoius comment in more detail:
I think, only if we import a cert having the CA flag, the Denial-of-Service
scenario is possible.
I propose, as the immediate fix to the problem, we stop importing CA certs
without user interaction.
We could examine all code paths that do certificate import.
If we are told to import, and we have been told it's a CA, we bring up the CA
import dialog, fine.
If we are told to import, but we have been told the cert is not a CA, and we
therefore do not bring the import CA dialog, then ensure the certificate we are
trying to install is indeed not a CA certificate.
However, Christian suspects, this approach will stop us from importing anything,
if the peer gives us a list of certificates, and one of them is an intermediate
certificate. Maybe we can find a way to distinguish the different scenarios.
(I'm fine to have a separate discussion about doing more user interaction on
certificate downloads in the future, but I fear this will involve a discussion
that will take some time, and I guess we should come up with some sort of fix
very soon.)
I am attaching a first patch for you to look at. It seems to fix the problem in
the "silent download" scenario, when downloading the cert from a web page.
However, I need to discuss this patch with Nelson, and we should check if a
similar change should be applied to other import routines.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=249004#c40)• 21 years ago |
|  | |

Attached patch

[Patch to ImportEmailCerts for discussion](attachment.cgi?id=153518&action=diff) (obsolete)
— [Details](attachment.cgi?id=153518&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153518)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=249004#c41)• 21 years ago |
|  | |

I think we already deal correctly with content type application/x-x509-ca-cert
The patch is for conten type application/x-x509-email-cert
I looked at the code that handles content type application/x-x509-server-cert
While we have code that tells the core of Mozilla, that PSM wants to be
responsible for it, we actually do not import the received certificate, we do
nothing.
I looked at the code that handles content type application/x-x509-user-cert
At a very early stage in content handling, we try to find out if the user has
owns the matching private key for the incoming cert. I don't know an external
way to automatically install a private key in the certificate store, so I guess
it's not possible for an attacker to make use of this content type.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=249004#c42)• 21 years ago |
|  | |

... with content type application/x-x509-user-cert, if there is no matching
private key, we do not import the arriving cert, that's why I assume we are safe
here.
But in addition to the reported handling of mime type email-cert, I see one more
code path that automatically imports incoming certificates: When processing
signed S/Mime messages, we automatically import arriving certs in order to be
able to reply encrypted.
The code is in nsCMS.cpp, calling NSS function NSS\_CMSSignedData\_ImportCerts. I
suspect if somebody sends a signed email message, carefully prepared, so that is
contains certificates of email certificate, that are actually fake CA
certificates, one could cause the same failure. I will investigate more and if
I'm right, I will produce an additional fix.

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=249004#c43)• 21 years ago |
|  | |

(In reply to [comment #41](/show_bug.cgi?id=249004#c41 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> I think we already deal correctly with content type
> application/x-x509-ca-cert
We ask the user, yes. But only for the first cert.
If one gets the user to agree importing it, other certs included in an pkcs#7
packet are automatically imported too.
So there's a barrier, but it's not insuperable.
> I looked at the code that handles content type application/x-x509-user-cert
> At a very early stage in content handling, we try to find out if the user has
> owns the matching private key for the incoming cert. I don't know an external
> way to automatically install a private key in the certificate store, so I
> guess it's not possible for an attacker to make use of this content type.
You don't need the private key. You only need a users certificate. Create a
pkcs#7 der file, first cert your certificate and further certs are the faked
root certs. Sending this with application/x-x509-user-cert also imports the
fakes, the user cert is either replaced or whatever, but nothing bad.
Though it's potentially possible to use this way, it's unlikely an attacker will
use it since he needs your cert. So this method isn't mass compatible.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=249004#c44)• 21 years ago |
|  | |

Thanks for making it clear.
If we are downloading mime type ca-cert, we should probably show a separate
prompt for each incoming CA cert?
If we are downloading mime type user-cert, the code indeed assumes that certs
after the first are CA certs. We should probably bring up the CA cert prompt for
each received certs, too?

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=249004#c45)• 21 years ago |
|  | |

(In reply to [comment #44](/show_bug.cgi?id=249004#c44 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> If we are downloading mime type ca-cert, we should probably show a separate
> prompt for each incoming CA cert?
Either that or only the root certs in the list, see [comment #27](/show_bug.cgi?id=249004#c27 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"), option a. As I
understand it, intermediate certs without according root CA will be discarded
without alert.
> If we are downloading mime type user-cert, the code indeed assumes that certs
> after the first are CA certs. We should probably bring up the CA cert prompt
> for each received certs, too?
That's the simpler to implement version but can become annoying for the user.
The other version is the more complex chain building thing. Don't ask if the
chain resolves to a trusted root CA. Otherwise ask once for the whole chain.

|  | [Kyle Hamilton](/user_profile?user_id=147432) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=249004#c46)• 21 years ago |
|  | |

From the POV of an interested outsider, this entire process is /broken/.
ALL certificates that are presented need to be validated (traced to a valid,
trusted signing certificate which is already in the store and authorized to sign
certificates). ALL certificates that are entered into the store need to be
echoed and given the chance to be accepted or rejected, EVEN IF THEY ARE SIGNED
BY A TRUSTED AUTHORITY. (The mechanics of trusting trust are such that if the
trusted authority becomes compromised [however unlikely it may be], one must be
able to choose not to accept certificates issued by that authority. Once a
certificate is in the store, it is accepted as 'trusted' unless it's explicitly
in the 'untrusted' store, if I understand correctly.)
Furthermore, the original bug can be avoided by the simple expedient of
comparing the entire certificate against first untrusted certificates (if a
complete match is found in untrusted certificates, it is untrusted), then
against the trusted certificates. Not just the DN, but the serial number and
key fingerprint. In the case of certificate chains, this is appropriate, since
you have the full certificate chain that signed the presented certificate.
In the case of S/MIME that isn't associated with a cert chain, you can just as
easily attempt to verify the certificate against the untrusted certificate first
(if it matches, the issuer had the private key associated with the untrusted
certficate's public key, therefore it is untrusted); if it doesn't match, go
through any other DNs that are the same in the untrusted or trusted store, and
verify against those. Whichever one verifies as a valid signature is the
certificate that issued the signature.
The problem is that you are trusting DNs to be unique, when there's obviously an
import process that doesn't enforce that uniqueness. This is the root of the
problem, and this is what needs to be fixed. (But 'automatically importing
certificates into the store without user intervention' is another critical
problem, as well.)

|  | [Bill Gianopoulos [:WG9s]](/user_profile?user_id=104622) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=249004#c47)• 21 years ago |
|  | |

I think I agree with [comment #46](/show_bug.cgi?id=249004#c46 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") on this as to the root cause.
1. In no circumstances should a certificate that cannot be tracd to an already
trusted root CA certificate in the store be silently added to the certificate
store not matter what kind of certificate it is. E-mail. webserver, CA,
signing, whatever.
2. Certificates that fail the above should be able to be added to the permanent
certificate store by user accepting them. If such certificates were not allowed
then a company would not be able to self sign server certificates and have
people add the appropriate root cert to the database. This behavior should be
overridable by a security preference. A boolean preference for reject silently
or prompt me.
3. Certificates that do pass the test in #1 above above should not silently be
added to the permanent certificate store without user interaction. This
behavior should be overridable by a different security preference than that used
for #2. A boolean preference for accept silently or prompt me.
4. In all cases where multiple ceriticates are included in a single file the
user prompting action must be carried out for each certificate in the file.

|  | [bugzilla](/user_profile?user_id=142989) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=249004#c48)• 21 years ago |
|  | |

If something needs to be done to certificate handling, would it be possible to
fix [Bug 245609](/show_bug.cgi?id=245609 "RESOLVED INVALID - Mozilla not getting certificate issuer from Authority Information Access CA Issuers") at this opportunity?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=249004#c49)• 21 years ago |
|  | |

Attached patch

[Patch v2 to ImportEmailCerts](attachment.cgi?id=153584&action=diff) (obsolete)
— [Details](attachment.cgi?id=153584&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153584)

I think this is a better patch for the email-cert problem.
While investigating the potential additional problem I mentioned in [comment 42](/show_bug.cgi?id=249004#c42 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"),
I found the implementation implementation of NSS function
NSS\_CMSSignedData\_ImportCerts to look solid, because it verifies certificates
before they get imported.
I have produced this new patch that uses the same logic I found in that NSS
function.
It turns out this new patch fixes the reported problem.
Since the cert import on incoming emails uses therefore the same logic, I think
we can conclude, when receiving incoming mails, we are not vulnerable (as I had
suspected in [comment 42](/show_bug.cgi?id=249004#c42 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email")).
(In addition, I'm changing the certusage to email-recipient. I don't see why we
should use email-signer, this is probably still from the days where
dual-key-certs were not common.)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1661428_36541)• 21 years ago |

[Attachment #153518](/attachment.cgi?id=153518&action=edit "Patch to ImportEmailCerts for discussion") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=249004#c50)• 21 years ago |
|  | |

I confirm the user-cert hack explained in [comment 43](/show_bug.cgi?id=249004#c43 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") works, I have a testcase
that causes the same trouble as the initially reported problem in this bug.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=249004#c51)• 21 years ago |
|  | |

Attached patch

[Patch v3](attachment.cgi?id=153590&action=diff) (obsolete)
— [Details](attachment.cgi?id=153590&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153590)

I hope to have addressed all urgent problems in this patch.
As said before, we verify all incoming certs with mime type email-cert, and
import only those that can be verified.
When processing mime type user-cert, we will process the first cert as we did
before.
If additional certs are delivered to us, we assume they are CA certs, and bring
up UI that allows the user to confirm or decline the import.
In addition to mime type user-cert, there is also a javascript function that
can be used to install a user certificate. I fixed that function the same way
(but I don't have a test case).
When processing mime type ca-cert, we will bring up the import dialog for each
delivered cert.
[Attachment #153584](/attachment.cgi?id=153584&action=edit "Patch v2 to ImportEmailCerts") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=249004#c52)• 21 years ago |
|  | |

Attached patch

[( same as before but for moz 140 branch )](attachment.cgi?id=153596&action=diff) (obsolete)
— [Details](attachment.cgi?id=153596&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153596)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=249004#c53)• 21 years ago |
|  | |

Comment on [attachment 153590](/attachment.cgi?id=153590 "Patch v3") [[details]](/attachment.cgi?id=153590&action=edit "Patch v3") [[diff]](/attachment.cgi?id=153590&action=diff "Patch v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153590)
Patch v3
Nelson, what do you think?
Anybody, please review and give feedback.
I can upload a Linux test build in a couple of hours if it helps.
[Attachment #153590](/attachment.cgi?id=153590&action=edit "Patch v3") -
Flags: review?(nelson)

|  | [Chris Thomas (CTho) [formerly cst@andrew.cmu.edu cst@yecc.com]](/user_profile?user_id=48814) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1674959_48814)• 21 years ago |

Flags: blocking1.8a3?

|  | [Heikki Toivonen (remove -bugzilla when emailing directly)](/user_profile?user_id=4030) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=249004#c54)• 21 years ago |
|  | |

Kai, does your patch also fix [bug 236461](/show_bug.cgi?id=236461 "NEW - Problems importing a PKCS #7 certificate set in Mozilla")?

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=249004#c55)• 21 years ago |
|  | |

Comment on [attachment 153590](/attachment.cgi?id=153590 "Patch v3") [[details]](/attachment.cgi?id=153590&action=edit "Patch v3") [[diff]](/attachment.cgi?id=153590&action=diff "Patch v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153590)
Patch v3
>Index: ssl/src/nsCrypto.cpp
>@@ -1983,35 +1984,45 @@
> if (numCAs > 0) {
> CERTCertListNode \*node;
>+ nsCOMPtr<nsIMutableArray> array;
>+ nsresult rv = NS\_NewArray(getter\_AddRefs(array));
>+ if (NS\_FAILED(rv)) {
> goto loser;
> }
this scares me. i don't like the idea of mixing gotos and comptrs.
>+ // let's create some certs to work with
>+ nsCOMPtr<nsIX509Cert> x509Cert;
>Index: ssl/src/nsNSSCertificateDB.cpp
>@@ -245,179 +245,95 @@
>+ NS\_ASSERTION(0,"Couldn't create cert from DER blob\n");
NS\_ERROR
>+ if (!allows)
allowed?
>@@ -477,63 +393,121 @@
>+ for (i=0; i < numcerts; i++) {
>+ CERTCertificate \*cert = certArray[i];
>+ if (cert)
{
>+ cert = CERT\_DupCertificate(cert);
>+ if (cert)
>+ CERT\_AddCertToListTail(certList, cert);
}
> }
>+ /\* filter out the certs we don't want \*/
>+ srv = CERT\_FilterCertListByUsage(certList, certusage, PR\_FALSE);
all these different \*rvs are really confusing :(
>+ (void )CERT\_ImportCerts(certdb, certusage, certChain->len,
strange whitespace pattern
>@@ -643,27 +615,45 @@
>+ SECItem \*currItem;
could this be a SECItem &currItem instead?
>+ for (int i=1; i<collectArgs->numcerts; i++) {
>+ currItem = &collectArgs->rawCerts[i];
>+ nssCert = nsNSSCertificate::ConstructFromDER((char\*)currItem->data, currItem->len);
>+ if (!nssCert)
>+ return NS\_ERROR\_FAILURE;
>+ x509Cert = do\_QueryInterface((nsIX509Cert\*)nssCert);
>+ array->AppendElement(x509Cert, PR\_FALSE);
> }

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1687957_11608)• 21 years ago |

Summary: Overriding built-in certificate leading to error -8182 (DoS), especially exploitable by email → Overriding built-in certificate leading to error -8182 (perm DoS), especially exploitable by email

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=249004#c56)• 21 years ago |
|  | |

[Comment 46](/show_bug.cgi?id=249004#c46 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") bears some misconceptions about mozilla's cert stores
with respect to trust, and with respect to cert path validation.
The local cert stores are mostly nothing more than a cache of certs
that may be received through various channels. The act of storing
a cert does not impute trust in it. (However, a user may choose to
add explicit trust to a stored cert.)
Storing a cert locally serves two primary purposes:
a) it facilitates initiating a secured communication. For example,
sending an encrypted email to a party without having to fetch that
party's encryption cert again.
b) It provides a way for the local user to attach trust to the cert,
so that the cert will be seen as valid when encountered in situations
where it might otherwise be deemed invalid and/or untrusted. This
is intended for root CAs and for self-signed email or server certs
that the user wishes to use.
It may also serve a secondary purpose: filling in missing certs into
incomplete chains received from misconfigured SSL or email peers.
In the PKI model, a cert that verifiably chains to an explicitly trusted
(root) CA cert is "valid", and usable for its allowed purposes, without
requiring any additional user approval of the certs in the chain. For
example, when you visit an SSL server whose server cert verifiably chains
to a locally explicitly trusted root CA through one or more intermediate
CAs, you are not asked if you trust the intermediate CAs, nor if you trust
the server's cert, even though you (and your client program) may never
have seen any of those certs (other than the trusted root CA) before.
Storing certs is no different. When you are asked to store a cert that
verifiably chains to a locally explicitly trusted root CA, (or that is an
exact copy of an already stored cert) there is no need to ask the user
to make any decision about that cert. The mere act of storing it locally
will not change the outcome of any decisions based on it in the future.
User intervention is required only for certs that do NOT verifiably chain
to a known and explicitly locally trusted (root CA) cert. The certs that
cause the problem reported in this bug do not chain to any known and
trusted CA.
When evaluating whether a new cert does or doesn't chain to a trusted root,
it is necessary to have all the certs in that chain present in SOME local
store. For that reason, NSS provides a temporary store, into which one can
dump all the certs from a set being evaluated. Then one validates a chain,
and may choose to move the cert from a temporary store to a permanent one
if it validated.
One more related point about the UI. Most of the time, the user's browser
will encounter one of these MIME content types wen the user has clicked a
link or button for the explicit purpose of downloading a cert or cert chain.
If user intervention is required, we should ask the user to make just one
trust decision, not many.
Otherwise, the user is likely to repeat his first decision each subsequent
time he is asked to decide. E.g. if the user is trying to download an email
cert that does not chain to a known root, we should ask him whether or not to
proceed to import (and trust) that email cert, and then drop the subsequent
certs, not ask the user about them. That is why the user cert must be first in
the downloaded chain.
If we ask the user about them, the user will likely (a) decide to keep
the email cert of his intended recipient, and then when he encounters
other certs whose names and/or purposes he may not understand, he is
likely to think that he MUST accept them too, in order for the email cert
to work, and so not excersize proper judgement on those certs.
This is exactly what we do for SSL server certs, BTW. When a user visits
an SSL server whose cert doesn't validate against a known trusted root,
we offer to let the user trust the server cert itself, and NOTHING else.
This prevents a user from accidentally trusting a rogue CA, thinking that
it is necessary to visit the chosen site.Summary: Overriding built-in certificate leading to error -8182 (perm DoS), especially exploitable by email → Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email

|  | [Kyle Hamilton](/user_profile?user_id=147432) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=249004#c57)• 21 years ago |
|  | |

My [comment #46](/show_bug.cgi?id=249004#c46 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") does have some misconceptions, and I appreciate Nelson clarifying
the role of the store. However, [comment #56](/show_bug.cgi?id=249004#c56 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") ignores a certain level of trust
that is implicitly being granted to the bogus CA root certificates in the store
(in the 'untrusted certificates' store) -- the trust that the DN in the
certificate is unique, and thus can be relied upon without double-checking for
other identifying characteristics.
The correct uniqueness should be determined by DN + keyhash + serial number, not
merely DN. (and if a certificate purports to be self-signed, to get around this
restriction, but the signature doesn't match... then the certificate should not
be added to the store/cache at all -- only valid certs should be added.)
If a bogus certificate can be added to the store, which is 'untrusted', why
should that untrusted certificate be trusted enough to affect operations
involving already-existing trust of other, pre-installed or explicitly-trusted
certificates?
Re [comment #47](/show_bug.cgi?id=249004#c47 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") point 4, in support of [comment #56](/show_bug.cgi?id=249004#c56 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"): As for the mechanics of
'trusting trust' -- an intermediate CA (or a root CA which has been explicitly
certified by a trusted root) is trusted as far as its certificate is explictly
trusted by the user, or by the user's implicit trust in the trusted root. If
the intermediate CA is compromised, and the trusted root CA finds out about it,
the trusted root CA revokes the certificate and, thus, notifies the world that
it has revoked its trust in the authenticity of any certificates which that CA
may have issued. (If a user explicitly trusts the CA certificate, then there's
not much that can be done automatically.) I don't see any problem with this
behavior.
Re [Comment #56](/show_bug.cgi?id=249004#c56 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email")'s concept of 'secondary purpose' (and thus, related to purpose a.
for SSL): Personally, I think the idea of a certificate 'cache' like this only
serves to create confusion for users and helpdesks, as well as website operators
who may not understand how to install certificate chains properly. "It works
for person A, using FireFox, but not for person B, using FireFox of the same
version -- what gives?" If person A has the proper certificates in her cache,
then it'll work, but if person B doesn't, it won't. Unless the website operator
is a Mozilla expert (and let's face it, they've got enough trouble configuring
Apache or whatever they're using as a webserver to be able to come up to speed
on MSIE and Mozilla and Opera and all the other browser platforms and their
idiosyncracies), they're not going to know to look in the certificate cache, nor
even how to. Consistent failure is better than intermittent success in
applications of this nature.
(If necessary, it might be useful to word the error message in a 'could not
verify up to trusted certificate' circumstance thus: "Mozilla was unable to
verify that the site you are connected to is truly the site you are attempting
to reach. Mozilla verifies site identity through "site certificates" that are
issued by trusted agencies; however, this site's certificate could not be
validated as being issued by any of these agencies. This could be a serious
issue for this site's security, and should be reported to the site administrator
at once; in your report, please ask the site administrator to ensure that the
webserver is properly configured to send the entire "certificate chain" to your
browser." This would allow users to suggest to site admins the most common
cause of this error, and provide a hook into their webserver's documentation for
proper configuration.)
I also see a problem with caching email certificates in the store in an
untrusted state -- the act of encrypting to a certificate implies that the
certificate is trusted to at least belong to the email address that it's used to
send to. (This is akin to the "Thawte Freemail Member" default name on
certificates issued by Thawte under its Freemail program -- the certificate will
certainly encrypt to the proper address, thus it meets all the 'technical'
requirements of trust, but nobody in their right mind would believe that the
name of the person at that mailbox would be "Mr. Thawte F. Member". Thus, it
doesn't meet the 'political' or 'social' requirements of trust.) What does
'explicitly trusting an email certificate' mean? What does 'not trusting an
email certificate' mean? For a distinction to be useful, there must be
something to distinguish between...
and this STILL doesn't solve the problem of certificates being silently added to
the store with no UI to even notify that something's happening. (cf [bug #251690](/show_bug.cgi?id=251690 "RESOLVED WORKSFORME - Client Certificate installs without notification (feedback) to user") )

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=249004#c58)• 21 years ago |
|  | |

Nelson, you wrote
> E.g. if the user is trying to download an email cert that does not chain to a
> known root, we should ask him whether or not to proceed to import (and trust)
> that email cert, and then drop the subsequent certs, not ask the user about
> them.
So this means, just set this single S/MIME cert to trust but don't set trust
flags for any intermediate or root CA (if already in perm or just in temp)?
But then what is the reason/benefit of a package containing a whole chain? The
S/MIME cert will chain up to the root included, but since it's not known nothing
else, except the S/MIME cert itself, will ever get imported.
Is this right and wanted?

|  | [Kyle Hamilton](/user_profile?user_id=147432) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=249004#c59)• 21 years ago |
|  | |

re [comment #58](/show_bug.cgi?id=249004#c58 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"): I'd like to have a dialog that says something like:
"This email certificate has been issued by an authority that Mozilla does not
know about (##CN of CA, link to full certificate information##). Only you can
decide if you believe that the certificate belongs to the person that it claims
to belong to.
In addition, if you believe that this authority will only issue email
certificates after verifying the identities of those requesting certificates,
you can choose to accept and trust the issuing authority. This will mean that
you will automatically accept email certificates issued by this authority, as
though you had chosen to accept each and every one of them.
What would you like to do? ##dropdown## [OK] [CANCEL] [HELP]"
dropdown includes:
"Do not accept this email certificate [default]"
"Accept this email certificate (##CN of email##)"
"Accept the issuer of this email certificate (##CN of CA##)"
"Accept the issuer of the authority (##CN of CA2##)"
...
"Accept the master (root) authority (##CN of ROOTCA##)"
A lot of the trouble for users is that they don't understand the key concepts
involved. I don't know if this particular wording would be appropriate, or if
end-users would be able to understand the concept in this way -- but doing
/anything/ to make it easier to understand should get them to take a more active
interest. (and hopefully spawn a few more "oh, is that what that means? Duh, I
get it now!" epiphanies.)
of course, I'm also of the mindset that software should teach the user how to
use it automatically, without the aid of a book or manual. Feel free to
disregard this comment if it's too far out of scope.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=249004#c60)• 21 years ago |
|  | |

Comment on [attachment 153590](/attachment.cgi?id=153590 "Patch v3") [[details]](/attachment.cgi?id=153590&action=edit "Patch v3") [[diff]](/attachment.cgi?id=153590&action=diff "Patch v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153590)
Patch v3
I had a chat with Nelson, and I agree with his statements in [comment 56](/show_bug.cgi?id=249004#c56 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email").
This means I will come up with another patch.
Please note that I have very limited time to work on this, because my day job
is not related to Mozilla. Therefore I'm trying to come up with a patch that
does the minimal effort to fix the problem.
[Attachment #153590](/attachment.cgi?id=153590&action=edit "Patch v3") -
Attachment is obsolete: true
[Attachment #153590](/attachment.cgi?id=153590&action=edit "Patch v3") -
Flags: review?(nelson)

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=249004#c61)• 21 years ago |
|  | |

Re [comment 57](/show_bug.cgi?id=249004#c57 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"): Kyle, I suggest you go read and study RFS 3280 before making
any additional suggestions. Learn about how an issuer cert is identified
based on the information in an issued cert. This bug report is not the
place to be conducting education about how X509v3 based PKI works.
Re [comment 58](/show_bug.cgi?id=249004#c58 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"): Yes, in that case, trust the leaf, drop the chain. The act
of importing a leaf cert is NOT the occasion to be adding trust to a root.
When the user decidees to accept and trust a cert that has already FAILED the
usual PKI validity checks, we need to MINIMIZE the scope of the new trust.
The fact that the user wants to accept the email cert from an unknown and
possibly rogue CA ought not to imply that the user will thereafter trust all
the certs from that CA. If the user wants to add a root CA cert and trust it,
the user should visit the CA, the source of the cert.
Re: [comment 59](/show_bug.cgi?id=249004#c59 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"): trusting a CA is the single most crucial decision the user
can make. No way should it be made as a side effect of some other action,
or be made without presenting the user with dialogs outlining the seriousness
of the action and enough information that the user has at least a chance of
looking at the right information with which to make the decision.
The proposed drop-down dialog would like have the wrong effects, increasing
the likelihood of the user accepting and trusting a rogue CA cert. Kai
pointed out that a "hot fix" to a bug like this must avoid designing new UI.
Aside: I'm on vacation, and will soon be travelling. I expect to be out of
contact with the Internet for most of the rest of the week.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=249004#c62)• 21 years ago |
|  | |

@Heikki: Having read Nelson's arguments, I agree that one download should
deliver one cert (chain) only. So I will not fix [bug 236461](/show_bug.cgi?id=236461 "NEW - Problems importing a PKCS #7 certificate set in Mozilla"), at least not with a
patch to this bug.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1762884_36541)• 21 years ago |

[Attachment #153596](/attachment.cgi?id=153596&action=edit "( same as before but for moz 140 branch )") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1763173_36541)• 21 years ago |

[Attachment #153139](/attachment.cgi?id=153139&action=edit "ditches some content types and seems to fix the problem. against 1.7") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=249004#c63)• 21 years ago |
|  | |

Attached patch

[Patch v4](attachment.cgi?id=153698&action=diff) (obsolete)
— [Details](attachment.cgi?id=153698&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153698)

Here is the new patch based on Nelson's proposal.
On importing ca-cert, we continue to show only one cert to the user.
However, if there are more certs, from now on they will only get imported, if
they can be verified as CA certs.
On importing email-cert, we continue to import any email cert delivered.
However, only certs that can be verified will be imported.
On importing user-cert, we will continue to import the first cert as before,
assuming it is a user cert.
However, if there are more certs, from now on they will only get imported, if
they can be verified as CA certs.
Christian, you reported a crash with the previous patch. Hopefully this new
patch no longer crashes, I'd appreciate if you could do some testing again.

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=249004#c64)• 21 years ago |
|  | |

(In reply to [comment #63](/show_bug.cgi?id=249004#c63 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> Christian, you reported a crash with the previous patch. Hopefully this new
> patch no longer crashes, I'd appreciate if you could do some testing again.
It still crashes.
But I don't think it's your code. It crashes when first calling
CERT\_ImportCerts() from ImportEmailCertificate() when importing a package
containing > 1 cert. Interestingly it doesn't if I copy that
CERT\_NewTempCertificate-loop directly into ImportEmailCertificate(). Strange
thing I've to investigate tomorrow.
Besides this I wonder if this patch works for you. I can't import any email-cert
and no ca-cert except the first (same with user-cert I guess, but untested).
Firstly it has to be !CERT\_LIST\_END(node,certList) in the for loops.
And secondly CERT\_VerifyCertificate() doesn't use the SECCertUsage enums but the
values ones from certt.h#485 ff.
> However, if there are more certs, from now on they will only get imported, if
> they can be verified as CA certs.
Besides I don't think that's what Nelson meant, this way I still can make
Mozilla import my faked Thawte Root cert if only the first cert in the package
(the one for which the dialog is shown) gets in. A CA cert should never, never,
never get imported without user interaction.
And as Nelson wrote e.g. in [bug 236461](/show_bug.cgi?id=236461 "NEW - Problems importing a PKCS #7 certificate set in Mozilla") "A PKCS7 file of certs is supposed to
contain a single cert chain, not a collection of potentially unrelated certs."
So I don't see a need for the "for (node = CERT\_LIST\_HEAD(certList) ..." loop at
all, for any cert type.
And last thing for tonight I can't see the reason for this calls to
CERT\_FilterCertListByUsage() since CERT\_VerifyCertificate()
CERT\_CertChainFromCert() IMO already filter for usage, no?

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=249004#c65)• 21 years ago |
|  | |

Re [comment 64](/show_bug.cgi?id=249004#c64 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"): The key word in Kai's sentence is "verified".
Any subordinate CA cert that can be verified as issued by a trusted root CA
can be imported without user interaction. If it was found in a cert chain,
it would be honored because the chain validates, whether or not it was
cached locally. cacheing it doesn't change that. There is no point in
putting tighter acceptance criteria on the cert for import than the criteria
that would be used when validating a cert chain.

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=249004#c66)• 21 years ago |
|  | |

(In reply to [comment #65](/show_bug.cgi?id=249004#c65 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> Re [comment 64](/show_bug.cgi?id=249004#c64 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"): The key word in Kai's sentence is "verified".
> Any subordinate CA cert that can be verified as issued by a trusted root CA
> can be imported without user interaction.
Yes, sorry. In
> A CA cert should never, never, never get imported without user interaction.
I meant unrelated certs. The certs I used for testing where completeley
different and both root certs. So there was no chain the second cert can be
validated to.
> Any subordinate CA cert that can be verified as issued by a trusted root CA
> can be imported without user interaction.
The last patch (as well as the current behaviour) doesn't honor this. The user
will allways receive a dialog for the first cert, if it chains up to a trusted
root or not.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=249004#c67)• 21 years ago |
|  | |

Ok, I found several problems with the patch. While for now I would like to stay
with the described logical approach, there are several problems at the code
level, due to lack of testing.
You're right with !CERT\_LIST\_END for some reason I missed the ! while copying
the code.
Regarding the crash in CERT\_ImportCerts, I see I can not not pass over directly
the array returned from certCollection, it's required to copy it over to a
separate array of SECItems and use that for importing. With that changed, I no
longer crash.
But third, there is a problem with function CERT\_VerifyCertificate !
It does not use the passed in certUsage correctly!
In my testing, when not passing in a pointer to return the verified usages, it
always uses certUsageSSLServer...
So I have to say I don't like this function.
Yes, you're right, the NSS implementation comment says, old function
CERT\_VerifyCert (without the trailing ...ificate) should no longer be used for
new code, however, it works better for me, so I'll use that.
Regarding filtering the list, I think it makes sense to avoid verifying
certificates we are not interested in anyway.
I'll attach a new patch in the next hour.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=249004#c68)• 21 years ago |
|  | |

Attached patch

[Patch v5](attachment.cgi?id=153767&action=diff) (obsolete)
— [Details](attachment.cgi?id=153767&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153767)

Next attempt.
This time I have done several tests and it looks good so far.
However, please repeat your tests.
We should make it work first, before asking the NSS team to review the patch.
The code calls NSS function CERT\_VerifyCert with parameter certUsageVerifyCA as
recommended by Bob. However, this makes it crash and it was necessary to patch
NSS to make it work.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=249004#c69)• 21 years ago |
|  | |

During testing I found [bug 252268](/show_bug.cgi?id=252268 "RESOLVED DUPLICATE - CRL DPCache problems with fake CA cert"). It has a similar result, producing error
-8182, however, limited to the current session only.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=249004#c70)• 21 years ago |
|  | |

[Bug 252271](/show_bug.cgi?id=252271 "RESOLVED FIXED - CERT_VerifyCert with param certUsageVerifyCA fails or asserts") tracks the necessary NSS change CERT\_VerifyCert.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=249004#c71)• 21 years ago |
|  | |

> The last patch (as well as the current behaviour) doesn't honor this. The user
> will allways receive a dialog for the first cert, if it chains up to a trusted
> root or not.
If the package delivered with x-x509-ca-cert contains more than 1 cert, we will
show only the first (or the second, if the first turns out be to signed by the
second).
Yes, in addition to the displayed cert, the new logic might import valid
verifiable CA certs (but ONLY verifiable certs) that are unrelated to the first
cert. I'm doing it because it will not cause any harm if the unrelated cert can
be verified.
Yes, we could start a discussion whether we should enhance the code further and
limit the import to related certs only, but if you agree this is not a security
problem, given my time constraints, I would ask that we do that additional work
in a separate step/bug.

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=249004#c72)• 21 years ago |
|  | |

Comment on [attachment 153767](/attachment.cgi?id=153767 "Patch v5") [[details]](/attachment.cgi?id=153767&action=edit "Patch v5") [[diff]](/attachment.cgi?id=153767&action=diff "Patch v5") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153767)
Patch v5
>Index: manager/ssl/src/nsNSSCertificateDB.cpp
>@@ -380,46 +381,98 @@
>+ for (node = CERT\_LIST\_HEAD(certList) ;
>+ !CERT\_LIST\_END(node,certList);
>+ node= CERT\_LIST\_NEXT(node)) {
that can't be house style for whitespace (space before semi and equals, no
space before semi, no space before equals).
> if (!certCollection) {
>+ if ( !rawArray ) {
what is house whitespace style?
>- if ( !rawCerts ) {
oh nevermind consistency.
...
> loser:
>- if (cert)
>- CERT\_DestroyCertificate(cert);
>+ if (certArray) {
>+ CERT\_DestroyCertArray(certArray, numcerts);
>+ }
>+ if (certList) {
>+ CERT\_DestroyCertList(certList);
>+ }
2-4 space indenting is bad, don't do it ;-)
> if (arena)
> PORT\_FreeArena(arena, PR\_TRUE);
> return nsrv;
> }

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=249004#c73)• 21 years ago |
|  | |

Timeless, I would like to propose we delay any whitespace cleanup discussion
until we know the patch works.

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=249004#c74)• 21 years ago |
|  | |

(In reply to [comment #67](/show_bug.cgi?id=249004#c67 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> I see I can not not pass over directly the array returned from certCollection,
> it's required to copy it over
Yep, that's what I also just discovered.
> But third, there is a problem with function CERT\_VerifyCertificate !
> It does not use the passed in certUsage correctly!
> In my testing, when not passing in a pointer to return the verified usages, it
> always uses certUsageSSLServer...
You used certificateUsageEmailRecipient resp. certificateUsageVerifyCA for
requiredUsages, not certUsageEmailRecipient resp. certUsageVerifyCA, yes?

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=249004#c75)• 21 years ago |
|  | |

(In reply to [comment #68](/show_bug.cgi?id=249004#c68 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> This time I have done several tests and it looks good so far.
> However, please repeat your tests.
> We should make it work first, before asking the NSS team to review the patch.
Up to now the patch seems to close the hole. I wasn't able to inject unwanted certs.
Though this fix shouldn't contain UI, I recommend at least a standard error box
if we don't import a email-cert because it doesn't chains up.
If we just silently drop it, users will start filing bugs that Mozilla doesn't
import email-certs.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=249004#c76)• 21 years ago |
|  | |

> I recommend at least a standard error box
Two problems with this approach:
- we would have to add a string for the error message, and embeddors do not want
to start over with their localization process on a stable branch like 1.7 (I
remember mkaply@ibm saying so). There are currently no suitable error strings
contained in module security/manager/ssl.
- the better approach would be a callback, implemented either by Mozilla's
security/manager/pki UI module, or the embeddors UI. But that requires changing
the callback interfaces, which is also not appropriate for a stable branch.
Unless mozilla staff grants explicit permission to include new UI strings on the
branch, I'd like to avoid it.
We can do anything we want on the trunk and for future main Mozilla versions,
but for now I'd like to start with a patch that is suitable for 1.4 branch, 1.7
branch and the trunk.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1835063_36541)• 21 years ago |

[Attachment #153698](/attachment.cgi?id=153698&action=edit "Patch v4") -
Attachment is obsolete: true

|  | [Christian Eyrich](/user_profile?user_id=31357) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=249004#c77)• 21 years ago |
|  | |

(In reply to [comment #76](/show_bug.cgi?id=249004#c76 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> - we would have to add a string for the error message
Oh yes, I forgot that.
So then we can only hope people will only import certs that base on already
imported CA certs. Adding a "known Issue" can also be done - though I suspect
anyone reads readmes.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=249004#c78)• 21 years ago |
|  | |

> You used certificateUsageEmailRecipient resp. certificateUsageVerifyCA for
> requiredUsages, not certUsageEmailRecipient resp. certUsageVerifyCA, yes?
Well, you're right, I did not. I used the certUsage constants.
However, have a look at CERT\_VerifyCertificate in certvfy.c, the switch action
is based on value of certUsage, which appears to always remain at 0, which I
think it confusing and not what we desire. Since Bob also recommended to use
CERT\_VerifyCert, I don't want to investigate further.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=249004#c79)• 21 years ago |
|  | |

Attached patch

[Patch v6](attachment.cgi?id=153783&action=diff) (obsolete)
— [Details](attachment.cgi?id=153783&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153783)

This patch is nearly identical to the previous one.
However, there were two identical code sections that I combined into a
function.
And it has some whitespace cleanup... ;-)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1839224_36541)• 21 years ago |

[Attachment #153767](/attachment.cgi?id=153767&action=edit "Patch v5") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=249004#c80)• 21 years ago |
|  | |

Comment on [attachment 153783](/attachment.cgi?id=153783 "Patch v6") [[details]](/attachment.cgi?id=153783&action=edit "Patch v6") [[diff]](/attachment.cgi?id=153783&action=diff "Patch v6") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153783)
Patch v6
Bob, could you please review the calls to NSS?
[Attachment #153783](/attachment.cgi?id=153783&action=edit "Patch v6") -
Flags: review?(rrelyea0264)

|  | [Robert Relyea](/user_profile?user_id=11099) |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=249004#c81)• 21 years ago |
|  | |

Comment on [attachment 153783](/attachment.cgi?id=153783 "Patch v6") [[details]](/attachment.cgi?id=153783&action=edit "Patch v6") [[diff]](/attachment.cgi?id=153783&action=diff "Patch v6") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153783)
Patch v6
What I didn't review:
1) that all the places we import certs have been found.
2) CERTCertificateListCleaner and CERTCertListCleaner do what I think they do
(destroy the appropriate type with the correct NSS destroy function when the go
out of scope).
3) That the style is consistant with PSM or Mozilla.
Those things aside, the code looks mostly correct. A minor nit, I agree with
timeless that we should be consistant in our cleanup strategy (at least within
a single function). That in itself did not warrent the r-.
The more major issue is the use of NULL for the wincx parameter for the
CERT\_VerifyCert calls. If we are not authenticate AND if PSM's password
callback requires a window context (or some other password arg) to fetch the
password, AND we are running in FIPs mode (where authentication is required to
verify signatures, for instance), then it is possible for CERT\_VerifyCert may
fail because it couldn't fetch the password. This issue would show up in a
rare, and inconsistant, failure to import an otherwise legitimate certificate
(and probably wouldn't be caught by system testing).
the r- can be changed to an r+ automatically under the following conditions:
1) the appropriate wincx argument is found and passed to CERT\_VerifyCert(), or
2) the PSM password function is reviewed and it is determined that it will
function correctly (still prompt for a password) if a NULL wincx is supplied.
The rest of the logic, including cleanup, appears functionally correct.
bob
[Attachment #153783](/attachment.cgi?id=153783&action=edit "Patch v6") -
Flags: review?(rrelyea0264) → review-

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1846524_1214)• 21 years ago |

Assignee: brendan → kaie

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=249004#c82)• 21 years ago |
|  | |

> I didn't review that all the places we import certs have been found.
I searched sources with "grep -i importcert" and "grep -i toperm"
I think all these places are safe now.
We don't touch the logic that permanently installs a server on visiting an
untrusted server, but the user is prompted, and AFAICT we don't import
additional certs.
We also don't touch the implementation of nsIX509CertDB2::addCertFromBase64,
which provides a mechanism to import a given cert into the perm store with the
given trust. I can't find any active code that makes use of this function, I
supposed some embeddors might do, but that's outside of our responsibility.
> I didn't review that CERTCertificateListCleaner and CERTCertListCleaner do
what I think they do (destroy the appropriate type with the correct NSS destroy
function when the go out of scope).
Your assumption is correct.
> I didn't review that the style is consistant with PSM or Mozilla.
> I agree with timeless that we should be consistant in our cleanup strategy (at
> least within a single function).
Now that the code is ready I will address the style and cleanup suggestion.
I hope the style in the forthcoming patch will be sufficient.
> The more major issue is the use of NULL for the wincx parameter for the
> CERT\_VerifyCert calls. If we are not authenticate AND if PSM's password
> callback requires a window context (or some other password arg) to fetch the
> password, AND we are running in FIPs mode (where authentication is required to
> verify signatures, for instance), then it is possible for CERT\_VerifyCert may
> fail because it couldn't fetch the password. This issue would show up in a
> rare, and inconsistant, failure to import an otherwise legitimate certificate
> (and probably wouldn't be caught by system testing).
I agree. Luckily the context arguments where already available in all modified
scopes, so in all new calls to CERT\_VerifyCert I set param 6 to variable ctx.
> the r- can be changed to an r+ automatically under the following conditions:
> 1) the appropriate wincx argument is found and passed to CERT\_VerifyCert(), or
> The rest of the logic, including cleanup, appears functionally correct.
Thanks a lot.
Because I fulfil condition 1), I'll mark the next patch with r=relyea.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=249004#c83)• 21 years ago |
|  | |

Attached patch

[Patch v7](attachment.cgi?id=153803&action=diff) (obsolete)
— [Details](attachment.cgi?id=153803&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153803)

Bob's requested changes and whitespace/style cleanup.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1849643_36541)• 21 years ago |

[Attachment #153783](/attachment.cgi?id=153783&action=edit "Patch v6") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=249004#c84)• 21 years ago |
|  | |

Comment on [attachment 153803](/attachment.cgi?id=153803 "Patch v7") [[details]](/attachment.cgi?id=153803&action=edit "Patch v7") [[diff]](/attachment.cgi?id=153803&action=diff "Patch v7") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153803)
Patch v7
marking r=relyea
Brendan, can you please sr?
[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: superreview?
[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: review+

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1872930_15223)• 21 years ago |

[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: superreview? → superreview?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=249004#c85)• 21 years ago |
|  | |

I'm not really doing srs in code I don't know at this time... Please ask someone
else.

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a1879341_15223)• 21 years ago |

[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: superreview?(bzbarsky) → superreview?(jst)

|  | [Ben Goodger (use ben at mozilla dot org for email)](/user_profile?user_id=5566) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2376204_5566)• 20 years ago |

Priority: -- → P2

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=249004#c86)• 20 years ago |
|  | |

In order to speed up the process, and to allow more testing of the patch, I have
produced a test build (Linux only).
It's a snapshot from yesterday's MOZILLA\_1\_7\_BRANCH with patch v7 applied.
[http://kuix.de/mozilla/20040727/mozilla-171+-20040727-249004.tar.gz](http://kuix.de/mozilla/20040727/mozilla-171%2B-20040727-249004.tar.gz)
No installer, just extract and run.
Below is a GPG signed md5sum (my gpg key is in the key servers).
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1
1601e49fe57d707f50cdf3ad9ec121ab mozilla-171+-20040727-249004.tar.gz
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)
iD8DBQFBBmnPdUk7WZN5lQ4RAsnCAJ4phL3C5rh22UpIPktpZHGdhcA5ZgCfdC7M
DqWyxtiadFNm+fq6axDDXEw=
=M+DC
-----END PGP SIGNATURE-----
PLEASE DO NOT DISTRIBUTE this build, it's unofficial.
Please give feedback in the bug. Thanks.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2454048_12352)• 20 years ago |

[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: superreview?(jst) → superreview+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=249004#c87)• 20 years ago |
|  | |

Comment on [attachment 153803](/attachment.cgi?id=153803 "Patch v7") [[details]](/attachment.cgi?id=153803&action=edit "Patch v7") [[diff]](/attachment.cgi?id=153803&action=diff "Patch v7") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153803)
Patch v7
Thanks for the superreview. I will check in the patch to the trunk now.
Requesting permission to land the patch on both MOZILLA\_1\_7\_BRANCH and
MOZILLA\_1\_4\_BRANCH.
This patch works on the 1.4 branch, too. There is a small context conflict
which I will resolve manually when checking in.
I'm not sure which branch this should land on for Firefox/Thunderbird, please
advice.
[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: approval1.7.2?
[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: approval1.4.3?

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=249004#c88)• 20 years ago |
|  | |

Comment on [attachment 153803](/attachment.cgi?id=153803 "Patch v7") [[details]](/attachment.cgi?id=153803&action=edit "Patch v7") [[diff]](/attachment.cgi?id=153803&action=diff "Patch v7") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153803)
Patch v7
Sorry, I was away last week but wanted to get a few nits picked:
>- // Now it's time to add the rest of the certs we just downloaded.
>- // Since we didn't prompt the user about any of these certs, we
>- // won't set any trust bits for them.
>- nsNSSCertTrust defaultTrust;
>- defaultTrust.SetValidCA();
>- defaultTrust.AddCATrust(0,0,0);
>+ // Import additional delivered certificates that can be verified.
>+
>+ /\* build a CertList for filtering \*/
Use a C++ one-line comment here too?
> CERTCertificate \*tmpCert2 =
> CERT\_NewTempCertificate(certdb, &der, nsnull, PR\_FALSE, PR\_TRUE);
>
> if (!tmpCert2) {
> NS\_ASSERTION(0, "Couldn't create temp cert from DER blob\n");
Use NS\_ERROR(...) here, not NS\_ASSERTION(0, ...).
>+ /\*
>+ \* CertChain returns an array of SECItems, import expects an array of
>+ \* SECItem pointers. Create the SECItem Pointers from the array of
>+ \* SECItems.
>+ \*/
>+ rawArray = (SECItem \*\*)PORT\_Alloc(certChain->len\*sizeof (SECItem \*));
Odd spacing (lack of spaces around binary \*, space after sizeof), contrast with
other (sizeof(SECItem \*) \* numcerts) expressions visible in this patch.
>+ /\* go down the remaining list of certs and verify that they have
>+ \* valid chains, if yes, then import.
>+ \*/
>+ PRTime now = PR\_Now();
>+ CERTCertListNode \*node = NULL;
>+ for (node = CERT\_LIST\_HEAD(certList);
No need to NULL-init node here before the for loop that reinits it.
>+ !CERT\_LIST\_END(node,certList);
>+ node = CERT\_LIST\_NEXT(node)) {
>+ CERTCertificateList \*certChain = NULL;
Could move this down, to where it's first set, I think/hope.
>+
>+ if (CERT\_VerifyCert(CERT\_GetDefaultCertDB(), node->cert,
>+ PR\_TRUE, certUsageVerifyCA, now, ctx, NULL) != SECSuccess) {
>+ continue;
>+ }
>+
>+ certChain = CERT\_CertChainFromCert(node->cert, certUsageAnyCA, PR\_FALSE);
>+ if (!certChain) {
>+ continue;
>+ }
>+
>+ CERTCertificateListCleaner chainCleaner(certChain);
>+
>+ /\*
>+ \* CertChain returns an array of SECItems, import expects an array of
>+ \* SECItem pointers. Create the SECItem Pointers from the array of
>+ \* SECItems.
>+ \*/
>+ rawArray = (SECItem \*\*)PORT\_Alloc(certChain->len\*sizeof (SECItem \*));
Ditto spacing comment on sizeof-bearing argument expression.
>+ if (!rawArray) {
>+ continue;
>+ }
>+ for (int i=0; i < certChain->len; i++) {
>+ rawArray[i] = &certChain->certs[i];
>+ }
>+ CERT\_ImportCerts(CERT\_GetDefaultCertDB(), certUsageAnyCA, certChain->len,
>+ rawArray, NULL, PR\_TRUE, PR\_TRUE, NULL);
>+
>+ PORT\_Free(rawArray);
>+ }
>+
>+ return NS\_OK;
General comment: is Out Of Memory hidden in favor of best-effort, even if not
all certs are imported? On most modern VM-using OSes, OOM can't happen (you
swap to death and the kernel kills processes), but it seems worth asking, in
case this code runs in a Minimo small-device setting.
/be

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 89](/show_bug.cgi?id=249004#c89)• 20 years ago |
|  | |

Comment on [attachment 153803](/attachment.cgi?id=153803 "Patch v7") [[details]](/attachment.cgi?id=153803&action=edit "Patch v7") [[diff]](/attachment.cgi?id=153803&action=diff "Patch v7") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=153803)
Patch v7
a=chofmann for 1.7.2
[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: approval1.7.2? → approval1.7.2+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 90](/show_bug.cgi?id=249004#c90)• 20 years ago |
|  | |

Attached patch

[Patch v7 with nits addressed](attachment.cgi?id=154493&action=diff) (obsolete)
— [Details](attachment.cgi?id=154493&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154493)

>>+ /\* build a CertList for filtering \*/
> Use a C++ one-line comment here too?
changed
> Use NS\_ERROR(...) here, not NS\_ASSERTION(0, ...).
In this place you're not reviewing my changes, but diff context...!
Anyway, Changed.
Looks like other Mozilla code doesn't use a trailing \n, so I removed it, too.
> Odd spacing (lack of spaces around binary \*, space after sizeof), contrast
with
> other (sizeof(SECItem \*) \* numcerts) expressions visible in this patch.
... changed
>>+ CERTCertListNode \*node = NULL;
> No need to NULL-init node here before the for loop that reinits it.
changed
>>+ CERTCertificateList \*certChain = NULL;
> Could move this down, to where it's first set, I think/hope.
moved, both places
>>+ rawArray = (SECItem \*\*)PORT\_Alloc(certChain->len\*sizeof (SECItem \*));
> Ditto spacing comment on sizeof-bearing argument expression.
changed
>>+ if (!rawArray) {
>>+ continue;
>>+ }
>
> is Out Of Memory hidden in favor of best-effort, even if not
> all certs are imported?
I didn't have a specific Out-Of-Memory strategy in mind when putting together
the patch. I'm just making sure not to use NULL pointers, and not introduce too
many exit pathes.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2459027_36541)• 20 years ago |

[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2459223_36541)• 20 years ago |

[Attachment #153803](/attachment.cgi?id=153803&action=edit "Patch v7") -
Flags: approval1.4.3?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 91](/show_bug.cgi?id=249004#c91)• 20 years ago |
|  | |

Comment on [attachment 154493](/attachment.cgi?id=154493 "Patch v7 with nits addressed") [[details]](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") [[diff]](/attachment.cgi?id=154493&action=diff "Patch v7 with nits addressed") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154493)
Patch v7 with nits addressed
carrying forward r= and approval1.7.2+
re-asking brendan for sr
requesting 1.4.3 approval
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Flags: superreview?(brendan)
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Flags: review+
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Flags: approval1.7.2+
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Flags: approval1.4.3?

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 92](/show_bug.cgi?id=249004#c92)• 20 years ago |
|  | |

Comment on [attachment 154493](/attachment.cgi?id=154493 "Patch v7 with nits addressed") [[details]](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") [[diff]](/attachment.cgi?id=154493&action=diff "Patch v7 with nits addressed") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154493)
Patch v7 with nits addressed
a=asa for aviary checkin

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 93](/show_bug.cgi?id=249004#c93)• 20 years ago |
|  | |

Comment on [attachment 154493](/attachment.cgi?id=154493 "Patch v7 with nits addressed") [[details]](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") [[diff]](/attachment.cgi?id=154493&action=diff "Patch v7 with nits addressed") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154493)
Patch v7 with nits addressed
talked to brendan, marking sr=jst/brendan
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Flags: superreview?(brendan) → superreview+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 94](/show_bug.cgi?id=249004#c94)• 20 years ago |
|  | |

I am marking this patch to be blocked by 252271.
This has relevance for trunk development only, and has to do with NSS release
tags used by Mozilla.
We are able to land this patch on any Mozilla branch, including the change to
mozilla/security/nss.
However, before we can land this patch on cvs HEAD, we must wait for the NSS
team to move NSS\_CLIENT\_TAG to a snapshot that includes the fix. I've asked them
in [bug 252271](/show_bug.cgi?id=252271 "RESOLVED FIXED - CERT_VerifyCert with param certUsageVerifyCA fails or asserts").
Blocks: [252271](/show_bug.cgi?id=252271 "RESOLVED FIXED - CERT_VerifyCert with param certUsageVerifyCA fails or asserts")

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2462493_36541)• 20 years ago |

No longer blocks: [252271](/show_bug.cgi?id=252271 "RESOLVED FIXED - CERT_VerifyCert with param certUsageVerifyCA fails or asserts")Depends on: [252271](/show_bug.cgi?id=252271 "RESOLVED FIXED - CERT_VerifyCert with param certUsageVerifyCA fails or asserts")

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 95](/show_bug.cgi?id=249004#c95)• 20 years ago |
|  | |

Checked in to MOZILLA\_1\_7\_BRANCH
adding fixed1.7.2 keyword
Keywords: [fixed1.7.2](/buglist.cgi?keywords=fixed1.7.2&resolution=---)

|  | [Christopher Aillon (sabbatical, not receiving bugmail)](/user_profile?user_id=32335) |  |
| --- | --- | --- |
| [Comment 96](/show_bug.cgi?id=249004#c96)• 20 years ago |
|  | |

Comment on [attachment 154493](/attachment.cgi?id=154493 "Patch v7 with nits addressed") [[details]](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") [[diff]](/attachment.cgi?id=154493&action=diff "Patch v7 with nits addressed") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154493)
Patch v7 with nits addressed
a=blizzard for 1.4.3.
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Flags: approval1.4.3? → approval1.4.3+

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 97](/show_bug.cgi?id=249004#c97)• 20 years ago |
|  | |

Checked in to MOZILLA\_1\_4\_BRANCH
adding fixed1.4.3 keywordKeywords: [fixed1.4.3](/buglist.cgi?keywords=fixed1.4.3&resolution=---)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 98](/show_bug.cgi?id=249004#c98)• 20 years ago |
|  | |

Attached patch

[Patch v7, adjusted for OS/2](attachment.cgi?id=154521&action=diff)
— [Details](attachment.cgi?id=154521&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154521)

This new revision of the patch has a very small change, just one loop variable
was renamed from i to i2, in order to allow it to compile on OS/2.
I have already checked in this bustage fix to MOZILLA\_1\_4\_BRANCH and
MOZILLA\_1\_7\_BRANCH.
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Attachment is obsolete: true

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 99](/show_bug.cgi?id=249004#c99)• 20 years ago |
|  | |

Patch checked in to cvs HEAD, marking fixed.Status: NEW → RESOLVEDClosed: 20 years agoResolution: --- → FIXED

|  | [Michael Lefevre](/user_profile?user_id=35351) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2474166_35351)• 20 years ago |

Whiteboard: [sg:fix]blocking1.4.3+ → [sg:fix]blocking1.4.3+ needed-aviary1.0

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 100](/show_bug.cgi?id=249004#c100)• 20 years ago |
|  | |

The approval-aviary flag (oops, not on the PSM product yet) corresponds to
AVIARY\_1\_0\_20040515\_BRANCH, which is for Firefox 1.0 and Thunderbird 1.0.

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Comment 101](/show_bug.cgi?id=249004#c101)• 20 years ago |
|  | |

Comment on [attachment 154493](/attachment.cgi?id=154493 "Patch v7 with nits addressed") [[details]](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") [[diff]](/attachment.cgi?id=154493&action=diff "Patch v7 with nits addressed") [[review]](/page.cgi?id=splinter.html&ignore=&bug=249004&attachment=154493)
Patch v7 with nits addressed
Who can check this in to the aviary branch?
[Attachment #154493](/attachment.cgi?id=154493&action=edit "Patch v7 with nits addressed") -
Flags: approval-aviary+

|  | [Michael Lefevre](/user_profile?user_id=35351) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2516162_35351)• 20 years ago |

Flags: blocking1.8a3?Flags: blocking1.7.2?

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 102](/show_bug.cgi?id=249004#c102)• 20 years ago |
|  | |

Checked in to AVIARY\_1\_0\_20040515\_BRANCH
Adding fixed-aviary1.0 keywordKeywords: [fixed-aviary1.0](/buglist.cgi?keywords=fixed-aviary1.0&resolution=---)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 103](/show_bug.cgi?id=249004#c103)• 20 years ago |
|  | |

Marcel, thanks again for your report and for producing the testcases.
If you get a chance to download a nightly build that includes the fix, it would
be great to hear from you, whether you agree the issue is fixed.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 104](/show_bug.cgi?id=249004#c104)• 20 years ago |
|  | |

Marcel says he is very busy at the moment, we're looking for volunteers to
verify the bug is fixed with latest builds. Thanks in advance.

|  | [OstGote!](/user_profile?user_id=51898) |  |
| --- | --- | --- |
| [Comment 105](/show_bug.cgi?id=249004#c105)• 20 years ago |
|  | |

Should this go into the 1.7.2 mini-branch too? (MOZILLA\_1\_7\_2\_BRANCH)

|  | [Daniel (Leaf) Nunes](/user_profile?user_id=4016) |  |
| --- | --- | --- |
| [Comment 106](/show_bug.cgi?id=249004#c106)• 20 years ago |
|  | |

(In reply to [comment #105](/show_bug.cgi?id=249004#c105 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email"))
> Should this go into the 1.7.2 mini-branch too? (MOZILLA\_1\_7\_2\_BRANCH)
I'll get it merged in.

|  | [Michael Lefevre](/user_profile?user_id=35351) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a2729308_35351)• 20 years ago |

Whiteboard: [sg:fix]blocking1.4.3+ needed-aviary1.0 → [sg:fix]blocking1.4.3+

|  | [Marcel Boesch](/user_profile?user_id=134282)  Reporter |  |
| --- | --- | --- |
| [Comment 107](/show_bug.cgi?id=249004#c107)• 20 years ago |
|  | |

Kai, thanks for the test build.
I've filed the thesis in now, the busy time is over.
According to my tests with
[http://kuix.de/mozilla/20040727/mozilla-171+-20040727-249004.tar.gz](http://kuix.de/mozilla/20040727/mozilla-171%2B-20040727-249004.tar.gz)
the silent import with mime type x-x509-emailcert is fixed (however i'd like
some info message when clicking the .ecert link instead of "nothing happens".)
However, when using mime type x-x509-cacert the import is still possible, with
the ca cert message dialogue. When clicking through the cert is imported as
untrusted. So far so good.
Now surfing to <https://thawte.com> still throws a -8182, but only before
restarting the browser. Btw, the thawte site seems to have changed their
certificate...
So in my opinion the bug is fixed, thank you all.
/marcel

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 108](/show_bug.cgi?id=249004#c108)• 20 years ago |
|  | |

[Comment 107](/show_bug.cgi?id=249004#c107 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") seems to imply a cert reference leak.
The certs that are not imported should not remain in the temp
cert DB (their references should be deleted before finishing
the processing of the MIME content type that imported them),
and so they should not affect subsequent https URLs.
If they actually do, some reference is apparently being leaked.
This will negatively affect a profile switch.
I'd say there is more work to do here.

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 109](/show_bug.cgi?id=249004#c109)• 20 years ago |
|  | |

@Nelson and @Marcel
During my testing I had experienced the same behaviour that you describe in
[comment 107](/show_bug.cgi?id=249004#c107 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email").
Please read [comment 69](/show_bug.cgi?id=249004#c69 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") which points to [bug 252268](/show_bug.cgi?id=252268 "RESOLVED DUPLICATE - CRL DPCache problems with fake CA cert").
I agree there is a cert leak, however, the leak is not in the new code we have
added. The leak is apparently within NSS, please read the NSS bug and the
duplicate it resolves to.

|  | [sairuh (rarely reading bugmail)](/user_profile?user_id=8793) |  |
| --- | --- | --- |
| [Comment 110](/show_bug.cgi?id=249004#c110)• 20 years ago |
|  | |

what would be a good test case to verify this bug? thanks!

|  | [sairuh (rarely reading bugmail)](/user_profile?user_id=8793) |  |
| --- | --- | --- |
| [Comment 111](/show_bug.cgi?id=249004#c111)• 20 years ago |
|  | |

that is, what would be specific steps to take for an end-user to test this?

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661) |  |
| --- | --- | --- |
| [Comment 112](/show_bug.cgi?id=249004#c112)• 20 years ago |
|  | |

per [comment 106](/show_bug.cgi?id=249004#c106 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") (and bonsai), adding fixed1.7.2 keywordKeywords: [fixed1.7.2](/buglist.cgi?keywords=fixed1.7.2&resolution=---)

|  | [Ralf Hauser](/user_profile?user_id=56971) |  |
| --- | --- | --- |
| [Comment 113](/show_bug.cgi?id=249004#c113)• 20 years ago |
|  | |

FYI: <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2004-0758>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a4489373_1689)• 20 years ago |

Blocks: [sbb?](/show_bug.cgi?id=256195 "RESOLVED WORKSFORME - Security Bug Bounty: nominated")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a6702734_1689)• 20 years ago |

Blocks: [sbb+](/show_bug.cgi?id=256197 "RESOLVED WORKSFORME - Security Bug Bounty: awarded")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a6702847_1689)• 20 years ago |

No longer blocks: [sbb?](/show_bug.cgi?id=256195 "RESOLVED WORKSFORME - Security Bug Bounty: nominated")

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a21862269_15223)• 20 years ago |

Product: PSM → Core

|  | [Ralf Hauser](/user_profile?user_id=56971) |  |
| --- | --- | --- |
| [Comment 114](/show_bug.cgi?id=249004#c114)• 20 years ago |
|  | |

the underlying transportation mechanisms as per [comment 6](/show_bug.cgi?id=249004#c6 "RESOLVED FIXED - Importing false CA certificate leading to error -8182 (perm DoS), especially exploitable by email") for the now fixed
exploits might still not be addressed --> see [Bug 276991](/show_bug.cgi?id=276991 "NEW - No indication of attachment in some virus laden e-mails")

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541)  Assignee |  |
| --- | --- | --- |
| [Comment 115](/show_bug.cgi?id=249004#c115)• 19 years ago |
|  | |

\*\*\* [Bug 174483](/show_bug.cgi?id=174483 "RESOLVED DUPLICATE - Enhance certificate import strategy on incoming messages to avoid bustage") has been marked as a duplicate of this bug. \*\*\*

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=249004#a386505318_1)• 8 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=249004&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


