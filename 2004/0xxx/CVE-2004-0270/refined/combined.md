=== Content from www.freebsd.org_574188c8_20250125_070546.html ===


FreeBSD Bugzilla – Bug 62586
[SECURITY] security/clamav: trivial DOS attack
Last modified: 2004-02-11 10:16:36 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](page.cgi?id=reporting.html)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=62586&GoAheadAndLogIn=1)

  Remember

  [x]
* |
  [Forgot Password](show_bug.cgi?id=62586&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 62586**](show_bug.cgi?id=62586)
- [SECURITY] security/clamav: trivial DOS attack

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
[SECURITY] security/clamav: trivial DOS attack

| | [Status](page.cgi?id=fields.html#bug_status): | Closed FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Ports & Packages | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Ports & Packages "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Individual Port(s) ([show other bugs](buglist.cgi?component=Individual%20Port%28s%29&product=Ports%20%26%20Packages&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | Latest | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Any Any | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal Affects Only Me | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Oliver Eikemeier | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2004-02-09 14:00 UTC by Oliver Eikemeier | | --- | --- | | Modified: | 2004-02-11 10:16 UTC ([History](show_activity.cgi?id=62586)) | | CC List: | 1 user (show)  markun | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [**file.diff**](attachment.cgi?id=39744 "View the content of the attachment") (299 bytes, patch)  [2004-02-09 14:00 UTC](#attach_39744 "Go to the comment associated with the attachment"), Oliver Eikemeier | *no flags* | [Details](attachment.cgi?id=39744&action=edit) | [Diff](attachment.cgi?id=39744&action=diff) | | [**patch-libclamav--message.c**](attachment.cgi?id=39745 "View the content of the attachment") (3.70 KB, text/plain)  [2004-02-09 22:47 UTC](#attach_39745 "Go to the comment associated with the attachment"), Rui Lopes | *no flags* | [Details](attachment.cgi?id=39745&action=edit) | | [View All](attachment.cgi?bugid=62586&action=viewall)  [Add an attachment](attachment.cgi?bugid=62586&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=62586&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=62586#c0)  Oliver Eikemeier    2004-02-09 14:00:33 UTC  ```  It is trivial to crash clamd using a malformed uuencoded message, resulting in a denial of service for all programs (e.g. SMTP daemons) relying on clamd running. The message must only contain one uuencoded line with an illegal line lenght, i.e. starting with a small letter.  libclamav calculates the line lenght of an uuencoded line by taking the ASCII value of the first character minus 64 and does an `assert' if the length is not in the allowed range, effectively terminating the calling program.  Fix: Add the following in files/patch-libclamav::message.c: How-To-Repeat:  Save the following file to ~/clamtest.mbox, removing the leading 'X':  XFrom - X Xbegin 644 byebye Xbyebye Xend  Then do:  # clamscan --mbox -v ~/clamtest.mbox assertion "(len >= 0) && (len <= 63)" failed: file "message.c", line 887 Abort (core dumped)  or  # clamdscan -v ~/clamtest.mbox; ps ax | grep clam ```  [Comment 1](show_bug.cgi?id=62586#c1)  Oliver Eikemeier   freebsd_committer freebsd_triage  2004-02-09 14:02:10 UTC  ``` Responsible Changed From-To: freebsd-ports-bugs->eik  I'll take it. ```  [Comment 2](show_bug.cgi?id=62586#c2)  Oliver Eikemeier    2004-02-09 14:21:38 UTC  ``` Argh! Fixed patch:  --- libclamav/message.c.orig	Wed Nov  5 11:59:53 2003 +++ libclamav/message.c	Mon Feb  9 15:17:13 2004 @@ -878,13 +878,16 @@  			if(strcasecmp(line, "end") == 0)  				break;   -			assert(strlen(line) <= 62); +			if(strlen(line) > 62) +				break; +  			if((line[0] & 0x3F) == ' ')  				break;    			len = *line++ - ' ';   -			assert((len >= 0) && (len <= 63)); +			if(len < 0 || len > 63) +				break;    			ptr = decode(line, ptr, uudecode, (len & 3) == 0);  			break; ```  [Comment 3](show_bug.cgi?id=62586#c3)  njh    2004-02-09 15:12:41 UTC  ``` This has been fixed in the latest code (see CVS) for sometime.  --  Nigel Horne. Arranger, Composer, Typesetter. NJH Music, Barnsley, UK.  ICQ#20252325 njh@despammed.com <http://www.bandsman.co.uk> ```  [Comment 4](show_bug.cgi?id=62586#c4)  Oliver Eikemeier    2004-02-09 15:18:14 UTC  ``` Nigel Horne wrote:  > This has been fixed in the latest code (see CVS) for sometime.  ... but not in the relase version, which most production servers will run. ```  [Comment 5](show_bug.cgi?id=62586#c5)  Rui Lopes    2004-02-09 22:47:13 UTC  ``` Hi,  In the attachment is a patch that was retreived directly from  clamav-devel sources.   Regards, Rui Lopes ```  [Comment 6](show_bug.cgi?id=62586#c6)  Oliver Eikemeier   freebsd_committer freebsd_triage  2004-02-11 10:16:06 UTC  ``` State Changed From-To: open->closed  fixed. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=62586)
* - [XML](show_bug.cgi?ctype=xml&id=62586)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=62586)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](page.cgi?id=reporting.html)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=62586&GoAheadAndLogIn=1)

    Remember

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=62586&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from security.gentoo.org_76c5115d_20250125_070544.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Clam Antivirus DoS vulnerability — GLSA **200402-07**

Oliver Eikemeier has reported a vulnerability in Clam AV, which can be
exploited by a malformed uuencoded message causing a denial of service for
programs that rely on the clamav daemon, such as SMTP daemons.

### Affected packages

| Package | **app-antivirus/clamav** on all architectures |
| --- | --- |
| Affected versions | < **0.67** |
| Unaffected versions | >= **0.67** |

### Background

Clam AntiVirus is a GPLed anti-virus toolkit, designed for integration with
mail servers to perform attachment scanning. Clam AV also provides a
command line scanner and a tool for fetching updates of the virus database.

### Description

Oliver Eikemeier of Fillmore Labs discovered the overflow in Clam AV 0.65
when it handled malformed UUEncoded messages, causing the daemon to shut
down.

The problem originated in libclamav which calculates the line length of an
uuencoded message by taking the ASCII value of the first character minus 64
while doing an assertion if the length is not in the allowed range,
effectively terminating the calling program as clamav would not be
available.

### Impact

A malformed message would cause a denial of service,
and depending on the server configuration this may impact other daemons
relying on Clam AV in a fatal manner.

### Workaround

There is no immediate workaround, a software upgrade is required.

### Resolution

All users are urged to upgrade their Clam AV installations to Clam AV 0.67:

```
 # emerge sync
 # emerge -pv ">=app-antivirus/clamav-0.6.7"
 # emerge ">=app-antivirus/clamav-0.6.7"
```
### References

**Release date**

February 17, 2004

**Latest revision**

February 17, 2004: 01

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [41248](https://bugs.gentoo.org/show_bug.cgi?id=41248)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from marc.info_bea17609_20250125_070543.html ===

```
[[prev in list](?l=bugtraq&m=107635612210739&w=2)] [[next in list](?l=bugtraq&m=107634756805543&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=107634756805543&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [clamav 0.65 remote DOS exploit](?t=107634707100007&r=1&w=2)
From:       [Oliver Eikemeier <eikemeier () fillmore-labs ! com>](?a=102613750400005&r=1&w=2)
Date:       [2004-02-09 14:24:17](?l=bugtraq&r=1&w=2&b=200402)
Message-ID: [40279811.9050407 () fillmore-labs ! com](?i=40279811.9050407%20()%20fillmore-labs%20!%20com)
[Download RAW [message](?l=bugtraq&m=107634700823822&q=mbox) or [body](?l=bugtraq&m=107634700823822&q=raw)]

>Description:

It is trivial to crash clamd using a malformed uuencoded message, resulting in a
denial of service for all programs (e.g. SMTP daemons) relying on clamd running.
The message must only contain one uuencoded line with an illegal line lenght, i.e.
starting with a small letter.

libclamav calculates the line lenght of an uuencoded line by taking the ASCII value
of the first character minus 64 and does an `assert' if the length is not in the
allowed range, effectively terminating the calling program.

>How-To-Repeat:

Save the following file to ~/clamtest.mbox, removing the leading 'X':

XFrom -
X
Xbegin 644 byebye
Xbyebye
Xend

Then do:

# clamscan --mbox -v ~/clamtest.mbox
assertion "(len >= 0) && (len <= 63)" failed: file "message.c", line 887
Abort (core dumped)

or

# clamdscan -v ~/clamtest.mbox; ps ax | grep clam

>Fix:

Apply the following patch to libclamav/message.c:

--- libclamav/message.c.orig	Wed Nov  5 11:59:53 2003
+++ libclamav/message.c	Mon Feb  9 15:17:13 2004
@@ -878,13 +878,16 @@
 			if(strcasecmp(line, "end") == 0)
 				break;

-			assert(strlen(line) <= 62);
+			if(strlen(line) > 62)
+				break;
+
 			if((line[[0]](#0) & 0x3F) == ' ')
 				break;

 			len = *line++ - ' ';

-			assert((len >= 0) && (len <= 63));
+			if(len < 0 || len > 63)
+				break;

 			ptr = decode(line, ptr, uudecode, (len & 3) == 0);
 			break;

>References:

FreeBSD PR 62586:
  <<http://www.freebsd.org/cgi/query-pr.cgi?pr=62586>>
[[prev in list](?l=bugtraq&m=107635612210739&w=2)] [[next in list](?l=bugtraq&m=107634756805543&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=107634756805543&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)


