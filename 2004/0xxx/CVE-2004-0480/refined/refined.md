- **Root cause of vulnerability:** The vulnerability arises from the way Lotus Notes handles "notes:" URLs. When a "notes:" URL is encountered, the system passes the URL as a command-line argument to notes.exe. If the URL contains spaces, characters after the space are treated as separate command-line arguments. This allows an attacker to inject malicious command-line arguments.
- **Weaknesses/vulnerabilities present:** The primary vulnerability is the insecure handling of command-line arguments by notes.exe. It does not sanitize or validate the input from the URL, which allows for argument injection. Specifically, the program interprets arguments passed after space characters as additional parameters. This allows for the specification of an arbitrary configuration file (`notes.ini`) through command-line injection. Additionally, the application's use of the `notes.ini` file for specifying the data directory which is used to load dynamic libraries is insecure as the program does not validate the path, and allows loading of libraries from a remote network share.
- **Impact of exploitation:** By exploiting this vulnerability, an attacker can execute arbitrary code on the victim's system. Specifically, they can control which `notes.ini` file is loaded, which dictates where the application loads its libraries from. An attacker can force Lotus Notes to load a malicious DLL from a network share, causing the code within the DLL to be executed when Lotus Notes starts.
- **Attack vectors:** The attack vector is via specially crafted "notes:" URLs. These URLs can be embedded in web pages or email messages. When a victim clicks on such a link, notes.exe is launched with the malicious URL as a command-line argument.
- **Required attacker capabilities/position:** The attacker needs to be able to host a malicious `notes.ini` file and a malicious DLL on a network share accessible to the victim. The attacker must also be able to deliver a malicious "notes:" URL to the victim, e.g. via a web page or email. The victim's system must also be configured to allow network shares connections and the attack only works when notes.exe isn't already running.