=== Content from svn.ec-cube.net_31c316b2_20250124_212454.html ===

[![EC-CUBE](/open_trac/raw-attachment/wiki/WikiStart/trac.jpg)](http://svn.ec-cube.net/open_trac/)

Search:

* [Login](/open_trac/login)
* [Help/Guide](/open_trac/wiki/TracGuide)
* [About Trac](/open_trac/about)
* [Preferences](/open_trac/prefs)

* [Wiki](/open_trac/wiki)
* [Browse Source](/open_trac/browser)
* [View Tickets](/open_trac/report)
* [Search](/open_trac/search)
* [Timeline](/open_trac/timeline)
* [Roadmap](/open_trac/roadmap)

## Context Navigation

* ← [Previous Changeset](/open_trac/changeset/22860 "Changeset 22860")
* [Next Changeset](/open_trac/changeset/22862 "Changeset 22862") →

---

# Changeset 22861

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
2013/06/19 16:50:22
([12 years](/open_trac/timeline?from=2013-06-19T16%3A50%3A22%2B09%3A00&precision=second "2013-06-19T16:50:22+09:00 in Timeline") ago)

Author:
m\_uehara
Message:

[#2264](/open_trac/ticket/2264 "バグ指摘: おすすめ商品検索画面にエスケープ漏れの項目がある (closed: 修正済)") おすすめ商品検索エスケープ漏れ対応

Location:
[branches/version-2\_12-dev/data](/open_trac/browser/branches/version-2_12-dev/data?rev=22861)
Files:

2 edited

* [Smarty/templates/admin/contents/recommend\_search.tpl](/open_trac/browser/branches/version-2_12-dev/data/Smarty/templates/admin/contents/recommend_search.tpl?rev=22861 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [class/pages/admin/contents/LC\_Page\_Admin\_Contents\_RecommendSearch.php](/open_trac/browser/branches/version-2_12-dev/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php?rev=22861 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [branches/version-2\_12-dev/data/Smarty/templates/admin/contents/recommend\_search.tpl](/open_trac/changeset/22861/branches/version-2_12-dev/data/Smarty/templates/admin/contents/recommend_search.tpl "Show the changeset 22861 restricted to branches/version-2_12-dev/data/Smarty/templates/admin/contents/recommend_search.tpl")

  | [r22796](/open_trac/browser/branches/version-2_12-dev/data/Smarty/templates/admin/contents/recommend_search.tpl?rev=22796#L30 "Show revision 22796 of this file in browser") | [r22861](/open_trac/browser/branches/version-2_12-dev/data/Smarty/templates/admin/contents/recommend_search.tpl?rev=22861#L30 "Show revision 22861 of this file in browser") |  |
  | --- | --- | --- |
  | 30 | 30 |  |
  | 31 | 31 | function func\_submit( id ){ |
  | 32 |  | var fm = window.opener.document.form<!--{$~~smarty.get.rank~~}-->; |
  |  | 32 | var fm = window.opener.document.form<!--{$rank|h}-->; |
  | 33 | 33 | fm.product\_id.value = id; |
  | 34 | 34 | fm.mode.value = 'set\_item'; |
  | 35 |  | fm.rank.value = '<!--{$~~smarty.get.rank~~}-->'; |
  |  | 35 | fm.rank.value = '<!--{$rank|h}-->'; |
  | 36 | 36 | fm.submit(); |
  | 37 | 37 | window.close(); |
* ## [branches/version-2\_12-dev/data/class/pages/admin/contents/LC\_Page\_Admin\_Contents\_RecommendSearch.php](/open_trac/changeset/22861/branches/version-2_12-dev/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php "Show the changeset 22861 restricted to branches/version-2_12-dev/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php")

  | [r22796](/open_trac/browser/branches/version-2_12-dev/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php?rev=22796#L72 "Show revision 22796 of this file in browser") | [r22861](/open_trac/browser/branches/version-2_12-dev/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php?rev=22861#L72 "Show revision 22861 of this file in browser") |  |
  | --- | --- | --- |
  | 72 | 72 | $objFormParam->setParam($\_POST); |
  | 73 | 73 | $objFormParam->convParam(); |
  |  | 74 |  |
  |  | 75 | $rank = intval($\_GET['rank']); |
  | 74 | 76 |  |
  | 75 | 77 | switch ($this->getMode()) { |
  | […](/open_trac/browser/branches/version-2_12-dev/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php?rev=22796#L104) | […](/open_trac/browser/branches/version-2_12-dev/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php?rev=22861#L106) |  |
  | 104 | 106 | // カテゴリ取得 |
  | 105 | 107 | $this->arrCatList = $objDb->sfGetCategoryList(); |
  |  | 108 | $this->rank       = $rank; |
  | 106 | 109 | $this->setTemplate('contents/recommend\_search.tpl'); |
  | 107 | 110 |  |

**Note:** See [TracChangeset](/open_trac/wiki/TracChangeset)
for help on using the changeset viewer.

### Download in other formats:

* [Unified Diff](?format=diff&new=22861)
* [Zip Archive](?format=zip&new=22861)

---

[![Trac Powered](/open_trac_common/htdocs/common/trac_logo_mini.png)](http://trac.edgewall.org/)

Powered by [**Trac 0.12.ja1**](/open_trac/about)

By [Edgewall Software](http://www.edgewall.org/).

Re-distributed by [インタアクト株式会社](http://www.i-act.co.jp/)

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from jvndb.jvn.jp_b26169f7_20250124_212452.html ===


![JVN iPedia](/en/common/img/en_logo.gif)
Last Updated:2013/07/02

| [[Japanese]](/ja/contents/2013/JVNDB-2013-000064.html) | |
| --- | --- |
| JVNDB-2013-000064 | |
| EC-CUBE vulnerable to cross-site scripting | |
| Overview | |
| EC-CUBE from LOCKON CO.,LTD. is an open source system for creating shopping websites. EC-CUBE contains a cross-site scripting vulnerability. | |
| CVSS Severity ([What is CVSS?](/en/nav/jvndbhelp.html#jvndb3)) | |
| **CVSS V2 Severity:Base Metrics [2.6](/cvss/en/v2.html#AV:N/AC:H/Au:N/C:N/I:P/A:N) (Low) [IPA Score]**  * Access Vector: Network * Access Complexity: High * Authentication: None * Confidentiality Impact: None * Integrity Impact: Partial * Availability Impact: None | |
| Affected Products | |
|  | |
| LOCKON CO.,LTD  * EC-CUBE prior to 2.12.5 | |
|  | |
| Impact | |
| An arbitrary script may be executed on the user's web browser. | |
| Solution | |
| [Apply the update or patch] | |
| Vendor Information | |
| LOCKON CO.,LTD  * LOCKON CO.,LTD : [Cross-site scripting vulnerability in the management screen in EC-CUBE](http://www.ec-cube.net/info/weakness/weakness.php?id=46) (in Japanese) | |
| CWE ([What is CWE?](http://www.ipa.go.jp/security/english/vuln/CWE_en.html)) | |
| 1. [Cross-site Scripting](http://www.ipa.go.jp/security/english/vuln/CWE_en.html#CWE79)(CWE-79) [IPA Evaluation] | |
| CVE ([What is CVE?](http://www.ipa.go.jp/security/english/vuln/CVE_en.html)) | |
| 1. [CVE-2013-3653](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-3653) | |
| References | |
| 1. JVN : [JVN#98665228](http://jvn.jp/en/jp/JVN98665228/index.html) 2. National Vulnerability Database (NVD) : [CVE-2013-3653](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2013-3653) | |
| Revision History | |
| * [2013/06/27] | |

| --- | |
| --- | --- |
| Date Public | 2013/06/27 |
| Date First Published | 2013/06/27 |
| Date Last Updated | 2013/07/02 |
| --- | |

* JVN
* [HOME](http://jvn.jp/en/)
* [What is JVN ?](http://jvn.jp/en/nav/jvn.html)
* [Instructions](http://jvn.jp/en/nav/jvnhelp.html)
* [List of Vulnerability Report](http://jvn.jp/en/report/index.html)
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* [TRnotes](http://jvn.jp/en/tr/index.html)
* [JVN iPedia](/en/)
* [Search](/search/index.php?mode=_vulnerability_search_IA_VulnSearch&lang=en)
* [What is JVN iPedia?](/en/nav/jvndb.html)
* [How to Use?](/en/nav/jvndbhelp.html)
* [MyJVN](/en/apis/myjvn/index.html)
* [JVNJS/RSS](http://jvn.jp/en/rss/index.html)
* [Vendor List](http://jvn.jp/en/nav/index.html)
* [List of unreachable developers](http://jvn.jp/en/reply/index.html)
* [Contact](http://jvn.jp/en/contact/index.html)

![Copyright © 2007- IPA. All rights reserved.](/common/img/copyright.png)



=== Content from jvn.jp_65c17bd1_20250124_212449.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2013/06/27  Last Updated:2013/06/27
# JVN#98665228 EC-CUBE vulnerable to cross-site scripting

## Overview

EC-CUBE contains a cross-site scripting vulnerability.

## Products Affected

* EC-CUBE prior to 2.12.5

## Description

EC-CUBE from LOCKON CO.,LTD. is an open source system for creating shopping websites. EC-CUBE contains a cross-site scripting vulnerability.

Note that this vulnerability is different from [JVN#07192063](https://jvn.jp/en/jp/JVN07192063/).

## Impact

An arbitrary script may be executed on the user's web browser.

## Solution

**Apply the update or patch**
Apply the update or patch according to the information provided by the developer.

## Vendor Status

| Vendor | Link |
| --- | --- |
| LOCKON CO.,LTD. | [Cross-site scripting vulnerability in the management screen in EC-CUBE](http://www.ec-cube.net/info/weakness/weakness.php?id=46) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

**Analyzed on 2013.06.27**

| Measures | Conditions | Severity |
| Access Required | can be attacked over the Internet using packets | * High |
| Authentication | anonymous or no authentication (IP addresses do not count) | * High |
| User Interaction Required | the user must be convinced to take a standard action that does not feel harmful to most users, such as click on a link or view a file | * Mid |
| Exploit Complexity | the user must be convinced to take a difficult or suspicious action. If the honest user must have elevated privileges, they are likely to be more suspiciouse | * High |

[Description of each analysis measures](http://jvn.jp/en/nav/jvnhelp.html#analysys)

## Credit

Ren Hirasawa of Gehirn Inc. reported this vulnerability to IPA.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2013-3653](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-3653) |
| JVN iPedia | [JVNDB-2013-000064](http://jvndb.jvn.jp/jvndb/JVNDB-2013-000064) |

* JVN
* HOME
* What is JVN ?
* Instructions
* List of Vulnerability Report
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* TRnotes
* JVN iPedia
* MyJVN
* JVNJS/RSS
* Vendor List
* List of unreachable developers
* Contact

Copyright (c) 2000-2013 JPCERT/CC and IPA. All rights reserved.



=== Content from www.ec-cube.net_d8eaf500_20250124_212456.html ===


| | 緊急度の高い2件を含めた5件の脆弱性に関しまして(2013年6月26日) | | --- |  |  | | --- | |  | | EC-CUBE 脆弱性に関するお知らせ | | いつもEC-CUBEをご利用いただきまして、誠にありがとうございます。  **EC-CUBE（2.4系以下/2.11系/2.12系）**に緊急度の高い2件の脆弱性を含め5件の脆弱性があることが判明いたしました。 （本脆弱性における被害報告は現在ございません。）  脆弱性そのものは該当ファイルのソースコード修正、またはファイルの上書きにより、すぐに解決するものです。  皆様にはお手数おかけしまして誠に申し訳ございませんが、対策を早急に講じて頂きますよう、どうかよろしくお願い申し上げます。 | |  | | 修正方法につきまして | | 1.EC-CUBEバージョンごとの修正ファイルをダウンロードしてください。   ※バージョンの確認方法   EC-CUBE管理画面へログイン後のホーム画面にてご確認頂けます。   また、カスタマイズによってシステム情報が表示されない場合は、以下のファイルをご確認下さい。   - data/class/SC\_Initial.php(40行目付近)   <例>-------------------------------------   /\*\* EC-CUBEのバージョン \*/   define('ECCUBE\_VERSION', '2.12.4');   -----------------------------------------   上記の例の場合、EC-CUBEのバージョンは2.12.4となります。  ※ 2.4系以下をお使いの方、該当ファイルをカスタマイズしている場合は以下をご参考いだだき個別で修正をお願いいたします。 ・ 2.4系以下をお使いの方は下記をご参考いだだき個別で修正をお願いいたします。   [【危険度：中】EC-CUBE における管理画面でのクロスサイト・スクリプティング](#2.4_1)   [【危険度：低】resize\_image.phpによるディレクトリトラバーサル](#2.4_2) ・ [修正ファイル(2.11.0用)](./eccube2110_update_files.zip)   md5：cdd926b92a7205c82bb9420b86ab6588 ・ [修正ファイル(2.11.1用)](./eccube2111_update_files.zip)   md5：9bfe49038cd8741c5afddf90c044796e ・ [修正ファイル(2.11.2用)](./eccube2112_update_files.zip)   md5：1a2bd540cb05d553e5fc2dd7b72de29e ・ [修正ファイル(2.11.3用)](./eccube2113_update_files.zip)   md5：c62ce27b9237153a0382e6a69f629e40 ・ [修正ファイル(2.11.4用)](./eccube2114_update_files.zip)   md5：38ceefac99d14be2bac60ffe6bc7c3de ・ [修正ファイル(2.11.5用)](./eccube2115_update_files.zip)   md5：0b2e4f996322191dd151533a468c6905 ・ [修正ファイル(2.12.0用)](./eccube2120_update_files.zip)   md5：db007a684f61d8bbbd9d95a165442e50 ・ [修正ファイル(2.12.1用)](./eccube2121_update_files.zip)   md5：c07598cdf8661ed2884abad1bdce86cd ・ [修正ファイル(2.12.2用)](./eccube2122_update_files.zip)   md5：0e1e3aaa2084f982ffc210ecb91febee ・ [修正ファイル(2.12.3用)](./eccube2123_update_files.zip)   md5：af30fdecaf9bfdf4f753ff989ea60d86 ・ [修正ファイル(2.12.3en用)](./eccube2123en_update_files.zip)   md5：d691eec7e99e86de2132fc60ac49f52e ・ [修正ファイル(2.12.3enP1用)](./eccube2123enp1_update_files.zip)   md5：d92f9789a24ce5d4995665f10b2b0998 ・ [修正ファイル(2.12.3enP2用)](./eccube2123enp2_update_files.zip)   md5：f06eed9b30ce6014d7198362392c3a6e ・ [修正ファイル(2.12.4用)](./eccube2124_update_files.zip)   md5：0f3678a9d180c6340be6f0070f6e8ab6 ・ [修正ファイル(2.12.4en用)](./eccube2124en_update_files.zip)   md5：5fc7a38389d23d4680c204e0844b1d12 2.修正する該当ファイル、もしくはEC-CUBEファイル全体のバックアップをとってください。 3.ダウンロードしたファイルを解凍し、該当ファイルを既存ファイルへ上書きしてください。   ※ディレクトリ付きファイルですので、ルートディレクトリからそのままファイルの上書きが可能です。   （EC-CUBEデフォルトのディレクトリ構造以外で使用されている場合、ファイルの上書きができない可能性がございますのでご注意ください）   ※既存ファイルをカスタマイズしている場合、以下個別の修正方法をご参考に修正をお願いします。  4.動作確認をしてください。   ※今回の修正によりプラグインが正常に動作しなくなる可能性がございます。  以上となります。 開発環境がある場合は、まず開発環境でお試しください。 | |  |  | | 本不具合に対する対応方法 | | --- | | ```  ----------------------------------------------------------------------------------------------------------------- ■不具合が存在するEC-CUBEのバージョン -----------------------------------------------------------------------------------------------------------------  [【危険度：高】パストラバーサルの脆弱性](#01)  - EC-CUBE　2.12.0  - EC-CUBE　2.12.1  - EC-CUBE　2.12.2  - EC-CUBE　2.12.3  - EC-CUBE　2.12.3en  - EC-CUBE　2.12.3enP1  - EC-CUBE　2.12.3enP2  - EC-CUBE　2.12.4  - EC-CUBE　2.12.4en   [【危険度：高】コードインジェクションの脆弱性](#01)  - EC-CUBE　2.11.2  - EC-CUBE　2.11.3  - EC-CUBE　2.11.4  - EC-CUBE　2.11.5  - EC-CUBE　2.12.0  - EC-CUBE　2.12.1  - EC-CUBE　2.12.2  - EC-CUBE　2.12.3  - EC-CUBE　2.12.3en  - EC-CUBE　2.12.3enP1  - EC-CUBE　2.12.3enP2  - EC-CUBE　2.12.4  - EC-CUBE　2.12.4en  [【危険度：中】EC-CUBE におけるクロスサイト・スクリプティング](#03)  - EC-CUBE　2.11.0  - EC-CUBE　2.11.1  - EC-CUBE　2.11.2  - EC-CUBE　2.11.3  - EC-CUBE　2.11.4  - EC-CUBE　2.11.5  - EC-CUBE　2.12.0  - EC-CUBE　2.12.1  - EC-CUBE　2.12.2  - EC-CUBE　2.12.3  - EC-CUBE　2.12.3en  - EC-CUBE　2.12.3enP1  - EC-CUBE　2.12.3enP2  - EC-CUBE　2.12.4  - EC-CUBE　2.12.4en   [【危険度：中】EC-CUBE における管理画面でのクロスサイト・スクリプティング](#04)  - EC-CUBE　全てのバージョン（2.4系以下/2.11系/2.12系）  [【危険度：低】resize_image.phpによるディレクトリトラバーサル](#05)  - EC-CUBE　全てのバージョン（2.4系以下/2.11系/2.12系）    ``` ```   ----------------------------------------------------------------------------------------------------------------- ■個別の脆弱性情報に関しまして -----------------------------------------------------------------------------------------------------------------  ``` ```  以下、個別の脆弱性情報を記載いたします。 該当ファイルをカスタマイズしている場合は以下をご参考いだだき個別で修正をお願いいたします。  /data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php::action /data/class/pages/products/LC_Page_Products_List.php::lfSetSelectedData /data/class/pages/LC_Page_ResizeImage.php::lfCheckFileName /data/class/SC_CheckError.php::EXIST_CHECK_REVERSE /data/class/SC_CheckError.php::EQUAL_CHECK /data/class/SC_CheckError.php::DIFFERENT_CHECK /data/class/SC_CheckError.php::GREATER_CHECK /data/class/SC_CheckError.php::CHECK_SET_TERM /data/class/SC_CheckError.php::CHECK_SET_TERM2 /data/class/SC_CheckError.php::CHECK_SET_TERM3 /data/class/SC_CheckError.php::EVAL_CHECK /data/class/SC_CheckError.php::createParam /data/class/SC_FormParam.php::recursionCheck /data/Smarty/templates/admin/contents/recommend_search.tpl  ※行数はバージョン・カスタマイズの内容によって異なりますので、ご注意下さい。  ``` | |  | | ```  ================================================================================================================= ▼パストラバーサルの脆弱性 ▼コードインジェクションの脆弱性 ----------------------------------------------------------------------------------------------------------------- 【危険度】 高  【修正方法について】 /data/class/SC_FormParam.php /data/class/SC_CheckError.php に以下の変更を加えます。  【修正後の確認方法について】 「管理画面」顧客管理＞顧客マスターの動作確認を行ってください。   ▽SC_FormParam.php 279行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- $objErr = new SC_CheckError_Ex(array(0 => $value)); $objErr->doFunc(array($disp_name, 0, $length), array($func)) -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- $objErr = new SC_CheckError_Ex(array(($error_last_key ? $error_last_key : $error_key) => $value)); $objErr->doFunc(array($disp_name, ($error_last_key ? $error_last_key : $error_key), $length), array($func));  -------------------------------------------------------------------  ▽SC_CheckError.php 102行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function EXIST_CHECK_REVERSE($value) {     if (isset($this->arrErr[$value[0]])) {         return;     }     $this->createParam($value);     if (strlen($this->arrParam[$value[0]]) == 0) {         $this->arrErr[$value[0]] = '※ ' . $value[0] . 'が入力されていません。<br />';     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function EXIST_CHECK_REVERSE($value) {     if (isset($this->arrErr[$value[0]])) {         return;     }     // $this->createParam($value);     if (strlen($this->arrParam[$value[0]]) == 0) {         $this->arrErr[$value[0]] = '※ ' . $value[0] . 'が入力されていません。<br />';     } } -------------------------------------------------------------------  185行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function EQUAL_CHECK( $value ) {     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[3]])) {         return;     }     $this->createParam($value);     // 文字数の取得     if( $this->arrParam[$value[2]] != $this->arrParam[$value[3]]) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "と" . $value[1] . "が一致しません。<br />";     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function EQUAL_CHECK( $value ) {     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[3]])) {         return;     }     // $this->createParam($value);     // 文字数の取得     if( $this->arrParam[$value[2]] != $this->arrParam[$value[3]]) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "と" . $value[1] . "が一致しません。<br />";     } } -------------------------------------------------------------------  203行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function DIFFERENT_CHECK( $value ) {     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[3]])) {         return;     }     $this->createParam($value);     // 文字数の取得     if( $this->arrParam[$value[2]] == $this->arrParam[$value[3]]) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "と" . $value[1] . "は、同じ値を使用できません。<br />";     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function DIFFERENT_CHECK( $value ) {     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[3]])) {         return;     }     // $this->createParam($value);     // 文字数の取得     if( $this->arrParam[$value[2]] == $this->arrParam[$value[3]]) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "と" . $value[1] . "は、同じ値を使用できません。<br />";     } } -------------------------------------------------------------------  221行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function GREATER_CHECK($value) {     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[3]])) {         return;     }     $this->createParam($value);     // 文字数の取得     if($this->arrParam[$value[2]] != "" && $this->arrParam[$value[3]] != "" && ($this->arrParam[$value[2]] > $this->arrParam[$value[3]])) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "は" . $value[1] . "より大きい値を入力できません。<br />";     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function GREATER_CHECK($value) {     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[3]])) {         return;     }     // $this->createParam($value);     // 文字数の取得     if($this->arrParam[$value[2]] != "" && $this->arrParam[$value[3]] != "" && ($this->arrParam[$value[2]] > $this->arrParam[$value[3]])) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "は" . $value[1] . "より大きい値を入力できません。<br />";     } } -------------------------------------------------------------------  932行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function CHECK_SET_TERM ($value) {      // 期間指定     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[5]])) {         return;     }     $this->createParam($value);     $error = 0;     if ( (strlen($this->arrParam[$value[2]]) > 0 || strlen($this->arrParam[$value[3]]) > 0 || strlen($this->arrParam[$value[4]] ) > 0) && ! checkdate($this->arrParam[$value[3]], $this->arrParam[$value[4]], $this->arrParam[$value[2]]) ) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[5]]) > 0 || strlen($this->arrParam[$value[6]]) > 0 || strlen($this->arrParam[$value[7]] ) > 0) && ! checkdate($this->arrParam[$value[6]], $this->arrParam[$value[7]], $this->arrParam[$value[5]]) ) {         $this->arrErr[$value[5]] = "※ " . $value[1] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[2]]) > 0 && strlen($this->arrParam[$value[3]]) > 0 && strlen($this->arrParam[$value[4]] ) > 0) &&  (strlen($this->arrParam[$value[5]]) > 0 || strlen($this->arrParam[$value[6]]) > 0 || strlen($this->arrParam[$value[7]] ) > 0) ){          $date1 = $this->arrParam[$value[2]] .sprintf("%02d", $this->arrParam[$value[3]]) .sprintf("%02d",$this->arrParam[$value[4]]) ."000000";         $date2 = $this->arrParam[$value[5]] .sprintf("%02d", $this->arrParam[$value[6]]) .sprintf("%02d",$this->arrParam[$value[7]]) ."235959";          if (($this->arrErr[$value[2]] == "" && $this->arrErr[$value[5]] == "") && $date1 > $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function CHECK_SET_TERM ($value) {      // 期間指定     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[5]])) {         return;     }     // $this->createParam($value);     $error = 0;     if ( (strlen($this->arrParam[$value[2]]) > 0 || strlen($this->arrParam[$value[3]]) > 0 || strlen($this->arrParam[$value[4]] ) > 0) && ! checkdate($this->arrParam[$value[3]], $this->arrParam[$value[4]], $this->arrParam[$value[2]]) ) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[5]]) > 0 || strlen($this->arrParam[$value[6]]) > 0 || strlen($this->arrParam[$value[7]] ) > 0) && ! checkdate($this->arrParam[$value[6]], $this->arrParam[$value[7]], $this->arrParam[$value[5]]) ) {         $this->arrErr[$value[5]] = "※ " . $value[1] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[2]]) > 0 && strlen($this->arrParam[$value[3]]) > 0 && strlen($this->arrParam[$value[4]] ) > 0) &&  (strlen($this->arrParam[$value[5]]) > 0 || strlen($this->arrParam[$value[6]]) > 0 || strlen($this->arrParam[$value[7]] ) > 0) ){          $date1 = $this->arrParam[$value[2]] .sprintf("%02d", $this->arrParam[$value[3]]) .sprintf("%02d",$this->arrParam[$value[4]]) ."000000";         $date2 = $this->arrParam[$value[5]] .sprintf("%02d", $this->arrParam[$value[6]]) .sprintf("%02d",$this->arrParam[$value[7]]) ."235959";          if (($this->arrErr[$value[2]] == "" && $this->arrErr[$value[5]] == "") && $date1 > $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }     } } -------------------------------------------------------------------  982行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function CHECK_SET_TERM2 ($value) {      // 期間指定     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[8]])) {         return;     }     $this->createParam($value);     $error = 0;     if ( (strlen($this->arrParam[$value[2]]) > 0 || strlen($this->arrParam[$value[3]]) > 0 || strlen($this->arrParam[$value[4]] ) > 0 || strlen($this->arrParam[$value[5]]) > 0) && ! checkdate($this->arrParam[$value[3]], $this->arrParam[$value[4]], $this->arrParam[$value[2]]) ) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[8]]) > 0 || strlen($this->arrParam[$value[9]]) > 0 || strlen($this->arrParam[$value[10]] ) > 0 || strlen($this->arrParam[$value[11]] ) > 0) && ! checkdate($this->arrParam[$value[9]], $this->arrParam[$value[10]], $this->arrParam[$value[8]]) ) {         $this->arrErr[$value[8]] = "※ " . $value[1] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[2]]) > 0 && strlen($this->arrParam[$value[3]]) > 0 && strlen($this->arrParam[$value[4]] ) > 0 && strlen($this->arrParam[$value[5]] ) > 0) &&  (strlen($this->arrParam[$value[8]]) > 0 || strlen($this->arrParam[$value[9]]) > 0 || strlen($this->arrParam[$value[10]] ) > 0 || strlen($this->arrParam[$value[11]] ) > 0) ){          $date1 = $this->arrParam[$value[2]] .sprintf("%02d", $this->arrParam[$value[3]]) .sprintf("%02d",$this->arrParam[$value[4]]) .sprintf("%02d",$this->arrParam[$value[5]]).sprintf("%02d",$this->arrParam[$value[6]]).sprintf("%02d",$this->arrParam[$value[7]]);         $date2 = $this->arrParam[$value[8]] .sprintf("%02d", $this->arrParam[$value[9]]) .sprintf("%02d",$this->arrParam[$value[10]]) .sprintf("%02d",$this->arrParam[$value[11]]).sprintf("%02d",$this->arrParam[$value[12]]).sprintf("%02d",$this->arrParam[$value[13]]);          if (($this->arrErr[$value[2]] == "" && $this->arrErr[$value[8]] == "") && $date1 > $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }         if($date1 == $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }      } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function CHECK_SET_TERM2 ($value) {      // 期間指定     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[8]])) {         return;     }     // $this->createParam($value);     $error = 0;     if ( (strlen($this->arrParam[$value[2]]) > 0 || strlen($this->arrParam[$value[3]]) > 0 || strlen($this->arrParam[$value[4]] ) > 0 || strlen($this->arrParam[$value[5]]) > 0) && ! checkdate($this->arrParam[$value[3]], $this->arrParam[$value[4]], $this->arrParam[$value[2]]) ) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[8]]) > 0 || strlen($this->arrParam[$value[9]]) > 0 || strlen($this->arrParam[$value[10]] ) > 0 || strlen($this->arrParam[$value[11]] ) > 0) && ! checkdate($this->arrParam[$value[9]], $this->arrParam[$value[10]], $this->arrParam[$value[8]]) ) {         $this->arrErr[$value[8]] = "※ " . $value[1] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[2]]) > 0 && strlen($this->arrParam[$value[3]]) > 0 && strlen($this->arrParam[$value[4]] ) > 0 && strlen($this->arrParam[$value[5]] ) > 0) &&  (strlen($this->arrParam[$value[8]]) > 0 || strlen($this->arrParam[$value[9]]) > 0 || strlen($this->arrParam[$value[10]] ) > 0 || strlen($this->arrParam[$value[11]] ) > 0) ){          $date1 = $this->arrParam[$value[2]] .sprintf("%02d", $this->arrParam[$value[3]]) .sprintf("%02d",$this->arrParam[$value[4]]) .sprintf("%02d",$this->arrParam[$value[5]]).sprintf("%02d",$this->arrParam[$value[6]]).sprintf("%02d",$this->arrParam[$value[7]]);         $date2 = $this->arrParam[$value[8]] .sprintf("%02d", $this->arrParam[$value[9]]) .sprintf("%02d",$this->arrParam[$value[10]]) .sprintf("%02d",$this->arrParam[$value[11]]).sprintf("%02d",$this->arrParam[$value[12]]).sprintf("%02d",$this->arrParam[$value[13]]);          if (($this->arrErr[$value[2]] == "" && $this->arrErr[$value[8]] == "") && $date1 > $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }         if($date1 == $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }      } } -------------------------------------------------------------------  1025行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function CHECK_SET_TERM3 ($value) {      // 期間指定     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[4]])) {         return;     }     $this->createParam($value);     $error = 0;     if ( (strlen($this->arrParam[$value[2]]) > 0 || strlen($this->arrParam[$value[3]]) > 0) && ! checkdate($this->arrParam[$value[3]], 1, $this->arrParam[$value[2]]) ) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[4]]) > 0 || strlen($this->arrParam[$value[5]]) > 0) && ! checkdate($this->arrParam[$value[5]], 1, $this->arrParam[$value[4]]) ) {         $this->arrErr[$value[4]] = "※ " . $value[1] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[2]]) > 0 && strlen($this->arrParam[$value[3]]) > 0 && (strlen($this->arrParam[$value[4]]) > 0 || strlen($this->arrParam[$value[5]]) > 0 ))) {          $date1 = $this->arrParam[$value[2]] .sprintf("%02d", $this->arrParam[$value[3]]);         $date2 = $this->arrParam[$value[4]] .sprintf("%02d", $this->arrParam[$value[5]]);          if (($this->arrErr[$value[2]] == "" && $this->arrErr[$value[5]] == "") && $date1 > $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function CHECK_SET_TERM3 ($value) {      // 期間指定     if(isset($this->arrErr[$value[2]]) || isset($this->arrErr[$value[4]])) {         return;     }     // $this->createParam($value);     $error = 0;     if ( (strlen($this->arrParam[$value[2]]) > 0 || strlen($this->arrParam[$value[3]]) > 0) && ! checkdate($this->arrParam[$value[3]], 1, $this->arrParam[$value[2]]) ) {         $this->arrErr[$value[2]] = "※ " . $value[0] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[4]]) > 0 || strlen($this->arrParam[$value[5]]) > 0) && ! checkdate($this->arrParam[$value[5]], 1, $this->arrParam[$value[4]]) ) {         $this->arrErr[$value[4]] = "※ " . $value[1] . "を正しく指定してください。<br />";     }     if ( (strlen($this->arrParam[$value[2]]) > 0 && strlen($this->arrParam[$value[3]]) > 0 && (strlen($this->arrParam[$value[4]]) > 0 || strlen($this->arrParam[$value[5]]) > 0 ))) {          $date1 = $this->arrParam[$value[2]] .sprintf("%02d", $this->arrParam[$value[3]]);         $date2 = $this->arrParam[$value[4]] .sprintf("%02d", $this->arrParam[$value[5]]);          if (($this->arrErr[$value[2]] == "" && $this->arrErr[$value[5]] == "") && $date1 > $date2) {             $this->arrErr[$value[2]] = "※ " .$value[0]. "と" .$value[1]. "の期間指定が不正です。<br />";         }     } } -------------------------------------------------------------------  1137行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function EVAL_CHECK($value) {     if (isset($this->arrErr[$value[0]])) {         return;     }     $this->createParam($value);     if ($this->evalCheck($value[1]) === false) {         $this->arrErr[$value[0]] = '※ ' . $value[0] . ' の形式が不正です。<br />';     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function EVAL_CHECK($value) {     if (isset($this->arrErr[$value[0]])) {         return;     }     // $this->createParam($value);     if ($this->evalCheck($value[1]) === false) {         $this->arrErr[$value[0]] = '※ ' . $value[0] . ' の形式が不正です。<br />';     } } -------------------------------------------------------------------  1165行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function createParam($value) {     foreach ($value as $key) {         if (is_string($key) || is_int($key)) {             if (!isset($this->arrParam[$key]))  $this->arrParam[$key] = '';         }     } } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function createParam($value) {      foreach ($value as $val_key => $key) {          if ($val_key != 0 && (is_string($key) || is_int($key))) {              if (!is_numeric($key) && preg_match('/^[a-z0-9_]+$/i', $key)) {                  if (!isset($this->arrParam[$key])) $this->arrParam[$key] = '';                  if (strlen($this->arrParam[$key]) > 0                        && (preg_match('/^[[:alnum:]\-\_]*[\.\/\\\\]*\.\.(\/|\\\\)/', $this->arrParam[$key]))                        ) {                      $this->arrErr[$value[1]] = '※ ' . $value[0] . 'に禁止された記号の並びまたは制御文字が入っています。<br />';                  }              } else if (preg_match('/[^a-z0-9_]/i', $key)) {                  trigger_error('', E_USER_ERROR);              }          }      } } =================================================================================================================  ``` | |  | | ```  ================================================================================================================= ▼EC-CUBE におけるクロスサイト・スクリプティング ----------------------------------------------------------------------------------------------------------------- 【危険度】 中  【修正方法について】 /data/class/pages/products/LC_Page_Products_List.php::lfSetSelectedData に以下の変更を加えます。  【修正後の確認方法について】 商品一覧で規格を選択できる事をご確認ください。  ▽LC_Page_Products_List.php 420行目付近 -----------------------------------------------------------------------------------------------------------------  変更前 ----------------------------------------------------------------------------------------------------------------- $arrProducts[$key]['quantity']          = $arrForm['quantity']; $arrProducts[$key]['arrErr']            = $arrErr; $js_fnOnLoad .= "fnSetClassCategories(document.product_form{$arrProducts[$key]['product_id']}, '{$arrForm['classcategory_id2']}');"; -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- $arrProducts[$key]['quantity']          = $arrForm['quantity']; $arrProducts[$key]['arrErr']            = $arrErr; $classcategory_id2 = SC_Utils_Ex::jsonEncode($arrForm['classcategory_id2']); $js_fnOnLoad .= "fnSetClassCategories(document.product_form{$arrProducts[$key]['product_id']}, {$classcategory_id2});"; =================================================================================================================  ``` | |  | | ```  ================================================================================================================= ▼EC-CUBE における管理画面でのクロスサイト・スクリプティング ----------------------------------------------------------------------------------------------------------------- 【危険度】 中  【修正方法について】 /data/Smarty/templates/admin/contents/recommend_search.tpl /data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php::action に以下の変更を加えます。  【修正後の確認方法について】 商品選択が正常に動作する事を確認ください。  ================================================================================================================= ▽2.11.0以上のバージョンは以下を参考下さい -----------------------------------------------------------------------------------------------------------------  ▽recommend_search.tpl 31行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function func_submit( id ){     var fm = window.opener.document.form<!--{$smarty.get.rank}-->;     fm.product_id.value = id;     fm.mode.value = 'set_item';     fm.rank.value = '<!--{$smarty.get.rank}-->';     fm.submit();     window.close();     return false; } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function func_submit( id ){     var fm = window.opener.document.form<!--{$rank|h}-->;     fm.product_id.value = id;     fm.mode.value = 'set_item';     fm.rank.value = '<!--{$rank|h}-->';     fm.submit();     window.close();     return false; } -------------------------------------------------------------------  ▽LC_Page_Admin_Contents_RecommendSearch.php 67行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- $objDb = new SC_Helper_DB_Ex(); $objFormParam = new SC_FormParam_Ex(); $this->lfInitParam($objFormParam); $objFormParam->setParam($_POST); $objFormParam->convParam(); -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- $objDb = new SC_Helper_DB_Ex(); $objFormParam = new SC_FormParam_Ex(); $this->lfInitParam($objFormParam); $objFormParam->setParam($_POST); $objFormParam->convParam();  $rank = intval($_GET['rank']); -------------------------------------------------------------------  105行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- // カテゴリ取得 $this->arrCatList = $objDb->sfGetCategoryList(); $this->setTemplate('contents/recommend_search.tpl'); -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- // カテゴリ取得 $this->arrCatList = $objDb->sfGetCategoryList(); $this->rank       = $rank; $this->setTemplate('contents/recommend_search.tpl'); -----------------------------------------------------------------------------------------------------------------  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ================================================================================================================= ▽2.4.4以下のバージョンは以下を参考下さい -----------------------------------------------------------------------------------------------------------------  ▽recommend_search.tpl 41行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- function func_submit( id ){     var fm = window.opener.document.form<!--{$smarty.get.rank}-->;     fm.product_id.value = id;     fm.mode.value = 'set_item';     fm.rank.value = '<!--{$smarty.get.rank}-->';     fm.submit();     window.close();     return false; } -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- function func_submit( id ){     var fm = window.opener.document.form<!--{$rank|escape}-->;     fm.product_id.value = id;     fm.mode.value = 'set_item';     fm.rank.value = '<!--{$rank|escape}-->';     fm.submit();     window.close();     return false; } -------------------------------------------------------------------  ▽LC_Page_Admin_Contents_RecommendSearch.php 67行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- // 認証可否の判定 SC_Utils_Ex::sfIsSuccess($objSess);  if (!isset($_POST['mode'])) $_POST['mode'] = ""; if ($_POST['mode'] == "search") { -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- // 認証可否の判定 SC_Utils_Ex::sfIsSuccess($objSess);  // 数値を代入 $this->rank = intval($_GET['rank']);  if (!isset($_POST['mode'])) $_POST['mode'] = ""; if ($_POST['mode'] == "search") { =================================================================================================================  ``` | |  | | ```  ================================================================================================================= ▼resize_image.phpによるディレクトリトラバーサル ----------------------------------------------------------------------------------------------------------------- 【危険度】 低  【修正方法について】 /data/class/pages/LC_Page_ResizeImage.php::lfCheckFileName に以下の変更を加えます。  【修正後の確認方法について】 画像が正しく表示される事をご確認ください。  ▽LC_Page_ResizeImage.php 108行目付近 -------------------------------------------------------------------  変更前 ------------------------------------------------------------------- $file    = trim($_GET['image']); if (preg_match_all($pattern, $file, $matches)) {    return false; -------------------------------------------------------------------  -------------------------------------------------------------------  変更後 ------------------------------------------------------------------- $file    = trim($_GET['image']); if (!preg_match("/^[[:alnum:]_\.-]+$/i", $file)) {     return false; =================================================================================================================  ``` | | | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |  |  | | --- |  |  | | --- | | FAQ | | **Q. 私のサイトは大丈夫か？** A. まずは対象バージョンをお確かめ下さい。 脆弱性対象バージョンのEC-CUBEをお使いの場合、対象ファイルを確認下さい。 修正がされていない場合、修正方法に沿って修正の対応をお願い致します。 [オフィシャルホスティングパートナー](http://www.ec-cube.net/partner/search.php)をご利用の場合・[インテグレートパートナー](http://www.ec-cube.net/integrate/partner/place.php)が構築した場合、既に対策されている場合がございます。  この度は、お手数をおかけいたしますことを深くお詫び申し上げます。 |  |  | | --- | | 謝辞 | | 本情報は、インテグレートパートナーの株式会社システムフレンド様 並びに、EC-CUBEオフィシャルサイトへお問い合わせ頂きました開発者さまよりご提供頂きました。この場をお借りして、厚く御礼申し上げます。 |  |  | | --- | | 問い合わせ先 | | EC-CUBE 運営チーム 金(キム)、吉本 | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |



=== Content from www.ec-cube.net_9ab0e83c_20250124_212457.html ===


JavaScript を有効にしてご利用下さい.

# [EC-CUBE®](/)

* [選ばれる理由](/reason/)
* [機能](/functions/)
* [決済](/alliance/)
* [導入事例](/cases/)
* [セキュリティ](/security/)
* [ストア](https://www.ec-cube.net/owners/)

[まずは相談する](/advisor/)

[ご利用中の方のお問い合わせはこちら](/support/)

* [資料請求](/document/)
* [ダウンロード](/download/)

# 脆弱性

## クロスサイトスクリプティングの脆弱性

* 情報公開日：2013年 06月 26日
* 危険度：中
* 対象：Ver 2.12.4 以前

```
-------------------------------------------------------------------
■脆弱性の種類
-------------------------------------------------------------------
管理画面ページでのXSS

-------------------------------------------------------------------
■不具合が存在するEC-CUBEのバージョン
-------------------------------------------------------------------
全てのバージョン(2.4系以下/2.11系/2.12系)

-------------------------------------------------------------------
■修正方法について(以下は Ver2.12.4 の修正となっております。)
-------------------------------------------------------------------
/data/Smarty/templates/admin/contents/recommend_search.tpl
/data/class/pages/admin/contents/LC_Page_Admin_Contents_RecommendSearch.php::action
に以下の変更を加えます。

※修正ファイルの詳細はこちらをご確認ください
http://www.ec-cube.net/info/weakness/20130626/index.php

▽recommend_search.tpl
31行目付近
-------------------------------------------------------------------
 変更前
-------------------------------------------------------------------
function func_submit( id ){
    var fm = window.opener.document.form<!--{$smarty.get.rank}-->;
    fm.product_id.value = id;
    fm.mode.value = 'set_item';
    fm.rank.value = '<!--{$smarty.get.rank}-->';
    fm.submit();
    window.close();
    return false;
}
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
function func_submit( id ){
    var fm = window.opener.document.form<!--{$rank|h}-->;
    fm.product_id.value = id;
    fm.mode.value = 'set_item';
    fm.rank.value = '<!--{$rank|h}-->';
    fm.submit();
    window.close();
    return false;
}
-------------------------------------------------------------------

▽LC_Page_Admin_Contents_RecommendSearch.php
67行目付近
-------------------------------------------------------------------
 変更前
-------------------------------------------------------------------
$objDb = new SC_Helper_DB_Ex();
$objFormParam = new SC_FormParam_Ex();
$this->lfInitParam($objFormParam);
$objFormParam->setParam($_POST);
$objFormParam->convParam();
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
$objDb = new SC_Helper_DB_Ex();
$objFormParam = new SC_FormParam_Ex();
$this->lfInitParam($objFormParam);
$objFormParam->setParam($_POST);
$objFormParam->convParam();

$rank = intval($_GET['rank']);
-------------------------------------------------------------------

105行目付近
-------------------------------------------------------------------
 変更前
-------------------------------------------------------------------
// カテゴリ取得
$this->arrCatList = $objDb->sfGetCategoryList();
$this->setTemplate('contents/recommend_search.tpl');
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
// カテゴリ取得
$this->arrCatList = $objDb->sfGetCategoryList();
$this->rank       = $rank;
$this->setTemplate('contents/recommend_search.tpl');
-------------------------------------------------------------------

下記のリビジョンで修正
http://svn.ec-cube.net/open_trac/changeset/22861
```

1. [ホーム](/)
3. 脆弱性

 [PageTop](#wrap)

## EC-CUBE公式アドバイザーご相談窓口

* 他社のASPやパッケージとの違いを知りたい
* BtoCのサイトにBtoB機能を追加したい
* 何から手をつければよいかわからない
* オープンソースならではの注意事項を知りたい
* 自社にマッチした制作会社を探したい
* サイト制作だけでなく運営もサポートしてほしい

新規構築・リニューアル・取引先向けのWeb受発注システム（BtoB）や事業の拡大など、
今抱えている課題を解決する最適な業者探しを、アドバイザーがお手伝いします。

* [まずは相談する](/advisor/)
* [資料請求する](/document/)
* [ご利用中の方のお問い合わせはこちら](/support/)

* ## EC-CUBE導入をお考えの方

  + [選ばれる理由](/reason/)
  + [導入事例](/cases/)
  + [デモサイト](/demo/)
  + [機能一覧](/functions/)
  + [マニュアル](https://www.ec-cube.net/manual/ec-cube4/)
  + [ライセンス](/license/)
  + [メールマガジン登録](https://www.ec-cube.net/mail/)
  + [EC開業・運営ノウハウ](/know-how/)
* ## EC-CUBEをインストールしたい

  + [最新版ダウンロード](/download/)
  + [機能一覧](/functions/)
  + [開発情報](/developers/)
  + [レンタルサーバ](/server/)
* ## EC-CUBEをご利用中の方

  + [EC-CUBEメンバー登録](https://www.ec-cube.net/entry/)
  + [メンバーページログイン](https://www.ec-cube.net/mypage/login.php)
  + [オーナーズストア](https://www.ec-cube.net/owners/)
  + [セキュリティ対策](/security/)
  + [開発コミュニティ](https://xoops.ec-cube.net/)
* ## お問い合わせ

  + [サポート](/support/)
  + [よくあるご質問](https://support.ec-cube.net/hc/ja)
  + [お問い合わせ](https://www.ec-cube.net/contact/)
  + [ec-cube.coに関するお問い合わせ](https://www.ec-cube.net/product/co/support.php)
* ## ニュース・イベント

  + [ニュースリリース](https://www.ec-cube.net/newsrelease/)
  + [イベント](https://www.ec-cube.net/event/)
  + [X（旧Twitter）](https://x.com/EC_CUBE)
  + [Facebook](https://www.facebook.com/eccube/)
* ## パートナーについて

  + [パートナー登録（無料）](https://www.ec-cube.net/entry/partner.php)
  + [パートナーページログイン](https://www.ec-cube.net/partnerpage/login.php)
  + [パートナー制度のご案内](https://www.ec-cube.net/partnerpage/top.php)
  + [インテグレートパートナー 一覧](https://www.ec-cube.net/integrate/partner/)
  + [エバンジェリスト紹介](/evangelist/)
  + [EC-CUBEのロゴ](/brand-assets/)
* ## 決済サービス

  + [決済サービス一覧](/alliance/)
  + [EC-CUBEペイメントPlus](/lp/payment/)
  + [EC-CUBEペイメントPlus・BtoB向けプラン](/lp/epsilon-btob/)
  + [Amazon Pay](https://www.ec-cube.net/products/detail.php?product_id=2490)
* ## その他サービス

  + [基幹システム](/lp/core-system/)
  + [物流サービス一覧](/logistics/)
  + [サイトマップ](/sitemap/)

## [EC-CUBE®](/)

* [X](https://x.com/EC_CUBE)
* [Facebook](https://www.facebook.com/eccube/)
* [Wantedly](https://www.wantedly.com/companies/ec-cube)

* [個人情報の取扱いについて](/policy/)
* [個人情報保護方針](/policy/privacy/)
* [Cookieによる情報収集について](/policy/cookie/)
* [外的環境の把握](/policy/foreign-corporation/)
* [情報セキュリティ方針](/policy/security-policy/)

* [サイトマップ](/sitemap/)
* [運営会社](https://www.ec-cube.co.jp/)

© EC-CUBE CO.,LTD.

![](https://www.facebook.com/tr?id=736682659717992&ev=NoScript)


