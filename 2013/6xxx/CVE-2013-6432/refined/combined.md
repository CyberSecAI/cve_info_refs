=== Content from lists.opensuse.org_59d93f50_20250124_162443.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK/#S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK)

# [security-announce] openSUSE-SU-2014:0205-1: important: kernel to 3.11.10

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

6 Feb
2014

6 Feb
'14

18:21

openSUSE Security Update: kernel to 3.11.10
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2014:0205-1
Rating: important
References: #733022 #773058 #838024 #844513 #845621 #846529
#848042 #849021 #850072 #852652 #852656 #852931
#853050 #853051 #853052 #853053 #854175 #854722
#856294 #859804 #860993
Cross-References: CVE-2013-4511 CVE-2013-4563 CVE-2013-4587
CVE-2013-6367 CVE-2013-6368 CVE-2013-6376
CVE-2013-6432 CVE-2014-0038
Affected Products:
openSUSE 13.1
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that solves 8 vulnerabilities and has 13 fixes is
now available.
Description:
The Linux Kernel was updated to version 3.11.10, fixing
security issues and bugs:
- floppy: bail out in open() if drive is not responding to
block0 read (bnc#773058).
- compat\_sys\_recvmmsg X32 fix (bnc#860993 CVE-2014-0038).
- HID: usbhid: fix sis quirk (bnc#859804).
- hwmon: (coretemp) Fix truncated name of alarm attributes
- HID: usbhid: quirk for Synaptics Quad HD touchscreen
(bnc#859804).
- HID: usbhid: quirk for Synaptics HD touchscreen
(bnc#859804).
- HID: usbhid: merge the sis quirk (bnc#859804).
- HID: hid-multitouch: add support for SiS panels
(bnc#859804).
- HID: usbhid: quirk for SiS Touchscreen (bnc#859804).
- HID: usbhid: quirk for Synaptics Large Touchccreen
(bnc#859804).
- drivers: net: cpsw: fix dt probe for one port ethernet.
- drivers: net: cpsw: fix for cpsw crash when build as
modules.
- dma: edma: Remove limits on number of slots.
- dma: edma: Leave linked to Null slot instead of DUMMY
slot.
- dma: edma: Find missed events and issue them.
- dma: edma: Write out and handle MAX\_NR\_SG at a given time.
- dma: edma: Setup parameters to DMA MAX\_NR\_SG at a time.
- ARM: edma: Add function to manually trigger an EDMA
channel.
- ARM: edma: Fix clearing of unused list for DT DMA
resources.
- ACPI: Add Toshiba NB100 to Vista \_OSI blacklist.
- ACPI: add missing win8 OSI comment to blacklist
(bnc#856294).
- ACPI: update win8 OSI blacklist.
- ACPI: blacklist win8 OSI for buggy laptops.
- ACPI: blacklist win8 OSI for ASUS Zenbook Prime UX31A
(bnc#856294).
- ACPI: Blacklist Win8 OSI for some HP laptop 2013 models
(bnc#856294).
- floppy: bail out in open() if drive is not responding to
block0 read (bnc#773058).
- ping: prevent NULL pointer dereference on write to
msg\_name (bnc#854175 CVE-2013-6432).
- x86/dumpstack: Fix printk\_address for direct addresses
(bnc#845621).
- Refresh patches.suse/stack-unwind.
- Refresh patches.xen/xen-x86\_64-dump-user-pgt.
- KVM: x86: Convert vapic synchronization to \_cached
functions (CVE-2013-6368) (bnc#853052 CVE-2013-6368).
- KVM: x86: fix guest-initiated crash with x2apic
(CVE-2013-6376) (bnc#853053 CVE-2013-6376).
- Build the KOTD against openSUSE:13.1:Update
- xencons: generalize use of add\_preferred\_console()
(bnc#733022, bnc#852652).
- Update Xen patches to 3.11.10.
- Rename patches.xen/xen-pcpu-hotplug to
patches.xen/xen-pcpu.
- KVM: x86: Fix potential divide by 0 in lapic
(CVE-2013-6367) (bnc#853051 CVE-2013-6367).
- KVM: Improve create VCPU parameter (CVE-2013-4587)
(bnc#853050 CVE-2013-4587).
- ipv6: fix headroom calculation in udp6\_ufo\_fragment
(bnc#848042 CVE-2013-4563).
- net: rework recvmsg handler msg\_name and msg\_namelen
logic (bnc#854722).
- patches.drivers/gpio-ucb1400-add-module\_alias.patch:
Update upstream reference
-
patches.drivers/gpio-ucb1400-can-be-built-as-a-module.patch:
Update upstream reference
- Delete patches.suse/ida-remove-warning-dump-stack.patch.
Already included in kernel 3.11 (WARN calls dump\_stack.)
- xhci: Limit the spurious wakeup fix only to HP machines
(bnc#852931).
- iscsi\_target: race condition on shutdown (bnc#850072).
- Linux 3.11.10.
- Refresh patches.xen/xen3-patch-2.6.29.
- Delete
patches.suse/btrfs-relocate-csums-properly-with-prealloc-ext
ents.patch.
-
patches.drivers/xhci-Fix-spurious-wakeups-after-S5-on-Haswel
l.patch: (bnc#852931).
- Build mei and mei\_me as modules (bnc#852656)
- Linux 3.11.9.
- Linux 3.11.8 (CVE-2013-4511 bnc#846529 bnc#849021).
- Delete
patches.drivers/ALSA-hda-Add-a-fixup-for-ASUS-N76VZ.
- Delete
patches.fixes/Fix-a-few-incorrectly-checked-io\_-remap\_pfn\_ra
nge-ca.patch.
- Add USB PHY support (needed to get USB and Ethernet
working on beagle and panda boards) Add
CONFIG\_PINCTRL\_SINGLE=y to be able to use Device tree (at
least for beagle and panda boards) Add ARM SoC sound
support Add SPI bus support Add user-space access to I2C
and SPI
-
patches.arch/iommu-vt-d-remove-stack-trace-from-broken-irq-r
emapping-warning.patch: Fix forward porting, sorry.
- iommu: Remove stack trace from broken irq remapping
warning (bnc#844513).
- gpio: ucb1400: Add MODULE\_ALIAS.
- Allow NFSv4 username mapping to work properly
(bnc#838024).
- nfs: check if gssd is running before attempting to use
krb5i auth in SETCLIENTID call.
- sunrpc: replace sunrpc\_net->gssd\_running flag with a more
reliable check.
- sunrpc: create a new dummy pipe for gssd to hold open.
- Set CONFIG\_GPIO\_TWL4030 as built-in (instead of module)
as a requirement to boot on SD card on beagleboard xM
- armv6hl, armv7hl: Update config files. Set
CONFIG\_BATMAN\_ADV\_BLA=y as all other kernel configuration
files have.
- Update config files:
\* CONFIG\_BATMAN\_ADV\_NC=y, because other BATMAN\_ADV
options are all enabled so why not this one.
\* CONFIG\_GPIO\_SCH=m, CONFIG\_GPIO\_PCH=m, because we
support all other features of these pieces of hardware.
\* CONFIG\_INTEL\_POWERCLAMP=m, because this small driver
might be useful in specific cases, and there's no
obvious reason not to include it.
- Fix a few incorrectly checked [io\_]remap\_pfn\_range()
calls (bnc#849021, CVE-2013-4511).
- Linux 3.11.7.
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 13.1:
zypper in -t patch openSUSE-2014-114
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 13.1 (i586 x86\_64):
kernel-default-3.11.10-7.1
kernel-default-base-3.11.10-7.1
kernel-default-base-debuginfo-3.11.10-7.1
kernel-default-debuginfo-3.11.10-7.1
kernel-default-debugsource-3.11.10-7.1
kernel-default-devel-3.11.10-7.1
kernel-default-devel-debuginfo-3.11.10-7.1
kernel-syms-3.11.10-7.1
- openSUSE 13.1 (i686 x86\_64):
kernel-debug-3.11.10-7.1
kernel-debug-base-3.11.10-7.1
kernel-debug-base-debuginfo-3.11.10-7.1
kernel-debug-debuginfo-3.11.10-7.1
kernel-debug-debugsource-3.11.10-7.1
kernel-debug-devel-3.11.10-7.1
kernel-debug-devel-debuginfo-3.11.10-7.1
kernel-desktop-3.11.10-7.1
kernel-desktop-base-3.11.10-7.1
kernel-desktop-base-debuginfo-3.11.10-7.1
kernel-desktop-debuginfo-3.11.10-7.1
kernel-desktop-debugsource-3.11.10-7.1
kernel-desktop-devel-3.11.10-7.1
kernel-desktop-devel-debuginfo-3.11.10-7.1
kernel-ec2-3.11.10-7.1
kernel-ec2-base-3.11.10-7.1
kernel-ec2-base-debuginfo-3.11.10-7.1
kernel-ec2-debuginfo-3.11.10-7.1
kernel-ec2-debugsource-3.11.10-7.1
kernel-ec2-devel-3.11.10-7.1
kernel-ec2-devel-debuginfo-3.11.10-7.1
kernel-trace-3.11.10-7.1
kernel-trace-base-3.11.10-7.1
kernel-trace-base-debuginfo-3.11.10-7.1
kernel-trace-debuginfo-3.11.10-7.1
kernel-trace-debugsource-3.11.10-7.1
kernel-trace-devel-3.11.10-7.1
kernel-trace-devel-debuginfo-3.11.10-7.1
kernel-vanilla-3.11.10-7.1
kernel-vanilla-debuginfo-3.11.10-7.1
kernel-vanilla-debugsource-3.11.10-7.1
kernel-vanilla-devel-3.11.10-7.1
kernel-vanilla-devel-debuginfo-3.11.10-7.1
kernel-xen-3.11.10-7.1
kernel-xen-base-3.11.10-7.1
kernel-xen-base-debuginfo-3.11.10-7.1
kernel-xen-debuginfo-3.11.10-7.1
kernel-xen-debugsource-3.11.10-7.1
kernel-xen-devel-3.11.10-7.1
kernel-xen-devel-debuginfo-3.11.10-7.1
- openSUSE 13.1 (noarch):
kernel-devel-3.11.10-7.1
kernel-docs-3.11.10-7.3
kernel-source-3.11.10-7.1
kernel-source-vanilla-3.11.10-7.1
- openSUSE 13.1 (i686):
kernel-pae-3.11.10-7.1
kernel-pae-base-3.11.10-7.1
kernel-pae-base-debuginfo-3.11.10-7.1
kernel-pae-debuginfo-3.11.10-7.1
kernel-pae-debugsource-3.11.10-7.1
kernel-pae-devel-3.11.10-7.1
kernel-pae-devel-debuginfo-3.11.10-7.1
References:
<http://support.novell.com/security/cve/CVE-2013-4511.html>
<http://support.novell.com/security/cve/CVE-2013-4563.html>
<http://support.novell.com/security/cve/CVE-2013-4587.html>
<http://support.novell.com/security/cve/CVE-2013-6367.html>
<http://support.novell.com/security/cve/CVE-2013-6368.html>
<http://support.novell.com/security/cve/CVE-2013-6376.html>
<http://support.novell.com/security/cve/CVE-2013-6432.html>
<http://support.novell.com/security/cve/CVE-2014-0038.html>
<https://bugzilla.novell.com/733022>
<https://bugzilla.novell.com/773058>
<https://bugzilla.novell.com/838024>
<https://bugzilla.novell.com/844513>
<https://bugzilla.novell.com/845621>
<https://bugzilla.novell.com/846529>
<https://bugzilla.novell.com/848042>
<https://bugzilla.novell.com/849021>
<https://bugzilla.novell.com/850072>
<https://bugzilla.novell.com/852652>
<https://bugzilla.novell.com/852656>
<https://bugzilla.novell.com/852931>
<https://bugzilla.novell.com/853050>
<https://bugzilla.novell.com/853051>
<https://bugzilla.novell.com/853052>
<https://bugzilla.novell.com/853053>
<https://bugzilla.novell.com/854175>
<https://bugzilla.novell.com/854722>
<https://bugzilla.novell.com/856294>
<https://bugzilla.novell.com/859804>
<https://bugzilla.novell.com/860993>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK/#S3Z5ZMLJMQRQPFMAXESRJNBNJMBGCZSK)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.redhat.com_08acef4e_20250124_162449.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1039046)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1039046)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1039046)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1039046

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1039046**](show_bug.cgi?id=1039046)
(CVE-2013-6432)
- [CVE-2013-6432](https://access.redhat.com/security/cve/CVE-2013-6432) Kernel: ping: NULL pointer dereference on write to msg\_name

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2013-6432 Kernel: ping: NULL pointer dereference on write to msg\_name

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2013-6432 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1036074](show_bug.cgi?id=1036074) | | TreeView+ | [depends on](buglist.cgi?bug_id=1039046&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1039046&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2013-12-06 13:07 UTC by Prasad Pandit | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-05-12 15:38 UTC ([History](show_activity.cgi?id=1039046)) | | [CC List:](page.cgi?id=fields.html#cclist) | 28 users (show)  agordeev anton aquini bhu davej dhoward esammons fhrbata gansalmon iboverma itamar jforbes jkacur jkurik jonathan jross jwboyer kernel-maint kernel-mgr lgoncalv lwang madhu.chinakonda mcressma pholasek plougher rt-maint rvrbovsk williams | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2014-06-10 11:55:35 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1039046#c0)  Prasad Pandit    2013-12-06 13:07:45 UTC  ``` Linux kernel built with the TCP/IP networking support(CONFIG_NET) is vulnerable to a NULL pointer dereference flaw. It could occur via a plain read(2) call on a ping socket. Usage of ping sockets is generally restricted to privileged users.  A user/program able to read from ping sockets could use this flaw to crash a system resulting in DoS.  Upstream fix: -------------  -> <https://git.kernel.org/linus/cf970c002d270c36202bd5b9c2804d3097a52da0>   ```  [Comment 1](show_bug.cgi?id=1039046#c1)  Prasad Pandit    2013-12-06 14:08:09 UTC  ``` Statement:  This issue does not affect the versions of the kernel package as shipped with Red Hat Enterprise Linux 5, 6 and Red Hat Enterprise MRG 2.   ```  [Comment 2](show_bug.cgi?id=1039046#c2)  Prasad Pandit    2013-12-06 14:14:51 UTC  ``` Acknowledgement:  Red Hat would like to thank Mr Hannes Frederic Sowa for reporting this issue.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1039046&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from bugzilla.novell.com_a0a2a0df_20250126_021134.html ===




=== Content from www.kernel.org_5e8086b3_20250124_162445.html ===
commit 289b6c71f0476983dfccf772fb03878eaa5bde27
Author: Greg Kroah-Hartman
Date: Sun Dec 8 08:18:58 2013 -0800
Linux 3.12.4
commit 30b722d9d7242767e009234abee86d5cc7eb03d7
Author: Pierre Ossman
Date: Wed Nov 6 20:00:32 2013 +0100
drm/radeon/audio: correct ACR table
commit 3e71985f2439d8c4090dc2820e497e6f3d72dcff upstream.
The values were taken from the HDMI spec, but they assumed
exact x/1.001 clocks. Since we round the clocks, we also need
to calculate different N and CTS values.
Note that the N for 25.2/1.001 MHz at 44.1 kHz audio is out of
spec. Hopefully this mode is rarely used and/or HDMI sinks
tolerate overly large values of N.
bug:
https://bugs.freedesktop.org/show\_bug.cgi?id=69675
Signed-off-by: Pierre Ossman
Signed-off-by: Alex Deucher
Cc: Josh Boyer
Signed-off-by: Greg Kroah-Hartman
commit e610724c69a3445f399d20a12f6cd218ad153ed0
Author: Pierre Ossman
Date: Wed Nov 6 20:09:08 2013 +0100
drm/radeon/audio: improve ACR calculation
commit a2098250fbda149cfad9e626afe80abe3b21e574 upstream.
In order to have any realistic chance of calculating proper
ACR values, we need to be able to calculate both N and CTS,
not just CTS. We still aim for the ideal N as specified in
the HDMI spec though.
bug:
https://bugs.freedesktop.org/show\_bug.cgi?id=69675
Signed-off-by: Pierre Ossman
Signed-off-by: Alex Deucher
Cc: Josh Boyer
Signed-off-by: Greg Kroah-Hartman
commit f47be34aa63fbea1a3857f9e8be5619bded8e5cf
Author: Gu Zheng
Date: Wed Dec 4 18:19:06 2013 +0800
aio: clean up aio ring in the fail path
commit d1b9432712a25eeb06114fb4b587133525a47de5 upstream.
Clean up the aio ring file in the fail path of aio\_setup\_ring
and ioctx\_alloc. And maybe it can fix the GPF issue reported by
Dave Jones:
https://lkml.org/lkml/2013/11/25/898
Signed-off-by: Gu Zheng
Signed-off-by: Benjamin LaHaise
Signed-off-by: Greg Kroah-Hartman
commit efbac2ca2f13d43a9aab37b84a3cca4d73b09c7c
Author: Sasha Levin
Date: Tue Nov 19 17:33:03 2013 -0500
aio: nullify aio->ring\_pages after freeing it
commit ddb8c45ba15149ebd41d7586261c05f7ca37f9a1 upstream.
After freeing ring\_pages we leave it as is causing a dangling pointer. This
has already caused an issue so to help catching any issues in the future
NULL it out.
Signed-off-by: Sasha Levin
Signed-off-by: Benjamin LaHaise
Signed-off-by: Greg Kroah-Hartman
commit f50db974cb75e31d98b176c3c9ea92e57aa97a1b
Author: Sasha Levin
Date: Tue Nov 19 17:33:02 2013 -0500
aio: prevent double free in ioctx\_alloc
commit d558023207e008a4476a3b7bb8706b2a2bf5d84f upstream.
ioctx\_alloc() calls aio\_setup\_ring() to allocate a ring. If aio\_setup\_ring()
fails to do so it would call aio\_free\_ring() before returning, but
ioctx\_alloc() would call aio\_free\_ring() again causing a double free of
the ring.
This is easily reproducible from userspace.
Signed-off-by: Sasha Levin
Signed-off-by: Benjamin LaHaise
Signed-off-by: Greg Kroah-Hartman
commit 603f89ac73b7f286d3fdbc26db0ada25b06bd333
Author: Dan Carpenter
Date: Wed Nov 13 10:49:40 2013 +0300
aio: checking for NULL instead of IS\_ERR
commit 7f62656be8a8ef14c168db2d98021fb9c8cc1076 upstream.
alloc\_anon\_inode() returns an ERR\_PTR(), it doesn't return NULL.
Fixes: 71ad7490c1f3 ('rework aio migrate pages to use aio fs')
Signed-off-by: Dan Carpenter
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 79b5389c84a342525b7cd1624251444a10518b95
Author: Benjamin LaHaise
Date: Tue Sep 17 10:18:25 2013 -0400
rework aio migrate pages to use aio fs
commit 71ad7490c1f32bd7829df76360f9fa17829868f3 upstream.
Don't abuse anon\_inodes.c to host private files needed by aio;
we can bloody well declare a mini-fs of our own instead of
patching up what anon\_inodes can create for us.
Tested-by: Benjamin LaHaise
Acked-by: Benjamin LaHaise
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 4875cd486d22cb6be9c1f77fd951310f0aaeb433
Author: Al Viro
Date: Wed Oct 2 22:35:11 2013 -0400
take anon inode allocation to libfs.c
commit 6987843ff7e836ea65b554905aec34d2fad05c94 upstream.
Signed-off-by: Al Viro
Cc: Benjamin LaHaise
Signed-off-by: Greg Kroah-Hartman
commit 9a3809da8d4e37a8039fe308de63396eb18b3e89
Author: Kent Overstreet
Date: Thu Oct 10 19:31:47 2013 -0700
aio: Fix a trinity splat
commit e34ecee2ae791df674dfb466ce40692ca6218e43 upstream.
aio kiocb refcounting was broken - it was relying on keeping track of
the number of available ring buffer entries, which it needs to do
anyways; then at shutdown time it'd wait for completions to be delivered
until the # of available ring buffer entries equalled what it was
initialized to.
Problem with that is that the ring buffer is mapped writable into
userspace, so userspace could futz with the head and tail pointers to
cause the kernel to see extra completions, and cause free\_ioctx() to
return while there were still outstanding kiocbs. Which would be bad.
Fix is just to directly refcount the kiocbs - which is more
straightforward, and with the new percpu refcounting code doesn't cost
us any cacheline bouncing which was the whole point of the original
scheme.
Also clean up ioctx\_alloc()'s error path and fix a bug where it wasn't
subtracting from aio\_nr if ioctx\_add\_table() failed.
Signed-off-by: Kent Overstreet
Cc: Benjamin LaHaise
Signed-off-by: Greg Kroah-Hartman
commit 27135f5f3ba151eefff1305488dc98cbbc216710
Author: Miroslav Lichvar
Date: Thu Aug 1 19:31:35 2013 +0200
ntp: Make periodic RTC update more reliable
commit a97ad0c4b447a132a322cedc3a5f7fa4cab4b304 upstream.
The current code requires that the scheduled update of the RTC happens
in the closest tick to the half of the second. This seems to be
difficult to achieve reliably. The scheduled work may be missing the
target time by a tick or two and be constantly rescheduled every second.
Relax the limit to 10 ticks. As a typical RTC drifts in the 11-minute
update interval by several milliseconds, this shouldn't affect the
overall accuracy of the RTC much.
Signed-off-by: Miroslav Lichvar
Signed-off-by: John Stultz
Cc: Josh Boyer
Signed-off-by: Greg Kroah-Hartman
commit fc655139edb1557a66fefe945ceb61715b18f929
Author: Tomoki Sekiyama
Date: Tue Oct 15 16:42:19 2013 -0600
elevator: acquire q->sysfs\_lock in elevator\_change()
commit 7c8a3679e3d8e9d92d58f282161760a0e247df97 upstream.
Add locking of q->sysfs\_lock into elevator\_change() (an exported function)
to ensure it is held to protect q->elevator from elevator\_init(), even if
elevator\_change() is called from non-sysfs paths.
sysfs path (elv\_iosched\_store) uses \_\_elevator\_change(), non-locking
version, as the lock is already taken by elv\_iosched\_store().
Signed-off-by: Tomoki Sekiyama
Signed-off-by: Jens Axboe
Cc: Josh Boyer
Signed-off-by: Greg Kroah-Hartman
commit d6a5267e403642c8802e5bc59cf754ba44a8993b
Author: Tomoki Sekiyama
Date: Tue Oct 15 16:42:16 2013 -0600
elevator: Fix a race in elevator switching and md device initialization
commit eb1c160b22655fd4ec44be732d6594fd1b1e44f4 upstream.
The soft lockup below happens at the boot time of the system using dm
multipath and the udev rules to switch scheduler.
[ 356.127001] BUG: soft lockup - CPU#3 stuck for 22s! [sh:483]
[ 356.127001] RIP: 0010:[] [] lock\_timer\_base.isra.35+0x1d/0x50
...
[ 356.127001] Call Trace:
[ 356.127001] [] try\_to\_del\_timer\_sync+0x20/0x70
[ 356.127001] [] ? kmem\_cache\_alloc\_node\_trace+0x20a/0x230
[ 356.127001] [] del\_timer\_sync+0x52/0x60
[ 356.127001] [] cfq\_exit\_queue+0x32/0xf0
[ 356.127001] [] elevator\_exit+0x2f/0x50
[ 356.127001] [] elevator\_change+0xf1/0x1c0
[ 356.127001] [] elv\_iosched\_store+0x20/0x50
[ 356.127001] [] queue\_attr\_store+0x59/0xb0
[ 356.127001] [] sysfs\_write\_file+0xc6/0x140
[ 356.127001] [] vfs\_write+0xbd/0x1e0
[ 356.127001] [] SyS\_write+0x49/0xa0
[ 356.127001] [] system\_call\_fastpath+0x16/0x1b
This is caused by a race between md device initialization by multipathd and
shell script to switch the scheduler using sysfs.
- multipathd:
SyS\_ioctl -> do\_vfs\_ioctl -> dm\_ctl\_ioctl -> ctl\_ioctl -> table\_load
-> dm\_setup\_md\_queue -> blk\_init\_allocated\_queue -> elevator\_init
q->elevator = elevator\_alloc(q, e); // not yet initialized
- sh -c 'echo deadline > /sys/$DEVPATH/queue/scheduler':
elevator\_switch (in the call trace above)
struct elevator\_queue \*old = q->elevator;
q->elevator = elevator\_alloc(q, new\_e);
elevator\_exit(old); // lockup! (\*)
- multipathd: (cont.)
err = e->ops.elevator\_init\_fn(q); // init fails; q->elevator is modified
(\*) When del\_timer\_sync() is called, lock\_timer\_base() will loop infinitely
while timer->base == NULL. In this case, as timer will never initialized,
it results in lockup.
This patch introduces acquisition of q->sysfs\_lock around elevator\_init()
into blk\_init\_allocated\_queue(), to provide mutual exclusion between
initialization of the q->scheduler and switching of the scheduler.
This should fix this bugzilla:
https://bugzilla.redhat.com/show\_bug.cgi?id=902012
Signed-off-by: Tomoki Sekiyama
Signed-off-by: Jens Axboe
Cc: Josh Boyer
Signed-off-by: Greg Kroah-Hartman
commit f8bf6d2085715c4326f255ad93ce32e9c4c9c550
Author: Stanislaw Gruszka
Date: Wed Sep 25 15:34:55 2013 +0200
rt2800: add support for radio chip RF3070
commit 3b9b74baa1af2952d719735b4a4a34706a593948 upstream.
Add support for new RF chip ID: 3070. It seems to be the same as 5370,
maybe vendor just put wrong value on the eeprom, but add this id anyway
since devices with it showed on the marked.
Signed-off-by: Stanislaw Gruszka
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 377fc8e63fb846b56d9565624a041015d5a120d7
Author: Neil Horman
Date: Fri Sep 27 12:53:35 2013 -0400
iommu: Remove stack trace from broken irq remapping warning
commit 05104a4e8713b27291c7bb49c1e7e68b4e243571 upstream.
The warning for the irq remapping broken check in intel\_irq\_remapping.c is
pretty pointless. We need the warning, but we know where its comming from, the
stack trace will always be the same, and it needlessly triggers things like
Abrt. This changes the warning to just print a text warning about BIOS being
broken, without the stack trace, then sets the appropriate taint bit. Since we
automatically disable irq remapping, theres no need to contiue making Abrt jump
at this problem
Signed-off-by: Neil Horman
CC: Joerg Roedel
CC: Bjorn Helgaas
CC: Andy Lutomirski
CC: Konrad Rzeszutek Wilk
CC: Sebastian Andrzej Siewior
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 18963511320a6eae19e6a584d099a7e549803cfa
Author: Julian Stecklina
Date: Wed Oct 9 10:03:52 2013 +0200
iommu/vt-d: Fixed interaction of VFIO\_IOMMU\_MAP\_DMA with IOMMU address limits
commit f9423606ade08653dd8a43334f0a7fb45504c5cc upstream.
The BUG\_ON in drivers/iommu/intel-iommu.c:785 can be triggered from userspace via
VFIO by calling the VFIO\_IOMMU\_MAP\_DMA ioctl on a vfio device with any address
beyond the addressing capabilities of the IOMMU. The problem is that the ioctl code
calls iommu\_iova\_to\_phys before it calls iommu\_map. iommu\_map handles the case that
it gets addresses beyond the addressing capabilities of its IOMMU.
intel\_iommu\_iova\_to\_phys does not.
This patch fixes iommu\_iova\_to\_phys to return NULL for addresses beyond what the
IOMMU can handle. This in turn causes the ioctl call to fail in iommu\_map and
(correctly) return EFAULT to the user with a helpful warning message in the kernel
log.
Signed-off-by: Julian Stecklina
Acked-by: Alex Williamson
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 30699c9661d6ecf0fb31804723f5d870865a617a
Author: Oliver Neukum
Date: Wed Sep 25 09:42:55 2013 +0200
HID: hid-elo: some systems cannot stomach work around
commit 403cfb53fb450d53751fdc7ee0cd6652419612cf upstream.
Some systems although they have firmware class 'M', which usually
needs a work around to not crash, must not be subjected to the
work around because the work around crashes them. They cannot be
told apart by their own device descriptor, but as they are part
of compound devices, can be identified by looking at their siblings.
Signed-off-by: Oliver Neukum
Signed-off-by: Jiri Kosina
Signed-off-by: Greg Kroah-Hartman
commit fef8c18a3f38d5446328997aaf7c8a56534df8c6
Author: Simon Wood
Date: Thu Oct 10 08:20:13 2013 -0600
HID: lg: fix Report Descriptor for Logitech MOMO Force (Black)
commit 348cbaa800f8161168b20f85f72abb541c145132 upstream.
By default the Logitech MOMO Force (Black) presents a combined accel/brake
axis ('Y'). This patch modifies the HID descriptor to present seperate
accel/brake axes ('Y' and 'Z').
Signed-off-by: Simon Wood
Signed-off-by: Jiri Kosina
Signed-off-by: Greg Kroah-Hartman
commit acc142b485c5d09358d9269834fb3ba8ceeeed0a
Author: Sasha Levin
Date: Tue Nov 19 14:25:36 2013 -0500
video: kyro: fix incorrect sizes when copying to userspace
commit 2ab68ec927310dc488f3403bb48f9e4ad00a9491 upstream.
kyro would copy u32s and specify sizeof(unsigned long) as the size to copy.
This would copy more data than intended and cause memory corruption and might
leak kernel memory.
Signed-off-by: Sasha Levin
Signed-off-by: Tomi Valkeinen
Signed-off-by: Greg Kroah-Hartman
commit aafc56772e2156d2c28fe6ce072d115c0e34834e
Author: Thomas Pugliese
Date: Wed Oct 23 14:44:29 2013 -0500
usb: wusbcore: change WA\_SEGS\_MAX to a legal value
commit f74b75e7f920c700636cccca669c7d16d12e9202 upstream.
change WA\_SEGS\_MAX to a number that is legal according to the WUSB
spec.
Signed-off-by: Thomas Pugliese
Signed-off-by: Greg Kroah-Hartman
commit ed32875deb3b4e319a94042db8e8e1f7fef2591a
Author: Sergei Shtylyov
Date: Sun Sep 22 01:43:58 2013 +0400
usb: musb: davinci: fix resources passed to MUSB driver for DM6467
commit ea78201e2e08f8a91e30100c4c4a908b5cf295fc upstream.
After commit 09fc7d22b024692b2fe8a943b246de1af307132b (usb: musb: fix incorrect
usage of resource pointer), CPPI DMA driver on DaVinci DM6467 can't detect its
dedicated IRQ and so the MUSB IRQ is erroneously used instead. This is because
only 2 resources are passed to the MUSB driver from the DaVinci glue layer, so
fix this by always copying 3 resources (it's safe since a placeholder for the
3rd resource is always there) and passing 'pdev->num\_resources' instead of the
size of musb\_resources[] to platform\_device\_add\_resources().
Signed-off-by: Sergei Shtylyov
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 8d3022e39bd68f76669ee3200797d44afdebd841
Author: majianpeng
Date: Thu Nov 14 15:16:20 2013 +1100
md/raid5: Use conf->device\_lock protect changing of multi-thread resources.
commit 60aaf933854511630e16be4efe0f96485e132de4 upstream.
and commit 0c775d5208284700de423e6746259da54a42e1f5
When we change group\_thread\_cnt from sysfs entry, it can OOPS.
The kernel messages are:
[ 135.299021] BUG: unable to handle kernel NULL pointer dereference at (null)
[ 135.299073] IP: [] handle\_active\_stripes+0x32b/0x440
[ 135.299107] PGD 0
[ 135.299122] Oops: 0000 [#1] SMP
[ 135.299144] Modules linked in: netconsole e1000e ptp pps\_core
[ 135.299188] CPU: 3 PID: 2225 Comm: md0\_raid5 Not tainted 3.12.0+ #24
[ 135.299214] Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./To be filled by O.E.M., BIOS 080015 11/09/2011
[ 135.299255] task: ffff8800b9638f80 ti: ffff8800b77a4000 task.ti: ffff8800b77a4000
[ 135.299283] RIP: 0010:[] [] handle\_active\_stripes+0x32b/0x440
[ 135.299323] RSP: 0018:ffff8800b77a5c48 EFLAGS: 00010002
[ 135.299344] RAX: ffff880037bb5c70 RBX: 0000000000000000 RCX: 0000000000000008
[ 135.299371] RDX: ffff880037bb5cb8 RSI: 0000000000000001 RDI: ffff880037bb5c00
[ 135.299398] RBP: ffff8800b77a5d08 R08: 0000000000000001 R09: 0000000000000000
[ 135.299425] R10: ffff8800b77a5c98 R11: 00000000ffffffff R12: ffff880037bb5c00
[ 135.299452] R13: 0000000000000000 R14: 0000000000000000 R15: ffff880037bb5c70
[ 135.299479] FS: 0000000000000000(0000) GS:ffff88013fd80000(0000) knlGS:0000000000000000
[ 135.299510] CS: 0010 DS: 0000 ES: 0000 CR0: 000000008005003b
[ 135.299532] CR2: 0000000000000000 CR3: 0000000001c0b000 CR4: 00000000000407e0
[ 135.299559] Stack:
[ 135.299570] ffff8800b77a5c88 ffffffff8107383e ffff8800b77a5c88 ffff880037a64300
[ 135.299611] 000000000000ec08 ffff880037bb5cb8 ffff8800b77a5c98 ffffffffffffffd8
[ 135.299654] 000000000000ec08 ffff880037bb5c60 ffff8800b77a5c98 ffff8800b77a5c98
[ 135.299696] Call Trace:
[ 135.299711] [] ? \_\_wake\_up+0x4e/0x70
[ 135.299733] [] raid5d+0x4c8/0x680
[ 135.299756] [] ? schedule\_timeout+0x15d/0x1f0
[ 135.299781] [] md\_thread+0x11f/0x170
[ 135.299804] [] ? wake\_up\_bit+0x40/0x40
[ 135.299826] [] ? md\_rdev\_init+0x110/0x110
[ 135.299850] [] kthread+0xc6/0xd0
[ 135.299871] [] ? kthread\_freezable\_should\_stop+0x70/0x70
[ 135.299899] [] ret\_from\_fork+0x7c/0xb0
[ 135.299923] [] ? kthread\_freezable\_should\_stop+0x70/0x70
[ 135.299951] Code: ff ff ff 0f 84 d7 fe ff ff e9 5c fe ff ff 66 90 41 8b b4 24 d8 01 00 00 45 31 ed 85 f6 0f 8e 7b fd ff ff 49 8b 9c 24 d0 01 00 00 <48> 3b 1b 49 89 dd 0f 85 67 fd ff ff 48 8d 43 28 31 d2 eb 17 90
[ 135.300005] RIP [] handle\_active\_stripes+0x32b/0x440
[ 135.300005] RSP
[ 135.300005] CR2: 0000000000000000
[ 135.300005] ---[ end trace 504854e5bb7562ed ]---
[ 135.300005] Kernel panic - not syncing: Fatal exception
This is because raid5d() can be running when the multi-thread
resources are changed via system. We see need to provide locking.
mddev->device\_lock is suitable, but we cannot simple call
alloc\_thread\_groups under this lock as we cannot allocate memory
while holding a spinlock.
So change alloc\_thread\_groups() to allocate and return the data
structures, then raid5\_store\_group\_thread\_cnt() can take the lock
while updating the pointers to the data structures.
This fixes a bug introduced in 3.12 and so is suitable for the 3.12.x
stable series.
Fixes: b721420e8719131896b009b11edbbd27
Signed-off-by: Jianpeng Ma
Signed-off-by: NeilBrown
Reviewed-by: Shaohua Li
Signed-off-by: Greg Kroah-Hartman
commit 4350fdaea3ba400b48e739acde0785318a6954ad
Author: Mel Gorman
Date: Tue Nov 12 15:08:32 2013 -0800
mm: numa: return the number of base pages altered by protection changes
commit 72403b4a0fbdf433c1fe0127e49864658f6f6468 upstream.
Commit 0255d4918480 ("mm: Account for a THP NUMA hinting update as one
PTE update") was added to account for the number of PTE updates when
marking pages prot\_numa. task\_numa\_work was using the old return value
to track how much address space had been updated. Altering the return
value causes the scanner to do more work than it is configured or
documented to in a single unit of work.
This patch reverts that commit and accounts for the number of THP
updates separately in vmstat. It is up to the administrator to
interpret the pair of values correctly. This is a straight-forward
operation and likely to only be of interest when actively debugging NUMA
balancing problems.
The impact of this patch is that the NUMA PTE scanner will scan slower
when THP is enabled and workloads may converge slower as a result. On
the flip size system CPU usage should be lower than recent tests
reported. This is an illustrative example of a short single JVM specjbb
test
specjbb
3.12.0 3.12.0
vanilla acctupdates
TPut 1 26143.00 ( 0.00%) 25747.00 ( -1.51%)
TPut 7 185257.00 ( 0.00%) 183202.00 ( -1.11%)
TPut 13 329760.00 ( 0.00%) 346577.00 ( 5.10%)
TPut 19 442502.00 ( 0.00%) 460146.00 ( 3.99%)
TPut 25 540634.00 ( 0.00%) 549053.00 ( 1.56%)
TPut 31 512098.00 ( 0.00%) 519611.00 ( 1.47%)
TPut 37 461276.00 ( 0.00%) 474973.00 ( 2.97%)
TPut 43 403089.00 ( 0.00%) 414172.00 ( 2.75%)
3.12.0 3.12.0
vanillaacctupdates
User 5169.64 5184.14
System 100.45 80.02
Elapsed 252.75 251.85
Performance is similar but note the reduction in system CPU time. While
this showed a performance gain, it will not be universal but at least
it'll be behaving as documented. The vmstats are obviously different but
here is an obvious interpretation of them from mmtests.
3.12.0 3.12.0
vanillaacctupdates
NUMA page range updates 1408326 11043064
NUMA huge PMD updates 0 21040
NUMA PTE updates 1408326 291624
"NUMA page range updates" == nr\_pte\_updates and is the value returned to
the NUMA pte scanner. NUMA huge PMD updates were the number of THP
updates which in combination can be used to calculate how many ptes were
updated from userspace.
Signed-off-by: Mel Gorman
Reported-by: Alex Thorlton
Reviewed-by: Rik van Riel
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Mel Gorman
Signed-off-by: Greg Kroah-Hartman
commit eaeeaec383f3228446715e660851f73423501eba
Author: Dwight Engen
Date: Thu Aug 15 14:08:03 2013 -0400
xfs: add capability check to free eofblocks ioctl
commit 8c567a7fab6e086a0284eee2db82348521e7120c upstream.
Check for CAP\_SYS\_ADMIN since the caller can truncate preallocated
blocks from files they do not own nor have write access to. A more
fine grained access check was considered: require the caller to
specify their own uid/gid and to use inode\_permission to check for
write, but this would not catch the case of an inode not reachable
via path traversal from the callers mount namespace.
Add check for read-only filesystem to free eofblocks ioctl.
Reviewed-by: Brian Foster
Reviewed-by: Dave Chinner
Reviewed-by: Gao feng
Signed-off-by: Dwight Engen
Signed-off-by: Ben Myers
Cc: Kees Cook
Signed-off-by: Greg Kroah-Hartman
commit d13252b415a1de2b91d240195afc7fd917c1f148
Author: Steffen Klassert
Date: Wed Oct 30 11:16:28 2013 +0100
xfrm: Fix null pointer dereference when decoding sessions
[ Upstream commit 84502b5ef9849a9694673b15c31bd3ac693010ae ]
On some codepaths the skb does not have a dst entry
when xfrm\_decode\_session() is called. So check for
a valid skb\_dst() before dereferencing the device
interface index. We use 0 as the device index if
there is no valid skb\_dst(), or at reverse decoding
we use skb\_iif as device interface index.
Bug was introduced with git commit bafd4bd4dc
("xfrm: Decode sessions with output interface.").
Reported-by: Meelis Roos
Tested-by: Meelis Roos
Signed-off-by: Steffen Klassert
Signed-off-by: Greg Kroah-Hartman
commit 83fc70f416f604cb71315de467accd0c07450c12
Author: fan.du
Date: Sun Dec 1 16:28:48 2013 +0800
{pktgen, xfrm} Update IPv4 header total len and checksum after tranformation
[ Upstream commit 3868204d6b89ea373a273e760609cb08020beb1a ]
commit a553e4a6317b2cfc7659542c10fe43184ffe53da ("[PKTGEN]: IPSEC support")
tried to support IPsec ESP transport transformation for pktgen, but acctually
this doesn't work at all for two reasons(The orignal transformed packet has
bad IPv4 checksum value, as well as wrong auth value, reported by wireshark)
- After transpormation, IPv4 header total length needs update,
because encrypted payload's length is NOT same as that of plain text.
- After transformation, IPv4 checksum needs re-caculate because of payload
has been changed.
With this patch, armmed pktgen with below cofiguration, Wireshark is able to
decrypted ESP packet generated by pktgen without any IPv4 checksum error or
auth value error.
pgset "flag IPSEC"
pgset "flows 1"
Signed-off-by: Fan Du
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 76a7894419438faeb03cf9a83b61c27e56f7a43a
Author: Hannes Frederic Sowa
Date: Fri Nov 29 06:39:44 2013 +0100
ipv6: fix possible seqlock deadlock in ip6\_finish\_output2
[ Upstream commit 7f88c6b23afbd31545c676dea77ba9593a1a14bf ]
IPv6 stats are 64 bits and thus are protected with a seqlock. By not
disabling bottom-half we could deadlock here if we don't disable bh and
a softirq reentrantly updates the same mib.
Cc: Eric Dumazet
Signed-off-by: Hannes Frederic Sowa
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 556a91d4d7c6f37f26701c7c067e486f79272671
Author: Eric Dumazet
Date: Thu Nov 28 09:51:22 2013 -0800
inet: fix possible seqlock deadlocks
[ Upstream commit f1d8cba61c3c4b1eb88e507249c4cb8d635d9a76 ]
In commit c9e9042994d3 ("ipv4: fix possible seqlock deadlock") I left
another places where IP\_INC\_STATS\_BH() were improperly used.
udp\_sendmsg(), ping\_v4\_sendmsg() and tcp\_v4\_connect() are called from
process context, not from softirq context.
This was detected by lockdep seqlock support.
Reported-by: jongman heo
Fixes: 584bdf8cbdf6 ("[IPV4]: Fix "ipOutNoRoutes" counter error for TCP and UDP")
Fixes: c319b4d76b9e ("net: ipv4: add IPPROTO\_ICMP socket kind")
Signed-off-by: Eric Dumazet
Cc: Hannes Frederic Sowa
Acked-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 34923f1eccdbd8c143b664edd933ce2840a50378
Author: Jiri Pirko
Date: Thu Nov 28 18:01:38 2013 +0100
team: fix master carrier set when user linkup is enabled
[ Upstream commit f5e0d34382e18f396d7673a84df8e3342bea7eb6 ]
When user linkup is enabled and user sets linkup of individual port,
we need to recompute linkup (carrier) of master interface so the change
is reflected. Fix this by calling \_\_team\_carrier\_check() which does the
needed work.
Please apply to all stable kernels as well. Thanks.
Reported-by: Jan Tluka
Signed-off-by: Jiri Pirko
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 2afe5cfbf8a8e9d5868dd5768fa80acacbf4b0e2
Author: Shawn Landden
Date: Sun Nov 24 22:36:28 2013 -0800
net: update consumers of MSG\_MORE to recognize MSG\_SENDPAGE\_NOTLAST
[ Upstream commit d3f7d56a7a4671d395e8af87071068a195257bf6 ]
Commit 35f9c09fe (tcp: tcp\_sendpages() should call tcp\_push() once)
added an internal flag MSG\_SENDPAGE\_NOTLAST, similar to
MSG\_MORE.
algif\_hash, algif\_skcipher, and udp used MSG\_MORE from tcp\_sendpages()
and need to see the new flag as identical to MSG\_MORE.
This fixes sendfile() on AF\_ALG.
v3: also fix udp
Cc: Tom Herbert
Cc: Eric Dumazet
Cc: David S. Miller
Cc:  # 3.4.x + 3.2.x
Reported-and-tested-by: Shawn Landden
Original-patch: Richard Weinberger
Signed-off-by: Shawn Landden
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 2c9681ebe69e09a73aa4e7e06107deb59dd43c65
Author: Linus Walleij
Date: Thu Nov 28 14:33:52 2013 +0100
net: smc91: fix crash regression on the versatile
[ Upstream commit a0c20fb02592d372e744d1d739cda3e1b3defaae ]
After commit e9e4ea74f06635f2ffc1dffe5ef40c854faa0a90
"net: smc91x: dont't use SMC\_outw for fixing up halfword-aligned data"
The Versatile SMSC LAN91C111 is crashing like this:
------------[ cut here ]------------
kernel BUG at /home/linus/linux/drivers/net/ethernet/smsc/smc91x.c:599!
Internal error: Oops - BUG: 0 [#1] ARM
Modules linked in:
CPU: 0 PID: 43 Comm: udhcpc Not tainted 3.13.0-rc1+ #24
task: c6ccfaa0 ti: c6cd0000 task.ti: c6cd0000
PC is at smc\_hardware\_send\_pkt+0x198/0x22c
LR is at smc\_hardware\_send\_pkt+0x24/0x22c
pc : [] lr : [] psr: 20000013
sp : c6cd1d08 ip : 00000001 fp : 00000000
r10: c02adb08 r9 : 00000000 r8 : c6ced802
r7 : c786fba0 r6 : 00000146 r5 : c8800000 r4 : c78d6000
r3 : 0000000f r2 : 00000146 r1 : 00000000 r0 : 00000031
Flags: nzCv IRQs on FIQs on Mode SVC\_32 ISA ARM Segment user
Control: 0005317f Table: 06cf4000 DAC: 00000015
Process udhcpc (pid: 43, stack limit = 0xc6cd01c0)
Stack: (0xc6cd1d08 to 0xc6cd2000)
1d00: 00000010 c8800000 c78d6000 c786fba0 c78d6000 c01be868
1d20: c01be7a4 00004000 00000000 c786fba0 c6c12b80 c0208554 000004d0 c780fc60
1d40: 00000220 c01fb734 00000000 00000000 00000000 c6c9a440 c6c12b80 c78d6000
1d60: c786fba0 c6c9a440 00000000 c021d1d8 00000000 00000000 c6c12b80 c78d6000
1d80: c786fba0 00000001 c6c9a440 c02087f8 c6c9a4a0 00080008 00000000 00000000
1da0: c78d6000 c786fba0 c78d6000 00000138 00000000 00000000 00000000 00000000
1dc0: 00000000 c027ba74 00000138 00000138 00000001 00000010 c6cedc00 00000000
1de0: 00000008 c7404400 c6cd1eec c6cd1f14 c067a73c c065c0b8 00000000 c067a740
1e00: 01ffffff 002040d0 00000000 00000000 00000000 00000000 00000000 ffffffff
1e20: 43004400 00110022 c6cdef20 c027ae8c c6ccfaa0 be82d65c 00000014 be82d3cc
1e40: 00000000 00000000 00000000 c01f2870 00000000 00000000 00000000 c6cd1e88
1e60: c6ccfaa0 00000000 00000000 00000000 00000000 00000000 00000000 00000000
1e80: 00000000 00000000 00000031 c7802310 c7802300 00000138 c7404400 c0771da0
1ea0: 00000000 c6cd1eec c7800340 00000138 be82d65c 00000014 be82d3cc c6cd1f08
1ec0: 00000014 00000000 c7404400 c7404400 00000138 c01f4628 c78d6000 00000000
1ee0: 00000000 be82d3cc 00000138 c6cd1f08 00000014 c6cd1ee4 00000001 00000000
1f00: 00000000 00000000 00080011 00000002 06000000 ffffffff 0000ffff 00000002
1f20: 06000000 ffffffff 0000ffff c00928c8 c065c520 c6cd1f58 00000003 c009299c
1f40: 00000003 c065c520 c7404400 00000000 c7404400 c01f2218 c78106b0 c7441cb0
1f60: 00000000 00000006 c06799fc 00000000 00000000 00000006 00000000 c01f3ee0
1f80: 00000000 00000000 be82d678 be82d65c 00000014 00000001 00000122 c00139c8
1fa0: c6cd0000 c0013840 be82d65c 00000014 00000006 be82d3cc 00000138 00000000
1fc0: be82d65c 00000014 00000001 00000122 00000000 00000000 00018cb1 00000000
1fe0: 00003801 be82d3a8 0003a0c7 b6e9af08 60000010 00000006 00000000 00000000
[] (smc\_hardware\_send\_pkt+0x198/0x22c) from [] (smc\_hard\_start\_xmit+0xc4/0x1e8)
[] (smc\_hard\_start\_xmit+0xc4/0x1e8) from [] (dev\_hard\_start\_xmit+0x460/0x4cc)
[] (dev\_hard\_start\_xmit+0x460/0x4cc) from [] (sch\_direct\_xmit+0x94/0x18c)
[] (sch\_direct\_xmit+0x94/0x18c) from [] (dev\_queue\_xmit+0x238/0x42c)
[] (dev\_queue\_xmit+0x238/0x42c) from [] (packet\_sendmsg+0xbe8/0xd28)
[] (packet\_sendmsg+0xbe8/0xd28) from [] (sock\_sendmsg+0x84/0xa8)
[] (sock\_sendmsg+0x84/0xa8) from [] (SyS\_sendto+0xb8/0xdc)
[] (SyS\_sendto+0xb8/0xdc) from [] (ret\_fast\_syscall+0x0/0x2c)
Code: e3130002 1a000001 e3130001 0affffcd (e7f001f2)
---[ end trace 81104fe70e8da7fe ]---
Kernel panic - not syncing: Fatal exception in interrupt
This is because the macro operations in smc91x.h defined
for Versatile are missing SMC\_outsw() as used in this
commit.
The Versatile needs and uses the same accessors as the other
platforms in the first if(...) clause, just switch it to using
that and we have one problem less to worry about.
This includes a hunk of a patch from Will Deacon fixin
the other 32bit platforms as well: Innokom, Ramses, PXA,
PCM027.
Checkpatch complains about spacing, but I have opted to
follow the style of this .h-file.
Cc: Russell King
Cc: Nicolas Pitre
Cc: Eric Miao
Cc: Jonathan Cameron
Cc: stable@vger.kernel.org
Signed-off-by: Will Deacon
Signed-off-by: Linus Walleij
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 2650c2f88adb79a2ec693ccf65fd59f7389e79c9
Author: Yang Yingliang
Date: Wed Nov 27 14:32:52 2013 +0800
net: 8139cp: fix a BUG\_ON triggered by wrong bytes\_compl
[ Upstream commit 7fe0ee099ad5e3dea88d4ee1b6f20246b1ca57c3 ]
Using iperf to send packets(GSO mode is on), a bug is triggered:
[ 212.672781] kernel BUG at lib/dynamic\_queue\_limits.c:26!
[ 212.673396] invalid opcode: 0000 [#1] SMP
[ 212.673882] Modules linked in: 8139cp(O) nls\_utf8 edd fuse loop dm\_mod ipv6 i2c\_piix4 8139too i2c\_core intel\_agp joydev pcspkr hid\_generic intel\_gtt floppy sr\_mod mii button sg cdrom ext3 jbd mbcache usbhid hid uhci\_hcd ehci\_hcd usbcore sd\_mod usb\_common crc\_t10dif crct10dif\_common processor thermal\_sys hwmon scsi\_dh\_emc scsi\_dh\_rdac scsi\_dh\_hp\_sw scsi\_dh ata\_generic ata\_piix libata scsi\_mod [last unloaded: 8139cp]
[ 212.676084] CPU: 0 PID: 4124 Comm: iperf Tainted: G O 3.12.0-0.7-default+ #16
[ 212.676084] Hardware name: Bochs Bochs, BIOS Bochs 01/01/2007
[ 212.676084] task: ffff8800d83966c0 ti: ffff8800db4c8000 task.ti: ffff8800db4c8000
[ 212.676084] RIP: 0010:[] [] dql\_completed+0x17f/0x190
[ 212.676084] RSP: 0018:ffff880116e03e30 EFLAGS: 00010083
[ 212.676084] RAX: 00000000000005ea RBX: 0000000000000f7c RCX: 0000000000000002
[ 212.676084] RDX: ffff880111dd0dc0 RSI: 0000000000000bd4 RDI: ffff8800db6ffcc0
[ 212.676084] RBP: ffff880116e03e48 R08: 0000000000000992 R09: 0000000000000000
[ 212.676084] R10: ffffffff8181e400 R11: 0000000000000004 R12: 000000000000000f
[ 212.676084] R13: ffff8800d94ec840 R14: ffff8800db440c80 R15: 000000000000000e
[ 212.676084] FS: 00007f6685a3c700(0000) GS:ffff880116e00000(0000) knlGS:0000000000000000
[ 212.676084] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 212.676084] CR2: 00007f6685ad6460 CR3: 00000000db714000 CR4: 00000000000006f0
[ 212.676084] Stack:
[ 212.676084] ffff8800db6ffc00 000000000000000f ffff8800d94ec840 ffff880116e03eb8
[ 212.676084] ffffffffa041509f ffff880116e03e88 0000000f16e03e88 ffff8800d94ec000
[ 212.676084] 00000bd400059858 000000050000000f ffffffff81094c36 ffff880116e03eb8
[ 212.676084] Call Trace:
[ 212.676084]
[ 212.676084] [] cp\_interrupt+0x4ef/0x590 [8139cp]
[ 212.676084] [] ? ktime\_get+0x56/0xd0
[ 212.676084] [] handle\_irq\_event\_percpu+0x53/0x170
[ 212.676084] [] handle\_irq\_event+0x3c/0x60
[ 212.676084] [] handle\_fasteoi\_irq+0x55/0xf0
[ 212.676084] [] handle\_irq+0x1f/0x30
[ 212.676084] [] do\_IRQ+0x5b/0xe0
[ 212.676084] [] common\_interrupt+0x6a/0x6a
[ 212.676084]
[ 212.676084] [] ? cp\_start\_xmit+0x621/0x97c [8139cp]
[ 212.676084] [] ? cp\_start\_xmit+0x609/0x97c [8139cp]
[ 212.676084] [] dev\_hard\_start\_xmit+0x2c9/0x550
[ 212.676084] [] sch\_direct\_xmit+0x179/0x1d0
[ 212.676084] [] dev\_queue\_xmit+0x293/0x440
[ 212.676084] [] ip\_finish\_output+0x236/0x450
[ 212.676084] [] ? \_\_alloc\_pages\_nodemask+0x187/0xb10
[ 212.676084] [] ip\_output+0x88/0x90
[ 212.676084] [] ip\_local\_out+0x24/0x30
[ 212.676084] [] ip\_queue\_xmit+0x14d/0x3e0
[ 212.676084] [] tcp\_transmit\_skb+0x501/0x840
[ 212.676084] [] tcp\_write\_xmit+0x1e3/0xb20
[ 212.676084] [] ? skb\_page\_frag\_refill+0x87/0xd0
[ 212.676084] [] tcp\_push\_one+0x2b/0x40
[ 212.676084] [] tcp\_sendmsg+0x926/0xc90
[ 212.676084] [] inet\_sendmsg+0x61/0xc0
[ 212.676084] [] sock\_aio\_write+0x101/0x120
[ 212.676084] [] ? vma\_adjust+0x2e1/0x5d0
[ 212.676084] [] ? timerqueue\_add+0x60/0xb0
[ 212.676084] [] do\_sync\_write+0x60/0x90
[ 212.676084] [] ? rw\_verify\_area+0x54/0xf0
[ 212.676084] [] vfs\_write+0x186/0x190
[ 212.676084] [] SyS\_write+0x5d/0xa0
[ 212.676084] [] system\_call\_fastpath+0x16/0x1b
[ 212.676084] Code: ca 41 89 dc 41 29 cc 45 31 db 29 c2 41 89 c5 89 d0 45 29 c5 f7 d0 c1 e8 1f e9 43 ff ff ff 66 0f 1f 44 00 00 31 c0 e9 7b ff ff ff <0f> 0b eb fe 66 66 66 66 2e 0f 1f 84 00 00 00 00 00 c7 47 40 00
[ 212.676084] RIP [] dql\_completed+0x17f/0x190
------------[ cut here ]------------
When a skb has frags, bytes\_compl plus skb->len nr\_frags times in cp\_tx().
It's not the correct value(actually, it should plus skb->len once) and it
will trigger the BUG\_ON(bytes\_compl > num\_queued - dql->num\_completed).
So only increase bytes\_compl when finish sending all frags. pkts\_compl also
has a wrong value, fix it too.
It's introduced by commit 871f0d4c ("8139cp: enable bql").
Suggested-by: Eric Dumazet
Signed-off-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 8b0a34fa49e2cca02beeafce2d96e9d8a53c85e3
Author: David Chang
Date: Wed Nov 27 15:48:36 2013 +0800
r8169: check ALDPS bit and disable it if enabled for the 8168g
[ Upstream commit 1bac1072425c86f1ac85bd5967910706677ef8b3 ]
Windows driver will enable ALDPS function, but linux driver and firmware
do not have any configuration related to ALDPS function for 8168g.
So restart system to linux and remove the NIC cable, LAN enter ALDPS,
then LAN RX will be disabled.
This issue can be easily reproduced on dual boot windows and linux
system with RTL\_GIGA\_MAC\_VER\_40 chip.
Realtek said, ALDPS function can be disabled by configuring to PHY,
switch to page 0x0A43, reg0x10 bit2=0.
Signed-off-by: David Chang
Acked-by: Hayes Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit df0c053e8ae401eab14447a729060bfa4f8c02ce
Author: Francois Romieu
Date: Tue Nov 26 00:40:58 2013 +0100
via-velocity: fix netif\_receive\_skb use in irq disabled section.
[ Upstream commit bc9627e7e918a85e906c1a3f6d01d9b8ef911a96 ]
2fdac010bdcf10a30711b6924612dfc40daf19b8 ("via-velocity.c: update napi
implementation") overlooked an irq disabling spinlock when the Rx part
of the NAPI poll handler was converted from netif\_rx to netif\_receive\_skb.
NAPI Rx processing can be taken out of the locked section with a pair of
napi\_{disable / enable} since it only races with the MTU change function.
An heavier rework of the NAPI locking would be able to perform NAPI Tx
before Rx where I simply removed one of velocity\_tx\_srv calls.
References: https://bugzilla.redhat.com/show\_bug.cgi?id=1022733
Fixes: 2fdac010bdcf (via-velocity.c: update napi implementation)
Signed-off-by: Francois Romieu
Tested-by: Alex A. Schmidt
Cc: Jamie Heilman
Cc: Michele Baldessari
Cc: Julia Lawall
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d172c155ae6c542947f3ebe690ac61ffa9b654f2
Author: Andy Whitcroft
Date: Mon Nov 25 16:52:34 2013 +0000
xen-netback: include definition of csum\_ipv6\_magic
[ Upstream commit ae5e8127b712313ec1b99356019ce9226fea8b88 ]
We are now using csum\_ipv6\_magic, include the appropriate header.
Avoids the following error:
drivers/net/xen-netback/netback.c:1313:4: error: implicit declaration of function 'csum\_ipv6\_magic' [-Werror=implicit-function-declaration]
tcph->check = ~csum\_ipv6\_magic(&ipv6h->saddr,
Signed-off-by: Andy Whitcroft
Acked-by: Ian Campbell
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f2b44be96bc1ed055baa56b6474bb9369ac186bf
Author: Eric Dumazet
Date: Sat Nov 23 12:59:20 2013 -0800
sch\_tbf: handle too small burst
[ Upstream commit 4d0820cf6a55d72350cb2d24a4504f62fbde95d9 ]
If a too small burst is inadvertently set on TBF, we might trigger
a bug in tbf\_segment(), as 'skb' instead of 'segs' was used in a
qdisc\_reshape\_fail() call.
tc qdisc add dev eth0 root handle 1: tbf latency 50ms burst 1KB rate
50mbit
Fix the bug, and add a warning, as such configuration is not
going to work anyway for non GSO packets.
(For some reason, one has to use a burst >= 1520 to get a working
configuration, even with old kernels. This is a probable iproute2/tc
bug)
Based on a report and initial patch from Yang Yingliang
Fixes: e43ac79a4bc6 ("sch\_tbf: segment too big GSO packets")
Signed-off-by: Eric Dumazet
Reported-by: Yang Yingliang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 99834e4d7c5e441e268eb718e41d7e83343477fb
Author: Herbert Xu
Date: Fri Nov 22 10:32:11 2013 +0800
gro: Clean up tcpX\_gro\_receive checksum verification
[ Upstream commit b8ee93ba80b5a0b6c3c06b65c34dd1276f16c047 ]
This patch simplifies the checksum verification in tcpX\_gro\_receive
by reusing the CHECKSUM\_COMPLETE code for CHECKSUM\_NONE. All it
does for CHECKSUM\_NONE is compute the partial checksum and then
treat it as if it came from the hardware (CHECKSUM\_COMPLETE).
Signed-off-by: Herbert Xu
Cheers,
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d8f703112e39ab0d58bc140d2f8db80add02acf7
Author: Herbert Xu
Date: Fri Nov 22 10:31:29 2013 +0800
gro: Only verify TCP checksums for candidates
[ Upstream commit cc5c00bbb44c5d68b883aa5cb9d01514a2525d94 ]
In some cases we may receive IP packets that are longer than
their stated lengths. Such packets are never merged in GRO.
However, we may end up computing their checksums incorrectly
and end up allowing packets with a bogus checksum enter our
stack with the checksum status set as verified.
Since such packets are rare and not performance-critical, this
patch simply skips the checksum verification for them.
Reported-by: Alexander Duyck
Signed-off-by: Herbert Xu
Acked-by: Alexander Duyck
Thanks,
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c5352f3600c8066715f5fa2f4cece0890d55c0a1
Author: Herbert Xu
Date: Thu Nov 21 11:10:04 2013 -0800
gso: handle new frag\_list of frags GRO packets
[ Upstream commit 9d8506cc2d7ea1f911c72c100193a3677f6668c3 ]
Recently GRO started generating packets with frag\_lists of frags.
This was not handled by GSO, thus leading to a crash.
Thankfully these packets are of a regular form and are easy to
handle. This patch handles them in two ways. For completely
non-linear frag\_list entries, we simply continue to iterate over
the frag\_list frags once we exhaust the normal frags. For frag\_list
entries with linear parts, we call pskb\_trim on the first part
of the frag\_list skb, and then process the rest of the frags in
the usual way.
This patch also kills a chunk of dead frag\_list code that has
obviously never ever been run since it ends up generating a bogus
GSO-segmented packet with a frag\_list entry.
Future work is planned to split super big packets into TSO
ones.
Fixes: 8a29111c7ca6 ("net: gro: allow to build full sized skb")
Reported-by: Christoph Paasch
Reported-by: Jerry Chu
Reported-by: Sander Eikelenboom
Signed-off-by: Herbert Xu
Signed-off-by: Eric Dumazet
Tested-by: Sander Eikelenboom
Tested-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f517950d9c64e4c75d054b3268b43c60b5ab0849
Author: Veaceslav Falico
Date: Fri Nov 29 09:53:23 2013 +0100
af\_packet: block BH in prb\_shutdown\_retire\_blk\_timer()
[ Upstream commit ec6f809ff6f19fafba3212f6aff0dda71dfac8e8 ]
Currently we're using plain spin\_lock() in prb\_shutdown\_retire\_blk\_timer(),
however the timer might fire right in the middle and thus try to re-aquire
the same spinlock, leaving us in a endless loop.
To fix that, use the spin\_lock\_bh() to block it.
Fixes: f6fb8f100b80 ("af-packet: TPACKET\_V3 flexible buffer implementation.")
CC: "David S. Miller"
CC: Daniel Borkmann
CC: Willem de Bruijn
CC: Phil Sutter
CC: Eric Dumazet
Reported-by: Jan Stancek
Tested-by: Jan Stancek
Signed-off-by: Veaceslav Falico
Acked-by: Daniel Borkmann
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit efc27dbe987ac25688b3c4ef8c4792209644306b
Author: Daniel Borkmann
Date: Thu Nov 21 16:50:58 2013 +0100
packet: fix use after free race in send path when dev is released
[ Upstream commit e40526cb20b5ee53419452e1f03d97092f144418 ]
Salam reported a use after free bug in PF\_PACKET that occurs when
we're sending out frames on a socket bound device and suddenly the
net device is being unregistered. It appears that commit 827d9780
introduced a possible race condition between {t,}packet\_snd() and
packet\_notifier(). In the case of a bound socket, packet\_notifier()
can drop the last reference to the net\_device and {t,}packet\_snd()
might end up suddenly sending a packet over a freed net\_device.
To avoid reverting 827d9780 and thus introducing a performance
regression compared to the current state of things, we decided to
hold a cached RCU protected pointer to the net device and maintain
it on write side via bind spin\_lock protected register\_prot\_hook()
and \_\_unregister\_prot\_hook() calls.
In {t,}packet\_snd() path, we access this pointer under rcu\_read\_lock
through packet\_cached\_dev\_get() that holds reference to the device
to prevent it from being freed through packet\_notifier() while
we're in send path. This is okay to do as dev\_put()/dev\_hold() are
per-cpu counters, so this should not be a performance issue. Also,
the code simplifies a bit as we don't need need\_rls\_dev anymore.
Fixes: 827d978037d7 ("af-packet: Use existing netdev reference for bound sockets.")
Reported-by: Salam Noureddine
Signed-off-by: Daniel Borkmann
Signed-off-by: Salam Noureddine
Cc: Ben Greear
Cc: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4af9d8887f6540abd355e2068af171f5400fccbf
Author: Ding Tianhong
Date: Sat Dec 7 22:12:05 2013 +0800
bridge: flush br's address entry in fdb when remove the bridge dev
[ Upstream commit f873042093c0b418d2351fe142222b625c740149 ]
When the following commands are executed:
brctl addbr br0
ifconfig br0 hw ether
rmmod bridge
The calltrace will occur:
[ 563.312114] device eth1 left promiscuous mode
[ 563.312188] br0: port 1(eth1) entered disabled state
[ 563.468190] kmem\_cache\_destroy bridge\_fdb\_cache: Slab cache still has objects
[ 563.468197] CPU: 6 PID: 6982 Comm: rmmod Tainted: G O 3.12.0-0.7-default+ #9
[ 563.468199] Hardware name: Bochs Bochs, BIOS Bochs 01/01/2007
[ 563.468200] 0000000000000880 ffff88010f111e98 ffffffff814d1c92 ffff88010f111eb8
[ 563.468204] ffffffff81148efd ffff88010f111eb8 0000000000000000 ffff88010f111ec8
[ 563.468206] ffffffffa062a270 ffff88010f111ed8 ffffffffa063ac76 ffff88010f111f78
[ 563.468209] Call Trace:
[ 563.468218] [] dump\_stack+0x6a/0x78
[ 563.468234] [] kmem\_cache\_destroy+0xfd/0x100
[ 563.468242] [] br\_fdb\_fini+0x10/0x20 [bridge]
[ 563.468247] [] br\_deinit+0x4e/0x50 [bridge]
[ 563.468254] [] SyS\_delete\_module+0x199/0x2b0
[ 563.468259] [] system\_call\_fastpath+0x16/0x1b
[ 570.377958] Bridge firewalling registered
--------------------------- cut here -------------------------------
The reason is that when the bridge dev's address is changed, the
br\_fdb\_change\_mac\_address() will add new address in fdb, but when
the bridge was removed, the address entry in the fdb did not free,
the bridge\_fdb\_cache still has objects when destroy the cache, Fix
this by flushing the bridge address entry when removing the bridge.
v2: according to the Toshiaki Makita and Vlad's suggestion, I only
delete the vlan0 entry, it still have a leak here if the vlan id
is other number, so I need to call fdb\_delete\_by\_port(br, NULL, 1)
to flush all entries whose dst is NULL for the bridge.
Suggested-by: Toshiaki Makita
Suggested-by: Vlad Yasevich
Signed-off-by: Ding Tianhong
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a6ec437be3d70e9ba85fb34941a96577dcbb8414
Author: Vlad Yasevich
Date: Tue Nov 19 20:47:15 2013 -0500
net: core: Always propagate flag changes to interfaces
[ Upstream commit d2615bf450694c1302d86b9cc8a8958edfe4c3a4 ]
The following commit:
b6c40d68ff6498b7f63ddf97cf0aa818d748dee7
net: only invoke dev->change\_rx\_flags when device is UP
tried to fix a problem with VLAN devices and promiscuouse flag setting.
The issue was that VLAN device was setting a flag on an interface that
was down, thus resulting in bad promiscuity count.
This commit blocked flag propagation to any device that is currently
down.
A later commit:
deede2fabe24e00bd7e246eb81cd5767dc6fcfc7
vlan: Don't propagate flag changes on down interfaces
fixed VLAN code to only propagate flags when the VLAN interface is up,
thus fixing the same issue as above, only localized to VLAN.
The problem we have now is that if we have create a complex stack
involving multiple software devices like bridges, bonds, and vlans,
then it is possible that the flags would not propagate properly to
the physical devices. A simple examle of the scenario is the
following:
eth0----> bond0 ----> bridge0 ---> vlan50
If bond0 or eth0 happen to be down at the time bond0 is added to
the bridge, then eth0 will never have promisc mode set which is
currently required for operation as part of the bridge. As a
result, packets with vlan50 will be dropped by the interface.
The only 2 devices that implement the special flag handling are
VLAN and DSA and they both have required code to prevent incorrect
flag propagation. As a result we can remove the generic solution
introduced in b6c40d68ff6498b7f63ddf97cf0aa818d748dee7 and leave
it to the individual devices to decide whether they will block
flag propagation or not.
Reported-by: Stefan Priebe
Suggested-by: Veaceslav Falico
Signed-off-by: Vlad Yasevich
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit fa2f52deaf335713f839fa17da58f60eb48528cd
Author: Alexei Starovoitov
Date: Tue Nov 19 19:12:34 2013 -0800
ipv4: fix race in concurrent ip\_route\_input\_slow()
[ Upstream commit dcdfdf56b4a6c9437fc37dbc9cee94a788f9b0c4 ]
CPUs can ask for local route via ip\_route\_input\_noref() concurrently.
if nh\_rth\_input is not cached yet, CPUs will proceed to allocate
equivalent DSTs on 'lo' and then will try to cache them in nh\_rth\_input
via rt\_cache\_route()
Most of the time they succeed, but on occasion the following two lines:
orig = \*p;
prev = cmpxchg(p, orig, rt);
in rt\_cache\_route() do race and one of the cpus fails to complete cmpxchg.
But ip\_route\_input\_slow() doesn't check the return code of rt\_cache\_route(),
so dst is leaking. dst\_destroy() is never called and 'lo' device
refcnt doesn't go to zero, which can be seen in the logs as:
unregister\_netdevice: waiting for lo to become free. Usage count = 1
Adding mdelay() between above two lines makes it easily reproducible.
Fix it similar to nh\_pcpu\_rth\_output case.
Fixes: d2d68ba9fe8b ("ipv4: Cache input routes in fib\_info nexthops.")
Signed-off-by: Alexei Starovoitov
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 30eb9c19716dbca111330f0e1d31054da9b69c24
Author: Andrey Vagin
Date: Tue Nov 19 22:10:06 2013 +0400
tcp: don't update snd\_nxt, when a socket is switched from repair mode
[ Upstream commit dbde497966804e63a38fdedc1e3815e77097efc2 ]
snd\_nxt must be updated synchronously with sk\_send\_head. Otherwise
tp->packets\_out may be updated incorrectly, what may bring a kernel panic.
Here is a kernel panic from my host.
[ 103.043194] BUG: unable to handle kernel NULL pointer dereference at 0000000000000048
[ 103.044025] IP: [] tcp\_rearm\_rto+0xcf/0x150
...
[ 146.301158] Call Trace:
[ 146.301158] [] tcp\_ack+0xcc0/0x12c0
Before this panic a tcp socket was restored. This socket had sent and
unsent data in the write queue. Sent data was restored in repair mode,
then the socket was switched from reapair mode and unsent data was
restored. After that the socket was switched back into repair mode.
In that moment we had a socket where write queue looks like this:
snd\_una snd\_nxt write\_seq
|\_\_\_\_\_\_\_\_\_|\_\_\_\_\_\_\_\_|
|
sk\_send\_head
After a second switching from repair mode the state of socket was
changed:
snd\_una snd\_nxt, write\_seq
|\_\_\_\_\_\_\_\_\_ \_\_\_\_\_\_\_\_|
|
sk\_send\_head
This state is inconsistent, because snd\_nxt and sk\_send\_head are not
synchronized.
Bellow you can find a call trace, how packets\_out can be incremented
twice for one skb, if snd\_nxt and sk\_send\_head are not synchronized.
In this case packets\_out will be always positive, even when
sk\_write\_queue is empty.
tcp\_write\_wakeup
skb = tcp\_send\_head(sk);
tcp\_fragment
if (!before(tp->snd\_nxt, TCP\_SKB\_CB(buff)->end\_seq))
tcp\_adjust\_pcount(sk, skb, diff);
tcp\_event\_new\_data\_sent
tp->packets\_out += tcp\_skb\_pcount(skb);
I think update of snd\_nxt isn't required, when a socket is switched from
repair mode. Because it's initialized in tcp\_connect\_init. Then when a
write queue is restored, snd\_nxt is incremented in tcp\_event\_new\_data\_sent,
so it's always is in consistent state.
I have checked, that the bug is not reproduced with this patch and
all tests about restoring tcp connections work fine.
Cc: Pavel Emelyanov
Cc: Eric Dumazet
Cc: "David S. Miller"
Cc: Alexey Kuznetsov
Cc: James Morris
Cc: Hideaki YOSHIFUJI
Cc: Patrick McHardy
Signed-off-by: Andrey Vagin
Acked-by: Pavel Emelyanov
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5f406a1e82eab34701698cfe19d2bcf054896453
Author: Ying Xue
Date: Tue Nov 19 18:09:27 2013 +0800
atm: idt77252: fix dev refcnt leak
[ Upstream commit b5de4a22f157ca345cdb3575207bf46402414bc1 ]
init\_card() calls dev\_get\_by\_name() to get a network deceive. But it
doesn't decrease network device reference count after the device is
used.
Signed-off-by: Ying Xue
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit fa3735e9981998674f23fb99212a591a5a69a9b0
Author: fan.du
Date: Tue Nov 19 16:53:28 2013 +0800
xfrm: Release dst if this dst is improper for vti tunnel
[ Upstream commit 236c9f84868534c718b6889aa624de64763281f9 ]
After searching rt by the vti tunnel dst/src parameter,
if this rt has neither attached to any transformation
nor the transformation is not tunnel oriented, this rt
should be released back to ip layer.
otherwise causing dst memory leakage.
Signed-off-by: Fan Du
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0a6905b2186e5ae1715545d067dde8ad830fc3f5
Author: Jiri Pirko
Date: Wed Nov 6 17:52:20 2013 +0100
netfilter: push reasm skb through instead of original frag skbs
[ Upstream commit 6aafeef03b9d9ecf255f3a80ed85ee070260e1ae ]
Pushing original fragments through causes several problems. For example
for matching, frags may not be matched correctly. Take following
example:
On HOSTA do:
ip6tables -I INPUT -p icmpv6 -j DROP
ip6tables -I INPUT -p icmpv6 -m icmp6 --icmpv6-type 128 -j ACCEPT
and on HOSTB you do:
ping6 HOSTA -s2000 (MTU is 1500)
Incoming echo requests will be filtered out on HOSTA. This issue does
not occur with smaller packets than MTU (where fragmentation does not happen)

As was discussed previously, the only correct solution seems to be to use
reassembled skb instead of separete frags. Doing this has positive side
effects in reducing sk\_buff by one pointer (nfct\_reasm) and also the reams
dances in ipvs and conntrack can be removed.
Future plan is to remove net/ipv6/netfilter/nf\_conntrack\_reasm.c
entirely and use code in net/ipv6/reassembly.c instead.
Signed-off-by: Jiri Pirko
Acked-by: Julian Anastasov
Signed-off-by: Marcelo Ricardo Leitner
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 88a6ec987d157ade1ba8b4e0d105a06a4c6fd27c
Author: Jiri Pirko
Date: Wed Nov 6 17:52:19 2013 +0100
ip6\_output: fragment outgoing reassembled skb properly
[ Upstream commit 9037c3579a277f3a23ba476664629fda8c35f7c4 ]
If reassembled packet would fit into outdev MTU, it is not fragmented
according the original frag size and it is send as single big packet.
The second case is if skb is gso. In that case fragmentation does not happen
according to the original frag size.
This patch fixes these.
Signed-off-by: Jiri Pirko
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 72b89baeaa1f76c517ae8cfe3dc9e4c59b8d0c0f
Author: Vlad Yasevich
Date: Sat Nov 16 15:17:24 2013 -0500
ipv6: Fix inet6\_init() cleanup order
Commit 6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67
net: ipv6: Add IPv6 support to the ping socket
introduced a change in the cleanup logic of inet6\_init and
has a bug in that ipv6\_packet\_cleanup() may not be called.
Fix the cleanup ordering.
CC: Hannes Frederic Sowa
CC: Lorenzo Colitti
CC: Fabio Estevam
Signed-off-by: Vlad Yasevich
Acked-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 00fecf737b27ccd17efcf7090267cf2b9597b456
Author: Hannes Frederic Sowa
Date: Sat Nov 23 07:22:33 2013 +0100
ipv6: fix leaking uninitialized port number of offender sockaddr
[ Upstream commit 1fa4c710b6fe7b0aac9907240291b6fe6aafc3b8 ]
Offenders don't have port numbers, so set it to 0.
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5bca4e493175cd62bb92af685262b11bb7d2ffba
Author: Dan Carpenter
Date: Wed Nov 27 15:40:21 2013 +0300
net: clamp ->msg\_namelen instead of returning an error
[ Upstream commit db31c55a6fb245fdbb752a2ca4aefec89afabb06 ]
If kmsg->msg\_namelen > sizeof(struct sockaddr\_storage) then in the
original code that would lead to memory corruption in the kernel if you
had audit configured. If you didn't have audit configured it was
harmless.
There are some programs such as beta versions of Ruby which use too
large of a buffer and returning an error code breaks them. We should
clamp the ->msg\_namelen value instead.
Fixes: 1661bf364ae9 ("net: heap overflow in \_\_audit\_sockaddr()")
Reported-by: Eric Wong
Signed-off-by: Dan Carpenter
Tested-by: Eric Wong
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d4cbc4a91331e0fa5819cdf4267be4f07185eef6
Author: Hannes Frederic Sowa
Date: Sat Nov 23 00:46:12 2013 +0100
inet: fix addr\_len/msg->msg\_namelen assignment in recv\_error and rxpmtu functions
[ Upstream commit 85fbaa75037d0b6b786ff18658ddf0b4014ce2a4 ]
Commit bceaa90240b6019ed73b49965eac7d167610be69 ("inet: prevent leakage
of uninitialized memory to user in recv syscalls") conditionally updated
addr\_len if the msg\_name is written to. The recv\_error and rxpmtu
functions relied on the recvmsg functions to set up addr\_len before.
As this does not happen any more we have to pass addr\_len to those
functions as well and set it to the size of the corresponding sockaddr
length.
This broke traceroute and such.
Fixes: bceaa90240b6 ("inet: prevent leakage of uninitialized memory to user in recv syscalls")
Reported-by: Brad Spengler
Reported-by: Tom Labanowski
Cc: mpb
Cc: David S. Miller
Cc: Eric Dumazet
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4d7aef1fc794bc093939f165ca5e78de7af01361
Author: Hannes Frederic Sowa
Date: Thu Nov 21 03:14:34 2013 +0100
net: add BUG\_ON if kernel advertises msg\_namelen > sizeof(struct sockaddr\_storage)
[ Upstream commit 68c6beb373955da0886d8f4f5995b3922ceda4be ]
In that case it is probable that kernel code overwrote part of the
stack. So we should bail out loudly here.
The BUG\_ON may be removed in future if we are sure all protocols are
conformant.
Suggested-by: Eric Dumazet
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0cefe287488ca07c0d7962a7b4d3fbb829d09917
Author: Hannes Frederic Sowa
Date: Thu Nov 21 03:14:22 2013 +0100
net: rework recvmsg handler msg\_name and msg\_namelen logic
[ Upstream commit f3d3342602f8bcbf37d7c46641cb9bca7618eb1c ]
This patch now always passes msg->msg\_namelen as 0. recvmsg handlers must
set msg\_namelen to the proper size <= sizeof(struct sockaddr\_storage)
to return msg\_name to the user.
This prevents numerous uninitialized memory leaks we had in the
recvmsg handlers and makes it harder for new code to accidentally leak
uninitialized memory.
Optimize for the case recvfrom is called with NULL as address. We don't
need to copy the address at all, so set it to NULL before invoking the
recvmsg handler. We can do so, because all the recvmsg handlers must
cope with the case a plain read() is called on them. read() also sets
msg\_name to NULL.
Also document these changes in include/linux/net.h as suggested by David
Miller.
Changes since RFC:
Set msg->msg\_name = NULL if user specified a NULL in msg\_name but had a
non-null msg\_namelen in verify\_iovec/verify\_compat\_iovec. This doesn't
affect sendto as it would bail out earlier while trying to copy-in the
address. It also more naturally reflects the logic by the callers of
verify\_iovec.
With this change in place I could remove "
if (!uaddr || msg\_sys->msg\_namelen == 0)
msg->msg\_name = NULL
".
This change does not alter the user visible error logic as we ignore
msg\_namelen as long as msg\_name is NULL.
Also remove two unnecessary curly brackets in \_\_\_sys\_recvmsg and change
comments to netdev style.
Cc: David Miller
Suggested-by: Eric Dumazet
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 086663e065ba2383382d6bb7d8a3d9bc9cba7cdf
Author: Hannes Frederic Sowa
Date: Mon Nov 18 07:07:45 2013 +0100
ping: prevent NULL pointer dereference on write to msg\_name
[ Upstream commit cf970c002d270c36202bd5b9c2804d3097a52da0 ]
A plain read() on a socket does set msg->msg\_name to NULL. So check for
NULL pointer first.
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7a9b8e64a5706d62d5a5ab54fe3d0320845b1d4a
Author: Hannes Frederic Sowa
Date: Mon Nov 18 04:20:45 2013 +0100
inet: prevent leakage of uninitialized memory to user in recv syscalls
[ Upstream commit bceaa90240b6019ed73b49965eac7d167610be69 ]
Only update \*addr\_len when we actually fill in sockaddr, otherwise we
can return uninitialized memory from the stack to the caller in the
recvfrom, recvmmsg and recvmsg syscalls. Drop the the (addr\_len == NULL)
checks because we only get called with a valid addr\_len pointer either
from sock\_common\_recvmsg or inet\_recvmsg.
If a blocking read waits on a socket which is concurrently shut down we
now return zero and set msg\_msgnamelen to 0.
Reported-by: mpb
Suggested-by: Eric Dumazet
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d902e2c30aeba8d9d76d9c7845f4b9833f7c336d
Author: Eric Dumazet
Date: Fri Nov 15 08:58:14 2013 -0800
pkt\_sched: fq: fix pacing for small frames
[ Upstream commit f52ed89971adbe79b6438c459814034707b8ab91 ]
For performance reasons, sch\_fq tried hard to not setup timers for every
sent packet, using a quantum based heuristic : A delay is setup only if
the flow exhausted its credit.
Problem is that application limited flows can refill their credit
for every queued packet, and they can evade pacing.
This problem can also be triggered when TCP flows use small MSS values,
as TSO auto sizing builds packets that are smaller than the default fq
quantum (3028 bytes)
This patch adds a 40 ms delay to guard flow credit refill.
Fixes: afe4fd062416 ("pkt\_sched: fq: Fair Queue packet scheduler")
Signed-off-by: Eric Dumazet
Cc: Maciej Żenczykowski
Cc: Willem de Bruijn
Cc: Yuchung Cheng
Cc: Neal Cardwell
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 8ec21820ff9714a66c17e89aad8d0fc74a357b27
Author: Eric Dumazet
Date: Fri Nov 15 08:57:26 2013 -0800
pkt\_sched: fq: warn users using defrate
[ Upstream commit 65c5189a2b57b9aa1d89e4b79da39928257c9505 ]
Commit 7eec4174ff29 ("pkt\_sched: fq: fix non TCP flows pacing")
obsoleted TCA\_FQ\_FLOW\_DEFAULT\_RATE without notice for the users.
Suggested by David Miller
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 41d5db117867708cde76f1009ca3fd52e6244559
Author: Eric Dumazet
Date: Thu Nov 14 13:37:54 2013 -0800
ipv4: fix possible seqlock deadlock
[ Upstream commit c9e9042994d37cbc1ee538c500e9da1bb9d1bcdf ]
ip4\_datagram\_connect() being called from process context,
it should use IP\_INC\_STATS() instead of IP\_INC\_STATS\_BH()
otherwise we can deadlock on 32bit arches, or get corruptions of
SNMP counters.
Fixes: 584bdf8cbdf6 ("[IPV4]: Fix "ipOutNoRoutes" counter error for TCP and UDP")
Signed-off-by: Eric Dumazet
Reported-by: Dave Jones
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ca86fc7e2f584fcf9fb33c033e9230044f15cd68
Author: Chris Metcalf
Date: Thu Nov 14 12:09:21 2013 -0500
connector: improved unaligned access error fix
[ Upstream commit 1ca1a4cf59ea343a1a70084fe7cc96f37f3cf5b1 ]
In af3e095a1fb4, Erik Jacobsen fixed one type of unaligned access
bug for ia64 by converting a 64-bit write to use put\_unaligned().
Unfortunately, since gcc will convert a short memset() to a series
of appropriately-aligned stores, the problem is now visible again
on tilegx, where the memset that zeros out proc\_event is converted
to three 64-bit stores, causing an unaligned access panic.
A better fix for the original problem is to ensure that proc\_event
is aligned to 8 bytes here. We can do that relatively easily by
arranging to start the struct cn\_msg aligned to 8 bytes and then
offset by 4 bytes. Doing so means that the immediately following
proc\_event structure is then correctly aligned to 8 bytes.
The result is that the memset() stores are now aligned, and as an
added benefit, we can remove the put\_unaligned() calls in the code.
Signed-off-by: Chris Metcalf
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 67db393568a1ab1816a1a39cbbd756611e83b31f
Author: Maciej Żenczykowski
Date: Thu Nov 14 08:50:43 2013 -0800
pkt\_sched: fq: change classification of control packets
[ Upstream commit 2abc2f070eb30ac8421554a5c32229f8332c6206 ]
Initial sch\_fq implementation copied code from pfifo\_fast to classify
a packet as a high prio packet.
This clashes with setups using PRIO with say 7 bands, as one of the
band could be incorrectly (mis)classified by FQ.
Packets would be queued in the 'internal' queue, and no pacing ever
happen for this special queue.
Fixes: afe4fd062416 ("pkt\_sched: fq: Fair Queue packet scheduler")
Signed-off-by: Maciej Żenczykowski
Signed-off-by: Eric Dumazet
Cc: Stephen Hemminger
Cc: Willem de Bruijn
Cc: Yuchung Cheng
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 06c375b4936023b32172afe8e6507579a48e2388
Author: Nicolas Dichtel
Date: Thu Nov 14 15:47:03 2013 +0100
ip6tnl: fix use after free of fb\_tnl\_dev
[ Upstream commit 1e9f3d6f1c403dd2b6270f654b4747147aa2306f ]
Bug has been introduced by commit bb8140947a24 ("ip6tnl: allow to use rtnl ops
on fb tunnel").
When ip6\_tunnel.ko is unloaded, FB device is delete by rtnl\_link\_unregister()
and then we try to use the pointer in ip6\_tnl\_destroy\_tunnels().
Let's add an handler for dellink, which will never remove the FB tunnel. With
this patch it will no more be possible to remove it via 'ip link del ip6tnl0',
but it's safer.
The same fix was already proposed by Willem de Bruijn  for
sit interfaces.
CC: Willem de Bruijn
Reported-by: Steven Rostedt
Signed-off-by: Nicolas Dichtel
Acked-by: Willem de Bruijn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c2ef4d4c0e4da81c73db598a8944fcb77bd713d9
Author: Dan Carpenter
Date: Thu Nov 14 11:21:10 2013 +0300
isdnloop: use strlcpy() instead of strcpy()
[ Upstream commit f9a23c84486ed350cce7bb1b2828abd1f6658796 ]
These strings come from a copy\_from\_user() and there is no way to be
sure they are NUL terminated.
Signed-off-by: Dan Carpenter
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 7c9c354a180ab36acfa8ca04c206042ce3d22fb4
Author: Willem de Bruijn
Date: Wed Nov 13 21:27:38 2013 -0500
sit: fix use after free of fb\_tunnel\_dev
[ Upstream commit 9434266f2c645d4fcf62a03a8e36ad8075e37943 ]
Bug: The fallback device is created in sit\_init\_net and assumed to be
freed in sit\_exit\_net. First, it is dereferenced in that function, in
sit\_destroy\_tunnels:
struct net \*net = dev\_net(sitn->fb\_tunnel\_dev);
Prior to this, rtnl\_unlink\_register has removed all devices that match
rtnl\_link\_ops == sit\_link\_ops.
Commit 205983c43700 added the line
+ sitn->fb\_tunnel\_dev->rtnl\_link\_ops = &sit\_link\_ops;
which cases the fallback device to match here and be freed before it
is last dereferenced.
Fix: This commit adds an explicit .delllink callback to sit\_link\_ops
that skips deallocation at rtnl\_unlink\_register for the fallback
device. This mechanism is comparable to the one in ip\_tunnel.
It also modifies sit\_destroy\_tunnels and its only caller sit\_exit\_net
to avoid the offending dereference in the first place. That double
lookup is more complicated than required.
Test: The bug is only triggered when CONFIG\_NET\_NS is enabled. It
causes a GPF only when CONFIG\_DEBUG\_SLAB is enabled. Verified that
this bug exists at the mentioned commit, at davem-net HEAD and at
3.11.y HEAD. Verified that it went away after applying this patch.
Fixes: 205983c43700 ("sit: allow to use rtnl ops on fb tunnel")
Signed-off-by: Willem de Bruijn
Acked-by: Nicolas Dichtel
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a9ac5b0bfce3f9777aa5e1512e5e605f61c81b3f
Author: Eric Dumazet
Date: Wed Nov 13 15:00:46 2013 -0800
net-tcp: fix panic in tcp\_fastopen\_cache\_set()
[ Upstream commit dccf76ca6b626c0c4a4e09bb221adee3270ab0ef ]
We had some reports of crashes using TCP fastopen, and Dave Jones
gave a nice stack trace pointing to the error.
Issue is that tcp\_get\_metrics() should not be called with a NULL dst
Fixes: 1fe4c481ba637 ("net-tcp: Fast Open client - cookie cache")
Signed-off-by: Eric Dumazet
Reported-by: Dave Jones
Cc: Yuchung Cheng
Acked-by: Yuchung Cheng
Tested-by: Dave Jones
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit accbc62ee04bb72ee23a96ec10b0a6a2e2260a55
Author: Nikolay Aleksandrov
Date: Wed Nov 13 17:07:46 2013 +0100
bonding: fix two race conditions in bond\_store\_updelay/downdelay
[ Upstream commit b869ccfab1e324507fa3596e3e1308444fb68227 ]
This patch fixes two race conditions between bond\_store\_updelay/downdelay
and bond\_store\_miimon which could lead to division by zero as miimon can
be set to 0 while either updelay/downdelay are being set and thus miss the
zero check in the beginning, the zero div happens because updelay/downdelay
are stored as new\_value / bond->params.miimon. Use rtnl to synchronize with
miimon setting.
CC: Jay Vosburgh
CC: Andy Gospodarek
CC: Veaceslav Falico
Signed-off-by: Nikolay Aleksandrov
Acked-by: Veaceslav Falico
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f4a5ec10024217be0a05f568eca5a93ff756df10
Author: Eric Dumazet
Date: Wed Nov 13 06:32:54 2013 -0800
tcp: tsq: restore minimal amount of queueing
[ Upstream commit 98e09386c0ef4dfd48af7ba60ff908f0d525cdee ]
After commit c9eeec26e32e ("tcp: TSQ can use a dynamic limit"), several
users reported throughput regressions, notably on mvneta and wifi
adapters.
802.11 AMPDU requires a fair amount of queueing to be effective.
This patch partially reverts the change done in tcp\_write\_xmit()
so that the minimal amount is sysctl\_tcp\_limit\_output\_bytes.
It also remove the use of this sysctl while building skb stored
in write queue, as TSO autosizing does the right thing anyway.
Users with well behaving NICS and correct qdisc (like sch\_fq),
can then lower the default sysctl\_tcp\_limit\_output\_bytes value from
128KB to 8KB.
This new usage of sysctl\_tcp\_limit\_output\_bytes permits each driver
authors to check how their driver performs when/if the value is set
to a minimum of 4KB.
Normally, line rate for a single TCP flow should be possible,
but some drivers rely on timers to perform TX completion and
too long TX completion delays prevent reaching full throughput.
Fixes: c9eeec26e32e ("tcp: TSQ can use a dynamic limit")
Signed-off-by: Eric Dumazet
Reported-by: Sujith Manoharan
Reported-by: Arnaud Ebalard
Tested-by: Sujith Manoharan
Cc: Felix Fietkau
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ebee20ff2444c1b65885ab1869001922e0a1f969
Author: Jason Wang
Date: Wed Nov 13 14:00:40 2013 +0800
macvtap: limit head length of skb allocated
[ Upstream commit 16a3fa28630331e28208872fa5341ce210b901c7 ]
We currently use hdr\_len as a hint of head length which is advertised by
guest. But when guest advertise a very big value, it can lead to an 64K+
allocating of kmalloc() which has a very high possibility of failure when host
memory is fragmented or under heavy stress. The huge hdr\_len also reduce the
effect of zerocopy or even disable if a gso skb is linearized in guest.
To solves those issues, this patch introduces an upper limit (PAGE\_SIZE) of the
head, which guarantees an order 0 allocation each time.
Cc: Stefan Hajnoczi
Cc: Michael S. Tsirkin
Signed-off-by: Jason Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d485b5173b10de877781e6cabf39bee3f0bca5dc
Author: Jason Wang
Date: Wed Nov 13 14:00:39 2013 +0800
tuntap: limit head length of skb allocated
[ Upstream commit 96f8d9ecf227638c89f98ccdcdd50b569891976c ]
We currently use hdr\_len as a hint of head length which is advertised by
guest. But when guest advertise a very big value, it can lead to an 64K+
allocating of kmalloc() which has a very high possibility of failure when host
memory is fragmented or under heavy stress. The huge hdr\_len also reduce the
effect of zerocopy or even disable if a gso skb is linearized in guest.
To solves those issues, this patch introduces an upper limit (PAGE\_SIZE) of the
head, which guarantees an order 0 allocation each time.
Cc: Stefan Hajnoczi
Cc: Michael S. Tsirkin
Signed-off-by: Jason Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit cec2b41aaf8da29ca3bb2a56a1cd67c6675ed60f
Author: Jukka Rissanen
Date: Wed Nov 13 11:03:39 2013 +0200
6lowpan: Uncompression of traffic class field was incorrect
[ Upstream commit 1188f05497e7bd2f2614b99c54adfbe7413d5749 ]
If priority/traffic class field in IPv6 header is set (seen when
using ssh), the uncompression sets the TC and Flow fields incorrectly.
Example:
This is IPv6 header of a sent packet. Note the priority/TC (=1) in
the first byte.
00000000: 61 00 00 00 00 2c 06 40 fe 80 00 00 00 00 00 00
00000010: 02 02 72 ff fe c6 42 10 fe 80 00 00 00 00 00 00
00000020: 02 1e ab ff fe 4c 52 57
This gets compressed like this in the sending side
00000000: 72 31 04 06 02 1e ab ff fe 4c 52 57 ec c2 00 16
00000010: aa 2d fe 92 86 4e be c6 ....
In the receiving end, the packet gets uncompressed to this
IPv6 header
00000000: 60 06 06 02 00 2a 1e 40 fe 80 00 00 00 00 00 00
00000010: 02 02 72 ff fe c6 42 10 fe 80 00 00 00 00 00 00
00000020: ab ff fe 4c 52 57 ec c2
First four bytes are set incorrectly and we have also lost
two bytes from destination address.
The fix is to switch the case values in switch statement
when checking the TC field.
Signed-off-by: Jukka Rissanen
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c7cf12c15986f580ce4f75ebbcbb8659eb96a506
Author: Alexei Starovoitov
Date: Tue Nov 12 14:39:13 2013 -0800
core/dev: do not ignore dmac in dev\_forward\_skb()
[ Upstream commit 81b9eab5ebbf0d5d54da4fc168cfb02c2adc76b8 ]
commit 06a23fe31ca3
("core/dev: set pkt\_type after eth\_type\_trans() in dev\_forward\_skb()")
and refactoring 64261f230a91
("dev: move skb\_scrub\_packet() after eth\_type\_trans()")
are forcing pkt\_type to be PACKET\_HOST when skb traverses veth.
which means that ip forwarding will kick in inside netns
even if skb->eth->h\_dest != dev->dev\_addr
Fix order of eth\_type\_trans() and skb\_scrub\_packet() in dev\_forward\_skb()
and in ip\_tunnel\_rcv()
Fixes: 06a23fe31ca3 ("core/dev: set pkt\_type after eth\_type\_trans() in dev\_forward\_skb()")
CC: Isaku Yamahata
CC: Maciej Zenczykowski
CC: Nicolas Dichtel
Signed-off-by: Alexei Starovoitov
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit db6b5bf758051d320b6b3363ddd515760010e527
Author: Felix Fietkau
Date: Tue Nov 12 16:34:41 2013 +0100
usbnet: fix status interrupt urb handling
[ Upstream commit 52f48d0d9aaa621ffa5e08d79da99a3f8c93b848 ]
Since commit 7b0c5f21f348a66de495868b8df0284e8dfd6bbf
"sierra\_net: keep status interrupt URB active", sierra\_net triggers
status interrupt polling before the net\_device is opened (in order to
properly receive the sync message response).
To be able to receive further interrupts, the interrupt urb needs to be
re-submitted, so this patch removes the bogus check for netif\_running().
Signed-off-by: Felix Fietkau
Tested-by: Dan Williams
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 24e9fcb4cf4653bc4142fd05f3a87dc42f31375a
Author: Veaceslav Falico
Date: Tue Nov 12 15:37:40 2013 +0100
bonding: don't permit to use ARP monitoring in 802.3ad mode
[ Upstream commit ec9f1d15db8185f63a2c3143dc1e90ba18541b08 ]
Currently the ARP monitoring is not supported with 802.3ad, and it's
prohibited to use it via the module params.
However we still can set it afterwards via sysfs, cause we only check for
\*LB modes there.
To fix this - add a check for 802.3ad mode in bonding\_store\_arp\_interval.
CC: Jay Vosburgh
CC: Andy Gospodarek
Signed-off-by: Veaceslav Falico
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d8b3693c2e8727131f4bc0c2b6000e7f563064fb
Author: Daniel Borkmann
Date: Mon Nov 11 12:20:32 2013 +0100
random32: fix off-by-one in seeding requirement
[ Upstream commit 51c37a70aaa3f95773af560e6db3073520513912 ]
For properly initialising the Tausworthe generator [1], we have
a strict seeding requirement, that is, s1 > 1, s2 > 7, s3 > 15.
Commit 697f8d0348 ("random32: seeding improvement") introduced
a \_\_seed() function that imposes boundary checks proposed by the
errata paper [2] to properly ensure above conditions.
However, we're off by one, as the function is implemented as:
"return (x < m) ? x + m : x;", and called with \_\_seed(X, 1),
\_\_seed(X, 7), \_\_seed(X, 15). Thus, an unwanted seed of 1, 7, 15
would be possible, whereas the lower boundary should actually
be of at least 2, 8, 16, just as GSL does. Fix this, as otherwise
an initialization with an unwanted seed could have the effect
that Tausworthe's PRNG properties cannot not be ensured.
Note that this PRNG is \*not\* used for cryptography in the kernel.
[1] http://www.iro.umontreal.ca/~lecuyer/myftp/papers/tausme.ps
[2] http://www.iro.umontreal.ca/~lecuyer/myftp/papers/tausme2.ps
Joint work with Hannes Frederic Sowa.
Fixes: 697f8d0348a6 ("random32: seeding improvement")
Cc: Stephen Hemminger
Cc: Florian Weimer
Cc: Theodore Ts'o
Signed-off-by: Daniel Borkmann
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 520e356e35b44957d5578a43e517ac1162141494
Author: Hannes Frederic Sowa
Date: Fri Nov 8 19:26:21 2013 +0100
ipv6: protect for\_each\_sk\_fl\_rcu in mem\_check with rcu\_read\_lock\_bh
[ Upstream commit f8c31c8f80dd882f7eb49276989a4078d33d67a7 ]
Fixes a suspicious rcu derference warning.
Cc: Florent Fourcot
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b379b19eb856b6a1d1e88007a930834417a96b11
Author: Duan Jiong
Date: Fri Nov 8 09:56:53 2013 +0800
ipv6: use rt6\_get\_dflt\_router to get default router in rt6\_route\_rcv
[ Upstream commit f104a567e673f382b09542a8dc3500aa689957b4 ]
As the rfc 4191 said, the Router Preference and Lifetime values in a
::/0 Route Information Option should override the preference and lifetime
values in the Router Advertisement header. But when the kernel deals with
a ::/0 Route Information Option, the rt6\_get\_route\_info() always return
NULL, that means that overriding will not happen, because those default
routers were added without flag RTF\_ROUTEINFO in rt6\_add\_dflt\_router().
In order to deal with that condition, we should call rt6\_get\_dflt\_router
when the prefix length is 0.
Signed-off-by: Duan Jiong
Acked-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 62e4ad5a4d690c688aa776ab8c264362d4c2f4fc
Author: Andreas Henriksson
Date: Thu Nov 7 18:26:38 2013 +0100
net: Fix "ip rule delete table 256"
[ Upstream commit 13eb2ab2d33c57ebddc57437a7d341995fc9138c ]
When trying to delete a table >= 256 using iproute2 the local table
will be deleted.
The table id is specified as a netlink attribute when it needs more then
8 bits and iproute2 then sets the table field to RT\_TABLE\_UNSPEC (0).
Preconditions to matching the table id in the rule delete code
doesn't seem to take the "table id in netlink attribute" into condition
so the frh\_get\_table helper function never gets to do its job when
matching against current rule.
Use the helper function twice instead of peaking at the table value directly.
Originally reported at: http://bugs.debian.org/724783
Reported-by: Nicolas HICHER
Signed-off-by: Andreas Henriksson
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ef06eb9f5076739ed146d74dcdd307daffcc163a
Author: Amir Vadai
Date: Thu Nov 7 11:08:30 2013 +0200
net/mlx4\_en: Fixed crash when port type is changed
[ Upstream commit 1ec4864b10171b0691ee196d7006ae56d2c153f2 ]
timecounter\_init() was was called only after first potential
timecounter\_read().
Moved mlx4\_en\_init\_timestamp() before mlx4\_en\_init\_netdev()
Signed-off-by: Amir Vadai
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 632394c5b26feb80f114a0fc7e9a3e01d464d9ac
Author: Andrey Vagin
Date: Thu Nov 7 08:35:12 2013 +0400
net: x86: bpf: don't forget to free sk\_filter (v2)
[ Upstream commit 98bbc06aabac5a2dcc46580d20c59baf8ebe479f ]
sk\_filter isn't freed if bpf\_func is equal to sk\_run\_filter.
This memory leak was introduced by v3.12-rc3-224-gd45ed4a4
"net: fix unsafe set\_memory\_rw from softirq".
Before this patch sk\_filter was freed in sk\_filter\_release\_rcu,
now it should be freed in bpf\_jit\_free.
Here is output of kmemleak:
unreferenced object 0xffff8800b774eab0 (size 128):
comm "systemd", pid 1, jiffies 4294669014 (age 124.062s)
hex dump (first 32 bytes):
00 00 00 00 0b 00 00 00 20 63 7f b7 00 88 ff ff ........ c......
60 d4 55 81 ff ff ff ff 30 d9 55 81 ff ff ff ff `.U.....0.U.....
backtrace:
[] kmemleak\_alloc+0x4e/0xb0
[] \_\_kmalloc+0xef/0x260
[] sock\_kmalloc+0x38/0x60
[] sk\_attach\_filter+0x5d/0x190
[] sock\_setsockopt+0x991/0x9e0
[] SyS\_setsockopt+0xb6/0xd0
[] system\_call\_fastpath+0x16/0x1b
[] 0xffffffffffffffff
v2: add extra { } after else
Fixes: d45ed4a4e33a ("net: fix unsafe set\_memory\_rw from softirq")
Acked-by: Daniel Borkmann
Cc: Alexei Starovoitov
Cc: Eric Dumazet
Cc: "David S. Miller"
Signed-off-by: Andrey Vagin
Acked-by: Alexei Starovoitov
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 6281cb601b21207cde24e0c5b43a3da56227b21d
Author: Veaceslav Falico
Date: Sat Sep 28 21:18:56 2013 +0200
bonding: RCUify bond\_set\_rx\_mode()
[ Upstream commit b32418705107265dfca5edfe2b547643e53a732e ]
Currently we rely on rtnl locking in bond\_set\_rx\_mode(), however it's not
always the case:
RTNL: assertion failed at drivers/net/bonding/bond\_main.c (3391)
...
[] dump\_stack+0x54/0x74
[] bond\_set\_rx\_mode+0xc7/0xd0 [bonding]
[] \_\_dev\_set\_rx\_mode+0x57/0xa0
[] \_\_dev\_mc\_add+0x58/0x70
[] dev\_mc\_add+0x10/0x20
[] igmp6\_group\_added+0x18e/0x1d0
[] ? kmem\_cache\_alloc\_trace+0x236/0x260
[] ipv6\_dev\_mc\_inc+0x29f/0x320
[] ipv6\_sock\_mc\_join+0x157/0x260
...
Fix this by using RCU primitives.
Reported-by: Joe Lawrence
Tested-by: Joe Lawrence
CC: Jay Vosburgh
CC: Andy Gospodarek
Signed-off-by: Veaceslav Falico
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d68268e60d0ec51e6c269f8dc34bb9fcfee970a7
Author: Hannes Frederic Sowa
Date: Tue Nov 5 02:41:27 2013 +0100
ipv6: fix headroom calculation in udp6\_ufo\_fragment
[ Upstream commit 0e033e04c2678dbbe74a46b23fffb7bb918c288e ]
Commit 1e2bd517c108816220f262d7954b697af03b5f9c ("udp6: Fix udp
fragmentation for tunnel traffic.") changed the calculation if
there is enough space to include a fragment header in the skb from a
skb->mac\_header dervived one to skb\_headroom. Because we already peeled
off the skb to transport\_header this is wrong. Change this back to check
if we have enough room before the mac\_header.
This fixes a panic Saran Neti reported. He used the tbf scheduler which
skb\_gso\_segments the skb. The offsets get negative and we panic in memcpy
because the skb was erroneously not expanded at the head.
Reported-by: Saran Neti
Cc: Pravin B Shelar
Signed-off-by: Hannes Frederic Sowa
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4b2867325d676b875154dbe0da8f3c4954dcaacc
Author: Dan Carpenter
Date: Wed Nov 13 10:52:47 2013 +0300
net: mv643xx\_eth: potential NULL dereference in probe()
upstream commit 6115c11fe1a5a636ac99fc823b00df4ff3c0674e
We assume that "mp->phy" can be NULL a couple lines before the
dereference.
Fixes: 1cce16d37d0f ('net: mv643xx\_eth: Add missing phy\_addr\_set in DT mode')
Signed-off-by: Dan Carpenter
Acked-by: Sebastian Hesselbarth
Acked-by: Jason Gunthorpe
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit db4968268ffaf57aa36950073b8f24ccb9e186df
Author: Jason Gunthorpe
Date: Mon Nov 4 17:27:19 2013 -0700
net: mv643xx\_eth: Add missing phy\_addr\_set in DT mode
Commit cc9d4598 'net: mv643xx\_eth: use of\_phy\_connect if phy\_node
present' made the call to phy\_scan optional, if the DT has a link to
the phy node.
However phy\_scan has the side effect of calling phy\_addr\_set, which
writes the phy MDIO address to the ethernet controller. If phy\_addr\_set
is not called, and the bootloader has not set the correct address then
the driver will fail to function.
Tested on Kirkwood.
Signed-off-by: Jason Gunthorpe
Acked-by: Sebastian Hesselbarth
Tested-by: Arnaud Ebalard
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman


=== Content from github.com_8e54cb01_20250126_021144.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-fw6g-56pg-38xh)

**CVE-2013-6432**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-fw6g-56pg-38xh)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [Unreviewed](/advisories?query=type%3Aunreviewed)
3. [CVE-2013-6432](/advisories/GHSA-fw6g-56pg-38xh)

## The ping\_recvmsg function in net/ipv4/ping.c in the Linux...

Moderate severity

Unreviewed

Published
May 17, 2022
to the GitHub Advisory Database
•
Updated Feb 13, 2023

## Package

No package listed—
[Suggest a package](/advisories/GHSA-fw6g-56pg-38xh/improve)

## Affected versions

Unknown

## Patched versions

Unknown

## Description

The ping\_recvmsg function in net/ipv4/ping.c in the Linux kernel before 3.12.4 does not properly interact with read system calls on ping sockets, which allows local users to cause a denial of service (NULL pointer dereference and system crash) by leveraging unspecified privileges to execute a crafted application.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2013-6432>
* [torvalds/linux@cf970c0](https://github.com/torvalds/linux/commit/cf970c002d270c36202bd5b9c2804d3097a52da0)
* <https://bugzilla.redhat.com/show_bug.cgi?id=1039046>
* <http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=cf970c002d270c36202bd5b9c2804d3097a52da0>
* <http://lists.opensuse.org/opensuse-security-announce/2014-02/msg00003.html>
* <http://www.kernel.org/pub/linux/kernel/v3.x/ChangeLog-3.12.4>
* <http://www.openwall.com/lists/oss-security/2013/12/06/6>
* <http://www.ubuntu.com/usn/USN-2113-1>
* <http://www.ubuntu.com/usn/USN-2117-1>
* <http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git%3Ba=commit%3Bh=cf970c002d270c36202bd5b9c2804d3097a52da0>

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2013-6432)
Dec 9, 2013

Published to the GitHub Advisory Database
May 17, 2022

Last updated
Feb 13, 2023

### Severity

Moderate

### EPSS score

0.042%

# Exploit Prediction Scoring System (EPSS)

This score estimates the probability of this vulnerability being exploited within the next 30 days.
Data provided by [FIRST](https://www.first.org/epss/user-guide).

 (5th percentile)

### Weaknesses

No CWEs

### CVE ID

CVE-2013-6432

### GHSA ID

GHSA-fw6g-56pg-38xh

### Source code

No known source code

Dependabot alerts are not supported on this advisory because it does not have a package from a supported ecosystem with an affected and fixed version.

[Learn more about GitHub language support](https://docs.github.com/get-started/learning-about-github/github-language-support#about-supported-languages)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-fw6g-56pg-38xh/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugzilla.novell.com_1f733916_20250126_021138.html ===




=== Content from bugzilla.novell.com_62d14315_20250126_021141.html ===




=== Content from www.ubuntu.com_026fd7e7_20250124_162447.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2113-1: Linux kernel (Saucy HWE) vulnerabilities

18 February 2014

Several security issues were fixed in the kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [linux-lts-saucy](/security/cves?package=linux-lts-saucy) - Linux hardware enablement kernel from Saucy

## Details

Saran Neti reported a flaw in the ipv6 UDP Fragmentation Offload (UFI) in

the Linux kernel. A remote attacker could exploit this flaw to cause a

denial of service (panic). ([CVE-2013-4563](/security/CVE-2013-4563))

Mathy Vanhoef discovered an error in the the way the ath9k driver was

handling the BSSID masking. A remote attacker could exploit this error to

discover the original MAC address after a spoofing atack. ([CVE-2013-4579](/security/CVE-2013-4579))

Andrew Honig reported a flaw in the Linux Kernel's kvm\_vm\_ioctl\_create\_vcpu

function of the Kernel Virtual Machine (KVM) subsystem. A local user could

exploit this flaw to gain privileges on the host machine. ([CVE-2013-4587](/security/CVE-2013-4587))

Andrew Honig reported a flaw in the apic\_get\_tmcct function of the Kernel

Virtual Machine (KVM) subsystem if the Linux kernel. A guest OS user could

exploit this flaw to cause a denial of service or host OS system crash.

([CVE-2013-6367](/security/CVE-2013-6367))

Andrew Honig reported an error in the Linux Kernel's Kernel Virtual Machine

(KVM) VAPIC synchronization operation. A local user could exploit this flaw

to gain privileges or cause a denial of service (system crash).

([CVE-2013-6368](/security/CVE-2013-6368))

Lars Bull discovered a flaw in the recalculate\_apic\_map function of the

Kernel Virtual Machine (KVM) subsystem in the Linux kernel. A guest OS user

could exploit this flaw to cause a denial of service (host OS crash).

([CVE-2013-6376](/security/CVE-2013-6376))

Nico Golde and Fabian Yamaguchi reported buffer underflow errors in the

implementation of the XFS filesystem in the Linux kernel. A local user with

CAP\_SYS\_ADMIN could exploit these flaw to cause a denial of service (memory

corruption) or possibly other unspecified issues. ([CVE-2013-6382](/security/CVE-2013-6382))

A flaw was discovered in the ipv4 ping\_recvmsg function of the Linux

kernel. A local user could exploit this flaw to cause a denial of service

(NULL pointer dereference and system crash). ([CVE-2013-6432](/security/CVE-2013-6432))

mpd reported an information leak in the recvfrom, recvmmsg, and recvmsg

system calls in the Linux kernel. An unprivileged local user could exploit

this flaw to obtain sensitive information from kernel stack memory.

([CVE-2013-7263](/security/CVE-2013-7263))

mpb reported an information leak in the Layer Two Tunneling Protocol (l2tp)

of the Linux kernel. A local user could exploit this flaw to obtain

sensitive information from kernel stack memory. ([CVE-2013-7264](/security/CVE-2013-7264))

mpb reported an information leak in the Phone Network protocol (phonet) in

the Linux kernel. A local user could exploit this flaw to obtain sensitive

information from kernel stack memory. ([CVE-2013-7265](/security/CVE-2013-7265))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with ISDN sockets in the Linux kernel. A local user

could exploit this leak to obtain potentially sensitive information from

kernel memory. ([CVE-2013-7266](/security/CVE-2013-7266))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with apple talk sockets in the Linux kernel. A local

user could exploit this leak to obtain potentially sensitive information

from kernel memory. ([CVE-2013-7267](/security/CVE-2013-7267))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with ipx protocol sockets in the Linux kernel. A

local user could exploit this leak to obtain potentially sensitive

information from kernel memory. ([CVE-2013-7268](/security/CVE-2013-7268))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with the netrom address family in the Linux kernel. A

local user could exploit this leak to obtain potentially sensitive

information from kernel memory. ([CVE-2013-7269](/security/CVE-2013-7269))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with packet address family sockets in the Linux

kernel. A local user could exploit this leak to obtain potentially

sensitive information from kernel memory. ([CVE-2013-7270](/security/CVE-2013-7270))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with x25 protocol sockets in the Linux kernel. A

local user could exploit this leak to obtain potentially sensitive

information from kernel memory. ([CVE-2013-7271](/security/CVE-2013-7271))

mpb reported an information leak in the Low-Rate Wireless Personal Area

Networks support (IEEE 802.15.4) in the Linux kernel. A local user could

exploit this flaw to obtain sensitive information from kernel stack memory.

([CVE-2013-7281](/security/CVE-2013-7281))

A flaw was discovered in the Reliable Datagram Sockets (RDS) protocol

implementation in the Linux kernel for systems that lack RDS transports. An

unprivileged local user could exploit this flaw to cause a denial of

service (system crash). ([CVE-2013-7339](/security/CVE-2013-7339))

halfdog reported an error in the AMD K7 and K8 platform support in the

Linux kernel. An unprivileged local user could exploit this flaw on AMD

based systems to cause a denial of service (task kill) or possibly gain

privileges via a crafted application. ([CVE-2014-1438](/security/CVE-2014-1438))

An information leak was discovered in the Linux kernel's hamradio YAM

driver for AX.25 packet radio. A local user with the CAP\_NET\_ADMIN

capability could exploit this flaw to obtain sensitive information from

kernel memory. ([CVE-2014-1446](/security/CVE-2014-1446))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [linux-image-3.11.0-17-generic](https://launchpad.net/ubuntu/%2Bsource/linux-lts-saucy)
  -
  [3.11.0-17.31~precise1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-saucy/3.11.0-17.31~precise1)
* [linux-image-3.11.0-17-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-lts-saucy)
  -
  [3.11.0-17.31~precise1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-saucy/3.11.0-17.31~precise1)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2013-4563](/security/CVE-2013-4563)
* [CVE-2013-4579](/security/CVE-2013-4579)
* [CVE-2013-4587](/security/CVE-2013-4587)
* [CVE-2013-6367](/security/CVE-2013-6367)
* [CVE-2013-6368](/security/CVE-2013-6368)
* [CVE-2013-6376](/security/CVE-2013-6376)
* [CVE-2013-6382](/security/CVE-2013-6382)
* [CVE-2013-6432](/security/CVE-2013-6432)
* [CVE-2013-7263](/security/CVE-2013-7263)
* [CVE-2013-7264](/security/CVE-2013-7264)
* [CVE-2013-7265](/security/CVE-2013-7265)
* [CVE-2013-7266](/security/CVE-2013-7266)
* [CVE-2013-7267](/security/CVE-2013-7267)
* [CVE-2013-7268](/security/CVE-2013-7268)
* [CVE-2013-7269](/security/CVE-2013-7269)
* [CVE-2013-7270](/security/CVE-2013-7270)
* [CVE-2013-7271](/security/CVE-2013-7271)
* [CVE-2013-7281](/security/CVE-2013-7281)
* [CVE-2013-7339](/security/CVE-2013-7339)
* [CVE-2014-1438](/security/CVE-2014-1438)
* [CVE-2014-1446](/security/CVE-2014-1446)

## Related notices

* [USN-2117-1](/security/notices/USN-2117-1)
* [USN-2138-1](/security/notices/USN-2138-1)
* [USN-2136-1](/security/notices/USN-2136-1)
* [USN-2139-1](/security/notices/USN-2139-1)
* [USN-2134-1](/security/notices/USN-2134-1)
* [USN-2141-1](/security/notices/USN-2141-1)
* [USN-2135-1](/security/notices/USN-2135-1)
* [USN-2133-1](/security/notices/USN-2133-1)
* [USN-2129-1](/security/notices/USN-2129-1)
* [USN-2110-1](/security/notices/USN-2110-1)
* [USN-2128-1](/security/notices/USN-2128-1)
* [USN-2109-1](/security/notices/USN-2109-1)
* [USN-2158-1](/security/notices/USN-2158-1)
* [USN-2108-1](/security/notices/USN-2108-1)
* [USN-2107-1](/security/notices/USN-2107-1)
* [USN-2220-1](/security/notices/USN-2220-1)
* [USN-2219-1](/security/notices/USN-2219-1)
* [USN-2234-1](/security/notices/USN-2234-1)
* [USN-2233-1](/security/notices/USN-2233-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from www.openwall.com_8b7df835_20250124_162445.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](5) [[next>]](7) [[<thread-prev]](4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <52A21AEB.5080203@redhat.com>
Date: Fri, 06 Dec 2013 11:43:55 -0700
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
Subject: Re: CVE request: Kernel: ping: NULL pointer dereference
 on write to msg_name

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 12/06/2013 07:01 AM, Vasily Kulikov wrote:
> Hi,
>
> On Fri, Dec 06, 2013 at 19:13 +0530, P J P wrote:
>> Linux kernel built with the TCP/IP networking support(CONFIG_NET)
>> is vulnerable to a NULL pointer dereference flaw. It could occur
>> via a plain read(2) call on a ping socket. Usage of ping sockets
>> is generally restricted to privileged users.
>>
>> A user/program able to read from ping sockets could use this flaw
>> to crash a system resulting in DoS.
>>
>> Upstream fix: ------------- ->
>> <https://git.kernel.org/linus/cf970c002d270c36202bd5b9c2804d3097a52da0>
>>
>>
>>
Reference:
>> ---------- ->
>> <https://bugzilla.redhat.com/show_bug.cgi?id=1039046>
>
> The bug was introduced with ping6 sockets implementation in:
>
> <https://git.kernel.org/linus/6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67>
>
>  Thanks,

Please use CVE-2013-6432 for this issue.

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.15 (GNU/Linux)

iQIcBAEBAgAGBQJSohrrAAoJEBYNRVNeJnmT1ecQAJWe9HwJpAqrLECRlH7WfKQ4
fCdBn7NtbJDfEJiLrWEPL6VRh/kRGUQwWmT3ZgfBmz8xRBYUSPmt7mMJL8ruf7k5
S9NDS1rv0OPiIivCc73+g36Tk2TPG27FET2y2pEIwnln80zVm4zc0uhM6aFR3gG9
Bs17kw3+L9jRronXncoM6VR8X4BEg5Aydg23cqnuGbYAZDoX5YeGQhQV29ooGgjN
ZE9C3xjzfSw9JhgIBMncID1iQt0F0YP8hcjyIJw8cnRVb+FbEY98TkRopSWufxhM
pnZJmUKoyCl8qm2Kb72IZQlm9Wt6veABdf5LOleLHlJfk1MadYyEZdM/cEHOHjgC
2GprLuF4p/UJkm+t7Z9XySWnG2bWMurDJWM773379qYmOpJ1QC1CqAM1RHIQuHBy
yaqAGvEP4HXgHjWkeIEaxloKsTh04fFRnlKr/+hquKcdew6zvy74VuqiOKyRGKxr
5x07k4JpkQt2C8ZxJOUfCc8ZqZVqdmbaxixwKMO1KTZYD4fxn+5BmFWkG4b3fKya
J9zlJ+iQMzguWwh0IYIVgvKDmBmMSYau51bSN4n4gV+/YdBuIHyTc/ViSLSHqgNO
xPsB7i0ThTcN6wpfDHXAPNDRuEpZjgfroGlh55tdkvEUrNmZm411OojjbkM0biGa
NbeYrvJcCaf+1C3kj3jB
=/c5r
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from docs.github.com_332f0a88_20250126_021143.html ===
[Skip to main content](#main-content)[GitHub Docs](/en)Version: Free, Pro, & TeamSearch GitHub DocsSearchSelect language: current language is EnglishOpen Search BarClose Search BarOpen MenuOpen Sidebar

* [Building communities](/en/communities "Building communities")/
* [Moderation](/en/communities/moderating-comments-and-conversations "Moderation")/
* [Manage comments](/en/communities/moderating-comments-and-conversations/managing-disruptive-comments "Manage comments")
[Home](/en)[Building communities](/en/communities)

* Healthy contributions
  + [Management & moderation](/en/communities/setting-up-your-project-for-healthy-contributions/about-community-management-and-moderation)
  + [Community profiles](/en/communities/setting-up-your-project-for-healthy-contributions/about-community-profiles-for-public-repositories)
  + [Access community profiles](/en/communities/setting-up-your-project-for-healthy-contributions/accessing-a-projects-community-profile)
  + [Add a code of conduct](/en/communities/setting-up-your-project-for-healthy-contributions/adding-a-code-of-conduct-to-your-project)
  + [Contributor guidelines](/en/communities/setting-up-your-project-for-healthy-contributions/setting-guidelines-for-repository-contributors)
  + [Add a license to a repo](/en/communities/setting-up-your-project-for-healthy-contributions/adding-a-license-to-a-repository)
  + [Add support resources](/en/communities/setting-up-your-project-for-healthy-contributions/adding-support-resources-to-your-project)
  + [Community health file](/en/communities/setting-up-your-project-for-healthy-contributions/creating-a-default-community-health-file)
  + [Encourage contributions](/en/communities/setting-up-your-project-for-healthy-contributions/encouraging-helpful-contributions-to-your-project-with-labels)
* Issue & PR templates
  + [About templates](/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/about-issue-and-pull-request-templates)
  + [Configure](/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/configuring-issue-templates-for-your-repository)
  + [Syntax for issue forms](/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/syntax-for-issue-forms)
  + [Syntax for GitHub's form schema](/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/syntax-for-githubs-form-schema)
  + [Create a PR template](/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/creating-a-pull-request-template-for-your-repository)
  + [Create an issue template](/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/manually-creating-a-single-issue-template-for-your-repository)
  + [Common validation errors when creating issue forms](/en/communities/using-templates-to-encourage-useful-issues-and-pull-requests/common-validation-errors-when-creating-issue-forms)
* Moderation
  + [Manage comments](/en/communities/moderating-comments-and-conversations/managing-disruptive-comments)
  + [Locking conversations](/en/communities/moderating-comments-and-conversations/locking-conversations)
  + [Limit interactions in repo](/en/communities/moderating-comments-and-conversations/limiting-interactions-in-your-repository)
  + [Limit interactions in account](/en/communities/moderating-comments-and-conversations/limiting-interactions-for-your-personal-account)
  + [Limit interactions in org](/en/communities/moderating-comments-and-conversations/limiting-interactions-in-your-organization)
  + [Track comment changes](/en/communities/moderating-comments-and-conversations/tracking-changes-in-a-comment)
  + [Manage abuse in your org](/en/communities/moderating-comments-and-conversations/managing-how-contributors-report-abuse-in-your-organizations-repository)
  + [Manage reported content](/en/communities/moderating-comments-and-conversations/managing-reported-content-in-your-organizations-repository)
* Maintaining safety
  + [Block from your account](/en/communities/maintaining-your-safety-on-github/blocking-a-user-from-your-personal-account)
  + [View blocked users in account](/en/communities/maintaining-your-safety-on-github/viewing-users-youve-blocked-from-your-personal-account)
  + [Unblock from your account](/en/communities/maintaining-your-safety-on-github/unblocking-a-user-from-your-personal-account)
  + [Block from your org](/en/communities/maintaining-your-safety-on-github/blocking-a-user-from-your-organization)
  + [View blocked users in org](/en/communities/maintaining-your-safety-on-github/viewing-users-who-are-blocked-from-your-organization)
  + [Unblock from your org](/en/communities/maintaining-your-safety-on-github/unblocking-a-user-from-your-organization)
  + [Reporting abuse or spam](/en/communities/maintaining-your-safety-on-github/reporting-abuse-or-spam)
* Using wikis
  + [About wikis](/en/communities/documenting-your-project-with-wikis/about-wikis)
  + [Manage wiki pages](/en/communities/documenting-your-project-with-wikis/adding-or-editing-wiki-pages)
  + [Create footer or sidebar](/en/communities/documenting-your-project-with-wikis/creating-a-footer-or-sidebar-for-your-wiki)
  + [Editing wiki content](/en/communities/documenting-your-project-with-wikis/editing-wiki-content)
  + [View a history of changes](/en/communities/documenting-your-project-with-wikis/viewing-a-wikis-history-of-changes)
  + [Change access permissions](/en/communities/documenting-your-project-with-wikis/changing-access-permissions-for-wikis)
  + [Disabling wikis](/en/communities/documenting-your-project-with-wikis/disabling-wikis)

* [Building communities](/en/communities "Building communities")/
* [Moderation](/en/communities/moderating-comments-and-conversations "Moderation")/
* [Manage comments](/en/communities/moderating-comments-and-conversations/managing-disruptive-comments "Manage comments")
# Managing disruptive comments

You can hide, edit, or delete comments on issues, pull requests, and commits.

## In this article

* [Hiding a comment](#hiding-a-comment)
* [Unhiding a comment](#unhiding-a-comment)
* [Editing a comment](#editing-a-comment)
* [Redacting sensitive information](#redacting-sensitive-information)
* [Deleting a comment](#deleting-a-comment)
* [Further reading](#further-reading)
## [Hiding a comment](#hiding-a-comment)

Organization moderators, and anyone with write access to a repository, can hide comments on issues, pull requests, and commits.

If a comment is off-topic, outdated, or resolved, you may want to hide a comment to keep a discussion focused or make a pull request easier to navigate and review. Hidden comments are minimized but people with read access to the repository can expand them.

![Screenshot of a hidden comment. The only visible content is "This comment has been minimized", with a button to show the comment.](/assets/cb-13766/images/help/repository/hidden-comment.png)

1. Navigate to the comment you'd like to hide.
2. In the upper-right corner of the comment, click , then click **Hide**.

   ![Screenshot of a pull request comment by octo-user. Below an icon of three dots, a dropdown menu is expanded, and "Hide" is outlined in orange.](/assets/cb-42438/images/help/repository/comment-menu-hide.png)
3. Using the "Choose a reason" dropdown menu, choose a reason to hide the comment. Then select **Hide comment**.

   ![Screenshot of a comment showing a menu to select a reason to hide the comment: Spam, Abuse, Off Topic, Outdated, Duplicate, or Resolved.](/assets/cb-67538/images/help/repository/choose-reason-for-hiding-comment.png)

## [Unhiding a comment](#unhiding-a-comment)

Organization moderators, and anyone with write access to a repository, can unhide comments on issues, pull requests, and commits.

1. Navigate to the comment you'd like to unhide.
2. On the right side of the comment, click  **Show comment**.
3. On the right side of the expanded comment, select the  dropdown menu, then click **Unhide**.

   ![Screenshot of a pull request comment marked as spam. Below an icon of three dots, a dropdown menu is expanded, and "Unhide" is outlined in orange.](/assets/cb-50118/images/help/repository/comment-menu-hidden.png)

## [Editing a comment](#editing-a-comment)

Anyone with write access to a repository can edit comments on issues, pull requests, and commits.

It's appropriate to edit a comment and remove content that doesn't contribute to the conversation and violates your community's code of conduct or GitHub's [Community Guidelines](/en/site-policy/github-terms/github-community-guidelines).

Sometimes it may make sense to clearly indicate edits and their justification.

That said, anyone with read access to a repository can view a comment's edit history. The **edited** dropdown at the top of the comment contains a history of edits showing the user and timestamp for each edit.

![Screenshot of a comment by octo-user, which is partially redacted. In the header, next to "edited by octocat", a dropdown icon is outlined in orange.](/assets/cb-42069/images/help/repository/content-redacted-comment.png)

## [Redacting sensitive information](#redacting-sensitive-information)

Comment authors and anyone with write access to a repository can also delete sensitive information from a comment's edit history. For more information, see [Tracking changes in a comment](/en/communities/moderating-comments-and-conversations/tracking-changes-in-a-comment).

1. Navigate to the comment you'd like to edit.
2. In the upper-right corner of the comment, click , then click **Edit**.

   ![Screenshot of a pull request comment by octo-user. Below an icon of three dots, a dropdown menu is expanded, and "Edit" is outlined in orange.](/assets/cb-42473/images/help/repository/comment-menu-edit.png)
3. In the comment window, delete the content you'd like to remove, then type `[REDACTED]` to replace it.
4. At the bottom of the comment, type a note indicating that you have edited the comment, and optionally, why you edited the comment.
5. Click **Update comment**.

## [Deleting a comment](#deleting-a-comment)

Anyone with write access to a repository can delete comments on issues, pull requests, and commits. Organization owners, team maintainers, and the comment author can also delete a comment on a team page.

If a comment contains some constructive content that adds to the conversation in the issue or pull request, you can edit the comment instead.

Deleting a comment is your last resort as a moderator. It's appropriate to delete a comment if the entire comment adds no constructive content to a conversation and violates your community's code of conduct or GitHub's [Community Guidelines](/en/site-policy/github-terms/github-community-guidelines).

Deleting a comment creates a timeline event that is visible to anyone with read access to the repository. However, the username of the person who deleted the comment is only visible to people with write access to the repository. For anyone without write access, the timeline event is anonymized.

![Screenshot of a timeline event, which says "octo-org deleted a comment from hubot 6 minutes ago."](/assets/cb-10760/images/help/issues/anonymized-timeline-entry-for-deleted-comment.png)

Note

The initial comment (or body) of an issue or pull request can't be deleted. Instead, you can edit issue and pull request bodies to remove unwanted content.

### [Steps to delete a comment](#steps-to-delete-a-comment)

1. Navigate to the comment you'd like to delete.
2. In the upper-right corner of the comment, click , then click **Delete**.
   ![Screenshot of a pull request comment by octo-user. Below an icon of three dots, a dropdown menu is expanded, and "Delete" is outlined in orange.](/assets/cb-42453/images/help/repository/comment-menu-delete.png)
3. Optionally, write a comment noting that you deleted a comment and why.

## [Further reading](#further-reading)

* [Managing moderators in your organization](/en/organizations/managing-peoples-access-to-your-organization-with-roles/managing-moderators-in-your-organization)
## Help and support

### Did you find what you needed?

 Yes No[Privacy policy](/en/site-policy/privacy-policies/github-privacy-statement)
### Help us make these docs great!

All GitHub docs are open source. See something that's wrong or unclear? Submit a pull request.

[Make a contribution](https://github.com/github/docs/blob/main/content/communities/moderating-comments-and-conversations/managing-disruptive-comments.md)

[Learn how to contribute](/contributing)

### Still need help?

[Ask the GitHub community](https://github.com/orgs/community/discussions)[Contact support](https://support.github.com)
## Legal

* © 2025 GitHub, Inc.
* [Terms](/en/site-policy/github-terms/github-terms-of-service)
* [Privacy](/en/site-policy/privacy-policies/github-privacy-statement)
* [Status](https://www.githubstatus.com/)
* [Pricing](https://github.com/pricing)
* [Expert services](https://services.github.com)
* [Blog](https://github.blog)


=== Content from github.com_081cbbd2_20250124_162450.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcf970c002d270c36202bd5b9c2804d3097a52da0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcf970c002d270c36202bd5b9c2804d3097a52da0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/cf970c002d270c36202bd5b9c2804d3097a52da0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

ping: prevent NULL pointer dereference on write to msg\_name

[Browse files](/torvalds/linux/tree/cf970c002d270c36202bd5b9c2804d3097a52da0)
Browse the repository at this point in the history

```
A plain read() on a socket does set msg->msg_name to NULL. So check for
NULL pointer first.

Signed-off-by: Hannes Frederic Sowa <hannes@stressinduktion.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
```

* Loading branch information

[![@strssndktn](https://avatars.githubusercontent.com/u/67002584?s=40&v=4)](/strssndktn) [![@davem330](https://avatars.githubusercontent.com/u/1053866?s=40&v=4)](/davem330)

[strssndktn](/torvalds/linux/commits?author=strssndktn "View all commits by strssndktn")
authored and
[davem330](/torvalds/linux/commits?author=davem330 "View all commits by davem330")
committed
Nov 18, 2013

1 parent
[4861292](/torvalds/linux/commit/4861292f730d7c461758575e2557e285a1d4521e)

commit cf970c0

Showing
**1 changed file**
with
**19 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

34 changes: 19 additions & 15 deletions

34
[net/ipv4/ping.c](#diff-116af33e8f91c477838ba42e8e69578938210b065ab76507a8bddee53981b5ef "net/ipv4/ping.c")

Show comments

[View file](/torvalds/linux/blob/cf970c002d270c36202bd5b9c2804d3097a52da0/net/ipv4/ping.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -870,11 +870,13 @@ int ping\_recvmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg, |
|  |  | if (family == AF\_INET) { |
|  |  | struct sockaddr\_in \*sin = (struct sockaddr\_in \*)msg->msg\_name; |
|  |  |  |
|  |  | sin->sin\_family = AF\_INET; |
|  |  | sin->sin\_port = 0 /\* skb->h.uh->source \*/; |
|  |  | sin->sin\_addr.s\_addr = ip\_hdr(skb)->saddr; |
|  |  | memset(sin->sin\_zero, 0, sizeof(sin->sin\_zero)); |
|  |  | \*addr\_len = sizeof(\*sin); |
|  |  | if (sin) { |
|  |  | sin->sin\_family = AF\_INET; |
|  |  | sin->sin\_port = 0 /\* skb->h.uh->source \*/; |
|  |  | sin->sin\_addr.s\_addr = ip\_hdr(skb)->saddr; |
|  |  | memset(sin->sin\_zero, 0, sizeof(sin->sin\_zero)); |
|  |  | \*addr\_len = sizeof(\*sin); |
|  |  | } |
|  |  |  |
|  |  | if (isk->cmsg\_flags) |
|  |  | ip\_cmsg\_recv(msg, skb); |
| Expand All | | @@ -886,16 +888,18 @@ int ping\_recvmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg, |
|  |  | struct sockaddr\_in6 \*sin6 = |
|  |  | (struct sockaddr\_in6 \*)msg->msg\_name; |
|  |  |  |
|  |  | sin6->sin6\_family = AF\_INET6; |
|  |  | sin6->sin6\_port = 0; |
|  |  | sin6->sin6\_addr = ip6->saddr; |
|  |  | sin6->sin6\_flowinfo = 0; |
|  |  | if (np->sndflow) |
|  |  | sin6->sin6\_flowinfo = ip6\_flowinfo(ip6); |
|  |  |  |
|  |  | sin6->sin6\_scope\_id = ipv6\_iface\_scope\_id(&sin6->sin6\_addr, |
|  |  | IP6CB(skb)->iif); |
|  |  | \*addr\_len = sizeof(\*sin6); |
|  |  | if (sin6) { |
|  |  | sin6->sin6\_family = AF\_INET6; |
|  |  | sin6->sin6\_port = 0; |
|  |  | sin6->sin6\_addr = ip6->saddr; |
|  |  | sin6->sin6\_flowinfo = 0; |
|  |  | if (np->sndflow) |
|  |  | sin6->sin6\_flowinfo = ip6\_flowinfo(ip6); |
|  |  | sin6->sin6\_scope\_id = |
|  |  | ipv6\_iface\_scope\_id(&sin6->sin6\_addr, |
|  |  | IP6CB(skb)->iif); |
|  |  | \*addr\_len = sizeof(\*sin6); |
|  |  | } |
|  |  |  |
|  |  | if (inet6\_sk(sk)->rxopt.all) |
|  |  | pingv6\_ops.ip6\_datagram\_recv\_ctl(sk, msg, skb); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 1 comment on commit `cf970c0`

[![@byhankswang](https://avatars.githubusercontent.com/u/6735699?s=80&v=4)](/byhankswang)

Copy link

### @byhankswang **[byhankswang](/byhankswang)** commented on `[cf970c0](/torvalds/linux/commit/cf970c002d270c36202bd5b9c2804d3097a52da0)` [Aug 23, 2014](#commitcomment-7498685)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

bug fix for [CVE-2013-6432](https://github.com/advisories/GHSA-fw6g-56pg-38xh "CVE-2013-6432")

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fcf970c002d270c36202bd5b9c2804d3097a52da0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from access.redhat.com_ae3fae3d_20250126_021142.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.ubuntu.com_4d20fbde_20250124_162448.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2117-1: Linux kernel vulnerabilities

18 February 2014

Several security issues were fixed in the kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 13.10](/security/notices?release=saucy)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel

## Details

Saran Neti reported a flaw in the ipv6 UDP Fragmentation Offload (UFI) in

the Linux kernel. A remote attacker could exploit this flaw to cause a

denial of service (panic). ([CVE-2013-4563](/security/CVE-2013-4563))

Mathy Vanhoef discovered an error in the the way the ath9k driver was

handling the BSSID masking. A remote attacker could exploit this error to

discover the original MAC address after a spoofing atack. ([CVE-2013-4579](/security/CVE-2013-4579))

Andrew Honig reported a flaw in the Linux Kernel's kvm\_vm\_ioctl\_create\_vcpu

function of the Kernel Virtual Machine (KVM) subsystem. A local user could

exploit this flaw to gain privileges on the host machine. ([CVE-2013-4587](/security/CVE-2013-4587))

Andrew Honig reported a flaw in the apic\_get\_tmcct function of the Kernel

Virtual Machine (KVM) subsystem if the Linux kernel. A guest OS user could

exploit this flaw to cause a denial of service or host OS system crash.

([CVE-2013-6367](/security/CVE-2013-6367))

Andrew Honig reported an error in the Linux Kernel's Kernel Virtual Machine

(KVM) VAPIC synchronization operation. A local user could exploit this flaw

to gain privileges or cause a denial of service (system crash).

([CVE-2013-6368](/security/CVE-2013-6368))

Lars Bull discovered a flaw in the recalculate\_apic\_map function of the

Kernel Virtual Machine (KVM) subsystem in the Linux kernel. A guest OS user

could exploit this flaw to cause a denial of service (host OS crash).

([CVE-2013-6376](/security/CVE-2013-6376))

Nico Golde and Fabian Yamaguchi reported buffer underflow errors in the

implementation of the XFS filesystem in the Linux kernel. A local user with

CAP\_SYS\_ADMIN could exploit these flaw to cause a denial of service (memory

corruption) or possibly other unspecified issues. ([CVE-2013-6382](/security/CVE-2013-6382))

A flaw was discovered in the ipv4 ping\_recvmsg function of the Linux

kernel. A local user could exploit this flaw to cause a denial of service

(NULL pointer dereference and system crash). ([CVE-2013-6432](/security/CVE-2013-6432))

mpd reported an information leak in the recvfrom, recvmmsg, and recvmsg

system calls in the Linux kernel. An unprivileged local user could exploit

this flaw to obtain sensitive information from kernel stack memory.

([CVE-2013-7263](/security/CVE-2013-7263))

mpb reported an information leak in the Layer Two Tunneling Protocol (l2tp)

of the Linux kernel. A local user could exploit this flaw to obtain

sensitive information from kernel stack memory. ([CVE-2013-7264](/security/CVE-2013-7264))

mpb reported an information leak in the Phone Network protocol (phonet) in

the Linux kernel. A local user could exploit this flaw to obtain sensitive

information from kernel stack memory. ([CVE-2013-7265](/security/CVE-2013-7265))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with ISDN sockets in the Linux kernel. A local user

could exploit this leak to obtain potentially sensitive information from

kernel memory. ([CVE-2013-7266](/security/CVE-2013-7266))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with apple talk sockets in the Linux kernel. A local

user could exploit this leak to obtain potentially sensitive information

from kernel memory. ([CVE-2013-7267](/security/CVE-2013-7267))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with ipx protocol sockets in the Linux kernel. A

local user could exploit this leak to obtain potentially sensitive

information from kernel memory. ([CVE-2013-7268](/security/CVE-2013-7268))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with the netrom address family in the Linux kernel. A

local user could exploit this leak to obtain potentially sensitive

information from kernel memory. ([CVE-2013-7269](/security/CVE-2013-7269))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with packet address family sockets in the Linux

kernel. A local user could exploit this leak to obtain potentially

sensitive information from kernel memory. ([CVE-2013-7270](/security/CVE-2013-7270))

An information leak was discovered in the recvfrom, recvmmsg, and recvmsg

systemcalls when used with x25 protocol sockets in the Linux kernel. A

local user could exploit this leak to obtain potentially sensitive

information from kernel memory. ([CVE-2013-7271](/security/CVE-2013-7271))

mpb reported an information leak in the Low-Rate Wireless Personal Area

Networks support (IEEE 802.15.4) in the Linux kernel. A local user could

exploit this flaw to obtain sensitive information from kernel stack memory.

([CVE-2013-7281](/security/CVE-2013-7281))

A flaw was discovered in the Reliable Datagram Sockets (RDS) protocol

implementation in the Linux kernel for systems that lack RDS transports. An

unprivileged local user could exploit this flaw to cause a denial of

service (system crash). ([CVE-2013-7339](/security/CVE-2013-7339))

halfdog reported an error in the AMD K7 and K8 platform support in the

Linux kernel. An unprivileged local user could exploit this flaw on AMD

based systems to cause a denial of service (task kill) or possibly gain

privileges via a crafted application. ([CVE-2014-1438](/security/CVE-2014-1438))

An information leak was discovered in the Linux kernel's hamradio YAM

driver for AX.25 packet radio. A local user with the CAP\_NET\_ADMIN

capability could exploit this flaw to obtain sensitive information from

kernel memory. ([CVE-2014-1446](/security/CVE-2014-1446))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 13.10

* [linux-image-3.11.0-17-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.11.0-17.31](https://launchpad.net/ubuntu/%2Bsource/linux/3.11.0-17.31)
* [linux-image-3.11.0-17-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.11.0-17.31](https://launchpad.net/ubuntu/%2Bsource/linux/3.11.0-17.31)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2013-4563](/security/CVE-2013-4563)
* [CVE-2013-4579](/security/CVE-2013-4579)
* [CVE-2013-4587](/security/CVE-2013-4587)
* [CVE-2013-6367](/security/CVE-2013-6367)
* [CVE-2013-6368](/security/CVE-2013-6368)
* [CVE-2013-6376](/security/CVE-2013-6376)
* [CVE-2013-6382](/security/CVE-2013-6382)
* [CVE-2013-6432](/security/CVE-2013-6432)
* [CVE-2013-7263](/security/CVE-2013-7263)
* [CVE-2013-7264](/security/CVE-2013-7264)
* [CVE-2013-7265](/security/CVE-2013-7265)
* [CVE-2013-7266](/security/CVE-2013-7266)
* [CVE-2013-7267](/security/CVE-2013-7267)
* [CVE-2013-7268](/security/CVE-2013-7268)
* [CVE-2013-7269](/security/CVE-2013-7269)
* [CVE-2013-7270](/security/CVE-2013-7270)
* [CVE-2013-7271](/security/CVE-2013-7271)
* [CVE-2013-7281](/security/CVE-2013-7281)
* [CVE-2013-7339](/security/CVE-2013-7339)
* [CVE-2014-1438](/security/CVE-2014-1438)
* [CVE-2014-1446](/security/CVE-2014-1446)

## Related notices

* [USN-2113-1](/security/notices/USN-2113-1)
* [USN-2138-1](/security/notices/USN-2138-1)
* [USN-2136-1](/security/notices/USN-2136-1)
* [USN-2139-1](/security/notices/USN-2139-1)
* [USN-2134-1](/security/notices/USN-2134-1)
* [USN-2141-1](/security/notices/USN-2141-1)
* [USN-2135-1](/security/notices/USN-2135-1)
* [USN-2133-1](/security/notices/USN-2133-1)
* [USN-2129-1](/security/notices/USN-2129-1)
* [USN-2110-1](/security/notices/USN-2110-1)
* [USN-2128-1](/security/notices/USN-2128-1)
* [USN-2109-1](/security/notices/USN-2109-1)
* [USN-2158-1](/security/notices/USN-2158-1)
* [USN-2108-1](/security/notices/USN-2108-1)
* [USN-2107-1](/security/notices/USN-2107-1)
* [USN-2220-1](/security/notices/USN-2220-1)
* [USN-2219-1](/security/notices/USN-2219-1)
* [USN-2234-1](/security/notices/USN-2234-1)
* [USN-2233-1](/security/notices/USN-2233-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from git.kernel.org_bb1d36e6_20250126_021142.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lorenzo Colitti <lorenzo@google.com> | 2013-05-22 20:17:31 +0000 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2013-05-25 21:07:49 -0700 |
| commit | [6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)) | |
| tree | [140f06221a5da5c44526cb61f921d80fec2132c2](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | |
| parent | [6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67&id2=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)) | |
| download | [linux-6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67.tar.gz) | |

net: ipv6: Add IPv6 support to the ping socket.This adds the ability to send ICMPv6 echo requests without a
raw socket. The equivalent ability for ICMPv4 was added in
2011.
Instead of having separate code paths for IPv4 and IPv6, make
most of the code in net/ipv4/ping.c dual-stack and only add a
few IPv6-specific bits (like the protocol definition) to a new
net/ipv6/ping.c. Hopefully this will reduce divergence and/or
duplication of bugs in the future.
Caveats:
- Setting options via ancillary data (e.g., using IPV6\_PKTINFO
to specify the outgoing interface) is not yet supported.
- There are no separate security settings for IPv4 and IPv6;
everything is controlled by /proc/net/ipv4/ping\_group\_range.
- The proc interface does not yet display IPv6 ping sockets
properly.
Tested with a patched copy of ping6 and using raw socket calls.
Compiles and works with all of CONFIG\_IPV6={n,m,y}.
Signed-off-by: Lorenzo Colitti <lorenzo@google.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)

| -rw-r--r-- | [include/net/ipv6.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/net/ipv6.h?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [include/net/ping.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/net/ping.h?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 49 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [include/net/transp\_v6.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/net/transp_v6.h?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 3 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/ipv4/icmp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv4/icmp.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/ipv4/ping.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv4/ping.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 557 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/ipv6/Makefile](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv6/Makefile?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/ipv6/af\_inet6.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv6/af_inet6.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 12 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/ipv6/icmp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv6/icmp.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 19 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/ipv6/ping.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/net/ipv6/ping.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67) | 216 | |  |  |  | | --- | --- | --- | |

9 files changed, 698 insertions, 171 deletions

| diff --git a/include/net/ipv6.h b/include/net/ipv6.hindex 0810aa57c78015..ab47582f6c0b46 100644--- a/[include/net/ipv6.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/ipv6.h?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[include/net/ipv6.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/ipv6.h?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -260,6 +260,12 @@ static inline void fl6\_sock\_release(struct ip6\_flowlabel \*fl)  extern void icmpv6\_notify(struct sk\_buff \*skb, u8 type, u8 code, \_\_be32 info); +int icmpv6\_push\_pending\_frames(struct sock \*sk, struct flowi6 \*fl6,+ struct icmp6hdr \*thdr, int len);++struct dst\_entry \*icmpv6\_route\_lookup(struct net \*net, struct sk\_buff \*skb,+ struct sock \*sk, struct flowi6 \*fl6);+ extern int ip6\_ra\_control(struct sock \*sk, int sel);  extern int ipv6\_parse\_hopopts(struct sk\_buff \*skb);diff --git a/include/net/ping.h b/include/net/ping.hindex 682b5ae9af5165..9242fa090d3dea 100644--- a/[include/net/ping.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/ping.h?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[include/net/ping.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/ping.h?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -13,6 +13,7 @@ #ifndef \_PING\_H #define \_PING\_H +#include <net/icmp.h> #include <net/netns/hash.h>  /\* PING\_HTABLE\_SIZE must be power of 2 \*/@@ -28,6 +29,18 @@ \*/ #define GID\_T\_MAX (((gid\_t)~0U) >> 1) +/\* Compatibility glue so we can support IPv6 when it's compiled as a module \*/+struct pingv6\_ops {+ int (\*ipv6\_recv\_error)(struct sock \*sk, struct msghdr \*msg, int len);+ int (\*ip6\_datagram\_recv\_ctl)(struct sock \*sk, struct msghdr \*msg,+ struct sk\_buff \*skb);+ int (\*icmpv6\_err\_convert)(u8 type, u8 code, int \*err);+ void (\*ipv6\_icmp\_error)(struct sock \*sk, struct sk\_buff \*skb, int err,+ \_\_be16 port, u32 info, u8 \*payload);+ int (\*ipv6\_chk\_addr)(struct net \*net, const struct in6\_addr \*addr,+ struct net\_device \*dev, int strict);+};+ struct ping\_table { struct hlist\_nulls\_head hash[PING\_HTABLE\_SIZE]; rwlock\_t lock;@@ -39,10 +52,39 @@ struct ping\_iter\_state { };  extern struct proto ping\_prot;+extern struct ping\_table ping\_table;+#if IS\_ENABLED(CONFIG\_IPV6)+extern struct pingv6\_ops pingv6\_ops;+#endif +struct pingfakehdr {+ struct icmphdr icmph;+ struct iovec \*iov;+ sa\_family\_t family;+ \_\_wsum wcheck;+}; -extern void ping\_rcv(struct sk\_buff \*);-extern void ping\_err(struct sk\_buff \*, u32 info);+int ping\_get\_port(struct sock \*sk, unsigned short ident);+void ping\_hash(struct sock \*sk);+void ping\_unhash(struct sock \*sk);++int ping\_init\_sock(struct sock \*sk);+void ping\_close(struct sock \*sk, long timeout);+int ping\_bind(struct sock \*sk, struct sockaddr \*uaddr, int addr\_len);+void ping\_err(struct sk\_buff \*skb, int offset, u32 info);+int ping\_getfrag(void \*from, char \*to, int offset, int fraglen, int odd,+ struct sk\_buff \*);++int ping\_recvmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,+ size\_t len, int noblock, int flags, int \*addr\_len);+int ping\_common\_sendmsg(int family, struct msghdr \*msg, size\_t len,+ void \*user\_icmph, size\_t icmph\_len);+int ping\_v4\_sendmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,+ size\_t len);+int ping\_v6\_sendmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,+ size\_t len);+int ping\_queue\_rcv\_skb(struct sock \*sk, struct sk\_buff \*skb);+void ping\_rcv(struct sk\_buff \*skb);  #ifdef CONFIG\_PROC\_FS extern int \_\_init ping\_proc\_init(void);@@ -50,6 +92,7 @@ extern void ping\_proc\_exit(void); #endif  void \_\_init ping\_init(void);-+int \_\_init pingv6\_init(void);+void pingv6\_exit(void);  #endif /\* \_PING\_H \*/diff --git a/include/net/transp\_v6.h b/include/net/transp\_v6.hindex 938b7fd1120477..eb40e71ff2ee32 100644--- a/[include/net/transp\_v6.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/transp_v6.h?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[include/net/transp\_v6.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/net/transp_v6.h?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -11,6 +11,7 @@ extern struct proto rawv6\_prot; extern struct proto udpv6\_prot; extern struct proto udplitev6\_prot; extern struct proto tcpv6\_prot;+extern struct proto pingv6\_prot;  struct flowi6; @@ -21,6 +22,8 @@ extern int ipv6\_frag\_init(void); extern void ipv6\_frag\_exit(void);  /\* transport protocols \*/+extern int pingv6\_init(void);+extern void pingv6\_exit(void); extern int rawv6\_init(void); extern void rawv6\_exit(void); extern int udpv6\_init(void);diff --git a/net/ipv4/icmp.c b/net/ipv4/icmp.cindex 76e10b47e053fd..562efd91f457f3 100644--- a/[net/ipv4/icmp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv4/icmp.c?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[net/ipv4/icmp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv4/icmp.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -939,7 +939,8 @@ error: void icmp\_err(struct sk\_buff \*skb, u32 info) { struct iphdr \*iph = (struct iphdr \*)skb->data;- struct icmphdr \*icmph = (struct icmphdr \*)(skb->data+(iph->ihl<<2));+ int offset = iph->ihl<<2;+ struct icmphdr \*icmph = (struct icmphdr \*)(skb->data + offset); int type = icmp\_hdr(skb)->type; int code = icmp\_hdr(skb)->code; struct net \*net = dev\_net(skb->dev);@@ -949,7 +950,7 @@ void icmp\_err(struct sk\_buff \*skb, u32 info) \* triggered by ICMP\_ECHOREPLY which sent from kernel. \*/ if (icmph->type != ICMP\_ECHOREPLY) {- ping\_err(skb, info);+ ping\_err(skb, offset, info); return; } diff --git a/net/ipv4/ping.c b/net/ipv4/ping.cindex 7d93d62cd5fdae..71f6ad02fa679f 100644--- a/[net/ipv4/ping.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv4/ping.c?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[net/ipv4/ping.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv4/ping.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -33,7 +33,6 @@ #include <linux/netdevice.h> #include <net/snmp.h> #include <net/ip.h>-#include <net/ipv6.h> #include <net/icmp.h> #include <net/protocol.h> #include <linux/skbuff.h>@@ -46,8 +45,18 @@ #include <net/inet\_common.h> #include <net/checksum.h> +#if IS\_ENABLED(CONFIG\_IPV6)+#include <linux/in6.h>+#include <linux/icmpv6.h>+#include <net/addrconf.h>+#include <net/ipv6.h>+#include <net/transp\_v6.h>+#endif -static struct ping\_table ping\_table;++struct ping\_table ping\_table;+struct pingv6\_ops pingv6\_ops;+EXPORT\_SYMBOL\_GPL(pingv6\_ops);  static u16 ping\_port\_rover; @@ -58,6 +67,7 @@ static inline int ping\_hashfn(struct net \*net, unsigned int num, unsigned int ma pr\_debug("hash(%d) = %d\n", num, res); return res; }+EXPORT\_SYMBOL\_GPL(ping\_hash);  static inline struct hlist\_nulls\_head \*ping\_hashslot(struct ping\_table \*table, struct net \*net, unsigned int num)@@ -65,7 +75,7 @@ static inline struct hlist\_nulls\_head \*ping\_hashslot(struct ping\_table \*table, return &table->hash[ping\_hashfn(net, num, PING\_HTABLE\_MASK)]; } -static int ping\_v4\_get\_port(struct sock \*sk, unsigned short ident)+int ping\_get\_port(struct sock \*sk, unsigned short ident) { struct hlist\_nulls\_node \*node; struct hlist\_nulls\_head \*hlist;@@ -103,6 +113,10 @@ next\_port: ping\_portaddr\_for\_each\_entry(sk2, node, hlist) { isk2 = inet\_sk(sk2); + /\* BUG? Why is this reuse and not reuseaddr? ping.c+ \* doesn't turn off SO\_REUSEADDR, and it doesn't expect+ \* that other ping processes can steal its packets.+ \*/ if ((isk2->inet\_num == ident) && (sk2 != sk) && (!sk2->sk\_reuse || !sk->sk\_reuse))@@ -125,17 +139,18 @@ fail: write\_unlock\_bh(&ping\_table.lock); return 1; }+EXPORT\_SYMBOL\_GPL(ping\_get\_port); -static void ping\_v4\_hash(struct sock \*sk)+void ping\_hash(struct sock \*sk) {- pr\_debug("ping\_v4\_hash(sk->port=%u)\n", inet\_sk(sk)->inet\_num);+ pr\_debug("ping\_hash(sk->port=%u)\n", inet\_sk(sk)->inet\_num); BUG(); /\* "Please do not press this button again." \*/ } -static void ping\_v4\_unhash(struct sock \*sk)+void ping\_unhash(struct sock \*sk) { struct inet\_sock \*isk = inet\_sk(sk);- pr\_debug("ping\_v4\_unhash(isk=%p,isk->num=%u)\n", isk, isk->inet\_num);+ pr\_debug("ping\_unhash(isk=%p,isk->num=%u)\n", isk, isk->inet\_num); if (sk\_hashed(sk)) { write\_lock\_bh(&ping\_table.lock); hlist\_nulls\_del(&sk->sk\_nulls\_node);@@ -146,31 +161,61 @@ static void ping\_v4\_unhash(struct sock \*sk) write\_unlock\_bh(&ping\_table.lock); } }+EXPORT\_SYMBOL\_GPL(ping\_unhash); -static struct sock \*ping\_v4\_lookup(struct net \*net, \_\_be32 saddr, \_\_be32 daddr,- u16 ident, int dif)+static struct sock \*ping\_lookup(struct net \*net, struct sk\_buff \*skb, u16 ident) { struct hlist\_nulls\_head \*hslot = ping\_hashslot(&ping\_table, net, ident); struct sock \*sk = NULL; struct inet\_sock \*isk; struct hlist\_nulls\_node \*hnode;+ int dif = skb->dev->ifindex;++ if (skb->protocol == htons(ETH\_P\_IP)) {+ pr\_debug("try to find: num = %d, daddr = %pI4, dif = %d\n",+ (int)ident, &ip\_hdr(skb)->daddr, dif);+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (skb->protocol == htons(ETH\_P\_IPV6)) {+ pr\_debug("try to find: num = %d, daddr = %pI6c, dif = %d\n",+ (int)ident, &ipv6\_hdr(skb)->daddr, dif);+#endif+ } - pr\_debug("try to find: num = %d, daddr = %pI4, dif = %d\n",- (int)ident, &daddr, dif); read\_lock\_bh(&ping\_table.lock);  ping\_portaddr\_for\_each\_entry(sk, hnode, hslot) { isk = inet\_sk(sk); - pr\_debug("found: %p: num = %d, daddr = %pI4, dif = %d\n", sk,- (int)isk->inet\_num, &isk->inet\_rcv\_saddr,- sk->sk\_bound\_dev\_if);- pr\_debug("iterate\n"); if (isk->inet\_num != ident) continue;- if (isk->inet\_rcv\_saddr && isk->inet\_rcv\_saddr != daddr)- continue;++ if (skb->protocol == htons(ETH\_P\_IP) &&+ sk->sk\_family == AF\_INET) {+ pr\_debug("found: %p: num=%d, daddr=%pI4, dif=%d\n", sk,+ (int) isk->inet\_num, &isk->inet\_rcv\_saddr,+ sk->sk\_bound\_dev\_if);++ if (isk->inet\_rcv\_saddr &&+ isk->inet\_rcv\_saddr != ip\_hdr(skb)->daddr)+ continue;+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (skb->protocol == htons(ETH\_P\_IPV6) &&+ sk->sk\_family == AF\_INET6) {+ struct ipv6\_pinfo \*np = inet6\_sk(sk);++ pr\_debug("found: %p: num=%d, daddr=%pI6c, dif=%d\n", sk,+ (int) isk->inet\_num,+ &inet6\_sk(sk)->rcv\_saddr,+ sk->sk\_bound\_dev\_if);++ if (!ipv6\_addr\_any(&np->rcv\_saddr) &&+ !ipv6\_addr\_equal(&np->rcv\_saddr,+ &ipv6\_hdr(skb)->daddr))+ continue;+#endif+ }+ if (sk->sk\_bound\_dev\_if && sk->sk\_bound\_dev\_if != dif) continue; @@ -200,7 +245,7 @@ static void inet\_get\_ping\_group\_range\_net(struct net \*net, kgid\_t \*low, }  -static int ping\_init\_sock(struct sock \*sk)+int ping\_init\_sock(struct sock \*sk) { struct net \*net = sock\_net(sk); kgid\_t group = current\_egid();@@ -225,8 +270,9 @@ static int ping\_init\_sock(struct sock \*sk)  return -EACCES; }+EXPORT\_SYMBOL\_GPL(ping\_init\_sock); -static void ping\_close(struct sock \*sk, long timeout)+void ping\_close(struct sock \*sk, long timeout) { pr\_debug("ping\_close(sk=%p,sk->num=%u)\n", inet\_sk(sk), inet\_sk(sk)->inet\_num);@@ -234,36 +280,122 @@ static void ping\_close(struct sock \*sk, long timeout)  sk\_common\_release(sk); }+EXPORT\_SYMBOL\_GPL(ping\_close);++/\* Checks the bind address and possibly modifies sk->sk\_bound\_dev\_if. \*/+int ping\_check\_bind\_addr(struct sock \*sk, struct inet\_sock \*isk,+ struct sockaddr \*uaddr, int addr\_len) {+ struct net \*net = sock\_net(sk);+ if (sk->sk\_family == AF\_INET) {+ struct sockaddr\_in \*addr = (struct sockaddr\_in \*) uaddr;+ int chk\_addr\_ret;++ if (addr\_len < sizeof(\*addr))+ return -EINVAL;++ pr\_debug("ping\_check\_bind\_addr(sk=%p,addr=%pI4,port=%d)\n",+ sk, &addr->sin\_addr.s\_addr, ntohs(addr->sin\_port));++ chk\_addr\_ret = inet\_addr\_type(net, addr->sin\_addr.s\_addr);++ if (addr->sin\_addr.s\_addr == htonl(INADDR\_ANY))+ chk\_addr\_ret = RTN\_LOCAL;++ if ((sysctl\_ip\_nonlocal\_bind == 0 &&+ isk->freebind == 0 && isk->transparent == 0 &&+ chk\_addr\_ret != RTN\_LOCAL) ||+ chk\_addr\_ret == RTN\_MULTICAST ||+ chk\_addr\_ret == RTN\_BROADCAST)+ return -EADDRNOTAVAIL;++#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (sk->sk\_family == AF\_INET6) {+ struct sockaddr\_in6 \*addr = (struct sockaddr\_in6 \*) uaddr;+ int addr\_type, scoped, has\_addr;+ struct net\_device \*dev = NULL;++ if (addr\_len < sizeof(\*addr))+ return -EINVAL;++ pr\_debug("ping\_check\_bind\_addr(sk=%p,addr=%pI6c,port=%d)\n",+ sk, addr->sin6\_addr.s6\_addr, ntohs(addr->sin6\_port));++ addr\_type = ipv6\_addr\_type(&addr->sin6\_addr);+ scoped = \_\_ipv6\_addr\_needs\_scope\_id(addr\_type);+ if ((addr\_type != IPV6\_ADDR\_ANY &&+ !(addr\_type & IPV6\_ADDR\_UNICAST)) ||+ (scoped && !addr->sin6\_scope\_id))+ return -EINVAL;++ rcu\_read\_lock();+ if (addr->sin6\_scope\_id) {+ dev = dev\_get\_by\_index\_rcu(net, addr->sin6\_scope\_id);+ if (!dev) {+ rcu\_read\_unlock();+ return -ENODEV;+ }+ }+ has\_addr = pingv6\_ops.ipv6\_chk\_addr(net, &addr->sin6\_addr, dev,+ scoped);+ rcu\_read\_unlock();++ if (!(isk->freebind || isk->transparent || has\_addr ||+ addr\_type == IPV6\_ADDR\_ANY))+ return -EADDRNOTAVAIL;++ if (scoped)+ sk->sk\_bound\_dev\_if = addr->sin6\_scope\_id;+#endif+ } else {+ return -EAFNOSUPPORT;+ }+ return 0;+} +void ping\_set\_saddr(struct sock \*sk, struct sockaddr \*saddr)+{+ if (saddr->sa\_family == AF\_INET) {+ struct inet\_sock \*isk = inet\_sk(sk);+ struct sockaddr\_in \*addr = (struct sockaddr\_in \*) saddr;+ isk->inet\_rcv\_saddr = isk->inet\_saddr = addr->sin\_addr.s\_addr;+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (saddr->sa\_family == AF\_INET6) {+ struct sockaddr\_in6 \*addr = (struct sockaddr\_in6 \*) saddr;+ struct ipv6\_pinfo \*np = inet6\_sk(sk);+ np->rcv\_saddr = np->saddr = addr->sin6\_addr;+#endif+ }+}++void ping\_clear\_saddr(struct sock \*sk, int dif)+{+ sk->sk\_bound\_dev\_if = dif;+ if (sk->sk\_family == AF\_INET) {+ struct inet\_sock \*isk = inet\_sk(sk);+ isk->inet\_rcv\_saddr = isk->inet\_saddr = 0;+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (sk->sk\_family == AF\_INET6) {+ struct ipv6\_pinfo \*np = inet6\_sk(sk);+ memset(&np->rcv\_saddr, 0, sizeof(np->rcv\_saddr));+ memset(&np->saddr, 0, sizeof(np->saddr));+#endif+ }+} /\* \* We need our own bind because there are no privileged id's == local ports. \* Moreover, we don't allow binding to multi- and broadcast addresses. \*/ -static int ping\_bind(struct sock \*sk, struct sockaddr \*uaddr, int addr\_len)+int ping\_bind(struct sock \*sk, struct sockaddr \*uaddr, int addr\_len) {- struct sockaddr\_in \*addr = (struct sockaddr\_in \*)uaddr; struct inet\_sock \*isk = inet\_sk(sk); unsigned short snum;- int chk\_addr\_ret; int err;+ int dif = sk->sk\_bound\_dev\_if; - if (addr\_len < sizeof(struct sockaddr\_in))- return -EINVAL;-- pr\_debug("ping\_v4\_bind(sk=%p,sa\_addr=%08x,sa\_port=%d)\n",- sk, addr->sin\_addr.s\_addr, ntohs(addr->sin\_port));-- chk\_addr\_ret = inet\_addr\_type(sock\_net(sk), addr->sin\_addr.s\_addr);- if (addr->sin\_addr.s\_addr == htonl(INADDR\_ANY))- chk\_addr\_ret = RTN\_LOCAL;-- if ((sysctl\_ip\_nonlocal\_bind == 0 &&- isk->freebind == 0 && isk->transparent == 0 &&- chk\_addr\_ret != RTN\_LOCAL) ||- chk\_addr\_ret == RTN\_MULTICAST ||- chk\_addr\_ret == RTN\_BROADCAST)- return -EADDRNOTAVAIL;+ err = ping\_check\_bind\_addr(sk, isk, uaddr, addr\_len);+ if (err)+ return err;  lock\_sock(sk); @@ -272,42 +404,50 @@ static int ping\_bind(struct sock \*sk, struct sockaddr \*uaddr, int addr\_len) goto out;  err = -EADDRINUSE;- isk->inet\_rcv\_saddr = isk->inet\_saddr = addr->sin\_addr.s\_addr;- snum = ntohs(addr->sin\_port);- if (ping\_v4\_get\_port(sk, snum) != 0) {- isk->inet\_saddr = isk->inet\_rcv\_saddr = 0;+ ping\_set\_saddr(sk, uaddr);+ snum = ntohs(((struct sockaddr\_in \*)uaddr)->sin\_port);+ if (ping\_get\_port(sk, snum) != 0) {+ ping\_clear\_saddr(sk, dif); goto out; } - pr\_debug("after bind(): num = %d, daddr = %pI4, dif = %d\n",+ pr\_debug("after bind(): num = %d, dif = %d\n", (int)isk->inet\_num,- &isk->inet\_rcv\_saddr, (int)sk->sk\_bound\_dev\_if);  err = 0;- if (isk->inet\_rcv\_saddr)+ if ((sk->sk\_family == AF\_INET && isk->inet\_rcv\_saddr) ||+ (sk->sk\_family == AF\_INET6 &&+ !ipv6\_addr\_any(&inet6\_sk(sk)->rcv\_saddr))) sk->sk\_userlocks |= SOCK\_BINDADDR\_LOCK;+ if (snum) sk->sk\_userlocks |= SOCK\_BINDPORT\_LOCK; isk->inet\_sport = htons(isk->inet\_num); isk->inet\_daddr = 0; isk->inet\_dport = 0;++#if IS\_ENABLED(CONFIG\_IPV6)+ if (sk->sk\_family == AF\_INET6)+ memset(&inet6\_sk(sk)->daddr, 0, sizeof(inet6\_sk(sk)->daddr));+#endif+ sk\_dst\_reset(sk); out: release\_sock(sk); pr\_debug("ping\_v4\_bind -> %d\n", err); return err; }+EXPORT\_SYMBOL\_GPL(ping\_bind);  /\* \* Is this a supported type of ICMP message? \*/ -static inline int ping\_supported(int type, int code)+static inline int ping\_supported(int family, int type, int code) {- if (type == ICMP\_ECHO && code == 0)- return 1;- return 0;+ return (family == AF\_INET && type == ICMP\_ECHO && code == 0) ||+ (family == AF\_INET6 && type == ICMPV6\_ECHO\_REQUEST && code == 0); }  /\*@@ -315,30 +455,42 @@ static inline int ping\_supported(int type, int code) \* sort of error condition. \*/ -static int ping\_queue\_rcv\_skb(struct sock \*sk, struct sk\_buff \*skb);--void ping\_err(struct sk\_buff \*skb, u32 info)+void ping\_err(struct sk\_buff \*skb, int offset, u32 info) {- struct iphdr \*iph = (struct iphdr \*)skb->data;- struct icmphdr \*icmph = (struct icmphdr \*)(skb->data+(iph->ihl<<2));+ int family;+ struct icmphdr \*icmph; struct inet\_sock \*inet\_sock;- int type = icmp\_hdr(skb)->type;- int code = icmp\_hdr(skb)->code;+ int type;+ int code; struct net \*net = dev\_net(skb->dev); struct sock \*sk; int harderr; int err; + if (skb->protocol == htons(ETH\_P\_IP)) {+ family = AF\_INET;+ type = icmp\_hdr(skb)->type;+ code = icmp\_hdr(skb)->code;+ icmph = (struct icmphdr \*)(skb->data + offset);+ } else if (skb->protocol == htons(ETH\_P\_IPV6)) {+ family = AF\_INET6;+ type = icmp6\_hdr(skb)->icmp6\_type;+ code = icmp6\_hdr(skb)->icmp6\_code;+ icmph = (struct icmphdr \*) (skb->data + offset);+ } else {+ BUG();+ }+ /\* We assume the packet has already been checked by icmp\_unreach \*/ - if (!ping\_supported(icmph->type, icmph->code))+ if (!ping\_supported(family, icmph->type, icmph->code)) return; - pr\_debug("ping\_err(type=%04x,code=%04x,id=%04x,seq=%04x)\n", type,- code, ntohs(icmph->un.echo.id), ntohs(icmph->un.echo.sequence));+ pr\_debug("ping\_err(proto=0x%x,type=%d,code=%d,id=%04x,seq=%04x)\n",+ skb->protocol, type, code, ntohs(icmph->un.echo.id),+ ntohs(icmph->un.echo.sequence)); - sk = ping\_v4\_lookup(net, iph->daddr, iph->saddr,- ntohs(icmph->un.echo.id), skb->dev->ifindex);+ sk = ping\_lookup(net, skb, ntohs(icmph->un.echo.id)); if (sk == NULL) { pr\_debug("no socket, dropping\n"); return; /\* No socket for error \*/@@ -349,72 +501,83 @@ void ping\_err(struct sk\_buff \*skb, u32 info) harderr = 0; inet\_sock = inet\_sk(sk); - switch (type) {- default:- case ICMP\_TIME\_EXCEEDED:- err = EHOSTUNREACH;- break;- case ICMP\_SOURCE\_QUENCH:- /\* This is not a real error but ping wants to see it.- \* Report it with some fake errno. \*/- err = EREMOTEIO;- break;- case ICMP\_PARAMETERPROB:- err = EPROTO;- harderr = 1;- break;- case ICMP\_DEST\_UNREACH:- if (code == ICMP\_FRAG\_NEEDED) { /\* Path MTU discovery \*/- ipv4\_sk\_update\_pmtu(skb, sk, info);- if (inet\_sock->pmtudisc != IP\_PMTUDISC\_DONT) {- err = EMSGSIZE;- harderr = 1;- break;+ if (skb->protocol == htons(ETH\_P\_IP)) {+ switch (type) {+ default:+ case ICMP\_TIME\_EXCEEDED:+ err = EHOSTUNREACH;+ break;+ case ICMP\_SOURCE\_QUENCH:+ /\* This is not a real error but ping wants to see it.+ \* Report it with some fake errno.+ \*/+ err = EREMOTEIO;+ break;+ case ICMP\_PARAMETERPROB:+ err = EPROTO;+ harderr = 1;+ break;+ case ICMP\_DEST\_UNREACH:+ if (code == ICMP\_FRAG\_NEEDED) { /\* Path MTU discovery \*/+ ipv4\_sk\_update\_pmtu(skb, sk, info);+ if (inet\_sock->pmtudisc != IP\_PMTUDISC\_DONT) {+ err = EMSGSIZE;+ harderr = 1;+ break;+ }+ goto out; }- goto out;- }- err = EHOSTUNREACH;- if (code <= NR\_ICMP\_UNREACH) {- harderr = icmp\_err\_convert[code].fatal;- err = icmp\_err\_convert[code].errno;+ err = EHOSTUNREACH;+ if (code <= NR\_ICMP\_UNREACH) {+ harderr = icmp\_err\_convert[code].fatal;+ err = icmp\_err\_convert[code].errno;+ }+ break;+ case ICMP\_REDIRECT:+ /\* See ICMP\_SOURCE\_QUENCH \*/+ ipv4\_sk\_redirect(skb, sk);+ err = EREMOTEIO;+ break; }- break;- case ICMP\_REDIRECT:- /\* See ICMP\_SOURCE\_QUENCH \*/- ipv4\_sk\_redirect(skb, sk);- err = EREMOTEIO;- break;+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (skb->protocol == htons(ETH\_P\_IPV6)) {+ harderr = pingv6\_ops.icmpv6\_err\_convert(type, code, &err);+#endif }  /\* \* RFC1122: OK. Passes ICMP errors back to application, as per \* 4.1.3.3. \*/- if (!inet\_sock->recverr) {+ if ((family == AF\_INET && !inet\_sock->recverr) ||+ (family == AF\_INET6 && !inet6\_sk(sk)->recverr)) { if (!harderr || sk->sk\_state != TCP\_ESTABLISHED) goto out; } else {- ip\_icmp\_error(sk, skb, err, 0 /\* no remote port \*/,- info, (u8 \*)icmph);+ if (family == AF\_INET) {+ ip\_icmp\_error(sk, skb, err, 0 /\* no remote port \*/,+ info, (u8 \*)icmph);+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (family == AF\_INET6) {+ pingv6\_ops.ipv6\_icmp\_error(sk, skb, err, 0,+ info, (u8 \*)icmph);+#endif+ } } sk->sk\_err = err; sk->sk\_error\_report(sk); out: sock\_put(sk); }+EXPORT\_SYMBOL\_GPL(ping\_err);  /\*- \* Copy and checksum an ICMP Echo packet from user space into a buffer.+ \* Copy and checksum an ICMP Echo packet from user space into a buffer+ \* starting from the payload. \*/ -struct pingfakehdr {- struct icmphdr icmph;- struct iovec \*iov;- \_\_wsum wcheck;-};--static int ping\_getfrag(void \*from, char \*to,- int offset, int fraglen, int odd, struct sk\_buff \*skb)+int ping\_getfrag(void \*from, char \*to,+ int offset, int fraglen, int odd, struct sk\_buff \*skb) { struct pingfakehdr \*pfh = (struct pingfakehdr \*)from; @@ -425,20 +588,33 @@ static int ping\_getfrag(void \*from, char \*to, pfh->iov, 0, fraglen - sizeof(struct icmphdr), &pfh->wcheck)) return -EFAULT;+ } else if (offset < sizeof(struct icmphdr)) {+ BUG();+ } else {+ if (csum\_partial\_copy\_fromiovecend+ (to, pfh->iov, offset - sizeof(struct icmphdr),+ fraglen, &pfh->wcheck))+ return -EFAULT;+ } - return 0;+#if IS\_ENABLED(CONFIG\_IPV6)+ /\* For IPv6, checksum each skb as we go along, as expected by+ \* icmpv6\_push\_pending\_frames. For IPv4, accumulate the checksum in+ \* wcheck, it will be finalized in ping\_v4\_push\_pending\_frames.+ \*/+ if (pfh->family == AF\_INET6) {+ skb->csum = pfh->wcheck;+ skb->ip\_summed = CHECKSUM\_NONE;+ pfh->wcheck = 0; }- if (offset < sizeof(struct icmphdr))- BUG();- if (csum\_partial\_copy\_fromiovecend- (to, pfh->iov, offset - sizeof(struct icmphdr),- fraglen, &pfh->wcheck))- return -EFAULT;+#endif+ return 0; }+EXPORT\_SYMBOL\_GPL(ping\_getfrag); -static int ping\_push\_pending\_frames(struct sock \*sk, struct pingfakehdr \*pfh,- struct flowi4 \*fl4)+static int ping\_v4\_push\_pending\_frames(struct sock \*sk, struct pingfakehdr \*pfh,+ struct flowi4 \*fl4) { struct sk\_buff \*skb = skb\_peek(&sk->sk\_write\_queue); @@ -450,24 +626,9 @@ static int ping\_push\_pending\_frames(struct sock \*sk, struct pingfakehdr \*pfh, return ip\_push\_pending\_frames(sk, fl4); } -static int ping\_sendmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,- size\_t len)-{- struct net \*net = sock\_net(sk);- struct flowi4 fl4;- struct inet\_sock \*inet = inet\_sk(sk);- struct ipcm\_cookie ipc;- struct icmphdr user\_icmph;- struct pingfakehdr pfh;- struct rtable \*rt = NULL;- struct ip\_options\_data opt\_copy;- int free = 0;- \_\_be32 saddr, daddr, faddr;- u8 tos;- int err;-- pr\_debug("ping\_sendmsg(sk=%p,sk->num=%u)\n", inet, inet->inet\_num);-+int ping\_common\_sendmsg(int family, struct msghdr \*msg, size\_t len,+ void \*user\_icmph, size\_t icmph\_len) {+ u8 type, code;  if (len > 0xFFFF) return -EMSGSIZE;@@ -482,15 +643,53 @@ static int ping\_sendmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,  /\* \* Fetch the ICMP header provided by the userland.- \* iovec is modified!+ \* iovec is modified! The ICMP header is consumed. \*/-- if (memcpy\_fromiovec((u8 \*)&user\_icmph, msg->msg\_iov,- sizeof(struct icmphdr)))+ if (memcpy\_fromiovec(user\_icmph, msg->msg\_iov, icmph\_len)) return -EFAULT;- if (!ping\_supported(user\_icmph.type, user\_icmph.code))++ if (family == AF\_INET) {+ type = ((struct icmphdr \*) user\_icmph)->type;+ code = ((struct icmphdr \*) user\_icmph)->code;+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (family == AF\_INET6) {+ type = ((struct icmp6hdr \*) user\_icmph)->icmp6\_type;+ code = ((struct icmp6hdr \*) user\_icmph)->icmp6\_code;+#endif+ } else {+ BUG();+ }++ if (!ping\_supported(family, type, code)) return -EINVAL; + return 0;+}+EXPORT\_SYMBOL\_GPL(ping\_common\_sendmsg);++int ping\_v4\_sendmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,+ size\_t len)+{+ struct net \*net = sock\_net(sk);+ struct flowi4 fl4;+ struct inet\_sock \*inet = inet\_sk(sk);+ struct ipcm\_cookie ipc;+ struct icmphdr user\_icmph;+ struct pingfakehdr pfh;+ struct rtable \*rt = NULL;+ struct ip\_options\_data opt\_copy;+ int free = 0;+ \_\_be32 saddr, daddr, faddr;+ u8 tos;+ int err;++ pr\_debug("ping\_v4\_sendmsg(sk=%p,sk->num=%u)\n", inet, inet->inet\_num);++ err = ping\_common\_sendmsg(AF\_INET, msg, len, &user\_icmph,+ sizeof(user\_icmph));+ if (err)+ return err;+ /\* \* Get and verify the address. \*/@@ -595,13 +794,14 @@ back\_from\_confirm: pfh.icmph.un.echo.sequence = user\_icmph.un.echo.sequence; pfh.iov = msg->msg\_iov; pfh.wcheck = 0;+ pfh.family = AF\_INET;  err = ip\_append\_data(sk, &fl4, ping\_getfrag, &pfh, len, 0, &ipc, &rt, msg->msg\_flags); if (err) ip\_flush\_pending\_frames(sk); else- err = ping\_push\_pending\_frames(sk, &pfh, &fl4);+ err = ping\_v4\_push\_pending\_frames(sk, &pfh, &fl4); release\_sock(sk);  out:@@ -622,11 +822,13 @@ do\_confirm: goto out; } -static int ping\_recvmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,- size\_t len, int noblock, int flags, int \*addr\_len)+int ping\_recvmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,+ size\_t len, int noblock, int flags, int \*addr\_len) { struct inet\_sock \*isk = inet\_sk(sk);- struct sockaddr\_in \*sin = (struct sockaddr\_in \*)msg->msg\_name;+ int family = sk->sk\_family;+ struct sockaddr\_in \*sin;+ struct sockaddr\_in6 \*sin6; struct sk\_buff \*skb; int copied, err; @@ -636,11 +838,22 @@ static int ping\_recvmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg, if (flags & MSG\_OOB) goto out; - if (addr\_len)- \*addr\_len = sizeof(\*sin);+ if (addr\_len) {+ if (family == AF\_INET)+ \*addr\_len = sizeof(\*sin);+ else if (family == AF\_INET6 && addr\_len)+ \*addr\_len = sizeof(\*sin6);+ } - if (flags & MSG\_ERRQUEUE)- return ip\_recv\_error(sk, msg, len);+ if (flags & MSG\_ERRQUEUE) {+ if (family == AF\_INET) {+ return ip\_recv\_error(sk, msg, len);+#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (family == AF\_INET6) {+ return pingv6\_ops.ipv6\_recv\_error(sk, msg, len);+#endif+ }+ }  skb = skb\_recv\_datagram(sk, flags, noblock, &err); if (!skb)@@ -659,15 +872,40 @@ static int ping\_recvmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,  sock\_recv\_timestamp(msg, sk, skb); - /\* Copy the address. \*/- if (sin) {+ /\* Copy the address and add cmsg data. \*/+ if (family == AF\_INET) {+ sin = (struct sockaddr\_in \*) msg->msg\_name; sin->sin\_family = AF\_INET; sin->sin\_port = 0 /\* skb->h.uh->source \*/; sin->sin\_addr.s\_addr = ip\_hdr(skb)->saddr; memset(sin->sin\_zero, 0, sizeof(sin->sin\_zero));++ if (isk->cmsg\_flags)+ ip\_cmsg\_recv(msg, skb);++#if IS\_ENABLED(CONFIG\_IPV6)+ } else if (family == AF\_INET6) {+ struct ipv6\_pinfo \*np = inet6\_sk(sk);+ struct ipv6hdr \*ip6 = ipv6\_hdr(skb);+ sin6 = (struct sockaddr\_in6 \*) msg->msg\_name;+ sin6->sin6\_family = AF\_INET6;+ sin6->sin6\_port = 0;+ sin6->sin6\_addr = ip6->saddr;++ if (np->sndflow)+ sin6->sin6\_flowinfo = ip6\_flowinfo(ip6);++ if (\_\_ipv6\_addr\_needs\_scope\_id(+ ipv6\_addr\_type(&sin6->sin6\_addr)))+ sin6->sin6\_scope\_id = IP6CB(skb)->iif;++ if (inet6\_sk(sk)->rxopt.all)+ pingv6\_ops.ip6\_datagram\_recv\_ctl(sk, msg, skb);+#endif+ } else {+ BUG(); }- if (isk->cmsg\_flags)- ip\_cmsg\_recv(msg, skb);+ err = copied;  done:@@ -676,8 +914,9 @@ out: pr\_debug("ping\_recvmsg -> %d\n", err); return err; }+EXPORT\_SYMBOL\_GPL(ping\_recvmsg); -static int ping\_queue\_rcv\_skb(struct sock \*sk, struct sk\_buff \*skb)+int ping\_queue\_rcv\_skb(struct sock \*sk, struct sk\_buff \*skb) { pr\_debug("ping\_queue\_rcv\_skb(sk=%p,sk->num=%d,skb=%p)\n", inet\_sk(sk), inet\_sk(sk)->inet\_num, skb);@@ -688,6 +927,7 @@ static int ping\_queue\_rcv\_skb(struct sock \*sk, struct sk\_buff \*skb) } return 0; }+EXPORT\_SYMBOL\_GPL(ping\_queue\_rcv\_skb);   /\*@@ -698,10 +938,7 @@ void ping\_rcv(struct sk\_buff \*skb) { struct sock \*sk; struct net \*net = dev\_net(skb->dev);- struct iphdr \*iph = ip\_hdr(skb); struct icmphdr \*icmph = icmp\_hdr(skb);- \_\_be32 saddr = iph->saddr;- \_\_be32 daddr = iph->daddr;  /\* We assume the packet has already been checked by icmp\_rcv \*/ @@ -711,8 +948,7 @@ void ping\_rcv(struct sk\_buff \*skb) /\* Push ICMP header back \*/ skb\_push(skb, skb->data - (u8 \*)icmph); - sk = ping\_v4\_lookup(net, saddr, daddr, ntohs(icmph->un.echo.id),- skb->dev->ifindex);+ sk = ping\_lookup(net, skb, ntohs(icmph->un.echo.id)); if (sk != NULL) { pr\_debug("rcv on socket %p\n", sk); ping\_queue\_rcv\_skb(sk, skb\_get(skb));@@ -723,6 +959,7 @@ void ping\_rcv(struct sk\_buff \*skb)  /\* We're called from icmp\_rcv(). kfree\_skb() is done there. \*/ }+EXPORT\_SYMBOL\_GPL(ping\_rcv);  struct proto ping\_prot = { .name = "PING",@@ -733,14 +970,14 @@ struct proto ping\_prot = { .disconnect = udp\_disconnect, .setsockopt = ip\_setsockopt, .getsockopt = ip\_getsockopt,- .sendmsg = ping\_sendmsg,+ .sendmsg = ping\_v4\_sendmsg, .recvmsg = ping\_recvmsg, .bind = ping\_bind, .backlog\_rcv = ping\_queue\_rcv\_skb, .release\_cb = ip4\_datagram\_release\_cb,- .hash = ping\_v4\_hash,- .unhash = ping\_v4\_unhash,- .get\_port = ping\_v4\_get\_port,+ .hash = ping\_hash,+ .unhash = ping\_unhash,+ .get\_port = ping\_get\_port, .obj\_size = sizeof(struct inet\_sock), }; EXPORT\_SYMBOL(ping\_prot);diff --git a/net/ipv6/Makefile b/net/ipv6/Makefileindex 9af088d2cdaab1..470a9c008e9b9e 100644--- a/[net/ipv6/Makefile](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/Makefile?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[net/ipv6/Makefile](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/Makefile?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -7,7 +7,7 @@ obj-$(CONFIG\_IPV6) += ipv6.o ipv6-objs := af\_inet6.o anycast.o ip6\_output.o ip6\_input.o addrconf.o \ addrlabel.o \ route.o ip6\_fib.o ipv6\_sockglue.o ndisc.o udp.o udplite.o \- raw.o icmp.o mcast.o reassembly.o tcp\_ipv6.o \+ raw.o icmp.o mcast.o reassembly.o tcp\_ipv6.o ping.o \ exthdrs.o datagram.o ip6\_flowlabel.o inet6\_connection\_sock.o  ipv6-offload := ip6\_offload.o tcpv6\_offload.o udp\_offload.o exthdrs\_offload.odiff --git a/net/ipv6/af\_inet6.c b/net/ipv6/af\_inet6.cindex ab5c7ad482cded..a5ac969aeefe53 100644--- a/[net/ipv6/af\_inet6.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/af_inet6.c?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[net/ipv6/af\_inet6.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/af_inet6.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -49,6 +49,7 @@ #include <net/udp.h> #include <net/udplite.h> #include <net/tcp.h>+#include <net/ping.h> #include <net/protocol.h> #include <net/inet\_common.h> #include <net/route.h>@@ -840,6 +841,9 @@ static int \_\_init inet6\_init(void) if (err) goto out\_unregister\_udplite\_proto; + err = proto\_register(&pingv6\_prot, 1);+ if (err)+ goto out\_unregister\_ping\_proto;  /\* We MUST register RAW sockets before we create the ICMP6, \* IGMP6, or NDISC control sockets.@@ -930,6 +934,10 @@ static int \_\_init inet6\_init(void) if (err) goto ipv6\_packet\_fail; + err = pingv6\_init();+ if (err)+ goto pingv6\_fail;+ #ifdef CONFIG\_SYSCTL err = ipv6\_sysctl\_register(); if (err)@@ -942,6 +950,8 @@ out: sysctl\_fail: ipv6\_packet\_cleanup(); #endif+pingv6\_fail:+ pingv6\_exit(); ipv6\_packet\_fail: tcpv6\_exit(); tcpv6\_fail:@@ -985,6 +995,8 @@ register\_pernet\_fail: rtnl\_unregister\_all(PF\_INET6); out\_sock\_register\_fail: rawv6\_exit();+out\_unregister\_ping\_proto:+ proto\_unregister(&pingv6\_prot); out\_unregister\_raw\_proto: proto\_unregister(&rawv6\_prot); out\_unregister\_udplite\_proto:diff --git a/net/ipv6/icmp.c b/net/ipv6/icmp.cindex b4ff0a42b8c702..1d2902e617866e 100644--- a/[net/ipv6/icmp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/icmp.c?id=6e2842f4bbb5abcf57d3cb0f10870e0ce20c0ba2)+++ b/[net/ipv6/icmp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/icmp.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -57,6 +57,7 @@  #include <net/ipv6.h> #include <net/ip6\_checksum.h>+#include <net/ping.h> #include <net/protocol.h> #include <net/raw.h> #include <net/rawv6.h>@@ -84,12 +85,18 @@ static inline struct sock \*icmpv6\_sk(struct net \*net) static void icmpv6\_err(struct sk\_buff \*skb, struct inet6\_skb\_parm \*opt, u8 type, u8 code, int offset, \_\_be32 info) {+ /\* icmpv6\_notify checks 8 bytes can be pulled, icmp6hdr is 8 bytes \*/+ struct icmp6hdr \*icmp6 = (struct icmp6hdr \*) (skb->data + offset); struct net \*net = dev\_net(skb->dev);  if (type == ICMPV6\_PKT\_TOOBIG) ip6\_update\_pmtu(skb, net, info, 0, 0); else if (type == NDISC\_REDIRECT) ip6\_redirect(skb, net, 0, 0);++ if (!(type & ICMPV6\_INFOMSG\_MASK))+ if (icmp6->icmp6\_type == ICMPV6\_ECHO\_REQUEST)+ ping\_err(skb, offset, info); }  static int icmpv6\_rcv(struct sk\_buff \*skb);@@ -224,7 +231,8 @@ static bool opt\_unrec(struct sk\_buff \*skb, \_\_u32 offset) return (\*op & 0xC0) == 0x80; } -static int icmpv6\_push\_pending\_frames(struct sock \*sk, struct flowi6 \*fl6, struct icmp6hdr \*thdr, int len)+int icmpv6\_push\_pending\_frames(struct sock \*sk, struct flowi6 \*fl6,+ struct icmp6hdr \*thdr, int len) { struct sk\_buff \*skb; struct icmp6hdr \*icmp6h;@@ -307,8 +315,8 @@ static void mip6\_addr\_swap(struct sk\_buff \*skb) static inline void mip6\_addr\_swap(struct sk\_buff \*skb) {} #endif -static struct dst\_entry \*icmpv6\_route\_lookup(struct net \*net, struct sk\_buff \*skb,- struct sock \*sk, struct flowi6 \*fl6)+struct dst\_entry \*icmpv6\_route\_lookup(struct net \*net, struct sk\_buff \*skb,+ struct sock \*sk, struct flowi6 \*fl6) { struct dst\_entry \*dst, \*dst2; struct flowi6 fl2;@@ -697,7 +705,8 @@ static int icmpv6\_rcv(struct sk\_buff \*skb) skb->csum = ~csum\_unfold(csum\_ipv6\_magic(saddr, daddr, skb->len, IPPROTO\_ICMPV6, 0)); if (\_\_skb\_checksum\_complete(skb)) {- LIMIT\_NETDEBUG(KERN\_DEBUG "ICMPv6 checksum failed [%pI6 > %pI6]\n",+ LIMIT\_NETDEBUG(KERN\_DEBUG+ "ICMPv6 checksum failed [%pI6c > %pI6c]\n", saddr, daddr); goto csum\_error; }@@ -718,7 +727,7 @@ static int icmpv6\_rcv(struct sk\_buff \*skb) break;  case ICMPV6\_ECHO\_REPLY:- /\* we couldn't care less \*/+ ping\_rcv(skb); break;  case ICMPV6\_PKT\_TOOBIG:diff --git a/net/ipv6/ping.c b/net/ipv6/ping.cnew file mode 100644index 00000000000000..a6462d657c154a--- /dev/null+++ b/[net/ipv6/ping.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/net/ipv6/ping.c?id=6d0bfe22611602f36617bc7aa2ffa1bbb2f54c67)@@ -0,0 +1,216 @@+/\*+ \* INET An implementation of the TCP/IP protocol suite for the LINUX+ \* operating system. INET is implemented using the BSD Socket+ \* interface as the means of communication with the user level.+ \*+ \* "Ping" sockets+ \*+ \* This program is free software; you can redistribute it and/or+ \* modify it under the terms of the GNU General Public License+ \* as published by the Free Software Foundation; either version+ \* 2 of the License, or (at your option) any later version.+ \*+ \* Based on ipv4/ping.c code.+ \*+ \* Authors: Lorenzo Colitti (IPv6 support)+ \* Vasiliy Kulikov / Openwall (IPv4 implementation, for Linux 2.6),+ \* Pavel Kankovsky (IPv4 implementation, for Linux 2.4.32)+ \*+ \*/++#include <net/addrconf.h>+#include <net/ipv6.h>+#include <net/ip6\_route.h>+#include <net/protocol.h>+#include <net/udp.h>+#include <net/transp\_v6.h>+#include <net/ping.h>++struct proto pingv6\_prot = {+ .name = "PINGv6",+ .owner = THIS\_MODULE,+ .init = ping\_init\_sock,+ .close = ping\_close,+ .connect = ip6\_datagram\_connect,+ .disconnect = udp\_disconnect,+ .setsockopt = ipv6\_setsockopt,+ .getsockopt = ipv6\_getsockopt,+ .sendmsg = ping\_v6\_sendmsg,+ .recvmsg = ping\_recvmsg,+ .bind = ping\_bind,+ .backlog\_rcv = ping\_queue\_rcv\_skb,+ .hash = ping\_hash,+ .unhash = ping\_unhash,+ .get\_port = ping\_get\_port,+ .obj\_size = sizeof(struct raw6\_sock),+};+EXPORT\_SYMBOL\_GPL(pingv6\_prot);++static struct inet\_protosw pingv6\_protosw = {+ .type = SOCK\_DGRAM,+ .protocol = IPPROTO\_ICMPV6,+ .prot = &pingv6\_prot,+ .ops = &inet6\_dgram\_ops,+ .no\_check = UDP\_CSUM\_DEFAULT,+ .flags = INET\_PROTOSW\_REUSE,+};+++/\* Compatibility glue so we can support IPv6 when it's compiled as a module \*/+int dummy\_ipv6\_recv\_error(struct sock \*sk, struct msghdr \*msg, int len)+{+ return -EAFNOSUPPORT;+}+int dummy\_ip6\_datagram\_recv\_ctl(struct sock \*sk, struct msghdr \*msg,+ struct sk\_buff \*skb)+{+ return -EAFNOSUPPORT;+}+int dummy\_icmpv6\_err\_convert(u8 type, u8 code, int \*err)+{+ return -EAFNOSUPPORT;+}+void dummy\_ipv6\_icmp\_error(struct sock \*sk, struct sk\_buff \*skb, int err,+ \_\_be16 port, u32 info, u8 \*payload) {}+int dummy\_ipv6\_chk\_addr(struct net \*net, const struct in6\_addr \*addr,+ struct net\_device \*dev, int strict)+{+ return 0;+}++int \_\_init pingv6\_init(void)+{+ pingv6\_ops.ipv6\_recv\_error = ipv6\_recv\_error;+ pingv6\_ops.ip6\_datagram\_recv\_ctl = ip6\_datagram\_recv\_ctl;+ pingv6\_ops.icmpv6\_err\_convert = icmpv6\_err\_convert;+ pingv6\_ops.ipv6\_icmp\_error = ipv6\_icmp\_error;+ pingv6\_ops.ipv6\_chk\_addr = ipv6\_chk\_addr;+ return inet6\_register\_protosw(&pingv6\_protosw);+}++/\* This never gets called because it's not possible to unload the ipv6 module,+ \* but just in case.+ \*/+void pingv6\_exit(void)+{+ pingv6\_ops.ipv6\_recv\_error = dummy\_ipv6\_recv\_error;+ pingv6\_ops.ip6\_datagram\_recv\_ctl = dummy\_ip6\_datagram\_recv\_ctl;+ pingv6\_ops.icmpv6\_err\_convert = dummy\_icmpv6\_err\_convert;+ pingv6\_ops.ipv6\_icmp\_error = dummy\_ipv6\_icmp\_error;+ pingv6\_ops.ipv6\_chk\_addr = dummy\_ipv6\_chk\_addr;+ inet6\_unregister\_protosw(&pingv6\_protosw);+}++int ping\_v6\_sendmsg(struct kiocb \*iocb, struct sock \*sk, struct msghdr \*msg,+ size\_t len)+{+ struct inet\_sock \*inet = inet\_sk(sk);+ struct ipv6\_pinfo \*np = inet6\_sk(sk);+ struct icmp6hdr user\_icmph;+ int addr\_type;+ struct in6\_addr \*daddr;+ int iif = 0;+ struct flowi6 fl6;+ int err;+ int hlimit;+ struct dst\_entry \*dst;+ struct rt6\_info \*rt;+ struct pingfakehdr pfh;++ pr\_debug("ping\_v6\_sendmsg(sk=%p,sk->num=%u)\n", inet, inet->inet\_num);++ err = ping\_common\_sendmsg(AF\_INET6, msg, len, &user\_icmph,+ sizeof(user\_icmph));+ if (err)+ return err;++ if (msg->msg\_name) {+ struct sockaddr\_in6 \*u = (struct sockaddr\_in6 \*) msg->msg\_name;+ if (msg->msg\_namelen < sizeof(struct sockaddr\_in6) ||+ u->sin6\_family != AF\_INET6) {+ return -EINVAL;+ }+ if (sk->sk\_bound\_dev\_if &&+ sk->sk\_bound\_dev\_if != u->sin6\_scope\_id) {+ return -EINVAL;+ }+ daddr = &(u->sin6\_addr);+ iif = u->sin6\_scope\_id;+ } else {+ if (sk->sk\_state != TCP\_ESTABLISHED)+ return -EDESTADDRREQ;+ daddr = &np->daddr;+ }++ if (!iif)+ iif = sk->sk\_bound\_dev\_if;++ addr\_type = ipv6\_addr\_type(daddr);+ if (\_\_ipv6\_addr\_needs\_scope\_id(addr\_type) && !iif)+ return -EINVAL;+ if (addr\_type & IPV6\_ADDR\_MAPPED)+ return -EINVAL;++ /\* TODO: use ip6\_datagram\_send\_ctl to get options from cmsg \*/++ memset(&fl6, 0, sizeof(fl6));++ fl6.flowi6\_proto = IPPROTO\_ICMPV6;+ fl6.saddr = np->saddr;+ fl6.daddr = \*daddr;+ fl6.fl6\_icmp\_type = user\_icmph.icmp6\_type;+ fl6.fl6\_icmp\_code = user\_icmph.icmp6\_code;+ security\_sk\_classify\_flow(sk, flowi6\_to\_flowi(&fl6));++ if (!fl6.flowi6\_oif && ipv6\_addr\_is\_multicast(&fl6.daddr))+ fl6.flowi6\_oif = np->mcast\_oif;+ else if (!fl6.flowi6\_oif)+ fl6.flowi6\_oif = np->ucast\_oif;++ dst = ip6\_sk\_dst\_lookup\_flow(sk, &fl6, daddr, 1);+ if (IS\_ERR(dst))+ return PTR\_ERR(dst);+ rt = (struct rt6\_info \*) dst;++ np = inet6\_sk(sk);+ if (!np)+ return -EBADF;++ if (!fl6.flowi6\_oif && ipv6\_addr\_is\_multicast(&fl6.daddr))+ fl6.flowi6\_oif = np->mcast\_oif;+ else if (!fl6.flowi6\_oif)+ fl6.flowi6\_oif = np->ucast\_oif;++ pfh.icmph.type = user\_icmph.icmp6\_type;+ pfh.icmph.code = user\_icmph.icmp6\_code;+ pfh.icmph.checksum = 0;+ pfh.icmph.un.echo.id = inet->inet\_sport;+ pfh.icmph.un.echo.sequence = user\_icmph.icmp6\_sequence;+ pfh.iov = msg->msg\_iov;+ pfh.wcheck = 0;+ pfh.family = AF\_INET6;++ if (ipv6\_addr\_is\_multicast(&fl6.daddr))+ hlimit = np->mcast\_hops;+ else+ hlimit = np->hop\_limit;+ if (hlimit < 0)+ hlimit = ip6\_dst\_hoplimit(dst);++ err = ip6\_append\_data(sk, ping\_getfrag, &pfh, len,+ 0, hlimit,+ np->tclass, NULL, &fl6, rt,+ MSG\_DONTWAIT, np->dontfrag);++ if (err) {+ ICMP6\_INC\_STATS\_BH(sock\_net(sk), rt->rt6i\_idev,+ ICMP6\_MIB\_OUTERRORS);+ ip6\_flush\_pending\_frames(sk);+ } else {+ err = icmpv6\_push\_pending\_frames(sk, &fl6,+ (struct icmp6hdr \*) &pfh.icmph,+ len);+ }++ return err;+} |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-26 02:10:20 +0000


