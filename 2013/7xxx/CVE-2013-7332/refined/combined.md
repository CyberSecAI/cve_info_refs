=== Content from soroush.secproject.com_8366f319_20250125_160827.html ===


# [Soroush Dalili (@irsdl) Blog](https://soroush.me/blog/)

## A web application security ninja ü•∑, a semicolon enthusiast!

Menu
[Skip to content](#content)

* [Home](https://soroush.me/blog/)
* [Advisories](https://soroush.me/blog/my-advisories/)
* [Privacy Policy](https://soroush.me/blog/privacy-policy/)
* [Bug Bounty Invites!](https://soroush.me/blog/bug-bounty-invites/)
* [Work](https://www.secproject.com/)
* [Sponsorship](https://soroush.me/blog/sponsorship/)

# Microsoft XMLDOM in IE can divulge information of local drive/network in error messages ‚Äì XXE

While I was testing a XML Injection vulnerability, I became interested in the W3Schools DTD Validator example that can only work in IE: <http://www.w3schools.com/dtd/dtd_validation.asp>¬†([updated 24/10/2016] ‚Äì link mirror: [https://web.archive.org/web/20130424001426/http://w3schools.com/dtd/dtd\_validation.asp](https://web.archive.org/web/20130424001426/http%3A//w3schools.com/dtd/dtd_validation.asp)). As a result, after I finished my testing, I started playing with this Microsoft XMLDOM object to see if it is vulnerable.

I created the following test case to manipulate the ‚Äú$target$‚Äù value and validate it to see the results:

```

validateXML('<?xml version="1.0" ?><!DOCTYPE anything SYSTEM "$target$">')

function validateXML(txt) {
    // code for IE
    if (window.ActiveXObject) {
        var xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
        xmlDoc.async = true;
        try {
            xmlDoc.loadXML(txt);
			if (xmlDoc.parseError.errorCode != 0) {
				var err;
				err = "Error Code: " + xmlDoc.parseError.errorCode + "\n";
				err += "Error Reason: " + xmlDoc.parseError.reason;
				err += "Error Line: " + xmlDoc.parseError.line;
				alert(err);
				var errReason = xmlDoc.parseError.reason.toLowerCase();
				alert(errReason);
			} else {
                alert('No Error? Unknown!')
			}
        } catch (e) {
            alert(e);
        }

    } else {
        alert('you need to use IE')
    }
}

```

You can see this JS in action via this link in IE: <http://jsfiddle.net/ubqug/>

#### **Detecting files in the C drive:**

I tried different local file paths to see if I can include a file from the local file system. The results of the following test cases are the same ‚Äì ‚ÄúAccess is denied.‚Äù:

$target$=file://c:/windows/system32/calc.exe

$target$=file://c:/windows/system32/invalid.exe

See this link: <http://jsfiddle.net/ubqug/1/>

I thought I might be able to use ‚Äú\\localhost‚Äù or ‚Äú\\127.0.0.1‚Äù instead of using ‚Äúfile‚Äù protocol:

$target$ = \\127.0.0.1\c$\windows\system32\calc.exe

$target$ = \\127.0.0.1\c$\windows\system32\invalid.exe

The result was the same again; however, I did not receive an ‚Äúaccess denied‚Äù error this time! See this link: <http://jsfiddle.net/ubqug/2/>

At this point, I used Sysinternals Suite Process Monitor to monitor the file system and I realised that in the previous example, it was looking for ‚Äúc$‚Äù folder in the C drive!

Therefore, I removed ‚Äúc$‚Äù from my targets and ran the test again:

$target$ = \\127.0.0.1\windows\system32\calc.exe

$target$ = \\127.0.0.1\windows\system32\invalid.exe

The result was promising as I received ‚ÄúUnspecified error‚Äù for the file that was available on my file system. See this: <http://jsfiddle.net/ubqug/3/>

So, I found my first bypass to detect available files on the C drive.

I also found more vectors to find files on the C drive and it turned out that I can get the same result by using ‚Äúfile:\‚Äù and ‚Äúfile:\\localhost\‚Äù instead of ‚Äúfile:\\‚Äù! See this link: <http://jsfiddle.net/ubqug/4/>

#### **Detecting valid folders in C drive:**

It was possible to find the valid folders on C drive by using the same technique as the error messages were a little bit different in case of having a valid or an invalid folder:

$target$ = \\localhost\windows\

$target$ = \\localhost\invalidfolder\

Try it in: <http://jsfiddle.net/ubqug/6/> ‚Äì in case of an invalid folder the message will be: ‚Äúthe system cannot locate the object ‚Ä¶‚Äù. When a folder is valid we will have: ‚Äúthe system cannot find the path ‚Ä¶‚Äù

I also found out if I use NTFS ADS (Alternate Data Streams) that are related to files and not the directories such as ‚Äú::$DATA‚Äù I would receive different error messages to detect the valid folders (‚Äúaccess denied‚Äù versus the ‚Äúthe system cannot locate the object ‚Ä¶‚Äù):

$target$ = \\localhost\windows::$DATA

$target$ = \\localhost\invalidfolder::$DATA

See the result in this link: <http://jsfiddle.net/ubqug/7/>

#### **Detecting files and directories in all drives:**

At this point during my testing, I had a limitation and I could not detect my files in any drive other than the C drive by using the previous vectors. Vectors like ‚Äúfile:/e:/‚Äù or ‚Äú\\localhost\e$‚Äù did not work.

I solved this problem by using ‚Äúres://‚Äù protocol ([http://msdn.microsoft.com/en-us/library/aa767740(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/aa767740%28v%3Dvs.85%29.aspx)) and I received different error messages by pointing to the files or folders.

$target$ = res://d:\validfile.txt

$target$ = res://d:\invalidfile.txt

See the results here (you need to create the ‚Äúvalidfile.txt‚Äù file in your D drive or change the path): <http://jsfiddle.net/ubqug/5/>

#### **Detecting available drives:**

In order to make the results more accurate, I had to find the available drive letters on the box. Unfortunately ‚Äúres://‚Äù protocol was not helpful in this case and I had to use another solution. The solution that I found was in fact very easy. I could use the drive letters directly; if the drive letter is available, the error message would be ‚Äúaccess denied‚Äù and when it is not available, the error message changes to ‚Äúthe system cannot find the path specified‚Äù:

$target$ = c:\

$target$ = invalid:\

See the results in <http://jsfiddle.net/ubqug/8/>

#### **Detecting available Windows internal network addresses or internal websites:**

During my tests, I realised that I can send http request to local sites or IP addresses, and I can point to network shares as well. In this case, it would give me an error immediately if the target was valid. However, it could take between 10 to 60 seconds to come back with an error when it could not receive a response from the target! I used this technique to detect valid local IP/Name addresses. However, as it does take a long time to identify an invalid target, it is not appropriate for scanning.

#### **Denial of Service:**

Like many other DTD parsers, XMLDOM object was also vulnerable to denial of service. I did not even try hard to find the issue and I used an example in the following link from MSDN Magazine:

<http://msdn.microsoft.com/en-us/magazine/ee335713.aspx>

#### **Summary:**

I have created a **PoC page** to test the above techniques in one page which can be found via:¬†[http://0me.me/demo/IE/dtdTest.html](http://0me.me/demo/IE/dtdTest.html "PoC")

I also searched in Google and I found out that the general topic of these issues have been mentioned in the following link from Microsoft:

[http://msdn.microsoft.com/en-gb/library/windows/desktop/ms754611(v=vs.85).aspx](http://msdn.microsoft.com/en-gb/library/windows/desktop/ms754611%28v%3Dvs.85%29.aspx)

See the ‚ÄúThreats and Mitigation‚Äù section in the link above.

At the moment this issue is a client side issue and only works in IE. I published it as the impacts are low (limited information disclosure vulnerability) and you cannot read the file contents with the vectors that I have found (only worthless local DTD files are partially readable). However, this research can be very valuable to people who are looking for the new vectors in finding/exploiting XML vulnerabilities (for example in Java ‚Äì I do not have time to test this at the moment) ‚Äì obviously in legal and legitimate research/pentest projects ;)

**Once again, the PoC page is:¬†[http://0me.me/demo/IE/dtdTest.html](http://0me.me/demo/IE/dtdTest.html "PoC")**

This entry was posted in [My Advisories](https://soroush.me/blog/category/myadvisories/), [Security Posts](https://soroush.me/blog/category/securityposts/) and tagged [denial of service](https://soroush.me/blog/tag/denial-of-service/), [dtd](https://soroush.me/blog/tag/dtd/), [information disclosure](https://soroush.me/blog/tag/information-disclosure/), [msxml](https://soroush.me/blog/tag/msxml/), [XML External Entity](https://soroush.me/blog/tag/xml-external-entity/), [xml injection](https://soroush.me/blog/tag/xml-injection/), [xmldom](https://soroush.me/blog/tag/xmldom/), [xxe](https://soroush.me/blog/tag/xxe/) on [April 25, 2013](https://soroush.me/blog/2013/04/microsoft-xmldom-in-ie-can-divulge-information-of-local-drivenetwork-in-error-messages/ "22:22") by [Soroush Dalili](https://soroush.me/blog/author/soroush/ "View all posts by Soroush Dalili").

### Post navigation

[‚Üê IE/Firefox Redirection Issue ‚Äì FB Oauth2 Bypass ‚Äì BugCrowd](https://soroush.me/blog/2013/03/iefirefox-redirection-issue-fb-oauth2-bypass-bugcrowd/)
[Simple Security Tip: window.location = window.location.pathname can cause Open-Redirect issue! ‚Üí](https://soroush.me/blog/2013/09/simple-security-tip-window-location-window-location-pathname-can-cause-open-redirect-issue/)

![](https://soroush.me/blog/wp-content/uploads/2023/07/cropped-Twitter_400x400-150x150.jpg)

* [Twitter](https://twitter.com/irsdl)
* [GitHub](https://github.com/irsdl)
* [LinkedIn](https://www.linkedin.com/in/sdalili/)
SearchSearch

* [MongoDB NoSQL Injection with Aggregation Pipelines](https://soroush.me/blog/2024/06/mongodb-nosql-injection-with-aggregation-pipelines/)June 23, 2024
* [Cookieless DuoDrop: IIS Auth Bypass & App Pool Privesc in ASP.NET Framework (CVE-2023-36899 & CVE-2023-36560)](https://soroush.me/blog/2023/08/cookieless-duodrop-iis-auth-bypass-app-pool-privesc-in-asp-net-framework-cve-2023-36899/)August 8, 2023
* [Anchor Tag XSS Exploitation in Firefox with Target=‚Äù\_blank‚Äù](https://soroush.me/blog/2023/08/anchor-tag-xss-exploitation-in-firefox-with-target_blank/)August 1, 2023
* [Thirteen Years On: Advancing the Understanding of IIS Short File Name (SFN) Disclosure!](https://soroush.me/blog/2023/07/thirteen-years-on-advancing-the-understanding-of-iis-short-file-name-sfn-disclosure/)July 31, 2023
* [My MDSec Blog Posts so far in 2020/2021!](https://soroush.me/blog/2020/10/mdsec-blog-posts-so-far-in-2020/)October 31, 2020
* [File Upload Attack using XAMLX Files](https://soroush.me/blog/2019/09/file-upload-attack-using-xamlx-files/)September 21, 2019
* [Uploading web.config for Fun and Profit 2](https://soroush.me/blog/2019/08/uploading-web-config-for-fun-and-profit-2/)August 15, 2019
* [IIS Application vs. Folder Detection During Blackbox Testing](https://soroush.me/blog/2019/07/iis-application-vs-folder-detection-during-blackbox-testing/)July 9, 2019
* [Danger of Stealing Auto Generated .NET Machine Keys](https://soroush.me/blog/2019/05/danger-of-stealing-auto-generated-net-machine-keys/)May 10, 2019
* [x-up-devcap-post-charset Header in ASP.NET to Bypass WAFs Again!](https://soroush.me/blog/2019/05/x-up-devcap-post-charset-header-in-aspnet-to-bypass-wafs-again/)May 4, 2019
* [Exploiting Deserialisation in ASP.NET via ViewState](https://soroush.me/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)April 23, 2019
* [Yet Other Examples of Abusing CSRF in Logout](https://soroush.me/blog/2019/04/yet-other-examples-of-abusing-csrf-in-logout/)April 23, 2019
* [How to win BIG and even more!](https://soroush.me/blog/2019/04/how-to-win-big-and-even-more/)April 17, 2019
* [Finding and Exploiting .NET Remoting over HTTP using Deserialisation](https://soroush.me/blog/2019/03/finding-and-exploiting-net-remoting-over-http-using-deserialisation/)March 26, 2019
* [More research on .NET deserialization](https://soroush.me/blog/2018/12/more-research-on-net-deserialization/)December 19, 2018
* [Feel honoured to be there again after 8 years: Top 10 Web Hacking Techniques of 2017](https://soroush.me/blog/2018/12/feel-honoured-to-be-there-again-after-8-years-top-10-web-hacking-techniques-of-2017/)December 19, 2018
* [Story of my two (but actually three) RCEs in SharePoint in 2018](https://soroush.me/blog/2018/12/story-of-two-published-rces-in-sharepoint-workflows/)December 19, 2018
* [ASP.NET resource files (.RESX) and deserialization issues](https://soroush.me/blog/2018/08/asp-net-resource-files-resx-and-deserialization-issues/)August 12, 2018
* [MS 2018 Q4 ‚Äì Top 5 Bounty Hunter for 2 RCEs in SharePoint Online](https://soroush.me/blog/2018/08/ms-2018-q4-top-5-bounty-hunter-for-2-rces-in-sharepoint-online/)August 12, 2018
* [WAF Bypass Techniques ‚Äì Using HTTP Standard and Web Servers‚Äô Behaviour](https://soroush.me/blog/2018/08/waf-bypass-techniques-using-http-standard-and-web-servers-behaviour/)August 12, 2018
Archives
Select Year  2024 ¬†(1)
 2023 ¬†(3)
 2020 ¬†(1)
 2019 ¬†(9)
 2018 ¬†(9)
 2017 ¬†(4)
 2016 ¬†(1)
 2015 ¬†(4)
 2014 ¬†(6)
 2013 ¬†(6)
 2012 ¬†(10)
 2011 ¬†(3)
 2010 ¬†(13)
 2009 ¬†(5)
### Blog Tags

* [.Net Framework](https://soroush.me/blog/tag/net-framework/)
* [Anti-XSS bypass](https://soroush.me/blog/tag/anti-xss-bypass/)
* [AntiXSS bypass](https://soroush.me/blog/tag/antixss-bypass/)
* [ASP.NET](https://soroush.me/blog/tag/asp-net/)
* [bug bounty](https://soroush.me/blog/tag/bug-bounty/)
* [bugbounty](https://soroush.me/blog/tag/bugbounty/)
* [bypass](https://soroush.me/blog/tag/bypass/)
* [Challenge](https://soroush.me/blog/tag/challenge/)
* [deserialisation](https://soroush.me/blog/tag/deserialisation/)
* [deserialization](https://soroush.me/blog/tag/deserialization/)
* [ecommerce](https://soroush.me/blog/tag/ecommerce/)
* [ExternalInterface](https://soroush.me/blog/tag/externalinterface/)
* [ExternalInterface.call](https://soroush.me/blog/tag/externalinterface-call/)
* [file upload](https://soroush.me/blog/tag/file-upload/)
* [file upload bypass](https://soroush.me/blog/tag/file-upload-bypass/)
* [file uploader bypass methods](https://soroush.me/blog/tag/file-uploader-bypass-methods/)
* [file uploader security bypass](https://soroush.me/blog/tag/file-uploader-security-bypass/)
* [financial](https://soroush.me/blog/tag/financial/)
* [flash](https://soroush.me/blog/tag/flash/)
* [flash xss](https://soroush.me/blog/tag/flash-xss/)
* [guideline](https://soroush.me/blog/tag/guideline/)
* [iis](https://soroush.me/blog/tag/iis/)
* [IIS File Extension Security Bypass](https://soroush.me/blog/tag/iis-file-extension-security-bypass/)
* [iis short file name](https://soroush.me/blog/tag/iis-short-file-name/)
* [IIS Tilde bug](https://soroush.me/blog/tag/iis-tilde-bug/)
* [IIS tilde feature](https://soroush.me/blog/tag/iis-tilde-feature/)
* [IIS tilde vulnerability](https://soroush.me/blog/tag/iis-tilde-vulnerability/)
* [jar protocol](https://soroush.me/blog/tag/jar-protocol/)
* [machine.config](https://soroush.me/blog/tag/machine-config/)
* [machinekey](https://soroush.me/blog/tag/machinekey/)
* [penetration testing](https://soroush.me/blog/tag/penetration-testing/)
* [RCE](https://soroush.me/blog/tag/rce/)
* [request encoding](https://soroush.me/blog/tag/request-encoding/)
* [sharepoint](https://soroush.me/blog/tag/sharepoint/)
* [Short name scanner](https://soroush.me/blog/tag/short-name-scanner/)
* [SQL Injection](https://soroush.me/blog/tag/sql-injection/)
* [Unrestricted File Download](https://soroush.me/blog/tag/unrestricted-file-download/)
* [Unrestricted File Upload](https://soroush.me/blog/tag/unrestricted-file-upload/)
* [viewstate](https://soroush.me/blog/tag/viewstate/)
* [waf](https://soroush.me/blog/tag/waf/)
* [WAF bypass](https://soroush.me/blog/tag/waf-bypass/)
* [web.config](https://soroush.me/blog/tag/web-config/)
* [XSS](https://soroush.me/blog/tag/xss/)
* [XSS Vulnerability](https://soroush.me/blog/tag/xss-vulnerability/)
* [ysoserial.net](https://soroush.me/blog/tag/ysoserial-net/)

### [RSS](https://www.reddit.com/r/websecurityresearch/.rss) [REDDIT Web Security Research](https://www.reddit.com/r/websecurityresearch/)

* [Stealing HttpOnly cookies with the cookie sandwich technique](https://www.reddit.com/r/websecurityresearch/comments/1i7dcjy/stealing_httponly_cookies_with_the_cookie/) January 22, 2025 /u/albinowax
* [Next.js, cache, and chains: the stale elixir](https://www.reddit.com/r/websecurityresearch/comments/1i779kp/nextjs_cache_and_chains_the_stale_elixir/) January 22, 2025 /u/albinowax
* [Vote for the Top Ten (new) Web Hacking Techniques of 2024](https://www.reddit.com/r/websecurityresearch/comments/1i20lqm/vote_for_the_top_ten_new_web_hacking_techniques/) January 15, 2025 /u/albinowax
* [Exploiting SSTI in a Modern Spring Boot Application (3.3.4)](https://www.reddit.com/r/websecurityresearch/comments/1hy3ci8/exploiting_ssti_in_a_modern_spring_boot/) January 10, 2025 /u/albinowax
* [WorstFit: Unveiling Hidden Transformers in Windows ANSI!](https://www.reddit.com/r/websecurityresearch/comments/1hxg7ug/worstfit_unveiling_hidden_transformers_in_windows/) January 9, 2025 /u/albinowax
* [Abuse a time-based blind SQL injection by customizing SQLMAP](https://www.reddit.com/r/websecurityresearch/comments/1hx96k8/abuse_a_timebased_blind_sql_injection_by/) January 9, 2025 /u/Hackmosphere
* [Bypassing File Upload Restrictions To Exploit Client-Side Path Traversal](https://www.reddit.com/r/websecurityresearch/comments/1hx93gj/bypassing_file_upload_restrictions_to_exploit/) January 9, 2025 /u/albinowax
* [Call for nominations: Top ten web hacking techniques of 2024](https://www.reddit.com/r/websecurityresearch/comments/1hwl5uo/call_for_nominations_top_ten_web_hacking/) January 8, 2025 /u/albinowax
* [From Arbitrary File Write to RCE in Restricted Rails apps](https://www.reddit.com/r/websecurityresearch/comments/1hrvw4o/from_arbitrary_file_write_to_rce_in_restricted/) January 2, 2025 /u/albinowax
* [New widespread client side web attack vector](https://www.reddit.com/r/websecurityresearch/comments/1hr5lk7/new_widespread_client_side_web_attack_vector/) January 1, 2025 /u/inlovewithhacking
### [RSS](http://www.reddit.com/r/netsec/.rss) [Reddit netsec Channel Feed](https://www.reddit.com/r/netsec/)

* [Someone wrote an Anti-Crawler/Scraper Trap](https://www.reddit.com/r/netsec/comments/1i93pzl/someone_wrote_an_anticrawlerscraper_trap/) January 24, 2025
* [USB Army Knife: Close Access Pentest Tool with VNC, Marauder, network adapter etc.](https://www.reddit.com/r/netsec/comments/1i8rdf5/usb_army_knife_close_access_pentest_tool_with_vnc/) January 24, 2025
* [Static Source Code Security Scanning Tools Evaluation Benchmark](https://www.reddit.com/r/netsec/comments/1i8q5mc/static_source_code_security_scanning_tools/) January 24, 2025
* [WinVisor: A proof-of-concept hypervisor-based emulator for Windows x64 binaries](https://www.reddit.com/r/netsec/comments/1i8nnii/winvisor_a_proofofconcept_hypervisorbased/) January 24, 2025
* [Introduction to Fuzzing Android Native Components: Strategies for Harness Creation](https://www.reddit.com/r/netsec/comments/1i8ef23/introduction_to_fuzzing_android_native_components/) January 23, 2025
### [RSS](https://www.exploit-db.com/rss.xml) [Exploit-DB Feed](https://www.exploit-db.com/)

* [[webapps] SOPlanning 1.52.01 (Simple Online Planning Tool) - Remote Code Execution (RCE) (Authenticated)](https://www.exploit-db.com/exploits/52082)
* [[webapps] reNgine 2.2.0 - Command Injection (Authenticated)](https://www.exploit-db.com/exploits/52081)
* [[webapps] dizqueTV 1.5.3 - Remote Code Execution (RCE)](https://www.exploit-db.com/exploits/52079)
* [[webapps] openSIS 9.1 - SQLi (Authenticated)](https://www.exploit-db.com/exploits/52080)
* [[dos] Windows TCP/IP - RCE Checker and Denial of Service](https://www.exploit-db.com/exploits/52075)

[Privacy Policy](https://soroush.me/blog/privacy-policy/) [Proudly powered by WordPress](https://wordpress.org/ "Semantic Personal Publishing Platform")


