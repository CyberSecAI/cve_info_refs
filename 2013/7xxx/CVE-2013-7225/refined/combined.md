=== Content from github.com_7eb01203_20250125_043437.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fwiki%2FFixing-security-vulnerabilities-%252827th-Dec-2013%2529)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fwiki%2FFixing-security-vulnerabilities-%252827th-Dec-2013%2529)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fwiki%2Fshow&source=header-repo&source_repo=fatfreecrm%2Ffat_free_crm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fatfreecrm](/fatfreecrm)
/
**[fat\_free\_crm](/fatfreecrm/fat_free_crm)**
Public

* [Notifications](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)
* [Star
   3.6k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)

* [Code](/fatfreecrm/fat_free_crm)
* [Issues
  65](/fatfreecrm/fat_free_crm/issues)
* [Pull requests
  10](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects
  0](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

Additional navigation options

* [Code](/fatfreecrm/fat_free_crm)
* [Issues](/fatfreecrm/fat_free_crm/issues)
* [Pull requests](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

# Fixing security vulnerabilities (27th Dec 2013)

[Jump to bottom](#wiki-pages-box)
 [Edit](/fatfreecrm/fat_free_crm/wiki/Fixing-security-vulnerabilities-%2827th-Dec-2013%29/_edit)
 [New page](/fatfreecrm/fat_free_crm/wiki/_new)

Steve Kenworthy edited this page Jan 3, 2014
Â·
[5 revisions](/fatfreecrm/fat_free_crm/wiki/Fixing-security-vulnerabilities-%2827th-Dec-2013%29/_history)

## Fixing security vulnerabilities (27th Dec 2013)

Several serious security flaws have been discovered which affect **all prior versions** of Fat Free CRM.

### Impact

This includes the following:

* several SQL injection attack points (via the homepage timeline and activity features - requires user to be logged in to perform an attack) CVE-2013-7225
* leakage of user data including password hashes and salts (logged in users are able to view password hashes of other users via json requests.) CVE-2013-7224 and CVE-2013-7249
* lack of support for cycling the Rails session secret (Users are now forced to run rake ffcrm:secret when setting up a new instance) see CVE-2013-7222
* `protect_from_forgery` was turned off by default CVE-2013-7223

### Releases

Please upgrade your instance immediately to the latest gem versions **0.13.0** and **0.12.1** or grab the latest code from the github master branch. Note: you will be required to run "rake ffcrm:secret" before the server will restart. This will generate a new secret token for you in config/initializers/secret\_token.rb

For those who are unable to upgrade, please use the workarounds section below to patch your existing system.

### Ongoing security work and reporting

We will be conducting a security audit over the next little while to review the codebase for flaws.

It's no secret that the FFCRM codebase is very old in parts and desperately needs an overhaul. For those who are willing, we'd welcome the help. If you build your business on this, we'd ask you to consider giving back time and effort. Currently, this is entirely a volunteer maintained project.

**For those who do find serious flaws, for the time being, please report discretely to steveyken@gmail.com**

### Workarounds

For those who are unable to upgrade, the following procedures should be applied to patch your existing system. You can either patch your code by cherry-picking the following commits or follow the manual procedure further below.

```
git fetch origin
git cherry-pick 93c182dd4c6f3620b721d2a15ba6a6ecab5669df   # Strengthen case to generate unique secret token.
git cherry-pick a7fedbb36388bad0c0f32b2346481e0ea126dea6   # Ensure requests are protected
git cherry-pick cf26a04b356ad2161c4c6160260eb870a3de5328   # Add custom serializers for xml and json.
git cherry-pick 078035f1ef73ed85285ac9d128c3c5f670cef066   # Fixed sql injection in timeline method.
git cherry-pick d4b2de81a4d8c1b201482edcb2488ed9280a65fd   # Refactor activity_user to remove possible SQL injection points.

```

#### Manual updates

1.. Rotate your secret token (if you haven't already, i.e. don't use the default version that Fat Free CRM provides.) Note: this is true of any other rails project you 'clone' from a public source.

To do this manually, open `irb` and type the following:

```
require 'securerandom'
SecureRandom.hex(64)

```

Then paste the result into `config/initializers/secret_token.rb`.

Note: the main reason for cycling this in your own project is that the secret token should not be publicly visible. If it's checked in on your github fork, it is publicly visible. More reading here: <http://robertheaton.com/2013/07/22/how-to-hack-a-rails-app-using-its-secret-token/>

2.. Add `protect_from_forgery` to ApplicationController.

In `app/controllers/application_controller.rb`, change add `protect_from_forgery` to the beginning of the class. This will prevent many types of CSRF attacks.

```
class ApplicationController < ActionController::Base

  protect_from_forgery

  ...rest of file

```

3.. Add the following method to your user class (before the private declaration) to stop important details being leaked via json. This is particularly serious as it enables any logged in user to view the password hash/salt of any other user. (Note: this does NOT disclose plain text passwords but, regardless, is still very serious.)

In `app/models/users/user.rb`, add the following lines above the 'private' keyword.

```
  def to_json(options = nil)
    [name].to_json
  end

  def to_xml(options = nil)
    [name].to_xml
  end

```

In `config/routes.rb`, change

```
resources :users, :id => /\d+/ do

```

to

```
resources :users, :id => /\d+/, :except => [:index, :destroy] do

```

4.. Patch the following code in `app/controllers/home_controller.rb`

This replaces two methods that had SQL injection vulnerabilities with code that sanitizes user input properly.

* Replace the `timeline` method with:

```
  def timeline
    state = params[:state].to_s
    if %w(Collapsed Expanded).include?(state)
      if (model_type = params[:type].to_s).present?
        if %w(comment email).include?(model_type)
          model = model_type.camelize.constantize
          item = model.find(params[:id])
          item.update_attribute(:state, state)
        end
      else
        comments, emails = params[:id].split("+")
        Comment.where(:id => comments.split(',')).update_all(:state => state) unless comments.blank?
        Email.where(:id => emails.split(',')).update_all(:state => state) unless emails.blank?
      end
    end

    render :nothing => true
  end

```

* and replace the `activity_user` method with

```
def activity_user
    user = current_user.pref[:activity_user]
    if user && user != "all_users"
      user = if user =~ /@/ # email
          User.where(:email => user).first
        else # first_name middle_name last_name any_name
          name_query = if user.include?(" ")
            user.name_permutations.map{ |first, last|
              User.where(:first_name => first, :last_name => last)
            }.map(&:to_a).flatten.first
          else
            [User.where(:first_name => user), User.where(:last_name => user)].map(&:to_a).flatten.first
          end
        end
    end
    user.is_a?(User) ? user.id : nil
  end

```

Please note: these methods are slated for an upgrade soon. Whilst it's tempting to refactor more fully right now, the focus has to be on locking them down with minimal changes for you.

Azar Aliyev

### Toggle table of contents Pages 47

* Loading

  [Home](/fatfreecrm/fat_free_crm/wiki)
* Loading

  [2024 Full setup on Linux WSL using MySQL](/fatfreecrm/fat_free_crm/wiki/2024-Full-setup-on-Linux-WSL-using-MySQL)
* Loading

  [Accounts](/fatfreecrm/fat_free_crm/wiki/Accounts)
* Loading

  [Available Plugins](/fatfreecrm/fat_free_crm/wiki/Available-Plugins)
* Loading

  [Callback Hooks](/fatfreecrm/fat_free_crm/wiki/Callback-Hooks)
* Loading

  [Campaigns](/fatfreecrm/fat_free_crm/wiki/Campaigns)
* Loading

  [Contacts](/fatfreecrm/fat_free_crm/wiki/Contacts)
* Loading

  [Contributing to this guide](/fatfreecrm/fat_free_crm/wiki/Contributing-to-this-guide)
* Loading

  [Creating a plugin](/fatfreecrm/fat_free_crm/wiki/Creating-a-plugin)
* Loading

  [Creating custom field plugins](/fatfreecrm/fat_free_crm/wiki/Creating-custom-field-plugins)
* Loading

  [CSRF Vulnerability (CVE 2015 1585)](/fatfreecrm/fat_free_crm/wiki/CSRF-Vulnerability-%28CVE-2015-1585%29)
* Loading

  [Customize the task categories](/fatfreecrm/fat_free_crm/wiki/Customize-the-task-categories)
* Loading

  [Discussion forums](/fatfreecrm/fat_free_crm/wiki/Discussion-forums)
* Loading

  [Docker](/fatfreecrm/fat_free_crm/wiki/Docker)
* Loading

  [Email Dropbox](/fatfreecrm/fat_free_crm/wiki/Email-Dropbox)
* Loading

  [Fat Free CRM Contributors](/fatfreecrm/fat_free_crm/wiki/Fat-Free-CRM-Contributors)
* Loading

  [Fixing security vulnerabilities (27th Dec 2013)](/fatfreecrm/fat_free_crm/wiki/Fixing-security-vulnerabilities-%2827th-Dec-2013%29)
* Loading

  [Fixing security vulnerabilities (7th jan 2014)](/fatfreecrm/fat_free_crm/wiki/Fixing-security-vulnerabilities-%287th-jan-2014%29)
* Loading

  [Frequently Asked Questions](/fatfreecrm/fat_free_crm/wiki/Frequently-Asked-Questions)
* Loading

  [Lazy Load Hooks](/fatfreecrm/fat_free_crm/wiki/Lazy-Load-Hooks)
* Loading

  [Leads](/fatfreecrm/fat_free_crm/wiki/Leads)
* Loading

  [Loading Demo Data](/fatfreecrm/fat_free_crm/wiki/Loading-Demo-Data)
* Loading

  [Localization Guidelines](/fatfreecrm/fat_free_crm/wiki/Localization-Guidelines)
* Loading

  [Navigation Bar](/fatfreecrm/fat_free_crm/wiki/Navigation-Bar)
* Loading

  [Opportunities](/fatfreecrm/fat_free_crm/wiki/Opportunities)
* Loading

  [Overview](/fatfreecrm/fat_free_crm/wiki/Overview)
* Loading

  [People Using Fat Free CRM](/fatfreecrm/fat_free_crm/wiki/People-Using-Fat-Free-CRM)
* Loading

  [Providing Feedback](/fatfreecrm/fat_free_crm/wiki/Providing-Feedback)
* Loading

  [Rake Command Reference](/fatfreecrm/fat_free_crm/wiki/Rake-Command-Reference)
* Loading

  [README](/fatfreecrm/fat_free_crm/wiki/README)
* Loading

  [Running as a Rails Engine](/fatfreecrm/fat_free_crm/wiki/Running-as-a-Rails-Engine)
* Loading

  [Running tests](/fatfreecrm/fat_free_crm/wiki/Running-tests)
* Loading

  [Security](/fatfreecrm/fat_free_crm/wiki/Security)
* Loading

  [Setup Heroku](/fatfreecrm/fat_free_crm/wiki/Setup-Heroku)
* Loading

  [Setup Linux or Mac OS](/fatfreecrm/fat_free_crm/wiki/Setup-Linux-or-Mac-OS)
* Loading

  [Setup Microsoft Windows](/fatfreecrm/fat_free_crm/wiki/Setup-Microsoft-Windows)
* Loading

  [Site wide Settings](/fatfreecrm/fat_free_crm/wiki/Site-wide-Settings)
* Loading

  [Tasks](/fatfreecrm/fat_free_crm/wiki/Tasks)
* Loading

  [The Countries Problem and How to Fix It](/fatfreecrm/fat_free_crm/wiki/The-Countries-Problem-and-How-to-Fix-It)
* Loading

  [The Permissions Tab](/fatfreecrm/fat_free_crm/wiki/The-Permissions-Tab)
* Loading

  [Translating Fat Free CRM](/fatfreecrm/fat_free_crm/wiki/Translating-Fat-Free-CRM)
* Loading

  [Ubuntu Server Setup Script](/fatfreecrm/fat_free_crm/wiki/Ubuntu-Server-Setup-Script)
* Loading

  [Upgrading Fat Free CRM](/fatfreecrm/fat_free_crm/wiki/Upgrading-Fat-Free-CRM)
* Loading

  [Using Zeus to speed up development](/fatfreecrm/fat_free_crm/wiki/Using-Zeus-to-speed-up-development)
* Loading

  [XSS vulnerabilities (4th Sept 2014)](/fatfreecrm/fat_free_crm/wiki/XSS-vulnerabilities-%284th-Sept-2014%29)
* Loading

  [XSS Vulnerability (2018 10 27)](/fatfreecrm/fat_free_crm/wiki/XSS-Vulnerability-%282018-10-27%29)
* Loading

  [XSS vulnerability (26th August 2014)](/fatfreecrm/fat_free_crm/wiki/XSS-vulnerability-%2826th-August-2014%29)
* Show 32 more pagesâ¦

[Add a custom sidebar](/fatfreecrm/fat_free_crm/wiki/_new?wiki%5Bname%5D=_Sidebar)
##### Clone this wiki locally

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canât perform that action at this time.



=== Content from github.com_0b2fe57c_20250126_060000.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fcommit%2Fd4b2de81a4d8c1b201482edcb2488ed9280a65fd)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fcommit%2Fd4b2de81a4d8c1b201482edcb2488ed9280a65fd)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fatfreecrm%2Ffat_free_crm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fatfreecrm](/fatfreecrm)
/
**[fat\_free\_crm](/fatfreecrm/fat_free_crm)**
Public

* [Notifications](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)
* [Star
   3.6k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)

* [Code](/fatfreecrm/fat_free_crm)
* [Issues
  65](/fatfreecrm/fat_free_crm/issues)
* [Pull requests
  10](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects
  0](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

Additional navigation options

* [Code](/fatfreecrm/fat_free_crm)
* [Issues](/fatfreecrm/fat_free_crm/issues)
* [Pull requests](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

## Commit

[Permalink](/fatfreecrm/fat_free_crm/commit/d4b2de81a4d8c1b201482edcb2488ed9280a65fd)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Refactor activity\_user to remove possible SQL injection points.

[Browse files](/fatfreecrm/fat_free_crm/tree/d4b2de81a4d8c1b201482edcb2488ed9280a65fd)
Browse the repository at this point in the history

* Loading branch information

[![@steveyken](https://avatars.githubusercontent.com/u/149198?s=40&v=4)](/steveyken)

[steveyken](/fatfreecrm/fat_free_crm/commits?author=steveyken "View all commits by steveyken")
committed
Dec 27, 2013

1 parent
[078035f](/fatfreecrm/fat_free_crm/commit/078035f1ef73ed85285ac9d128c3c5f670cef066)

commit d4b2de8

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**10 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app/controllers

  + app/controllers/home\_controller.rb
    [home\_controller.rb](#diff-2e1b0bda5d1af14b6acbbff496f78d7343528dcd5d1f58aa7259c9b73f2deb5a)
* spec/controllers

  + spec/controllers/home\_controller\_spec.rb
    [home\_controller\_spec.rb](#diff-77044ce093cea55ebee68eb38316c01fbe0213a0f63849dfa2f015c9b150e7a5)

## There are no files selected for viewing

10 changes: 6 additions & 4 deletions

10
[app/controllers/home\_controller.rb](#diff-2e1b0bda5d1af14b6acbbff496f78d7343528dcd5d1f58aa7259c9b73f2deb5a "app/controllers/home_controller.rb")

Show comments

[View file](/fatfreecrm/fat_free_crm/blob/d4b2de81a4d8c1b201482edcb2488ed9280a65fd/app/controllers/home_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -122,6 +122,9 @@ def activity\_event |
|  |  | end |
|  |  |  |
|  |  | #---------------------------------------------------------------------------- |
|  |  | # TODO: this is ugly, ugly code. It's being security patched now but urgently |
|  |  | # needs refactoring to use user id instead. Permuations based on name or email |
|  |  | # yield incorrect results. |
|  |  | def activity\_user |
|  |  | user = current\_user.pref[:activity\_user] |
|  |  | if user && user != "all\_users" |
| Expand All | | @@ -130,12 +133,11 @@ def activity\_user |
|  |  | else # first\_name middle\_name last\_name any\_name |
|  |  | name\_query = if user.include?(" ") |
|  |  | user.name\_permutations.map{ |first, last| |
|  |  | "(upper(first\_name) LIKE upper('%#{first}%') AND upper(last\_name) LIKE upper('%#{last}%'))" |
|  |  | }.join(" OR ") |
|  |  | User.where(:first\_name => first, :last\_name => last) |
|  |  | }.map(&:to\_a).flatten.first |
|  |  | else |
|  |  | "upper(first\_name) LIKE upper('%#{user}%') OR upper(last\_name) LIKE upper('%#{user}%')" |
|  |  | [User.where(:first\_name => user), User.where(:last\_name => user)].map(&:to\_a).flatten.first |
|  |  | end |
|  |  | User.where(name\_query).first |
|  |  | end |
|  |  | end |
|  |  | user.is\_a?(User) ? user.id : nil |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[spec/controllers/home\_controller\_spec.rb](#diff-77044ce093cea55ebee68eb38316c01fbe0213a0f63849dfa2f015c9b150e7a5 "spec/controllers/home_controller_spec.rb")

Show comments

[View file](/fatfreecrm/fat_free_crm/blob/d4b2de81a4d8c1b201482edcb2488ed9280a65fd/spec/controllers/home_controller_spec.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -171,14 +171,16 @@ |
|  |  | it "should find a user by first name or last name" do |
|  |  | @cur\_user.stub(:pref).and\_return(:activity\_user => 'Billy') |
|  |  | controller.instance\_variable\_set(:@current\_user, @cur\_user) |
|  |  | User.should\_receive(:where).with("upper(first\_name) LIKE upper('%Billy%') OR upper(last\_name) LIKE upper('%Billy%')").and\_return([@user]) |
|  |  | User.should\_receive(:where).with(:first\_name => 'Billy').and\_return([@user]) |
|  |  | User.should\_receive(:where).with(:last\_name => 'Billy').and\_return([@user]) |
|  |  | controller.send(:activity\_user).should == 1 |
|  |  | end |
|  |  |  |
|  |  | it "should find a user by first name and last name" do |
|  |  | @cur\_user.stub(:pref).and\_return(:activity\_user => 'Billy Elliot') |
|  |  | controller.instance\_variable\_set(:@current\_user, @cur\_user) |
|  |  | User.should\_receive(:where).with("(upper(first\_name) LIKE upper('%Billy%') AND upper(last\_name) LIKE upper('%Elliot%')) OR (upper(first\_name) LIKE upper('%Elliot%') AND upper(last\_name) LIKE upper('%Billy%'))").and\_return([@user]) |
|  |  | User.should\_receive(:where).with(:first\_name => 'Billy', :last\_name => "Elliot").and\_return([@user]) |
|  |  | User.should\_receive(:where).with(:first\_name => 'Elliot', :last\_name => "Billy").and\_return([@user]) |
|  |  | controller.send(:activity\_user).should == 1 |
|  |  | end |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d4b2de8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fcommit%2Fd4b2de81a4d8c1b201482edcb2488ed9280a65fd) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canât perform that action at this time.



=== Content from openwall.com_2c92c44d_20250125_043432.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](../../../2013/12/29/1) [[<thread-prev]](1) [[thread-next>]](../../../2013/12/31/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <201312281223.rBSCNFKJ000867@linus.mitre.org>
Date: Sat, 28 Dec 2013 07:23:15 -0500 (EST)
From: cve-assign@...re.org
To: henri@...v.fi
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com, steveyken@...il.com,
        joernchen@...noelit.de
Subject: Re: CVE request: Fat Free CRM multiple vulnerabilities

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> <http://www.phenoelit.org/stuff/ffcrm.txt>
> <http://seclists.org/fulldisclosure/2013/Dec/199>
> <https://github.com/fatfreecrm/fat_free_crm/issues/300>
> <https://github.com/fatfreecrm/fat_free_crm/wiki/Fixing-security-vulnerabilities-%2827th-Dec-2013%29>

> 1. Known Session Secret
> <https://github.com/fatfreecrm/fat_free_crm/commit/93c182dd4c6f3620b721d2a15ba6a6ecab5669df>

Use CVE-2013-7222.

> 2. Lack of CSRF Protection
> <https://github.com/fatfreecrm/fat_free_crm/commit/a7fedbb36388bad0c0f32b2346481e0ea126dea6>

Use CVE-2013-7223.

> 3. Default to_json for models
> <https://github.com/fatfreecrm/fat_free_crm/commit/cf26a04b356ad2161c4c6160260eb870a3de5328>

Use CVE-2013-7224.

> 4. Multiple SQL Injections
> <https://github.com/fatfreecrm/fat_free_crm/commit/078035f1ef73ed85285ac9d128c3c5f670cef066>
> <https://github.com/fatfreecrm/fat_free_crm/commit/d4b2de81a4d8c1b201482edcb2488ed9280a65fd>

Use CVE-2013-7225.

For item 3: if there is an information-disclosure vulnerability
involving to_xml, please let us know and we can assign an additional
CVE ID. The joernchen advisory mentioned only to_json, and therefore
to_xml has a different discoverer and may require a separate CVE ID.

If there is a denial of service issue involving :delete, please let us
know and we can assign an additional CVE ID. The joernchen advisory
mentioned only "renders JSON requests with a full JSON object," and
therefore :delete has a different discoverer and may require a
separate CVE ID.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJSvsH6AAoJEKllVAevmvmsjksIAMeaH2HBfTrSNt83LAy1Sk0c
Q+lexLe6vIsOQLeh02/vk4zk/piqcuQGcmTmpEQ+X5lT+7zwrBoZAe3/g36Nb+mM
uJh9gBzsJkq0JUnqRVn84e9gxnJpqXjUB0aRRhaFrMBKB5jdTDFpWzKWS77KVzhI
QlgEMBObp4WUQHjAfsZcN+cs+xWjMVvR7+rk1AWJ9hAjT02UBGigVNWe5PmDrb8z
/yqcrQiEFTENbdQKSjNxlSSoEFWxEUF1b4PInNl7451ep0Ee2ZKoi9bte8h8pgsP
rOzEsPzu0yevLI7Wgrvl+clSdesuvIi6/2kGklv5LTsM23Rw/spat4nkAuFPKlU=
=PZmt
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_a6774405_20250126_060001.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fcommit%2F078035f1ef73ed85285ac9d128c3c5f670cef066)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fcommit%2F078035f1ef73ed85285ac9d128c3c5f670cef066)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=fatfreecrm%2Ffat_free_crm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fatfreecrm](/fatfreecrm)
/
**[fat\_free\_crm](/fatfreecrm/fat_free_crm)**
Public

* [Notifications](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)
* [Star
   3.6k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)

* [Code](/fatfreecrm/fat_free_crm)
* [Issues
  65](/fatfreecrm/fat_free_crm/issues)
* [Pull requests
  10](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects
  0](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

Additional navigation options

* [Code](/fatfreecrm/fat_free_crm)
* [Issues](/fatfreecrm/fat_free_crm/issues)
* [Pull requests](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

## Commit

[Permalink](/fatfreecrm/fat_free_crm/commit/078035f1ef73ed85285ac9d128c3c5f670cef066)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed sql injection in timeline method.

[Browse files](/fatfreecrm/fat_free_crm/tree/078035f1ef73ed85285ac9d128c3c5f670cef066)
Browse the repository at this point in the history

* Loading branch information

[![@steveyken](https://avatars.githubusercontent.com/u/149198?s=40&v=4)](/steveyken)

[steveyken](/fatfreecrm/fat_free_crm/commits?author=steveyken "View all commits by steveyken")
committed
Dec 27, 2013

1 parent
[cf26a04](/fatfreecrm/fat_free_crm/commit/cf26a04b356ad2161c4c6160260eb870a3de5328)

commit 078035f

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**75 additions**
and
**21 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app/controllers

  + app/controllers/home\_controller.rb
    [home\_controller.rb](#diff-2e1b0bda5d1af14b6acbbff496f78d7343528dcd5d1f58aa7259c9b73f2deb5a)
* spec/controllers

  + spec/controllers/home\_controller\_spec.rb
    [home\_controller\_spec.rb](#diff-77044ce093cea55ebee68eb38316c01fbe0213a0f63849dfa2f015c9b150e7a5)

## There are no files selected for viewing

21 changes: 13 additions & 8 deletions

21
[app/controllers/home\_controller.rb](#diff-2e1b0bda5d1af14b6acbbff496f78d7343528dcd5d1f58aa7259c9b73f2deb5a "app/controllers/home_controller.rb")

Show comments

[View file](/fatfreecrm/fat_free_crm/blob/078035f1ef73ed85285ac9d128c3c5f670cef066/app/controllers/home_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,14 +57,19 @@ def toggle |
|  |  | # GET /home/timeline AJAX |
|  |  | #---------------------------------------------------------------------------- |
|  |  | def timeline |
|  |  | unless params[:type].empty? |
|  |  | model = params[:type].camelize.constantize |
|  |  | item = model.find(params[:id]) |
|  |  | item.update\_attribute(:state, params[:state]) |
|  |  | else |
|  |  | comments, emails = params[:id].split("+") |
|  |  | Comment.update\_all("state = '#{params[:state]}'", "id IN (#{comments})") unless comments.blank? |
|  |  | Email.update\_all("state = '#{params[:state]}'", "id IN (#{emails})") unless emails.blank? |
|  |  | state = params[:state].to\_s |
|  |  | if %w(Collapsed Expanded).include?(state) |
|  |  | if (model\_type = params[:type].to\_s).present? |
|  |  | if %w(comment email).include?(model\_type) |
|  |  | model = model\_type.camelize.constantize |
|  |  | item = model.find(params[:id]) |
|  |  | item.update\_attribute(:state, state) |
|  |  | end |
|  |  | else |
|  |  | comments, emails = params[:id].split("+") |
|  |  | Comment.where(:id => comments.split(',')).update\_all(:state => state) unless comments.blank? |
|  |  | Email.where(:id => emails.split(',')).update\_all(:state => state) unless emails.blank? |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  | render :nothing => true |
| Expand Down | |  |

75 changes: 62 additions & 13 deletions

75
[spec/controllers/home\_controller\_spec.rb](#diff-77044ce093cea55ebee68eb38316c01fbe0213a0f63849dfa2f015c9b150e7a5 "spec/controllers/home_controller_spec.rb")

Show comments

[View file](/fatfreecrm/fat_free_crm/blob/078035f1ef73ed85285ac9d128c3c5f670cef066/spec/controllers/home_controller_spec.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -42,13 +42,13 @@ |
|  |  | assigns[:my\_tasks].should == [task\_1, task\_2, task\_3, task\_4] |
|  |  | end |
|  |  |  |
|  |  | it "should not display completed tasks" do |
|  |  | task\_1 = FactoryGirl.create(:task, :user\_id => current\_user.id, :name => "Your first task", :bucket => "due\_asap", :assigned\_to => current\_user.id) |
|  |  | task\_2 = FactoryGirl.create(:task, :user\_id => current\_user.id, :name => "Completed task", :bucket => "due\_asap", :completed\_at => 1.days.ago, :completed\_by => current\_user.id, :assigned\_to => current\_user.id) |
|  |  | it "should not display completed tasks" do |
|  |  | task\_1 = FactoryGirl.create(:task, :user\_id => current\_user.id, :name => "Your first task", :bucket => "due\_asap", :assigned\_to => current\_user.id) |
|  |  | task\_2 = FactoryGirl.create(:task, :user\_id => current\_user.id, :name => "Completed task", :bucket => "due\_asap", :completed\_at => 1.days.ago, :completed\_by => current\_user.id, :assigned\_to => current\_user.id) |
|  |  |  |
|  |  | get :index |
|  |  | assigns[:my\_tasks].should == [task\_1] |
|  |  | end |
|  |  | get :index |
|  |  | assigns[:my\_tasks].should == [task\_1] |
|  |  | end |
|  |  |  |
|  |  | it "should get a list of my opportunities ordered by closes\_on" do |
|  |  | opportunity\_1 = FactoryGirl.create(:opportunity, :name => "Your first opportunity", :closes\_on => 15.days.from\_now, :assigned\_to => current\_user.id, :stage => 'proposal') |
| Expand Down  Expand Up | | @@ -153,42 +153,91 @@ |
|  |  | session[:hello].should == true |
|  |  | end |
|  |  | end |
|  |  |  |
|  |  |  |
|  |  | describe "activity\_user" do |
|  |  |  |
|  |  |  |
|  |  | before(:each) do |
|  |  | @user = double(User, :id => 1, :is\_a? => true) |
|  |  | @cur\_user = double(User) |
|  |  | end |
|  |  |  |
|  |  |  |
|  |  | it "should find a user by email" do |
|  |  | @cur\_user.stub(:pref).and\_return(:activity\_user => 'billy@example.com') |
|  |  | controller.instance\_variable\_set(:@current\_user, @cur\_user) |
|  |  | User.should\_receive(:where).with(:email => 'billy@example.com').and\_return([@user]) |
|  |  | controller.send(:activity\_user).should == 1 |
|  |  | end |
|  |  |  |
|  |  |  |
|  |  | it "should find a user by first name or last name" do |
|  |  | @cur\_user.stub(:pref).and\_return(:activity\_user => 'Billy') |
|  |  | controller.instance\_variable\_set(:@current\_user, @cur\_user) |
|  |  | User.should\_receive(:where).with("upper(first\_name) LIKE upper('%Billy%') OR upper(last\_name) LIKE upper('%Billy%')").and\_return([@user]) |
|  |  | controller.send(:activity\_user).should == 1 |
|  |  | end |
|  |  |  |
|  |  |  |
|  |  | it "should find a user by first name and last name" do |
|  |  | @cur\_user.stub(:pref).and\_return(:activity\_user => 'Billy Elliot') |
|  |  | controller.instance\_variable\_set(:@current\_user, @cur\_user) |
|  |  | User.should\_receive(:where).with("(upper(first\_name) LIKE upper('%Billy%') AND upper(last\_name) LIKE upper('%Elliot%')) OR (upper(first\_name) LIKE upper('%Elliot%') AND upper(last\_name) LIKE upper('%Billy%'))").and\_return([@user]) |
|  |  | controller.send(:activity\_user).should == 1 |
|  |  | end |
|  |  |  |
|  |  |  |
|  |  | it "should return nil when 'all\_users' is specified" do |
|  |  | @cur\_user.stub(:pref).and\_return(:activity\_user => 'all\_users') |
|  |  | controller.instance\_variable\_set(:@current\_user, @cur\_user) |
|  |  | User.should\_not\_receive(:where) |
|  |  | controller.send(:activity\_user).should == nil |
|  |  | end |
|  |  |  |
|  |  |  |
|  |  | end |
|  |  |  |
|  |  | describe "timeline" do |
|  |  |  |
|  |  | before(:each) do |
|  |  | require\_user |
|  |  | end |
|  |  |  |
|  |  | it "should collapse all comments and emails on a specific contact" do |
|  |  | comment = double(Comment) |
|  |  | Comment.should\_receive(:find).with("1").and\_return(comment) |
|  |  | comment.should\_receive(:update\_attribute).with(:state, 'Collapsed') |
|  |  | xhr :get, :timeline, :type => "comment", :id => "1", :state => "Collapsed" |
|  |  | end |
|  |  |  |
|  |  | it "should expand all comments and emails on a specific contact" do |
|  |  | comment = double(Comment) |
|  |  | Comment.should\_receive(:find).with("1").and\_return(comment) |
|  |  | comment.should\_receive(:update\_attribute).with(:state, 'Expanded') |
|  |  | xhr :get, :timeline, :type => "comment", :id => "1", :state => "Expanded" |
|  |  | end |
|  |  |  |
|  |  | it "should not do anything when state neither Expanded nor Collapsed" do |
|  |  | comment = double(Comment) |
|  |  | Comment.should\_not\_receive(:find).with("1") |
|  |  | xhr :get, :timeline, :type => "comment", :id => "1", :state => "Explode" |
|  |  | end |
|  |  |  |
|  |  | it "should collapse all comments and emails on Contact" do |
|  |  | where\_stub = double |
|  |  | where\_stub.should\_receive(:update\_all).with(:state => "Collapsed") |
|  |  | Comment.should\_receive(:where).and\_return(where\_stub) |
|  |  | xhr :get, :timeline, :id => "1,2,3,4+", :state => "Collapsed" |
|  |  | end |
|  |  |  |
|  |  | it "should not allow an arbitary state (sanitizes input)" do |
|  |  | where\_stub = double |
|  |  | where\_stub.should\_receive(:update\_all).with(:state => "Expanded") |
|  |  | Comment.should\_receive(:where).and\_return(where\_stub) |
|  |  | xhr :get, :timeline, :id => "1,2,3,4+", :state => "Expanded" |
|  |  | end |
|  |  |  |
|  |  | it "should not update an arbitary model (sanitizes input)" do |
|  |  | where\_stub = double |
|  |  | where\_stub.should\_receive(:update\_all).with(:state => "Expanded") |
|  |  | Comment.should\_receive(:where).and\_return(where\_stub) |
|  |  | xhr :get, :timeline, :id => "1,2,3,4+", :state => "Expanded" |
|  |  | end |
|  |  |  |
|  |  | end |
|  |  |  |
|  |  | end |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `078035f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fcommit%2F078035f1ef73ed85285ac9d128c3c5f670cef066) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canât perform that action at this time.



=== Content from github.com_7869a7dc_20250125_043436.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fissues%2F300)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffatfreecrm%2Ffat_free_crm%2Fissues%2F300)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=fatfreecrm%2Ffat_free_crm)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[fatfreecrm](/fatfreecrm)
/
**[fat\_free\_crm](/fatfreecrm/fat_free_crm)**
Public

* [Notifications](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm) You must be signed in to change notification settings
* [Fork
  1.3k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)
* [Star
   3.6k](/login?return_to=%2Ffatfreecrm%2Ffat_free_crm)

* [Code](/fatfreecrm/fat_free_crm)
* [Issues
  65](/fatfreecrm/fat_free_crm/issues)
* [Pull requests
  10](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects
  0](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

Additional navigation options

* [Code](/fatfreecrm/fat_free_crm)
* [Issues](/fatfreecrm/fat_free_crm/issues)
* [Pull requests](/fatfreecrm/fat_free_crm/pulls)
* [Discussions](/fatfreecrm/fat_free_crm/discussions)
* [Actions](/fatfreecrm/fat_free_crm/actions)
* [Projects](/fatfreecrm/fat_free_crm/projects)
* [Wiki](/fatfreecrm/fat_free_crm/wiki)
* [Security](/fatfreecrm/fat_free_crm/security)
* [Insights](/fatfreecrm/fat_free_crm/pulse)

# Security vulnerabilities announcedÂ #300

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Security vulnerabilities announced](#top)#300Copy link[![@fgeek](https://avatars.githubusercontent.com/u/286959?u=13f491fcbcf1b1aa8c5f34d17038912e5701673f&v=4&size=80)](/fgeek)
## Description

[![@fgeek](https://avatars.githubusercontent.com/u/286959?u=13f491fcbcf1b1aa8c5f34d17038912e5701673f&v=4&size=48)](/fgeek)[fgeek](https://github.com/fgeek)opened [on Dec 24, 2013](https://github.com/fatfreecrm/fat_free_crm/issues/300#issue-24752243)

For details please see: <http://seclists.org/fulldisclosure/2013/Dec/199>

Are these issues already fixed in some version? If not, do you have a plan already?

Are these issues tracked in some issue tracker?

Have you requested CVE identifiers for these security updates?

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canât perform that action at this time.



=== Content from seclists.org_d24fd441_20250125_043433.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)
## [Full Disclosure](/fulldisclosure/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](198)
[By Date](date.html#199)
[![Next](/images/right-icon-16x16.png)](200)

[![Previous](/images/left-icon-16x16.png)](197)
[By Thread](index.html#199)
[![Next](/images/right-icon-16x16.png)](200)

![](/shared/images/nst-icons.svg#search)

# Happy Holidays / Xmas Advisory

---

*From*: joernchen <joernchen () phenoelit de>

*Date*: Tue, 24 Dec 2013 11:26:15 +0100

---

```
To whom it may concern:

A rather informal advisory on Fat Free CRM (<http://fatfreecrm.com/>):

Timeline:
Aug 27th 2013 Initial email containing the findings listed below
         including a note that there more vulnerabilities
         which just need to be verified. (Send to
         mike () fatfreecrm com and security () fatfreecrm com)

Sep 16th 2013 No response so far (not even a bounce of the initial
         mail), re-send email of Aug. 27th.

Dec 20th 2013 Still no response.

Dec 24th 2013 Public Disclosure.

Hint: Actually the codebase is full of Ruby on Rails worst practices.
      You might want to use it as a sample "Hack Me" application.

---
1. Known Session Secret

In config/initialiers/secret_token.rb a static secret token is defined,
with the knowledge of this token an attacker is able to execute
arbitrary Ruby code server side.

2. Lack of CSRF Protection

In app/controllers/application_controller.rb the protect_from_forgery
statement is missing, therefore Fat Free CRM is vulnerable to CSRF
attacks.

3. Default to_json for models

The users controller renders JSON requests with a full JSON object:
For instance when being logged in to the demo app and requesting
<http://demo.fatfreecrm.com/users/1.json>, the response would be

{

    "user": {
        "admin": true,
        "aim": "",
        "alt_email": "",
        "company": "example",
        "created_at": "2012-02-12T02:00:00+02:00",
        "current_login_at": "2013-08-26T22:12:05+03:00",
        "current_login_ip": "61.143.60.146",
        "deleted_at": null,
        "email": "aaron () example com",
        "first_name": "Aaron",
        "google": "",
        "id": 1,
        "last_login_at": "2013-08-24T22:20:06+03:00",
        "last_login_ip": "122.173.185.99",
        "last_name": "Assembler",
        "last_request_at": "2013-08-26T22:13:35+03:00",
        "login_count": 481,
        "mobile": "(800)555-1211",
        "password_hash":
"56d91c9f1a9c549304768982fd4e2d8bc2700b403b4524c0f14136dbbe2ce4cd923156ad69f9acce8305dba4e63faa884e61fb7a256cf8f5fc7c2ce176e68e8f",
        "password_salt":
"ce6e0200c96f4dd326b91f3967115a31421a0e7dcddc9ffb63a77f598a9fcb5326fe532dbd9836a2446e46840d398fa32c81f8f4da1a0fcfe931989e9639a013",
        "perishable_token": "NE0n6wUCumVNdQ24ahRu",
        "persistence_token":
"d7cdeffd3625f7cb265b21126b85da7c930d47c4a708365c20eb857560055a6b57c9775becb8a957dfdb46df8aee17eb120a011b380e9cc0882f9dfaa2b7ba26",
        "phone": "(800)555-1210",
        "single_access_token": "TarXlrOPfaokNOzls2U8",
        "skype": "ranzitreddy",
        "suspended_at": null,
        "title": "VP of Sales",
        "updated_at": "2013-08-26T22:13:35+03:00",
        "username": "aaron",
        "yahoo": ""
    }

}

A custom to_json method which sanitizes the output should be created.

4. Multiple SQL Injections

In app/controllers/home_controller.rb:

  def timeline
    unless params[:type].empty?
      model = params[:type].camelize.constantize
      item = model.find(params[:id])
      item.update_attribute(:state, params[:state])
    else
      comments, emails = params[:id].split("+")
      Comment.update_all("state = '#{params[:state]}'", "id IN
(#{comments})") unless comments.blank?
      Email.update_all("state = '#{params[:state]}'", "id IN
(#{emails})") unless emails.blank?
    end

    render :nothing => true
  end

Here params[:state], comments and emails are attacker controlled values
which go directly into SQL statements. Therefore this piece of code
exposes a SQL Injection vulnerability.
---

Static URL of this text:

<http://www.phenoelit.org/stuff/ffcrm.txt>

Happy Holidays,

joernchen
--
joernchen ~ Phenoelit
<joernchen () phenoelit de> ~ C776 3F67 7B95 03BF 5344
<http://www.phenoelit.de>  ~ A46A 7199 8B7B 756A F5AC

_______________________________________________
Full-Disclosure - We believe in it.
Charter: <http://lists.grok.org.uk/full-disclosure-charter.html>
Hosted and sponsored by Secunia - <http://secunia.com/>

```

---

[![Previous](/images/left-icon-16x16.png)](198)
[By Date](date.html#199)
[![Next](/images/right-icon-16x16.png)](200)

[![Previous](/images/left-icon-16x16.png)](197)
[By Thread](index.html#199)
[![Next](/images/right-icon-16x16.png)](200)

### Current thread:

* **Happy Holidays / Xmas Advisory** *joernchen (Dec 24)*
  + [Re: Happy Holidays / Xmas Advisory](200) *Henri Salo (Dec 24)*
    - [Re: Happy Holidays / Xmas Advisory](201) *PsychoBilly (Dec 26)*
      * [Re: Happy Holidays / Xmas Advisory](207) *Brandon Perry (Dec 26)*
      * *Message not available** [Re: Happy Holidays / Xmas Advisory](208) *Gage Bystrom (Dec 26)** [Re: Happy Holidays / Xmas Advisory](211) *Henri Salo (Dec 27)*
  + <Possible follow-ups>
  + [Re: Happy Holidays / Xmas Advisory](217) *Matthew Gow (Dec 29)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")


