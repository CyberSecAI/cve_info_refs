=== Content from blog.c22.cc_4ae2d41e_20250125_161348.html ===


* [Home](http://blog.c22.cc/)
* [About me](https://c22blog.wordpress.com/about/)
  + [About me](https://c22blog.wordpress.com/about/)
  + [Speed Blogging](https://c22blog.wordpress.com/about/speed-blogging/)
  + [Twitter (@ChrisJohnRiley)](http://www.twitter.com/ChrisJohnRiley)
  + [Twitter (@catch22insec)](http://twitter.com/catch22insec)
  + [Eurotrash Security Podcast](http://www.eurotrashsecurity.eu)
  + [Twitter (@eurotrashsec)](http://twitter.com/eurotrashsec)
  + [PGP Public Key](https://c22blog.wordpress.com/pgp-public-key/)
* [Shared Items](http://feed.c22.cc)
  + [Shared Items](http://feed.c22.cc)
  + [Shared Items (RSS)](http://feeds.feedburner.com/C22SharedItems)
  + [Shared Items (Google Reader archive)](http://www.google.com/reader/shared/ChrisJohnRiley)
* [Tools / Scripts](https://c22blog.wordpress.com/toolsscripts/)
  + [Tools / Scripts](https://c22blog.wordpress.com/toolsscripts/)
  + [Scythe Framework](http://blog.c22.cc/2012/10/03/scythe-framework/)
  + [Apache Log Extractor [Alpha]](https://c22blog.wordpress.com/toolsscripts/apache-log-extractor-alpha/)
  + [UA-Tester](https://c22blog.wordpress.com/toolsscripts/ua-tester/)
  + [Metasploit Modules](https://c22blog.wordpress.com/toolsscripts/metasploit-modules/)
  + [PRN-2-ME](https://c22blog.wordpress.com/toolsscripts/prn-2-me/)
  + [[PoC] scr.im.tessercap (CAPTCHA OCR)](https://c22blog.wordpress.com/toolsscripts/poc-scr-im-tessercap-captcha-ocr/)
  + [[PoC] scr.im-jim](https://c22blog.wordpress.com/toolsscripts/poc-scr-im-jim/)
  + [Typo3 Default Encryption Keys](https://c22blog.wordpress.com/toolsscripts/typ3defenctool/)
* [Media](https://c22blog.wordpress.com/media/)
* [Advisories](https://c22blog.wordpress.com/advisories/)
  + [Advisories](https://c22blog.wordpress.com/advisories/)
  + [CVE-2013-5113/5114 â€“ LastPass Android container PIN and auto-wipe security feature bypass](https://c22blog.wordpress.com/advisories/cve-2013-51135114-lastpass-android-container-pin-and-auto-wipe-security-feature-bypass/)
  + [CVE-2013-2503 â€“ Privoxy Proxy Authentication Credential Exposure](https://c22blog.wordpress.com/advisories/cve-2013-2503-privoxy-proxy-authentication-credential-exposure/)
  + [TYPO3-EXT-SA-2012-003 â€“ t3extplorer](https://c22blog.wordpress.com/advisories/typo3-ext-sa-2012-003-t3extplorer/)
  + [SurveyMonkey: IP Spoofing](http://wp.me/p6I7X-Jh)
  + [SAP Management Console](http://blog.c22.cc/2011/01/09/metasploit-sap-management-console-aux-modules/)
  + [scr.im Captcha Bypass](http://blog.c22.cc/2009/10/07/the-secrets-of-scr-im/)
  + [TYPO3-SA-2010-009 â€“ sr\_feuser\_register](https://c22blog.wordpress.com/advisories/typo3-sa-2010-009-sr_feuser_register/)
  + [TYPO3-SA-2009-001 â€“ Insecure Randomness](https://c22blog.wordpress.com/advisories/typo3-sa-2009-001/)
  + [TYPO3-SA-2009-016 â€“ Install Tool](https://c22blog.wordpress.com/advisories/typo3-sa-2009-016-install-tool/)
  + [TYPO3-SA-2009-016 â€“ felogin](https://c22blog.wordpress.com/advisories/typo3-sa-2009-016-felogin/)
* [Bookshelf](https://c22blog.wordpress.com/books/)

# [CĞ°Ñ‚ÑĞ½Â²Â² (in)sĞµÑuÑitÑƒ / ChrisJohnRiley](https://c22blog.wordpress.com/)

Because we're damned if we do, and we're damned if we don't!

[Home](https://c22blog.wordpress.com/)
## A sneak peek into Android â€œSecureâ€ Containers

[1 Comment](https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/#respond)
Posted by [ChrisJohnRiley](https://c22blog.wordpress.com/author/catchtwotwo/ "Posts by ChrisJohnRiley") on September 5, 2013

Itâ€™s been a bit quiet here on the blog, so I thought Iâ€™d take a few minutes to write up an issue I raised with the fine folks over at [LastPass](https://lastpass.com/support_security.php) .

Alongside the HTTP Response Code stuff, Iâ€™ve been playing around more and more with Android applications. One of the things I presented on in Vegas at the BSidesLV Underground track was breaking into Android Secure Containers. The name of the talk was cryptic for sure, mostly because said â€œsecureâ€ containers were anything but secure, and because I hadnâ€™t had time to report the issues to the effected vendors. The issues I discussed werenâ€™t tied to a single application, and effect numerous apps within the Play Storeâ€¦

![LastPassLogoShadow](https://c22blog.wordpress.com/wp-content/uploads/2013/09/lastpasslogoshadow.jpg?w=353&h=88)

So, here we are a month later, and LastPass has rolled out a â€œfixâ€ for the issue I reported to them. This means I can give you the down and dirty details now that youâ€™ve all updated your Android devices to the latest LastPass version (*currently 2.5.1*). FYI: the CVE Â numbers for these issues although not referenced in the LastPass changelogs as yet are CVE-2013-5113 and CVE-2013-5114.

This research needs a little back story to explain it, so bear with me for a minute while I set the stage.

## Back Story / Testing Scenario

I started down this research track when I was looking at how Android applications provide additional security through PIN and/or password protection of specific applications. This additional layer of security offered by applications like LastPass is there to stop people who have physical access to your Android device from getting into the more secure areas of your data (*e.g. Passwords*). With this in mind I expected the implementation of these protections to be designed to stand up to an attacker with physical access to the device *(aka. somebody whoâ€™s stolen/borrowed/found your Android device*).

## Some Facts

Without root access to the android device, itâ€™s not directly possible to view or alter the data of specific applications. Even if USB Debugging is enabled (*by the owner, or later by an attacker with device access*) itâ€™s only possible to view specific data on the Android device, not all the juicy stuff. Everything Iâ€™m about to discuss is possible based on a non-rooted device, however USB debugging needs to be enabled to allow us to interact with the device using adb. Remember, the scenario weâ€™re talking about here is physical device access, so this shouldnâ€™t be a big hurdle.

**Note**: It goes without saying that everything that can be achieved here with ADB /USB Debugging can also be achieved through exploitation of the deviceâ€¦ although, there are much more fun things to do if youâ€™re popping shell on a device ğŸ˜‰

## **The LastPass Case**

[![lastpass_pin_promp](https://c22blog.wordpress.com/wp-content/uploads/2013/09/lastpass_pin_promp.png?w=149&h=248)](https://c22blog.wordpress.com/wp-content/uploads/2013/09/lastpass_pin_promp.png)

LastPass allows a user to save their password within the Android application so that you donâ€™t need to type it every time you open the app. This isnâ€™t abnormal for applications, and like any good security minded application they give you options to secure the access using something other than your long long password (*akaâ€¦ the PIN*).

Given my experience, users of such applications have too much faith in the security of their devices and have no desire to type in their 32 character random LastPass password whenever they open the application (*have you tried that on a handheld device? Yhea, not funâ€¦*). Much better to store the password in the secure container settings and assign a PIN to protect the app (*because thatâ€™s secure!*).

So with the back story and the explanation out the way, hereâ€™s the meat of the issue

## The Meat

When I first started testing LastPass on the Android (*version 2.0.4 at the time*) I noticed something interesting about the AndroidManifest. In particular the android:allBackup was set to True, meaning that even though I couldnâ€™t read or edit the configuration/settings of LastPass directly on the device (*remember, non-rooted device*) or via ADB (*remember, USB debugging enabled, but even then no direct access*), I could perform backup and restore operations via ADB.

This led me down the trail of learning more about the â€œadb backupâ€ command (*introduced in Android ICS*). What makes adb backup and restore so useful in this context, is the ability to not only backup a device entirely over USB, but also to specifically backup individual application data (*with or without the APK file*). This makes the backup and restore much more flexible for what weâ€™re looking at doing. After all, backing up an entire 16GB device every time gets tiring (*Iâ€™m looking at you iOS*).

By performing an adb backup (**command**: *adb backup com.lastpass.lpandroid -apk*) and accepting the prompt on the device, you end up with a backup.ab file containing the LastPass application (APK) and the data/configuration/settings from the application. There have been numerous discussions on the format used by Android Backup files, but I wasnâ€™t happy with any of the solutions offered to decrypt the AB files into something usable. So I decided to automate the lengthy process in Python (see <http://blog.c22.cc/2013/08/01/bsideslv-android-backup-unpacker-release/>) and add in some features to ease things a little.

The final result is a directory output of the LastPass application (*with or without the APK â€“ your choice â€“ screenshot is without APK*).Â [![lastpass_tree](https://c22blog.wordpress.com/wp-content/uploads/2013/09/lastpass_tree.png?w=504&h=168)](https://c22blog.wordpress.com/wp-content/uploads/2013/09/lastpass_tree.png)

Taking a look at the files the sp/LPandroid.xml quickly stood out as worth further analysis. As expected the configuration file contained the username and password in encoded format (*if saved within the LastPass app*). Alongside this the XML also contains an encoded version of the PIN and various other application settings.Â Putting aside the possibility to decode the password and PIN, a few settings caught my eye for easy wins:

* reprompt\_tries

This is a simple integar that increases as incorrect PINs are entered

* passwordrepromptonactive
* pincodeforreprompt (*holds encoded PIN*)
* requirepin

These control the password reprompt on startup and the PIN protection (*yeah, you can see where this is going already*)

## The Story So Far

We have access to the LastPass configuration of a non-rooted device via adb backupâ€¦ and we can fiddle with the resulting configuration file. However weâ€™re still playing about with the XML inside a backup and not with the device itself. We need to get the changes back into the device

## Next Step

Using more Python trickery goodness (*see* <http://blog.c22.cc/2013/08/01/bsideslv-android-backup-unpacker-release/>) we can take the directory structure created and rebuild the Android Backup file (*with the changes that weâ€™ve made to the files of course*). Then we can restore the backup to the device (*if you still have access to it*) or to your own device/emulator (*make sure you have the APK in the backup file or the app already installed if you want to restore to another device*).

## Effects

[![lastpass_home_screen](https://c22blog.wordpress.com/wp-content/uploads/2013/09/lastpass_home_screen.png?w=156&h=259)](https://c22blog.wordpress.com/wp-content/uploads/2013/09/lastpass_home_screen.png)As expected, playing with the reprompt\_tries by setting it to a minus number (*-9999 for example*) allows you to bypass the 5 PIN attempts before wipe feature of LastPass. This essentially gives you 10,000 retries. If you canâ€™t guess a 4 digit PIN in 10,000 retries, then nothing can help you ğŸ˜›

However, the easier and more fun option is the pincodeforreprompt / passwordrepromptonactive and requirepin alteration which results in the LastPass application not requiring a PIN for entry anymore.

1. Backup configuration and unpack
2. Alter XML settings as required
3. Pack configuration and restore
4. <<< Profit >>>

## After-effects

Some of the more eagle eyed amongst you may have already noticed another interesting attack vector here. The ability to backup LastPass from a device (*within 30 seconds if youâ€™re handy ;*) and return the device to the owner, coupled with the freedom to restore said backup to an attacker controlled device, makes the attack much more interesting. Not only can you do this, bypass the PIN in your own time, and then read and extract the stored passwords as desired. You can also maintain access to the users LastPass account until such time as they change their LastPass password itself.

If the original owner alters their any of the passwords their store in the LastPass service, the attacker can simply close and restart the cloned Android container to update the information from LastPassâ€™ servers.

Note: Version 2.5.1 mentions an alteration in the way LastPass creates UUIDs. This may effect this cloning attack â€“ as yet unconfirmed

## Round 2 â€“ Itâ€™s not over yet

You may have noticed the use of quotes around **â€œfixâ€** at the beginning of this postâ€¦ After LastPass got back to me to say theyâ€™d fixed the issue (*actually they responded to say theyâ€™d fixed it the day before I reported it as theyâ€™d disabled allowBackup and not pushed it to the Play Store yet*), I started looking at the proposed fix and possible bypasses based on the same physical access scenario. After a few false starts I have a working bypass for their fix that once again allows the attack (*with an additional step*). Once theyâ€™ve fixed the fix, Iâ€™ll let you guys know how that one went down ğŸ˜‰

Until then, make sure you upgrade your Lastpass to the latest Play Store version (*2.5.1 at this time*) and keep an eye out for further fixes!

**Links**:

* android:allowBackup > <http://developer.android.com/reference/android/R.attr.html#allowBackup>
* Android ADB > <http://developer.android.com/tools/help/adb.html>
* Python scripts for easier Android Backup fiddling > <http://blog.c22.cc/2013/08/01/bsideslv-android-backup-unpacker-release/>
* Lastpass Android (Play Store) > <https://play.google.com/store/apps/details?id=com.lastpass.lpandroid>

### Rate this:

### Share this:

* [Twitter](https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/?share=twitter "Click to share on Twitter")
* [Facebook](https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/?share=facebook "Click to share on Facebook")
* [LinkedIn](https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/?share=linkedin "Click to share on LinkedIn")
* [Tumblr](https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/?share=tumblr "Click to share on Tumblr")
* [Reddit](https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/?share=reddit "Click to share on Reddit")
Like Loading...
### *Related*

[Penetration Test](https://c22blog.wordpress.com/category/penetration-test/), [Security](https://c22blog.wordpress.com/category/security/)
[adb](https://c22blog.wordpress.com/tag/adb/), [allowBackup](https://c22blog.wordpress.com/tag/allowbackup/), [android](https://c22blog.wordpress.com/tag/android/), [bypass](https://c22blog.wordpress.com/tag/bypass/), [lastpass](https://c22blog.wordpress.com/tag/lastpass/)

[â† #DEFCON Defense by numbers: Making Problems for Script Kiddies and ScannerÂ Monkeys](https://c22blog.wordpress.com/2013/08/06/defcon-defense-by-numbers-making-problems-for-script-kiddies-and-scanner-monkeys/) [SANS FOR610: Reverse Engineering Malware â€“ CourseÂ Review â†’](https://c22blog.wordpress.com/2013/10/15/sans-for610-reverse-engineering-malware-course-review/)

### One response to â€œ*A sneak peek into Android â€œSecureâ€ Containers*â€

1. ![](https://1.gravatar.com/avatar/709de8a9547be93d94caac6f4ee4a7472a1beb2061c3505a96830024dff5e103?s=40&d=https%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D40)[Aamil](http://aamilsyed.wordpress.com/) [December 11, 2013 at 08:39](https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/#comment-10212)

   This is both brilliant and scary! I guess there really is no good way to make authentication easy AND secure. You know of any?

[RSS feed](https://c22blog.wordpress.com/feed/)
### Recent Posts

* [[DeepSec 2015]50 Shades ofÂ WAF](https://c22blog.wordpress.com/2015/11/19/deepsec-201550-shades-of-waf/)
* [[DeepSec 2015] File Format Fuzzing in Android â€“ Giving a Stagefright to the AndroidÂ Installer](https://c22blog.wordpress.com/2015/11/19/deepsec-2015-file-format-fuzzing-in-android-giving-a-stagefright-to-the-android-installer/)
* [[DeepSec 2015]How to Break XML Encryption â€“Â Automatically](https://c22blog.wordpress.com/2015/11/19/deepsec-2015how-to-break-xml-encryption-automatically/)
* [[DeepSec 2015] Hacking Cookies in Modern Web Applications andÂ Browsers](https://c22blog.wordpress.com/2015/11/19/deepsec-2015-hacking-cookies-in-modern-web-applications-and-browsers/)
* [[DeepSec 2015] Can societies manage the SIGINTÂ monster?](https://c22blog.wordpress.com/2015/11/19/deepsec-2015-can-societies-manage-the-sigint-monster/)
* [[LHS Microcast] DeepSecÂ 2015](https://c22blog.wordpress.com/2015/10/19/lhs-microcase-deepsec-2015/)
* [[LHS Microcast] Interview w/ JenÂ Ellis](https://c22blog.wordpress.com/2015/10/02/lhs-microcast-interview-w-jen-ellis/)
* [Taking out theÂ Eurotrash](https://c22blog.wordpress.com/2014/12/23/taking-out-the-eurotrash/)
* [All good things must come to anÂ end](https://c22blog.wordpress.com/2014/12/22/all-good-things-must-come-to-an-end/)
* [[DeepSec 2014] Advanced Powershell Threat: Lethal Client Side Attacks usingÂ Powershell](https://c22blog.wordpress.com/2014/11/21/deepsec-2014-advanced-powershell-threat-lethal-client-side-attacks-using-powershell/)
[![](http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png)](http://creativecommons.org/licenses/by-nc-sa/3.0/)
### Archives

Archives
Select Month
 November 2015 Â (5)
 October 2015 Â (2)
 December 2014 Â (2)
 November 2014 Â (5)
 October 2014 Â (1)
 September 2014 Â (1)
 August 2014 Â (1)
 July 2014 Â (1)
 April 2014 Â (1)
 January 2014 Â (1)
 December 2013 Â (2)
 October 2013 Â (1)
 September 2013 Â (1)
 August 2013 Â (2)
 July 2013 Â (1)
 June 2013 Â (1)
 May 2013 Â (1)
 April 2013 Â (2)
 March 2013 Â (1)
 February 2013 Â (1)
 December 2012 Â (4)
 November 2012 Â (2)
 October 2012 Â (2)
 September 2012 Â (2)
 August 2012 Â (1)
 July 2012 Â (2)
 June 2012 Â (3)
 May 2012 Â (3)
 April 2012 Â (3)
 March 2012 Â (8)
 February 2012 Â (7)
 January 2012 Â (7)
 December 2011 Â (11)
 November 2011 Â (17)
 October 2011 Â (6)
 September 2011 Â (9)
 August 2011 Â (6)
 July 2011 Â (10)
 June 2011 Â (5)
 May 2011 Â (3)
 April 2011 Â (9)
 March 2011 Â (5)
 February 2011 Â (1)
 January 2011 Â (11)
 December 2010 Â (3)
 November 2010 Â (12)
 October 2010 Â (6)
 September 2010 Â (11)
 August 2010 Â (9)
 July 2010 Â (21)
 June 2010 Â (8)
 May 2010 Â (7)
 April 2010 Â (13)
 March 2010 Â (7)
 February 2010 Â (1)
 January 2010 Â (3)
 December 2009 Â (17)
 November 2009 Â (6)
 October 2009 Â (6)
 September 2009 Â (21)
 August 2009 Â (15)
 July 2009 Â (9)
 June 2009 Â (5)
 May 2009 Â (3)
 April 2009 Â (5)
 March 2009 Â (4)
 February 2009 Â (5)
 January 2009 Â (4)
 December 2008 Â (18)
 November 2008 Â (6)
 October 2008 Â (5)
 September 2008 Â (10)
 August 2008 Â (7)
 July 2008 Â (7)
 June 2008 Â (1)
 March 2008 Â (3)
 February 2008 Â (4)
 January 2008 Â (4)
 December 2007 Â (5)
 November 2007 Â (8)
 October 2007 Â (6)
 September 2007 Â (8)
 August 2007 Â (6)

[![ChrisJohnRiley on Twitter](http://twittercounter.com/counter/?username=ChrisJohnRiley)](http://twitter.com/ChrisJohnRiley)

### [@ChrisJohnRiley](http://twitter.com/ChrisJohnRiley)

[Tweets by ChrisJohnRiley](https://twitter.com/ChrisJohnRiley)
###

[![Computer History Museum (Mountain View, CA)](https://live.staticflickr.com/7642/16171126653_504b9e28d2_s.jpg "Computer History Museum (Mountain View, CA)")](https://www.flickr.com/photos/c22/16171126653/)[![Hmmâ€¦ no tanks. Why did nobody tell me earlier!](https://live.staticflickr.com/7518/15658163086_92a02df283_s.jpg "Hmmâ€¦ no tanks. Why did nobody tell me earlier!")](https://www.flickr.com/photos/c22/15658163086/)[![Huge Organâ€¦ #firstcon14](https://live.staticflickr.com/5591/14322110059_07bec335c6_s.jpg "Huge Organâ€¦ #firstcon14")](https://www.flickr.com/photos/c22/14322110059/)[![The Internet @ the MIT Museumâ€¦ #firstcon14](https://live.staticflickr.com/3867/14479643812_ef9aa76deb_s.jpg "The Internet @ the MIT Museumâ€¦ #firstcon14")](https://www.flickr.com/photos/c22/14479643812/)
[More Photos](https://www.flickr.com/photos/c22/)

### Disclaimer

The contents of this personal blog are solely my own opinions and comments, as such they do not reflect the opinions of my employer(s) past, present or future. No legal liability is accepted for anything you do, think, or consider fact as the basis of articles and links posted on this blog.

"Three to one...two...one...probability factor of one to one...we have normality, I repeat we have normality. Anything you still canâ€™t cope with is therefore your own problem."

Note: A large portion of content I post on my blog comes from "live blogging" of security conferences. These posts are in notes form and are written live during a talk. As such errors and emissions are expected. I'm only human after all!

[â†‘ Top](#wrapper)
[Blog at WordPress.com.](https://wordpress.com/?ref=footer_blog)

* Reblog
* Subscribe
  Subscribed

  + [![](https://secure.gravatar.com/blavatar/770e6edec9ad46dc256a0b6e899831fffce8cefdfab8133d02c4f1a8365cab33?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png) CĞ°Ñ‚ÑĞ½Â²Â² (in)sĞµÑuÑitÑƒ / ChrisJohnRiley](https://c22blog.wordpress.com)

  Join 3,178 other subscribers

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fc22blog.wordpress.com%2F2013%2F09%2F05%2Fa-sneak-peak-into-android-secure-containers-2%2F&signup_flow=account)
* Privacy
* + [![](https://secure.gravatar.com/blavatar/770e6edec9ad46dc256a0b6e899831fffce8cefdfab8133d02c4f1a8365cab33?s=50&d=https%3A%2F%2Fs2.wp.com%2Fi%2Flogo%2Fwpcom-gray-white.png) CĞ°Ñ‚ÑĞ½Â²Â² (in)sĞµÑuÑitÑƒ / ChrisJohnRiley](https://c22blog.wordpress.com)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fc22blog.wordpress.com%2F2013%2F09%2F05%2Fa-sneak-peak-into-android-secure-containers-2%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/p6I7X-1tO)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://c22blog.wordpress.com/2013/09/05/a-sneak-peak-into-android-secure-containers-2/)
  + [View post in Reader](https://wordpress.com/read/blogs/1599597/posts/5692)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)

