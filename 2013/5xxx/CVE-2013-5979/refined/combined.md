=== Content from bugs.launchpad.net_bdc7a0e7_20250124_212222.html ===

[Log in / Register](https://bugs.launchpad.net/xibo/%2Bbug/1093967/%2Blogin)

[![](https://launchpadlibrarian.net/103575142/XIBO-LOGO-64.png)](https://launchpad.net/xibo)

## [Xibo](https://launchpad.net/xibo)

* [Overview](https://launchpad.net/xibo)
* [Code](https://code.launchpad.net/xibo)
* [Bugs](https://bugs.launchpad.net/xibo)
* [Blueprints](https://blueprints.launchpad.net/xibo)
* [Translations](https://translations.launchpad.net/xibo)
* [Answers](https://answers.launchpad.net/xibo)

# Directory traversal in index.php

Bug #1093967 reported by
[Amril Jafni Joehari](https://launchpad.net/~amriljafni)
on 2012-12-27

[260](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Xibo](https://bugs.launchpad.net/xibo) | Fix Released | Critical | Unassigned | [Xibo 1.5.0 "d'Arrest"](https://launchpad.net/xibo/%2Bmilestone/1.5.0) |
|  | [1.2](https://bugs.launchpad.net/xibo/1.2) | Fix Released | Critical | [Alex Harrington](https://launchpad.net/~alexharrington) | [Xibo 1.2.3 "Biela"](https://launchpad.net/xibo/%2Bmilestone/1.2.3) |
|  | [1.4](https://bugs.launchpad.net/xibo/1.4) | Fix Released | Critical | [Dan Garner](https://launchpad.net/~dangarner) | [Xibo 1.4.2 "Brorsen"](https://launchpad.net/xibo/%2Bmilestone/1.4.2) |
|  | [1.5](https://bugs.launchpad.net/xibo/1.5) | Fix Released | Critical | Unassigned | [Xibo 1.5.0 "d'Arrest"](https://launchpad.net/xibo/%2Bmilestone/1.5.0) |

### Bug Description

Hi Xibo Team,

Our pentesters (Detica - BAE Systems) have found a directory traversal vulnerability in Xibo 1.2.2. We have tested on version 1.2.2 and 1.4.1 in our staging environment. The bug exist on "p" parameter in index.php and unauthenticated users can exploit the bug.

POC:

<http://host.com/index.php?p=../../../../../../../../../../../../../../../../etc/passwd%00index&q=About&ajax=true&_=1355714673828>

Expected output will show the content of /etc/passwd if the server is running Linux.

Please email me for screenshot and details.

## Related branches

[lp:~dangarner/xibo/server-142](https://code.launchpad.net/~dangarner/xibo/server-142)
(Merged)

[lp:~alexharrington/xibo/server-123](https://code.launchpad.net/~alexharrington/xibo/server-123)
(Merged)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Amril Jafni Joehari (amriljafni)](https://launchpad.net/~amriljafni) wrote on 2012-12-27: |  |  | [#1](/xibo/%2Bbug/1093967/comments/1) |
| --- | --- | --- | --- |

* [xibo 1.4.1 debug log](https://bugs.launchpad.net/xibo/%2Bbug/1093967/%2Battachment/3468728/%2Bfiles/troubleshoot.txt)
  [Edit](/xibo/%2Bbug/1093967/%2Battachment/3468728)
  (45.4 KiB,
  text/plain)

| **information type**: | Private Security → Public Security |
| --- | --- |

[Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington)
on 2012-12-27

| **information type**: | Public Security → Private Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-01-02: |  |  | [#2](/xibo/%2Bbug/1093967/comments/2) |
| --- | --- | --- | --- |

Thanks for reporting this Amril. We'll confirm and look at releasing a patch shortly.

Thanks for reporting this Amril. We'll confirm and look at releasing a patch shortly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-01-02: |  |  | [#3](/xibo/%2Bbug/1093967/comments/3) |
| --- | --- | --- | --- |

I've had a bash at confirming and it doesn't seem to work for me. I've tried the string you gave and ammending the number of ../ appropriately but I can't get the contents of /etc/passwd to show.

What it's doing is adding .class.php to the name supplied in the p= query so the target file isn't opened, however you're absolutely correct that this has potential to be exploited to execute code uploaded by a third party to a different folder on the server.

The p= argument needs to be sanitised to remove ../ characters or some similar fix.

I'll mark as confirmed and we'll get a patch out.

Many thanks for your help finding this.

I've had a bash at confirming and it doesn't seem to work for me. I've tried the string you gave and ammending the number of ../ appropriately but I can't get the contents of /etc/passwd to show.
What it's doing is adding .class.php to the name supplied in the p= query so the target file isn't opened, however you're absolutely correct that this has potential to be exploited to execute code uploaded by a third party to a different folder on the server.
The p= argument needs to be sanitised to remove ../ characters or some similar fix.
I'll mark as confirmed and we'll get a patch out.
Many thanks for your help finding this.

| Changed in xibo: | |
| --- | --- |
| **status**: | New → Confirmed |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-01-02: |  |  | [#4](/xibo/%2Bbug/1093967/comments/4) |
| --- | --- | --- | --- |

Kit seems to allow ../ as part of a word validation here:

[http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head:/server/lib/include.php#L136](http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head%3A/server/lib/include.php#L136)

Then on creation of the PageManager class, that string is used without further validation here:

[http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head:/server/lib/app/pagemanager.class.php#L44](http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head%3A/server/lib/app/pagemanager.class.php#L44)

Kit seems to allow ../ as part of a word validation here:
http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head:/server/lib/include.php#L136
Then on creation of the PageManager class, that string is used without further validation here:
http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head:/server/lib/app/pagemanager.class.php#L44

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Amril Jafni Joehari (amriljafni)](https://launchpad.net/~amriljafni) wrote on 2013-01-03: |  |  | [#5](/xibo/%2Bbug/1093967/comments/5) |
| --- | --- | --- | --- |

Thank you for looking into this. I am looking forward for the patch.

Thank you for looking into this. I am looking forward for the patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-01-22: |  |  | [#6](/xibo/%2Bbug/1093967/comments/6) |
| --- | --- | --- | --- |

Please try the following:

[http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head:/server/lib/app/kit.class.php#L286](http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head%3A/server/lib/app/kit.class.php#L286)

In kit.class.php, please replace line 286 as follows:

$return = (string) preg\_replace( '/[^A-Z\_-]/i', '', $return );

So the whole section reads:

   case \_WORD :

    if ($return == '')

    {

     $return = '';

     break;

    }

$return = (string) preg\_replace('/[^A-Z\_-]/i', '', $return );

    break;

I'm testing this on one of my systems and will look for any unintended side effects

Please try the following:
http://bazaar.launchpad.net/~xibo-maintainers/xibo/head-14-fix/view/head:/server/lib/app/kit.class.php#L286
In kit.class.php, please replace line 286 as follows:
$return = (string) preg\_replace( '/[^A-Z\_-]/i', '', $return );
So the whole section reads:
case \_WORD :
if ($return == '')
{
$return = '';
break;
}
$return = (string) preg\_replace('/[^A-Z\_-]/i', '', $return );
break;
I'm testing this on one of my systems and will look for any unintended side effects

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-01-22: |  |  | [#7](/xibo/%2Bbug/1093967/comments/7) |
| --- | --- | --- | --- |

Note the above will prevent the reported exploit, however there should still be code on creating a PageManager class to check for the existence of the loaded class and give a graceful error if it doesn't exist.

Note the above will prevent the reported exploit, however there should still be code on creating a PageManager class to check for the existence of the loaded class and give a graceful error if it doesn't exist.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Amril Jafni Joehari (amriljafni)](https://launchpad.net/~amriljafni) wrote on 2013-01-23: |  |  | [#8](/xibo/%2Bbug/1093967/comments/8) |
| --- | --- | --- | --- |

I am testing this out in our staging environment. will revert back if there are any issue found.

I am testing this out in our staging environment. will revert back if there are any issue found.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-01-31: |  |  | [#9](/xibo/%2Bbug/1093967/comments/9) |
| --- | --- | --- | --- |

I've not seen any issue as a result of this change. Amril has it been OK for you?

I've not seen any issue as a result of this change. Amril has it been OK for you?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Amril Jafni Joehari (amriljafni)](https://launchpad.net/~amriljafni) wrote on 2013-01-31: |  |  | [#10](/xibo/%2Bbug/1093967/comments/10) |
| --- | --- | --- | --- |

We have also did the advised changes on our staging env. The vulnerability is no longer exploitable. Currently we are still waiting a response from functional testing. So far all seems OK.

We have also did the advised changes on our staging env. The vulnerability is no longer exploitable. Currently we are still waiting a response from functional testing. So far all seems OK.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-01-31: |  |  | [#11](/xibo/%2Bbug/1093967/comments/11) |
| --- | --- | --- | --- |

Thanks for the update. Assuming no issue is found, my proposal would be that we quietly merge this in to the next release and produce a 1.2 patch for those needing to continue running 1.2. We can say that it fixes a security issue but be non-specific about what the bug was - we'll just link to this report (which they won't be able to read as it's currently private).

Once that's been released for a month or so, having given people a chance to upgrade or patch their systems, I'll set the visibility of this bug to public and those interested can pick over the notes if they wish.

Does that seem reasonable - Dan?

Also still need to implement validation before we try and load a class with the PageManager - but suggest we only include that in 1.4.2 onwards as it's not important to fixing this issue completely.

Thanks for the update. Assuming no issue is found, my proposal would be that we quietly merge this in to the next release and produce a 1.2 patch for those needing to continue running 1.2. We can say that it fixes a security issue but be non-specific about what the bug was - we'll just link to this report (which they won't be able to read as it's currently private).
Once that's been released for a month or so, having given people a chance to upgrade or patch their systems, I'll set the visibility of this bug to public and those interested can pick over the notes if they wish.
Does that seem reasonable - Dan?
Also still need to implement validation before we try and load a class with the PageManager - but suggest we only include that in 1.4.2 onwards as it's not important to fixing this issue completely.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Garner (dangarner)](https://launchpad.net/~dangarner) wrote on 2013-01-31: |  |  | [#12](/xibo/%2Bbug/1093967/comments/12) |
| --- | --- | --- | --- |

Yes that works well for me, I will implement your fix and some extra validation on the Page Manger class.

Yes that works well for me, I will implement your fix and some extra validation on the Page Manger class.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Garner (dangarner)](https://launchpad.net/~dangarner) wrote on 2013-02-02: |  |  | [#13](/xibo/%2Bbug/1093967/comments/13) |
| --- | --- | --- | --- |

Alex - can you double check the page manager modifications.

<http://bazaar.launchpad.net/~dangarner/xibo/server-142/revision/269#server/lib/app/pagemanager.class.php>

Alex - can you double check the page manager modifications.
http://bazaar.launchpad.net/~dangarner/xibo/server-142/revision/269#server/lib/app/pagemanager.class.php

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-02-02: |  |  | [#14](/xibo/%2Bbug/1093967/comments/14) |
| --- | --- | --- | --- |

It's really hard to read the diff because it looks like the line indenting was changed so it thinks the entire file is new :(

So as I understand it there's a check if the user is authenticated for that module. If the module doesn't exist in the DB then users that aren't SuperAdmins will fail that check and the code indicated in p= will never be loaded?

If I've understood it correctly then yes that sounds fine.

It's really hard to read the diff because it looks like the line indenting was changed so it thinks the entire file is new :(
So as I understand it there's a check if the user is authenticated for that module. If the module doesn't exist in the DB then users that aren't SuperAdmins will fail that check and the code indicated in p= will never be loaded?
If I've understood it correctly then yes that sounds fine.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dan Garner (dangarner)](https://launchpad.net/~dangarner) wrote on 2013-02-03: |  |  | [#15](/xibo/%2Bbug/1093967/comments/15) |
| --- | --- | --- | --- |

I did rewrite the entire file... it was loading the file requested by "p" before it had validated security. Now it will always either a) validate security in the DB, or b) check that p is in the following array:

private $nonAuthedPages = array('index', 'clock');

I did rewrite the entire file... it was loading the file requested by "p" before it had validated security. Now it will always either a) validate security in the DB, or b) check that p is in the following array:
private $nonAuthedPages = array('index', 'clock');

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [mahendra (mahendra-0)](https://launchpad.net/~mahendra-0) wrote on 2013-02-19: |  |  | [#16](/xibo/%2Bbug/1093967/comments/16) |
| --- | --- | --- | --- |

Hi Xibo Team,

I am Mahendra from BAE Systems Detica which performed pentest for Amril and identified this vulnerability.

May i know when are your team will release the patch to public? We want to release an advisory of this issue on our website.

Thank you.

Hi Xibo Team,
I am Mahendra from BAE Systems Detica which performed pentest for Amril and identified this vulnerability.
May i know when are your team will release the patch to public? We want to release an advisory of this issue on our website.
Thank you.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-02-19: |  |  | [#17](/xibo/%2Bbug/1093967/comments/17) |
| --- | --- | --- | --- |

It will be part of 1.4.2 which will be released soon.

We'd ask you not to release any details of the exploit until 1 month after release to give end users time to upgrade.

We will then make the contents of this bug public so peopld have a full disclosure of the issue.

Do I take it no issues were found in your functional testing with this patch applied?

It will be part of 1.4.2 which will be released soon.
We'd ask you not to release any details of the exploit until 1 month after release to give end users time to upgrade.
We will then make the contents of this bug public so peopld have a full disclosure of the issue.
Do I take it no issues were found in your functional testing with this patch applied?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [mahendra (mahendra-0)](https://launchpad.net/~mahendra-0) wrote on 2013-02-19: |  |  | [#18](/xibo/%2Bbug/1093967/comments/18) |
| --- | --- | --- | --- |

Hi Alex,

No worries, we will follow your procedures for releasing the advisory.

We have not done any tests yet after the patch has been applied by Amril and team, thus i cannot confirm this one for you yet.

Hi Alex,
No worries, we will follow your procedures for releasing the advisory.
We have not done any tests yet after the patch has been applied by Amril and team, thus i cannot confirm this one for you yet.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-02-19: |  |  | [#19](/xibo/%2Bbug/1093967/comments/19) |
| --- | --- | --- | --- |

How would you like to be credited in the release note? BAE Systems Detica?

Best wishes

Alex

How would you like to be credited in the release note? BAE Systems Detica?
Best wishes
Alex

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [mahendra (mahendra-0)](https://launchpad.net/~mahendra-0) wrote on 2013-02-19: |  |  | [#20](/xibo/%2Bbug/1093967/comments/20) |
| --- | --- | --- | --- |

Hi Alex,

Can you credit it as Mahendra, BAE Systems Detica ?

Thank you

Hi Alex,
Can you credit it as Mahendra, BAE Systems Detica ?
Thank you

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-02-19: |  |  | [#21](/xibo/%2Bbug/1093967/comments/21) |
| --- | --- | --- | --- |

Certainly. Thanks for your help with this.

Certainly. Thanks for your help with this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Alex Harrington (alexharrington)](https://launchpad.net/~alexharrington) wrote on 2013-03-20: |  |  | [#22](/xibo/%2Bbug/1093967/comments/22) |
| --- | --- | --- | --- |

Marked as public

Marked as public

| **information type**: | Private Security → Public Security |
| --- | --- |

[See full activity log](https://bugs.launchpad.net/xibo/%2Bbug/1093967/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/xibo/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/xibo/%2Bbug/1093967/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/xibo/%2Bbug/1093967/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/xibo/%2Bbug/1093967/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Bug attachments

* [xibo 1.4.1 debug log](https://bugs.launchpad.net/xibo/%2Bbug/1093967/%2Battachment/3468728/%2Bfiles/troubleshoot.txt)
  [Edit](/xibo/%2Bbug/1093967/%2Battachment/3468728 "Change attachment details")

* [Add attachment](/xibo/%2Bbug/1093967/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


