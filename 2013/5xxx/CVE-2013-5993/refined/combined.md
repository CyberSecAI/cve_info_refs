=== Content from svn.ec-cube.net_c1a7da65_20250125_011348.html ===

[![EC-CUBE](/open_trac/raw-attachment/wiki/WikiStart/trac.jpg)](http://svn.ec-cube.net/open_trac/)

Search:

* [Login](/open_trac/login)
* [Help/Guide](/open_trac/wiki/TracGuide)
* [About Trac](/open_trac/about)
* [Preferences](/open_trac/prefs)

* [Wiki](/open_trac/wiki)
* [Browse Source](/open_trac/browser)
* [View Tickets](/open_trac/report)
* [Search](/open_trac/search)
* [Timeline](/open_trac/timeline)
* [Roadmap](/open_trac/roadmap)

## Context Navigation

* ← [Previous Changeset](/open_trac/changeset/23276 "Changeset 23276")
* [Next Changeset](/open_trac/changeset/23278 "Changeset 23278") →

---

# Changeset 23277

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
2013/11/18 13:07:02
([11 years](/open_trac/timeline?from=2013-11-18T13%3A07%3A02%2B09%3A00&precision=second "2013-11-18T13:07:02+09:00 in Timeline") ago)

Author:
m\_uehara
Message:

[#2463](/open_trac/ticket/2463 "バグ指摘: 退会画面の入力チェックの見直し (closed: 修正済)") 退会画面の入力チェックの見直し

Location:
[branches/version-2\_13\_1/data](/open_trac/browser/branches/version-2_13_1/data?rev=23277)
Files:

4 edited

* [Smarty/templates/default/mypage/refusal\_confirm.tpl](/open_trac/browser/branches/version-2_13_1/data/Smarty/templates/default/mypage/refusal_confirm.tpl?rev=23277 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [Smarty/templates/mobile/mypage/refusal.tpl](/open_trac/browser/branches/version-2_13_1/data/Smarty/templates/mobile/mypage/refusal.tpl?rev=23277 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [Smarty/templates/sphone/mypage/refusal\_confirm.tpl](/open_trac/browser/branches/version-2_13_1/data/Smarty/templates/sphone/mypage/refusal_confirm.tpl?rev=23277 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [class/pages/mypage/LC\_Page\_Mypage\_Refusal.php](/open_trac/browser/branches/version-2_13_1/data/class/pages/mypage/LC_Page_Mypage_Refusal.php?rev=23277 "Show entry in browser")
  (modified)
  ([3 diffs](#file3 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [branches/version-2\_13\_1/data/Smarty/templates/default/mypage/refusal\_confirm.tpl](/open_trac/changeset/23277/branches/version-2_13_1/data/Smarty/templates/default/mypage/refusal_confirm.tpl "Show the changeset 23277 restricted to branches/version-2_13_1/data/Smarty/templates/default/mypage/refusal_confirm.tpl")

  | [r23134](/open_trac/browser/branches/version-2_13-dev/data/Smarty/templates/default/mypage/refusal_confirm.tpl?rev=23134#L28 "Show revision 23134 of this file in browser") | [r23277](/open_trac/browser/branches/version-2_13_1/data/Smarty/templates/default/mypage/refusal_confirm.tpl?rev=23277#L28 "Show revision 23277 of this file in browser") |  |
  | --- | --- | --- |
  | 28 | 28 | <form name="form1" id="form1" method="post" action="?"> |
  | 29 | 29 | <input type="hidden" name="<!--{$smarty.const.TRANSACTION\_ID\_NAME}-->" value="<!--{$transactionid}-->" /> |
  |  | 30 | <input type="hidden" name="refusal\_transactionid" value="<!--{$refusal\_transactionid}-->" /> |
  | 30 | 31 | <input type="hidden" name="mode" value="complete" /> |
  | 31 | 32 |  |
* ## [branches/version-2\_13\_1/data/Smarty/templates/mobile/mypage/refusal.tpl](/open_trac/changeset/23277/branches/version-2_13_1/data/Smarty/templates/mobile/mypage/refusal.tpl "Show the changeset 23277 restricted to branches/version-2_13_1/data/Smarty/templates/mobile/mypage/refusal.tpl")

  | [r22206](/open_trac/browser/branches/version-2_12-dev/data/Smarty/templates/mobile/mypage/refusal.tpl?rev=22206#L29 "Show revision 22206 of this file in browser") | [r23277](/open_trac/browser/branches/version-2_13_1/data/Smarty/templates/mobile/mypage/refusal.tpl?rev=23277#L29 "Show revision 23277 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | <form action="?" method="post"> |
  | 30 | 30 | <input type="hidden" name="mode" value="complete"> |
  |  | 31 | <input type="hidden" name="refusal\_transactionid" value="<!--{$refusal\_transactionid}-->" /> |
  | 31 | 32 | <input type="hidden" name="<!--{$smarty.const.TRANSACTION\_ID\_NAME}-->" value="<!--{$transactionid}-->"> |
  | 32 | 33 |  |
* ## [branches/version-2\_13\_1/data/Smarty/templates/sphone/mypage/refusal\_confirm.tpl](/open_trac/changeset/23277/branches/version-2_13_1/data/Smarty/templates/sphone/mypage/refusal_confirm.tpl "Show the changeset 23277 restricted to branches/version-2_13_1/data/Smarty/templates/sphone/mypage/refusal_confirm.tpl")

  | [r23134](/open_trac/browser/branches/version-2_13-dev/data/Smarty/templates/sphone/mypage/refusal_confirm.tpl?rev=23134#L28 "Show revision 23134 of this file in browser") | [r23277](/open_trac/browser/branches/version-2_13_1/data/Smarty/templates/sphone/mypage/refusal_confirm.tpl?rev=23277#L28 "Show revision 23277 of this file in browser") |  |
  | --- | --- | --- |
  | 28 | 28 | <form name="form1" id="form1" method="post" action="<!--{$smarty.const.HTTPS\_URL}-->mypage/refusal.php"> |
  | 29 | 29 | <input type="hidden" name="<!--{$smarty.const.TRANSACTION\_ID\_NAME}-->" value="<!--{$transactionid}-->" /> |
  |  | 30 | <input type="hidden" name="refusal\_transactionid" value="<!--{$refusal\_transactionid}-->" /> |
  | 30 | 31 | <input type="hidden" name="mode" value="complete" /> |
  | 31 | 32 |  |
* ## [branches/version-2\_13\_1/data/class/pages/mypage/LC\_Page\_Mypage\_Refusal.php](/open_trac/changeset/23277/branches/version-2_13_1/data/class/pages/mypage/LC_Page_Mypage_Refusal.php "Show the changeset 23277 restricted to branches/version-2_13_1/data/class/pages/mypage/LC_Page_Mypage_Refusal.php")

  | [r23124](/open_trac/browser/branches/version-2_13-dev/data/class/pages/mypage/LC_Page_Mypage_Refusal.php?rev=23124#L64 "Show revision 23124 of this file in browser") | [r23277](/open_trac/browser/branches/version-2_13_1/data/class/pages/mypage/LC_Page_Mypage_Refusal.php?rev=23277#L64 "Show revision 23277 of this file in browser") |  |
  | --- | --- | --- |
  | 64 | 64 | switch ($this->getMode()) { |
  | 65 | 65 | case 'confirm': |
  |  | 66 | // トークンを設定 |
  |  | 67 | $this->refusal\_transactionid = $this->getRefusalToken(); |
  |  | 68 |  |
  | 66 | 69 | $this->tpl\_mainpage     = 'mypage/refusal\_confirm.tpl'; |
  | 67 | 70 | $this->tpl\_subtitle     = '退会手続き(確認ページ)'; |
  | […](/open_trac/browser/branches/version-2_13-dev/data/class/pages/mypage/LC_Page_Mypage_Refusal.php?rev=23124#L69) | […](/open_trac/browser/branches/version-2_13_1/data/class/pages/mypage/LC_Page_Mypage_Refusal.php?rev=23277#L72) |  |
  | 69 | 72 |  |
  | 70 | 73 | case 'complete': |
  |  | 74 | // トークン入力チェック |
  |  | 75 | if(!$this->isValidRefusalToken()) { |
  |  | 76 | // エラー画面へ遷移する |
  |  | 77 | SC\_Utils\_Ex::sfDispSiteError(PAGE\_ERROR, '', true); |
  |  | 78 | SC\_Response\_Ex::actionExit(); |
  |  | 79 | } |
  |  | 80 |  |
  | 71 | 81 | $objCustomer = new SC\_Customer\_Ex(); |
  | 72 | 82 | $this->lfDeleteCustomer($objCustomer->getValue('customer\_id')); |
  | […](/open_trac/browser/branches/version-2_13-dev/data/class/pages/mypage/LC_Page_Mypage_Refusal.php?rev=23124#L76) | […](/open_trac/browser/branches/version-2_13_1/data/class/pages/mypage/LC_Page_Mypage_Refusal.php?rev=23277#L86) |  |
  | 76 | 86 |  |
  | 77 | 87 | default: |
  |  | 88 | if (SC\_Display\_Ex::detectDevice() == DEVICE\_TYPE\_MOBILE) { |
  |  | 89 | $this->refusal\_transactionid = $this->getRefusalToken(); |
  |  | 90 | } |
  | 78 | 91 | break; |
  | 79 | 92 | } |
  | 80 | 93 |  |
  |  | 94 | } |
  |  | 95 |  |
  |  | 96 | /\*\* |
  |  | 97 | \* トランザクショントークンを取得する |
  |  | 98 | \* |
  |  | 99 | \* @return string |
  |  | 100 | \*/ |
  |  | 101 | function getRefusalToken() { |
  |  | 102 | if (empty($\_SESSION['refusal\_transactionid'])) { |
  |  | 103 | $\_SESSION['refusal\_transactionid'] = SC\_Helper\_Session\_Ex::createToken(); |
  |  | 104 | } |
  |  | 105 | return $\_SESSION['refusal\_transactionid']; |
  |  | 106 | } |
  |  | 107 |  |
  |  | 108 | /\*\* |
  |  | 109 | \* トランザクショントークンのチェックを行う |
  |  | 110 | \*/ |
  |  | 111 | function isValidRefusalToken() { |
  |  | 112 | if(empty($\_POST['refusal\_transactionid'])) { |
  |  | 113 | $ret = false; |
  |  | 114 | } else { |
  |  | 115 | $ret = $\_POST['refusal\_transactionid'] === $\_SESSION['refusal\_transactionid']; |
  |  | 116 | } |
  |  | 117 |  |
  |  | 118 | return $ret; |
  |  | 119 | } |
  |  | 120 |  |
  |  | 121 | /\*\* |
  |  | 122 | \* トランザクショントークを破棄する |
  |  | 123 | \*/ |
  |  | 124 | function destroyRefusalToken() { |
  |  | 125 | unset($\_SESSION['refusal\_transactionid']); |
  | 81 | 126 | } |
  | 82 | 127 |  |

**Note:** See [TracChangeset](/open_trac/wiki/TracChangeset)
for help on using the changeset viewer.

### Download in other formats:

* [Unified Diff](?format=diff&new=23277)
* [Zip Archive](?format=zip&new=23277)

---

[![Trac Powered](/open_trac_common/htdocs/common/trac_logo_mini.png)](http://trac.edgewall.org/)

Powered by [**Trac 0.12.ja1**](/open_trac/about)

By [Edgewall Software](http://www.edgewall.org/).

Re-distributed by [インタアクト株式会社](http://www.i-act.co.jp/)

Visit the Trac open source project at
<http://trac.edgewall.org/>



=== Content from jvn.jp_f0c5e3c1_20250125_011344.html ===


![Japan Vulnerability Notes](/common/img/note_logo.gif)

Published:2013/11/20  Last Updated:2013/11/20
# JVN#11221613 EC-CUBE vulnerable to cross-site request forgery

## Overview

EC-CUBE contains a cross-site request forgery vulnerability.

## Products Affected

* EC-CUBE 2.11.0
* EC-CUBE 2.11.1
* EC-CUBE 2.11.2
* EC-CUBE 2.11.3
* EC-CUBE 2.11.4
* EC-CUBE 2.11.5
* EC-CUBE 2.12.0
* EC-CUBE 2.12.1
* EC-CUBE 2.12.2
* EC-CUBE 2.12.3
* EC-CUBE 2.12.3en
* EC-CUBE 2.12.3enP1
* EC-CUBE 2.12.3enP2
* EC-CUBE 2.12.4
* EC-CUBE 2.12.4en
* EC-CUBE 2.12.5
* EC-CUBE 2.12.5en
* EC-CUBE 2.12.6
* EC-CUBE 2.12.6en
* EC-CUBE 2.13.0

## Description

EC-CUBE from LOCKON CO.,LTD. is an open source system for creating
shopping websites. EC-CUBE contains a cross-site request forgery vulnerability.

## Impact

If a user views a malicious page while logged in, unintended operations may be conducted.

## Solution

**Apply the update or the patch**
Apply the update or the patch according to the information provided by the developer.

## Vendor Status

| Vendor | Link |
| --- | --- |
| LOCKON CO.,LTD. | [Cross-site request forgery vulnerability](http://www.ec-cube.net/info/weakness/weakness.php?id=53) |

## References

## JPCERT/CC Addendum

## Vulnerability Analysis by JPCERT/CC

**Analyzed on 2013.11.20**

| Measures | Conditions | Severity |
| Access Required | can be attacked over the Internet using packets | * High |
| Authentication | anonymous or no authentication (IP addresses do not count) | * High |
| User Interaction Required | the user must be convinced to take a standard action that does not feel harmful to most users, such as click on a link or view a file | * Mid |
| Exploit Complexity | some expertise and/or luck required (most buffer overflows, guessing correctly in small space, expertise in Windows function calls) | * Mid-High |

[Description of each analysis measures](http://jvn.jp/en/nav/jvnhelp.html#analysys)

## Credit

Gen Sato reported this vulnerability to the developer.

## Other Information

| JPCERT Alert |  |
| --- | --- |
| JPCERT Reports |  |
| CERT Advisory |  |
| CPNI Advisory |  |
| TRnotes |  |
| CVE | [CVE-2013-5993](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-5993) |
| JVN iPedia | [JVNDB-2013-000097](http://jvndb.jvn.jp/jvndb/JVNDB-2013-000097) |

* JVN
* HOME
* What is JVN ?
* Instructions
* List of Vulnerability Report
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* TRnotes
* JVN iPedia
* MyJVN
* JVNJS/RSS
* Vendor List
* List of unreachable developers
* Contact

Copyright (c) 2000-2013 JPCERT/CC and IPA. All rights reserved.



=== Content from jvndb.jvn.jp_c87c1a45_20250125_011347.html ===


![JVN iPedia](/en/common/img/en_logo.gif)
Last Updated:2013/11/22

| [[Japanese]](/ja/contents/2013/JVNDB-2013-000097.html) | |
| --- | --- |
| JVNDB-2013-000097 | |
| EC-CUBE vulnerable to cross-site request forgery | |
| Overview | |
| EC-CUBE from LOCKON CO.,LTD. is an open source system for creating shopping websites. EC-CUBE contains a cross-site request forgery vulnerability. | |
| CVSS Severity ([What is CVSS?](/en/nav/jvndbhelp.html#jvndb3)) | |
| **CVSS V2 Severity:Base Metrics [2.6](/cvss/en/v2.html#AV:N/AC:H/Au:N/C:N/I:P/A:N) (Low) [IPA Score]**  * Access Vector: Network * Access Complexity: High * Authentication: None * Confidentiality Impact: None * Integrity Impact: Partial * Availability Impact: None | |
| Affected Products | |
|  | |
| LOCKON CO.,LTD  * EC-CUBE 2.11.0 * EC-CUBE 2.11.1 * EC-CUBE 2.11.2 * EC-CUBE 2.11.3 * EC-CUBE 2.11.4 * EC-CUBE 2.11.5 * EC-CUBE 2.12.0 * EC-CUBE 2.12.1 * EC-CUBE 2.12.2 * EC-CUBE 2.12.3 * EC-CUBE 2.12.3en * EC-CUBE 2.12.3enP1 * EC-CUBE 2.12.3enP2 * EC-CUBE 2.12.4 * EC-CUBE 2.12.4en * EC-CUBE 2.12.5 * EC-CUBE 2.12.5en * EC-CUBE 2.12.6 * EC-CUBE 2.12.6en * EC-CUBE 2.13.0 | |
|  | |
| Impact | |
| If a user views a malicious page while logged in, unintended operations may be conducted. | |
| Solution | |
| [Apply the update or the patch] | |
| Vendor Information | |
| LOCKON CO.,LTD  * EC-CUBE : [Changeset 23277](http://svn.ec-cube.net/open_trac/changeset/23277) (in Japanese) * LOCKON CO.,LTD : [Cross-site request forgery vulnerability](http://www.ec-cube.net/info/weakness/weakness.php?id=53) (in Japanese) | |
| CWE ([What is CWE?](http://www.ipa.go.jp/security/english/vuln/CWE_en.html)) | |
| 1. [Cross-Site Request Forgery](http://www.ipa.go.jp/security/english/vuln/CWE_en.html#CWE352)(CWE-352) [IPA Evaluation] | |
| CVE ([What is CVE?](http://www.ipa.go.jp/security/english/vuln/CVE_en.html)) | |
| 1. [CVE-2013-5993](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-5993) | |
| References | |
| 1. JVN : [JVN#11221613](http://jvn.jp/en/jp/JVN11221613/index.html) 2. National Vulnerability Database (NVD) : [CVE-2013-5993](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2013-5993) | |
| Revision History | |
| * [2013/11/20] | |

| --- | |
| --- | --- |
| Date Public | 2013/11/20 |
| Date First Published | 2013/11/20 |
| Date Last Updated | 2013/11/22 |
| --- | |

* JVN
* [HOME](http://jvn.jp/en/)
* [What is JVN ?](http://jvn.jp/en/nav/jvn.html)
* [Instructions](http://jvn.jp/en/nav/jvnhelp.html)
* [List of Vulnerability Report](http://jvn.jp/en/report/index.html)
* [VN\_JP](http://jvn.jp/en/jp/index.html)
* [VN\_JP(Unreachable)](http://jvn.jp/en/adj/index.html)
* [VN\_VU](http://jvn.jp/en/vu/index.html)
* [TA](http://jvn.jp/en/ta/index.html)
* [TRnotes](http://jvn.jp/en/tr/index.html)
* [JVN iPedia](/en/)
* [Search](/search/index.php?mode=_vulnerability_search_IA_VulnSearch&lang=en)
* [What is JVN iPedia?](/en/nav/jvndb.html)
* [How to Use?](/en/nav/jvndbhelp.html)
* [MyJVN](/en/apis/myjvn/index.html)
* [JVNJS/RSS](http://jvn.jp/en/rss/index.html)
* [Vendor List](http://jvn.jp/en/nav/index.html)
* [List of unreachable developers](http://jvn.jp/en/reply/index.html)
* [Contact](http://jvn.jp/en/contact/index.html)

![Copyright © 2007- IPA. All rights reserved.](/common/img/copyright.png)


