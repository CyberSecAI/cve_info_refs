=== Content from bugzilla.mozilla.org_80513386_20250125_154632.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/896126)
* [XML](/show_bug.cgi?ctype=xml&id=896126)

Closed
[Bug 896126](/show_bug.cgi?id=896126)

Opened 12 years ago
Closed 12 years ago

# Assertion failure: parent, at jswrapper.cpp

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: parent, at jswrapper.cpp

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla25

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 | --- | [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) |
| firefox24 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 |  | affected |
| firefox24 |  | fixed |
| firefox25 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[CVE-2013-1738](/show_bug.cgi?id=887334 "RESOLVED FIXED - GC hazard with default compartments and frame chain restoration")

Dependency [tree](/showdependencytree.cgi?id=896126&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=896126)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [jsbugmon:update][adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:update][adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [stack](/attachment.cgi?id=778746)  [12 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   12.52 KB, text/plain |  | [Details](/attachment.cgi?id=778746&action=edit) |
| --- | --- | --- |
| [[crash-signature] Machine-readable crash signature](/attachment.cgi?id=779140)  [12 years ago](#c3)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   607 bytes, text/plain |  | [Details](/attachment.cgi?id=779140&action=edit) |
| [same testcase in comment 0](/attachment.cgi?id=779355)  [12 years ago](#c4)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   154 bytes, text/plain |  | [Details](/attachment.cgi?id=779355&action=edit) |
| [Don't wrap pending exceptions into the atoms compartment. v1](/attachment.cgi?id=779368)  [12 years ago](#c6)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.11 KB, patch | luke : [review+](#a248270_347312 "12 years ago") | [Details](/attachment.cgi?id=779368&action=edit) | [Diff](/attachment.cgi?id=779368&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=896126&attachment=779368) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=896126#c0)• 12 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=778746)
— [Details](attachment.cgi?id=778746&action=edit)

({
r: function() {
function f() {
w[0xe56241c6 >> 3]
}
},
s: function() {
"use asm"
return (1 for
asserts js debug shell on m-c changeset 0d0263a58f06 without any CLI arguments at Assertion failure: parent, at jswrapper.cpp

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=896126#c1)• 12 years ago |
|  | |

autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: <http://hg.mozilla.org/mozilla-central/rev/d09d109a7e88>
user: Bobby Holley
date: Wed Jul 17 11:53:52 2013 -0700
summary: [Bug 887334](/show_bug.cgi?id=887334 "RESOLVED FIXED - GC hazard with default compartments and frame chain restoration") - Use the new AutoCompartment overload for the atoms compartment and remove AutoEnterAtomsCompartment. r=bhackettBlocks: [CVE-2013-1738](/show_bug.cgi?id=887334 "RESOLVED FIXED - GC hazard with default compartments and frame chain restoration")Flags: needinfo?(bobbyholley+bmo)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=896126#c2)• 12 years ago |
|  | |

LangFuzz also found tests for this, but they involve gczeal:
gczeal(2,1);
function runTestCase(testcase) {
$ERROR('Test case returned non-true value!');
}
function newFunc(x) { new Function(x)(); };
newFunc("\
function testcase() {\
\"use strict\";\
try {} catch (eval) {}\
}\
runTestCase(testcase);\
");
Marking s-s based on that.Group: core-security

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=896126#c3)• 12 years ago |
|  | |

Attached file
[[crash-signature] Machine-readable crash signature](attachment.cgi?id=779140)
— [Details](attachment.cgi?id=779140&action=edit)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=896126#c4)• 12 years ago |
|  | |

Attached file
[same testcase in comment 0](attachment.cgi?id=779355)
— [Details](attachment.cgi?id=779355&action=edit)

I can reproduce using:
<http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2013-07-22-mozilla-central-debug/jsshell-mac64.zip>
./js testcase.js
Assertion failure: parent, at ../../../js/src/jswrapper.cpp:35

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=896126#c5)• 12 years ago |
|  | |

Ah, I was doing |./js < testcase.js|. Gary explained IRL that I need to drop the |<|.Flags: needinfo?(bobbyholley+bmo)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a244497_313730)• 12 years ago |

Assignee: general → bobbyholley+bmo

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=896126#c6)• 12 years ago |
|  | |

Attached patch

[Don't wrap pending exceptions into the atoms compartment. v1](attachment.cgi?id=779368&action=diff)
— [Details](attachment.cgi?id=779368&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=896126&attachment=779368)

[Attachment #779368](/attachment.cgi?id=779368&action=edit "Don't wrap pending exceptions into the atoms compartment. v1") -
Flags: review?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a244770_313730)• 12 years ago |

[Attachment #779368](/attachment.cgi?id=779368&action=edit "Don't wrap pending exceptions into the atoms compartment. v1") -
Flags: review? → review?(luke)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=896126#c7)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=5ff314641023>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a247851_406194)• 12 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a248270_347312)• 12 years ago |

[Attachment #779368](/attachment.cgi?id=779368&action=edit "Don't wrap pending exceptions into the atoms compartment. v1") -
Flags: review?(luke) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=896126#c8)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/de1042bf3026>

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a307262_395101)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:update,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=896126#c9)• 12 years ago |
|  | |

JSBugMon: The testcase found in this bug no longer reproduces (tried revision b717a7945dfb).

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=896126#c10)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/de1042bf3026>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla25

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a321982_132034)• 12 years ago |

Whiteboard: [jsbugmon:update,ignore] → [jsbugmon:update]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a323010_395101)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=896126#c11)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=896126#c12)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/pushloghtml?changeset=84b828b63115>
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=896126#c13)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #12](/show_bug.cgi?id=896126#c12 "VERIFIED FIXED - Assertion failure: parent, at jswrapper.cpp"))
> <https://hg.mozilla.org/releases/mozilla-aurora/>
> pushloghtml?changeset=84b828b63115
Backed out from Aurora for possibly causing xpcshell crashes along with the other changes from bholley's push in <https://hg.mozilla.org/releases/mozilla-aurora/rev/659b0d61fbc6>

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a512368_308534)• 12 years ago |

[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=896126#c14)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/pushloghtml?changeset=5f9484e134f9>
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=896126#c15)• 11 years ago |
|  | |

Backed out for xpcshell failures.
<https://hg.mozilla.org/releases/mozilla-aurora/rev/b3d0c2498b42>
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=896126#c16)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/pushloghtml?changeset=3266c1d73816>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a1024129_313730)• 11 years ago |

[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=896126#c17)• 11 years ago |
|  | |

(In reply to Gary Kwong [:gkw] [:nth10sd] from [comment #1](/show_bug.cgi?id=896126#c1 "VERIFIED FIXED - Assertion failure: parent, at jswrapper.cpp"))
> autoBisect shows this is probably related to the following changeset:
>
> The first bad revision is:
> changeset: <http://hg.mozilla.org/mozilla-central/rev/d09d109a7e88>
> user: Bobby Holley
> date: Wed Jul 17 11:53:52 2013 -0700
> summary: [Bug 887334](/show_bug.cgi?id=887334 "RESOLVED FIXED - GC hazard with default compartments and frame chain restoration") - Use the new AutoCompartment overload for the atoms
> compartment and remove AutoEnterAtomsCompartment. r=bhackett
If this was the regression, why did this affect Firefox 24? Firefox 25 was trunk then.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=896126#c18)• 11 years ago |
|  | |

Probably the wrong regressing bug? bholley might know.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=896126#c19)• 11 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #17](/show_bug.cgi?id=896126#c17 "VERIFIED FIXED - Assertion failure: parent, at jswrapper.cpp"))
> (In reply to Gary Kwong [:gkw] [:nth10sd] from [comment #1](/show_bug.cgi?id=896126#c1 "VERIFIED FIXED - Assertion failure: parent, at jswrapper.cpp"))
> > autoBisect shows this is probably related to the following changeset:
> >
> > The first bad revision is:
> > changeset: <http://hg.mozilla.org/mozilla-central/rev/d09d109a7e88>
> > user: Bobby Holley
> > date: Wed Jul 17 11:53:52 2013 -0700
> > summary: [Bug 887334](/show_bug.cgi?id=887334 "RESOLVED FIXED - GC hazard with default compartments and frame chain restoration") - Use the new AutoCompartment overload for the atoms
> > compartment and remove AutoEnterAtomsCompartment. r=bhackett
>
> If this was the regression, why did this affect Firefox 24? Firefox 25 was
> trunk then.
Because I backported [bug 887334](/show_bug.cgi?id=887334 "RESOLVED FIXED - GC hazard with default compartments and frame chain restoration") to 24.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a3256976_280903)• 11 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)Whiteboard: [jsbugmon:update] → [jsbugmon:update][adv-main24+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=896126#c20)• 11 years ago |
|  | |

regressing bug was not backported to ESR17 or b2g18
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=896126#a42176688_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=896126&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_0ce17698_20250125_154628.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/883450)
* [XML](/show_bug.cgi?ctype=xml&id=883450)

Closed
[Bug 883450](/show_bug.cgi?id=883450)

Opened 12 years ago
Closed 12 years ago

# Conservative Stack Scanner doesn't work when not in a request

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Conservative Stack Scanner doesn't work when not in a request

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |
| b2g-v1.1hd | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=wontfix) |
| b2g-v1.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox24 | + | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| b2g-v1.1hd |  | wontfix |
| b2g-v1.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bholley, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[884362](/show_bug.cgi?id=884362 "RESOLVED FIXED - GC: Fix test crashes in exact browser builds"), [885769](/show_bug.cgi?id=885769 "RESOLVED FIXED - Assertion failure: cxArg, at dist/include/js/RootingAPI.h")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[879649](/show_bug.cgi?id=879649 "RESOLVED FIXED - Add cx push back to nsJSContext::CompileScript"), [884109](/show_bug.cgi?id=884109 "RESOLVED FIXED - Remove use of GetDocumentFromCaller in image and option code")

Dependency [tree](/showdependencytree.cgi?id=883450&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=883450)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-critical, Whiteboard: [Embargo until ESR17 EOL][adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[Embargo until ESR17 EOL][adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files)

| [Part 1 - MOZ\_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1](/attachment.cgi?id=765108)  [12 years ago](#c21)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   3.19 KB, patch | gkrizsanits : [review+](#c30 "12 years ago") | [Details](/attachment.cgi?id=765108&action=edit) | [Diff](/attachment.cgi?id=765108&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765108) |
| --- | --- | --- |
| [Part 2 - Unscope the JSAutoRequest in XPCJSContextStack. v1](/attachment.cgi?id=765109)  [12 years ago](#c22)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.65 KB, patch | gkrizsanits : [review+](#a493138_420273 "12 years ago") | [Details](/attachment.cgi?id=765109&action=edit) | [Diff](/attachment.cgi?id=765109&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765109) |
| [Part 3 - Remove custom request munging in XPCCallContext and use a JSAutoRequest. v1](/attachment.cgi?id=765110)  [12 years ago](#c23)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   8.84 KB, patch | gkrizsanits : [review+](#a493772_420273 "12 years ago") | [Details](/attachment.cgi?id=765110&action=edit) | [Diff](/attachment.cgi?id=765110&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765110) |
| [Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1](/attachment.cgi?id=765111)  [12 years ago](#c24)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   3.76 KB, patch | bzbarsky : [review+](#c28 "12 years ago") | [Details](/attachment.cgi?id=765111&action=edit) | [Diff](/attachment.cgi?id=765111&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765111) |
| [Part 5 - Miscellaneous requests. v1](/attachment.cgi?id=765112)  [12 years ago](#c25)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   10.41 KB, patch | gkrizsanits : [review+](#c33 "12 years ago") | [Details](/attachment.cgi?id=765112&action=edit) | [Diff](/attachment.cgi?id=765112&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765112) |
| [Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1](/attachment.cgi?id=765113)  [12 years ago](#c26)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.18 KB, patch | terrence : [review+](#c34 "12 years ago") | [Details](/attachment.cgi?id=765113&action=edit) | [Diff](/attachment.cgi?id=765113&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765113) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=883450#c0)• 12 years ago |
|  | |

I've been debugging [bug 879649](/show_bug.cgi?id=879649 "RESOLVED FIXED - Add cx push back to nsJSContext::CompileScript") for a good day and a half now, and finally figured out what's going on.
In bug MarkConservativeStackRoots, we bail out of stack scanning if !cgcd->hasStackToScan():
<http://mxr.mozilla.org/mozilla-central/source/js/src/gc/RootMarking.cpp#316>
This predicate just evaluates to !!nativeStackTop - that is to say, whether we have a usable pointer to the top of the stack. This pointer is generated in RecordNativeStackTopForGC, but is then \_cleared\_ in updateForRequestEnd(), which gets called when our request count drops to zero:
<http://mxr.mozilla.org/mozilla-central/source/js/src/jsapi.cpp#1230>
And though RecordNativeStackTopForGC is called at the beginning of Collect(), it no-ops because the request depth is zero:
<http://mxr.mozilla.org/mozilla-central/source/js/src/jsgc.cpp#963>
This means that \_anything\_ on the stack outside of a request isn't rooted at all. I wouldn't be surprised if there were dozens of such cases in the browser - especially from consumers of nsIScriptContext functions, who don't necessarily have a need to enter a request themselves.
Marking sec-critical, because the surface is wide enough that there's almost certainly an exploitable case somewhere.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=883450#c1)• 12 years ago |
|  | |

I think we do sort of depend on being able to skip stack scanning during timer GCs. The stack scanner has a pretty high false positive rate on 32-bit platforms, and I'm afraid we'd leak a lot if we always scanned.
However, we could probably find a better way to decide whether to skip stack scanning. Rather than "are we in a request", maybe we could skip it if we're invoked from a timer GC when we're not in a nested event loop. We also have to watch out for schedulePreciseGC.
One question I have is how this is happening. My assumption was always that:
1. We have to be doing some JSAPI stuff in order to GC.
2. Almost all JSAPI calls assert that you're in a request.
Which one of these is broken in this case?

|  | [Gregor Wagner [:gwagner]](/user_profile?user_id=314734) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=883450#c2)• 12 years ago |
|  | |

Since when do we require a stack scan when we are not in a request?
Only <20% of all our GCs do a stack scan last time I measured.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=883450#c3)• 12 years ago |
|  | |

(In reply to Gregor Wagner [:gwagner] from [comment #2](/show_bug.cgi?id=883450#c2 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> Since when do we require a stack scan when we are not in a request?
> Only <20% of all our GCs do a stack scan last time I measured.
We don't scan the stack when we're not in a request. Bobby filed the bug because he found a case where that caused us to fail to scan something that needed to be scanned. We could just put a request there, but he's worried that it's a widespread problem.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=883450#c4)• 12 years ago |
|  | |

I think the particular case was this:
<http://mxr.mozilla.org/mozilla-central/source/content/xul/content/src/nsXULElement.cpp#2575>
This method has a JSScript pointer that is null, which calls into nsJSContext::CompileScript, which does an AutoRequest, sets the script, then exits the request, so we're in danger, returns the script, then roots the script on the heap. The particular problem he was seeing was that a Pop(), which happened in between the end of the AutoRequest and the return from CompileScript, was triggering a GC.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=883450#c5)• 12 years ago |
|  | |

I guess we could dynamically detect this by adding an assertion to JS::Rooted that we're in a request? Then, if we're properly precisely rooted, we should be properly dynamically rooted, for paths we test. (Of course, there is a certain irony here.)

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=883450#c6)• 12 years ago |
|  | |

Bobby, do you have a stack or anything? I don't see where Pop() can GC outside of a request, but maybe I got lost following all the indirections.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=883450#c7)• 12 years ago |
|  | |

nsCxPusher embeds a JSAutoRequest, but destroys it (manually) before calling xpc::PopContext:
<http://mxr.mozilla.org/mozilla-central/source/js/xpconnect/src/nsCxPusher.cpp#168>
xpc::PopContext invokes JS\_RestoreFrameChain, which can GC (both according to evidence and to mrgiggles).
I also don't think that adding more JSAutoRequests is the right solution to this problem, especially since the Request API is on its way out anyway.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=883450#c8)• 12 years ago |
|  | |

(note that the issue in [bug 879649](/show_bug.cgi?id=879649 "RESOLVED FIXED - Add cx push back to nsJSContext::CompileScript") was that \_adding\_ an AutoPushJSContext (which wraps an nsCxPusher) to nsJSContext::CompileScript caused a ton of crashes in the wild, even though we're incorrect without it).

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=883450#c9)• 12 years ago |
|  | |

> xpc::PopContext invokes JS\_RestoreFrameChain, which can GC (both according to evidence
> and to mrgiggles).
Are you talking about this call?
<http://mxr.mozilla.org/mozilla-central/source/js/xpconnect/src/XPCJSContextStack.cpp#52>
What's confusing is that the line before it opens a request. So the GC should happen inside a request and we should scan the stack, right?

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=883450#c10)• 12 years ago |
|  | |

Also, JS\_RestoreFrameChain does assert that we're in a request.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=883450#c11)• 12 years ago |
|  | |

(In reply to Bill McCloskey (:billm) from [comment #9](/show_bug.cgi?id=883450#c9 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> > xpc::PopContext invokes JS\_RestoreFrameChain, which can GC (both according to evidence
> > and to mrgiggles).
>
> Are you talking about this call?
>
> <http://mxr.mozilla.org/mozilla-central/source/js/xpconnect/src/>
> XPCJSContextStack.cpp#52
> What's confusing is that the line before it opens a request. So the GC
> should happen inside a request and we should scan the stack, right?
(In reply to Bill McCloskey (:billm) from [comment #10](/show_bug.cgi?id=883450#c10 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> Also, JS\_RestoreFrameChain does assert that we're in a request.
Oh, good point. However, shortly after calling PopRequest, we call ScriptEvaluted:
<http://mxr.mozilla.org/mozilla-central/source/js/xpconnect/src/nsCxPusher.cpp#186>
Whose first action in office is to call JS\_MaybeGC():
<http://mxr.mozilla.org/mozilla-central/source/dom/base/nsJSEnvironment.cpp#2333>
So that's probably the cause of the GC we're seeing here.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=883450#c12)• 12 years ago |
|  | |

OK. Direct calls to GC are one of the cases where we don't assert that you're in a request, so that makes sense.
I'm kind of tempted to say that we should just spot-fix this. This problem will go away when exact rooting lands. My sense is that that will be ready roughly at the same time as getting rid of requests. The alternative is to do something like [comment 1](/show_bug.cgi?id=883450#c1 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request") suggests.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=883450#c13)• 12 years ago |
|  | |

(In reply to Bill McCloskey (:billm) from [comment #12](/show_bug.cgi?id=883450#c12 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> I'm kind of tempted to say that we should just spot-fix this. This problem
> will go away when exact rooting lands.
Do you mean spot fix this one case we found? If so, I'm not really comfortable with that. If you mean "sprinkle in JSAutoRequests in the right places," I think that's the correct solution, assuming we can implement strong dynamic enforcement.
I think the right approach is to assert that we're in a request every time we create a Rooted<T>. The static analysis has pointed us to all the places where we want to keep a GCThing alive across GC potential GC calls. For most of those, we should already be in a request. In theory, the only failures that crop up should be the hazards we're trying to fix here. I'll throw in some assertions and see what happens.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a240553_313730)• 12 years ago |

Assignee: general → bobbyholley+bmo

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=883450#c14)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=1f1e1b2f3e9c>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a257015_313730)• 12 years ago |

Blocks: [884109](/show_bug.cgi?id=884109 "RESOLVED FIXED - Remove use of GetDocumentFromCaller in image and option code")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=883450#c15)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=4c42110868c2>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=883450#c16)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=9befe60d26e6>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=883450#c17)• 12 years ago |
|  | |

Ah, so... CallbackObject \_used\_ to have a request there until it got removed in [bug 868130](/show_bug.cgi?id=868130 "RESOLVED FIXED - Fold JSAutoRequest into nsCxPusher"). Note that the comments were not updated in the process; please update them here?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=883450#c18)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=05c86f1e1982>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a409512_313730)• 12 years ago |

Depends on: [884362](/show_bug.cgi?id=884362 "RESOLVED FIXED - GC: Fix test crashes in exact browser builds")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=883450#c19)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=44175e0899ba>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=883450#c20)• 12 years ago |
|  | |

Green! Uploading patches and flagging for review.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=883450#c21)• 12 years ago |
|  | |

Attached patch

[Part 1 - MOZ\_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1](attachment.cgi?id=765108&action=diff)
— [Details](attachment.cgi?id=765108&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765108)

There's not a lot we can do without it in the browser these days.
[Attachment #765108](/attachment.cgi?id=765108&action=edit "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") -
Flags: review?(gkrizsanits)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=883450#c22)• 12 years ago |
|  | |

Attached patch

[Part 2 - Unscope the JSAutoRequest in XPCJSContextStack. v1](attachment.cgi?id=765109&action=diff)
— [Details](attachment.cgi?id=765109&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765109)

[Attachment #765109](/attachment.cgi?id=765109&action=edit "Part 2 - Unscope the JSAutoRequest in XPCJSContextStack. v1") -
Flags: review?(gkrizsanits)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=883450#c23)• 12 years ago |
|  | |

Attached patch

[Part 3 - Remove custom request munging in XPCCallContext and use a JSAutoRequest. v1](attachment.cgi?id=765110&action=diff)
— [Details](attachment.cgi?id=765110&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765110)

[Attachment #765110](/attachment.cgi?id=765110&action=edit "Part 3 - Remove custom request munging in XPCCallContext and use a JSAutoRequest. v1") -
Flags: review?(gkrizsanits)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=883450#c24)• 12 years ago |
|  | |

Attached patch

[Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1](attachment.cgi?id=765111&action=diff)
— [Details](attachment.cgi?id=765111&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765111)

[Attachment #765111](/attachment.cgi?id=765111&action=edit "Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=883450#c25)• 12 years ago |
|  | |

Attached patch

[Part 5 - Miscellaneous requests. v1](attachment.cgi?id=765112&action=diff)
— [Details](attachment.cgi?id=765112&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765112)

[Attachment #765112](/attachment.cgi?id=765112&action=edit "Part 5 - Miscellaneous requests. v1") -
Flags: review?(gkrizsanits)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=883450#c26)• 12 years ago |
|  | |

Attached patch

[Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1](attachment.cgi?id=765113&action=diff)
— [Details](attachment.cgi?id=765113&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765113)

[Attachment #765113](/attachment.cgi?id=765113&action=edit "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") -
Flags: review?(gkrizsanits)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=883450#c27)• 12 years ago |
|  | |

Comment on [attachment 765113](/attachment.cgi?id=765113 "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[details]](/attachment.cgi?id=765113&action=edit "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[diff]](/attachment.cgi?id=765113&action=diff "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765113)
Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1
Er, this.
[Attachment #765113](/attachment.cgi?id=765113&action=edit "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") -
Flags: review?(gkrizsanits) → review?(terrence)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=883450#c28)• 12 years ago |
|  | |

Comment on [attachment 765111](/attachment.cgi?id=765111 "Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1") [[details]](/attachment.cgi?id=765111&action=edit "Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1") [[diff]](/attachment.cgi?id=765111&action=diff "Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765111)
Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1
> // We construct our JS::Rooted right after our JSAutoRequest; let's just
Please do fix the comment; see [comment 17](/show_bug.cgi?id=883450#c17 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request").
r=me with that.
[Attachment #765111](/attachment.cgi?id=765111&action=edit "Part 4 - Re-order stuff in CallSetup so that we construct the RootedObject after the Push. v1") -
Flags: review?(bzbarsky) → review+

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=883450#c29)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #0](/show_bug.cgi?id=883450#c0 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> especially from consumers of nsIScriptContext functions
Or mCx, or GetSafeJSContext... Based on some mxr search we have quite some cases to worry about. So the idea here is we assert and rely on our test coverage, and fix only the cases that pops up on try with this assert, right? I have to say that it's not a very relaxing approach. Anyway, I'll finish up the review of the patches soon, just was wondering if it makes sense to try and do some major cleaning up on this department (by manually cherry-picking the suspicious looking cx usages) or this whole thing is going away soon, and this is a good enough solution for the time being?

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=883450#c30)• 12 years ago |
|  | |

Comment on [attachment 765108](/attachment.cgi?id=765108 "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") [[details]](/attachment.cgi?id=765108&action=edit "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") [[diff]](/attachment.cgi?id=765108&action=diff "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765108)
Part 1 - MOZ\_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1
Review of [attachment 765108](/attachment.cgi?id=765108 "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") [[details]](/attachment.cgi?id=765108&action=edit "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") [[diff]](/attachment.cgi?id=765108&action=diff "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765108):
-----------------------------------------------------------------
Shouldn't we rename it to SafeJSContext now that it cannot fail? (at some point in the future...)
[Attachment #765108](/attachment.cgi?id=765108&action=edit "Part 1 - MOZ_CRASH if we fail to spin up the SafeJSContext, and remove error handling. v1") -
Flags: review?(gkrizsanits) → review+

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a493138_420273)• 12 years ago |

[Attachment #765109](/attachment.cgi?id=765109&action=edit "Part 2 - Unscope the JSAutoRequest in XPCJSContextStack. v1") -
Flags: review?(gkrizsanits) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=883450#c31)• 12 years ago |
|  | |

(In reply to Gabor Krizsanits [:krizsa :gabor] from [comment #29](/show_bug.cgi?id=883450#c29 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> Or mCx, or GetSafeJSContext... Based on some mxr search we have quite some
> cases to worry about. So the idea here is we assert and rely on our test
> coverage, and fix only the cases that pops up on try with this assert right?
Well, it's better than that. We're (more or less) green on the sixgill exact rooting static analysis. The means we can statically prove that we use Rooted/Handle for every stack value that we need to keep alive across calls that can GC. So as long as we at least call through these functions once, the assertions will tell us the right answer.

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a493772_420273)• 12 years ago |

[Attachment #765110](/attachment.cgi?id=765110&action=edit "Part 3 - Remove custom request munging in XPCCallContext and use a JSAutoRequest. v1") -
Flags: review?(gkrizsanits) → review+

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=883450#c32)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #31](/show_bug.cgi?id=883450#c31 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> Well, it's better than that. We're (more or less) green on the sixgill exact
> rooting static analysis. The means we can statically prove that we use
> Rooted/Handle for every stack value that we need to keep alive across calls
> that can GC. So as long as we at least call through these functions once,
> the assertions will tell us the right answer.
What ever the sixgill exact rooting static analysis exactly does under the hood, I already feel a bit more relaxed :)

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=883450#c33)• 12 years ago |
|  | |

Comment on [attachment 765112](/attachment.cgi?id=765112 "Part 5 - Miscellaneous requests. v1") [[details]](/attachment.cgi?id=765112&action=edit "Part 5 - Miscellaneous requests. v1") [[diff]](/attachment.cgi?id=765112&action=diff "Part 5 - Miscellaneous requests. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765112)
Part 5 - Miscellaneous requests. v1
Review of [attachment 765112](/attachment.cgi?id=765112 "Part 5 - Miscellaneous requests. v1") [[details]](/attachment.cgi?id=765112&action=edit "Part 5 - Miscellaneous requests. v1") [[diff]](/attachment.cgi?id=765112&action=diff "Part 5 - Miscellaneous requests. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765112):
-----------------------------------------------------------------
AutoJSContext cx;
nsresult rv;
+ JSAutoRequest ar(cx);
why?
[Attachment #765112](/attachment.cgi?id=765112&action=edit "Part 5 - Miscellaneous requests. v1") -
Flags: review?(gkrizsanits) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=883450#c34)• 12 years ago |
|  | |

Comment on [attachment 765113](/attachment.cgi?id=765113 "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[details]](/attachment.cgi?id=765113&action=edit "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[diff]](/attachment.cgi?id=765113&action=diff "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765113)
Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1
Review of [attachment 765113](/attachment.cgi?id=765113 "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[details]](/attachment.cgi?id=765113&action=edit "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[diff]](/attachment.cgi?id=765113&action=diff "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=883450&attachment=765113):
-----------------------------------------------------------------
r=me
[Attachment #765113](/attachment.cgi?id=765113&action=edit "Part 6 - Assert that we're in a request whenever we create a Rooted<T>. v1") -
Flags: review?(terrence) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=883450#c35)• 12 years ago |
|  | |

remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/be022529d704>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/809ce50459c1>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/9e6fa71b9f72>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/aae5d429b8d4>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/dd4b059747b8>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/ce7085b63b2b>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a505607_280903)• 12 years ago |

[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=883450#c36)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/be022529d704>
<https://hg.mozilla.org/mozilla-central/rev/809ce50459c1>
<https://hg.mozilla.org/mozilla-central/rev/9e6fa71b9f72>
<https://hg.mozilla.org/mozilla-central/rev/aae5d429b8d4>
<https://hg.mozilla.org/mozilla-central/rev/dd4b059747b8>
<https://hg.mozilla.org/mozilla-central/rev/ce7085b63b2b>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla24

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a584034_132034)• 12 years ago |

Depends on: [885769](/show_bug.cgi?id=885769 "RESOLVED FIXED - Assertion failure: cxArg, at dist/include/js/RootingAPI.h")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=883450#c37)• 12 years ago |
|  | |

Bobby, what's the backporting story this these patches?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=883450#c38)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #37](/show_bug.cgi?id=883450#c37 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> Bobby, what's the backporting story this these patches?
We're unlikely to be able to fix this solidly on all branches, because the assertions aren't backportable (they're only meaningful on branches where we're more or less exactly rooted, which is just trunk at the moment).
There are also a lot of other things that have changed in this department ([bug 834732](/show_bug.cgi?id=834732 "RESOLVED FIXED - Do a better job of maintaining the JS context stack"), [bug 868130](/show_bug.cgi?id=868130 "RESOLVED FIXED - Fold JSAutoRequest into nsCxPusher"), etc), that will make any kind of meaningful backport hard.
I recommend backporting Part 5 and embargoing this bug until ESR17 EOL.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a598899_406194)• 12 years ago |

Whiteboard: [Embargo until ESR17 EOL]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a6304215_280903)• 11 years ago |

Whiteboard: [Embargo until ESR17 EOL] → [Embargo until ESR17 EOL][adv-main24+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a8153815_1689)• 11 years ago |

[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a12607628_280903)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected)
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=883450#c39)• 11 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #38](/show_bug.cgi?id=883450#c38 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> I recommend backporting Part 5 and embargoing this bug until ESR17 EOL.
Still recommended for b2g18? We still want to fix sec-crits there if possible.Flags: needinfo?(bobbyholley+bmo)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=883450#c40)• 11 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM UTC-5] from [comment #39](/show_bug.cgi?id=883450#c39 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> (In reply to Bobby Holley (:bholley) from [comment #38](/show_bug.cgi?id=883450#c38 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request"))
> > I recommend backporting Part 5 and embargoing this bug until ESR17 EOL.
>
> Still recommended for b2g18? We still want to fix sec-crits there if
> possible.
Yeah, we should probably at least try to backport Part 5.Flags: needinfo?(bobbyholley+bmo)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=883450#c41)• 11 years ago |
|  | |

Actually, I realize that backporting this pixie dust is totally useless without [bug 834732](/show_bug.cgi?id=834732 "RESOLVED FIXED - Do a better job of maintaining the JS context stack").
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=wontfix)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a40907635_313730)• 10 years ago |

Flags: in-testsuite?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=883450#a45203039_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=883450&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bobby Holley (:bholley)](/user_profile?user_id=313730)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_14eefe13_20250125_154616.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/847606)
* [XML](/show_bug.cgi?ctype=xml&id=847606)

Closed
[Bug 847606](/show_bug.cgi?id=847606)

Opened 12 years ago
Closed 12 years ago

# Crash with ion, setTimeout(Array.prototype.filter)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash with ion, setTimeout(Array.prototype.filter)

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | [24+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=24%2B) | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |
| b2g-v1.1hd | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | wontfix |
| firefox22 | + | wontfix |
| firefox23 | + | wontfix |
| firefox24 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 | 24+ | wontfix |
| b2g-v1.1hd |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: jandem)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ js::ion::FastInvoke ]](https://crash-stats.mozilla.org/signature/?signature=js%3A%3Aion%3A%3AFastInvoke)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [testcase (10000 elements)](/attachment.cgi?id=720874)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   245 bytes, text/html |  | [Details](/attachment.cgi?id=720874&action=edit) |
| --- | --- | --- |
| [testcase (10 elements)](/attachment.cgi?id=720876)  [12 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   242 bytes, text/html |  | [Details](/attachment.cgi?id=720876&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=847606#c0)• 12 years ago |
|  | |

Attached file
[testcase (10000 elements)](attachment.cgi?id=720874)
— [Details](attachment.cgi?id=720874&action=edit)

Testcase can cause:
\* Assertion failure: hasfp(), at js/src/vm/Stack.h:1663
\* Crash [@ js::ion::FastInvoke]
Security-sensitive because the testcase reminds me of [bug 815010](/show_bug.cgi?id=815010 "RESOLVED FIXED - \"Assertion failure: hasScript()\" with setTimeout(Array.prototype.indexOf)").

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=847606#c1)• 12 years ago |
|  | |

Attached file
[testcase (10 elements)](attachment.cgi?id=720876)
— [Details](attachment.cgi?id=720876&action=edit)

This one requires:
user\_pref("javascript.options.ion.parallel\_compilation", false);
user\_pref("javascript.options.methodjit.content", false);

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=847606#c2)• 12 years ago |
|  | |

So all window.setTimeout does is cause a JS\_CallFunctionValue on the bound function with absolutely nothing on the stack.
Eventually we end up in array\_filter which does:
FastInvokeGuard fig(cx, ObjectValue(\*callable));
....
if (!fig.invoke(cx))
And js::ion::FastInvoke does:
StackFrame \*fp = cx->fp();
but cx doesn't have an fp on it, so that hits an assert... Not sure where the bug is here exactly, but it sure doesn't seem to be in setTimeout stuff.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=847606#c3)• 12 years ago |
|  | |

[bp-15f1bc07-f564-4394-bd85-a075f2130304](https://crash-stats.mozilla.org/report/index/15f1bc07-f564-4394-bd85-a075f2130304)Crash Signature: [@ js::ion::FastInvoke]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=847606#c4)• 12 years ago |
|  | |

This case is a null deref, but could we do the same with a more dangerous bogus value?

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=847606#c5)• 12 years ago |
|  | |

We need js team input to sec rate this.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a1366600_1689)• 12 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=847606#c6)• 12 years ago |
|  | |

Pushing to Naveed to find an owner.Assignee: general → nihsanullah

|  | [Naveed Ihsanullah [:naveed]](/user_profile?user_id=441971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a8097042_441971)• 12 years ago |

Assignee: nihsanullah → jdemooij

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=847606#c7)• 12 years ago |
|  | |

Good find! The way FastInvoke works is pretty hackish, the patch in [bug 868437](/show_bug.cgi?id=868437 "RESOLVED FIXED - Simplify the interpreter and stack frame layout") will make this much nicer (it removes the cx->fp() call and a lot of code around it).
This affects all branches, but should be uncommon: FastInvoke is only used when some natives implemented in C++ (Array.prototype.filter/sort/.., String.prototype.replace, etc) call back into JS.Status: NEW → ASSIGNED
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)OS: Mac OS X → AllHardware: x86\_64 → All

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=847606#c8)• 12 years ago |
|  | |

Does the patch in [bug 868437](/show_bug.cgi?id=868437 "RESOLVED FIXED - Simplify the interpreter and stack frame layout") fix this?
Do you have another plan for branches? ("Don't bother fixing it on branches" is one possibility.)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a8534999_425645)• 12 years ago |

[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=847606#c9)• 12 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #8](/show_bug.cgi?id=847606#c8 "RESOLVED FIXED - Crash with ion, setTimeout(Array.prototype.filter)"))
> Does the patch in [bug 868437](/show_bug.cgi?id=868437 "RESOLVED FIXED - Simplify the interpreter and stack frame layout") fix this?
I just downloaded mozilla-inbound builds with/without that patch. [Bug 868437](/show_bug.cgi?id=868437 "RESOLVED FIXED - Simplify the interpreter and stack frame layout") indeed fixed this.
> Do you have another plan for branches? ("Don't bother fixing it on
> branches" is one possibility.)
Yeah I don't think it's worth fixing on branches: it's a safe NULL-deref and the bug has been there since Firefox 18.Status: ASSIGNED → RESOLVEDClosed: 12 years agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a8603057_75935)• 12 years ago |

[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Target Milestone: --- → mozilla24

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a8732601_280903)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a14867321_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a16350456_272375)• 11 years ago |

[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F) → [24+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=24%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a19339344_75935)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=847606#a54022928_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=847606&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_df6d04c4_20250125_154610.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG/)

[Manage this list](/manage/lists/updates.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/updates%40lists.opensuse.org/thread/T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG/#T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG)

# openSUSE-SU-2013:1499-1: moderate: Mozilla updates September 2013

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

29 Sep
2013

29 Sep
'13

12:04

openSUSE Security Update: Mozilla updates September 2013
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:1499-1
Rating: moderate
References: #840485 #840551
Cross-References: CVE-2013-1718 CVE-2013-1719 CVE-2013-1720
CVE-2013-1721 CVE-2013-1722 CVE-2013-1723
CVE-2013-1724 CVE-2013-1725 CVE-2013-1728
CVE-2013-1730 CVE-2013-1732 CVE-2013-1735
CVE-2013-1736 CVE-2013-1737 CVE-2013-1738
Affected Products:
openSUSE 11.4
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 15 vulnerabilities is now available.
Description:
Updates Firefox, Thunderbird and Seamonkey and fixes the
following security issues:
\* MFSA 2013-76/CVE-2013-1718/CVE-2013-1719 Miscellaneous
memory safety hazards
\* MFSA 2013-77/CVE-2013-1720 (bmo#888820) Improper state
in HTML5 Tree Builder with templates
\* MFSA 2013-78/CVE-2013-1721 (bmo#890277) Integer
overflow in ANGLE library
\* MFSA 2013-79/CVE-2013-1722 (bmo#893308) Use-after-free
in Animation Manager during stylesheet cloning
\* MFSA 2013-80/CVE-2013-1723 (bmo#891292) NativeKey
continues handling key messages after widget is
destroyed
\* MFSA 2013-81/CVE-2013-1724 (bmo#894137) Use-after-free
with select element
\* MFSA 2013-82/CVE-2013-1725 (bmo#876762) Calling scope
for new Javascript objects can lead to memory corruption
\* MFSA 2013-85/CVE-2013-1728 (bmo#883686) Uninitialized
data in IonMonkey
\* MFSA 2013-88/CVE-2013-1730 (bmo#851353) Compartment
mismatch re-attaching XBL-backed nodes
\* MFSA 2013-89/CVE-2013-1732 (bmo#883514) Buffer overflow
with multi-column, lists, and floats
\* MFSA 2013-90/CVE-2013-1735/CVE-2013-1736 (bmo#898871,
bmo#906301) Memory corruption involving scrolling
\* MFSA 2013-91/CVE-2013-1737 (bmo#907727) User-defined
properties on DOM proxies get the wrong "this" object
\* MFSA 2013-92/CVE-2013-1738 (bmo#887334, bmo#882897) GC
hazard with default compartments and frame chain
restoration
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 11.4:
zypper in -t patch 2013-141
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 11.4 (i586 x86\_64):
MozillaFirefox-24.0-87.3
MozillaFirefox-branding-upstream-24.0-87.3
MozillaFirefox-buildsymbols-24.0-87.3
MozillaFirefox-debuginfo-24.0-87.3
MozillaFirefox-debugsource-24.0-87.3
MozillaFirefox-devel-24.0-87.3
MozillaFirefox-translations-common-24.0-87.3
MozillaFirefox-translations-other-24.0-87.3
MozillaThunderbird-24.0-73.3
MozillaThunderbird-buildsymbols-24.0-73.3
MozillaThunderbird-debuginfo-24.0-73.3
MozillaThunderbird-debugsource-24.0-73.3
MozillaThunderbird-devel-24.0-73.3
MozillaThunderbird-translations-common-24.0-73.3
MozillaThunderbird-translations-other-24.0-73.3
enigmail-1.5.2+24.0-73.3
seamonkey-2.21-77.3
seamonkey-debuginfo-2.21-77.3
seamonkey-debugsource-2.21-77.3
seamonkey-dom-inspector-2.21-77.3
seamonkey-irc-2.21-77.3
seamonkey-translations-common-2.21-77.3
seamonkey-translations-other-2.21-77.3
seamonkey-venkman-2.21-77.3
References:
<http://support.novell.com/security/cve/CVE-2013-1718.html>
<http://support.novell.com/security/cve/CVE-2013-1719.html>
<http://support.novell.com/security/cve/CVE-2013-1720.html>
<http://support.novell.com/security/cve/CVE-2013-1721.html>
<http://support.novell.com/security/cve/CVE-2013-1722.html>
<http://support.novell.com/security/cve/CVE-2013-1723.html>
<http://support.novell.com/security/cve/CVE-2013-1724.html>
<http://support.novell.com/security/cve/CVE-2013-1725.html>
<http://support.novell.com/security/cve/CVE-2013-1728.html>
<http://support.novell.com/security/cve/CVE-2013-1730.html>
<http://support.novell.com/security/cve/CVE-2013-1732.html>
<http://support.novell.com/security/cve/CVE-2013-1735.html>
<http://support.novell.com/security/cve/CVE-2013-1736.html>
<http://support.novell.com/security/cve/CVE-2013-1737.html>
<http://support.novell.com/security/cve/CVE-2013-1738.html>
<https://bugzilla.novell.com/840485>
<https://bugzilla.novell.com/840551>

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG/)
Use email software

[Back to the thread](/archives/list/updates%40lists.opensuse.org/thread/T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG/#T3RTERPF7GBCRVUWKXHYDJP25HPXDUJG)

[Back to the list](/archives/list/updates%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from blog.mozilla.org_a1905f2a_20250126_100125.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_765d45b9_20250125_154618.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/851982)
* [XML](/show_bug.cgi?ctype=xml&id=851982)

Closed
[Bug 851982](/show_bug.cgi?id=851982)

Opened 12 years ago
Closed 12 years ago

# Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP (#2)

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP (#2)

## Categories

### (Core :: Networking, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking#Networking)

Networking
▾

Core :: Networking
For bugs in Mozilla's modular networking library (aka "Netlib" or "Necko".) The networking library supplies the software interface that Mozilla uses to access physical transports (e.g. the Internet and local drives), perform URL resolutions, and handle a variety of networking protocols.

Examples of appropriate bugs: URLs with backslash not fetched; URLs starting with a single slash turn into http:///; Cannot access authenticated FTP site.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |
| b2g-v1.1hd | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=unaffected) |
| b2g-v1.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 |  | wontfix |
| firefox24 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| b2g-v1.1hd |  | unaffected |
| b2g-v1.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: emk)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e9388eb9cf1a0eb509c4dc3686e66ca5?d=mm&size=40)  [emk](/user_profile?user_id=5842)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[883083](/show_bug.cgi?id=883083 "RESOLVED DUPLICATE - Assertion failure: ((bool)(__builtin_expect(!!(!NS_FAILED_impl(convResult)), 1)))")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, sec-moderate, testcase, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [emk](/user_profile?user_id=5842) | [in-testsuite](#c9 "12 years ago") | + |
| --- | --- | --- |
| [emk](/user_profile?user_id=5842) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase](/attachment.cgi?id=725954)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   70 bytes, text/html |  | [Details](/attachment.cgi?id=725954&action=edit) |
| --- | --- | --- |
| [Make ISO-2022-JP decoder reliable](/attachment.cgi?id=765062)  [12 years ago](#c5)  [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)   19.45 KB, patch | smontagu : [review+](#a8172927_11171 "12 years ago") | [Details](/attachment.cgi?id=765062&action=edit) | [Diff](/attachment.cgi?id=765062&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=851982&attachment=765062) |
| [Regression test](/attachment.cgi?id=765064)  [12 years ago](#c6)  [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)   3.26 KB, patch | smontagu : [review+](#a8173034_11171 "12 years ago") | [Details](/attachment.cgi?id=765064&action=edit) | [Diff](/attachment.cgi?id=765064&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=851982&attachment=765064) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=851982#c0)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=725954)
— [Details](attachment.cgi?id=725954&action=edit)

Assertion failure: ((bool)(\_\_builtin\_expect(!!(!NS\_FAILED\_impl(rv)), 1))), at netwerk/base/src/nsUnicharStreamLoader.cpp:218
Same assertion as [bug 843434](/show_bug.cgi?id=843434 "RESOLVED FIXED - Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP"), which Josh fixed last week.

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a13861_18821)• 12 years ago |

Assignee: nobody → VYV03354

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=851982#c1)• 12 years ago |
|  | |

mErrBehavior check is needed here, too.
<https://mxr.mozilla.org/mozilla-central/source/intl/uconv/ucvja/nsJapaneseToUnicode.cpp#506>
And we should audit the all occurrence of |goto error2;|.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a234456_1689)• 12 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=851982#c3)• 12 years ago |
|  | |

also this is happing on realworld sites see my [bug 883083](/show_bug.cgi?id=883083 "RESOLVED DUPLICATE - Assertion failure: ((bool)(__builtin_expect(!!(!NS_FAILED_impl(convResult)), 1)))")

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=851982#c4)• 12 years ago |
|  | |

:emk or josh, can you supply a patch here?

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=851982#c5)• 12 years ago |
|  | |

Attached patch

[Make ISO-2022-JP decoder reliable](attachment.cgi?id=765062&action=diff)
— [Details](attachment.cgi?id=765062&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=851982&attachment=765062)

[Attachment #765062](/attachment.cgi?id=765062&action=edit "Make ISO-2022-JP decoder reliable") -
Flags: review?(smontagu)

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=851982#c6)• 12 years ago |
|  | |

Attached patch

[Regression test](attachment.cgi?id=765064&action=diff)
— [Details](attachment.cgi?id=765064&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=851982&attachment=765064)

[Attachment #765064](/attachment.cgi?id=765064&action=edit "Regression test") -
Flags: review?(smontagu)

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=851982#c7)• 12 years ago |
|  | |

Although the assertions are debug only, this change is web-visible because of TextDecoder. The test should catch all possible cases.
I commented out |SimpleTest.expectAssertions(0, 2);| line because testharness doesn't define SimpleTest.

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=851982#c8)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=11e9dbc16257>

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a8172927_11171)• 12 years ago |

[Attachment #765062](/attachment.cgi?id=765062&action=edit "Make ISO-2022-JP decoder reliable") -
Flags: review?(smontagu) → review+

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a8173034_11171)• 12 years ago |

[Attachment #765064](/attachment.cgi?id=765064&action=edit "Regression test") -
Flags: review?(smontagu) → review+

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=851982#c9)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/84855cdd91da>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/d1d09117491f>Status: NEW → ASSIGNEDFlags: in-testsuite+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=851982#c10)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/84855cdd91da>
<https://hg.mozilla.org/mozilla-central/rev/d1d09117491f>Status: ASSIGNED → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla24

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=851982#c11)• 12 years ago |
|  | |

> I commented out |SimpleTest.expectAssertions(0, 2);| line because testharness
> doesn't define SimpleTest.
Which test harness does this test run in?

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=851982#c12)• 12 years ago |
|  | |

dom/encoding/test/test\_TextDecoder.html.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=851982#c13)• 11 years ago |
|  | |

Was this bug present in Firefox 23 or earlier?
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=%3F)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=%3F)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=%3F)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a14074237_280903)• 11 years ago |

Flags: needinfo?(VYV03354)

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=851982#c14)• 11 years ago |
|  | |

Probably Firefox 20 or later. This is a regression from [bug 638379](/show_bug.cgi?id=638379 "RESOLVED FIXED - make nsIUnicodeDecoder::SetInputErrorBehavior reliable and stop using nsIUnicodeDecoder::Reset for error handling").Flags: needinfo?(VYV03354)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a14085934_280903)• 11 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a14254926_280903)• 11 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)Whiteboard: [adv-main24+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a20293029_280903)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=unaffected)
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=851982#a52889023_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=851982&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_d734cd3f_20250125_154625.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/873073)
* [XML](/show_bug.cgi?ctype=xml&id=873073)

Closed
[Bug 873073](/show_bug.cgi?id=873073)

Opened 12 years ago
Closed 12 years ago

# nsNativeThemeWin seems to spin event loop during layout

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsNativeThemeWin seems to spin event loop during layout

## Categories

### (Core :: Widget: Win32, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Widget%3A%20Win32#Widget%3A%20Win32)

Widget: Win32
▾

Core :: Widget: Win32
Mapping of cross platform widget interfaces to Win32 platform APIs.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Widget%3A%20Win32)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Windows 7

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla25

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) |
| firefox22 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [-](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=verified) |
| firefox-esr17 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | wontfix |
| firefox22 |  | wontfix |
| firefox23 | - | wontfix |
| firefox24 | + | verified |
| firefox25 | + | verified |
| firefox-esr17 | - | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: smaug, Assigned: jimm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/605ee8cd1c9a74704916c7bdc4e4865d?d=mm&size=40)  [rkraesig](/user_profile?user_id=699639)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[888765](/show_bug.cgi?id=888765 "RESOLVED FIXED - Many tests on Win8 on nightly builds fail to start")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[748156](/show_bug.cgi?id=748156 "RESOLVED FIXED - Intermittent 166750-1.html,test_bug240933.html,749816-1.html,763223-1.html,763702.xhtml | assertion count 2 is more than expected 0 assertions from \"ASSERTION: This is unsafe! Fix the caller!\" in nsEventDispatcher.cpp, line 559")

Dependency [tree](/showdependencytree.cgi?id=873073&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=873073)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, crash, sec-moderate, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [fix](/attachment.cgi?id=768891)  [12 years ago](#c12)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   4.61 KB, patch | bbondy : [review+](#a3706619_407790 "12 years ago")  bajaj : [approval-mozilla-aurora+](#c31 "12 years ago") | [Details](/attachment.cgi?id=768891&action=edit) | [Diff](/attachment.cgi?id=768891&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=873073&attachment=768891) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=873073#c0)• 12 years ago |
|  | |

This is what causes [Bug 748156](/show_bug.cgi?id=748156 "RESOLVED FIXED - Intermittent 166750-1.html,test_bug240933.html,749816-1.html,763223-1.html,763702.xhtml | assertion count 2 is more than expected 0 assertions from \"ASSERTION: This is unsafe! Fix the caller!\" in nsEventDispatcher.cpp, line 559").
07:01:45 INFO - ###!!! ASSERTION: This is unsafe! Fix the caller!: 'Error', file e:/builds/moz2\_slave/m-cen-w32-d-000000000000000000/build/content/events/src/nsEventDispatcher.cpp, line 494
07:01:45 INFO - nsEventDispatcher::DispatchDOMEvent(nsISupports \*,nsEvent \*,nsIDOMEvent \*,nsPresContext \*,nsEventStatus \*) [content/events/src/nsEventDispatcher.cpp:692]
07:01:45 INFO - nsGlobalWindow::DispatchEvent(nsIDOMEvent \*,bool \*) [dom/base/nsGlobalWindow.cpp:7928]
07:01:45 INFO - nsGlobalWindow::DispatchEvent(nsIDOMEvent \*,bool \*) [dom/base/nsGlobalWindow.cpp:7909]
07:01:45 INFO - nsContentUtils::DispatchEvent(nsIDocument \*,nsISupports \*,nsAString\_internal const &,bool,bool,bool,bool \*) [content/base/src/nsContentUtils.cpp:3532]
07:01:45 INFO - nsContentUtils::DispatchTrustedEvent(nsIDocument \*,nsISupports \*,nsAString\_internal const &,bool,bool,bool \*) [content/base/src/nsContentUtils.cpp:3503]
07:01:45 INFO - nsFocusManager::WindowLowered(nsIDOMWindow \*) [dom/base/nsFocusManager.cpp:766]
07:01:45 INFO - nsWebShellWindow::WindowDeactivated() [xpfe/appshell/src/nsWebShellWindow.cpp:418]
07:01:45 INFO - nsWindow::DispatchFocusToTopLevelWindow(bool) [widget/windows/nsWindow.cpp:4080]
07:01:45 INFO - nsWindow::ProcessMessage(unsigned int,unsigned int &,long &,long \*) [widget/windows/nsWindow.cpp:5177]
07:01:45 INFO - nsWindow::WindowProcInternal(HWND\_\_ \*,unsigned int,unsigned int,long) [widget/windows/nsWindow.cpp:4390]
07:01:45 INFO - CallWindowProcCrashProtected [xpcom/base/nsCrashOnException.cpp:32]
07:01:45 INFO - nsWindow::WindowProc(HWND\_\_ \*,unsigned int,unsigned int,long) [widget/windows/nsWindow.cpp:4342]
07:01:45 INFO - USER32 + 0x186ef
07:01:45 INFO - USER32 + 0x18876
07:01:45 INFO - USER32 + 0x170f4
07:01:45 INFO - USER32 + 0x1738f
07:01:45 INFO - ntdll + 0x4642e
07:01:45 INFO - USER32 + 0x17308
07:01:45 INFO - USER32 + 0x1729f
07:01:45 INFO - USER32 + 0xbf96
07:01:45 INFO - USER32 + 0x1738f
07:01:45 INFO - ntdll + 0x4642e
07:01:45 INFO - QueryForButtonData [widget/windows/nsNativeThemeWin.cpp:119]
07:01:45 INFO - nsIFrame::AddCSSMinSize(nsBoxLayoutState &,nsIFrame \*,nsSize &,bool &,bool &) [layout/xul/base/src/nsBox.cpp:690]
07:01:45 INFO - nsBoxFrame::GetMinSize(nsBoxLayoutState &) [layout/xul/base/src/nsBoxFrame.cpp:816]
07:01:45 INFO - nsBoxFrame::GetPrefSize(nsBoxLayoutState &) [layout/xul/base/src/nsBoxFrame.cpp:768]
07:01:45 INFO - nsSprocketLayout::GetPrefSize(nsIFrame \*,nsBoxLayoutState &) [layout/xul/base/src/nsSprocketLayout.cpp:1320]
07:01:45 INFO - nsBoxFrame::GetPrefSize(nsBoxLayoutState &) [layout/xul/base/src/nsBoxFrame.cpp:757]
07:01:45 INFO - nsSprocketLayout::GetPrefSize(nsIFrame \*,nsBoxLayoutState &) [layout/xul/base/src/nsSprocketLayout.cpp:1320]
07:01:45 INFO - nsBoxFrame::GetPrefSize(nsBoxLayoutState &) [layout/xul/base/src/nsBoxFrame.cpp:757]
07:01:45 INFO - nsSprocketLayout::GetPrefSize(nsIFrame \*,nsBoxLayoutState &) [layout/xul/base/src/nsSprocketLayout.cpp:1320]
07:01:45 INFO - nsBoxFrame::GetPrefSize(nsBoxLayoutState &) [layout/xul/base/src/nsBoxFrame.cpp:757]
07:01:45 INFO - nsSprocketLayout::PopulateBoxSizes(nsIFrame \*,nsBoxLayoutState &,nsBoxSize \* &,int &,int &,int &) [layout/xul/base/src/nsSprocketLayout.cpp:738]
07:01:45 INFO - nsSprocketLayout::Layout(nsIFrame \*,nsBoxLayoutState &) [layout/xul/base/src/nsSprocketLayout.cpp:221]
07:01:45 INFO - nsBoxFrame::DoLayout(nsBoxLayoutState &) [layout/xul/base/src/nsBoxFrame.cpp:899]
07:01:45 INFO - nsIFrame::Layout(nsBoxLayoutState &) [layout/xul/base/src/nsBox.cpp:512]
07:01:45 INFO - nsStackLayout::Layout(nsIFrame \*,nsBoxLayoutState &) [layout/xul/base/src/nsStackLayout.cpp:343]
07:01:45 INFO - nsBoxFrame::DoLayout(nsBoxLayoutState &) [layout/xul/base/src/nsBoxFrame.cpp:899]
07:01:45 INFO - nsIFrame::Layout(nsBoxLayoutState &) [layout/xul/base/src/nsBox.cpp:512]
07:01:45 INFO - nsBoxFrame::Reflow(nsPresContext \*,nsHTMLReflowMetrics &,nsHTMLReflowState const &,unsigned int &) [layout/xul/base/src/nsBoxFrame.cpp:703]
07:01:45 INFO - nsContainerFrame::ReflowChild(nsIFrame \*,nsPresContext \*,nsHTMLReflowMetrics &,nsHTMLReflowState const &,int,int,unsigned int,unsigned int &,nsOverflowContinuationTracker \*) [layout/generic/nsContainerFrame.cpp:971]
07:01:45 INFO - ViewportFrame::Reflow(nsPresContext \*,nsHTMLReflowMetrics &,nsHTMLReflowState const &,unsigned int &) [layout/generic/nsViewportFrame.cpp:226]
07:01:45 INFO - PresShell::ProcessReflowCommands(bool) [layout/base/nsPresShell.cpp:7929]
07:01:45 INFO - PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) [layout/base/nsPresShell.cpp:3891]
07:01:45 INFO - nsRefreshDriver::Tick(\_\_int64,mozilla::TimeStamp) [layout/base/nsRefreshDriver.cpp:962]
07:01:45 INFO - mozilla::RefreshDriverTimer::TickDriver(nsRefreshDriver \*,\_\_int64,mozilla::TimeStamp) [layout/base/nsRefreshDriver.cpp:168]
07:01:45 INFO - mozilla::RefreshDriverTimer::Tick() [layout/base/nsRefreshDriver.cpp:159]
07:01:45 INFO - nsTimerImpl::Fire() [xpcom/threads/nsTimerImpl.cpp:547]
07:01:45 INFO - nsTimerEvent::Run() [xpcom/threads/nsTimerImpl.cpp:636]
07:01:45 INFO - nsThread::ProcessNextEvent(bool,bool \*) [xpcom/threads/nsThread.cpp:627]

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a26_39966)• 12 years ago |

Group: core-security

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=873073#c1)• 12 years ago |
|  | |

Getting caption button dims is a real pita -
<http://mxr.mozilla.org/mozilla-central/source/widget/windows/nsUXThemeData.cpp#186>
we create a window so that we can query it for the button info. The window has to have it's visibility set for the information to be valid. If anyone has any ideas on how to accomplish this in a less heavy handed way I'd love to hear them.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=873073#c2)• 12 years ago |
|  | |

To work around this we could move the query call to some other location, maybe when the hidden toolkit window gets created.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a14888_5168)• 12 years ago |

Assignee: nobody → jmathiesSeverity: normal → critical

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a15150_103593)• 12 years ago |

Assignee: jmathies → nobodySeverity: critical → normal

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a82905_103593)• 12 years ago |

Assignee: nobody → jmathiesSeverity: normal → critical

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=873073#c3)• 12 years ago |
|  | |

Can anyone suggest a security rating for this? What are the implications in that area?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=873073#c4)• 12 years ago |
|  | |

Probably pretty bad...Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=873073#c5)• 12 years ago |
|  | |

It seems the culprit here is nsUXThemeData::UpdateTitlebarInfo which only affects
Windows, afaict.Component: Layout → Widget: Win32Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=873073#c6)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #4](/show_bug.cgi?id=873073#c4 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> Probably pretty bad...
So specific! Arbitrary code execution? :-)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=873073#c7)• 12 years ago |
|  | |

Per Andrew, this can cause random memory corruption but it might not be terribly controllable.
Marking for Trunk, may go back as far as Firefox 13.
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=873073#c8)• 12 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #7](/show_bug.cgi?id=873073#c7 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> Per Andrew, this can cause random memory corruption but it might not be
> terribly controllable.
>
> Marking for Trunk, may go back as far as Firefox 13.
I'm pretty sure this stretches back to Firefox 4.0, via [bug 575870](/show_bug.cgi?id=575870 "RESOLVED FIXED - Implement the firefox button on xp, classic, and aero basic").

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=873073#c9)• 12 years ago |
|  | |

Marking wontfix for b2g18 because this is a Windows widget problem.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=873073#c10)• 12 years ago |
|  | |

Jim, can we get a fix for this based on [comment 2](/show_bug.cgi?id=873073#c2 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout")'s idea?

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a2437149_452604)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=873073#c11)• 12 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #10](/show_bug.cgi?id=873073#c10 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> Jim, can we get a fix for this based on [comment 2](/show_bug.cgi?id=873073#c2 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout")'s idea?
I can investigate an earlier call. A little background:
<http://mxr.mozilla.org/mozilla-central/source/widget/windows/nsUXThemeData.cpp#186>
This queries for metric info on the titlebar buttons for tab in titlebar support. On non-glass desktops we draw our own window controls and with vista+ glass desktops, we let the dwm draw the command buttons and we carve a section out of persona backgrounds so they don't overlap. To do this right we need the exact dims of the normal window control buttons.
The problem is that you can't query for this information on a window that hasn't been displayed yet, and we need this info early in startup during initial layout. The toolkit window doesn't work since it's always hidden and as such doesn't have the right info. The main browser window won't work as it is created way too late, and is set up early not to draw into the titlebar.
So I needed a fresh window that could display briefly and then be destroyed. I ended up creating a visible but fully transparent window to do this. That's why we call create window here.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a3647792_406194)• 12 years ago |

[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=873073#c12)• 12 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=768891&action=diff)
— [Details](attachment.cgi?id=768891&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=873073&attachment=768891)

Test on win7 aerobasic and classic, works as expected. Creating a temp window in nsIWidget's create window call certainly shouldn't be an issue.
[Attachment #768891](/attachment.cgi?id=768891&action=edit "fix") -
Flags: review?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a3705388_279663)• 12 years ago |

[Attachment #768891](/attachment.cgi?id=768891&action=edit "fix") -
Flags: review? → review?(netzen)

|  | [Brian R. Bondy [:bbondy]](/user_profile?user_id=407790) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a3706619_407790)• 12 years ago |

[Attachment #768891](/attachment.cgi?id=768891&action=edit "fix") -
Flags: review?(netzen) → review+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=873073#c13)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/5cd49ff35fb9>
thanks for the quick review!

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=873073#c14)• 12 years ago |
|  | |

Thanks for fixing this. In the future, you should get sec-approval before landing sec-high or sec-critical bugs that affect more than trunk.

|  | [Phil Ringnalda (:philor)](/user_profile?user_id=135518) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=873073#c15)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/5cd49ff35fb9>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla25

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=873073#c16)• 12 years ago |
|  | |

(In reply to Phil Ringnalda (:philor) from [comment #15](/show_bug.cgi?id=873073#c15 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> <https://hg.mozilla.org/mozilla-central/rev/5cd49ff35fb9>
Since we just did an uplift, lets give this a week or two and then consider uplifting to aurora and possibly beta.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=873073#c17)• 12 years ago |
|  | |

And esr17?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a4337986_279663)• 12 years ago |

Depends on: [888765](/show_bug.cgi?id=888765 "RESOLVED FIXED - Many tests on Win8 on nightly builds fail to start")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a4579103_75935)• 12 years ago |

Blocks: [748156](/show_bug.cgi?id=748156 "RESOLVED FIXED - Intermittent 166750-1.html,test_bug240933.html,749816-1.html,763223-1.html,763702.xhtml | assertion count 2 is more than expected 0 assertions from \"ASSERTION: This is unsafe! Fix the caller!\" in nsEventDispatcher.cpp, line 559")

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=873073#c18)• 12 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM UTC-4] from [comment #17](/show_bug.cgi?id=873073#c17 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> And esr17?
Is esr 17 released? If so I'm not sure we would do anything about it.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=873073#c19)• 12 years ago |
|  | |

Comment on [attachment 768891](/attachment.cgi?id=768891 "fix") [[details]](/attachment.cgi?id=768891&action=edit "fix") [[diff]](/attachment.cgi?id=768891&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=873073&attachment=768891)
fix
[Approval Request Comment]
Bug caused by (feature/regressing bug #): something that landed ages ago.
User impact if declined: none.
Testing completed (on m-c, etc.): yep. Note this should include follow up fix in [bug 888765](/show_bug.cgi?id=888765 "RESOLVED FIXED - Many tests on Win8 on nightly builds fail to start").
Risk to taking this patch (and alternatives if risky): seems low based on mc testing that's been done. Flaws would be pretty visible to users.
String or IDL/UUID changes made by this patch: None.
Since this has been open for quite some time without issue I think we can uplift to aurora and let it roll out with the trains from there.
[Attachment #768891](/attachment.cgi?id=768891&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=873073#c20)• 12 years ago |
|  | |

In fact we could probably just let it roll out without uplift if we want. I image sec would have input on this decision.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a4858788_279663)• 12 years ago |

[Attachment #768891](/attachment.cgi?id=768891&action=edit "fix") -
Flags: sec-approval?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=873073#c21)• 12 years ago |
|  | |

(In reply to Jim Mathies [:jimm] from [comment #18](/show_bug.cgi?id=873073#c18 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> Is esr 17 released? If so I'm not sure we would do anything about it.
What do you mean? Of course it is.
<http://www.mozilla.org/en-US/firefox/organizations/all.html>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=873073#c22)• 12 years ago |
|  | |

Comment on [attachment 768891](/attachment.cgi?id=768891 "fix") [[details]](/attachment.cgi?id=768891&action=edit "fix") [[diff]](/attachment.cgi?id=768891&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=873073&attachment=768891)
fix
This already landed on trunk, so sec-approval doesn't matter any more.
[Attachment #768891](/attachment.cgi?id=768891&action=edit "fix") -
Flags: sec-approval?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=873073#c23)• 12 years ago |
|  | |

I guess you are looking for input on where to land this, in [comment 20](/show_bug.cgi?id=873073#c20 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout").Flags: needinfo?(abillings)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=873073#c24)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #23](/show_bug.cgi?id=873073#c23 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> I guess you are looking for input on where to land this, in [comment 20](/show_bug.cgi?id=873073#c20 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout").
yep.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=873073#c25)• 12 years ago |
|  | |

I'm not sure why I got needinfo'd here, Andrew.
(In reply to Jim Mathies [:jimm] from [comment #18](/show_bug.cgi?id=873073#c18 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> (In reply to Ryan VanderMeulen [:RyanVM UTC-4] from [comment #17](/show_bug.cgi?id=873073#c17 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> > And esr17?
>
> Is esr 17 released? If so I'm not sure we would do anything about it.
ESR17 is a fork of Firefox 17 that contains most of the sec-high and sec-critical fixes (plus a few other things) since then.
It would be nice if someone answered the sec-approval? template questions so we know more about taking this on branches or not (since that requires approval but then trunk did too...).Flags: needinfo?(abillings)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=873073#c26)• 12 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #25](/show_bug.cgi?id=873073#c25 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> I'm not sure why I got needinfo'd here, Andrew.
We're trying to decide if this should be uplifted.
> It would be nice if someone answered the sec-approval? template questions so
> we know more about taking this on branches or not (since that requires
> approval but then trunk did too...).
\* How easily could an exploit be constructed based on the patch?
Unknown, it happens very early on startup before content is loaded, so probably pretty minimal.
\* Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
No.
\* Which older supported branches are affected by this flaw?
See affected flags.
\* If not all supported branches, which bug introduced the flaw?
[Bug 748156](/show_bug.cgi?id=748156 "RESOLVED FIXED - Intermittent 166750-1.html,test_bug240933.html,749816-1.html,763223-1.html,763702.xhtml | assertion count 2 is more than expected 0 assertions from \"ASSERTION: This is unsafe! Fix the caller!\" in nsEventDispatcher.cpp, line 559")
\* Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
minimal effort.
\* How likely is this patch to cause regressions; how much testing does it need?
A respectable amount of bake time on mc (15 days) plus one follow up have already been completed. Fallout would be pretty obvious to users, so very little testing is needed. Confirming command buttons have the correct dimensions on classic / basic desktops should suffice.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=873073#c27)• 12 years ago |
|  | |

correction:
\* If not all supported branches, which bug introduced the flaw?
[bug 575870](/show_bug.cgi?id=575870 "RESOLVED FIXED - Implement the firefox button on xp, classic, and aero basic")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=873073#c28)• 12 years ago |
|  | |

Jim: you said this only happens at startup? Does that include the assertion in [comment 0](/show_bug.cgi?id=873073#c0 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout")? Over in [bug 748156](/show_bug.cgi?id=748156 "RESOLVED FIXED - Intermittent 166750-1.html,test_bug240933.html,749816-1.html,763223-1.html,763702.xhtml | assertion count 2 is more than expected 0 assertions from \"ASSERTION: This is unsafe! Fix the caller!\" in nsEventDispatcher.cpp, line 559") the dangerous assertion happened after we were up to DOMWINDOW == 68.
If this is truly only a startup issue (not that the fix is at startup, but that the resulting problems are) then we can lower this to sec-moderate and not worry about older branches (ESR and Beta 23). Otherwise we should backport it (and [bug 888765](/show_bug.cgi?id=888765 "RESOLVED FIXED - Many tests on Win8 on nightly builds fail to start")).
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F)Flags: needinfo?(jmathies)Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---) → [assertion](/buglist.cgi?keywords=assertion&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=873073#c29)• 12 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #28](/show_bug.cgi?id=873073#c28 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> Jim: you said this only happens at startup? Does that include the assertion
> in [comment 0](/show_bug.cgi?id=873073#c0 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout")? Over in [bug 748156](/show_bug.cgi?id=748156 "RESOLVED FIXED - Intermittent 166750-1.html,test_bug240933.html,749816-1.html,763223-1.html,763702.xhtml | assertion count 2 is more than expected 0 assertions from \"ASSERTION: This is unsafe! Fix the caller!\" in nsEventDispatcher.cpp, line 559") the dangerous assertion happened after we
> were up to DOMWINDOW == 68.
Unfortunately there are only five occurrences for that test and the logs are all gone. Then it switched to another test that was much closer to startup.
UpdateTitlebarInfo was called the first time layout asked for button metrics for any of the following non-client command buttons:
NS\_THEME\_WINDOW\_BUTTON\_MAXIMIZE
NS\_THEME\_WINDOW\_BUTTON\_RESTORE
NS\_THEME\_WINDOW\_BUTTON\_MINIMIZE
NS\_THEME\_WINDOW\_BUTTON\_CLOSE
NS\_THEME\_WINDOW\_BUTTON\_BOX
NS\_THEME\_WINDOW\_BUTTON\_BOX\_MAXIMIZED
If a set of tests ran without non-client chrome these values would not get queried until a regular chrome window was created. reftest do exactly that, so I'm guessing at some point a crash/ref test created a chromed window for something, hence the late query / assert.Flags: needinfo?(jmathies)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=873073#c30)• 12 years ago |
|  | |

OK, based on that we should be OK leaving this out of Beta/ESR.
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=-)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a4937489_280903)• 12 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a4944116_448925)• 12 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a4944219_448925)• 12 years ago |

Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---),
[verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=873073#c31)• 12 years ago |
|  | |

Comment on [attachment 768891](/attachment.cgi?id=768891 "fix") [[details]](/attachment.cgi?id=768891&action=edit "fix") [[diff]](/attachment.cgi?id=768891&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=873073&attachment=768891)
fix
Approving on aurora and adding qawanted to help with testing per [comment #26](/show_bug.cgi?id=873073#c26 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout").
[Attachment #768891](/attachment.cgi?id=768891&action=edit "fix") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=873073#c32)• 12 years ago |
|  | |

Question for Jim because of Bhavana's QA request in [comment 31](/show_bug.cgi?id=873073#c31 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"):
"Confirming command buttons have the correct dimensions on classic / basic desktops should suffice."
Jim, can you give examples of command buttons, and what a classic or basic desktop means? Sorry if that sounds obtuse, I just want to be sure. Thanks.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=873073#c33)• 12 years ago |
|  | |

(In reply to Matt Wobensmith from [comment #32](/show_bug.cgi?id=873073#c32 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"))
> Question for Jim because of Bhavana's QA request in [comment 31](/show_bug.cgi?id=873073#c31 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout"):
>
> "Confirming command buttons have the correct dimensions on classic / basic
> desktops should suffice."
>
> Jim, can you give examples of command buttons, and what a classic or basic
> desktop means? Sorry if that sounds obtuse, I just want to be sure. Thanks.
We render the minimize, maximize, and close button in the window chrome on the upper right ourselves on "basic" themes. So in testing on Win7, try switching desktop themes from glass to aero basic or classic and check that those buttons look right. (Note, switching themes while fx is running is broken, so switch before starting firefox.)
With Win7 glass we leave rendering to Windows, but apply special treatment when a persona is installed. Try installing a persona on a glass desktop and make sure the transparent aero buttons aren't overlapping the light weight theme texture in the titlebar.
Also, try enabling/disabling the fx button while on "basic" themes. (alt-view-toolbars-enable/disable the menu bar.)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=873073#c34)• 12 years ago |
|  | |

Thanks Jim.
I ran through all of the scenarios Jim suggested in the previous comment on a pre-patch build, and didn't see any weirdness or crash.
I then did the same on today's m-c build, and again, all seems fine.
I did see artifacts when a persona is installed, and we are switching themes without restarting the browser, but Jim already mentioned that would be expected.
Based on that, I am going to mark this verified for FF25.
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=verified)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a5218201_452604)• 12 years ago |

Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=873073#c35)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/44b9a417273d>
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a7137320_1689)• 11 years ago |

Group: layout-core-security

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a8841877_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=873073#c36)• 11 years ago |
|  | |

Verified, same steps, FF24b6.Status: RESOLVED → VERIFIED
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified)Keywords: [verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=873073#a47739847_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=873073&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jim Mathies [:jimm]](/user_profile?user_id=279663)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from blog.mozilla.org_214f5ef1_20250126_100127.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_ab3405ea_20250125_154627.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/876878)
* [XML](/show_bug.cgi?ctype=xml&id=876878)

Closed
[Bug 876878](/show_bug.cgi?id=876878)

Opened 12 years ago
Closed 12 years ago

# crash in webrtc::videocapturemodule::GetMaxOfFrameArray

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

crash in webrtc::videocapturemodule::GetMaxOfFrameArray

## Categories

### (Core :: WebRTC, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=WebRTC#WebRTC)

WebRTC
▾

Core :: WebRTC
General bugs associated with WebRTC
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=WebRTC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=WebRTC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=WebRTC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

22 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows NT

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla25

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) |
| firefox22 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | wontfix |
| firefox22 |  | wontfix |
| firefox23 |  | wontfix |
| firefox24 |  | fixed |
| firefox25 |  | fixed |
| firefox-esr17 |  | unaffected |
| firefox-esr24 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jsmith, Assigned: jesup)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=40)  [jesup](/user_profile?user_id=11539)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/fba16ea71cd5ef27991fcea651e8cd56?d=mm&size=40)  [jsmith](/user_profile?user_id=432443)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/fba16ea71cd5ef27991fcea651e8cd56?d=mm&size=40)  [jsmith](/user_profile?user_id=432443)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e2a2be17b9bb8a1d4d7427c810996388?d=mm&size=40)  [mjf](/user_profile?user_id=546718)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, sec-moderate, sec-vector, Whiteboard: [getUserMedia], [blocking-gum-][leave-open][webrtc-topcrash][adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[getUserMedia], [blocking-gum-][leave-open][webrtc-topcrash][adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ webrtc::videocapturemodule::GetMaxOfFrameArray(\_\_int64\*, long) ]](https://crash-stats.mozilla.org/signature/?signature=webrtc%3A%3Avideocapturemodule%3A%3AGetMaxOfFrameArray%28__int64%2A%2C%20long%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [null out pointer for GetFrameRateList](/attachment.cgi?id=755485)  [12 years ago](#c2)  [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)   1.37 KB, patch | jesup : [review+](#c5 "12 years ago")  akeybl : [approval-mozilla-aurora+](#a513144_425645 "12 years ago")  akeybl : [approval-mozilla-beta+](#a513144_425645 "12 years ago") | [Details](/attachment.cgi?id=755485&action=edit) | [Diff](/attachment.cgi?id=755485&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=755485) |
| --- | --- | --- |
| [Avoid null deref if camera doesn't update framelist ptr](/attachment.cgi?id=780534)  [12 years ago](#c21)  [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)   2.60 KB, patch | bas.schouten : [review+](#a5000967_272464 "12 years ago")  bajaj : [approval-mozilla-aurora+](#a5440571_448925 "12 years ago") | [Details](/attachment.cgi?id=780534&action=edit) | [Diff](/attachment.cgi?id=780534&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=780534) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=876878#c0)• 12 years ago |
|  | |

This bug was filed from the Socorro interface and is
report [bp-0a4f8b73-e624-48f2-bbf5-dc62d2130527](https://crash-stats.mozilla.org/report/index/0a4f8b73-e624-48f2-bbf5-dc62d2130527) .
=============================================================
Frame Module Signature Source
0 xul.dll webrtc::videocapturemodule::GetMaxOfFrameArray media/webrtc/trunk/webrtc/modules/video\_capture/windows/help\_functions\_ds.cc:26
1 xul.dll webrtc::videocapturemodule::DeviceInfoDS::CreateCapabilityMap media/webrtc/trunk/webrtc/modules/video\_capture/windows/device\_info\_ds.cc:609
2 xul.dll webrtc::videocapturemodule::DeviceInfoImpl::NumberOfCapabilities media/webrtc/trunk/webrtc/modules/video\_capture/device\_info\_impl.cc:76
3 xul.dll webrtc::ViECaptureImpl::NumberOfCapabilities media/webrtc/trunk/webrtc/video\_engine/vie\_capture\_impl.cc:442
4 xul.dll mozilla::MediaEngineWebRTCVideoSource::ChooseCapability content/media/webrtc/MediaEngineWebRTCVideo.cpp:157
5 xul.dll mozilla::MediaEngineWebRTCVideoSource::Allocate content/media/webrtc/MediaEngineWebRTCVideo.cpp:224
6 xul.dll mozilla::GetUserMediaRunnable::ProcessGetUserMedia dom/media/MediaManager.cpp:739
7 xul.dll mozilla::GetUserMediaRunnable::Run dom/media/MediaManager.cpp:600
8 xul.dll nsThread::ProcessNextEvent xpcom/threads/nsThread.cpp:627
9 xul.dll nsThread::ThreadFunc xpcom/threads/nsThread.cpp:265
10 nss3.dll \_PR\_NativeRunThread nsprpub/pr/src/threads/combined/pruthr.c:395
11 nss3.dll pr\_root nsprpub/pr/src/md/windows/w95thred.c:90
12 msvcr100.dll \_callthreadstartex f:\dd\vctools\crt\_bld\self\_x86\crt\src\threadex.c:314
13 msvcr100.dll \_threadstartex f:\dd\vctools\crt\_bld\self\_x86\crt\src\threadex.c:292
14 kernel32.dll BaseThreadInitThunk
15 ntdll.dll \_\_RtlUserThreadStart
16 ntdll.dll \_RtlUserThreadStart

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=876878#c1)• 12 years ago |
|  | |

Looks like a bug in GetFrameRateList() in the directx/camera-driver.... it would help a lot to know what camera/driver the reports were for.
Bas, any ideas?

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=876878#c2)• 12 years ago |
|  | |

Attached patch

[null out pointer for GetFrameRateList](attachment.cgi?id=755485&action=diff) (obsolete)
— [Details](attachment.cgi?id=755485&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=755485)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=876878#c3)• 12 years ago |
|  | |

Comment on [attachment 755485](/attachment.cgi?id=755485 "null out pointer for GetFrameRateList") [[details]](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") [[diff]](/attachment.cgi?id=755485&action=diff "null out pointer for GetFrameRateList") [[review]](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=755485)
null out pointer for GetFrameRateList
Worth a try...
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: review?(bas)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a72974_11539)• 12 years ago |

Whiteboard: [getUserMedia], [blocking-gum-][webrtc-uplift]

|  | [Bas Schouten (:bas.schouten)](/user_profile?user_id=272464) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=876878#c4)• 12 years ago |
|  | |

Comment on [attachment 755485](/attachment.cgi?id=755485 "null out pointer for GetFrameRateList") [[details]](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") [[diff]](/attachment.cgi?id=755485&action=diff "null out pointer for GetFrameRateList") [[review]](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=755485)
null out pointer for GetFrameRateList
Review of [attachment 755485](/attachment.cgi?id=755485 "null out pointer for GetFrameRateList") [[details]](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") [[diff]](/attachment.cgi?id=755485&action=diff "null out pointer for GetFrameRateList") [[review]](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=755485):
-----------------------------------------------------------------
This looks good for me but I'm afraid I'm not really qualified to review this code as I'm not a WebRTC peer.
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: review?(bas)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=876878#c5)• 12 years ago |
|  | |

Comment on [attachment 755485](/attachment.cgi?id=755485 "null out pointer for GetFrameRateList") [[details]](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") [[diff]](/attachment.cgi?id=755485&action=diff "null out pointer for GetFrameRateList") [[review]](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=755485)
null out pointer for GetFrameRateList
As module owner, I'll interpret that as r+ ;-)
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: review+

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=876878#c6)• 12 years ago |
|  | |

<https://hg.mozilla.org/projects/cypress/rev/758527363f29>
We should watch crash stats once this gets to the field, and also investigate what broken cameras/drivers might be at fault.Whiteboard: [getUserMedia], [blocking-gum-][webrtc-uplift] → [getUserMedia], [blocking-gum-][webrtc-uplift][leave-open]

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=876878#c7)• 12 years ago |
|  | |

Comment on [attachment 755485](/attachment.cgi?id=755485 "null out pointer for GetFrameRateList") [[details]](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") [[diff]](/attachment.cgi?id=755485&action=diff "null out pointer for GetFrameRateList") [[review]](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=755485)
null out pointer for GetFrameRateList
[Approval Request Comment]
Bug caused by (feature/regressing bug #): N/A
User impact if declined: Patch might not get a chance to fix/wallpaper over camera driver bug
Testing completed (on m-c, etc.): Still waiting for m-c merge - trivial fix
Risk to taking this patch (and alternatives if risky): No risk to the patch. Just initializing a pointer to NULL in case the broken driver is leaving it unset.
String or IDL/UUID changes made by this patch: none
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: approval-mozilla-beta?
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: approval-mozilla-aurora?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=876878#c8)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/758527363f29>

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a513124_425645)• 12 years ago |

Assignee: nobody → rjesup

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a513144_425645)• 12 years ago |

[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: approval-mozilla-beta?
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: approval-mozilla-beta+
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: approval-mozilla-aurora?
[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Flags: approval-mozilla-aurora+

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=876878#c9)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/f7ddec3461a7>
Aurora is waiting on closureTarget Milestone: --- → mozilla24

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=876878#c10)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/34fdc5b5710d>Whiteboard: [getUserMedia], [blocking-gum-][webrtc-uplift][leave-open] → [getUserMedia], [blocking-gum-][leave-open]

|  | [Manuela Muntean [Away]](/user_profile?user_id=452908) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=876878#c11)• 12 years ago |
|  | |

Considering the time the patch was submitted, I'll verify the fix on Firefox 22 beta 5. (I'll check in Socorro if until then new crash reports will appear)

|  | [Manuela Muntean [Away]](/user_profile?user_id=452908) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a733660_452908)• 12 years ago |

Flags: needinfo?

|  | [Manuela Muntean [Away]](/user_profile?user_id=452908) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a733688_452908)• 12 years ago |

Flags: needinfo?

|  | [Manuela Muntean [Away]](/user_profile?user_id=452908) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=876878#c12)• 12 years ago |
|  | |

While checking in Socorro for crash reports from last month, I found these 4 reports, which seem to be related to Firefox 22 beta 4 build (they have 20130605070403 as build ID). They only appear under the "Reports" tab in Socorro, and not also under the "Signature Summary" tab (Fx 22 beta 4 isn't mentioned).
<https://crash-stats.mozilla.com/report/index/01ce5409-f812-4938-8d8a-1d09d2130613>
<https://crash-stats.mozilla.com/report/index/7426a742-4d0a-45b0-b176-5ea472130613>
<https://crash-stats.mozilla.com/report/index/62634ceb-b37c-4ec5-b48c-25e592130613>
<https://crash-stats.mozilla.com/report/index/5bb257a5-6f27-401a-abbf-5c57b2130613>
Does anyone have any suggestions?Flags: needinfo?

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=876878#c13)• 12 years ago |
|  | |

Suggestions specifically on what?Flags: needinfo?

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=876878#c14)• 12 years ago |
|  | |

This would indicate that the problem was indeed caused by a bug in the driver. All signs still point to a bug in the camera driver returning success without setting the pointer to a value. This also proves that this was a potential security bug (though limited to machines with the bad camera driver - and webrtc isn't going to work on those cameras, so it may be hard to engineer users into enabling their cameras, since everytime they try for any site it will crash (in 22 beta-3 and before, and 23/24 builds up to when we landed the ptr-nulling patch).
The followon patch needed will be to check for a null array returned, and cleanly fail instead of null-derefing.
Needinfo to dveditz to decide if this makes sense to keep closed.Group: core-securityFlags: needinfo?(dveditz)

|  | [Manuela Muntean [Away]](/user_profile?user_id=452908) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=876878#c15)• 12 years ago |
|  | |

(In reply to Jason Smith [:jsmith] from [comment #13](/show_bug.cgi?id=876878#c13 "RESOLVED FIXED - crash in webrtc::videocapturemodule::GetMaxOfFrameArray"))
> Suggestions specifically on what?
I was wondering about the strange behavior that I experienced in [comment 12](/show_bug.cgi?id=876878#c12 "RESOLVED FIXED - crash in webrtc::videocapturemodule::GetMaxOfFrameArray"). It seems weird to me. Is it expected?

|  | [Manuela Muntean [Away]](/user_profile?user_id=452908) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=876878#c16)• 12 years ago |
|  | |

7 new crashes appeared with Firefox 22 beta 5: <https://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=contains&query=webrtc%3A%3Avideocapturemodule%3A%3AGetMaxOfFrameArray%28__int64%2A%2C%20long%29&reason_type=contains&date=06%2F18%2F2013%2006%3A42%3A25&range_value=4&range_unit=weeks&hang_type=any&process_type=any&do_query=1&signature=webrtc%3A%3Avideocapturemodule%3A%3AGetMaxOfFrameArray%28__int64%2A%2C%20long%29>

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a1800145_425645)• 12 years ago |

[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=876878#c17)• 12 years ago |
|  | |

By far the worst crash on the list for WebRTC-related crashes.Whiteboard: [getUserMedia], [blocking-gum-][leave-open] → [getUserMedia], [blocking-gum-][leave-open][webrtc-topcrash]

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=876878#c18)• 12 years ago |
|  | |

Note that all the crashes in B5 and later are null derefs (i.e. the safety patch works).
We need to land an "error and don't crash patch". Also, we need to find out what camera and what driver is causing this failure. This is a bug in some camera driver on windows.Flags: needinfo?(dveditz)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=876878#c19)• 12 years ago |
|  | |

Grr. Thanks keyboard. I was going to say, clearing needinfo to dveditz since we should keep this closed, as it applies to FF20 and FF21 (hard to test, but we see the crashes).
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=876878#c20)• 12 years ago |
|  | |

I'll call this sec-moderate rather than worse mostly because of the mitigations mentioned in [comment 14](/show_bug.cgi?id=876878#c14 "RESOLVED FIXED - crash in webrtc::videocapturemodule::GetMaxOfFrameArray")Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a2077343_425645)• 12 years ago |

[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → ---

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=876878#c21)• 12 years ago |
|  | |

Attached patch

[Avoid null deref if camera doesn't update framelist ptr](attachment.cgi?id=780534&action=diff)
— [Details](attachment.cgi?id=780534&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=780534)

Final 'don't crash with null deref if the driver does something stupid' patch

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a4917067_11539)• 12 years ago |

[Attachment #755485](/attachment.cgi?id=755485&action=edit "null out pointer for GetFrameRateList") -
Attachment is obsolete: true

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=876878#c22)• 12 years ago |
|  | |

Comment on [attachment 780534](/attachment.cgi?id=780534 "Avoid null deref if camera doesn't update framelist ptr") [[details]](/attachment.cgi?id=780534&action=edit "Avoid null deref if camera doesn't update framelist ptr") [[diff]](/attachment.cgi?id=780534&action=diff "Avoid null deref if camera doesn't update framelist ptr") [[review]](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=780534)
Avoid null deref if camera doesn't update framelist ptr
bas: you can review this one. :-) Just adds a null-check, and treats a broken driver as having failed the GetMaxOfFrameArray() call. I'll propose this to the upstream codebase.
[Attachment #780534](/attachment.cgi?id=780534&action=edit "Avoid null deref if camera doesn't update framelist ptr") -
Flags: review?(bas)

|  | [Bas Schouten (:bas.schouten)](/user_profile?user_id=272464) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a5000967_272464)• 12 years ago |

[Attachment #780534](/attachment.cgi?id=780534&action=edit "Avoid null deref if camera doesn't update framelist ptr") -
Flags: review?(bas) → review+

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=876878#c23)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/19d9842325b2>
Will nominate for Aurora shortly. Not sure we need to nominate it for beta at this late date.

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a5005230_11539)• 12 years ago |

Target Milestone: mozilla24 → mozilla25

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=876878#c24)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/19d9842325b2>
Assuming this won't make it onto Fx23 since it's only sec-moderate.Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=876878#c25)• 12 years ago |
|  | |

Comment on [attachment 780534](/attachment.cgi?id=780534 "Avoid null deref if camera doesn't update framelist ptr") [[details]](/attachment.cgi?id=780534&action=edit "Avoid null deref if camera doesn't update framelist ptr") [[diff]](/attachment.cgi?id=780534&action=diff "Avoid null deref if camera doesn't update framelist ptr") [[review]](/page.cgi?id=splinter.html&ignore=&bug=876878&attachment=780534)
Avoid null deref if camera doesn't update framelist ptr
[Approval Request Comment]
Bug caused by (feature/regressing bug #): N/A
User impact if declined: Crashes (null-deref) if you have a particular-but-unknown broken camera driver.
Testing completed (on m-c, etc.): on m-c.
Risk to taking this patch (and alternatives if risky): virtually none
String or IDL/UUID changes made by this patch: none
[Attachment #780534](/attachment.cgi?id=780534&action=edit "Avoid null deref if camera doesn't update framelist ptr") -
Flags: approval-mozilla-aurora?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a5440571_448925)• 11 years ago |

[Attachment #780534](/attachment.cgi?id=780534&action=edit "Avoid null deref if camera doesn't update framelist ptr") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=876878#c26)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/c93b75b0efdb>
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a7527183_280903)• 11 years ago |

Whiteboard: [getUserMedia], [blocking-gum-][leave-open][webrtc-topcrash] → [getUserMedia], [blocking-gum-][leave-open][webrtc-topcrash][adv-main24+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a11738959_280903)• 11 years ago |

[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=876878#c27)• 11 years ago |
|  | |

getUserMedia wasn't enabled-by-default until FF 20
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a14017373_1689)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=876878#a46681134_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=876878&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_d5096333_20250125_154608.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ/)

[Manage this list](/manage/lists/updates.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/updates%40lists.opensuse.org/thread/V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ/#V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ)

# openSUSE-SU-2013:1493-1: moderate: update for MozillaFirefox

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

27 Sep
2013

27 Sep
'13

14:04

openSUSE Security Update: update for MozillaFirefox
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:1493-1
Rating: moderate
References: #840485 #840551
Cross-References: CVE-2013-1718 CVE-2013-1719 CVE-2013-1720
CVE-2013-1721 CVE-2013-1722 CVE-2013-1723
CVE-2013-1724 CVE-2013-1725 CVE-2013-1728
CVE-2013-1730 CVE-2013-1732 CVE-2013-1735
CVE-2013-1736 CVE-2013-1737 CVE-2013-1738
Affected Products:
openSUSE 12.3
openSUSE 12.2
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 15 vulnerabilities is now available.
Description:
This MozillaFirefox update to version 24.0 fixes several
security and non-security issues:
- move greek to the translations-common package (bnc#840551)
- update to Firefox 24.0 (bnc#840485)
\* MFSA 2013-76/CVE-2013-1718/CVE-2013-1719 Miscellaneous
memory safety hazards
\* MFSA 2013-77/CVE-2013-1720 (bmo#888820) Improper state
in HTML5 Tree Builder with templates
\* MFSA 2013-78/CVE-2013-1721 (bmo#890277) Integer
overflow in ANGLE library
\* MFSA 2013-79/CVE-2013-1722 (bmo#893308) Use-after-free
in Animation Manager during stylesheet cloning
\* MFSA 2013-80/CVE-2013-1723 (bmo#891292) NativeKey
continues handling key messages after widget is
destroyed
\* MFSA 2013-81/CVE-2013-1724 (bmo#894137) Use-after-free
with select element
\* MFSA 2013-82/CVE-2013-1725 (bmo#876762) Calling scope
for new Javascript objects can lead to memory corruption
\* MFSA 2013-85/CVE-2013-1728 (bmo#883686) Uninitialized
data in IonMonkey
\* MFSA 2013-88/CVE-2013-1730 (bmo#851353) Compartment
mismatch re-attaching XBL-backed nodes
\* MFSA 2013-89/CVE-2013-1732 (bmo#883514) Buffer overflow
with multi-column, lists, and floats
\* MFSA 2013-90/CVE-2013-1735/CVE-2013-1736 (bmo#898871,
bmo#906301) Memory corruption involving scrolling
\* MFSA 2013-91/CVE-2013-1737 (bmo#907727) User-defined
properties on DOM proxies get the wrong "this" object
\* MFSA 2013-92/CVE-2013-1738 (bmo#887334, bmo#882897) GC
hazard with default compartments and frame chain
restoration
- enable gstreamer explicitely via pref (gecko.js)
- require NSS 3.15.1
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.3:
zypper in -t patch openSUSE-2013-718
- openSUSE 12.2:
zypper in -t patch openSUSE-2013-718
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.3 (i586 x86\_64):
MozillaFirefox-24.0-1.33.1
MozillaFirefox-branding-upstream-24.0-1.33.1
MozillaFirefox-buildsymbols-24.0-1.33.1
MozillaFirefox-debuginfo-24.0-1.33.1
MozillaFirefox-debugsource-24.0-1.33.1
MozillaFirefox-devel-24.0-1.33.1
MozillaFirefox-translations-common-24.0-1.33.1
MozillaFirefox-translations-other-24.0-1.33.1
- openSUSE 12.2 (i586 x86\_64):
MozillaFirefox-24.0-2.59.1
MozillaFirefox-branding-upstream-24.0-2.59.1
MozillaFirefox-buildsymbols-24.0-2.59.1
MozillaFirefox-debuginfo-24.0-2.59.1
MozillaFirefox-debugsource-24.0-2.59.1
MozillaFirefox-devel-24.0-2.59.1
MozillaFirefox-translations-common-24.0-2.59.1
MozillaFirefox-translations-other-24.0-2.59.1
References:
<http://support.novell.com/security/cve/CVE-2013-1718.html>
<http://support.novell.com/security/cve/CVE-2013-1719.html>
<http://support.novell.com/security/cve/CVE-2013-1720.html>
<http://support.novell.com/security/cve/CVE-2013-1721.html>
<http://support.novell.com/security/cve/CVE-2013-1722.html>
<http://support.novell.com/security/cve/CVE-2013-1723.html>
<http://support.novell.com/security/cve/CVE-2013-1724.html>
<http://support.novell.com/security/cve/CVE-2013-1725.html>
<http://support.novell.com/security/cve/CVE-2013-1728.html>
<http://support.novell.com/security/cve/CVE-2013-1730.html>
<http://support.novell.com/security/cve/CVE-2013-1732.html>
<http://support.novell.com/security/cve/CVE-2013-1735.html>
<http://support.novell.com/security/cve/CVE-2013-1736.html>
<http://support.novell.com/security/cve/CVE-2013-1737.html>
<http://support.novell.com/security/cve/CVE-2013-1738.html>
<https://bugzilla.novell.com/840485>
<https://bugzilla.novell.com/840551>

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ/)
Use email software

[Back to the thread](/archives/list/updates%40lists.opensuse.org/thread/V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ/#V7U7QTTYQX7SC4CLZWS3VYBGJD6K2HOZ)

[Back to the list](/archives/list/updates%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from lists.opensuse.org_a1908f0f_20250125_154608.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/J6QRVI25NBOM6C66WHBPITP3MZA342OJ/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/J6QRVI25NBOM6C66WHBPITP3MZA342OJ/)

[Manage this list](/manage/lists/updates.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/J6QRVI25NBOM6C66WHBPITP3MZA342OJ/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/J6QRVI25NBOM6C66WHBPITP3MZA342OJ/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/updates%40lists.opensuse.org/thread/J6QRVI25NBOM6C66WHBPITP3MZA342OJ/#J6QRVI25NBOM6C66WHBPITP3MZA342OJ)

# openSUSE-SU-2013:1491-1: moderate: update for seamonkey

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

27 Sep
2013

27 Sep
'13

14:04

openSUSE Security Update: update for seamonkey
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:1491-1
Rating: moderate
References: #840485
Cross-References: CVE-2013-1718 CVE-2013-1719 CVE-2013-1720
CVE-2013-1721 CVE-2013-1722 CVE-2013-1723
CVE-2013-1724 CVE-2013-1725 CVE-2013-1728
CVE-2013-1730 CVE-2013-1732 CVE-2013-1735
CVE-2013-1736 CVE-2013-1737 CVE-2013-1738
Affected Products:
openSUSE 12.3
openSUSE 12.2
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 15 vulnerabilities is now available.
Description:
This seamonkey update to version 2.21 fixes several
security and non-security issues:
- update to SeaMonkey 2.21 (bnc#840485)
\* MFSA 2013-76/CVE-2013-1718/CVE-2013-1719 Miscellaneous
memory safety hazards
\* MFSA 2013-77/CVE-2013-1720 (bmo#888820) Improper state
in HTML5 Tree Builder with templates
\* MFSA 2013-78/CVE-2013-1721 (bmo#890277) Integer
overflow in ANGLE library
\* MFSA 2013-79/CVE-2013-1722 (bmo#893308) Use-after-free
in Animation Manager during stylesheet cloning
\* MFSA 2013-80/CVE-2013-1723 (bmo#891292) NativeKey
continues handling key messages after widget is
destroyed
\* MFSA 2013-81/CVE-2013-1724 (bmo#894137) Use-after-free
with select element
\* MFSA 2013-82/CVE-2013-1725 (bmo#876762) Calling scope
for new Javascript objects can lead to memory corruption
\* MFSA 2013-85/CVE-2013-1728 (bmo#883686) Uninitialized
data in IonMonkey
\* MFSA 2013-88/CVE-2013-1730 (bmo#851353) Compartment
mismatch re-attaching XBL-backed nodes
\* MFSA 2013-89/CVE-2013-1732 (bmo#883514) Buffer overflow
with multi-column, lists, and floats
\* MFSA 2013-90/CVE-2013-1735/CVE-2013-1736 (bmo#898871,
bmo#906301) Memory corruption involving scrolling
\* MFSA 2013-91/CVE-2013-1737 (bmo#907727) User-defined
properties on DOM proxies get the wrong "this" object
\* MFSA 2013-92/CVE-2013-1738 (bmo#887334, bmo#882897) GC
hazard with default compartments and frame chain
restoration
- requires NSS 3.15.1
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.3:
zypper in -t patch openSUSE-2013-720
- openSUSE 12.2:
zypper in -t patch openSUSE-2013-720
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.3 (i586 x86\_64):
seamonkey-2.21-1.21.2
seamonkey-debuginfo-2.21-1.21.2
seamonkey-debugsource-2.21-1.21.2
seamonkey-dom-inspector-2.21-1.21.2
seamonkey-irc-2.21-1.21.2
seamonkey-translations-common-2.21-1.21.2
seamonkey-translations-other-2.21-1.21.2
seamonkey-venkman-2.21-1.21.2
- openSUSE 12.2 (i586 x86\_64):
seamonkey-2.21-2.50.1
seamonkey-debuginfo-2.21-2.50.1
seamonkey-debugsource-2.21-2.50.1
seamonkey-dom-inspector-2.21-2.50.1
seamonkey-irc-2.21-2.50.1
seamonkey-translations-common-2.21-2.50.1
seamonkey-translations-other-2.21-2.50.1
seamonkey-venkman-2.21-2.50.1
References:
<http://support.novell.com/security/cve/CVE-2013-1718.html>
<http://support.novell.com/security/cve/CVE-2013-1719.html>
<http://support.novell.com/security/cve/CVE-2013-1720.html>
<http://support.novell.com/security/cve/CVE-2013-1721.html>
<http://support.novell.com/security/cve/CVE-2013-1722.html>
<http://support.novell.com/security/cve/CVE-2013-1723.html>
<http://support.novell.com/security/cve/CVE-2013-1724.html>
<http://support.novell.com/security/cve/CVE-2013-1725.html>
<http://support.novell.com/security/cve/CVE-2013-1728.html>
<http://support.novell.com/security/cve/CVE-2013-1730.html>
<http://support.novell.com/security/cve/CVE-2013-1732.html>
<http://support.novell.com/security/cve/CVE-2013-1735.html>
<http://support.novell.com/security/cve/CVE-2013-1736.html>
<http://support.novell.com/security/cve/CVE-2013-1737.html>
<http://support.novell.com/security/cve/CVE-2013-1738.html>
<https://bugzilla.novell.com/840485>

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/J6QRVI25NBOM6C66WHBPITP3MZA342OJ/)
Use email software

[Back to the thread](/archives/list/updates%40lists.opensuse.org/thread/J6QRVI25NBOM6C66WHBPITP3MZA342OJ/#J6QRVI25NBOM6C66WHBPITP3MZA342OJ)

[Back to the list](/archives/list/updates%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.ubuntu.com_f7d32b13_20250125_154613.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1951-1: Firefox vulnerabilities

17 September 2013

Firefox could be made to crash or run programs as your login if it
opened a malicious website.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 13.04](/security/notices?release=raring)
* [Ubuntu 12.10](/security/notices?release=quantal)
* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [firefox](/security/cves?package=firefox) - Mozilla Open Source web browser

## Details

Multiple memory safety issues were discovered in Firefox. If a user were

tricked in to opening a specially crafted page, an attacker could possibly

exploit these to cause a denial of service via application crash, or

potentially execute arbitrary code with the privileges of the user

invoking Firefox. ([CVE-2013-1718](/security/CVE-2013-1718), [CVE-2013-1719](/security/CVE-2013-1719))

Atte Kettunen discovered a flaw in the HTML5 Tree Builder when interacting

with template elements. In some circumstances, an attacker could

potentially exploit this to execute arbitrary code with the privileges of

the user invoking Firefox. ([CVE-2013-1720](/security/CVE-2013-1720))

Alex Chapman discovered an integer overflow vulnerability in the ANGLE

library. An attacker could potentially exploit this to execute arbitrary

code with the privileges of the user invoking Firefox. ([CVE-2013-1721](/security/CVE-2013-1721))

Abhishek Arya discovered a use-after-free in the Animation Manager. An

attacked could potentially exploit this to execute arbitrary code with the

privileges of the user invoking Firefox. ([CVE-2013-1722](/security/CVE-2013-1722))

Scott Bell discovered a use-after-free when using a select element. An

attacker could potentially exploit this to execute arbitrary code with the

privileges of the user invoking Firefox. ([CVE-2013-1724](/security/CVE-2013-1724))

It was discovered that the scope of new Javascript objects could be

accessed before their compartment is initialized. An attacker could

potentially exploit this to execute code with the privileges of the user

invoking Firefox. ([CVE-2013-1725](/security/CVE-2013-1725))

Dan Gohman discovered that some variables and data were used in IonMonkey,

without being initialized, which could lead to information leakage.

([CVE-2013-1728](/security/CVE-2013-1728))

Sachin Shinde discovered a crash when moving some XBL-backed nodes

in to a document created by document.open(). An attacker could potentially

exploit this to cause a denial of service. ([CVE-2013-1730](/security/CVE-2013-1730))

Aki Helin discovered a buffer overflow when combining lists, floats and

multiple columns. An attacker could potentially exploit this to execute

arbitrary code with the privileges of the user invoking Firefox.

([CVE-2013-1732](/security/CVE-2013-1732))

Two memory corruption bugs when scrolling were discovered. An attacker

could potentially exploit these to cause a denial of service via

application crash, or execute arbitrary code with the privileges of the

user invoking Firefox. ([CVE-2013-1735](/security/CVE-2013-1735), [CVE-2013-1736](/security/CVE-2013-1736))

Boris Zbarsky discovered that user-defined getters on DOM proxies would

use the expando object as "this". An attacker could potentially exploit

this by tricking add-on code in to making incorrect security sensitive

decisions based on malicious values. ([CVE-2013-1737](/security/CVE-2013-1737))

A use-after-free bug was discovered in Firefox. An attacker could

potentially exploit this to execute arbitrary code with the privileges

of the user invoking Firefox. ([CVE-2013-1738](/security/CVE-2013-1738))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 13.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [24.0+build1-0ubuntu0.13.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/24.0%2Bbuild1-0ubuntu0.13.04.1)

##### Ubuntu 12.10

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [24.0+build1-0ubuntu0.12.10.1](https://launchpad.net/ubuntu/%2Bsource/firefox/24.0%2Bbuild1-0ubuntu0.12.10.1)

##### Ubuntu 12.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [24.0+build1-0ubuntu0.12.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/24.0%2Bbuild1-0ubuntu0.12.04.1)

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* [CVE-2013-1718](/security/CVE-2013-1718)
* [CVE-2013-1719](/security/CVE-2013-1719)
* [CVE-2013-1720](/security/CVE-2013-1720)
* [CVE-2013-1721](/security/CVE-2013-1721)
* [CVE-2013-1722](/security/CVE-2013-1722)
* [CVE-2013-1724](/security/CVE-2013-1724)
* [CVE-2013-1725](/security/CVE-2013-1725)
* [CVE-2013-1728](/security/CVE-2013-1728)
* [CVE-2013-1730](/security/CVE-2013-1730)
* [CVE-2013-1732](/security/CVE-2013-1732)
* [CVE-2013-1735](/security/CVE-2013-1735)
* [CVE-2013-1736](/security/CVE-2013-1736)
* [CVE-2013-1737](/security/CVE-2013-1737)
* [CVE-2013-1738](/security/CVE-2013-1738)
* <https://launchpad.net/bugs/1223826>

## Related notices

* [USN-1952-1](/security/notices/USN-1952-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from bugzilla.mozilla.org_82202031_20250125_154630.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/893519)
* [XML](/show_bug.cgi?ctype=xml&id=893519)

Closed
[Bug 893519](/show_bug.cgi?id=893519)

Opened 12 years ago
Closed 11 years ago

# Compartment mismatch with asm module in event listener attribute

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Compartment mismatch with asm module in event listener attribute

## Categories

### (Core :: DOM: Events, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Events#DOM%3A%20Events)

DOM: Events
▾

Core :: DOM: Events
This component includes bugs for DOM events from [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/).
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Events&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Events&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Events)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla26

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox26 | [+](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=verified) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 |  | wontfix |
| firefox24 | + | fixed |
| firefox25 | + | fixed |
| firefox26 | + | verified |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: luke)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [luke](/user_profile?user_id=347312)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[compartment-mismatch](/show_bug.cgi?id=821733 "RESOLVED WORKSFORME - [meta] crash in js::CompartmentChecker::fail")

Dependency [tree](/showdependencytree.cgi?id=893519&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=893519)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, sec-high, testcase, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [cbook](/user_profile?user_id=277293) | [in-testsuite](#c5 "11 years ago") | + |
| --- | --- | --- |
| [cbook](/user_profile?user_id=277293) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=775293)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   490 bytes, text/html |  | [Details](/attachment.cgi?id=775293&action=edit) |
| --- | --- | --- |
| [stack](/attachment.cgi?id=775294)  [12 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   23.95 KB, text/plain |  | [Details](/attachment.cgi?id=775294&action=edit) |
| [fix and test](/attachment.cgi?id=789180)  [11 years ago](#c3)  [Luke Wagner [:luke]](/user_profile?user_id=347312)   1.54 KB, patch | bbouvier : [review+](#a2567902_468907 "11 years ago") | [Details](/attachment.cgi?id=789180&action=edit) | [Diff](/attachment.cgi?id=789180&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893519&attachment=789180) |
| [aurora-fix](/attachment.cgi?id=789566)  [11 years ago](#c6)  [Luke Wagner [:luke]](/user_profile?user_id=347312)   1.13 KB, patch | luke : [review+](#c6 "11 years ago")  lsblakk : [approval-mozilla-aurora+](#a2720426_272375 "11 years ago") | [Details](/attachment.cgi?id=789566&action=edit) | [Diff](/attachment.cgi?id=789566&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893519&attachment=789566) |
| [beta-fix](/attachment.cgi?id=789578)  [11 years ago](#c7)  [Luke Wagner [:luke]](/user_profile?user_id=347312)   1.14 KB, patch | luke : [review+](#c7 "11 years ago")  lsblakk : [approval-mozilla-beta+](#a2720438_272375 "11 years ago") | [Details](/attachment.cgi?id=789578&action=edit) | [Diff](/attachment.cgi?id=789578&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893519&attachment=789578) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=893519#c0)• 12 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=775293)
— [Details](attachment.cgi?id=775293&action=edit)

[bp-3956aca3-ec88-4820-8830-a6f392130714](https://crash-stats.mozilla.org/report/index/3956aca3-ec88-4820-8830-a6f392130714)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=893519#c1)• 12 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=775294)
— [Details](attachment.cgi?id=775294&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a17918_406194)• 12 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2544016_406194)• 11 years ago |

[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2544050_406194)• 11 years ago |

Assignee: nobody → continuation

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=893519#c2)• 11 years ago |
|  | |

Luke, could you take a look at this? It seems like some kind of problem with cloning asm.js scripts across compartments.
Olli said that setAttribute lazily compiles whatever its argument is, so maybe that's related. I didn't hit an error when I changed the setAttribute line to:
e.ondrag = function module() { 'use asm'; return {}; };
I'm not very familiar with script cloning, so my poking around with the debugger was not very fruitful.Assignee: continuation → nobodyFlags: needinfo?(luke)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=893519#c3)• 11 years ago |
|  | |

Attached patch

[fix and test](attachment.cgi?id=789180&action=diff)
— [Details](attachment.cgi?id=789180&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893519&attachment=789180)

Ah, event handlers. With [bug 900669](/show_bug.cgi?id=900669 "RESOLVED FIXED - OdinMonkey: serialization/deserialization of AsmJSModule") there will be an easy way to clone an AsmJS module which will allow CloneScript to just clone the the nested asm.js module. However, a quick fix is to just disable Odin on non-compile-and-go scripts. All normal <script>/eval/Function code is compile-and-go, so this shouldn't affect anyone.Assignee: nobody → lukeStatus: NEW → ASSIGNED
[Attachment #789180](/attachment.cgi?id=789180&action=edit "fix and test") -
Flags: review?Flags: needinfo?(luke)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2560345_347312)• 11 years ago |

[Attachment #789180](/attachment.cgi?id=789180&action=edit "fix and test") -
Flags: review? → review?(bbouvier)

|  | [Benjamin Bouvier [:bbouvier] (inactive)](/user_profile?user_id=468907) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2567902_468907)• 11 years ago |

[Attachment #789180](/attachment.cgi?id=789180&action=edit "fix and test") -
Flags: review?(bbouvier) → review+

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=893519#c4)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/bb2abb7412e6>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2569510_406194)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=893519#c5)• 11 years ago |
|  | |

checkin - <https://hg.mozilla.org/mozilla-central/rev/bb2abb7412e6> patch and testStatus: ASSIGNED → RESOLVEDClosed: 11 years agoFlags: in-testsuite+Resolution: --- → FIXEDTarget Milestone: --- → mozilla26

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2616910_406194)• 11 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F)
[tracking-firefox26](/buglist.cgi?f1=cf_tracking_firefox26&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%3F)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=893519#c6)• 11 years ago |
|  | |

Attached patch

[aurora-fix](attachment.cgi?id=789566&action=diff)
— [Details](attachment.cgi?id=789566&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893519&attachment=789566)

At the least this is trivial to port to aurora (just need to rename /jit/ to /ion/ in paths).
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 840282](/show_bug.cgi?id=840282 "RESOLVED FIXED - Land OdinMonkey (asm.js optimizing compiler)")
User impact if declined: potential security vulnerability
Testing completed (on m-c, etc.): m-c
Risk to taking this patch (and alternatives if risky): very low
[Attachment #789566](/attachment.cgi?id=789566&action=edit "aurora-fix") -
Flags: review+
[Attachment #789566](/attachment.cgi?id=789566&action=edit "aurora-fix") -
Flags: approval-mozilla-aurora?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=893519#c7)• 11 years ago |
|  | |

Attached patch

[beta-fix](attachment.cgi?id=789578&action=diff)
— [Details](attachment.cgi?id=789578&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893519&attachment=789578)

[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 840282](/show_bug.cgi?id=840282 "RESOLVED FIXED - Land OdinMonkey (asm.js optimizing compiler)")
User impact if declined: potential security vulnerability
Testing completed (on m-c, etc.): m-c
Risk to taking this patch (and alternatives if risky): very low
[Attachment #789578](/attachment.cgi?id=789578&action=edit "beta-fix") -
Flags: review+
[Attachment #789578](/attachment.cgi?id=789578&action=edit "beta-fix") -
Flags: approval-mozilla-beta?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2720363_272375)• 11 years ago |

[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)
[tracking-firefox26](/buglist.cgi?f1=cf_tracking_firefox26&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%2B)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2720426_272375)• 11 years ago |

[Attachment #789566](/attachment.cgi?id=789566&action=edit "aurora-fix") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a2720438_272375)• 11 years ago |

[Attachment #789578](/attachment.cgi?id=789578&action=edit "beta-fix") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=893519#c8)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/6e0534f87045>
<https://hg.mozilla.org/releases/mozilla-beta/rev/ecdbdbed2233>
Any particular reason the branch patches didn't include the test?
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a3518684_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=893519#c9)• 11 years ago |
|  | |

Confirmed crash on ASan FF24, 2013-06-06.
Verified fixed on ASan FF26, 2013-11-20.
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893519#a42673969_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=893519&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_9a7019fb_20250125_154622.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/863935)
* [XML](/show_bug.cgi?ctype=xml&id=863935)

Closed
[Bug 863935](/show_bug.cgi?id=863935)

Opened 12 years ago
Closed 12 years ago

# Use-after-poison in nsFrameList::UnhookFrameFromSiblings with moz-column

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Use-after-poison in nsFrameList::UnhookFrameFromSiblings with moz-column

## Categories

### (Core :: Layout: Block and Inline, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Block%20and%20Inline#Layout%3A%20Block%20and%20Inline)

Layout: Block and Inline
▾

Core :: Layout: Block and Inline

Issues with core layout and geometry for basic block and inline elements. This includes issues with ::first-letter and ::first-line.

Example bugs:

* margins between two blocks do not collapse properly
* button does not align its baseline correctly with the rest of the line it’s in

Specifications covered:

* CSS Box
* CSS Inline Layout

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Block%20and%20Inline&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Block%20and%20Inline&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Block%20and%20Inline)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 |  | wontfix |
| firefox23 |  | wontfix |
| firefox24 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)"), [881090](/show_bug.cgi?id=881090 "RESOLVED DUPLICATE - use-after-poison in nsFrameList::FirstChild()")

Dependency [tree](/showdependencytree.cgi?id=863935&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=863935)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[881090](/show_bug.cgi?id=881090 "RESOLVED DUPLICATE - use-after-poison in nsFrameList::FirstChild()")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-framepoisoning](/buglist.cgi?keywords=csectype-framepoisoning&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | [in-testsuite](#c17 "12 years ago") | + |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [testcase](/attachment.cgi?id=739896)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   743 bytes, text/html |  | [Details](/attachment.cgi?id=739896&action=edit) |
| --- | --- | --- |
| [frame dump #1](/attachment.cgi?id=740048)  [12 years ago](#c2)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   12.84 KB, text/html |  | [Details](/attachment.cgi?id=740048&action=edit) |
| [frame dump #2](/attachment.cgi?id=740062)  [12 years ago](#c4)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   13.02 KB, text/html | MatsPalmgren\_bugz : [feedback?](#c4 "12 years ago") fantasai.bugs | [Details](/attachment.cgi?id=740062&action=edit) |
| [fix](/attachment.cgi?id=740090)  [12 years ago](#c5)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   11.73 KB, patch | roc : [review+](#c9 "12 years ago") | [Details](/attachment.cgi?id=740090&action=edit) | [Diff](/attachment.cgi?id=740090&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=863935&attachment=740090) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=863935#c0)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=739896)
— [Details](attachment.cgi?id=739896&action=edit)

Debug:
Assertion failure: !GetPropTableFrames(aPresContext, aProperty), at layout/generic/nsContainerFrame.cpp:1459
ASan:
Use-after-poison of pres arena memory in nsFrameList::UnhookFrameFromSiblings.
Nightly:
No symptoms.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=863935#c1)• 12 years ago |
|  | |

Security-sensitive in case this is a long-standing bug revealed by [bug 729519](/show_bug.cgi?id=729519 "RESOLVED FIXED - Allocate heap nsFrameLists from the pres shell arena").

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=863935#a34726_5168)• 12 years ago |

Assignee: nobody → matspal

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=863935#c2)• 12 years ago |
|  | |

Attached file
[frame dump #1](attachment.cgi?id=740048)
— [Details](attachment.cgi?id=740048&action=edit)

The check for when to forget about mOverflowContList is wrong.
<http://hg.mozilla.org/mozilla-central/annotate/4420f27742c7/layout/generic/nsContainerFrame.cpp#l1770>
Here's the stack / frame tree for the call to Finish() when we
shouldn't forget about it, because only the first two children
(ColumnSet frames) will be removed.
It seems we also update mSentry/mPrevOverflowCont wrong -
if I fix the above bug, then the resulting mSentry/mPrevOverflowCont
points to a frame (red) that is going to be destroyed. I think mSentry
should point to the green block, and mPrevOverflowCont its prev-in-flow
(pink), but I'm not really sure...

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=863935#c3)• 12 years ago |
|  | |

I'm pretty sure this is mitigated by frame poisoning.
After nsOverflowContinuationTracker::Insert creates a new list and overwrites
the ExcessOverflowContainers property (the assertion in [comment 0](/show_bug.cgi?id=863935#c0 "RESOLVED FIXED - Use-after-poison in nsFrameList::UnhookFrameFromSiblings with moz-column")) there's
no way to access the old list anymore. The crash is either going to be
accessing a destroyed frame through the bogus mSentry/mPrevOverflowCont
or when DeleteNextInFlowChild is trying to unhook one of the frames and finds
a next-sibling that is destroyed because we failed to remove it from the new
frame list earlier so it's still hooked up (the ASan error above).Keywords: [csec-framepoisoning](/buglist.cgi?keywords=csec-framepoisoning&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---)OS: Mac OS X → AllHardware: x86\_64 → All

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=863935#c4)• 12 years ago |
|  | |

Attached file
[frame dump #2](attachment.cgi?id=740062)
— [Details](attachment.cgi?id=740062&action=edit)

BEFORE: mSentry=0x7f4fe5b03330 mPrevOverflowCont=(nil)
AFTER: mSentry=0x7f4fe5b03af0 mPrevOverflowCont=(nil)
fantasai, does this makes sense to you for the given frame trees?
[Attachment #740062](/attachment.cgi?id=740062&action=edit "frame dump #2") -
Flags: feedback?(fantasai.bugs)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=863935#c5)• 12 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=740090&action=diff)
— [Details](attachment.cgi?id=740090&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=863935&attachment=740090)

Call BeginFinish() before DeleteNextInFlowChild/StealFrame on the kid's
next-in-flow and EndFinish() after, with the help of the new AutoFinish
class.
The old Finish() method tried to figure out whether the OC frame list
would become empty, and thus deleted. This is too fragile and never
really worked. Instead, compare the list pointer with mParent's
OC lists after the kid's next-in-flows are gone, in EndFinish(),
and re-setup the tracker's list if it was deleted.
Break out the list setup code from the ctor to a new method,
SetupOverflowContList(), so that it can be used for that purpose.
In BeginFinish, only try to detect if mSentry/mPrevOverflowCont
are going stale and repair those later in EndFinish().
(to my surprise "f == mPrevOverflowCont" actually do occur, which seems
to contradict the documentation that "it's a known good point; this
pointer won't be deleted on us")
I'm assuming that if we bump into mSentry without seeing
mPrevOverflowCont then mPrevOverflowCont is still valid - does this
assumption hold?
It would be great if you could elaborate on what mPrevOverflowCont/
mSentry is used for, and the relation between them. If one is null,
what does that mean? and what values can the other have in that case?
<https://tbpl.mozilla.org/?tree=Try&rev=c3cebb6cf160>
[Attachment #740090](/attachment.cgi?id=740090&action=edit "fix") -
Flags: review?(fantasai.bugs)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=863935#c6)• 12 years ago |
|  | |

WFM on mozilla-central??

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=863935#c7)• 12 years ago |
|  | |

The first good revision is:
changeset: <http://hg.mozilla.org/mozilla-central/rev/52127bafd50b>
user: Scott Johnson
date: Wed Apr 24 10:02:36 2013 -0500
summary: [Bug 857324](/show_bug.cgi?id=857324 "VERIFIED FIXED - Tbpl's bottom-right summary pane cuts off entries as of the 2013-03-08 nightly"): Make column set reflow continue without balancing rather than restarting if computed height is exceeded. [r=mats]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=863935#c8)• 12 years ago |
|  | |

Comment on [attachment 740090](/attachment.cgi?id=740090 "fix") [[details]](/attachment.cgi?id=740090&action=edit "fix") [[diff]](/attachment.cgi?id=740090&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=863935&attachment=740090)
fix
I still think we should fix this.
[Attachment #740090](/attachment.cgi?id=740090&action=edit "fix") -
Flags: review?(fantasai.bugs) → review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=863935#c9)• 12 years ago |
|  | |

Comment on [attachment 740090](/attachment.cgi?id=740090 "fix") [[details]](/attachment.cgi?id=740090&action=edit "fix") [[diff]](/attachment.cgi?id=740090&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=863935&attachment=740090)
fix
Review of [attachment 740090](/attachment.cgi?id=740090 "fix") [[details]](/attachment.cgi?id=740090&action=edit "fix") [[diff]](/attachment.cgi?id=740090&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=863935&attachment=740090):
-----------------------------------------------------------------
I'm rubber-stamping this.
[Attachment #740090](/attachment.cgi?id=740090&action=edit "fix") -
Flags: review?(roc) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=863935#a4463653_5168)• 12 years ago |

Blocks: [881090](/show_bug.cgi?id=881090 "RESOLVED DUPLICATE - use-after-poison in nsFrameList::FirstChild()")

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=863935#c10)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/48bbd10759f7>Flags: in-testsuite?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=863935#c11)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/48bbd10759f7>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla24

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=863935#c12)• 12 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #1](/show_bug.cgi?id=863935#c1 "RESOLVED FIXED - Use-after-poison in nsFrameList::UnhookFrameFromSiblings with moz-column"))
> Security-sensitive in case this is a long-standing bug revealed by bug
> 729519.
This means 22 and 23 are affected by this and would, ideally, have the fix ported to them, right?
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=863935#c13)• 12 years ago |
|  | |

[Bug 729519](/show_bug.cgi?id=729519 "RESOLVED FIXED - Allocate heap nsFrameLists from the pres shell arena") was fixed in 22 so this crash is mitigated by arena poisoning
from that version, so it's not necessary to uplift this IMO.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=863935#c14)• 12 years ago |
|  | |

Same for 23?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=863935#c15)• 12 years ago |
|  | |

Yes, 22 and all later versions.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=863935#a4731530_280903)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → ---
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → ---

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=863935#a10883520_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=863935#a17374893_1689)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=863935#c17)• 10 years ago |
|  | |

Landed a crashtest:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/c4e37220caed>Group: core-securityFlags: in-testsuite? → in-testsuite+

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=863935#c18)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/c4e37220caed>
You need to [log in](/show_bug.cgi?id=863935&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_0479ca2e_20250125_154612.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2013-76

## Miscellaneous memory safety hazards (rv:24.0 / rv:17.0.9)

Announced
September 17, 2013
Reporter
Mozilla Developers
Impact
Critical
Products
Firefox, Firefox ESR, SeaMonkey, Thunderbird, Thunderbird ESR
Fixed in

* Firefox 24
* Firefox ESR 17.0.9
* SeaMonkey 2.21
* Thunderbird 24
* Thunderbird ESR 17.0.9

### Description

Mozilla developers identified and fixed several memory safety bugs in the
browser engine used in Firefox and other Mozilla-based products. Some of these
bugs showed evidence of memory corruption under certain circumstances, and we
presume that with enough effort at least some of these could be exploited to run
arbitrary code.

In general these flaws cannot be exploited through email in the
Thunderbird product because scripting is disabled, but are potentially a risk in
browser or browser-like contexts.

### References

André Bargull, Scoobidiver, Bobby Holley, and Reuben Morais reported memory safety problems and
crashes that affect Firefox ESR 17, and Firefox 23.

* [Memory safety bugs fixed in Firefox 17.0.9 and Firefox 24.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=901351,899022,897676,889193) ([CVE-2013-1718](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1718))

Christian Holler, Makoto Kato, Jesse Ruderman, Jason Smith, Jan de Mooij,
Gary Kwong, Scoobidiver, Olli Pettay, Bobby Holley, and Bob Clary reported memory
safety problems and crashes that affect Firefox 23.

* [Memory safety bugs fixed in Firefox 24.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=750932,871462,847606,863935,893519,895294,876878,898381,896126,898832,873073,854897,851982,883450,909494) ([CVE-2013-1719](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1719))

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_2c759eea_20250125_154637.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/909494)
* [XML](/show_bug.cgi?ctype=xml&id=909494)

Closed
[Bug 909494](/show_bug.cgi?id=909494)

Opened 11 years ago
Closed 11 years ago

# Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla26

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox26 | [+](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 |  | wontfix |
| firefox24 | + | fixed |
| firefox25 | + | fixed |
| firefox26 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: sunfish)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d0f20c3888e5ac206b6ede4d4dc5c2ce?d=mm&size=40)  [sunfish](/user_profile?user_id=468136)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/d0f20c3888e5ac206b6ede4d4dc5c2ce?d=mm&size=40)  [sunfish](/user_profile?user_id=468136)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[841666](/show_bug.cgi?id=841666 "RESOLVED FIXED - IonMonkey: Support double exponent range analysis for multiplication truncation."), [908867](/show_bug.cgi?id=908867 "RESOLVED DUPLICATE - Crash with SIGTRAP involving --ion-eager --ion-gvn=off --ion-check-range-analysis")

Dependency [tree](/showdependencytree.cgi?id=909494&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=909494)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[908867](/show_bug.cgi?id=908867 "RESOLVED DUPLICATE - Crash with SIGTRAP involving --ion-eager --ion-gvn=off --ion-check-range-analysis")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [jsbugmon:][adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:][adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [bug908867.patch](/attachment.cgi?id=797333)  [11 years ago](#c4)  [Dan Gohman [:sunfish]](/user_profile?user_id=468136)   2.32 KB, patch | nbp : [review+](#c7 "11 years ago") | [Details](/attachment.cgi?id=797333&action=edit) | [Diff](/attachment.cgi?id=797333&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797333) |
| --- | --- | --- |
| [aurora.patch](/attachment.cgi?id=797549)  [11 years ago](#c12)  [Dan Gohman [:sunfish]](/user_profile?user_id=468136)   1.20 KB, patch | bajaj : [approval-mozilla-aurora+](#a348110_448925 "11 years ago")  abillings : [sec-approval+](#a344238_280903 "11 years ago") | [Details](/attachment.cgi?id=797549&action=edit) | [Diff](/attachment.cgi?id=797549&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797549) |
| [beta.patch](/attachment.cgi?id=797580)  [11 years ago](#c15)  [Dan Gohman [:sunfish]](/user_profile?user_id=468136)   913 bytes, patch | bajaj : [approval-mozilla-beta+](#c35 "11 years ago") | [Details](/attachment.cgi?id=797580&action=edit) | [Diff](/attachment.cgi?id=797580&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797580) |
| [release.patch](/attachment.cgi?id=797586)  [11 years ago](#c16)  [Dan Gohman [:sunfish]](/user_profile?user_id=468136)   1000 bytes, patch | abillings : [approval-mozilla-release-](#c29 "11 years ago") | [Details](/attachment.cgi?id=797586&action=edit) | [Diff](/attachment.cgi?id=797586&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797586) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=909494#c0)• 11 years ago |
|  | |

The following testcase crashes on mozilla-central revision 4887845b1142 (threadsafe build, run with --fuzzing-safe --ion-check-range-analysis):
assertArraySeqParResultsEq(range(0, 1024), "filter", function(e, i) { return (i % (1.1)) != 0; });
function range(n, m) {
var result = [];
for (var i = n; i < m; i++)
result.push(i);
return result;
}
function assertArraySeqParResultsEq(arr, op, func) {
arr[op].apply(arr, [func]);
}

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a94_395101)• 11 years ago |

Whiteboard: [jsbugmon:update,bisect]

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=909494#c1)• 11 years ago |
|  | |

This bug is very similar to [bug 908867](/show_bug.cgi?id=908867 "RESOLVED DUPLICATE - Crash with SIGTRAP involving --ion-eager --ion-gvn=off --ion-check-range-analysis"). In this case, it's the rhs being "decimal" that's causing the problem. Both will be fixed in the same patch, as soon as I get approval to submit it.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a4221_395101)• 11 years ago |

Whiteboard: [jsbugmon:update,bisect] → [jsbugmon:bisect]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=909494#c2)• 11 years ago |
|  | |

JSBugMon: Cannot process bug: Unable to automatically reproduce, please track manually.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a7335_395101)• 11 years ago |

Whiteboard: [jsbugmon:bisect] → [jsbugmon:]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a164338_406194)• 11 years ago |

Status: NEW → RESOLVEDClosed: 11 years agoResolution: --- → DUPLICATE

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=909494#c4)• 11 years ago |
|  | |

Attached patch

[bug908867.patch](attachment.cgi?id=797333&action=diff)
— [Details](attachment.cgi?id=797333&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797333)

The "foo" function in the testcase doesn't actually reproduce the bug yet, but it will once some other range analysis enhancements land.
[Attachment #797333](/attachment.cgi?id=797333&action=edit "bug908867.patch") -
Flags: review?(nicolas.b.pierron)

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a250072_422187)• 11 years ago |

Status: RESOLVED → REOPENEDResolution: DUPLICATE → ---

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=909494#c6)• 11 years ago |
|  | |

Inherit tracking flags from [Bug 908867](/show_bug.cgi?id=908867 "RESOLVED DUPLICATE - Crash with SIGTRAP involving --ion-eager --ion-gvn=off --ion-check-range-analysis").
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=unaffected)
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=909494#c7)• 11 years ago |
|  | |

Comment on [attachment 797333](/attachment.cgi?id=797333 "bug908867.patch") [[details]](/attachment.cgi?id=797333&action=edit "bug908867.patch") [[diff]](/attachment.cgi?id=797333&action=diff "bug908867.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797333)
[bug908867](/show_bug.cgi?id=908867 "RESOLVED DUPLICATE - Crash with SIGTRAP involving --ion-eager --ion-gvn=off --ion-check-range-analysis").patch
Review of [attachment 797333](/attachment.cgi?id=797333 "bug908867.patch") [[details]](/attachment.cgi?id=797333&action=edit "bug908867.patch") [[diff]](/attachment.cgi?id=797333&action=diff "bug908867.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797333):
-----------------------------------------------------------------
Be aware that this is changing a line introduce in Gecko 25, as part of [Bug 897747](/show_bug.cgi?id=897747 "RESOLVED FIXED - IonMonkey: Incorrect result with MMod range analysis"), as opposed to what the tracking flags inherited from [Bug 908867](/show_bug.cgi?id=908867 "RESOLVED DUPLICATE - Crash with SIGTRAP involving --ion-eager --ion-gvn=off --ion-check-range-analysis") mention.
As you will have to backport you should land the test case separately once the patch landed on both inbound & aurora.
[Attachment #797333](/attachment.cgi?id=797333&action=edit "bug908867.patch") -
Flags: review?(nicolas.b.pierron) → review+

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a251115_422187)• 11 years ago |

Blocks: [908867](/show_bug.cgi?id=908867 "RESOLVED DUPLICATE - Crash with SIGTRAP involving --ion-eager --ion-gvn=off --ion-check-range-analysis")
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=unaffected)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=unaffected) → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=909494#c8)• 11 years ago |
|  | |

In fact, I think the bug might even come from [Bug 841666](/show_bug.cgi?id=841666 "RESOLVED FIXED - IonMonkey: Support double exponent range analysis for multiplication truncation.") which accepted the specialization of MMod compute range with doubles without paying attention to the bounds of the range previously made on Integers.

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=909494#c9)• 11 years ago |
|  | |

Fix on trunk:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/b6412dc95e7f>
Testcase on trunk:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/c0e80bbe50fb>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=909494#c10)• 11 years ago |
|  | |

This should not have been landed with a security rating followed by sec-approval since this affects multiple branches. Please see <https://wiki.mozilla.org/Security/Bug_Approval_Process> for the process for security bugs.
We definitely shouldn't have landed any tests at this time.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=909494#c11)• 11 years ago |
|  | |

[Bug 841666](/show_bug.cgi?id=841666 "RESOLVED FIXED - IonMonkey: Support double exponent range analysis for multiplication truncation.") landed on Firefox 22, so this likely affects 23 and 24 too.
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=unaffected) → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=909494#c12)• 11 years ago |
|  | |

Attached patch

[aurora.patch](attachment.cgi?id=797549&action=diff)
— [Details](attachment.cgi?id=797549&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797549)

I apologize for my mistake. I will take more care to follow the process in the future.
Attached is a patch which contains the fix for aurora. I'll backport the fix to firefox23 and firefox24 next and attach the patches to this bug. I'll wait for further instructions before checking anything in.

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=909494#c13)• 11 years ago |
|  | |

The risk seems to be that we could have a off-by-less-than-one which can be scale to any magnitude with a multiplication and later truncated to get an offset.
Hopefully, (I really feel released by reading the code carefully) there is no way that we would remove a bound check around an array if we have a modulo as an operand of the array. So this bug cannot be sec-critical.
Marty: Can you confirm that I read the code correctly?Flags: needinfo?(mrosenberg)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=909494#c14)• 11 years ago |
|  | |

The patch that introduced the --ion-check-range-analysis flag also included fixes for several pre-existing range analysis bugs, at least one of which goes back to 6688ede89a36 ([bug 699883](/show_bug.cgi?id=699883 "RESOLVED FIXED - IonMonkey: Implement range analysis")). Is it important to backport these other fixes as well?Flags: needinfo?

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=909494#c15)• 11 years ago |
|  | |

Attached patch

[beta.patch](attachment.cgi?id=797580&action=diff)
— [Details](attachment.cgi?id=797580&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797580)

This is the backport to mozilla-beta. I also fixed the "1-a" expression, to make the code work more like the code on trunk.

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=909494#c16)• 11 years ago |
|  | |

Attached patch

[release.patch](attachment.cgi?id=797586&action=diff)
— [Details](attachment.cgi?id=797586&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797586)

Here's the mozilla-release patch. It's the same as the mozilla-beta patch except that in mozilla-release, the "ion" directory has not yet been renamed to "jit", and some of the patch context is different.

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=909494#c17)• 11 years ago |
|  | |

(In reply to Dan Gohman [:sunfish] from [comment #14](/show_bug.cgi?id=909494#c14 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> The patch that introduced the --ion-check-range-analysis flag also included
> fixes for several pre-existing range analysis bugs, at least one of which
> goes back to 6688ede89a36 ([bug 699883](/show_bug.cgi?id=699883 "RESOLVED FIXED - IonMonkey: Implement range analysis")). Is it important to backport these
> other fixes as well?
I think we should consider any patch which manipulate operations which can be interpreted in a LinearSum, as they are used for removing bound checks.
So probably any fix on range analysis of MAdd, MSub and MMul.

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=909494#c18)• 11 years ago |
|  | |

(In reply to Nicolas B. Pierron [:nbp] from [comment #17](/show_bug.cgi?id=909494#c17 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> (In reply to Dan Gohman [:sunfish] from [comment #14](/show_bug.cgi?id=909494#c14 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> > The patch that introduced the --ion-check-range-analysis flag also included
> > fixes for several pre-existing range analysis bugs, at least one of which
> > goes back to 6688ede89a36 ([bug 699883](/show_bug.cgi?id=699883 "RESOLVED FIXED - IonMonkey: Implement range analysis")). Is it important to backport these
> > other fixes as well?
>
> I think we should consider any patch which manipulate operations which can
> be interpreted in a LinearSum, as they are used for removing bound checks.
>
> So probably any fix on range analysis of MAdd, MSub and MMul.
The ranges of MAdd, MSub, and MMul are computed in terms of the ranges of their operands, which could be any operator, so if the range analysis for those operators matters, doesn't that mean that any operator matters?

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=909494#c19)• 11 years ago |
|  | |

(In reply to Dan Gohman [:sunfish] from [comment #18](/show_bug.cgi?id=909494#c18 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> (In reply to Nicolas B. Pierron [:nbp] from [comment #17](/show_bug.cgi?id=909494#c17 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> > (In reply to Dan Gohman [:sunfish] from [comment #14](/show_bug.cgi?id=909494#c14 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> > > The patch that introduced the --ion-check-range-analysis flag also included
> > > fixes for several pre-existing range analysis bugs, at least one of which
> > > goes back to 6688ede89a36 ([bug 699883](/show_bug.cgi?id=699883 "RESOLVED FIXED - IonMonkey: Implement range analysis")). Is it important to backport these
> > > other fixes as well?
> >
> > I think we should consider any patch which manipulate operations which can
> > be interpreted in a LinearSum, as they are used for removing bound checks.
> >
> > So probably any fix on range analysis of MAdd, MSub and MMul.
>
> The ranges of MAdd, MSub, and MMul are computed in terms of the ranges of
> their operands, which could be any operator, so if the range analysis for
> those operators matters, doesn't that mean that any operator matters?
The only case that I see so far would be to get through the lowering of MBoundsCheckLower [0] which is created by tryHoistBoundsCheck[1], which use jit::ExtractLinearSum [2], which expects to see MAdd, MSub and constants (not even MMul).
[0] <http://dxr.mozilla.org/mozilla-central/source/js/src/jit/Lowering.cpp#l2001>
<http://dxr.mozilla.org/mozilla-central/source/js/src/jit/MIR.cpp#l2213>
[1] <http://dxr.mozilla.org/mozilla-central/source/js/src/jit/RangeAnalysis.cpp#l1530>
[2] <http://dxr.mozilla.org/mozilla-central/source/js/src/jit/IonAnalysis.cpp#l1105>

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=909494#c20)• 11 years ago |
|  | |

(In reply to Nicolas B. Pierron [:nbp] from [comment #19](/show_bug.cgi?id=909494#c19 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> The only case that I see so far would be to get through the lowering of
> MBoundsCheckLower [0] which is created by tryHoistBoundsCheck[1], which use
> jit::ExtractLinearSum [2], which expects to see MAdd, MSub and constants
> (not even MMul).
Ah, and it doesn't appear to actually use the range() from the MAdd or MSub; it just uses the symbolicLower() and symbolicUpper(). And the "range()->lower() < minimum\_" check in MBoundsCheckLower::fallible() [0] is actually unreachable, because MBoundsCheckLower objects are never assigned a range. Tricky.
However, mozilla-aurora for example has the MinMaxD optimization which disables a NaN check if range analysis says the operands aren't NaN [1]. Looking at that code with this bug in mind, it seems like it could theoretically be subverted to significant ends.
[0] <http://dxr.mozilla.org/mozilla-central/source/js/src/jit/MIR.cpp#l2213>
[1] <http://dxr.mozilla.org/mozilla-central/source/js/src/jit/shared/CodeGenerator-x86-shared.cpp#l385>
I'm not familiar with all of the ways range analysis is used, so I don't know that there aren't other problems too. Consequently, I went and created backported patches of the dynamic range checking (--ion-check-range-analysis) to mozilla-aurora, mozilla-beta, and mozilla-release, and patches backporting all the fixes for bugs that the checking turns up on jit\_tests.py and jstests.py, for each of those trees. Let me know if you'd like me to attach these patches to this bug.

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=909494#c21)• 11 years ago |
|  | |

(In reply to Nicolas B. Pierron [:nbp] from [comment #13](/show_bug.cgi?id=909494#c13 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> The risk seems to be that we could have a off-by-less-than-one which can be
> scale to any magnitude with a multiplication and later truncated to get an
> offset.
>
> Hopefully, (I really feel released by reading the code carefully) there is
> no way that we would remove a bound check around an array if we have a
> modulo as an operand of the array. So this bug cannot be sec-critical.
>
> Marty: Can you confirm that I read the code correctly?
Yes, we can get an arbitrary amount above the range that we've calculated, but we can only get a double range. Won't we need to have an explicit conversion to integer? I don't see any range calculation for a double -> integer conversion.

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=909494#c22)• 11 years ago |
|  | |

(In reply to Marty Rosenberg [:mjrosenb] from [comment #21](/show_bug.cgi?id=909494#c21 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> (In reply to Nicolas B. Pierron [:nbp] from [comment #13](/show_bug.cgi?id=909494#c13 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> > The risk seems to be that we could have a off-by-less-than-one which can be
> > scale to any magnitude with a multiplication and later truncated to get an
> > offset.
> >
> > Hopefully, (I really feel released by reading the code carefully) there is
> > no way that we would remove a bound check around an array if we have a
> > modulo as an operand of the array. So this bug cannot be sec-critical.
> >
> > Marty: Can you confirm that I read the code correctly?
>
> Yes, we can get an arbitrary amount above the range that we've calculated,
> but we can only get a double range. Won't we need to have an explicit
> conversion to integer? I don't see any range calculation for a double ->
> integer conversion.
Yes, we would need a truncate before writing to / reading from any array. My worry is about removing bounds check. If we are ever able to remove a bound check, then we can overflow or underflow the buffer (which would be a way easier exploit).
One of the thing I was thinking of something like:
arr[((-1 % 0.5) \* 2 \* 8) | 0] = 0x7fffffff; // map all memory in this array
But hopefully this case is not supported as described in [comment 19](/show_bug.cgi?id=909494#c19 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis").

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=909494#c23)• 11 years ago |
|  | |

(In reply to Dan Gohman [:sunfish] from [comment #15](/show_bug.cgi?id=909494#c15 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis"))
> Created [attachment 797580](/attachment.cgi?id=797580 "beta.patch") [[details]](/attachment.cgi?id=797580&action=edit "beta.patch") [[diff]](/attachment.cgi?id=797580&action=diff "beta.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797580)
> beta.patch
If your patches are ready, you should ask for approval. Look at the attachement details.

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=909494#c24)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/c0e80bbe50fb>
<https://hg.mozilla.org/mozilla-central/rev/b6412dc95e7f>Status: REOPENED → RESOLVEDClosed: 11 years ago → 11 years ago
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed)Flags: needinfo?QA Contact: general → sunfishResolution: --- → FIXEDTarget Milestone: --- → mozilla26

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=909494#c25)• 11 years ago |
|  | |

Comment on [attachment 797549](/attachment.cgi?id=797549 "aurora.patch") [[details]](/attachment.cgi?id=797549&action=edit "aurora.patch") [[diff]](/attachment.cgi?id=797549&action=diff "aurora.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797549)
aurora.patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): 909494
User impact if declined: See [bug 909494](/show_bug.cgi?id=909494 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis")
Testing completed (on m-c, etc.): The patch is green on m-c.
Risk to taking this patch (and alternatives if risky):
It seems low. The patch is small and simple, and there are no known complications.
String or IDL/UUID changes made by this patch:
None.
[Attachment #797549](/attachment.cgi?id=797549&action=edit "aurora.patch") -
Flags: approval-mozilla-aurora?

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=909494#c26)• 11 years ago |
|  | |

Comment on [attachment 797580](/attachment.cgi?id=797580 "beta.patch") [[details]](/attachment.cgi?id=797580&action=edit "beta.patch") [[diff]](/attachment.cgi?id=797580&action=diff "beta.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797580)
beta.patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): 909494
User impact if declined: See [bug 909494](/show_bug.cgi?id=909494 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis")
Testing completed (on m-c, etc.): The patch is green on m-c.
Risk to taking this patch (and alternatives if risky):
It seems low. The patch is small and simple, and there are no known complications.
String or IDL/UUID changes made by this patch:
None.
[Attachment #797580](/attachment.cgi?id=797580&action=edit "beta.patch") -
Flags: approval-mozilla-beta?

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=909494#c27)• 11 years ago |
|  | |

Comment on [attachment 797586](/attachment.cgi?id=797586 "release.patch") [[details]](/attachment.cgi?id=797586&action=edit "release.patch") [[diff]](/attachment.cgi?id=797586&action=diff "release.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797586)
release.patch
[Approval Request Comment]
Regression caused by (bug #): 909494
User impact if declined: See [bug 909494](/show_bug.cgi?id=909494 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis")
Testing completed (on m-c, etc.): The patch is green on m-c.
Risk to taking this patch (and alternatives if risky):
It seems low. The patch is small and simple, and there are no known complications.
String or IDL/UUID changes made by this patch:
None.
[Attachment #797586](/attachment.cgi?id=797586&action=edit "release.patch") -
Flags: approval-mozilla-release?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=909494#c28)• 11 years ago |
|  | |

This is a security bug that is rated "sec-high" that affects more than trunk. Before branches can be approved, someone needs to mark this sec-approval? and fill out the template.
Just because this got checked in incorrectly without sec-approval doesn't mean we shouldn't still answer the questions. It helps us determine whether to take it on branches (though, since it is public, effectively, I'm inclined to do so).
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F)
[tracking-firefox26](/buglist.cgi?f1=cf_tracking_firefox26&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=909494#c29)• 11 years ago |
|  | |

Comment on [attachment 797586](/attachment.cgi?id=797586 "release.patch") [[details]](/attachment.cgi?id=797586&action=edit "release.patch") [[diff]](/attachment.cgi?id=797586&action=diff "release.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797586)
release.patch
We're not going to take this on release branch.
The question right now is Aurora and Beta.
[Attachment #797586](/attachment.cgi?id=797586&action=edit "release.patch") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=909494#c30)• 11 years ago |
|  | |

Comment on [attachment 797549](/attachment.cgi?id=797549 "aurora.patch") [[details]](/attachment.cgi?id=797549&action=edit "aurora.patch") [[diff]](/attachment.cgi?id=797549&action=diff "aurora.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797549)
aurora.patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
It's not trivial. The available testcases don't trigger the bug in release builds, as they rely on the --ion-check-range-analysis debug flag. A few different people have looked at this bug and have not been able to construct a testcase which actually exploits the bug. That doesn't necessarily mean it's impossible, of course.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
The bug itself is pretty obvious in the patch, but it takes some creativity to connect the bug with the right circumstances to make this security-relevant.
Which older supported branches are affected by this flaw?
Releases back to Firefox 23 contain the bug.
If not all supported branches, which bug introduced the flaw?
The flaw was introduced in [bug 841666](/show_bug.cgi?id=841666 "RESOLVED FIXED - IonMonkey: Support double exponent range analysis for multiplication truncation.").
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Yes. Attached to [bug 909494](/show_bug.cgi?id=909494 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis") are backports for all affected branches.
How likely is this patch to cause regressions; how much testing does it need?
It is very unlikely to cause regressions. The patch is small and uncomplicated, and probably does not need any testing beyond what would be done for any patch.
[Attachment #797549](/attachment.cgi?id=797549&action=edit "aurora.patch") -
Flags: sec-approval?

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=909494#c31)• 11 years ago |
|  | |

I created [bug 911320](/show_bug.cgi?id=911320 "RESOLVED WONTFIX") to track the patches which backport --ion-check-range-analysis and associated bug fixes to all the various branches.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=909494#c32)• 11 years ago |
|  | |

Thanks. We should probably take this on Beta and Aurora.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a344238_280903)• 11 years ago |

[Attachment #797549](/attachment.cgi?id=797549&action=edit "aurora.patch") -
Flags: sec-approval? → sec-approval+

|  | [Dan Gohman [:sunfish]](/user_profile?user_id=468136)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=909494#c33)• 11 years ago |
|  | |

Do you want me to check the patch into Beta and Aurora now, or should I wait for the branch approvals?Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=909494#c34)• 11 years ago |
|  | |

Please wait for specific branch approvals.Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a346702_280903)• 11 years ago |

Flags: needinfo?(release-mgmt)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a347992_448925)• 11 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=909494#c35)• 11 years ago |
|  | |

Comment on [attachment 797580](/attachment.cgi?id=797580 "beta.patch") [[details]](/attachment.cgi?id=797580&action=edit "beta.patch") [[diff]](/attachment.cgi?id=797580&action=diff "beta.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=909494&attachment=797580)
beta.patch
Given the cat is out the bag already, and the looks safe and contained.
Also discussed with :nbp and confirmed this area has enough tests, so approving on branches.If there is anyways QA can help in additional verification please add verifyme with more details.
[Attachment #797580](/attachment.cgi?id=797580&action=edit "beta.patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a348110_448925)• 11 years ago |

[Attachment #797549](/attachment.cgi?id=797549&action=edit "aurora.patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a348127_448925)• 11 years ago |

Flags: needinfo?(release-mgmt)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=909494#c36)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/9dd5f0e7f716>
<https://hg.mozilla.org/releases/mozilla-beta/rev/2a52a96cb0c6>
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a1732810_1689)• 11 years ago |

Assignee: general → sunfishBlocks: [841666](/show_bug.cgi?id=841666 "RESOLVED FIXED - IonMonkey: Support double exponent range analysis for multiplication truncation.")
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: [jsbugmon:] → [jsbugmon:][adv-main24+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=909494#a38908273_1689)• 10 years ago |

Group: core-security

|  | [Sean Stangl [:sstangl]](/user_profile?user_id=383201) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=909494#c37)• 10 years ago |
|  | |

Clearing old needinfo.Flags: needinfo?(marty.rosenberg)
You need to [log in](/show_bug.cgi?id=909494&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Dan Gohman [:sunfish]](/user_profile?user_id=468136)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_04c02c81_20250125_154619.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/854897)
* [XML](/show_bug.cgi?ctype=xml&id=854897)

Closed
[Bug 854897](/show_bug.cgi?id=854897)

Opened 12 years ago
Closed 11 years ago

# Medium exploitable crash [@ IndicShape] with EXCEPTION\_STACK\_BUFFER\_OVERRUN [WinXP]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Medium exploitable crash [@ IndicShape] with EXCEPTION\_STACK\_BUFFER\_OVERRUN [WinXP]

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

18 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla26

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | [-](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) |
| firefox22 | [-](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [-](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox26 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed) |
| firefox-esr17 | [24+](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=24%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |
| b2g-v1.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | - | wontfix |
| firefox22 | - | wontfix |
| firefox23 | - | wontfix |
| firefox24 | + | fixed |
| firefox25 | + | fixed |
| firefox26 |  | fixed |
| firefox-esr17 | 24+ | wontfix |
| b2g18 |  | unaffected |
| b2g-v1.2 |  | unaffected |
| b2g-v1.3 |  | unaffected |
| b2g-v1.4 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bc, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=40)  [mwobensmith](/user_profile?user_id=452604)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

### ( [URL](http://www.quraneralo.com/our-duties-towards-sahabah/ "http://www.quraneralo.com/our-duties-towards-sahabah/") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[797405](/show_bug.cgi?id=797405 "VERIFIED FIXED - use harfbuzz for all text shaping on Windows")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=854897&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=854897)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[quraneralo.com/our-duties-towards-sah...](http://www.quraneralo.com/our-duties-towards-sahabah/ "http://www.quraneralo.com/our-duties-towards-sahabah/")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [adv-main24+][MSRC case 14349st -- keep hidden until MS is clear too])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+][MSRC case 14349st -- keep hidden until MS is clear too]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ IndicShape(HDC\_\_\*, void\*\*, unsigned short const\*, int, int, tag\_SCRIPT\_ANALYSIS\*, unsigned short\*, unsigned short\*, tag\_SCRIPT\_VISATTR\*, int\*) ]](https://crash-stats.mozilla.org/signature/?signature=IndicShape%28HDC__%2A%2C%20void%2A%2A%2C%20unsigned%20short%20const%2A%2C%20int%2C%20int%2C%20tag_SCRIPT_ANALYSIS%2A%2C%20unsigned%20short%2A%2C%20unsigned%20short%2A%2C%20tag_SCRIPT_VISATTR%2A%2C%20int%2A%29)

[

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [testcase](/attachment.cgi?id=729675)  [12 years ago](#c1)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   899 bytes, text/html |  | [Details](/attachment.cgi?id=729675&action=edit) |
| --- | --- | --- |
| [testcase2](/attachment.cgi?id=729878)  [12 years ago](#c4)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   467 bytes, text/html |  | [Details](/attachment.cgi?id=729878&action=edit) |
| [testcase2](/attachment.cgi?id=729882)  [12 years ago](#c5)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   169 bytes, text/html |  | [Details](/attachment.cgi?id=729882&action=edit) |
| [result of opening testcase2 with IE8 on WinXP](/attachment.cgi?id=730113)  [12 years ago](#c6)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   86.45 KB, image/png |  | [Details](/attachment.cgi?id=730113&action=edit) |
| [prefer harfbuzz shaping for Indic text on WinXP](/attachment.cgi?id=766471)  [12 years ago](#c23)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   4.38 KB, patch | jtd : [review+](#c49 "12 years ago")  lsblakk : [approval-mozilla-aurora+](#a12014399_272375 "11 years ago")  lsblakk : [approval-mozilla-beta+](#a12014399_272375 "11 years ago")  abillings : [sec-approval+](#c51 "11 years ago") | [Details](/attachment.cgi?id=766471&action=edit) | [Diff](/attachment.cgi?id=766471&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=854897&attachment=766471) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=854897#c0)• 12 years ago |
|  | |

1. <http://www.quraneralo.com/our-duties-towards-sahabah/> on Windows XP Firefox 18, Beta/20, Aurora/21, Nightly/22.
Crash opt:
[@ IndicShape(HDC\_\_\*, void\*\*, unsigned short const\*, int, int, tag\_SCRIPT\_ANALYSIS\*, unsigned short\*, unsigned short\*, tag\_SCRIPT\_VISATTR\*, int\*) ]
0 usp10.dll IndicShape
1 xul.dll gfxUniscribeShaper::ShapeText gfx/thebes/gfxUniscribeShaper.cpp:490
2 xul.dll gfxShapedText::SetupClusterBoundaries gfx/thebes/gfxFont.cpp:4557
3 mozalloc.dll moz\_xrealloc memory/mozalloc/mozalloc.cpp:86
4 xul.dll gfxFontGroup::InitScriptRun<wchar\_t> gfx/thebes/gfxFont.cpp:3951
5 xul.dll gfxScriptItemizer::Next gfx/thebes/gfxScriptItemizer.cpp:228
exploitability: medium
EXCEPTION\_STACK\_BUFFER\_OVERRUN
[bp-2008e109-b8ca-43d3-9acd-32b332130326](https://crash-stats.mozilla.org/report/index/2008e109-b8ca-43d3-9acd-32b332130326)
[bp-905e95fe-e369-4cdf-89f7-4bc302130326](https://crash-stats.mozilla.org/report/index/905e95fe-e369-4cdf-89f7-4bc302130326)
Crash debug:
usp10.dll@0x31a31 gfxUniscribeShaper::ShapeText nsAutoTArray<gfxShapedText::DetailedGlyph, int>::~nsAutoTArray<gfxShapedText::DetailedGlyph, int> gfxHarfBuzzShaper::SetGlyphsFromRun
exploitability: medium
EXCEPTION\_STACK\_BUFFER\_OVERRUN

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=854897#c1)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=729675)
— [Details](attachment.cgi?id=729675&action=edit)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a13861_23402)• 12 years ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=854897#c2)• 12 years ago |
|  | |

I'm guessing there's a single word in that testcase that is sufficient to trigger the crash - any chance you could isolate it?

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=854897#c3)• 12 years ago |
|  | |

sure. brb.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=854897#c4)• 12 years ago |
|  | |

Attached file
[testcase2](attachment.cgi?id=729878) (obsolete)
— [Details](attachment.cgi?id=729878&action=edit)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=854897#c5)• 12 years ago |
|  | |

Attached file
[testcase2](attachment.cgi?id=729882)
— [Details](attachment.cgi?id=729882&action=edit)

without cruft.
[Attachment #729878](/attachment.cgi?id=729878&action=edit "testcase2") -
Attachment is obsolete: true

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=854897#c6)• 12 years ago |
|  | |

Attached image
[result of opening testcase2 with IE8 on WinXP](attachment.cgi?id=730113)
— [Details](attachment.cgi?id=730113&action=edit)

It may not be much comfort, but FWIW the testcase also crashes Internet Explorer just as readily - see screenshot.
This looks like a Uniscribe bug, and I don't think we can realistically do much to work around it except switch Indic shaping on Windows (at least on XP - does Vista or Win7's version of Uniscribe also crash?) over to harfbuzz. Note that if you set gfx.font\_rendering.harfbuzz.scripts to -1, it will no longer crash.
I've been reluctant to make that switch until we have more extensive and automated regression testing in place for the harfbuzz Indic shaper, as there's the possibility that it could regress shaping behavior for some fonts. But this gives us some extra incentive to move forward there.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=854897#c7)• 12 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #6](/show_bug.cgi?id=854897#c6 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> does Vista or Win7's version of Uniscribe also crash?
In crash automation I test 32bit builds on winxp and win7 32bit and 64bit. Only xp crashed. I do have Vista locally as a virtualbox vm. I'll try to test that later today.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=854897#c8)• 12 years ago |
|  | |

To test this on vista or win7, you'll need to ensure that hardware acceleration is -not- enabled; otherwise Indic shaping will go via directwrite rather than uniscribe, so you may not run into the issue. Does win7 crash with hw/acc disabled?

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=854897#c9)• 12 years ago |
|  | |

My vms are vanilla VMware ESXi. I don't believe they have any hardware acceleration available. I have some virtualbox vms that I might be able to toggle acceleration. I'll get to that later today.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=854897#c10)• 12 years ago |
|  | |

I did not crash with either Vista or Win7.
dveditz: re [comment 6](/show_bug.cgi?id=854897#c6 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"): can we contact Microsoft about this?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=854897#c11)• 12 years ago |
|  | |

I don't know why a plain stack buffer overflow wouldn't be fully exploitable.
Yeah, I'll contact MS.Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a714366_1689)• 12 years ago |

Summary: Medium exploitable crash [@ IndicShape] with EXCEPTION\_STACK\_BUFFER\_OVERRUN → Medium exploitable crash [@ IndicShape] with EXCEPTION\_STACK\_BUFFER\_OVERRUN [WinXP]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=854897#c12)• 12 years ago |
|  | |

Microsoft is tracking this as "case 14349st" (the "st" apparently refers to the case manager Stephen). Please don't unhide this bug even after our fix until we check with them.Whiteboard: [MSRC case 14349st -- keep hidden until MS is clear too]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a796120_1689)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=854897#c13)• 12 years ago |
|  | |

Just reproduced on Windows XP using the public url
[bp-15531d08-5cd0-4412-ac32-af92d2130418](https://crash-stats.mozilla.org/report/index/15531d08-5cd0-4412-ac32-af92d2130418)
[bp-cb996650-d5d5-4467-8627-921bf2130418](https://crash-stats.mozilla.org/report/index/cb996650-d5d5-4467-8627-921bf2130418)
stefin, is there anything else you need?

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a2085486_23402)• 12 years ago |

Flags: needinfo?(stefin)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=854897#c14)• 12 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #12](/show_bug.cgi?id=854897#c12 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> Microsoft is tracking this as "case 14349st" (the "st" apparently refers to
> the case manager Stephen). Please don't unhide this bug even after our fix
> until we check with them.
Do we want to track for our releases, even though it sounds like this won't be fixed in Firefox? Or are we waiting on MS investigation prior to assigning an engineer here?

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=854897#c15)• 12 years ago |
|  | |

This won't directly be "fixed" in Firefox, but it will be avoided when we switch the text back-end on Windows to harfbuzz for all scripts, thus bypassing Uniscribe shaping altogether ([bug 797405](/show_bug.cgi?id=797405 "VERIFIED FIXED - use harfbuzz for all text shaping on Windows")). That in turn is dependent on having sufficiently extensive testing in place ([bug 770591](/show_bug.cgi?id=770591 "RESOLVED WONTFIX - Continuous-testing HarfBuzz")).Depends on: [797405](/show_bug.cgi?id=797405 "VERIFIED FIXED - use harfbuzz for all text shaping on Windows")

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=854897#c16)• 12 years ago |
|  | |

Sounds like we don't need to track for upcoming releases for the time being, since this will require major change in [bug 797405](/show_bug.cgi?id=797405 "VERIFIED FIXED - use harfbuzz for all text shaping on Windows").
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=-)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=-)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=-)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F) → ---

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=854897#c17)• 12 years ago |
|  | |

Hi Jonathan do we have the harfbuzz bug roadmapped?
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)Flags: needinfo?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=854897#c18)• 12 years ago |
|  | |

Well - "roadmapped" is perhaps a bit too formal for the current state of things.
The actual change we need to make for Gecko in [bug 797405](/show_bug.cgi?id=797405 "VERIFIED FIXED - use harfbuzz for all text shaping on Windows") is trivial - it's just switching a pref. But before we do that, we'd like to have a \*really\* extensive test suite in place for complex-script shaping behavior.
Behdad and I have discussed this from time to time, gradually refining some ideas and tools to support the testing process, but we're not yet at the point of having an automated, adequately scalable setup.
([Bug 770591](/show_bug.cgi?id=770591 "RESOLVED WONTFIX - Continuous-testing HarfBuzz") was filed to track the testing issue, though I think it's possible we'll end up with the main shaping regression-test suite being run outside Mozilla's infrastructure, e.g. at Google instead.)Flags: needinfo?(jfkthame)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=854897#c19)• 12 years ago |
|  | |

If the only fix we're pursuing to resolve this bug is [bug 797405](/show_bug.cgi?id=797405 "VERIFIED FIXED - use harfbuzz for all text shaping on Windows"), then we won't track this bug for upcoming releases.
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=-)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=854897#c20)• 12 years ago |
|  | |

stefin,
any update on this from your end?
can you reproduce?
do you agree this is exploitable?
do you intend to fix this?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=854897#c21)• 12 years ago |
|  | |

Renominating this one because we need to fix it. Tracking a pref-flip bug seems unmotivated and I don't want to explain why we need it in a public bug. I also don't see any movement on the tests mentioned in [comment 18](/show_bug.cgi?id=854897#c18 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]") so we should just flip it and get real-world testing ASAP.
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=-) → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=854897#c22)• 12 years ago |
|  | |

Given that this issue is only on WinXP, not later Windows releases ([comment 10](/show_bug.cgi?id=854897#c10 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]")), I'd be reluctant to push a risky change to \*all\* Windows users in order to address it. Maybe we should look into switching XP users (only) from Uniscribe to HarfBuzz.
This would require a code-level patch, but it should be a trivial one - we already have code in the platform that checks the Windows version at runtime, so we'd just need to connect that to the code in gfxGDIFont::ShapeText that chooses which shaper backend to call.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=854897#c23)• 12 years ago |
|  | |

Attached patch

[prefer harfbuzz shaping for Indic text on WinXP](attachment.cgi?id=766471&action=diff)
— [Details](attachment.cgi?id=766471&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=854897&attachment=766471)

This should work to switch XP users to harfbuzz shaping (for Indic scripts), without affecting Win8/8 users. There's still a risk it could regress shaping behavior for specific fonts and/or text strings; harfbuzz has generally had more testing with newer (Win7) fonts than with the older XP versions, or with the mass of third-party fonts (of varying vintages) out there, which is why I'm hesitant to simply toggle the pan-Windows default in [bug 797405](/show_bug.cgi?id=797405 "VERIFIED FIXED - use harfbuzz for all text shaping on Windows") at this point. Tryserver run in progress at <https://tbpl.mozilla.org/?tree=Try&rev=8b1571105aa0>.
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: review?(jdaggett)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a7705525_329583)• 12 years ago |

Assignee: nobody → jfkthame

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=854897#c24)• 12 years ago |
|  | |

Oops. "...without affecting Win8/8 users" should of course refer to Win7/8.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=854897#c25)• 12 years ago |
|  | |

I think before landing this we should do proper triage on versions of the Uniscribe DLL to confirm that the OS version is the right way to classify this. Microsoft uses multiple update vectors to make changes to Uniscribe (e.g. Office, VOLT, Language Packs, Security Fixes, OS updates). I think it's possible that this bug may occur with a given flavor of Windows that is \*not\* strictly XP (e.g. early versions of Vista).
If the version of the Uniscribe DLL containing the problem \*only\* exists on XP than the logic in the patch makes sense. Otherwise we may need to use the Uniscribe DLL version instead.
For more information see:
<http://en.wikipedia.org/wiki/Uniscribe>

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=854897#c26)• 12 years ago |
|  | |

As far as I'm aware, it seems unlikely that significant numbers of users will be running \*older\* versions of Uniscribe than the default installed with their Windows platform, and thus remain vulnerable even though their OS version suggests they shouldn't be. Given that Bob reported that Vista did not crash, I think making the switch for WinXP only is a simple way to address the problem for the vast majority of affected users. It's admittedly a "broad brush" that will include users who have actually upgraded their Uniscribe and so don't really need the fix, but that's a minor issue.
It's true that the USP10.dll version would be a more accurate indicator of whether a given system may be vulnerable, but I'm not in a position to attempt that investigation. Do you have a collection of all the Uniscribe versions as distributed through these various channels?
Given that the simple approach here will resolve the issue for (at least!) the vast majority of affected users, I don't see much justification for spending more time on this.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=854897#c27)• 12 years ago |
|  | |

I think it should be a pretty simple process for a QA person with access to a MSDN subscription. Just download a smattering of the affected OS builds (e.g. WinXP SPx, Vista RC, Win7 RC), check the Uniscribe DLL version and see if the testcase crashes. With that info in hand we can then make the call as to whether a simple OS version check is sufficient.
Jet, maybe you can suggest someone to do this?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a7966048_448925)• 12 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a7986563_280585)• 12 years ago |

Flags: needinfo?(bugs)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a8053999_452604)• 12 years ago |

[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F)

|  | [Jet Villegas (inactive)](/user_profile?user_id=384647) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=854897#c28)• 12 years ago |
|  | |

I'm inclined to accelerate the migration to HarfBuzz for shaping these scripts.Flags: needinfo?(bugs)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=854897#c29)• 12 years ago |
|  | |

(In reply to Jet Villegas (:jet) from [comment #28](/show_bug.cgi?id=854897#c28 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> I'm inclined to accelerate the migration to HarfBuzz for shaping these
> scripts.
Jet, the question is whether the problem here is limited to XP or not. The patch uses the OS version number (i.e. XP or not) to decide whether to force on Harfbuzz shaping. But as you can see from the Wikipedia page for Uniscribe, the Uniscribe DLL is updated a lot. The question is whether there's a version of Uniscribe that shipped with early versions of OS's \*other\* than XP that would exhibit the problem.
What I'm asking for is a QA resource to do a more complete analysis of which versions of Uniscribe are affected by this bug to determine whether those versions are strictly limited to XP or not. If they are, then the patch is fine, otherwise we need to base the switch on the Uniscribe DLL version instead.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=854897#c30)• 12 years ago |
|  | |

Alternatively, we could
(1) take the existing patch for now, which addresses the issue for the large class of users that we -know- are affected;
(2) not worry much about the possibility that there -might- be other marginal affected populations (such as users on early Vista releases who have avoided updating their OS); if such cases do in fact exist, we (a) won't be making things any worse for them, and (b) can't really be held responsible for the fact that they've chosen to stay on a vulnerable OS version.
(3) focus efforts on the testing that will enable us to make the global switch for -all- users with confidence that we're not regressing behavior.

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=854897#c31)• 12 years ago |
|  | |

RE: QA resource. I've assigned myself as QA owner, but I may be recruiting Kamil Jozwiak for this task as well.QA Contact: mwobensmith

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=854897#c32)• 12 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #30](/show_bug.cgi?id=854897#c30 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> Alternatively, we could
>
> (1) take the existing patch for now, which addresses the issue for the large
> class of users that we -know- are affected;
>
> (2) not worry much about the possibility that there -might- be other
> marginal affected populations (such as users on early Vista releases who
> have avoided updating their OS); if such cases do in fact exist, we (a)
> won't be making things any worse for them, and (b) can't really be held
> responsible for the fact that they've chosen to stay on a vulnerable OS
> version.
>
> (3) focus efforts on the testing that will enable us to make the global
> switch for -all- users with confidence that we're not regressing behavior.
:jfkthame, can you please needinfo the right folks who can help on your comments ?
In addition, is this targeted to be resolved in FX24 timeframe which is the main reason I tracked this.If we are unsure of its resolution, I'll go ahead and untrack this at this point as this security bug has been there long enough and we don't have track for a particular release unless a blocker (needinfo : dan).Flags: needinfo?(dveditz)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=854897#c33)• 12 years ago |
|  | |

(In reply to Jonathan Kew (:jfkthame) from [comment #30](/show_bug.cgi?id=854897#c30 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> Alternatively, we could
>
> (1) take the existing patch for now, which addresses the issue for the large
> class of users that we -know- are affected;
>
> (2) not worry much about the possibility that there -might- be other
> marginal affected populations (such as users on early Vista releases who
> have avoided updating their OS); if such cases do in fact exist, we (a)
> won't be making things any worse for them, and (b) can't really be held
> responsible for the fact that they've chosen to stay on a vulnerable OS
> version.
>
> (3) focus efforts on the testing that will enable us to make the global
> switch for -all- users with confidence that we're not regressing behavior.
Um, there isn't a big effort to figure out the details needed, namely which versions of Uniscribe are affected and do they only ship with XP. Better to figure this out first rather than patch one way and have to patch again once we do the required testing.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=854897#c34)• 12 years ago |
|  | |

(In reply to bhavana bajaj [:bajaj] from [comment #32](/show_bug.cgi?id=854897#c32 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> (In reply to Jonathan Kew (:jfkthame) from [comment #30](/show_bug.cgi?id=854897#c30 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> > Alternatively, we could
> >
> > (1) take the existing patch for now, which addresses the issue for the large
> > class of users that we -know- are affected;
> >
> > (2) not worry much about the possibility that there -might- be other
> > marginal affected populations (such as users on early Vista releases who
> > have avoided updating their OS); if such cases do in fact exist, we (a)
> > won't be making things any worse for them, and (b) can't really be held
> > responsible for the fact that they've chosen to stay on a vulnerable OS
> > version.
> >
> > (3) focus efforts on the testing that will enable us to make the global
> > switch for -all- users with confidence that we're not regressing behavior.
>
> :jfkthame, can you please needinfo the right folks who can help on your
> comments ?
I'm not sure what further input to seek, aside from the testing of uniscribe versions that jdaggett wants to see done.
I am currently working on point (3) above, with the aim of switching globally from uniscribe to harfbuzz shaping once we have tested that more extensively. That's still likely to be some weeks off, however, given the scale of testing involved in covering many scripts, fonts and texts. Maybe for Fx26, if things go well.
> In addition, is this targeted to be resolved in FX24 timeframe which is the
> main reason I tracked this.
We could take the current patch for Fx24/25; that would resolve the crash for XP users - who are the only ones we know to be affected. If QA can complete more detailed testing across Windows/uniscribe versions, maybe we could refine it further, but I don't see why that should block us from taking the fix based on what we already know.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=854897#c35)• 12 years ago |
|  | |

Considering current events and the lack of responses in this bug, I believe it is highly likely that this is being exploited in the wild and will remain unfixed. In this case the pursuit of the perfect is the enemy of the good. If we have a fix in hand that even partially protects our users without disclosing the issue, we should take it now.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=854897#c36)• 12 years ago |
|  | |

Matt, QA needs to do something here per [comment 31](/show_bug.cgi?id=854897#c31 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]").Flags: needinfo?(dveditz)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a9357249_425645)• 12 years ago |

[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=854897#c37)• 12 years ago |
|  | |

I'll look into this and post all my results ASAP

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=854897#c38)• 11 years ago |
|  | |

Hows the investigation going?

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=854897#c39)• 11 years ago |
|  | |

I was away for work last week and didn't get a chance to take a look at this. I will have a look at this and post my results sometime this week.

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=854897#c40)• 11 years ago |
|  | |

I've been trying to reproduce the issue on Windows XP Pro x64 before going through all the different OS's but couldn't reproduce the problem. I turned off hardware acceleration but still couldn't get the crash. I would like to reproduce this so I know I am doing it correctly before going through all the other OS's.
Went through the following:
- loaded Windows XP Pro SP2 x64 (no other updates) in VirtualBox (VM instance)
- turned off hardware acceleration (also tried with hardware acceleration turned on)
- Installed Firefox 23/24/25 and then loaded "testcase2" without any crashes (just loads a square symbol)
- Attempted to install Firefox on Windows XP with something earlier then SP2 but received an error message indicating SP2 is needed
Please let me know if I am doing something wrong or if someone can point me in the right direction it would be much appreciated!

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=854897#c41)• 11 years ago |
|  | |

(In reply to Kamil Jozwiak [:kjozwiak] from [comment #40](/show_bug.cgi?id=854897#c40 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> I've been trying to reproduce the issue on Windows XP Pro x64 before going
> through all the different OS's but couldn't reproduce the problem. I turned
> off hardware acceleration but still couldn't get the crash. I would like to
> reproduce this so I know I am doing it correctly before going through all
> the other OS's.
>
> Went through the following:
>
> - loaded Windows XP Pro SP2 x64 (no other updates) in VirtualBox (VM
> instance)
The bug was reported for x86. I think it's likely it will behave the same on x64 (as Firefox will still be an x86 application, linking to 32-bit libs), but haven't actually tried that.
> - turned off hardware acceleration (also tried with hardware acceleration
> turned on)
> - Installed Firefox 23/24/25 and then loaded "testcase2" without any crashes
> (just loads a square symbol)
This is the main problem, I think - it sounds like your WinXP doesn't have the relevant fonts and Indic script support installed. IIRC, the support for these languages (in particular, Bengali) is an optional component on XP, not part of the default en-US install. So try:
- Go to Control Panel, then Regional and Language Options
- In the Language tab, select Install files for complex script and right-to-left languages (including Thai)
With the necessary support installed, "testcase2" should display a Bengali letter, not just a missing-glyph box (unless it crashes, of course!).

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=854897#c42)• 11 years ago |
|  | |

On the XP installs I have done, as far as I know they were vanilla installations and I didn't intentionally choose additional fonts. The XP installs were all 32bit and the version of Firefox was 32bit as well.

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=854897#c43)• 11 years ago |
|  | |

Thanks Jonathan! Enabling/Installing those complex scripts through the Regional & Language Options reproduced the crash on Win XP SP2 x86:
- Windows XP Pro x86 SP2 (fresh install without any updates) - Reproduced the crash with the latest Firefox 25 (Nighty Channel)
- Windows XP Pro x64 SP2 (fresh install without any updates) - Couldn't reproduce the crash, still loaded the little square even after installing the "Complex Scripts" through the Regional & Language Options. Also tried installing the Asian languages just in case but still couldn't reproduce.
Does this mean the issue isn't present in Win XP SP2 x64? (just worried as the font is not appearing and still showing a square but Win XP SP2 x86 crashed as soon as testcase2 was opened within the browser)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=854897#c44)• 11 years ago |
|  | |

(In reply to Kamil Jozwiak [:kjozwiak] from [comment #43](/show_bug.cgi?id=854897#c43 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> Thanks Jonathan! Enabling/Installing those complex scripts through the
> Regional & Language Options reproduced the crash on Win XP SP2 x86:
>
> - Windows XP Pro x86 SP2 (fresh install without any updates) - Reproduced
> the crash with the latest Firefox 25 (Nighty Channel)
>
> - Windows XP Pro x64 SP2 (fresh install without any updates) - Couldn't
> reproduce the crash, still loaded the little square even after installing
> the "Complex Scripts" through the Regional & Language Options. Also tried
> installing the Asian languages just in case but still couldn't reproduce.
>
> Does this mean the issue isn't present in Win XP SP2 x64? (just worried as
> the font is not appearing and still showing a square but Win XP SP2 x86
> crashed as soon as testcase2 was opened within the browser)
Seeing the "little square" suggests that the x64 version, even after you enabled "complex scripts", still does not include the Bengali font (I think it's Vrinda) that is shipped with the x86 version. Could you check the Fonts folder and see if it's present?
If you copy vrinda.ttf from the x86 installation to the x64 version, does it -then- crash? (It's possible it won't, because if they're not shipping the font, perhaps this means uniscribe on that system doesn't even attempt to support Bengali. In which case it'd be unlikely to hit the crash.) Or does it display a Bengali character successfully?

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=854897#c45)• 11 years ago |
|  | |

Jonathan,
- Checked the C:\Windows\Fonts\ directory under Windows XP SP2 x64 and didn't see vrinda.tff
- Moved vrinda.tff from the Windows XP SP2 x86 machine into the Windows XP SP2 x64 machine
- Ran through "testcase2" without any issues, the character appeared without any problems (tried several times)
- Tried it with Hardware Acceleration On & Off, browser under x64 never crashed (with vrinda.tff inside the fonts folder)
- Looks like its crashing in x86 but not under x64
Would this be valid for testing on the other OS's? Checking to see if that font exists and if it doesn't, add it from the Windows XP x86 installation and run through "testcase2"?
Appreciate the help!

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=854897#c46)• 11 years ago |
|  | |

(In reply to Kamil Jozwiak [:kjozwiak] from [comment #45](/show_bug.cgi?id=854897#c45 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> Jonathan,
>
> - Checked the C:\Windows\Fonts\ directory under Windows XP SP2 x64 and
> didn't see vrinda.tff
> - Moved vrinda.tff from the Windows XP SP2 x86 machine into the Windows XP
> SP2 x64 machine
> - Ran through "testcase2" without any issues, the character appeared without
> any problems (tried several times)
> - Tried it with Hardware Acceleration On & Off, browser under x64 never
> crashed (with vrinda.tff inside the fonts folder)
> - Looks like its crashing in x86 but not under x64
OK - I suspect this may mean that uniscribe on the x64 version of WinXPSP2 lacks Bengali support. (You could try loading bn.wikipedia.org/wiki/ and compare the display with the x86 version - if, as I suspect, uniscribe lacks support for the script, there should be some fairly obvious differences even though the basic glyphs will be present.)
Presumably Bengali support will appear in some later x64 release - certainly it's there in Win7, but I don't know if it ever shipped for XP/x64. If it did, then the issue might arise there.
> Would this be valid for testing on the other OS's? Checking to see if that
> font exists and if it doesn't, add it from the Windows XP x86 installation
> and run through "testcase2"?
It's essential that you enable "support for complex scripts" in Windows (not just install the font), as without this, the relevant uniscribe version may not be present.
It seems likely that if "complex scripts" support for any given version does -not- give you the Bengali font, it's because that script simply isn't supported, and so the bug won't be relevant. I think that's probably the case for your x64 installation. But presumably any x86 version going forward will include that support (once "complex scripts" have been enabled) - it won't have been -removed- in a later SP or OS release.
So I guess the interesting questions are (a) at what point after XP/SP2 do Bengali-enabled ("complex scripts") x86 releases -stop- suffering from the crash; and (b) at what point does Bengali support appear on x64 with "complex scripts", and does it ever suffer from the crash?

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=854897#c47)• 11 years ago |
|  | |

Jonathan, went through the following test cases for Windows XP and the other OS's and only received the crash in Windows XP x86.
Everything was tested against the following build:
<http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2013-08-01-03-02-23-mozilla-central/>
Windows XP Pro SP2 x86 (no updates): [FAILED]
- Reproduced the crash using testcase2
Windows XP Pro SP3 x86 (no updates): [FAILED]
- Reproduced the crash using testcase2
Windows XP Pro SP3 x86 (Fully Updated): [FAILED]
- Reproduced the crash using testcase2
Windows XP Pro SP2 x64 (no updates): [PASSED]
- Disabled Hardware Acceleration
- Checked the C:\Windows\Fonts for vrinda.tff (didn't exist)
- Enabled "support for complex scripts"
- Installed the vrinda.tff font by placing it into fonts
- Couldn't reproduce the issue using testcase2 (tried several times)
Windows XP Pro SP2 x64 (Fully Updated): [PASSED]
- Disabled Hardware Acceleration
- Checked the C:\Windows\Fonts for vrinda.tff (didn't exist)
- Enabled "support for complex scripts"
- Installed the vrinda.tff font by placing it into fonts
- Couldn't reproduce the issue using testcase2 (tried several times)
For the below OS's, I went through the following test cases and all of them passed without any issues:
- Disabled Hardware Acceleration
- Checked the C:\Windows\Fonts for vrinda.tff (it's installed)
- Couldn't reproduce the issue using testcase2 & character appeared correctly (tried several times)
Windows Vista Ultimate x86 (fresh install without updates): [PASSED]
Windows Vista Ultimate SP1 x86 (no updates): [PASSED]
Windows Vista Ultimate SP2 x86 (no updates): [PASSED]
Windows Vista Ultimate SP2 x86 (Fully Updated): [PASSED]
Windows Vista Ultimate x64 (fresh install without updates): [PASSED]
Windows Vista Ultimate x64 (Fully Updated without any SP's): [PASSED]
Windows Vista Ultimate SP1 x64 (no updates): [PASSED]
Windows Vista Ultimate SP2 x64 (no updates): [PASSED]
Windows Vista Ultimate SP2 x64 (Fully Updated): [PASSED]
Windows 7 Home Premium X86 (fresh install without updates): [PASSED]
Windows 7 Home Premium SP1 X86 (no updates): [PASSED]
Windows 7 Home Premium SP1 X86 (Fully Updated): [PASSED]
Windows 7 Home Premium X64 (fresh install without updates): [PASSED]
Windows 7 Home Premium SP1 X64 (no updates): [PASSED]
Windows 7 Home Premium SP1 X64 (Fully Updated): [PASSED]
The only one that I have left is Windows 8 x86/64 and will try to get that done tomorrow as I still need to create VM's for both machines. Jonathan, please let me know if there's any issues with the test that was done or if I missed something.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=854897#c48)• 11 years ago |
|  | |

(In reply to Kamil Jozwiak [:kjozwiak] from [comment #47](/show_bug.cgi?id=854897#c47 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> The only one that I have left is Windows 8 x86/64 and will try to get that
> done tomorrow as I still need to create VM's for both machines. Jonathan,
> please let me know if there's any issues with the test that was done or if I
> missed something.
I'm not really concerned about Windows 8; it seems clear this was a flaw in early Uniscribe Indic-script code, it's since been fixed, and we have no reason to suspect it would have regressed again recently.
John, are there other versions or combinations you want to see tested here? It still seems to me that taking the simplest patch, to just avoid Uniscribe on WinXP, is a reasonable solution for the time being, while we continue in-depth harfbuzz testing. There's no indication here of problems on post-XP systems.Flags: needinfo?(jdaggett)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=854897#c49)• 11 years ago |
|  | |

Comment on [attachment 766471](/attachment.cgi?id=766471 "prefer harfbuzz shaping for Indic text on WinXP") [[details]](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") [[diff]](/attachment.cgi?id=766471&action=diff "prefer harfbuzz shaping for Indic text on WinXP") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854897&attachment=766471)
prefer harfbuzz shaping for Indic text on WinXP
Yeah, given the testing results in [comment 47](/show_bug.cgi?id=854897#c47 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]") this seems reasonable to me.
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: review?(jdaggett) → review+

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a11357982_280585)• 11 years ago |

Flags: needinfo?(jdaggett)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=854897#c50)• 11 years ago |
|  | |

Comment on [attachment 766471](/attachment.cgi?id=766471 "prefer harfbuzz shaping for Indic text on WinXP") [[details]](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") [[diff]](/attachment.cgi?id=766471&action=diff "prefer harfbuzz shaping for Indic text on WinXP") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854897&attachment=766471)
prefer harfbuzz shaping for Indic text on WinXP
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Not readily, IMO; though if it prompted someone to try fuzz-testing on XP with Indic text and fonts, they'd probably hit the crashing case before long.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
The patch just shows that we are avoiding the use of Uniscribe for Indic text, but does not give any clue to the reason for this, or the specific font(s) or text sequence(s) that lead to the crash.
Which older supported branches are affected by this flaw?
All - it's really a Windows XP flaw. (The patch here just aims to avoid using the buggy API, not fix it.)
If not all supported branches, which bug introduced the flaw?
n/a.
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
The patch would backport easily. However, on older branches (particularly ESR17, with a much older version of harfbuzz), it's likely there would be more significant behavioral regressions. Given that the underlying bug has been present "forever" (and affects all applications, not just Firefox - see [comment 6](/show_bug.cgi?id=854897#c6 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]")), I don't see much value in backporting.
How likely is this patch to cause regressions; how much testing does it need?
The only area that could regress is text shaping for Indic scripts on XP. It's impractical for us to proactively test every possible text sequence against every font in the wild, so there almost certainly -will- be a few regressions with particular fonts and text sequences, although we believe the vast majority of text will render fine. (There will also be -improvements- in some cases, though that will be small comfort for anyone who does encounter a shaping regression.)
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=854897#c51)• 11 years ago |
|  | |

Comment on [attachment 766471](/attachment.cgi?id=766471 "prefer harfbuzz shaping for Indic text on WinXP") [[details]](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") [[diff]](/attachment.cgi?id=766471&action=diff "prefer harfbuzz shaping for Indic text on WinXP") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854897&attachment=766471)
prefer harfbuzz shaping for Indic text on WinXP
sec-approval+ for trunk.
I would go ahead and make the Aurora patch and nominate it. This is tracking+ for that so it should be approved immediately.
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: sec-approval? → sec-approval+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=854897#c52)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/ba49de65e2c0>Target Milestone: --- → mozilla26

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=854897#c53)• 11 years ago |
|  | |

Comment on [attachment 766471](/attachment.cgi?id=766471 "prefer harfbuzz shaping for Indic text on WinXP") [[details]](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") [[diff]](/attachment.cgi?id=766471&action=diff "prefer harfbuzz shaping for Indic text on WinXP") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854897&attachment=766471)
prefer harfbuzz shaping for Indic text on WinXP
[Approval Request Comment]
Bug caused by (feature/regressing bug #): n/a (workaround for WinXP bug)
User impact if declined: crash (possibly exploitable?) may be triggered by specific characters in a web page
Testing completed (on m-c, etc.): just landed on inbound; tested with local build to confirm this avoids the crash
Risk to taking this patch (and alternatives if risky): see [comment 50](/show_bug.cgi?id=854897#c50 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]") last para
String or IDL/UUID changes made by this patch: none
Note that this patch landed on inbound for mozilla-26, as review and sec-approval only happened on merge day (too late to catch the mozilla-25 train). So this nomination should therefore be considered as being for aurora-25 and beta-24, although at this time I believe those version bumps may still be pending.
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: approval-mozilla-beta?
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: approval-mozilla-aurora?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=854897#c54)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ba49de65e2c0>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a12014399_272375)• 11 years ago |

[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: approval-mozilla-beta?
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: approval-mozilla-beta+
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: approval-mozilla-aurora?
[Attachment #766471](/attachment.cgi?id=766471&action=edit "prefer harfbuzz shaping for Indic text on WinXP") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=854897#c55)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/7c8d69378d3a>
<https://hg.mozilla.org/releases/mozilla-beta/rev/8440b676b1bf>
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=854897#c56)• 11 years ago |
|  | |

It appears this landed with today's patch tuesday:
<https://technet.microsoft.com/en-us/security/bulletin/ms13-060>

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=854897#c57)• 11 years ago |
|  | |

Certainly sounds like it; Kamil, could you re-test with a patched WinXP (and an \*UN\*patched Firefox version, obviously) to confirm that the testcase no longer crashes?
(It's interesting to note that the MS bulletin lists WinXP/x64 as being affected, although AFAICT we were never able to reproduce this specific crash on a 64-bit version.)Flags: needinfo?(kamiljoz)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=854897#c58)• 11 years ago |
|  | |

I retested my urls on unpatched windows xp 32bit and could not reproduce with beta, aurora or nightly. :-) I'll recheck after I do patch tuesday maintenance and update all my vms.

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=854897#c59)• 11 years ago |
|  | |

Jonathan, sure! I will check when I get home from work and post the results for both Windows XP x86/x64 versions with the latest patches + unpatched Firefox.
Ya, noticed that also, I couldn't reproduce it on Windows XP x64 and tried many times with different VM's but MS added it to the affected list...

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=854897#c60)• 11 years ago |
|  | |

i was not able to reproduce any crashes with the patched Firefox builds and patched XP systems.Flags: needinfo?(stefin)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=854897#c61)• 11 years ago |
|  | |

(In reply to Bob Clary [:bc:] from [comment #60](/show_bug.cgi?id=854897#c60 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> i was not able to reproduce any crashes with the patched Firefox builds and
> patched XP systems.
And with UNpatched Firefox (e.g. FF23 release) on fully-patched XP?

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=854897#c62)• 11 years ago |
|  | |

see [comment 59](/show_bug.cgi?id=854897#c59 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]")

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=854897#c63)• 11 years ago |
|  | |

I will also go through this tonight and post the results

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=854897#c64)• 11 years ago |
|  | |

Used the following build: (an older version as recommended per [comment 61](/show_bug.cgi?id=854897#c61 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
<http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2013/04/2013-04-04-03-08-59-mozilla-central/>
- Reproduced the original issue with Windows XP Pro x86 SP3 that wasn't updated with the newer patches ("hardware acceleration disabled" & enabled "support for complex scripts")
- Once the issue was reproduced, restored the Windows XP Pro SP3 x86 VM to its original state (without complex scripts, latest patches & Firefox uninstalled)
- Updated the VM instance with all of the latest patches from the Microsoft Update page
- Enabled "support complex scripts" & "hardware acceleration" and restarted the machine
- Downloaded and installed the above build
- Once installed, opened Testcase2 without any crashes nor issuesFlags: needinfo?(kamiljoz)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=854897#c65)• 11 years ago |
|  | |

Shouldn't we take this on ESR17?
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a13248728_1689)• 11 years ago |

[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F) → [24+](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=24%2B)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=854897#c66)• 11 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #65](/show_bug.cgi?id=854897#c65 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]"))
> Shouldn't we take this on ESR17?
I don't think so (see [comment 50](/show_bug.cgi?id=854897#c50 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]") for details), especially given that MS has just patched the bug in XP anyway.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a13255480_280903)• 11 years ago |

Whiteboard: [MSRC case 14349st -- keep hidden until MS is clear too] → [adv-main24+][MSRC case 14349st -- keep hidden until MS is clear too]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a13256262_280903)• 11 years ago |

[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a25433128_1689)• 11 years ago |

[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected)
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854897#a75269544_1689)• 9 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=854897&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_0b387a3e_20250125_154609.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM/)

[Manage this list](/manage/lists/updates.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM/)
[Sign Up](/accounts/signup/?next=/archives/list/updates%40lists.opensuse.org/message/CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/updates%40lists.opensuse.org/thread/CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM/#CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM)

# openSUSE-SU-2013:1495-1: moderate: update for MozillaThunderbird

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

27 Sep
2013

27 Sep
'13

14:05

openSUSE Security Update: update for MozillaThunderbird
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:1495-1
Rating: moderate
References: #840485
Cross-References: CVE-2013-1718 CVE-2013-1719 CVE-2013-1720
CVE-2013-1722 CVE-2013-1723 CVE-2013-1724
CVE-2013-1725 CVE-2013-1728 CVE-2013-1730
CVE-2013-1732 CVE-2013-1735 CVE-2013-1736
CVE-2013-1737 CVE-2013-1738
Affected Products:
openSUSE 12.3
openSUSE 12.2
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 14 vulnerabilities is now available.
Description:
This MozillaThunderbird update to version 24.0 fixes
several security and non-security issues:
- update to Thunderbird 24.0 (bnc#840485)
\* MFSA 2013-76/CVE-2013-1718/CVE-2013-1719 Miscellaneous
memory safety hazards
\* MFSA 2013-77/CVE-2013-1720 (bmo#888820) Improper state
in HTML5 Tree Builder with templates
\* MFSA 2013-79/CVE-2013-1722 (bmo#893308) Use-after-free
in Animation Manager during stylesheet cloning
\* MFSA 2013-80/CVE-2013-1723 (bmo#891292) NativeKey
continues handling key messages after widget is
destroyed
\* MFSA 2013-81/CVE-2013-1724 (bmo#894137) Use-after-free
with select element
\* MFSA 2013-82/CVE-2013-1725 (bmo#876762) Calling scope
for new Javascript objects can lead to memory corruption
\* MFSA 2013-85/CVE-2013-1728 (bmo#883686) Uninitialized
data in IonMonkey
\* MFSA 2013-88/CVE-2013-1730 (bmo#851353) Compartment
mismatch re-attaching XBL-backed nodes
\* MFSA 2013-89/CVE-2013-1732 (bmo#883514) Buffer overflow
with multi-column, lists, and floats
\* MFSA 2013-90/CVE-2013-1735/CVE-2013-1736 (bmo#898871,
bmo#906301) Memory corruption involving scrolling
\* MFSA 2013-91/CVE-2013-1737 (bmo#907727) User-defined
properties on DOM proxies get the wrong "this" object
\* MFSA 2013-92/CVE-2013-1738 (bmo#887334, bmo#882897) GC
hazard with default compartments and frame chain
restoration
- moved greek to common translation package
- require NSPR 4.10 and NSS 3.15.1
- add GStreamer build requirements for Gecko
- added enigmail-build.patch to fix TB packaging
(bmo#886095)
- removed obsolete patches:
\* enigmail-old-gcc.patch
\* mozilla-gcc43-enums.patch
\* mozilla-gcc43-template\_hacks.patch
\* mozilla-gcc43-templates\_instantiation.patch
\* ppc-xpcshell.patch
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.3:
zypper in -t patch openSUSE-2013-719
- openSUSE 12.2:
zypper in -t patch openSUSE-2013-719
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.3 (i586 x86\_64):
MozillaThunderbird-24.0-61.25.2
MozillaThunderbird-buildsymbols-24.0-61.25.2
MozillaThunderbird-debuginfo-24.0-61.25.2
MozillaThunderbird-debugsource-24.0-61.25.2
MozillaThunderbird-devel-24.0-61.25.2
MozillaThunderbird-translations-common-24.0-61.25.2
MozillaThunderbird-translations-other-24.0-61.25.2
enigmail-1.5.2+24.0-61.25.2
enigmail-debuginfo-1.5.2+24.0-61.25.2
- openSUSE 12.2 (i586 x86\_64):
MozillaThunderbird-24.0-49.55.1
MozillaThunderbird-buildsymbols-24.0-49.55.1
MozillaThunderbird-debuginfo-24.0-49.55.1
MozillaThunderbird-debugsource-24.0-49.55.1
MozillaThunderbird-devel-24.0-49.55.1
MozillaThunderbird-translations-common-24.0-49.55.1
MozillaThunderbird-translations-other-24.0-49.55.1
enigmail-1.5.2+24.0-49.55.1
References:
<http://support.novell.com/security/cve/CVE-2013-1718.html>
<http://support.novell.com/security/cve/CVE-2013-1719.html>
<http://support.novell.com/security/cve/CVE-2013-1720.html>
<http://support.novell.com/security/cve/CVE-2013-1722.html>
<http://support.novell.com/security/cve/CVE-2013-1723.html>
<http://support.novell.com/security/cve/CVE-2013-1724.html>
<http://support.novell.com/security/cve/CVE-2013-1725.html>
<http://support.novell.com/security/cve/CVE-2013-1728.html>
<http://support.novell.com/security/cve/CVE-2013-1730.html>
<http://support.novell.com/security/cve/CVE-2013-1732.html>
<http://support.novell.com/security/cve/CVE-2013-1735.html>
<http://support.novell.com/security/cve/CVE-2013-1736.html>
<http://support.novell.com/security/cve/CVE-2013-1737.html>
<http://support.novell.com/security/cve/CVE-2013-1738.html>
<https://bugzilla.novell.com/840485>

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/updates%40lists.opensuse.org/message/CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM/)
Use email software

[Back to the thread](/archives/list/updates%40lists.opensuse.org/thread/CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM/#CULCKUSLZFRK5LYPDZHBSXBBH4H7B3PM)

[Back to the list](/archives/list/updates%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_0bd95a76_20250125_154615.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/750932)
* [XML](/show_bug.cgi?ctype=xml&id=750932)

Closed
[Bug 750932](/show_bug.cgi?id=750932)

Opened 13 years ago
Closed 11 years ago

# ASAN: Test test\_multipart\_streamconv\_missing\_lead\_boundary.js triggers error

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

ASAN: Test test\_multipart\_streamconv\_missing\_lead\_boundary.js triggers error

## Categories

### (Core :: Networking, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking#Networking)

Networking
▾

Core :: Networking
For bugs in Mozilla's modular networking library (aka "Netlib" or "Necko".) The networking library supplies the software interface that Mozilla uses to access physical transports (e.g. the Internet and local drives), perform URL resolutions, and handle a variety of networking protocols.

Examples of appropriate bugs: URLs with backslash not fetched; URLs starting with a single slash turn into http:///; Cannot access authenticated FTP site.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla26

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 | --- | [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) |
| firefox24 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox26 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed) |
| b2g18 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed) |
| b2g-v1.1hd | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=fixed) |
| b2g-v1.2 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 |  | affected |
| firefox24 |  | fixed |
| firefox25 |  | fixed |
| firefox26 |  | fixed |
| b2g18 |  | fixed |
| b2g-v1.1hd |  | fixed |
| b2g-v1.2 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: mcmanus)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/2b0de973c803f192309b00777c594202?d=mm&size=40)  [mcmanus](/user_profile?user_id=32546)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[905636](/show_bug.cgi?id=905636 "RESOLVED FIXED - ASAN: Mark test_multipart_streamconv_missing_lead_boundary.js as failing")

[asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")

Dependency [tree](/showdependencytree.cgi?id=750932&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=750932)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, testcase, Whiteboard: [asan][asan-test-failure][adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[asan][asan-test-failure][adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [mcmanus](/user_profile?user_id=32546) | [in-testsuite](#c26 "11 years ago") | + |
| --- | --- | --- |
| [mcmanus](/user_profile?user_id=32546) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [AddressSanitizer Log](/attachment.cgi?id=620104)  [13 years ago](#c0)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   12.65 KB, text/plain |  | [Details](/attachment.cgi?id=620104&action=edit) |
| --- | --- | --- |
| [multipart delimiter check](/attachment.cgi?id=792407)  [11 years ago](#c10)  [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)   1.17 KB, patch | jduell.mcbugs : [review+](#c17 "11 years ago") | [Details](/attachment.cgi?id=792407&action=edit) | [Diff](/attachment.cgi?id=792407&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=792407) |
| [multipart delimiter check](/attachment.cgi?id=793464)  [11 years ago](#c18)  [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)   1.90 KB, patch | mcmanus : [review+](#a41177395_32546 "11 years ago")  decoder : [review+](#c19 "11 years ago")  bajaj : [approval-mozilla-aurora+](#c22 "11 years ago")  bajaj : [approval-mozilla-beta+](#c22 "11 years ago")  bajaj : [approval-mozilla-b2g18+](#a54600928_448925 "11 years ago") | [Details](/attachment.cgi?id=793464&action=edit) | [Diff](/attachment.cgi?id=793464&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=793464) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=750932#c0)• 13 years ago |
|  | |

Attached file
[AddressSanitizer Log](attachment.cgi?id=620104)
— [Details](attachment.cgi?id=620104&action=edit)

This xpcshell test "test\_multipart\_streamconv\_missing\_lead\_boundary.js" fails with AddressSanitizer on mozilla-central revision 6e34995a746e. The output of the command
make SOLO\_FILE="test\_multipart\_streamconv\_missing\_lead\_boundary.js" -C netwerk/test/ check-one 2>&1 | asan\_symbolize.py | c++filt
is attached, which includes the backtrace of the problem. Not sure which component this belongs to exactly, please move as appropriate :) Marking this s-s until triaged and confirmed to be safe.

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a12823_3881)• 13 years ago |

Component: General → NetworkingQA Contact: general → networking

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=750932#c1)• 13 years ago |
|  | |

Josh, any thoughts on who could look at this one?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a479939_395101)• 13 years ago |

Whiteboard: [asan] → [asan][asan-test-failure]

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=750932#c2)• 13 years ago |
|  | |

cc+ Brian Smith. Does this look like a networking bug?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=750932#c3)• 13 years ago |
|  | |

looks like we're over-reading from a buffer we realloc'd only 35 lines before. worst case maybe leaking other memory into a document? Unless there's some reason to believe we'd have stopped at that one byte instead of keeping going.Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a10616748_395101)• 12 years ago |

Whiteboard: [asan][asan-test-failure] → [asan][asan-test-failure][orange]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=750932#c4)• 12 years ago |
|  | |

I'm still seeing this on today's try push, causing orange on xpcshell tests.

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a11030137_251051)• 12 years ago |

Blocks: [438871](/show_bug.cgi?id=438871 "RESOLVED INCOMPLETE - ***Do not use any more** some tests fail intermittently")

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a11030464_395101)• 12 years ago |

No longer blocks: [438871](/show_bug.cgi?id=438871 "RESOLVED INCOMPLETE - ***Do not use any more** some tests fail intermittently")Whiteboard: [asan][asan-test-failure][orange] → [asan][asan-test-failure]

|  | [Brian Smith (:briansmith, :bsmith, use NEEDINFO?)](/user_profile?user_id=14661) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=750932#c5)• 12 years ago |
|  | |

I am going to take this so I can investigate it. Christian, if I run this under ASAN should I be expecting a failure every time, or only intermittently?Assignee: nobody → bsmith

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=750932#c6)• 12 years ago |
|  | |

Over to Patrick to take a look.Assignee: bsmith → mcmanus

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a24172362_395101)• 12 years ago |

Blocks: [asan-tests](/show_bug.cgi?id=831491 "RESOLVED FIXED - run tests on ASAN builds")

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a30561617_395101)• 12 years ago |

Blocks: [asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=750932#c7)• 12 years ago |
|  | |

This is still showing up daily on TBPL and I can reproduce locally.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=750932#c8)• 11 years ago |
|  | |

I took a quick look at this and it seems to me that we're reading out of bounds in the line in question:
> if (\*(token+mTokenLen+1) == '-') {
What guarantees that there is something after token at all? My debugging seems to indicate that we're at the end of the string (token+mTokenLen pointing at the last '-', so token+mTokenLen+1 is OOB if these strings aren't null-terminated).Flags: needinfo?(mcmanus)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=750932#c9)• 11 years ago |
|  | |

Correction to the last comment (I had modified the test): With the original test, the "--" at the end of the string in question doesn't seem to be even there. We die while parsing this string:
> var multipartBody = "\r\nSome text\r\n--boundary\r\n\r\n<?xml version='1.0'?><root/>\r\n--boundary--";
Breakpoint 1, \_\_asan\_report\_error (pc=46912521199766, bp=140737488320688, sp=140737488320680, addr=106034152709708, is\_write=false, access\_size=1) at /srv/repos/llvm/projects/compiler-rt/lib/asan/asan\_report.cc:675
675 uptr addr, bool is\_write, uptr access\_size) {
(gdb) x /16bx 106034152709708-8
0x607000019e44: 0x62 0x6f 0x75 0x6e 0x64 0x61 0x72 0x79 <- 'boundary'
0x607000019e4c: 0x00 0x00 0x00 0x00 0xb9 0x96 0x6e 0xcc <- no dashes
So the ASan error is perfectly correct, we're reading out of bounds.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a40662213_395101)• 11 years ago |

Blocks: [905636](/show_bug.cgi?id=905636 "RESOLVED FIXED - ASAN: Mark test_multipart_streamconv_missing_lead_boundary.js as failing")

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a40662670_395101)• 11 years ago |

No longer blocks: [asan-tests](/show_bug.cgi?id=831491 "RESOLVED FIXED - run tests on ASAN builds")

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=750932#c10)• 11 years ago |
|  | |

Attached patch

[multipart delimiter check](attachment.cgi?id=792407&action=diff) (obsolete)
— [Details](attachment.cgi?id=792407&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=792407)

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=750932#c11)• 11 years ago |
|  | |

I endeavored to confirm the bug and the fix using a asan try run based on the instructions here: <https://developer.mozilla.org/en-US/docs/Building_Firefox_with_Address_Sanitizer>
but I failed to get it to build: <https://tbpl.mozilla.org/?tree=Try&rev=6dc544ff626a>
therefore I'm going to ask :decoder to build the patch for me and verify the fix.Flags: needinfo?(mcmanus)

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a41034716_32546)• 11 years ago |

[Attachment #792407](/attachment.cgi?id=792407&action=edit "multipart delimiter check") -
Flags: feedback?(choller)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=750932#c12)• 11 years ago |
|  | |

Thanks for looking into this.
Actually, your try run looks good and is still running. The orange on the opt-build can be ignored, it's a buildbot thing. The red on debug is because there seems to be --enable-valgrind in the config while the builder doesn't have valgrind installed. But we don't need that debug build to confirm the bug.
xpcshell is running and should orange because the test is marked as failing and with the patch it should pass. So let's just wait until that is finished :)

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=750932#c13)• 11 years ago |
|  | |

thanks christian.. I was just noticing that.. distracted by all the red :)

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=750932#c14)• 11 years ago |
|  | |

13:41:09 WARNING - TEST-UNEXPECTED-PASS | /builds/slave/test/build/tests/xpcshell/tests/netwerk/test/unit/test\_multipart\_streamconv\_missing\_lead\_boundary.js | test failed (with xpcshell return code: 0), see following log:
UNEXPECTED-PASS.. that's funny :)

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=750932#c15)• 11 years ago |
|  | |

Comment on [attachment 792407](/attachment.cgi?id=792407 "multipart delimiter check") [[details]](/attachment.cgi?id=792407&action=edit "multipart delimiter check") [[diff]](/attachment.cgi?id=792407&action=diff "multipart delimiter check") [[review]](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=792407)
multipart delimiter check
I had to familiarize myself with this code.
I'm 98% sure the case where the - and the normal boundary string are in different ODA events works ok because it is followed by an OnStopRequest event.. but even if that isn't true that's a pre-existing (non security) bug which isn't regressed by this change.
[Attachment #792407](/attachment.cgi?id=792407&action=edit "multipart delimiter check") -
Flags: feedback?(choller) → review?(jduell.mcbugs)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=750932#c16)• 11 years ago |
|  | |

(In reply to Patrick McManus [:mcmanus] from [comment #14](/show_bug.cgi?id=750932#c14 "RESOLVED FIXED - ASAN: Test test_multipart_streamconv_missing_lead_boundary.js triggers error"))
> UNEXPECTED-PASS.. that's funny :)
Yep :) Looks like your fix is working. If you push it like this to inbound, please also re-enable the test in the same push by removing the AddressSanitizer specific "fail-if" in xpcshell.ini. Thanks!

|  | [Jason Duell](/user_profile?user_id=334931) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=750932#c17)• 11 years ago |
|  | |

Comment on [attachment 792407](/attachment.cgi?id=792407 "multipart delimiter check") [[details]](/attachment.cgi?id=792407&action=edit "multipart delimiter check") [[diff]](/attachment.cgi?id=792407&action=diff "multipart delimiter check") [[review]](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=792407)
multipart delimiter check
Review of [attachment 792407](/attachment.cgi?id=792407 "multipart delimiter check") [[details]](/attachment.cgi?id=792407&action=edit "multipart delimiter check") [[diff]](/attachment.cgi?id=792407&action=diff "multipart delimiter check") [[review]](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=792407):
-----------------------------------------------------------------
Thanks for figuring this out Patrick!
[Attachment #792407](/attachment.cgi?id=792407&action=edit "multipart delimiter check") -
Flags: review?(jduell.mcbugs) → review+

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=750932#c18)• 11 years ago |
|  | |

Attached patch

[multipart delimiter check](attachment.cgi?id=793464&action=diff)
— [Details](attachment.cgi?id=793464&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=793464)

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a41177395_32546)• 11 years ago |

[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: review+

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a41177415_32546)• 11 years ago |

[Attachment #792407](/attachment.cgi?id=792407&action=edit "multipart delimiter check") -
Attachment is obsolete: true

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=750932#c19)• 11 years ago |
|  | |

Comment on [attachment 793464](/attachment.cgi?id=793464 "multipart delimiter check") [[details]](/attachment.cgi?id=793464&action=edit "multipart delimiter check") [[diff]](/attachment.cgi?id=793464&action=diff "multipart delimiter check") [[review]](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=793464)
multipart delimiter check
Thanks!
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: review+

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=750932#c20)• 11 years ago |
|  | |

this is sec-moderate so I just pushed it without sec-approval
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/5f8ae314d872>

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=750932#c21)• 11 years ago |
|  | |

Comment on [attachment 793464](/attachment.cgi?id=793464 "multipart delimiter check") [[details]](/attachment.cgi?id=793464&action=edit "multipart delimiter check") [[diff]](/attachment.cgi?id=793464&action=diff "multipart delimiter check") [[review]](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=793464)
multipart delimiter check
[Approval Request Comment]
Bug caused by (feature/regressing bug #): latent original sin
User impact if declined: possible info leak between documents
Testing completed (on m-c, etc.): on m-i, contains an ASAN test
Risk to taking this patch (and alternatives if risky): low
String or IDL/UUID changes made by this patch: none
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-beta?
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-aurora?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=750932#c22)• 11 years ago |
|  | |

Comment on [attachment 793464](/attachment.cgi?id=793464 "multipart delimiter check") [[details]](/attachment.cgi?id=793464&action=edit "multipart delimiter check") [[diff]](/attachment.cgi?id=793464&action=diff "multipart delimiter check") [[review]](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=793464)
multipart delimiter check
low risk patch contains an ASAN test and we still have a few more beta's to deal with fallouts if any.Hence approving this for uplift on aurora/beta.
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-beta?
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-beta+
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-aurora?
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-aurora+

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=750932#c23)• 11 years ago |
|  | |

trivial osx -Werror .. will need to reland.
../../../../../netwerk/streamconv/converters/nsMultiMixedConv.cpp:568:43: error: comparison of integers of different signs: 'int' and 'uint32\_t' (aka 'unsigned int') [-Werror,-Wsign-compare]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=750932#c24)• 11 years ago |
|  | |

Backed out for Werror bustage on all platforms.
<https://hg.mozilla.org/integration/mozilla-inbound/rev/5f8ae314d872>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=26822633&tree=Mozilla-Inbound>

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=750932#c25)• 11 years ago |
|  | |

asan retry: <https://tbpl.mozilla.org/?tree=Try&rev=7dee5d7f5e8c>
desktop retry <https://tbpl.mozilla.org/?tree=Try&rev=2290a97bf799>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/3a10f2f0401a>

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=750932#c26)• 11 years ago |
|  | |

remote: <https://hg.mozilla.org/releases/mozilla-aurora/rev/b7986713641d>
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/f935e4a1c6dd>
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed)Flags: in-testsuite+

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a41286342_32546)• 11 years ago |

[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed) → ---

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=750932#c27)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/3a10f2f0401a>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla26

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a41303086_280903)• 11 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)Whiteboard: [asan][asan-test-failure] → [asan][asan-test-failure][adv-main24+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a47948420_280903)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected)
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=affected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a48010008_75935)• 11 years ago |

[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=750932#c28)• 11 years ago |
|  | |

Comment on [attachment 793464](/attachment.cgi?id=793464 "multipart delimiter check") [[details]](/attachment.cgi?id=793464&action=edit "multipart delimiter check") [[diff]](/attachment.cgi?id=793464&action=diff "multipart delimiter check") [[review]](/page.cgi?id=splinter.html&ignore=&bug=750932&attachment=793464)
multipart delimiter check
NOTE: This flag is now for security issues only. Please see <https://wiki.mozilla.org/Release_Management/B2G_Landing> to better understand the B2G approval process and landings.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): latent original sin
User impact if declined: possible info leak between documents
Testing completed (on m-c, etc.): Shipping on desktop since Fx24. Backporting was trivial and is green on Try.
Risk to taking this patch (and alternatives if risky): low
String or IDL/UUID changes made by this patch: none
[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-b2g18?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a54600928_448925)• 11 years ago |

[Attachment #793464](/attachment.cgi?id=793464&action=edit "multipart delimiter check") -
Flags: approval-mozilla-b2g18? → approval-mozilla-b2g18+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=750932#c29)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g18/rev/1f6e89d119a9>
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=750932#c30)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g18_v1_1_0_hd/rev/1f6e89d119a9>
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=750932#a80544904_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=750932&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_715f39e1_20250125_154624.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/871462)
* [XML](/show_bug.cgi?ctype=xml&id=871462)

Closed
[Bug 871462](/show_bug.cgi?id=871462)

Opened 12 years ago
Closed 12 years ago

# Clean up String API usages for dom/system/gonk

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Clean up String API usages for dom/system/gonk

## Categories

### (Core :: DOM: Device Interfaces, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Device%20Interfaces#DOM%3A%20Device%20Interfaces)

DOM: Device Interfaces
▾

Core :: DOM: Device Interfaces
This component covers APIs exposing device interfaces for communication, networking, multimedia, etc.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Device%20Interfaces&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Device%20Interfaces&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Device%20Interfaces)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

Gonk (Firefox OS)

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | [+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed) |
| b2g18-v1.0.0 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix) |
| b2g18-v1.0.1 | --- | [affected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=affected) |
| b2g-v1.1hd | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 |  | wontfix |
| firefox23 |  | wontfix |
| firefox24 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 | + | fixed |
| b2g18-v1.0.0 |  | wontfix |
| b2g18-v1.0.1 |  | affected |
| b2g-v1.1hd |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: m\_kato, Assigned: m\_kato)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/1875645d5594d36bca29657d51d24ed6?d=mm&size=40)  [m\_kato](/user_profile?user_id=8636)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1875645d5594d36bca29657d51d24ed6?d=mm&size=40)  [m\_kato](/user_profile?user_id=8636)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/449d5e4f615206171e7b9a8e77399571?d=mm&size=40)  [cmartin](/user_profile?user_id=625428)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uaf, sec-critical, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [fix](/attachment.cgi?id=748718)  [12 years ago](#c0)  [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)   4.98 KB, patch | dbaron : [review+](#c6 "12 years ago") | [Details](/attachment.cgi?id=748718&action=edit) | [Diff](/attachment.cgi?id=748718&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=748718) |
| --- | --- | --- |
| [for b2g18](/attachment.cgi?id=757756)  [12 years ago](#c8)  [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)   5.82 KB, patch | akeybl : [approval-mozilla-b2g18+](#a2023738_425645 "12 years ago") | [Details](/attachment.cgi?id=757756&action=edit) | [Diff](/attachment.cgi?id=757756&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=757756) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=871462#c0)• 12 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=748718&action=diff)
— [Details](attachment.cgi?id=748718&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=748718)

*No description provided.*

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a131_8636)• 12 years ago |

[Attachment #748718](/attachment.cgi?id=748718&action=edit "fix") -
Flags: review?(doug.turner)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=871462#c1)• 12 years ago |
|  | |

address value in AudioManager::Observe has use after free. This is possible crash code.

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=871462#c2)• 12 years ago |
|  | |

free after use is Security-Sensitive.Group: core-security

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=871462#c3)• 12 years ago |
|  | |

other way around, of course.

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=871462#c4)• 12 years ago |
|  | |

Comment on [attachment 748718](/attachment.cgi?id=748718 "fix") [[details]](/attachment.cgi?id=748718&action=edit "fix") [[diff]](/attachment.cgi?id=748718&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=748718)
fix
Review of [attachment 748718](/attachment.cgi?id=748718 "fix") [[details]](/attachment.cgi?id=748718&action=edit "fix") [[diff]](/attachment.cgi?id=748718&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=748718):
-----------------------------------------------------------------
I \*hate\* our string classes.
::: dom/system/gonk/nsVolumeService.cpp
@@ -192,5 @@
>
> NS\_IMETHODIMP
> nsVolumeService::GetVolumeByPath(const nsAString& aPath, nsIVolume \*\*aResult)
> {
> - nsCString utf8Path = NS\_ConvertUTF16toUTF8(aPath);
Don't we have this pattern everywhere?

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=871462#c5)• 12 years ago |
|  | |

String API is complex...
(In reply to Doug Turner (:dougt) from [comment #4](/show_bug.cgi?id=871462#c4 "RESOLVED FIXED - Clean up String API usages for dom/system/gonk"))
> Comment on [attachment 748718](/attachment.cgi?id=748718 "fix") [[details]](/attachment.cgi?id=748718&action=edit "fix") [[diff]](/attachment.cgi?id=748718&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=748718)
> fix
>
> Review of [attachment 748718](/attachment.cgi?id=748718 "fix") [[details]](/attachment.cgi?id=748718&action=edit "fix") [[diff]](/attachment.cgi?id=748718&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=748718):
> -----------------------------------------------------------------
>
> I \*hate\* our string classes.
>
> ::: dom/system/gonk/nsVolumeService.cpp
> @@ -192,5 @@
> >
> > NS\_IMETHODIMP
> > nsVolumeService::GetVolumeByPath(const nsAString& aPath, nsIVolume \*\*aResult)
> > {
> > - nsCString utf8Path = NS\_ConvertUTF16toUTF8(aPath);
>
> Don't we have this pattern everywhere?
Years ago, although I clean up many code for this case, but I don't know now.
This pattern means,
NS\_ConvertUTF18toUTF8 str(aPath);
nsCString utf8Path(str);
str.~str();
So This allocate unnecessary string object. It is wasteful.

|  | [Doug Turner (:dougt)](/user_profile?user_id=302291) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a1322140_302291)• 12 years ago |

[Attachment #748718](/attachment.cgi?id=748718&action=edit "fix") -
Flags: review?(doug.turner) → review?(dbaron)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=871462#c6)• 12 years ago |
|  | |

Comment on [attachment 748718](/attachment.cgi?id=748718 "fix") [[details]](/attachment.cgi?id=748718&action=edit "fix") [[diff]](/attachment.cgi?id=748718&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=748718)
fix
r=dbaron
At least only the first one looks like it's fixing a crash.
[Attachment #748718](/attachment.cgi?id=748718&action=edit "fix") -
Flags: review?(dbaron) → review+

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a1409796_406194)• 12 years ago |

Keywords: [csec-uaf](/buglist.cgi?keywords=csec-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a1508199_406194)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=871462#c7)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/92ba04c3ee67>Target Milestone: --- → mozilla24

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=871462#c8)• 12 years ago |
|  | |

Attached patch

[for b2g18](attachment.cgi?id=757756&action=diff)
— [Details](attachment.cgi?id=757756&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=757756)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=871462#c9)• 12 years ago |
|  | |

Comment on [attachment 757756](/attachment.cgi?id=757756 "for b2g18") [[details]](/attachment.cgi?id=757756&action=edit "for b2g18") [[diff]](/attachment.cgi?id=757756&action=diff "for b2g18") [[review]](/page.cgi?id=splinter.html&ignore=&bug=871462&attachment=757756)
for b2g18
NOTE: Please see <https://wiki.mozilla.org/Release_Management/B2G_Landing> to better understand the B2G approval process and landings.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [Bug 794903](/show_bug.cgi?id=794903 "RESOLVED FIXED - [b2g-bluetooth] BluetoothSCOManager prototype") and [Bug 796300](/show_bug.cgi?id=796300 "RESOLVED FIXED - [b2g-bluetooth] Set audio device BLUETOOTH_SCO_HEADSET to unavailable when disconnect Sco socket")
User impact if declined: possible crash due to use-after-free bug
Testing completed: landed in m-i
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: no
[Attachment #757756](/attachment.cgi?id=757756&action=edit "for b2g18") -
Flags: approval-mozilla-b2g18?

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=871462#c10)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/92ba04c3ee67>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a2023722_425645)• 12 years ago |

[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%2B)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a2023738_425645)• 12 years ago |

[Attachment #757756](/attachment.cgi?id=757756&action=edit "for b2g18") -
Flags: approval-mozilla-b2g18? → approval-mozilla-b2g18+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=871462#c11)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g18/rev/0539d7c8c001>
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed)
[status-b2g18-v1.0.0](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix)
[status-b2g18-v1.0.1](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=affected)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=871462#c12)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g18_v1_1_0_hd/rev/0539d7c8c001>
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a8778854_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=871462#a48018924_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=871462&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Makoto Kato [:m\_kato]](/user_profile?user_id=8636)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_214ccaa0_20250125_154634.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/898381)
* [XML](/show_bug.cgi?ctype=xml&id=898381)

Closed
[Bug 898381](/show_bug.cgi?id=898381)

Opened 12 years ago
Closed 11 years ago

# IonMonkey: Fix ARM moveValue so that GC pointers are traced

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

IonMonkey: Fix ARM moveValue so that GC pointers are traced

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla25

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [disabled](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=disabled) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 |  | wontfix |
| firefox23 |  | wontfix |
| firefox24 | + | fixed |
| firefox25 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | disabled |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jandem, Assigned: jandem)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

4 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-high, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c8 "11 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Patch](/attachment.cgi?id=781644)  [12 years ago](#c0)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   1.09 KB, patch | mjrosenb : [review+](#c1 "12 years ago")  abillings : [approval-mozilla-aurora+](#c6 "11 years ago")  abillings : [sec-approval+](#c6 "11 years ago") | [Details](/attachment.cgi?id=781644&action=edit) | [Diff](/attachment.cgi?id=781644&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898381&attachment=781644) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=898381#c0)• 12 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=781644&action=diff)
— [Details](attachment.cgi?id=781644&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898381&attachment=781644)

I was reading some unrelated code earlier today and noticed this. I'm not sure it can cause crashes right now, but there are some callers that pass a Value that could be an object/string I think, so let's assume it's possible.
x86/x64 already do this and grep shows this is the only place that uses payload.i32 without an isMarkable() check.
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: review?(mrosenberg)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898381#a90_375297)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F)

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=898381#c1)• 12 years ago |
|  | |

Comment on [attachment 781644](/attachment.cgi?id=781644 "Patch") [[details]](/attachment.cgi?id=781644&action=edit "Patch") [[diff]](/attachment.cgi?id=781644&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898381&attachment=781644)
Patch
Review of [attachment 781644](/attachment.cgi?id=781644 "Patch") [[details]](/attachment.cgi?id=781644&action=edit "Patch") [[diff]](/attachment.cgi?id=781644&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898381&attachment=781644):
-----------------------------------------------------------------
Nothing looks wrong with it, so r+, but I think we should poke a bit first.
::: js/src/ion/arm/MacroAssembler-arm.cpp
@@ +2672,5 @@
> MacroAssemblerARMCompat::moveValue(const Value &val, Register type, Register data) {
> jsval\_layout jv = JSVAL\_TO\_IMPL(val);
> ma\_mov(Imm32(jv.s.tag), type);
> + if (val.isMarkable())
> + ma\_mov(ImmGCPtr(reinterpret\_cast<gc::Cell \*>(val.toGCThing())), data);
Since without the ImmGCPtr, we'd never record the offset, we shouldn't crash due to the wrong instrutions during marking. However, we could not trace through that pointer, and get the standard use-after-collect GC bug. How does x86/x64 handle this case?
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: review?(mrosenberg) → review+

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=898381#c2)• 12 years ago |
|  | |

(In reply to Marty Rosenberg [:mjrosenb] from [comment #1](/show_bug.cgi?id=898381#c1 "RESOLVED FIXED - IonMonkey: Fix ARM moveValue so that GC pointers are traced"))
> Since without the ImmGCPtr, we'd never record the offset, we shouldn't crash
> due to the wrong instrutions during marking. However, we could not trace
> through that pointer, and get the standard use-after-collect GC bug.
Yup, it'd be a use-after-collect GC bug.
> How does x86/x64 handle this case?
See [comment 0](/show_bug.cgi?id=898381#c0 "RESOLVED FIXED - IonMonkey: Fix ARM moveValue so that GC pointers are traced"); x86 already has exactly the same code. x64 has similar code (only difference is due to the different boxing format there).

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=898381#c3)• 12 years ago |
|  | |

Can we get a sec rating? If this isn't something highly exploitable that we'd have to chemspill for - or something attributable to high crash volumes - we're probably not going to track this for FF23 since we're in the homestretch there and our final beta is going to build on Monday.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=898381#c4)• 11 years ago |
|  | |

(In reply to lsblakk@mozilla.com [:lsblakk] from [comment #3](/show_bug.cgi?id=898381#c3 "RESOLVED FIXED - IonMonkey: Fix ARM moveValue so that GC pointers are traced"))
> Can we get a sec rating? If this isn't something highly exploitable that
> we'd have to chemspill for - or something attributable to high crash volumes
> - we're probably not going to track this for FF23 since we're in the
> homestretch there and our final beta is going to build on Monday.
This is potentially sec-critical and can cause all kinds of crashes, but it's likely hard/impossible to trigger atm (fuzzers also didn't find it yet). So either we are lucky and for some reason it's not exploitable right now or maybe we have a sec-critical. Unfortunately I can't say for sure which one it is.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=898381#c5)• 11 years ago |
|  | |

Comment on [attachment 781644](/attachment.cgi?id=781644 "Patch") [[details]](/attachment.cgi?id=781644&action=edit "Patch") [[diff]](/attachment.cgi?id=781644&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898381&attachment=781644)
Patch
lsblakk, I'm requesting sec-approval and aurora approval. Since we don't have a testcase and don't have any evidence this is causing problems right now, I'm fine with taking this on aurora only. If you disagree please a+ for beta too.
[Approval Request Comment]
> Bug caused by (feature/regressing bug #):
IonMonkey.
> User impact if declined:
Maybe crashes, security bugs.
> Testing completed (on m-c, etc.):
Didn't land yet.
> Risk to taking this patch (and alternatives if risky):
Very low.
> String or IDL/UUID changes made by this patch:
None.
[Security approval request comment]
> How easily could an exploit be constructed based on the patch?
Not easy..
> Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
No.
> Which older supported branches are affected by this flaw?
Firefox 18+.
> If not all supported branches, which bug introduced the flaw?
Unknown.
> Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Should be very easy.
> How likely is this patch to cause regressions; how much testing does it need?
Very unlikely.
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: sec-approval?
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: approval-mozilla-aurora?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=898381#c6)• 11 years ago |
|  | |

Comment on [attachment 781644](/attachment.cgi?id=781644 "Patch") [[details]](/attachment.cgi?id=781644&action=edit "Patch") [[diff]](/attachment.cgi?id=781644&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898381&attachment=781644)
Patch
Giving sec-appoval+ to land in trunk. After this, please land on Aurora, which I have also set the approval flag for.
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: sec-approval?
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: sec-approval+
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: approval-mozilla-aurora?
[Attachment #781644](/attachment.cgi?id=781644&action=edit "Patch") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898381#a278767_280903)• 11 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → ---
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898381#a278987_280903)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=%3F)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=898381#c7)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/affe224de780>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=898381#c8)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/affe224de780>Status: ASSIGNED → RESOLVEDClosed: 11 years ago
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla25

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=898381#c9)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/7fbedcc70869>
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898381#a2465528_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=898381#c10)• 11 years ago |
|  | |

This shouldn't affect b2g18 because ionmonkey is disabled there.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=%3F) → [disabled](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=disabled)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898381#a41618838_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=898381&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_7e0e9460_20250125_154636.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/898832)
* [XML](/show_bug.cgi?ctype=xml&id=898832)

Closed
[Bug 898832](/show_bug.cgi?id=898832)

Opened 11 years ago
Closed 11 years ago

# crash in mozilla::dom::NodeBinding::get\_childNodes

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

crash in mozilla::dom::NodeBinding::get\_childNodes

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

23 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla26

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=unaffected) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=verified) |
| firefox26 | --- | [verified](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=verified) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 |  | unaffected |
| firefox23 | + | wontfix |
| firefox24 | + | verified |
| firefox25 | + | verified |
| firefox26 |  | verified |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: scoobidiver, Assigned: h4writer)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/1e19e5f3f314ade17e6a1e04a0f9c819?d=mm&size=40)  [h4writer](/user_profile?user_id=196399)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=40)  [mwobensmith](/user_profile?user_id=452604)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/43a258096978fdc5ca10d5b423b0c178?d=mm&size=40)  [scoobidiver](/user_profile?user_id=386758)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

### ( [URL](http://www.wildundhund.de/forum/viewforum.php?f=40 "http://www.wildundhund.de/forum/viewforum.php?f=40") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[841442](/show_bug.cgi?id=841442 "RESOLVED FIXED - Move HTMLFormElement to WebIDL")

[899035](/show_bug.cgi?id=899035 "RESOLVED FIXED - [Security Review][Fuzzing][LangFuzz] Find testcase for bug 898832 with fuzz patch"), [899934](/show_bug.cgi?id=899934 "RESOLVED FIXED - [Security Review][Fuzzing][jsfunfuzz] Find testcase for bug 898832 with fuzz patch")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[864468](/show_bug.cgi?id=864468 "RESOLVED FIXED - IonMonkey: Skip argument type check when type is known to match"), [930989](/show_bug.cgi?id=930989 "RESOLVED FIXED - IonMonkey: In debug builds always test arguments")

Dependency [tree](/showdependencytree.cgi?id=898832&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=898832)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[895437](/show_bug.cgi?id=895437 "RESOLVED DUPLICATE - TypedArrayTemplate<js::uint8_clamped>::copyFromTypedArray js::GetElement| crash in mozilla::dom::NodeBinding::get_childNodes")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[wildundhund.de/forum/viewforum.php?f=40](http://www.wildundhund.de/forum/viewforum.php?f=40 "http://www.wildundhund.de/forum/viewforum.php?f=40")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c40 "11 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ mozilla::dom::NodeBinding::get\_childNodes ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Adom%3A%3ANodeBinding%3A%3Aget_childNodes)

[[@ @0x0 | mozilla::dom::NodeBinding::get\_childNodes ]](https://crash-stats.mozilla.org/signature/?signature=%400x0%20%7C%20mozilla%3A%3Adom%3A%3ANodeBinding%3A%3Aget_childNodes)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [bug898832-debug-argument-check](/attachment.cgi?id=782522)  [11 years ago](#c7)  [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)   3.51 KB, patch |  | [Details](/attachment.cgi?id=782522&action=edit) | [Diff](/attachment.cgi?id=782522&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=782522) |
| --- | --- | --- |
| [bug898832-debug-argument-check (for tip)](/attachment.cgi?id=783853)  [11 years ago](#c10)  [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)   3.52 KB, patch | jandem : [review+](#c25 "11 years ago") | [Details](/attachment.cgi?id=783853&action=edit) | [Diff](/attachment.cgi?id=783853&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=783853) |
| [bug898832-argcheck](/attachment.cgi?id=785014)  [11 years ago](#c13)  [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)   1000 bytes, patch | bhackett1024 : [review+](#a460769_346231 "11 years ago")  bajaj : [approval-mozilla-aurora+](#a1078790_448925 "11 years ago")  bajaj : [approval-mozilla-beta+](#a1078790_448925 "11 years ago")  dveditz : [sec-approval+](#c23 "11 years ago") | [Details](/attachment.cgi?id=785014&action=edit) | [Diff](/attachment.cgi?id=785014&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=785014) |
| [bug898832-debug-argument-check (for beta, ff24)](/attachment.cgi?id=794545)  [11 years ago](#c48)  [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)   3.40 KB, patch |  | [Details](/attachment.cgi?id=794545&action=edit) | [Diff](/attachment.cgi?id=794545&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=794545) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=898832#c0)• 11 years ago |
|  | |

It's #48 browser crasher in 23.0b8 and #15 in the first day of 23.0b9.
Using mozregression, the regression range is:
<http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=b980d32c366f&tochange=ea059733677c>
and the working range is:
<http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=d2a7cfa34154&tochange=8ea92aeab783>
It might be fixed by [bug 884401](/show_bug.cgi?id=884401 "RESOLVED FIXED - Remove the hasXPConnectImpls annotations from HTMLElement, Element, and Node and the corresponding quickstub bits")'s patch.
Signature mozilla::dom::NodeBinding::get\_childNodes More Reports Search
UUID e4aa87e5-24e7-4e0e-8da1-db5842130728
Date Processed 2013-07-28 08:05:27.125889
Uptime 22
Last Crash 27 seconds before submission
Install Age 51551 since version was first installed.
Install Time 2013-07-27 17:46:07
Product Firefox
Version 23.0
Build ID 20130725195523
Release Channel beta
OS Windows NT
OS Version 6.1.7601 Service Pack 1
Build Architecture x86
Build Architecture Info GenuineIntel family 6 model 23 stepping 10 | 2
Crash Reason EXCEPTION\_ACCESS\_VIOLATION\_EXEC
Crash Address 0x12143c20
App Notes
AdapterVendorID: 0x8086, AdapterDeviceID: 0x2a42, AdapterSubsysID: 02051025, AdapterDriverVersion: 8.15.10.2202
D2D? D2D+ DWrite? DWrite+ D3D10 Layers? D3D10 Layers+
Frame Module Signature Source
0 @0x12143c20
1 xul.dll mozilla::dom::NodeBinding::get\_childNodes obj-firefox/dom/bindings/NodeBinding.cpp
2 mozjs.dll ToLowerCaseHelper js/src/jsstr.cpp
3 @0x1
4 @0x1f8c03bc
More reports at:
<https://crash-stats.mozilla.com/report/list?product=Firefox&signature=mozilla%3A%3Adom%3A%3ANodeBinding%3A%3Aget_childNodes>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=898832#c1)• 11 years ago |
|  | |

That stack is not useful.... :(

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=898832#c2)• 11 years ago |
|  | |

Regression window
Good:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/c9737a4136cf>
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:23.0) Gecko/20130507 Firefox/23.0 ID:20130507225450
Bad:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/e698d3534b96>
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:23.0) Gecko/20130507 Firefox/23.0 ID:20130508010349
Pushlog:
<http://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=c9737a4136cf&tochange=e698d3534b96>
In local build(ubuntu)
Last Good: ef2134c93dae
First Bad: 92a5a4a9b76b
Regressed by:
92a5a4a9b76b Hannes Verschore — [Bug 864468](/show_bug.cgi?id=864468 "RESOLVED FIXED - IonMonkey: Skip argument type check when type is known to match"): IonMonkey: Skip argument type checks when type is known to match, r=jandem
Working window
Bad:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/5458a7880db5>
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:24.0) Gecko/20130619 Firefox/24.0 ID:20130619062021
Good:
<http://hg.mozilla.org/integration/mozilla-inbound/rev/259e68f8843d>
Mozilla/5.0 (Windows NT 6.1; WOW64; rv:24.0) Gecko/20130619 Firefox/24.0 ID:20130619072522
Pushlog:
<http://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=5458a7880db5&tochange=259e68f8843d>
Fixed by
259e68f8843d Andrea Marchesini — [Bug 841442](/show_bug.cgi?id=841442 "RESOLVED FIXED - Move HTMLFormElement to WebIDL") - Move HTMLFormElement to WebIDL, r=bzBlocks: [864468](/show_bug.cgi?id=864468 "RESOLVED FIXED - IonMonkey: Skip argument type check when type is known to match")

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a37346_293623)• 11 years ago |

OS: Windows 7 → All

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=898832#c3)• 11 years ago |
|  | |

Hmm. That's very odd... What testcase did you use to reproduce this? Were we incorrectly invoking the specialized getter on a form in some cases???Flags: needinfo?(alice0775)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=898832#c4)• 11 years ago |
|  | |

Oh, nevermind, the testcase is in the url field; it's just not mentioned in the comments.
So [comment 3](/show_bug.cgi?id=898832#c3 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes") is correct: we're invoking mozilla::dom::NodeBinding::get\_childNodes directly from jitcode but 'obj' is an XPConnect object (in particular it has obj->getClass()->addProperty == XPC\_WN\_Helper\_AddProperty and so forth). It's an XPConnect wrapper for a <form>: it has obj->getClass()->name as "HTMLFormElement".
Jandem, Hannes, I would expect that this is exploitable if one tries hard enough... how are we managing to fail the TI bits here? Furthermore, I would expect it to be possible to write exploits for trunk and 24; just have to get non-DOM objects through this codepath.Group: dom-core-security
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)Flags: needinfo?(jdemooij)Flags: needinfo?(hv1989)Flags: needinfo?(alice0775)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=898832#c5)• 11 years ago |
|  | |

Oh, and I don't understand how [bug 864468](/show_bug.cgi?id=864468 "RESOLVED FIXED - IonMonkey: Skip argument type check when type is known to match") would trigger this, since we're dealing with a property getter, not a method call... unless the problem is that we're now screwing up the types of things inside a method somehow?Group: dom-core-security → core-security

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=898832#c6)• 11 years ago |
|  | |

Hannes can you take a look?Assignee: nobody → hv1989Status: NEW → ASSIGNEDFlags: needinfo?(jdemooij)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=898832#c7)• 11 years ago |
|  | |

Attached patch

[bug898832-debug-argument-check](attachment.cgi?id=782522&action=diff) (obsolete)
— [Details](attachment.cgi?id=782522&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=782522)

I created a patch that will assert in debug build if we end up with wrong type information after skipping the argument check. This should make it possible for fuzzers to find quite easily if [Bug 864468](/show_bug.cgi?id=864468 "RESOLVED FIXED - IonMonkey: Skip argument type check when type is known to match") is indeed the blame and normally should give a much easier testcase.
(Ran jit-tests, but nothing failed)
@gkw, decoder: could you run a fuzzer with this patch? It sets a breakpoint if something wrongs happens. It would also be awesome to get the testcase if it fails.
[Attachment #782522](/attachment.cgi?id=782522&action=edit "bug898832-debug-argument-check") -
Flags: feedback?(gary)
[Attachment #782522](/attachment.cgi?id=782522&action=edit "bug898832-debug-argument-check") -
Flags: feedback?(choller)Flags: needinfo?(hv1989)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=898832#c8)• 11 years ago |
|  | |

With the attached patch, on the testcase for this bug I definitely hit SIGTRAP from jitcode in a debugger, for what that's worth.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a93491_20209)• 11 years ago |

[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=unaffected) → [?](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=%3F)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a95808_395101)• 11 years ago |

Depends on: [899035](/show_bug.cgi?id=899035 "RESOLVED FIXED - [Security Review][Fuzzing][LangFuzz] Find testcase for bug 898832 with fuzz patch")

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=898832#c9)• 11 years ago |
|  | |

Will track this while investigation is underway but we're about to build our final beta today so unless something exploitable is uncovered that would make this chemspill-worthy we'll probably wontfix this for FF23
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a166658_386758)• 11 years ago |

Crash Signature: [@ mozilla::dom::NodeBinding::get\_childNodes] → [@ mozilla::dom::NodeBinding::get\_childNodes]
[@ @0x0 | mozilla::dom::NodeBinding::get\_childNodes ]Depends on: [841442](/show_bug.cgi?id=841442 "RESOLVED FIXED - Move HTMLFormElement to WebIDL")Hardware: x86 → AllWhiteboard: [workingwindow-wanted]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a206971_406194)• 11 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a257370_132034)• 11 years ago |

Depends on: [899934](/show_bug.cgi?id=899934 "RESOLVED FIXED - [Security Review][Fuzzing][jsfunfuzz] Find testcase for bug 898832 with fuzz patch")

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=898832#c10)• 11 years ago |
|  | |

Attached patch

[bug898832-debug-argument-check (for tip)](attachment.cgi?id=783853&action=diff)
— [Details](attachment.cgi?id=783853&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=783853)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=898832#c11)• 11 years ago |
|  | |

Fuzzer found the following testcase after 3 days:
try {
var fib = new Intl.Collator(it, options);
} catch(exc0) {}
var functions = {
toLocaleTimeString: Date.prototype.toLocaleTimeString
};
var locales = [ [NaN], ["de\_DE"] ];
Object.getOwnPropertyNames(functions).forEach(function (p) {
var f = functions[p];
locales.forEach(function (locales) {
try {
var format = new Intl.DateTimeFormat(locales);
} catch (e) { }
try {
var result = f.call(new Date(), locales);
} catch (e) { }
});
});
Causes sigtrap for me on a 32 bit optimized build (I removed the #ifdef DEBUG, but it might also reproduce on a debug build). Hannes, is that what you wanted me to find?Flags: needinfo?(hv1989)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=898832#c12)• 11 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #11](/show_bug.cgi?id=898832#c11 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> Fuzzer found the following testcase after 3 days:
\0/, this indeed trips on the argumentcheck, THANKS!Flags: needinfo?(hv1989)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a454817_196399)• 11 years ago |

[Attachment #782522](/attachment.cgi?id=782522&action=edit "bug898832-debug-argument-check") -
Attachment is obsolete: true
[Attachment #782522](/attachment.cgi?id=782522&action=edit "bug898832-debug-argument-check") -
Flags: feedback?(gary)
[Attachment #782522](/attachment.cgi?id=782522&action=edit "bug898832-debug-argument-check") -
Flags: feedback?(choller)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=898832#c13)• 11 years ago |
|  | |

Attached patch

[bug898832-argcheck](attachment.cgi?id=785014&action=diff)
— [Details](attachment.cgi?id=785014&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=785014)

That's the culprit. If the argument was expected to be a specific object, we also removed the argument when it was only typed an object (not specific). So the called script would assume a specific object, but could get anything.
This is very bad and hackers will be pleased to try to exploit this. So I think we want this in all versions. I also think this might be worthy to get into FF23 (that is now on his last beta). Fix is really simple and shouldn't introduce something new. So would be very low risk, but it removes a big potential vector for hackers
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: review?(bhackett1024)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=898832#c14)• 11 years ago |
|  | |

Comment on [attachment 783853](/attachment.cgi?id=783853 "bug898832-debug-argument-check (for tip)") [[details]](/attachment.cgi?id=783853&action=edit "bug898832-debug-argument-check (for tip)") [[diff]](/attachment.cgi?id=783853&action=diff "bug898832-debug-argument-check (for tip)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=783853)
[bug898832](/show_bug.cgi?id=898832 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes")-debug-argument-check (for tip)
Review of [attachment 783853](/attachment.cgi?id=783853 "bug898832-debug-argument-check (for tip)") [[details]](/attachment.cgi?id=783853&action=edit "bug898832-debug-argument-check (for tip)") [[diff]](/attachment.cgi?id=783853&action=diff "bug898832-debug-argument-check (for tip)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=783853):
-----------------------------------------------------------------
I like to get this patch also in, now that we found the culprit. I will only land it after the fix goes in, to make sure we don't give extra tools to hackers to find this issue.
[Attachment #783853](/attachment.cgi?id=783853&action=edit "bug898832-debug-argument-check (for tip)") -
Flags: review?(jdemooij)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=898832#c15)• 11 years ago |
|  | |

Hannes, I assume you verified that this fixes the original testcase here?

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=898832#c16)• 11 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #15](/show_bug.cgi?id=898832#c15 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> Hannes, I assume you verified that this fixes the original testcase here?
Oh good call. I haven't been able to test it yet. I have build my own build, but it doesn't crash here :(. The description posted above does indicate this fix would work. But I think you could reproduce right? Can you test it?

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=898832#c17)• 11 years ago |
|  | |

(In reply to Hannes Verschore [:h4writer] from [comment #13](/show_bug.cgi?id=898832#c13 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> I also think this might be worthy to get
> into FF23 (that is now on his last beta).
Actually, the release builds have already been built, so that QA has time to sign off before we release on Tuesday. Unless this is a 0-day, I don't think we can still shove it into 23. That said, if this is exploitable, 1) the security rating should be re-evaluated (maybe it's sec-crit then?) and 2) you should ask for sec-approval before landing anywhere.

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a460769_346231)• 11 years ago |

[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: review?(bhackett1024)
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=898832#c18)• 11 years ago |
|  | |

> I have build my own build, but it doesn't crash here :(
Is it a build from rev 5458a7880db5? See [comment 2](/show_bug.cgi?id=898832#c2 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"), which changed DOM code to effectively mask this bug....

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=898832#c19)• 11 years ago |
|  | |

Changed to sec-crit. We assume an object and therefore the layout of it (e.g. how many slots we have). Resulting code can therefore specialize and will remove the otherwise needed checks. Here we can take an arbitrary object (that doesn't fit the description on what we compiled). So as a result we could be reading/writing in slots that the object doesn't have. So in uninitialized or unexpected memory. (This is just speculation and I didn't try to exploit it myself.)
(In reply to Boris Zbarsky (:bz) from [comment #18](/show_bug.cgi?id=898832#c18 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> > I have build my own build, but it doesn't crash here :(
>
> Is it a build from rev 5458a7880db5? See [comment 2](/show_bug.cgi?id=898832#c2 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"), which changed DOM code
> to effectively mask this bug....
No, I tried 92a5a4a9b76b, that is the blamed revision.Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=898832#c20)• 11 years ago |
|  | |

Comment on [attachment 785014](/attachment.cgi?id=785014 "bug898832-argcheck") [[details]](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") [[diff]](/attachment.cgi?id=785014&action=diff "bug898832-argcheck") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=785014)
[bug898832](/show_bug.cgi?id=898832 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes")-argcheck
[Security approval request comment]
- How easily could an exploit be constructed based on the patch?
I think the exploit isn't that easy to find, but when understanding the provided two-liner patch and IM code, it might be rather easy to know how to abuse this. There is still the question to create the exploit itself.
So I think this need to get fixed on all branches (what seems it will not happen for 23, since we are to far in the release). So if we land to 24/25 only, I really think we should mask this patch into another unrelated patch! (Not sure if that is done, but I find it rather tricky to only commit this to aurora/nightly and don't fix beta with the current patch). I thought a lot of people are eavesdropping the commits right?
- Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
\* No comments
\* Not sure what to do about the check-in comment. See above comment
\* No tests
- Which older supported branches are affected by this flaw?
23/24/25 (beta/aurora/nightly)
- If not all supported branches, which bug introduced the flaw?
[bug 864468](/show_bug.cgi?id=864468 "RESOLVED FIXED - IonMonkey: Skip argument type check when type is known to match")
- Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
They should be all the same. (That codepath hasn't changed since the introduction)
- How likely is this patch to cause regressions; how much testing does it need?
Pure speculative this could introduce a speed regression. But since we don't hit this case often (= never) (hence fuzzing took that long to create a testcase, also I haven't seen it happening in the wild on various JS sites, while browser for 3 days to find a testcase and dedicated opening JS heavy sites). I very confident to say, testing should be ok with testing the testcase and running jit-tests.
(Still I need to test if it fixes the original problem, but I'm rather sure it is. If it isn't the same, I'll open another bug. This issue found here really needs to get fixed!)
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: sec-approval?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=898832#c21)• 11 years ago |
|  | |

> No, I tried 92a5a4a9b76b, that is the blamed revision.
OK. I had reproduced with 5458a7880db5, but I no longer have that build around...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=898832#c22)• 11 years ago |
|  | |

Er, actually I do still have it around. But now it's no reproducing the crash on the page in the url field. :(

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a736423_1689)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=898832#c23)• 11 years ago |
|  | |

Comment on [attachment 785014](/attachment.cgi?id=785014 "bug898832-argcheck") [[details]](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") [[diff]](/attachment.cgi?id=785014&action=diff "bug898832-argcheck") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=785014)
[bug898832](/show_bug.cgi?id=898832 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes")-argcheck
The merge has already happened today, so now it will need to land on beta, aurora, and trunk to hit Fx 24/25/26; Fx23 is practically out the door so that will remain unfixed.
Might as well land now with the initial flurry of "fix the first beta" bugs, if anything it will stand out more later. sec-approval+
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: sec-approval? → sec-approval+

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=898832#c24)• 11 years ago |
|  | |

Comment on [attachment 785014](/attachment.cgi?id=785014 "bug898832-argcheck") [[details]](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") [[diff]](/attachment.cgi?id=785014&action=diff "bug898832-argcheck") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=785014)
[bug898832](/show_bug.cgi?id=898832 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes")-argcheck
[Approval Request Comment]
- Bug caused by (feature/regressing bug #):
[bug 864468](/show_bug.cgi?id=864468 "RESOLVED FIXED - IonMonkey: Skip argument type check when type is known to match")
- User impact if declined:
Possibility to crash/exploit the browser
- Testing completed (on m-c, etc.):
Not landed on any branch yet. Jit-tests succeed + found testcase.
- Risk to taking this patch (and alternatives if risky):
Very small. This patch reenables the old path (that is used in most cases) a bit more eagerly. So we don't hit the potential exploit
String or IDL/UUID changes made by this patch: /
(This request is for FF24/25, since we just merged, not for FF23)
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: approval-mozilla-beta?
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: approval-mozilla-aurora?

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=898832#c25)• 11 years ago |
|  | |

Comment on [attachment 783853](/attachment.cgi?id=783853 "bug898832-debug-argument-check (for tip)") [[details]](/attachment.cgi?id=783853&action=edit "bug898832-debug-argument-check (for tip)") [[diff]](/attachment.cgi?id=783853&action=diff "bug898832-debug-argument-check (for tip)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=783853)
[bug898832](/show_bug.cgi?id=898832 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes")-debug-argument-check (for tip)
Review of [attachment 783853](/attachment.cgi?id=783853 "bug898832-debug-argument-check (for tip)") [[details]](/attachment.cgi?id=783853&action=edit "bug898832-debug-argument-check (for tip)") [[diff]](/attachment.cgi?id=783853&action=diff "bug898832-debug-argument-check (for tip)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=783853):
-----------------------------------------------------------------
Great!
::: js/src/ion/CodeGenerator.cpp
@@ +2162,5 @@
> +CodeGenerator::generateArgumentsChecks(bool bailout)
> +{
> + // This function can be used the normal way to check the argument types,
> + // before entering the function and bailout when arguemnts don't match.
> + // For debug purpose, this is can also be used to force/check that the
Nit: "For debugging purposes, this can also..."
[Attachment #783853](/attachment.cgi?id=783853&action=edit "bug898832-debug-argument-check (for tip)") -
Flags: review?(jdemooij) → review+

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=898832#c26)• 11 years ago |
|  | |

It's #11 top browser crasher in the first days of 23.0 + a security issue. I think it should be in a chemspill.
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)Keywords: [topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=898832#c27)• 11 years ago |
|  | |

I'm waiting for an update to push to aurora/beta! I want to get this in as quickly as possible. (But I want to do it all at the same time!).
I'm also for release chemspill. It is really a nasty security bug and apparently it is a #11 browser crash. I assume that will get investigated by security people finding the issue?

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=898832#c28)• 11 years ago |
|  | |

(In reply to Hannes Verschore [:h4writer] from [comment #27](/show_bug.cgi?id=898832#c27 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> I'm waiting for an update to push to aurora/beta! I want to get this in as
> quickly as possible. (But I want to do it all at the same time!).
>
> I'm also for release chemspill. It is really a nasty security bug and
> apparently it is a #11 browser crash. I assume that will get investigated by
> security people finding the issue?
I filed [Bug 895437](/show_bug.cgi?id=895437 "RESOLVED DUPLICATE - TypedArrayTemplate<js::uint8_clamped>::copyFromTypedArray js::GetElement| crash in mozilla::dom::NodeBinding::get_childNodes") some time before that bug and seems this is really on real world sites - and this 2 issues seems to be same :(

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=898832#c29)• 11 years ago |
|  | |

btw i made some investigation over in Bug [https://bugzilla.mozilla.org/show\_bug.cgi?id=895437#c16](/show_bug.cgi?id=895437#c16 "RESOLVED DUPLICATE - TypedArrayTemplate<js::uint8_clamped>::copyFromTypedArray js::GetElement| crash in mozilla::dom::NodeBinding::get_childNodes") and seems this problem is already fixed in aurora and beta.
When i filed [bug 895437](/show_bug.cgi?id=895437 "RESOLVED DUPLICATE - TypedArrayTemplate<js::uint8_clamped>::copyFromTypedArray js::GetElement| crash in mozilla::dom::NodeBinding::get_childNodes") i noticed that this crash didn't happen in aurora and nightly so maybe whatever fixed this is now uplifted from aurora -> beta and so fix the problem on beta

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=898832#c30)• 11 years ago |
|  | |

The same happened with this bug. Due to some changes we don't crash anymore. BUT the issue is not gone! This is still exploitable! Add patch "debug-arguments-check" and you'll still notice sigtraps. Decoder also found a minimal testcase in [comment 11](/show_bug.cgi?id=898832#c11 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"). I'm sure if crafted correctly we can crash the browser again or even worse...

|  | [Scoobidiver (away)](/user_profile?user_id=386758)  Reporter |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=898832#c32)• 11 years ago |
|  | |

(In reply to Hannes Verschore [:h4writer] from [comment #30](/show_bug.cgi?id=898832#c30 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> Due to some changes we don't crash anymore.
The ref. URL doesn't crash Firefox but comments for 23.0 Release state it's still about German forums.
(In reply to Scoobidiver from [comment #26](/show_bug.cgi?id=898832#c26 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> It's #11 top browser crasher in the first days of 23.0
Now #14.

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=898832#c33)• 11 years ago |
|  | |

(In reply to Hannes Verschore [:h4writer] from [comment #27](/show_bug.cgi?id=898832#c27 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> I'm waiting for an update to push to aurora/beta! I want to get this in as
> quickly as possible. (But I want to do it all at the same time!).
>
Branch uplift Approval is awaiting m-c landing here.
> I'm also for release chemspill. It is really a nasty security bug and
> apparently it is a #11 browser crash. I assume that will get investigated by
> security people finding the issue?

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=898832#c34)• 11 years ago |
|  | |

I'm fine with just pushing. I'm just concerned that will increase awareness of the bug... But that's just my opinion. Like said in [comment 20](/show_bug.cgi?id=898832#c20 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"), it is quite easy to guess what is wrong and create a testcase by just reading the patch...
But this is only my first security bug that serious. So I'll just listen. If you think it is better to push to trunk now, I will do it immediately ...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a1077306_20209)• 11 years ago |

Flags: needinfo?(bbajaj)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=898832#c35)• 11 years ago |
|  | |

Given [comment 26](/show_bug.cgi?id=898832#c26 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes") you could easily justify a check-in comment such as
"[bug 898832](/show_bug.cgi?id=898832 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes") fix topcrash regression" or some such.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=898832#c36)• 11 years ago |
|  | |

(In reply to bhavana bajaj [:bajaj] from [comment #33](/show_bug.cgi?id=898832#c33 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> Branch uplift Approval is awaiting m-c landing here.
We shouldn't need to land on m-c for this change. The intent of that guideline is to shake out potential regressions before inflicting the branch with problems. This is a simple change that will be easy to back out if it does cause regressions, seems unlikely that it will cause regressions, and given it's a dangerous security bug the regressions are likely less bad than having this unfixed. And if there are subtle regressions it's more likely to be found by the huge beta audience, and the sooner we get it into their hands the better chance we have of finding any.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=898832#c37)• 11 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #36](/show_bug.cgi?id=898832#c36 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> We shouldn't need to land on m-c for this change.
... before landing on branches. Of course we do need to land on m-c to fix the bug there.

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=898832#c38)• 11 years ago |
|  | |

Thanks Dan !
[:h4writer], Please go ahead and land everywhere, approving for branches now.Flags: needinfo?(bbajaj)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a1078790_448925)• 11 years ago |

[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: approval-mozilla-beta?
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: approval-mozilla-beta+
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: approval-mozilla-aurora?
[Attachment #785014](/attachment.cgi?id=785014&action=edit "bug898832-argcheck") -
Flags: approval-mozilla-aurora+

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a1078817_448925)• 11 years ago |

[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=898832#c39)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/b31a5d8c5e7f>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/7c52efc15dfd>
<https://hg.mozilla.org/releases/mozilla-beta/rev/73848fcdb8bb>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=898832#c40)• 11 years ago |
|  | |

Seems like we should try to write a test for this?Status: ASSIGNED → RESOLVEDClosed: 11 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla26

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=898832#c41)• 11 years ago |
|  | |

We have one, [comment 11](/show_bug.cgi?id=898832#c11 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"). But we shouldn't make this viewable until FF23 is fixed!!

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=898832#c42)• 11 years ago |
|  | |

Is this wontfix for 23 given we already shipped Firefox 23.0.1 without this fix? Should the case be made for a 23.0.2 to take this fix?Flags: needinfo?(release-mgmt)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=898832#c43)• 11 years ago |
|  | |

Matt, can you please verify this is fixed for Firefox 24 through 26?QA Contact: mwobensmith

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a2189640_279076)• 11 years ago |

Keywords: [verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=898832#c44)• 11 years ago |
|  | |

(In reply to Anthony Hughes, Mozilla QA (:ashughes) from [comment #42](/show_bug.cgi?id=898832#c42 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> Is this wontfix for 23 given we already shipped Firefox 23.0.1 without this
> fix? Should the case be made for a 23.0.2 to take this fix?
Given the small/easy fix, with almost no possibility to regressions, the reduction in crashes and removal of possible serious exploit. I would vote yes. (Off course it is not my decision. Just giving more reasons ;))

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=898832#c45)• 11 years ago |
|  | |

The wontfix was due to this not being ready for final beta of 23.0 - on its own (at #15 in the topcrash list at 0.48%) this is not a driver for another chemspill unless the security team has a different thinking it seems like we can wait 4 weeks to 24.0's releaseFlags: needinfo?(release-mgmt) → needinfo?(dveditz)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=898832#c46)• 11 years ago |
|  | |

I can't repro the original bug using decoder's test or the URL above. I've tried pretty much all builds, pre-2013-07-28, dbg/opt, 32/64, Mac/Win/Linux. No crash, assert, warning or anything, and sadly I can't seem to get the patch from [attachment #1](/attachment.cgi?id=1 "Applied this patch and build worked") [[details]](/attachment.cgi?id=1&action=edit "Applied this patch and build worked") [[diff]](/attachment.cgi?id=1&action=diff "Applied this patch and build worked") [[review]](/page.cgi?id=splinter.html&ignore=&bug=4761&attachment=1) applied to my own build, either.
So I'd like to appeal to decoder - or anyone who has been able to reliably reproduce - to verify that we can no longer do so, on any and all branches 24-26 if possible. Thank you.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=898832#c47)• 11 years ago |
|  | |

I verified this on nightly and aurora, but on beta, the patch that traps the failing condition doesn't apply. Hannes, can you rebase that patch so I can test on beta?
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=verified)
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=verified)Flags: needinfo?(hv1989)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=898832#c48)• 11 years ago |
|  | |

Attached patch

[bug898832-debug-argument-check (for beta, ff24)](attachment.cgi?id=794545&action=diff)
— [Details](attachment.cgi?id=794545&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=898832&attachment=794545)

Sure thingFlags: needinfo?(hv1989)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a2244794_196399)• 11 years ago |

[Attachment #794545](/attachment.cgi?id=794545&action=edit "bug898832-debug-argument-check (for beta, ff24)") -
Attachment description: bug898832-debug-argument-check (for beta, ff25) → bug898832-debug-argument-check (for beta, ff24)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=898832#c49)• 11 years ago |
|  | |

Verified using the new patch.
Please note that I \*only\* did jsshell verification based on the test in [comment 11](/show_bug.cgi?id=898832#c11 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"). I did not create browser builds to test the URL.
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=898832#c50)• 11 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #49](/show_bug.cgi?id=898832#c49 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"))
> Verified using the new patch.
>
> Please note that I \*only\* did jsshell verification based on the test in
> [comment 11](/show_bug.cgi?id=898832#c11 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes"). I did not create browser builds to test the URL.
The url is very fragile. I even think the site has changed and does not trigger it anymore.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a2557261_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a3758303_279076)• 11 years ago |

Status: RESOLVED → VERIFIEDKeywords: [verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=898832#c51)• 11 years ago |
|  | |

Setting myself as needinfo to land debug patch when FF24 takes FF23 over. So we don't have an active exploitable version anymore.Flags: needinfo?(hv1989)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a7704790_196399)• 11 years ago |

Blocks: [930989](/show_bug.cgi?id=930989 "RESOLVED FIXED - IonMonkey: In debug builds always test arguments")

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=898832#c52)• 11 years ago |
|  | |

Debug patch landed in [bug 930989](/show_bug.cgi?id=930989 "RESOLVED FIXED - IonMonkey: In debug builds always test arguments")Flags: needinfo?(hv1989)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a8068238_1689)• 11 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a24341031_1689)• 11 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=898832#a177483228_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=898832&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Hannes Verschore [:h4writer]](/user_profile?user_id=196399)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_00487b62_20250126_100125.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 02:01:25 PST

* **Bug ID:**
  750932,
  871462,
  847606,
  863935,
  893519,
  895294,
  876878,
  898381,
  896126,
  898832,
  873073,
  854897,
  851982,
  883450,
  909494

---

15 bugs found.

| [ID](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [883450](/show_bug.cgi?id=883450 "RESOLVED FIXED - Conservative Stack Scanner doesn't work when not in a request") |  | [Conservative Stack Scanner doesn't work when not in a request](/show_bug.cgi?id=883450) | Core | JavaScript Engine | bholley | RESO | FIXE | 2014-11-19 |
| [847606](/show_bug.cgi?id=847606 "RESOLVED FIXED - Crash with ion, setTimeout(Array.prototype.filter)") |  | [Crash with ion, setTimeout(Array.prototype.filter)](/show_bug.cgi?id=847606) | Core | JavaScript Engine | jdemooij | RESO | FIXE | 2014-11-19 |
| [898381](/show_bug.cgi?id=898381 "RESOLVED FIXED - IonMonkey: Fix ARM moveValue so that GC pointers are traced") |  | [IonMonkey: Fix ARM moveValue so that GC pointers are traced](/show_bug.cgi?id=898381) | Core | JavaScript Engine | jdemooij | RESO | FIXE | 2014-11-19 |
| [854897](/show_bug.cgi?id=854897 "RESOLVED FIXED - Medium exploitable crash [@ IndicShape] with EXCEPTION_STACK_BUFFER_OVERRUN [WinXP]") |  | [Medium exploitable crash [@ IndicShape] with EXCEPTION\_STACK\_BUFFER\_OVERRUN [WinXP]](/show_bug.cgi?id=854897) | Core | Graphics | jfkthame | RESO | FIXE | 2015-08-14 |
| [871462](/show_bug.cgi?id=871462 "RESOLVED FIXED - Clean up String API usages for dom/system/gonk") |  | [Clean up String API usages for dom/system/gonk](/show_bug.cgi?id=871462) | Core | DOM: Device Interfac | m\_kato | RESO | FIXE | 2014-11-19 |
| [893519](/show_bug.cgi?id=893519 "RESOLVED FIXED - Compartment mismatch with asm module in event listener attribute") |  | [Compartment mismatch with asm module in event listener attribute](/show_bug.cgi?id=893519) | Core | DOM: Events | mail | RESO | FIXE | 2014-11-19 |
| [863935](/show_bug.cgi?id=863935 "RESOLVED FIXED - Use-after-poison in nsFrameList::UnhookFrameFromSiblings with moz-column") |  | [Use-after-poison in nsFrameList::UnhookFrameFromSiblings with moz-column](/show_bug.cgi?id=863935) | Core | Layout: Block and In | MatsPalmgren\_bugz | RESO | FIXE | 2014-10-24 |
| [750932](/show_bug.cgi?id=750932 "RESOLVED FIXED - ASAN: Test test_multipart_streamconv_missing_lead_boundary.js triggers error") |  | [ASAN: Test test\_multipart\_streamconv\_missing\_lead\_boundary.js triggers error](/show_bug.cgi?id=750932) | Core | Networking | mcmanus | RESO | FIXE | 2014-11-19 |
| [876878](/show_bug.cgi?id=876878 "RESOLVED FIXED - crash in webrtc::videocapturemodule::GetMaxOfFrameArray") |  | [crash in webrtc::videocapturemodule::GetMaxOfFrameArray](/show_bug.cgi?id=876878) | Core | WebRTC | rjesup | RESO | FIXE | 2014-11-19 |
| [909494](/show_bug.cgi?id=909494 "RESOLVED FIXED - Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis") |  | [Crash with SIGTRAP with ParallelArray and --ion-check-range-analysis](/show_bug.cgi?id=909494) | Core | JavaScript Engine | sunfish | RESO | FIXE | 2015-06-30 |
| [851982](/show_bug.cgi?id=851982 "RESOLVED FIXED - Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP (#2)") |  | [Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP (#2)](/show_bug.cgi?id=851982) | Core | Networking | VYV03354 | RESO | FIXE | 2014-11-19 |
| [896126](/show_bug.cgi?id=896126 "VERIFIED FIXED - Assertion failure: parent, at jswrapper.cpp") |  | [Assertion failure: parent, at jswrapper.cpp](/show_bug.cgi?id=896126) | Core | JavaScript Engine | bholley | VERI | FIXE | 2014-11-19 |
| [895294](/show_bug.cgi?id=895294 "VERIFIED FIXED - Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing") |  | [Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing](/show_bug.cgi?id=895294) | Core | DOM: Core & HTML | continuation | VERI | FIXE | 2019-03-13 |
| [898832](/show_bug.cgi?id=898832 "VERIFIED FIXED - crash in mozilla::dom::NodeBinding::get_childNodes") |  | [crash in mozilla::dom::NodeBinding::get\_childNodes](/show_bug.cgi?id=898832) | Core | DOM: Core & HTML | hv1989 | VERI | FIXE | 2019-03-13 |
| [873073](/show_bug.cgi?id=873073 "VERIFIED FIXED - nsNativeThemeWin seems to spin event loop during layout") |  | [nsNativeThemeWin seems to spin event loop during layout](/show_bug.cgi?id=873073) | Core | Widget: Win32 | jmathies | VERI | FIXE | 2014-11-19 |

15 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=750932%2C871462%2C847606%2C863935%2C893519%2C895294%2C876878%2C898381%2C896126%2C898832%2C873073%2C854897%2C851982%2C883450%2C909494&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |

[File
a new bug
in the "Core" product](/enter_bug.cgi?product=Core)



=== Content from bugzilla.mozilla.org_440de914_20250125_154631.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/895294)
* [XML](/show_bug.cgi?ctype=xml&id=895294)

Closed
[Bug 895294](/show_bug.cgi?id=895294)

Opened 12 years ago
Closed 11 years ago

# Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla26

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=verified) |
| firefox26 | [+](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=verified) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 |  | wontfix |
| firefox24 | + | verified |
| firefox25 | + | verified |
| firefox26 | + | verified |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: mccr8)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main24+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main24+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 1 obsolete file)

| [testcase](/attachment.cgi?id=777636)  [12 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   788 bytes, text/html |  | [Details](/attachment.cgi?id=777636&action=edit) |
| --- | --- | --- |
| [stack](/attachment.cgi?id=777637)  [12 years ago](#c2)  [Jesse Ruderman](/user_profile?user_id=11608)   20.01 KB, text/plain |  | [Details](/attachment.cgi?id=777637&action=edit) |
| [stack for destroy](/attachment.cgi?id=787871)  [11 years ago](#c15)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   5.04 KB, text/plain |  | [Details](/attachment.cgi?id=787871&action=edit) |
| [variant, works without unsafe\_eager\_compilation](/attachment.cgi?id=788401)  [11 years ago](#c19)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   811 bytes, text/html |  | [Details](/attachment.cgi?id=788401&action=edit) |
| [preserve wrapper in last case in EnsureExpandoObject](/attachment.cgi?id=788433)  [11 years ago](#c21)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   947 bytes, patch |  | [Details](/attachment.cgi?id=788433&action=edit) | [Diff](/attachment.cgi?id=788433&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=788433) |
| [Make ImageDocument OverrideBuiltins](/attachment.cgi?id=790844)  [11 years ago](#c33)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   1023 bytes, patch | peterv : [review+](#a2525726_24295 "11 years ago")  abillings : [approval-mozilla-aurora+](#c35 "11 years ago")  abillings : [approval-mozilla-beta+](#c35 "11 years ago")  abillings : [sec-approval+](#c35 "11 years ago") | [Details](/attachment.cgi?id=790844&action=edit) | [Diff](/attachment.cgi?id=790844&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=790844) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=895294#c0)• 12 years ago |
|  | |

1. Set:
user\_pref("javascript.options.baselinejit.unsafe\_eager\_compilation", true);
2. Install <https://www.squarefree.com/extensions/domFuzzLite3.xpi>
3. Load the testcase
Result: Crash [@ mozilla::dom::MaybeWrapObjectValue]
Might be debug-only.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=895294#c1)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=777636)
— [Details](attachment.cgi?id=777636&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=895294#c2)• 12 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=777637)
— [Details](attachment.cgi?id=777637&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=895294#c3)• 12 years ago |
|  | |

Looks like just a null crash, but I'll mark it sec-high for now.Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=895294#c4)• 12 years ago |
|  | |

Er, this is bad. What we have is an ImageDocument for which "p/x \*self->mAll.ptr" shows:
shape\_ = {
<js::EncapsulatedPtr<js::Shape, unsigned long>> = {
{
value = 0xdadadadadadadada,
other = 0xdadadadadadadada
}
}, <No data fields>},
etc.
As in, the frameDoc.all got GCed!

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a389729_406194)• 12 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [csec-uaf](/buglist.cgi?keywords=csec-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=895294#c5)• 12 years ago |
|  | |

We seem to never traverse the ImageDocument in question during the CC the page triggers....

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a391551_406194)• 12 years ago |

Assignee: nobody → continuation

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=895294#c6)• 12 years ago |
|  | |

I can't reproduce on a 138350:18467a85acf6 build from 7/13, I'll try updating.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=895294#c7)• 12 years ago |
|  | |

Did you set the preference from [comment 0](/show_bug.cgi?id=895294#c0 "VERIFIED FIXED - Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing")?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=895294#c8)• 12 years ago |
|  | |

Regression range might be useful.
I would test around
<http://hg.mozilla.org/mozilla-central/rev/9fc3d4e62179>
and perhaps
<http://hg.mozilla.org/mozilla-central/rev/135a277d1319>

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=895294#c9)• 12 years ago |
|  | |

Assuming we had javascript.options.baselinejit.unsafe\_eager\_compilation at that time.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=895294#c10)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #7](/show_bug.cgi?id=895294#c7 "VERIFIED FIXED - Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing"))
> Did you set the preference from [comment 0](/show_bug.cgi?id=895294#c0 "VERIFIED FIXED - Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing")?
I did, assuming that going into about:config and adding it is enough.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=895294#c11)• 12 years ago |
|  | |

Hmm, the pref is too new <http://hg.mozilla.org/mozilla-central/rev/08c202fef059>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=895294#c12)• 12 years ago |
|  | |

I can't reproduce this, even with an updated build on a fresh profile updated with the addon and the pref, and restarting. I'm not sure why that is.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=895294#c13)• 11 years ago |
|  | |

I tried a Linux ASAN non-debug build, and I couldn't reproduce it there, either. Though I meant to do a debug build, I'll retry once I rebuild...

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=895294#c14)• 11 years ago |
|  | |

Okay, it does reproduce on a Linux ASAN debug build.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a1859677_280903)• 11 years ago |

[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)
[tracking-firefox26](/buglist.cgi?f1=cf_tracking_firefox26&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox26&o1=equals&v1=%2B)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=895294#c15)• 11 years ago |
|  | |

Attached file
[stack for destroy](attachment.cgi?id=787871)
— [Details](attachment.cgi?id=787871&action=edit)

What is happening is that we're first triggering nsDocument::Destroy. I'm not sure why that is, but I've attached the stack. It involves nsDocShell::EndPageLoad, PresShell::UnsuppressAndInvalidate, nsDocumentViewer::Show and some other stuff.
nsDocument::Destroy manually calls ReleaseWrapper for some reason, which seems bad:
7788 // XXX We really should let cycle collection do this, but that currently still
7789 // leaks (see [https://bugzilla.mozilla.org/show\_bug.cgi?id=406684](/show_bug.cgi?id=406684 "RESOLVED FIXED - Memory leaks when content policies set properties of wrapped nodes")).
7790 ReleaseWrapper(static\_cast<nsINode\*>(this));
This causes us to drop the document from the JS holders table, which doesn't trigger the assertion because we haven't set mAll to anything. The ImageDocument now has PreservingWrapper() equal to false.
Then DOMProxyHandler::EnsureExpandoObject sets PreservingWrapper() to true on the ImageDocument, but doesn't add it as a JSHolder again.
Then we hit the code that actually sets mAll for the first time, but because the document already has preserving set to true, we don't hold it.
From there we are doomed. We GC, don't trace the image document because it isn't held, get the saved value of mAll, which is now garbage.
I see at least two problems here:
1) The ReleaseWrapper() in nsDocument::Destroy() is bad. It might be okay if we're only supposed to call nsDocument::Destroy() on dead documents, in which case whatever the trigger is for the Destroy() is bad.
2) EnsureExpandoObject is setting the preserved bit to true without ensuring the object is held. I'm not sure exactly what this code does, but that seems bad to me. It would be nice if we had an assertion in SetPreservingWrapper(true) that checked to make sure the object was held.
I'll look more into this tomorrow, focusing on the second issue first, as I'm more likely to understand that code.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=895294#c16)• 11 years ago |
|  | |

Olli, are we supposed to Destroy documents that are still alive? I'm guessing no...Flags: needinfo?(bugs)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=895294#c17)• 11 years ago |
|  | |

Destroy() is called when you navigate away from a document, basically. So it can most definitely happen on still-alive documents.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=895294#c18)• 11 years ago |
|  | |

Thanks. Hopefully that comment about needing release wrapper to avoid leaks is no longer accurate. I could imagine this could be triggered with the wrapper instead of the mAll pointer. I'll try experimenting with that.
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected)Flags: needinfo?(bugs)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a1935634_406194)• 11 years ago |

[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected) → ---

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=895294#c19)• 11 years ago |
|  | |

Attached file
[variant, works without unsafe\_eager\_compilation](attachment.cgi?id=788401)
— [Details](attachment.cgi?id=788401&action=edit)

I suspect the reason that eager\_compilation is required is that without optimizations the result of the first call to |frameDoc.all| is being stuck on the stack somewhere, so the conservative stack scanner keeps the "all" object alive. I'd guess that with eager\_compilation, the compiler is smart enough to realize that the result of frameDoc.all isn't use, so it throws out the intermediate result, and we don't keep the all object alive through the GC.
This theory is supported by the fact that the variant in this attachment works without eager\_compilation set. The only change is that it explicitly puts the result of frameDoc.all into a local variable x, then sets the value of x to something else, thus I'd guess we don't keep around the all object, like in the optimized case.
I could verify this by looking at a GC log, but I'm lazy.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=895294#c20)• 11 years ago |
|  | |

Anyways, deleting the ReleaseWrapper call in nsDocument::Destroy fixes the test case, and doesn't seem to leak ( <https://tbpl.mozilla.org/?tree=Try&rev=0de6a6910f3c> ), but then we still have the funny behavior where DOMProxyHandler::EnsureExpandoObject sets a wrapper as preserving without doing a hold, so we'll end up being a use-after-unlink error away from a use-after-free (triggering an EnsureExpandoObject after an Unlink will put us in the same situation as the test case), so I'm going to try to figure out what is going on there.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=895294#c21)• 11 years ago |
|  | |

Attached patch

[preserve wrapper in last case in EnsureExpandoObject](attachment.cgi?id=788433&action=diff) (obsolete)
— [Details](attachment.cgi?id=788433&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=788433)

This is enough to fix the patch. Is there some reason we can't just do this, Peter?
mAll gets cleared in Destroy, so maybe the ReleaseWrapper in Destroy isn't so terrible. I can file a separate bug for removing that, as it still feels a bit archaic.
[Attachment #788433](/attachment.cgi?id=788433&action=edit "preserve wrapper in last case in EnsureExpandoObject") -
Flags: feedback?(peterv)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a1959797_406194)• 11 years ago |

[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=895294#c22)• 11 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=20bfab125154>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=895294#c23)• 11 years ago |
|  | |

Comment on [attachment 788433](/attachment.cgi?id=788433 "preserve wrapper in last case in EnsureExpandoObject") [[details]](/attachment.cgi?id=788433&action=edit "preserve wrapper in last case in EnsureExpandoObject") [[diff]](/attachment.cgi?id=788433&action=diff "preserve wrapper in last case in EnsureExpandoObject") [[review]](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=788433)
preserve wrapper in last case in EnsureExpandoObject
I don't really know what this last case is supposed to be for, but this at least passes try...
[Attachment #788433](/attachment.cgi?id=788433&action=edit "preserve wrapper in last case in EnsureExpandoObject") -
Flags: feedback?(peterv) → review?(peterv)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=895294#c24)• 11 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #15](/show_bug.cgi?id=895294#c15 "VERIFIED FIXED - Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing"))
> Then DOMProxyHandler::EnsureExpandoObject sets PreservingWrapper() to true
> on the ImageDocument, but doesn't add it as a JSHolder again.
But it does call XPCWrappedNativeScope::RegisterDOMExpandoObject,
> From there we are doomed. We GC, don't trace the image document
so why isn't XPCWrappedNativeScope::TraceWrappedNativesInAllScopes not tracing it?Flags: needinfo?(continuation)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=895294#c25)• 11 years ago |
|  | |

It looks to me like that only traces the expando, and what we're missing here is tracing the mAll pointer.
I hadn't really realized about the RegisterDOMExpandoObject mechanism for tracing expandos, that's good to know.Flags: needinfo?(continuation)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=895294#c26)• 11 years ago |
|  | |

So this is a little confusing, because really what should be happening for ImageDocument (which inherits from HTMLDocument) is that we take the |if (expandoAndGeneration) {|. It looks like that is a problem with the OverrideBuiltins (we don't check for that on base interfaces).

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=895294#c27)• 11 years ago |
|  | |

(In reply to Peter Van der Beken [:peterv] from [comment #26](/show_bug.cgi?id=895294#c26 "VERIFIED FIXED - Crash [@ mozilla::dom::MaybeWrapObjectValue] with document.all after navigating away and GCing"))
> we take the |if (expandoAndGeneration) {|
... branch which does |cache->PreserveWrapper(native)|.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=895294#c28)• 11 years ago |
|  | |

From what I'm seeing, what is happening is that the call of nsDocument::Destroy into ReleaseWrapper is calling GetAndClearExpandoObject on the ImageDocument, which causes JSPROXYSLOT\_EXPANDO to become undefined, so then when we call into EnsureExpandoObject, we don't hit the expandoAndGeneration case. Is OverrideBuiltins supposed to prevent that somehow?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=895294#c29)• 11 years ago |
|  | |

Comment on [attachment 788433](/attachment.cgi?id=788433 "preserve wrapper in last case in EnsureExpandoObject") [[details]](/attachment.cgi?id=788433&action=edit "preserve wrapper in last case in EnsureExpandoObject") [[diff]](/attachment.cgi?id=788433&action=diff "preserve wrapper in last case in EnsureExpandoObject") [[review]](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=788433)
preserve wrapper in last case in EnsureExpandoObject
It sounds like this is the wrong solution.
I'll poke around in the bindings generation code for whatever deals with OverrideBuiltins to try to figure out what that is doing.
[Attachment #788433](/attachment.cgi?id=788433&action=edit "preserve wrapper in last case in EnsureExpandoObject") -
Flags: review?(peterv)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=895294#c30)• 11 years ago |
|  | |

I still don't know what it does, but I can confirm that manually adding OverrideBuiltins to ImageDocument in the .webidl file fixes this crash.

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=895294#c31)• 11 years ago |
|  | |

Let's do that for now to fix this. I'll file a separate bug to make that mandatory (I don't think it makes sense to have OverrideBuiltins on a base interface but not on a derived one).

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=895294#c32)• 11 years ago |
|  | |

Great! I checked and there are no other cases of classes inheriting from OverrideBuiltins.
I'm going to call this a regression from the original WebIDLization of ImageDocument, though it isn't clear to me that it can be exploited without the addition of the document.all pointer.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=895294#c33)• 11 years ago |
|  | |

Attached patch

[Make ImageDocument OverrideBuiltins](attachment.cgi?id=790844&action=diff)
— [Details](attachment.cgi?id=790844&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=790844)

I still need to do a try run.
[Attachment #788433](/attachment.cgi?id=788433&action=edit "preserve wrapper in last case in EnsureExpandoObject") -
Attachment is obsolete: true
[Attachment #790844](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") -
Flags: review?(peterv)

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a2465058_152868)• 11 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a2525726_24295)• 11 years ago |

[Attachment #790844](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") -
Flags: review?(peterv) → review+

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=895294#c34)• 11 years ago |
|  | |

Comment on [attachment 790844](/attachment.cgi?id=790844 "Make ImageDocument OverrideBuiltins") [[details]](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") [[diff]](/attachment.cgi?id=790844&action=diff "Make ImageDocument OverrideBuiltins") [[review]](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=790844)
Make ImageDocument OverrideBuiltins
try run: <https://tbpl.mozilla.org/?tree=Try&rev=ef9284fca0eb>
[Security approval request comment]
How easily could an exploit be constructed based on the patch? Very difficult.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem? No.
Which older supported branches are affected by this flaw? 23, 24 and 25, though this might not be a security problem on 23. The actual testcase here is only going to work on 24 and later.
If not all supported branches, which bug introduced the flaw? [Bug 868929](/show_bug.cgi?id=868929 "RESOLVED FIXED - Convert ImageDocument to WebIDL") or [bug 877277](/show_bug.cgi?id=877277 "RESOLVED FIXED - Move the document.all getter into WebIDL").
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be? Trivial.
How likely is this patch to cause regressions; how much testing does it need? This looks very safe.
[Attachment #790844](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=895294#c35)• 11 years ago |
|  | |

Comment on [attachment 790844](/attachment.cgi?id=790844 "Make ImageDocument OverrideBuiltins") [[details]](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") [[diff]](/attachment.cgi?id=790844&action=diff "Make ImageDocument OverrideBuiltins") [[review]](/page.cgi?id=splinter.html&ignore=&bug=895294&attachment=790844)
Make ImageDocument OverrideBuiltins
Sec-approval+ for trunk. Once it is in and green, let's take this on aurora and beta. I think this is the smallest patch I've seen this week and the risk appears to be very low.
[Attachment #790844](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") -
Flags: sec-approval?
[Attachment #790844](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") -
Flags: sec-approval+
[Attachment #790844](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") -
Flags: approval-mozilla-beta+
[Attachment #790844](/attachment.cgi?id=790844&action=edit "Make ImageDocument OverrideBuiltins") -
Flags: approval-mozilla-aurora+

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=895294#c36)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/3c60eec96230>

|  | [Phil Ringnalda (:philor)](/user_profile?user_id=135518) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=895294#c37)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/3c60eec96230>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla26

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=895294#c38)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/b4b0dd527993>
<https://hg.mozilla.org/releases/mozilla-beta/rev/7bd99c764420>
The patch didn't apply cleanly to beta due [bug 885177](/show_bug.cgi?id=885177 "RESOLVED FIXED - Make window.ImageDocument ChromeOnly") not landing there. I assume that having just the OverrideBuiltins without the ChromeOnly won't hurt anything.
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a3168638_280903)• 11 years ago |

Whiteboard: [adv-main24+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=895294#c39)• 11 years ago |
|  | |

Confirmed crash on ASan FF25 2013-06-25.
Verified fixed on ASan FF25 2013-09-14.
Verified fixed on ASan FF26 2013-11-20.Status: RESOLVED → VERIFIED
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=verified)
[status-firefox26](/buglist.cgi?f1=cf_status_firefox26&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox26&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a42323862_1689)• 10 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=895294#a178351689_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=895294&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


