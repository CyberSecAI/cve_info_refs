=== Content from bugzilla.mozilla.org_82aaf2c3_20250125_164316.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/821479)
* [XML](/show_bug.cgi?ctype=xml&id=821479)

Closed
[Bug 821479](/show_bug.cgi?id=821479)

Opened 12 years ago
Closed 12 years ago

# Out-of-bounds read crash in PropertyProvider::GetSpacingInternal

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Out-of-bounds read crash in PropertyProvider::GetSpacingInternal

## Categories

### (Core :: Layout: Text and Fonts, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts#Layout%3A%20Text%20and%20Fonts)

Layout: Text and Fonts
▾

Core :: Layout: Text and Fonts

Issues with CSS font selection, font loading, text shaping and glyph selection, breaking, text decorations, bidirectional text processing, and white space processing. For issues with glyph rendering and font format support, see the Graphics: Text component.

Example bugs:

* line-breaking code does not handle supplementary-plane characters properly
* double or wavy decoration lines are not repainted correctly if specified on floating first letter

Specifications covered:

* CSS Fonts
* CSS Size Adjustment
* CSS Text
* CSS Text Decoration

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix) |
| firefox19 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix) |
| firefox20 | [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr10 | [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix) |
| firefox-esr17 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 |  | wontfix |
| firefox19 |  | wontfix |
| firefox20 | - | wontfix |
| firefox21 | + | fixed |
| firefox-esr10 | - | wontfix |
| firefox-esr17 | - | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mwobensmith, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=40)  [mwobensmith](/user_profile?user_id=452604)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[CVE-2012-3995](/show_bug.cgi?id=765621 "RESOLVED FIXED - Out of bounds read in IsCSSWordSpacingSpace")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=821479&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=821479)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, sec-low, testcase, Whiteboard: [asan][adv-main21+] testcase in bug 765621)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[asan][adv-main21+] testcase in bug 765621

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 2 obsolete files)

| [fix, part 1](/attachment.cgi?id=698924)  [12 years ago](#c2)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   2.67 KB, patch | roc : [review+](#c4 "12 years ago") | [Details](/attachment.cgi?id=698924&action=edit) | [Diff](/attachment.cgi?id=698924&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698924) |
| --- | --- | --- |
| [fix, part 2](/attachment.cgi?id=698931)  [12 years ago](#c3)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.54 KB, patch | roc : [review+](#c5 "12 years ago") | [Details](/attachment.cgi?id=698931&action=edit) | [Diff](/attachment.cgi?id=698931&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698931) |
| [fix, part 1](/attachment.cgi?id=699153)  [12 years ago](#c7)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   5.69 KB, patch | MatsPalmgren\_bugz : [review+](#c7 "12 years ago")  abillings : [sec-approval+](#a2241947_280903 "12 years ago") | [Details](/attachment.cgi?id=699153&action=edit) | [Diff](/attachment.cgi?id=699153&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=699153) |
| [fix, part 2](/attachment.cgi?id=699154)  [12 years ago](#c8)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.27 KB, patch | MatsPalmgren\_bugz : [review+](#c8 "12 years ago") | [Details](/attachment.cgi?id=699154&action=edit) | [Diff](/attachment.cgi?id=699154&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=699154) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=821479#c0)• 12 years ago |
|  | |

Nightly, 2012-12-12, found using bug files from related [bug #765621](/show_bug.cgi?id=765621 "RESOLVED FIXED - Out of bounds read in IsCSSWordSpacingSpace").
I'm guessing on the title, based on the crash report. Please edit the title for accuracy if I have gotten it wrong.
A similar bug exists in #807891.
=================================================================
==1661== ERROR: AddressSanitizer heap-buffer-overflow on address 0x0001294ddc63 at pc 0x105ecb04c bp 0x7fff5fbf4990 sp 0x7fff5fbf4988
READ of size 1 at 0x0001294ddc63 thread T0
#0 0x105ecb04b in PropertyProvider::GetSpacingInternal nsTextFragment.h:162
#1 0x105ecb9d3 in PropertyProvider::CalcTabWidths nsTextFrameThebes.cpp:3046
#2 0x105ec9d1b in PropertyProvider::GetSpacingInternal nsTextFrameThebes.cpp:2936
#3 0x109da4dd6 in GetAdjustedSpacing gfxFont.cpp:4713
#4 0x109da4bf9 in gfxTextRun::GetAdjustedSpacingArray gfxFont.cpp:4744
#5 0x109da7126 in gfxTextRun::AccumulateMetricsForRun gfxFont.cpp:5012
#6 0x109da6db7 in gfxTextRun::MeasureText gfxFont.cpp:5083
#7 0x105ef8d24 in nsTextFrame::ComputeTightBounds const nsTextFrameThebes.cpp:7289
#8 0x105d4d488 in nsFrame::ComputeSimpleTightBounds const nsFrame.cpp:4132
#9 0x105ca45d3 in nsBlockFrame::ComputeTightBounds const nsBlockFrame.cpp:831
#10 0x106372ee7 in nsMathMLContainerFrame::ReflowChild nsMathMLContainerFrame.cpp:895
#11 0x106373772 in nsMathMLContainerFrame::Reflow nsMathMLContainerFrame.cpp:926
#12 0x105e3707a in nsLineLayout::ReflowFrame nsLineLayout.cpp:840
#13 0x105cc84c8 in nsBlockFrame::ReflowInlineFrame nsBlockFrame.cpp:3723
#14 0x105cc6262 in nsBlockFrame::DoReflowInlineFrames nsBlockFrame.cpp:3520
#15 0x105cc15a9 in nsBlockFrame::ReflowInlineFrames nsBlockFrame.cpp:3374
#16 0x105caf54e in nsBlockFrame::ReflowDirtyLines nsBlockFrame.cpp:1998
#17 0x105ca58f7 in nsBlockFrame::Reflow nsBlockFrame.cpp:1041
#18 0x105d0adfc in nsContainerFrame::ReflowChild nsContainerFrame.cpp:952
#19 0x105de22e1 in nsCanvasFrame::Reflow nsCanvasFrame.cpp:472
#20 0x105d0adfc in nsContainerFrame::ReflowChild nsContainerFrame.cpp:952
#21 0x105dad4e9 in nsHTMLScrollFrame::ReflowScrolledFrame nsGfxScrollFrame.cpp:433
#22 0x105dadd22 in nsHTMLScrollFrame::ReflowContents nsGfxScrollFrame.cpp:533
#23 0x105db0ec1 in nsHTMLScrollFrame::Reflow nsGfxScrollFrame.cpp:774
#24 0x105d0adfc in nsContainerFrame::ReflowChild nsContainerFrame.cpp:952
#25 0x105f2c593 in ViewportFrame::Reflow nsViewportFrame.cpp:202
#26 0x105ba0e9e in PresShell::DoReflow nsPresShell.cpp:7554
#27 0x105bb69aa in PresShell::ProcessReflowCommands nsPresShell.cpp:7695
#28 0x105bb5d14 in PresShell::FlushPendingNotifications nsPresShell.cpp:3907
#29 0x105bfbd17 in nsRefreshDriver::Tick nsRefreshDriver.cpp:897
#30 0x105c00931 in mozilla::RefreshDriverTimer::Tick nsRefreshDriver.cpp:164
#31 0x109c1bdbe in nsTimerImpl::Fire nsTimerImpl.cpp:482
#32 0x109c1c95e in nsTimerEvent::Run nsTimerImpl.cpp:565
#33 0x109c09f3e in nsThread::ProcessNextEvent nsThread.cpp:627
#34 0x109af8918 in NS\_ProcessPendingEvents\_P nsThreadUtils.cpp:171
#35 0x109013f1e in nsBaseAppShell::NativeEventCallback nsBaseAppShell.cpp:97
#36 0x108f57b0c in nsAppShell::ProcessGeckoEvents nsAppShell.mm:387
#37 0x7fff91b4e100 in \_\_CFRUNLOOP\_IS\_CALLING\_OUT\_TO\_A\_SOURCE0\_PERFORM\_FUNCTION\_\_ (in CoreFoundation) + 16
#38 0x7fff91b4da24 in \_\_CFRunLoopDoSources0 (in CoreFoundation) + 244
#39 0x7fff91b70dc4 in \_\_CFRunLoopRun (in CoreFoundation) + 788
#40 0x7fff91b706b1 in CFRunLoopRunSpecific (in CoreFoundation) + 289
#41 0x7fff8b5140a3 in RunCurrentEventLoopInMode (in HIToolbox) + 208
#42 0x7fff8b513e41 in ReceiveNextEventCommon (in HIToolbox) + 355
#43 0x7fff8b513cd2 in BlockUntilNextEventMatchingListInMode (in HIToolbox) + 61
#44 0x7fff8d811612 in \_DPSNextEvent (in AppKit) + 684
#45 0x7fff8d810ed1 in -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] (in AppKit) + 127
#46 0x108f55bd7 in -[GeckoNSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] nsAppShell.mm:164
#47 0x7fff8d808282 in -[NSApplication run] (in AppKit) + 516
#48 0x108f588a9 in nsAppShell::Run nsAppShell.mm:741
#49 0x10887b2b0 in nsAppStartup::Run nsAppStartup.cpp:291
#50 0x1050c56ae in XREMain::XRE\_mainRun nsAppRunner.cpp:3824
#51 0x1050c6cdc in XREMain::XRE\_main nsAppRunner.cpp:3891
#52 0x1050c76ca in XRE\_main nsAppRunner.cpp:4089
#53 0x10000294f in main nsBrowserApp.cpp:174
#54 0x100001553 in start (in firefox-bin) + 51
#55 0x0 in 0x0000000100000000 (in firefox-bin)
0x0001294ddc63 is located 29 bytes to the left of 94-byte region [0x0001294ddc80,0x0001294ddcde)
allocated by thread T0 here:
#0 0x10000d7cc in (anonymous namespace)::mz\_malloc(\_malloc\_zone\_t\*, unsigned long) (in firefox-bin) + 44
#1 0x7fff8c723152 in malloc\_zone\_malloc (in libsystem\_c.dylib) + 70
#2 0x7fff8c723ba6 in malloc (in libsystem\_c.dylib) + 40
#3 0x10274250d in moz\_xmalloc mozalloc.cpp:54
#4 0x106706bb2 in nsTextFragment::SetTo nsMemory.h:36
#5 0x1066102ad in nsGenericDOMDataNode::SetTextInternal nsGenericDOMDataNode.cpp:290
#6 0x106615a44 in nsGenericDOMDataNode::SetText nsGenericDOMDataNode.cpp:833
#7 0x106542c92 in nsDocument::CreateTextNode nsIContent.h:521
#8 0x1083541ac in nsIDOMDocument\_CreateTextNode dom\_quickstubs.cpp:1332
#9 0x10b2a77fa in js::CallJSNative, JS::CallArgs const&) jscntxtinlines.h:364
#10 0x10b29810a in js::InvokeKernel jsinterp.cpp:382
#11 0x10b285525 in js::Interpret jsinterp.cpp:2348
#12 0x10b873f20 in js::mjit::EnterMethodJIT MethodJIT.cpp:1066
#13 0x10b874d42 in CheckStackAndEnterMethodJIT MethodJIT.cpp:1097
#14 0x10b87490b in js::mjit::JaegerShot MethodJIT.cpp:1115
#15 0x10b26ec09 in js::RunScript jsinterp.cpp:343
#16 0x10b298024 in js::InvokeKernel jsinterp.cpp:404
#17 0x10b299a3d in js::Invoke jsinterp.h:112
#18 0x10b0b099e in JS\_CallFunctionValue jsapi.cpp:5789
#19 0x1082f8197 in nsXPCWrappedJSClass::CallMethod XPCWrappedJSClass.cpp:1432
#20 0x1082e043f in nsXPCWrappedJS::CallMethod XPCWrappedJS.cpp:580
#21 0x109c6680f in PrepareAndDispatch xptcstubs\_x86\_64\_darwin.cpp:121
#22 0x109c6513a in SharedStub (in XUL) + 90
Shadow byte and word:
0x10002529bb8c: fa
0x10002529bb88: fa fa fa fa fa fa fa fa
More shadow bytes:
0x10002529bb68: fa fa fa fa fa fa fa fa
0x10002529bb70: fd fd fd fd fd fd fd fd
0x10002529bb78: fd fd fd fd fd fd fd fd
0x10002529bb80: fa fa fa fa fa fa fa fa
=>0x10002529bb88: fa fa fa fa fa fa fa fa
0x10002529bb90: 00 00 00 00 00 00 00 00
0x10002529bb98: 00 00 00 06 fb fb fb fb
0x10002529bba0: fa fa fa fa fa fa fa fa
0x10002529bba8: fa fa fa fa fa fa fa fa
Stats: 926M malloced (702M for red zones) by 1093052 calls
Stats: 117M realloced by 48243 calls
Stats: 871M freed by 883111 calls
Stats: 728M really freed by 617834 calls
Stats: 848M (217234 full pages) mmaped in 195 calls
mmaps by size class: 8:425958; 9:65528; 10:24570; 11:18423; 12:6144; 13:3584; 14:1792; 15:2048; 16:1280; 17:1312; 18:64; 19:40; 20:24; 21:24; 22:11; 23:8; 24:3;
mallocs by size class: 8:813948; 9:131520; 10:62859; 11:48412; 12:13338; 13:9046; 14:4430; 15:4650; 16:2349; 17:2137; 18:158; 19:96; 20:43; 21:36; 22:12; 23:10; 24:8;
frees by size class: 8:640884; 9:108444; 10:55114; 11:45679; 12:11474; 13:8453; 14:4122; 15:4467; 16:2037; 17:2107; 18:134; 19:91; 20:40; 21:35; 22:12; 23:10; 24:8;
rfrees by size class: 8:417410; 9:85525; 10:46759; 11:40530; 12:9482; 13:7117; 14:3698; 15:3880; 16:1242; 17:1911; 18:119; 19:66; 20:37; 21:31; 22:11; 23:10; 24:6;
Stats: malloc large: 2563 small slow: 7378

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a120_20209)• 12 years ago |

Component: Layout: Block and Inline → Layout: Text

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a112715_5168)• 12 years ago |

Assignee: nobody → matspal

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a507763_1689)• 12 years ago |

Whiteboard: [asan] → [asan] testcase in bug 765621

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=821479#c1)• 12 years ago |
|  | |

Mats, any thoughts on sec rating?Flags: needinfo?(matspal)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=821479#c2)• 12 years ago |
|  | |

Attached patch

[fix, part 1](attachment.cgi?id=698924&action=diff) (obsolete)
— [Details](attachment.cgi?id=698924&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698924)

The problem is that TabWidthStore::mLimit is stored as a skipped
string offset, which can vary over the frame lifetime.
(TabWidthStore is stored on a frame property)
The fix is to store it as an unskipped offset relative the current
frame and then add the current skipped offset when using it (i.e. when
calculating 'tabsEnd'). PropertyProvider::mTabWidthsAnalyzedLimit is
also stored as a skipped string offset, but I don't think it has the
same problem since it doesn't persist between reflows (I think).
It makes the code simpler to change that too though.
Note that the TabWidth::mOffset is already stored in the same
way (i - startOffset) here:
<http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsTextFrameThebes.cpp#3066>
This fixes the crash and pass tests:
<https://tbpl.mozilla.org/?tree=Try&rev=f6f0a6823a64>
[Attachment #698924](/attachment.cgi?id=698924&action=edit "fix, part 1") -
Flags: review?(roc)Flags: needinfo?(matspal)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=821479#c3)• 12 years ago |
|  | |

Attached patch

[fix, part 2](attachment.cgi?id=698931&action=diff) (obsolete)
— [Details](attachment.cgi?id=698931&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698931)

I'm still a little worried that the stored indices are wrong if the text
frame's offset changes so perhaps we should store it and blow away the
property if it's not the same. Or can't that happen for some reason?
(if so we could make this an assertion instead)
With both patches:
<https://tbpl.mozilla.org/?tree=Try&rev=459fe3118d61>
[Attachment #698931](/attachment.cgi?id=698931&action=edit "fix, part 2") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=821479#c4)• 12 years ago |
|  | |

Comment on [attachment 698924](/attachment.cgi?id=698924 "fix, part 1") [[details]](/attachment.cgi?id=698924&action=edit "fix, part 1") [[diff]](/attachment.cgi?id=698924&action=diff "fix, part 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698924)
fix, part 1
Review of [attachment 698924](/attachment.cgi?id=698924 "fix, part 1") [[details]](/attachment.cgi?id=698924&action=edit "fix, part 1") [[diff]](/attachment.cgi?id=698924&action=diff "fix, part 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698924):
-----------------------------------------------------------------
Please add a comment where mLimit and mOffset are declared saying that they're DOM offsets relative to the current frame's offset.
::: layout/generic/nsTextFrameThebes.cpp
@@ +3021,5 @@
> // tab widths; check that they're available as far as the last
> // tab character present (if any)
> for (uint32\_t i = aStart + aLength; i > aStart; --i) {
> if (mTextRun->CharIsTab(i - 1)) {
> + uint32\_t startOffset = mStart.GetSkippedOffset();
DebugOnly<uint32\_t>
[Attachment #698924](/attachment.cgi?id=698924&action=edit "fix, part 1") -
Flags: review?(roc) → review+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=821479#c5)• 12 years ago |
|  | |

Comment on [attachment 698931](/attachment.cgi?id=698931 "fix, part 2") [[details]](/attachment.cgi?id=698931&action=edit "fix, part 2") [[diff]](/attachment.cgi?id=698931&action=diff "fix, part 2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698931)
fix, part 2
Review of [attachment 698931](/attachment.cgi?id=698931 "fix, part 2") [[details]](/attachment.cgi?id=698931&action=edit "fix, part 2") [[diff]](/attachment.cgi?id=698931&action=diff "fix, part 2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=698931):
-----------------------------------------------------------------
This seems good.
[Attachment #698931](/attachment.cgi?id=698931&action=edit "fix, part 2") -
Flags: review?(roc) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=821479#c6)• 12 years ago |
|  | |

(In reply to Robert O'Callahan (:roc) (Mozilla Corporation) from [comment #4](/show_bug.cgi?id=821479#c4 "RESOLVED FIXED - Out-of-bounds read crash in PropertyProvider::GetSpacingInternal"))
> > + uint32\_t startOffset = mStart.GetSkippedOffset();
>
> DebugOnly<uint32\_t>
Good point but this whole block is inside #ifdef DEBUG.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=821479#c7)• 12 years ago |
|  | |

Attached patch

[fix, part 1](attachment.cgi?id=699153&action=diff)
— [Details](attachment.cgi?id=699153&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=699153)

Updated code comments.
[Attachment #698924](/attachment.cgi?id=698924&action=edit "fix, part 1") -
Attachment is obsolete: true
[Attachment #699153](/attachment.cgi?id=699153&action=edit "fix, part 1") -
Flags: review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=821479#c8)• 12 years ago |
|  | |

Attached patch

[fix, part 2](attachment.cgi?id=699154&action=diff)
— [Details](attachment.cgi?id=699154&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=699154)

Updated code comments.
[Attachment #698931](/attachment.cgi?id=698931&action=edit "fix, part 2") -
Attachment is obsolete: true
[Attachment #699154](/attachment.cgi?id=699154&action=edit "fix, part 2") -
Flags: review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=821479#c9)• 12 years ago |
|  | |

(In reply to David Bolter [:davidb] from [comment #1](/show_bug.cgi?id=821479#c1 "RESOLVED FIXED - Out-of-bounds read crash in PropertyProvider::GetSpacingInternal"))
> Mats, any thoughts on sec rating?
This code is rather complicated so it's hard to guess. I've only seen
out-of-bounds READ so far. In theory you could get the read value reflected
in layout (at least in some cases) in the form of spacing for a "tab",
but it looks very hard to do.OS: Mac OS X → AllHardware: x86 → All

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=821479#c10)• 12 years ago |
|  | |

Comment on [attachment 699153](/attachment.cgi?id=699153 "fix, part 1") [[details]](/attachment.cgi?id=699153&action=edit "fix, part 1") [[diff]](/attachment.cgi?id=699153&action=diff "fix, part 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821479&attachment=699153)
fix, part 1
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
looks hard to me
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
not really
Which older supported branches are affected by this flaw?
all
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
I expect the patches to apply to all supported branches
How likely is this patch to cause regressions; how much testing does it need?
medium risk
[Attachment #699153](/attachment.cgi?id=699153&action=edit "fix, part 1") -
Flags: sec-approval?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a2217998_5168)• 12 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a2241947_280903)• 12 years ago |

[Attachment #699153](/attachment.cgi?id=699153&action=edit "fix, part 1") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a2242012_280903)• 12 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected)
[status-firefox17](/buglist.cgi?f1=cf_status_firefox17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox17&o1=equals&v1=affected)
[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=affected)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F)
[tracking-firefox19](/buglist.cgi?f1=cf_tracking_firefox19&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=%3F)
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a2419277_1689)• 12 years ago |

[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix)
[status-firefox17](/buglist.cgi?f1=cf_status_firefox17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox17&o1=equals&v1=affected) → ---
[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix)
[tracking-firefox-esr10](/buglist.cgi?f1=cf_tracking_esr10&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_esr10&o1=equals&v1=-)
[tracking-firefox19](/buglist.cgi?f1=cf_tracking_firefox19&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=%3F) → ---Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=821479#c11)• 12 years ago |
|  | |

If this sec-low bug is medium risk, let's let it ride the trains. Severity doesn't seem high enough for the risk.
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=821479#c12)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/678cac97bf1a>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/63ba23c13e9b>

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=821479#c13)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/63ba23c13e9b>
<https://hg.mozilla.org/mozilla-central/rev/678cac97bf1a>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla21

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a3462629_425645)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a12016397_280903)• 12 years ago |

Whiteboard: [asan] testcase in bug 765621 → [asan][adv-main21+] testcase in bug 765621

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821479#a61019311_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=821479&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Mats Palmgren (inactive)](/user_profile?user_id=5168)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.ubuntu.com_8d3bdd9e_20250125_164310.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1823-1: Thunderbird vulnerabilities

14 May 2013

Several security issues were fixed in Thunderbird.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 13.04](/security/notices?release=raring)
* [Ubuntu 12.10](/security/notices?release=quantal)
* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [thunderbird](/security/cves?package=thunderbird) - Mozilla Open Source mail and newsgroup client

## Details

Multiple memory safety issues were discovered in Thunderbird. If the user

were tricked into opening a specially crafted message with scripting

enabled, an attacker could possibly exploit these to cause a denial of

service via application crash, or potentially execute code with the

privileges of the user invoking Thunderbird. ([CVE-2013-0801](/security/CVE-2013-0801),

[CVE-2013-1669](/security/CVE-2013-1669))

Cody Crews discovered that some constructors could be used to bypass

restrictions enforced by their Chrome Object Wrapper (COW). If a user had

scripting enabled, an attacker could exploit this to conduct cross-site

scripting (XSS) attacks. ([CVE-2013-1670](/security/CVE-2013-1670))

A use-after-free was discovered when resizing video content whilst it is

playing. If a user had scripting enabled, an attacker could potentially

exploit this to execute code with the privileges of the user invoking

Thunderbird. ([CVE-2013-1674](/security/CVE-2013-1674))

It was discovered that some DOMSVGZoomEvent functions could be used

without being properly initialized, which could lead to information

leakage. ([CVE-2013-1675](/security/CVE-2013-1675))

Abhishek Arya discovered multiple memory safety issues in Thunderbird. If

the user were tricked into opening a specially crafted message, an

attacker could possibly exploit these to cause a denial of service via

application crash, or potentially execute code with the privileges of

the user invoking Thunderbird. ([CVE-2013-1676](/security/CVE-2013-1676), [CVE-2013-1677](/security/CVE-2013-1677),

[CVE-2013-1678](/security/CVE-2013-1678), [CVE-2013-1679](/security/CVE-2013-1679), [CVE-2013-1680](/security/CVE-2013-1680), [CVE-2013-1681](/security/CVE-2013-1681))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 13.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [17.0.6+build1-0ubuntu0.13.04.1](https://launchpad.net/ubuntu/%2Bsource/thunderbird/17.0.6%2Bbuild1-0ubuntu0.13.04.1)

##### Ubuntu 12.10

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [17.0.6+build1-0ubuntu0.12.10.1](https://launchpad.net/ubuntu/%2Bsource/thunderbird/17.0.6%2Bbuild1-0ubuntu0.12.10.1)

##### Ubuntu 12.04

* [thunderbird](https://launchpad.net/ubuntu/%2Bsource/thunderbird)
  -
  [17.0.6+build1-0ubuntu0.12.04.1](https://launchpad.net/ubuntu/%2Bsource/thunderbird/17.0.6%2Bbuild1-0ubuntu0.12.04.1)

After a standard system update you need to restart Thunderbird to make

all the necessary changes.

## References

* [CVE-2013-0801](/security/CVE-2013-0801)
* [CVE-2013-1669](/security/CVE-2013-1669)
* [CVE-2013-1670](/security/CVE-2013-1670)
* [CVE-2013-1674](/security/CVE-2013-1674)
* [CVE-2013-1675](/security/CVE-2013-1675)
* [CVE-2013-1676](/security/CVE-2013-1676)
* [CVE-2013-1677](/security/CVE-2013-1677)
* [CVE-2013-1678](/security/CVE-2013-1678)
* [CVE-2013-1679](/security/CVE-2013-1679)
* [CVE-2013-1680](/security/CVE-2013-1680)
* [CVE-2013-1681](/security/CVE-2013-1681)
* <https://launchpad.net/bugs/1178649>

## Related notices

* [USN-1822-1](/security/notices/USN-1822-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from lists.opensuse.org_ad9e8aca_20250125_164301.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S/#DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S)

# [security-announce] openSUSE-SU-2013:0825-1: important: MozillaFirefox: update to version 21.0

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

24 May
2013

24 May
'13

15:06

openSUSE Security Update: MozillaFirefox: update to version 21.0
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:0825-1
Rating: important
References: #801121 #814101 #819204
Cross-References: CVE-2013-0801 CVE-2013-1669 CVE-2013-1670
CVE-2013-1671 CVE-2013-1674 CVE-2013-1675
CVE-2013-1676 CVE-2013-1677 CVE-2013-1678
CVE-2013-1679 CVE-2013-1680 CVE-2013-1681
Affected Products:
openSUSE 12.2
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 12 vulnerabilities is now available.
Description:
MozillaFirefox was updated to Firefox 21.0 (bnc#819204)
\* MFSA 2013-41/CVE-2013-0801/CVE-2013-1669 Miscellaneous
memory safety hazards
\* MFSA 2013-42/CVE-2013-1670 (bmo#853709) Privileged access
for content level constructor
\* MFSA 2013-43/CVE-2013-1671 (bmo#842255) File input
control has access to full path
\* MFSA 2013-46/CVE-2013-1674 (bmo#860971) Use-after-free
with video and onresize event
\* MFSA 2013-47/CVE-2013-1675 (bmo#866825) Uninitialized
functions in DOMSVGZoomEvent
\* MFSA 2013-48/CVE-2013-1676/CVE-2013-1677/CVE-2013-1678/
CVE-2013-1679/CVE-2013-1680/CVE-2013-1681 Memory
corruption found using Address Sanitizer
Changes in MozillaFirefox-branding-openSUSE:
- modified file locations for Firefox 21 and above
- added DuckDuckGo as search option (bnc#801121)
Special Instructions and Notes:
Please reboot the system after installing this update.
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.2:
zypper in -t patch openSUSE-2013-438
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.2 (i586 x86\_64):
MozillaFirefox-21.0-2.47.1
MozillaFirefox-branding-openSUSE-21-1.4.1
MozillaFirefox-branding-upstream-21.0-2.47.1
MozillaFirefox-buildsymbols-21.0-2.47.1
MozillaFirefox-debuginfo-21.0-2.47.1
MozillaFirefox-debugsource-21.0-2.47.1
MozillaFirefox-devel-21.0-2.47.1
MozillaFirefox-translations-common-21.0-2.47.1
MozillaFirefox-translations-other-21.0-2.47.1
References:
<http://support.novell.com/security/cve/CVE-2013-0801.html>
<http://support.novell.com/security/cve/CVE-2013-1669.html>
<http://support.novell.com/security/cve/CVE-2013-1670.html>
<http://support.novell.com/security/cve/CVE-2013-1671.html>
<http://support.novell.com/security/cve/CVE-2013-1674.html>
<http://support.novell.com/security/cve/CVE-2013-1675.html>
<http://support.novell.com/security/cve/CVE-2013-1676.html>
<http://support.novell.com/security/cve/CVE-2013-1677.html>
<http://support.novell.com/security/cve/CVE-2013-1678.html>
<http://support.novell.com/security/cve/CVE-2013-1679.html>
<http://support.novell.com/security/cve/CVE-2013-1680.html>
<http://support.novell.com/security/cve/CVE-2013-1681.html>
<https://bugzilla.novell.com/801121>
<https://bugzilla.novell.com/814101>
<https://bugzilla.novell.com/819204>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S/#DHT4AR66RX2ZTUXISJPU2TUDQDVWPX7S)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_9b37ca1a_20250125_164320.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/822910)
* [XML](/show_bug.cgi?ctype=xml&id=822910)

Closed
[Bug 822910](/show_bug.cgi?id=822910)

Opened 12 years ago
Closed 12 years ago

# Crash [@ nsTextFrame::HasTerminalNewline()] with splitText, floating :first-letter

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ nsTextFrame::HasTerminalNewline()] with splitText, floating :first-letter

## Categories

### (Core :: Layout: Text and Fonts, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts#Layout%3A%20Text%20and%20Fonts)

Layout: Text and Fonts
▾

Core :: Layout: Text and Fonts

Issues with CSS font selection, font loading, text shaping and glyph selection, breaking, text decorations, bidirectional text processing, and white space processing. For issues with glyph rendering and font format support, see the Graphics: Text component.

Example bugs:

* line-breaking code does not handle supplementary-plane characters properly
* double or wavy decoration lines are not repainted correctly if specified on floating first letter

Specifications covered:

* CSS Fonts
* CSS Size Adjustment
* CSS Text
* CSS Text Decoration

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout%3A%20Text%20and%20Fonts)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | affected |
| firefox21 |  | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomclasses](/show_bug.cgi?id=331889 "RESOLVED INACTIVE - [meta] Bugs found with \"Random Classes\" (adding random CSS stylesheets)"), [textfuzzer](/show_bug.cgi?id=377438 "RESOLVED FIXED - [meta] Text fuzzer")

Dependency [tree](/showdependencytree.cgi?id=822910&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=822910)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [fuzzblocker][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[fuzzblocker][adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | [in-testsuite](#c13 "12 years ago") | + |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [testcase](/attachment.cgi?id=693696)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   368 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=693696&action=edit) |
| --- | --- | --- |
| [stacks (NS\_StackWalk, breakpad)](/attachment.cgi?id=693698)  [12 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   25.98 KB, text/plain |  | [Details](/attachment.cgi?id=693698&action=edit) |
| [frame dumps, stacks, more comments](/attachment.cgi?id=712282)  [12 years ago](#c6)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   12.46 KB, text/html |  | [Details](/attachment.cgi?id=712282&action=edit) |
| [wip](/attachment.cgi?id=712284)  [12 years ago](#c7)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.49 KB, patch |  | [Details](/attachment.cgi?id=712284&action=edit) | [Diff](/attachment.cgi?id=712284&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=822910&attachment=712284) |
| [wallpaper](/attachment.cgi?id=715215)  [12 years ago](#c10)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   2.76 KB, patch | roc : [review+](#a5339808_5038 "12 years ago") | [Details](/attachment.cgi?id=715215&action=edit) | [Diff](/attachment.cgi?id=715215&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=822910&attachment=715215) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=822910#c0)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=693696)
— [Details](attachment.cgi?id=693696&action=edit)

###!!! ASSERTION: negative length: 'GetContentEnd() - mContentOffset >= 0', file nsTextFrame.h, line 420
###!!! ASSERTION: bad index: 'uint32\_t(aIndex) < mState.mLength', file nsTextFragment.h, line 161
Crash [@ nsTextFrame::HasTerminalNewline()]
Oddly enough, Breakpad debug-opt shows this as a -1 deref (dangerous), while ASan opt shows it as a 0 deref (safe).

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=822910#c1)• 12 years ago |
|  | |

Attached file
[stacks (NS\_StackWalk, breakpad)](attachment.cgi?id=693698)
— [Details](attachment.cgi?id=693698&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=822910#c2)• 12 years ago |
|  | |

Clicking on "details" apparently makes it load the test case, so here's a crash report from a recent Nightly:
<https://crash-stats.mozilla.com/report/index/bp-888c2390-7078-49e1-9ed8-eea912121226>

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=822910#c3)• 12 years ago |
|  | |

CC+ Mats for triage/assignment.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=822910#c4)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #2](/show_bug.cgi?id=822910#c2 "RESOLVED FIXED - Crash [@ nsTextFrame::HasTerminalNewline()] with splitText, floating :first-letter"))
> Clicking on "details" apparently makes it load the test case,
BugzillaTweaks is a great add-on; one feature puts a "source" link next to attachments so you can view the source before blindly loading testcases.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=822910#c5)• 12 years ago |
|  | |

The assertions sound bad, but until we get a worse crash can only call this sec-moderate.Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=822910#a4130223_11608)• 12 years ago |

Whiteboard: [fuzzblocker]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=822910#a4650090_5168)• 12 years ago |

Assignee: nobody → matspalOS: Mac OS X → AllHardware: x86\_64 → All

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=822910#c6)• 12 years ago |
|  | |

Attached file
[frame dumps, stacks, more comments](attachment.cgi?id=712282)
— [Details](attachment.cgi?id=712282&action=edit)

nsCSSFrameConstructor::CharacterDataChanged calls RemoveLetterFrames
which inserts a new text frame. The problem is that when inserting
into a nsBlockFrame it peeks at the prev-sibling in a way that assumes
that text frame content offsets are correct. In CharacterDataChanged
they are wrong of course, that's what it's supposed to correct.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=822910#c7)• 12 years ago |
|  | |

Attached patch

[wip](attachment.cgi?id=712284&action=diff) (obsolete)
— [Details](attachment.cgi?id=712284&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=822910&attachment=712284)

This is a bit wallpaper-ish, but perhaps good enough for this edge case.
I'm just using NS\_FRAME\_IS\_DIRTY to tell ShouldPutNextSiblingOnNewLine
to avoid looking at text frames. I think it's purely for performance
reasons we do this in the first place - we'll reflow this block anyway
so layout should be correct afterwards.
3.768 <bzbarsky@mit.edu> 2006-04-20 12:00
Treat terminal newlines in preformatted text like we treat <br> when inserting
frames into a block. [Bug 310087](/show_bug.cgi?id=310087 "RESOLVED FIXED - Be smarter about handling of newlines in pre and pre-wrap content"), r+sr=roc

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=822910#c8)• 12 years ago |
|  | |

An alternative:
+ nsTextFrame\* prevText = do\_QueryFrame(prevSibling);
+ if (prevText) {
+ prevText = static\_cast<nsTextFrame\*>(prevText->GetFirstInFlow());
+ prevText->SetLength(prevText->GetContent()->GetText()->GetLength(), nullptr);
+ }
This is a brutal way of fixing up the content offsets on the prev-sibling.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=822910#c9)• 12 years ago |
|  | |

AFAICT, this bug is completely benign. We'll either SEGV crash, or read a random
value that only influences taking a slightly more performant code path.Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---) → [csec-dos](/buglist.cgi?keywords=csec-dos&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=822910#c10)• 12 years ago |
|  | |

Attached patch

[wallpaper](attachment.cgi?id=715215&action=diff)
— [Details](attachment.cgi?id=715215&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=822910&attachment=715215)

I think this is an acceptable wallpaper for now. I don't see any other
fixes other than rewriting all that nasty first-letter frame ctor code.
<https://tbpl.mozilla.org/?tree=Try&rev=f132761991b9>
I also tested an Opt build on Linux64 with the perf tests in [bug 310087](/show_bug.cgi?id=310087 "RESOLVED FIXED - Be smarter about handling of newlines in pre and pre-wrap content") -
there were no difference afaict.
[Attachment #712284](/attachment.cgi?id=712284&action=edit "wip") -
Attachment is obsolete: true
[Attachment #715215](/attachment.cgi?id=715215&action=edit "wallpaper") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=822910#a5339808_5038)• 12 years ago |

[Attachment #715215](/attachment.cgi?id=715215&action=edit "wallpaper") -
Flags: review?(roc) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=822910#c11)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/016923079831>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=822910#c12)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/016923079831>
Not sure if I should be resolving this or if it should be left open for a better fix. Also, should this have a test?Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla21

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=822910#a5613705_1689)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=822910#a11572005_280903)• 12 years ago |

[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)Whiteboard: [fuzzblocker] → [fuzzblocker][adv-main21+]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=822910#c13)• 10 years ago |
|  | |

Landed a crashtest:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/a136c4ba2bb5>
BTW, the wallpaper was later improved in:
<http://hg.mozilla.org/mozilla-central/rev/b732738b75f8>Group: core-securityFlags: in-testsuite? → in-testsuite+

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=822910#c14)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/a136c4ba2bb5>
You need to [log in](/show_bug.cgi?id=822910&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_b2f4d99a_20250125_164303.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/465DRTIBRTV5M3M47I4YLT7JCNYDNTZH/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/465DRTIBRTV5M3M47I4YLT7JCNYDNTZH/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/465DRTIBRTV5M3M47I4YLT7JCNYDNTZH/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/465DRTIBRTV5M3M47I4YLT7JCNYDNTZH/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/465DRTIBRTV5M3M47I4YLT7JCNYDNTZH/#465DRTIBRTV5M3M47I4YLT7JCNYDNTZH)

# [security-announce] openSUSE-SU-2013:0834-1: important: MozillaThunderbird: update to 17.0.6

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

27 May
2013

27 May
'13

15:05

openSUSE Security Update: MozillaThunderbird: update to 17.0.6
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:0834-1
Rating: important
References: #819204
Cross-References: CVE-2013-0801 CVE-2013-1669 CVE-2013-1670
CVE-2013-1674 CVE-2013-1675 CVE-2013-1676
CVE-2013-1677 CVE-2013-1678 CVE-2013-1679
CVE-2013-1680 CVE-2013-1681
Affected Products:
openSUSE 12.2
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 11 vulnerabilities is now available.
Description:
MozillaThunderbird was updated to security update
Thunderbird 17.0.6 (bnc#819204):
\* MFSA 2013-41/CVE-2013-0801/CVE-2013-1669 Miscellaneous
memory safety hazards
\* MFSA 2013-42/CVE-2013-1670 (bmo#853709) Privileged access
for content level constructor
\* MFSA 2013-46/CVE-2013-1674 (bmo#860971) Use-after-free
with video and onresize event
\* MFSA 2013-47/CVE-2013-1675 (bmo#866825) Uninitialized
functions in DOMSVGZoomEvent
\* MFSA 2013-48/CVE-2013-1676/CVE-2013-1677/CVE-2013-1678/
CVE-2013-1679/CVE-2013-1680/CVE-2013-1681 Memory
corruption found using Address Sanitizer
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.2:
zypper in -t patch openSUSE-2013-447
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.2 (i586 x86\_64):
MozillaThunderbird-17.0.6-49.43.1
MozillaThunderbird-buildsymbols-17.0.6-49.43.1
MozillaThunderbird-debuginfo-17.0.6-49.43.1
MozillaThunderbird-debugsource-17.0.6-49.43.1
MozillaThunderbird-devel-17.0.6-49.43.1
MozillaThunderbird-devel-debuginfo-17.0.6-49.43.1
MozillaThunderbird-translations-common-17.0.6-49.43.1
MozillaThunderbird-translations-other-17.0.6-49.43.1
enigmail-1.5.1+17.0.6-49.43.1
enigmail-debuginfo-1.5.1+17.0.6-49.43.1
References:
<http://support.novell.com/security/cve/CVE-2013-0801.html>
<http://support.novell.com/security/cve/CVE-2013-1669.html>
<http://support.novell.com/security/cve/CVE-2013-1670.html>
<http://support.novell.com/security/cve/CVE-2013-1674.html>
<http://support.novell.com/security/cve/CVE-2013-1675.html>
<http://support.novell.com/security/cve/CVE-2013-1676.html>
<http://support.novell.com/security/cve/CVE-2013-1677.html>
<http://support.novell.com/security/cve/CVE-2013-1678.html>
<http://support.novell.com/security/cve/CVE-2013-1679.html>
<http://support.novell.com/security/cve/CVE-2013-1680.html>
<http://support.novell.com/security/cve/CVE-2013-1681.html>
<https://bugzilla.novell.com/819204>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/465DRTIBRTV5M3M47I4YLT7JCNYDNTZH/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/465DRTIBRTV5M3M47I4YLT7JCNYDNTZH/#465DRTIBRTV5M3M47I4YLT7JCNYDNTZH)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_cb2bf9ea_20250125_164312.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/803228)
* [XML](/show_bug.cgi?ctype=xml&id=803228)

Closed
[Bug 803228](/show_bug.cgi?id=803228)

Opened 12 years ago
Closed 12 years ago

# Assertion failure: cx->compartment->principals == options.principals

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: cx->compartment->principals == options.principals

## Categories

### (Core Graveyard :: Plug-ins, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Plug-ins#Plug-ins)

Plug-ins
▾

Core Graveyard :: Plug-ins
Bugs in core Mozilla code that supports registering and using plug-ins. For bugs in specific plugins, please file those bugs under External Software Affecting Firefox.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Plug-ins)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

18 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (firefox18 wontfix, firefox19 wontfix, firefox20 wontfix, firefox21 fixed, firefox-esr17 wontfix, b2g18 wontfix)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix) |
| firefox19 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix) |
| firefox20 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 |  | wontfix |
| firefox19 |  | wontfix |
| firefox20 |  | wontfix |
| firefox21 |  | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |

## People

### (Reporter: bc, Assigned: benjamin)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/3301a62f3707d6bcef9542d316fb587f?d=mm&size=40)  [benjamin](/user_profile?user_id=7044)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ee4c7c6351b45c4655e16993a29979b0?d=mm&size=40)  [bc](/user_profile?user_id=23402)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

### ( [URL](http://www.aol.com "http://www.aol.com") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[aol.com](http://www.aol.com "http://www.aol.com")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, sec-audit, Whiteboard: [fixed by bug 824864][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-audit](/buglist.cgi?keywords=sec-audit&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[fixed by bug 824864][adv-main21+]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=803228#c0)• 12 years ago |
|  | |

1. <http://www.aol.com>
2. Assertion failure: cx->compartment->principals == options.principals, at c:/work/mozilla/builds/nightly/mozilla/js/src/jsapi.cpp:5689
s-s 'cause compartments are scary, mkay?
Windows XP Nightly so far. Doesn't appear to crash opt build.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=803228#c1)• 12 years ago |
|  | |

really a plugin issue I think. s-s 'cause principals are scary, mkay?
Thread 0 (crashed)
0 mozjs.dll!JS::Evaluate(JSContext \*,JS::Handle<JSObject \*>,JS::CompileOptions,wchar\_t const \*,unsigned int,JS::Value \*) [jsapi.cpp : 5689 + 0x2b]
eip = 0x00b2b08e esp = 0x0012b4f4 ebp = 0x0012b540 ebx = 0x00000000
esi = 0x0012b610 edi = 0x0012b570 eax = 0x00000000 ecx = 0xd11e63cc
edx = 0x10362ee8 efl = 0x00000212
Found by: given as instruction pointer in context
1 xul.dll!nsJSContext::EvaluateStringWithValue(nsAString\_internal const &,JSObject \*,nsIPrincipal \*,char const \*,unsigned int,unsigned int,JS::Value \*,bool \*) [nsJSEnvironment.cpp : 1313 + 0x54]
eip = 0x02a8eab3 esp = 0x0012b548 ebp = 0x0012b64c
Found by: call frame info
2 xul.dll!mozilla::plugins::parent::\_evaluate(\_NPP \*,NPObject \*,\_NPString \*,\_NPVariant \*) [nsNPAPIPlugin.cpp : 1557 + 0x4c]
eip = 0x0333bc8e esp = 0x0012b654 ebp = 0x0012b808
Found by: call frame info
3 xul.dll!mozilla::plugins::PluginScriptableObjectParent::AnswerNPN\_Evaluate(nsCString const &,mozilla::plugins::Variant \*,bool \*) [PluginScriptableObjectParent.cpp : 1196 + 0x22]
eip = 0x0360df8a esp = 0x0012b810 ebp = 0x0012b868
Found by: call frame info
4 xul.dll!mozilla::plugins::PPluginScriptableObjectParent::OnCallReceived(IPC::Message const &,IPC::Message \* &) [PPluginScriptableObjectParent.cpp : 776 + 0x27]
eip = 0x036795b9 esp = 0x0012b870 ebp = 0x0012bd04
Found by: call frame info
5 xul.dll!mozilla::plugins::PPluginModuleParent::OnCallReceived(IPC::Message const &,IPC::Message \* &) [PPluginModuleParent.cpp : 1288 + 0x1a]
eip = 0x03655c95 esp = 0x0012bd0c ebp = 0x0012be48
Found by: call frame info
6 xul.dll!mozilla::ipc::RPCChannel::DispatchIncall(IPC::Message const &) [RPCChannel.cpp : 486 + 0x1f]
eip = 0x0361db44 esp = 0x0012be50 ebp = 0x0012be80
Found by: call frame info
7 xul.dll!mozilla::ipc::RPCChannel::Incall(IPC::Message const &,unsigned int) [RPCChannel.cpp : 472 + 0xb]
eip = 0x0361da91 esp = 0x0012be88 ebp = 0x0012becc
Found by: call frame info
8 xul.dll!mozilla::ipc::RPCChannel::Call(IPC::Message \*,IPC::Message \*) [RPCChannel.cpp : 279 + 0x15]
eip = 0x0361ced2 esp = 0x0012bed4 ebp = 0x0012c020
Found by: call frame info
9 xul.dll!mozilla::plugins::PPluginScriptableObjectParent::CallHasProperty(mozilla::plugins::PPluginIdentifierParent \*,bool \*) [PPluginScriptableObjectParent.cpp : 288 + 0x18]
eip = 0x03677229 esp = 0x0012c028 ebp = 0x0012c0e8
Found by: call frame info
10 xul.dll!mozilla::plugins::PluginScriptableObjectParent::ScriptableHasProperty(NPObject \*,void \*) [PluginScriptableObjectParent.cpp : 259 + 0x1b]
eip = 0x0360b1e6 esp = 0x0012c0f0 ebp = 0x0012c10c
Found by: call frame info
11 xul.dll!NPObjWrapper\_NewResolve [nsJSNPRuntime.cpp : 1624 + 0x11]
eip = 0x0335fbfb esp = 0x0012c114 ebp = 0x0012c174
Found by: call frame infoAssignee: general → nobodyComponent: JavaScript Engine → Plug-ins

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=803228#c2)• 12 years ago |
|  | |

Found regression between 20120927001241-20120928002836
Pushlog: <http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=b038e9e2023f&tochange=895f66c4eada>
<http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2012/09/2012-09-27-mozilla-central-debug/firefox-18.0a1.en-US.debug-win32.installer.exe>
<http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2012/09/2012-09-28-mozilla-central-debug/firefox-18.0a1.en-US.debug-win32.installer.exe>
I couldn't get a local test case so you might want to check this soon.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=803228#c3)• 12 years ago |
|  | |

My totally wild guess at what's happening:
- There is JS running higher up the stack (frame 12+) because NPObjWrapper\_NewResolve is a JSAPI hook.
- That JS is running on the JSContext\* we have in frame 0.
- That JS is running in a compartment that is not the normal compartment of the JSContext (due to a CCW or something).

|  | [Benjamin Smedberg](/user_profile?user_id=7044)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=803228#c4)• 12 years ago |
|  | |

 mozjs.dll!JS::Evaluate(cx=0x1239fdf0, obj={...}, options={...}, chars=0x12ffb970, length=0x0000064b, rval=0x0022b4f8) Line 5670 C++
xul.dll!nsJSContext::EvaluateStringWithValue(aScript={...}, aScopeObject=0x14bf5d30, aPrincipal=0x1626a518, aURL=0x0dfe45a8, aLineNo=0x00000000, aVersion=0x00000000, aRetValue=0x0022b6cc, aIsUndefined=0x00000000) Line 1313 C++
xul.dll!mozilla::plugins::parent::\_evaluate(npp=0x16b996c4, npobj=0x0e5938e8, script=0x0022b724, result=0x0022b6fc) Line 1558 C++
xul.dll!mozilla::plugins::PluginScriptableObjectParent::AnswerNPN\_Evaluate(aScript={...}, aResult=0x0022b934, aSuccess=0x0022b933) Line 1196 C++
xul.dll!mozilla::plugins::PPluginScriptableObjectParent::OnCallReceived(\_\_msg={...}, \_\_reply=0x00000000) Line 776 C++
> xul.dll!mozilla::plugins::PPluginModuleParent::OnCallReceived(\_\_msg={...}, \_\_reply=0x00000000) Line 1288 C++
xul.dll!mozilla::ipc::RPCChannel::DispatchIncall(call={...}) Line 486 C++
xul.dll!mozilla::ipc::RPCChannel::Incall(call={...}, stackDepth=0x00000001) Line 473 C++
xul.dll!mozilla::ipc::RPCChannel::Call(\_msg=0x180e76e8, reply=0x0022bf14) Line 281 C++
xul.dll!mozilla::plugins::PPluginScriptableObjectParent::CallHasMethod(aId=0x17ff5928, aHasMethod=0x0022bfcf) Line 153 C++
xul.dll!mozilla::plugins::PluginScriptableObjectParent::ScriptableHasMethod(aObject=0x1249a1e0, aName=0x0caebb90) Line 117 C++
xul.dll!NPObjWrapper\_NewResolve(cx=0x1239fdf0, obj={...}, id={...}, flags=0x00000001, objp={...}) Line 1645 C++
mozjs.dll!CallResolveOp(cx=0x1239fdf0, obj={...}, id={...}, flags=0x00000001, objp={...}, propp={...}, recursedp=0x0022c10f) Line 4048 C++
mozjs.dll!LookupPropertyWithFlagsInline(cx=0x1239fdf0, obj={...}, id={...}, flags=0x0000ffff, objp={...}, propp={...}) Line 4100 C++
mozjs.dll!js\_GetPropertyHelperInline(cx=0x1239fdf0, obj={...}, receiver={...}, id\_={...}, getHow=0x00000000, vp={...}) Line 4303 C++
mozjs.dll!js::baseops::GetProperty(cx=0x1239fdf0, obj={...}, receiver={...}, id={...}, vp={...}) Line 4398 C++
mozjs.dll!JSObject::getGeneric(cx=0x1239fdf0, obj={...}, receiver={...}, id={...}, vp={...}) Line 171 C++
mozjs.dll!js::DirectProxyHandler::get(cx=0x1239fdf0, proxy=0x098ca5b0, receiver\_=0x17005cc0, id\_={...}, vp=0x0022cdb8) Line 586 C++
mozjs.dll!js::DirectWrapper::get(cx=0x1239fdf0, wrapper=0x098ca5b0, receiver=0x17005cc0, id={...}, vp=0x0022cdb8) Line 358 C++
mozjs.dll!js::CrossCompartmentWrapper::get(cx=0x1239fdf0, wrapperArg=0x098ca5b0, receiverArg=0x098ca5b0, idArg={...}, vp=0x0022cdb8) Line 592 C++
mozjs.dll!js::Proxy::get(cx=0x1239fdf0, proxy\_={...}, receiver={...}, id={...}, vp={...}) Line 2377 C++
mozjs.dll!proxy\_GetGeneric(cx=0x1239fdf0, obj={...}, receiver={...}, id={...}, vp={...}) Line 2646 C++
mozjs.dll!JSObject::getGeneric(cx=0x1239fdf0, obj={...}, receiver={...}, id={...}, vp={...}) Line 168 C++
mozjs.dll!js::GetPropertyGenericMaybeCallXML(cx=0x1239fdf0, op=JSOP\_GETPROP, obj={...}, id={...}, vp={...}) Line 205 C++
mozjs.dll!js::GetPropertyOperation(cx=0x1239fdf0, script=0x170d6300, pc=0x081999be, lval={...}, vp={...}) Line 277 C++
mozjs.dll!js::Interpret(cx=0x1239fdf0, entryFrame=0x08350020, interpMode=JSINTERP\_NORMAL) Line 2340 C++
mozjs.dll!js::RunScript(cx=0x1239fdf0, script={...}, fp=0x08350020) Line 324 C++
mozjs.dll!js::InvokeKernel(cx=0x1239fdf0, args={...}, construct=NO\_CONSTRUCT) Line 378 C++
mozjs.dll!js::Invoke(cx=0x1239fdf0, args={...}, construct=NO\_CONSTRUCT) Line 109 C++
mozjs.dll!js::Invoke(cx=0x1239fdf0, thisv={...}, fval={...}, argc=0x00000000, argv=0x00000000, rval=0x0022d41c) Line 411 C++
mozjs.dll!JS\_CallFunctionValue(cx=0x1239fdf0, objArg=0x098c2040, fval={...}, argc=0x00000000, argv=0x00000000, rval=0x0022d41c) Line 5863 C++
xul.dll!nsJSContext::CallEventHandler(aTarget=0x0bdacfe8, aScope=0x098c2040, aHandler=0x17310aa0, aargv=0x0e7dbc70, arv=0x0022d484) Line 1921 C++
xul.dll!nsGlobalWindow::RunTimeoutHandler(aTimeout=0x0e648c48, aScx=0x09f64328) Line 9678 C++
xul.dll!nsGlobalWindow::RunTimeout(aTimeout=0x0e648c48) Line 9927 C++
xul.dll!nsGlobalWindow::TimerCallback(aTimer=0x0e64bc90, aClosure=0x0e648c48) Line 10195 C++
xul.dll!nsTimerImpl::Fire() Line 473 C++
xul.dll!nsTimerEvent::Run() Line 558 C++
xul.dll!nsThread::ProcessNextEvent(mayWait=false, result=0x0022d717) Line 612 C++
xul.dll!NS\_ProcessNextEvent\_P(thread=0x00906e30, mayWait=false) Line 220 C++
xul.dll!mozilla::ipc::MessagePump::Run(aDelegate=0x00905c70) Line 82 C++
xul.dll!MessageLoop::RunInternal() Line 209 C++
xul.dll!MessageLoop::RunHandler() Line 202 C++
xul.dll!MessageLoop::Run() Line 176 C++
xul.dll!nsBaseAppShell::Run() Line 165 C++
xul.dll!nsAppShell::Run() Line 232 C++
xul.dll!nsAppStartup::Run() Line 290 C++
xul.dll!XREMain::XRE\_mainRun() Line 3782 C++
xul.dll!XREMain::XRE\_main(argc=0x00000004, argv=0x008e7ab0, aAppData=0x01108864) Line 3848 C++
xul.dll!XRE\_main(argc=0x00000004, argv=0x008e7ab0, aAppData=0x01108864, aFlags=0x00000000) Line 3923 C++
firefox.exe!do\_main(argc=0x00000004, argv=0x008e7ab0) Line 174 C++
firefox.exe!NS\_internal\_main(argc=0x00000004, argv=0x008e7ab0) Line 279 C++
firefox.exe!wmain(argc=0x00000004, argv=0x00409d20) Line 105 C++
firefox.exe!\_\_tmainCRTStartup() Line 552 C
firefox.exe!wmainCRTStartup() Line 371 C
kernel32.dll!@BaseThreadInitThunk@12()
ntdll.dll!\_\_\_RtlUserThreadStart@8()
ntdll.dll!\_\_RtlUserThreadStart@8()
aPrincipal is a codebase principal for "<http://www.aol.com/ads/load_v7.html>"
options.principals = 0x1626a51c which dumps as the same thing
cx->compartment->principals = 0x0eb8eaf4 which dumps as "<http://www.aol.com>" (it's a domain principal)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=803228#a5385_23402)• 12 years ago |

[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=affected)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected)Version: Trunk → 18 Branch

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=803228#c5)• 12 years ago |
|  | |

We have principals that are equivalent to Gecko (which uses nsIPrincipal::Equals to determine that) but that are not equivalent to the JS engine (which does a pointer comparison). It seems like a footgun that the two sides are using different equivalence relations.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=803228#c6)• 12 years ago |
|  | |

(In reply to Kyle Huey [:khuey] (khuey@mozilla.com) from [comment #5](/show_bug.cgi?id=803228#c5 "RESOLVED FIXED - Assertion failure: cx->compartment->principals == options.principals"))
> We have principals that are equivalent to Gecko (which uses
> nsIPrincipal::Equals to determine that) but that are not equivalent to the
> JS engine (which does a pointer comparison). It seems like a footgun that
> the two sides are using different equivalence relations.
We've been moving away from direct principal comparisons in the engine (with the exception of assertion) in part for this reason. Given the assertion that already happens in nsJSContext::EvaluateStringWithValue, it seems like we can just use the other principal to fix this?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=803228#c7)• 12 years ago |
|  | |

In this case the two principals /should/ have compared equal--failing when it should have passed--which is a bug but not a security problem. From the description in [comment 5](/show_bug.cgi?id=803228#c5 "RESOLVED FIXED - Assertion failure: cx->compartment->principals == options.principals") it doesn't sound like we'd get into a security vulnerability case where they compare equal while actually being different. Is that right, or have I misunderstood the scenario?

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=803228#c8)• 12 years ago |
|  | |

Kyle thoughts on [comment 7](/show_bug.cgi?id=803228#c7 "RESOLVED FIXED - Assertion failure: cx->compartment->principals == options.principals")? (Or can you pass over to someone else for a look?)Assignee: nobody → khuey

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=803228#c9)• 12 years ago |
|  | |

Bobby added this assertion, he should comment on the consequences of its failure.Assignee: khuey → nobodyFlags: needinfo?(bobbyholley+bmo)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=803228#c10)• 12 years ago |
|  | |

I added this assertion when I removed the code that handled options.principals. Since the argument was effectively unused, I wanted to make sure that it would match the principal that would actually be used (the scope object's principal). If they don't, then the caller is executing the code with the wrong principal. If that can be made to happen with cross-origin principals, that's bad. The same-origin-ness of the two principals in the testcase here seems likely to be incidental. I think we should assume that such a testcase could be constructed here unless proven otherwise.
Looking at the implementation of \_evaluate in nsNPAPIPlugin.cpp, the issue appears to be that the results of GetDocumentFromNPP(npp) and nsNPObjWrapper::GetNewOrUsed(npp, cx, npobj) are not same-compartment. This could be the result of two possible causes:
(1) - The cx we pull off the document is in a different compartment from the document itself (which can happen if the page has navigated away from the document, since nsIScriptContext is per-outer-window).
(2) - The hashtable already contained an nsNPObjWrapper for npobj, and that object was in a different compartment (so we wrapped it).
Benjamin, any idea which case it is?Flags: needinfo?(bobbyholley+bmo)

|  | [Benjamin Smedberg](/user_profile?user_id=7044)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=803228#c11)• 12 years ago |
|  | |

#2 is much more likely in this case. From the stack it looks like we are scripting some iframe from the main aol page, and so the first wrapper for a plugin object may well be the wrapper for aol.com, not its native document.
aol.com currently doesn't exhibit this issue, but I can look at creating a testcase based on this hunch.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=803228#c12)• 12 years ago |
|  | |

Is the hashmap specific to an NPP object? If so, maybe we should make sure that all objects in the hash are created in that document's compartment, and hand out wrappers as appropriate?

|  | [Benjamin Smedberg](/user_profile?user_id=7044)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=803228#c13)• 12 years ago |
|  | |

We couldn't maintain the invariant, though, because plugins can be adopted into other documents.

|  | [Benjamin Smedberg](/user_profile?user_id=7044)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=803228#c14)• 12 years ago |
|  | |

->me for a testcase for nowAssignee: nobody → benjamin

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=803228#c15)• 12 years ago |
|  | |

I'll assume wanting a testcase in this instance is akin to "sec-audit", but if it finds something we'll want to upgrade the severity.Keywords: [sec-audit](/buglist.cgi?keywords=sec-audit&resolution=---)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=803228#c16)• 12 years ago |
|  | |

Does this still happen, I think it may have been fixed by [bug 824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope").

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=803228#c17)• 12 years ago |
|  | |

Bobby, that looks about right. This has been 'fairly' common but disappears on Nightly after 2013-01-17 but still appears on Aurora, Beta. I've resubmitted the urls for retesting and I'll report back in a bit.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=803228#c18)• 12 years ago |
|  | |

Reproduced Beta, Aurora primarily Windows and 32bit Linux but not 64bit Linux with one url reproducing on 64bit OSX Beta, Aurora. Nightly does crash with the bogus Flash shutdown crash but not with this assertion.Status: NEW → RESOLVEDClosed: 12 years agoResolution: --- → FIXEDWhiteboard: [fixed by bug 824864]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=803228#a9799933_406194)• 12 years ago |

[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=803228#c19)• 12 years ago |
|  | |

Seems unlikely we'd ever try to backport [bug 824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope").
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=803228#a16775726_280903)• 12 years ago |

Whiteboard: [fixed by bug 824864] → [fixed by bug 824864][adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=803228#a65866008_1689)• 10 years ago |

Group: core-security

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=803228#a302141909_546015)• 3 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=803228&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_a6f8a8fa_20250125_164324.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/826588)
* [XML](/show_bug.cgi?ctype=xml&id=826588)

Closed
[Bug 826588](/show_bug.cgi?id=826588)

Opened 12 years ago
Closed 12 years ago

# Differential Testing: Getting different output on 64-bit Windows js shells involving lastIndex

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Differential Testing: Getting different output on 64-bit Windows js shells involving lastIndex

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Windows 7

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=unaffected) |
| firefox19 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=unaffected) |
| firefox20 | --- | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 |  | unaffected |
| firefox19 |  | unaffected |
| firefox20 |  | affected |
| firefox21 |  | fixed |
| firefox-esr17 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: sstangl)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/711501c4322560b918b90250a377fce8?d=mm&size=40)  [sstangl](/user_profile?user_id=383201)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[831884](/show_bug.cgi?id=831884 "RESOLVED FIXED - Prevent calling MatchOnly on Win64 as a Stopgap")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[808245](/show_bug.cgi?id=808245 "RESOLVED FIXED - Use YARR's new MatchOnly JIT mode"), [831055](/show_bug.cgi?id=831055 "RESOLVED FIXED - \"Assertion failure: [infer failure] Missing type in object [0x241d1f0] lastIndex: float,\"")

Dependency [tree](/showdependencytree.cgi?id=826588&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=826588)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, sec-moderate, testcase, Whiteboard: [fuzzblocker][adv-main21+] YARR bug on Win64)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[fuzzblocker][adv-main21+] YARR bug on Win64

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [gkw](/user_profile?user_id=132034) | [in-testsuite](#c8 "12 years ago") | ? |
| --- | --- | --- |
| [gkw](/user_profile?user_id=132034) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=826588#c0)• 12 years ago |
|  | |

r = RegExp("(){0}", "g")
r.test()
print(r.lastIndex)
prints a number that is different everytime, on js opt shell on m-c changeset ceef8a5c3ca1 without any CLI arguments. This only seems to happen on 64-bit builds.
Other platforms / OS'es or Win32 js shells seem to output 0 instead.
Jesse advises to set this s-s pending further investigation.
autoBisect is now running.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=826588#c1)• 12 years ago |
|  | |

autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 116118:7711a36c2771
user: Sean Stangl
date: Wed Dec 12 17:42:02 2012 -0800
summary: [Bug 808245](/show_bug.cgi?id=808245 "RESOLVED FIXED - Use YARR's new MatchOnly JIT mode"), Part 5/6 - Use MatchPairs for RegExp output. r=dvanderBlocks: [808245](/show_bug.cgi?id=808245 "RESOLVED FIXED - Use YARR's new MatchOnly JIT mode")Flags: needinfo?(sstangl)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=826588#c2)• 12 years ago |
|  | |

This is so bad that I've had to disable the compareJIT fuzzer on 64-bit Windows.Whiteboard: [fuzzblocker]

|  | [Sean Stangl [:sstangl]](/user_profile?user_id=383201)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=826588#c3)• 12 years ago |
|  | |

This is a compiler bug on Win64. The problem is that the "length" parameter of executeMatchOnly() takes on a random value, but it has the correct value in the caller.
Printing |length| within executeMatchOnly() causes the test to pass.
Disabling optimizations around executeMatchOnly() does not fix it.
I'm not sure how to fix this.Flags: needinfo?(sstangl)

|  | [Sean Stangl [:sstangl]](/user_profile?user_id=383201)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=826588#c4)• 12 years ago |
|  | |

On further examination, it looks like MatchResult::MatchResult(EncodedMatchResult) assumes that (sizeof size\_t) == 32. I'm not sure why this wouldn't break on x86\_64 Linux, though.

|  | [Sean Stangl [:sstangl]](/user_profile?user_id=383201)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=826588#c5)• 12 years ago |
|  | |

Unfortunately, the problem is that Yarr is built assuming the presence of an ABI that includes a secondary return register. Win64 does not have one, although returnReg2 is erroneously defined for the platform in yarr/YarrJIT.cpp.
Windows will happily let you return a struct of size 128 (inasmuch as it passes compilation). I don't see anything in the Win64 ABI that defines what happens in this situation, but some time with a debugger would sort that mess out. Probably just needs yet another shim.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a485787_1689)• 12 years ago |

Assignee: general → sstanglWhiteboard: [fuzzblocker] → [fuzzblocker] YARR bug on Win64

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a485820_1689)• 12 years ago |

Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a1024028_132034)• 12 years ago |

Blocks: [831055](/show_bug.cgi?id=831055 "RESOLVED FIXED - \"Assertion failure: [infer failure] Missing type in object [0x241d1f0] lastIndex: float,\"")

|  | [Sean Stangl [:sstangl]](/user_profile?user_id=383201)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a1181293_383201)• 12 years ago |

Depends on: [831884](/show_bug.cgi?id=831884 "RESOLVED FIXED - Prevent calling MatchOnly on Win64 as a Stopgap")

|  | [Sean Stangl [:sstangl]](/user_profile?user_id=383201)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a1181362_383201)• 12 years ago |

[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=unaffected)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=unaffected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=826588#c6)• 12 years ago |
|  | |

(In reply to Sean Stangl from [comment #5](/show_bug.cgi?id=826588#c5 "RESOLVED FIXED - Differential Testing: Getting different output on 64-bit Windows js shells involving lastIndex"))
> Windows will happily let you return a struct of size 128 (inasmuch as it
> passes compilation). I don't see anything in the Win64 ABI that defines what
> happens in this situation, but some time with a debugger would sort that
> mess out. Probably just needs yet another shim.
<http://msdn.microsoft.com/en-us/library/7572ztz4.aspx>
Unless you're returning \_\_m128, \_\_m128i, \_\_m128d, floats, and doubles, which are returned in XMM0, then if the return value does not fit into 64 bits then the caller must pass a pointer to the return value.

|  | [Sean Stangl [:sstangl]](/user_profile?user_id=383201)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=826588#c7)• 12 years ago |
|  | |

Gary, this should have been fixed by Makoto's recent patch in [Bug 830676](/show_bug.cgi?id=830676 "RESOLVED FIXED - YarrJIT is broken on Win64 after landing bug 820124").Flags: needinfo?(gary)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=826588#c8)• 12 years ago |
|  | |

I verify that the assertion no longer occurs with the testcase. Setting in-testsuite? and assuming fixed by [bug 830676](/show_bug.cgi?id=830676 "RESOLVED FIXED - YarrJIT is broken on Win64 after landing bug 820124").Status: NEW → RESOLVEDClosed: 12 years agoFlags: needinfo?(gary) → in-testsuite?Resolution: --- → FIXED

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a2918360_132034)• 12 years ago |

[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a3012668_448925)• 12 years ago |

[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a10096770_280903)• 12 years ago |

Whiteboard: [fuzzblocker] YARR bug on Win64 → [fuzzblocker][adv-main21+] YARR bug on Win64

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826588#a42066601_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=826588&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_5e2e52ae_20250125_164330.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/843434)
* [XML](/show_bug.cgi?ctype=xml&id=843434)

Closed
[Bug 843434](/show_bug.cgi?id=843434)

Opened 12 years ago
Closed 12 years ago

# Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP

## Categories

### (Core :: Networking, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking#Networking)

Networking
▾

Core :: Networking
For bugs in Mozilla's modular networking library (aka "Netlib" or "Necko".) The networking library supplies the software interface that Mozilla uses to access physical transports (e.g. the Internet and local drives), perform URL resolutions, and handle a variety of networking protocols.

Examples of appropriate bugs: URLs with backslash not fetched; URLs starting with a single slash turn into http:///; Cannot access authenticated FTP site.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla22

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox22 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | - | affected |
| firefox21 | + | fixed |
| firefox22 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: jaas)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a8fc05fdb6f74856d2cfbeef69fcda2a?d=mm&size=40)  [jaas](/user_profile?user_id=18821)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[638379](/show_bug.cgi?id=638379 "RESOLVED FIXED - make nsIUnicodeDecoder::SetInputErrorBehavior reliable and stop using nsIUnicodeDecoder::Reset for error handling"), [858433](/show_bug.cgi?id=858433 "VERIFIED FIXED - web page not displayed properly in Firefox20 and 21beta.")

Dependency [tree](/showdependencytree.cgi?id=843434&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=843434)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c17 "12 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 2 obsolete files)

| [testcase](/attachment.cgi?id=716326)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   67 bytes, text/html |  | [Details](/attachment.cgi?id=716326&action=edit) |
| --- | --- | --- |
| [stack](/attachment.cgi?id=716327)  [12 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   4.90 KB, text/plain |  | [Details](/attachment.cgi?id=716327&action=edit) |
| [testcase 2: <script>](/attachment.cgi?id=720408)  [12 years ago](#c5)  [Jesse Ruderman](/user_profile?user_id=11608)   62 bytes, text/html |  | [Details](/attachment.cgi?id=720408&action=edit) |
| [fix v1.0](/attachment.cgi?id=722639)  [12 years ago](#c8)  [Josh Aas](/user_profile?user_id=18821)   1.35 KB, patch | emk : [review-](#c9 "12 years ago") | [Details](/attachment.cgi?id=722639&action=edit) | [Diff](/attachment.cgi?id=722639&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=722639) |
| [fix v1.1](/attachment.cgi?id=722911)  [12 years ago](#c10)  [Josh Aas](/user_profile?user_id=18821)   1.43 KB, patch | emk : [review+](#a1363206_5842 "12 years ago") | [Details](/attachment.cgi?id=722911&action=edit) | [Diff](/attachment.cgi?id=722911&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=722911) |
| [fix v1.1 w/test](/attachment.cgi?id=723468)  [12 years ago](#c13)  [Josh Aas](/user_profile?user_id=18821)   2.96 KB, patch | emk : [review+](#a1601779_5842 "12 years ago")  bajaj : [approval-mozilla-beta+](#a3987257_448925 "12 years ago")  lsblakk : [approval-mozilla-release-](#a4138263_272375 "12 years ago") | [Details](/attachment.cgi?id=723468&action=edit) | [Diff](/attachment.cgi?id=723468&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=723468) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=843434#c0)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=716326)
— [Details](attachment.cgi?id=716326&action=edit)

Assertion failure: ((bool)(\_\_builtin\_expect(!!(!NS\_FAILED\_impl(rv)), 1))), at netwerk/base/src/nsUnicharStreamLoader.cpp:218
213 DebugOnly<nsresult> rv =
214 self->mDecoder->Convert(aSegment,
215 &srcLen,
216 self->mBuffer.BeginWriting() + haveRead,
217 &dstLen);
\* 218 MOZ\_ASSERT(NS\_SUCCEEDED(rv));
219 MOZ\_ASSERT(srcLen == static\_cast<int32\_t>(aCount));
220 haveRead += dstLen;
221
222 self->mBuffer.SetLength(haveRead);

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=843434#c1)• 12 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=716327)
— [Details](attachment.cgi?id=716327&action=edit)

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=843434#c2)• 12 years ago |
|  | |

ISO-2022-JP decoder should honor the mErrBehavior...

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=843434#c3)• 12 years ago |
|  | |

is dstLen initialized to something or did line 220-222 just incorporate a random amount of junk into the string?Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a579019_18821)• 12 years ago |

Assignee: nobody → sworkman

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=843434#c4)• 12 years ago |
|  | |

dstLen is initialized by GetMaxLength in line 206.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=843434#c5)• 12 years ago |
|  | |

Attached file
[testcase 2: <script>](attachment.cgi?id=720408)
— [Details](attachment.cgi?id=720408&action=edit)

Assertion failure: ((bool)(\_\_builtin\_expect(!!(!NS\_FAILED\_impl(rv)), 1))), at ../../../../content/base/src/nsScriptLoader.cpp:1070

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=843434#c6)• 12 years ago |
|  | |

(In reply to Masatoshi Kimura [:emk] from [comment #2](/show_bug.cgi?id=843434#c2 "RESOLVED FIXED - Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP"))
> ISO-2022-JP decoder should honor the mErrBehavior...
Can you explain this further?
The error code causing the assertion comes from nsISO2022JPToUnicodeV2::Convert:
================
switch(mState)
{
case mState\_ASCII:
if(0x1b == \*src)
{
mLastLegalState = mState;
mState = mState\_ESC;
} else if(\*src & 0x80) {
ERROR-> goto error2;
} else {
if (CHECK\_OVERRUN(dest, destEnd, 1))
goto error1;
\*dest++ = (PRUnichar) \*src;
}
break;
================
The state is mState\_ASCII, and "if(\*src & 0x80)" is true.

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=843434#c7)• 12 years ago |
|  | |

(In reply to Josh Aas (Mozilla Corporation) from [comment #6](/show_bug.cgi?id=843434#c6 "RESOLVED FIXED - Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP"))
> (In reply to Masatoshi Kimura [:emk] from [comment #2](/show_bug.cgi?id=843434#c2 "RESOLVED FIXED - Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP"))
> > ISO-2022-JP decoder should honor the mErrBehavior...
>
> Can you explain this further?
1. If mErrBehavior is not kOnError\_Signal (default), the ISO-2022-JP decoder should replace the offending char with a REPLACEMENT CHARACTER (U+FFFD) rather than throwing NS\_ERROR\_UNEXPECTED.
2. Even if mErrBehavior is kOnError\_Signal, the thrown error should be NS\_ERROR\_ILLEGAL\_INPUT.

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=843434#c8)• 12 years ago |
|  | |

Attached patch

[fix v1.0](attachment.cgi?id=722639&action=diff) (obsolete)
— [Details](attachment.cgi?id=722639&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=722639)

Thanks for the info.
This avoids the assertion in the first test case, and gives what I'd expect for an error in the script case. I don't really know what this code is supposed to be doing though, so please review carefully!
[Attachment #722639](/attachment.cgi?id=722639&action=edit "fix v1.0") -
Flags: review?(VYV03354)

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=843434#c9)• 12 years ago |
|  | |

Comment on [attachment 722639](/attachment.cgi?id=722639 "fix v1.0") [[details]](/attachment.cgi?id=722639&action=edit "fix v1.0") [[diff]](/attachment.cgi?id=722639&action=diff "fix v1.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=722639)
fix v1.0
You need to call CHECK\_OVERRUN every time you write to dest.
[Attachment #722639](/attachment.cgi?id=722639&action=edit "fix v1.0") -
Flags: review?(VYV03354) → review-

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=843434#c10)• 12 years ago |
|  | |

Attached patch

[fix v1.1](attachment.cgi?id=722911&action=diff) (obsolete)
— [Details](attachment.cgi?id=722911&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=722911)

Like so?
[Attachment #722639](/attachment.cgi?id=722639&action=edit "fix v1.0") -
Attachment is obsolete: true
[Attachment #722911](/attachment.cgi?id=722911&action=edit "fix v1.1") -
Flags: review?(VYV03354)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=843434#c11)• 12 years ago |
|  | |

I will also write a test for this.

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a1361410_18821)• 12 years ago |

Assignee: sworkman → joshmoz

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=843434#c12)• 12 years ago |
|  | |

Comment on [attachment 722911](/attachment.cgi?id=722911 "fix v1.1") [[details]](/attachment.cgi?id=722911&action=edit "fix v1.1") [[diff]](/attachment.cgi?id=722911&action=diff "fix v1.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=722911)
fix v1.1
LGTM

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a1363206_5842)• 12 years ago |

[Attachment #722911](/attachment.cgi?id=722911&action=edit "fix v1.1") -
Flags: review?(VYV03354) → review+

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=843434#c13)• 12 years ago |
|  | |

Attached patch

[fix v1.1 w/test](attachment.cgi?id=723468&action=diff)
— [Details](attachment.cgi?id=723468&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=723468)

This test works, but there may be a better test. The test here fails if the assertion is triggered.
[Attachment #722911](/attachment.cgi?id=722911&action=edit "fix v1.1") -
Attachment is obsolete: true
[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: review?(VYV03354)

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a1601779_5842)• 12 years ago |

[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: review?(VYV03354) → review+

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=843434#c14)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=738d670ac50d>

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a1610897_18821)• 12 years ago |

[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: review?(smontagu)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=843434#c15)• 12 years ago |
|  | |

Comment on [attachment 723468](/attachment.cgi?id=723468 "fix v1.1 w/test") [[details]](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") [[diff]](/attachment.cgi?id=723468&action=diff "fix v1.1 w/test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=723468)
fix v1.1 w/test
Canceling second review, turns out emk is a peer. Had smontagu update the module owernship wiki.
[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: review?(smontagu)

|  | [Josh Aas](/user_profile?user_id=18821)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=843434#c16)• 12 years ago |
|  | |

pushed to mozilla-inbound
<http://hg.mozilla.org/integration/mozilla-inbound/rev/8d7a31fbb879>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=843434#c17)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/8d7a31fbb879>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed)Flags: in-testsuite+Resolution: --- → FIXEDTarget Milestone: --- → mozilla22

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=843434#c18)• 12 years ago |
|  | |

I found another testcase that still trips the assertion. Filed [bug 851982](/show_bug.cgi?id=851982 "RESOLVED FIXED - Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP (#2)").

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=843434#c19)• 12 years ago |
|  | |

Comment on [attachment 723468](/attachment.cgi?id=723468 "fix v1.1 w/test") [[details]](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") [[diff]](/attachment.cgi?id=723468&action=diff "fix v1.1 w/test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=843434&attachment=723468)
fix v1.1 w/test
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 638379](/show_bug.cgi?id=638379 "RESOLVED FIXED - make nsIUnicodeDecoder::SetInputErrorBehavior reliable and stop using nsIUnicodeDecoder::Reset for error handling")
User impact if declined: Some Japanese production sites are broken (see [bug 858433](/show_bug.cgi?id=858433 "VERIFIED FIXED - web page not displayed properly in Firefox20 and 21beta.")).
Testing completed (on m-c, etc.): on m-c and aurora
Risk to taking this patch (and alternatives if risky): very low
String or IDL/UUID changes made by this patch: none
[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: approval-mozilla-release?
[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: approval-mozilla-beta?

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a3765360_5842)• 12 years ago |

Blocks: [858433](/show_bug.cgi?id=858433 "VERIFIED FIXED - web page not displayed properly in Firefox20 and 21beta.")

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=843434#c20)• 12 years ago |
|  | |

Approving on beta, as this is a recent regression from [Bug 638379](/show_bug.cgi?id=638379 "RESOLVED FIXED - make nsIUnicodeDecoder::SetInputErrorBehavior reliable and stop using nsIUnicodeDecoder::Reset for error handling"), which has impacted a few Japanese websites .The patch fixes the broken websites and is low risk,well baked on m-c and aurora.
Please land asap for this to make it into our next beta going to build tomorrow morning PT .

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a3987257_448925)• 12 years ago |

[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a3987289_448925)• 12 years ago |

[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=843434#c21)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/e3bc8afeb76d>
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a4044531_272375)• 12 years ago |

[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=843434#c22)• 12 years ago |
|  | |

Since this is sec-moderate, and we don't have indications that a large number of sites are affected, we'll ship this fix in FF21.
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a4138263_272375)• 12 years ago |

[Attachment #723468](/attachment.cgi?id=723468&action=edit "fix v1.1 w/test") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a6037191_280903)• 12 years ago |

Whiteboard: [adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a6122863_1689)• 12 years ago |

Blocks: [638379](/show_bug.cgi?id=638379 "RESOLVED FIXED - make nsIUnicodeDecoder::SetInputErrorBehavior reliable and stop using nsIUnicodeDecoder::Reset for error handling")
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=843434#a24011308_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=843434&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_82e9a86f_20250125_164328.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/837324)
* [XML](/show_bug.cgi?ctype=xml&id=837324)

Closed
[Bug 837324](/show_bug.cgi?id=837324)

Opened 12 years ago
Closed 12 years ago

# WebRTC crash [@fsmdef\_ev\_addcandidate]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WebRTC crash [@fsmdef\_ev\_addcandidate]

## Categories

### (Core :: WebRTC: Networking, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=WebRTC%3A%20Networking#WebRTC%3A%20Networking)

WebRTC: Networking
▾

Core :: WebRTC: Networking
Bugs in the networking portions of WebRTC (PeerConnection dataChannels, SCTP, DTLS, SRTP, ICE, TURN, STUN, etc)
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=WebRTC%3A%20Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=WebRTC%3A%20Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=WebRTC%3A%20Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | affected |
| firefox21 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: posidron, Assigned: ehugg)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/dd7f56aae04f6a828da60ada692e6eab?d=mm&size=40)  [ehugg](/user_profile?user_id=436277)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/fba16ea71cd5ef27991fcea651e8cd56?d=mm&size=40)  [jsmith](/user_profile?user_id=432443)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=40)  [posidron](/user_profile?user_id=368570)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/3e201149abea356acc9bb6f0eea8b5a0?d=mm&size=40)  [bwc](/user_profile?user_id=478411)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[fuzzing-webrtc](/show_bug.cgi?id=792125 "RESOLVED FIXED - [meta] Fuzzing: WebRTC Library")

Dependency [tree](/showdependencytree.cgi?id=837324&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=837324)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[835835](/show_bug.cgi?id=835835 "RESOLVED DUPLICATE - WebRTC use-after-free crash [@sipcc::PeerConnectionMedia::ShutdownMediaTransport]"), [837324](/show_bug.cgi?id=837324 "VERIFIED FIXED - WebRTC crash [@fsmdef_ev_addcandidate]")

## Details

### (Keywords: crash, sec-low, testcase, Whiteboard: [WebRTC][blocking-webrtc+][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[WebRTC][blocking-webrtc+][adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c29 "12 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ fsmdef\_ev\_addcandidate ]](https://crash-stats.mozilla.org/signature/?signature=fsmdef_ev_addcandidate)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 2 obsolete files)

| [callstack](/attachment.cgi?id=709282)  [12 years ago](#c0)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   6.44 KB, text/plain |  | [Details](/attachment.cgi?id=709282&action=edit) |
| --- | --- | --- |
| [testcase](/attachment.cgi?id=709283)  [12 years ago](#c1)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   511 bytes, text/html |  | [Details](/attachment.cgi?id=709283&action=edit) |
| [testcase](/attachment.cgi?id=709373)  [12 years ago](#c3)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   454 bytes, text/html |  | [Details](/attachment.cgi?id=709373&action=edit) |
| [Crashtest for 1st testcase v1](/attachment.cgi?id=710084)  [12 years ago](#c9)  [Jason Smith [:jsmith]](/user_profile?user_id=432443)   1.40 KB, patch | jesup : [review+](#a941739_11539 "12 years ago") | [Details](/attachment.cgi?id=710084&action=edit) | [Diff](/attachment.cgi?id=710084&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710084) |
| [testcase-after-fix](/attachment.cgi?id=710233)  [12 years ago](#c13)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   12.37 KB, text/html |  | [Details](/attachment.cgi?id=710233&action=edit) |
| [testcase-after-fix](/attachment.cgi?id=710234)  [12 years ago](#c14)  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)   507 bytes, text/html |  | [Details](/attachment.cgi?id=710234&action=edit) |
| [Fix ui\_ice\_candidate\_add call when dcb is NULL](/attachment.cgi?id=710316)  [12 years ago](#c24)  [Ethan Hugg [:ehugg]](/user_profile?user_id=436277)   1.94 KB, patch | ekr : [review+](#c25 "12 years ago") | [Details](/attachment.cgi?id=710316&action=edit) | [Diff](/attachment.cgi?id=710316&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710316) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=837324#c0)• 12 years ago |
|  | |

Attached file
[callstack](attachment.cgi?id=709282)
— [Details](attachment.cgi?id=709282&action=edit)

Click "start" to reproduce.
Tested with m-c changeset: 120354:2cc710018b14

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=837324#c1)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=709283) (obsolete)
— [Details](attachment.cgi?id=709283&action=edit)

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a263_368570)• 12 years ago |

Crash Signature: [@ fsmdef\_ev\_addcandidate]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=837324#c2)• 12 years ago |
|  | |

0 XUL fsmdef\_ev\_addcandidate fsmdef.c:3654
1 XUL sm\_process\_event sm.c:48
2 XUL fim\_process\_event fim.c:651
3 XUL gsm\_process\_msg gsm.c:132
4 XUL GSMTask gsm.c:324
5 libsystem\_c.dylib libsystem\_c.dylib@0x4e8bf
6 libsystem\_c.dylib libsystem\_c.dylib@0x51b75
7 XUL XUL@0x17185b0Flags: in-testsuite?

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=837324#c3)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=709373)
— [Details](attachment.cgi?id=709373&action=edit)

The while loop is not needed.
[Attachment #709283](/attachment.cgi?id=709283&action=edit "testcase") -
Attachment is obsolete: true

|  | [Eric Rescorla (:ekr)](/user_profile?user_id=35667) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=837324#c4)• 12 years ago |
|  | |

I cannot reproduce this with a local build of asan and the listed line number (3654) is a comment in my copy of fsmdef.c
Please provide a new run with not just the line number but also the actual contents of the failing line of code.
Best-case, please break it in the debugger and show the offending object.Flags: needinfo?(cdiehl)

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=837324#c5)• 12 years ago |
|  | |

Also can not reproduce it with m-i 120658:4466d3ff8ada
The crashing line for m-c 120354:2cc710018b14 is:
gsmsdp\_set\_ice\_attribute (SDP\_ATTR\_ICE\_CANDIDATE, level,
dcb->sdp->dest\_sdp, candidate);
gdb $ p dcb
$4 = (fsmdef\_dcb\_t \*) 0x114fe8080
gdb $ p dcb->sdp
$5 = (cc\_sdp\_t \*) 0x0
gdb $ p dcb->sdp->dest\_sdp
Cannot access memory at address 0x8Flags: needinfo?(cdiehl)

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=837324#c6)• 12 years ago |
|  | |

It is line 3668 on m-i 120658:4466d3ff8ada

|  | [Eric Rescorla (:ekr)](/user_profile?user_id=35667) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=837324#c7)• 12 years ago |
|  | |

Fixed in 120528:f8e40ab9bf6cStatus: NEW → RESOLVEDClosed: 12 years agoResolution: --- → FIXED

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a78928_76551)• 12 years ago |

Depends on: [834100](/show_bug.cgi?id=834100 "VERIFIED FIXED - Null deref if you call addIceCandidate on an RTCPeerConnection before setting localDesc [@ fsmdef_ev_addcandidate]")

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a147706_432443)• 12 years ago |

Keywords: [verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=837324#c8)• 12 years ago |
|  | |

Verified on 2/3/2013 - not getting a crash.Keywords: [verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a164051_432443)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=837324#c9)• 12 years ago |
|  | |

Attached patch

[Crashtest for 1st testcase v1](attachment.cgi?id=710084&action=diff)
— [Details](attachment.cgi?id=710084&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710084)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a289316_432443)• 12 years ago |

[Attachment #710084](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") -
Flags: review?(rjesup)

|  | [Scoobidiver (away)](/user_profile?user_id=386758) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=837324#c10)• 12 years ago |
|  | |

(In reply to Jason Smith [:jsmith] from [comment #8](/show_bug.cgi?id=837324#c8 "VERIFIED FIXED - WebRTC crash [@fsmdef_ev_addcandidate]"))
> Verified on 2/3/2013 - not getting a crash.
There are still crashes with this signature: <https://crash-stats.mozilla.com/report/list?signature=fsmdef_ev_addcandidate>

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=837324#c11)• 12 years ago |
|  | |

Correct. So this crash has not been fixed by [bug 834100](/show_bug.cgi?id=834100 "VERIFIED FIXED - Null deref if you call addIceCandidate on an RTCPeerConnection before setting localDesc [@ fsmdef_ev_addcandidate]"). It's also a cross-platform crash.
One of those reports from a build on Feb 4th: [bp-64ffad4b-0ce8-4e97-bd72-17f272130205](https://crash-stats.mozilla.org/report/index/64ffad4b-0ce8-4e97-bd72-17f272130205)Status: VERIFIED → REOPENEDNo longer depends on: [834100](/show_bug.cgi?id=834100 "VERIFIED FIXED - Null deref if you call addIceCandidate on an RTCPeerConnection before setting localDesc [@ fsmdef_ev_addcandidate]")OS: Mac OS X → AllHardware: x86\_64 → AllResolution: FIXED → ---

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a315291_432443)• 12 years ago |

Keywords: [needURLs](/buglist.cgi?keywords=needURLs&resolution=---)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=837324#c12)• 12 years ago |
|  | |

The only URL existent for now is:
<https://apprtc.appspot.com>
The others are the testcases from this bug and the one Eric thought it will fix this bug.Keywords: [needURLs](/buglist.cgi?keywords=needURLs&resolution=---)

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=837324#c13)• 12 years ago |
|  | |

Attached file
[testcase-after-fix](attachment.cgi?id=710233) (obsolete)
— [Details](attachment.cgi?id=710233&action=edit)

Depends, the testcase here does not crash anymore immediately. We are now crashing here:
if (dcb == NULL) {
FSM\_DEBUG\_SM(DEB\_F\_PREFIX"dcb is NULL.\n", DEB\_F\_PREFIX\_ARGS(FSM, \_\_FUNCTION\_\_));
ui\_ice\_candidate\_add(evAddIceCandidateError, line, call\_id,
dcb->caller\_id.call\_instance\_id, strlib\_empty());
return SM\_RC\_CLEANUP;
}
Have added a new testcase, click the button a few times and wait.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=837324#c14)• 12 years ago |
|  | |

Attached file
[testcase-after-fix](attachment.cgi?id=710234)
— [Details](attachment.cgi?id=710234&action=edit)

Let's use this testcase for simplicity, since the malformed candidate strings doesn't seem to cause the problem.
[Attachment #710233](/attachment.cgi?id=710233&action=edit "testcase-after-fix") -
Attachment is obsolete: true

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=837324#c15)• 12 years ago |
|  | |

(In reply to Christoph Diehl [:cdiehl] from [comment #14](/show_bug.cgi?id=837324#c14 "VERIFIED FIXED - WebRTC crash [@fsmdef_ev_addcandidate]"))
> Created [attachment 710234](/attachment.cgi?id=710234 "testcase-after-fix") [[details]](/attachment.cgi?id=710234&action=edit "testcase-after-fix")
> testcase-after-fix
>
> Let's use this testcase for simplicity, since the malformed candidate
> strings doesn't seem to cause the problem.
Is this the same crash as this bug?
Cause the stack I got looks different:
<https://crash-stats.mozilla.com/report/index/bp-12a04f7b-34e4-422a-8b36-b34402130205>

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=837324#c16)• 12 years ago |
|  | |

Ohw, that looks like the callstack I just filed for a use-after-free crash for which I had no testcase. See bug: 838169. Somehow those crashes are all connected.
I will hide this bug because it contains a testcase which can trigger also the use-after-free crash.Group: mozilla-corporation-confidential

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a320143_368570)• 12 years ago |

Group: mozilla-corporation-confidential → core-security

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=837324#c17)• 12 years ago |
|  | |

Comment on [attachment 710084](/attachment.cgi?id=710084 "Crashtest for 1st testcase v1") [[details]](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") [[diff]](/attachment.cgi?id=710084&action=diff "Crashtest for 1st testcase v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710084)
Crashtest for 1st testcase v1
Given that the original test case isn't causing the crash, I'm clearing the review request here.
[Attachment #710084](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") -
Attachment is obsolete: true
[Attachment #710084](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") -
Flags: review?(rjesup)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a320254_432443)• 12 years ago |

Whiteboard: [WebRTC][blocking-webrtc+]

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a320301_368570)• 12 years ago |

See Also: → [835835](/show_bug.cgi?id=835835 "RESOLVED DUPLICATE - WebRTC use-after-free crash [@sipcc::PeerConnectionMedia::ShutdownMediaTransport]"), [837324](/show_bug.cgi?id=837324 "VERIFIED FIXED - WebRTC crash [@fsmdef_ev_addcandidate]")

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=837324#c18)• 12 years ago |
|  | |

(In reply to Jason Smith [:jsmith] from [comment #17](/show_bug.cgi?id=837324#c17 "VERIFIED FIXED - WebRTC crash [@fsmdef_ev_addcandidate]"))
> Given that the original test case isn't causing the crash, I'm clearing the
> review request here.
This testcase was crashing the browser with this stack. So it would still be worth having this test in the tree. Also because it's different from the one from [bug 837324](/show_bug.cgi?id=837324 "VERIFIED FIXED - WebRTC crash [@fsmdef_ev_addcandidate]").

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=837324#c19)• 12 years ago |
|  | |

The original testcase is not obsolete per se, but it requires you now to click the crash button a few more times. Therefore I have added the setTimeout function to the new testcase. Before the patch landed a single PeerConnection/addIceCandidate call was enough to trigger the crash.

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=837324#c20)• 12 years ago |
|  | |

Comment on [attachment 710084](/attachment.cgi?id=710084 "Crashtest for 1st testcase v1") [[details]](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") [[diff]](/attachment.cgi?id=710084&action=diff "Crashtest for 1st testcase v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710084)
Crashtest for 1st testcase v1
Alright, putting r? back out then. Sounds like it's still worthwhile to check this in then.
Might need to make the 2nd testcase have a different name though.
[Attachment #710084](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") -
Attachment description: Crashtest v1 → Crashtest for 1st testcase v1
[Attachment #710084](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") -
Attachment is obsolete: false
[Attachment #710084](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") -
Flags: review?(rjesup)

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=837324#c21)• 12 years ago |
|  | |

Edit: The callstack is the same except the line number changed for #0, it is:
media/webrtc/signaling/src/sipcc/core/gsm/fsmdef.c:3539

|  | [Eric Rescorla (:ekr)](/user_profile?user_id=35667) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=837324#c22)• 12 years ago |
|  | |

OK, so the problem here is a simple null-ptr deref, because dcb == NULL and then
we are doing dcb->caller\_id
if (dcb == NULL) {
FSM\_DEBUG\_SM(DEB\_F\_PREFIX"dcb is NULL.\n", DEB\_F\_PREFIX\_ARGS(FSM, \_\_FUNCTION\_\_));
ui\_ice\_candidate\_add(evAddIceCandidateError, line, call\_id,
dcb->caller\_id.call\_instance\_id, strlib\_empty());
Yo

|  | [Eric Rescorla (:ekr)](/user_profile?user_id=35667) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=837324#c23)• 12 years ago |
|  | |

This probably means that the NrIceCtx::Release() in c15 is a different defect.

|  | [Ethan Hugg [:ehugg]](/user_profile?user_id=436277)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=837324#c24)• 12 years ago |
|  | |

Attached patch

[Fix ui\_ice\_candidate\_add call when dcb is NULL](attachment.cgi?id=710316&action=diff)
— [Details](attachment.cgi?id=710316&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710316)

|  | [Ethan Hugg [:ehugg]](/user_profile?user_id=436277)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a329569_436277)• 12 years ago |

[Attachment #710316](/attachment.cgi?id=710316&action=edit "Fix ui_ice_candidate_add call when dcb is NULL") -
Flags: review?(rjesup)

|  | [Eric Rescorla (:ekr)](/user_profile?user_id=35667) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=837324#c25)• 12 years ago |
|  | |

Comment on [attachment 710316](/attachment.cgi?id=710316 "Fix ui_ice_candidate_add call when dcb is NULL") [[details]](/attachment.cgi?id=710316&action=edit "Fix ui_ice_candidate_add call when dcb is NULL") [[diff]](/attachment.cgi?id=710316&action=diff "Fix ui_ice_candidate_add call when dcb is NULL") [[review]](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710316)
Fix ui\_ice\_candidate\_add call when dcb is NULL
Review of [attachment 710316](/attachment.cgi?id=710316 "Fix ui_ice_candidate_add call when dcb is NULL") [[details]](/attachment.cgi?id=710316&action=edit "Fix ui_ice_candidate_add call when dcb is NULL") [[diff]](/attachment.cgi?id=710316&action=diff "Fix ui_ice_candidate_add call when dcb is NULL") [[review]](/page.cgi?id=splinter.html&ignore=&bug=837324&attachment=710316):
-----------------------------------------------------------------
lgtm
[Attachment #710316](/attachment.cgi?id=710316&action=edit "Fix ui_ice_candidate_add call when dcb is NULL") -
Flags: review?(rjesup) → review+

|  | [Ethan Hugg [:ehugg]](/user_profile?user_id=436277)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a407535_436277)• 12 years ago |

Assignee: nobody → ethanhuggKeywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Ethan Hugg [:ehugg]](/user_profile?user_id=436277)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=837324#c26)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/9e978440a0ce>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=837324#c27)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/9e978440a0ce>Status: REOPENED → RESOLVEDClosed: 12 years ago → 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla21

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a439082_432443)• 12 years ago |

Keywords: [verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a520008_448925)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=837324#c28)• 12 years ago |
|  | |

Verified on 2/8/2013 with updated test case.Status: RESOLVED → VERIFIEDKeywords: [verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a941739_11539)• 12 years ago |

[Attachment #710084](/attachment.cgi?id=710084&action=edit "Crashtest for 1st testcase v1") -
Flags: review?(rjesup) → review+

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a943519_432443)• 12 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=837324#c29)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/4f2e0fe92df9>Flags: in-testsuite? → in-testsuite+

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a959988_432443)• 12 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=837324#c30)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/4f2e0fe92df9>

|  | [Scoobidiver (away)](/user_profile?user_id=386758) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=837324#c31)• 12 years ago |
|  | |

There are crashes from a single user in 20.0b1.
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a7601601_280903)• 12 years ago |

Whiteboard: [WebRTC][blocking-webrtc+] → [WebRTC][blocking-webrtc+][adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837324#a25662362_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=837324&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christoph Diehl [:posidron]](/user_profile?user_id=368570)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_a011f10a_20250125_164334.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/865948)
* [XML](/show_bug.cgi?ctype=xml&id=865948)

Closed
[Bug 865948](/show_bug.cgi?id=865948)
(CVE-2013-1703)

Opened 12 years ago
Closed 12 years ago

# nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla23

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox-esr17 | [23+](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=23%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=fixed) |
| b2g18 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed) |
| b2g18-v1.0.0 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix) |
| b2g18-v1.0.1 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | wontfix |
| firefox21 | + | fixed |
| firefox22 | + | fixed |
| firefox23 | + | fixed |
| firefox-esr17 | 23+ | fixed |
| b2g18 |  | fixed |
| b2g18-v1.0.0 |  | wontfix |
| b2g18-v1.0.1 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bholley, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[734891](/show_bug.cgi?id=734891 "RESOLVED FIXED - Content scripts need more privileges (cross domain features)"), [CVE-2013-1687](/show_bug.cgi?id=863933 "VERIFIED FIXED - Arbitrary code execution via XBL")

Dependency [tree](/showdependencytree.cgi?id=865948&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=865948)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, reporter-external, sec-high, Whiteboard: [adv-main21+][adv-esr1708+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2013-1703

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main21+][adv-esr1708+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1544569_1689 "12 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [bholley](/user_profile?user_id=313730) | [in-testsuite](#a45223314_313730 "12 years ago") | + |
| --- | --- | --- |
| [bholley](/user_profile?user_id=313730) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Return the appropriate value when the whitelist checks fail. v1](/attachment.cgi?id=742718)  [12 years ago](#c9)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.31 KB, patch | gkrizsanits : [review+](#a165145_420273 "12 years ago")  bajaj : [approval-mozilla-aurora+](#c18 "12 years ago")  bajaj : [approval-mozilla-beta+](#c20 "12 years ago")  akeybl : [approval-mozilla-esr17+](#a7659864_425645 "12 years ago")  lsblakk : [approval-mozilla-b2g18+](#c22 "12 years ago") | [Details](/attachment.cgi?id=742718&action=edit) | [Diff](/attachment.cgi?id=742718&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718) |
| --- | --- | --- |
| [Tests. v1](/attachment.cgi?id=742719)  [12 years ago](#c10)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.34 KB, patch | gkrizsanits : [review+](#c12 "12 years ago") | [Details](/attachment.cgi?id=742719&action=edit) | [Diff](/attachment.cgi?id=742719&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742719) |
| [Tests. v2 r=gabor](/attachment.cgi?id=742757)  [12 years ago](#c14)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.43 KB, patch | bholley : [review+](#c14 "12 years ago") | [Details](/attachment.cgi?id=742757&action=edit) | [Diff](/attachment.cgi?id=742757&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742757) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=865948#c0)• 12 years ago |
|  | |

in CheckLoadURIWithPrincipal, we have special handling for nsExpandedPrincipal, in which we iterate over the whitelist, caling CheckLoadURIWithPrincipal on each one individually. But if none of those succeed, we return NS\_OK (!!!) instead of a failure code. This means that the nsExpandedPrincipal can load whatever it wants. :-(
I really should have caught this in review. I'm currently investigating why this wasn't caught by our test coverage.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=865948#c1)• 12 years ago |
|  | |

This is a regression from [bug 734891](/show_bug.cgi?id=734891 "RESOLVED FIXED - Content scripts need more privileges (cross domain features)"), patch 2, which landed in Fx16.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-b2g18-v1.0.0](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix)
[status-b2g18-v1.0.1](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=865948#c2)• 12 years ago |
|  | |

Probably better not to mark the dependency on [bug 734891](/show_bug.cgi?id=734891 "RESOLVED FIXED - Content scripts need more privileges (cross domain features)"), which may be findable by inspection of the patch.

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=865948#c3)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #0](/show_bug.cgi?id=865948#c0 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> This means that
> the nsExpandedPrincipal can load whatever it wants. :-(
Trying to estimate the risk here... what can they load? For XHR this check is only used for the scheme check (we don't have test coverage for that :( ), but XHR to another domain that is not on the list still fails. For accessing object we don't rely on this check. Can we load anything else? Is anyone currently using nsEP based XHR?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=865948#c4)• 12 years ago |
|  | |

(In reply to Gabor Krizsanits [:krizsa :gabor] from [comment #3](/show_bug.cgi?id=865948#c3 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> Can we load anything else? Is anyone currently using nsEP based XHR?
This check isn't just for XHR. In this particular case, it allows content to load about: (a system-principal paged) in an iframe, which should normally throw as insecure.

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=865948#c5)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #4](/show_bug.cgi?id=865948#c4 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> (In reply to Gabor Krizsanits [:krizsa :gabor] from [comment #3](/show_bug.cgi?id=865948#c3 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> > Can we load anything else? Is anyone currently using nsEP based XHR?
>
> This check isn't just for XHR. In this particular case, it allows content to
> load about: (a system-principal paged) in an iframe, which should normally
> throw as insecure.
Sure, I get that this check is used in other cases too. But I don't understand your example, how could content code ever run with nsEP to do that?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=865948#c6)• 12 years ago |
|  | |

(In reply to Gabor Krizsanits [:krizsa :gabor] from [comment #5](/show_bug.cgi?id=865948#c5 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> Sure, I get that this check is used in other cases too. But I don't
> understand your example, how could content code ever run with nsEP to do
> that?
If they combine it with other vulnerabilities, like [bug 865947](/show_bug.cgi?id=865947 "RESOLVED FIXED - <marquee> evals arbitrary strings"). See [bug 863933](/show_bug.cgi?id=863933 "VERIFIED FIXED - Arbitrary code execution via XBL").

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=865948#c7)• 12 years ago |
|  | |

Thanks, I looked over that one. wow... just, wow...

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=865948#c8)• 12 years ago |
|  | |

Can we get a security rating here? Tracking regardless for now, but the sec rating will be important for uplift considerations.
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=865948#c9)• 12 years ago |
|  | |

Attached patch

[Return the appropriate value when the whitelist checks fail. v1](attachment.cgi?id=742718&action=diff)
— [Details](attachment.cgi?id=742718&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)

[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: review?(gkrizsanits)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=865948#c10)• 12 years ago |
|  | |

Attached patch

[Tests. v1](attachment.cgi?id=742719&action=diff)
— [Details](attachment.cgi?id=742719&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742719)

[Attachment #742719](/attachment.cgi?id=742719&action=edit "Tests. v1") -
Flags: review?(gkrizsanits)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a144006_313730)• 12 years ago |

Flags: in-testsuite?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=865948#c11)• 12 years ago |
|  | |

It's hard to say. I'm going to hazard a guess at sec-moderate on its own, but this is one of the pieces that make up [bug 863933](/show_bug.cgi?id=863933 "VERIFIED FIXED - Arbitrary code execution via XBL"), which is sec-critical.Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a165145_420273)• 12 years ago |

[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: review?(gkrizsanits) → review+

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=865948#c12)• 12 years ago |
|  | |

Comment on [attachment 742719](/attachment.cgi?id=742719 "Tests. v1") [[details]](/attachment.cgi?id=742719&action=edit "Tests. v1") [[diff]](/attachment.cgi?id=742719&action=diff "Tests. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742719)
Tests. v1
Review of [attachment 742719](/attachment.cgi?id=742719 "Tests. v1") [[details]](/attachment.cgi?id=742719&action=edit "Tests. v1") [[diff]](/attachment.cgi?id=742719&action=diff "Tests. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742719):
-----------------------------------------------------------------
replace all 777777 -> 865948
[Attachment #742719](/attachment.cgi?id=742719&action=edit "Tests. v1") -
Flags: review?(gkrizsanits) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=865948#c13)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/cf9e342c1e7c>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=865948#c14)• 12 years ago |
|  | |

Attached patch

[Tests. v2 r=gabor](attachment.cgi?id=742757&action=diff)
— [Details](attachment.cgi?id=742757&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742757)

Heh, sorry about the 777777 thing. I was on a plane and couldn't file a bug. :-)
[Attachment #742757](/attachment.cgi?id=742757&action=edit "Tests. v2 r=gabor") -
Flags: review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=865948#c15)• 12 years ago |
|  | |

Comment on [attachment 742718](/attachment.cgi?id=742718 "Return the appropriate value when the whitelist checks fail. v1") [[details]](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") [[diff]](/attachment.cgi?id=742718&action=diff "Return the appropriate value when the whitelist checks fail. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)
Return the appropriate value when the whitelist checks fail. v1
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 734891](/show_bug.cgi?id=734891 "RESOLVED FIXED - Content scripts need more privileges (cross domain features)")
User impact if declined: Potential security bugs, depending on who's using nsExpandedPrincipal. They only started being used outside of jetpack in FF21.
Testing completed (on m-c, etc.): Just pushed to inbound, but the patch is very safe.
Risk to taking this patch (and alternatives if risky): None. Not risky.
String or IDL/UUID changes made by this patch: None
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-esr17?
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-beta?
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-b2g18?
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-aurora?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=865948#c16)• 12 years ago |
|  | |

See [comment 11](/show_bug.cgi?id=865948#c11 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal") for the security ramifications of this beyond the immediate sec-moderate rating.

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=865948#c17)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/cf9e342c1e7c>Target Milestone: --- → mozilla23

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a332871_308534)• 12 years ago |

Status: NEW → RESOLVEDClosed: 12 years agoResolution: --- → FIXED

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=865948#c18)• 12 years ago |
|  | |

Comment on [attachment 742718](/attachment.cgi?id=742718 "Return the appropriate value when the whitelist checks fail. v1") [[details]](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") [[diff]](/attachment.cgi?id=742718&action=diff "Return the appropriate value when the whitelist checks fail. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)
Return the appropriate value when the whitelist checks fail. v1
Given this is sec-mod,I am going to untrack it for Fx21 and let the fix land in Fx22.Also this is a regression from Fx16, hence no rush to get it landed in our final two beta's .Approving for aurora and a- for beta.
please renominate if there is a disagreement here.
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-beta?
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-beta-
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-aurora?
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-aurora+

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a338489_448925)• 12 years ago |

[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=-)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=865948#c19)• 12 years ago |
|  | |

Comment on [attachment 742718](/attachment.cgi?id=742718 "Return the appropriate value when the whitelist checks fail. v1") [[details]](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") [[diff]](/attachment.cgi?id=742718&action=diff "Return the appropriate value when the whitelist checks fail. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)
Return the appropriate value when the whitelist checks fail. v1
(In reply to bhavana bajaj [:bajaj] from [comment #18](/show_bug.cgi?id=865948#c18 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> Comment on [attachment 742718](/attachment.cgi?id=742718 "Return the appropriate value when the whitelist checks fail. v1") [[details]](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") [[diff]](/attachment.cgi?id=742718&action=diff "Return the appropriate value when the whitelist checks fail. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)
> Return the appropriate value when the whitelist checks fail. v1
>
> Given this is sec-mod
See [comment 16](/show_bug.cgi?id=865948#c16 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"). The security rating is kind of arbitrary here.
> Also this is a regression from Fx16, hence no rush to get it landed
> in our final two beta's.
It's a regression from Fx16 in that Fx16 introduced the feature of nsExpandedPrincipal. But we only started using it in the platform in Fx21.
I think we should take the patch. It's a one-liner that very clearly only takes effect in a situation that is, otherwise, a very obvious security bug.
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-beta- → approval-mozilla-beta?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=865948#c20)• 12 years ago |
|  | |

Comment on [attachment 742718](/attachment.cgi?id=742718 "Return the appropriate value when the whitelist checks fail. v1") [[details]](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") [[diff]](/attachment.cgi?id=742718&action=diff "Return the appropriate value when the whitelist checks fail. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)
Return the appropriate value when the whitelist checks fail. v1
Reconsidered based on [https://bugzilla.mozilla.org/show\_bug.cgi?id=865948#c19](/show_bug.cgi?id=865948#c19 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal") & because the patch is very safe . Approving on beta.
please land by tomorrow noon PT.
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a340679_448925)• 12 years ago |

[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=-) → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a342940_75935)• 12 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=865948#c21)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/32fb800ed81d>
<https://hg.mozilla.org/releases/mozilla-beta/rev/75e01dbd4b22>
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a399499_272375)• 12 years ago |

[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=865948#c22)• 12 years ago |
|  | |

Comment on [attachment 742718](/attachment.cgi?id=742718 "Return the appropriate value when the whitelist checks fail. v1") [[details]](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") [[diff]](/attachment.cgi?id=742718&action=diff "Return the appropriate value when the whitelist checks fail. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)
Return the appropriate value when the whitelist checks fail. v1
This is out of scope for ESR17, being sec-moderate, approving for uplift to b2g18 though.
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-esr17?
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-esr17-
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-b2g18?
[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-b2g18+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=865948#c23)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g18/rev/e74a88ada013>
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=865948#c24)• 12 years ago |
|  | |

(In reply to lsblakk@mozilla.com from [comment #22](/show_bug.cgi?id=865948#c22 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> Comment on [attachment 742718](/attachment.cgi?id=742718 "Return the appropriate value when the whitelist checks fail. v1") [[details]](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") [[diff]](/attachment.cgi?id=742718&action=diff "Return the appropriate value when the whitelist checks fail. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=865948&attachment=742718)
> Return the appropriate value when the whitelist checks fail. v1
>
> This is out of scope for ESR17, being sec-moderate, approving for uplift to
> b2g18 though.
Ok. We should definitely advisory-embargo this until esr17-EOL then. Al, is that the default behavior when we WONTFIX a sec bug on branch? This \_could\_ also imply embargoing [bug 863933](/show_bug.cgi?id=863933 "VERIFIED FIXED - Arbitrary code execution via XBL"), which gets tricky...Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=865948#c25)• 12 years ago |
|  | |

We only mention where we fix in advisories, not where we won't fix.
This is only a sec-moderate. Normally, as an internal find, this would go into the rollup advisory under the list of "things found by Mozilla people that we fixed in 21" with a link to a list of bugs in bugzilla (and no details). This wouldn't get its own advisory.Flags: needinfo?(abillings)Whiteboard: [adv-main21+]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=865948#c26)• 12 years ago |
|  | |

Al, this isn't actually an internal find, despite the fact that bholley filed the bug. It is actually one part of [bug 863933](/show_bug.cgi?id=863933 "VERIFIED FIXED - Arbitrary code execution via XBL"), which was externally reported, so it seems to me it thus qualifies as externally reported.
Personally, I think this is such a low risk fix, and part of a really awful exploit, so we should really just take it on ESR17. Maybe we could even wait a few weeks, or maybe a month (when it will be in release), to get a better sense if there are any regressions.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=865948#c27)• 12 years ago |
|  | |

Ah, I didn't realize that this was an external report. Let's loop in release management.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a1544569_1689)• 12 years ago |

Blocks: [734891](/show_bug.cgi?id=734891 "RESOLVED FIXED - Content scripts need more privileges (cross domain features)")Flags: sec-bounty+Keywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---) → [regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=865948#c30)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #26](/show_bug.cgi?id=865948#c26 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal"))
> Personally, I think this is such a low risk fix, and part of a really
> awful exploit, so we should really just take it on ESR17. Maybe we
> could even wait a few weeks, or maybe a month (when it will be in
> release), to get a better sense if there are any regressions.
Re-nominating for ESR-17 based on the above.
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F)Flags: needinfo?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a4658090_1689)• 12 years ago |

Flags: needinfo?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a7659592_425645)• 12 years ago |

[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a7659850_425645)• 12 years ago |

[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
[-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-) → [23+](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=23%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a7659864_425645)• 12 years ago |

[Attachment #742718](/attachment.cgi?id=742718&action=edit "Return the appropriate value when the whitelist checks fail. v1") -
Flags: approval-mozilla-esr17- → approval-mozilla-esr17+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=865948#c31)• 12 years ago |
|  | |

This seems safe, and given the security team's preference here, we've approved for the next ESR17 release.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=865948#c32)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr17/rev/a857a443defb>
[status-b2g18-v1.0.1](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a8183167_280903)• 11 years ago |

Whiteboard: [adv-main21+] → [adv-main21+][adv-esr1708+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a8287038_280903)• 11 years ago |

Alias: CVE-2013-1703

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a18485983_1689)• 11 years ago |

Group: core-security

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=865948#c34)• 10 years ago |
|  | |

Landed tests: <https://hg.mozilla.org/integration/mozilla-inbound/rev/1c6f050126d7>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a45223314_313730)• 10 years ago |

Flags: in-testsuite? → in-testsuite+

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=865948#c35)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/1c6f050126d7>

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=865948#a350140122_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=865948&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bobby Holley (:bholley)](/user_profile?user_id=313730)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_dd4da8c5_20250126_102115.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 02:21:15 PST

* **Bug ID:**
  803228,
  834526,
  791432,
  865948,
  821850,
  837324,
  814552,
  826392,
  826588,
  855236,
  819775,
  822910,
  837007,
  843434,
  821479,
  826104,
  854001

---

17 bugs found.

| [ID](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [803228](/show_bug.cgi?id=803228 "RESOLVED FIXED - Assertion failure: cx->compartment->principals == options.principals") |  | [Assertion failure: cx->compartment->principals == options.principals](/show_bug.cgi?id=803228) | Core Graveyard | Plug-ins | benjamin | RESO | FIXE | 2022-05-16 |
| [834526](/show_bug.cgi?id=834526 "RESOLVED FIXED - IPC Channel uses debug-only check for number of FDs in a single message, could overwrite stack") |  | [IPC Channel uses debug-only check for number of FDs in a single message, could overwrite stack](/show_bug.cgi?id=834526) | Core | IPC | bent.mozilla | RESO | FIXE | 2013-11-25 |
| [821850](/show_bug.cgi?id=821850 "RESOLVED FIXED - Investigate running XBL in a separate compartment") |  | [Investigate running XBL in a separate compartment](/show_bug.cgi?id=821850) | Core | XPConnect | bholley | RESO | FIXE | 2014-11-19 |
| [865948](/show_bug.cgi?id=865948 "RESOLVED FIXED - nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal") |  | [nsScriptSecurityManager::CheckLoadURIWithPrincipal is broken for nsExpandedPrincipal](/show_bug.cgi?id=865948) | Core | XPConnect | bholley | RESO | FIXE | 2024-05-30 |
| [854001](/show_bug.cgi?id=854001 "RESOLVED FIXED - crash in mozilla::dom::InstanceClassHasProtoAtDepth") |  | [crash in mozilla::dom::InstanceClassHasProtoAtDepth](/show_bug.cgi?id=854001) | Core | DOM: Workers | bzbarsky | RESO | FIXE | 2013-11-25 |
| [826392](/show_bug.cgi?id=826392 "RESOLVED INVALID - compartment checker fail in mozilla::plugins::parent::_evaluate") |  | [compartment checker fail in mozilla::plugins::parent::\_evaluate](/show_bug.cgi?id=826392) | Core Graveyard | Plug-ins | continuation | RESO | INVA | 2022-05-16 |
| [819775](/show_bug.cgi?id=819775 "RESOLVED FIXED - js_InitRandom: Don't use pointer values in seeding the random number generator") |  | [js\_InitRandom: Don't use pointer values in seeding the random number generator](/show_bug.cgi?id=819775) | Core | JavaScript Engine | general | RESO | FIXE | 2014-11-19 |
| [843434](/show_bug.cgi?id=843434 "RESOLVED FIXED - Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP") |  | [Assertion failure in nsUnicharStreamLoader::WriteSegmentFun with ISO-2022-JP](/show_bug.cgi?id=843434) | Core | Networking | jaas | RESO | FIXE | 2013-11-25 |
| [791432](/show_bug.cgi?id=791432 "RESOLVED FIXED - WebGL canvases of width <= 16 contain uninitialized memory upon creation on HTC One S") |  | [WebGL canvases of width <= 16 contain uninitialized memory upon creation on HTC One S](/show_bug.cgi?id=791432) | Core | Graphics: CanvasWebG | jacob.benoit.1 | RESO | FIXE | 2013-11-25 |
| [826104](/show_bug.cgi?id=826104 "RESOLVED FIXED - Crash in MediaDecoder::UpdatePlaybackOffset") |  | [Crash in MediaDecoder::UpdatePlaybackOffset](/show_bug.cgi?id=826104) | Core | Audio/Video | kinetik | RESO | FIXE | 2020-05-27 |
| [814552](/show_bug.cgi?id=814552 "RESOLVED FIXED - IonMonkey: Assertion failure: masm.framePushed() == frameSize(), at ion/CodeGenerator.cpp:342 or Crash [@ MarkInternal<js::ion::IonCode>]") |  | [IonMonkey: Assertion failure: masm.framePushed() == frameSize(), at ion/CodeGenerator.cpp:342 or Crash [@ MarkInternal<js::ion::IonCode>]](/show_bug.cgi?id=814552) | Core | JavaScript Engine | marty.rosenberg | RESO | FIXE | 2013-11-25 |
| [821479](/show_bug.cgi?id=821479 "RESOLVED FIXED - Out-of-bounds read crash in PropertyProvider::GetSpacingInternal") |  | [Out-of-bounds read crash in PropertyProvider::GetSpacingInternal](/show_bug.cgi?id=821479) | Core | Layout: Text and Fon | MatsPalmgren\_bugz | RESO | FIXE | 2014-11-19 |
| [822910](/show_bug.cgi?id=822910 "RESOLVED FIXED - Crash [@ nsTextFrame::HasTerminalNewline()] with splitText, floating :first-letter") |  | [Crash [@ nsTextFrame::HasTerminalNewline()] with splitText, floating :first-letter](/show_bug.cgi?id=822910) | Core | Layout: Text and Fon | MatsPalmgren\_bugz | RESO | FIXE | 2014-10-24 |
| [837007](/show_bug.cgi?id=837007 "RESOLVED FIXED - \"ASSERTION: Out of flow frame doesn't have the expected parent\" and crash with -moz-column, float") |  | ["ASSERTION: Out of flow frame doesn't have the expected parent" and crash with -moz-column, float](/show_bug.cgi?id=837007) | Core | Layout | MatsPalmgren\_bugz | RESO | FIXE | 2015-04-16 |
| [826588](/show_bug.cgi?id=826588 "RESOLVED FIXED - Differential Testing: Getting different output on 64-bit Windows js shells involving lastIndex") |  | [Differential Testing: Getting different output on 64-bit Windows js shells involving lastIndex](/show_bug.cgi?id=826588) | Core | JavaScript Engine | sean.stangl | RESO | FIXE | 2014-05-05 |
| [837324](/show_bug.cgi?id=837324 "VERIFIED FIXED - WebRTC crash [@fsmdef_ev_addcandidate]") |  | [WebRTC crash [@fsmdef\_ev\_addcandidate]](/show_bug.cgi?id=837324) | Core | WebRTC: Networking | ethanhugg | VERI | FIXE | 2013-11-25 |
| [855236](/show_bug.cgi?id=855236 "VERIFIED FIXED - Crash with SIGTRAP") |  | [Crash with SIGTRAP](/show_bug.cgi?id=855236) | Core | JavaScript Engine | jdemooij | VERI | FIXE | 2013-11-25 |

17 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=803228%2C834526%2C791432%2C865948%2C821850%2C837324%2C814552%2C826392%2C826588%2C855236%2C819775%2C822910%2C837007%2C843434%2C821479%2C826104%2C854001&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |



=== Content from bugzilla.mozilla.org_34c80260_20250125_164319.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/821850)
* [XML](/show_bug.cgi?ctype=xml&id=821850)

Closed
[Bug 821850](/show_bug.cgi?id=821850)
(XBL-scopes)

Opened 12 years ago
Closed 12 years ago

# Investigate running XBL in a separate compartment

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Investigate running XBL in a separate compartment

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | wontfix |
| firefox21 |  | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bholley, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

27 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[822383](/show_bug.cgi?id=822383 "RESOLVED FIXED - Allow arbitrary proxies on scope chains"), [822961](/show_bug.cgi?id=822961 "RESOLVED FIXED - Add JS_WrapId"), [823348](/show_bug.cgi?id=823348 "RESOLVED FIXED - Security Wrapper Housecleaning"), [824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope"), [830500](/show_bug.cgi?id=830500 "RESOLVED FIXED - Need way to convert two-byte characters to jsid outside the engine"), [832041](/show_bug.cgi?id=832041 "RESOLVED FIXED - Remove nsJSContext::CompileEventHandler and move consumers to nsJSUtils::CompileFunction"), [832512](/show_bug.cgi?id=832512 "RESOLVED FIXED - SOWs shouldn't be created for chrome objects"), [833412](/show_bug.cgi?id=833412 "RESOLVED FIXED - Remove XBL binding layering (addBinding)"), [834732](/show_bug.cgi?id=834732 "RESOLVED FIXED - Do a better job of maintaining the JS context stack"), [839792](/show_bug.cgi?id=839792 "RESOLVED FIXED - From add-on, TypeError: \"_appendCurrentResult\" is read-only"), [839795](/show_bug.cgi?id=839795 "RESOLVED DUPLICATE - The monkey patch no longer works."), [839873](/show_bug.cgi?id=839873 "RESOLVED DUPLICATE - TB shows only the first conversation")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[816071](/show_bug.cgi?id=816071 "RESOLVED FIXED - Content can confuse XBL with prototypes and can impersonate XBL script using eval() and Function() (bypassing SOWs)"), [834697](/show_bug.cgi?id=834697 "RESOLVED FIXED - Enable XBL Scopes")

Dependency [tree](/showdependencytree.cgi?id=821850&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=821850)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-other, Whiteboard: [adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

XBL-scopes

[Keywords:](/describekeywords.cgi)

[sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c98 "12 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (21 files, 1 obsolete file)

| [Part 1 - Properly propagate |strict| in JSObject::deleteByValue. v1](/attachment.cgi?id=707108)  [12 years ago](#c32)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.04 KB, patch | jorendorff : [review+](#a4480900_281791 "12 years ago") | [Details](/attachment.cgi?id=707108&action=edit) | [Diff](/attachment.cgi?id=707108&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707108) |
| --- | --- | --- |
| [Part 2 - Don't rewrap |this| in nativeCall. v1](/attachment.cgi?id=707109)  [12 years ago](#c33)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.38 KB, patch |  | [Details](/attachment.cgi?id=707109&action=edit) | [Diff](/attachment.cgi?id=707109&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707109) |
| [Part 3 - Make XBL-in-content tests Xray-safe. v2](/attachment.cgi?id=707110)  [12 years ago](#c34)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   20.87 KB, patch | bzbarsky : [review+](#c70 "12 years ago") | [Details](/attachment.cgi?id=707110&action=edit) | [Diff](/attachment.cgi?id=707110&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707110) |
| [Part 4 - Add infrastructure for lazily-created XBL scopes. v1](/attachment.cgi?id=707111)  [12 years ago](#c35)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   13.25 KB, patch | bzbarsky : [review+](#c71 "12 years ago") | [Details](/attachment.cgi?id=707111&action=edit) | [Diff](/attachment.cgi?id=707111&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707111) |
| [Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1](/attachment.cgi?id=707112)  [12 years ago](#c36)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.63 KB, patch | bzbarsky : [review+](#c72 "12 years ago") | [Details](/attachment.cgi?id=707112&action=edit) | [Diff](/attachment.cgi?id=707112&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707112) |
| [Part 6 - Clean up security wrappers for NAC. v1](/attachment.cgi?id=707113)  [12 years ago](#c37)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   4.22 KB, patch | bzbarsky : [review+](#c73 "12 years ago") | [Details](/attachment.cgi?id=707113&action=edit) | [Diff](/attachment.cgi?id=707113&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707113) |
| [Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1](/attachment.cgi?id=707114)  [12 years ago](#c38)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.09 KB, patch | bzbarsky : [review+](#c74 "12 years ago") | [Details](/attachment.cgi?id=707114&action=edit) | [Diff](/attachment.cgi?id=707114&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707114) |
| [Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1](/attachment.cgi?id=707115)  [12 years ago](#c39)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   7.36 KB, patch | bzbarsky : [review+](#c75 "12 years ago") | [Details](/attachment.cgi?id=707115&action=edit) | [Diff](/attachment.cgi?id=707115&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707115) |
| [Part 9 - Remove bogus comment/check and replace with an assert. v1](/attachment.cgi?id=707117)  [12 years ago](#c40)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.09 KB, patch | bzbarsky : [review+](#c76 "12 years ago") | [Details](/attachment.cgi?id=707117&action=edit) | [Diff](/attachment.cgi?id=707117&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707117) |
| [Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1](/attachment.cgi?id=707118)  [12 years ago](#c41)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   13.59 KB, patch | bzbarsky : [review+](#c77 "12 years ago") | [Details](/attachment.cgi?id=707118&action=edit) | [Diff](/attachment.cgi?id=707118&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707118) |
| [Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1](/attachment.cgi?id=707119)  [12 years ago](#c42)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   4.16 KB, patch | bzbarsky : [review+](#c78 "12 years ago") | [Details](/attachment.cgi?id=707119&action=edit) | [Diff](/attachment.cgi?id=707119&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707119) |
| [Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1](/attachment.cgi?id=707120)  [12 years ago](#c43)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   11.25 KB, patch | bzbarsky : [review+](#c79 "12 years ago") | [Details](/attachment.cgi?id=707120&action=edit) | [Diff](/attachment.cgi?id=707120&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707120) |
| [Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1](/attachment.cgi?id=707121)  [12 years ago](#c44)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   22.83 KB, patch | bzbarsky : [review+](#c80 "12 years ago") | [Details](/attachment.cgi?id=707121&action=edit) | [Diff](/attachment.cgi?id=707121&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707121) |
| [Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2](/attachment.cgi?id=707123)  [12 years ago](#c45)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   12.41 KB, patch | bzbarsky : [review+](#c81 "12 years ago") | [Details](/attachment.cgi?id=707123&action=edit) | [Diff](/attachment.cgi?id=707123&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707123) |
| [Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1](/attachment.cgi?id=707124)  [12 years ago](#c46)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   2.42 KB, patch | bzbarsky : [review+](#c82 "12 years ago") | [Details](/attachment.cgi?id=707124&action=edit) | [Diff](/attachment.cgi?id=707124&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707124) |
| [Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1](/attachment.cgi?id=707125)  [12 years ago](#c47)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   5.73 KB, patch | bzbarsky : [review+](#c83 "12 years ago") | [Details](/attachment.cgi?id=707125&action=edit) | [Diff](/attachment.cgi?id=707125&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707125) |
| [Part 17 - Add API for lookup up implementation members on XBL bindings. v1](/attachment.cgi?id=707126)  [12 years ago](#c48)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   9.45 KB, patch | bzbarsky : [review+](#c85 "12 years ago") | [Details](/attachment.cgi?id=707126&action=edit) | [Diff](/attachment.cgi?id=707126&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707126) |
| [Part 18 - Expose XBL members via Xray wrappers. v1](/attachment.cgi?id=707127)  [12 years ago](#c49)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   6.16 KB, patch | bzbarsky : [review+](#c92 "12 years ago") | [Details](/attachment.cgi?id=707127&action=edit) | [Diff](/attachment.cgi?id=707127&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707127) |
| [Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1](/attachment.cgi?id=707128)  [12 years ago](#c50)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   9.86 KB, patch | bzbarsky : [review+](#c93 "12 years ago") | [Details](/attachment.cgi?id=707128&action=edit) | [Diff](/attachment.cgi?id=707128&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707128) |
| [Part 20 - Clone XBL into the XBL scope's compartment. v4](/attachment.cgi?id=707129)  [12 years ago](#c51)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   20.28 KB, patch | bzbarsky : [review+](#c94 "12 years ago") | [Details](/attachment.cgi?id=707129&action=edit) | [Diff](/attachment.cgi?id=707129&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707129) |
| [Part 21 - Tests. v1](/attachment.cgi?id=707130)  [12 years ago](#c52)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   10.07 KB, patch | bzbarsky : [review+](#c95 "12 years ago") | [Details](/attachment.cgi?id=707130&action=edit) | [Diff](/attachment.cgi?id=707130&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707130) |
| [Part 2 - Don't rewrap |this| in nativeCall. v2](/attachment.cgi?id=710762)  [12 years ago](#c69)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.57 KB, patch | jorendorff : [review+](#c91 "12 years ago") | [Details](/attachment.cgi?id=710762&action=edit) | [Diff](/attachment.cgi?id=710762&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=710762) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=821850#c0)• 12 years ago |
|  | |

I'm prototyping some patches for this, leveraging sandboxes to avoid hand-coding a lot of infrastructure. It might not work out. Let's see.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=821850#c1)• 12 years ago |
|  | |

I assume this is for bindings in content only, not for chrome stuff.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=821850#c2)• 12 years ago |
|  | |

(In reply to Olli Pettay [:smaug] from [comment #1](/show_bug.cgi?id=821850#c1 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> I assume this is for bindings in content only, not for chrome stuff.
yep.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=821850#c3)• 12 years ago |
|  | |

So, I've got an initial sketch done to run content XBL in a separate scope:
<https://github.com/bholley/mozilla-central/commits/sbxblscope>
The most immediate snag I've hit has to do with fields. Fields are implemented by calling EvaluateStringWithValue with the bound node as the scope object. So I tried to enter the XBL scope, wrap the bound node for that compartment, and then pass the wrapper as the scope object.
When I do, the JS engine "complain[s] bitterly", throwing JSMSG\_NON\_NATIVE\_SCOPE:
<http://mxr.mozilla.org/mozilla-central/source/js/src/jsinterp.cpp#553>
I think Luke is the right person to tell me what to do next.Flags: needinfo?(luke)

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=821850#c4)• 12 years ago |
|  | |

Is there a list (or can it be easily created) of exactly which XBL bindings are being used in content?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=821850#c5)• 12 years ago |
|  | |

(In reply to Justin Dolske [:Dolske] from [comment #4](/show_bug.cgi?id=821850#c4 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Is there a list (or can it be easily created) of exactly which XBL bindings
> are being used in content?
In Gecko? I'd figured you'd know. ;-)
There's also addons, of course. Flashblock runs bindings in content, I think.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=821850#c6)• 12 years ago |
|  | |

So JSMSG\_NON\_NATIVE\_SCOPE is an assertion-turned-dynamic-check (in [bug 609990](/show_bug.cgi?id=609990 "RESOLVED FIXED - JS_ASSERT(!initialVarObj->getOps()->defineProperty); triggered while browsing hulu.com")). The assertion itself is pretty old. Now, I know for a fact that we can have proxies on the scope chain: DebugScopeProxy. It looks like the assert comes from [bug 566549](/show_bug.cgi?id=566549 "RESOLVED FIXED - Crash [@ js_AllocSlot] or \"Assertion failure: obj->map->ops->defineProperty == js_DefineProperty\" with evalcx") which had problems with non-native scope objects in JSOP\_DEFVAR. But, surprise surprise, I had to generalize JSOP\_DEFVAR for DebugScopeProxy so I think you should just loosen up this assertion:
<http://hg.mozilla.org/mozilla-central/diff/f45eec2bd4c7/js/src/jsinterpinlines.h#l1.13>
to accept any isProxy(), not just isDebugScope() proxies and then remove the JSMSG\_NON\_NATIVE\_SCOPE error (and the following !defineProperty assertion) entirely (from js.msg). Can you replace it with an assertion that every object (on the obj->enclosingScope() chain) is in the right compartment and that the chain terminates with an isGlobal?). You might want to try some of the flash examples that were hitting this (listed in [bug 609990](/show_bug.cgi?id=609990 "RESOLVED FIXED - JS_ASSERT(!initialVarObj->getOps()->defineProperty); triggered while browsing hulu.com")) and then try to land the change by itself (I can review) in case there are other issues.Flags: needinfo?(luke)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a253930_313730)• 12 years ago |

Depends on: [822383](/show_bug.cgi?id=822383 "RESOLVED FIXED - Allow arbitrary proxies on scope chains")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=821850#c7)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=190f19fae4fc>Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a380999_313730)• 12 years ago |

Depends on: [822961](/show_bug.cgi?id=822961 "RESOLVED FIXED - Add JS_WrapId")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a441374_313730)• 12 years ago |

Blocks: [821676](/show_bug.cgi?id=821676 "RESOLVED FIXED - It's possible to break XBL scripts for video controls")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a618459_313730)• 12 years ago |

Depends on: [823348](/show_bug.cgi?id=823348 "RESOLVED FIXED - Security Wrapper Housecleaning")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a1054026_313730)• 12 years ago |

Depends on: [824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a1246554_313730)• 12 years ago |

Blocks: [825392](/show_bug.cgi?id=825392 "RESOLVED FIXED - Create native-anonymous content reflectors in the XBL scope")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=821850#c8)• 12 years ago |
|  | |

These patches got significantly more complicated because of all the crazy stuff I had to do to XrayWrapper to make the XBL API show up on bound nodes. They pass XBL tests locally. Pushing to try.
<https://tbpl.mozilla.org/?tree=Try&rev=ae142e64815c>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=821850#c9)• 12 years ago |
|  | |

Hit a compartment mismatch as a result of an nsCxPusher saving the frame chain after the JSAutoEnterCompartment. Fixed and pushed again:
<https://tbpl.mozilla.org/?tree=Try&rev=cedd646b3170>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a2683674_313730)• 12 years ago |

Depends on: [830500](/show_bug.cgi?id=830500 "RESOLVED FIXED - Need way to convert two-byte characters to jsid outside the engine")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=821850#c10)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=be3b8a1939ca>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a2946295_313730)• 12 years ago |

Depends on: [832041](/show_bug.cgi?id=832041 "RESOLVED FIXED - Remove nsJSContext::CompileEventHandler and move consumers to nsJSUtils::CompileFunction")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a3030801_313730)• 12 years ago |

Depends on: [832512](/show_bug.cgi?id=832512 "RESOLVED FIXED - SOWs shouldn't be created for chrome objects")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=821850#c11)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=74504d3956de>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a3358997_313730)• 12 years ago |

Depends on: [833412](/show_bug.cgi?id=833412 "RESOLVED FIXED - Remove XBL binding layering (addBinding)")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=821850#c12)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=f2891896079f>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=821850#c13)• 12 years ago |
|  | |

Woohoo! This massive patch stack is green, modulo one b-c failure that I've fixed in a way that I hope is acceptable (I'll leave that up to the reviewers). There are three things left to do:
1 - Remove the XBL bit, which is now unused.
2 - Write thorough tests.
3 - Think about compartment overhead.
Number 3 is a big one here, which only really dawned on me recently when smaug pointed it out. These patches cause each content scope to lazily generate an associated sandbox (whose principal is nsExpandedPrincipal(contentPrincipal)) whenever an XBL binding is bound in a given content scope. This isn't a big problem for stuff like <video>, but things like scrollbars are implemented in XBL. This means that we have the potential to create a whole lot of extra compartments in content, which could have a significant memory impact.
I chose to create one XBL scope per content scope so that we could do the nsExpandedPrincipal(contentPrincipal) trick, which gives XBL asymmetric security relations with |contentPrincipal|, but (very importantly) nothing else. This maintains the long-understood security invariant that XBL code doesn't run with system principal.
There are a few approaches I can think of, here:
1 - Run the XBL as system principal, giving us one and only one XBL scope. This is the most expedient, but runs the risk of security issues. It shouldn't be a huge deal for the most part, since XBL will now be better-insulated from content manipulation. However, XBL still needs to waive Xray vision for field access, so there's a small potential for exploits there.
2 - Audit and whitelist certain common XBL controls (like scrollbar) to run in a common system-principal compartment, and run the rest in individual content compartments. This is a bit more complexity, but might be a good balance. Scrollbar and such aren't that complicated, so we can probably be reasonable sure it's safe. On the other hand, there's also the issue that some addons (like flashblock?) might inject XBL into every content scope. This means that those addons would suddenly have a very large memory regression unless we let them whitelist their stuff somehow, which isn't something we necessarily want to encourage.
3 - Implement zones. I think this would mostly solve things while maintaining our good security invariants, and it sounds like there's already traction behind the idea. However, it's not clear to me how big of a task that is (hoisting XBL is a Q1 DOM goal). I'm also not sure what the residual memory footprint would be, since IIUC we still get an extra shapes arena. Hopefully njn and billm can weigh in here.
Some other mitigation strategies:
\* Have one XBL scope per origin, rather than per content scope. This just involves some extra gross machinery, but isn't hard per se.
\* Invent a new XBL principal that has special security characteristics. The simplest implementation would be a principal that subsumes everything \_but\_ the system principal, meaning that an exploit would be a universal XSS but not arbitrary code execution.
Curious to hear what people think here.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=821850#c14)• 12 years ago |
|  | |

(1) feels very scary change.
Don't know what (3) is about. What zones?
But before anything, we need some data. How much does this increase memory usage? Does this
affect to page load times?

|  | [Gabor Krizsanits (INACTIVE)](/user_profile?user_id=420273) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=821850#c15)• 12 years ago |
|  | |

Ok, so do I get it correctly that in worst case scenario for each content compartment we create a sandbox? (in case of every content compartment is using XBL)
Because if that is the case almost all add-on does the same with content-scripts, so if it's a huge performance issue, then I just mention that add-ons on top of that even create a huge pile of sandboxes for the modules they are using. My point is that if this is a performance issue then we should deal with that regardless of this patch being landed. I was pushing it really hard before the CPG patch to make compartments as light-weighted as possible. Note that, CPG created an order of magnitude more extra compartments...
That's being said, I'm with smaug: (1) is scary, and I don't know much about these zones either.
"principal that subsumes everything \_but\_ the system principal"
I think at some point I will need this anyway for add-ons, it does sound like a useful feature to me.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=821850#c16)• 12 years ago |
|  | |

Zones (or compartment groups) are described in [bug 759585](/show_bug.cgi?id=759585 "RESOLVED FIXED - Change the granularity of collection from compartment to zone"), and have been discussed a bit on the recently dev-platform thread about memory overhead. The basic idea is to have certain compartments share arenas, which would significantly decrease the wasted space incurred by having multiple near-empty and related compartments.
I think in general I agree with Nick's argument on the dev-platform thread: compartments are an important part of our infrastructure, and we should find ways to make them efficient rather than finding ways to avoid using them. Gabor's argument about jetpack is also a great point - any content script that attaches to '\*' is already creating a new compartment for every scope.
Hopefully one of the garbagemen can tell us more here. Are compartment groups feasible in the Q1 timeframe?
As for measuring the memory footprint: I don't have a ton of experience doing this kind of thing, and I'm concerned that I'd get it wrong. Is there a memory-savvy person who's willing to help me out with the measurements? johns perhaps? Is there a way to do a trial run of AWSY or some other sort of automation with a set of patches applied?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=821850#c17)• 12 years ago |
|  | |

Also - In the interest of speeding things along, I'm going to try to get this landed behind a pref.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=821850#c18)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #16](/show_bug.cgi?id=821850#c16 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Gabor's argument about jetpack is also a great point - any content script
> that attaches to '\*' is already creating a new compartment for every scope.
But it is not about this bug. Here we're talking about baseline memusage and performance
> As for measuring the memory footprint: I don't have a ton of experience
> doing this kind of thing, and I'm concerned that I'd get it wrong. Is there
> a memory-savvy person who's willing to help me out with the measurements?
> johns perhaps? Is there a way to do a trial run of AWSY or some other sort
> of automation with a set of patches applied?
AWSY runs would be good.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=821850#c19)• 12 years ago |
|  | |

(In reply to Olli Pettay [:smaug] from [comment #18](/show_bug.cgi?id=821850#c18 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> (In reply to Bobby Holley (:bholley) from [comment #16](/show_bug.cgi?id=821850#c16 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> > Gabor's argument about jetpack is also a great point - any content script
> > that attaches to '\*' is already creating a new compartment for every scope.
> But it is not about this bug. Here we're talking about baseline memusage and
> performance
Sure. I'm just saying that if we consider this kind of compartment overhead unacceptable, then we're in effect encouraging an unacceptable configuration for a large number of users (those that use addons developed with our own addon SDK).
So given that JSMs, Jetpack, and now XBL are all running into the same overhead issues, it makes sense to try to tackle the problem at the source, rather than fighting the symptoms. :-)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a3449862_1689)• 12 years ago |

Blocks: [817922](/show_bug.cgi?id=817922 "RESOLVED FIXED - Functions implemented by XBL are callable, this could be a serious security threat under the right circumstances.")

|  | [John Schoenick [:johns]](/user_profile?user_id=429621) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=821850#c20)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #16](/show_bug.cgi?id=821850#c16 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Is there a way to do a trial run of AWSY or some other sort
> of automation with a set of patches applied?
I can pretty easily AWSY test any set of patches (or try build with linux64-opt builds).

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=821850#c21)• 12 years ago |
|  | |

(In reply to John Schoenick [:johns] from [comment #20](/show_bug.cgi?id=821850#c20 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> (In reply to Bobby Holley (:bholley) from [comment #16](/show_bug.cgi?id=821850#c16 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> > Is there a way to do a trial run of AWSY or some other sort
> > of automation with a set of patches applied?
>
> I can pretty easily AWSY test any set of patches (or try build with
> linux64-opt builds).
(johns and I talked on IRC and he kicked off a run)
John, what do the results look like?

|  | [John Schoenick [:johns]](/user_profile?user_id=429621) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=821850#c22)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #21](/show_bug.cgi?id=821850#c21 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> (In reply to John Schoenick [:johns] from [comment #20](/show_bug.cgi?id=821850#c20 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> > (In reply to Bobby Holley (:bholley) from [comment #16](/show_bug.cgi?id=821850#c16 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> > > Is there a way to do a trial run of AWSY or some other sort
> > > of automation with a set of patches applied?
> >
> > I can pretty easily AWSY test any set of patches (or try build with
> > linux64-opt builds).
>
> (johns and I talked on IRC and he kicked off a run)
>
> John, what do the results look like?
Sorry, I neglected to check on this before signing off yesterday. I queued this to run ten times: (the ten rightmost builds labeled f2891896079f are the try runs)
<https://www.areweslimyet.com/?series=bholley>
Aside from some noise, the majority of the runs show a explicit green line of ~344MiB, which is about the average for the past few weeks, so almost no change. The resident line seemingly regressed by a few megabytes, but looking at the past weeks of data, it doesn't look statistically significant (resident is very noisy)

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=821850#c23)• 12 years ago |
|  | |

bholley, how many extra compartments are being created? I imagine it varies with workload, but do you have any numbers, e.g. for popular sites?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=821850#c24)• 12 years ago |
|  | |

(In reply to John Schoenick [:johns] from [comment #22](/show_bug.cgi?id=821850#c22 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Aside from some noise, the majority of the runs show a explicit green line
> of ~344MiB, which is about the average for the past few weeks, so almost no
> change. The resident line seemingly regressed by a few megabytes, but
> looking at the past weeks of data, it doesn't look statistically significant
> (resident is very noisy)
That's really great news!
(In reply to Nicholas Nethercote [:njn] from [comment #23](/show_bug.cgi?id=821850#c23 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> bholley, how many extra compartments are being created? I imagine it varies
> with workload, but do you have any numbers, e.g. for popular sites?
Well, that's what I was hoping to grok from the AWSY run. We'd be creating an extra compartment for each content scope that contains one of:
1 - a <video> or <audio> control
2 - a scrollbar
3 - a <marquee> element
I don't expect 1 or 3 to be very common, but I (and others) had feared that the scrollbar case would be a bigger issue. These numbers are pretty encouraging, though.
Smaug, Kyle, what do you think? Are there other experiments we should do?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=821850#c25)• 12 years ago |
|  | |

Do we have tp numbers?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=821850#c26)• 12 years ago |
|  | |

(In reply to Olli Pettay [:smaug] from [comment #25](/show_bug.cgi?id=821850#c25 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Do we have tp numbers?
Nope. I'll do some runs soon.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a3606903_313730)• 12 years ago |

Blocks: [834697](/show_bug.cgi?id=834697 "RESOLVED FIXED - Enable XBL Scopes")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a3612167_313730)• 12 years ago |

Depends on: [834732](/show_bug.cgi?id=834732 "RESOLVED FIXED - Do a better job of maintaining the JS context stack")

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=821850#c27)• 12 years ago |
|  | |

about:memory reports the number of compartments under "js-compartment/system" and "js-compartments/user". I just looked for them but they seem to be missing on AWSY... johns, any idea why?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=821850#c28)• 12 years ago |
|  | |

Made various changes to put the machinery behind a pref.
Pref disabled: <https://tbpl.mozilla.org/?tree=Try&rev=428e75fccab7>
Pref enabled: <https://tbpl.mozilla.org/?tree=Try&rev=3ded30290fd7>

|  | [John Schoenick [:johns]](/user_profile?user_id=429621) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=821850#c29)• 12 years ago |
|  | |

(In reply to Nicholas Nethercote [:njn] from [comment #27](/show_bug.cgi?id=821850#c27 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> about:memory reports the number of compartments under
> "js-compartment/system" and "js-compartments/user". I just looked for them
> but they seem to be missing on AWSY... johns, any idea why?
AWSY was not handling memory reporters that didn't use "bytes" units :-/
I just pushed a fix for that, but only builds tested going forward will have the data. I can re-queue the last month of tinderbox builds, however.

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=821850#c30)• 12 years ago |
|  | |

> I can re-queue the last month of tinderbox builds, however.
If it's not hard, sure. But it's not super important.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=821850#c31)• 12 years ago |
|  | |

The TP5 numbers from [comment 28](/show_bug.cgi?id=821850#c28 "RESOLVED FIXED - Investigate running XBL in a separate compartment") look pretty encouraging:
enabled:
tp5n\_pbytes\_paint: avg(499.5, 503.3, 502.4, 502.0, 498.8, 497.6) => 500.6
tp5n\_main\_rss\_paint: avg(158.1, 157.8, 158.5, 157.8, 157.7, 157.6) => 157.9
disabled:
tp5n\_pbytes\_paint: avg(499.5, 498.8, 488.5, 497.8, 497.3, 494.4) => 496.1
tp5n\_main\_rss\_paint: avg(156.8, 157.1, 157.5, 157.5, 158, 157.6) => 157.4
In particular, this suggests that the regression is less than 1%. Combined with John's AWSY analysis, that gives us reasonable confidence that we're not looking at a massive memory hit here. The zone stuff will be a major help and we should get it in as soon as possible (in particular, I've signed on to do the non-SpiderMonkey bits), but IMO it doesn't block this landing.
I'm going to put the patches up for bz's review. He said he may or may not get to them before London, and if not we can do it in a room when we get there.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=821850#c32)• 12 years ago |
|  | |

Attached patch

[Part 1 - Properly propagate |strict| in JSObject::deleteByValue. v1](attachment.cgi?id=707108&action=diff)
— [Details](attachment.cgi?id=707108&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707108)

[Attachment #707108](/attachment.cgi?id=707108&action=edit "Part 1 - Properly propagate |strict| in JSObject::deleteByValue. v1") -
Flags: review?(jorendorff)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=821850#c33)• 12 years ago |
|  | |

Attached patch

[Part 2 - Don't rewrap |this| in nativeCall. v1](attachment.cgi?id=707109&action=diff) (obsolete)
— [Details](attachment.cgi?id=707109&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707109)

This generally works with membrane semantics, but breaks when same-compartment
security wrappers are involved. In particular, when Field{Getter,Setter} live
in the XBL scope and operate on NAC via nativeCall, the this object can't be
rewrapped, because otherwise a SOW will appear and break everything.
It's not ideal to hardcode the index of |this|, but there's not really a great
alternative. IIUC the layout isn't changing any time soon, and this code will
hopefully be short-lived anyway, since SCSWs are on their way out.
[Attachment #707109](/attachment.cgi?id=707109&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v1") -
Flags: review?(jorendorff)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=821850#c34)• 12 years ago |
|  | |

Attached patch

[Part 3 - Make XBL-in-content tests Xray-safe. v2](attachment.cgi?id=707110&action=diff)
— [Details](attachment.cgi?id=707110&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707110)

We use XPCNativeWrapper.unwrap rather than .wrappedJSObject so that the tests
are agnostic to whether there's an Xray wrapper or not.
I converted test\_tree\_column\_reorder.xul into a chrome test because it does
all sorts of crazy introspection on the binding, and it really should be
a chrome test anyway.
[Attachment #707110](/attachment.cgi?id=707110&action=edit "Part 3 - Make XBL-in-content tests Xray-safe. v2") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=821850#c35)• 12 years ago |
|  | |

Attached patch

[Part 4 - Add infrastructure for lazily-created XBL scopes. v1](attachment.cgi?id=707111&action=diff)
— [Details](attachment.cgi?id=707111&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707111)

[Attachment #707111](/attachment.cgi?id=707111&action=edit "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=821850#c36)• 12 years ago |
|  | |

Attached patch

[Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1](attachment.cgi?id=707112&action=diff)
— [Details](attachment.cgi?id=707112&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707112)

[Attachment #707112](/attachment.cgi?id=707112&action=edit "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=821850#c37)• 12 years ago |
|  | |

Attached patch

[Part 6 - Clean up security wrappers for NAC. v1](attachment.cgi?id=707113&action=diff)
— [Details](attachment.cgi?id=707113&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707113)

[Attachment #707113](/attachment.cgi?id=707113&action=edit "Part 6 - Clean up security wrappers for NAC. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=821850#c38)• 12 years ago |
|  | |

Attached patch

[Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1](attachment.cgi?id=707114&action=diff)
— [Details](attachment.cgi?id=707114&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707114)

Otherwise the whole method borks when it discovers that the principal doesn't
have a URI.
[Attachment #707114](/attachment.cgi?id=707114&action=edit "Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=821850#c39)• 12 years ago |
|  | |

Attached patch

[Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1](attachment.cgi?id=707115&action=diff)
— [Details](attachment.cgi?id=707115&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707115)

This lets us hook up the binding to the JSClass.
[Attachment #707115](/attachment.cgi?id=707115&action=edit "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=821850#c40)• 12 years ago |
|  | |

Attached patch

[Part 9 - Remove bogus comment/check and replace with an assert. v1](attachment.cgi?id=707117&action=diff)
— [Details](attachment.cgi?id=707117&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707117)

This confused me, because fields are, in fact, exposed via the prototype
via the complicated two-step solution defined in InstallField. As it turns
out, CompilePrototypeMembers throws if mClassObject ends up null.
[Attachment #707117](/attachment.cgi?id=707117&action=edit "Part 9 - Remove bogus comment/check and replace with an assert. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=821850#c41)• 12 years ago |
|  | |

Attached patch

[Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1](attachment.cgi?id=707118&action=diff)
— [Details](attachment.cgi?id=707118&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707118)

Right now, DoInitJSClass only returns non-null if the class object is new
(and thus needs to have members installed on it). The code then goes and
unconditionally tries to install the members, null-checking and aborting
each time.
Instead, let's use an explicit boolean and one early return. This lets us
get a reference to our JSClass no matter what, which we need.
[Attachment #707118](/attachment.cgi?id=707118&action=edit "Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=821850#c42)• 12 years ago |
|  | |

Attached patch

[Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1](attachment.cgi?id=707119&action=diff)
— [Details](attachment.cgi?id=707119&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707119)

[Attachment #707119](/attachment.cgi?id=707119&action=edit "Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=821850#c43)• 12 years ago |
|  | |

Attached patch

[Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1](attachment.cgi?id=707120&action=diff)
— [Details](attachment.cgi?id=707120&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707120)

Let's just pass a JSContext and do Requests/Compartments in the caller.
[Attachment #707120](/attachment.cgi?id=707120&action=edit "Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=821850#c44)• 12 years ago |
|  | |

Attached patch

[Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1](attachment.cgi?id=707121&action=diff)
— [Details](attachment.cgi?id=707121&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707121)

This is a pure cut/paste except for removing |static| from XBLResolve.
XBLResolve will go away soon, so there's no need to put it in a header.
[Attachment #707121](/attachment.cgi?id=707121&action=edit "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=821850#c45)• 12 years ago |
|  | |

Attached patch

[Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2](attachment.cgi?id=707123&action=diff)
— [Details](attachment.cgi?id=707123&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707123)

[Attachment #707123](/attachment.cgi?id=707123&action=edit "Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=821850#c46)• 12 years ago |
|  | |

Attached patch

[Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1](attachment.cgi?id=707124&action=diff)
— [Details](attachment.cgi?id=707124&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707124)

InstallXBLField knows how to handle cross-compartment |callee|. However,
The current value will always be wrapped. We need to unwrap said wrappers,
otherwise we'll end up with objects that aren't functions.
[Attachment #707124](/attachment.cgi?id=707124&action=edit "Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=821850#c47)• 12 years ago |
|  | |

Attached patch

[Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1](attachment.cgi?id=707125&action=diff)
— [Details](attachment.cgi?id=707125&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707125)

We make the class object readonly/non-configurable, as well as all the properties
and methods on the class object.
[Attachment #707125](/attachment.cgi?id=707125&action=edit "Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=821850#c48)• 12 years ago |
|  | |

Attached patch

[Part 17 - Add API for lookup up implementation members on XBL bindings. v1](attachment.cgi?id=707126&action=diff)
— [Details](attachment.cgi?id=707126&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707126)

[Attachment #707126](/attachment.cgi?id=707126&action=edit "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=821850#c49)• 12 years ago |
|  | |

Attached patch

[Part 18 - Expose XBL members via Xray wrappers. v1](attachment.cgi?id=707127&action=diff)
— [Details](attachment.cgi?id=707127&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707127)

[Attachment #707127](/attachment.cgi?id=707127&action=edit "Part 18 - Expose XBL members via Xray wrappers. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=821850#c50)• 12 years ago |
|  | |

Attached patch

[Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1](attachment.cgi?id=707128&action=diff)
— [Details](attachment.cgi?id=707128&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707128)

[Attachment #707128](/attachment.cgi?id=707128&action=edit "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=821850#c51)• 12 years ago |
|  | |

Attached patch

[Part 20 - Clone XBL into the XBL scope's compartment. v4](attachment.cgi?id=707129&action=diff)
— [Details](attachment.cgi?id=707129&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707129)

[Attachment #707129](/attachment.cgi?id=707129&action=edit "Part 20 - Clone XBL into the XBL scope's compartment. v4") -
Flags: review?(bzbarsky)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=821850#c52)• 12 years ago |
|  | |

Attached patch

[Part 21 - Tests. v1](attachment.cgi?id=707130&action=diff)
— [Details](attachment.cgi?id=707130&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707130)

[Attachment #707130](/attachment.cgi?id=707130&action=edit "Part 21 - Tests. v1") -
Flags: review?(bzbarsky)

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=821850#c53)• 12 years ago |
|  | |

Comment on [attachment 707109](/attachment.cgi?id=707109 "Part 2 - Don't rewrap |this| in nativeCall. v1") [[details]](/attachment.cgi?id=707109&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v1") [[diff]](/attachment.cgi?id=707109&action=diff "Part 2 - Don't rewrap |this| in nativeCall. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707109)
Part 2 - Don't rewrap |this| in nativeCall. v1
Review of [attachment 707109](/attachment.cgi?id=707109 "Part 2 - Don't rewrap |this| in nativeCall. v1") [[details]](/attachment.cgi?id=707109&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v1") [[diff]](/attachment.cgi?id=707109&action=diff "Part 2 - Don't rewrap |this| in nativeCall. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707109):
-----------------------------------------------------------------
::: js/src/jswrapper.cpp
@@ +675,5 @@
> + // Handle |this| separately. We don't want to just rewrap it on the other
> + // side of the membrane, because that might apply a same-compartment
> + // security wrapper that will stymie this whole process. This logic can
> + // go away when same-compartment security wrappers go away.
> + Value \*thisAddr = src + 1;
&srcArgs.thisv()? Or do srcArgs.calleev()/.thisv() separately, and make the loop run over the arguments instead?

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=821850#c54)• 12 years ago |
|  | |

Comment on [attachment 707111](/attachment.cgi?id=707111 "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[details]](/attachment.cgi?id=707111&action=edit "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[diff]](/attachment.cgi?id=707111&action=diff "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707111)
Part 4 - Add infrastructure for lazily-created XBL scopes. v1
Review of [attachment 707111](/attachment.cgi?id=707111 "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[details]](/attachment.cgi?id=707111&action=edit "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[diff]](/attachment.cgi?id=707111&action=diff "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707111):
-----------------------------------------------------------------
::: js/xpconnect/src/XPCWrappedNativeScope.cpp
@@ +194,5 @@
> + !strcmp(js::GetObjectClass(mGlobalJSObject)->name, "ChromeWindow"));
> +
> + // Get the scope principal. If it's system, there's no reason to make
> + // a separate XBL scope.
> + nsIPrincipal\* principal = GetPrincipal();
\* to the right :/
@@ +214,5 @@
> + options.proto = global;
> +
> + // Use an nsExpandedPrincipal to create asymmetric security.
> + nsCOMPtr<nsIExpandedPrincipal> ep;
> + MOZ\_ASSERT(!(ep = do\_QueryInterface(principal)));
Ugh. Does
MOZ\_ASSERT(nsCOMPtr<nsIExpandedPrincipal>(do\_QueryInterface(principal)));
work?
@@ +221,5 @@
> + ep = new nsExpandedPrincipal(principalAsArray);
> +
> + // Create the sandbox.
> + JSAutoRequest ar(cx);
> + js::RootedValue v(cx);
Do you need to use RootedValue?
@@ +222,5 @@
> +
> + // Create the sandbox.
> + JSAutoRequest ar(cx);
> + js::RootedValue v(cx);
> + nsresult rv = xpc\_CreateSandboxObject(cx, v.address(), ep, options);
One space before =
::: js/xpconnect/src/xpcprivate.h
@@ +1739,5 @@
> XPCWrappedNativeScope(JSContext \*cx, JSObject\* aGlobal);
>
> nsAutoPtr<JSObject2JSObjectMap> mWaiverWrapperMap;
>
> + bool IsXBLScope() { return mIsXBLScope; }
Five-space indentation?

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=821850#c55)• 12 years ago |
|  | |

Comment on [attachment 707112](/attachment.cgi?id=707112 "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[details]](/attachment.cgi?id=707112&action=edit "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[diff]](/attachment.cgi?id=707112&action=diff "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707112)
Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1
Review of [attachment 707112](/attachment.cgi?id=707112 "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[details]](/attachment.cgi?id=707112&action=edit "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[diff]](/attachment.cgi?id=707112&action=diff "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707112):
-----------------------------------------------------------------
::: content/base/src/nsContentUtils.cpp
@@ +1769,5 @@
> JSScript \*script;
> JSContext \*cx = GetCurrentJSContext();
> + if (!cx)
> + return false;
> + // New Hotness.
Not a terribly helpful comment.

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=821850#c56)• 12 years ago |
|  | |

Comment on [attachment 707115](/attachment.cgi?id=707115 "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[details]](/attachment.cgi?id=707115&action=edit "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[diff]](/attachment.cgi?id=707115&action=diff "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707115)
Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1
Review of [attachment 707115](/attachment.cgi?id=707115 "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[details]](/attachment.cgi?id=707115&action=edit "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[diff]](/attachment.cgi?id=707115&action=diff "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707115):
-----------------------------------------------------------------
::: content/xbl/src/nsXBLProtoImpl.cpp
@@ +53,5 @@
> return NS\_OK; // Nothing to do, so let's not waste time.
>
> // If the way this gets the script context changes, fix
> // nsXBLProtoImplAnonymousMethod::Execute
> + nsIDocument\* document = aBinding->GetBoundElement()->OwnerDoc();
Can GetBoundElement() return null?

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=821850#c57)• 12 years ago |
|  | |

Comment on [attachment 707126](/attachment.cgi?id=707126 "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[details]](/attachment.cgi?id=707126&action=edit "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[diff]](/attachment.cgi?id=707126&action=diff "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707126)
Part 17 - Add API for lookup up implementation members on XBL bindings. v1
Review of [attachment 707126](/attachment.cgi?id=707126 "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[details]](/attachment.cgi?id=707126&action=edit "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[diff]](/attachment.cgi?id=707126&action=diff "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707126):
-----------------------------------------------------------------
::: content/xbl/src/nsXBLBinding.cpp
@@ +1425,5 @@
> +
> + // Get the string as an nsString before doing anything, so we can make
> + // convenient comparisons during our search.
> + if (!JSID\_IS\_STRING(aId))
> + return true;
{}. More below.

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=821850#c58)• 12 years ago |
|  | |

Comment on [attachment 707128](/attachment.cgi?id=707128 "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[details]](/attachment.cgi?id=707128&action=edit "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[diff]](/attachment.cgi?id=707128&action=diff "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707128)
Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1
Review of [attachment 707128](/attachment.cgi?id=707128 "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[details]](/attachment.cgi?id=707128&action=edit "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[diff]](/attachment.cgi?id=707128&action=diff "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707128):
-----------------------------------------------------------------
::: js/xpconnect/wrappers/XrayWrapper.cpp
@@ +1291,2 @@
> return false;
> }
if (!EnsureCompartmentPrivate(wrapper)->scope->IsXBLScope())
return false;
nsCOMPtr<nsIContent> content = do\_QueryInterfaceNative(cx, wrapper);
if (!content)
return false;
js::RootedId id\_(cx, id);
return nsContentUtils::IsBindingField(cx, content, id\_);

|  | [:Ms2ger (he/him; ⌚ UTC+1/+2)](/user_profile?user_id=302720) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=821850#c59)• 12 years ago |
|  | |

Comment on [attachment 707129](/attachment.cgi?id=707129 "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[details]](/attachment.cgi?id=707129&action=edit "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[diff]](/attachment.cgi?id=707129&action=diff "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707129)
Part 20 - Clone XBL into the XBL scope's compartment. v4
Review of [attachment 707129](/attachment.cgi?id=707129 "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[details]](/attachment.cgi?id=707129&action=edit "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[diff]](/attachment.cgi?id=707129&action=diff "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707129):
-----------------------------------------------------------------
::: content/xbl/src/nsXBLProtoImplMethod.cpp
@@ +312,5 @@
>
> JSAutoRequest ar(cx);
> + JSAutoCompartment ac(cx, scopeObject);
> + if (!JS\_WrapObject(cx, &thisObject))
> + return NS\_ERROR\_OUT\_OF\_MEMORY;
Indentation

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=821850#c60)• 12 years ago |
|  | |

To echo Ms2ger, less Rooted please.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=821850#c61)• 12 years ago |
|  | |

Bobby, will this let us run the XBL scripts even if the user has turned off JS? That would be \_really\_ nice; we have bugs about video controls not working in that situation.
Followup is fine if it needs additional work on top of this.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=821850#c62)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #61](/show_bug.cgi?id=821850#c61 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Bobby, will this let us run the XBL scripts even if the user has turned off
> JS? That would be \_really\_ nice; we have bugs about video controls not
> working in that situation.
It gives us that ability, yeah. If we want that behavior, we'll need to make sure it actually happens, and that we don't bail early via some check for disabled scripts. But such work should be trivial, if it exists.
> Followup is fine if it needs additional work on top of this.
Can you mark those bugs as dependent on this one?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=821850#c63)• 12 years ago |
|  | |

Sure thing. The general tracker for those problems is [bug 236839](/show_bug.cgi?id=236839 "RESOLVED FIXED - Disabling JavaScript should not prevent JavaScript contained in chrome XBL from running"), and there are a bunch of specific bugs about marquee, videocontrols, xml prettyprinter.Blocks: [236839](/show_bug.cgi?id=236839 "RESOLVED FIXED - Disabling JavaScript should not prevent JavaScript contained in chrome XBL from running"), [208864](/show_bug.cgi?id=208864 "RESOLVED WORKSFORME - marquee stops if JS is turned off"), [264817](/show_bug.cgi?id=264817 "NEW - XML Pretty Printer loses collapsing tree functionality with JavaScript disabled"), [449358](/show_bug.cgi?id=449358 "RESOLVED FIXED - Add test to confirm that video/audio UI controls function when JavaScript is disabled")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=821850#c64)• 12 years ago |
|  | |

This seems like a good bug to land early in Fx22 rather than late in Firefox 21 -- pretty good chance of regressions, yes?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=821850#c65)• 12 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #64](/show_bug.cgi?id=821850#c64 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> This seems like a good bug to land early in Fx22 rather than late in Firefox
> 21 -- pretty good chance of regressions, yes?
Yeah. On the flip side, it's our only answer to an otherwise unfixable sg-crit that currently affects all branches. We'd be in a pretty impossible position if we ever had to chemspill over this, so I'm not wild about waiting another 6 weeks.
Given that it's preffable, I'm going to land it, and then try flipping the pref on. If it becomes a problem, we can just pref it off on branch. Does that sound ok?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a4480900_281791)• 12 years ago |

[Attachment #707108](/attachment.cgi?id=707108&action=edit "Part 1 - Properly propagate |strict| in JSObject::deleteByValue. v1") -
Flags: review?(jorendorff) → review+

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=821850#c66)• 12 years ago |
|  | |

Er, r=me on that one with the addition of a test that runs in the standalone JS shell. It's easy to test, because the bug affects Proxies:
js> m={}
({})
js> Object.defineProperty(m, 'p', {value: 3});
({})
js> "use strict"; delete m.p
typein:3:14 TypeError: property "p" is non-configurable and can't be deleted
js> x = new Proxy(m, {})
({})
js> x.p
3
js> "use strict"; delete x.p
false

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=821850#c67)• 12 years ago |
|  | |

Comment on [attachment 707109](/attachment.cgi?id=707109 "Part 2 - Don't rewrap |this| in nativeCall. v1") [[details]](/attachment.cgi?id=707109&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v1") [[diff]](/attachment.cgi?id=707109&action=diff "Part 2 - Don't rewrap |this| in nativeCall. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707109)
Part 2 - Don't rewrap |this| in nativeCall. v1
Review of [attachment 707109](/attachment.cgi?id=707109 "Part 2 - Don't rewrap |this| in nativeCall. v1") [[details]](/attachment.cgi?id=707109&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v1") [[diff]](/attachment.cgi?id=707109&action=diff "Part 2 - Don't rewrap |this| in nativeCall. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707109):
-----------------------------------------------------------------
Still thinking about this one.
bholley and I have talked a little about this on IRC, but I need a little more. In particular, this exchange:
<jorendorff> bholley: I think the problem applies equally to other parameters as to this; consider x.appendChild(y) where both x and y are NAC nodes
[...bholley explained this is because appendChild doesn't go through callNative...]
<jorendorff> but going back to appendChild() just for a second, when you call the function, we rewrap everything for the content compartment? why does that work?
<bholley> jorendorff: so, for regular method access, we actually just do wrappedObject(wrapper) for |this|
<bholley> jorendorff: we don't rewrap it
<bholley> jorendorff: that's why it works
I don't see this in the source code.
I would feel more comfortable for this if the hack were:
- rewrap for target compartment, as we do now,
- but then if the result is a same-compartment security wrapper, unwrap it
because then it would clearly only apply in the particular case where we need it, leaving other security-sensitive cases unaffected. Plus the hack will \*certainly\* go away when same-compartment security wrappers go away.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=821850#c68)• 12 years ago |
|  | |

(In reply to Jason Orendorff [:jorendorff] from [comment #67](/show_bug.cgi?id=821850#c67 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> I don't see this in the source code.
Oh yeah, you're totally right. I misread the code when we were talking a few hours ago. We unwrap the \_call\_, but not the |this|. So what probably ends up happening, in effect, is that we call the method with a proxy |this|, which means that we end up back in the nativeCall trap, which incidentally explains why this problem is fixed when only fixing the nativeCall situation.
>
> I would feel more comfortable for this if the hack were:
> - rewrap for target compartment, as we do now,
> - but then if the result is a same-compartment security wrapper, unwrap it
> because then it would clearly only apply in the particular case where we
> need it, leaving other security-sensitive cases unaffected. Plus the hack
> will \*certainly\* go away when same-compartment security wrappers go away.
Fine by me. Happy to do that.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=821850#c69)• 12 years ago |
|  | |

Attached patch

[Part 2 - Don't rewrap |this| in nativeCall. v2](attachment.cgi?id=710762&action=diff)
— [Details](attachment.cgi?id=710762&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=710762)

[Attachment #707109](/attachment.cgi?id=707109&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v1") -
Attachment is obsolete: true
[Attachment #707109](/attachment.cgi?id=707109&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v1") -
Flags: review?(jorendorff)
[Attachment #710762](/attachment.cgi?id=710762&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v2") -
Flags: review?(jorendorff)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=821850#c70)• 12 years ago |
|  | |

Comment on [attachment 707110](/attachment.cgi?id=707110 "Part 3 - Make XBL-in-content tests Xray-safe. v2") [[details]](/attachment.cgi?id=707110&action=edit "Part 3 - Make XBL-in-content tests Xray-safe. v2") [[diff]](/attachment.cgi?id=707110&action=diff "Part 3 - Make XBL-in-content tests Xray-safe. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707110)
Part 3 - Make XBL-in-content tests Xray-safe. v2
r=me
[Attachment #707110](/attachment.cgi?id=707110&action=edit "Part 3 - Make XBL-in-content tests Xray-safe. v2") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=821850#c71)• 12 years ago |
|  | |

Comment on [attachment 707111](/attachment.cgi?id=707111 "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[details]](/attachment.cgi?id=707111&action=edit "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[diff]](/attachment.cgi?id=707111&action=diff "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707111)
Part 4 - Add infrastructure for lazily-created XBL scopes. v1
>+MOZ\_ASSERT(!strcmp(js::GetObjectClass(mGlobalJSObject)->name, "Window") ||
>+ !strcmp(js::GetObjectClass(mGlobalJSObject)->name, "ChromeWindow"));
What about "ModalContentWindow"? Or do we no longer end up with those? Check with a showModalDialog?
>+ if (nsContentUtils::IsSystemPrincipal(principal))
>+ return global;
Does it make sense to set mXBLScope to global here, so we can avoid doing the system-principal check multiple times?
>+ options.wantComponents = true;
It's odd to set this and wantXHRConstructor to their default values explicitly but not do the same for wantXrays. Why, exactly?
r=me with the above dealt with.
[Attachment #707111](/attachment.cgi?id=707111&action=edit "Part 4 - Add infrastructure for lazily-created XBL scopes. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=821850#c72)• 12 years ago |
|  | |

Comment on [attachment 707112](/attachment.cgi?id=707112 "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[details]](/attachment.cgi?id=707112&action=edit "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[diff]](/attachment.cgi?id=707112&action=diff "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707112)
Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1
r=me
[Attachment #707112](/attachment.cgi?id=707112&action=edit "Part 5 - Check for XBL scopes in nsContentUtils::IsCallerXBL(). v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=821850#c73)• 12 years ago |
|  | |

Comment on [attachment 707113](/attachment.cgi?id=707113 "Part 6 - Clean up security wrappers for NAC. v1") [[details]](/attachment.cgi?id=707113&action=edit "Part 6 - Clean up security wrappers for NAC. v1") [[diff]](/attachment.cgi?id=707113&action=diff "Part 6 - Clean up security wrappers for NAC. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707113)
Part 6 - Clean up security wrappers for NAC. v1
r=me
[Attachment #707113](/attachment.cgi?id=707113&action=edit "Part 6 - Clean up security wrappers for NAC. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=821850#c74)• 12 years ago |
|  | |

Comment on [attachment 707114](/attachment.cgi?id=707114 "Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1") [[details]](/attachment.cgi?id=707114&action=edit "Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1") [[diff]](/attachment.cgi?id=707114&action=diff "Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707114)
Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1
r=me.
Does this really not address the video-when-script-is-disabled issue?
[Attachment #707114](/attachment.cgi?id=707114&action=edit "Part 7 - Let nsExpandedPrincipal through CheckFunctionAccess. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=821850#c75)• 12 years ago |
|  | |

Comment on [attachment 707115](/attachment.cgi?id=707115 "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[details]](/attachment.cgi?id=707115&action=edit "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[diff]](/attachment.cgi?id=707115&action=diff "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707115)
Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1
r=me
[Attachment #707115](/attachment.cgi?id=707115&action=edit "Part 8 - Pass nsXBLBinding instead of nsIContent during implementation installation. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=821850#c76)• 12 years ago |
|  | |

Comment on [attachment 707117](/attachment.cgi?id=707117 "Part 9 - Remove bogus comment/check and replace with an assert. v1") [[details]](/attachment.cgi?id=707117&action=edit "Part 9 - Remove bogus comment/check and replace with an assert. v1") [[diff]](/attachment.cgi?id=707117&action=diff "Part 9 - Remove bogus comment/check and replace with an assert. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707117)
Part 9 - Remove bogus comment/check and replace with an assert. v1
r=me
[Attachment #707117](/attachment.cgi?id=707117&action=edit "Part 9 - Remove bogus comment/check and replace with an assert. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=821850#c77)• 12 years ago |
|  | |

Comment on [attachment 707118](/attachment.cgi?id=707118 "Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1") [[details]](/attachment.cgi?id=707118&action=edit "Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1") [[diff]](/attachment.cgi?id=707118&action=diff "Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707118)
Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1
Maybe add asserts that aTargetClassObject to the two InstallMember implementation?
[Attachment #707118](/attachment.cgi?id=707118&action=edit "Part 10 - Make DoInitJSClass unconditionally fill in aClassObject. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=821850#c78)• 12 years ago |
|  | |

Comment on [attachment 707119](/attachment.cgi?id=707119 "Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1") [[details]](/attachment.cgi?id=707119&action=edit "Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1") [[diff]](/attachment.cgi?id=707119&action=diff "Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707119)
Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1
r=me
[Attachment #707119](/attachment.cgi?id=707119&action=edit "Part 11 - Store a strong ref to the JSClass in nsXBLBinding. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=821850#c79)• 12 years ago |
|  | |

Comment on [attachment 707120](/attachment.cgi?id=707120 "Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1") [[details]](/attachment.cgi?id=707120&action=edit "Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1") [[diff]](/attachment.cgi?id=707120&action=diff "Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707120)
Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1
r=me
[Attachment #707120](/attachment.cgi?id=707120&action=edit "Part 12 - Remove unused arguments from InstallMember and simplify calling convention. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=821850#c80)• 12 years ago |
|  | |

Comment on [attachment 707121](/attachment.cgi?id=707121 "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") [[details]](/attachment.cgi?id=707121&action=edit "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") [[diff]](/attachment.cgi?id=707121&action=diff "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707121)
Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1
Please add to the checkin comment that the code is just being moved with no changes.
r=me
[Attachment #707121](/attachment.cgi?id=707121&action=edit "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=821850#c81)• 12 years ago |
|  | |

Comment on [attachment 707123](/attachment.cgi?id=707123 "Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2") [[details]](/attachment.cgi?id=707123&action=edit "Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2") [[diff]](/attachment.cgi?id=707123&action=diff "Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707123)
Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2
>+// InstallXBLField below) reify a for the field onto the actual XBL-backed
> element.
"a property", right?
>+ // Don't resolve it if the field is empty; see also InstallField which also
s/resolve/install/ ?
r=me
[Attachment #707123](/attachment.cgi?id=707123&action=edit "Part 14 - Install XBL field accessors on prototype objects at setup time, and nuke XBLResolve. v2") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=821850#c82)• 12 years ago |
|  | |

Comment on [attachment 707124](/attachment.cgi?id=707124 "Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1") [[details]](/attachment.cgi?id=707124&action=edit "Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1") [[diff]](/attachment.cgi?id=707124&action=diff "Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707124)
Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1
r=me
[Attachment #707124](/attachment.cgi?id=707124&action=edit "Part 15 - Unwrap |callee| before passing it to InstallXBLField. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=821850#c83)• 12 years ago |
|  | |

Comment on [attachment 707125](/attachment.cgi?id=707125 "Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1") [[details]](/attachment.cgi?id=707125&action=edit "Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1") [[diff]](/attachment.cgi?id=707125&action=diff "Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707125)
Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1
Hmm. This is slightly worrisome in terms of regression risk, but r=me
[Attachment #707125](/attachment.cgi?id=707125&action=edit "Part 16 - Make XBL prototype setup tamper-proof for Xrays. v1") -
Flags: review?(bzbarsky) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=821850#c84)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #71](/show_bug.cgi?id=821850#c71 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> What about "ModalContentWindow"?
Added it.
>
> >+ if (nsContentUtils::IsSystemPrincipal(principal))
> >+ return global;
>
> Does it make sense to set mXBLScope to global here, so we can avoid doing
> the system-principal check multiple times?
I'd prefer not to. I don't think the overhead is significant considering what else is going on here (it's basically just one virtual function call), and I'm concerned that we'd screw it up with tracing or get confused debugging. I'd rather have that member point either to a sandbox or null, depending on whether we're using a separate XBL scope or not.
> >+ options.wantComponents = true;
>
> It's odd to set this and wantXHRConstructor to their default values
> explicitly but not do the same for wantXrays. Why, exactly?
I'd original had wantXrays=false (which is non-default) when I was experimenting with this stuff without nsEP. When I implemented nsEP, I removed it, to make sure that we were getting Xrays on account of the asymmetric security and not on account of wantXrays. I'll add options.wantXrays = false here to be explicit.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=821850#c85)• 12 years ago |
|  | |

Comment on [attachment 707126](/attachment.cgi?id=707126 "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[details]](/attachment.cgi?id=707126&action=edit "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[diff]](/attachment.cgi?id=707126&action=diff "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707126)
Part 17 - Add API for lookup up implementation members on XBL bindings. v1
> [Bug 821850](/show_bug.cgi?id=821850 "RESOLVED FIXED - Investigate running XBL in a separate compartment") - Add API for lookup up implementation members on XBL bindings. v1
Extra "up" in there?
>+ if (!mBoundElement && !mBoundElement->GetWrapper())
s/&&/||/ or something?
>+ // Find our class object. It's permanent, so it should be there no matter
>+ // what.
Is that true if the node was adopted? Do we end up creating a new XBLBinding for it in the new global? Otherwise it seems like the class object would be on the old global but the aBoundScope would be the new global...
r=me as long as that part is sorted out.
[Attachment #707126](/attachment.cgi?id=707126&action=edit "Part 17 - Add API for lookup up implementation members on XBL bindings. v1") -
Flags: review?(bzbarsky) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=821850#c86)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #74](/show_bug.cgi?id=821850#c74 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Does this really not address the video-when-script-is-disabled issue?
Actually, it might!

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=821850#c87)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #77](/show_bug.cgi?id=821850#c77 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Maybe add asserts that aTargetClassObject to the two InstallMember
> implementation?
It ends up implicitly asserted a few patches later via:
MOZ\_ASSERT(js::IsObjectInContextCompartment(aTargetClassObject, aCx));

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=821850#c88)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #80](/show_bug.cgi?id=821850#c80 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Comment on [attachment 707121](/attachment.cgi?id=707121 "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") [[details]](/attachment.cgi?id=707121&action=edit "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") [[diff]](/attachment.cgi?id=707121&action=diff "Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707121)
> Part 13 - Hoist Field machinery into nsXBLProtoImplField. v1
>
> Please add to the checkin comment that the code is just being moved with no
> changes.
Already there - whenever I post a series of patches, the comments in the bug are also checkin comments in the patches. :-)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 89](/show_bug.cgi?id=821850#c89)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #85](/show_bug.cgi?id=821850#c85 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> Is that true if the node was adopted? Do we end up creating a new
> XBLBinding for it in the new global? Otherwise it seems like the class
> object would be on the old global but the aBoundScope would be the new
> global...
Discussed in person. All good.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 90](/show_bug.cgi?id=821850#c90)• 12 years ago |
|  | |

> Already there
No, the comment in the patch doesn't make it quite clear that the only change is things being moved, via pure copy/paste. I \_did\_ look at the patch comment there... ;)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791) |  |
| --- | --- | --- |
| [Comment 91](/show_bug.cgi?id=821850#c91)• 12 years ago |
|  | |

Comment on [attachment 710762](/attachment.cgi?id=710762 "Part 2 - Don't rewrap |this| in nativeCall. v2") [[details]](/attachment.cgi?id=710762&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v2") [[diff]](/attachment.cgi?id=710762&action=diff "Part 2 - Don't rewrap |this| in nativeCall. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=710762)
Part 2 - Don't rewrap |this| in nativeCall. v2
/me narrows his eyes and peers closely at the patch.
OK, let's do it.
[Attachment #710762](/attachment.cgi?id=710762&action=edit "Part 2 - Don't rewrap |this| in nativeCall. v2") -
Flags: review?(jorendorff) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 92](/show_bug.cgi?id=821850#c92)• 12 years ago |
|  | |

Comment on [attachment 707127](/attachment.cgi?id=707127 "Part 18 - Expose XBL members via Xray wrappers. v1") [[details]](/attachment.cgi?id=707127&action=edit "Part 18 - Expose XBL members via Xray wrappers. v1") [[diff]](/attachment.cgi?id=707127&action=diff "Part 18 - Expose XBL members via Xray wrappers. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707127)
Part 18 - Expose XBL members via Xray wrappers. v1
>+ if (!aContent->IsInDoc())
Why? Nodes not in a document can have XBL bindings attached, generally...
Please remove this check and use OwnerDoc() to get the binding manager.
r=me with that.
[Attachment #707127](/attachment.cgi?id=707127&action=edit "Part 18 - Expose XBL members via Xray wrappers. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 93](/show_bug.cgi?id=821850#c93)• 12 years ago |
|  | |

Comment on [attachment 707128](/attachment.cgi?id=707128 "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[details]](/attachment.cgi?id=707128&action=edit "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[diff]](/attachment.cgi?id=707128&action=diff "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707128)
Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1
>+++ b/content/base/src/nsContentUtils.cpp
>+ if (!aContent->IsInDoc())
>+ return false;
Again, drop this and get the binding manager from OwnerDoc().
>+ const jschar\* chars = JS\_GetStringCharsZ(aCx, JSID\_TO\_STRING(aId));
>+ if (!chars)
>+ return false;
>+ nsDependentString name(chars);
Why not nsDependentJSString?
>+++ b/content/xbl/src/nsXBLBinding.cpp
>+ if (mPrototypeBinding->FindField(aName))
>+ return true;
>+
>+ // Try ancestor bindings.
>+ return mNextBinding ? mNextBinding->HasField(aName) : false;
Could just do:
return mPrototypeBinding->FindField(aName) ||
(mNextBinding && mNextBinding->HasField(aName));
In either case, I'd prefer boolean and there to using ?:.
r=me with that
[Attachment #707128](/attachment.cgi?id=707128&action=edit "Part 19 - Dynamically waive Xray for field access by XBL script on bound nodes. v1") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 94](/show_bug.cgi?id=821850#c94)• 12 years ago |
|  | |

Comment on [attachment 707129](/attachment.cgi?id=707129 "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[details]](/attachment.cgi?id=707129&action=edit "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[diff]](/attachment.cgi?id=707129&action=diff "Part 20 - Clone XBL into the XBL scope's compartment. v4") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707129)
Part 20 - Clone XBL into the XBL scope's compartment. v4
>+ // FieldGetter and FieldSetter need to run in the XBL scope so that they can
>+ // see throw any SOWs on their targets.
s/throw/through/?
>+ JSAutoCompartment ac (aCx, scopeObject);
Nix the space before '(' please.
>+ JSAutoCompartment c2(aCx, aTargetClassObject);
"ac2"?
r=me with those fixed. This stuff is ... finicky. :(
[Attachment #707129](/attachment.cgi?id=707129&action=edit "Part 20 - Clone XBL into the XBL scope's compartment. v4") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 95](/show_bug.cgi?id=821850#c95)• 12 years ago |
|  | |

Comment on [attachment 707130](/attachment.cgi?id=707130 "Part 21 - Tests. v1") [[details]](/attachment.cgi?id=707130&action=edit "Part 21 - Tests. v1") [[diff]](/attachment.cgi?id=707130&action=diff "Part 21 - Tests. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=821850&attachment=707130)
Part 21 - Tests. v1
r=me
[Attachment #707130](/attachment.cgi?id=707130&action=edit "Part 21 - Tests. v1") -
Flags: review?(bzbarsky) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 96](/show_bug.cgi?id=821850#c96)• 12 years ago |
|  | |

Final try push before landing preffed off:
<https://tbpl.mozilla.org/?tree=Try&rev=e5eb423ab5db>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 97](/show_bug.cgi?id=821850#c97)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?changeset=b191b0790a66>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 98](/show_bug.cgi?id=821850#c98)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/60c531ee1fbe>
<https://hg.mozilla.org/mozilla-central/rev/7e7bd18931c1>
<https://hg.mozilla.org/mozilla-central/rev/cc884677ee40>
<https://hg.mozilla.org/mozilla-central/rev/580a65d9eb1e>
<https://hg.mozilla.org/mozilla-central/rev/f168a07ce06f>
<https://hg.mozilla.org/mozilla-central/rev/2c0fdd436173>
<https://hg.mozilla.org/mozilla-central/rev/dd78d9d83bdd>
<https://hg.mozilla.org/mozilla-central/rev/34bc18d21cc5>
<https://hg.mozilla.org/mozilla-central/rev/bbad14489645>
<https://hg.mozilla.org/mozilla-central/rev/c092442efc7b>
<https://hg.mozilla.org/mozilla-central/rev/a1ddf64db133>
<https://hg.mozilla.org/mozilla-central/rev/583ed5f34e84>
<https://hg.mozilla.org/mozilla-central/rev/05df50b4e43e>
<https://hg.mozilla.org/mozilla-central/rev/30c448ff9ea7>
<https://hg.mozilla.org/mozilla-central/rev/507c15457176>
<https://hg.mozilla.org/mozilla-central/rev/5264dc88e9c2>
<https://hg.mozilla.org/mozilla-central/rev/d002170e2ba7>
<https://hg.mozilla.org/mozilla-central/rev/cd5c0556477c>
<https://hg.mozilla.org/mozilla-central/rev/61fde4343620>
<https://hg.mozilla.org/mozilla-central/rev/411dcc78008e>
<https://hg.mozilla.org/mozilla-central/rev/b191b0790a66>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Flags: in-testsuite+Resolution: --- → FIXEDTarget Milestone: --- → mozilla21

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 99](/show_bug.cgi?id=821850#c99)• 12 years ago |
|  | |

Bobby, this is crazy awesome! Great work!

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 100](/show_bug.cgi?id=821850#c100)• 12 years ago |
|  | |

To be clear to anybody trying to figure out what is going on here, this landed preffed off. The pref is going to be flipped in [bug 834697](/show_bug.cgi?id=834697 "RESOLVED FIXED - Enable XBL Scopes"), so technically the other dependent bugs here should be blocked by that.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 101](/show_bug.cgi?id=821850#c101)• 12 years ago |
|  | |

If I understand correctly, the plan is to fuzz it for a few days, fix any fallout, then flip the pref.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a4913659_75935)• 12 years ago |

Depends on: [839795](/show_bug.cgi?id=839795 "RESOLVED DUPLICATE - The monkey patch no longer works.")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a4941381_20209)• 12 years ago |

Depends on: [839792](/show_bug.cgi?id=839792 "RESOLVED FIXED - From add-on, TypeError: \"_appendCurrentResult\" is read-only")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 102](/show_bug.cgi?id=821850#c102)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #100](/show_bug.cgi?id=821850#c100 "RESOLVED FIXED - Investigate running XBL in a separate compartment"))
> The pref is going to be flipped in [bug 834697](/show_bug.cgi?id=834697 "RESOLVED FIXED - Enable XBL Scopes"), so
> technically the other dependent bugs here should be blocked by that.
Good point. Moving the deps.No longer blocks: [208864](/show_bug.cgi?id=208864 "RESOLVED WORKSFORME - marquee stops if JS is turned off"), [236839](/show_bug.cgi?id=236839 "RESOLVED FIXED - Disabling JavaScript should not prevent JavaScript contained in chrome XBL from running"), [264817](/show_bug.cgi?id=264817 "NEW - XML Pretty Printer loses collapsing tree functionality with JavaScript disabled"), [449358](/show_bug.cgi?id=449358 "RESOLVED FIXED - Add test to confirm that video/audio UI controls function when JavaScript is disabled"), [817922](/show_bug.cgi?id=817922 "RESOLVED FIXED - Functions implemented by XBL are callable, this could be a serious security threat under the right circumstances."), [821676](/show_bug.cgi?id=821676 "RESOLVED FIXED - It's possible to break XBL scripts for video controls"), [825392](/show_bug.cgi?id=825392 "RESOLVED FIXED - Create native-anonymous content reflectors in the XBL scope")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a5370486_1689)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Philip Chee](/user_profile?user_id=188891) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a5412500_188891)• 12 years ago |

Depends on: [839873](/show_bug.cgi?id=839873 "RESOLVED DUPLICATE - TB shows only the first conversation")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a11847781_280903)• 12 years ago |

Whiteboard: [adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a12031833_1689)• 12 years ago |

Blocks: [816071](/show_bug.cgi?id=816071 "RESOLVED FIXED - Content can confuse XBL with prototypes and can impersonate XBL script using eval() and Function() (bypassing SOWs)")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a12978568_1689)• 12 years ago |

Alias: XBL-scopes

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=821850#a60937485_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=821850&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bobby Holley (:bholley)](/user_profile?user_id=313730)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_9cef06b5_20250125_164322.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/826104)
* [XML](/show_bug.cgi?ctype=xml&id=826104)

Closed
[Bug 826104](/show_bug.cgi?id=826104)

Opened 12 years ago
Closed 12 years ago

# Crash in MediaDecoder::UpdatePlaybackOffset

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in MediaDecoder::UpdatePlaybackOffset

## Categories

### (Core :: Audio/Video, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Audio%2FVideo#Audio%2FVideo)

Audio/Video
▾

Core :: Audio/Video
For problems related to media (video/audio) -- especially when the reporter is not sure which area of the media stack the problem is in. This category will mostly be for untriaged video/audio issues. Bugs in this category will typically be moved to another media category during the triage process.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Audio%2FVideo)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix) |
| firefox19 | --- | [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected) |
| firefox20 | --- | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 |  | wontfix |
| firefox19 |  | affected |
| firefox20 |  | affected |
| firefox21 |  | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mwobensmith, Assigned: kinetik)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/aeea283b2f56b75a7c959ccfb660a619?d=mm&size=40)  [kinetik](/user_profile?user_id=274575)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=40)  [mwobensmith](/user_profile?user_id=452604)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[794426](/show_bug.cgi?id=794426 "RESOLVED FIXED - Simultaneous calls to nsBuiltinDecoderStateMachine::StopAudioThread() cause problems")

Dependency [tree](/showdependencytree.cgi?id=826104&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=826104)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, sec-low, Whiteboard: [asan][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[asan][adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [patch v0](/attachment.cgi?id=702628)  [12 years ago](#c5)  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)   4.56 KB, patch | roc : [review+](#c6 "12 years ago") | [Details](/attachment.cgi?id=702628&action=edit) | [Diff](/attachment.cgi?id=702628&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=826104&attachment=702628) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=826104#c0)• 12 years ago |
|  | |

This was surfaced after [bug #784918](/show_bug.cgi?id=784918 "RESOLVED FIXED - Heap-use-after-free in nsHTMLMediaElement::CaptureStreamInternal") was fixed. Use Abhishek's sample file for that bug to reproduce this one.
Also, if bug does not reproduce at first, try loading in several tabs at once and refreshing page.
=================================================================
==87236== ERROR: AddressSanitizer: SEGV on unknown address 0x000000000000 (pc 0x000105579b20 sp 0x000190549fe0 bp 0x00019054a0d0 T409)
AddressSanitizer can not provide additional info.
#0 0x105579b1f in mozilla::MediaDecoder::UpdatePlaybackOffset(long long) (in XUL) + 175
#1 0x105588d42 in mozilla::MediaDecoderStateMachine::PlayFromAudioQueue(unsigned long long, unsigned int) (in XUL) + 1394
#2 0x1055877be in mozilla::MediaDecoderStateMachine::AudioLoop() (in XUL) + 4238
#3 0x105594239 in nsRunnableMethodImpl<void (mozilla::MediaDecoderStateMachine::\*)(), true>::Run() (in XUL) + 137
#4 0x1069c2f4b in nsThread::ProcessNextEvent(bool, bool\*) (in XUL) + 2139
#5 0x106909a72 in NS\_ProcessNextEvent\_P(nsIThread\*, bool) (in XUL) + 194
#6 0x1069c122c in nsThread::ThreadFunc(void\*) (in XUL) + 412
#7 0x103258f1d in \_pt\_root (in libnspr4.dylib) + 749
#8 0x1000113ea in 0x2000113ea
#9 0x7fff913be180 in thread\_start (in libsystem\_c.dylib) + 12
Thread T409 created by T28 here:
#0 0x1000090b4 in 0x2000090b4
#1 0x1032548bc in \_PR\_CreateThread (in libnspr4.dylib) + 1612
#2 0x10325425a in PR\_CreateThread (in libnspr4.dylib) + 26
#3 0x1069c1c67 in nsThread::Init() (in XUL) + 327
#4 0x1069c6717 in nsThreadManager::NewThread(unsigned int, unsigned int, nsIThread\*\*) (in XUL) + 119
#5 0x106909267 in NS\_NewThread\_P(nsIThread\*\*, nsIRunnable\*, unsigned int) (in XUL) + 199
#6 0x1051b1ecc in tag\_nsresult NS\_NewNamedThread\_P<12ul>(char const (&) [12ul], nsIThread\*\*, nsIRunnable\*, unsigned int) (in XUL) + 28
#7 0x105589dab in mozilla::MediaDecoderStateMachine::StartAudioThread() (in XUL) + 539
#8 0x105589ada in mozilla::MediaDecoderStateMachine::StartPlayback() (in XUL) + 474
#9 0x10558f5f5 in mozilla::MediaDecoderStateMachine::AdvanceFrame() (in XUL) + 2405
#10 0x10558deac in mozilla::MediaDecoderStateMachine::RunStateMachine() (in XUL) + 492
#11 0x105590f2d in mozilla::MediaDecoderStateMachine::CallRunStateMachine() (in XUL) + 541
#12 0x105590cb7 in mozilla::MediaDecoderStateMachine::Run() (in XUL) + 231
#13 0x1069c2f4b in nsThread::ProcessNextEvent(bool, bool\*) (in XUL) + 2139
#14 0x106909a72 in NS\_ProcessNextEvent\_P(nsIThread\*, bool) (in XUL) + 194
#15 0x1069c243c in nsThread::Shutdown() (in XUL) + 764
#16 0x10558c8ff in mozilla::MediaDecoderStateMachine::StopAudioThread() (in XUL) + 655
#17 0x105590ea5 in mozilla::MediaDecoderStateMachine::CallRunStateMachine() (in XUL) + 405
#18 0x105590cb7 in mozilla::MediaDecoderStateMachine::Run() (in XUL) + 231
#19 0x1069c2f4b in nsThread::ProcessNextEvent(bool, bool\*) (in XUL) + 2139
#20 0x106909a72 in NS\_ProcessNextEvent\_P(nsIThread\*, bool) (in XUL) + 194
#21 0x1069c122c in nsThread::ThreadFunc(void\*) (in XUL) + 412
#22 0x103258f1d in \_pt\_root (in libnspr4.dylib) + 749
#23 0x1000113ea in 0x2000113ea
#24 0x7fff913be180 in thread\_start (in libsystem\_c.dylib) + 12
Thread T28 created by T0 here:
#0 0x1000090b4 in 0x2000090b4
#1 0x1032548bc in \_PR\_CreateThread (in libnspr4.dylib) + 1612
#2 0x10325425a in PR\_CreateThread (in libnspr4.dylib) + 26
#3 0x1069c1c67 in nsThread::Init() (in XUL) + 327
#4 0x1069c6717 in nsThreadManager::NewThread(unsigned int, unsigned int, nsIThread\*\*) (in XUL) + 119
#5 0x106909267 in NS\_NewThread\_P(nsIThread\*\*, nsIRunnable\*, unsigned int) (in XUL) + 199
#6 0x1051b1ecc in tag\_nsresult NS\_NewNamedThread\_P<12ul>(char const (&) [12ul], nsIThread\*\*, nsIRunnable\*, unsigned int) (in XUL) + 28
#7 0x10557e344 in mozilla::StateMachineTracker::EnsureGlobalStateMachine() (in XUL) + 356
#8 0x10557fb6d in mozilla::MediaDecoderStateMachine::MediaDecoderStateMachine(mozilla::MediaDecoder\*, mozilla::MediaDecoderReader\*, bool) (in XUL) + 1821
#9 0x1055fd6f2 in mozilla::WaveDecoder::CreateStateMachine() (in XUL) + 66
#10 0x1055726c6 in mozilla::MediaDecoder::Load(mozilla::MediaResource\*, nsIStreamListener\*\*, mozilla::MediaDecoder\*) (in XUL) + 134
#11 0x104db717f in nsHTMLMediaElement::FinishDecoderSetup(mozilla::MediaDecoder\*, mozilla::MediaResource\*, nsIStreamListener\*\*, mozilla::MediaDecoder\*) (in XUL) + 943
#12 0x104da857f in nsHTMLMediaElement::InitializeDecoderForChannel(nsIChannel\*, nsIStreamListener\*\*) (in XUL) + 719
#13 0x104da7ee4 in nsHTMLMediaElement::MediaLoadListener::OnStartRequest(nsIRequest\*, nsISupports\*) (in XUL) + 1380
#14 0x103c2301f in nsBaseChannel::OnStartRequest(nsIRequest\*, nsISupports\*) (in XUL) + 495
#15 0x103c4ad53 in nsInputStreamPump::OnStateStart() (in XUL) + 515
#16 0x103c4a8e2 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream\*) (in XUL) + 530
#17 0x106989e0d in nsInputStreamReadyEvent::Run() (in XUL) + 125
#18 0x1069c2f4b in nsThread::ProcessNextEvent(bool, bool\*) (in XUL) + 2139
#19 0x1069098ae in NS\_ProcessPendingEvents\_P(nsIThread\*, unsigned int) (in XUL) + 254
#20 0x1061a6813 in nsBaseAppShell::NativeEventCallback() (in XUL) + 451
#21 0x1061266ca in nsAppShell::ProcessGeckoEvents(void\*) (in XUL) + 490
#22 0x7fff96815100 in \_\_CFRUNLOOP\_IS\_CALLING\_OUT\_TO\_A\_SOURCE0\_PERFORM\_FUNCTION\_\_ (in CoreFoundation) + 16
#23 0x7fff96814a24 in \_\_CFRunLoopDoSources0 (in CoreFoundation) + 244
#24 0x7fff96837dc4 in \_\_CFRunLoopRun (in CoreFoundation) + 788
#25 0x7fff968376b1 in CFRunLoopRunSpecific (in CoreFoundation) + 289
#26 0x7fff901db0a3 in RunCurrentEventLoopInMode (in HIToolbox) + 208
#27 0x7fff901dad83 in ReceiveNextEventCommon (in HIToolbox) + 165
#28 0x7fff901dacd2 in BlockUntilNextEventMatchingListInMode (in HIToolbox) + 61
#29 0x7fff924d8612 in \_DPSNextEvent (in AppKit) + 684
#30 0x7fff924d7ed1 in -[NSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] (in AppKit) + 127
#31 0x106124f15 in -[GeckoNSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] (in XUL) + 245
#32 0x7fff924cf282 in -[NSApplication run] (in AppKit) + 516
#33 0x1061272a9 in nsAppShell::Run() (in XUL) + 185
#34 0x105d028c7 in nsAppStartup::Run() (in XUL) + 311
#35 0x103bc674f in XREMain::XRE\_mainRun() (in XUL) + 4287
#36 0x103bc7707 in XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) (in XUL) + 599
#37 0x103bc7bb2 in XRE\_main (in XUL) + 146
#38 0x100002d50 in 0x200002d50
#39 0x1000023fa in 0x2000023fa
#40 0x100001853 in 0x200001853
#41 0x0 in 0x0000000100000000 (in firefox-bin)
Stats: 1909M malloced (1465M for red zones) by 2527360 calls
Stats: 260M realloced by 160538 calls
Stats: 1785M freed by 2116352 calls
Stats: 1741M really freed by 2026212 calls
Stats: 703M (180003 full pages) mmaped in 1041 calls
mmaps by size class: 7:356265; 8:124867; 9:27621; 10:13797; 11:9180; 12:4480; 13:11648; 14:3200; 15:800; 16:1160; 17:464; 18:148; 19:38; 20:29; 21:5; 22:23; 23:2; 24:4;
mallocs by size class: 7:1596497; 8:494426; 9:131434; 10:117840; 11:84623; 12:32593; 13:33559; 14:13390; 15:12108; 16:5815; 17:3815; 18:874; 19:165; 20:120; 21:14; 22:80; 23:2; 24:7;
frees by size class: 7:1318903; 8:396513; 9:113833; 10:109720; 11:81490; 12:29796; 13:32710; 14:11321; 15:11885; 16:5314; 17:3744; 18:760; 19:155; 20:116; 21:13; 22:73; 23:2; 24:7;
rfrees by size class: 7:1258696; 8:381608; 9:109079; 10:106352; 11:78281; 12:28656; 13:31792; 14:10212; 15:11507; 16:5240; 17:3698; 18:726; 19:154; 20:116; 21:13; 22:73; 23:2; 24:7;
Stats: malloc large: 24019 small slow: 41712
==87236== ABORTING

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=826104#c1)• 12 years ago |
|  | |

Looks like a null deref which wouldn't be too worrying, but CC'ing Roc who fixed the original bug.Whiteboard: [asan]

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826104#a684829_274575)• 12 years ago |

Status: NEW → ASSIGNEDQA Contact: kinetik

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=826104#c2)• 12 years ago |
|  | |

Marking as sec-low because it looks like a null deref. Please re-rate or clear the sec- flag if that's wrong.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826104#a685019_406194)• 12 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=826104#c3)• 12 years ago |
|  | |

The audio thread thread blocks in PlayFromAudioQueue (at mAudioStream->Write).
The state machine thread calls StopAudioThread (triggered by SetAudioCaptured(true) rescheduling the state machine thread), mStopAudioThread is false so it "blocks" (spins a nested event queue) at mAudioThread->Shutdown waiting for the audio thread to complete.
As the nested event queue spins, additional calls are made to StopAudioThread (from CallRunStateMachine because mAudioCaptured == true, triggered by TimeoutExpired) which bail early due to mStopAudioThread being true.
Still in the nested event queue, Shutdown is called from somewhere, which calls StopAudioThread from RunStateMachine#DECODER\_STATE\_SHUTDOWN but does not block because mStopAudioThread == true so shutdown continues, resulting in the state machine's mDecoder pointer being set to null.
The audio thread eventually wakes up in PlayFromAudioQueue and calls mDecoder->UpdatePlaybackOffset, crashing due to a null dereference.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826104#a949128_274575)• 12 years ago |

Blocks: [794426](/show_bug.cgi?id=794426 "RESOLVED FIXED - Simultaneous calls to nsBuiltinDecoderStateMachine::StopAudioThread() cause problems")

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=826104#c4)• 12 years ago |
|  | |

How about having PlayFromAudioQueue take a strong reference to mDecoder while holding the monitor?
One thing I don't understand is that MediaDecoder::UpdatePlaybackRate asserts we're holding the monitor, but it looks like MediaDecoderStateMachine::PlayFromAudioQueue calls it without holding the monitor?

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=826104#c5)• 12 years ago |
|  | |

Attached patch

[patch v0](attachment.cgi?id=702628&action=diff)
— [Details](attachment.cgi?id=702628&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=826104&attachment=702628)

(In reply to Robert O'Callahan (:roc) (Mozilla Corporation) from [comment #4](/show_bug.cgi?id=826104#c4 "RESOLVED FIXED - Crash in MediaDecoder::UpdatePlaybackOffset"))
> How about having PlayFromAudioQueue take a strong reference to mDecoder
> while holding the monitor?
That's an option. The fix I implemented and pushed to try on Monday night (<https://tbpl.mozilla.org/?tree=Try&rev=942e57738c8c>) takes the approach of deferring RunStateMachine's SHUTDOWN steps until the audio thread has completed. Perhaps that's too ugly--if you think so I'll try your approach.
> One thing I don't understand is that MediaDecoder::UpdatePlaybackRate
> asserts we're holding the monitor, but it looks like
> MediaDecoderStateMachine::PlayFromAudioQueue calls it without holding the
> monitor?
It's MediaDecoder::UpdatePlaybackOffset, which takes the monitor internally.Assignee: nobody → kinetik
[Attachment #702628](/attachment.cgi?id=702628&action=edit "patch v0") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=826104#c6)• 12 years ago |
|  | |

Comment on [attachment 702628](/attachment.cgi?id=702628 "patch v0") [[details]](/attachment.cgi?id=702628&action=edit "patch v0") [[diff]](/attachment.cgi?id=702628&action=diff "patch v0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=826104&attachment=702628)
patch v0
Review of [attachment 702628](/attachment.cgi?id=702628 "patch v0") [[details]](/attachment.cgi?id=702628&action=edit "patch v0") [[diff]](/attachment.cgi?id=702628&action=diff "patch v0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=826104&attachment=702628):
-----------------------------------------------------------------
This isn't ugly, it's brilliant! :-)
[Attachment #702628](/attachment.cgi?id=702628&action=edit "patch v0") -
Flags: review?(roc) → review+

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=826104#c7)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/ee9dd4854dfc>

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=826104#c8)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ee9dd4854dfc>Status: ASSIGNED → RESOLVEDClosed: 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla21

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826104#a1299699_1689)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826104#a10281412_280903)• 12 years ago |

Whiteboard: [asan] → [asan][adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826104#a59284293_1689)• 10 years ago |

Group: core-security

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826104#a233393141_274575)• 5 years ago |

QA Contact: kinetik
You need to [log in](/show_bug.cgi?id=826104&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_9649f157_20250125_164327.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/837007)
* [XML](/show_bug.cgi?ctype=xml&id=837007)

Closed
[Bug 837007](/show_bug.cgi?id=837007)

Opened 12 years ago
Closed 12 years ago

# "ASSERTION: Out of flow frame doesn't have the expected parent" and crash with -moz-column, float

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: Out of flow frame doesn't have the expected parent" and crash with -moz-column, float

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix) |
| firefox19 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix) |
| firefox20 | [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-) | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | [-](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=-) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |
| b2g18-v1.0.0 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 |  | wontfix |
| firefox19 |  | wontfix |
| firefox20 | - | affected |
| firefox21 | - | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| b2g18-v1.0.0 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[5588](/show_bug.cgi?id=5588 "VERIFIED FIXED - Very slow in viewing JAVA 2 API docs..."), [randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)"), [765409](/show_bug.cgi?id=765409 "VERIFIED FIXED - Crash [@ nsLineLayout::ReflowFrame(nsIFrame *,unsigned int &,nsHTMLReflowMetrics *,bool &) ] | ASSERTION: unexpected flow: 'mFrames.ContainsFrame(nextInFlow)' | ASSERTION: StealFrame: can't find aChild: 'removed' | ASSERTION: StealFrame failure: 'NS_SUCCE"), [838688](/show_bug.cgi?id=838688 "RESOLVED FIXED - Improve nsBlockFrame::ReparentFloats/CollectFloats")

Dependency [tree](/showdependencytree.cgi?id=837007&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=837007)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [fuzzblocker][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-nullptr](/buglist.cgi?keywords=csectype-nullptr&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[fuzzblocker][adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | [in-testsuite](#c14 "12 years ago") | + |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [testcase](/attachment.cgi?id=708889)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   215 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=708889&action=edit) |
| --- | --- | --- |
| [stack](/attachment.cgi?id=708890)  [12 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   28.88 KB, text/plain |  | [Details](/attachment.cgi?id=708890&action=edit) |
| [frame dumps + stacks](/attachment.cgi?id=709429)  [12 years ago](#c4)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   33.96 KB, text/html |  | [Details](/attachment.cgi?id=709429&action=edit) |
| [fix](/attachment.cgi?id=709741)  [12 years ago](#c5)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   5.81 KB, patch |  | [Details](/attachment.cgi?id=709741&action=edit) | [Diff](/attachment.cgi?id=709741&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837007&attachment=709741) |
| [fix, v2](/attachment.cgi?id=710744)  [12 years ago](#c10)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   5.88 KB, patch | roc : [review+](#a506031_5038 "12 years ago") | [Details](/attachment.cgi?id=710744&action=edit) | [Diff](/attachment.cgi?id=710744&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837007&attachment=710744) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=837007#c0)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=708889)
— [Details](attachment.cgi?id=708889&action=edit)

###!!! ASSERTION: Out of flow frame doesn't have the expected parent: 'outOfFlowFrame->GetParent() == this', file layout/generic/nsBlockFrame.cpp, line 6898
###!!! ASSERTION: Broken frame linkage: 'prevSibling && prevSibling->GetNextSibling() == aFrame', file layout/generic/nsFrameList.cpp, line 95
###!!! ASSERTION: Creating a circular frame list, this is very bad.: 'this != aNextSibling', file layout/generic/nsIFrame.h, line 1133
[@ nsFrameList::RemoveFrame]

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=837007#c1)• 12 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=708890)
— [Details](attachment.cgi?id=708890&action=edit)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=837007#c2)• 12 years ago |
|  | |

Regression window: 2012-09-07-03-05-54 -- 2012-09-08-03-05-56
<http://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?fromchange=36427d4b2cf6&tochange=1d4fc0c60063>
Prime suspect: [bug 765409](/show_bug.cgi?id=765409 "VERIFIED FIXED - Crash [@ nsLineLayout::ReflowFrame(nsIFrame *,unsigned int &,nsHTMLReflowMetrics *,bool &) ] | ASSERTION: unexpected flow: 'mFrames.ContainsFrame(nextInFlow)' | ASSERTION: StealFrame: can't find aChild: 'removed' | ASSERTION: StealFrame failure: 'NS_SUCCE")Assignee: nobody → matspalKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)OS: Mac OS X → AllHardware: x86\_64 → All

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=837007#c3)• 12 years ago |
|  | |

I should have used the mozilla-central tree for the link:
<http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=36427d4b2cf6&tochange=1d4fc0c60063>
Still the same prime suspect though.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837007#a164312_5168)• 12 years ago |

Blocks: [765409](/show_bug.cgi?id=765409 "VERIFIED FIXED - Crash [@ nsLineLayout::ReflowFrame(nsIFrame *,unsigned int &,nsHTMLReflowMetrics *,bool &) ] | ASSERTION: unexpected flow: 'mFrames.ContainsFrame(nextInFlow)' | ASSERTION: StealFrame: can't find aChild: 'removed' | ASSERTION: StealFrame failure: 'NS_SUCCE")
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-b2g18-v1.0.0](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=affected)
[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=affected)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)
[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F)
[tracking-firefox19](/buglist.cgi?f1=cf_tracking_firefox19&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=%3F)
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F)Keywords: [csec-nullptr](/buglist.cgi?keywords=csec-nullptr&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=837007#c4)• 12 years ago |
|  | |

Attached file
[frame dumps + stacks](attachment.cgi?id=709429)
— [Details](attachment.cgi?id=709429&action=edit)

Step 1: Reflow the inline 0x7fffe1f70450 (lime)
=> pushing the (placeholder) child 0x7fffe1f70800 (blue)
Step 2: Reflow the next-in-flow 0x7fffe1f71f58
it picks up the pushed frames, puts it in mFrames,
assigns irs.mSetParentPointer = true.
We reflow (and reparent) the first child (0x7fffe1f71ee0)
but not the placeholder, which is pushed again.
Step 3:
The containing block 0x7fffe1fd3868 (magenta) decides to push the line
(cyan) containing the inline with the placeholder to its next-in-flow
block 0x7fffd07411b8 (yellow). PushLines() collects the floats for
those lines and reparents them and insert them into the next-in-flow.
Step 4: Reflow the inline 0x7fffe1f71f58
It detects the overflow list and decides to reparent the frames:
<http://hg.mozilla.org/mozilla-central/annotate/be76182b91a6/layout/generic/nsInlineFrame.cpp#l358>
since the 'lineContainer' (yellow) has a prev-in-flow we also reparent
any associated floats (ReparentFloatsForInlineChild) but it expects
any float to still be on the prev-in-flow (but PushLines() already
moved them) so we crash here:
<http://hg.mozilla.org/mozilla-central/annotate/be76182b91a6/layout/generic/nsBlockFrame.cpp#l6893>

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=837007#c5)• 12 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=709741&action=diff) (obsolete)
— [Details](attachment.cgi?id=709741&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837007&attachment=709741)

Make ReflowFrames reparent all child frames when lazy reparenting,
also those on the overflow list.
I'm tempted to remove this whole lazy reparenting optimization
altogether, but let's consider that in a follow-up bug.
Green on Try: <https://tbpl.mozilla.org/?tree=Try&rev=59f54a3a3c76>
Also tested [bug 765409](/show_bug.cgi?id=765409 "VERIFIED FIXED - Crash [@ nsLineLayout::ReflowFrame(nsIFrame *,unsigned int &,nsHTMLReflowMetrics *,bool &) ] | ASSERTION: unexpected flow: 'mFrames.ContainsFrame(nextInFlow)' | ASSERTION: StealFrame: can't find aChild: 'removed' | ASSERTION: StealFrame failure: 'NS_SUCCE").
[Attachment #709741](/attachment.cgi?id=709741&action=edit "fix") -
Flags: review?(roc)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837007#a325472_11608)• 12 years ago |

Whiteboard: [fuzzblocker]

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=837007#c6)• 12 years ago |
|  | |

Doesn't this kind of break lazy reparenting?
The issue is if we have something like
<p><em><b>Hello</b> <b>Hello</b> <b>Hello</b> <b>Hello</b> ... <b>Hello</b>
Say there are N <b> elements and each one ends up on its own line. Then without lazy reparenting, when we reflow the <em> frame at line K, we will have to reparent N - K <b> frames to the current frame. This makes reflowing this paragraph O(N^2) in the number of lines. That's really bad.
With your patch here, it seems to me the first line will reflow OK, then on the second line we'll reparent \*everything\* to the second line. Or am I missing something?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=837007#c7)• 12 years ago |
|  | |

(In reply to Mats Palmgren [:mats] from [comment #3](/show_bug.cgi?id=837007#c3 "RESOLVED FIXED - \"ASSERTION: Out of flow frame doesn't have the expected parent\" and crash with -moz-column, float"))
> I should have used the mozilla-central tree for the link:
> <http://hg.mozilla.org/mozilla-central/>
> pushloghtml?fromchange=36427d4b2cf6&tochange=1d4fc0c60063
> Still the same prime suspect though.
To set expectations here, it's unlikely that we'll take a fix for this in our final beta. If there's any reason to have more urgency around this fix, please do provide context.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=837007#c8)• 12 years ago |
|  | |

(also any context around why this should track at all would be great)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=837007#c9)• 12 years ago |
|  | |

(In reply to Alex Keybl [:akeybl] from [comment #8](/show_bug.cgi?id=837007#c8 "RESOLVED FIXED - \"ASSERTION: Out of flow frame doesn't have the expected parent\" and crash with -moz-column, float"))
> (also any context around why this should track at all would be great)
The crashes I've seen we're accessing a null-pointer. If there's other
variations it's very likely to be covered by frame poisoning so I guess
this fix can ride the trains, possibly adding it to Aurora if the risk
is low.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-b2g18-v1.0.0](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix)
[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)
[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F) → ---
[tracking-firefox19](/buglist.cgi?f1=cf_tracking_firefox19&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=%3F) → ---

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=837007#c10)• 12 years ago |
|  | |

Attached patch

[fix, v2](attachment.cgi?id=710744&action=diff)
— [Details](attachment.cgi?id=710744&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=837007&attachment=710744)

Make CollectFloats ignore floats that isn't a child of 'this'.
This patch looks more invasive than it really is - CollectFloats already
does this for FRAME\_IS\_PUSHED\_FLOATs, I'm just extending it to all floats
and consolidating the two branches to share some code.
<https://tbpl.mozilla.org/?tree=Try&rev=8755ec711c0c>
[Attachment #709741](/attachment.cgi?id=709741&action=edit "fix") -
Attachment is obsolete: true
[Attachment #709741](/attachment.cgi?id=709741&action=edit "fix") -
Flags: review?(roc)
[Attachment #710744](/attachment.cgi?id=710744&action=edit "fix, v2") -
Flags: review?(roc)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837007#a486720_5168)• 12 years ago |

Blocks: [838688](/show_bug.cgi?id=838688 "RESOLVED FIXED - Improve nsBlockFrame::ReparentFloats/CollectFloats")

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=837007#c11)• 12 years ago |
|  | |

No need to track but will look at aurora approval nomination and take a fix if low risk.
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=-)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837007#a506031_5038)• 12 years ago |

[Attachment #710744](/attachment.cgi?id=710744&action=edit "fix, v2") -
Flags: review?(roc) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=837007#c12)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/bf8667d7004d>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=837007#c13)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/bf8667d7004d>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla21

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837007#a7767303_280903)• 12 years ago |

Whiteboard: [fuzzblocker] → [fuzzblocker][adv-main21+]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=837007#c14)• 10 years ago |
|  | |

Landed a crashtest:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/e553c9a0cc1d>Group: core-securityFlags: in-testsuite? → in-testsuite+

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=837007#c15)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e553c9a0cc1d>

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=837007#a69523021_5168)• 10 years ago |

Blocks: [5588](/show_bug.cgi?id=5588 "VERIFIED FIXED - Very slow in viewing JAVA 2 API docs...")
You need to [log in](/show_bug.cgi?id=837007&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_bae132cd_20250125_164315.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/819775)
* [XML](/show_bug.cgi?ctype=xml&id=819775)

Closed
[Bug 819775](/show_bug.cgi?id=819775)

Opened 12 years ago
Closed 12 years ago

# js\_InitRandom: Don't use pointer values in seeding the random number generator

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

js\_InitRandom: Don't use pointer values in seeding the random number generator

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Other Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr10 | --- | [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | + | fixed |
| firefox-esr10 |  | wontfix |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jorendorff, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

3 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: [js:t][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[js:t][adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=819775#c0)• 12 years ago |
|  | |

Follow-up to [bug 811355](/show_bug.cgi?id=811355 "RESOLVED FIXED - Signed integer overflow in js::random_next").
We have this code (word-wrapped for bugzilla):
> void
> js\_InitRandom(JSContext \*cx)
> {
> /\*
> \* Set the seed from current time. Since we have a RNG per context and we
> \* often bring up several contexts at the same time, we xor in some
> \* additional values, namely the context and its successor. We don't just
> \* use the context because it might be possible to reverse engineer the
> \* context pointer if one guesses the time right.
> \*/
> random\_setSeed(&cx->rngSeed,
> (PRMJ\_Now() / 1000) ^ int64\_t(cx) ^ int64\_t(cx->getNext()));
> }
cx->getNext() is always null here.
This is not exploitable by itself, but I'd be shocked if an attacker couldn't recover cx. sec-moderate.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=819775#c1)• 12 years ago |
|  | |

What to do about it? It depends on the desired behavior.
Maybe all we're trying to avoid is opening a JS demo in four windows and having the random number stream be the same in all four; that is, avoid having the non-randomness be embarrassingly obvious. If that's the case, we can use rt->nonce++ instead of int64\_t(cx).
If there is any security requirement at all, the weakest one I can think of is:
Scripts in one domain should not be able to guess the RNG seed
of a new window in another domain.
That is actually a reasonable property to consider providing. And we can file a separate bug in the clear for that, and land it, and it'll look like a general tightening-up rather than a fix for an existing issue.
(I don't know how to do it short of going to the OS for secure-random bits, at least once per runtime and more likely once per context. But that's an acceptable cost, right?)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=819775#c2)• 12 years ago |
|  | |

Aside: The random number seed should be per-global (stored in JSCompartment) rather than per-context anyway.

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=819775#c3)• 12 years ago |
|  | |

Talked it over with decoder and settled on the rt->nonce++ approach.
Patch posted in [bug 820180](/show_bug.cgi?id=820180 "RESOLVED FIXED - Isolate JS pseudorandom number generator state per compartment").

|  | [Naveed Ihsanullah [:naveed]](/user_profile?user_id=441971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=819775#a253470_441971)• 12 years ago |

Whiteboard: [js:t]

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=819775#c4)• 12 years ago |
|  | |

Fixed in [bug 820180](/show_bug.cgi?id=820180 "RESOLVED FIXED - Isolate JS pseudorandom number generator state per compartment").Status: NEW → RESOLVEDClosed: 12 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=819775#a3398375_1689)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox-esr10](/buglist.cgi?f1=cf_status_esr10&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_esr10&o1=equals&v1=wontfix)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=819775#a12380079_280903)• 12 years ago |

Whiteboard: [js:t] → [js:t][adv-main20+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=819775#a12380119_280903)• 12 years ago |

Whiteboard: [js:t][adv-main20+] → [js:t][adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=819775#a61383205_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=819775&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_9bb66bda_20250125_164323.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/826392)
* [XML](/show_bug.cgi?ctype=xml&id=826392)

Closed
[Bug 826392](/show_bug.cgi?id=826392)

Opened 12 years ago
Closed 12 years ago

# compartment checker fail in mozilla::plugins::parent::\_evaluate

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

compartment checker fail in mozilla::plugins::parent::\_evaluate

## Categories

### (Core Graveyard :: Plug-ins, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Plug-ins#Plug-ins)

Plug-ins
▾

Core Graveyard :: Plug-ins
Bugs in core Mozilla code that supports registering and using plug-ins. For bugs in specific plugins, please file those bugs under External Software Affecting Firefox.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Plug-ins&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Plug-ins)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (firefox18 wontfix, firefox19 wontfix, firefox20- wontfix, firefox21 fixed, firefox-esr17- wontfix, b2g18 wontfix, b2g18-v1.0.0 wontfix)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
INVALID

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

INVALID

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix) |
| firefox19 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix) |
| firefox20 | [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |
| b2g18-v1.0.0 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox18 |  | wontfix |
| firefox19 |  | wontfix |
| firefox20 | - | wontfix |
| firefox21 |  | fixed |
| firefox-esr17 | - | wontfix |
| b2g18 |  | wontfix |
| b2g18-v1.0.0 |  | wontfix |

## People

### (Reporter: mccr8, Assigned: mccr8)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[compartment-mismatch](/show_bug.cgi?id=821733 "RESOLVED WORKSFORME - [meta] crash in js::CompartmentChecker::fail")

Dependency [tree](/showdependencytree.cgi?id=826392&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=826392)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, sec-other, Whiteboard: [adv-main21-][fixed in 21 by 824864][probably bogus assertion])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main21-][fixed in 21 by 824864][probably bogus assertion]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=826392#c0)• 12 years ago |
|  | |

I found 3 crashes like this when searching through some crash stacks for the cross-compartment pointer checker.
0 js::CompartmentChecker::fail js/src/jscntxtinlines.h:205
1 JS\_GetStringCharsZAndLength js/src/jsapi.cpp:6055
2 JSValToNPVariant dom/plugins/base/nsJSNPRuntime.cpp:435
3 mozilla::plugins::parent::\_evaluate dom/plugins/base/nsNPAPIPlugin.cpp:1599
4 mozilla::plugins::PluginScriptableObjectParent::AnswerNPN\_Evaluate dom/plugins/ipc/PluginScriptableObjectParent.cpp:1197
5 mozilla::plugins::PPluginScriptableObjectParent::OnCallReceived obj-firefox/ipc/ipdl/PPluginScriptableObjectParent.cpp:776
6 mozilla::plugins::PPluginModuleParent::OnCallReceived obj-firefox/ipc/ipdl/PPluginModuleParent.cpp:1288
I'm not sure exactly what is going wrong, because the string comes from |scx->EvaluateStringWithValue|, where |scx| is the |GetScriptContextFromJSContext| of the context we're calling JS\_GetStringCharsZAndLength on.
<https://crash-stats.mozilla.com/report/index/b5621c05-db57-412e-bdb1-b475c2130101>
<https://crash-stats.mozilla.com/report/index/f97d5d0f-f881-4f45-b755-efad72121229>
<https://crash-stats.mozilla.com/report/index/995820a8-b2b8-40c5-b050-785ab2130101>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=826392#c1)• 12 years ago |
|  | |

<https://crash-stats.mozilla.com/report/index/aa0f7790-ad5c-431c-8996-0ea4a2130101>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=826392#c2)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #0](/show_bug.cgi?id=826392#c0 "RESOLVED INVALID - compartment checker fail in mozilla::plugins::parent::_evaluate"))
> I'm not sure exactly what is going wrong, because the string comes from
> |scx->EvaluateStringWithValue|, where |scx| is the
> |GetScriptContextFromJSContext| of the context we're calling
> JS\_GetStringCharsZAndLength on.
That doesn't mean the cx is still in that compartment. In fact, it doesn't even mean that that cx is at the top of the cx stack anymore, because EvaluteStringWithValue does both a cx push (which includes an implicit scoped JS\_SaveFrameChain/JS\_RestoreFrameChain (temporarily making us look as if we'd entered no compartment at all)), and a JSAutoEnterCompartment.
I'm refatoring this code in [bug 824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope"). But I think we probably need to enter the compartment of the returned jsval here. We might even want to push the cx, though I'm not sure about that.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=826392#c3)• 12 years ago |
|  | |

Ah, good point!Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=826392#c4)• 12 years ago |
|  | |

See also [bug 803228](/show_bug.cgi?id=803228 "RESOLVED FIXED - Assertion failure: cx->compartment->principals == options.principals") which could be related. I promised to try and brainstorm some testcases there but haven't yet :-(

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a610808_1689)• 12 years ago |

Assignee: nobody → benjaminKeywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=826392#c5)• 12 years ago |
|  | |

Here are some more crashes, now that the checker has hit Aurora:
<https://crash-stats.mozilla.com/report/index/22e086e5-29ae-4d2e-b497-777572130116>
<https://crash-stats.mozilla.com/report/index/4e143557-0b3b-4388-8467-5d84b2130116>
<https://crash-stats.mozilla.com/report/index/ae66bcf8-cea0-40c7-ab46-e8d8d2130116>
<https://crash-stats.mozilla.com/report/index/594a2e98-c1ac-45a1-8e8d-6b32c2130115>
<https://crash-stats.mozilla.com/report/index/53f67503-0d44-4b43-a03f-b2d972130115>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=826392#c6)• 12 years ago |
|  | |

bsmedberg is presumbly super busy, and I can write a patch for this, but not a test case, so I'll grab this for now.Assignee: benjamin → continuation

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=826392#c7)• 12 years ago |
|  | |

It looks like this is an old problem.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-firefox18](/buglist.cgi?f1=cf_status_firefox18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox18&o1=equals&v1=wontfix)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=826392#c8)• 12 years ago |
|  | |

Bill suggested that this might be fixed by [bug 824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope"), and indeed I haven't seen any crashes in recent Nightly builds. Unfortunately, that patch is huge, so we probably don't want to backport it everywhere.
Bill said you shouldn't enter the compartment of a string (because you can end up in the atoms compartment), so the simple solution here isn't going to work.
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a2163835_406194)• 12 years ago |

Whiteboard: [fixed in 21 by 824864?]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=826392#c9)• 12 years ago |
|  | |

Presumably we don't care about NPAPI plugins on b2g, and we're not going to get anything together in time for 19.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-b2g18-v1.0.0](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=826392#c10)• 12 years ago |
|  | |

Not sure what release management is going to want to do here. Compartment failures can theoretically be exploited, but we don't have a specific way to reproduce this particular one. The "fix" in [bug 824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope") is bigger than we'd like to back-port to ESR-17 -- might even depend on other changes between 17 and 21 in unexpected ways.
We don't need to push this into Firefox 20, it's ESR-17 where we need to make the call since Firefox 21 will contain a fix (we think).
I guess we could look for this signature on ESR-17 and see if it even happens there.
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F)Depends on: [824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope")Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=826392#c11)• 12 years ago |
|  | |

There are no crashes prior to Firefox 20
[https://crash-stats.mozilla.com/report/list?product=Firefox&query\_search=signature&query\_type=contains&query=js%3A%3ACompartmentChecker%3A%3Afail&reason\_type=contains&date=02%2F08%2F2013%2000%3A13%3A35&range\_value=2&range\_unit=weeks&hang\_type=any&process\_type=any&do\_query=1&signature=js%3A%3ACompartmentChecker%3A%3Afail%28JSCompartment\*%2C%20JSCompartment\*%29](https://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=contains&query=js%3A%3ACompartmentChecker%3A%3Afail&reason_type=contains&date=02%2F08%2F2013%2000%3A13%3A35&range_value=2&range_unit=weeks&hang_type=any&process_type=any&do_query=1&signature=js%3A%3ACompartmentChecker%3A%3Afail%28JSCompartment*%2C%20JSCompartment*%29)
But presumably the issue is there and simply not detected.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=826392#c12)• 12 years ago |
|  | |

Yes, this relies on special release mode assertions that are only enabled on Nightly and Aurora.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=826392#c13)• 12 years ago |
|  | |

Bill, is there any chance I could write a hacky string compartment entering thing that explicitly checks if it is the atoms compartment? I'm not sure what else to do here.

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=826392#c14)• 12 years ago |
|  | |

I think we just need to change EvaluateStringWithValue to wrap the result its returning in whatever the current compartment is. I think that's all the fix in [bug 824864](/show_bug.cgi?id=824864 "RESOLVED FIXED - Disentangle CompileFunction and EvaluateString{,WithValue} from the script context's active scope") is buying us here. Maybe I'm wrong though. Bobby?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=826392#c15)• 12 years ago |
|  | |

Well, there was also a fair amount of fallout from that bug. Can't we just add a call to JS\_WrapValue after the call to scx->EvaluateString?

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=826392#c16)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #15](/show_bug.cgi?id=826392#c15 "RESOLVED INVALID - compartment checker fail in mozilla::plugins::parent::_evaluate"))
> Well, there was also a fair amount of fallout from that bug. Can't we just
> add a call to JS\_WrapValue after the call to scx->EvaluateString?
Yeah, that seems fine too.

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a3383526_272375)• 12 years ago |

[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=826392#c17)• 12 years ago |
|  | |

As [comment 10](/show_bug.cgi?id=826392#c10 "RESOLVED INVALID - compartment checker fail in mozilla::plugins::parent::_evaluate") mentions, we don't need to push this to FF 20 and since we haven't any indication (in crash reports) that this is even occurring on ESR we'll wontfix there and if it shows up we can look into options for safe backporting.
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-)
[tracking-firefox-esr17](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr17&o1=equals&v1=-)

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a3626799_152868)• 12 years ago |

Whiteboard: [fixed in 21 by 824864?] → [fixed in 21 by 824864?][Reprioritize if we see ESR17 crashes]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=826392#c18)• 12 years ago |
|  | |

Well, these crashes will never show up on ESR17, because they only show up on Nightly and Aurora because of special runtime checks we added there. The suggested fix in [comment 15](/show_bug.cgi?id=826392#c15 "RESOLVED INVALID - compartment checker fail in mozilla::plugins::parent::_evaluate") is probably small enough to consider backporting, but I'll worry about that when the patch exists.Whiteboard: [fixed in 21 by 824864?][Reprioritize if we see ESR17 crashes] → [fixed in 21 by 824864]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=826392#c19)• 12 years ago |
|  | |

Bill, in one of your zones patch, you just drop the same-compartment check on JS\_GetStringCharsZAndLength, which is precisely the one we're trying to fix here. Do you think it is probably safe to not care about the compartments on all branches? If so, we can just won't fix this everywhere.
[1] <https://bugzilla.mozilla.org/page.cgi?id=splinter.html&bug=759585&attachment=714648>Flags: needinfo?(wmccloskey)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=826392#c20)• 12 years ago |
|  | |

Okay, well, it is already wontfixed everywhere, but we could rest easy knowing that it isn't really a problem anywhere...

|  | [Bill McCloskey [inactive unless it's an emergency] (:billm)](/user_profile?user_id=389993) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=826392#c21)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #19](/show_bug.cgi?id=826392#c19 "RESOLVED INVALID - compartment checker fail in mozilla::plugins::parent::_evaluate"))
> Bill, in one of your zones patch, you just drop the same-compartment check
> on JS\_GetStringCharsZAndLength, which is precisely the one we're trying to
> fix here. Do you think it is probably safe to not care about the
> compartments on all branches? If so, we can just won't fix this everywhere.
Sure.Flags: needinfo?(wmccloskey)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a3731569_406194)• 12 years ago |

Status: NEW → RESOLVEDClosed: 12 years agoKeywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---) → [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)Resolution: --- → INVALIDWhiteboard: [fixed in 21 by 824864] → [fixed in 21 by 824864][[probably bogus assertion]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a3731592_406194)• 12 years ago |

Whiteboard: [fixed in 21 by 824864][[probably bogus assertion] → [fixed in 21 by 824864][probably bogus assertion]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a10124895_280903)• 12 years ago |

Whiteboard: [fixed in 21 by 824864][probably bogus assertion] → [adv-main21-][fixed in 21 by 824864][probably bogus assertion]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a28965269_1689)• 11 years ago |

Group: core-security

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=826392#a295488995_546015)• 3 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=826392&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_e3c697a7_20250125_164333.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/855236)
* [XML](/show_bug.cgi?ctype=xml&id=855236)

Closed
[Bug 855236](/show_bug.cgi?id=855236)

Opened 12 years ago
Closed 12 years ago

# Crash with SIGTRAP

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash with SIGTRAP

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla23

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=verified) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | [21+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=21%2B) | [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed) |
| b2g18-v1.0.0 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix) |
| b2g18-v1.0.1 | --- | [affected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=affected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | affected |
| firefox21 | + | fixed |
| firefox22 | + | fixed |
| firefox23 | + | verified |
| firefox-esr17 |  | unaffected |
| b2g18 | 21+ | fixed |
| b2g18-v1.0.0 |  | wontfix |
| b2g18-v1.0.1 |  | affected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: jandem)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [jsbugmon:update,ignore][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:update,ignore][adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#a2265912_75935 "12 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Patch](/attachment.cgi?id=736247)  [12 years ago](#c12)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   1.19 KB, patch | bhackett1024 : [review+](#a1464190_346231 "12 years ago")  bajaj : [approval-mozilla-aurora+](#c21 "12 years ago")  bajaj : [approval-mozilla-beta+](#c21 "12 years ago")  bajaj : [approval-mozilla-b2g18+](#a2454179_448925 "12 years ago")  abillings : [sec-approval+](#a1779394_280903 "12 years ago") | [Details](/attachment.cgi?id=736247&action=edit) | [Diff](/attachment.cgi?id=736247&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=855236&attachment=736247) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=855236#c0)• 12 years ago |
|  | |

mjitChunkLimit(11);
options('strict');
function h(...d) {};
eval("\
toSource = function () {\
x = 0;\
return function() {\
++x;\
if (x % 4) {\
this[0] = 1;\
this.h();\
}\
};\
}();\
");
Object.preventExtensions(this);
g = function() {}
eval("function f(){}");
crashes js debug shell on m-c changeset 178a4a770bb1 with --no-ion -a at SIGTRAP.
During the course of reduction I had to alter the mjitChunkLimit value as needed to keep crashing with smaller testcases.
Program received signal SIGTRAP, Trace/breakpoint trap.
0x009b3e80 in ?? ()
gdb $ bt
#0 0x009b3e80 in ?? ()
#1 0x00b3cd40 in ?? ()
Previous frame inner to this frame (gdb could not unwind past this frame)
gdb $

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a6913_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,bisect] → [jsbugmon:update]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=855236#c1)• 12 years ago |
|  | |

JSBugMon: Bisection requested, result:
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 106754:a26469331bf9
user: Brian Hackett
date: Thu Aug 30 14:44:15 2012 -0600
summary: Re-enable JM inlining when IonMonkey is disabled, [bug 786925](/show_bug.cgi?id=786925 "RESOLVED FIXED - IonMonkey: Re-enable JM inlining when IonMonkey is disabled"). r=dvander
This iteration took 123.879 seconds to run.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=855236#c2)• 12 years ago |
|  | |

Needinfo from Brian based on [comment 1](/show_bug.cgi?id=855236#c1 "VERIFIED FIXED - Crash with SIGTRAP") :)Flags: needinfo?(bhackett1024)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=855236#c3)• 12 years ago |
|  | |

Also marking s-s since a SIGTRAP could indicate an invalid jump.Group: core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=855236#c4)• 12 years ago |
|  | |

Does the BaselineCompiler change/fix this code? Or is it still a problem?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a638503_395101)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:update,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=855236#c5)• 12 years ago |
|  | |

JSBugMon: The testcase found in this bug no longer reproduces (tried revision b5cb88ccd907).

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=855236#c6)• 12 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #4](/show_bug.cgi?id=855236#c4 "VERIFIED FIXED - Crash with SIGTRAP"))
> Does the BaselineCompiler change/fix this code? Or is it still a problem?
BaselineCompiler does fix this, specifically m-c changeset e34e126f817e. The following date shown is inaccurate, as BaselineCompiler just landed this morning.
autoBisect shows this is probably related to the following changeset:
The first good revision is:
changeset: 127151:e34e126f817e
user: Jan de Mooij
date: Mon Dec 17 10:55:02 2012 +0100
summary: [Bug 821315](/show_bug.cgi?id=821315 "RESOLVED FIXED - BaselineCompiler: Compile BINDGNAME and SETGNAME") - Compile BINDGNAME, SETPROP, SETGNAME, SETNAME. r=djvj
(The supposed regressing changeset a26469331bf9 landed on all branches except ESR 17)
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-b2g18-v1.0.0](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=wontfix)
[status-b2g18-v1.0.1](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a649043_132034)• 12 years ago |

Status: NEW → RESOLVEDClosed: 12 years agoResolution: --- → FIXED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a651765_395101)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=855236#c7)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=855236#c8)• 12 years ago |
|  | |

Can we get a security rating on this ?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=855236#c9)• 12 years ago |
|  | |

(In reply to bhavana bajaj [:bajaj] from [comment #8](/show_bug.cgi?id=855236#c8 "VERIFIED FIXED - Crash with SIGTRAP"))
> Can we get a security rating on this ?
Still holding to understand this.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=855236#c10)• 12 years ago |
|  | |

I just discussed this with nbp and he mentions that a SIGTRAP crash is likely to be deliberately caused by our engine, and it is likely to be a safe crash.
Perhaps jandem can double-confirm here?Flags: needinfo?(bhackett1024) → needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=855236#c11)• 12 years ago |
|  | |

(In reply to Gary Kwong [:gkw] [:nth10sd] from [comment #10](/show_bug.cgi?id=855236#c10 "VERIFIED FIXED - Crash with SIGTRAP"))
> I just discussed this with nbp and he mentions that a SIGTRAP crash is
> likely to be deliberately caused by our engine, and it is likely to be a
> safe crash.
>
> Perhaps jandem can double-confirm here?
In many cases it is, but here the SIGTRAP is in freed memory. Patch coming up.Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=855236#c12)• 12 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=736247&action=diff)
— [Details](attachment.cgi?id=736247&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=855236&attachment=736247)

If a script has multiple chunks, and we hit an abort while compiling one of them (in this case because we are trying to inline an uncompilable script), we will release all script code. However, if another chunk's code is still on the stack, we will return to freed memory. The patch calls mjit::Recompiler::clearStackReferences before releasing the code.Assignee: general → jdemooijStatus: VERIFIED → REOPENED
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: review?(bhackett1024)Resolution: FIXED → ---

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a1318132_406194)• 12 years ago |

Keywords: [csec-uaf](/buglist.cgi?keywords=csec-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a1320796_448925)• 12 years ago |

[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F) → [21+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=21%2B)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a1464190_346231)• 12 years ago |

[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: review?(bhackett1024) → review+

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=855236#c13)• 12 years ago |
|  | |

Comment on [attachment 736247](/attachment.cgi?id=736247 "Patch") [[details]](/attachment.cgi?id=736247&action=edit "Patch") [[diff]](/attachment.cgi?id=736247&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=855236&attachment=736247)
Patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Not easy, especially not in versions with IonMonkey enabled. But with some work it's probably possible somehow.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
No.
Which older supported branches are affected by this flaw?
Firefox 9-22 (JM is disabled in 23.)
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Patch is simple, should apply to older branches.
How likely is this patch to cause regressions; how much testing does it need?
Unlikely to cause regressions.
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a1779394_280903)• 12 years ago |

[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=855236#c14)• 12 years ago |
|  | |

You'll need to nominate the patch for branches.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=855236#c15)• 12 years ago |
|  | |

This looks ready for landing.Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=855236#c16)• 12 years ago |
|  | |

(In reply to Gary Kwong [:gkw] [:nth10sd] from [comment #15](/show_bug.cgi?id=855236#c15 "VERIFIED FIXED - Crash with SIGTRAP"))
> This looks ready for landing.
Thanks Gary, I will push this today or tomorrow. Not clearing needinfo? flag so that I won't forget about it.Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a2013520_375297)• 12 years ago |

Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=855236#c17)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/f74d1d6771ff>Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=855236#c18)• 12 years ago |
|  | |

Comment on [attachment 736247](/attachment.cgi?id=736247 "Patch") [[details]](/attachment.cgi?id=736247&action=edit "Patch") [[diff]](/attachment.cgi?id=736247&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=855236&attachment=736247)
Patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): JM
User impact if declined: Security bug, crashes.
Testing completed (on m-c, etc.): On m-i.
Risk to taking this patch (and alternatives if risky): Low.
String or IDL/UUID changes made by this patch: None.
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-beta?
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-aurora?

|  | [Phil Ringnalda (:philor)](/user_profile?user_id=135518) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=855236#c19)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/f74d1d6771ff>Status: REOPENED → RESOLVEDClosed: 12 years ago → 12 years agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a2265912_75935)• 12 years ago |

Flags: in-testsuite?Target Milestone: --- → mozilla23

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a2266050_395101)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=855236#c20)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=855236#c21)• 12 years ago |
|  | |

Comment on [attachment 736247](/attachment.cgi?id=736247 "Patch") [[details]](/attachment.cgi?id=736247&action=edit "Patch") [[diff]](/attachment.cgi?id=736247&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=855236&attachment=736247)
Patch
low risk, sec-crit crash regression. Approving on branches.
Can you please prepare the b2g patch needed here and nominate for approval-mozilla-b2g18 : ? Thanks !
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-beta?
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-beta+
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-aurora?
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-aurora+

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=855236#c22)• 12 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #17](/show_bug.cgi?id=855236#c17 "VERIFIED FIXED - Crash with SIGTRAP"))
> <https://hg.mozilla.org/integration/mozilla-inbound/rev/f74d1d6771ff>
Please make sure to land the mozilla-beta patch by tomorrow morning PT as we are targeting beta 4 go-to-build around noon PT.Thank you.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a2276697_132034)• 12 years ago |

Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=855236#c23)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/f98c5b7415c6>
<https://hg.mozilla.org/releases/mozilla-beta/rev/fc0b144921d0>
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed)Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=855236#c24)• 12 years ago |
|  | |

Comment on [attachment 736247](/attachment.cgi?id=736247 "Patch") [[details]](/attachment.cgi?id=736247&action=edit "Patch") [[diff]](/attachment.cgi?id=736247&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=855236&attachment=736247)
Patch
NOTE: Please see <https://wiki.mozilla.org/Release_Management/B2G_Landing> to better understand the B2G approval process and landings.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): JM
User impact if declined: Security bugs, crashes
Testing completed: On m-c, aurora/beta branches
Risk to taking this patch (and alternatives if risky): Low
String or UUID changes made by this patch: None
[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-b2g18?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a2454179_448925)• 12 years ago |

[Attachment #736247](/attachment.cgi?id=736247&action=edit "Patch") -
Flags: approval-mozilla-b2g18? → approval-mozilla-b2g18+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=855236#c25)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g18/rev/db887846d6fb>
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=855236#c26)• 12 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #25](/show_bug.cgi?id=855236#c25 "VERIFIED FIXED - Crash with SIGTRAP"))
> <https://hg.mozilla.org/releases/mozilla-b2g18/rev/db887846d6fb>
Kinda overlooked the whole b2g18 not having zones thing, though. :fail:
<https://hg.mozilla.org/releases/mozilla-b2g18/rev/bc27f5a366b5>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a2989744_280903)• 12 years ago |

Whiteboard: [jsbugmon:update,ignore] → [jsbugmon:update,ignore][adv-main21+]

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=855236#c27)• 12 years ago |
|  | |

Marking status-firefox23:verified based on [comment 20](/show_bug.cgi?id=855236#c20 "VERIFIED FIXED - Crash with SIGTRAP").
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855236#a21048026_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=855236&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.ubuntu.com_5d06d2e7_20250125_164309.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-1822-1: Firefox vulnerabilities

14 May 2013

Firefox could be made to crash or run programs as your login if it
opened a malicious website.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 13.04](/security/notices?release=raring)
* [Ubuntu 12.10](/security/notices?release=quantal)
* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [firefox](/security/cves?package=firefox) - Mozilla Open Source web browser

## Details

Multiple memory safety issues were discovered in Firefox. If the user were

tricked into opening a specially crafted page, an attacker could possibly

exploit these to cause a denial of service via application crash, or

potentially execute code with the privileges of the user invoking Firefox.

([CVE-2013-0801](/security/CVE-2013-0801), [CVE-2013-1669](/security/CVE-2013-1669))

Cody Crews discovered that some constructors could be used to bypass

restrictions enforced by their Chrome Object Wrapper (COW). An attacker

could exploit this to conduct cross-site scripting (XSS) attacks.

([CVE-2013-1670](/security/CVE-2013-1670))

It was discovered that the file input element could expose the full local

path under certain conditions. An attacker could potentially exploit this

to steal sensitive information. ([CVE-2013-1671](/security/CVE-2013-1671))

A use-after-free was discovered when resizing video content whilst it is

playing. An attacker could potentially exploit this to execute code with

the privileges of the user invoking Firefox. ([CVE-2013-1674](/security/CVE-2013-1674))

It was discovered that some DOMSVGZoomEvent functions could be used

without being properly initialized, which could lead to information

leakage. ([CVE-2013-1675](/security/CVE-2013-1675))

Abhishek Arya discovered multiple memory safety issues in Firefox. If

the user were tricked into opening a specially crafted page, an attacker

could possibly exploit these to cause a denial of service via application

crash, or potentially execute code with the privileges of the user

invoking Firefox. ([CVE-2013-1676](/security/CVE-2013-1676), [CVE-2013-1677](/security/CVE-2013-1677), [CVE-2013-1678](/security/CVE-2013-1678),

[CVE-2013-1679](/security/CVE-2013-1679), [CVE-2013-1680](/security/CVE-2013-1680), [CVE-2013-1681](/security/CVE-2013-1681))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 13.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [21.0+build2-0ubuntu0.13.04.2](https://launchpad.net/ubuntu/%2Bsource/firefox/21.0%2Bbuild2-0ubuntu0.13.04.2)

##### Ubuntu 12.10

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [21.0+build2-0ubuntu0.12.10.2](https://launchpad.net/ubuntu/%2Bsource/firefox/21.0%2Bbuild2-0ubuntu0.12.10.2)

##### Ubuntu 12.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [21.0+build2-0ubuntu0.12.04.3](https://launchpad.net/ubuntu/%2Bsource/firefox/21.0%2Bbuild2-0ubuntu0.12.04.3)

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* [CVE-2013-0801](/security/CVE-2013-0801)
* [CVE-2013-1669](/security/CVE-2013-1669)
* [CVE-2013-1670](/security/CVE-2013-1670)
* [CVE-2013-1671](/security/CVE-2013-1671)
* [CVE-2013-1674](/security/CVE-2013-1674)
* [CVE-2013-1675](/security/CVE-2013-1675)
* [CVE-2013-1676](/security/CVE-2013-1676)
* [CVE-2013-1677](/security/CVE-2013-1677)
* [CVE-2013-1678](/security/CVE-2013-1678)
* [CVE-2013-1679](/security/CVE-2013-1679)
* [CVE-2013-1680](/security/CVE-2013-1680)
* [CVE-2013-1681](/security/CVE-2013-1681)
* <https://launchpad.net/bugs/1178277>

## Related notices

* [USN-1823-1](/security/notices/USN-1823-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from blog.mozilla.org_a1905f2a_20250126_102115.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_a473d88f_20250125_164325.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/834526)
* [XML](/show_bug.cgi?ctype=xml&id=834526)

Closed
[Bug 834526](/show_bug.cgi?id=834526)

Opened 12 years ago
Closed 12 years ago

# IPC Channel uses debug-only check for number of FDs in a single message, could overwrite stack

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

IPC Channel uses debug-only check for number of FDs in a single message, could overwrite stack

## Categories

### (Core :: IPC, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=IPC#IPC)

IPC
▾

Core :: IPC
Core inter-process communication and IPDL system for communicating with and isolating sub-processes. Please file plugin-specific IPC bugs in Core: Plug-Ins and content-specific IPC bugs in Core: DOM: Content Processes.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=IPC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=IPC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=IPC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox19 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix) |
| firefox20 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox19 |  | wontfix |
| firefox20 |  | wontfix |
| firefox21 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bent.mozilla, Assigned: bent.mozilla)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a1dc08fda91b2717842f4b1903da2881?d=mm&size=40)  [bent.mozilla](/user_profile?user_id=200444)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a1dc08fda91b2717842f4b1903da2881?d=mm&size=40)  [bent.mozilla](/user_profile?user_id=200444)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

3 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-critical, Whiteboard: [adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Patch, v1](/attachment.cgi?id=706173)  [12 years ago](#c0)  [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)   1.11 KB, patch | cjones : [review+](#c1 "12 years ago")  cjones : [approval-mozilla-b2g18+](#c2 "12 years ago") | [Details](/attachment.cgi?id=706173&action=edit) | [Diff](/attachment.cgi?id=706173&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=834526&attachment=706173) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=834526#c0)• 12 years ago |
|  | |

Attached patch

[Patch, v1](attachment.cgi?id=706173&action=diff)
— [Details](attachment.cgi?id=706173&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=834526&attachment=706173)

IPC Channel uses a debug-only check for number of FDs that may be transmitted in a single message. That's currently |FileDescriptorSet::MAX\_DESCRIPTORS\_PER\_MESSAGE| (currently 4 in our code, 5 in chromium tip). It uses this to allocate some stack space, and if we exceed this limit then we will overwrite the stack.
[Attachment #706173](/attachment.cgi?id=706173&action=edit "Patch, v1") -
Flags: review?(jones.chris.g)

|  | [Chris Jones [:cjones] inactive; ni?/f?/r? if you need me](/user_profile?user_id=336288) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=834526#c1)• 12 years ago |
|  | |

Comment on [attachment 706173](/attachment.cgi?id=706173 "Patch, v1") [[details]](/attachment.cgi?id=706173&action=edit "Patch, v1") [[diff]](/attachment.cgi?id=706173&action=diff "Patch, v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=834526&attachment=706173)
Patch, v1
Add a note that the return isn't reached.
[Attachment #706173](/attachment.cgi?id=706173&action=edit "Patch, v1") -
Flags: review?(jones.chris.g) → review+

|  | [Chris Jones [:cjones] inactive; ni?/f?/r? if you need me](/user_profile?user_id=336288) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=834526#c2)• 12 years ago |
|  | |

Comment on [attachment 706173](/attachment.cgi?id=706173 "Patch, v1") [[details]](/attachment.cgi?id=706173&action=edit "Patch, v1") [[diff]](/attachment.cgi?id=706173&action=diff "Patch, v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=834526&attachment=706173)
Patch, v1
This shouldn't happen in current code, but if content can somehow force the b2g process to hit this path, then we'll overflow a stack buffer in an sg:crit way. This check prevents that path from being reached.
[Attachment #706173](/attachment.cgi?id=706173&action=edit "Patch, v1") -
Flags: approval-mozilla-b2g18+

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=834526#c3)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/4b48effcf696>
<https://hg.mozilla.org/releases/mozilla-b2g18/rev/fb2bb1320ac7>

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=834526#a1371_200444)• 12 years ago |

Status: NEW → RESOLVEDClosed: 12 years ago
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=834526#c4)• 12 years ago |
|  | |

Can we get a security rating on this issue?
I assume this only affects trunk and no previous versions?

|  | [Chris Jones [:cjones] inactive; ni?/f?/r? if you need me](/user_profile?user_id=336288) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=834526#c5)• 12 years ago |
|  | |

If it were triggered, the vulnerability here would be sec-critical.
However, to the best of our knowledge it can't be triggered in current code.
The buggy code exists in gecko19 and gecko20 but all clients of IPC are fully trusted. So I don't think we need to uplift the patch there, although there's no risk in doing so.Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=834526#c6)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/4b48effcf696>
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Target Milestone: --- → mozilla21

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=834526#a603743_1689)• 12 years ago |

[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=834526#a603761_1689)• 12 years ago |

[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=834526#a8288590_280903)• 12 years ago |

Whiteboard: [adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=834526#a26350477_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=834526&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from lists.opensuse.org_3f263af8_20250125_164307.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/XKW4YUINN44KB4HKBVKPMJPB7DOFYP55/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/XKW4YUINN44KB4HKBVKPMJPB7DOFYP55/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/XKW4YUINN44KB4HKBVKPMJPB7DOFYP55/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/XKW4YUINN44KB4HKBVKPMJPB7DOFYP55/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/XKW4YUINN44KB4HKBVKPMJPB7DOFYP55/#XKW4YUINN44KB4HKBVKPMJPB7DOFYP55)

# [security-announce] openSUSE-SU-2013:0946-1: important: MozillaFirefox: update to version 21.0

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

10 Jun
2013

10 Jun
'13

16:13

openSUSE Security Update: MozillaFirefox: update to version 21.0
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:0946-1
Rating: important
References: #801121 #814101 #819204
Cross-References: CVE-2013-0801 CVE-2013-1669 CVE-2013-1670
CVE-2013-1671 CVE-2013-1674 CVE-2013-1675
CVE-2013-1676 CVE-2013-1677 CVE-2013-1678
CVE-2013-1679 CVE-2013-1680 CVE-2013-1681
Affected Products:
openSUSE 12.3
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 12 vulnerabilities is now available.
Description:
MozillaFirefox was updated to Firefox 21.0 (bnc#819204)
\* MFSA 2013-41/CVE-2013-0801/CVE-2013-1669 Miscellaneous
memory safety hazards
\* MFSA 2013-42/CVE-2013-1670 (bmo#853709) Privileged access
for content level constructor
\* MFSA 2013-43/CVE-2013-1671 (bmo#842255) File input
control has access to full path
\* MFSA 2013-46/CVE-2013-1674 (bmo#860971) Use-after-free
with video and onresize event
\* MFSA 2013-47/CVE-2013-1675 (bmo#866825) Uninitialized
functions in DOMSVGZoomEvent
\* MFSA 2013-48/CVE-2013-1676/CVE-2013-1677/CVE-2013-1678/
CVE-2013-1679/CVE-2013-1680/CVE-2013-1681 Memory
corruption found using Address Sanitizer
Changes in MozillaFirefox-branding-openSUSE:
- modified file locations for Firefox 21 and above
- added DuckDuckGo as search option (bnc#801121)
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.3:
zypper in -t patch openSUSE-2013-438
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.3 (i586 x86\_64):
MozillaFirefox-21.0-1.18.1
MozillaFirefox-branding-openSUSE-21-2.5.1
MozillaFirefox-branding-upstream-21.0-1.18.1
MozillaFirefox-buildsymbols-21.0-1.18.1
MozillaFirefox-debuginfo-21.0-1.18.1
MozillaFirefox-debugsource-21.0-1.18.1
MozillaFirefox-devel-21.0-1.18.1
MozillaFirefox-translations-common-21.0-1.18.1
MozillaFirefox-translations-other-21.0-1.18.1
mozilla-nspr-4.9.6-1.7.1
mozilla-nspr-debuginfo-4.9.6-1.7.1
mozilla-nspr-debugsource-4.9.6-1.7.1
mozilla-nspr-devel-4.9.6-1.7.1
- openSUSE 12.3 (x86\_64):
mozilla-nspr-32bit-4.9.6-1.7.1
mozilla-nspr-debuginfo-32bit-4.9.6-1.7.1
References:
<http://support.novell.com/security/cve/CVE-2013-0801.html>
<http://support.novell.com/security/cve/CVE-2013-1669.html>
<http://support.novell.com/security/cve/CVE-2013-1670.html>
<http://support.novell.com/security/cve/CVE-2013-1671.html>
<http://support.novell.com/security/cve/CVE-2013-1674.html>
<http://support.novell.com/security/cve/CVE-2013-1675.html>
<http://support.novell.com/security/cve/CVE-2013-1676.html>
<http://support.novell.com/security/cve/CVE-2013-1677.html>
<http://support.novell.com/security/cve/CVE-2013-1678.html>
<http://support.novell.com/security/cve/CVE-2013-1679.html>
<http://support.novell.com/security/cve/CVE-2013-1680.html>
<http://support.novell.com/security/cve/CVE-2013-1681.html>
<https://bugzilla.novell.com/801121>
<https://bugzilla.novell.com/814101>
<https://bugzilla.novell.com/819204>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/XKW4YUINN44KB4HKBVKPMJPB7DOFYP55/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/XKW4YUINN44KB4HKBVKPMJPB7DOFYP55/#XKW4YUINN44KB4HKBVKPMJPB7DOFYP55)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from lists.opensuse.org_10c81223_20250125_164305.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/PAW6EP7LI576HGNFENYNO5ABG3O262VM/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/PAW6EP7LI576HGNFENYNO5ABG3O262VM/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/PAW6EP7LI576HGNFENYNO5ABG3O262VM/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/PAW6EP7LI576HGNFENYNO5ABG3O262VM/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/PAW6EP7LI576HGNFENYNO5ABG3O262VM/#PAW6EP7LI576HGNFENYNO5ABG3O262VM)

# [security-announce] openSUSE-SU-2013:0929-1: important: xulrunner to 17.0.6esr

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

10 Jun
2013

10 Jun
'13

16:05

openSUSE Security Update: xulrunner to 17.0.6esr
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:0929-1
Rating: important
References: #819204
Cross-References: CVE-2013-0801 CVE-2013-1669 CVE-2013-1670
CVE-2013-1674 CVE-2013-1675 CVE-2013-1676
CVE-2013-1677 CVE-2013-1678 CVE-2013-1679
CVE-2013-1680 CVE-2013-1681
Affected Products:
openSUSE 12.3
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 11 vulnerabilities is now available.
Description:
Mozilla xulrunner was updated to 17.0.6esr (bnc#819204)
\* MFSA 2013-41/CVE-2013-0801/CVE-2013-1669 Miscellaneous
memory safety hazards
\* MFSA 2013-42/CVE-2013-1670 (bmo#853709) Privileged
access for content level constructor
\* MFSA 2013-46/CVE-2013-1674 (bmo#860971) Use-after-free
with video and onresize event
\* MFSA 2013-47/CVE-2013-1675 (bmo#866825) Uninitialized
functions in DOMSVGZoomEvent
\* MFSA 2013-48/CVE-2013-1676/CVE-2013-1677/CVE-2013-1678/
CVE-2013-1679/CVE-2013-1680/CVE-2013-1681 Memory
corruption found using Address Sanitizer
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.3:
zypper in -t patch openSUSE-2013-448
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.3 (i586 x86\_64):
mozilla-js-17.0.6-1.12.1
mozilla-js-debuginfo-17.0.6-1.12.1
xulrunner-17.0.6-1.12.1
xulrunner-buildsymbols-17.0.6-1.12.1
xulrunner-debuginfo-17.0.6-1.12.1
xulrunner-debugsource-17.0.6-1.12.1
xulrunner-devel-17.0.6-1.12.1
xulrunner-devel-debuginfo-17.0.6-1.12.1
- openSUSE 12.3 (x86\_64):
mozilla-js-32bit-17.0.6-1.12.1
mozilla-js-debuginfo-32bit-17.0.6-1.12.1
xulrunner-32bit-17.0.6-1.12.1
xulrunner-debuginfo-32bit-17.0.6-1.12.1
References:
<http://support.novell.com/security/cve/CVE-2013-0801.html>
<http://support.novell.com/security/cve/CVE-2013-1669.html>
<http://support.novell.com/security/cve/CVE-2013-1670.html>
<http://support.novell.com/security/cve/CVE-2013-1674.html>
<http://support.novell.com/security/cve/CVE-2013-1675.html>
<http://support.novell.com/security/cve/CVE-2013-1676.html>
<http://support.novell.com/security/cve/CVE-2013-1677.html>
<http://support.novell.com/security/cve/CVE-2013-1678.html>
<http://support.novell.com/security/cve/CVE-2013-1679.html>
<http://support.novell.com/security/cve/CVE-2013-1680.html>
<http://support.novell.com/security/cve/CVE-2013-1681.html>
<https://bugzilla.novell.com/819204>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/PAW6EP7LI576HGNFENYNO5ABG3O262VM/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/PAW6EP7LI576HGNFENYNO5ABG3O262VM/#PAW6EP7LI576HGNFENYNO5ABG3O262VM)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_9d4fc014_20250125_164331.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/854001)
* [XML](/show_bug.cgi?ctype=xml&id=854001)

Closed
[Bug 854001](/show_bug.cgi?id=854001)

Opened 12 years ago
Closed 12 years ago

# crash in mozilla::dom::InstanceClassHasProtoAtDepth

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

crash in mozilla::dom::InstanceClassHasProtoAtDepth

## Categories

### (Core :: DOM: Workers, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Workers#DOM%3A%20Workers)

DOM: Workers
▾

Core :: DOM: Workers
This component covers the [Web Workers](https://developer.mozilla.org/En/DOM/Worker) implementation in Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Workers)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla22

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | - | wontfix |
| firefox21 | + | fixed |
| firefox22 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: MatsPalmgren\_bugz, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

### ( [URL](http://people.mozilla.com/~bgirard/cleopatra/#report=1ca3b3891f7a4fbd265d3addf0a759a6be857044 "http://people.mozilla.com/~bgirard/cleopatra/#report=1ca3b3891f7a4fbd265d3addf0a759a6be857044") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[742193](/show_bug.cgi?id=742193 "RESOLVED FIXED - Stop using DOMJSClass for worker proto objects")

Dependency [tree](/showdependencytree.cgi?id=854001&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=854001)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[people.mozilla.com/~bgirard/cleopatra...](http://people.mozilla.com/~bgirard/cleopatra/#report=1ca3b3891f7a4fbd265d3addf0a759a6be857044 "http://people.mozilla.com/~bgirard/cleopatra/#report=1ca3b3891f7a4fbd265d3addf0a759a6be857044")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[dogfood](/buglist.cgi?keywords=dogfood&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c22 "12 years ago") | ? |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ mozilla::dom::InstanceClassHasProtoAtDepth(JS::Handle<JSObject\*>, unsigned int, unsigned int) ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Adom%3A%3AInstanceClassHasProtoAtDepth%28JS%3A%3AHandle%3CJSObject%2A%3E%2C%20unsigned%20int%2C%20unsigned%20int%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [part 1. Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.](/attachment.cgi?id=730123)  [12 years ago](#c13)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   10.52 KB, patch | bent.mozilla : [review+](#c17 "12 years ago")  peterv : [review+](#c20 "12 years ago")  bajaj : [approval-mozilla-aurora+](#a607626_448925 "12 years ago") | [Details](/attachment.cgi?id=730123&action=edit) | [Diff](/attachment.cgi?id=730123&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123) |
| --- | --- | --- |
| [part 2. Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.](/attachment.cgi?id=730124)  [12 years ago](#c14)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   1.23 KB, patch | bent.mozilla : [review+](#c18 "12 years ago")  peterv : [review+](#a483830_24295 "12 years ago") | [Details](/attachment.cgi?id=730124&action=edit) | [Diff](/attachment.cgi?id=730124&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730124) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=854001#c0)• 12 years ago |
|  | |

This bug was filed from the Socorro interface and is
report [bp-d2b6ee93-7d37-4078-a801-a34c02130322](https://crash-stats.mozilla.org/report/index/d2b6ee93-7d37-4078-a801-a34c02130322) .
=============================================================
STR: I tried to open the links in [bug 853772 comment 3](/show_bug.cgi?id=853772#c3 "NEW - CPU Utilization Spikes when Selecting All")
mozilla::dom::InstanceClassHasProtoAtDepth dom/bindings/BindingUtils.cpp:619
TestShouldDOMCall js/src/ion/IonBuilder.cpp:4215
mozilla::ErrorResult::ReportJSException dom/bindings/BindingUtils.cpp:154
PR\_GetCurrentThread nsprpub/pr/src/pthreads/ptthread.c:621
js::ion::IonBuilder::makeCallHelper js/src/ion/IonBuilder.cpp:4341
js::TempAllocPolicy::malloc\_ obj-firefox/dist/include/js/Utility.h:151
js::ion::IonBuilder::makeCallBarrier js/src/ion/IonBuilder.cpp:4380
js::ion::IonBuilder::jsop\_call js/src/ion/IonBuilder.cpp:4160
js::ion::IonBuilder::getPropTryConstant js/src/ion/IonBuilder.cpp:6563
js::ion::MUnbox::New js/src/ion/MIR.h:1872
PR\_GetCurrentThread nsprpub/pr/src/pthreads/ptthread.c:621
js::ion::MPassArg::New js/src/ion/MIR.h:2104
js::ion::IonBuilder::inspectOpcode js/src/ion/IonBuilder.cpp:932
js::ion::MBasicBlock::NewPopN js/src/ion/MIRGraph.cpp:127
PR\_GetCurrentThread nsprpub/pr/src/pthreads/ptthread.c:621
PR\_GetThreadPrivate nsprpub/pr/src/threads/prtpd.c:200
js::ion::IonBuilder::processCondSwitchBody js/src/ion/IonBuilder.cpp:2503
js::ion::IonBuilder::processCondSwitchCase js/src/ion/IonBuilder.cpp:2474
js::ion::IonBuilder::processCondSwitchBody js/src/ion/IonBuilder.cpp:2503
js::ion::IonBuilder::snoopControlFlow js/src/ion/CompileInfo-inl.h:56
js::ion::IonBuilder::traverseBytecode js/src/ion/IonBuilder.cpp:684
js::ion::IonBuilder::build js/src/ion/IonBuilder.cpp:346
js::VectorImpl<js::types::CompilerOutput, 0ul, js::TempAllocPolicy, false>::grow obj-firefox/dist/include/js/Utility.h:168
js::ion::SequentialCompileContext::compile js/src/ion/Ion.cpp:1293
js::ion::IonBuilder::IonBuilder js/src/ion/IonBuilder.cpp:48
js::ion::Compile<js::ion::SequentialCompileContext> js/src/ion/Ion.cpp:1248
icon-theme.cache@0x135e000
js::CallObject::createForFunction js/src/gc/Barrier-inl.h:74
js::CallObject::createForFunction js/src/gc/Barrier-inl.h:74
js::ion::CanEnterAtBranch js/src/ion/Ion.cpp:1514
js::Interpret js/src/jsinterp.cpp:1591
[...]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a967_5168)• 12 years ago |

Keywords: [dogfood](/buglist.cgi?keywords=dogfood&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=854001#c1)• 12 years ago |
|  | |

A null-deref on the domClass? That's ... very odd.
Mats, can you get this in a debugger? I'd very much like to interrogate the objects involved, but I can't reproduce the crash. :(

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=854001#c2)• 12 years ago |
|  | |

I should have noted that the crash was with a non-default profile, sorry.
I've reduced the prefs.js that causes the crash to this:
user\_pref("javascript.options.methodjit.content", false);
Boris, can you reproduce it with that?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=854001#c3)• 12 years ago |
|  | |

Yes, indeed.
In fact, in a debug build I get a fatal assert on the toPrivate() bit of this line:
js::GetReservedSlot(protoObject, DOM\_PROTO\_INSTANCE\_CLASS\_SLOT).toPrivate());
in mozilla::dom::InstanceClassHasProtoAtDepth.
The passed-in protoObject is "Worker". Not "WorkerPrototype", but "Worker". In particular, its getClass is Worker::sClass.
Its class flags are 0x330.
I assume this is part of the worker "use instance classes for prototypes but still use DOMJSClass for instances" insanity, but I can't find where workers are setting up their proto objects right now. That spot needs to be fixed to not violate invariants. The current setup is ... a problem.Group: core-securityComponent: DOM → DOM: Workers

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=854001#c4)• 12 years ago |
|  | |

It's possible that workers create the proto via the mess that is js::InitClassWithReserved...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=854001#c5)• 12 years ago |
|  | |

This is all totally busted. So.
1) Workers use the same JSClass for instances and prototypes.
2) The trace hook in this class tries to UnwrapDOMObject to WorkerPrivate and it it
returns non-null (it'll return null for the proto!) traces it.
3) The DOM object is stored in slot 0.
4) The instance class is stored on normal WebIDL prototypes in slot 0.
So the only possible solution I can see here is to stop the insanity and stop using the same JSClass for both instances and protos for workers. Ben, do we do that for anything other than Worker, ChromeWorker, and DedicatedWorkerGlobalScope? On the other hand, if we do that, how do we make the objects have the right proto? Right now it seems like it finds them via the insane jsclass-to-proto hashtable thing, right?
I guess another possible solution is to completely disable the ion DOM optimizations because of this worker insanity. :(

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=854001#c6)• 12 years ago |
|  | |

And to be clear, this "reuse the same class" thing was supposed to be temporary when it was written over a year ago. Since then, it's caused at least two security bugs that I know of. We really need someone to actually fix it. :(Flags: needinfo?(bent.mozilla)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=854001#c7)• 12 years ago |
|  | |

This almost certainly affects every single branch we have that has Ion...
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=854001#c8)• 12 years ago |
|  | |

We have no info around when this regressed or the level of criticality here and are about to build our final FF20 beta & rc candidate so minusing for tracking on FF20 and we can make a call on tracking for other versions once we get more info.
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=-)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=854001#c9)• 12 years ago |
|  | |

> We have no info around when this regressed
This regressed with the ionmonkey landing in 18.
> or the level of criticality here
That's a harder call. If the private on these is always JS::UndefinedValue, then it's possible that this is always a safe crash. I just can't tell obviously from code inspection....
Certainly this is a trivial "crash the browser" kind of thing, but that's not that critical in some ways.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=854001#c10)• 12 years ago |
|  | |

I talked this over with mrbkap yesterday and I think splitting the worker classes into a instance and prototype classes is fine if it makes life easier.
There's nothing really "insane" going on here, though... js::InitClass with a null private and a constructor function is just the way the JS engine does classes. It was the way we approximated DOM constructors back when this was written years ago. As we continue to aggressively optimize JS/DOM interaction we're bound to run into cases where this old approximation causes problems.Flags: needinfo?(bent.mozilla)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=854001#c11)• 12 years ago |
|  | |

> There's nothing really "insane" going on here, though...
There is from the point of view of WebIDL: prototypes and instance objects are totally different beasts in WebIDL, with different behavior, different [[Class]], etc...
The other "insane" part is manually doing things that sort of look like WebIDL objects but violate invariants WebIDL objects depend on, of course. :(
In any case, if we plan to split this up, who's doing the work? You, me, or Kyle seem like the obvious options...

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=854001#c12)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #11](/show_bug.cgi?id=854001#c11 "RESOLVED FIXED - crash in mozilla::dom::InstanceClassHasProtoAtDepth"))
Right, I'm in total agreement. I guess my point was just that this is old code written before WebIDL was a real thing and we're trying to retrofit it, basically. Incompatibilities that require code changes are inevitable.
> In any case, if we plan to split this up, who's doing the work?
I'm really hoping Kyle can tackle this. I'm utterly swamped for the next few weeks at least.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=854001#c13)• 12 years ago |
|  | |

Attached patch

[part 1. Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.](attachment.cgi?id=730123&action=diff)
— [Details](attachment.cgi?id=730123&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123)

[Attachment #730123](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") -
Flags: review?(peterv)
[Attachment #730123](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") -
Flags: review?(bent.mozilla)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a404404_20209)• 12 years ago |

Assignee: nobody → bzbarsky

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=854001#c14)• 12 years ago |
|  | |

Attached patch

[part 2. Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.](attachment.cgi?id=730124&action=diff)
— [Details](attachment.cgi?id=730124&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730124)

[Attachment #730124](/attachment.cgi?id=730124&action=edit "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") -
Flags: review?(peterv)
[Attachment #730124](/attachment.cgi?id=730124&action=edit "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") -
Flags: review?(bent.mozilla)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=854001#c15)• 12 years ago |
|  | |

Try run: <https://tbpl.mozilla.org/?tree=Try&rev=bbfddd3e5b52>Whiteboard: [need review]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=854001#c16)• 12 years ago |
|  | |

I'm just going to mark this as sec-high, because of unknown badness. Feel free to adjust as needed.
Marking esr17 and b2g18 as unaffected, as they don't have Ionmonkey.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=854001#c17)• 12 years ago |
|  | |

Comment on [attachment 730123](/attachment.cgi?id=730123 "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[details]](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[diff]](/attachment.cgi?id=730123&action=diff "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123)
part 1. Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.
Review of [attachment 730123](/attachment.cgi?id=730123 "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[details]](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[diff]](/attachment.cgi?id=730123&action=diff "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123):
-----------------------------------------------------------------
::: dom/workers/Worker.cpp
@@ +481,5 @@
> + // js::InitClassWithReserved this JSClass and then call
> + // JS\_NewObject with our sClass and have it find the right
> + // prototype.
> + "ChromeWorker",
> + JSCLASS\_IS\_DOMIFACEANDPROTOJSCLASS | JSCLASS\_HAS\_RESERVED\_SLOTS(2),
This only needs one reserved slot, right?
::: dom/workers/WorkerScope.cpp
@@ +895,5 @@
> + // so that we can JS\_InitClass this JSClass and then
> + // call JS\_NewObject with our sClass and have it find the right
> + // prototype.
> + "DedicatedWorkerGlobalScope",
> + JSCLASS\_IS\_DOMIFACEANDPROTOJSCLASS | JSCLASS\_HAS\_RESERVED\_SLOTS(2),
Same here.
[Attachment #730123](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") -
Flags: review?(bent.mozilla) → review+

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=854001#c18)• 12 years ago |
|  | |

Comment on [attachment 730124](/attachment.cgi?id=730124 "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") [[details]](/attachment.cgi?id=730124&action=edit "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") [[diff]](/attachment.cgi?id=730124&action=diff "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730124)
part 2. Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.
Review of [attachment 730124](/attachment.cgi?id=730124 "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") [[details]](/attachment.cgi?id=730124&action=edit "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") [[diff]](/attachment.cgi?id=730124&action=diff "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730124):
-----------------------------------------------------------------
This looks fine to me, but I bet you want peterv to look over this.
[Attachment #730124](/attachment.cgi?id=730124&action=edit "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") -
Flags: review?(bent.mozilla) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=854001#c19)• 12 years ago |
|  | |

> This only needs one reserved slot, right?
No. The second one is used by Xrays.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a426058_425645)• 12 years ago |

[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=854001#c20)• 12 years ago |
|  | |

Comment on [attachment 730123](/attachment.cgi?id=730123 "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[details]](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[diff]](/attachment.cgi?id=730123&action=diff "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123)
part 1. Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.
Review of [attachment 730123](/attachment.cgi?id=730123 "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[details]](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[diff]](/attachment.cgi?id=730123&action=diff "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123):
-----------------------------------------------------------------
::: dom/workers/Worker.cpp
@@ +316,5 @@
> + {
> + // XXXbz we use "Worker" here to match sClass so that we can
> + // js::InitClassWithReserved this JSClass and then call
> + // JS\_NewObject with our sClass and have it find the right
> + // prototype.
Bah :-(. These should just be in the DOM proto array :-(.
@@ +336,5 @@
> + JSCLASS\_NO\_INTERNAL\_MEMBERS
> + },
> + eInterfacePrototype,
> + &sWorkerNativePropertyHooks,
> + "[object Worker]",
"[object WorkerPrototype]" I think.
@@ +499,5 @@
> + JSCLASS\_NO\_INTERNAL\_MEMBERS
> + },
> + eInterfacePrototype,
> + &sWorkerNativePropertyHooks,
> + "[object ChromeWorker]",
"[object ChromeWorkerPrototype]"
::: dom/workers/WorkerScope.cpp
@@ +913,5 @@
> + JSCLASS\_NO\_INTERNAL\_MEMBERS
> + },
> + eInterfacePrototype,
> + &sWorkerNativePropertyHooks,
> + "[object DedicatedWorkerGlobalScope]",
"[object DedicatedWorkerGlobalScopePrototype]"
[Attachment #730123](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") -
Flags: review?(peterv) → review+

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a483830_24295)• 12 years ago |

[Attachment #730124](/attachment.cgi?id=730124&action=edit "part 2.  Remove a null check in bindings code that is no longer needed because workers no longer use a DOMJSClass for prototype objects.") -
Flags: review?(peterv) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=854001#c21)• 12 years ago |
|  | |

> Bah :-(. These should just be in the DOM proto array :-(.
I agree, but that's a larger change that I'm not comfortable backporting to branches. :(
> "[object WorkerPrototype]" I think.
Again, I was trying to preserve existing behavior as much as possible. Are you OK with me not making that change?Flags: needinfo?(peterv)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=854001#c22)• 12 years ago |
|  | |

 <https://hg.mozilla.org/integration/mozilla-inbound/rev/3e18a5b5257d>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/db2babefda12>Flags: needinfo?(peterv) → in-testsuite?Whiteboard: [need review]Target Milestone: --- → mozilla22

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=854001#c23)• 12 years ago |
|  | |

Comment on [attachment 730123](/attachment.cgi?id=730123 "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[details]](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[diff]](/attachment.cgi?id=730123&action=diff "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123)
part 1. Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): Ionmonkey landing
User impact if declined: Possible crashes in ion code that involves workers, may
be exploitable.
Testing completed (on m-c, etc.): Passes tests
Risk to taking this patch (and alternatives if risky): Risk is low to medium.
The other option is disabling the ion optimizations for WebIDL bindings, which
I suspect is riskier, not to mention a performance hit.
String or IDL/UUID changes made by this patch: None.
[Attachment #730123](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") -
Flags: approval-mozilla-aurora?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=854001#c24)• 12 years ago |
|  | |

(In reply to Boris Zbarsky (:bz) from [comment #23](/show_bug.cgi?id=854001#c23 "RESOLVED FIXED - crash in mozilla::dom::InstanceClassHasProtoAtDepth"))
> Comment on [attachment 730123](/attachment.cgi?id=730123 "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[details]](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[diff]](/attachment.cgi?id=730123&action=diff "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=854001&attachment=730123)
> part 1. Give workers that are pretending to be on WebIDL bindings separate
> JSClasses for instance objects and prototype objects.
>
> [Approval Request Comment]
> Bug caused by (feature/regressing bug #): Ionmonkey landing
> User impact if declined: Possible crashes in ion code that involves workers,
> may
> be exploitable.
> Testing completed (on m-c, etc.): Passes tests
> Risk to taking this patch (and alternatives if risky): Risk is low to
> medium.
> The other option is disabling the ion optimizations for WebIDL bindings,
> which
> I suspect is riskier, not to mention a performance hit.
Based on the risk evaluation here and keeping in mind the alternative is riskier along with perf impact approving the patch here. But a quick check on what sort of impact this may have in terms of new regressions? Are we talking about a possible stability issue ?
> String or IDL/UUID changes made by this patch: None.

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a607626_448925)• 12 years ago |

[Attachment #730123](/attachment.cgi?id=730123&action=edit "part 1.  Give workers that are pretending to be on WebIDL bindings separate JSClasses for instance objects and prototype objects.") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=854001#c25)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/3e18a5b5257d>
<https://hg.mozilla.org/mozilla-central/rev/db2babefda12>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=854001#c26)• 12 years ago |
|  | |

> But a quick check on what sort of impact this may have in terms of new regressions?
The most likely fallout would be either correctness or stability issues with workers. Impact would be limited to pages that actually use workers. Given that we do pass our worker tests, and we have sane test coverage here, the most likely regression is actually another worker-related security-critical crash bug of some sort.... :(

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=854001#c27)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/90661ab654d7>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/95c8ca26e8bb>
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a982174_20209)• 12 years ago |

Blocks: [742193](/show_bug.cgi?id=742193 "RESOLVED FIXED - Stop using DOMJSClass for worker proto objects")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a3623827_280903)• 12 years ago |

Whiteboard: [adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854001#a21439015_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=854001&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_68b42fd1_20250125_164308.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2013-41

## Miscellaneous memory safety hazards (rv:21.0 / rv:17.0.6)

Announced
May 14, 2013
Reporter
Mozilla Developers
Impact
Critical
Products
Firefox, Firefox ESR, Thunderbird, Thunderbird ESR
Fixed in

* Firefox 21
* Firefox ESR 17.0.6
* Thunderbird 17.0.6
* Thunderbird ESR 17.0.6

### Description

Mozilla developers identified and fixed several memory safety bugs in the
browser engine used in Firefox and other Mozilla-based products. Some of these
bugs showed evidence of memory corruption under certain circumstances, and we
presume that with enough effort at least some of these could be exploited to run
arbitrary code.

In general these flaws cannot be exploited through email in the
Thunderbird product because scripting is disabled, but are
potentially a risk in browser or browser-like contexts.

### References

Christoph Diehl, Christian Holler, Jesse Ruderman, Timothy Nikkel, and Jeff
Walden reported memory safety problems and crashes that affect Firefox ESR 17,
and Firefox 20.

* [Memory safety bugs fixed in Firefox 17.0.6 and Firefox 21.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=808402,787283,849597,866544,852315,864558) ([CVE-2013-0801](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-0801))

Bob Clary, Ben Turner, Benoit Jacob, Bobby Holley, Christoph Diehl, Christian
Holler, Andrew McCreight, Gary Kwong, Jason Orendorff, Jesse Ruderman, Matt
Wobensmith, and Mats Palmgren reported memory safety problems and crashes that
affect Firefox 20.

* [Memory safety bugs fixed in Firefox 21.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=803228,834526,791432,865948,821850,837324,814552,826392,826588,855236,819775,822910,837007,843434,821479,826104,854001) ([CVE-2013-1669](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1669))

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from blog.mozilla.org_214f5ef1_20250126_102117.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from lists.opensuse.org_5ac1e7c1_20250125_164302.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q/#FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q)

# [security-announce] openSUSE-SU-2013:0831-1: important: xulrunner to 17.0.6esr

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

27 May
2013

27 May
'13

15:04

openSUSE Security Update: xulrunner to 17.0.6esr
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2013:0831-1
Rating: important
References: #819204
Cross-References: CVE-2013-0801 CVE-2013-1669 CVE-2013-1670
CVE-2013-1674 CVE-2013-1675 CVE-2013-1676
CVE-2013-1677 CVE-2013-1678 CVE-2013-1679
CVE-2013-1680 CVE-2013-1681
Affected Products:
openSUSE 12.2
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 11 vulnerabilities is now available.
Description:
Mozilla xulrunner was updated to 17.0.6esr (bnc#819204)
\* MFSA 2013-41/CVE-2013-0801/CVE-2013-1669 Miscellaneous
memory safety hazards
\* MFSA 2013-42/CVE-2013-1670 (bmo#853709) Privileged
access for content level constructor
\* MFSA 2013-46/CVE-2013-1674 (bmo#860971) Use-after-free
with video and onresize event
\* MFSA 2013-47/CVE-2013-1675 (bmo#866825) Uninitialized
functions in DOMSVGZoomEvent
\* MFSA 2013-48/CVE-2013-1676/CVE-2013-1677/CVE-2013-1678/
CVE-2013-1679/CVE-2013-1680/CVE-2013-1681 Memory
corruption found using Address Sanitizer
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 12.2:
zypper in -t patch openSUSE-2013-448
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 12.2 (i586 x86\_64):
mozilla-js-17.0.6-2.42.1
mozilla-js-debuginfo-17.0.6-2.42.1
xulrunner-17.0.6-2.42.1
xulrunner-buildsymbols-17.0.6-2.42.1
xulrunner-debuginfo-17.0.6-2.42.1
xulrunner-debugsource-17.0.6-2.42.1
xulrunner-devel-17.0.6-2.42.1
xulrunner-devel-debuginfo-17.0.6-2.42.1
- openSUSE 12.2 (x86\_64):
mozilla-js-32bit-17.0.6-2.42.1
mozilla-js-debuginfo-32bit-17.0.6-2.42.1
xulrunner-32bit-17.0.6-2.42.1
xulrunner-debuginfo-32bit-17.0.6-2.42.1
References:
<http://support.novell.com/security/cve/CVE-2013-0801.html>
<http://support.novell.com/security/cve/CVE-2013-1669.html>
<http://support.novell.com/security/cve/CVE-2013-1670.html>
<http://support.novell.com/security/cve/CVE-2013-1674.html>
<http://support.novell.com/security/cve/CVE-2013-1675.html>
<http://support.novell.com/security/cve/CVE-2013-1676.html>
<http://support.novell.com/security/cve/CVE-2013-1677.html>
<http://support.novell.com/security/cve/CVE-2013-1678.html>
<http://support.novell.com/security/cve/CVE-2013-1679.html>
<http://support.novell.com/security/cve/CVE-2013-1680.html>
<http://support.novell.com/security/cve/CVE-2013-1681.html>
<https://bugzilla.novell.com/819204>
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q/#FEKANRWVIGM4RRSYRAKJUNDHIBT22C4Q)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from bugzilla.mozilla.org_0933af63_20250125_164314.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/814552)
* [XML](/show_bug.cgi?ctype=xml&id=814552)

Closed
[Bug 814552](/show_bug.cgi?id=814552)

Opened 12 years ago
Closed 12 years ago

# IonMonkey: Assertion failure: masm.framePushed() == frameSize(), at ion/CodeGenerator.cpp:342 or Crash [@ MarkInternal<js::ion::IonCode>]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

IonMonkey: Assertion failure: masm.framePushed() == frameSize(), at ion/CodeGenerator.cpp:342 or Crash [@ MarkInternal<js::ion::IonCode>]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

ARM

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla23

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox19 | [-](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix) |
| firefox20 | [+](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) |
| firefox21 | [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed) |
| firefox23 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |
| b2g18-v1.0.0 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=unaffected) |
| b2g18-v1.0.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox19 | - | wontfix |
| firefox20 | + | wontfix |
| firefox21 | + | fixed |
| firefox22 | + | fixed |
| firefox23 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| b2g18-v1.0.0 |  | unaffected |
| b2g18-v1.0.1 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: mjrosenb)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/b00d3efc283ff1d77f56f01b78f60713?d=mm&size=40)  [mjrosenb](/user_profile?user_id=419881)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[IonFuzz](/show_bug.cgi?id=724444 "RESOLVED FIXED - [meta] IonMonkey fuzz bugs")

Dependency [tree](/showdependencytree.cgi?id=814552&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=814552)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [jsbugmon:ignore][fuzzblocker][adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:ignore][fuzzblocker][adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c22 "12 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ MarkInternal<js::ion::IonCode> ]](https://crash-stats.mozilla.org/signature/?signature=MarkInternal%3Cjs%3A%3Aion%3A%3AIonCode%3E)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Testcase for shell](/attachment.cgi?id=684561)  [12 years ago](#c0)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   1.47 KB, application/javascript |  | [Details](/attachment.cgi?id=684561&action=edit) |
| --- | --- | --- |
| [/home/mjrosenb/patches/alignAllTheStacks-r0.patch](/attachment.cgi?id=718716)  [12 years ago](#c8)  [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)   3.25 KB, patch |  | [Details](/attachment.cgi?id=718716&action=edit) | [Diff](/attachment.cgi?id=718716&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=814552&attachment=718716) |
| [/home/mjrosenb/patches/alignAllTheStacks-r1.patch](/attachment.cgi?id=730171)  [12 years ago](#c20)  [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)   840 bytes, patch | dvander : [review+](#a11308496_309316 "12 years ago")  bajaj : [approval-mozilla-aurora+](#a12410281_448925 "12 years ago")  bajaj : [approval-mozilla-beta+](#a12410281_448925 "12 years ago") | [Details](/attachment.cgi?id=730171&action=edit) | [Diff](/attachment.cgi?id=730171&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=814552&attachment=730171) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=814552#c0)• 12 years ago |
|  | |

Attached file
[Testcase for shell](attachment.cgi?id=684561)
— [Details](attachment.cgi?id=684561&action=edit)

The attached testcase asserts on mozilla-central revision bc69705c162d (run with --ion-eager).

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=814552#c1)• 12 years ago |
|  | |

Crash trace:
Program received signal SIGSEGV, Segmentation fault.
0x40a08140 in ?? ()
(gdb) bt
#0 0x40a08140 in ?? ()
Cannot access memory at address 0xffffff82
#1 0x0015739e in MarkInternal<js::ion::IonCode> (trc=0x40a11150, thing=<value optimized out>, name=<value optimized out>) at /srv/repos/mozilla-central/js/src/gc/Marking.cpp:125
#2 Mark<js::ion::IonCode> (trc=0x40a11150, thing=<value optimized out>, name=<value optimized out>) at /srv/repos/mozilla-central/js/src/gc/Marking.cpp:151
#3 js::gc::MarkIonCode (trc=0x40a11150, thing=<value optimized out>, name=<value optimized out>) at /srv/repos/mozilla-central/js/src/gc/Marking.cpp:240
#4 0x001d0ba6 in trace (trc=0x40a11150, script=0x1c2c320) at /srv/repos/mozilla-central/js/src/ion/Ion.cpp:537
#5 js::ion::IonScript::Trace (trc=0x40a11150, script=0x1c2c320) at /srv/repos/mozilla-central/js/src/ion/Ion.cpp:713
#6 0x00233d84 in js::ion::IonBailoutIterator::IonBailoutIterator (this=0x40a11150, activations=<value optimized out>, bailout=0x40a11150) at /srv/repos/mozilla-central/js/src/ion/arm/Bailouts-arm.cpp:159
#7 0x00233d84 in js::ion::IonBailoutIterator::IonBailoutIterator (this=0xbee0d1c4, activations=<value optimized out>, bailout=0xbee0d290) at /srv/repos/mozilla-central/js/src/ion/arm/Bailouts-arm.cpp:159
#8 0x001ce054 in js::ion::InvalidationBailout (sp=0xbee0d290, frameSizeOut=0xbee0d288) at /srv/repos/mozilla-central/js/src/ion/Bailouts.cpp:391
#9 0x400abf4c in ?? ()
Cannot access memory at address 0xffffff82
#10 0x400abf4c in ?? ()
Cannot access memory at address 0xffffff82Assignee: general → mrosenbergCrash Signature: [@ MarkInternal<js::ion::IonCode>]Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Whiteboard: [jsbugmon:ignore]

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=814552#c2)• 12 years ago |
|  | |

I cannot reproduce it with a recent build of mozilla-central on Linux x64, CC marty.
This assertion is raised by the codegen. Can you provide the backtrace of the debug version?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=814552#c3)• 12 years ago |
|  | |

The bug is likely ARM only, that's why assigned Marty already. Here is the backtrace of the debug version as requested:
Program received signal SIGSEGV, Segmentation fault.
0x004f09a4 in js::ion::CodeGenerator::visitOsiPoint (this=0xd55d48, lir=0xd6b0f0) at /srv/repos/mozilla-central/js/src/ion/CodeGenerator.cpp:342
342 JS\_ASSERT(masm.framePushed() == frameSize());
(gdb) bt
#0 0x004f09a4 in js::ion::CodeGenerator::visitOsiPoint (this=0xd55d48, lir=0xd6b0f0) at /srv/repos/mozilla-central/js/src/ion/CodeGenerator.cpp:342
#1 0x00445cdc in js::ion::LOsiPoint::accept (this=0xd6b0f0, visitor=0xd55d48) at ../ion/LIR-Common.h:72
#2 0x004f411e in js::ion::CodeGenerator::generateBody (this=0xd55d48) at /srv/repos/mozilla-central/js/src/ion/CodeGenerator.cpp:1472
#3 0x004f9a86 in js::ion::CodeGenerator::generate (this=0xd55d48) at /srv/repos/mozilla-central/js/src/ion/CodeGenerator.cpp:3079
#4 0x003c19c0 in js::ion::CompileBackEnd (mir=0xd5eb88) at /srv/repos/mozilla-central/js/src/ion/Ion.cpp:957
#5 0x003c1cd4 in js::ion::SequentialCompileContext::compile (this=0xbee18ba4, builder=0xd5eb88, graph=0xd5eb20, autoDestroy=...) at /srv/repos/mozilla-central/js/src/ion/Ion.cpp:1142
#6 0x003c625a in js::ion::IonCompile<js::ion::SequentialCompileContext> (cx=0xce4868, script=0x40a0f280, fun=0x40a17020, osrPc=0xd28ba8 "\343V", constructing=false, compileContext=...)
at /srv/repos/mozilla-central/js/src/ion/Ion.cpp:1104
#7 0x003c20f6 in js::ion::Compile (cx=0xce4868, script=0x40a0f280, fun=0x40a17020, osrPc=0xd28ba8 "\343V", constructing=false) at /srv/repos/mozilla-central/js/src/ion/Ion.cpp:1281
#8 0x003c22b8 in js::ion::CanEnterAtBranch (cx=0xce4868, script=..., fp=0x403d80d8, pc=0xd28ba8 "\343V") at /srv/repos/mozilla-central/js/src/ion/Ion.cpp:1323
#9 0x0011b104 in js::Interpret (cx=0xce4868, entryFrame=0x403d8088, interpMode=js::JSINTERP\_NORMAL) at /srv/repos/mozilla-central/js/src/jsinterp.cpp:1394
#10 0x00117ab0 in js::RunScript (cx=0xce4868, script=..., fp=0x403d8088) at /srv/repos/mozilla-central/js/src/jsinterp.cpp:326
#11 0x00118736 in js::ExecuteKernel (cx=0xce4868, script=..., scopeChain=..., thisv=..., type=js::EXECUTE\_GLOBAL, evalInFrame=0x0, result=0x403d8060) at /srv/repos/mozilla-central/js/src/jsinterp.cpp:512
#12 0x00118938 in js::Execute (cx=0xce4868, script=..., scopeChainArg=..., rval=0x403d8060) at /srv/repos/mozilla-central/js/src/jsinterp.cpp:550
#13 0x000532bc in JS\_ExecuteScript (cx=0xce4868, objArg=0x40a0b040, scriptArg=0x40a0f200, rval=0x403d8060) at /srv/repos/mozilla-central/js/src/jsapi.cpp:5537
#14 0x00011bc0 in Evaluate (cx=0xce4868, argc=1, vp=0x403d8060) at /srv/repos/mozilla-central/js/src/shell/js.cpp:927

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a46858_309316)• 12 years ago |

Assignee: mrosenberg → general

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=814552#c4)• 12 years ago |
|  | |

This needs a security rating, Marty, can you judge the severity here?Flags: needinfo?(mrosenberg)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a2301698_1689)• 12 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=814552#c5)• 12 years ago |
|  | |

The original test doesn't reproduce anymore, but I got a very similar looking test that still repros this (revision 8f818068da09):
var assertEq = {};
evaluate("var oa = f2(0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,\
0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,\
0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,\
0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,\
0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,\
0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9,\
0,1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7,8,9);\
var ob = {};\
assertEq(ob.length, 1);\
", { noScriptRval : true });

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=814552#c6)• 12 years ago |
|  | |

This keeps triggering, also in various release crashes.Whiteboard: [jsbugmon:ignore] → [jsbugmon:ignore][fuzzblocker]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a8256817_1689)• 12 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=814552#c7)• 12 years ago |
|  | |

Naveed: please find an assignee for this one. In addition to being a security bug in its own right it's a "fuzzblocker" that is preventing us from effectively testing Ionmonkey on ARM.Assignee: general → nihsanullah

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a8280745_309316)• 12 years ago |

Assignee: nihsanullah → mrosenbergStatus: NEW → ASSIGNED

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=814552#c8)• 12 years ago |
|  | |

Attached patch

[/home/mjrosenb/patches/alignAllTheStacks-r0.patch](attachment.cgi?id=718716&action=diff)
— [Details](attachment.cgi?id=718716&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=814552&attachment=718716)

I'll leave it to dvander to dictate the break-up of the mega-line that is created here. Due to this line being in an initializer list, I can't use temps or anything quite that fancy.
[Attachment #718716](/attachment.cgi?id=718716&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") -
Flags: review?(dvander)Flags: needinfo?(mrosenberg)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=814552#c9)• 12 years ago |
|  | |

Comment on [attachment 718716](/attachment.cgi?id=718716 "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") [[details]](/attachment.cgi?id=718716&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") [[diff]](/attachment.cgi?id=718716&action=diff "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=814552&attachment=718716)
/home/mjrosenb/patches/alignAllTheStacks-r0.patch
> JS\_ASSERT((framePushed() & 3) == 0);
>+ // ma\_callIonHalfPush(callee);
> if ((framePushed() & 7) == 4) {
>+ // fprintf(stderr, "half push\n");
> ma\_callIonHalfPush(callee);
> } else {
>+ //fprintf(stderr, "full push\n");
> adjustFrame(sizeof(void\*));
> ma\_callIon(callee);
> }
> }
nit: don't forget to remove these and the other commented debug statements
>- frameDepth\_(graph->localSlotCount() \* sizeof(STACK\_SLOT\_SIZE) +
>+ frameDepth\_(((graph->localSlotCount() + ComputeByteAlignment(-graph->localSlotCount(), StackAlignment / sizeof(STACK\_SLOT\_SIZE)))) \* sizeof(STACK\_SLOT\_SIZE) +
> graph->argumentSlotCount() \* sizeof(Value))
> {
You could store stuff in temporaries and assign frameDepth\_ in the constructor body, if that would be clearer.
(As discussed in IRC you can get rid of the negate.)
[Attachment #718716](/attachment.cgi?id=718716&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") -
Flags: review?(dvander) → review+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a8446158_280903)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-b2g18-v1.0.0](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18_1_0_0&o1=equals&v1=unaffected)
[status-b2g18-v1.0.1](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=unaffected)
[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-firefox19](/buglist.cgi?f1=cf_tracking_firefox19&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=%3F)
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=814552#c10)• 12 years ago |
|  | |

Tracking based on [comment 7](/show_bug.cgi?id=814552#c7 "RESOLVED FIXED - IonMonkey: Assertion failure: masm.framePushed() == frameSize(), at ion/CodeGenerator.cpp:342 or Crash [@ MarkInternal<js::ion::IonCode>]").
[tracking-firefox20](/buglist.cgi?f1=cf_tracking_firefox20&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox20&o1=equals&v1=%2B)
[tracking-firefox21](/buglist.cgi?f1=cf_tracking_firefox21&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox21&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=814552#c11)• 12 years ago |
|  | |

Al - do you suspect this is a new or easily exploited regression in FF19 and something we should consider fixing before FF20?Flags: needinfo?(abillings)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=814552#c12)• 12 years ago |
|  | |

Alex, I don't know. Decoder might be able to say if this is a regression or not. He did think it was ARM only.Flags: needinfo?(abillings)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=814552#c13)• 12 years ago |
|  | |

I don't know how easily this can be exploited, but it should be ARM only.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a8796448_425645)• 12 years ago |

[status-firefox19](/buglist.cgi?f1=cf_status_firefox19&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox19&o1=equals&v1=wontfix)
[tracking-firefox19](/buglist.cgi?f1=cf_tracking_firefox19&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox19&o1=equals&v1=-)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=814552#c14)• 12 years ago |
|  | |

Looks like this needs to be landed, verified, and nominated for uplift - would be great to get that happening prior to Tuesday when we go to build with our next beta.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=814552#c15)• 12 years ago |
|  | |

Needs a sec-approval nomination first.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=814552#c16)• 12 years ago |
|  | |

(In reply to Gary Kwong [:gkw] [:nth10sd] from [comment #15](/show_bug.cgi?id=814552#c15 "RESOLVED FIXED - IonMonkey: Assertion failure: masm.framePushed() == frameSize(), at ion/CodeGenerator.cpp:342 or Crash [@ MarkInternal<js::ion::IonCode>]"))
> Needs a sec-approval nomination first.
Marty, can you do that and fill out the template that comes up for the patch?

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=814552#c17)• 12 years ago |
|  | |

Comment on [attachment 718716](/attachment.cgi?id=718716 "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") [[details]](/attachment.cgi?id=718716&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") [[diff]](/attachment.cgi?id=718716&action=diff "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=814552&attachment=718716)
/home/mjrosenb/patches/alignAllTheStacks-r0.patch
We talked in person last week, posting here for posterity: I don't fully understand this fix, and am worried about the mismatch between localSlotCount() and the actual number of slots being allocated.
If we need to, we should align localSlotCount at its source, but I'd like to know why it's crashing.
[Attachment #718716](/attachment.cgi?id=718716&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r0.patch") -
Flags: review+

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=814552#c18)• 12 years ago |
|  | |

Emailed Marty about next steps here.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=814552#c19)• 12 years ago |
|  | |

Haven't yet gotten a response.
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=814552#c20)• 12 years ago |
|  | |

Attached patch

[/home/mjrosenb/patches/alignAllTheStacks-r1.patch](attachment.cgi?id=730171&action=diff)
— [Details](attachment.cgi?id=730171&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=814552&attachment=730171)

Sorry for the delay, I was buys with odin. This is the simpler scheme that dvander and I talked about.
[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a11308496_309316)• 12 years ago |

[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: review?(dvander) → review+

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=814552#c21)• 12 years ago |
|  | |

landed: <https://hg.mozilla.org/integration/mozilla-inbound/rev/538ec52a9156>Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=814552#c22)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/538ec52a9156>Status: ASSIGNED → RESOLVEDClosed: 12 years ago
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla23

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=814552#c23)• 12 years ago |
|  | |

Given this has baked on m-c for a few days can we uplift this on aurora/beta ?

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=814552#c24)• 12 years ago |
|  | |

Comment on [attachment 730171](/attachment.cgi?id=730171 "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") [[details]](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") [[diff]](/attachment.cgi?id=730171&action=diff "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=814552&attachment=730171)
/home/mjrosenb/patches/alignAllTheStacks-r1.patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #):
User impact if declined: (Mobile only) debug builds can throw an assertion, opt builds will most likely crash. It is possible for some compiler-controlled data to leak places in the stack reconstructor that it should not.
Testing completed (on m-c, etc.): on m-c for about a week now
Risk to taking this patch (and alternatives if risky): this may be the safest patch I have ever written.
String or IDL/UUID changes made by this patch:
[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: approval-mozilla-beta?
[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: approval-mozilla-aurora?

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a12410281_448925)• 12 years ago |

[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: approval-mozilla-beta?
[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: approval-mozilla-beta+
[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: approval-mozilla-aurora?
[Attachment #730171](/attachment.cgi?id=730171&action=edit "/home/mjrosenb/patches/alignAllTheStacks-r1.patch") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=814552#c25)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/73986f0ec459>
<https://hg.mozilla.org/releases/mozilla-beta/rev/92ebf138fc39>
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a13726676_280903)• 12 years ago |

Whiteboard: [jsbugmon:ignore][fuzzblocker] → [jsbugmon:ignore][fuzzblocker][adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=814552#a31786801_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=814552&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_e688e950_20250125_164311.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/791432)
* [XML](/show_bug.cgi?ctype=xml&id=791432)

Closed
[Bug 791432](/show_bug.cgi?id=791432)

Opened 12 years ago
Closed 12 years ago

# WebGL canvases of width <= 16 contain uninitialized memory upon creation on HTC One S

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

WebGL canvases of width <= 16 contain uninitialized memory upon creation on HTC One S

## Categories

### (Core :: Graphics: CanvasWebGL, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20CanvasWebGL#Graphics%3A%20CanvasWebGL)

Graphics: CanvasWebGL
▾

Core :: Graphics: CanvasWebGL
Bugs with the WebGL Canvas Context.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20CanvasWebGL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20CanvasWebGL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

ARM

Android

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla21

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected) |
| firefox21 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | affected |
| firefox21 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bjacob, Assigned: bjacob)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8f64ddf291d83cdc891c05ee5d5cc5dc?d=mm&size=40)  [bjacob](/user_profile?user_id=382769)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/ca6a57abf052ac63d917d5dae1cc0f00?d=mm&size=40)  [jgilbert](/user_profile?user_id=419431)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[790712](/show_bug.cgi?id=790712 "RESOLVED FIXED - Implement WEBGL_compressed_texture_atc")

Dependency [tree](/showdependencytree.cgi?id=791432&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=791432)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-high, Whiteboard: [adv-main21+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main21+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 3 obsolete files)

| [testcase](/attachment.cgi?id=661462)  [12 years ago](#c0)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   359 bytes, text/html |  | [Details](/attachment.cgi?id=661462&action=edit) |
| --- | --- | --- |
| [testcase](/attachment.cgi?id=661464)  [12 years ago](#c1)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   318 bytes, text/html |  | [Details](/attachment.cgi?id=661464&action=edit) |
| [testcase](/attachment.cgi?id=661465)  [12 years ago](#c3)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.07 KB, text/html |  | [Details](/attachment.cgi?id=661465&action=edit) |
| [testcase](/attachment.cgi?id=702905)  [12 years ago](#c12)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   1.14 KB, text/html |  | [Details](/attachment.cgi?id=702905&action=edit) |
| [blacklist WebGL on HTC One S ("ville")](/attachment.cgi?id=702978)  [12 years ago](#c14)  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)   952 bytes, patch | jgilbert : [review+](#c15 "12 years ago") | [Details](/attachment.cgi?id=702978&action=edit) | [Diff](/attachment.cgi?id=702978&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=791432&attachment=702978) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=791432#c0)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=661462) (obsolete)
— [Details](attachment.cgi?id=661462&action=edit)

STR: load testcase
Expected: blank page
Actual: hit reload a few times, see some random junk.
Tested on a HTC One S with a Adreno 225 GPU.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a56_382769)• 12 years ago |

Summary: resizing GL canvas leaves junk in the drawing buffer on Android → resizing GL canvas leaves junk on Android

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a98_382769)• 12 years ago |

Group: core-security

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=791432#c1)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=661464) (obsolete)
— [Details](attachment.cgi?id=661464&action=edit)

Oh, actually the issue is not with resizing the canvas, it's with scaling it by setting a style size different from the drawing buffer size.
[Attachment #661462](/attachment.cgi?id=661462&action=edit "testcase") -
Attachment is obsolete: true

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a431_382769)• 12 years ago |

Summary: resizing GL canvas leaves junk on Android → Scaling a WebGL canvas gives junk on Android

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=791432#c2)• 12 years ago |
|  | |

...which makes it more likely to be a gfx/layers bug than a WebGL bug.Component: Canvas: WebGL → Graphics: Layers

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=791432#c3)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=661465) (obsolete)
— [Details](attachment.cgi?id=661465&action=edit)

New findings:
- the drawing buffer itself is corrupted: these random pixels can be read by readPixels, as this testcase shows
- this has nothing to do with scaled or resized canvases after all
- this reproduces on a fresh new WebGL context, never resized or scaled
- this only seems to affect canvases of width <= 16.
[Attachment #661464](/attachment.cgi?id=661464&action=edit "testcase") -
Attachment is obsolete: true

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a2437_382769)• 12 years ago |

Summary: Scaling a WebGL canvas gives junk on Android → WebGL canvases of width <= 16 contain uninitialized memory upon creation on Android

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=791432#c4)• 12 years ago |
|  | |

And so, back to the WebGL component. Sorry for the noise.Component: Graphics: Layers → Canvas: WebGL

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a2511_382769)• 12 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=791432#c5)• 12 years ago |
|  | |

This is confirmed to be a Adreno driver bug: glClear is called by GLContext::ClearSafely during WebGL initialization, checked with GDB. It just doesn't do its job.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=791432#c6)• 12 years ago |
|  | |

Michael, this is a bug in the Adreno driver: with a framebuffer object backed by a texture of width <= 16, glClear seems to not take effect. Any info on possible work-arounds / scope of bug / hope of fixes would be greatly appreciated!

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=791432#c7)• 12 years ago |
|  | |

FWIW I stumbled upon this while writing the ATC conformance test (which uses a 16x8 canvas) and this soft-blocks it -- I can still write a conformance test with that bug, but not the one I'd like to.Blocks: [790712](/show_bug.cgi?id=790712 "RESOLVED FIXED - Implement WEBGL_compressed_texture_atc")

|  | [Michael Vines [:m1] [:evilmachines]](/user_profile?user_id=434420) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=791432#c8)• 12 years ago |
|  | |

Can you please let me know the "Version:" of the driver in use here. I need that to map back into the source internally.
e.g:
E/GeckoConsole( 904): OpenGL LayerManager Initialized Succesfully.
E/GeckoConsole( 904): Version: OpenGL ES 2.0 V@6.0 AU@04.00.04.19.229 (CL@)
E/GeckoConsole( 904): Vendor: Qualcomm
E/GeckoConsole( 904): Renderer: Adreno (TM) 200
E/GeckoConsole( 904): FBO Texture Target: TEXTURE\_2D
Also does the issue still manifest with the latest driver from
<https://developer.qualcomm.com/download>? (Search for "Adreno 2xx User-mode Android ICS Graphics Driver (ARMv7)" link in the bottom half of the page).

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=791432#c9)• 12 years ago |
|  | |

Traveling (to Khronos F2F), will be back on Thursday. Jeff, if you want to check this for me, this is the HTC/Adreno phone you had lent me, it's sitting on my desk.

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a487677_152868)• 12 years ago |

Assignee: nobody → bjacob

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=791432#c10)• 12 years ago |
|  | |

Can we get an update here? It has been over three months.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=791432#c11)• 12 years ago |
|  | |

Oops, looks like I dropped this ball. Will look into it on Monday.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=791432#c12)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=702905)
— [Details](attachment.cgi?id=702905&action=edit)

fixed the testcase in success case
[Attachment #661465](/attachment.cgi?id=661465&action=edit "testcase") -
Attachment is obsolete: true

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=791432#c13)• 12 years ago |
|  | |

So I tried on a bunch of Adreno phones to see how widespread the problem is:
Does not reproduce:
Otoro
Unagi
Reproduces:
HTC One S
(Hardware: ville, GPU: Adreno 225)
WebGL blocked on:
HTC "passion"
(Hardware: mahimahi, GPU: Adreno 200)
HTC "supersonic"
(Hardware: supersonic, GPU: Adreno 200)
HTC Desire HD
(Hardware: spade, GPU: Adreno 205)
So, possibly thanks to WebGL being blacklisted on old Adreno drivers, the HTC One S was the only phone on which I could reproduce.
Most importantly, the B2G prototype phones (Otoro and Unagi) are unaffected!
At this point I'm not concerned anymore by this bug; if you want, we can blacklist WebGL on the HTC One S, but that's about it.

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=791432#c14)• 12 years ago |
|  | |

Attached patch

[blacklist WebGL on HTC One S ("ville")](attachment.cgi?id=702978&action=diff)
— [Details](attachment.cgi?id=702978&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=791432&attachment=702978)

[Attachment #702978](/attachment.cgi?id=702978&action=edit "blacklist WebGL on HTC One S (\"ville\")") -
Flags: review?(jgilbert)

|  | [Kelsey Gilbert [:jgilbert]](/user_profile?user_id=419431) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=791432#c15)• 12 years ago |
|  | |

Comment on [attachment 702978](/attachment.cgi?id=702978 "blacklist WebGL on HTC One S (\"ville\")") [[details]](/attachment.cgi?id=702978&action=edit "blacklist WebGL on HTC One S (\"ville\")") [[diff]](/attachment.cgi?id=702978&action=diff "blacklist WebGL on HTC One S (\"ville\")") [[review]](/page.cgi?id=splinter.html&ignore=&bug=791432&attachment=702978)
blacklist WebGL on HTC One S ("ville")
Review of [attachment 702978](/attachment.cgi?id=702978 "blacklist WebGL on HTC One S (\"ville\")") [[details]](/attachment.cgi?id=702978&action=edit "blacklist WebGL on HTC One S (\"ville\")") [[diff]](/attachment.cgi?id=702978&action=diff "blacklist WebGL on HTC One S (\"ville\")") [[review]](/page.cgi?id=splinter.html&ignore=&bug=791432&attachment=702978):
-----------------------------------------------------------------
::: widget/android/GfxInfo.cpp
@@ +345,5 @@
> \*aStatus = nsIGfxInfo::FEATURE\_BLOCKED\_DEVICE;
> return NS\_OK;
> }
> +
> + if (mHardware.Equals(NS\_LITERAL\_STRING("ville"), nsCaseInsensitiveCStringComparator())) {
Equals not StartsWith or Contains, or similar?
[Attachment #702978](/attachment.cgi?id=702978&action=edit "blacklist WebGL on HTC One S (\"ville\")") -
Flags: review?(jgilbert) → review+

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=791432#c16)• 12 years ago |
|  | |

I think we really want Equals there. Suppose that Zynga gets in the business of making phones next year and names their hardware "farmville" .

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=791432#c17)• 12 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/31399fd0cb5b>Target Milestone: --- → mozilla21

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a11454265_382769)• 12 years ago |

Summary: WebGL canvases of width <= 16 contain uninitialized memory upon creation on Android → WebGL canvases of width <= 16 contain uninitialized memory upon creation on HTC One S

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=791432#c18)• 12 years ago |
|  | |

Build bustage; hotfix consists in dropping the attempt at case-insensitiveness. -1 for our string classes (case-insensitive compares should be easy, they're not).
<https://hg.mozilla.org/integration/mozilla-inbound/rev/8f213db8fe7f>

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=791432#c19)• 12 years ago |
|  | |

Backed out speculatively as the possible cause of android reftest-4 failures (for lack of any better guesses that I could find):
<https://hg.mozilla.org/integration/mozilla-inbound/rev/d9d98ffe9ecc>

|  | [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=791432#c20)• 12 years ago |
|  | |

Still failing:
<https://tbpl.mozilla.org/?tree=Mozilla-Inbound>
also, the reftest failure was a SVG reftest, according to the logs.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=791432#c21)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/b52b445017c9>
<https://hg.mozilla.org/mozilla-central/rev/cf4db0037c7e>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=791432#c22)• 12 years ago |
|  | |

[Security Triage] Marking esr17/b2g unaffected as this affected driver may not be used there.Please help with comment's if this was misunderstood for b2g.Thanks
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a19678681_280903)• 12 years ago |

[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=affected)Whiteboard: [adv-main21+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=791432#a37740476_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=791432&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Benoit Jacob [:bjacob] (mostly away)](/user_profile?user_id=382769)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


