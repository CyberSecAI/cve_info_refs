=== Content from bugzilla.mozilla.org_3effc51e_20250125_115346.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/855331)
* [XML](/show_bug.cgi?ctype=xml&id=855331)

Closed
[Bug 855331](/show_bug.cgi?id=855331)

Opened 12 years ago
Closed 12 years ago

# TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate

## Categories

### (Core :: Storage: IndexedDB, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Storage%3A%20IndexedDB#Storage%3A%20IndexedDB)

Storage: IndexedDB
▾

Core :: Storage: IndexedDB
[IndexedDB](https://w3c.github.io/IndexedDB/) implementation, exposed through self.indexedDB.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Storage%3A%20IndexedDB)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla23

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=unaffected) |
| firefox21 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | unaffected |
| firefox21 |  | unaffected |
| firefox22 | + | wontfix |
| firefox23 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bent.mozilla, Assigned: janv)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/eceeadad4a0ed64f00f8e691ad14b59d?d=mm&size=40)  [janv](/user_profile?user_id=8340)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a1dc08fda91b2717842f4b1903da2881?d=mm&size=40)  [bent.mozilla](/user_profile?user_id=200444)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[767944](/show_bug.cgi?id=767944 "RESOLVED FIXED - Implement a manager for centralized quota and storage handling")

Dependency [tree](/showdependencytree.cgi?id=855331&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=855331)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, sec-critical, Whiteboard: [regression from bug 767944?][don't uplift yet, see comment 23][adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[regression from bug 767944?][don't uplift yet, see comment 23][adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [idb mochitests under valgrind (on mac)](/attachment.cgi?id=741152)  [12 years ago](#c13)  [Jan Varga [:janv]](/user_profile?user_id=8340)   1.63 MB, text/plain |  | [Details](/attachment.cgi?id=741152&action=edit) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=855331#c0)• 12 years ago |
|  | |

See <https://tbpl.mozilla.org/php/getParsedLog.php?id=21144311&tree=Mozilla-Inbound>
TransactionThreadPool::FinishTransaction() calls MaybeFireCallback with a DatabasesCompleteCallback& reference that comes out of mCompleteCallbacks. It then calls Run() on the callback, which could do something like call WaitForAllDatabasesToComplete which appends an element to mCompleteCallbacks. If that causes reallocation then the DatabasesCompleteCallback& on our stack is now garbage.
Somehow the log says we're jumping to HasTransactionsForDatabase (line 472), but I can't see how that is happening. Maybe we're calling a virtual Run() on one of our callback pointers that is now garbage?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a77926_406194)• 12 years ago |

Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=855331#c1)• 12 years ago |
|  | |

When we figure this out, we'd like to know how far back it goes.
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=855331#c2)• 12 years ago |
|  | |

bent says he's not working on [bug 855276](/show_bug.cgi?id=855276 "RESOLVED FIXED - Intermittent test_open_empty_db.html,test_indexes.html | Exited with code -1073741819 during test run [@ mozilla::dom::indexedDB::TransactionThreadPool::MaybeFireCallback(mozilla::dom::indexedDB::TransactionThreadPool::DatabasesCompleteCallback &)][@ 0x0]"), which presumably means the same for this bug. Can we please get an owner? It's a frequent orange and s-s.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a526421_280903)• 12 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=855331#c3)• 12 years ago |
|  | |

Kyle you lost our coin toss :) (Please find another owner if appropriate)Assignee: nobody → khuey

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a704461_1689)• 12 years ago |

Assignee: khuey → nobody
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: work happening in bug 855276

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a704483_1689)• 12 years ago |

Assignee: nobody → khuey

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=855331#c4)• 12 years ago |
|  | |

We suspect that this isn't actually a security issue, but we're not confident enough to open it up yet. In particular, [comment 0](/show_bug.cgi?id=855331#c0 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate") is wrong, and every instance of this we've seen is a null deref.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a1308131_336670)• 12 years ago |

Whiteboard: work happening in bug 855276

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a1308646_406194)• 12 years ago |

Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---) → [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=855331#c5)• 12 years ago |
|  | |

We're pretty convinced this is a security bug again ;-)
Still haven't managed to reproduce.Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---) → [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=855331#c6)• 12 years ago |
|  | |

I landed a patch to change from pass-by-reference to pass-by-value when calling this function and that didn't change anything, so this looks like actual heap corruption.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=855331#c7)• 12 years ago |
|  | |

I'm going to assume this affects everything. Adjust as needed.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a1913883_1689)• 12 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=855331#c8)• 12 years ago |
|  | |

I strongly suspect this is a regression for [bug 767944](/show_bug.cgi?id=767944 "RESOLVED FIXED - Implement a manager for centralized quota and storage handling").

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=855331#c9)• 12 years ago |
|  | |

Great, that would match up with the time this started happening.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=unaffected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: [regression from bug 767944?]

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=855331#c10)• 12 years ago |
|  | |

Yes that's my primary piece of evidence ;-)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=855331#c11)• 12 years ago |
|  | |

I think we should consider backing out [Bug 767944](/show_bug.cgi?id=767944 "RESOLVED FIXED - Implement a manager for centralized quota and storage handling"). I haven't managed to reproduce this locally :-/

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=855331#c12)• 12 years ago |
|  | |

Please give me a few days, I'll try to run IDB tests under valgrind.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=855331#c13)• 12 years ago |
|  | |

Attached file
[idb mochitests under valgrind (on mac)](attachment.cgi?id=741152)
— [Details](attachment.cgi?id=741152&action=edit)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a2421974_336670)• 12 years ago |

Assignee: khuey → Jan.Varga

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=855331#c14)• 12 years ago |
|  | |

(In reply to Jan Varga [:janv] from [comment #12](/show_bug.cgi?id=855331#c12 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate"))
> Please give me a few days, I'll try to run IDB tests under valgrind.
Where do we stand on this? Are we considering a backout at this point? We're nearing the end of the Fx23 cycle and I don't think we want to bring this over to Aurora.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=855331#c15)• 12 years ago |
|  | |

The centralized quota manager is already on Aurora, but it seems the crash doesn't happen there so often.
Could the crash somehow relate to the fact that dom/indexedDB tests now run in mochitest-3 ? They used to run in mochitest-2.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=855331#c16)• 12 years ago |
|  | |

It's important to keep in mind that this patch cannot be simply backed out. It changed the directory structure of idb databases so a complete backout would effectively lose all idb data. If we decide to back this out we'll need to handle that migration as well.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=855331#c17)• 12 years ago |
|  | |

I'm testing a patch here:
<https://tbpl.mozilla.org/?tree=Try&rev=01b6bfd06fd7>
It looks promising so far ...

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=855331#c18)• 12 years ago |
|  | |

16 \* 40 mochitest-3 runs, no crashes in MaybeFireCallback()
Should we land it on m-c and see if it really helps ?

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=855331#c19)• 12 years ago |
|  | |

Definitely.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=855331#c20)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/093f7b379757>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=855331#c21)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/093f7b379757>
Looking very good to me! Please request Aurora uplift ASAP :)Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla23

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=855331#c22)• 12 years ago |
|  | |

Ben, it looks to me that we were firing a callback for some other database instance and that database instance didn't exist anymore.
Not sure how can that happen, but that's the only explanation I have for now.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=855331#c23)• 12 years ago |
|  | |

We really need to understand why this happened before we move on or uplift or anything else here. Otherwise we risk simply hiding the problem or (worse) moving it somewhere else.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a3591098_200444)• 12 years ago |

Whiteboard: [regression from bug 767944?] → [regression from bug 767944?][don't uplift yet, see comment 23]

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=855331#c24)• 12 years ago |
|  | |

(In reply to ben turner [:bent] from [comment #23](/show_bug.cgi?id=855331#c23 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate"))
> We really need to understand why this happened before we move on or uplift
> or anything else here. Otherwise we risk simply hiding the problem or
> (worse) moving it somewhere else.
So are we going to do that ...?
We need to do something on beta.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a4982827_336670)• 12 years ago |

Flags: needinfo?(bent.mozilla)

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=855331#c25)• 12 years ago |
|  | |

Jan, are you looking into this?Flags: needinfo?(bent.mozilla)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=855331#c26)• 12 years ago |
|  | |

(In reply to ben turner [:bent] from [comment #25](/show_bug.cgi?id=855331#c25 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate"))
> Jan, are you looking into this?
well, I can take a look ...
do you think it could be something like the thing described in [comment 22](/show_bug.cgi?id=855331#c22 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate") ?

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=855331#c27)• 12 years ago |
|  | |

I haven't been able to come up with any explanation of why this patch seems to work. Since you came up with it I'm hoping you might have a better idea ;)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=855331#c28)• 12 years ago |
|  | |

There hasn't been enough traction here to get into Beta 22, and [comment 27](/show_bug.cgi?id=855331#c27 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate") doesn't make me feel good about getting this into our final two betas.
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=855331#c29)• 12 years ago |
|  | |

This is a "kungFuDeathGrip" type patch. The worst risk of uplifting it would seem to be memory leaks (but those should show up as unexpected leaks in tbpl and don't seem to be).Blocks: [767944](/show_bug.cgi?id=767944 "RESOLVED FIXED - Implement a manager for centralized quota and storage handling")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=855331#c30)• 12 years ago |
|  | |

I don't know how to appeal the "wontfix" because there's no attachment on which to request approval :-( but that is what the previous comment was attempting to be.
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=855331#c31)• 12 years ago |
|  | |

(In reply to ben turner [:bent] from [comment #23](/show_bug.cgi?id=855331#c23 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate"))
> We really need to understand why this happened before we move on or uplift
> or anything else here. Otherwise we risk simply hiding the problem or
> (worse) moving it somewhere else.
Whether we uplift to Fx22 or not the above is true since the patch is on its way to release regardless.

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444)  Reporter |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=855331#c32)• 12 years ago |
|  | |

Can we back this out of trunk before we branch? There's no reason to think that this patch is what we actually want.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=855331#c33)• 12 years ago |
|  | |

Can we just back this out from beta after the merge rather than inflicting the nearly once per push crash back on the rest of the tree? This was one of our most frequent oranges when we were hitting it and the rate at which this and associated bugs has moved along doesn't leave me brimming with confidence that the pain of a trunk backout will be short-lived.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=855331#c34)• 12 years ago |
|  | |

Ok, Ben and I suspect that those crashes we used to have before the "noone knows why it works" patch could be caused by the issue described in the [bug 878703](/show_bug.cgi?id=878703 "RESOLVED FIXED - Cleanup usage of IO thread only objects") and that the centralized manager somehow made the crashes to happen more often.
I'm going to backout the "noone knows why it works" patch on the try server this weekend. I need to retrigger the tests like hundreds of times to be sure that the crashes don't happen anymore, that's why I'll do it on the weekend, when the load is lower.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a6834403_425645)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=855331#c35)• 12 years ago |
|  | |

no, [bug 878703](/show_bug.cgi?id=878703 "RESOLVED FIXED - Cleanup usage of IO thread only objects") seems to be unrelated
when I backed out the hacky patch, crashes reappeared:
<https://tbpl.mozilla.org/php/getParsedLog.php?id=24186335&tree=Try>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=855331#c36)• 12 years ago |
|  | |

Tagging this since we seem to be shipping this in two weeks.Whiteboard: [regression from bug 767944?][don't uplift yet, see comment 23] → [regression from bug 767944?][don't uplift yet, see comment 23][adv-main23+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=855331#a34936465_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=855331&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jan Varga [:janv]](/user_profile?user_id=8340)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_e6e4a6f8_20250125_115355.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/878703)
* [XML](/show_bug.cgi?ctype=xml&id=878703)

Closed
[Bug 878703](/show_bug.cgi?id=878703)

Opened 12 years ago
Closed 12 years ago

# Cleanup usage of IO thread only objects

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Cleanup usage of IO thread only objects

## Categories

### (Core :: Storage: IndexedDB, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Storage%3A%20IndexedDB#Storage%3A%20IndexedDB)

Storage: IndexedDB
▾

Core :: Storage: IndexedDB
[IndexedDB](https://w3c.github.io/IndexedDB/) implementation, exposed through self.indexedDB.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Storage%3A%20IndexedDB&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Storage%3A%20IndexedDB)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |
| b2g-v1.1hd | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=wontfix) |
| b2g-v1.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 | + | wontfix |
| firefox23 | + | fixed |
| firefox24 | + | fixed |
| firefox-esr17 |  | wontfix |
| firefox-esr24 |  | unaffected |
| b2g18 |  | wontfix |
| b2g-v1.1hd |  | wontfix |
| b2g-v1.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: janv, Assigned: janv)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/eceeadad4a0ed64f00f8e691ad14b59d?d=mm&size=40)  [janv](/user_profile?user_id=8340)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/eceeadad4a0ed64f00f8e691ad14b59d?d=mm&size=40)  [janv](/user_profile?user_id=8340)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[785884](/show_bug.cgi?id=785884 "RESOLVED FIXED - Implement support for temporary storage (aka shared pool)")

Dependency [tree](/showdependencytree.cgi?id=878703&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=878703)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-race, sec-moderate, Whiteboard: [adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-race](/buglist.cgi?keywords=csectype-race&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [patch v0.1](/attachment.cgi?id=757241)  [12 years ago](#c0)  [Jan Varga [:janv]](/user_profile?user_id=8340)   43.33 KB, patch | bent.mozilla : [review+](#c1 "12 years ago")  akeybl : [approval-mozilla-aurora+](#a824701_425645 "12 years ago")  akeybl : [approval-mozilla-beta-](#c11 "12 years ago") | [Details](/attachment.cgi?id=757241&action=edit) | [Diff](/attachment.cgi?id=757241&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=757241) |
| --- | --- | --- |
| [interdiff](/attachment.cgi?id=758484)  [12 years ago](#c3)  [Jan Varga [:janv]](/user_profile?user_id=8340)   6.16 KB, patch |  | [Details](/attachment.cgi?id=758484&action=edit) | [Diff](/attachment.cgi?id=758484&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=758484) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=878703#c0)• 12 years ago |
|  | |

Attached patch

[patch v0.1](attachment.cgi?id=757241&action=diff)
— [Details](attachment.cgi?id=757241&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=757241)

mFileManagerInfos member in IndexedDatabaseManager supposed to be touched only on the IO thread, unfortunately it is not.
This patch fixes it and also adds AssertIsOnIOThread() to all IO thread only methods to make the thread they are running on more obvious.
Temp storage implementation depends on this fix.

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a74_8340)• 12 years ago |

Assignee: nobody → Jan.VargaBlocks: [785884](/show_bug.cgi?id=785884 "RESOLVED FIXED - Implement support for temporary storage (aka shared pool)")Status: NEW → ASSIGNED

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a113_8340)• 12 years ago |

[Attachment #757241](/attachment.cgi?id=757241&action=edit "patch v0.1") -
Flags: review?(bent.mozilla)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a22277_8340)• 12 years ago |

[Attachment #757241](/attachment.cgi?id=757241&action=edit "patch v0.1") -
Attachment is patch: true

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=878703#c1)• 12 years ago |
|  | |

Comment on [attachment 757241](/attachment.cgi?id=757241 "patch v0.1") [[details]](/attachment.cgi?id=757241&action=edit "patch v0.1") [[diff]](/attachment.cgi?id=757241&action=diff "patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=757241)
patch v0.1
Review of [attachment 757241](/attachment.cgi?id=757241 "patch v0.1") [[details]](/attachment.cgi?id=757241&action=edit "patch v0.1") [[diff]](/attachment.cgi?id=757241&action=diff "patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=757241):
-----------------------------------------------------------------
Looks good! r=me with just a few changes:
::: dom/indexedDB/IndexedDatabaseManager.cpp
@@ +644,5 @@
>
> return NS\_OK;
> }
> +
> +GetFileReferencesHelper::GetFileReferencesHelper(const nsACString& aOrigin,
Nit: Just inline this
@@ +659,5 @@
> +{
> +}
> +
> +nsresult
> +GetFileReferencesHelper::DispatchAndReturnFileReferences(int32\_t\* aMemRefCnt,
Assert that you start out on the main thread here.
::: dom/indexedDB/IndexedDatabaseManager.h
@@ +96,5 @@
> AsyncDeleteFile(FileManager\* aFileManager,
> int64\_t aFileId);
>
> + nsresult
> + GetFileReferences(const nsACString& aOrigin,
Nit: Make this 'BlockAndGetFileReferences', and add a big scary comment saying that this is to be used in testing-only code because it blocks the main thread.
[Attachment #757241](/attachment.cgi?id=757241&action=edit "patch v0.1") -
Flags: review?(bent.mozilla) → review+

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=878703#c2)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/23a34163cd70>

|  | [Jan Varga [:janv]](/user_profile?user_id=8340)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=878703#c3)• 12 years ago |
|  | |

Attached patch

[interdiff](attachment.cgi?id=758484&action=diff)
— [Details](attachment.cgi?id=758484&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=758484)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=878703#c4)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/23a34163cd70>Status: ASSIGNED → RESOLVEDClosed: 12 years agoResolution: --- → FIXEDTarget Milestone: --- → mozilla24

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=878703#c5)• 12 years ago |
|  | |

This is a thread-unsafe access of a hash table. s-s for now until someone from the sec team can rate it.Group: core-security

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=878703#c6)• 12 years ago |
|  | |

Comment on [attachment 757241](/attachment.cgi?id=757241 "patch v0.1") [[details]](/attachment.cgi?id=757241&action=edit "patch v0.1") [[diff]](/attachment.cgi?id=757241&action=diff "patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=757241)
patch v0.1
[Approval Request Comment]
Bug caused by (feature/regressing bug #): Unclear
User impact if declined: Crashes, maybe an exploit. Depends on a race so it might be tough.
Testing completed (on m-c, etc.): It's been on m-c for a while now.
Risk to taking this patch (and alternatives if risky): No risks that we're aware of.
String or IDL/UUID changes made by this patch: None
[Attachment #757241](/attachment.cgi?id=757241&action=edit "patch v0.1") -
Flags: approval-mozilla-beta?
[Attachment #757241](/attachment.cgi?id=757241&action=edit "patch v0.1") -
Flags: approval-mozilla-aurora?

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=878703#c7)• 12 years ago |
|  | |

(In reply to ben turner [:bent] from [comment #6](/show_bug.cgi?id=878703#c6 "RESOLVED FIXED - Cleanup usage of IO thread only objects"))
> User impact if declined: Crashes, maybe an exploit. Depends on a race so it
> might be tough.
Can we get more confidence than maybe an exploit? If so, can we make this a sec-critical.
> Risk to taking this patch (and alternatives if risky): No risks that we're
> aware of.
Low enough risk for the final beta of a release?
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)Flags: needinfo?(bent.mozilla)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a824701_425645)• 12 years ago |

[Attachment #757241](/attachment.cgi?id=757241&action=edit "patch v0.1") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=878703#c8)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/d2f19cdab655>
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=878703#c9)• 12 years ago |
|  | |

(In reply to Alex Keybl [:akeybl] from [comment #7](/show_bug.cgi?id=878703#c7 "RESOLVED FIXED - Cleanup usage of IO thread only objects"))
> Can we get more confidence than maybe an exploit? If so, can we make this a
> sec-critical.
We'd need someone from the sec team to weigh in on this.
> Low enough risk for the final beta of a release?
I'm not sure, so I guess not :(Flags: needinfo?(bent.mozilla)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=878703#c10)• 12 years ago |
|  | |

Did this affect 21 or earlier, such as ESR17?
Also, before this went in initially, it should have gone through sec-approval and gotten a rating, per <https://wiki.mozilla.org/Security/Bug_Approval_Process>.
I'm not sure of the rating here. Asking Dan.Flags: needinfo?(dveditz)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a994974_425645)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=878703#c11)• 12 years ago |
|  | |

Comment on [attachment 757241](/attachment.cgi?id=757241 "patch v0.1") [[details]](/attachment.cgi?id=757241&action=edit "patch v0.1") [[diff]](/attachment.cgi?id=757241&action=diff "patch v0.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=878703&attachment=757241)
patch v0.1
We're not confident enough in the fix (even if this is sec-crit) to take in a final beta.
[Attachment #757241](/attachment.cgi?id=757241&action=edit "patch v0.1") -
Flags: approval-mozilla-beta? → approval-mozilla-beta-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a1904055_1689)• 12 years ago |

Flags: needinfo?(dveditz)Keywords: [csec-race](/buglist.cgi?keywords=csec-race&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a4877959_280903)• 11 years ago |

Whiteboard: [adv-main23+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a11272056_280903)• 11 years ago |

[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a13618661_280903)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected)
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a20251984_75935)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=878703#a46213750_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=878703&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jan Varga [:janv]](/user_profile?user_id=8340)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_fd85ae4c_20250125_115357.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/879139)
* [XML](/show_bug.cgi?ctype=xml&id=879139)

Closed
[Bug 879139](/show_bug.cgi?id=879139)

Opened 12 years ago
Closed 12 years ago

# Use-after-free with SVG animation in SVG image

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Use-after-free with SVG animation in SVG image

## Categories

### (Core :: SVG, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=SVG#SVG)

SVG
▾

Core :: SVG

Issues with the layout or rendering of SVG content and interacting with the SVG DOM.

Example bugs:

* SVG marker can not be clipped with clip-path
* x position adjustments of SVG vertical text on a path moves in the wrong direction

Specifications covered:

* SVG

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=SVG&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=SVG&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=SVG)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | unaffected |
| firefox22 | + | wontfix |
| firefox23 | + | fixed |
| firefox24 | + | fixed |
| firefox25 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: seth)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/6cf6a8d04179da2ab0f6dbc88dc5fe7b?d=mm&size=40)  [seth](/user_profile?user_id=452036)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomclasses](/show_bug.cgi?id=331889 "RESOLVED INACTIVE - [meta] Bugs found with \"Random Classes\" (adding random CSS stylesheets)"), [846028](/show_bug.cgi?id=846028 "RESOLVED FIXED - SVG images generate too many OnStopFrame calls")

Dependency [tree](/showdependencytree.cgi?id=879139&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=879139)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [fixed by bug 883416][adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[fixed by bug 883416][adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dholbert](/user_profile?user_id=278074) | [in-testsuite](#a29015850_278074 "11 years ago") | ? |
| --- | --- | --- |
| [dholbert](/user_profile?user_id=278074) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [testcase (see comment 0)](/attachment.cgi?id=757807)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   287 bytes, application/octet-stream |  | [Details](/attachment.cgi?id=757807&action=edit) |
| --- | --- | --- |
| [Keep VectorImage's rendering and mutation observers in sync.](/attachment.cgi?id=760636)  [12 years ago](#c6)  [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)   2.62 KB, patch |  | [Details](/attachment.cgi?id=760636&action=edit) | [Diff](/attachment.cgi?id=760636&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=879139&attachment=760636) |
| [Keep VectorImage's rendering and mutation observers in sync.](/attachment.cgi?id=761781)  [12 years ago](#c12)  [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)   3.46 KB, patch |  | [Details](/attachment.cgi?id=761781&action=edit) | [Diff](/attachment.cgi?id=761781&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=879139&attachment=761781) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=879139#c0)• 12 years ago |
|  | |

Attached file
[testcase (see comment 0)](attachment.cgi?id=757807)
— [Details](attachment.cgi?id=757807&action=edit)

With:
user\_pref("privacy.sanitize.sanitizeOnShutdown", true);
The testcase causes a crash on shutdown.
==40362== ERROR: AddressSanitizer heap-use-after-free on address 0x000146dcc780 at pc 0x10c3379a1 bp 0x7fff5fbeae50 sp 0x7fff5fbeae48
READ of size 8 at 0x000146dcc780 thread T0
#0 0x10c33799f in nsNodeUtils::LastRelease [nsNodeUtils.cpp:187]
#1 0x10b9e6fda in mozilla::dom::FragmentOrElement::Release [FragmentOrElement.cpp:1711]
#2 0x111e73b11 in nsSVGElement::Release [nsSVGElement.cpp:229]
#3 0x111c013e1 in mozilla::dom::SVGGraphicsElement::Release [SVGGraphicsElement.cpp:15]
#4 0x111d52f51 in mozilla::dom::SVGSVGElement::Release [SVGSVGElement.cpp:143]
#5 0x119d1bfc8 in nsXPCOMCycleCollectionParticipant::UnrootImpl [nsCycleCollectionParticipant.cpp:38]
#6 0x11a1dfd19 in nsCycleCollector::CollectWhite [nsCycleCollector.cpp:2432]
#7 0x11a1d107f in nsCycleCollector::FinishCollection [nsCycleCollector.cpp:2883]
#8 0x11a1e3aec in nsCycleCollector::ShutdownCollect [nsCycleCollector.cpp:2767]
#9 0x11a1e514e in nsCycleCollector::Shutdown [nsCycleCollector.cpp:2917]
#10 0x11a1e7e11 in nsCycleCollector\_shutdown [nsCycleCollector.cpp:3116]
#11 0x119d709c7 in mozilla::ShutdownXPCOM [nsXPComInit.cpp:651]
#12 0x119d6fc58 in NS\_ShutdownXPCOM [nsXPComInit.cpp:540]
#13 0x1068e3a62 in ScopedXPCOMStartup::~ScopedXPCOMStartup [nsAppRunner.cpp:1125]
#14 0x1068e35a8 in ScopedXPCOMStartup::~ScopedXPCOMStartup [nsAppRunner.cpp:1106]
#15 0x10690c310 in XREMain::XRE\_main [nsAppRunner.cpp:3944]
#16 0x10690db22 in XRE\_main [nsAppRunner.cpp:4121]
#17 0x1000083ec in do\_main [nsBrowserApp.cpp:272]
#18 0x100004b02 in main [nsBrowserApp.cpp:632]
#19 0x1000015c3 in start (in firefox-bin) + 51
#20 0x5 in 0x00000005 (in firefox-bin)
Same symptoms as [bug 851416](/show_bug.cgi?id=851416 "RESOLVED FIXED - Use-after-free with SVG and privacy.sanitize.sanitizeOnShutdown"), pretty much.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=879139#c1)• 12 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #0](/show_bug.cgi?id=879139#c0 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image"))
> With:
> user\_pref("privacy.sanitize.sanitizeOnShutdown", true);
>
> The testcase causes a crash on shutdown.
I can reproduce this without any pref tweaks by clearing my cache (ctrl+shift+del) before shutdown, or by viewing the testcase in a Private Window (ctrl+shift+p) and then quitting.
(So basically: this crashes at shutdown IFF we've cleared the image cache.)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=879139#c2)• 12 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #0](/show_bug.cgi?id=879139#c0 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image"))
> Same symptoms as [bug 851416](/show_bug.cgi?id=851416 "RESOLVED FIXED - Use-after-free with SVG and privacy.sanitize.sanitizeOnShutdown"), pretty much.
Caused by the same commit, too. On my Linux system, targeted debug builds (w/ my cache-clearing STR from [comment 1](/show_bug.cgi?id=879139#c1 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image")) indicate that this started with <https://hg.mozilla.org/mozilla-central/rev/1cf12e699dc7> for [bug 846028](/show_bug.cgi?id=846028 "RESOLVED FIXED - SVG images generate too many OnStopFrame calls").
So: This affects builds going back to Firefox 22, which is currently on Beta (slated to be released June 21 I believe). We should fix this before 22 goes to release, if at all possible.
Seth, do you have cycles to look at this? Tentatively assigning to you, but feel free to kick it over to me if you need to.Assignee: nobody → sethBlocks: [846028](/show_bug.cgi?id=846028 "RESOLVED FIXED - SVG images generate too many OnStopFrame calls")
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)OS: Mac OS X → AllHardware: x86\_64 → All

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=879139#c3)• 12 years ago |
|  | |

I will take a look tomorrow.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=879139#c4)• 12 years ago |
|  | |

Whether or not we fix this FF22 regression will depend on the fix and the risk associated.
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a578747_452036)• 12 years ago |

[Attachment #757807](/attachment.cgi?id=757807&action=edit "testcase (see comment 0)") -
Attachment mime type: image/svg+xml → application/octet-stream

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=879139#c5)• 12 years ago |
|  | |

Sorry for the MIME type change but I simply could not convince Firefox to download the file otherwise.

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=879139#c6)• 12 years ago |
|  | |

Attached patch

[Keep VectorImage's rendering and mutation observers in sync.](attachment.cgi?id=760636&action=diff) (obsolete)
— [Details](attachment.cgi?id=760636&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=879139&attachment=760636)

This patch fixes the crash for me locally. It needs a try run before review, though.

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=879139#c7)• 12 years ago |
|  | |

Try job here: <https://tbpl.mozilla.org/?tree=Try&rev=5893d3103ff3>

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=879139#c8)• 12 years ago |
|  | |

> Sorry for the MIME type change but I simply could not convince Firefox to download
> the file otherwise.
Is something wrong with right-click "Save Link As..." in your Firefox?

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=879139#c9)• 12 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #8](/show_bug.cgi?id=879139#c8 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image"))
> > Sorry for the MIME type change but I simply could not convince Firefox to download
> > the file otherwise.
>
> Is something wrong with right-click "Save Link As..." in your Firefox?
I think BugzillaJS is at fault, but yes, for some reason I could not do that for this particular test case.

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=879139#c10)• 12 years ago |
|  | |

Comment on [attachment 760636](/attachment.cgi?id=760636 "Keep VectorImage's rendering and mutation observers in sync.") [[details]](/attachment.cgi?id=760636&action=edit "Keep VectorImage's rendering and mutation observers in sync.") [[diff]](/attachment.cgi?id=760636&action=diff "Keep VectorImage's rendering and mutation observers in sync.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=879139&attachment=760636)
Keep VectorImage's rendering and mutation observers in sync.
Review of [attachment 760636](/attachment.cgi?id=760636 "Keep VectorImage's rendering and mutation observers in sync.") [[details]](/attachment.cgi?id=760636&action=edit "Keep VectorImage's rendering and mutation observers in sync.") [[diff]](/attachment.cgi?id=760636&action=diff "Keep VectorImage's rendering and mutation observers in sync.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=879139&attachment=760636):
-----------------------------------------------------------------
This looks OK on try, so requesting review.
[Attachment #760636](/attachment.cgi?id=760636&action=edit "Keep VectorImage's rendering and mutation observers in sync.") -
Flags: review?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=879139#c11)• 12 years ago |
|  | |

Comment on [attachment 760636](/attachment.cgi?id=760636 "Keep VectorImage's rendering and mutation observers in sync.") [[details]](/attachment.cgi?id=760636&action=edit "Keep VectorImage's rendering and mutation observers in sync.") [[diff]](/attachment.cgi?id=760636&action=diff "Keep VectorImage's rendering and mutation observers in sync.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=879139&attachment=760636)
Keep VectorImage's rendering and mutation observers in sync.
It makes me a little uneasy that we're needing to juggle multiple observer lists here, while our parent class also tries to juggle them.
Maybe we should be calling the parent's StartListening / StopListening methods, and let those do the work for us (even though it may sometimes involve a little extra work, e.g. checking the rendering-observer list when we know we're not in it. Worth the complexity win if it works, IMHO.)
So: does it work if we just switch to using those methods, and let VectorImage be blissfully ignorant of these various lists?

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=879139#c12)• 12 years ago |
|  | |

Attached patch

[Keep VectorImage's rendering and mutation observers in sync.](attachment.cgi?id=761781&action=diff)
— [Details](attachment.cgi?id=761781&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=879139&attachment=761781)

Thanks for the review, Daniel. I definitely like that idea. I'm not ultra happy with the API that nsSVGRenderingObserver exposes for its subclasses - in particular, we need to call different functions to add ourselves to each observer list, but only a single function to remove ourselves from both, and it's not safe to call StartListening twice without a StopListening in between. This is the reason why, in the updated version of the patch, I continue to call GetReferencedElement manually in one place. (Though it could be replaced by StopListening followed by ResumeListening.) That said, this updated version of the patch does feel cleaner.
Try job here (reftests only): <https://tbpl.mozilla.org/?tree=Try&rev=c28aeacada91>
[Attachment #761781](/attachment.cgi?id=761781&action=edit "Keep VectorImage's rendering and mutation observers in sync.") -
Flags: review?(dholbert)

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a755950_452036)• 12 years ago |

[Attachment #760636](/attachment.cgi?id=760636&action=edit "Keep VectorImage's rendering and mutation observers in sync.") -
Attachment is obsolete: true
[Attachment #760636](/attachment.cgi?id=760636&action=edit "Keep VectorImage's rendering and mutation observers in sync.") -
Flags: review?(dholbert)

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=879139#c13)• 12 years ago |
|  | |

Hmmm.. so that doesn't look so good on try. I'll take a look and see what I can do.

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a815604_452036)• 12 years ago |

[Attachment #761781](/attachment.cgi?id=761781&action=edit "Keep VectorImage's rendering and mutation observers in sync.") -
Flags: review?(dholbert)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=879139#c14)• 12 years ago |
|  | |

Summarizing 2 things seth & I discussed/realized over IRC:
(1) This VectorImage (& its SVGDocumentWrapper, etc) seem to be sticking around until shutdown, even after I clear my cache, per [comment 1](/show_bug.cgi?id=879139#c1 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image"). That seems odd.
(2) Since it's sticking around until shutdown, it gets some ties severed by the SVGDocumentWrapper's shutdown-observer, which clears the internal doc's rendering-observer list but \*not\* its mutation observer list. It technically should be clearing both lists. (or, removing everything in the rendering observer list from the mutation observer list as well) Though seth has some ideas about how we could handle this better, which I need to think through a bit more & haven't yet.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=879139#c15)• 12 years ago |
|  | |

For now, I wonder if we should just back out [bug 846028](/show_bug.cgi?id=846028 "RESOLVED FIXED - SVG images generate too many OnStopFrame calls") (and [bug 851416](/show_bug.cgi?id=851416 "RESOLVED FIXED - Use-after-free with SVG and privacy.sanitize.sanitizeOnShutdown"), which stacks on top of it) from beta, so that we don't ship this with Firefox 22?
akeybl, how much longer do we have (if any time at all) to land backout-patches that restore us to a known-good state, for beta?Flags: needinfo?(akeybl)

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=879139#c16)• 12 years ago |
|  | |

From my perspective backing out is a good idea. If we do go with my plan (don't remove ourselves from the observer lists at all, just use a flag in nsSVGRootRenderingObserver to ignore invalidations that we don't want to act on) then I'd be reverting [bug 846028](/show_bug.cgi?id=846028 "RESOLVED FIXED - SVG images generate too many OnStopFrame calls") and [bug 851416](/show_bug.cgi?id=851416 "RESOLVED FIXED - Use-after-free with SVG and privacy.sanitize.sanitizeOnShutdown") anyway.

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a911081_425645)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)Flags: needinfo?(akeybl)

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=879139#c17)• 12 years ago |
|  | |

We've agreed to move to the flag approach. I'll work on this in [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage"). That bug doesn't mention this issue, and justifies the change as a refactoring to simplify the code. (Which is also true!) Consider that bug an implicit blocker of this bug.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=879139#c18)• 12 years ago |
|  | |

Thanks, Seth!

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=879139#c19)• 12 years ago |
|  | |

WFM on mozilla-central??

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=879139#c20)• 12 years ago |
|  | |

We'll make the change in [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage") regardless. I'm not convinced that we've seen the end of bugs from the code as it currently stands. =) I intend to start work on that bug tomorrow.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=879139#c21)• 12 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #19](/show_bug.cgi?id=879139#c19 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image"))
> WFM on mozilla-central??
Not WFM -- I can still reproduce this with the ctrl+shift+del STR from [Comment 1](/show_bug.cgi?id=879139#c1 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image"), with current m-c tip. (revision 8ea92aeab783)

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=879139#c22)• 12 years ago |
|  | |

So with the patches up in [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage") applied, I can't reproduce this with any of the STR mentioned in this bug. I think [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage") takes care of this.

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a2041262_452604)• 12 years ago |

[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F)Flags: needinfo?(mwobensmith)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=879139#c23)• 12 years ago |
|  | |

Sounds like this should be FIXED, now that [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage") has landed, right?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=879139#c24)• 12 years ago |
|  | |

Yup; I get no shutdown crash w/ [comment 1](/show_bug.cgi?id=879139#c1 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image")'s ctrl+shift+del STR, with:
<https://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2013/06/2013-06-23-mozilla-central-debug/firefox-24.0a1.en-US.debug-linux-x86_64.txt>
but I do get a crash in the build from the day before:
<https://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2013/06/2013-06-22-mozilla-central-debug/firefox-24.0a1.en-US.debug-linux-x86_64.txt>
(And [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage")'s fix landed on mozilla-central between those builds.)
So this is FIXED by [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage"), which means it's fixed for Firefox 24 and 25, and we don't need to track it for Firefox 25.Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F) → ---Resolution: --- → FIXEDWhiteboard: [fixed by bug 883416]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=879139#c25)• 12 years ago |
|  | |

[I'll leave mwobensmith's self-needinfo open, though I suspect he toggled that flag to circle back on the tracking-firefox25 request, which is now no longer needed.]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=879139#c26)• 12 years ago |
|  | |

Indeed, Daniel. Thanks. :)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=879139#c27)• 12 years ago |
|  | |

Cool! Canceling your needinfo then.Flags: needinfo?(mwobensmith)

|  | [Seth Fowler [:seth] [:s2h]](/user_profile?user_id=452036)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=879139#c28)• 12 years ago |
|  | |

Thanks for marking this as resolved, Daniel!

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=879139#c29)• 12 years ago |
|  | |

Marking this status-firefox23 fixed as [bug 883416](/show_bug.cgi?id=883416 "RESOLVED FIXED - Simplify the coalescing of invalidation notifications in VectorImage") is marked that way as well.
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a4796956_280903)• 11 years ago |

Whiteboard: [fixed by bug 883416] → [fixed by bug 883416][adv-main23+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a5447567_1689)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a29014970_1689)• 11 years ago |

Group: core-security

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=879139#a29015850_278074)• 11 years ago |

Flags: in-testsuite?
You need to [log in](/show_bug.cgi?id=879139&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_edca1848_20250125_115358.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/893684)
* [XML](/show_bug.cgi?ctype=xml&id=893684)

Closed
[Bug 893684](/show_bug.cgi?id=893684)

Opened 12 years ago
Closed 12 years ago

# OdinMonkey: Assertion failure: (size\_t) (dst - src) >= len, at jsutil.h

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

OdinMonkey: Assertion failure: (size\_t) (dst - src) >= len, at jsutil.h

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla25

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox25 | [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox22 |  | wontfix |
| firefox23 | + | fixed |
| firefox24 | + | fixed |
| firefox25 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: luke)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [luke](/user_profile?user_id=347312)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[880538](/show_bug.cgi?id=880538 "RESOLVED FIXED - OdinMonkey: avoid parse node memory spike by LifoAlloc::release()ing after every function")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[885758](/show_bug.cgi?id=885758 "RESOLVED FIXED - Add ExclusiveContext class for off main thread contexts with exclusive access to their compartment")

Dependency [tree](/showdependencytree.cgi?id=893684&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=893684)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[893739](/show_bug.cgi?id=893739 "RESOLVED DUPLICATE - OdinMonkey: Use-after-free [@ strlen] through [@ js::ScriptSource::setFilename]"), [894956](/show_bug.cgi?id=894956 "RESOLVED DUPLICATE - Use-After-Free with JS::CompileOptions")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [jsbugmon:][adv-main23+] fixed on trunk in bug 880538)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:][adv-main23+] fixed on trunk in bug 880538

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack](/attachment.cgi?id=775521)  [12 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   5.88 KB, text/plain |  | [Details](/attachment.cgi?id=775521&action=edit) |
| --- | --- | --- |
| [fix](/attachment.cgi?id=776120)  [12 years ago](#c5)  [Luke Wagner [:luke]](/user_profile?user_id=347312)   1020 bytes, patch | bbouvier : [review+](#c6 "12 years ago")  lsblakk : [approval-mozilla-aurora+](#a387834_272375 "12 years ago")  lsblakk : [approval-mozilla-beta+](#a387834_272375 "12 years ago") | [Details](/attachment.cgi?id=776120&action=edit) | [Diff](/attachment.cgi?id=776120&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893684&attachment=776120) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=893684#c0)• 12 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=775521)
— [Details](attachment.cgi?id=775521&action=edit)

evaluate("\
valueOf = (function() {\
\"use asm\";\
function f() {}\
return f\
});\
this + ''\
", {
fileName: '',
})
this + ''
asserts js debug shell on m-c changeset 3433a021847b without any CLI arguments intermittently (but fairly reliably) at Assertion failure: (size\_t) (dst - src) >= len, at jsutil.h
Locking s-s because previously-found similar assertion [bug 855442](/show_bug.cgi?id=855442 "RESOLVED FIXED - OdinMonkey: Assertion failure: size_t(dst - src) >= nelem, at jsutil.h:229 and invalid read") was also s-s.
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: <http://hg.mozilla.org/mozilla-central/rev/b674f0e40c8e>
user: Brian Hackett
date: Wed Jul 10 09:29:52 2013 -0600
summary: [Bug 885758](/show_bug.cgi?id=885758 "RESOLVED FIXED - Add ExclusiveContext class for off main thread contexts with exclusive access to their compartment") - Add ExclusiveContext for use by threads with exclusive access to their compartment, r=billm.
Brian, is [bug 885758](/show_bug.cgi?id=885758 "RESOLVED FIXED - Add ExclusiveContext class for off main thread contexts with exclusive access to their compartment") a likely regressor?Flags: needinfo?(bhackett1024)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a12639_395101)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=893684#c1)• 12 years ago |
|  | |

JSBugMon: Cannot process bug: Unable to automatically reproduce, please track manually.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=893684#c3)• 12 years ago |
|  | |

Nope, silly pre-existing Odin bug.Flags: needinfo?(bhackett1024)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=893684#c4)• 12 years ago |
|  | |

The problem here is PostFailureLinkInfo stores a copy of the CompileOptions which stores a (dangling) pointer to filename (I should have caught this in review). The patches in [bug 880538](/show_bug.cgi?id=880538 "RESOLVED FIXED - OdinMonkey: avoid parse node memory spike by LifoAlloc::release()ing after every function") stop doing this and reconstruct the CompileOptions using the filename stored in ScriptSource. That should be getting landed soon, so I'll wait until that and we can verify this problem is fixed.

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=893684#c5)• 12 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=776120&action=diff)
— [Details](attachment.cgi?id=776120&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=893684&attachment=776120)

Actually the fix is super-trivial, no need to wait for the bigger patch. I'd like to wait to land the testcase until the fix is in release, though, since this is pretty exploitable.Assignee: general → lukeStatus: NEW → ASSIGNED
[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: review?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a62716_347312)• 12 years ago |

[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: review? → review?(bbouvier)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a63919_406194)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F)Keywords: [csec-uaf](/buglist.cgi?keywords=csec-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Benjamin Bouvier [:bbouvier] (inactive)](/user_profile?user_id=468907) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=893684#c6)• 12 years ago |
|  | |

Comment on [attachment 776120](/attachment.cgi?id=776120 "fix") [[details]](/attachment.cgi?id=776120&action=edit "fix") [[diff]](/attachment.cgi?id=776120&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=893684&attachment=776120)
fix
Review of [attachment 776120](/attachment.cgi?id=776120 "fix") [[details]](/attachment.cgi?id=776120&action=edit "fix") [[diff]](/attachment.cgi?id=776120&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=893684&attachment=776120):
-----------------------------------------------------------------
Love it when patches are simple like that.
[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: review?(bbouvier) → review+

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=893684#c8)• 12 years ago |
|  | |

[Bug 880538](/show_bug.cgi?id=880538 "RESOLVED FIXED - OdinMonkey: avoid parse node memory spike by LifoAlloc::release()ing after every function") just landed on inbound - is this patch still needed?Flags: needinfo?(luke)

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=893684#c9)• 12 years ago |
|  | |

Heh, you beat me to commenting: no.Flags: needinfo?(luke)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=893684#c10)• 12 years ago |
|  | |

What does that mean for 23/24? will we want this as a smaller, lower risk fix on those branches?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=893684#c11)• 12 years ago |
|  | |

We could, if you think it is a good idea. (It having not been discovered externally yet, I was thinking landing the smaller fix only drew attention.)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=893684#c12)• 12 years ago |
|  | |

We should land the small fix.
[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)
[tracking-firefox25](/buglist.cgi?f1=cf_tracking_firefox25&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox25&o1=equals&v1=%2B)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a302861_132034)• 12 years ago |

Flags: needinfo?(luke)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a302869_1689)• 12 years ago |

[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected)Depends on: [880538](/show_bug.cgi?id=880538 "RESOLVED FIXED - OdinMonkey: avoid parse node memory spike by LifoAlloc::release()ing after every function")Whiteboard: [jsbugmon:] → [jsbugmon:] fixed on trunk in bug 880538

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=893684#c13)• 12 years ago |
|  | |

Comment on [attachment 776120](/attachment.cgi?id=776120 "fix") [[details]](/attachment.cgi?id=776120&action=edit "fix") [[diff]](/attachment.cgi?id=776120&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=893684&attachment=776120)
fix
[Approval Request Comment]
Bug caused by (feature/regressing bug #): 851421
User impact if declined: exploitable bug
Testing completed (on m-c, etc.): a bigger version of this patch is on m-c
Risk to taking this patch (and alternatives if risky): low
[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Luke Wagner [:luke]](/user_profile?user_id=347312)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a321598_347312)• 12 years ago |

[status-firefox25](/buglist.cgi?f1=cf_status_firefox25&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox25&o1=equals&v1=fixed)Flags: needinfo?(luke)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a387834_272375)• 12 years ago |

[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: approval-mozilla-beta+
[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #776120](/attachment.cgi?id=776120&action=edit "fix") -
Flags: approval-mozilla-aurora+

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a388307_132034)• 12 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=893684#c14)• 12 years ago |
|  | |

(Please land the patch only on Aurora and Beta, thanks!)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=893684#c15)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/b3aa850f03fc>
<https://hg.mozilla.org/releases/mozilla-beta/rev/aa1e0d96de39>Status: ASSIGNED → RESOLVEDClosed: 12 years ago
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Resolution: --- → FIXEDTarget Milestone: --- → mozilla25

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a989571_280903)• 12 years ago |

Whiteboard: [jsbugmon:] fixed on trunk in bug 880538 → [jsbugmon:][adv-main23+] fixed on trunk in bug 880538

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=893684#a42577955_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=893684&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_4a08ce2c_20250125_115349.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/861530)
* [XML](/show_bug.cgi?ctype=xml&id=861530)

Closed
[Bug 861530](/show_bug.cgi?id=861530)

Opened 12 years ago
Closed 12 years ago

# Assertion: "id got defined somewhere else?" with Xrays and \_content

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion: "id got defined somewhere else?" with Xrays and \_content

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla23

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox23 |  | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mccr8, Assigned: mccr8)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[865260](/show_bug.cgi?id=865260 "VERIFIED FIXED - crash in js::IsStandardClassResolved"), [868528](/show_bug.cgi?id=868528 "VERIFIED FIXED - content._content is not Xray")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=861530&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=861530)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-audit, Whiteboard: [adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-audit](/buglist.cgi?keywords=sec-audit&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [mccr8](/user_profile?user_id=406194) | [in-testsuite](#c15 "12 years ago") | + |
| --- | --- | --- |
| [mccr8](/user_profile?user_id=406194) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [handle Xrays on \_content more correctly](/attachment.cgi?id=739191)  [12 years ago](#c4)  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)   2.13 KB, patch | bholley : [review+](#c5 "12 years ago") | [Details](/attachment.cgi?id=739191&action=edit) | [Diff](/attachment.cgi?id=739191&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=861530&attachment=739191) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=861530#c0)• 12 years ago |
|  | |

At some point, the test case from 826471 started failing with this assertion (accessing \_content on a sandbox).
bholley via mail: "That Xray code ends up passing |wrapper| (an XrayWrapper) as |obj| to nsWindowSH::NewResolve, which would ordinarily expect a Window reflector. When the resolve hook defines properties on |obj|, we end up in the defineProperty hook of the XrayWrapper, which detects that we're actually mid-resolve here, and subsequently goes and defines the property on the holder. So this check is basically making sure that if the resolve hook claims to have succeeded, that the property made it safely through the whole mess and ended up on the holder.
Looking at the s\_content\_id stuff in nsDOMClassInfo.cpp, that appears to be the exact bug we're catching, since it looks like the resolve code defines the property on |windowObj|, rather than on |obj| like it's supposed to."
I don't know if this is actually a security problem or not, but it sounds sketchy.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=861530#c1)• 12 years ago |
|  | |

maybe moz\_bug\_r\_a4 or codyc can have some fun with this one.

|  | [moz\_bug\_r\_a4](/user_profile?user_id=194398) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=861530#c2)• 12 years ago |
|  | |

Could you please cc me on [bug 826471](/show_bug.cgi?id=826471 "RESOLVED FIXED - compartment mismatch in nsWindowSH::NewResolve for _content with Xrays")?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=861530#c3)• 12 years ago |
|  | |

(In reply to moz\_bug\_r\_a4 from [comment #2](/show_bug.cgi?id=861530#c2 "RESOLVED FIXED - Assertion: \"id got defined somewhere else?\" with Xrays and _content"))
> Could you please cc me on [bug 826471](/show_bug.cgi?id=826471 "RESOLVED FIXED - compartment mismatch in nsWindowSH::NewResolve for _content with Xrays")?
Done.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=861530#c4)• 12 years ago |
|  | |

Attached patch

[handle Xrays on \_content more correctly](attachment.cgi?id=739191&action=diff)
— [Details](attachment.cgi?id=739191&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=861530&attachment=739191)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=861530#a530776_406194)• 12 years ago |

[Attachment #739191](/attachment.cgi?id=739191&action=edit "handle Xrays on _content more correctly") -
Flags: review?(bobbyholley+bmo)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=861530#c5)• 12 years ago |
|  | |

Comment on [attachment 739191](/attachment.cgi?id=739191 "handle Xrays on _content more correctly") [[details]](/attachment.cgi?id=739191&action=edit "handle Xrays on _content more correctly") [[diff]](/attachment.cgi?id=739191&action=diff "handle Xrays on _content more correctly") [[review]](/page.cgi?id=splinter.html&ignore=&bug=861530&attachment=739191)
handle Xrays on \_content more correctly
Review of [attachment 739191](/attachment.cgi?id=739191 "handle Xrays on _content more correctly") [[details]](/attachment.cgi?id=739191&action=edit "handle Xrays on _content more correctly") [[diff]](/attachment.cgi?id=739191&action=diff "handle Xrays on _content more correctly") [[review]](/page.cgi?id=splinter.html&ignore=&bug=861530&attachment=739191):
-----------------------------------------------------------------
r=bholley with comment fixed or an appropriate explanation.
::: dom/base/nsDOMClassInfo.cpp
@@ +5376,5 @@
> + return NS\_ERROR\_DOM\_SECURITY\_ERR;
> + }
> + } else {
> + windowObj = obj;
> + }
Why can't this just be:
JSObject\* windowObj = js::UnwrapObjectChecked(obj, /\* stopAtOuter = \*/ false);
NS\_ENSURE\_TRUE(windowObj, NS\_ERROR\_DOM\_SECURITY\_ERROR);
?
[Attachment #739191](/attachment.cgi?id=739191&action=edit "handle Xrays on _content more correctly") -
Flags: review?(bobbyholley+bmo) → review+

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=861530#c6)• 12 years ago |
|  | |

I don't know how that ObjectIsNativeWrapper guard interacts with unwrapping, so I was just cargo culting. If you think it should be okay to do what you said, then I'll try that out and see if it works.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=861530#c7)• 12 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #6](/show_bug.cgi?id=861530#c6 "RESOLVED FIXED - Assertion: \"id got defined somewhere else?\" with Xrays and _content"))
> I don't know how that ObjectIsNativeWrapper guard interacts with unwrapping,
> so I was just cargo culting. If you think it should be okay to do what you
> said, then I'll try that out and see if it works.
ObjectIsNativeWrapper just checks if the thing is an XrayWrapper that subsumes its target. CheckedUnwrap will just unwrap wrappers unless it hits one that doesn't subsume its target. So the only difference in behavior between the two would be if |obj| was a security wrapper (one that did not subsume its target) - i.e. a cross-origin Xray wrapper. But we'd never have such a situation, because all XOWs filter before property access so they could never get to the point where they might resolve \_content. So this should be fine. And even if that case somehow happened, my proposed behavior (throwing) is certainly better than the behavior in the patch (compartment mismatch).

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=861530#c8)• 12 years ago |
|  | |

Actually, once I fix [bug 862380](/show_bug.cgi?id=862380 "RESOLVED FIXED - Enumerating cross-origin objects shouldn't throw"), it will be possible to trigger the resolution of filtered names if they get resolved in the enumerate hook. But we're still safe here, and regardless \_content isn't in nsWindowSH::Enumerate.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=861530#c9)• 12 years ago |
|  | |

What security rating would you give this, Bobby? I have no idea how bad this is.Flags: needinfo?(bobbyholley+bmo)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=861530#c10)• 12 years ago |
|  | |

I don't see an immediate security problem here.Flags: needinfo?(bobbyholley+bmo)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=861530#a951621_406194)• 12 years ago |

Keywords: [sec-audit](/buglist.cgi?keywords=sec-audit&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=861530#c11)• 12 years ago |
|  | |

I'll just land the test as part of this, too.
is(sandbox.\_content, sandbox.content, "\_content and content returned the same thing");

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=861530#c12)• 12 years ago |
|  | |

Note that I'm going to make these properties chrome-only soon: [bug 864845](/show_bug.cgi?id=864845 "RESOLVED FIXED - Make window.content chrome-only in nightly").
Can we write this test such that it won't break when that happens?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=861530#a958608_406194)• 12 years ago |

Depends on: [865260](/show_bug.cgi?id=865260 "VERIFIED FIXED - crash in js::IsStandardClassResolved")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=861530#c13)• 12 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #12](/show_bug.cgi?id=861530#c12 "RESOLVED FIXED - Assertion: \"id got defined somewhere else?\" with Xrays and _content"))
> Can we write this test such that it won't break when that happens?
The test is in test\_sandbox\_bindings.xul, which is a chrome mochitest, so IIUC that should be okay. On the other hand, my test in [bug 863390](/show_bug.cgi?id=863390 "RESOLVED FIXED - Add test for _content == content") will break, so I'll just wait until you fix [bug 864845](/show_bug.cgi?id=864845 "RESOLVED FIXED - Make window.content chrome-only in nightly").

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=861530#c14)• 12 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=832da19f3b18>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=861530#c15)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/2893ed05e739>Flags: in-testsuite+

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=861530#c16)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/2893ed05e739>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla23

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=861530#a1672157_1689)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=861530#a1736925_20209)• 12 years ago |

Depends on: [868528](/show_bug.cgi?id=868528 "VERIFIED FIXED - content._content is not Xray")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=861530#a8987844_280903)• 12 years ago |

Whiteboard: [adv-main23+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=861530#a50581544_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=861530&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_a8ff219c_20250125_115342.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2013-63

## Miscellaneous memory safety hazards (rv:23.0 / rv:17.0.8)

Announced
August 6, 2013
Reporter
Mozilla Developers
Impact
Critical
Products
Firefox, Firefox ESR, SeaMonkey, Thunderbird, Thunderbird ESR
Fixed in

* Firefox 23
* Firefox ESR 17.0.8
* SeaMonkey 2.20
* Thunderbird 17.0.8
* Thunderbird ESR 17.0.8

### Description

Mozilla developers identified and fixed several memory safety bugs in the
browser engine used in Firefox and other Mozilla-based products. Some of these
bugs showed evidence of memory corruption under certain circumstances, and we
presume that with enough effort at least some of these could be exploited to run
arbitrary code.

In general these flaws cannot be exploited through email in the
Thunderbird product because scripting is disabled, but are
potentially a risk in browser or browser-like contexts.

### References

Jeff Gilbert and Henrik Skupin reported memory safety problems and crashes
that affect Firefox ESR 17, and Firefox 22.

* [Memory safety bugs fixed in Firefox 17.0.8 and Firefox 23.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=888107,880734) ([CVE-2013-1701](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1701))

Ben Turner, Christian Holler, Andrew McCreight, Gary Kwong, Jan Varga, and Jesse Ruderman reported memory safety problems and crashes that
affect Firefox 22.

* [Memory safety bugs fixed in Firefox 23.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=855331,844088,858060,870200,874974,861530,854157,893684,878703,862185,879139) ([CVE-2013-1702](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-1702))

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_54be180e_20250126_081804.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 00:18:03 PST

* **Bug ID:**
  855331,
  844088,
  858060,
  870200,
  874974,
  861530,
  854157,
  893684,
  878703,
  862185,
  879139

---

11 bugs found.

| [ID](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [844088](/show_bug.cgi?id=844088 "RESOLVED FIXED - ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable") |  | [ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable](/show_bug.cgi?id=844088) | Core Graveyard | Identity | bholley | RESO | FIXE | 2019-02-25 |
| [861530](/show_bug.cgi?id=861530 "RESOLVED FIXED - Assertion: \"id got defined somewhere else?\" with Xrays and _content") |  | [Assertion: "id got defined somewhere else?" with Xrays and \_content](/show_bug.cgi?id=861530) | Core | XPConnect | continuation | RESO | FIXE | 2014-11-19 |
| [855331](/show_bug.cgi?id=855331 "RESOLVED FIXED - TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate") |  | [TransactionThreadPool doing sketchy things with mCompleteCallbacks array that can mutate](/show_bug.cgi?id=855331) | Core | Storage: IndexedDB | jan.varga | RESO | FIXE | 2014-05-05 |
| [878703](/show_bug.cgi?id=878703 "RESOLVED FIXED - Cleanup usage of IO thread only objects") |  | [Cleanup usage of IO thread only objects](/show_bug.cgi?id=878703) | Core | Storage: IndexedDB | jan.varga | RESO | FIXE | 2014-11-19 |
| [893684](/show_bug.cgi?id=893684 "RESOLVED FIXED - OdinMonkey: Assertion failure: (size_t) (dst - src) >= len, at jsutil.h") |  | [OdinMonkey: Assertion failure: (size\_t) (dst - src) >= len, at jsutil.h](/show_bug.cgi?id=893684) | Core | JavaScript Engine | mail | RESO | FIXE | 2014-11-19 |
| [862185](/show_bug.cgi?id=862185 "RESOLVED FIXED - Use-after-poison with -moz-column, fieldset") |  | [Use-after-poison with -moz-column, fieldset](/show_bug.cgi?id=862185) | Core | Layout | MatsPalmgren\_bugz | RESO | FIXE | 2014-10-24 |
| [879139](/show_bug.cgi?id=879139 "RESOLVED FIXED - Use-after-free with SVG animation in SVG image") |  | [Use-after-free with SVG animation in SVG image](/show_bug.cgi?id=879139) | Core | SVG | seth.bugzilla | RESO | FIXE | 2014-05-05 |
| [854157](/show_bug.cgi?id=854157 "VERIFIED FIXED - Assertion failure: regs->fp() == regs_->fp()->prev(), at vm/Stack.cpp or Assertion failure: !inline_, at vm/Stack.cpp with gcPreserveCode") |  | [Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp or Assertion failure: !inline\_, at vm/Stack.cpp with gcPreserveCode](/show_bug.cgi?id=854157) | Core | JavaScript Engine | bhackett1024 | VERI | FIXE | 2014-11-19 |
| [874974](/show_bug.cgi?id=874974 "VERIFIED FIXED - Crash [@ setStringThis] with controllable invalid read") |  | [Crash [@ setStringThis] with controllable invalid read](/show_bug.cgi?id=874974) | Core | JavaScript Engine | jdemooij | VERI | FIXE | 2014-11-19 |
| [858060](/show_bug.cgi?id=858060 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318") |  | [Assertion failure: cur->isKind(PNK\_FUNCTION), at frontend/NameFunctions.cpp:318](/show_bug.cgi?id=858060) | Core | JavaScript Engine | jorendorff | VERI | FIXE | 2014-05-05 |
| [870200](/show_bug.cgi?id=870200 "VERIFIED FIXED - Assertion failure: (ptrBits & 0x7) == 0, at ./dist/include/js/Value.h:703 or Crash [@ GetValueType]") |  | [Assertion failure: (ptrBits & 0x7) == 0, at ./dist/include/js/Value.h:703 or Crash [@ GetValueType]](/show_bug.cgi?id=870200) | Core | JavaScript Engine | kvijayan | VERI | FIXE | 2014-11-19 |

11 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=855331%2C844088%2C858060%2C870200%2C874974%2C861530%2C854157%2C893684%2C878703%2C862185%2C879139&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |



=== Content from bugzilla.mozilla.org_bb0512ce_20250125_115351.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/862185)
* [XML](/show_bug.cgi?ctype=xml&id=862185)

Closed
[Bug 862185](/show_bug.cgi?id=862185)

Opened 12 years ago
Closed 12 years ago

# Use-after-poison with -moz-column, fieldset

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Use-after-poison with -moz-column, fieldset

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla23

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) |
| firefox22 | --- | [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) |
| firefox23 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | wontfix |
| firefox22 |  | affected |
| firefox23 |  | fixed |
| firefox-esr17 |  | wontfix |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[PoisonFrameCrash](/show_bug.cgi?id=526587 "NEW - [meta] Crashes at the Poison Frame address"), [randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)")

Dependency [tree](/showdependencytree.cgi?id=862185&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=862185)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[878719](/show_bug.cgi?id=878719 "RESOLVED DUPLICATE - use-after-poison in nsLineList::empty()")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-framepoisoning](/buglist.cgi?keywords=csectype-framepoisoning&resolution=---),
[sec-other](/buglist.cgi?keywords=sec-other&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | [in-testsuite](#c11 "12 years ago") | + |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsLayoutUtils::IntrinsicForContainer ]](https://crash-stats.mozilla.org/signature/?signature=nsLayoutUtils%3A%3AIntrinsicForContainer)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 1 obsolete file)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=737793)  [12 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   253 bytes, text/html |  | [Details](/attachment.cgi?id=737793&action=edit) |
| --- | --- | --- |
| [stack (gdb)](/attachment.cgi?id=737794)  [12 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   29.95 KB, text/plain |  | [Details](/attachment.cgi?id=737794&action=edit) |
| [stack for destroying the frame](/attachment.cgi?id=738103)  [12 years ago](#c2)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   38.19 KB, text/plain |  | [Details](/attachment.cgi?id=738103&action=edit) |
| [Make nsFieldSetFrame reflow overflow container children.](/attachment.cgi?id=738107)  [12 years ago](#c3)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   3.16 KB, patch |  | [Details](/attachment.cgi?id=738107&action=edit) | [Diff](/attachment.cgi?id=738107&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738107) |
| [Make nsFieldSetFrame reflow and paint overflow container children.](/attachment.cgi?id=738216)  [12 years ago](#c4)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   4.43 KB, patch | roc : [review+](#c6 "12 years ago") | [Details](/attachment.cgi?id=738216&action=edit) | [Diff](/attachment.cgi?id=738216&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738216) |
| [Remove child frame members which may become stale and add accessors to get them from the child list instead.](/attachment.cgi?id=738220)  [12 years ago](#c5)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   22.03 KB, patch | roc : [review+](#a76138_5038 "12 years ago") | [Details](/attachment.cgi?id=738220&action=edit) | [Diff](/attachment.cgi?id=738220&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738220) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=862185#c0)• 12 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=737793)
— [Details](attachment.cgi?id=737793&action=edit)

###!!! ASSERTION: this type of frame can't have overflow containers: '(aProperty != nsContainerFrame::OverflowContainersProperty() && aProperty != nsContainerFrame::ExcessOverflowContainersProperty()) || IsFrameOfType(nsIFrame::eCanContainOverflowContainers)', file /Users/jruderman/trees/mozilla-central/layout/generic/nsContainerFrame.cpp, line 1458
Crash with nsFieldSetFrame::GetIntrinsicWidth calling nsLayoutUtils::IntrinsicForContainer.
Nightly: [bp-9f41ac48-8362-4f07-84aa-837992130416](https://crash-stats.mozilla.org/report/index/9f41ac48-8362-4f07-84aa-837992130416)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=862185#c1)• 12 years ago |
|  | |

Attached file
[stack (gdb)](attachment.cgi?id=737794)
— [Details](attachment.cgi?id=737794&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=862185#a313_11608)• 12 years ago |

Crash Signature: [@ nsLayoutUtils::IntrinsicForContainer]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=862185#c2)• 12 years ago |
|  | |

Attached file
[stack for destroying the frame](attachment.cgi?id=738103)
— [Details](attachment.cgi?id=738103&action=edit)

When we reflow a nsFieldSetFrame and its child frames are COMPLETE
their next-in-flows will be destroyed, by DeleteNextInFlowChild.
The problem is nsFieldSetFrame has frame pointer members mLegendFrame
and mContentFrame that isn't updated when such children are destroyed,
so when we reflow the nsFieldSetFrame's next-in-flow it will use
stale pointers.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=862185#a58392_5168)• 12 years ago |

Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)OS: Mac OS X → AllHardware: x86\_64 → All

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=862185#c3)• 12 years ago |
|  | |

Attached patch

[Make nsFieldSetFrame reflow overflow container children.](attachment.cgi?id=738107&action=diff) (obsolete)
— [Details](attachment.cgi?id=738107&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738107)

Assignee: nobody → matspal

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=862185#c4)• 12 years ago |
|  | |

Attached patch

[Make nsFieldSetFrame reflow and paint overflow container children.](attachment.cgi?id=738216&action=diff)
— [Details](attachment.cgi?id=738216&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738216)

[Attachment #738107](/attachment.cgi?id=738107&action=edit "Make nsFieldSetFrame reflow overflow container children.") -
Attachment is obsolete: true
[Attachment #738216](/attachment.cgi?id=738216&action=edit "Make nsFieldSetFrame reflow and paint overflow container children.") -
Flags: review?(roc)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=862185#c5)• 12 years ago |
|  | |

Attached patch

[Remove child frame members which may become stale and add accessors to get them from the child list instead.](attachment.cgi?id=738220&action=diff)
— [Details](attachment.cgi?id=738220&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738220)

<https://tbpl.mozilla.org/?tree=Try&rev=ddd01ee1e9f2>
[Attachment #738220](/attachment.cgi?id=738220&action=edit "Remove child frame members which may become stale and add accessors to get them from the child list instead.") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=862185#c6)• 12 years ago |
|  | |

Comment on [attachment 738216](/attachment.cgi?id=738216 "Make nsFieldSetFrame reflow and paint overflow container children.") [[details]](/attachment.cgi?id=738216&action=edit "Make nsFieldSetFrame reflow and paint overflow container children.") [[diff]](/attachment.cgi?id=738216&action=diff "Make nsFieldSetFrame reflow and paint overflow container children.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738216)
Make nsFieldSetFrame reflow and paint overflow container children.
Review of [attachment 738216](/attachment.cgi?id=738216 "Make nsFieldSetFrame reflow and paint overflow container children.") [[details]](/attachment.cgi?id=738216&action=edit "Make nsFieldSetFrame reflow and paint overflow container children.") [[diff]](/attachment.cgi?id=738216&action=diff "Make nsFieldSetFrame reflow and paint overflow container children.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=862185&attachment=738216):
-----------------------------------------------------------------
I think we need a reftest here
[Attachment #738216](/attachment.cgi?id=738216&action=edit "Make nsFieldSetFrame reflow and paint overflow container children.") -
Flags: review?(roc) → review+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=862185#a76138_5038)• 12 years ago |

[Attachment #738220](/attachment.cgi?id=738220&action=edit "Remove child frame members which may become stale and add accessors to get them from the child list instead.") -
Flags: review?(roc) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=862185#c7)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/440634eef3f1>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/b064ea1f6af7>
Will add a reftest when the bug is public.Flags: in-testsuite?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=862185#c8)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/440634eef3f1>
<https://hg.mozilla.org/mozilla-central/rev/b064ea1f6af7>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla23

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=862185#c9)• 12 years ago |
|  | |

The ESR 17.0.5 version of this crash is also frame poisoning (as expected): [bp-e40441a7-ca1c-4ba3-ad77-2f5032130503](https://crash-stats.mozilla.org/report/index/e40441a7-ca1c-4ba3-ad77-2f5032130503)
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=862185#a9042029_280903)• 11 years ago |

Whiteboard: [adv-main23+]

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=862185#c11)• 10 years ago |
|  | |

Landed a crashtest:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/0246c21cfc5c>Group: core-securityFlags: in-testsuite? → in-testsuite+

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=862185#c12)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/0246c21cfc5c>
You need to [log in](/show_bug.cgi?id=862185&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from blog.mozilla.org_214f5ef1_20250126_081805.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_9c979d6d_20250125_115354.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/874974)
* [XML](/show_bug.cgi?ctype=xml&id=874974)

Closed
[Bug 874974](/show_bug.cgi?id=874974)

Opened 12 years ago
Closed 12 years ago

# Crash [@ setStringThis] with controllable invalid read

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ setStringThis] with controllable invalid read

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) |
| firefox22 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | wontfix |
| firefox22 |  | wontfix |
| firefox23 | + | fixed |
| firefox24 | + | verified |
| firefox-esr17 |  | unaffected |
| b2g18 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: jandem)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/709c5feed942bf99f098bb24aa1cc86f?d=mm&size=40)  [jandem](/user_profile?user_id=375297)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [jsbugmon:update,verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17,ignore][adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-wildptr](/buglist.cgi?keywords=csectype-wildptr&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:update,verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17,ignore][adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c22 "12 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ setStringThis ]](https://crash-stats.mozilla.org/signature/?signature=setStringThis)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [[crash-signature] Machine-readable crash signature](/attachment.cgi?id=752841)  [12 years ago](#c1)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   2.07 KB, text/plain |  | [Details](/attachment.cgi?id=752841&action=edit) |
| --- | --- | --- |
| [Patch](/attachment.cgi?id=762008)  [12 years ago](#c16)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   8.59 KB, patch | bhackett1024 : [review+](#c18 "12 years ago")  abillings : [sec-approval+](#a1988410_280903 "12 years ago") | [Details](/attachment.cgi?id=762008&action=edit) | [Diff](/attachment.cgi?id=762008&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=762008) |
| [Patch for aurora](/attachment.cgi?id=764086)  [12 years ago](#c25)  [Jan de Mooij [:jandem]](/user_profile?user_id=375297)   1.02 KB, patch | bhackett1024 : [review+](#a2398649_346231 "12 years ago")  lsblakk : [approval-mozilla-aurora+](#a2600931_272375 "12 years ago") | [Details](/attachment.cgi?id=764086&action=edit) | [Diff](/attachment.cgi?id=764086&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=764086) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=874974#c0)• 12 years ago |
|  | |

The following testcase crashes on mozilla-central revision c21ef3664c67 (no options required):
var gTestcases = new Array();
var x = '';
function TestCase(n, d, e, a) {
this.bugnumber = x;
gTestcases[gTc++] = this;
TestCase.prototype.dump = function () {
this.bugnumber.toString();
}
};
function reportCompare () {
var testcase = new TestCase();
}
for ( gTc=0; gTc < gTestcases.length; gTc++ ) {}
function jsTestDriverEnd() {
for (var i = 0; i < gTestcases.length; i++)
gTestcases[i].dump();
}
for (var i = 0x0020; i < 0x007e; i++ ) {
new TestCase();
new TestCase();
new TestCase();
}
gc();
jsTestDriverEnd();
jsTestDriverEnd();
jsTestDriverEnd();
var x = 0xbeef; // Yummy!
jsTestDriverEnd();
reportCompare();
jsTestDriverEnd();

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=874974#c1)• 12 years ago |
|  | |

Attached file
[[crash-signature] Machine-readable crash signature](attachment.cgi?id=752841)
— [Details](attachment.cgi?id=752841&action=edit)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=874974#c2)• 12 years ago |
|  | |

I took the liberty to enhance this test with a little beef...
Program received signal SIGSEGV, Segmentation fault.
setStringThis (str=<error reading variable: Cannot access memory at address 0xbeef>, this=(js::StringObject \* const) 0x7ffff653b7c0 [object String]) at js/src/vm/StringObject.h:51
51 setFixedSlot(LENGTH\_SLOT, Int32Value(int32\_t(str->length())));
#0 setStringThis (str=<error reading variable: Cannot access memory at address 0xbeef>, this=(js::StringObject \* const) 0x7ffff653b7c0 [object String]) at js/src/vm/StringObject.h:51
#1 js::StringObject::init (this=<optimized out>, cx=<optimized out>, str=...) at js/src/vm/StringObject-inl.h:36
#2 0x000000000054d32f in create (newKind=js::GenericObject, str=..., cx=<optimized out>) at js/src/vm/StringObject-inl.h:48
#3 PrimitiveToObject (cx=<optimized out>, v=...) at js/src/jsobj.cpp:4848
#4 0x000000000054d44d in js::ToObjectSlow (cx=<optimized out>, val=..., reportScanStack=<optimized out>) at js/src/jsobj.cpp:4903
#5 0x000000000051118b in ToObjectFromStack (vp=$jsval(<error reading variable: Cannot access memory at address 0xbeef>), cx=0x1851730) at ../jsobj.h:1440
#6 js::GetProperty (cx=0x1851730, v=$jsval(<error reading variable: Cannot access memory at address 0xbeef>), name="toString", vp=...) at js/src/jsinterp.cpp:3284
#7 0x00007ffff67c2d5c in ?? ()
r12 0xbeef 48879
rip 0x53b037 <js::StringObject::init(JSContext\*, JS::Handle<JSString\*>)+263>
=> 0x53b037 <js::StringObject::init(JSContext\*, JS::Handle<JSString\*>)+263>: mov (%r12),%rax
This doesn't look good at all. Marking sec-critical unless shown to be less severe.Keywords: [csec-wildptr](/buglist.cgi?keywords=csec-wildptr&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)Whiteboard: [jsbugmon:update,bisect]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a6334_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,bisect] → [jsbugmon:update]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=874974#c3)• 12 years ago |
|  | |

JSBugMon: Bisection requested, result:
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 131119:0f91553baf96
user: Jan de Mooij
date: Tue May 07 16:31:25 2013 +0200
summary: [Bug 866050](/show_bug.cgi?id=866050 "RESOLVED FIXED - IonMonkey: Fix UsesBeforeIonRecompile") - Fix UsesBeforeIonRecompile. r=bhackett
This iteration took 327.746 seconds to run.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=874974#c4)• 12 years ago |
|  | |

Needinfo from Jan based on [comment 3](/show_bug.cgi?id=874974#c3 "VERIFIED FIXED - Crash [@ setStringThis] with controllable invalid read") :)Flags: needinfo?(jdemooij)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=874974#c5)• 12 years ago |
|  | |

autoBisect is wrong, the underlying bug is older.
What's happening is that in IonBuilder::getPropTryDefiniteSlot we call GetDefiniteSlot => propertyTypes->isOwnProperty => CheckNewScriptProperties and this adds an extra type (int32) to the property's heap TypeSet.
When we return to IonBuilder::getPropTryDefiniteSlot, it still thinks the GETPROP's type is definitely string and the code it generates crashes because it treats an int32 value as string pointer.
Brian, how is this supposed to work? Do we have a way to guard against this somehow?Flags: needinfo?(jdemooij) → needinfo?(bhackett1024)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=874974#c6)• 12 years ago |
|  | |

Marking flags under the assumption that this is a regression from the IonMonkey landing. Adjust as appropriate.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a168092_406194)• 12 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) → [wontfix](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=wontfix)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=874974#c7)• 12 years ago |
|  | |

(In reply to Jan de Mooij [:jandem] from [comment #5](/show_bug.cgi?id=874974#c5 "VERIFIED FIXED - Crash [@ setStringThis] with controllable invalid read"))
> autoBisect is wrong, the underlying bug is older.
>
> What's happening is that in IonBuilder::getPropTryDefiniteSlot we call
> GetDefiniteSlot => propertyTypes->isOwnProperty => CheckNewScriptProperties
> and this adds an extra type (int32) to the property's heap TypeSet.
>
> When we return to IonBuilder::getPropTryDefiniteSlot, it still thinks the
> GETPROP's type is definitely string and the code it generates crashes
> because it treats an int32 value as string pointer.
>
> Brian, how is this supposed to work? Do we have a way to guard against this
> somehow?
The freeze constraint added under PropertyReadNeedsTypeBarrier is supposed to ensure that the compilation is invalidated immediately after it finishes. It doesn't look like that is happening, and from ~AutoEnterCompilation it doesn't look like we are ever able to invalidate the currently active compilation. Nicolas, thoughts?Flags: needinfo?(bhackett1024) → needinfo?(nicolas.b.pierron)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=874974#c8)• 12 years ago |
|  | |

Assigning this to jandem, as it looks like he's investigating.Assignee: general → jdemooij

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1756988_395101)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:update,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=874974#c9)• 12 years ago |
|  | |

JSBugMon: The testcase found in this bug no longer reproduces (tried revision cc35f8929768).

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1774416_132034)• 12 years ago |

Whiteboard: [jsbugmon:update,ignore] → [jsbugmon:update,bisect]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1775665_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,bisect] → [jsbugmon:update,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=874974#c10)• 12 years ago |
|  | |

JSBugMon: The testcase found in this bug no longer reproduces (tried revision cc35f8929768).
JSBugMon: Bisection requested, result:
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: <http://hg.mozilla.org/mozilla-central/rev/0f91553baf96>
user: Jan de Mooij
date: Tue May 07 16:31:25 2013 +0200
summary: [Bug 866050](/show_bug.cgi?id=866050 "RESOLVED FIXED - IonMonkey: Fix UsesBeforeIonRecompile") - Fix UsesBeforeIonRecompile. r=bhackett
This iteration took 0.918 seconds to run.

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1795359_375297)• 12 years ago |

Whiteboard: [jsbugmon:update,ignore] → [jsbugmon:update,ignore,bisectfix]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1812823_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,ignore,bisectfix] → [jsbugmon:bisectfix]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1816962_395101)• 12 years ago |

Whiteboard: [jsbugmon:bisectfix] → [jsbugmon:]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=874974#c11)• 12 years ago |
|  | |

JSBugMon: Fix Bisection requested, result:
autoBisect shows this is probably related to the following changeset:
The first good revision is:
changeset: <http://hg.mozilla.org/mozilla-central/rev/1684c32be328>
user: Kannan Vijayan
date: Tue Jun 11 15:49:51 2013 -0400
summary: [Bug 859609](/show_bug.cgi?id=859609 "RESOLVED FIXED - IonMonkey: JSOP_CALL: Inline lambda functions.") - Inline functions that use the scope chain, and also inline call sites with monomorphic cloned lambdas. r=h4writer
This iteration took 317.084 seconds to run.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=874974#c12)• 12 years ago |
|  | |

djvj, is [bug 859609](/show_bug.cgi?id=859609 "RESOLVED FIXED - IonMonkey: JSOP_CALL: Inline lambda functions.") a possible fix?Flags: needinfo?(nicolas.b.pierron) → needinfo?(kvijayan)

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=874974#c13)• 12 years ago |
|  | |

Nope. This patch is unrelated, and simply masks the issue in this bug.Flags: needinfo?(kvijayan)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=874974#c14)• 12 years ago |
|  | |

Reverting needinfo to nbp as per [comment 7](/show_bug.cgi?id=874974#c7 "VERIFIED FIXED - Crash [@ setStringThis] with controllable invalid read").Flags: needinfo?(nicolas.b.pierron)

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=874974#c15)• 12 years ago |
|  | |

Kannan, do you know how to transform the testcase into one that still shows the bug? (Just in case fuzzing doesn't turn one up easily.)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1884869_375297)• 12 years ago |

Whiteboard: [jsbugmon:] → [jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17]

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1885855_375297)• 12 years ago |

Whiteboard: [jsbugmon:verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17] → [jsbugmon:update,verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17]

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=874974#c16)• 12 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=762008&action=diff)
— [Details](attachment.cgi?id=762008&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=762008)

There are two functions used by TI code to invalidate scripts:
(1) TypeCompartment::addPendingRecompile(JSContext \*cx, const RecompileInfo &info)
(2) AddPendingRecompile(JSContext \*cx, JSScript \*script)
The second one correctly handles invalidation during compilation by checking if there's a compiler running and if so it calls CompilerOutput::invalidate(). Ion's CodeGenerator::link checks this and aborts compilation if that's set.
However, the first method is basically a no-op during compilation, because AutoEnterCompilation sets pendingRecompilation to |true| during compilation and addPendingRecompile returns immediately in that case.
Brian, do you have any idea why we're only seeing this now? I think it should also affect aurora, beta and release.
[Attachment #762008](/attachment.cgi?id=762008&action=edit "Patch") -
Flags: review?(bhackett1024)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=874974#c17)• 12 years ago |
|  | |

And btw, we're running code based on outdated type information so this is definitely sec-critical.Flags: needinfo?(nicolas.b.pierron)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=874974#c18)• 12 years ago |
|  | |

Comment on [attachment 762008](/attachment.cgi?id=762008 "Patch") [[details]](/attachment.cgi?id=762008&action=edit "Patch") [[diff]](/attachment.cgi?id=762008&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=762008)
Patch
Review of [attachment 762008](/attachment.cgi?id=762008 "Patch") [[details]](/attachment.cgi?id=762008&action=edit "Patch") [[diff]](/attachment.cgi?id=762008&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=762008):
-----------------------------------------------------------------
This is definitely an older bug, though I don't know why it would start showing up now. Maybe 804676 made this easier to expose?
[Attachment #762008](/attachment.cgi?id=762008&action=edit "Patch") -
Flags: review?(bhackett1024) → review+

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1909396_452604)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)
[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=874974#c19)• 12 years ago |
|  | |

Comment on [attachment 762008](/attachment.cgi?id=762008 "Patch") [[details]](/attachment.cgi?id=762008&action=edit "Patch") [[diff]](/attachment.cgi?id=762008&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=762008)
Patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch? It's possible for somebody who knows what he/she is doing, but not easily.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem? No tests. There are some short comments but you could get the same info from the code with little more effort.
Which older supported branches are affected by this flaw? Release, beta, aurora. This is the first reported (fuzz) bug that triggers it though so for some reason it may be hard/impossible to trigger on older branches.
If not all supported branches, which bug introduced the flaw? -
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be? Patch won't apply to branches, but we need to backport only a small part of it, should be easy.
How likely is this patch to cause regressions; how much testing does it need? Unlikely - usual fuzz testing + a few nightlies should be enough.
[Attachment #762008](/attachment.cgi?id=762008&action=edit "Patch") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=874974#c20)• 12 years ago |
|  | |

I'm unclear of how far back we need to take this but I'll give sec-approval+ for trunk to get it onto 24 before we branch. If 23 is the only affected version (effectively), we should get a patch for it prepared.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a1988410_280903)• 12 years ago |

[Attachment #762008](/attachment.cgi?id=762008&action=edit "Patch") -
Flags: sec-approval? → sec-approval+

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=874974#c21)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/f6f5699da1fd>
I will also prepare a patch for 23.Status: NEW → ASSIGNED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=874974#c22)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/f6f5699da1fd>Status: ASSIGNED → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla24

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a2257235_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17] → [jsbugmon:update,verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=874974#c23)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically confirmed to be still valid on branch mozilla-aurora (reproduced on revision 6b40d5226c13).
JSBugMon: The testcase found in this bug does not reproduce on branch mozilla-beta (tried revision 9f0d4fe5db55).
JSBugMon: The testcase found in this bug does not reproduce on branch mozilla-release (tried revision 88ff4d1b205f).
JSBugMon: The testcase found in this bug does not reproduce on branch mozilla-esr17 (tried revision 468f2568342c).

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a2257833_395101)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=874974#c24)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [bhavana bajaj [:bajaj]](/user_profile?user_id=448925) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a2264402_448925)• 12 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=874974#c25)• 12 years ago |
|  | |

Attached patch

[Patch for aurora](attachment.cgi?id=764086&action=diff)
— [Details](attachment.cgi?id=764086&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=764086)

Minimal fix for aurora. This fixes the crash for me.
[Attachment #764086](/attachment.cgi?id=764086&action=edit "Patch for aurora") -
Flags: review?(bhackett1024)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a2398649_346231)• 12 years ago |

[Attachment #764086](/attachment.cgi?id=764086&action=edit "Patch for aurora") -
Flags: review?(bhackett1024) → review+

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=874974#c26)• 12 years ago |
|  | |

Comment on [attachment 764086](/attachment.cgi?id=764086 "Patch for aurora") [[details]](/attachment.cgi?id=764086&action=edit "Patch for aurora") [[diff]](/attachment.cgi?id=764086&action=diff "Patch for aurora") [[review]](/page.cgi?id=splinter.html&ignore=&bug=874974&attachment=764086)
Patch for aurora
[Approval Request Comment]
Bug caused by (feature/regressing bug #): Unknown, we think [bug 804676](/show_bug.cgi?id=804676 "RESOLVED FIXED - Remove dependence of Ion compilation on ScriptAnalysis::analyzeTypes") may have exposed an older bug.
User impact if declined: Security bugs, crashes.
Testing completed (on m-c, etc.): A similar patch landed on m-c.
Risk to taking this patch (and alternatives if risky): Low.
String or IDL/UUID changes made by this patch: None.
[Attachment #764086](/attachment.cgi?id=764086&action=edit "Patch for aurora") -
Flags: approval-mozilla-aurora?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a2600915_272375)• 12 years ago |

[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a2600931_272375)• 12 years ago |

[Attachment #764086](/attachment.cgi?id=764086&action=edit "Patch for aurora") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Jan de Mooij [:jandem]](/user_profile?user_id=375297)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=874974#c27)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/dbd00c459693>
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=874974#c28)• 12 years ago |
|  | |

Marking status-firefox24:verified based on [comment 24](/show_bug.cgi?id=874974#c24 "VERIFIED FIXED - Crash [@ setStringThis] with controllable invalid read").
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=verified)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a5617675_280903)• 12 years ago |

Whiteboard: [jsbugmon:update,verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17,ignore] → [jsbugmon:update,verify-branch=mozilla-aurora;mozilla-beta;mozilla-release;mozilla-esr17,ignore][adv-main23+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=874974#a47211541_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=874974&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_182dbefb_20250125_115344.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/844088)
* [XML](/show_bug.cgi?ctype=xml&id=844088)

Closed
[Bug 844088](/show_bug.cgi?id=844088)

Opened 12 years ago
Closed 12 years ago

# ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable

## Categories

### (Core Graveyard :: Identity, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Identity#Identity)

Identity
▾

Core Graveyard :: Identity
Persona / BrowserID Gecko and Firefox integration
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Identity&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Identity&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Identity)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (firefox21 unaffected, firefox22 ?, firefox23+ fixed, firefox-esr17 unaffected, b2g18+ fixed, b2g18-v1.0.1 wontfix, b2g-v1.1hd fixed)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla23

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected) |
| firefox22 | --- | [?](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=%3F) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | [+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed) |
| b2g18-v1.0.1 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=wontfix) |
| b2g-v1.1hd | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | unaffected |
| firefox22 |  | ? |
| firefox23 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 | + | fixed |
| b2g18-v1.0.1 |  | wontfix |
| b2g-v1.1hd |  | fixed |

## People

### (Reporter: decoder, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[850253](/show_bug.cgi?id=850253 "RESOLVED FIXED - Remove Off-Main-Thread XPCWrappedJS refcounting from KeyGenRunnable")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")

Dependency [tree](/showdependencytree.cgi?id=844088&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=844088)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-uaf, sec-high, Whiteboard: [asan][asan-test-failure][fixed by bug 850253][adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[asan][asan-test-failure][fixed by bug 850253][adv-main23+]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [ASan log](/attachment.cgi?id=717100)  [12 years ago](#c0)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   9.37 KB, text/plain |  | [Details](/attachment.cgi?id=717100&action=edit) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=844088#c0)• 12 years ago |
|  | |

Attached file
[ASan log](attachment.cgi?id=717100)
— [Details](attachment.cgi?id=717100&action=edit)

In several try runs I've already been observing that tests like
toolkit/identity/tests/unit/test\_jwcrypto.js
toolkit/identity/tests/unit/test\_relying\_party.js
toolkit/identity/tests/unit/test\_provisioning.js
cause ASan errors. I was however never able to reproduce it locally. Now I managed to reproduce a failure with the third test locally, using:
taskset -c 0 make -C toolkit/identity/tests/ xpcshell-tests
on an optimized build (mozilla-central 885cde564ff3). Might need to run it multiple times, but maybe the attached symbolized trace already helps to solve this issue.

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=844088#c1)• 12 years ago |
|  | |

This looks like it's just the XPCWrappedJS off the main thread bug in different clothing.

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=844088#c2)• 12 years ago |
|  | |

For the ASAN failures, how much risk do these ASAN failures pose to FF OS's use of navigator.id from a security perspective?
I'm looking to know if this is worth nominating to block or not.Flags: needinfo?(choller)

|  | [Ben Adida [:benadida]](/user_profile?user_id=411314) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=844088#c3)• 12 years ago |
|  | |

Jed and I stand ready to fix this ... except we don't know how to read these traces. Kyle: can you help us? Is this how we handled wrapped JS objects, or is it in the C++ crypto code we're using?

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=844088#c4)• 12 years ago |
|  | |

(In reply to Ben Adida [:benadida] from [comment #3](/show_bug.cgi?id=844088#c3 "RESOLVED FIXED - ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable"))
> Jed and I stand ready to fix this ... except we don't know how to read these
> traces. Kyle: can you help us? Is this how we handled wrapped JS objects, or
> is it in the C++ crypto code we're using?
I think its the same underlying issue as [bug 843923](/show_bug.cgi?id=843923 "RESOLVED FIXED - ASAN: js/xpconnect/tests/unit/test_bug608142.js triggers heap-use-after-free error") (which is being fixed in [bug 773610](/show_bug.cgi?id=773610 "RESOLVED WORKSFORME - Fix consumers that AddRef XPCWrappedJS off-main-thread")) and has nothing to do with identity.

|  | [Ben Adida [:benadida]](/user_profile?user_id=411314) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=844088#c5)• 12 years ago |
|  | |

(In reply to Kyle Huey [:khuey] (khuey@mozilla.com) from [comment #4](/show_bug.cgi?id=844088#c4 "RESOLVED FIXED - ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable"))
>
> I think its the same underlying issue as [bug 843923](/show_bug.cgi?id=843923 "RESOLVED FIXED - ASAN: js/xpconnect/tests/unit/test_bug608142.js triggers heap-use-after-free error") (which is being fixed in
> [bug 773610](/show_bug.cgi?id=773610 "RESOLVED WORKSFORME - Fix consumers that AddRef XPCWrappedJS off-main-thread")) and has nothing to do with identity.
OK, it looks to me like there is a fix in sight for this, so should we wait and see if that fix also fixes this? Or should we be more aggressive and investigate this further right away?

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=844088#c6)• 12 years ago |
|  | |

I think you should just wait and see.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a449557_1689)• 12 years ago |

Depends on: [773610](/show_bug.cgi?id=773610 "RESOLVED WORKSFORME - Fix consumers that AddRef XPCWrappedJS off-main-thread")Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=844088#c7)• 12 years ago |
|  | |

(In reply to Jason Smith [:jsmith] from [comment #2](/show_bug.cgi?id=844088#c2 "RESOLVED FIXED - ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable"))
> For the ASAN failures, how much risk do these ASAN failures pose to FF OS's
> use of navigator.id from a security perspective?
>
> I'm looking to know if this is worth nominating to block or not.
Shouldn't block, but you'll eventually want the fix when we have one.Flags: needinfo?(choller)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a450117_432443)• 12 years ago |

[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a1218486_272375)• 12 years ago |

[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%2B)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=844088#c8)• 12 years ago |
|  | |

Assigning to bholley so he can mark it fixed when [bug 772610](/show_bug.cgi?id=772610 "RESOLVED WONTFIX - results.py shouldn't say \"Graph server unreachable\" when the test name isn't recognised") lands (assuming that turns out to do the trick).Assignee: nobody → bobbyholley+bmoKeywords: [csec-uaf](/buglist.cgi?keywords=csec-uaf&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=844088#c9)• 12 years ago |
|  | |

More precisely, it appears that [bug 850253](/show_bug.cgi?id=850253 "RESOLVED FIXED - Remove Off-Main-Thread XPCWrappedJS refcounting from KeyGenRunnable") should fix this.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=844088#c10)• 12 years ago |
|  | |

decoder, now that [bug 850253](/show_bug.cgi?id=850253 "RESOLVED FIXED - Remove Off-Main-Thread XPCWrappedJS refcounting from KeyGenRunnable") has landed on central, can you make sure that this doesn't happen any more? Thanks!Flags: needinfo?(choller)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=844088#c11)• 12 years ago |
|  | |

Several try runs haven't shown the issue anymore, confirming as fixed :)Status: NEW → RESOLVEDClosed: 12 years agoFlags: needinfo?(choller)Resolution: --- → FIXED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a4931042_395101)• 12 years ago |

Blocks: [asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a4931648_406194)• 12 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a4931680_406194)• 12 years ago |

No longer depends on: [773610](/show_bug.cgi?id=773610 "RESOLVED WORKSFORME - Fix consumers that AddRef XPCWrappedJS off-main-thread")Whiteboard: [asan][asan-test-failure] → [asan][asan-test-failure][fixed by bug 850253]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=844088#c12)• 12 years ago |
|  | |

Does this need to be fixed on prior branches? I don't think the identity code is enabled anywhere shipping, is it?
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=%3F)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)Depends on: [850253](/show_bug.cgi?id=850253 "RESOLVED FIXED - Remove Off-Main-Thread XPCWrappedJS refcounting from KeyGenRunnable")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=844088#c13)• 12 years ago |
|  | |

oh, b2g18 has this though.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=%3F)

|  | [Jason Smith [:jsmith]](/user_profile?user_id=432443) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=844088#c14)• 12 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #13](/show_bug.cgi?id=844088#c13 "RESOLVED FIXED - ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable"))
> oh, b2g18 has this though.
Right. B2G Identity is enabled on b2g18 and b2g18v1.01. Given [comment 7](/show_bug.cgi?id=844088#c7 "RESOLVED FIXED - ASAN: Several xpcshell tests in toolkit/identity trigger use-after-free, involving KeyGenRunnable") doesn't indicate this is a blocker, I'd suggest nominating the dependency here ([bug 850253](/show_bug.cgi?id=850253 "RESOLVED FIXED - Remove Off-Main-Thread XPCWrappedJS refcounting from KeyGenRunnable")) for approval b2g18 to uplift this fix.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected)
[status-b2g18-v1.0.1](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g18_1_0_1&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a13320640_280903)• 12 years ago |

Whiteboard: [asan][asan-test-failure][fixed by bug 850253] → [asan][asan-test-failure][fixed by bug 850253][adv-main23+]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=844088#c15)• 11 years ago |
|  | |

[Bug 850253](/show_bug.cgi?id=850253 "RESOLVED FIXED - Remove Off-Main-Thread XPCWrappedJS refcounting from KeyGenRunnable") landed on b2g18.
<https://hg.mozilla.org/releases/mozilla-b2g18/rev/2d1fe68319cc>
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=844088#c16)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g18_v1_1_0_hd/rev/bb1ba0f59b31>
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=fixed)Target Milestone: --- → mozilla23

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a37797174_1689)• 11 years ago |

Group: core-security

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=844088#a189572109_546015)• 6 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=844088&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_ec2313bb_20250125_115348.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/858060)
* [XML](/show_bug.cgi?ctype=xml&id=858060)

Closed
[Bug 858060](/show_bug.cgi?id=858060)

Opened 12 years ago
Closed 12 years ago

# Assertion failure: cur->isKind(PNK\_FUNCTION), at frontend/NameFunctions.cpp:318

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: cur->isKind(PNK\_FUNCTION), at frontend/NameFunctions.cpp:318

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected) |
| firefox22 | [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox24 | [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | unaffected |
| firefox22 | + | wontfix |
| firefox23 | + | fixed |
| firefox24 | + | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: jorendorff)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [jsbugmon:update,ignore][adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:update,ignore][adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c20 "12 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 4 obsolete files)

| [Quick fix](/attachment.cgi?id=733412)  [12 years ago](#c5)  [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505)   895 bytes, patch | jorendorff : [review+](#a115400_281791 "12 years ago") | [Details](/attachment.cgi?id=733412&action=edit) | [Diff](/attachment.cgi?id=733412&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=733412) |
| --- | --- | --- |
| [Updated fix](/attachment.cgi?id=753568)  [12 years ago](#c10)  [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505)   1.65 KB, patch | decoder : [feedback-](#a4311817_395101 "12 years ago") | [Details](/attachment.cgi?id=753568&action=edit) | [Diff](/attachment.cgi?id=753568&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=753568) |
| [[crash-signature] Machine-readable crash signature](/attachment.cgi?id=754432)  [12 years ago](#c15)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   533 bytes, text/plain |  | [Details](/attachment.cgi?id=754432&action=edit) |
| [Updated fix](/attachment.cgi?id=756875)  [12 years ago](#c16)  [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505)   2.91 KB, patch |  | [Details](/attachment.cgi?id=756875&action=edit) | [Diff](/attachment.cgi?id=756875&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=756875) |
| [Updated fix](/attachment.cgi?id=756876)  [12 years ago](#c17)  [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505)   2.90 KB, patch | jorendorff : [review+](#c18 "12 years ago") | [Details](/attachment.cgi?id=756876&action=edit) | [Diff](/attachment.cgi?id=756876&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=756876) |
| [Updated fix](/attachment.cgi?id=757053)  [12 years ago](#c19)  [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505)   2.96 KB, patch | jorendorff : [review+](#a5357186_281791 "12 years ago")  lsblakk : [approval-mozilla-aurora+](#a8475016_272375 "12 years ago")  lsblakk : [approval-mozilla-beta+](#a8475016_272375 "12 years ago") | [Details](/attachment.cgi?id=757053&action=edit) | [Diff](/attachment.cgi?id=757053&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=757053) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=858060#c0)• 12 years ago |
|  | |

The following testcase asserts on mozilla-central revision c232bec6974d (no options required):
g("module 'foo' {}");
function g(x) {
eval(x, g.escaped);
}

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a171_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,bisect]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a3224_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,bisect] → [jsbugmon:update]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=858060#c1)• 12 years ago |
|  | |

JSBugMon: Bisection requested, result:
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 122483:ec8547a266b7
user: Eddy Bruel
date: Wed Feb 20 20:49:41 2013 +0100
summary: [Bug 568953](/show_bug.cgi?id=568953 "NEW - [meta] ES6 modules") - Parser support for module declarations; r=jorendorff
This iteration took 123.577 seconds to run.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=858060#c2)• 12 years ago |
|  | |

Needinfo based on [comment 1](/show_bug.cgi?id=858060#c1 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318") :)Flags: needinfo?(ejpbruel)

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=858060#c3)• 12 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #2](/show_bug.cgi?id=858060#c2 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318"))
> Needinfo based on [comment 1](/show_bug.cgi?id=858060#c1 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318") :)
Needstacktrace based on needinfo :-)Flags: needinfo?(ejpbruel)

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=858060#c4)• 12 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #2](/show_bug.cgi?id=858060#c2 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318"))
> Needinfo based on [comment 1](/show_bug.cgi?id=858060#c1 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318") :)
Looking at that test, my hunch is that the assertion is wrong. I'll look into it in a sec.

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=858060#c5)• 12 years ago |
|  | |

Attached patch

[Quick fix](attachment.cgi?id=733412&action=diff) (obsolete)
— [Details](attachment.cgi?id=733412&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=733412)

That assertion is wrong. PN\_CODE used to be PN\_FUNCTION. It has been changed because it can now refer to modules as well as functions, but we still have places in the code where we explicitly assert that the parse node kind is PNK\_FUNCTION.
I've attached a one-liner fix to remedy the problem.
[Attachment #733412](/attachment.cgi?id=733412&action=edit "Quick fix") -
Flags: review?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a115400_281791)• 12 years ago |

[Attachment #733412](/attachment.cgi?id=733412&action=edit "Quick fix") -
Flags: review?(jorendorff) → review+

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=858060#c6)• 12 years ago |
|  | |

Marking s-s and sec-critical because the following test triggers the same assertion but trips a "use-after-poison" in AddressSanitizer builds (indicating a use-after-free involving one of the internal JS allocators):
Math=1;
module 'foo' {}
The trace is this:
==2921== ERROR: AddressSanitizer: use-after-poison on address 0x60720000da8e at pc 0x8c75c7 bp 0x7fffccee5e70 sp 0x7fffccee5e68
READ of size 1 at 0x60720000da8e thread T0
#0 0x8c75c6 in js::frontend::FunctionBox::useAsmOrInsideUseAsm() const /srv/repos/mozilla-central/js/src/frontend/SharedContext.h:235
#1 0x887dda in js::frontend::CompileScript(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JSScript\*>, JS::CompileOptions const&, unsigned short const\*, unsigned long, JSString\*, unsigned int, js::SourceCompressionToken\*) /srv/repos/mozilla-central/js/src/frontend/BytecodeCompiler.cpp:203
#2 0x476ae2 in JS::Compile(JSContext\*, JS::Handle<JSObject\*>, JS::CompileOptions, unsigned short const\*, unsigned long) /srv/repos/mozilla-central/js/src/jsapi.cpp:5327
#3 0x476ee9 in JS::Compile(JSContext\*, JS::Handle<JSObject\*>, JS::CompileOptions, \_IO\_FILE\*) /srv/repos/mozilla-central/js/src/jsapi.cpp:5354
#4 0x43843f in Process(JSContext\*, JSObject\*, char const\*, bool) /srv/repos/mozilla-central/js/src/shell/js.cpp:464
#5 0x435f5c in ProcessArgs(JSContext\*, JSObject\*, js::cli::OptionParser\*) /srv/repos/mozilla-central/js/src/shell/js.cpp:5111
#6 0x4371d1 in main /srv/repos/mozilla-central/js/src/shell/js.cpp:5385
#7 0x7f690fc2176c in \_\_libc\_start\_main /build/buildd/eglibc-2.15/csu/libc-start.c:226
#8 0x434c84 in \_start ??:0
0x60720000da8e is located 398 bytes inside of 4096-byte region [0x60720000d900,0x60720000e900)
allocated by thread T0 here:
#0 0x42a0b2 in malloc ??:0
#1 0x961ae2 in js\_malloc(unsigned long) /srv/repos/mozilla-central/js/src/opt64asan/./dist/include/js/Utility.h:150Group: core-securityKeywords: [csec-uaf](/buglist.cgi?keywords=csec-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=858060#c7)• 12 years ago |
|  | |

Does [comment 6](/show_bug.cgi?id=858060#c6 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318") have the same regression window as [comment 1](/show_bug.cgi?id=858060#c1 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318")? Marking flags based on [comment 1](/show_bug.cgi?id=858060#c1 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318").Assignee: general → ejpbruel
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=unaffected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a1917825_272375)• 12 years ago |

[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%2B)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=858060#c8)• 12 years ago |
|  | |

Pinged Eddy to find out latest status.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=858060#c9)• 12 years ago |
|  | |

Perhaps this can land? (Feel free to set checkin-needed if this is ready)Flags: needinfo?(ejpbruel)

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=858060#c10)• 12 years ago |
|  | |

Attached patch

[Updated fix](attachment.cgi?id=753568&action=diff) (obsolete)
— [Details](attachment.cgi?id=753568&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=753568)

I've updated the fix. Note that the bytecode emitter cannot handle parse nodes of kind PNK\_MODULE yet, so we need to avoid an assertion there as well.
This should fix the assertion errors, but I have no idea if it will also fix the memory issue from [comment #6](/show_bug.cgi?id=858060#c6 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318") (it shouldn't, afaict). I tried to confirm that for myself, but I need a Clang build with ASAN support to test it.
The Clang version that ships with OS X doesn't have ASAN support yet, so I had to make a custom build. Unfortunately, that custom build causes build errors when trying to build SpiderMonkey with it.
Decoder said he would look into my fix and see if he could confirm whether or not this fixes the problem. If not, we need to find some way for me to build SpiderMonkey with ASAN support.
[Attachment #733412](/attachment.cgi?id=733412&action=edit "Quick fix") -
Attachment is obsolete: true
[Attachment #753568](/attachment.cgi?id=753568&action=edit "Updated fix") -
Flags: review?(jorendorff)
[Attachment #753568](/attachment.cgi?id=753568&action=edit "Updated fix") -
Flags: feedback?(choller)Flags: needinfo?(ejpbruel)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=858060#c11)• 12 years ago |
|  | |

I just confirmed that the use-after-poison is \*not\* gone with the patch. I also tried a regular opt-build with Valgrind and I see this:
==24262== Invalid read of size 1
==24262== at 0x82103CB: bool js::frontend::FoldConstants<js::frontend::FullParseHandler>(JSContext\*, js::frontend::FullParseHandler::Node\*, js::frontend::Parser<js::frontend::FullParseHandler>\*, bool, bool) (SharedContext.h:235)
==24262== by 0x81FD985: js::frontend::CompileScript(JSContext\*, JS::Handle<JSObject\*>, JS::Handle<JSScript\*>, JS::CompileOptions const&, unsigned short const\*, unsigned int, JSString\*, unsigned int, js::SourceCompressionToken\*) (BytecodeCompiler.cpp:207)
==24262== by 0xFE93334B: ???
==24262== Address 0x9a6442a is 266 bytes inside a block of size 4,096 alloc'd
==24262== at 0x4ADEE68: malloc (in /usr/lib/valgrind/vgpreload\_memcheck-x86-linux.so)
==24262== by 0x8247E09: js::LifoAlloc::getOrCreateChunk(unsigned int) (Utility.h:152)
==24262== by 0xFE9333FB: ???
Haven't tried a debug build yet with the fix but it's likely that you can reproduce the issue there with Valgrind.. Maybe that makes it more actionable for you right now?Flags: needinfo?(ejpbruel)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a4311817_395101)• 12 years ago |

[Attachment #753568](/attachment.cgi?id=753568&action=edit "Updated fix") -
Flags: feedback?(choller) → feedback-

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=858060#c12)• 12 years ago |
|  | |

(In reply to Christian Holler (:decoder) from [comment #11](/show_bug.cgi?id=858060#c11 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318"))
> I just confirmed that the use-after-poison is \*not\* gone with the patch. I
> also tried a regular opt-build with Valgrind and I see this:
>
>
> ==24262== Invalid read of size 1
> ==24262== at 0x82103CB: bool
> js::frontend::FoldConstants<js::frontend::FullParseHandler>(JSContext\*,
> js::frontend::FullParseHandler::Node\*,
> js::frontend::Parser<js::frontend::FullParseHandler>\*, bool, bool)
> (SharedContext.h:235)
> ==24262== by 0x81FD985: js::frontend::CompileScript(JSContext\*,
> JS::Handle<JSObject\*>, JS::Handle<JSScript\*>, JS::CompileOptions const&,
> unsigned short const\*, unsigned int, JSString\*, unsigned int,
> js::SourceCompressionToken\*) (BytecodeCompiler.cpp:207)
> ==24262== by 0xFE93334B: ???
> ==24262== Address 0x9a6442a is 266 bytes inside a block of size 4,096
> alloc'd
> ==24262== at 0x4ADEE68: malloc (in
> /usr/lib/valgrind/vgpreload\_memcheck-x86-linux.so)
> ==24262== by 0x8247E09: js::LifoAlloc::getOrCreateChunk(unsigned int)
> (Utility.h:152)
> ==24262== by 0xFE9333FB: ???
>
>
> Haven't tried a debug build yet with the fix but it's likely that you can
> reproduce the issue there with Valgrind.. Maybe that makes it more
> actionable for you right now?
Are you sure this particular regression was introduced by the same changeset as the one in [comment #1](/show_bug.cgi?id=858060#c1 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318")? I have a hunch that the problem was introduced by a later changeset, extending one subclass of SharedContext with a field, but not the other.Flags: needinfo?(ejpbruel)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=858060#c13)• 12 years ago |
|  | |

(In reply to Eddy Bruel [:ejpbruel] from [comment #12](/show_bug.cgi?id=858060#c12 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318"))
> Are you sure this particular regression was introduced by the same changeset
> as the one in [comment #1](/show_bug.cgi?id=858060#c1 "VERIFIED FIXED - Assertion failure: cur->isKind(PNK_FUNCTION), at frontend/NameFunctions.cpp:318")?
No, I am not. The only reason why I listed this here is that the second test triggered this assertion in a debug build and in an opt build the invalid read/use-after-poison so I assumed they are connected, especially because the test is so small.
If this issue shouldn't be fixed in this bug, then we should clone the bug and fix the problem there.

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=858060#c14)• 12 years ago |
|  | |

Oh, I think I found the issue! There is another place in frontend/FoldConstants.cpp:267 where we assume that if a parse node has kind PN\_CODE, it must be a function, which is no longer true.
I don't have time to write up a patch right now, but I can do so later today. I'm still operating blind however, so I'd need decoder to double check if this fixes the issue.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=858060#c15)• 12 years ago |
|  | |

Attached file
[[crash-signature] Machine-readable crash signature](attachment.cgi?id=754432)
— [Details](attachment.cgi?id=754432&action=edit)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a4860001_132034)• 12 years ago |

[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected)Flags: needinfo?(ejpbruel)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a4860013_132034)• 12 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a4860036_280903)• 12 years ago |

[tracking-firefox24](/buglist.cgi?f1=cf_tracking_firefox24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox24&o1=equals&v1=%2B)

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=858060#c16)• 12 years ago |
|  | |

Attached patch

[Updated fix](attachment.cgi?id=756875&action=diff) (obsolete)
— [Details](attachment.cgi?id=756875&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=756875)

[Attachment #753568](/attachment.cgi?id=753568&action=edit "Updated fix") -
Attachment is obsolete: true
[Attachment #753568](/attachment.cgi?id=753568&action=edit "Updated fix") -
Flags: review?(jorendorff)
[Attachment #756875](/attachment.cgi?id=756875&action=edit "Updated fix") -
Flags: review?(jorendorff)Flags: needinfo?(ejpbruel)

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=858060#c17)• 12 years ago |
|  | |

Attached patch

[Updated fix](attachment.cgi?id=756876&action=diff) (obsolete)
— [Details](attachment.cgi?id=756876&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=756876)

Slightly nicer fix.
Hopefully, this catches all the places where we need to check if a code node is a function or a module now.
[Attachment #756875](/attachment.cgi?id=756875&action=edit "Updated fix") -
Attachment is obsolete: true
[Attachment #756875](/attachment.cgi?id=756875&action=edit "Updated fix") -
Flags: review?(jorendorff)
[Attachment #756876](/attachment.cgi?id=756876&action=edit "Updated fix") -
Flags: review?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=858060#c18)• 12 years ago |
|  | |

Comment on [attachment 756876](/attachment.cgi?id=756876 "Updated fix") [[details]](/attachment.cgi?id=756876&action=edit "Updated fix") [[diff]](/attachment.cgi?id=756876&action=diff "Updated fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=756876)
Updated fix
Review of [attachment 756876](/attachment.cgi?id=756876 "Updated fix") [[details]](/attachment.cgi?id=756876&action=edit "Updated fix") [[diff]](/attachment.cgi?id=756876&action=diff "Updated fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=756876):
-----------------------------------------------------------------
::: js/src/frontend/BytecodeEmitter.cpp
@@ +6024,5 @@
> JS\_ASSERT(pn->getArity() == PN\_NULLARY);
> break;
>
> + case PNK\_MODULE:
> + return true; // TODO: Add emitter support for modules
This has to report a SyntaxError or something, right? It can't just return true; we would allow module syntax but ignore it.
[Attachment #756876](/attachment.cgi?id=756876&action=edit "Updated fix") -
Flags: review?(jorendorff) → review+

|  | [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=858060#c19)• 12 years ago |
|  | |

Attached patch

[Updated fix](attachment.cgi?id=757053&action=diff)
— [Details](attachment.cgi?id=757053&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=757053)

Fair enough on the syntax error. Here is a new patch with that comment addressed.
Decoder, could you please confirm that this patch fixes the problem? It looks fine on my machine, but I'd like to be absolutely sure.
Jorendorff, I'll be on PTO for the next 3 weeks, so could you make sure that this gets landed, or hand it off to someone else if you are too busy?
I've also informed my manager about this bug, just in case.
[Attachment #756876](/attachment.cgi?id=756876&action=edit "Updated fix") -
Attachment is obsolete: true
[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: review?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a5357186_281791)• 12 years ago |

[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: review?(jorendorff) → review+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=858060#c20)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/2bd3d9bbd722>Status: NEW → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla24

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a5534437_395101)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:update,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=858060#c21)• 12 years ago |
|  | |

JSBugMon: The testcase found in this bug no longer reproduces (tried revision 6f32011a27ef).

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a5536549_395101)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=858060#c22)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=858060#c23)• 12 years ago |
|  | |

Jorendorff was goiong to look into the branch uplifts here.Assignee: ejpbruel → jorendorff

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=858060#c24)• 12 years ago |
|  | |

This is a wontfix for FF22 at this point - sorry, but this didn't make it into our final beta.
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=858060#c25)• 12 years ago |
|  | |

Emailed jorendorff to ask about an uplift nom for FF23Flags: needinfo?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=858060#c26)• 12 years ago |
|  | |

Comment on [attachment 757053](/attachment.cgi?id=757053 "Updated fix") [[details]](/attachment.cgi?id=757053&action=edit "Updated fix") [[diff]](/attachment.cgi?id=757053&action=diff "Updated fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=858060&attachment=757053)
Updated fix
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 568953](/show_bug.cgi?id=568953 "NEW - [meta] ES6 modules")
User impact if declined: likely remote execution vulnerability
Testing completed (on m-c, etc.): has baked on m-c for a few weeks now
Risk to taking this patch (and alternatives if risky): minimal
String or IDL/UUID changes made by this patch: none
[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: approval-mozilla-beta?
[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: approval-mozilla-aurora?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a8226854_281791)• 12 years ago |

Flags: needinfo?(jorendorff)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a8475016_272375)• 12 years ago |

[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: approval-mozilla-beta?
[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: approval-mozilla-beta+
[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: approval-mozilla-aurora?
[Attachment #757053](/attachment.cgi?id=757053&action=edit "Updated fix") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=858060#c27)• 12 years ago |
|  | |

This landed on m-c during the Fx24 cycle.
<https://hg.mozilla.org/releases/mozilla-beta/rev/64823c2294bf>
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a9776604_280903)• 12 years ago |

Whiteboard: [jsbugmon:update,ignore] → [jsbugmon:update,ignore][adv-main23+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=858060#a34253119_1689)• 11 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=858060&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Eddy Bruel [:ejpbruel]](/user_profile?user_id=417505)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_6a970abe_20250125_115352.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/870200)
* [XML](/show_bug.cgi?ctype=xml&id=870200)

Closed
[Bug 870200](/show_bug.cgi?id=870200)

Opened 12 years ago
Closed 12 years ago

# Assertion failure: (ptrBits & 0x7) == 0, at ./dist/include/js/Value.h:703 or Crash [@ GetValueType]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: (ptrBits & 0x7) == 0, at ./dist/include/js/Value.h:703 or Crash [@ GetValueType]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla24

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix) |
| firefox22 | [-](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix) |
| firefox23 | [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) |
| firefox24 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |
| b2g-v1.1hd | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=unaffected) |
| b2g-v1.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox21 |  | wontfix |
| firefox22 | - | wontfix |
| firefox23 | + | fixed |
| firefox24 |  | fixed |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| b2g-v1.1hd |  | unaffected |
| b2g-v1.2 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: djvj)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/55e0476b8efe4fd21a03a662d86e3578?d=mm&size=40)  [djvj](/user_profile?user_id=436087)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [jsbugmon:update][adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:update][adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [djvj](/user_profile?user_id=436087) | [in-testsuite](#a3508119_436087 "12 years ago") | ? |
| --- | --- | --- |
| [djvj](/user_profile?user_id=436087) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ GetValueType ]](https://crash-stats.mozilla.org/signature/?signature=GetValueType)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [[crash-signature] Machine-readable crash signature](/attachment.cgi?id=747255)  [12 years ago](#c1)  [Christian Holler (:decoder)](/user_profile?user_id=395101)   1.54 KB, text/plain |  | [Details](/attachment.cgi?id=747255&action=edit) |
| --- | --- | --- |
| [Hacky fix](/attachment.cgi?id=752990)  [12 years ago](#c6)  [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)   995 bytes, patch |  | [Details](/attachment.cgi?id=752990&action=edit) | [Diff](/attachment.cgi?id=752990&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=870200&attachment=752990) |
| [Fix](/attachment.cgi?id=753328)  [12 years ago](#c8)  [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)   3.81 KB, patch | bhackett1024 : [review+](#c9 "12 years ago")  lsblakk : [approval-mozilla-beta+](#a5227725_272375 "12 years ago") | [Details](/attachment.cgi?id=753328&action=edit) | [Diff](/attachment.cgi?id=753328&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=870200&attachment=753328) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=870200#c0)• 12 years ago |
|  | |

The following testcase asserts on mozilla-central revision e19d0885977c (run with --ion-eager):
function getter(a, i) {
return a[i];
}
function foo(... a) {
res = 0;
for (var j = 0; j < 100 ; j++) {
res += getter(a, j);
}
}
var n = 100;
var a = Array(n);
var q = foo(a, n);

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=870200#c1)• 12 years ago |
|  | |

Attached file
[[crash-signature] Machine-readable crash signature](attachment.cgi?id=747255)
— [Details](attachment.cgi?id=747255&action=edit)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=870200#c2)• 12 years ago |
|  | |

Pretty sure there's something going wrong in memory here, in a 32 bit build I don't get the assert but get the crash directly even in a debug build.Crash Signature: [@ GetValueType]Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Whiteboard: [jsbugmon:update,bisect]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a2479_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,bisect] → [jsbugmon:update]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=870200#c3)• 12 years ago |
|  | |

JSBugMon: Bisection requested, result:
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 127209:ed51ae24fee2
user: Kannan Vijayan
date: Wed Jan 30 12:09:10 2013 -0500
summary: [Bug 805877](/show_bug.cgi?id=805877 "RESOLVED FIXED - BaselineCompiler: Implement OSR between Baseline <=> Ion") - Bailout from Ion to Baseline. r=jandem
This iteration took 128.277 seconds to run.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=870200#c4)• 12 years ago |
|  | |

This assertion looks bad, so I'm marking it sec-high. Could you maybe look at this djvj?Flags: needinfo?(kvijayan)Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=870200#c5)• 12 years ago |
|  | |

What's happening here is that Ion is compiling |getter| (it compiles once and then invalidates, and then recompiles), but the LoadElement operation it uses for the |a[i]| expression is typed as Object during the second compile. However, |a| in that context is actually the composed array: [Array(n), n] captured by the rest-arg call to |foo| (n=100 in this case). When |j=1|, the LoadElement is loading the second value in the array (the integer n) as if it were an object.
Tracked it down some more. The TypeObject being assigned the created rest-argument array is happening after the array is created:
111578: BEGIN\_CASE(JSOP\_REST)
111578: {
111578: RootedObject &rest = rootObject0;
111578: rest = regs.fp()->createRestParameter(cx);
111578: if (!rest)
111578: goto error;
111578: PUSH\_COPY(ObjectValue(\*rest));
120931: if (!SetInitializerObjectType(cx, script, regs.pc, rest, GenericObject))
111578: goto error;
120931: rootType0 = GetTypeCallerInitObject(cx, JSProto\_Array);
120931: if (!rootType0)
120931: goto error;
120931: rest->setType(rootType0);
111578: }
111578: END\_CASE(JSOP\_REST)
Also weird, |SetInitializerObjectType| is expected to initialize |rest|'s type. But this code additionally gets another TypeObject via |GetTypeCallerInitObject| and resets rest's type again.
I don't know what the intent is here.
Terrence: The 'hg blame' for the lines with the TypeObject changes point to one of your pushes. Can you explain the intent of the type code here? Why do we re-set the type on |rest| when |SetInitializerObjectType| should have already done it?Flags: needinfo?(kvijayan) → needinfo?(terrence)

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=870200#c6)• 12 years ago |
|  | |

Attached patch

[Hacky fix](attachment.cgi?id=752990&action=diff) (obsolete)
— [Details](attachment.cgi?id=752990&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=870200&attachment=752990)

This patch "solves" the issue, but in a horrible way. It just manually loops around the array after it's been created and the type set, and calls the type update routine for every value in the array.
Presumably there's a better way of doing this, and it probably involves changing |StackFrame::createRestParameter| to calculate the type, set it, and ensure that all value types are updated.
This is a good opportunity to clean up the JSOP\_REST handling in the interpreter too, so I'll look in to that.
In the meantime, this patch makes the crash go away.

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=870200#c7)• 12 years ago |
|  | |

Good find! This looks like fallout from moving singleton selection into the allocator.
So, the problem we had before was that we would update an object to be a singleton /after/ allocating it; however, we need all singletons to start tenured because they can get baked into jit code. To solve this, I munged all sites that could be singletons to pass SingletonObject in this case.
When Benjamin added JSOP\_REST, he (quite reasonably) copied the array initialization code directly from JSOP\_NEWARRAY. In the case of JSOP\_NEWARRAY, we may want to create the array as a singleton -- the UseNewTypeForInitializer call in that opcode checks this. For JSOP\_REST, however, we probably never want this. Since I needed to change the code anyway, Brian had me update this site to never create the rest array as Singleton.
Given that this code is a horrid amalgam of two separate cargo cultings, I expect it is probably just wrong.Flags: needinfo?(terrence)

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=870200#c8)• 12 years ago |
|  | |

Attached patch

[Fix](attachment.cgi?id=753328&action=diff)
— [Details](attachment.cgi?id=753328&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=870200&attachment=753328)

Fix modifies |StackFrame::createRestParameter| to also do the TypeObject initialization for the created array.
[Attachment #752990](/attachment.cgi?id=752990&action=edit "Hacky fix") -
Attachment is obsolete: true
[Attachment #753328](/attachment.cgi?id=753328&action=edit "Fix") -
Flags: review?(bhackett1024)

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=870200#c9)• 12 years ago |
|  | |

Comment on [attachment 753328](/attachment.cgi?id=753328 "Fix") [[details]](/attachment.cgi?id=753328&action=edit "Fix") [[diff]](/attachment.cgi?id=753328&action=diff "Fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=870200&attachment=753328)
Fix
Review of [attachment 753328](/attachment.cgi?id=753328 "Fix") [[details]](/attachment.cgi?id=753328&action=edit "Fix") [[diff]](/attachment.cgi?id=753328&action=diff "Fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=870200&attachment=753328):
-----------------------------------------------------------------
::: js/src/vm/Stack.cpp
@@ +244,5 @@
> + obj->setType(type);
> +
> + /\* Ensure that values in the rest array are represented in the type of the array. \*/
> + for (unsigned i = 0; i < nrest; i++)
> + types::AddTypePropertyId(cx, obj, JSID\_VOID, restvp[i]);
It might be simpler to just drop this block and the GetTypeCallerInitObject stuff above, so that the array retains its generic type and has unknown properties. Barriers will be needed when reading from the array, but that's no worse than what we do for arguments accesses.
[Attachment #753328](/attachment.cgi?id=753328&action=edit "Fix") -
Flags: review?(bhackett1024) → review+

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=870200#c10)• 12 years ago |
|  | |

(In reply to Brian Hackett (:bhackett) from [comment #9](/show_bug.cgi?id=870200#c9 "VERIFIED FIXED - Assertion failure: (ptrBits & 0x7) == 0, at ./dist/include/js/Value.h:703 or Crash [@ GetValueType]"))
> ::: js/src/vm/Stack.cpp
> @@ +244,5 @@
> > + obj->setType(type);
> > +
> > + /\* Ensure that values in the rest array are represented in the type of the array. \*/
> > + for (unsigned i = 0; i < nrest; i++)
> > + types::AddTypePropertyId(cx, obj, JSID\_VOID, restvp[i]);
>
> It might be simpler to just drop this block and the GetTypeCallerInitObject
> stuff above, so that the array retains its generic type and has unknown
> properties. Barriers will be needed when reading from the array, but that's
> no worse than what we do for arguments accesses.
I like the idea of leaving them in. It's reasonable to guess that at least in some cases, we will see stable type patterns for the rest arguments arrays. Would be nice to catch those.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=870200#c11)• 12 years ago |
|  | |

Kannan has a few patches here, so assigning as-is.Assignee: general → kvijayanStatus: NEW → ASSIGNED

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=870200#c12)• 12 years ago |
|  | |

I was going to land this earlier today but CLOSED TREE :(

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=870200#c13)• 12 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/a17bb92b2d52>

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=870200#c14)• 12 years ago |
|  | |

Backed out for bustage: <https://hg.mozilla.org/integration/mozilla-inbound/rev/8de86a614249>
Fixed and re-pushed: <https://hg.mozilla.org/integration/mozilla-inbound/rev/8de86a614249>

|  | [Phil Ringnalda (:philor)](/user_profile?user_id=135518) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=870200#c15)• 12 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/8de86a614249>Status: ASSIGNED → RESOLVEDClosed: 12 years ago
[status-firefox24](/buglist.cgi?f1=cf_status_firefox24&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox24&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla24

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a1864305_395101)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=870200#c16)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=870200#c17)• 12 years ago |
|  | |

Shouldn't this be backported since a Jan 30 regression affects Firefox 21 and higher?
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=wontfix)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F)
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=870200#c18)• 12 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #17](/show_bug.cgi?id=870200#c17 "VERIFIED FIXED - Assertion failure: (ptrBits & 0x7) == 0, at ./dist/include/js/Value.h:703 or Crash [@ GetValueType]"))
> Shouldn't this be backported since a Jan 30 regression affects Firefox 21
> and higher?
Unless this is highly obvious/exploitable, or super low risk, this will be a wontfix for FF22.
[tracking-firefox23](/buglist.cgi?f1=cf_tracking_firefox23&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox23&o1=equals&v1=%2B)

|  | [Alex Keybl [:akeybl]](/user_profile?user_id=425645) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a3418677_425645)• 12 years ago |

[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=wontfix)
[tracking-firefox22](/buglist.cgi?f1=cf_tracking_firefox22&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox22&o1=equals&v1=-)

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a3508119_436087)• 12 years ago |

Flags: in-testsuite?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=870200#c19)• 12 years ago |
|  | |

Uplift nomination?Flags: needinfo?(kvijayan)

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=870200#c20)• 12 years ago |
|  | |

Comment on [attachment 753328](/attachment.cgi?id=753328 "Fix") [[details]](/attachment.cgi?id=753328&action=edit "Fix") [[diff]](/attachment.cgi?id=753328&action=diff "Fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=870200&attachment=753328)
Fix
[Approval Request Comment]
Bug caused by (feature/regressing bug #):
[Bug 706885](/show_bug.cgi?id=706885 "RESOLVED FIXED - GC: Bump Allocation Nursery")
User impact if declined:
Potentially exploitable error.
Testing completed (on m-c, etc.):
Green on m-c for about a month.
Risk to taking this patch (and alternatives if risky):
Low risk.
String or IDL/UUID changes made by this patch:
N/A
[Attachment #753328](/attachment.cgi?id=753328&action=edit "Fix") -
Flags: approval-mozilla-beta?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a5227725_272375)• 12 years ago |

[Attachment #753328](/attachment.cgi?id=753328&action=edit "Fix") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=870200#c21)• 12 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/f505ea8cb1c2>
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a5576875_436087)• 12 years ago |

Flags: needinfo?(kvijayan)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a6794628_280903)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:update][adv-main23+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a15793147_280903)• 11 years ago |

[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=unaffected)
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=870200#a48388513_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=870200&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Holler (:decoder)](/user_profile?user_id=395101)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_259459e2_20250125_115345.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/854157)
* [XML](/show_bug.cgi?ctype=xml&id=854157)

Closed
[Bug 854157](/show_bug.cgi?id=854157)

Opened 12 years ago
Closed 12 years ago

# Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp or Assertion failure: !inline\_, at vm/Stack.cpp with gcPreserveCode

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp or Assertion failure: !inline\_, at vm/Stack.cpp with gcPreserveCode

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=unaffected) |
| firefox21 | --- | [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected) |
| firefox22 | --- | [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected) |
| firefox23 | --- | [verified](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=verified) |
| firefox-esr17 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox20 |  | unaffected |
| firefox21 |  | affected |
| firefox22 |  | affected |
| firefox23 |  | verified |
| firefox-esr17 |  | unaffected |
| b2g18 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: bhackett1024)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/764aa0af2fda6f02fb17dc9771bb18d9?d=mm&size=40)  [bhackett1024](/user_profile?user_id=346231)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/55857f92ded07119259dc6c1dd386205?d=mm&size=40)  [general](/user_profile?user_id=4729)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[833898](/show_bug.cgi?id=833898 "RESOLVED FIXED - Investigate converting mixed arrays of ints and doubles to arrays of doubles")

Dependency [tree](/showdependencytree.cgi?id=854157&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=854157)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, regression, testcase, Whiteboard: [jsbugmon:][adv-main23+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:][adv-main23+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [testcase](/attachment.cgi?id=728685)  [12 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   15.59 KB, text/plain |  | [Details](/attachment.cgi?id=728685&action=edit) |
| --- | --- | --- |
| [stack](/attachment.cgi?id=728687)  [12 years ago](#c2)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   22.20 KB, text/plain |  | [Details](/attachment.cgi?id=728687&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=854157#c0)• 12 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=728685)
— [Details](attachment.cgi?id=728685&action=edit)

The attached testcase asserts js debug shell on m-c changeset bcf09432affd with --no-ion and -a at Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp
(This was a very tough testcase to reduce)
autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: 120310:d7dd65663469
user: Brian Hackett
date: Tue Jan 29 16:20:03 2013 -0700
summary: [Bug 833898](/show_bug.cgi?id=833898 "RESOLVED FIXED - Investigate converting mixed arrays of ints and doubles to arrays of doubles") - Allow converting mixed arrays of ints and doubles to uniform doubles, r=jandem.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=854157#c1)• 12 years ago |
|  | |

This testcase involves gcPreserveCode, which the testcases in the other bugs ([bug 851247](/show_bug.cgi?id=851247 "RESOLVED WORKSFORME - IonMonkey: Assertion failure: regs->fp() == regs_->fp()->prev(), at vm/Stack.cpp:559") and [bug 852202](/show_bug.cgi?id=852202 "RESOLVED WORKSFORME - Assertion failure: regs->fp() == regs_->fp()->prev(), at vm/Stack.cpp:559")) don't have. autoBisect also points to a different changeset.
Brian, is [bug 833898](/show_bug.cgi?id=833898 "RESOLVED FIXED - Investigate converting mixed arrays of ints and doubles to arrays of doubles") a possible cause?Flags: needinfo?(bhackett1024)Summary: Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp → Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp with gcPreserveCode

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=854157#c2)• 12 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=728687)
— [Details](attachment.cgi?id=728687&action=edit)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=854157#c3)• 12 years ago |
|  | |

During the course of reduction, the assertion located here:
<http://hg.mozilla.org/mozilla-central/annotate/ec68e56cafa3/js/src/vm/Stack.cpp#l1263>
was also hit:
Assertion failure: !inline\_, at vm/Stack.cppSummary: Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp with gcPreserveCode → Assertion failure: regs->fp() == regs\_->fp()->prev(), at vm/Stack.cpp or Assertion failure: !inline\_, at vm/Stack.cpp with gcPreserveCode

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=854157#c4)• 12 years ago |
|  | |

jandem mentioned over IRC that this might be memory corruption or something, so locking s-s just to be safe. I'll try to reproduce this again.Group: core-security

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=854157#c5)• 12 years ago |
|  | |

(In reply to Gary Kwong [:gkw] [:nth10sd] from [comment #4](/show_bug.cgi?id=854157#c4 "VERIFIED FIXED - Assertion failure: regs->fp() == regs_->fp()->prev(), at vm/Stack.cpp or Assertion failure: !inline_, at vm/Stack.cpp with gcPreserveCode"))
> jandem mentioned over IRC that this might be memory corruption or something,
> so locking s-s just to be safe. I'll try to reproduce this again.
I can definitely still reproduce this on m-c tip c9bf19d37fe0:
$ ./js-dbg-64-dm-ts-darwin-c9bf19d37fe0 --no-ion -a ~/Downloads/854157.js
fuzzSeed: 115076139
Assertion failure: regs->fp() == regs\_->fp()->prev(),
Tested on 64-bit debug threadsafe deterministic build on Mac.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a349273_395101)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=854157#c6)• 12 years ago |
|  | |

JSBugMon: Cannot process bug: Unknown exception (check manually)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a918450_1689)• 12 years ago |

Assignee: general → bhackett1024
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-firefox20](/buglist.cgi?f1=cf_status_firefox20&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox20&o1=equals&v1=unaffected)
[status-firefox21](/buglist.cgi?f1=cf_status_firefox21&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox21&o1=equals&v1=affected)
[status-firefox22](/buglist.cgi?f1=cf_status_firefox22&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox22&o1=equals&v1=affected)
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected)
[status-firefox-esr17](/buglist.cgi?f1=cf_status_firefox_esr17&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr17&o1=equals&v1=unaffected)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a926035_395101)• 12 years ago |

Whiteboard: [jsbugmon:] → [jsbugmon:update]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a933401_395101)• 12 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:update,ignore]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=854157#c7)• 12 years ago |
|  | |

JSBugMon: The testcase found in this bug no longer reproduces (tried revision f20b0ce9e528).

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a933499_395101)• 12 years ago |

Whiteboard: [jsbugmon:update,ignore] → [jsbugmon:bisectfix]

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=854157#c8)• 12 years ago |
|  | |

I suspect the landing of BaselineCompiler might have caused this bug to go away.

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a988440_395101)• 12 years ago |

Whiteboard: [jsbugmon:bisectfix] → [jsbugmon:]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=854157#c9)• 12 years ago |
|  | |

JSBugMon: Fix Bisection requested, result:
autoBisect shows this is probably related to the following changeset:
The first good revision is:
changeset: 127440:492e87516012
parent: 127437:d4656be59219
parent: 126103:5b7ed1616c62
user: Jan de Mooij
date: Mon Mar 25 10:27:13 2013 +0100
summary: Merge from mozilla-inbound.
This iteration took 170.595 seconds to run.
Oops! We didn't test rev d4656be59219, a parent of the blamed revision! Let's do that now.
We did not test rev d4656be59219 because it is not a descendant of either bcf09432affd or 445d8eecdd80.
Rev d4656be59219: Updating... Compiling... Testing... [Uninteresting] It didn't crash. (6.352 seconds)
good (not interesting)
Bisect lied to us! Parent rev d4656be59219 was also good!
Oops! We didn't test rev 5b7ed1616c62, a parent of the blamed revision! Let's do that now.
Rev 5b7ed1616c62: Updating... Compiling... Testing... Exit status: CRASHED signal 11 (SIGSEGV) (15.878 seconds)
bad (interesting)
As expected, the parent's label is the opposite of the blamed rev's label.
Perhaps we should expand the search to include the common ancestor of the blamed changeset's parents.
The common ancestor of d4656be59219 and 5b7ed1616c62 is 0e9badd3cf39.
Rev 0e9badd3cf39: Updating... Compiling... Testing... Exit status: CRASHED signal 11 (SIGSEGV) (16.439 seconds)
bad (interesting)
The following line is still under testing:
Try setting -s to 0e9badd3cf39, and -e to 445d8eecdd80, and re-run autoBisect.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=854157#c10)• 12 years ago |
|  | |

Assuming fixed by BaselineCompiler.Status: NEW → RESOLVEDClosed: 12 years agoFlags: needinfo?(bhackett1024)Resolution: --- → FIXED

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a1269220_132034)• 12 years ago |

[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a1271008_395101)• 12 years ago |

Status: RESOLVED → VERIFIED

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=854157#c11)• 12 years ago |
|  | |

JSBugMon: This bug has been automatically verified fixed.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=854157#c12)• 12 years ago |
|  | |

Marking status-firefox23:verified as per [comment 11](/show_bug.cgi?id=854157#c11 "VERIFIED FIXED - Assertion failure: regs->fp() == regs_->fp()->prev(), at vm/Stack.cpp or Assertion failure: !inline_, at vm/Stack.cpp with gcPreserveCode")
[status-firefox23](/buglist.cgi?f1=cf_status_firefox23&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox23&o1=equals&v1=verified)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a10770341_280903)• 12 years ago |

Whiteboard: [jsbugmon:] → [jsbugmon:][adv-main23+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=854157#a52363865_1689)• 10 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=854157&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from blog.mozilla.org_a1905f2a_20250126_081802.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)


