```
[waraxe-2013-SA#097] - Multiple Vulnerabilities in PHP-Fusion 7.02.05
===============================================================================

This document describes multiple vulnerabilities found in PHP-Fusion version 7.02.05.

1.  **Local File Inclusion in "maincore.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data.
    *   **Vulnerability:** Local File Inclusion.
    *   **Attack vector:** User-supplied POST parameter "user_theme".
    *   **Preconditions:**
        *   Logged in as a valid user.
        *   "Allow users to change theme" option must be activated (default).
        *   PHP version must be less than 5.3.4 for null-byte attacks to work.
    *   **Details:** The "user_theme" parameter, used for theme selection, is not properly sanitized. The `stripinput()` function does not prevent directory traversal or null-byte injection. By injecting a path like "../images/avatars/waraxe.jpg\0z", an attacker can include arbitrary files.
    *   **Impact:** Arbitrary code execution by including an uploaded avatar with PHP payload.

2.  **Local File Inclusion in "administration/user_fields.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data.
    *   **Vulnerability:** Local File Inclusion.
    *   **Attack vector:** User-supplied GET parameter "enable".
    *   **Preconditions:**
        *   Logged in as an admin with user field administration privileges.
        *   PHP version must be less than 5.3.4 for null-byte attacks to work.
    *   **Details:** The "enable" parameter, used to enable user fields, is not properly sanitized. An attacker can use a null byte injection to bypass filename checks and include arbitrary files.
    *   **Impact:** Arbitrary code execution by including an uploaded avatar with PHP payload.

3.  **SQL Injection in "includes/classes/Authenticate.class.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data.
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied HTTP cookie (COOKIE\_USER).
    *  **Preconditions:** `magic_quotes_gpc=off`
    *   **Details:** The application uses the user-supplied cookie data without proper sanitization in a SQL query, specifically the `user_id` which is the first part of the exploded cookie.
    *   **Impact:** SQL Injection leading to potential data breach.

4.  **SQL Injection in "downloads.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data.
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied GET parameter "orderby".
    *   **Preconditions:** A valid download category with at least one download.
    *  **Details:** The `orderby` parameter is not properly sanitized before being used in a SQL query's ORDER BY clause.
    *   **Impact:** SQL Injection leading to potential data breach.

5.  **SQL Injection in "forum/postedit.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data.
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied POST parameter "delete_attach_*".
    *   **Preconditions:**
        *   Logged in as a user with forum posting privileges.
        *   `magic_quotes_gpc=off`
    *   **Details:** The application uses user-supplied data from POST parameters in a SQL query without proper sanitization, specifically the part after "delete_attach\_".
    *   **Impact:** SQL Injection leading to potential data breach.

6.  **SQL Injection in "forum/postnewthread.php"**

    *   **Root cause:** Uninitialized variable and insufficient sanitization of user-supplied data.
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied parameter "poll_opts".
    *   **Preconditions:**
        *   Logged in as a user with poll creation privileges.
        *   Available forum with poll creation abilities.
        *  `magic_quotes_gpc=off`
        *  `register_globals=on`
    *   **Details:** The application uses the "poll\_opts" parameter in a SQL query without proper sanitization when creating a poll.
    *   **Impact:** SQL Injection leading to potential data breach.

7.  **SQL Injection in "administration/settings_messages.php"**

    *  **Root cause:** Insufficient sanitization of user-supplied data
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied POST parameters "pm\_email\_notify", "pm\_save\_sent", "pm\_inbox", "pm\_sentbox", "pm\_savebox".
    *   **Preconditions:**
        *   Logged in as an admin with private message settings change privileges.
        *   `magic_quotes_gpc=off`
    *   **Details:**  The application uses multiple POST parameters in a SQL query without proper sanitization.
    *   **Impact:** SQL Injection leading to potential data breach.

8.  **SQL Injection in "administration/settings_photo.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied POST parameters "thumb\_compression", "photo\_watermark\_text\_color1", "photo\_watermark\_text\_color2", "photo\_watermark\_text\_color3".
    *   **Preconditions:**
        *   Logged in as an admin with photo gallery settings change privileges.
        *   `magic_quotes_gpc=off`
    *   **Details:** The "thumb\_compression" parameter is directly used in a SQL query without sanitization. While "photo\_watermark\_text\_color" parameters have a regex check, the check is flawed, allowing SQL injection by injecting values such as "AABBCC'waraxe".
    *   **Impact:** SQL Injection leading to potential data breach.

9.  **SQL Injection in "administration/bbcodes.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied GET parameter "enable".
    *   **Preconditions:**
        *   Logged in as an admin with BB Codes administration privileges.
        *   `magic_quotes_gpc=off`
        *   PHP must be < 5.3.4 for null-byte attacks to work.
    *   **Details:** The "enable" parameter is used in a SQL query without sufficient sanitization. File existence checks can be bypassed using null byte injection, allowing arbitrary SQL injection.
    *   **Impact:** SQL Injection leading to potential data breach.

10. **SQL Injection in "administration/news.php" case 1**

    *   **Root cause:** Insufficient sanitization of user-supplied data
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied POST parameters "news\_image", "news\_image\_t1", and "news\_image\_t2".
    *   **Preconditions:**
        *   Logged in as an admin with news administration privileges.
        *   `magic_quotes_gpc=off`
    *  **Details:** The application uses the POST parameters  `news_image`, `news_image_t1`, and `news_image_t2` in a SQL query without proper sanitization.
    *   **Impact:** SQL Injection leading to potential data breach.

11. **SQL Injection in "administration/articles.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied POST parameter "article\_id".
    *   **Preconditions:**
        *   Logged in as an admin with articles administration privileges.
        *   `magic_quotes_gpc=off`
    *   **Details:** The application attempts to sanitize the "article\_id" parameter, however, it's vulnerable to SQL injection because if a numeric GET parameter is provided with a non-numeric POST parameter with the same name, the numeric GET parameter check passes and the non-numeric POST parameter is used in the query.
    *   **Impact:** SQL Injection leading to potential data breach.

12. **SQL Injection in "administration/news.php" case 2**

    *   **Root cause:** Insufficient sanitization of user-supplied data
    *   **Vulnerability:** SQL Injection.
    *   **Attack vector:** User-supplied POST parameter "news\_id".
    *   **Preconditions:**
        *   Logged in as an admin with news administration privileges.
        *   `magic_quotes_gpc=off`
    *    **Details:** Similar to the previous case, the "news\_id" parameter is not properly sanitized, as a numeric GET parameter check can be bypassed by submitting a non-numeric POST parameter with the same name.
    *   **Impact:** SQL Injection leading to potential data breach.

13. **Reflected XSS in "forum/viewthread.php"**

    *   **Root cause:** Insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied GET parameter "highlight".
    *   **Preconditions:** At least one forum thread must exist.
    *   **Details:** The "highlight" parameter is not properly sanitized before being used in Javascript, allowing an attacker to inject arbitrary Javascript code.
    *   **Impact:**  Cross-site scripting.

14. **Reflected XSS in "messages.php"**

    *   **Root cause:** Uninitialized variables and insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied parameters "user\_list" and "user\_types".
    *   **Preconditions:**
        *   Logged in as a user.
        *  `register_globals=on`
    *   **Details:** The uninitialized variables "$user\_list" and "$user\_types" are directly output without sanitization, allowing for XSS injection. The "$user\_types" case requires admin privileges.
    *  **Impact**: Cross-site scripting.

15. **Reflected XSS in "infusions/shoutbox_panel/shoutbox_admin.php"**

    *   **Root cause:** Uninitialized variable and insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied parameter "message".
    *   **Preconditions:**
        *   Logged in as an admin with shoutbox administration privileges.
        *   `register_globals=on`
    *   **Details:** The uninitialized variable "$message" is directly output without sanitization, allowing for XSS injection.
    *   **Impact:** Cross-site scripting.

16. **Reflected XSS in "administration/news.php"**

    *   **Root cause:** Uninitialized variable and insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied parameter "message".
    *   **Preconditions:**
        *   Logged in as an admin with news administration privileges.
        *   `register_globals=on`
    *   **Details:** The uninitialized variable "$message" is directly output without sanitization, allowing for XSS injection.
    *   **Impact:** Cross-site scripting.

17. **Reflected XSS in "administration/panel\_editor.php"**

    *   **Root cause:** Uninitialized variable and insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied parameter "panel\_list".
    *   **Preconditions:**
        *   Logged in as an admin with panel editing privileges.
        *  `register_globals=on`
    *   **Details:** The uninitialized variable "$panel\_list" is directly output without sanitization, allowing for XSS injection.
    *   **Impact:** Cross-site scripting.

18. **Reflected XSS in "administration/phpinfo.php"**

    *   **Root cause:** Insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-Agent string
    *   **Preconditions:** Logged in as an admin with php info view privileges.
    *   **Details:** The User-Agent HTTP header is displayed on the page without any sanitization.
    *   **Impact:** Cross-site scripting.

19. **Reflected XSS in "administration/bbcodes.php"**

    *   **Root cause:** Uninitialized variable and insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied parameter "\_\_BBCODE\_\_".
    *   **Preconditions:**
        *   Logged in as an admin with bbcode settings change privileges.
        *   `register_globals=on`
    *  **Details:** The uninitialized variable "$__BBCODE__" is directly output without sanitization, allowing for XSS injection.
    *   **Impact:** Cross-site scripting.

20. **Reflected XSS in multiple admin scripts**

    *   **Root cause:** Uninitialized variables and insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied parameters "error" and "errorMessage".
    *   **Preconditions:**
        *   Logged in as an admin with appropriate privileges.
        *  `register_globals=on`
    *   **Details:** The uninitialized variables "$error" and "$errorMessage" are directly output without sanitization, allowing for XSS injection. Affects multiple scripts:
        *   administration/article\_cats.php
        *   administration/download\_cats.php
        *   administration/news\_cats.php
        *   administration/weblink\_cats.php
    *   **Impact:** Cross-site scripting.

21. **Reflected XSS in "administration/articles.php"**

    *   **Root cause:** Insufficient sanitization of HTML output.
    *   **Vulnerability:** Reflected Cross-Site Scripting (XSS).
    *   **Attack vector:** User-supplied POST parameters "body" and "body2".
    *   **Preconditions:** Logged in as an admin with articles administration privileges.
    *   **Details:** The parameters "body" and "body2" are output with minimal sanitization, allowing for XSS injection.
    *   **Impact:** Cross-site scripting.

22. **Arbitrary file deletion in "administration/db\_backup.php"**

    *   **Root cause:** Insufficient sanitization of user-supplied data.
    *   **Vulnerability:** Arbitrary file deletion.
    *   **Attack vector:** User-supplied POST parameter "file".
    *   **Preconditions:** Logged in as an admin with database backup privileges.
    *   **Details:** The "file" parameter is used unsanitized in the `unlink()` function, allowing for deletion of arbitrary files using directory traversal.
    *   **Impact:** Arbitrary file deletion on the server.

23. **Insecure database backup file handling in "administration/db\_backup.php"**

    *   **Root cause:** Insecure storage and weak randomness of backup filenames.
    *   **Vulnerability:** Information disclosure
    *   **Attack vector:** Direct request or filename bruteforce.
    *   **Preconditions:** Admin needs to initiate a database backup.
    *  **Details:** Database backup files are stored in a directory without access restrictions, making them publicly accessible. The filenames are generated with weak randomness which makes them bruteforceable.
    *   **Impact:** Information disclosure of sensitive database information, including hashed admin credentials.
```
The provided content details multiple vulnerabilities in PHP-Fusion 7.02.05, including Local File Inclusion, SQL Injection, Reflected XSS, Arbitrary File Deletion, and insecure database backup handling. The document thoroughly outlines the root cause, attack vectors, preconditions, and impact of each vulnerability.

The CVE assignments based on the provided information are:
* CVE-2013-1803: SQL Injection vulnerabilities in multiple scripts
* CVE-2013-1804: XSS vulnerabilities
* CVE-2013-1805: Arbitrary File Deletion
* CVE-2013-1806: Local File Inclusion
* CVE-2013-1807: Information Disclosure