```
Message-ID: <522A410C.4020907@redhat.com>
Date: Fri, 06 Sep 2013 14:54:36 -0600
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
CC: Vincent Danen <vdanen@...hat.com>
Subject: Re: CVE request: pyOpenSSL hostname check bypassing
 vulnerability

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On 09/06/2013 10:28 AM, Vincent Danen wrote:
> pyOpenSSL suffers from the same NULL-byte truncation issue that
> ruby, python, php, etc. suffered from (like ruby CVE-2013-4073).
>
> 0.13.1 was recently released to correct this.  Could a CVE be
> assigned?
>
> References:
>
> <https://mail.python.org/pipermail/pyopenssl-users/2013-September/000478.html>
>
>  <https://bugzilla.redhat.com/show_bug.cgi?id=1005325>
>

Please use CVE-2013-4314 for this issue.

- --
Kurt Seifried Red Hat Security Response Team (SRT)
PGP: 0x5E267993 A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (GNU/Linux)

iQIcBAEBAgAGBQJSKkELAAoJEBYNRVNeJnmTsEIP/A8piMsssgPuYynOFvr8AH3s
kF45hHOMMjVYXPXfsr6m1GFMC2IM7nPGIG2XD8NEruSZJhfi35aR4Oeh3QyL5vHg
QmOkGILy1Va0P5CsrRmoGJ9gpvmA7HBs21sU0cUizy+f25nRm7Nx4vtAteZ9Jdh6
rIGC8bGNg9JxmkOiWjQZh1otXAb6QpTAamhE6h7oIqZOoYh3uM0CCwmB15arGCMU
sOssLQATAnp+xIufXwM7yUCO6zZ0tT2JWebXIPJuTq9/J+sMizcY/mwUtbcSjuQa
Lw6wOKjPXyjFTw+MB4Ysf3f9sTzc4QSSKe7K8eLUCbyGuzJ3JJaTjfchK3QBetwk
SX2hssXXogos0xPDoYaXNImkPh0fwf+PIiw6JexKg53V4g8t3DQRogeDJEtkkfEi
u1LluxnBFMTOQ7L3k7u0ix0lU+LO1vd77y9hl73c8KP5QDDh67oJ3/gRD0DUOA+o
rMWCM8CrMCOtpjgfNbJNZIu+s7iQvcUgdXk4vna7Wist/yq6OhOnOdGWRS0rX8br
MF8AFD/eXFqoGDBQmRg8ToxT4AysIUdBpbp7Qv9HKWydOmGjKfXchygssdn8zd5Z
Ioqpusxxol1mb+gcVk2rIhO6j6a38bGK3lmSC3NlTkv+8VHYZGJBqrQY5J4Qk6dz
PVGm477HZN0wJKfS2+Wk
=o5nu
-----END PGP SIGNATURE-----
```
### Summary
The pyOpenSSL library incorrectly handled certificates with NULL bytes in the Subject Alternative Name field. This could allow a remote attacker to perform a man-in-the-middle attack.

### Root cause
The vulnerability stems from how pyOpenSSL processes the Subject Alternative Name (SAN) field in X.509 certificates. Prior to version 0.13.1, the library's string formatting for SAN fields would truncate the displayed name upon encountering a NULL byte.

### Weaknesses
- **NULL byte truncation:** The primary weakness is the improper handling of NULL bytes in the SAN field, leading to truncated and therefore misleading hostnames.
- **Lack of proper validation:** The library did not correctly validate the hostname in the certificate subject alternative name (SAN) field when processing a TLS connection, which could be exploited for impersonation.

### Impact
- **Man-in-the-middle attacks:** A successful attack allows an attacker to intercept and potentially modify communication between a pyOpenSSL client and an SSL/TLS server.
- **Spoofing:** The attacker can spoof a legitimate server by presenting a certificate with a crafted SAN field, leading the client to believe it is connecting to the legitimate server.
- **Exposure of sensitive information:** By successfully performing a man-in-the-middle attack, the attacker can view or alter sensitive information being transmitted between the client and the server.

### Attack vectors
- **Malicious certificate:** An attacker obtains a certificate from a trusted CA for a domain name like `www.foo.org\0.example.com`.
- **Man-in-the-middle position:** The attacker would need to be in a position to intercept the connection between the client and the server, presenting the malicious certificate.

### Required attacker capabilities/position
- **Trusted CA compromise or certificate issuance:** The attacker needs a certificate from a CA that the client trusts, where the certificate's SAN field contains a NULL byte.
- **Network position:** The attacker must be able to intercept network traffic between the client and the server, typically through a man-in-the-middle position or DNS spoofing.

### Additional details
- pyOpenSSL versions prior to 0.13.1 were vulnerable.
- The issue is similar to other NULL byte truncation vulnerabilities in other languages/libraries.
- pyOpenSSL 0.13.1 includes a fix to correctly handle the NULL byte and include it (escaped) in the SAN field's string formatting.
- The vulnerability is triggered during hostname verification, when the certificateâ€™s Subject Alternative Name is parsed.
- Red Hat stated that versions of pyOpenSSL in RHEL 5 & 6 were not vulnerable because the `get_extension()` method, which exposed the vulnerability, was not available in those versions.