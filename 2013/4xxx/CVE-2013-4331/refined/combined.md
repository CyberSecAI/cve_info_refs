=== Content from bugs.launchpad.net_baa8723c_20250125_042127.html ===

[Log in / Register](https://bugs.launchpad.net/lightdm/%2Bbug/685212/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/lightdm)

## [Light Display Manager](https://launchpad.net/lightdm)

* [Overview](https://launchpad.net/lightdm)
* [Code](https://code.launchpad.net/lightdm)
* [Bugs](https://bugs.launchpad.net/lightdm)
* [Blueprints](https://blueprints.launchpad.net/lightdm)
* [Translations](https://translations.launchpad.net/lightdm)
* [Answers](https://answers.launchpad.net/lightdm)

# wrong permission on xauthority file

Bug #685212 reported by
[Yves-Alexis Perez](https://launchpad.net/~corsac)
on 2010-12-04

[262](/%2Bhelp-bugs/bug-heat.html)

This bug affects 2 people

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Light Display Manager](https://bugs.launchpad.net/lightdm) | Fix Released | High | Unassigned |  |

### Bug Description

By default, the Xauthority file is created with mode 644, enabling any user to hijack another user X screen.

Attached patch seems to fix the problem for me.

## CVE References

* [2013-4331](/bugs/cve/2013-4331 "Light Display Manager (aka LightDM) 1...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Yves-Alexis Perez (corsac)](https://launchpad.net/~corsac) wrote on 2010-12-04: |  |  | [#1](/lightdm/%2Bbug/685212/comments/1) |
| --- | --- | --- | --- |

* [fix xauthority permissions](https://bugs.launchpad.net/lightdm/%2Bbug/685212/%2Battachment/1755423/%2Bfiles/03_fix-xauthority-perms.patch)
  [Edit](/lightdm/%2Bbug/685212/%2Battachment/1755423)
  (619 bytes,
  text/plain)

[Robert Ancell (robert-ancell)](https://launchpad.net/~robert-ancell)
on 2010-12-06

| Changed in lightdm: | |
| --- | --- |
| **status**: | New → Fix Committed |
| **importance**: | Undecided → High |

[Robert Ancell (robert-ancell)](https://launchpad.net/~robert-ancell)
on 2010-12-09

| Changed in lightdm: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Yves-Alexis Perez (corsac)](https://launchpad.net/~corsac) wrote on 2010-12-09: |  |  | [#2](/lightdm/%2Bbug/685212/comments/2) |
| --- | --- | --- | --- |

Hmmh, btw it might be cleaner to use G\_FILE\_CREATE\_PRIVATE in g\_file\_replace() instead of changing the mode afterward, I just discovered that.

Hmmh, btw it might be cleaner to use G\_FILE\_CREATE\_PRIVATE in g\_file\_replace() instead of changing the mode afterward, I just discovered that.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Ancell (robert-ancell)](https://launchpad.net/~robert-ancell) wrote on 2010-12-09: |  |  | [#3](/lightdm/%2Bbug/685212/comments/3) |
| --- | --- | --- | --- |

I've updated to do that

I've updated to do that

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Yves-Alexis Perez (corsac)](https://launchpad.net/~corsac) wrote on 2013-09-04: |  |  | [#4](/lightdm/%2Bbug/685212/comments/4) |
| --- | --- | --- | --- |

Seems that the bug is back, since you replaced g\_file\_replace() by g\_file\_set\_contents() which actually replaces atomically the whole file but then respects umask, which is not touched before doing that...

It has been reported in Debian as <http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721744>

I'm not sure if it's possible to reopen a bug, so I'll report a new one if it's not.

Seems that the bug is back, since you replaced g\_file\_replace() by g\_file\_set\_contents() which actually replaces atomically the whole file but then respects umask, which is not touched before doing that...
It has been reported in Debian as http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721744
I'm not sure if it's possible to reopen a bug, so I'll report a new one if it's not.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Ancell (robert-ancell)](https://launchpad.net/~robert-ancell) wrote on 2013-09-04:  [**Re: [Bug 685212] Re: wrong permission on xauthority file**](/lightdm/%2Bbug/685212/comments/5) |  |  | [#5](/lightdm/%2Bbug/685212/comments/5) |
| --- | --- | --- | --- |

Hi,

I've released lightdm 1.4.2 and 1.6.1 which have this fix backported.

On Thu, Sep 5, 2013 at 7:58 AM, Yves-Alexis Perez <email address hidden> wrote:

> Seems that the bug is back, since you replaced g\_file\_replace() by

> g\_file\_set\_contents() which actually replaces atomically the whole file

> but then respects umask, which is not touched before doing that...

>

> It has been reported in Debian as <http://bugs.debian.org/cgi->

> bin/bugreport.cgi?[bug=721744](/bugs/721744)

>

> I'm not sure if it's possible to reopen a bug, so I'll report a new one

> if it's not.

>

> \*\* Bug watch added: Debian Bug tracker #721744

> <http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721744>

>

> --

> You received this bug notification because you are subscribed to the bug

> report.

> <https://bugs.launchpad.net/bugs/685212>

>

> Title:

> wrong permission on xauthority file

>

> To manage notifications about this bug go to:

> [https://bugs.launchpad.net/lightdm/+bug/685212/+subscriptions](https://bugs.launchpad.net/lightdm/%2Bbug/685212/%2Bsubscriptions)

>

Hi,
I've released lightdm 1.4.2 and 1.6.1 which have this fix backported.
On Thu, Sep 5, 2013 at 7:58 AM, Yves-Alexis Perez <corsac@debian.org> wrote:
> Seems that the bug is back, since you replaced g\_file\_replace() by
> g\_file\_set\_contents() which actually replaces atomically the whole file
> but then respects umask, which is not touched before doing that...
>
> It has been reported in Debian as http://bugs.debian.org/cgi-
> bin/bugreport.cgi?bug=721744
>
> I'm not sure if it's possible to reopen a bug, so I'll report a new one
> if it's not.
>
> \*\* Bug watch added: Debian Bug tracker #721744
> http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721744
>
> --
> You received this bug notification because you are subscribed to the bug
> report.
> https://bugs.launchpad.net/bugs/685212
>
> Title:
> wrong permission on xauthority file
>
> To manage notifications about this bug go to:
> https://bugs.launchpad.net/lightdm/+bug/685212/+subscriptions
>

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Yves-Alexis Perez (corsac)](https://launchpad.net/~corsac) wrote on 2013-09-06: |  |  | [#6](/lightdm/%2Bbug/685212/comments/6) |
| --- | --- | --- | --- |

I'm sorry but that doesn't fix the security bug at all. It doesn't fix the permissions if they are currently bad, and even if the .Xauthority file doesn't exist, fopen() won't do better than set\_file\_contents(). Actually checking for the return code of the function might have helped too, but anyway.

In any case, care should be taken to:

- fix the permissions of existing .Xauthority files in a secure way

- correctly set the umask (or use a function which does it) before writing a new file

I'm sorry but that doesn't fix the security bug at all. It doesn't fix the permissions if they are currently bad, and even if the .Xauthority file doesn't exist, fopen() won't do better than set\_file\_contents(). Actually checking for the return code of the function might have helped too, but anyway.
In any case, care should be taken to:
- fix the permissions of existing .Xauthority files in a secure way
- correctly set the umask (or use a function which does it) before writing a new file

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Yves-Alexis Perez (corsac)](https://launchpad.net/~corsac) wrote on 2013-09-07: |  |  | [#7](/lightdm/%2Bbug/685212/comments/7) |
| --- | --- | --- | --- |

On mer., 2013-09-04 at 22:24 +0000, Robert Ancell wrote:

> I've released lightdm 1.4.2 and 1.6.1 which have this fix backported.

As said on the bug, the fix doesn't actually work.

Regards,

--

Yves-Alexis

On mer., 2013-09-04 at 22:24 +0000, Robert Ancell wrote:
> I've released lightdm 1.4.2 and 1.6.1 which have this fix backported.
As said on the bug, the fix doesn't actually work.
Regards,
--
Yves-Alexis

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Ancell (robert-ancell)](https://launchpad.net/~robert-ancell) wrote on 2013-09-10: |  |  | [#8](/lightdm/%2Bbug/685212/comments/8) |
| --- | --- | --- | --- |

Sorry, this was a reply to an email regarding the temporary files being left behind when updating Xauthority. Confirmed the bug is back - am working on a fix.

Sorry, this was a reply to an email regarding the temporary files being left behind when updating Xauthority. Confirmed the bug is back - am working on a fix.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Robert Ancell (robert-ancell)](https://launchpad.net/~robert-ancell) wrote on 2013-09-11: |  |  | [#9](/lightdm/%2Bbug/685212/comments/9) |
| --- | --- | --- | --- |

Should be fixed in 1.4.3, 1.6.2, 1.7.14

Should be fixed in 1.4.3, 1.6.2, 1.7.14

[Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur)
on 2013-09-11

| **information type**: | Private Security → Public Security |
| --- | --- |

[Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur)
on 2013-09-11

| **information type**: | Public Security → Private Security |
| --- | --- |

[Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur)
on 2013-09-11

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Yves-Alexis Perez (corsac)](https://launchpad.net/~corsac) wrote on 2013-09-26: |  |  | [#10](/lightdm/%2Bbug/685212/comments/10) |
| --- | --- | --- | --- |

I guess it'd be best to also check for the current file permissions and change them if needed (or change them inconditionally if the file already exists).

I can try to cook a patch, I'm just not too sure how to be really clean wrt. links attacks etc, although at that point the file should be written as user so it's safer than if it was done as root.

I guess it'd be best to also check for the current file permissions and change them if needed (or change them inconditionally if the file already exists).
I can try to cook a patch, I'm just not too sure how to be really clean wrt. links attacks etc, although at that point the file should be written as user so it's safer than if it was done as root.

[See full activity log](https://bugs.launchpad.net/lightdm/%2Bbug/685212/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/lightdm/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/lightdm/%2Bbug/685212/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/lightdm/%2Bbug/685212/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/lightdm/%2Bbug/685212/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [fix xauthority permissions](https://bugs.launchpad.net/lightdm/%2Bbug/685212/%2Battachment/1755423/%2Bfiles/03_fix-xauthority-perms.patch)
  [Edit](/lightdm/%2Bbug/685212/%2Battachment/1755423 "Change patch details")

* [Add patch](/lightdm/%2Bbug/685212/%2Baddcomment?field.patch=on)

## Remote bug watches

* [debbugs #721744](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=721744)

  [done important]
  [Edit](/bugs/685212/%2Bwatch/107026 "Change watch details")

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


