- **Root cause of vulnerability**: Bugs in the code that compiles VCL ACLs into C code. Specifically, issues related to how CIDR (Classless Inter-Domain Routing) masks are handled when they don't align with byte boundaries and when more specific ACL entries are present.
- **Weaknesses/vulnerabilities present**: Incorrect handling of non-class CIDR ACL entries (e.g., /xx, except /8, /16, /24...) when more specific ACL entries are also present. This leads to the ACL matching *less* than it should.
- **Impact of exploitation**: If an ACL is used to deny access, some IP addresses that should be denied may be allowed to pass through. The ACL might not function as intended, potentially allowing unauthorized access.
- **Attack vectors**: By crafting requests from IP addresses that should be denied based on the miscompiled ACL logic.
- **Required attacker capabilities/position**: An attacker needs to have the ability to send requests to the Varnish cache and knowledge of the vulnerable ACL configuration. They don't need any special access to the Varnish server itself beyond the ability to send network traffic.

The vulnerability occurs because, during compilation of ACLs, the CIDR mask can be rounded up to a byte boundary, or the CIDR entry is ignored under specific circumstances. This rounding can cause a broader range of IPs to be matched, or it can result in the CIDR entry being ignored if the split byte matches the tested IP, leading to incorrect ACL behavior. The issue impacts both IPv4 and IPv6.