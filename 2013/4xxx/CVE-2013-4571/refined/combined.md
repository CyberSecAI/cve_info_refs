=== Content from bugzilla.wikimedia.org_8153f7a3_20250126_105921.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT56527)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T56527
# NULL pointer dereference in php-luasandboxClosed, Resolved[Public](/policy/explain/PHID-TASK-y7ivxufptazz3i3uccqt/view/)Actions

* [Edit Task](/maniphest/task/edit/56527/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/56527/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-y7ivxufptazz3i3uccqt/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-y7ivxufptazz3i3uccqt/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Protect as security issue](/wmf/escalate-task/56527/)
* [Award Token](/token/give/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Flag For Later](/flag/edit/PHID-TASK-y7ivxufptazz3i3uccqt/)

Assigned ToNoneAuthored By

|  | [Anomie](/p/Anomie/) |
| --- | --- |
| Sep 24 2013, 8:14 PM2013-09-24 20:14:00 (UTC+0) |

Tags

* [Scribunto](/tag/scribunto/) [(Backlog)](/project/board/558/)
* [Security](/tag/security/)
Referenced Files

|  | [F12015: scribunto.diff](/F12015) |
| --- | --- |
| Nov 22 2014, 2:15 AM2014-11-22 02:15:32 (UTC+0) |

|  | [F12014: 0003-Update-changelog.patch](/F12014) |
| --- | --- |
| Nov 22 2014, 2:15 AM2014-11-22 02:15:31 (UTC+0) |

|  | [F12013: 0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch](/F12013) |
| --- | --- |
| Nov 22 2014, 2:15 AM2014-11-22 02:15:31 (UTC+0) |

Subscribers

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [Dzahn](/p/Dzahn/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [tstarling](/p/tstarling/) |
| --- | --- |

|  | [vvv](/p/vvv/) |
| --- | --- |

# Description

Patch to php-luasandbox to handle the NULL

As part of converting data structures from Lua to PHP, lua-phpsandbox will convert Lua tables to PHP arrays. To do this, it uses the lua\_tolstring function to convert the table keys into strings for PHP.

Unfortunately, lua\_tolstring will return NULL if it is asked to convert any data type besides number and string, and this possibility is not being checked before the resulting pointer is passed to zend\_hash\_update. zend\_hash\_update turns around and passes the pointer to zend\_inline\_hash\_func, which dereferences the pointer and causes a crash.

This crash can be caused by any user simply by returning a table such as { [{}] = 1 } from a module function, or by passing such a table to PHP.

The attached patch fixes matters by checking for this NULL and throwing an error.

---

**Version**: unspecified

**Severity**: normal

*attachment diff1 ignored as obsolete*

# Details

Reference bz54527
# Related ObjectsSearch...

* Task Graph

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  |  |  |  | Restricted Task |
|  |  | Resolved |  | *None* | T56527 [NULL pointer dereference in php-luasandbox](/T56527) |

### Event Timeline

[• bzimport](/p/bzimport/) raised the priority of this task from  to Needs Triage.[Nov 22 2014, 2:15 AM2014-11-22 02:15:29 (UTC+0)](#597837)[• bzimport](/p/bzimport/) added a project: [Scribunto](/tag/scribunto/).[• bzimport](/p/bzimport/) set Reference to bz54527.[• bzimport](/p/bzimport/) added a subscriber: Unknown Object (MLST).[Anomie](/p/Anomie/) created this task.[Sep 24 2013, 8:14 PM2013-09-24 20:14:00 (UTC+0)](#597843)

[Anomie](/p/Anomie/) added a comment.[Sep 24 2013, 8:17 PM2013-09-24 20:17:56 (UTC+0)](#597857)Comment Actions

Created attachment 13362

Patch to Scribunto to handle the same situation in LuaStandalone

The LuaStandalone interpreter in Scribunto also doesn't handle these problematic keys correctly, although here there is no null pointer problem. It will, however, encode table and function keys using Lua's default tostring function which will expose the pointer addresses of tables and functions.

This patch probably isn't a security issue in itself, but anyone seeing it could easily think to try the same thing in LuaSandbox and discover the php-luasandbox bug. So I'm going to put this patch here too, at least for the moment.

*attachment diff2 ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Sep 25 2013, 11:38 PM2013-09-25 23:38:16 (UTC+0)](#597877)Comment Actions

Can we get the package on the cluster updated for this issue this week, and we'll make this public next week with the next security release?

[tstarling](/p/tstarling/) added a comment.[Sep 26 2013, 3:25 AM2013-09-26 03:25:05 (UTC+0)](#597891)Comment Actions

The patches look fine to me.

[• csteipp](/p/csteipp/) added a comment.[Nov 14 2013, 7:30 PM2013-11-14 19:30:40 (UTC+0)](#597898)Comment Actions

This was assigned CVE-2013-4570

[Anomie](/p/Anomie/) added a comment.[Nov 14 2013, 9:03 PM2013-11-14 21:03:12 (UTC+0)](#597904)Comment Actions

Created attachment 13796

Rebased patch for luasandbox (on top of bug 49705)

**Attached**: 0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/g5ya7264guxn47tfm3s5/PHID-FILE-fuzigqkxyszf7afcxvak/0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch)

[Anomie](/p/Anomie/) added a comment.[Nov 14 2013, 9:03 PM2013-11-14 21:03:46 (UTC+0)](#597914)Comment Actions

Created attachment 13797

Changelog update for this and bug 49705

**Attached**: 0003-Update-changelog.patch967 B[Download](https://phab.wmfusercontent.org/file/download/rye3ooa6d5mhrh54ocux/PHID-FILE-nih6hrbvrystkn6m4j2m/0003-Update-changelog.patch)

[Anomie](/p/Anomie/) added a comment.[Nov 14 2013, 9:04 PM2013-11-14 21:04:11 (UTC+0)](#597920)Comment Actions

Created attachment 13798

Rebased patch for Scribunto extension

**Attached**: scribunto.diff3 KB[Download](https://phab.wmfusercontent.org/file/download/27rcu6og2hvlqgk5kdew/PHID-FILE-hxpyp6lhrsv2oiy74ci5/scribunto.diff)

[Dzahn](/p/Dzahn/) added a comment.[Dec 3 2013, 7:38 PM2013-12-03 19:38:04 (UTC+0)](#597929)Comment Actions

built 1.8 on labs php-packaging instance. had to install these first this time, not sure why they were gone from the instance: dpkg-checkbuilddeps: Unmet build dependencies: php5-dev liblua5.1-0-dev pkg-config

..then:

clone to /tmp..

cd /tmp/build/luasandboxorig/

git apply 0001-Fix-Lua-stack-overflow.patch

git apply 0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch

git apply 0003-Update-changelog.patch

debuild -us -uc ..

Version: 1.8-1

Distribution: precise-wikimedia

Urgency: high

Maintainer: Tim Starling <tstarling@wikimedia.org>

Changed-By: Brad Jorsch <bjorsch@wikimedia.org>

..

debdiff /home/dzahn/php-luasandbox\_1.7-1\_amd64.deb /tmp/build/php-luasandbox\_1.8-1\_amd64.deb

File lists identical (after any substitutions)

### Control files: lines which differ (wdiff format)

Depends: libc6 (>= [-2.14),-] {+2.4),+} liblua5.1-0, php5-common

Installed-Size: [-126-] {+148+}

Version: [-1.7-1-] {+1.8-1+}

.. copied to test.wp - mw1017 -

[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[Mar 26 2015, 8:39 PM2015-03-26 20:39:15 (UTC+0)](#1154598)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:53 PM2020-02-10 22:53:41 (UTC+0)](#5868085) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:14 PM2020-02-20 20:14:27 (UTC+0)](#5903809) · [Aklapper](/p/Aklapper/) removed subscribers: [Anomie](/p/Anomie/), [• wikibugs-l-list](/p/wikibugs-l-list/).[Oct 16 2020, 5:40 PM2020-10-16 17:40:10 (UTC+0)](#6553837) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from lists.wikimedia.org_69eea16e_20250125_182248.html ===


[lists.wikimedia.org](/hyperkitty/)

[Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)
[Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)

* [Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)
* [Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)

* [Manage this list](/postorius/lists/mediawiki-announce.lists.wikimedia.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2025/1/)

### 2024

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/1/)

### 2023

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/1/)

### 2022

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/1/)

### 2021

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/1/)

### 2020

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/1/)

### 2019

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/1/)

### 2018

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/1/)

### 2017

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/1/)

### 2016

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/1/)

### 2015

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/1/)

### 2014

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/1/)

### 2013

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/1/)

### 2012

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/1/)

### 2011

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/1/)

### 2010

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/1/)

### 2009

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/1/)

### 2008

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/1/)

### 2007

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/1/)

### 2006

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/1/)

### 2005

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/1/)

### 2004

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2004/12/)

[List overview](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

[Download](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/export/mediawiki-announce%40lists.wikimedia.org-YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A.mbox.gz?message=YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A "This message in gzipped mbox format")

[thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/#YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A)

# [MediaWiki-announce] MediaWiki Security Releases: 1.22.1, 1.21.4 and 1.19.10

[Chris Steipp](/hyperkitty/users/dd272b532a8d4667a37daa128483ef95/ "See the profile for Chris Steipp")

14 Jan
2014

14 Jan
'14

8:34 a.m.

I would like to announce the release of MediaWiki 1.22.1, 1.21.4 and
1.19.10.
These releases fix a number of security related bugs that could affect
users of
MediaWiki. In addition, MediaWiki 1.22.1 is a maintenance release. It fixes
several bugs. You can consult the RELEASE-NOTES-1.22 file for the full list
of
changes in this version. Download links are given at the end of this email.

== Security fixes ==

\* MediaWiki user Michael M reported that the fix for bug 55332
(CVE-2013-4568)
allowed insertion of escaped CSS values which could pass the CSS validation
checks, resulting in XSS. (CVE-2013-6451)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58088>

\* Chris from RationalWiki reported that SVG files could be uploaded that
include external stylesheets, which could lead to XSS when an XSL was used
to
include JavaScript. (CVE-2013-6452)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=57550>

\* During internal review, it was discovered that MediaWiki's SVG
sanitization
could be bypassed when the XML was considered invalid. (CVE-2013-6453)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58553>

\* Durign internal review, it was discovered that MediaWiki's CSS
sanitization
did not filter -o-link attributes, which could be used to execute
JavaScript in
Opera 12. (CVE-2013-6454)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58472>

\* During internal review, it was discovered that MediaWiki displayed some
information about deleted pages in the log API, enhanced RecentChanges, and
user watchlists. (CVE-2013-6472)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58699>

Additionally, the following extensions have been updated to fix security
issues:

\* TimedMediaHandler: Bawolff discovered an XSS vulnerability with the way
the
extension stored and used HTML for showing videos. (CVE-2013-4574)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=56699>

\* Scribuntu: Internal review found a NULL pointer dereference in
php-luasandbox, which could be used for DoS attacks. (CVE-2013-4570)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=54527>

\* Scribuntu: Internal review found a Buffer Overflow in php-luasandbox. It's
not know if this could be use for code execution on the server.
(CVE-2013-4571)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=49705>

\* CentralAuth: Eran Roz reported that MediaWiki usernames could be leaked to
other websites. Javascript returned for CentralAuth's login would update the
page DOM with the username, even when included on other sites.
(CVE-2013-6455)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=57081>

\* SemanticForms: Ravindra Singh Rathore reported a missing CSRF check to
Mozilla, who reported the issue to us. Several other forms in the extension
were also fixed.
<https://bugzilla.wikimedia.org/show_bug.cgi?id=57025>

== Bug fixes in 1.22.1 ==

\* (bug 59945) 1.22 tarball offers Extension SimpleAntiSpam which is supposed
to be in core.

\* (bug 58178) Restore compatibility with curl < 7.16.2.

\* (bug 56931) Updated the plural rules to CLDR 24. They are in new format
which is detailed in UTS 35 Rev 33. The PHP parser and evaluator as well as
the JavaScript evaluator were updated to support the new format. Plural
rules
for some languages have changed, most notably Russian. Affected software
messages have been updated and marked for review at translatewiki.net.
This change is backported from the development branch of MediaWiki 1.23.

\* (bug 58434) The broken installer for database backend Oracle was fixed.

\* (bug 58167) The web installer no longer throws an exception when PHP is
compiled without support for MySQL yet with support for another DBMS.

\* (bug 58640) Fixed a compatibility issue with PCRE 8.34 that caused pages
to appear blank or with missing text.

\* (bug 47055) Changed FOR UPDATE handling in Postgresql

Full release notes for 1.22.1:
<https://www.mediawiki.org/wiki/Release_notes/1.22>

Full release notes for 1.21.4:
<https://www.mediawiki.org/wiki/Release_notes/1.21>

Full release notes for 1.19.9:
<https://www.mediawiki.org/wiki/Release_notes/1.19>

For information about how to upgrade, see
[https://www.mediawiki.org/wiki/Manual:Upgrading](https://www.mediawiki.org/wiki/Manual%3AUpgrading)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.22.1
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.tar.gz>

Patch to previous version (1.22.0), without interface text:
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.patch.gz>
Interface text changes:
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-i18n-1.22.1.patch.gz>

GPG signatures:
[http://download.wikimedia.org/mediawiki/1.22/mediawiki-core-1.22.1.tar.gz.si...](http://download.wikimedia.org/mediawiki/1.22/mediawiki-core-1.22.1.tar.gz.sig)
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.patch.gz.sig>
[http://download.wikimedia.org/mediawiki/1.22/mediawiki-i18n-1.22.1.patch.gz....](http://download.wikimedia.org/mediawiki/1.22/mediawiki-i18n-1.22.1.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.21.4
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.tar.gz>

Patch to previous version (1.21.3), without interface text:
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.patch.gz>
Interface text changes:
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-i18n-1.21.4.patch.gz>

GPG signatures:
[http://download.wikimedia.org/mediawiki/1.21/mediawiki-core-1.21.4.tar.gz.si...](http://download.wikimedia.org/mediawiki/1.21/mediawiki-core-1.21.4.tar.gz.sig)
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.patch.gz.sig>
[http://download.wikimedia.org/mediawiki/1.21/mediawiki-i18n-1.21.4.patch.gz....](http://download.wikimedia.org/mediawiki/1.21/mediawiki-i18n-1.21.4.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.19.10
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.tar.gz>

Patch to previous version (1.19.9), without interface text:
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.patch.gz>
Interface text changes:
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-i18n-1.19.10.patch.gz>

GPG signatures:
[http://download.wikimedia.org/mediawiki/1.19/mediawiki-core-1.19.10.tar.gz.s...](http://download.wikimedia.org/mediawiki/1.19/mediawiki-core-1.19.10.tar.gz.sig)
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.patch.gz.sig>
[http://download.wikimedia.org/mediawiki/1.19/mediawiki-i18n-1.19.10.patch.gz...](http://download.wikimedia.org/mediawiki/1.19/mediawiki-i18n-1.19.10.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:TimedMediaHandler
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:TimedMediaHandler](https://www.mediawiki.org/wiki/Extension%3ATimedMediaHandler)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:Scribunto
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:Scribunto](https://www.mediawiki.org/wiki/Extension%3AScribunto)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:CentralAuth
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:CentralAuth](https://www.mediawiki.org/wiki/Extension%3ACentralAuth)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:SemanticForms
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:SemanticForms](https://www.mediawiki.org/wiki/Extension%3ASemanticForms)

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/#YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A)

[Back to the list](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from bugzilla.wikimedia.org_11cbef93_20250126_105923.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT51705)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T51705
# Buffer overflow in luasandbox php extension (mediawiki/php/luasandbox)Closed, Resolved[Public](/policy/explain/PHID-TASK-crd4kovw4hiophfmgnnd/view/)Actions

* [Edit Task](/maniphest/task/edit/51705/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/51705/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-crd4kovw4hiophfmgnnd/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-crd4kovw4hiophfmgnnd/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-crd4kovw4hiophfmgnnd/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-crd4kovw4hiophfmgnnd/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-crd4kovw4hiophfmgnnd/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-crd4kovw4hiophfmgnnd/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-crd4kovw4hiophfmgnnd/)
* [Protect as security issue](/wmf/escalate-task/51705/)
* [Award Token](/token/give/PHID-TASK-crd4kovw4hiophfmgnnd/)
* [Flag For Later](/flag/edit/PHID-TASK-crd4kovw4hiophfmgnnd/)

Assigned ToNoneAuthored By

|  | [Anomie](/p/Anomie/) |
| --- | --- |
| Jun 17 2013, 5:32 PM2013-06-17 17:32:00 (UTC+0) |

Tags

* [Scribunto](/tag/scribunto/) [(Backlog)](/project/board/558/)
* [Security](/tag/security/)
Referenced Files

|  | [F11554: 0001-Fix-Lua-stack-overflow.patch](/F11554) |
| --- | --- |
| Nov 22 2014, 1:59 AM2014-11-22 01:59:10 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [Dzahn](/p/Dzahn/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [tstarling](/p/tstarling/) |
| --- | --- |

|  | [vvv](/p/vvv/) |
| --- | --- |

# Description

Patch to fix the issue

The underlying cause in bug 49649 is a buffer overflow in malloced memory in the luasandbox PHP extension. In Lua's C API, the caller is responsible for calling lua\_checkstack to expand the Lua's stack as necessary before pushing onto it, and the various lua\_push\* functions apparently don't do any checking unless you compile with certain debug options activated. The lua\_checkstack call isn't being done when processing arguments when calling from PHP to Lua or when returning values from PHP to Lua, so if the existing Lua stack isn't big enough (default is space for 20 values unless some other call already made Lua allocate a bigger stack) it will overflow into the next data structure on the heap.

FYI, an easier reproduction in Scribunto than the one given in bug 49649 is the one liner mw.ustring.codepoint( string.rep( 'x', 1000 ), 1, -1); the limit on the 1000 depends on whether anything else has already increased the Lua stack size. An even simpler (but longer) one-liner is to replace the string.rep call with a literal string of sufficient length. It can also be reproduced from the command line, see the tests in the attached patch.

Deployment process is apparently to update the changelog then have someone with appropriate access (Ops?) run the wmf-build script that's in the mediawiki/php/luasandbox repo. Tim usually does all that, of course, but he's on vacation this week.

---

**Version**: unspecified

**Severity**: normal

*attachment patch ignored as obsolete*

# Details

Reference bz49705
# Related ObjectsSearch...

* Task Graph

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  |  |  |  | Restricted Task |
|  |  | Resolved |  | *None* | T51705 [Buffer overflow in luasandbox php extension (mediawiki/php/luasandbox)](/T51705) |

### Event Timeline

[• bzimport](/p/bzimport/) raised the priority of this task from  to Needs Triage.[Nov 22 2014, 1:59 AM2014-11-22 01:59:04 (UTC+0)](#566819)[• bzimport](/p/bzimport/) added a project: [Scribunto](/tag/scribunto/).[• bzimport](/p/bzimport/) set Reference to bz49705.[• bzimport](/p/bzimport/) added a subscriber: Unknown Object (MLST).[Anomie](/p/Anomie/) created this task.[Jun 17 2013, 5:32 PM2013-06-17 17:32:00 (UTC+0)](#566823)

[Anomie](/p/Anomie/) added a comment.[Jun 17 2013, 5:33 PM2013-06-17 17:33:29 (UTC+0)](#566832)Comment Actions

Created attachment 12566

Patch to update the changelog

*attachment patch2 ignored as obsolete*

[Dzahn](/p/Dzahn/) added a comment.[Jun 17 2013, 6:08 PM2013-06-17 18:08:14 (UTC+0)](#566840)Comment Actions

How will we handle this one in Gerrit? Are we gonna submit it in public with the "fix buffer overflow" comment, but only right before deployment?

[Anomie](/p/Anomie/) added a comment.[Jun 17 2013, 6:23 PM2013-06-17 18:23:28 (UTC+0)](#566850)Comment Actions

(In reply to comment #2)

> How will we handle this one in Gerrit? Are we gonna submit it in public with
>
> the "fix buffer overflow" comment, but only right before deployment?

I know this was already answered on IRC, but for the record:

We're handling it like any other security update, if possible: deploy the fix, then put it in Gerrit afterwards. The bug also gets reassigned to the appropriate non-Security product when it's closed. I don't know if there will be a security announcement too or what. Coordinate with Chris on the details and timing of the making-public bits, of course.

[Dzahn](/p/Dzahn/) added a comment.[Jun 17 2013, 10:43 PM2013-06-17 22:43:14 (UTC+0)](#566866)Comment Actions

i added myself to labs project "packaging", and used instance "php-packaging" since it appears in the wmf-build script from the luasandbox repo.

i applied the patch and build 1.7-1, then manually copied from the labs instance to brewster and imported with reprepro.

since the package is "ensure latest" in puppet, it then got auto-updated on the cluster hosts.

as of this writing i'ts now "ii php-luasandbox 1.7-1 " on all 217 mw\* hosts.

[Dzahn](/p/Dzahn/) added a comment.[Jun 17 2013, 11:00 PM2013-06-17 23:00:52 (UTC+0)](#566891)Comment Actions

test case as decribed in <https://bugzilla.wikimedia.org/show_bug.cgi?id=49649> as far as i understand it should be this: <http://en.wiktionary.org/w/index.php?title=User:Mutante/foo&action=history>

and [http://en.wiktionary.org/wiki/User:Mutante/foo](http://en.wiktionary.org/wiki/User%3AMutante/foo) did \_not\_ become uneditable. So that would be good, please confirm.

[Anomie](/p/Anomie/) added a comment.[Jun 18 2013, 12:11 AM2013-06-18 00:11:39 (UTC+0)](#566901)Comment Actions

(In reply to comment #5)

> and [http://en.wiktionary.org/wiki/User:Mutante/foo](http://en.wiktionary.org/wiki/User%3AMutante/foo) did \_not\_ become
>
> uneditable.
>
> So that would be good, please confirm.

My tests work as well.

[Dzahn](/p/Dzahn/) added a comment.[Jun 18 2013, 12:37 AM2013-06-18 00:37:22 (UTC+0)](#566910)Comment Actions

cool, claiming RESOLVED then.

[Dzahn](/p/Dzahn/) added a comment.[Jun 18 2013, 12:38 AM2013-06-18 00:38:49 (UTC+0)](#566918)Comment Actions

This is not in gerrit yet, do we want to make it public now?

[Anomie](/p/Anomie/) added a comment.[Jun 18 2013, 1:23 AM2013-06-18 01:23:21 (UTC+0)](#566924)Comment Actions

(In reply to comment #8)

> This is not in gerrit yet, do we want to make it public now?

I'd say let's ask Chris.

[• csteipp](/p/csteipp/) added a comment.[Jun 18 2013, 4:57 PM2013-06-18 16:57:53 (UTC+0)](#566939)Comment Actions

The only other issue is if there are external users we would want to notify. I'm assuming that's not the case here (although Brad, let us know if you think otherwise), so I think we can release-- i.e., put the patch in gerrit and send a note to wikitech-l in case other people want to patch.

[Anomie](/p/Anomie/) added a comment.[Jun 18 2013, 5:46 PM2013-06-18 17:46:08 (UTC+0)](#566946)Comment Actions

It's certainly possible that others have downloaded and installed luasandbox, we mention it on the extension page and people have filed bugs against it specifically.

[Anomie](/p/Anomie/) added a comment.[Aug 23 2013, 3:01 PM2013-08-23 15:01:44 (UTC+0)](#566958)Comment Actions

Created attachment 13158

Rebased patch, and added one more check

It would be nice to get this released sometime soon. In the mean time, I rebased the patch and added an additional luaL\_checkstack() call.

*attachment diff ignored as obsolete*

[Anomie](/p/Anomie/) added a comment.[Aug 23 2013, 3:02 PM2013-08-23 15:02:58 (UTC+0)](#566969)Comment Actions

Created attachment 13159

And here's a version rebased on top of Gerrit change 63565

Also, since Gerrit change 63565 and this have conflicts, here's a version rebased on top of that change in case that gets merged first.

*attachment diff2 ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Aug 23 2013, 4:41 PM2013-08-23 16:41:12 (UTC+0)](#566980)Comment Actions

I'm planning to include this this with 1.21.2, currently scheduled for Aug 27th.

[Anomie](/p/Anomie/) added a comment.[Sep 3 2013, 7:45 PM2013-09-03 19:45:46 (UTC+0)](#566985)Comment Actions

Created attachment 13226

Changelog for 1.7 and 1.8

*attachment diff ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Nov 14 2013, 7:31 PM2013-11-14 19:31:11 (UTC+0)](#566994)Comment Actions

This was assigned CVE-2013-4571

[Anomie](/p/Anomie/) added a comment.[Nov 14 2013, 9:03 PM2013-11-14 21:03:01 (UTC+0)](#567011)Comment Actions

Created attachment 13795

Rebased patch

**Attached**: 0001-Fix-Lua-stack-overflow.patch4 KB[Download](https://phab.wmfusercontent.org/file/download/keeo4mzlbd46ikktpu5r/PHID-FILE-oc54d3ooiqrr4bjwp363/0001-Fix-Lua-stack-overflow.patch)

[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[Mar 26 2015, 8:39 PM2015-03-26 20:39:14 (UTC+0)](#1154597)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:53 PM2020-02-10 22:53:42 (UTC+0)](#5868100) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:14 PM2020-02-20 20:14:29 (UTC+0)](#5903820) · [Aklapper](/p/Aklapper/) removed subscribers: [Anomie](/p/Anomie/), [• wikibugs-l-list](/p/wikibugs-l-list/).[Oct 16 2020, 5:40 PM2020-10-16 17:40:13 (UTC+0)](#6553861) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
