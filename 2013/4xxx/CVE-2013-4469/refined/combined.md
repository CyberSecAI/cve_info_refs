=== Content from www.openwall.com_d01a2667_20250125_124636.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <527289B8.70304@openstack.org>
Date: Thu, 31 Oct 2013 17:47:52 +0100
From: Thierry Carrez <thierry@...nstack.org>
To: Open Source Security <oss-security@...ts.openwall.com>
Subject: [OSSA 2013-029] Potential Nova denial of service through compressed
 disk images (CVE-2013-4463, CVE-2013-4469)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

OpenStack Security Advisory: 2013-029
CVE: CVE-2013-4463, CVE-2013-4469
Date: October 31, 2013
Title: Potential Nova denial of service through compressed disk images
Reporter: Bernhard M. Wiedemann (SUSE) & Pádraig Brady (Red Hat)
Products: Nova
Affects: All versions

Description:
Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's
control of the size of disk images. By using malicious compressed qcow2
disk images, an authenticated user may consume large amounts of disk
space for each image, potentially resulting in a Denial of Service
attack on Nova compute nodes (CVE-2013-4463). While fixing this issue,
Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012
did not fully address CVE-2013-2096 in the non-default case where
use_cow_images=False, and malicious qcow images are being transferred
from Glance. In that specific case, an authenticated user could still
consume large amounts of disk space for each instance using the
malicious image, potentially also resulting in a Denial of Service
attack on Nova compute nodes (CVE-2013-4469). The provided fixes
address both issues.

Icehouse (development branch) fix:
<https://review.openstack.org/54765>

Havana fix:
<https://review.openstack.org/54767>

Grizzly fix:
<https://review.openstack.org/54768>

References:
<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-4463>
<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-4469>
[https://bugs.launchpad.net/nova/+bug/1206081](https://bugs.launchpad.net/nova/%2Bbug/1206081)

Regards,

- --
Thierry Carrez
OpenStack Vulnerability Management Team
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.12 (GNU/Linux)
Comment: Using GnuPG with Thunderbird - <http://www.enigmail.net/>

iQIcBAEBCAAGBQJScom4AAoJEFB6+JAlsQQjds8P/RHc+cYZTRRvoRM2BIIbbfB0
d28WZPGGHKpKY99XQ/Q0+rDfmZb3N1KJ0nsCrLOdaNUXydIO7kE3wNElvyY8ES4x
6AJcocK6+3IPdazdu7tTiU/wfhx7DjjFZP+jk91JOmd4jcJ83TGqBT1nUhwDyhIf
YNjyPoZNnMIz9ga/yn1Drk9RyH0CCNHIL1h4OT9V8CQ4jmbmNOoqw0Benrk+o2Rn
eFpQfagUm6uKjhyCvbowZueVZv8KB/johfj/w3gpAiuQEMana9dU7fLX18qRhUlh
xJzCfUanD0JGWUkLtHsy9SapStjqclme4vEjBhLJxhqST547jDjWHnNylPDNHKXa
OnZ8r7mYrpx3hAhrDe+hWjPmrZ/dOMIwNP8nuWIY+Hyenyv1henSJX0qeppXeAbA
swTeQhet1iCDw9v+1KadCdPyVLNft7aIa9jw40WUV+Ff60HW8lzNAH0EXf5YWDuG
rQ5fZoHSRBmOF3GsVtuNDKTABsZz1ecxgwJ4oXV23b79VLV87n1RN5sZLHIu5FY8
303ci7O7xwFh1mV3VgiQZJzub7/Ey1CBmj8ds/Bg/TyxsraVkDoOxdg216OdvVzs
VdhgN9dOzD3UEW7kL4uBYNWNSNYoAhTmEphotvtWIR8n/Y4olEYO61YaYZFJvIOy
hVLCGyCGF9uUbWqkCs5D
=AdLt
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from review.openstack.org_a2832fc3_20250126_083849.html ===




=== Content from review.openstack.org_304d86f5_20250126_083848.html ===




=== Content from bugs.launchpad.net_e5911737_20250126_083851.html ===

[Log in / Register](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* [Translations](https://translations.launchpad.net/nova)
* [Answers](https://answers.launchpad.net/nova)

# [OSSA 2013-029] Unchecked qcow2 root disk sizes DoS

Bug #1206081 reported by
[Bernhard M. Wiedemann](https://launchpad.net/~ubuntubmw)
on 2013-07-29

[272](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Compute (nova)](https://bugs.launchpad.net/nova) | Fix Released | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) | [OpenStack Compute (nova) 2014.1 "icehouse"](https://launchpad.net/nova/%2Bmilestone/2014.1) |
|  | [Folsom](https://bugs.launchpad.net/nova/folsom) | Won't Fix | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) |  |
|  | [Grizzly](https://bugs.launchpad.net/nova/grizzly) | Fix Released | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) | [OpenStack Compute (nova) 2013.1.5](https://launchpad.net/nova/%2Bmilestone/2013.1.5) |
|  | [Havana](https://bugs.launchpad.net/nova/havana) | Fix Released | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) | [OpenStack Compute (nova) 2013.2.1](https://launchpad.net/nova/%2Bmilestone/2013.2.1) |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Medium | [Thierry Carrez](https://launchpad.net/~ttx) |  |

### Bug Description

When doing QA for SUSE on [bug 1177830](/bugs/1177830)

I found that the fix is incomplete,

because it assumed that the cached image would be mostly sparse.

However, I can easily create non-sparse small compressed qcow2 images with

perl -e 'for(1..11000){print "x" x 1024000}' > img

qemu-img convert -c -O qcow2 img img.qcow2

glance image-create --name=11gb --is-public=True --disk-format=qcow2 --container-format=bare < img.qcow2

nova boot --image 11gb --flavor m1.small testvm

which (in Grizzly and Essex) results in one (or two in Essex) 11GB large files being created in /var/lib/nova/instances/\_base/

still allowing attackers to fill up disk space of compute nodes

because the size check is only done after the uncompressing / caching

Tags:

[libvirt](/nova/%2Bbugs?field.tag=libvirt)

## CVE References

* [2013-4463](/bugs/cve/2013-4463 "OpenStack Compute (Nova) Folsom, Griz...")
* [2013-4469](/bugs/cve/2013-4469 "OpenStack Compute (Nova) Folsom, Griz...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Bernhard M. Wiedemann (ubuntubmw)](https://launchpad.net/~ubuntubmw) wrote on 2013-07-29: |  |  | [#1](/nova/%2Bbug/1206081/comments/1) |
| --- | --- | --- | --- |

* [example image](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3753115/%2Bfiles/11gb.qcow2.xz)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3753115)
  (26.1 KiB,
  application/octet-stream)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-01: |  |  | [#2](/nova/%2Bbug/1206081/comments/2) |
| --- | --- | --- | --- |

Russell, Mikal: could you confirm the vulnerability ?

Russell, Mikal: could you confirm the vulnerability ?

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Russell Bryant (russellb)](https://launchpad.net/~russellb) wrote on 2013-08-08: |  |  | [#3](/nova/%2Bbug/1206081/comments/3) |
| --- | --- | --- | --- |

Added Pádraig Brady to help review this.

Added Pádraig Brady to help review this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-08-08: |  |  | [#4](/nova/%2Bbug/1206081/comments/4) |
| --- | --- | --- | --- |

Refreshing my memory for the flow of these images ... <http://www.pixelbeat.org/docs/openstack_libvirt_images/>

Yes this does seem like a valid issue, though not as serious as the related [bug 1177830](/bugs/1177830)

as there is only an allocation per image rather than per instance.

Also any sizes over the quote size etc. for an instance wouldn't be thus referenced and so

could be auto deleted at some stage.

But yes this is a valid DOS vector given the difference between input and output sizes.

Now if we did limit sizes, I suppose we could limit to the max flavor size?

But that doesn't help much. One could still upload many small images up to the max flavor size to fill up the \_base/

Maybe we need quotas glance side for max actual disk usage per user for all their images?

Refreshing my memory for the flow of these images ... http://www.pixelbeat.org/docs/openstack\_libvirt\_images/
Yes this does seem like a valid issue, though not as serious as the related bug 1177830
as there is only an allocation per image rather than per instance.
Also any sizes over the quote size etc. for an instance wouldn't be thus referenced and so
could be auto deleted at some stage.
But yes this is a valid DOS vector given the difference between input and output sizes.
Now if we did limit sizes, I suppose we could limit to the max flavor size?
But that doesn't help much. One could still upload many small images up to the max flavor size to fill up the \_base/
Maybe we need quotas glance side for max actual disk usage per user for all their images?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-09: |  |  | [#5](/nova/%2Bbug/1206081/comments/5) |
| --- | --- | --- | --- |

Looks like we'll need an OSSA on this then.

Looks like we'll need an OSSA on this then.

| Changed in ossa: | |
| --- | --- |
| **importance**: | Undecided → Medium |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-19: |  |  | [#6](/nova/%2Bbug/1206081/comments/6) |
| --- | --- | --- | --- |

Anyone on the current subscription list up for a patch ?

Anyone on the current subscription list up for a patch ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-30: |  |  | [#7](/nova/%2Bbug/1206081/comments/7) |
| --- | --- | --- | --- |

Padraig, Mikal: any chance you could produce a patch to fix this ?

Padraig, Mikal: any chance you could produce a patch to fix this ?

| Changed in nova: | |
| --- | --- |
| **importance**: | Undecided → High |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-03: |  |  | [#8](/nova/%2Bbug/1206081/comments/8) |
| --- | --- | --- | --- |

Ok I'll take this (was away for a couple of weeks). I might get to it in the next couple of days

Ok I'll take this (was away for a couple of weeks). I might get to it in the next couple of days

| Changed in nova: | |
| --- | --- |
| **assignee**: | nobody → Pádraig Brady (p-draigbrady) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-09-10: |  |  | [#9](/nova/%2Bbug/1206081/comments/9) |
| --- | --- | --- | --- |

@Pádraig: any progress ?

@Pádraig: any progress ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-19: |  |  | [#10](/nova/%2Bbug/1206081/comments/10) |
| --- | --- | --- | --- |

Lets summarize \_this\_ bug as "per \_image\_ qcow2 root disk sizes DoS"

and [bug 1177830](/bugs/1177830) as "per \_instance\_ qcow2 root disk sizes DoS".

Unfortunately I think that even [bug 1177830](/bugs/1177830) mightn't be addressed in the case

where use\_cow\_images=False, i.e. in nova.virt.libvirt.imagebackend.Raw.create\_image().

On initial inspection it seems like the large qcow2 files could be copied to each instance here too.

So thoughts on addressing this.

1. Always set min\_disk = virt\_size for an image in glance.

This is already checked in nova before we download anything.

That has the advantage of saving on network bandwidth and is

honored by cinder too for volumes.

2. Pass/Inspect size into nova.virt.images.fetch{,\_to\_raw}()

and disallow disk.get\_disk\_size('tmp\_download') > size

Doing either should address both bugs I think,

but I'm leaning towards 1 as a more general solution.

Lets summarize \_this\_ bug as "per \_image\_ qcow2 root disk sizes DoS"
and bug 1177830 as "per \_instance\_ qcow2 root disk sizes DoS".
Unfortunately I think that even bug 1177830 mightn't be addressed in the case
where use\_cow\_images=False, i.e. in nova.virt.libvirt.imagebackend.Raw.create\_image().
On initial inspection it seems like the large qcow2 files could be copied to each instance here too.
So thoughts on addressing this.
1. Always set min\_disk = virt\_size for an image in glance.
This is already checked in nova before we download anything.
That has the advantage of saving on network bandwidth and is
honored by cinder too for volumes.
2. Pass/Inspect size into nova.virt.images.fetch{,\_to\_raw}()
and disallow disk.get\_disk\_size('tmp\_download') > size
Doing either should address both bugs I think,
but I'm leaning towards 1 as a more general solution.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-20: |  |  | [#11](/nova/%2Bbug/1206081/comments/11) |
| --- | --- | --- | --- |

Actually we probably should do both.

Better to have nova not rely on a particular glance implementation or version or glance at all for that matter.

I'll do the nova change now...

Actually we probably should do both.
Better to have nova not rely on a particular glance implementation or version or glance at all for that matter.
I'll do the nova change now...

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-09-23

| Changed in ossa: | |
| --- | --- |
| **assignee**: | nobody → Thierry Carrez (ttx) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-09-27: |  |  | [#12](/nova/%2Bbug/1206081/comments/12) |
| --- | --- | --- | --- |

@Padraig: we'll take the Nova patch as the vulnerability fix. We'll consider the Glance as a hardening improvement.

@Padraig: we'll take the Nova patch as the vulnerability fix. We'll consider the Glance as a hardening improvement.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-09-27: |  |  | [#13](/nova/%2Bbug/1206081/comments/13) |
| --- | --- | --- | --- |

First attempt at an impact description, not sure I got this right:

----------------------

Title: Potential Nova denial of service through compressed disk images

Reporter: Bernhard M. Wiedemann (SUSE)

Products: Nova

Affects: All versions

Description:

Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space, potentially resulting in a Denial of Service attack on Nova compute nodes. This issue is slightly different from CVE-2013-2096 which was addressed in OSSA 2013-012.

---------------------------

First attempt at an impact description, not sure I got this right:
----------------------
Title: Potential Nova denial of service through compressed disk images
Reporter: Bernhard M. Wiedemann (SUSE)
Products: Nova
Affects: All versions
Description:
Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space, potentially resulting in a Denial of Service attack on Nova compute nodes. This issue is slightly different from CVE-2013-2096 which was addressed in OSSA 2013-012.
---------------------------

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-27: |  |  | [#14](/nova/%2Bbug/1206081/comments/14) |
| --- | --- | --- | --- |

Re impact description, I'd mention that CVE-2013-2096 wasn't fully addressed either

in the non default case where use\_cow\_images=False, and malicious qcow images

are being transferred from glance. If mentioning both it's probably worth mentioning

the original CVE-2013-2096 was a per instance issue, while this new one is per image.

Re impact description, I'd mention that CVE-2013-2096 wasn't fully addressed either
in the non default case where use\_cow\_images=False, and malicious qcow images
are being transferred from glance. If mentioning both it's probably worth mentioning
the original CVE-2013-2096 was a per instance issue, while this new one is per image.

[Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady)
on 2013-09-27

| Changed in nova: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

[Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady)
on 2013-10-01

| Changed in nova: | |
| --- | --- |
| **milestone**: | none → havana-rc1 |
| **tags**: | added: havana-rc-potential libvirt |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-01: |  |  | [#18](/nova/%2Bbug/1206081/comments/18) |
| --- | --- | --- | --- |

RC1 will probably be out before we can properly embargo and release this as an OSSA. This should stay as havana-rc-potential just in case it can make it prerelease.

Would be good to get some core pre-approvals on the proposed patches. Feel free to subscribe fellow core developers to accelerate that.

RC1 will probably be out before we can properly embargo and release this as an OSSA. This should stay as havana-rc-potential just in case it can make it prerelease.
Would be good to get some core pre-approvals on the proposed patches. Feel free to subscribe fellow core developers to accelerate that.

| Changed in nova: | |
| --- | --- |
| **milestone**: | havana-rc1 → none |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Russell Bryant (russellb)](https://launchpad.net/~russellb) wrote on 2013-10-03: |  |  | [#19](/nova/%2Bbug/1206081/comments/19) |
| --- | --- | --- | --- |

Added a few nova developers that could help review these patches

Added a few nova developers that could help review these patches

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-07: |  |  | [#20](/nova/%2Bbug/1206081/comments/20) |
| --- | --- | --- | --- |

Hey guys, please review proposed patches !

Hey guys, please review proposed patches !

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Russell Bryant (russellb)](https://launchpad.net/~russellb) wrote on 2013-10-07: |  |  | [#21](/nova/%2Bbug/1206081/comments/21) |
| --- | --- | --- | --- |

+2 on the patch

+2 on the patch

[Russell Bryant (russellb)](https://launchpad.net/~russellb)
on 2013-10-07

| Changed in nova: | |
| --- | --- |
| **milestone**: | none → icehouse-1 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#22](/nova/%2Bbug/1206081/comments/22) |
| --- | --- | --- | --- |

respinning with just improved commit messages

respinning with just improved commit messages

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#23](/nova/%2Bbug/1206081/comments/23) |
| --- | --- | --- | --- |

* [proposed havana fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868692/%2Bfiles/1206081-havana.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868692)
  (20.4 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#24](/nova/%2Bbug/1206081/comments/24) |
| --- | --- | --- | --- |

* [proposed grizzly fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868693/%2Bfiles/1206081-grizzly.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868693)
  (19.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#25](/nova/%2Bbug/1206081/comments/25) |
| --- | --- | --- | --- |

* [proposed folsom fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868694/%2Bfiles/1206081-folsom.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868694)
  (16.8 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-09: |  |  | [#26](/nova/%2Bbug/1206081/comments/26) |
| --- | --- | --- | --- |

Nova core: Please review proposed patches

Nova core: Please review proposed patches

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-10-14

| **tags**: | added: havana-backport-potentialremoved: havana-rc-potential |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-21: |  |  | [#27](/nova/%2Bbug/1206081/comments/27) |
| --- | --- | --- | --- |

New attempt at impact description:

----------------------

Title: Potential Nova denial of service through compressed disk images

Reporter: Bernhard M. Wiedemann (SUSE)

Products: Nova

Affects: All versions

Description:

Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space for each image, potentially resulting in a Denial of Service attack on Nova compute nodes. While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes. The provided fixes address both issues.

---------------------------

New attempt at impact description:
----------------------
Title: Potential Nova denial of service through compressed disk images
Reporter: Bernhard M. Wiedemann (SUSE)
Products: Nova
Affects: All versions
Description:
Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space for each image, potentially resulting in a Denial of Service attack on Nova compute nodes. While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes. The provided fixes address both issues.
---------------------------

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Vish Ishaya (vishvananda)](https://launchpad.net/~vishvananda) wrote on 2013-10-22: |  |  | [#28](/nova/%2Bbug/1206081/comments/28) |
| --- | --- | --- | --- |

+2 on patches

+2 on patches

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-23: |  |  | [#29](/nova/%2Bbug/1206081/comments/29) |
| --- | --- | --- | --- |

+1 on impact description

+1 on impact description

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-24: |  |  | [#30](/nova/%2Bbug/1206081/comments/30) |
| --- | --- | --- | --- |

CVE requested

CVE requested

| Changed in ossa: | |
| --- | --- |
| **status**: | Triaged → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-25: |  |  | [#31](/nova/%2Bbug/1206081/comments/31) |
| --- | --- | --- | --- |

CVE-2013-4463

CVE-2013-4463

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-25: |  |  | [#32](/nova/%2Bbug/1206081/comments/32) |
| --- | --- | --- | --- |

Proposed public disclosure date/time: Thursday, October 31, 1500UTC.

Proposed public disclosure date/time: Thursday, October 31, 1500UTC.

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-28: |  |  | [#33](/nova/%2Bbug/1206081/comments/33) |
| --- | --- | --- | --- |

CVE SPLIT w/ CVE-2013-4469:

Title: Potential Nova denial of service through compressed disk images

Reporter: Bernhard M. Wiedemann (SUSE) & Pádraig Brady (Red Hat)

Products: Nova

Affects: All versions

Description:

Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's

control of the size of disk images. By using malicious compressed qcow2

disk images, an authenticated user may consume large amounts of disk

space for each image, potentially resulting in a Denial of Service

attack on Nova compute nodes (CVE-2013-4463). While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes (CVE-2013-4469). The provided fixes address both issues.

CVE SPLIT w/ CVE-2013-4469:
Title: Potential Nova denial of service through compressed disk images
Reporter: Bernhard M. Wiedemann (SUSE) & Pádraig Brady (Red Hat)
Products: Nova
Affects: All versions
Description:
Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's
control of the size of disk images. By using malicious compressed qcow2
disk images, an authenticated user may consume large amounts of disk
space for each image, potentially resulting in a Denial of Service
attack on Nova compute nodes (CVE-2013-4463). While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes (CVE-2013-4469). The provided fixes address both issues.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-30: |  |  | [#34](/nova/%2Bbug/1206081/comments/34) |
| --- | --- | --- | --- |

Patches test runs:

master: tox, smoke PASS

havana: tox, neutron PASS

grizzly: tox, full PASS

Patches test runs:
master: tox, smoke PASS
havana: tox, neutron PASS
grizzly: tox, full PASS

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-10-31

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix proposed to nova (stable/havana)**](/nova/%2Bbug/1206081/comments/35) |  |  | [#35](/nova/%2Bbug/1206081/comments/35) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/havana

Review: <https://review.openstack.org/54767>

Fix proposed to branch: stable/havana
Review: https://review.openstack.org/54767

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-31:  [**Re: Unchecked qcow2 root disk sizes DoS**](/nova/%2Bbug/1206081/comments/36) |  |  | [#36](/nova/%2Bbug/1206081/comments/36) |
| --- | --- | --- | --- |

master: <https://review.openstack.org/54765>

stable/havana: <https://review.openstack.org/54767>

stable/grizzly: <https://review.openstack.org/54768>

master: https://review.openstack.org/54765
stable/havana: https://review.openstack.org/54767
stable/grizzly: https://review.openstack.org/54768

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-31: |  |  | [#37](/nova/%2Bbug/1206081/comments/37) |
| --- | --- | --- | --- |

[OSSA 2013-029]

[OSSA 2013-029]

| **summary**: | - Unchecked qcow2 root disk sizes DoS+ [OSSA 2013-029] Unchecked qcow2 root disk sizes DoS |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix merged to nova (master)**](/nova/%2Bbug/1206081/comments/38) |  |  | [#38](/nova/%2Bbug/1206081/comments/38) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/54765>

Committed: <http://github.com/openstack/nova/commit/f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30>

Submitter: Jenkins

Branch: master

commit f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30

Author: Pádraig Brady <email address hidden>

Date: Fri Sep 27 04:07:14 2013 +0100

ensure we don't boot oversized images

Since we can't generally shrink incoming images, add extra checks

    to ensure oversized images are not allowed through.

    All cases when populating the libvirt image cache are now handled,

    including the initial download from glance, where we avoid

    converting to raw, as that could generate non sparse images

    much larger than the downloaded image.

\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through

    of the max\_size parameter.

    \* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,

    and use it to discard images with larger (virtual) sizes.

    \* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new

    refactored function to identify and raise exception to oversized images.

    (Raw.create\_image): Pass the max\_size to the fetch function.

    Also enforce virtual image size checking for already fetched images,

    as this class (despite the name) can be handling qcow files.

    (Qcow2.create\_image): Pass the max\_size to the fetch function,

    or verify the virtual size for the instance as done previously.

    (Lvm.create\_image): Pass the max\_size to the fetch function.

    Also check the size before transferring to the volume to improve

    efficiency by not even attempting the transfer of oversized images.

    (Rbd.create\_image): Likewise.

    \* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.

    \* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):

    Add a case to check oversized images are discarded.

    \* nova/tests/virt/libvirt/test\_imagebackend.py

    (test\_create\_image\_too\_small): Adjust to avoid the fetch size check.

Fixes bug: 1177830

    Fixes bug: 1206081

    Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

Reviewed: https://review.openstack.org/54765
Committed: http://github.com/openstack/nova/commit/f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30
Submitter: Jenkins
Branch: master
commit f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30
Author: Pádraig Brady <pbrady@redhat.com>
Date: Fri Sep 27 04:07:14 2013 +0100
ensure we don't boot oversized images
Since we can't generally shrink incoming images, add extra checks
to ensure oversized images are not allowed through.
All cases when populating the libvirt image cache are now handled,
including the initial download from glance, where we avoid
converting to raw, as that could generate non sparse images
much larger than the downloaded image.
\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through
of the max\_size parameter.
\* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,
and use it to discard images with larger (virtual) sizes.
\* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new
refactored function to identify and raise exception to oversized images.
(Raw.create\_image): Pass the max\_size to the fetch function.
Also enforce virtual image size checking for already fetched images,
as this class (despite the name) can be handling qcow files.
(Qcow2.create\_image): Pass the max\_size to the fetch function,
or verify the virtual size for the instance as done previously.
(Lvm.create\_image): Pass the max\_size to the fetch function.
Also check the size before transferring to the volume to improve
efficiency by not even attempting the transfer of oversized images.
(Rbd.create\_image): Likewise.
\* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.
\* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):
Add a case to check oversized images are discarded.
\* nova/tests/virt/libvirt/test\_imagebackend.py
(test\_create\_image\_too\_small): Adjust to avoid the fetch size check.
Fixes bug: 1177830
Fixes bug: 1206081
Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |
| **tags**: | added: in-stable-havana |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix merged to nova (stable/havana)**](/nova/%2Bbug/1206081/comments/39) |  |  | [#39](/nova/%2Bbug/1206081/comments/39) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/54767>

Committed: <http://github.com/openstack/nova/commit/3cdfe894ab58f7b91bf7fb690fc5bc724e44066f>

Submitter: Jenkins

Branch: stable/havana

commit 3cdfe894ab58f7b91bf7fb690fc5bc724e44066f

Author: Pádraig Brady <email address hidden>

Date: Fri Sep 27 04:07:14 2013 +0100

ensure we don't boot oversized images

Since we can't generally shrink incoming images, add extra checks

    to ensure oversized images are not allowed through.

    All cases when populating the libvirt image cache are now handled,

    including the initial download from glance, where we avoid

    converting to raw, as that could generate non sparse images

    much larger than the downloaded image.

\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through

    of the max\_size parameter.

    \* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,

    and use it to discard images with larger (virtual) sizes.

    \* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new

    refactored function to identify and raise exception to oversized images.

    (Raw.create\_image): Pass the max\_size to the fetch function.

    Also enforce virtual image size checking for already fetched images,

    as this class (despite the name) can be handling qcow files.

    (Qcow2.create\_image): Pass the max\_size to the fetch function,

    or verify the virtual size for the instance as done previously.

    (Lvm.create\_image): Pass the max\_size to the fetch function.

    Also check the size before transferring to the volume to improve

    efficiency by not even attempting the transfer of oversized images.

    (Rbd.create\_image): Likewise.

    \* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.

    \* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):

    Add a case to check oversized images are discarded.

    \* nova/tests/virt/libvirt/test\_imagebackend.py

    (test\_create\_image\_too\_small): Adjust to avoid the fetch size check.

Fixes bug: 1177830

    Fixes bug: 1206081

    Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

Reviewed: https://review.openstack.org/54767
Committed: http://github.com/openstack/nova/commit/3cdfe894ab58f7b91bf7fb690fc5bc724e44066f
Submitter: Jenkins
Branch: stable/havana
commit 3cdfe894ab58f7b91bf7fb690fc5bc724e44066f
Author: Pádraig Brady <pbrady@redhat.com>
Date: Fri Sep 27 04:07:14 2013 +0100
ensure we don't boot oversized images
Since we can't generally shrink incoming images, add extra checks
to ensure oversized images are not allowed through.
All cases when populating the libvirt image cache are now handled,
including the initial download from glance, where we avoid
converting to raw, as that could generate non sparse images
much larger than the downloaded image.
\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through
of the max\_size parameter.
\* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,
and use it to discard images with larger (virtual) sizes.
\* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new
refactored function to identify and raise exception to oversized images.
(Raw.create\_image): Pass the max\_size to the fetch function.
Also enforce virtual image size checking for already fetched images,
as this class (despite the name) can be handling qcow files.
(Qcow2.create\_image): Pass the max\_size to the fetch function,
or verify the virtual size for the instance as done previously.
(Lvm.create\_image): Pass the max\_size to the fetch function.
Also check the size before transferring to the volume to improve
efficiency by not even attempting the transfer of oversized images.
(Rbd.create\_image): Likewise.
\* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.
\* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):
Add a case to check oversized images are discarded.
\* nova/tests/virt/libvirt/test\_imagebackend.py
(test\_create\_image\_too\_small): Adjust to avoid the fetch size check.
Fixes bug: 1177830
Fixes bug: 1206081
Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix merged to nova (stable/grizzly)**](/nova/%2Bbug/1206081/comments/40) |  |  | [#40](/nova/%2Bbug/1206081/comments/40) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/54768>

Committed: <http://github.com/openstack/nova/commit/135faa7b5d9855312bedc19e5e1ecebae34d3d18>

Submitter: Jenkins

Branch: stable/grizzly

commit 135faa7b5d9855312bedc19e5e1ecebae34d3d18

Author: Pádraig Brady <email address hidden>

Date: Fri Sep 27 04:07:14 2013 +0100

ensure we don't boot oversized images

Since we can't generally shrink incoming images, add extra checks

    to ensure oversized images are not allowed through.

    All cases when populating the libvirt image cache are now handled,

    including the initial download from glance, where we avoid

    converting to raw, as that could generate non sparse images

    much larger than the downloaded image.

\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through

    of the max\_size parameter.

    \* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,

    and use it to discard images with larger (virtual) sizes.

    \* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new

    refactored function to identify and raise exception to oversized images.

    (Raw.create\_image): Pass the max\_size to the fetch function.

    Also enforce virtual image size checking for already fetched images,

    as this class (despite the name) can be handling qcow files.

    (Qcow2.create\_image): Pass the max\_size to the fetch function,

    or verify the virtual size for the instance as done previously.

    (Lvm.create\_image): Pass the max\_size to the fetch function.

    Also check the size before transferring to the volume to improve

    efficiency by not even attempting the transfer of oversized images.

    (Rbd.create\_image): Likewise.

    \* nova/tests/fake\_libvirt\_utils.py: Support max\_size arg.

    \* nova/tests/test\_libvirt.py (test\_fetch\_raw\_image):

    Add a case to check oversized images are discarded.

    \* nova/tests/test\_imagebackend.py (test\_create\_image\_too\_small):

    Adjust to avoid the fetch size check.

Fixes bug: 1177830

    Fixes bug: 1206081

Conflicts:

nova/tests/test\_imagebackend.py

     nova/virt/libvirt/imagebackend.py

Change-Id: Idc35fce580be4f74e23883d1b4bea6475c3f6e30

Reviewed: https://review.openstack.org/54768
Committed: http://github.com/openstack/nova/commit/135faa7b5d9855312bedc19e5e1ecebae34d3d18
Submitter: Jenkins
Branch: stable/grizzly
commit 135faa7b5d9855312bedc19e5e1ecebae34d3d18
Author: Pádraig Brady <pbrady@redhat.com>
Date: Fri Sep 27 04:07:14 2013 +0100
ensure we don't boot oversized images
Since we can't generally shrink incoming images, add extra checks
to ensure oversized images are not allowed through.
All cases when populating the libvirt image cache are now handled,
including the initial download from glance, where we avoid
converting to raw, as that could generate non sparse images
much larger than the downloaded image.
\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through
of the max\_size parameter.
\* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,
and use it to discard images with larger (virtual) sizes.
\* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new
refactored function to identify and raise exception to oversized images.
(Raw.create\_image): Pass the max\_size to the fetch function.
Also enforce virtual image size checking for already fetched images,
as this class (despite the name) can be handling qcow files.
(Qcow2.create\_image): Pass the max\_size to the fetch function,
or verify the virtual size for the instance as done previously.
(Lvm.create\_image): Pass the max\_size to the fetch function.
Also check the size before transferring to the volume to improve
efficiency by not even attempting the transfer of oversized images.
(Rbd.create\_image): Likewise.
\* nova/tests/fake\_libvirt\_utils.py: Support max\_size arg.
\* nova/tests/test\_libvirt.py (test\_fetch\_raw\_image):
Add a case to check oversized images are discarded.
\* nova/tests/test\_imagebackend.py (test\_create\_image\_too\_small):
Adjust to avoid the fetch size check.
Fixes bug: 1177830
Fixes bug: 1206081
Conflicts:
nova/tests/test\_imagebackend.py
nova/virt/libvirt/imagebackend.py
Change-Id: Idc35fce580be4f74e23883d1b4bea6475c3f6e30

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-11-01

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Gary Kotton (garyk)](https://launchpad.net/~garyk)
on 2013-11-07

| **tags**: | removed: havana-backport-potential |
| --- | --- |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-12-04

| Changed in nova: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Alan Pevec (apevec)](https://launchpad.net/~apevec)
on 2013-12-08

| **tags**: | removed: in-stable-havana |
| --- | --- |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-04-17

| Changed in nova: | |
| --- | --- |
| **milestone**: | icehouse-1 → 2014.1 |

[See full activity log](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/nova/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/nova/%2Bbug/1206081/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [proposed havana fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868692/%2Bfiles/1206081-havana.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868692 "Change patch details")
* [proposed grizzly fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868693/%2Bfiles/1206081-grizzly.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868693 "Change patch details")
* [proposed folsom fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868694/%2Bfiles/1206081-folsom.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868694 "Change patch details")

* [Add patch](/nova/%2Bbug/1206081/%2Baddcomment?field.patch=on)

## Bug attachments

* [example image](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3753115/%2Bfiles/11gb.qcow2.xz)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3753115 "Change attachment details")

* [Add attachment](/nova/%2Bbug/1206081/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from www.ubuntu.com_c2daf951_20250125_124637.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2247-1: OpenStack Nova vulnerabilities

17 June 2014

Several security issues were fixed in OpenStack Nova.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 14.04 ESM](/security/notices?release=trusty)
* [Ubuntu 13.10](/security/notices?release=saucy)
* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [nova](/security/cves?package=nova) - OpenStack Compute cloud infrastructure

## Details

Darragh O'Reilly discovered that the Ubuntu packaging for OpenStack Nova

did not properly set up its sudo configuration. If a different flaw was

found in OpenStack Nova, this vulnerability could be used to escalate

privileges. This issue only affected Ubuntu 13.10 and Ubuntu 14.04 LTS.

([CVE-2013-1068](/security/CVE-2013-1068))

Bernhard M. Wiedemann and Pedraig Brady discovered that OpenStack Nova did

not properly verify the virtual size of a QCOW2 images. A remote

authenticated attacker could exploit this to create a denial of service via

disk consumption. This issue did not affect Ubuntu 14.04 LTS.

([CVE-2013-4463](/security/CVE-2013-4463), [CVE-2013-4469](/security/CVE-2013-4469))

JuanFra Rodriguez Cardoso discovered that OpenStack Nova did not enforce

SSL connections when Nova was configured to use QPid and qpid\_protocol is

set to 'ssl'. If a remote attacker were able to perform a machine-in-the-middle

attack, this flaw could be exploited to view sensitive information. Ubuntu

does not use QPid with Nova by default. This issue did not affect Ubuntu

14.04 LTS. ([CVE-2013-6491](/security/CVE-2013-6491))

Loganathan Parthipan discovered that OpenStack Nova did not properly create

expected files during KVM live block migration. A remote authenticated

attacker could exploit this to obtain root disk snapshot contents via

ephemeral storage. This issue did not affect Ubuntu 14.04 LTS.

([CVE-2013-7130](/security/CVE-2013-7130))

Stanislaw Pitucha discovered that OpenStack Nova did not enforce the image

format when rescuing an instance. A remote authenticated attacker could

exploit this to read host files. In the default installation, attackers

would be isolated by the libvirt guest AppArmor profile. This issue only

affected Ubuntu 13.10. ([CVE-2014-0134](/security/CVE-2014-0134))

Mark Heckmann discovered that OpenStack Nova did not enforce RBAC policy

when adding security group rules via the EC2 API. A remote authenticated

user could exploit this to gain unintended access to this API. This issue

only affected Ubuntu 13.10. ([CVE-2014-0167](/security/CVE-2014-0167))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 14.04

* [python-nova](https://launchpad.net/ubuntu/%2Bsource/nova)
  -
  [1:2014.1-0ubuntu1.2](https://launchpad.net/ubuntu/%2Bsource/nova/1%3A2014.1-0ubuntu1.2)

##### Ubuntu 13.10

* [python-nova](https://launchpad.net/ubuntu/%2Bsource/nova)
  -
  [1:2013.2.3-0ubuntu1.2](https://launchpad.net/ubuntu/%2Bsource/nova/1%3A2013.2.3-0ubuntu1.2)

##### Ubuntu 12.04

* [python-nova](https://launchpad.net/ubuntu/%2Bsource/nova)
  -
  [2012.1.3+stable-20130423-e52e6912-0ubuntu1.4](https://launchpad.net/ubuntu/%2Bsource/nova/2012.1.3%2Bstable-20130423-e52e6912-0ubuntu1.4)

In general, a standard system update will make all the necessary changes.

## References

* [CVE-2013-1068](/security/CVE-2013-1068)
* [CVE-2013-4463](/security/CVE-2013-4463)
* [CVE-2013-4469](/security/CVE-2013-4469)
* [CVE-2013-6491](/security/CVE-2013-6491)
* [CVE-2013-7130](/security/CVE-2013-7130)
* [CVE-2014-0134](/security/CVE-2014-0134)
* [CVE-2014-0167](/security/CVE-2014-0167)

## Related notices

* [USN-2248-1](/security/notices/USN-2248-1)
* [USN-2208-1](/security/notices/USN-2208-1)
* [USN-2208-2](/security/notices/USN-2208-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from launchpad.net_1d0b4763_20250126_083852.html ===

[Log in / Register](https://launchpad.net/~ttx/%2Blogin)

[![](https://launchpadlibrarian.net/116816327/ttx64.jpg)](https://launchpad.net/~ttx)

## [Thierry Carrez](https://launchpad.net/~ttx)

* Overview
* [Code](https://code.launchpad.net/~ttx)
* [Bugs](https://bugs.launchpad.net/~ttx)
* [Blueprints](https://blueprints.launchpad.net/~ttx)
* [Translations](https://translations.launchpad.net/~ttx)
* [Answers](https://answers.launchpad.net/~ttx)

Chair of the Technical Committee and Release Manager for OpenStack.

Python Software Foundation member.

Ubuntu core developer.

* [Related packages](https://launchpad.net/~ttx/%2Brelated-packages)
* [Related projects](https://launchpad.net/~ttx/%2Brelated-projects)

## User information

Launchpad Id:
ttx

Email:
[Log in](%2Blogin) for email information.

Member since:
2008-05-12

[![Icon of Cassandra Ubuntu Packaging](https://launchpadlibrarian.net/59580596/cassandra-ubuntu-icon.png "Member of Cassandra Ubuntu Packaging")](/~cassandra-ubuntu)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of Launchpad Beta Testers](https://launchpadlibrarian.net/600856498/Canonical_Launchpad_icon_14px.png "Member of Launchpad Beta Testers")](/~launchpad-beta-testers)
[![Icon of Martin Pitt's fan](https://launchpadlibrarian.net/16410730/immaginexz0.png "Member of Martin Pitt's fan")](/~we-love-pitti)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack release team](https://launchpadlibrarian.net/73211233/openstack-release.png "Member of OpenStack release team")](/~openstack-release)
[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)
[![Icon of Python OpenStack Client Drivers](https://launchpadlibrarian.net/697274978/osc-icon.png "Member of Python OpenStack Client Drivers")](/~python-openstackclient-drivers)
[![Icon of Python OpenStack Client](https://launchpadlibrarian.net/697274843/osc-icon.png "Member of Python OpenStack Client")](/~python-openstackclient)
[![Icon of Soren's Target Audience](https://launchpadlibrarian.net/20548684/golf.png "Member of Soren's Target Audience")](/~sorens-target-audience)
[![Icon of Ubuntu Contributing Developers](https://launchpadlibrarian.net/17290192/wrench_emblem-trans.png "Member of Ubuntu Contributing Developers")](/~ubuntu-developer-members)
[![Icon of Ubuntu Members](https://launchpadlibrarian.net/606495581/CoF%2014px.png "Member of Ubuntu Members")](/~ubuntumembers)
[![Icon of Ubuntu Server papercutters](https://launchpadlibrarian.net/38078797/14.png "Member of Ubuntu Server papercutters")](/~server-papercutters)

Signed Ubuntu Code of Conduct:
Yes

Languages:

English, French

OpenPGP keys:

22A7943050DB1E67EC2B641A507AF89025B10423

SSH keys:

[ttx@stardust](%2Bsshkeys)

[ttx@mercury](%2Bsshkeys)

Time zone:

Europe/Paris
(UTC+0100)

Karma:
[0](https://launchpad.net/~ttx/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**ttx**
 on
**FreeNode**

## [All bugs in progress](https://launchpad.net/~ttx/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1473369 [new mock release broke a bunch of unit tests](https://bugs.launchpad.net/python-muranoclient/kilo/%2Bbug/1473369) |  |
| --- | --- | --- |
| in [python-muranoclient](/python-muranoclient), [Glance](/glance), [glance\_store](/glance-store), [Murano](/murano), [neutron](/neutron), [OpenStack Object Storage (swift)](/swift) | | |

| --- | --- | --- | --- | --- | --- |

## Personal package archives

| [Test Openstack 2011.3](/~ttx/%2Barchive/ubuntu/2011.3) |
| --- |
| [Extra packages](/~ttx/%2Barchive/ubuntu/extras) |
| [Bexar update candidates](/~ttx/%2Barchive/ubuntu/nova-bexar-updates) |
| [Junk PPA](/~ttx/%2Barchive/ubuntu/ppa) |
| [Terracotta stack](/~ttx/%2Barchive/ubuntu/terracotta) |

## [All memberships](https://launchpad.net/~ttx/%2Bparticipation) Latest memberships

| [kata-containers](/~kata-containers)  Joined on 2018-10-09 | |
| --- | --- |
| [OpenStack Folsom Stable Maintainers](/~openstack-folsom-maint)  Joined on 2013-04-11 | |
| [OpenStack Python3 Migration Team](/~openstack-py3-team)  Joined on 2013-03-20 | |
| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2012-05-25 | |
| [Swift Drivers](/~swift-drivers)  Joined on 2012-04-06 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from review.openstack.org_fca12e00_20250126_083852.html ===




=== Content from bugs.launchpad.net_e05375ba_20250126_083852.html ===

[Log in / Register](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Blogin)

[![](https://launchpadlibrarian.net/324577028/nova64.png)](https://launchpad.net/nova)

## [OpenStack Compute (nova)](https://launchpad.net/nova)

* [Overview](https://launchpad.net/nova)
* [Code](https://code.launchpad.net/nova)
* [Bugs](https://bugs.launchpad.net/nova)
* [Blueprints](https://blueprints.launchpad.net/nova)
* [Translations](https://translations.launchpad.net/nova)
* [Answers](https://answers.launchpad.net/nova)

# [OSSA 2013-029] Unchecked qcow2 root disk sizes DoS

Bug #1206081 reported by
[Bernhard M. Wiedemann](https://launchpad.net/~ubuntubmw)
on 2013-07-29

[272](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Compute (nova)](https://bugs.launchpad.net/nova) | Fix Released | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) | [OpenStack Compute (nova) 2014.1 "icehouse"](https://launchpad.net/nova/%2Bmilestone/2014.1) |
|  | [Folsom](https://bugs.launchpad.net/nova/folsom) | Won't Fix | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) |  |
|  | [Grizzly](https://bugs.launchpad.net/nova/grizzly) | Fix Released | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) | [OpenStack Compute (nova) 2013.1.5](https://launchpad.net/nova/%2Bmilestone/2013.1.5) |
|  | [Havana](https://bugs.launchpad.net/nova/havana) | Fix Released | High | [Pádraig Brady](https://launchpad.net/~p-draigbrady) | [OpenStack Compute (nova) 2013.2.1](https://launchpad.net/nova/%2Bmilestone/2013.2.1) |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | Medium | [Thierry Carrez](https://launchpad.net/~ttx) |  |

### Bug Description

When doing QA for SUSE on [bug 1177830](/bugs/1177830)

I found that the fix is incomplete,

because it assumed that the cached image would be mostly sparse.

However, I can easily create non-sparse small compressed qcow2 images with

perl -e 'for(1..11000){print "x" x 1024000}' > img

qemu-img convert -c -O qcow2 img img.qcow2

glance image-create --name=11gb --is-public=True --disk-format=qcow2 --container-format=bare < img.qcow2

nova boot --image 11gb --flavor m1.small testvm

which (in Grizzly and Essex) results in one (or two in Essex) 11GB large files being created in /var/lib/nova/instances/\_base/

still allowing attackers to fill up disk space of compute nodes

because the size check is only done after the uncompressing / caching

Tags:

[libvirt](/nova/%2Bbugs?field.tag=libvirt)

## CVE References

* [2013-4463](/bugs/cve/2013-4463 "OpenStack Compute (Nova) Folsom, Griz...")
* [2013-4469](/bugs/cve/2013-4469 "OpenStack Compute (Nova) Folsom, Griz...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Bernhard M. Wiedemann (ubuntubmw)](https://launchpad.net/~ubuntubmw) wrote on 2013-07-29: |  |  | [#1](/nova/%2Bbug/1206081/comments/1) |
| --- | --- | --- | --- |

* [example image](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3753115/%2Bfiles/11gb.qcow2.xz)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3753115)
  (26.1 KiB,
  application/octet-stream)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-01: |  |  | [#2](/nova/%2Bbug/1206081/comments/2) |
| --- | --- | --- | --- |

Russell, Mikal: could you confirm the vulnerability ?

Russell, Mikal: could you confirm the vulnerability ?

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Russell Bryant (russellb)](https://launchpad.net/~russellb) wrote on 2013-08-08: |  |  | [#3](/nova/%2Bbug/1206081/comments/3) |
| --- | --- | --- | --- |

Added Pádraig Brady to help review this.

Added Pádraig Brady to help review this.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-08-08: |  |  | [#4](/nova/%2Bbug/1206081/comments/4) |
| --- | --- | --- | --- |

Refreshing my memory for the flow of these images ... <http://www.pixelbeat.org/docs/openstack_libvirt_images/>

Yes this does seem like a valid issue, though not as serious as the related [bug 1177830](/bugs/1177830)

as there is only an allocation per image rather than per instance.

Also any sizes over the quote size etc. for an instance wouldn't be thus referenced and so

could be auto deleted at some stage.

But yes this is a valid DOS vector given the difference between input and output sizes.

Now if we did limit sizes, I suppose we could limit to the max flavor size?

But that doesn't help much. One could still upload many small images up to the max flavor size to fill up the \_base/

Maybe we need quotas glance side for max actual disk usage per user for all their images?

Refreshing my memory for the flow of these images ... http://www.pixelbeat.org/docs/openstack\_libvirt\_images/
Yes this does seem like a valid issue, though not as serious as the related bug 1177830
as there is only an allocation per image rather than per instance.
Also any sizes over the quote size etc. for an instance wouldn't be thus referenced and so
could be auto deleted at some stage.
But yes this is a valid DOS vector given the difference between input and output sizes.
Now if we did limit sizes, I suppose we could limit to the max flavor size?
But that doesn't help much. One could still upload many small images up to the max flavor size to fill up the \_base/
Maybe we need quotas glance side for max actual disk usage per user for all their images?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-09: |  |  | [#5](/nova/%2Bbug/1206081/comments/5) |
| --- | --- | --- | --- |

Looks like we'll need an OSSA on this then.

Looks like we'll need an OSSA on this then.

| Changed in ossa: | |
| --- | --- |
| **importance**: | Undecided → Medium |
| **status**: | Incomplete → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-19: |  |  | [#6](/nova/%2Bbug/1206081/comments/6) |
| --- | --- | --- | --- |

Anyone on the current subscription list up for a patch ?

Anyone on the current subscription list up for a patch ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-08-30: |  |  | [#7](/nova/%2Bbug/1206081/comments/7) |
| --- | --- | --- | --- |

Padraig, Mikal: any chance you could produce a patch to fix this ?

Padraig, Mikal: any chance you could produce a patch to fix this ?

| Changed in nova: | |
| --- | --- |
| **importance**: | Undecided → High |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-03: |  |  | [#8](/nova/%2Bbug/1206081/comments/8) |
| --- | --- | --- | --- |

Ok I'll take this (was away for a couple of weeks). I might get to it in the next couple of days

Ok I'll take this (was away for a couple of weeks). I might get to it in the next couple of days

| Changed in nova: | |
| --- | --- |
| **assignee**: | nobody → Pádraig Brady (p-draigbrady) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-09-10: |  |  | [#9](/nova/%2Bbug/1206081/comments/9) |
| --- | --- | --- | --- |

@Pádraig: any progress ?

@Pádraig: any progress ?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-19: |  |  | [#10](/nova/%2Bbug/1206081/comments/10) |
| --- | --- | --- | --- |

Lets summarize \_this\_ bug as "per \_image\_ qcow2 root disk sizes DoS"

and [bug 1177830](/bugs/1177830) as "per \_instance\_ qcow2 root disk sizes DoS".

Unfortunately I think that even [bug 1177830](/bugs/1177830) mightn't be addressed in the case

where use\_cow\_images=False, i.e. in nova.virt.libvirt.imagebackend.Raw.create\_image().

On initial inspection it seems like the large qcow2 files could be copied to each instance here too.

So thoughts on addressing this.

1. Always set min\_disk = virt\_size for an image in glance.

This is already checked in nova before we download anything.

That has the advantage of saving on network bandwidth and is

honored by cinder too for volumes.

2. Pass/Inspect size into nova.virt.images.fetch{,\_to\_raw}()

and disallow disk.get\_disk\_size('tmp\_download') > size

Doing either should address both bugs I think,

but I'm leaning towards 1 as a more general solution.

Lets summarize \_this\_ bug as "per \_image\_ qcow2 root disk sizes DoS"
and bug 1177830 as "per \_instance\_ qcow2 root disk sizes DoS".
Unfortunately I think that even bug 1177830 mightn't be addressed in the case
where use\_cow\_images=False, i.e. in nova.virt.libvirt.imagebackend.Raw.create\_image().
On initial inspection it seems like the large qcow2 files could be copied to each instance here too.
So thoughts on addressing this.
1. Always set min\_disk = virt\_size for an image in glance.
This is already checked in nova before we download anything.
That has the advantage of saving on network bandwidth and is
honored by cinder too for volumes.
2. Pass/Inspect size into nova.virt.images.fetch{,\_to\_raw}()
and disallow disk.get\_disk\_size('tmp\_download') > size
Doing either should address both bugs I think,
but I'm leaning towards 1 as a more general solution.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-20: |  |  | [#11](/nova/%2Bbug/1206081/comments/11) |
| --- | --- | --- | --- |

Actually we probably should do both.

Better to have nova not rely on a particular glance implementation or version or glance at all for that matter.

I'll do the nova change now...

Actually we probably should do both.
Better to have nova not rely on a particular glance implementation or version or glance at all for that matter.
I'll do the nova change now...

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-09-23

| Changed in ossa: | |
| --- | --- |
| **assignee**: | nobody → Thierry Carrez (ttx) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-09-27: |  |  | [#12](/nova/%2Bbug/1206081/comments/12) |
| --- | --- | --- | --- |

@Padraig: we'll take the Nova patch as the vulnerability fix. We'll consider the Glance as a hardening improvement.

@Padraig: we'll take the Nova patch as the vulnerability fix. We'll consider the Glance as a hardening improvement.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-09-27: |  |  | [#13](/nova/%2Bbug/1206081/comments/13) |
| --- | --- | --- | --- |

First attempt at an impact description, not sure I got this right:

----------------------

Title: Potential Nova denial of service through compressed disk images

Reporter: Bernhard M. Wiedemann (SUSE)

Products: Nova

Affects: All versions

Description:

Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space, potentially resulting in a Denial of Service attack on Nova compute nodes. This issue is slightly different from CVE-2013-2096 which was addressed in OSSA 2013-012.

---------------------------

First attempt at an impact description, not sure I got this right:
----------------------
Title: Potential Nova denial of service through compressed disk images
Reporter: Bernhard M. Wiedemann (SUSE)
Products: Nova
Affects: All versions
Description:
Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space, potentially resulting in a Denial of Service attack on Nova compute nodes. This issue is slightly different from CVE-2013-2096 which was addressed in OSSA 2013-012.
---------------------------

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → Triaged |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-09-27: |  |  | [#14](/nova/%2Bbug/1206081/comments/14) |
| --- | --- | --- | --- |

Re impact description, I'd mention that CVE-2013-2096 wasn't fully addressed either

in the non default case where use\_cow\_images=False, and malicious qcow images

are being transferred from glance. If mentioning both it's probably worth mentioning

the original CVE-2013-2096 was a per instance issue, while this new one is per image.

Re impact description, I'd mention that CVE-2013-2096 wasn't fully addressed either
in the non default case where use\_cow\_images=False, and malicious qcow images
are being transferred from glance. If mentioning both it's probably worth mentioning
the original CVE-2013-2096 was a per instance issue, while this new one is per image.

[Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady)
on 2013-09-27

| Changed in nova: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

[Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady)
on 2013-10-01

| Changed in nova: | |
| --- | --- |
| **milestone**: | none → havana-rc1 |
| **tags**: | added: havana-rc-potential libvirt |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-01: |  |  | [#18](/nova/%2Bbug/1206081/comments/18) |
| --- | --- | --- | --- |

RC1 will probably be out before we can properly embargo and release this as an OSSA. This should stay as havana-rc-potential just in case it can make it prerelease.

Would be good to get some core pre-approvals on the proposed patches. Feel free to subscribe fellow core developers to accelerate that.

RC1 will probably be out before we can properly embargo and release this as an OSSA. This should stay as havana-rc-potential just in case it can make it prerelease.
Would be good to get some core pre-approvals on the proposed patches. Feel free to subscribe fellow core developers to accelerate that.

| Changed in nova: | |
| --- | --- |
| **milestone**: | havana-rc1 → none |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Russell Bryant (russellb)](https://launchpad.net/~russellb) wrote on 2013-10-03: |  |  | [#19](/nova/%2Bbug/1206081/comments/19) |
| --- | --- | --- | --- |

Added a few nova developers that could help review these patches

Added a few nova developers that could help review these patches

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-07: |  |  | [#20](/nova/%2Bbug/1206081/comments/20) |
| --- | --- | --- | --- |

Hey guys, please review proposed patches !

Hey guys, please review proposed patches !

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Russell Bryant (russellb)](https://launchpad.net/~russellb) wrote on 2013-10-07: |  |  | [#21](/nova/%2Bbug/1206081/comments/21) |
| --- | --- | --- | --- |

+2 on the patch

+2 on the patch

[Russell Bryant (russellb)](https://launchpad.net/~russellb)
on 2013-10-07

| Changed in nova: | |
| --- | --- |
| **milestone**: | none → icehouse-1 |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#22](/nova/%2Bbug/1206081/comments/22) |
| --- | --- | --- | --- |

respinning with just improved commit messages

respinning with just improved commit messages

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#23](/nova/%2Bbug/1206081/comments/23) |
| --- | --- | --- | --- |

* [proposed havana fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868692/%2Bfiles/1206081-havana.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868692)
  (20.4 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#24](/nova/%2Bbug/1206081/comments/24) |
| --- | --- | --- | --- |

* [proposed grizzly fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868693/%2Bfiles/1206081-grizzly.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868693)
  (19.1 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-09: |  |  | [#25](/nova/%2Bbug/1206081/comments/25) |
| --- | --- | --- | --- |

* [proposed folsom fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868694/%2Bfiles/1206081-folsom.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868694)
  (16.8 KiB,
  text/plain)

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-09: |  |  | [#26](/nova/%2Bbug/1206081/comments/26) |
| --- | --- | --- | --- |

Nova core: Please review proposed patches

Nova core: Please review proposed patches

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-10-14

| **tags**: | added: havana-backport-potentialremoved: havana-rc-potential |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-21: |  |  | [#27](/nova/%2Bbug/1206081/comments/27) |
| --- | --- | --- | --- |

New attempt at impact description:

----------------------

Title: Potential Nova denial of service through compressed disk images

Reporter: Bernhard M. Wiedemann (SUSE)

Products: Nova

Affects: All versions

Description:

Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space for each image, potentially resulting in a Denial of Service attack on Nova compute nodes. While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes. The provided fixes address both issues.

---------------------------

New attempt at impact description:
----------------------
Title: Potential Nova denial of service through compressed disk images
Reporter: Bernhard M. Wiedemann (SUSE)
Products: Nova
Affects: All versions
Description:
Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's control of the size of disk images. By using malicious compressed qcow2 disk images, an authenticated user may consume large amounts of disk space for each image, potentially resulting in a Denial of Service attack on Nova compute nodes. While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes. The provided fixes address both issues.
---------------------------

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Vish Ishaya (vishvananda)](https://launchpad.net/~vishvananda) wrote on 2013-10-22: |  |  | [#28](/nova/%2Bbug/1206081/comments/28) |
| --- | --- | --- | --- |

+2 on patches

+2 on patches

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Pádraig Brady (p-draigbrady)](https://launchpad.net/~p-draigbrady) wrote on 2013-10-23: |  |  | [#29](/nova/%2Bbug/1206081/comments/29) |
| --- | --- | --- | --- |

+1 on impact description

+1 on impact description

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-24: |  |  | [#30](/nova/%2Bbug/1206081/comments/30) |
| --- | --- | --- | --- |

CVE requested

CVE requested

| Changed in ossa: | |
| --- | --- |
| **status**: | Triaged → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-25: |  |  | [#31](/nova/%2Bbug/1206081/comments/31) |
| --- | --- | --- | --- |

CVE-2013-4463

CVE-2013-4463

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-25: |  |  | [#32](/nova/%2Bbug/1206081/comments/32) |
| --- | --- | --- | --- |

Proposed public disclosure date/time: Thursday, October 31, 1500UTC.

Proposed public disclosure date/time: Thursday, October 31, 1500UTC.

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-28: |  |  | [#33](/nova/%2Bbug/1206081/comments/33) |
| --- | --- | --- | --- |

CVE SPLIT w/ CVE-2013-4469:

Title: Potential Nova denial of service through compressed disk images

Reporter: Bernhard M. Wiedemann (SUSE) & Pádraig Brady (Red Hat)

Products: Nova

Affects: All versions

Description:

Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's

control of the size of disk images. By using malicious compressed qcow2

disk images, an authenticated user may consume large amounts of disk

space for each image, potentially resulting in a Denial of Service

attack on Nova compute nodes (CVE-2013-4463). While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes (CVE-2013-4469). The provided fixes address both issues.

CVE SPLIT w/ CVE-2013-4469:
Title: Potential Nova denial of service through compressed disk images
Reporter: Bernhard M. Wiedemann (SUSE) & Pádraig Brady (Red Hat)
Products: Nova
Affects: All versions
Description:
Bernhard M. Wiedemann from SUSE reported a vulnerability in Nova's
control of the size of disk images. By using malicious compressed qcow2
disk images, an authenticated user may consume large amounts of disk
space for each image, potentially resulting in a Denial of Service
attack on Nova compute nodes (CVE-2013-4463). While fixing this issue, Pádraig Brady from Red Hat additionally discovered that OSSA 2013-012 did not fully address CVE-2013-2096 in the non-default case where use\_cow\_images=False, and malicious qcow images are being transferred from Glance. In that specific case, an authenticated user could still consume large amounts of disk space for each instance using the malicious image, potentially also resulting in a Denial of Service attack on Nova compute nodes (CVE-2013-4469). The provided fixes address both issues.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-30: |  |  | [#34](/nova/%2Bbug/1206081/comments/34) |
| --- | --- | --- | --- |

Patches test runs:

master: tox, smoke PASS

havana: tox, neutron PASS

grizzly: tox, full PASS

Patches test runs:
master: tox, smoke PASS
havana: tox, neutron PASS
grizzly: tox, full PASS

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-10-31

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix proposed to nova (stable/havana)**](/nova/%2Bbug/1206081/comments/35) |  |  | [#35](/nova/%2Bbug/1206081/comments/35) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/havana

Review: <https://review.openstack.org/54767>

Fix proposed to branch: stable/havana
Review: https://review.openstack.org/54767

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-31:  [**Re: Unchecked qcow2 root disk sizes DoS**](/nova/%2Bbug/1206081/comments/36) |  |  | [#36](/nova/%2Bbug/1206081/comments/36) |
| --- | --- | --- | --- |

master: <https://review.openstack.org/54765>

stable/havana: <https://review.openstack.org/54767>

stable/grizzly: <https://review.openstack.org/54768>

master: https://review.openstack.org/54765
stable/havana: https://review.openstack.org/54767
stable/grizzly: https://review.openstack.org/54768

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Thierry Carrez (ttx)](https://launchpad.net/~ttx) wrote on 2013-10-31: |  |  | [#37](/nova/%2Bbug/1206081/comments/37) |
| --- | --- | --- | --- |

[OSSA 2013-029]

[OSSA 2013-029]

| **summary**: | - Unchecked qcow2 root disk sizes DoS+ [OSSA 2013-029] Unchecked qcow2 root disk sizes DoS |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix merged to nova (master)**](/nova/%2Bbug/1206081/comments/38) |  |  | [#38](/nova/%2Bbug/1206081/comments/38) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/54765>

Committed: <http://github.com/openstack/nova/commit/f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30>

Submitter: Jenkins

Branch: master

commit f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30

Author: Pádraig Brady <email address hidden>

Date: Fri Sep 27 04:07:14 2013 +0100

ensure we don't boot oversized images

Since we can't generally shrink incoming images, add extra checks

    to ensure oversized images are not allowed through.

    All cases when populating the libvirt image cache are now handled,

    including the initial download from glance, where we avoid

    converting to raw, as that could generate non sparse images

    much larger than the downloaded image.

\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through

    of the max\_size parameter.

    \* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,

    and use it to discard images with larger (virtual) sizes.

    \* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new

    refactored function to identify and raise exception to oversized images.

    (Raw.create\_image): Pass the max\_size to the fetch function.

    Also enforce virtual image size checking for already fetched images,

    as this class (despite the name) can be handling qcow files.

    (Qcow2.create\_image): Pass the max\_size to the fetch function,

    or verify the virtual size for the instance as done previously.

    (Lvm.create\_image): Pass the max\_size to the fetch function.

    Also check the size before transferring to the volume to improve

    efficiency by not even attempting the transfer of oversized images.

    (Rbd.create\_image): Likewise.

    \* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.

    \* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):

    Add a case to check oversized images are discarded.

    \* nova/tests/virt/libvirt/test\_imagebackend.py

    (test\_create\_image\_too\_small): Adjust to avoid the fetch size check.

Fixes bug: 1177830

    Fixes bug: 1206081

    Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

Reviewed: https://review.openstack.org/54765
Committed: http://github.com/openstack/nova/commit/f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30
Submitter: Jenkins
Branch: master
commit f6810be4ae1a6c93e7d8017ee67d5344dfdf4a30
Author: Pádraig Brady <pbrady@redhat.com>
Date: Fri Sep 27 04:07:14 2013 +0100
ensure we don't boot oversized images
Since we can't generally shrink incoming images, add extra checks
to ensure oversized images are not allowed through.
All cases when populating the libvirt image cache are now handled,
including the initial download from glance, where we avoid
converting to raw, as that could generate non sparse images
much larger than the downloaded image.
\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through
of the max\_size parameter.
\* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,
and use it to discard images with larger (virtual) sizes.
\* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new
refactored function to identify and raise exception to oversized images.
(Raw.create\_image): Pass the max\_size to the fetch function.
Also enforce virtual image size checking for already fetched images,
as this class (despite the name) can be handling qcow files.
(Qcow2.create\_image): Pass the max\_size to the fetch function,
or verify the virtual size for the instance as done previously.
(Lvm.create\_image): Pass the max\_size to the fetch function.
Also check the size before transferring to the volume to improve
efficiency by not even attempting the transfer of oversized images.
(Rbd.create\_image): Likewise.
\* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.
\* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):
Add a case to check oversized images are discarded.
\* nova/tests/virt/libvirt/test\_imagebackend.py
(test\_create\_image\_too\_small): Adjust to avoid the fetch size check.
Fixes bug: 1177830
Fixes bug: 1206081
Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

| Changed in nova: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |
| **tags**: | added: in-stable-havana |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix merged to nova (stable/havana)**](/nova/%2Bbug/1206081/comments/39) |  |  | [#39](/nova/%2Bbug/1206081/comments/39) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/54767>

Committed: <http://github.com/openstack/nova/commit/3cdfe894ab58f7b91bf7fb690fc5bc724e44066f>

Submitter: Jenkins

Branch: stable/havana

commit 3cdfe894ab58f7b91bf7fb690fc5bc724e44066f

Author: Pádraig Brady <email address hidden>

Date: Fri Sep 27 04:07:14 2013 +0100

ensure we don't boot oversized images

Since we can't generally shrink incoming images, add extra checks

    to ensure oversized images are not allowed through.

    All cases when populating the libvirt image cache are now handled,

    including the initial download from glance, where we avoid

    converting to raw, as that could generate non sparse images

    much larger than the downloaded image.

\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through

    of the max\_size parameter.

    \* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,

    and use it to discard images with larger (virtual) sizes.

    \* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new

    refactored function to identify and raise exception to oversized images.

    (Raw.create\_image): Pass the max\_size to the fetch function.

    Also enforce virtual image size checking for already fetched images,

    as this class (despite the name) can be handling qcow files.

    (Qcow2.create\_image): Pass the max\_size to the fetch function,

    or verify the virtual size for the instance as done previously.

    (Lvm.create\_image): Pass the max\_size to the fetch function.

    Also check the size before transferring to the volume to improve

    efficiency by not even attempting the transfer of oversized images.

    (Rbd.create\_image): Likewise.

    \* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.

    \* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):

    Add a case to check oversized images are discarded.

    \* nova/tests/virt/libvirt/test\_imagebackend.py

    (test\_create\_image\_too\_small): Adjust to avoid the fetch size check.

Fixes bug: 1177830

    Fixes bug: 1206081

    Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

Reviewed: https://review.openstack.org/54767
Committed: http://github.com/openstack/nova/commit/3cdfe894ab58f7b91bf7fb690fc5bc724e44066f
Submitter: Jenkins
Branch: stable/havana
commit 3cdfe894ab58f7b91bf7fb690fc5bc724e44066f
Author: Pádraig Brady <pbrady@redhat.com>
Date: Fri Sep 27 04:07:14 2013 +0100
ensure we don't boot oversized images
Since we can't generally shrink incoming images, add extra checks
to ensure oversized images are not allowed through.
All cases when populating the libvirt image cache are now handled,
including the initial download from glance, where we avoid
converting to raw, as that could generate non sparse images
much larger than the downloaded image.
\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through
of the max\_size parameter.
\* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,
and use it to discard images with larger (virtual) sizes.
\* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new
refactored function to identify and raise exception to oversized images.
(Raw.create\_image): Pass the max\_size to the fetch function.
Also enforce virtual image size checking for already fetched images,
as this class (despite the name) can be handling qcow files.
(Qcow2.create\_image): Pass the max\_size to the fetch function,
or verify the virtual size for the instance as done previously.
(Lvm.create\_image): Pass the max\_size to the fetch function.
Also check the size before transferring to the volume to improve
efficiency by not even attempting the transfer of oversized images.
(Rbd.create\_image): Likewise.
\* nova/tests/virt/libvirt/fake\_libvirt\_utils.py: Support max\_size arg.
\* nova/tests/virt/libvirt/test\_libvirt.py (test\_fetch\_raw\_image):
Add a case to check oversized images are discarded.
\* nova/tests/virt/libvirt/test\_imagebackend.py
(test\_create\_image\_too\_small): Adjust to avoid the fetch size check.
Fixes bug: 1177830
Fixes bug: 1206081
Change-Id: I3d47adaa2ad07434853f447feb27d7aae0e2e717

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2013-10-31:  [**Fix merged to nova (stable/grizzly)**](/nova/%2Bbug/1206081/comments/40) |  |  | [#40](/nova/%2Bbug/1206081/comments/40) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/54768>

Committed: <http://github.com/openstack/nova/commit/135faa7b5d9855312bedc19e5e1ecebae34d3d18>

Submitter: Jenkins

Branch: stable/grizzly

commit 135faa7b5d9855312bedc19e5e1ecebae34d3d18

Author: Pádraig Brady <email address hidden>

Date: Fri Sep 27 04:07:14 2013 +0100

ensure we don't boot oversized images

Since we can't generally shrink incoming images, add extra checks

    to ensure oversized images are not allowed through.

    All cases when populating the libvirt image cache are now handled,

    including the initial download from glance, where we avoid

    converting to raw, as that could generate non sparse images

    much larger than the downloaded image.

\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through

    of the max\_size parameter.

    \* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,

    and use it to discard images with larger (virtual) sizes.

    \* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new

    refactored function to identify and raise exception to oversized images.

    (Raw.create\_image): Pass the max\_size to the fetch function.

    Also enforce virtual image size checking for already fetched images,

    as this class (despite the name) can be handling qcow files.

    (Qcow2.create\_image): Pass the max\_size to the fetch function,

    or verify the virtual size for the instance as done previously.

    (Lvm.create\_image): Pass the max\_size to the fetch function.

    Also check the size before transferring to the volume to improve

    efficiency by not even attempting the transfer of oversized images.

    (Rbd.create\_image): Likewise.

    \* nova/tests/fake\_libvirt\_utils.py: Support max\_size arg.

    \* nova/tests/test\_libvirt.py (test\_fetch\_raw\_image):

    Add a case to check oversized images are discarded.

    \* nova/tests/test\_imagebackend.py (test\_create\_image\_too\_small):

    Adjust to avoid the fetch size check.

Fixes bug: 1177830

    Fixes bug: 1206081

Conflicts:

nova/tests/test\_imagebackend.py

     nova/virt/libvirt/imagebackend.py

Change-Id: Idc35fce580be4f74e23883d1b4bea6475c3f6e30

Reviewed: https://review.openstack.org/54768
Committed: http://github.com/openstack/nova/commit/135faa7b5d9855312bedc19e5e1ecebae34d3d18
Submitter: Jenkins
Branch: stable/grizzly
commit 135faa7b5d9855312bedc19e5e1ecebae34d3d18
Author: Pádraig Brady <pbrady@redhat.com>
Date: Fri Sep 27 04:07:14 2013 +0100
ensure we don't boot oversized images
Since we can't generally shrink incoming images, add extra checks
to ensure oversized images are not allowed through.
All cases when populating the libvirt image cache are now handled,
including the initial download from glance, where we avoid
converting to raw, as that could generate non sparse images
much larger than the downloaded image.
\* nova/virt/libvirt/utils.py (fetch\_image): Allow passing through
of the max\_size parameter.
\* nova/virt/images.py (fetch\_to\_raw): Accept the max\_size parameter,
and use it to discard images with larger (virtual) sizes.
\* nova/virt/libvirt/imagebackend.py (verify\_base\_size): A new
refactored function to identify and raise exception to oversized images.
(Raw.create\_image): Pass the max\_size to the fetch function.
Also enforce virtual image size checking for already fetched images,
as this class (despite the name) can be handling qcow files.
(Qcow2.create\_image): Pass the max\_size to the fetch function,
or verify the virtual size for the instance as done previously.
(Lvm.create\_image): Pass the max\_size to the fetch function.
Also check the size before transferring to the volume to improve
efficiency by not even attempting the transfer of oversized images.
(Rbd.create\_image): Likewise.
\* nova/tests/fake\_libvirt\_utils.py: Support max\_size arg.
\* nova/tests/test\_libvirt.py (test\_fetch\_raw\_image):
Add a case to check oversized images are discarded.
\* nova/tests/test\_imagebackend.py (test\_create\_image\_too\_small):
Adjust to avoid the fetch size check.
Fixes bug: 1177830
Fixes bug: 1206081
Conflicts:
nova/tests/test\_imagebackend.py
nova/virt/libvirt/imagebackend.py
Change-Id: Idc35fce580be4f74e23883d1b4bea6475c3f6e30

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-11-01

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Gary Kotton (garyk)](https://launchpad.net/~garyk)
on 2013-11-07

| **tags**: | removed: havana-backport-potential |
| --- | --- |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2013-12-04

| Changed in nova: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Alan Pevec (apevec)](https://launchpad.net/~apevec)
on 2013-12-08

| **tags**: | removed: in-stable-havana |
| --- | --- |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-04-17

| Changed in nova: | |
| --- | --- |
| **milestone**: | icehouse-1 → 2014.1 |

[See full activity log](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/nova/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/nova/%2Bbug/1206081/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [proposed havana fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868692/%2Bfiles/1206081-havana.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868692 "Change patch details")
* [proposed grizzly fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868693/%2Bfiles/1206081-grizzly.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868693 "Change patch details")
* [proposed folsom fix](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3868694/%2Bfiles/1206081-folsom.patch)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3868694 "Change patch details")

* [Add patch](/nova/%2Bbug/1206081/%2Baddcomment?field.patch=on)

## Bug attachments

* [example image](https://bugs.launchpad.net/nova/%2Bbug/1206081/%2Battachment/3753115/%2Bfiles/11gb.qcow2.xz)
  [Edit](/nova/%2Bbug/1206081/%2Battachment/3753115 "Change attachment details")

* [Add attachment](/nova/%2Bbug/1206081/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


