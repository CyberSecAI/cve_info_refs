=== Content from bugzilla.wikimedia.org_8cfcbbf5_20250126_045127.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT58699)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T58699
# TimedMediaHandler allows for stored XSSClosed, Resolved[Public](/policy/explain/PHID-TASK-clpftahbycdauscf5lxe/view/)Actions

* [Edit Task](/maniphest/task/edit/58699/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/58699/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-clpftahbycdauscf5lxe/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-clpftahbycdauscf5lxe/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-clpftahbycdauscf5lxe/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-clpftahbycdauscf5lxe/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-clpftahbycdauscf5lxe/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-clpftahbycdauscf5lxe/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-clpftahbycdauscf5lxe/)
* [Protect as security issue](/wmf/escalate-task/58699/)
* [Award Token](/token/give/PHID-TASK-clpftahbycdauscf5lxe/)
* [Flag For Later](/flag/edit/PHID-TASK-clpftahbycdauscf5lxe/)

Assigned ToNoneAuthored By

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |
| Nov 6 2013, 11:32 PM2013-11-06 23:32:00 (UTC+0) |

Tags

* [TimedMediaHandler](/tag/timedmediahandler/) [(To sort)](/project/board/299/)
* [Multimedia](/tag/multimedia/) [(Done)](/project/board/48/)
* [Vuln-XSS](/tag/vuln-xss/)
* [Security](/tag/security/)
Referenced Files

|  | [F11995: xssFix.diff](/F11995) |
| --- | --- |
| Nov 22 2014, 2:14 AM2014-11-22 02:14:41 (UTC+0) |

|  | [F11994: bug56699.patch](/F11994) |
| --- | --- |
| Nov 22 2014, 2:14 AM2014-11-22 02:14:35 (UTC+0) |

Subscribers

|  | [Bawolff](/p/Bawolff/) |
| --- | --- |

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [• Fabrice\_Florin](/p/Fabrice_Florin/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [MarkTraceur](/p/MarkTraceur/) |
| --- | --- |

|  | [Matanya](/p/Matanya/) |
| --- | --- |

|  | [Schnark](/p/Schnark/) |
| --- | --- |

|  | [Tgr](/p/Tgr/) |
| --- | --- |

# Description

Steps to reproduce:

\*Add <span class="PopUpMediaTransform" data-videopayload="&lt;script&gt;alert(1)&lt;/script&gt;">[[foo]]</span> to a page

\*Hit save

\*Click on link

(Important note, only present on page save, it appears there is a bug in how TimedMediaHandler loads javascript on page preview).

The vulnrability is in TimedMediaHandler/resources/mw.PopUpThumbVideo.js:

Specificly the line:

var $videoContainer = $( unescape( $(this).parent().attr('data-videopayload') ) );

and later line

mw.addDialog({

...

```
'title' : $videoContainer.find('video,audio').attr('data-mwtitle'),
'content' : $videoContainer,
```

Suggested solution - Easy workaround for right now would be setting $wgMinimumVideoPlayerSize to 0 and stop TimedMediaHandler/resources/mw.PopUpThumbVideo.js from being served.

Longer term, I guess would be to rewrite how PopUpThumbVideo, so it is given the information not as a string of html, but as data it can turn into html safely. Alternatively, maybe instead of putting the html as a string, display:none ing the html, and then retrieving it for the pop up.

---

Discovered well investigating bug 56538. That bug has the obvious issue of unescaping something with the non-unicode aware unescape function when the input isn't even url escaped in the first place, but I haven't mentioned on bug since that quite obviously leads to discovering this.

---

**Version**: unspecified

**Severity**: normal

# Details

Reference bz56699
# Related ObjectsSearch...

* Task Graph

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  |  |  |  | Restricted Task |
|  |  | Resolved |  | *None* | T58699 [TimedMediaHandler allows for stored XSS](/T58699) |

### Event Timeline

[• bzimport](/p/bzimport/) raised the priority of this task from  to Unbreak Now!.[Nov 22 2014, 2:14 AM2014-11-22 02:14:34 (UTC+0)](#596090)[• bzimport](/p/bzimport/) added a project: [TimedMediaHandler](/tag/timedmediahandler/).[• bzimport](/p/bzimport/) set Reference to bz56699.[Bawolff](/p/Bawolff/) created this task.[Nov 6 2013, 11:32 PM2013-11-06 23:32:00 (UTC+0)](#596092)[• csteipp](/p/csteipp/) added a comment.[Nov 7 2013, 1:29 AM2013-11-07 01:29:19 (UTC+0)](#596101)Comment Actions

Working exploit on commons would be:

<span class="PopUpMediaTransform" data-videopayload="&lt;script&gt;alert(1)&lt;/script&gt;">[[File:Shock\_wave\_above\_A320\_wing\_(1).webm|100px]]</span>

And click on the thumbnail. And please click "Preview" instead of save, so we don't have these in recent changes..

I think we'll set $wgMinimumVideoPlayerSize = 0, and basically blank mw.PopUpThumbVideo.js so we prevent this from running. I'm not seeing an easy fix to this that we could deploy immediately.

[• csteipp](/p/csteipp/) added a comment.[Nov 7 2013, 5:20 PM2013-11-07 17:20:34 (UTC+0)](#596105)Comment Actions

A slightly less drastic measure would be to disable the vector that's being used, and change the attribute name that is storing the html to one that can't be inserted by other users. So if we change the payload to sit in 'videopayload' as the attribute, and the javsacript checks for a div with that attribute, there shouldn't be a way for users to inject a fake one on the page.

[• csteipp](/p/csteipp/) added a comment.[Nov 7 2013, 6:05 PM2013-11-07 18:05:23 (UTC+0)](#596126)Comment Actions

Created attachment 13720

Rename vulnerable attribute

**Attached**: bug56699.patch1 KB[Download](https://phab.wmfusercontent.org/file/download/d7j34i34gtdlualsn2c2/PHID-FILE-ls5ihbyhvmh53jm3ekt3/bug56699.patch)

[• bzimport](/p/bzimport/) added a comment.[Nov 7 2013, 9:11 PM2013-11-07 21:11:14 (UTC+0)](#596137)Comment Actions

**mdale** wrote:

Fix looks good to me.

Probably would not hurt to add in:

$videoContainer = $videoContainer.filter( 'div,video,track,audio' );

Before mw.addDialog({ call as well.

[Bawolff](/p/Bawolff/) added a comment.[Nov 7 2013, 9:20 PM2013-11-07 21:20:20 (UTC+0)](#596151)Comment Actions

That seems like a reasonable short term fix. Long term it would be nice if we avoided stuffing html in attributes (separating code and data is good, validation, etc)

[• bzimport](/p/bzimport/) added a comment.[Nov 7 2013, 10:41 PM2013-11-07 22:41:41 (UTC+0)](#596162)Comment Actions

**mdale** wrote:

Yea... we should just package that in JSON instead of HTML for the respective embed build out / pop-up.

Will add it to the TODO list for the player update ;)

[Bawolff](/p/Bawolff/) added a comment.[Nov 8 2013, 5:56 PM2013-11-08 17:56:54 (UTC+0)](#596168)Comment Actions

It just occured to me the old version of the html would be in parser cache, so if we disabled reading from data-payload, it would break pages with old cache.

[• bzimport](/p/bzimport/) added a comment.[Nov 8 2013, 9:41 PM2013-11-08 21:41:23 (UTC+0)](#596177)Comment Actions

**mdale** wrote:

$videoContainer = $videoContainer.filter( 'div,video,track,audio' );

Would be safe for existing cached pages?

And or check both places as we transition?

[• csteipp](/p/csteipp/) added a comment.[Nov 8 2013, 11:29 PM2013-11-08 23:29:34 (UTC+0)](#596188)Comment Actions

Thanks for bringing that up Bawolff. Thankfully with the cluster break this morning I didn't deploy :)

We don't want to check for the old value, since that will allow the xss for another 30 days while the caches expire. And although the filter is probably a good start, it won't quite work since it won't catch <video onerror="alert(1)"><source></source></video> if someone can add that to the attribute.

Is it possible to deploy our patch as it, and use a maintenance script to edit or purge all the articles using video files? I'm not sure if we keep a reference around to where we use all the files..

[Tgr](/p/Tgr/) added a comment.[Nov 9 2013, 12:15 AM2013-11-09 00:15:27 (UTC+0)](#596195)Comment Actions

We could keep the old value for 30 days, and add data-videopayload as a temporary exception to the Sanitizer class.

[Bawolff](/p/Bawolff/) added a comment.[Nov 9 2013, 2:34 AM2013-11-09 02:34:40 (UTC+0)](#596205)Comment Actions

(In reply to comment #9)

> Is it possible to deploy our patch as it, and use a maintenance script to
>
> edit
>
> or purge all the articles using video files? I'm not sure if we keep a
>
> reference around to where we use all the files..

We do, sort of. You can look at everything with img\_media\_type = VIDEO, and join on globalimagelinks. Doesn't sound like the most fun thing to do though, might get complicated with cross-wiki stuff.

(In reply to comment #10)

> We could keep the old value for 30 days, and add data-videopayload as a
>
> temporary exception to the Sanitizer class.

Temp blacklisting data-videopayload sounds fine to me

Also if worst comes to worst, we just need to make sure the cached pages aren't totally broken, if there is some sane fallback (like going to the file description page on click), that would probably be fine for the transition. Most popular pages end up getting edited or otherwise have their cache purged before the 30 days are up.

> good start, it won't quite work since it won't catch <video
>
> onerror="alert(1)"><source></source></video> if someone can add that to the
>
> attribute.

I'm not sure I like the filter idea, seems like it would give a false sense of security. At the very least, even if the filter stripped all js, the filter wouldn't prevent someone making a fake video tag that referenced a video on another website, potentially exposing user IPs.

[Bawolff](/p/Bawolff/) added a comment.[Nov 9 2013, 2:50 AM2013-11-09 02:50:38 (UTC+0)](#596219)Comment Actions
> Also if worst comes to worst, we just need to make sure the cached pages
>
> aren't
>
> totally broken, if there is some sane fallback (like going to the file
>
> description page on click), that would probably be fine for the transition.
>
> Most popular pages end up getting edited or otherwise have their cache purged
>
> before the 30 days are up.

Actually, current behaviour if the js doesn't run, is to go directly to video file - which isn't exactly horrid (but not great), as many web browsers would probably just play the file.

[• bzimport](/p/bzimport/) added a comment.[Nov 9 2013, 2:24 PM2013-11-09 14:24:37 (UTC+0)](#596250)Comment Actions

**mdale** wrote:

Yea seems like filter is not a good idea. Even serialized JSON if in the data-\* attribute could result in leaking IPs to other domains if full urls are taken as is. So we are back to non-standard HTML attribute since we let users control the data-\* attributes in HTML output.

The final solution may be an api request based solely on a title attribute instead of packing in all resource data inline. Assuming we care about "standard" HTML.

Tisza idea of restricting data-videopayload in santization sounds reasonable, if not too much work, would prevent you from saving new pages with this attribute?

Or just deploy the change as proposed, and old pages will just end up linking to the file of the respective asset.

IE, Safari users will get a prompt to play in VLC or what have you but in-browser cortado is bad experience anyway / often java is disabled.

[• csteipp](/p/csteipp/) added a comment.[Nov 13 2013, 12:50 AM2013-11-13 00:50:52 (UTC+0)](#596261)Comment Actions

(In reply to comment #13)

> Tisza idea of restricting data-videopayload in santization sounds reasonable,
>
> if not too much work, would prevent you from saving new pages with this
>
> attribute?

If we had global abuse filters, we could prevent it coming in, but we don't. So I think the only way we could filter this would be a temporary hack in the Sanitizer, which we don't typically do. So I'm thinking no, unless Gergő, were you thinking of another way to filter those?

So if we change the attribute name (my patch), I think the fallback behavior for when the user gets a cached page, but current javascript, would be they are taken to the file page and could play it there, right? I don't have this setup in a way I can confirm that, but if so, then initially a lot of users would click through, but then pages would get recached and the popup would work.

Does that sounds realistic? Or am I off on that?

[Bawolff](/p/Bawolff/) added a comment.[Nov 13 2013, 1:07 AM2013-11-13 01:07:29 (UTC+0)](#596269)Comment Actions

(In reply to comment #14)

> (In reply to comment #13)
>
> > Tisza idea of restricting data-videopayload in santization sounds reasonable,
> >
> > if not too much work, would prevent you from saving new pages with this
> >
> > attribute?
>
> If we had global abuse filters, we could prevent it coming in, but we don't.
>
> So
>
> I think the only way we could filter this would be a temporary hack in the
>
> Sanitizer, which we don't typically do. So I'm thinking no, unless Gergő,
>
> were
>
> you thinking of another way to filter those?

That's (patch Sanitizer) what I was assuming he meant.

> So if we change the attribute name (my patch), I think the fallback behavior
>
> for when the user gets a cached page, but current javascript, would be they
>
> are
>
> taken to the file page and could play it there, right?

Just tested, and that's not what happens. The behaviour is that an empty dialog is popped up (the if statement for if to put the pop-up is based only on class name, and doesn't check if there is a valid (data-)videopayload attribute.

[• bzimport](/p/bzimport/) added a comment.[Nov 13 2013, 1:09 AM2013-11-13 01:09:15 (UTC+0)](#596275)Comment Actions

**mdale** wrote:

yea you would need to add:

if( $videoContainer.length == 0 ){

```
return true;
```

}

For it to follow the link if the attribute was not found.

[Bawolff](/p/Bawolff/) added a comment.[Nov 13 2013, 1:11 AM2013-11-13 01:11:31 (UTC+0)](#596285)Comment Actions

(In reply to comment #16)

> yea you would need to add:
>
> if( $videoContainer.length == 0 ){
>
> ```
> return true;
> ```
>
> }
>
> For it to follow the link if the attribute was not found.

There's the additional problem in that the link is to the actual file, not the file page. We probably want to direct users to the former.

[• bzimport](/p/bzimport/) added a comment.[Nov 13 2013, 1:14 AM2013-11-13 01:14:08 (UTC+0)](#596290)Comment Actions

**mdale** wrote:

Unfortunately that would create an infinite loop on non-purged file pages at the moment, since the popup was recently broadly enabled on commons.

[Bawolff](/p/Bawolff/) added a comment.[Nov 13 2013, 3:13 AM2013-11-13 03:13:14 (UTC+0)](#596294)Comment Actions

Created attachment 13782

Rename the attribute with graceful degradation

(In reply to comment #18)

> Unfortunately that would create an infinite loop on non-purged file pages at
>
> the moment, since the popup was recently broadly enabled on commons.

Well the main image on the file description page isn't included in the parser cache (One could still have issues with browser cache, and perhaps squid/varnish for logged out users).

Anyways, included is a patch which I think would degrade relatively gracefully in all cases. If the element is not present, it redirects user to image page, unless already on image page, in which case user goes directly to the file.

**Attached**: xssFix.diff3 KB[Download](https://phab.wmfusercontent.org/file/download/kek5ldmrd6w3skkm2vic/PHID-FILE-w7ljyfwt7pdx43hhs45p/xssFix.diff)

[• csteipp](/p/csteipp/) added a comment.[Nov 14 2013, 7:34 PM2013-11-14 19:34:36 (UTC+0)](#596307)Comment Actions

This issue was assigned CVE-2013-4574. Since we don't have a patch on the cluster yet, we'll wait to release this publicly with 1.21.4.

[• csteipp](/p/csteipp/) added a comment.[Nov 19 2013, 11:16 PM2013-11-19 23:16:06 (UTC+0)](#596318)Comment Actions

Bawolff, sorry for the delay on this, but I think that patch looks good. I'll get it deployed onto the cluster this week.

[• csteipp](/p/csteipp/) added a comment.[Nov 26 2013, 8:28 PM2013-11-26 20:28:10 (UTC+0)](#596328)Comment Actions

Deployed onto the cluster:

20:21 logmsgbot: csteipp synchronized php-1.23wmf4/extensions/TimedMediaHandler 'bug56699'

20:16 logmsgbot: csteipp synchronized php-1.23wmf5/extensions/TimedMediaHandler 'bug56699'

It looks like there are on a few non WMF sits running the extension ([http://wikiapiary.com/wiki/Extension:TimedMediaHandler](http://wikiapiary.com/wiki/Extension%3ATimedMediaHandler)). Michael, we can either keep the patch a secret until the next security release and do an official release of it then, or we can put it into gerrit now and give it a brief mention of it when we do the release. Let me know your preference.

[• bzimport](/p/bzimport/) added a comment.[Nov 27 2013, 4:52 AM2013-11-27 04:52:36 (UTC+0)](#596346)Comment Actions

**mdale** wrote:

Standard practice would be keep a secret until the next security release no?

When you say release, you mean for the full mediaWiki package and all extensions running on WMF wikis correct?

I don't know if folks would be accustom to checking for TMH releases, since that has not been a regular thing.

[• csteipp](/p/csteipp/) added a comment.[Nov 27 2013, 9:48 PM2013-11-27 21:48:10 (UTC+0)](#596365)Comment Actions

(In reply to comment #23)

> Standard practice would be keep a secret until the next security release no?

Yes

> When you say release, you mean for the full mediaWiki package and all
>
> extensions running on WMF wikis correct?

Yes

> I don't know if folks would be accustom to checking for TMH releases, since
>
> that has not been a regular thing.

Ok, I think then we'll wait for the next tarball release, and we'll mention this at that time. We'll probably need one early next month.

[• csteipp](/p/csteipp/) added a comment.[Dec 10 2013, 4:51 PM2013-12-10 16:51:28 (UTC+0)](#596381)Comment Actions

* Bug 58263 has been marked as a duplicate of this bug. \*\*\*
[• Gilles](/p/Gilles/) added a project: [Multimedia](/tag/multimedia/).[Nov 24 2014, 3:19 PM2014-11-24 15:19:23 (UTC+0)](#779385)[• Gilles](/p/Gilles/) moved this task from [Untriaged](/project/board/48/) to [Done](/project/board/48/) on the [Multimedia](/tag/multimedia/) board.[Dec 2 2014, 8:55 AM2014-12-02 08:55:29 (UTC+0)](#800652)[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[Mar 26 2015, 8:39 PM2015-03-26 20:39:05 (UTC+0)](#1154556)[• csteipp](/p/csteipp/) added a project: [Vuln-XSS](/tag/vuln-xss/).[Aug 20 2015, 10:08 PM2015-08-20 22:08:00 (UTC+0)](#1559012)Restricted Application added a subscriber: [Matanya](/p/Matanya/).  · [View Herald Transcript](/herald/transcript/895946/)[Aug 20 2015, 10:08 PM2015-08-20 22:08:00 (UTC+0)](#1559013)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:50 PM2020-02-10 22:50:49 (UTC+0)](#5867224) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:11 PM2020-02-20 20:11:42 (UTC+0)](#5903038) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from bugzilla.wikimedia.org_8153f7a3_20250126_045125.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT56527)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T56527
# NULL pointer dereference in php-luasandboxClosed, Resolved[Public](/policy/explain/PHID-TASK-y7ivxufptazz3i3uccqt/view/)Actions

* [Edit Task](/maniphest/task/edit/56527/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/56527/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-y7ivxufptazz3i3uccqt/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-y7ivxufptazz3i3uccqt/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Protect as security issue](/wmf/escalate-task/56527/)
* [Award Token](/token/give/PHID-TASK-y7ivxufptazz3i3uccqt/)
* [Flag For Later](/flag/edit/PHID-TASK-y7ivxufptazz3i3uccqt/)

Assigned ToNoneAuthored By

|  | [Anomie](/p/Anomie/) |
| --- | --- |
| Sep 24 2013, 8:14 PM2013-09-24 20:14:00 (UTC+0) |

Tags

* [Scribunto](/tag/scribunto/) [(Backlog)](/project/board/558/)
* [Security](/tag/security/)
Referenced Files

|  | [F12015: scribunto.diff](/F12015) |
| --- | --- |
| Nov 22 2014, 2:15 AM2014-11-22 02:15:32 (UTC+0) |

|  | [F12014: 0003-Update-changelog.patch](/F12014) |
| --- | --- |
| Nov 22 2014, 2:15 AM2014-11-22 02:15:31 (UTC+0) |

|  | [F12013: 0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch](/F12013) |
| --- | --- |
| Nov 22 2014, 2:15 AM2014-11-22 02:15:31 (UTC+0) |

Subscribers

|  | [• csteipp](/p/csteipp/) |
| --- | --- |

|  | [Dzahn](/p/Dzahn/) |
| --- | --- |

|  | [Grunny](/p/Grunny/) |
| --- | --- |

|  | [tstarling](/p/tstarling/) |
| --- | --- |

|  | [vvv](/p/vvv/) |
| --- | --- |

# Description

Patch to php-luasandbox to handle the NULL

As part of converting data structures from Lua to PHP, lua-phpsandbox will convert Lua tables to PHP arrays. To do this, it uses the lua\_tolstring function to convert the table keys into strings for PHP.

Unfortunately, lua\_tolstring will return NULL if it is asked to convert any data type besides number and string, and this possibility is not being checked before the resulting pointer is passed to zend\_hash\_update. zend\_hash\_update turns around and passes the pointer to zend\_inline\_hash\_func, which dereferences the pointer and causes a crash.

This crash can be caused by any user simply by returning a table such as { [{}] = 1 } from a module function, or by passing such a table to PHP.

The attached patch fixes matters by checking for this NULL and throwing an error.

---

**Version**: unspecified

**Severity**: normal

*attachment diff1 ignored as obsolete*

# Details

Reference bz54527
# Related ObjectsSearch...

* Task Graph

|  |  | Status | Subtype | Assigned | Task |
| --- | --- | --- | --- | --- | --- |
|  |  |  |  |  | Restricted Task |
|  |  | Resolved |  | *None* | T56527 [NULL pointer dereference in php-luasandbox](/T56527) |

### Event Timeline

[• bzimport](/p/bzimport/) raised the priority of this task from  to Needs Triage.[Nov 22 2014, 2:15 AM2014-11-22 02:15:29 (UTC+0)](#597837)[• bzimport](/p/bzimport/) added a project: [Scribunto](/tag/scribunto/).[• bzimport](/p/bzimport/) set Reference to bz54527.[• bzimport](/p/bzimport/) added a subscriber: Unknown Object (MLST).[Anomie](/p/Anomie/) created this task.[Sep 24 2013, 8:14 PM2013-09-24 20:14:00 (UTC+0)](#597843)

[Anomie](/p/Anomie/) added a comment.[Sep 24 2013, 8:17 PM2013-09-24 20:17:56 (UTC+0)](#597857)Comment Actions

Created attachment 13362

Patch to Scribunto to handle the same situation in LuaStandalone

The LuaStandalone interpreter in Scribunto also doesn't handle these problematic keys correctly, although here there is no null pointer problem. It will, however, encode table and function keys using Lua's default tostring function which will expose the pointer addresses of tables and functions.

This patch probably isn't a security issue in itself, but anyone seeing it could easily think to try the same thing in LuaSandbox and discover the php-luasandbox bug. So I'm going to put this patch here too, at least for the moment.

*attachment diff2 ignored as obsolete*

[• csteipp](/p/csteipp/) added a comment.[Sep 25 2013, 11:38 PM2013-09-25 23:38:16 (UTC+0)](#597877)Comment Actions

Can we get the package on the cluster updated for this issue this week, and we'll make this public next week with the next security release?

[tstarling](/p/tstarling/) added a comment.[Sep 26 2013, 3:25 AM2013-09-26 03:25:05 (UTC+0)](#597891)Comment Actions

The patches look fine to me.

[• csteipp](/p/csteipp/) added a comment.[Nov 14 2013, 7:30 PM2013-11-14 19:30:40 (UTC+0)](#597898)Comment Actions

This was assigned CVE-2013-4570

[Anomie](/p/Anomie/) added a comment.[Nov 14 2013, 9:03 PM2013-11-14 21:03:12 (UTC+0)](#597904)Comment Actions

Created attachment 13796

Rebased patch for luasandbox (on top of bug 49705)

**Attached**: 0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch5 KB[Download](https://phab.wmfusercontent.org/file/download/g5ya7264guxn47tfm3s5/PHID-FILE-fuzigqkxyszf7afcxvak/0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch)

[Anomie](/p/Anomie/) added a comment.[Nov 14 2013, 9:03 PM2013-11-14 21:03:46 (UTC+0)](#597914)Comment Actions

Created attachment 13797

Changelog update for this and bug 49705

**Attached**: 0003-Update-changelog.patch967 B[Download](https://phab.wmfusercontent.org/file/download/rye3ooa6d5mhrh54ocux/PHID-FILE-nih6hrbvrystkn6m4j2m/0003-Update-changelog.patch)

[Anomie](/p/Anomie/) added a comment.[Nov 14 2013, 9:04 PM2013-11-14 21:04:11 (UTC+0)](#597920)Comment Actions

Created attachment 13798

Rebased patch for Scribunto extension

**Attached**: scribunto.diff3 KB[Download](https://phab.wmfusercontent.org/file/download/27rcu6og2hvlqgk5kdew/PHID-FILE-hxpyp6lhrsv2oiy74ci5/scribunto.diff)

[Dzahn](/p/Dzahn/) added a comment.[Dec 3 2013, 7:38 PM2013-12-03 19:38:04 (UTC+0)](#597929)Comment Actions

built 1.8 on labs php-packaging instance. had to install these first this time, not sure why they were gone from the instance: dpkg-checkbuilddeps: Unmet build dependencies: php5-dev liblua5.1-0-dev pkg-config

..then:

clone to /tmp..

cd /tmp/build/luasandboxorig/

git apply 0001-Fix-Lua-stack-overflow.patch

git apply 0002-Handle-invalid-keys-in-Lua-to-PHP-calls-for-LuaSandb.patch

git apply 0003-Update-changelog.patch

debuild -us -uc ..

Version: 1.8-1

Distribution: precise-wikimedia

Urgency: high

Maintainer: Tim Starling <tstarling@wikimedia.org>

Changed-By: Brad Jorsch <bjorsch@wikimedia.org>

..

debdiff /home/dzahn/php-luasandbox\_1.7-1\_amd64.deb /tmp/build/php-luasandbox\_1.8-1\_amd64.deb

File lists identical (after any substitutions)

### Control files: lines which differ (wdiff format)

Depends: libc6 (>= [-2.14),-] {+2.4),+} liblua5.1-0, php5-common

Installed-Size: [-126-] {+148+}

Version: [-1.7-1-] {+1.8-1+}

.. copied to test.wp - mw1017 -

[• csteipp](/p/csteipp/) added a project: [acl\*security](/tag/acl_security/).[Mar 26 2015, 8:39 PM2015-03-26 20:39:15 (UTC+0)](#1154598)[• chasemp](/p/chasemp/) added a project: [Security](/tag/security/).[Feb 10 2020, 10:53 PM2020-02-10 22:53:41 (UTC+0)](#5868085) · [• chasemp](/p/chasemp/) removed a project: [acl\*security](/tag/acl_security/).[Feb 20 2020, 8:14 PM2020-02-20 20:14:27 (UTC+0)](#5903809) · [Aklapper](/p/Aklapper/) removed subscribers: [Anomie](/p/Anomie/), [• wikibugs-l-list](/p/wikibugs-l-list/).[Oct 16 2020, 5:40 PM2020-10-16 17:40:10 (UTC+0)](#6553837) · [Log In to Comment](/login/?next=)Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)

=== Content from lists.wikimedia.org_69eea16e_20250125_004330.html ===


[lists.wikimedia.org](/hyperkitty/)

[Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)
[Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)

* [Sign In](/accounts/login/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)
* [Sign Up](/accounts/signup/?next=/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/message/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/)

* [Manage this list](/postorius/lists/mediawiki-announce.lists.wikimedia.org/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2025/1/)

### 2024

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2024/1/)

### 2023

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2023/1/)

### 2022

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2022/1/)

### 2021

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2021/1/)

### 2020

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2020/1/)

### 2019

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2019/1/)

### 2018

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2018/1/)

### 2017

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2017/1/)

### 2016

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2016/1/)

### 2015

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2015/1/)

### 2014

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2014/1/)

### 2013

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2013/1/)

### 2012

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2012/1/)

### 2011

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2011/1/)

### 2010

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2010/1/)

### 2009

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2009/1/)

### 2008

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2008/1/)

### 2007

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2007/1/)

### 2006

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2006/1/)

### 2005

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/12/)
* [November](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/11/)
* [October](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/10/)
* [September](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/9/)
* [August](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/8/)
* [July](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/7/)
* [June](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/6/)
* [May](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/5/)
* [April](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/4/)
* [March](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/3/)
* [February](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/2/)
* [January](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2005/1/)

### 2004

* [December](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/2004/12/)

[List overview](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

[Download](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/export/mediawiki-announce%40lists.wikimedia.org-YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A.mbox.gz?message=YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A "This message in gzipped mbox format")

[thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/#YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A)

# [MediaWiki-announce] MediaWiki Security Releases: 1.22.1, 1.21.4 and 1.19.10

[Chris Steipp](/hyperkitty/users/dd272b532a8d4667a37daa128483ef95/ "See the profile for Chris Steipp")

14 Jan
2014

14 Jan
'14

8:34 a.m.

I would like to announce the release of MediaWiki 1.22.1, 1.21.4 and
1.19.10.
These releases fix a number of security related bugs that could affect
users of
MediaWiki. In addition, MediaWiki 1.22.1 is a maintenance release. It fixes
several bugs. You can consult the RELEASE-NOTES-1.22 file for the full list
of
changes in this version. Download links are given at the end of this email.

== Security fixes ==

\* MediaWiki user Michael M reported that the fix for bug 55332
(CVE-2013-4568)
allowed insertion of escaped CSS values which could pass the CSS validation
checks, resulting in XSS. (CVE-2013-6451)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58088>

\* Chris from RationalWiki reported that SVG files could be uploaded that
include external stylesheets, which could lead to XSS when an XSL was used
to
include JavaScript. (CVE-2013-6452)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=57550>

\* During internal review, it was discovered that MediaWiki's SVG
sanitization
could be bypassed when the XML was considered invalid. (CVE-2013-6453)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58553>

\* Durign internal review, it was discovered that MediaWiki's CSS
sanitization
did not filter -o-link attributes, which could be used to execute
JavaScript in
Opera 12. (CVE-2013-6454)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58472>

\* During internal review, it was discovered that MediaWiki displayed some
information about deleted pages in the log API, enhanced RecentChanges, and
user watchlists. (CVE-2013-6472)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=58699>

Additionally, the following extensions have been updated to fix security
issues:

\* TimedMediaHandler: Bawolff discovered an XSS vulnerability with the way
the
extension stored and used HTML for showing videos. (CVE-2013-4574)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=56699>

\* Scribuntu: Internal review found a NULL pointer dereference in
php-luasandbox, which could be used for DoS attacks. (CVE-2013-4570)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=54527>

\* Scribuntu: Internal review found a Buffer Overflow in php-luasandbox. It's
not know if this could be use for code execution on the server.
(CVE-2013-4571)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=49705>

\* CentralAuth: Eran Roz reported that MediaWiki usernames could be leaked to
other websites. Javascript returned for CentralAuth's login would update the
page DOM with the username, even when included on other sites.
(CVE-2013-6455)
<https://bugzilla.wikimedia.org/show_bug.cgi?id=57081>

\* SemanticForms: Ravindra Singh Rathore reported a missing CSRF check to
Mozilla, who reported the issue to us. Several other forms in the extension
were also fixed.
<https://bugzilla.wikimedia.org/show_bug.cgi?id=57025>

== Bug fixes in 1.22.1 ==

\* (bug 59945) 1.22 tarball offers Extension SimpleAntiSpam which is supposed
to be in core.

\* (bug 58178) Restore compatibility with curl < 7.16.2.

\* (bug 56931) Updated the plural rules to CLDR 24. They are in new format
which is detailed in UTS 35 Rev 33. The PHP parser and evaluator as well as
the JavaScript evaluator were updated to support the new format. Plural
rules
for some languages have changed, most notably Russian. Affected software
messages have been updated and marked for review at translatewiki.net.
This change is backported from the development branch of MediaWiki 1.23.

\* (bug 58434) The broken installer for database backend Oracle was fixed.

\* (bug 58167) The web installer no longer throws an exception when PHP is
compiled without support for MySQL yet with support for another DBMS.

\* (bug 58640) Fixed a compatibility issue with PCRE 8.34 that caused pages
to appear blank or with missing text.

\* (bug 47055) Changed FOR UPDATE handling in Postgresql

Full release notes for 1.22.1:
<https://www.mediawiki.org/wiki/Release_notes/1.22>

Full release notes for 1.21.4:
<https://www.mediawiki.org/wiki/Release_notes/1.21>

Full release notes for 1.19.9:
<https://www.mediawiki.org/wiki/Release_notes/1.19>

For information about how to upgrade, see
[https://www.mediawiki.org/wiki/Manual:Upgrading](https://www.mediawiki.org/wiki/Manual%3AUpgrading)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.22.1
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.tar.gz>

Patch to previous version (1.22.0), without interface text:
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.patch.gz>
Interface text changes:
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-i18n-1.22.1.patch.gz>

GPG signatures:
[http://download.wikimedia.org/mediawiki/1.22/mediawiki-core-1.22.1.tar.gz.si...](http://download.wikimedia.org/mediawiki/1.22/mediawiki-core-1.22.1.tar.gz.sig)
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.22/mediawiki-1.22.1.patch.gz.sig>
[http://download.wikimedia.org/mediawiki/1.22/mediawiki-i18n-1.22.1.patch.gz....](http://download.wikimedia.org/mediawiki/1.22/mediawiki-i18n-1.22.1.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.21.4
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.tar.gz>

Patch to previous version (1.21.3), without interface text:
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.patch.gz>
Interface text changes:
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-i18n-1.21.4.patch.gz>

GPG signatures:
[http://download.wikimedia.org/mediawiki/1.21/mediawiki-core-1.21.4.tar.gz.si...](http://download.wikimedia.org/mediawiki/1.21/mediawiki-core-1.21.4.tar.gz.sig)
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.21/mediawiki-1.21.4.patch.gz.sig>
[http://download.wikimedia.org/mediawiki/1.21/mediawiki-i18n-1.21.4.patch.gz....](http://download.wikimedia.org/mediawiki/1.21/mediawiki-i18n-1.21.4.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
1.19.10
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Download:
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.tar.gz>

Patch to previous version (1.19.9), without interface text:
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.patch.gz>
Interface text changes:
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-i18n-1.19.10.patch.gz>

GPG signatures:
[http://download.wikimedia.org/mediawiki/1.19/mediawiki-core-1.19.10.tar.gz.s...](http://download.wikimedia.org/mediawiki/1.19/mediawiki-core-1.19.10.tar.gz.sig)
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.tar.gz.sig>
<http://download.wikimedia.org/mediawiki/1.19/mediawiki-1.19.10.patch.gz.sig>
[http://download.wikimedia.org/mediawiki/1.19/mediawiki-i18n-1.19.10.patch.gz...](http://download.wikimedia.org/mediawiki/1.19/mediawiki-i18n-1.19.10.patch.gz.sig)

Public keys:
<https://www.mediawiki.org/keys/keys.html>

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:TimedMediaHandler
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:TimedMediaHandler](https://www.mediawiki.org/wiki/Extension%3ATimedMediaHandler)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:Scribunto
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:Scribunto](https://www.mediawiki.org/wiki/Extension%3AScribunto)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:CentralAuth
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:CentralAuth](https://www.mediawiki.org/wiki/Extension%3ACentralAuth)

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Extension:SemanticForms
\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*
Information and Download:
[https://www.mediawiki.org/wiki/Extension:SemanticForms](https://www.mediawiki.org/wiki/Extension%3ASemanticForms)

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/thread/YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A/#YUPPCCDXJ4GDG6XKKN67URP2U2GDTI7A)

[Back to the list](/hyperkitty/list/mediawiki-announce%40lists.wikimedia.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.


