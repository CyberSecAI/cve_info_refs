- **Root cause of vulnerability**: The vulnerability is a race condition due to the lack of proper synchronization when accessing a shared memory block used to store connection information.
- **Weaknesses/vulnerabilities present**: The code in `SftpServer/SftpWho.c` attempts to find an empty slot in a shared memory array. The code uses a loop and checks `who[i].status == SFTPWHO_EMPTY`, and if found, uses `usleep(100)`, then checks if the status is still empty, and if so, it claims the slot. The sleep is not a correct synchronization method which can lead to two or more processes claiming the same slot if they both find it empty at the same time.
- **Impact of exploitation**: Multiple processes can end up occupying the same slot in shared memory. This can cause the server to log in as someone else which may lead to information disclosure or other security issues.
- **Attack vectors**: An attacker can exploit this by establishing multiple SFTP connections to the server which can trigger the race condition.
- **Required attacker capabilities/position**: The attacker needs the ability to initiate multiple SFTP connections to the vulnerable server.