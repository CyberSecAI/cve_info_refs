```
Message-Id: <E1UjXmF-0000j5-0w@xenbits.xen.org>
Date: Mon, 03 Jun 2013 16:38:35 +0000
From: Xen.org security team <security@....org>
To: xen-announce@...ts.xen.org, xen-devel@...ts.xen.org,
 xen-users@...ts.xen.org, oss-security@...ts.openwall.com
CC: Xen.org security team <security@....org>
Subject: Xen Security Advisory 54 (CVE-2013-2078) - Hypervisor crash due
 to missing exception recovery on XSETBV

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

	     Xen Security Advisory CVE-2013-2078 / XSA-54
                            version 3

       Hypervisor crash due to missing exception recovery on XSETBV

UPDATES IN VERSION 3
====================

Public release.

ISSUE DESCRIPTION
=================

Processors do certain validity checks on the register values passed to
XSETBV.  For the PV emulation path for that instruction the hypervisor
code didn't check for certain invalid bit combinations, thus exposing
itself to a fault occurring when invoking that instruction on behalf
of the guest.

IMPACT
======

Malicious or buggy unprivileged user space can cause the entire host
to crash.

VULNERABLE SYSTEMS
==================

Xen 4.0 and onwards are vulnerable when run on systems with processors
supporting XSAVE.  Only PV guests can exploit the vulnerability.

In Xen 4.0.2 through 4.0.4 as well as in Xen 4.1.x XSAVE support is
disabled by default; therefore systems running these versions are not
vulnerable unless support is explicitly enabled using the "xsave"
hypervisor command line option.

Systems using processors not supporting XSAVE are not vulnerable.

Xen 3.x and earlier are not vulnerable.

MITIGATION
==========

Turning off XSAVE support via the "no-xsave" hypervisor command line
option will avoid the vulnerability.

RESOLUTION
==========

Applying the attached patch resolves this issue.

xsa54.patch                 Xen 4.1.x, Xen 4.2.x, xen-unstable
```

- **Root cause of vulnerability**: The Xen hypervisor's PV emulation path for the XSETBV instruction lacked proper validation of register values, specifically not checking for certain invalid bit combinations, leading to a fault when invoked on behalf of a guest.
- **Weaknesses/vulnerabilities present**: Insufficient input validation within the hypervisor's instruction emulation logic. The hypervisor didn't handle the potential exceptions caused by invalid inputs to XSETBV.
- **Impact of exploitation**: A malicious or buggy unprivileged user space within a PV guest can cause the entire host to crash. This constitutes a denial of service (DoS) vulnerability.
- **Attack vectors**: A malicious PV guest can exploit the vulnerability.
- **Required attacker capabilities/position**: An attacker needs to have the ability to execute code within an unprivileged PV guest. They need to be able to cause the hypervisor to emulate the XSETBV instruction with invalid inputs.

```
Package        : xen
CVE ID         : CVE-2013-1432 CVE-2013-1442 CVE-2013-2076 CVE-2013-2077
                 CVE-2013-2078 CVE-2013-2194 CVE-2013-2195 CVE-2013-2196
                 CVE-2013-2211 CVE-2013-4329 CVE-2013-4355 CVE-2013-4361
                 CVE-2013-4368 CVE-2013-4494 CVE-2013-4553 CVE-2014-1950
                 CVE-2014-2599 CVE-2014-3124 CVE-2014-4021

Multiple security issues have been discovered in the Xen virtualisation
solution which may result in information leaks or denial of service.
```
This excerpt from a Debian Security Advisory confirms that CVE-2013-2078 is associated with a security issue in the Xen virtualization solution that can lead to a denial-of-service.

```
Multiple vulnerabilities have been found in Xen, allowing attackers
on a Xen Virtual Machine to execute arbitrary code, cause Denial of
Service, or gain access to data on the host.
...
Guest domains could possibly gain privileges, execute arbitrary code, or
cause a Denial of Service on the host domain (Dom0).
```
This excerpt from a Gentoo security advisory indicates that CVE-2013-2078 is part of a set of vulnerabilities affecting Xen, which could lead to denial of service attacks from a guest VM to the host.

```
## The worldâ€™s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.
```
This content from Secunia is an advertisement for their vulnerability research, it does not contain vulnerability information about CVE-2013-2078.