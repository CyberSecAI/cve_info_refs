=== Content from immunityproducts.blogspot.com_c50a5dd8_20250124_182135.html ===


# Immunity Products

welcome to the product blog of [IMMUNITY INC](http://www.immunityinc.com)

global leader in the assessment and penetration testing space

* #[immunityinc](https://twitter.com/immunityinc)
* #[InfiltrateCon](https://twitter.com/InfiltrateCon)

1130 WASHINGTON AVE. 8th FLOOR
MIAMI BEACH, FLORIDA 33139
[immunityinc.com](http://www.immunityinc.com)
(786) 220 0600
admin@immunityinc.com

#### // RECENT POSTS:

#### // SUBSCRIBE:

* [immunityinc.com](http://www.immunityinc.com/)
* sales@immunityinc.com
* +1 786 220 0600

* CANVAS: an automated exploitation system, and a comprehensive, reliable exploit development framework to penetration testers and security professionals.
* [learn more about canvas](http://www.immunityinc.com/products/canvas/)
* SWARM: quickly deploy an exploit or reconnaissance tool against large sections of a cyber range.
* [learn more about swarm](http://www.immunityinc.com/products/swarm/)
* SILICA: Immunity has built the first automated, WiFi specific, vulnerability assessment and penetration tool.
* [learn more about silica](http://www.immunityinc.com/products/silica/)
* IMMUNITY DEBUGGER: Immunity Debugger is a powerful new way to write exploits, analyze malware, and reverse engineer binary files.
* [learn more about immunity debugger](http://www.immunityinc.com/products/debugger/)
* EL JEFE: Immunity's open source project, El Jefe is a Windows based process monitoring solution.
* [learn more about el jefe](http://www.immunityinc.com/products/eljefe/)

[VIEW ALL IMMUNITY PRODUCTS](http://www.immunityinc.com/products/canvas/)
#### IMMUNITY SERVICES

* Consulting:
* [Application Vulnerability Analysis](http://www.immunityinc.com/services/application-vulnerability-analysis.html)
* [Network Security Assessment](http://www.immunityinc.com/services/network-security-assessment.html)
* [Web Application Testing](http://www.immunityinc.com/services/web-application-testing.html)
* [Wireless Security Assessment](http://www.immunityinc.com/services/wireless-security-assessment.html)
* [Process Review](http://www.immunityinc.com/services/process-review.html)
* [Source Code Analysis](http://www.immunityinc.com/services/source-code-analysis.html)
* [Exploit Development](http://www.immunityinc.com/services/exploit-dev-reverse-engineering.html)
* [Penetration Scanning](http://www.immunityinc.com/services/penetration-scanning.html)

* Certifications:
* [Certified Network Offense Professional (NOP)](http://www.immunityinc.com/services-cnop.shtml)

[VIEW ALL IMMUNITY SERVICES](http://www.immunityinc.com/services/)

# [Immunity Products](https://immunityproducts.blogspot.com/)

## Monday, March 11, 2013

### Infiltrate Preview - TrueType Font Fuzzing and Vulnerability

TrueType font files are made up of a number of tables; each table begins on a 4 byte boundary that comprises an outline font and must be long aligned and padded with zeroes if necessary. Referring to the “TrueType 1.0 Font File Technical Specification”, provided by Microsoft; the TrueType font file begins at byte 0 with the Offset Table. Offset Table is divided into 5 subtable:

**sfnt version :** 65536(0x0001 0000) for version 1.0
**numTables :** Number of tables
**searchRange :** (Maximum power of 2 ≤ numTables) x 16
**entrySelector :** Log2(Maximum power of 2 ≤ numTables)
**rangeShift :** numTables x 16 – searchRange

Beginning at byte 12, after the Offset Table, is the Font Table Directory. Entries in the Table Directory must be sorted in ascending order by ‘tag’ name. Overall, the Font Table Directory Header consists of:

**tag :** 4 byte identifier
**checkSum :** checksum of the table
**offset :** Beginning offset of the font table entry
**length :** Length of the table

|  |
| --- |
| The Structure of True Type Font Directory |

The required tables in the Font Table Directory:

**cmap :** character to glyph mapping
**glyf :** glyph data
**head :** font header
**hhea :** horizontal header
**hmtx :** horizontal metrics
**loca :** index to location
**maxp :** maximum profile
**name :** naming table
**post :** PostScript information
**OS/2 :** OS/2 and Windows specific metrics

The optional tables in the Font Table Directory:

**cvt :** Control Value Table
**EBDT :** Embedded bitmap data
**EBLC :** Embedded bitmap location data
**EBSC :** Embedded bitmap Scaling data
**fpgm :** font program
**gasp :** grid-fitting and scan conversion procedure
**hdmx :** horizontal device metrics
**kern :** kerning
**LTSH :** Linear threshold table
**prep :** CVT Program
**PCLT :**PCL5
**VDMX :** Vertical Metrics header
**vhea :** Vertical Metrics

Due to font validation purposes, the dumb fuzzing technique is not recommended for these fields: ‘checkSum’, ‘offset’, ‘length’ and ‘Table’. To reduce the number of irrelevant tests, a checksum validation program is used to determine the checksum of ‘head’ table.

|  |
| --- |
| Fix the Checksum value of the “head” Font Table Directory |

During the fuzzing process, the table checksum has to re-compute. The checksum calculation implies 4 byte boundaries as shown in Python program below:

<NOTE TO NICO: NO PYTHON PROGRAM IS HERE>

Our font fuzzer is to fuzz the TrueType font file into different sizes which enables the generation of the test cases to determine the size of font in triggering the vulnerability. Each fuzzing process starts with automating the installation of the mutated font in Windows system. It will then display the font; both in open the font file via fontview.exe and displaying the character maps. Lastly, uninstall the font and repeat the process if no vulnerability is found.

The windll.gdi32.AddFontResourceExA function is used to automate the installation of the crafted font into the “C:\Windows\Fonts” folder.

**htr = windll.gdi32.AddFontResourceExA(FileFont, FR\_PRIVATE, None)**

Once the fuzzing environment is ready, a LOGFONT object is created to define the attributes of a font.

**lf=win32gui.LOGFONT()**

Assuming no vulnerability has been found at a font with a specified size that has been called; the windll.gdi32.RemoveFontResourceExW function will be called to remove the fonts in “C:\Windows\Fonts” folder.

**windll.gdi32.RemoveFontResourceExW(fileFont, FR\_PRIVATE, None)**

Another size of font in the range that has been set will be called and the same process will repeat until vulnerability is found or the list of font size elements under a loop function has all been called and no vulnerability is found.

Figure below shows the Blue Screen of Death (BSOD) proof of concept via our font fuzzer. [Editor's note: BOOM! :>]

|  |
| --- |
| BSOD of Windows 8 Pro |

The details of the fuzzer and findings will be discussed in the talk. Looking forward to see you guys in [INFILTRATE 2013](http://www.infiltratecon.com/).

--- Ling Chuan Lee & Lee Yee Chan from F13 Labs

Posted by
Nico Waisman

at

[9:13 AM](https://immunityproducts.blogspot.com/2013/03/infiltrate-preview-truetype-font.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=7337853103195839314&postID=8587225466028464474&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=7337853103195839314&postID=8587225466028464474&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=7337853103195839314&postID=8587225466028464474&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=7337853103195839314&postID=8587225466028464474&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=7337853103195839314&postID=8587225466028464474&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=7337853103195839314&postID=8587225466028464474&target=pinterest "Share to Pinterest")

#### No comments:

[Post a Comment](https://www.blogger.com/comment/fullpage/post/7337853103195839314/8587225466028464474)

[Newer Post](https://immunityproducts.blogspot.com/2013/03/hacking-web-exploiting-cbc-with-padding.html "Newer Post")

[Older Post](https://immunityproducts.blogspot.com/2013/03/infiltrate-preview-stephen-watt-keynote.html "Older Post")

[Home](https://immunityproducts.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](https://immunityproducts.blogspot.com/feeds/8587225466028464474/comments/default)

## Blog Archive

* ►
  [2018](https://immunityproducts.blogspot.com/2018/)
  (1)
  + ►
    [November](https://immunityproducts.blogspot.com/2018/11/)
    (1)

* ►
  [2017](https://immunityproducts.blogspot.com/2017/)
  (1)
  + ►
    [July](https://immunityproducts.blogspot.com/2017/07/)
    (1)

* ►
  [2016](https://immunityproducts.blogspot.com/2016/)
  (7)
  + ►
    [December](https://immunityproducts.blogspot.com/2016/12/)
    (1)
  + ►
    [September](https://immunityproducts.blogspot.com/2016/09/)
    (1)
  + ►
    [June](https://immunityproducts.blogspot.com/2016/06/)
    (1)
  + ►
    [May](https://immunityproducts.blogspot.com/2016/05/)
    (1)
  + ►
    [February](https://immunityproducts.blogspot.com/2016/02/)
    (2)
  + ►
    [January](https://immunityproducts.blogspot.com/2016/01/)
    (1)

* ►
  [2015](https://immunityproducts.blogspot.com/2015/)
  (3)
  + ►
    [September](https://immunityproducts.blogspot.com/2015/09/)
    (1)
  + ►
    [June](https://immunityproducts.blogspot.com/2015/06/)
    (1)
  + ►
    [March](https://immunityproducts.blogspot.com/2015/03/)
    (1)

* ►
  [2014](https://immunityproducts.blogspot.com/2014/)
  (6)
  + ►
    [November](https://immunityproducts.blogspot.com/2014/11/)
    (1)
  + ►
    [September](https://immunityproducts.blogspot.com/2014/09/)
    (2)
  + ►
    [June](https://immunityproducts.blogspot.com/2014/06/)
    (1)
  + ►
    [May](https://immunityproducts.blogspot.com/2014/05/)
    (1)
  + ►
    [April](https://immunityproducts.blogspot.com/2014/04/)
    (1)

* ▼
  [2013](https://immunityproducts.blogspot.com/2013/)
  (26)
  + ►
    [November](https://immunityproducts.blogspot.com/2013/11/)
    (1)
  + ►
    [August](https://immunityproducts.blogspot.com/2013/08/)
    (1)
  + ►
    [June](https://immunityproducts.blogspot.com/2013/06/)
    (2)
  + ►
    [May](https://immunityproducts.blogspot.com/2013/05/)
    (4)
  + ►
    [April](https://immunityproducts.blogspot.com/2013/04/)
    (1)
  + ▼
    [March](https://immunityproducts.blogspot.com/2013/03/)
    (5)
    - [WIN at CBC](https://immunityproducts.blogspot.com/2013/03/win-at-cbc.html)
    - [Immunity Releases an Exploit for the Linux Kernel ...](https://immunityproducts.blogspot.com/2013/03/immunity-releases-exploit-for-linux.html)
    - [Hacking the web: Exploiting CBC with Padding Oracle](https://immunityproducts.blogspot.com/2013/03/hacking-web-exploiting-cbc-with-padding.html)
    - [Infiltrate Preview - TrueType Font Fuzzing and Vul...](https://immunityproducts.blogspot.com/2013/03/infiltrate-preview-truetype-font.html)
    - [Infiltrate Preview - Stephen Watt Keynote](https://immunityproducts.blogspot.com/2013/03/infiltrate-preview-stephen-watt-keynote.html)
  + ►
    [February](https://immunityproducts.blogspot.com/2013/02/)
    (8)
  + ►
    [January](https://immunityproducts.blogspot.com/2013/01/)
    (4)

* ►
  [2012](https://immunityproducts.blogspot.com/2012/)
  (18)
  + ►
    [December](https://immunityproducts.blogspot.com/2012/12/)
    (1)
  + ►
    [November](https://immunityproducts.blogspot.com/2012/11/)
    (2)
  + ►
    [October](https://immunityproducts.blogspot.com/2012/10/)
    (3)
  + ►
    [August](https://immunityproducts.blogspot.com/2012/08/)
    (4)
  + ►
    [July](https://immunityproducts.blogspot.com/2012/07/)
    (6)
  + ►
    [June](https://immunityproducts.blogspot.com/2012/06/)
    (2)

Powered by [Blogger](https://www.blogger.com).


