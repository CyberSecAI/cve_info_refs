=== Content from blog.dscpl.com.au_7cefaeec_20250125_100844.html ===


# [Graham Dumpleton](http://blog.dscpl.com.au/)

## Wednesday, May 21, 2014

### Security release for mod\_wsgi (version 3.5).

The Apache/mod\_wsgi module I authored has been in suspended animation for some time. Today though I announce a new release (version 3.5) to address a security vulnerability, plus bring overdue updates to address issues in support for Apache 2.4 and Python 3.4.

Version 3.5 of mod\_wsgi can be downloaded from github at:

* <https://github.com/GrahamDumpleton/mod_wsgi/releases>

The release notes for version 3.5 of mod\_wsgi can be found at:

* <http://modwsgi.readthedocs.org/en/latest/release-notes/version-3.5.html>

Although the security vulnerability will not affect all users, it is highly recommended you upgrade to this new version, or any newer revision of a Linux distributions binary package which includes a back ported fix for the issue.

In addition to the details of this vulnerability, I also include here details of an issue which was previously fixed in mod\_wsgi 3.4 but was recently also discovered to be more severe than previously believed and which itself constitutes a security issue.

For more details read on. I will follow up this post with a further post about the general future of the mod\_wsgi module for Apache.

**Issue: Possibility of local privilege escalation when using daemon mode. (CVE-2014-0240)**

The issue is believed to affect Linux systems running kernel versions >= 2.6.0 and < 3.1.0.

The issue affects all versions of mod\_wsgi up to and including version 3.4.

The source of the issue derives from mod\_wsgi not correctly handling Linux specific error codes from setuid(), which differ to what would be expected to be returned by UNIX systems conforming to the Open Group UNIX specification for setuid().

* <http://man7.org/linux/man-pages/man2/setuid.2.html>
* <http://pubs.opengroup.org/onlinepubs/009695399/functions/setuid.html>

This difference in behaviour between Linux and the UNIX specification was believed to have been removed in version 3.1.0 of the Linux kernel.

* <https://groups.google.com/forum/?fromgroups=#!topic/linux.kernel/u6cKf4D1D-k>

The issue would allow a user, where Apache is initially being started as the root user and where running code under mod\_wsgi daemon mode as an unprivileged user, to manipulate the number of processes run by that user to affect the outcome of setuid() when daemon mode processes are forked and so gain escalated privileges for the users code.

Due to the nature of the issue, if you provide a service or allow untrusted users to run Python web applications you do not control the code for, and do so using daemon mode of mod\_wsgi, you should update mod\_wsgi as soon as possible.

If you are unable to upgrade to a newer version of mod\_wsgi, but wish to back port the fix to an older version of mod\_wsgi that you are using, then the patch from mod\_wsgi 3.5 can be found at:

* <https://github.com/GrahamDumpleton/mod_wsgi/commit/d9d5fea585b23991f76532a9b07de7fcd3b649f4>

There is no workaround for this issue, so using a version of mod\_wsgi which incorporates the fix is your only choice.

Thanks go to Róbert Kisteleki for identifying this issue.

**Issue: Possibility of information disclosure via Content-Type response header. (CVE-2014-0242)**

The issue was actually identified and previously fixed in version 3.4 (August 2012) of mod\_wsgi.

> Response Content-Type header could be corrupted when being sent in multithreaded configuration and embedded mode being used. Problem thus affected Windows and worker MPM on UNIX.

Release notes for version 3.4 of mod\_wsgi can be viewed at:

* <http://modwsgi.readthedocs.org/en/latest/release-notes/version-3.4.html>

At the time it was believed to be relatively benign, only ever having been seen with one specific web application (Trac - http://trac.edgewall.org), with the corrupted value always appearing to be replaced with a small set of known values which themselves did not raise concerns.

A new example of this problem has now been identified which opens this issue up as being able to cause arbitrary corruption of the web server HTTP response Content-Type value, resulting in possible exposure of data from the hosted web application to a HTTP client.

The new example also opens the possibility that the issue can occur with any Apache MPM and not just multithreaded MPMs as previously identified. Albeit that it still requires some form of background application threads to be in use, when a single threaded Apache MPM is being used.

In either case, it is still however restricted to the case where embedded mode of mod\_wsgi is being used.

The specific scenario which can trigger the issue is where the value for the Content-Type response header is dynamically generated, and where the stack frame where the calculation was done went out of use between the time that the WSGI start\_response() function was called and the first non empty byte string was yielded from the WSGI application for the response, resulting in the Python object being destroyed and memory returned to the free list.

At the same time, it would have been necessary for a parallel request thread or an application background thread to execute during that window of time and perform sufficient object allocations so as to reuse the memory previously used by the value of the Content-Type response header.

Example code which can be used to trigger the specific scenario can be found at:

* <https://gist.github.com/GrahamDumpleton/14b31ebe18166a89b090>

That example code also provides a workaround if you find yourself affected by the issue but cannot upgrade straight away. It consists of the @intern\_content\_type decorator/wrapper. This can be applied to the WSGI application entry point and will use a cache to store the value of the Content-Type response header to ensure it is persistent for the life of the request.

If you are still using a version of mod\_wsgi older than version 3.4, but are unable to upgrade to a newer version of mod\_wsgi  and wish to back port the fix to the older version of mod\_wsgi that you are using, then the patch from mod\_wsgi 3.4 can be found at:

* <https://github.com/GrahamDumpleton/mod_wsgi/commit/b0a149c1f5e569932325972e2e20176a42e43517>

Thanks go to Buck Golemon for identifying this subsequent issue.

Posted by

[Graham Dumpleton](https://www.blogger.com/profile/13609779138164842374 "author profile")

at

[5:58 PM](http://blog.dscpl.com.au/2014/05/security-release-for-modwsgi-version-35.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_email.gif)](https://www.blogger.com/email-post/2363643920942057324/317971864158524742 "Email Post")

[Email This](https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=317971864158524742&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=317971864158524742&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=317971864158524742&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=317971864158524742&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=2363643920942057324&postID=317971864158524742&target=pinterest "Share to Pinterest")

Labels:
[apache](http://blog.dscpl.com.au/search/label/apache),
[mod\_wsgi](http://blog.dscpl.com.au/search/label/mod_wsgi),
[python](http://blog.dscpl.com.au/search/label/python),
[wsgi](http://blog.dscpl.com.au/search/label/wsgi)

#### No comments:

[Post a Comment](https://www.blogger.com/comment/fullpage/post/2363643920942057324/317971864158524742)

[Newer Post](http://blog.dscpl.com.au/2014/08/transparent-object-proxies-in-python.html "Newer Post")

[Older Post](http://blog.dscpl.com.au/2014/04/talk-to-me-at-pycon-about-python-web.html "Older Post")

[Home](http://blog.dscpl.com.au/)

Subscribe to:
[Post Comments (Atom)](http://blog.dscpl.com.au/feeds/317971864158524742/comments/default)

## About Me

[Graham Dumpleton](https://www.blogger.com/profile/13609779138164842374)

[View my complete profile](https://www.blogger.com/profile/13609779138164842374)

## Quick Links

* [Decorators and monkey patching.](http://blog.dscpl.com.au/p/decorators-and-monkey-patching.html)
* [Using Python with Docker.](http://blog.dscpl.com.au/p/using-python-with-docker.html)

## Blog Archive

Blog Archive
January (3)
December (4)
October (1)
April (1)
January (1)
April (1)
December (2)
August (1)
July (1)
April (2)
March (1)
February (2)
January (3)
December (6)
October (1)
August (1)
July (2)
June (5)
May (7)
April (4)
March (4)
January (2)
December (4)
November (1)
September (7)
August (1)
May (1)
April (1)
February (4)
January (8)
December (1)
December (1)
October (4)
August (1)
November (1)
October (1)
September (1)
March (1)
January (5)
December (2)
October (1)
August (2)
June (2)
May (2)
April (1)
March (3)
November (4)
October (3)
September (1)
August (3)
May (2)
April (5)
March (5)
February (1)
December (2)
August (1)
March (1)
November (2)
October (3)
September (3)
August (1)
July (2)
March (2)

## Labels

* [python](http://blog.dscpl.com.au/search/label/python)
  (111)
* [mod\_wsgi](http://blog.dscpl.com.au/search/label/mod_wsgi)
  (86)
* [wsgi](http://blog.dscpl.com.au/search/label/wsgi)
  (58)
* [apache](http://blog.dscpl.com.au/search/label/apache)
  (35)
* [docker](http://blog.dscpl.com.au/search/label/docker)
  (34)
* [openshift](http://blog.dscpl.com.au/search/label/openshift)
  (26)
* [decorators](http://blog.dscpl.com.au/search/label/decorators)
  (15)
* [django](http://blog.dscpl.com.au/search/label/django)
  (13)
* [kubernetes](http://blog.dscpl.com.au/search/label/kubernetes)
  (12)
* [mod\_python](http://blog.dscpl.com.au/search/label/mod_python)
  (9)
* [red hat](http://blog.dscpl.com.au/search/label/red%20hat)
  (9)
* [ipython](http://blog.dscpl.com.au/search/label/ipython)
  (7)
* [jupyterhub](http://blog.dscpl.com.au/search/label/jupyterhub)
  (7)
* [new relic](http://blog.dscpl.com.au/search/label/new%20relic)
  (6)
* [wrapt](http://blog.dscpl.com.au/search/label/wrapt)
  (6)
* [pycon](http://blog.dscpl.com.au/search/label/pycon)
  (5)
* [s2i](http://blog.dscpl.com.au/search/label/s2i)
  (4)
* [gunicorn](http://blog.dscpl.com.au/search/label/gunicorn)
  (3)
* [uWSGI](http://blog.dscpl.com.au/search/label/uWSGI)
  (3)
* [datadog](http://blog.dscpl.com.au/search/label/datadog)
  (2)
* [nginx](http://blog.dscpl.com.au/search/label/nginx)
  (2)
* [statsd](http://blog.dscpl.com.au/search/label/statsd)
  (2)
* [web2py](http://blog.dscpl.com.au/search/label/web2py)
  (2)
* [async](http://blog.dscpl.com.au/search/label/async)
  (1)
* [dyndns53](http://blog.dscpl.com.au/search/label/dyndns53)
  (1)
* [fastcgi](http://blog.dscpl.com.au/search/label/fastcgi)
  (1)
* [heroku](http://blog.dscpl.com.au/search/label/heroku)
  (1)
* [jupyter](http://blog.dscpl.com.au/search/label/jupyter)
  (1)
* [lektor](http://blog.dscpl.com.au/search/label/lektor)
  (1)
* [php](http://blog.dscpl.com.au/search/label/php)
  (1)
* [shiv](http://blog.dscpl.com.au/search/label/shiv)
  (1)
* [testing](http://blog.dscpl.com.au/search/label/testing)
  (1)
* [tornado](http://blog.dscpl.com.au/search/label/tornado)
  (1)
* [warpdrive](http://blog.dscpl.com.au/search/label/warpdrive)
  (1)
* [zipapp](http://blog.dscpl.com.au/search/label/zipapp)
  (1)

|  |  |
| --- | --- |

Simple theme. Powered by [Blogger](https://www.blogger.com).



=== Content from www.openwall.com_1f36580e_20250125_100846.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2014/05/20/10) [[next>]](2) [[thread-next>]](../../../2014/06/17/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <537C75F8.5060208@redhat.com>
Date: Wed, 21 May 2014 11:46:32 +0200
From: Kurt Seifried <kseifried@...hat.com>
To: oss-security@...ts.openwall.com
Subject: Security release for mod_wsgi (version 3.5)

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

So CVEs were assigned, this is now public, very well written an
detailed write up is at:

<http://blog.dscpl.com.au/2014/05/security-release-for-modwsgi-version-35.html>

The Apache/mod_wsgi module I authored has been in suspended animation
for some time. Today though I announce a new release (version 3.5) to
address a security vulnerability, plus bring overdue updates to
address issues in support for Apache 2.4 and Python 3.4.

Version 3.5 of mod_wsgi can be downloaded from github at:

<https://github.com/GrahamDumpleton/mod_wsgi/releases>
The release notes for version 3.5 of mod_wsgi can be found at:
<http://modwsgi.readthedocs.org/en/latest/release-notes/version-3.5.html>
Although the security vulnerability will not affect all users, it is
highly recommended you upgrade to this new version, or any newer
revision of a Linux distributions binary package which includes a back
ported fix for the issue.
In addition to the details of this vulnerability, I also include here
details of an issue which was previously fixed in mod_wsgi 3.4 but was
recently also discovered to be more severe than previously believed
and which itself constitutes a security issue.

For more details read on. I will follow up this post with a further
post about the general future of the mod_wsgi module for Apache.

Issue: Possibility of local privilege escalation when using daemon
mode. (CVE-2014-0240)

The issue is believed to affect Linux systems running kernel versions
> = 2.6.0 and < 3.1.0.

The issue affects all versions of mod_wsgi up to and including version
3.4.

The source of the issue derives from mod_wsgi not correctly handling
Linux specific error codes from setuid(), which differ to what would
be expected to be returned by UNIX systems conforming to the Open
Group UNIX specification for setuid().

<http://man7.org/linux/man-pages/man2/setuid.2.html>
<http://pubs.opengroup.org/onlinepubs/009695399/functions/setuid.html>
This difference in behaviour between Linux and the UNIX specification
was believed to have been removed in version 3.1.0 of the Linux kernel.

<https://groups.google.com/forum/?fromgroups=#!topic/linux.kernel/u6cKf4D1D-k>
The issue would allow a user, where Apache is initially being started
as the root user and where running code under mod_wsgi daemon mode as
an unprivileged user, to manipulate the number of processes run by
that user to affect the outcome of setuid() when daemon mode processes
are forked and so gain escalated privileges for the users code.

Due to the nature of the issue, if you provide a service or allow
untrusted users to run Python web applications you do not control the
code for, and do so using daemon mode of mod_wsgi, you should update
mod_wsgi as soon as possible.

If you are unable to upgrade to a newer version of mod_wsgi, but wish
to back port the fix to an older version of mod_wsgi that you are
using, then the patch from mod_wsgi 3.5 can be found at:

<https://github.com/GrahamDumpleton/mod_wsgi/commit/d9d5fea585b23991f76532a9b07de7fcd3b649f4>
There is no workaround for this issue, so using a version of mod_wsgi
which incorporates the fix is your only choice.

Thanks go to Róbert Kisteleki for identifying this issue.
Issue: Possibility of information disclosure via Content-Type response
header. (CVE-2014-0242)

The issue was actually identified and previously fixed in version 3.4
(August 2012) of mod_wsgi.

Response Content-Type header could be corrupted when being sent in
multithreaded configuration and embedded mode being used. Problem thus
affected Windows and worker MPM on UNIX.

Release notes for version 3.4 of mod_wsgi can be viewed at:

<http://modwsgi.readthedocs.org/en/latest/release-notes/version-3.4.html>
At the time it was believed to be relatively benign, only ever having
been seen with one specific web application (Trac -
<http://trac.edgewall.org>), with the corrupted value always appearing
to be replaced with a small set of known values which themselves did
not raise concerns.

A new example of this problem has now been identified which opens this
issue up as being able to cause arbitrary corruption of the web server
HTTP response Content-Type value, resulting in possible exposure of
data from the hosted web application to a HTTP client.

The new example also opens the possibility that the issue can occur
with any Apache MPM and not just multithreaded MPMs as previously
identified. Albeit that it still requires some form of background
application threads to be in use, when a single threaded Apache MPM is
being used.

In either case, it is still however restricted to the case where
embedded mode of mod_wsgi is being used.

The specific scenario which can trigger the issue is where the value
for the Content-Type response header is dynamically generated, and
where the stack frame where the calculation was done went out of use
between the time that the WSGI start_response() function was called
and the first non empty byte string was yielded from the WSGI
application for the response, resulting in the Python object being
destroyed and memory returned to the free list.

At the same time, it would have been necessary for a parallel request
thread or an application background thread to execute during that
window of time and perform sufficient object allocations so as to
reuse the memory previously used by the value of the Content-Type
response header.

Example code which can be used to trigger the specific scenario can be
found at:

<https://gist.github.com/GrahamDumpleton/14b31ebe18166a89b090>
That example code also provides a workaround if you find yourself
affected by the issue but cannot upgrade straight away. It consists of
the @intern_content_type decorator/wrapper. This can be applied to the
WSGI application entry point and will use a cache to store the value
of the Content-Type response header to ensure it is persistent for the
life of the request.

If you are still using a version of mod_wsgi older than version 3.4,
but are unable to upgrade to a newer version of mod_wsgi  and wish to
back port the fix to the older version of mod_wsgi that you are using,
then the patch from mod_wsgi 3.4 can be found at:

<https://github.com/GrahamDumpleton/mod_wsgi/commit/b0a149c1f5e569932325972e2e20176a42e43517>
Thanks go to Buck Golemon for identifying this subsequent issue.

- -- Kurt Seifried Red Hat Security Response Team (SRT) PGP: 0x5E267993
A90B F995 7350 148F 66BF 7554 160D 4553 5E26 7993
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1
Comment: Using GnuPG with Thunderbird - <http://www.enigmail.net/>

iQIcBAEBAgAGBQJTfHX4AAoJEBYNRVNeJnmTYd0QAI3h2HN+VbmAY+gMow+IU7pY
3QJMQNSm2p8q8PKnOqjZZZQiMOklxARbPKW9EefAB4QoDca/7m+sl6Zrbmn3dv52
cMskIfOZ/530W9hF21s+KsVhbLemQv97MIidmZZkY//BghH8l6jhaYXQx7OJkgWS
zcnUs59srkSMKlTV0nww//pULbmJ2AK7ZuxBOqpsxUpqgTugCuyhFj0GwTljggIm
93q/IoDesZApMqfbBgkUcfUGj/EjDqM8LR5TUy6KqTnh8iulgdaakK25+e9lu9WL
X555y5wZzI15Nqniijoi16DhuF05b7JRRGVQboGbF2MbPz6WZQk+pvPh8SxBSIqG
1PzVp2/BcUyzfCp7oZWqbMj9UrBLn9O4i8OwQ/dR3yf72bWHBe+xMM933Xv2yuQL
dn7msHoMc72VDu/KxWWlfSbczdg8xEGX4yRvvuWwuXI6Sp3kWfU2Ggqqcwo8VgJw
395KSUCVf1uyYDOE530ptl6ShnYTLQ76p3ZmSl9I6x2iBgRgWn6P6gov8262M8WA
SQxRUhhReqjqqfUIpRxjhJBZxcn9W0lCUDVWqbO8AxEpOLk41g5Y4YWQlh0QFOhK
2R+G+WWaDUPLu12+guTA/OEo8QD0A7RlizNOl79+IMyFhcJFxPLusGY5IDUK+mwb
ij8EJjA0ebrOMrHKwF8J
=CWJw
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from modwsgi.readthedocs.org_b7cbf67a_20250125_100845.html ===

[mod\_wsgi](../index.html)

* [Project Status](../project-status.html)
* [Security Issues](../security-issues.html)
* [Getting Started](../getting-started.html)
* [Requirements](../requirements.html)
* [Installation](../installation.html)
* [Troubleshooting](../troubleshooting.html)
* [User Guides](../user-guides.html)
* [Configuration](../configuration.html)
* [Finding Help](../finding-help.html)
* [Reporting Bugs](../reporting-bugs.html)
* [Contributing](../contributing.html)
* [Source Code](../source-code.html)
* [Release Notes](../release-notes.html)
  + [Version 5.0.2](version-5.0.2.html)
  + [Version 5.0.1](version-5.0.1.html)
  + [Version 5.0.0](version-5.0.0.html)
  + [Version 4.9.4](version-4.9.4.html)
  + [Version 4.9.3](version-4.9.3.html)
  + [Version 4.9.2](version-4.9.2.html)
  + [Version 4.9.1](version-4.9.1.html)
  + [Version 4.9.0](version-4.9.0.html)
  + [Version 4.8.0](version-4.8.0.html)
  + [Version 4.7.1](version-4.7.1.html)
  + [Version 4.7.0](version-4.7.0.html)
  + [Version 4.6.8](version-4.6.8.html)
  + [Version 4.6.7](version-4.6.7.html)
  + [Version 4.6.6](version-4.6.6.html)
  + [Version 4.6.5](version-4.6.5.html)
  + [Version 4.6.4](version-4.6.4.html)
  + [Version 4.6.3](version-4.6.3.html)
  + [Version 4.6.2](version-4.6.2.html)
  + [Version 4.6.1](version-4.6.1.html)
  + [Version 4.6.0](version-4.6.0.html)
  + [Version 4.5.24](version-4.5.24.html)
  + [Version 4.5.23](version-4.5.23.html)
  + [Version 4.5.22](version-4.5.22.html)
  + [Version 4.5.21](version-4.5.21.html)
  + [Version 4.5.20](version-4.5.20.html)
  + [Version 4.5.19](version-4.5.19.html)
  + [Version 4.5.18](version-4.5.18.html)
  + [Version 4.5.17](version-4.5.17.html)
  + [Version 4.5.16](version-4.5.16.html)
  + [Version 4.5.15](version-4.5.15.html)
  + [Version 4.5.14](version-4.5.14.html)
  + [Version 4.5.13](version-4.5.13.html)
  + [Version 4.5.12](version-4.5.12.html)
  + [Version 4.5.11](version-4.5.11.html)
  + [Version 4.5.10](version-4.5.10.html)
  + [Version 4.5.9](version-4.5.9.html)
  + [Version 4.5.8](version-4.5.8.html)
  + [Version 4.5.7](version-4.5.7.html)
  + [Version 4.5.6](version-4.5.6.html)
  + [Version 4.5.5](version-4.5.5.html)
  + [Version 4.5.4](version-4.5.4.html)
  + [Version 4.5.3](version-4.5.3.html)
  + [Version 4.5.2](version-4.5.2.html)
  + [Version 4.5.1](version-4.5.1.html)
  + [Version 4.5.0](version-4.5.0.html)
  + [Version 4.4.23](version-4.4.23.html)
  + [Version 4.4.22](version-4.4.22.html)
  + [Version 4.4.21](version-4.4.21.html)
  + [Version 4.4.20](version-4.4.20.html)
  + [Version 4.4.19](version-4.4.19.html)
  + [Version 4.4.18](version-4.4.18.html)
  + [Version 4.4.17](version-4.4.17.html)
  + [Version 4.4.16](version-4.4.16.html)
  + [Version 4.4.15](version-4.4.15.html)
  + [Version 4.4.14](version-4.4.14.html)
  + [Version 4.4.13](version-4.4.13.html)
  + [Version 4.4.12](version-4.4.12.html)
  + [Version 4.4.11](version-4.4.11.html)
  + [Version 4.4.10](version-4.4.10.html)
  + [Version 4.4.9](version-4.4.9.html)
  + [Version 4.4.8](version-4.4.8.html)
  + [Version 4.4.7](version-4.4.7.html)
  + [Version 4.4.6](version-4.4.6.html)
  + [Version 4.4.5](version-4.4.5.html)
  + [Version 4.4.4](version-4.4.4.html)
  + [Version 4.4.3](version-4.4.3.html)
  + [Version 4.4.2](version-4.4.2.html)
  + [Version 4.4.1](version-4.4.1.html)
  + [Version 4.4.0](version-4.4.0.html)
  + [Version 4.3.2](version-4.3.2.html)
  + [Version 4.3.1](version-4.3.1.html)
  + [Version 4.3.0](version-4.3.0.html)
  + [Version 4.2.8](version-4.2.8.html)
  + [Version 4.2.7](version-4.2.7.html)
  + [Version 4.2.6](version-4.2.6.html)
  + [Version 4.2.5](version-4.2.5.html)
  + [Version 4.2.4](version-4.2.4.html)
  + [Version 4.2.3](version-4.2.3.html)
  + [Version 4.2.2](version-4.2.2.html)
  + [Version 4.2.1](version-4.2.1.html)
  + [Version 4.2.0](version-4.2.0.html)
  + [Version 4.1.3](version-4.1.3.html)
  + [Version 4.1.2](version-4.1.2.html)
  + [Version 4.1.1](version-4.1.1.html)
  + [Version 4.1.0](version-4.1.0.html)
  + [Version 4.0](version-4.0.html)
  + [Version 3.5](version-3.5.html)
  + Version 3.4
    - [Security Issues](#security-issues)
    - [Bugs Fixed](#bugs-fixed)
    - [Features Changed](#features-changed)
    - [New Features](#new-features)
  + [Version 3.3](version-3.3.html)
  + [Version 3.2](version-3.2.html)
  + [Version 3.1](version-3.1.html)
  + [Version 3.0](version-3.0.html)
  + [Version 2.8](version-2.8.html)
  + [Version 2.7](version-2.7.html)
  + [Version 2.6](version-2.6.html)
  + [Version 2.5](version-2.5.html)
  + [Version 2.4](version-2.4.html)
  + [Version 2.3](version-2.3.html)
  + [Version 2.2](version-2.2.html)
  + [Version 2.1](version-2.1.html)
  + [Version 2.0](version-2.0.html)
  + [Version 1.6](version-1.6.html)
  + [Version 1.5](version-1.5.html)
  + [Version 1.4](version-1.4.html)
  + [Version 1.3](version-1.3.html)
  + [Version 1.2](version-1.2.html)
  + [Version 1.1](version-1.1.html)
  + [Version 1.0](version-1.0.html)

[mod\_wsgi](../index.html)

* [Release Notes](../release-notes.html)
* Version 3.4
* [View page source](../_sources/release-notes/version-3.4.rst.txt)

---

# Version 3.4[¶](#version-3-4 "Link to this heading")

Version 3.4 of mod\_wsgi can be obtained from:

> <http://modwsgi.googlecode.com/files/mod_wsgi-3.4.tar.gz>

## Security Issues[¶](#security-issues "Link to this heading")

1. Information disclosure via Content-Type response header. (CVE-2014-0242)

The issue was identified and fixed in version 3.4 (August 2012) of mod\_wsgi
and is listed below at item 7 under ‘Bugs Fixed’.

> Response Content-Type header could be corrupted when being sent in
> multithreaded configuration and embedded mode being used. Problem thus
> affected Windows and worker MPM on UNIX.

At the time it was believed to be relatively benign, only ever having been
seen with one specific web application (Trac - <http://trac.edgewall.org>),
with the corrupted value always appearing to be replaced with a small set
of known values which themselves did not raise concerns.

A new example of this problem was identified May 2014 which opens this
issue up as being able to cause arbitrary corruption of the web server HTTP
response Content-Type value, resulting in possible exposure of data from
the hosted web application to a HTTP client.

The new example also opens the possibility that the issue can occur with
any Apache MPM and not just multithreaded MPMs as previously identified.
Albeit that it still requires some form of background application threads
to be in use, when a single threaded Apache MPM is being used.

In either case, it is still however restricted to the case where embedded
mode of mod\_wsgi is being used.

The specific scenario which can trigger the issue is where the value for
the Content-Type response header is dynamically generated, and where the
stack frame where the calculation was done went out of use between the time
that the WSGI start\_response() function was called and the first non empty
byte string was yielded from the WSGI application for the response,
resulting in the Python object being destroyed and memory returned to the
free list.

At the same time, it would have been necessary for a parallel request
thread or an application background thread to execute during that window of
time and perform sufficient object allocations so as to reuse the memory
previously used by the value of the Content-Type response header.

Example code which can be used to trigger the specific scenario can be
found at:

> <https://gist.github.com/GrahamDumpleton/14b31ebe18166a89b090>

That example code also provides a workaround if you find yourself affected
by the issue but cannot upgrade straight away. It consists of the
@intern\_content\_type decorator/wrapper. This can be applied to the WSGI
application entry point and will use a cache to store the value of the
Content-Type response header to ensure it is persistent for the life of the
request.

## Bugs Fixed[¶](#bugs-fixed "Link to this heading")

1. If using write() function returned by start\_response() and a non string
value is passed to it, then process can crash due to errors in Python object
reference counting in error path of code.

2. If using write() function returned by start\_response() under Python 3.X
and a Unicode string is passed to it rather than a byte string, then a
memory leak will occur because of errors in Python object reference
counting.

3. Debug level log message about mismatch in content length generated was
generated when content returned less than that specified by Content-Length
response header even when exception occurring during response generation
from an iterator. In the case of an exception occuring, was only meant to
generate the log message if more content returned than defined by the
Content-Length response header.

4. Using writelines() on wsgi.errors was failing.

5. If a UNIX signal received by daemon mode process while still being
initialised to signal that it should be shutdown, the process could crash
rather than shutdown properly due to not registering the signal pipe
prior to registering signal handler.

6. Python doesn’t initialise codecs in sub interpreters automatically which
in some cases could cause code running in WSGI script to fail due to lack
of encoding for Unicode strings when converting them. The error message
in this case was:

```
LookupError: no codec search functions registered: can't find encoding

```

The ‘ascii’ encoding is now forcibly loaded when initialising sub interpreters
to get Python to initialise codecs.

7. Response Content-Type header could be corrupted when being sent in
multithreaded configuration and embedded mode being used. Problem thus
affected Windows and worker MPM on UNIX.

## Features Changed[¶](#features-changed "Link to this heading")

1. The HTTPS variable is no longer set within the WSGI environment. The
authoritative indicator of whether a SSL connection is used is
wsgi.url\_scheme and a WSGI compliant application should check for
wsgi.url\_scheme. The only reason that HTTPS was supplied at all was because
early Django versions supporting WSGI interface weren’t correctly using
wsgi.url\_scheme. Instead they were expecting to see HTTPS to exist.

This change will cause non conformant WSGI applications to finally break.
This possibly includes some Django versions prior to Django version 1.0.

Note that you can still set HTTPS in Apache configuration using the !SetEnv
or !SetEnvIf directive, or via a rewrite rule. In that case, that will
override what wsgi.url\_scheme is set to and once wsgi.url\_scheme is set
appropriately, the HTTPS variable will be removed from the set of variables
passed through to the WSGI environment.

2. The wsgi.version variable has been reverted to 1.0 to conform to the
WSGI PEP 3333 specification. It was originally set to 1.1 on expectation
that revised specification would use 1.1 but that didn’t come to be.

3. Use of kernel sendfile() function by wsgi.file\_wrapper is now off by
default. This was originally always on for embedded mode and completely
disabled for daemon mode. Use of this feature can be enabled for either
mode using WSGIEnableSendfile directive, setting it to On to enable it.

The default is now off because kernel sendfile() is not always able to work
on all file objects. Some instances where it will not work are described
for the Apache !EnableSendfile directive.

> <http://httpd.apache.org/docs/2.2/mod/core.html#enablesendfile>

Although Apache has use of sendfile() enabled by default for static files,
they are moving to having it off by default in future version of Apache.
This change is being made because of the problems which arise and users not
knowing how to debug it and solve it.

Thus also erring on side of caution and having it off by default but
allowing more knowledgeable users to enable it where they know always using
file objects which will work with sendfile().

## New Features[¶](#new-features "Link to this heading")

1. Support use of Python 3.2.
2. Support use of Apache 2.4.

3. Is now guaranteed that mod\_ssl access handler is run before that for
mod\_wsgi so that any per request variables setup by mod\_ssl are available
in the mod\_wsgi access handler as implemented by WSGIAccessScript
directive.

4. Added ‘python-home’ option to WSGIDaemonProcess allowing a Python virtual
environment to be used directly in conjunction with daemon process. Note that
this option does not do anything if setting WSGILazyInitialization to ‘Off’.

5. Added ‘lang’ and ‘locale’ options to WSGIDaemonProcess to perform same
tasks as setting ‘LANG’ and ‘LC\_ALL environment’ variables. Note that if
needing to do the same for embedded mode you still need to set the
environment variables in the Apache envvars file or init.d startup scripts.

6. Split combined WWW-Authenticate header returned from daemon process back
into separate headers. This is work around for some browsers which require
separate headers when multiple authentication providers exist.

7. For Python 2.6 and above, the WSGIDontWriteBytecode directive can be used
at global scope in Apache configuration to disable writing of all byte code
files, ie., .pyc, by the Python interpreter when it imports Python code files.
To disable writing of byte code files, set directive to ‘On’.

Note that this doesn’t prevent existing byte code files on disk being used
in preference to the corresponding Python code files. Thus you should first
remove .pyc files from web application directories if relying on this
option to ensure that .py file is always used.

8. Add supplementary-groups option to WSGIDaemonProcess to allow group
membership to be overridden and specified comma separated list of groups
to be used instead.

9. Add ‘memory-limit’ option to WSGIDaemonProcess to allow memory usage of
daemon processes to be restricted. This will have no affect on some
platforms as RLIMIT\_AS/RLIMIT\_DATA with setrlimit() isn’t always
implemented. For example MacOS X and older Linux kernel versions do not
implement this feature. You will need to test whether this feature works
or not before depending on it.

10. Add ‘virtual-memory-limit’ option to WSGIDaemonProcess to allow virtual
memory usage of daemon processes to be restricted. This will have no affect
on some platforms as RLIMIT\_VMEM with setrlimit() isn’t always implemented.
You will need to test whether this feature works or not before depending on
it.

11. Access, authentication and authorisation hooks now have additional keys
in the environ dictionary for ‘mod\_ssl.is\_https’ and ‘mod\_ssl.var\_lookup’.
These equate to callable functions provided by mod\_ssl for determining if
the client connection to Apache used SSL and what the values of variables
specified in the SSL certifcates, server or client, are. These are only
available if Apache 2.0 or later is being used.

12. Add ‘mod\_wsgi.queue\_start’ attribute to WSGI environ so tools like
New Relic can use it to track request queueing time. This is the time between
when request accepted by Apache and when handled by WSGI application.

 [Previous](version-3.5.html "Version 3.5")
[Next](version-3.3.html "Version 3.3")

---

© Copyright 2007-2024, Graham Dumpleton.

Built with [Sphinx](https://www.sphinx-doc.org/) using a
[theme](https://github.com/readthedocs/sphinx_rtd_theme)
provided by [Read the Docs](https://readthedocs.org).


