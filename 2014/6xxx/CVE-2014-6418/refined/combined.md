=== Content from tracker.ceph.com_69a2d3ac_20250124_211256.html ===


⚲

### Project

### General

### Profile

* [Sign in](/login)
* [Register](/account/register)

* [Home](/)
* [Projects](/projects)
* [Help](https://www.redmine.org/guide)

[Search](/projects/ceph-kclient/search):

 Linux kernel client[All Projects](/projects?jump=issues)
# [Ceph](/projects/ceph?jump=issues) » Linux kernel client

* [Overview](/projects/ceph-kclient)
* [Activity](/projects/ceph-kclient/activity)
* [Roadmap](/projects/ceph-kclient/roadmap)
* [Issues](/projects/ceph-kclient/issues)
* [Spent time](/projects/ceph-kclient/time_entries)
* [Gantt](/projects/ceph-kclient/issues/gantt)
* [Calendar](/projects/ceph-kclient/issues/calendar)

### Custom queries

* [Backlog](/projects/ceph-kclient/issues?query_id=26)
* [Bug queue](/projects/ceph-kclient/issues?query_id=27)
* [Bug triage](/projects/ceph-kclient/issues?query_id=40)
* [Crash queue](/projects/ceph-kclient/issues?query_id=241)
* [Crash triage](/projects/ceph-kclient/issues?query_id=240)
* [Feedback](/projects/ceph-kclient/issues?query_id=30)
* [My issues](/projects/ceph-kclient/issues?query_id=7)
* [Need Review](/projects/ceph-kclient/issues?query_id=32)
* [Pending backports](/projects/ceph-kclient/issues?query_id=60)
* [Product Backlog Scrub](/projects/ceph-kclient/issues?query_id=45)

Actions
Copy link
## Bug #9561

closed

### libceph: do not crash if auth reply is not understood

Added by [Ilya Dryomov](/users/1296) [over 10 years](/projects/ceph-kclient/activity?from=2014-09-22 "09/22/2014 04:04 AM") ago.
Updated [over 10 years](/projects/ceph-kclient/activity?from=2014-10-21 "10/21/2014 08:09 AM") ago.

Status:RejectedPriority:NormalAssignee:-Category:-Target version:-% Done:

|  |
| --- |

0%

Source:otherBackport:Regression:Severity:3 - minorReviewed:Affected Versions:ceph-qa-suite:Crash signature (v1):Crash signature (v2):Tags (freeform):

---

**Related issues**
[1](/issues?issue_id=8979&set_filter=true&status_id=%2A) (0 open — [1 closed](/issues?issue_id=8979&set_filter=true&status_id=c))

|  | Related to Linux kernel client - [Bug #8979](/issues/8979): GPF kernel panics - auth? | Resolved | [Ilya Dryomov](/users/1296) | 07/31/2014 |  | |  | | --- | | Actions |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

Related to
Is duplicate of
Has duplicate
Blocks
Blocked by
Precedes
Follows
Copied to
Copied from
Issue #
Delay:  days

Cancel

* [History](/issues/9561?tab=history)
* [Notes](/issues/9561?tab=notes)
* [Property changes](/issues/9561?tab=properties)

ActionsCopy link
[#1](#note-1)
#### Updated by [Ilya Dryomov](/users/1296) [over 10 years](/projects/ceph-kclient/activity?from=2014-09-23 "09/23/2014 01:56 PM") ago

* **Subject** changed from *do not crash if auth reply is not understood* to *libceph: do not crash if auth reply is not understood*

ActionsCopy link
[#2](#note-2)
#### Updated by [Sage Weil](/users/3) [over 10 years](/projects/ceph-kclient/activity?from=2014-10-21 "10/21/2014 08:09 AM") ago

* **Status** changed from *New* to *Rejected*

I believe the code is correct as is and I misdiagnosed the original issue. :(

Actions
Copy link

Also available in: [Atom](/issues/9561.atom)
[PDF](/issues/9561.pdf)

Powered by [Redmine](https://www.redmine.org/) © 2006-2024 Jean-Philippe Lang

Loading...



=== Content from www.ubuntu.com_f8ace1dc_20250124_211313.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2378-1: Linux kernel (Trusty HWE) vulnerabilities

9 October 2014

Several security issues were fixed in the kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [linux-lts-trusty](/security/cves?package=linux-lts-trusty) - Linux hardware enablement kernel from Trusty

## Details

Steven Vittitoe reported multiple stack buffer overflows in Linux kernel's

magicmouse HID driver. A physically proximate attacker could exploit this

flaw to cause a denial of service (system crash) or possibly execute

arbitrary code via specially crafted devices. ([CVE-2014-3181](/security/CVE-2014-3181))

Ben Hawkes reported some off by one errors for report descriptors in the

Linux kernel's HID stack. A physically proximate attacker could exploit

these flaws to cause a denial of service (out-of-bounds write) via a

specially crafted device. ([CVE-2014-3184](/security/CVE-2014-3184))

Several bounds check flaws allowing for buffer overflows were discovered in

the Linux kernel's Whiteheat USB serial driver. A physically proximate

attacker could exploit these flaws to cause a denial of service (system

crash) via a specially crafted device. ([CVE-2014-3185](/security/CVE-2014-3185))

Steven Vittitoe reported a buffer overflow in the Linux kernel's PicoLCD

HID device driver. A physically proximate attacker could exploit this flaw

to cause a denial of service (system crash) or possibly execute arbitrary

code via a specially craft device. ([CVE-2014-3186](/security/CVE-2014-3186))

A flaw was discovered in the Linux kernel's associative-array garbage

collection implementation. A local user could exploit this flaw to cause a

denial of service (system crash) or possibly have other unspecified impact

by using keyctl operations. ([CVE-2014-3631](/security/CVE-2014-3631))

A flaw was discovered in the Linux kernel's UDF filesystem (used on some

CD-ROMs and DVDs) when processing indirect ICBs. An attacker who can cause

CD, DVD or image file with a specially crafted inode to be mounted can

cause a denial of service (infinite loop or stack consumption).

([CVE-2014-6410](/security/CVE-2014-6410))

James Eckersall discovered a buffer overflow in the Ceph filesystem in the

Linux kernel. A remote attacker could exploit this flaw to cause a denial

of service (memory consumption and panic) or possibly have other

unspecified impact via a long unencrypted auth ticket. ([CVE-2014-6416](/security/CVE-2014-6416))

James Eckersall discovered a flaw in the handling of memory allocation

failures in the Ceph filesystem. A remote attacker could exploit this flaw

to cause a denial of service (system crash) or possibly have unspecified

other impact. ([CVE-2014-6417](/security/CVE-2014-6417))

James Eckersall discovered a flaw in how the Ceph filesystem validates auth

replies. A remote attacker could exploit this flaw to cause a denial of

service (system crash) or possibly have other unspecified impact.

([CVE-2014-6418](/security/CVE-2014-6418))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [linux-image-3.13.0-37-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty)
  -
  [3.13.0-37.64~precise1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty/3.13.0-37.64~precise1)
* [linux-image-3.13.0-37-generic](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty)
  -
  [3.13.0-37.64~precise1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-trusty/3.13.0-37.64~precise1)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2014-3181](/security/CVE-2014-3181)
* [CVE-2014-3184](/security/CVE-2014-3184)
* [CVE-2014-3185](/security/CVE-2014-3185)
* [CVE-2014-3186](/security/CVE-2014-3186)
* [CVE-2014-3631](/security/CVE-2014-3631)
* [CVE-2014-6410](/security/CVE-2014-6410)
* [CVE-2014-6416](/security/CVE-2014-6416)
* [CVE-2014-6417](/security/CVE-2014-6417)
* [CVE-2014-6418](/security/CVE-2014-6418)

## Related notices

* [USN-2376-1](/security/notices/USN-2376-1)
* [USN-2377-1](/security/notices/USN-2377-1)
* [USN-2379-1](/security/notices/USN-2379-1)
* [USN-2375-1](/security/notices/USN-2375-1)
* [USN-2374-1](/security/notices/USN-2374-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from www.ubuntu.com_0362f2c1_20250124_211315.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2379-1: Linux kernel vulnerabilities

9 October 2014

Several security issues were fixed in the kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel

## Details

Steven Vittitoe reported multiple stack buffer overflows in Linux kernel's

magicmouse HID driver. A physically proximate attacker could exploit this

flaw to cause a denial of service (system crash) or possibly execute

arbitrary code via specially crafted devices. ([CVE-2014-3181](/security/CVE-2014-3181))

Ben Hawkes reported some off by one errors for report descriptors in the

Linux kernel's HID stack. A physically proximate attacker could exploit

these flaws to cause a denial of service (out-of-bounds write) via a

specially crafted device. ([CVE-2014-3184](/security/CVE-2014-3184))

Several bounds check flaws allowing for buffer overflows were discovered in

the Linux kernel's Whiteheat USB serial driver. A physically proximate

attacker could exploit these flaws to cause a denial of service (system

crash) via a specially crafted device. ([CVE-2014-3185](/security/CVE-2014-3185))

Steven Vittitoe reported a buffer overflow in the Linux kernel's PicoLCD

HID device driver. A physically proximate attacker could exploit this flaw

to cause a denial of service (system crash) or possibly execute arbitrary

code via a specially craft device. ([CVE-2014-3186](/security/CVE-2014-3186))

A flaw was discovered in the Linux kernel's associative-array garbage

collection implementation. A local user could exploit this flaw to cause a

denial of service (system crash) or possibly have other unspecified impact

by using keyctl operations. ([CVE-2014-3631](/security/CVE-2014-3631))

A flaw was discovered in the Linux kernel's UDF filesystem (used on some

CD-ROMs and DVDs) when processing indirect ICBs. An attacker who can cause

CD, DVD or image file with a specially crafted inode to be mounted can

cause a denial of service (infinite loop or stack consumption).

([CVE-2014-6410](/security/CVE-2014-6410))

James Eckersall discovered a buffer overflow in the Ceph filesystem in the

Linux kernel. A remote attacker could exploit this flaw to cause a denial

of service (memory consumption and panic) or possibly have other

unspecified impact via a long unencrypted auth ticket. ([CVE-2014-6416](/security/CVE-2014-6416))

James Eckersall discovered a flaw in the handling of memory allocation

failures in the Ceph filesystem. A remote attacker could exploit this flaw

to cause a denial of service (system crash) or possibly have unspecified

other impact. ([CVE-2014-6417](/security/CVE-2014-6417))

James Eckersall discovered a flaw in how the Ceph filesystem validates auth

replies. A remote attacker could exploit this flaw to cause a denial of

service (system crash) or possibly have other unspecified impact.

([CVE-2014-6418](/security/CVE-2014-6418))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 14.04

* [linux-image-3.13.0-37-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)
* [linux-image-3.13.0-37-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)
* [linux-image-3.13.0-37-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)
* [linux-image-3.13.0-37-powerpc-e500](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)
* [linux-image-3.13.0-37-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)
* [linux-image-3.13.0-37-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)
* [linux-image-3.13.0-37-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)
* [linux-image-3.13.0-37-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.13.0-37.64](https://launchpad.net/ubuntu/%2Bsource/linux/3.13.0-37.64)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2014-3181](/security/CVE-2014-3181)
* [CVE-2014-3184](/security/CVE-2014-3184)
* [CVE-2014-3185](/security/CVE-2014-3185)
* [CVE-2014-3186](/security/CVE-2014-3186)
* [CVE-2014-3631](/security/CVE-2014-3631)
* [CVE-2014-6410](/security/CVE-2014-6410)
* [CVE-2014-6416](/security/CVE-2014-6416)
* [CVE-2014-6417](/security/CVE-2014-6417)
* [CVE-2014-6418](/security/CVE-2014-6418)

## Related notices

* [USN-2378-1](/security/notices/USN-2378-1)
* [USN-2376-1](/security/notices/USN-2376-1)
* [USN-2377-1](/security/notices/USN-2377-1)
* [USN-2375-1](/security/notices/USN-2375-1)
* [USN-2374-1](/security/notices/USN-2374-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from github.com_9c6f9c5e_20250124_211319.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc27a3e4d667fdcad3db7b104f75659478e0c68d8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc27a3e4d667fdcad3db7b104f75659478e0c68d8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/c27a3e4d667fdcad3db7b104f75659478e0c68d8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

libceph: do not hard code max auth ticket len

[Browse files](/torvalds/linux/tree/c27a3e4d667fdcad3db7b104f75659478e0c68d8)
Browse the repository at this point in the history

```
We hard code cephx auth ticket buffer size to 256 bytes.  This isn't
enough for any moderate setups and, in case tickets themselves are not
encrypted, leads to buffer overflows (ceph_x_decrypt() errors out, but
ceph_decode_copy() doesn't - it's just a memcpy() wrapper).  Since the
buffer is allocated dynamically anyway, allocated it a bit later, at
the point where we know how much is going to be needed.

Fixes: <http://tracker.ceph.com/issues/8979>

Cc: stable@vger.kernel.org
Signed-off-by: Ilya Dryomov <ilya.dryomov@inktank.com>
Reviewed-by: Sage Weil <sage@redhat.com>
```

* Loading branch information

[![@idryomov](https://avatars.githubusercontent.com/u/567341?s=40&v=4)](/idryomov)

[idryomov](/torvalds/linux/commits?author=idryomov "View all commits by idryomov")
committed
Sep 10, 2014

1 parent
[597cda3](/torvalds/linux/commit/597cda357716a3cf8d994cb11927af917c8d71fa)

commit c27a3e4

Showing
**1 changed file**
with
**29 additions**
and
**35 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

64 changes: 29 additions & 35 deletions

64
[net/ceph/auth\_x.c](#diff-3e53878b23f9c3aab6aa6c262c02d16ca622b81998eb4f50e32bb1d262165129 "net/ceph/auth_x.c")

Show comments

[View file](/torvalds/linux/blob/c27a3e4d667fdcad3db7b104f75659478e0c68d8/net/ceph/auth_x.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,8 +13,6 @@ |
|  |  | #include "auth\_x.h" |
|  |  | #include "auth\_x\_protocol.h" |
|  |  |  |
|  |  | #define TEMP\_TICKET\_BUF\_LEN 256 |
|  |  |  |
|  |  | static void ceph\_x\_validate\_tickets(struct ceph\_auth\_client \*ac, int \*pneed); |
|  |  |  |
|  |  | static int ceph\_x\_is\_authenticated(struct ceph\_auth\_client \*ac) |
| Expand Down  Expand Up | | @@ -64,7 +62,7 @@ static int ceph\_x\_encrypt(struct ceph\_crypto\_key \*secret, |
|  |  | } |
|  |  |  |
|  |  | static int ceph\_x\_decrypt(struct ceph\_crypto\_key \*secret, |
|  |  | void \*\*p, void \*end, void \*obuf, size\_t olen) |
|  |  | void \*\*p, void \*end, void \*\*obuf, size\_t olen) |
|  |  | { |
|  |  | struct ceph\_x\_encrypt\_header head; |
|  |  | size\_t head\_len = sizeof(head); |
| Expand All | | @@ -75,8 +73,14 @@ static int ceph\_x\_decrypt(struct ceph\_crypto\_key \*secret, |
|  |  | return -EINVAL; |
|  |  |  |
|  |  | dout("ceph\_x\_decrypt len %d\n", len); |
|  |  | ret = ceph\_decrypt2(secret, &head, &head\_len, obuf, &olen, |
|  |  | \*p, len); |
|  |  | if (\*obuf == NULL) { |
|  |  | \*obuf = kmalloc(len, GFP\_NOFS); |
|  |  | if (!\*obuf) |
|  |  | return -ENOMEM; |
|  |  | olen = len; |
|  |  | } |
|  |  |  |
|  |  | ret = ceph\_decrypt2(secret, &head, &head\_len, \*obuf, &olen, \*p, len); |
|  |  | if (ret) |
|  |  | return ret; |
|  |  | if (head.struct\_v != 1 || le64\_to\_cpu(head.magic) != CEPHX\_ENC\_MAGIC) |
| Expand Down  Expand Up | | @@ -131,18 +135,19 @@ static void remove\_ticket\_handler(struct ceph\_auth\_client \*ac, |
|  |  |  |
|  |  | static int process\_one\_ticket(struct ceph\_auth\_client \*ac, |
|  |  | struct ceph\_crypto\_key \*secret, |
|  |  | void \*\*p, void \*end, |
|  |  | void \*dbuf, void \*ticket\_buf) |
|  |  | void \*\*p, void \*end) |
|  |  | { |
|  |  | struct ceph\_x\_info \*xi = ac->private; |
|  |  | int type; |
|  |  | u8 tkt\_struct\_v, blob\_struct\_v; |
|  |  | struct ceph\_x\_ticket\_handler \*th; |
|  |  | void \*dbuf = NULL; |
|  |  | void \*dp, \*dend; |
|  |  | int dlen; |
|  |  | char is\_enc; |
|  |  | struct timespec validity; |
|  |  | struct ceph\_crypto\_key old\_key; |
|  |  | void \*ticket\_buf = NULL; |
|  |  | void \*tp, \*tpend; |
|  |  | struct ceph\_timespec new\_validity; |
|  |  | struct ceph\_crypto\_key new\_session\_key; |
| Expand All | | @@ -167,8 +172,7 @@ static int process\_one\_ticket(struct ceph\_auth\_client \*ac, |
|  |  | } |
|  |  |  |
|  |  | /\* blob for me \*/ |
|  |  | dlen = ceph\_x\_decrypt(secret, p, end, dbuf, |
|  |  | TEMP\_TICKET\_BUF\_LEN); |
|  |  | dlen = ceph\_x\_decrypt(secret, p, end, &dbuf, 0); |
|  |  | if (dlen <= 0) { |
|  |  | ret = dlen; |
|  |  | goto out; |
| Expand All | | @@ -195,20 +199,25 @@ static int process\_one\_ticket(struct ceph\_auth\_client \*ac, |
|  |  |  |
|  |  | /\* ticket blob for service \*/ |
|  |  | ceph\_decode\_8\_safe(p, end, is\_enc, bad); |
|  |  | tp = ticket\_buf; |
|  |  | if (is\_enc) { |
|  |  | /\* encrypted \*/ |
|  |  | dout(" encrypted ticket\n"); |
|  |  | dlen = ceph\_x\_decrypt(&old\_key, p, end, ticket\_buf, |
|  |  | TEMP\_TICKET\_BUF\_LEN); |
|  |  | dlen = ceph\_x\_decrypt(&old\_key, p, end, &ticket\_buf, 0); |
|  |  | if (dlen < 0) { |
|  |  | ret = dlen; |
|  |  | goto out; |
|  |  | } |
|  |  | tp = ticket\_buf; |
|  |  | dlen = ceph\_decode\_32(&tp); |
|  |  | } else { |
|  |  | /\* unencrypted \*/ |
|  |  | ceph\_decode\_32\_safe(p, end, dlen, bad); |
|  |  | ticket\_buf = kmalloc(dlen, GFP\_NOFS); |
|  |  | if (!ticket\_buf) { |
|  |  | ret = -ENOMEM; |
|  |  | goto out; |
|  |  | } |
|  |  | tp = ticket\_buf; |
|  |  | ceph\_decode\_need(p, end, dlen, bad); |
|  |  | ceph\_decode\_copy(p, ticket\_buf, dlen); |
|  |  | } |
| Expand Down  Expand Up | | @@ -237,6 +246,8 @@ static int process\_one\_ticket(struct ceph\_auth\_client \*ac, |
|  |  | xi->have\_keys |= th->service; |
|  |  |  |
|  |  | out: |
|  |  | kfree(ticket\_buf); |
|  |  | kfree(dbuf); |
|  |  | return ret; |
|  |  |  |
|  |  | bad: |
| Expand All | | @@ -249,21 +260,10 @@ static int ceph\_x\_proc\_ticket\_reply(struct ceph\_auth\_client \*ac, |
|  |  | void \*buf, void \*end) |
|  |  | { |
|  |  | void \*p = buf; |
|  |  | char \*dbuf; |
|  |  | char \*ticket\_buf; |
|  |  | u8 reply\_struct\_v; |
|  |  | u32 num; |
|  |  | int ret; |
|  |  |  |
|  |  | dbuf = kmalloc(TEMP\_TICKET\_BUF\_LEN, GFP\_NOFS); |
|  |  | if (!dbuf) |
|  |  | return -ENOMEM; |
|  |  |  |
|  |  | ret = -ENOMEM; |
|  |  | ticket\_buf = kmalloc(TEMP\_TICKET\_BUF\_LEN, GFP\_NOFS); |
|  |  | if (!ticket\_buf) |
|  |  | goto out\_dbuf; |
|  |  |  |
|  |  | ceph\_decode\_8\_safe(&p, end, reply\_struct\_v, bad); |
|  |  | if (reply\_struct\_v != 1) |
|  |  | return -EINVAL; |
| Expand All | | @@ -272,22 +272,15 @@ static int ceph\_x\_proc\_ticket\_reply(struct ceph\_auth\_client \*ac, |
|  |  | dout("%d tickets\n", num); |
|  |  |  |
|  |  | while (num--) { |
|  |  | ret = process\_one\_ticket(ac, secret, &p, end, |
|  |  | dbuf, ticket\_buf); |
|  |  | ret = process\_one\_ticket(ac, secret, &p, end); |
|  |  | if (ret) |
|  |  | goto out; |
|  |  | return ret; |
|  |  | } |
|  |  |  |
|  |  | ret = 0; |
|  |  | out: |
|  |  | kfree(ticket\_buf); |
|  |  | out\_dbuf: |
|  |  | kfree(dbuf); |
|  |  | return ret; |
|  |  | return 0; |
|  |  |  |
|  |  | bad: |
|  |  | ret = -EINVAL; |
|  |  | goto out; |
|  |  | return -EINVAL; |
|  |  | } |
|  |  |  |
|  |  | static int ceph\_x\_build\_authorizer(struct ceph\_auth\_client \*ac, |
| Expand Down  Expand Up | | @@ -603,13 +596,14 @@ static int ceph\_x\_verify\_authorizer\_reply(struct ceph\_auth\_client \*ac, |
|  |  | struct ceph\_x\_ticket\_handler \*th; |
|  |  | int ret = 0; |
|  |  | struct ceph\_x\_authorize\_reply reply; |
|  |  | void \*preply = &reply; |
|  |  | void \*p = au->reply\_buf; |
|  |  | void \*end = p + sizeof(au->reply\_buf); |
|  |  |  |
|  |  | th = get\_ticket\_handler(ac, au->service); |
|  |  | if (IS\_ERR(th)) |
|  |  | return PTR\_ERR(th); |
|  |  | ret = ceph\_x\_decrypt(&th->session\_key, &p, end, &reply, sizeof(reply)); |
|  |  | ret = ceph\_x\_decrypt(&th->session\_key, &p, end, &preply, sizeof(reply)); |
|  |  | if (ret < 0) |
|  |  | return ret; |
|  |  | if (ret != sizeof(reply)) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c27a3e4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fc27a3e4d667fdcad3db7b104f75659478e0c68d8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.ubuntu.com_4c710ea0_20250124_211309.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2376-1: Linux kernel vulnerabilities

9 October 2014

Several security issues were fixed in the kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel

## Details

Steven Vittitoe reported multiple stack buffer overflows in Linux kernel's

magicmouse HID driver. A physically proximate attacker could exploit this

flaw to cause a denial of service (system crash) or possibly execute

arbitrary code via specially crafted devices. ([CVE-2014-3181](/security/CVE-2014-3181))

A bounds check error was discovered in the driver for the Logitech Unifying

receivers and devices. A physically proximate attacker could exploit this

flaw to to cause a denial of service (invalid kfree) or to execute

arbitrary code. ([CVE-2014-3182](/security/CVE-2014-3182))

Ben Hawkes reported some off by one errors for report descriptors in the

Linux kernel's HID stack. A physically proximate attacker could exploit

these flaws to cause a denial of service (out-of-bounds write) via a

specially crafted device. ([CVE-2014-3184](/security/CVE-2014-3184))

Several bounds check flaws allowing for buffer overflows were discovered in

the Linux kernel's Whiteheat USB serial driver. A physically proximate

attacker could exploit these flaws to cause a denial of service (system

crash) via a specially crafted device. ([CVE-2014-3185](/security/CVE-2014-3185))

Steven Vittitoe reported a buffer overflow in the Linux kernel's PicoLCD

HID device driver. A physically proximate attacker could exploit this flaw

to cause a denial of service (system crash) or possibly execute arbitrary

code via a specially craft device. ([CVE-2014-3186](/security/CVE-2014-3186))

A flaw was discovered in the Linux kernel's UDF filesystem (used on some

CD-ROMs and DVDs) when processing indirect ICBs. An attacker who can cause

CD, DVD or image file with a specially crafted inode to be mounted can

cause a denial of service (infinite loop or stack consumption).

([CVE-2014-6410](/security/CVE-2014-6410))

James Eckersall discovered a buffer overflow in the Ceph filesystem in the

Linux kernel. A remote attacker could exploit this flaw to cause a denial

of service (memory consumption and panic) or possibly have other

unspecified impact via a long unencrypted auth ticket. ([CVE-2014-6416](/security/CVE-2014-6416))

James Eckersall discovered a flaw in the handling of memory allocation

failures in the Ceph filesystem. A remote attacker could exploit this flaw

to cause a denial of service (system crash) or possibly have unspecified

other impact. ([CVE-2014-6417](/security/CVE-2014-6417))

James Eckersall discovered a flaw in how the Ceph filesystem validates auth

replies. A remote attacker could exploit this flaw to cause a denial of

service (system crash) or possibly have other unspecified impact.

([CVE-2014-6418](/security/CVE-2014-6418))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [linux-image-3.2.0-70-generic-pae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-70.105](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-70.105)
* [linux-image-3.2.0-70-omap](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-70.105](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-70.105)
* [linux-image-3.2.0-70-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-70.105](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-70.105)
* [linux-image-3.2.0-70-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-70.105](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-70.105)
* [linux-image-3.2.0-70-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-70.105](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-70.105)
* [linux-image-3.2.0-70-highbank](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-70.105](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-70.105)
* [linux-image-3.2.0-70-virtual](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [3.2.0-70.105](https://launchpad.net/ubuntu/%2Bsource/linux/3.2.0-70.105)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2014-3181](/security/CVE-2014-3181)
* [CVE-2014-3182](/security/CVE-2014-3182)
* [CVE-2014-3184](/security/CVE-2014-3184)
* [CVE-2014-3185](/security/CVE-2014-3185)
* [CVE-2014-3186](/security/CVE-2014-3186)
* [CVE-2014-6410](/security/CVE-2014-6410)
* [CVE-2014-6416](/security/CVE-2014-6416)
* [CVE-2014-6417](/security/CVE-2014-6417)
* [CVE-2014-6418](/security/CVE-2014-6418)

## Related notices

* [USN-2378-1](/security/notices/USN-2378-1)
* [USN-2377-1](/security/notices/USN-2377-1)
* [USN-2379-1](/security/notices/USN-2379-1)
* [USN-2395-1](/security/notices/USN-2395-1)
* [USN-2394-1](/security/notices/USN-2394-1)
* [USN-2375-1](/security/notices/USN-2375-1)
* [USN-2374-1](/security/notices/USN-2374-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from www.openwall.com_66a88a1f_20250124_211307.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[<thread-prev]](4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <20140915172009.403996C0024@smtpvmsrv1.mitre.org>
Date: Mon, 15 Sep 2014 13:20:09 -0400 (EDT)
From: cve-assign@...re.org
To: meissner@...e.de
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: CVE Request: libceph auth token overflow / Linux kernel

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> <https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c27a3e4d667fdcad3db7b104f75659478e0c68d8>
> <http://tracker.ceph.com/issues/8979>

Bug 8979 says "about 1 month ago ... pushed wip-8979 which removes the
fixed buffer size. but, we still need to make things not crash when
the auth reply processing fails. that could still happen if we get a
huge ticket (>4k) and kmalloc fails on a large page size. or the auth
reply from the mon is simply not understood by the client."

This apparently has multiple known vulnerability types.

Use CVE-2014-6416 for the buffer overflow.

Use CVE-2014-6417 for the issue of incorrect handling of kmalloc
failures.

Use CVE-2014-6418 for ths missing validation of the auth reply.

Our guess is that c27a3e4d667fdcad3db7b104f75659478e0c68d8 is intended
to address all three of these crash issues, but additional CVE IDs
might be needed if there were an incomplete fix.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJUFx92AAoJEKllVAevmvmspFUH/RHfrkakYAUwmoN3qgGKC1La
KiKgvljZn4WUt7p5pMQyb1FYIjMF7vIEdV2GR5hdG+gec0wVjlyw7SfLPvwXIjO+
KykcaXfHIp4IMJ0/62FFVeZbB6izU4Qgep0a27ynBCg0+vhfIOuiyLfgiVL5IfES
HqUXdUyxvRL+1e+TyMweQQezEDJL5FLc5YUU8kwRhSydDLOdjMjIWY5KvKYp3xyo
ETG6HHwFzQaHu8ty9Hyx3oLDVH113nE5gUbjG4kI5MjaLcCq8zer+cE57YCEnOBu
eOmrs4An/CZhuGho0ThYFr1G4N821af8ycPb1kts5h7u2e4SycFYG0k9N7/UN68=
=XnWo
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.kernel.org_e55aed54_20250124_211306.html ===
commit c13c28207bf7d812d1b310a76013579cdb461b3e
Author: Greg Kroah-Hartman
Date: Wed Sep 17 10:22:16 2014 -0700
Linux 3.16.3
commit a4b9e45fed010808c2b0c38d243a7a2b4adb512b
Author: David Howells
Date: Wed Sep 10 22:22:00 2014 +0100
KEYS: Fix termination condition in assoc array garbage collection
commit 95389b08d93d5c06ec63ab49bd732b0069b7c35e upstream.
This fixes CVE-2014-3631.
It is possible for an associative array to end up with a shortcut node at the
root of the tree if there are more than fan-out leaves in the tree, but they
all crowd into the same slot in the lowest level (ie. they all have the same
first nibble of their index keys).
When assoc\_array\_gc() returns back up the tree after scanning some leaves, it
can fall off of the root and crash because it assumes that the back pointer
from a shortcut (after label ascend\_old\_tree) must point to a normal node -
which isn't true of a shortcut node at the root.
Should we find we're ascending rootwards over a shortcut, we should check to
see if the backpointer is zero - and if it is, we have completed the scan.
This particular bug cannot occur if the root node is not a shortcut - ie. if
you have fewer than 17 keys in a keyring or if you have at least two keys that
sit into separate slots (eg. a keyring and a non keyring).
This can be reproduced by:
ring=`keyctl newring bar @s`
for ((i=1; i<=18; i++)); do last\_key=`keyctl newring foo$i $ring`; done
keyctl timeout $last\_key 2
Doing this:
echo 3 >/proc/sys/kernel/keys/gc\_delay
first will speed things up.
If we do fall off of the top of the tree, we get the following oops:
BUG: unable to handle kernel NULL pointer dereference at 0000000000000018
IP: [] assoc\_array\_gc+0x2f7/0x540
PGD dae15067 PUD cfc24067 PMD 0
Oops: 0000 [#1] SMP
Modules linked in: xt\_nat xt\_mark nf\_conntrack\_netbios\_ns nf\_conntrack\_broadcast ip6t\_rpfilter ip6t\_REJECT xt\_conntrack ebtable\_nat ebtable\_broute bridge stp llc ebtable\_filter ebtables ip6table\_ni
CPU: 0 PID: 26011 Comm: kworker/0:1 Not tainted 3.14.9-200.fc20.x86\_64 #1
Hardware name: Bochs Bochs, BIOS Bochs 01/01/2011
Workqueue: events key\_garbage\_collector
task: ffff8800918bd580 ti: ffff8800aac14000 task.ti: ffff8800aac14000
RIP: 0010:[] [] assoc\_array\_gc+0x2f7/0x540
RSP: 0018:ffff8800aac15d40 EFLAGS: 00010206
RAX: 0000000000000000 RBX: 0000000000000000 RCX: ffff8800aaecacc0
RDX: ffff8800daecf440 RSI: 0000000000000001 RDI: ffff8800aadc2bc0
RBP: ffff8800aac15da8 R08: 0000000000000001 R09: 0000000000000003
R10: ffffffff8136ccc7 R11: 0000000000000000 R12: 0000000000000000
R13: 0000000000000000 R14: 0000000000000070 R15: 0000000000000001
FS: 0000000000000000(0000) GS:ffff88011fc00000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 000000008005003b
CR2: 0000000000000018 CR3: 00000000db10d000 CR4: 00000000000006f0
Stack:
ffff8800aac15d50 0000000000000011 ffff8800aac15db8 ffffffff812e2a70
ffff880091a00600 0000000000000000 ffff8800aadc2bc3 00000000cd42c987
ffff88003702df20 ffff88003702dfa0 0000000053b65c09 ffff8800aac15fd8
Call Trace:
[] ? keyring\_detect\_cycle\_iterator+0x30/0x30
[] keyring\_gc+0x75/0x80
[] key\_garbage\_collector+0x154/0x3c0
[] process\_one\_work+0x176/0x430
[] worker\_thread+0x11b/0x3a0
[] ? rescuer\_thread+0x3b0/0x3b0
[] kthread+0xd8/0xf0
[] ? insert\_kthread\_work+0x40/0x40
[] ret\_from\_fork+0x7c/0xb0
[] ? insert\_kthread\_work+0x40/0x40
Code: 08 4c 8b 22 0f 84 bf 00 00 00 41 83 c7 01 49 83 e4 fc 41 83 ff 0f 4c 89 65 c0 0f 8f 5a fe ff ff 48 8b 45 c0 4d 63 cf 49 83 c1 02 <4e> 8b 34 c8 4d 85 f6 0f 84 be 00 00 00 41 f6 c6 01 0f 84 92
RIP [] assoc\_array\_gc+0x2f7/0x540
RSP
CR2: 0000000000000018
---[ end trace 1129028a088c0cbd ]---
Signed-off-by: David Howells
Acked-by: Don Zickus
Signed-off-by: James Morris
Signed-off-by: Greg Kroah-Hartman
commit b3c24771aaaa566ba977d67ea22d9758b31efe13
Author: David Howells
Date: Tue Sep 2 13:52:20 2014 +0100
KEYS: Fix use-after-free in assoc\_array\_gc()
commit 27419604f51a97d497853f14142c1059d46eb597 upstream.
An edit script should be considered inaccessible by a function once it has
called assoc\_array\_apply\_edit() or assoc\_array\_cancel\_edit().
However, assoc\_array\_gc() is accessing the edit script just after the
gc\_complete: label.
Reported-by: Andreea-Cristina Bernat
Signed-off-by: David Howells
Reviewed-by: Andreea-Cristina Bernat
cc: shemming@brocade.com
cc: paulmck@linux.vnet.ibm.com
Signed-off-by: James Morris
Signed-off-by: Greg Kroah-Hartman
commit c857808daf9f819010731b0e5669d315a623d41f
Author: Pavel Shilovsky
Date: Mon Aug 18 20:49:57 2014 +0400
CIFS: Fix SMB2 readdir error handling
commit 52755808d4525f4d5b86d112d36ffc7a46f3fb48 upstream.
SMB2 servers indicates the end of a directory search with
STATUS\_NO\_MORE\_FILE error code that is not processed now.
This causes generic/257 xfstest to fail. Fix this by triggering
the end of search by this error code in SMB2\_query\_directory.
Also when negotiating CIFS protocol we tell the server to close
the search automatically at the end and there is no need to do
it itself. In the case of SMB2 protocol, we need to close it
explicitly - separate close directory checks for different
protocols.
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit b5cf3193759f7cd1cfbeef11f5cf067bbce22e55
Author: Linus Torvalds
Date: Sat Sep 13 11:30:10 2014 -0700
vfs: fix bad hashing of dentries
commit 99d263d4c5b2f541dfacb5391e22e8c91ea982a6 upstream.
Josef Bacik found a performance regression between 3.2 and 3.10 and
narrowed it down to commit bfcfaa77bdf0 ("vfs: use 'unsigned long'
accesses for dcache name comparison and hashing"). He reports:
"The test case is essentially
for (i = 0; i < 1000000; i++)
mkdir("a$i");
On xfs on a fio card this goes at about 20k dir/sec with 3.2, and 12k
dir/sec with 3.10. This is because we spend waaaaay more time in
\_\_d\_lookup on 3.10 than in 3.2.
The new hashing function for strings is suboptimal for <
sizeof(unsigned long) string names (and hell even > sizeof(unsigned
long) string names that I've tested). I broke out the old hashing
function and the new one into a userspace helper to get real numbers
and this is what I'm getting:
Old hash table had 1000000 entries, 0 dupes, 0 max dupes
New hash table had 12628 entries, 987372 dupes, 900 max dupes
We had 11400 buckets with a p50 of 30 dupes, p90 of 240 dupes, p99 of 567 dupes for the new hash
My test does the hash, and then does the d\_hash into a integer pointer
array the same size as the dentry hash table on my system, and then
just increments the value at the address we got to see how many
entries we overlap with.
As you can see the old hash function ended up with all 1 million
entries in their own bucket, whereas the new one they are only
distributed among ~12.5k buckets, which is why we're using so much
more CPU in \_\_d\_lookup".
The reason for this hash regression is two-fold:
- On 64-bit architectures the down-mixing of the original 64-bit
word-at-a-time hash into the final 32-bit hash value is very
simplistic and suboptimal, and just adds the two 32-bit parts
together.
In particular, because there is no bit shuffling and the mixing
boundary is also a byte boundary, similar character patterns in the
low and high word easily end up just canceling each other out.
- the old byte-at-a-time hash mixed each byte into the final hash as it
hashed the path component name, resulting in the low bits of the hash
generally being a good source of hash data. That is not true for the
word-at-a-time case, and the hash data is distributed among all the
bits.
The fix is the same in both cases: do a better job of mixing the bits up
and using as much of the hash data as possible. We already have the
"hash\_32|64()" functions to do that.
Reported-by: Josef Bacik
Cc: Al Viro
Cc: Christoph Hellwig
Cc: Chris Mason
Cc: linux-fsdevel@vger.kernel.org
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit b80e628657c501dade91cebbf0ce0466702e3b70
Author: Mario Kleiner
Date: Wed Aug 6 06:09:44 2014 +0200
drm/nouveau: Bump version from 1.1.1 to 1.1.2
commit 7820e5eef0faa4a5e10834296680827f7ce78a89 upstream.
Linux 3.16 fixed multiple bugs in kms pageflip completion events
and timestamping, which were originally introduced in Linux 3.13.
These fixes have been backported to all stable kernels since 3.13.
However, the userspace nouveau-ddx needs to be aware if it is
running on a kernel on which these bugs are fixed, or not.
Bump the patchlevel of the drm driver version to signal this,
so backporting this patch to stable 3.13+ kernels will give the
ddx the required info.
Signed-off-by: Mario Kleiner
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit a82fd71283780f4026125f647f1b1d39ebfcb7c2
Author: Mario Kleiner
Date: Tue Jul 29 02:36:44 2014 +0200
drm/nouveau: Dis/Enable vblank irqs during suspend/resume.
commit 9cba5efab5a8145ae6c52ea273553f069c294482 upstream.
Vblank irqs don't get disabled during suspend or driver
unload, which causes irq delivery after "suspend" or
driver unload, at least until the gpu is powered off.
This could race with drm\_vblank\_cleanup() in the case
of nouveau and cause a use-after-free bug if the driver
is unloaded.
More annoyingly during everyday use, at least on nv50
display engine (likely also others), vblank irqs are
off after a resume from suspend, but the drm doesn't
know this, so all vblank related functionality is dead
after a resume. E.g., all windowed OpenGL clients will
hang at swapbuffers time, as well as many fullscreen
clients in many cases. This makes suspend/resume useless
if one wants to use any OpenGL apps after the resume.
In Linux 3.16, drm\_vblank\_on() was added, complementing
the older drm\_vblank\_off() to solve these problems
elegantly, so use those calls in nouveaus suspend/resume
code.
For kernels 3.8 - 3.15, we need to cherry-pick the
drm\_vblank\_on() patch to support this patch.
Signed-off-by: Mario Kleiner
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 1b29db8c29dea208525a527a07ccc0ee23b65059
Author: Bart Van Assche
Date: Wed Jul 9 15:57:26 2014 +0200
IB/srp: Fix deadlock between host removal and multipathd
commit bcc05910359183b431da92713e98eed478edf83a upstream.
If scsi\_remove\_host() is invoked after a SCSI device has been blocked,
if the fast\_io\_fail\_tmo or dev\_loss\_tmo work gets scheduled on the
workqueue executing srp\_remove\_work() and if an I/O request is
scheduled after the SCSI device had been blocked by e.g. multipathd
then the following deadlock can occur:
kworker/6:1 D ffff880831f3c460 0 195 2 0x00000000
Call Trace:
[] schedule+0x29/0x70
[] schedule\_timeout+0x10f/0x2a0
[] msleep+0x2f/0x40
[] \_\_blk\_drain\_queue+0x4e/0x180
[] blk\_cleanup\_queue+0x225/0x230
[] \_\_scsi\_remove\_device+0x62/0xe0 [scsi\_mod]
[] scsi\_forget\_host+0x6f/0x80 [scsi\_mod]
[] scsi\_remove\_host+0x7a/0x130 [scsi\_mod]
[] srp\_remove\_work+0x95/0x180 [ib\_srp]
[] process\_one\_work+0x1ea/0x6c0
[] worker\_thread+0x11b/0x3a0
[] kthread+0xed/0x110
[] ret\_from\_fork+0x7c/0xb0
multipathd D ffff880096acc460 0 5340 1 0x00000000
Call Trace:
[] schedule+0x29/0x70
[] schedule\_timeout+0x10f/0x2a0
[] io\_schedule\_timeout+0x9b/0xf0
[] wait\_for\_completion\_io\_timeout+0xdc/0x110
[] blk\_execute\_rq+0x9b/0x100
[] sg\_io+0x1a5/0x450
[] scsi\_cmd\_ioctl+0x2a1/0x430
[] scsi\_cmd\_blk\_ioctl+0x42/0x50
[] sd\_ioctl+0xbe/0x140 [sd\_mod]
[] blkdev\_ioctl+0x234/0x840
[] block\_ioctl+0x41/0x50
[] do\_vfs\_ioctl+0x300/0x520
[] SyS\_ioctl+0x41/0x80
[] tracesys+0xd0/0xd5
Fix this by scheduling removal work on another workqueue than the
transport layer timers.
Signed-off-by: Bart Van Assche
Reviewed-by: Sagi Grimberg
Reviewed-by: David Dillow
Cc: Sebastian Parschauer
Signed-off-by: Roland Dreier
Signed-off-by: Greg Kroah-Hartman
commit 05a095332f281c23f102b567c9c8483565a0e7b0
Author: Jeff Moyer
Date: Fri Aug 8 11:03:41 2014 -0400
dm table: propagate QUEUE\_FLAG\_NO\_SG\_MERGE
commit 200612ec33e555a356eebc717630b866ae2b694f upstream.
Commit 05f1dd5 ("block: add queue flag for disabling SG merging")
introduced a new queue flag: QUEUE\_FLAG\_NO\_SG\_MERGE. This gets set by
default in blk\_mq\_init\_queue for mq-enabled devices. The effect of
the flag is to bypass the SG segment merging. Instead, the
bio->bi\_vcnt is used as the number of hardware segments.
With a device mapper target on top of a device with
QUEUE\_FLAG\_NO\_SG\_MERGE set, we can end up sending down more segments
than a driver is prepared to handle. I ran into this when backporting
the virtio\_blk mq support. It triggerred this BUG\_ON, in
virtio\_queue\_rq:
BUG\_ON(req->nr\_phys\_segments + 2 > vblk->sg\_elems);
The queue's max is set here:
blk\_queue\_max\_segments(q, vblk->sg\_elems-2);
Basically, what happens is that a bio is built up for the dm device
(which does not have the QUEUE\_FLAG\_NO\_SG\_MERGE flag set) using
bio\_add\_page. That path will call into \_\_blk\_recalc\_rq\_segments, so
what you end up with is bi\_phys\_segments being much smaller than bi\_vcnt
(and bi\_vcnt grows beyond the maximum sg elements). Then, when the bio
is submitted, it gets cloned. When the cloned bio is submitted, it will
end up in blk\_recount\_segments, here:
if (test\_bit(QUEUE\_FLAG\_NO\_SG\_MERGE, &q->queue\_flags))
bio->bi\_phys\_segments = bio->bi\_vcnt;
and now we've set bio->bi\_phys\_segments to a number that is beyond what
was registered as queue\_max\_segments by the driver.
The right way to fix this is to propagate the queue flag up the stack.
The rules for propagating the flag are simple:
- if the flag is set for any underlying device, it must be set for the
upper device
- consequently, if the flag is not set for any underlying device, it
should not be set for the upper device.
Signed-off-by: Jeff Moyer
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 20c0fb35f167f18454c522a3c877da0247a3b0e0
Author: Roger Quadros
Date: Mon Aug 25 16:15:33 2014 -0700
mtd: nand: omap: Fix 1-bit Hamming code scheme, omap\_calculate\_ecc()
commit 40ddbf5069bd4e11447c0088fc75318e0aac53f0 upstream.
commit 65b97cf6b8de introduced in v3.7 caused a regression
by using a reversed CS\_MASK thus causing omap\_calculate\_ecc to
always fail. As the NAND base driver never checks for .calculate()'s
return value, the zeroed ECC values are used as is without showing
any error to the user. However, this won't work and the NAND device
won't be guarded by any error code.
Fix the issue by using the correct mask.
Code was tested on omap3beagle using the following procedure
- flash the primary bootloader (MLO) from the kernel to the first
NAND partition using nandwrite.
- boot the board from NAND. This utilizes OMAP ROM loader that
relies on 1-bit Hamming code ECC.
Fixes: 65b97cf6b8de (mtd: nand: omap2: handle nand on gpmc)
Signed-off-by: Roger Quadros
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman
commit 711f8bcf1dd5608d2a841f7e1bb471090e53514f
Author: Kevin Hao
Date: Thu Jul 3 10:35:26 2014 +0800
mtd/ftl: fix the double free of the buffers allocated in build\_maps()
commit a152056c912db82860a8b4c23d0bd3a5aa89e363 upstream.
I got the following panic on my fsl p5020ds board.
Unable to handle kernel paging request for data at address 0x7375627379737465
Faulting instruction address: 0xc000000000100778
Oops: Kernel access of bad area, sig: 11 [#1]
SMP NR\_CPUS=24 CoreNet Generic
Modules linked in:
CPU: 0 PID: 1 Comm: swapper/0 Not tainted 3.15.0-next-20140613 #145
task: c0000000fe080000 ti: c0000000fe088000 task.ti: c0000000fe088000
NIP: c000000000100778 LR: c00000000010073c CTR: 0000000000000000
REGS: c0000000fe08aa00 TRAP: 0300 Not tainted (3.15.0-next-20140613)
MSR: 0000000080029000  CR: 24ad2e24 XER: 00000000
DEAR: 7375627379737465 ESR: 0000000000000000 SOFTE: 1
GPR00: c0000000000c99b0 c0000000fe08ac80 c0000000009598e0 c0000000fe001d80
GPR04: 00000000000000d0 0000000000000913 c000000007902b20 0000000000000000
GPR08: c0000000feaae888 0000000000000000 0000000007091000 0000000000200200
GPR12: 0000000028ad2e28 c00000000fff4000 c0000000007abe08 0000000000000000
GPR16: c0000000007ab160 c0000000007aaf98 c00000000060ba68 c0000000007abda8
GPR20: c0000000007abde8 c0000000feaea6f8 c0000000feaea708 c0000000007abd10
GPR24: c000000000989370 c0000000008c6228 00000000000041ed c0000000fe00a400
GPR28: c00000000017c1cc 00000000000000d0 7375627379737465 c0000000fe001d80
NIP [c000000000100778] .\_\_kmalloc\_track\_caller+0x70/0x168
LR [c00000000010073c] .\_\_kmalloc\_track\_caller+0x34/0x168
Call Trace:
[c0000000fe08ac80] [c00000000087e6b8] uevent\_sock\_list+0x0/0x10 (unreliable)
[c0000000fe08ad20] [c0000000000c99b0] .kstrdup+0x44/0x90
[c0000000fe08adc0] [c00000000017c1cc] .\_\_kernfs\_new\_node+0x4c/0x130
[c0000000fe08ae70] [c00000000017d7e4] .kernfs\_new\_node+0x2c/0x64
[c0000000fe08aef0] [c00000000017db00] .kernfs\_create\_dir\_ns+0x34/0xc8
[c0000000fe08af80] [c00000000018067c] .sysfs\_create\_dir\_ns+0x58/0xcc
[c0000000fe08b010] [c0000000002c711c] .kobject\_add\_internal+0xc8/0x384
[c0000000fe08b0b0] [c0000000002c7644] .kobject\_add+0x64/0xc8
[c0000000fe08b140] [c000000000355ebc] .device\_add+0x11c/0x654
[c0000000fe08b200] [c0000000002b5988] .add\_disk+0x20c/0x4b4
[c0000000fe08b2c0] [c0000000003a21d4] .add\_mtd\_blktrans\_dev+0x340/0x514
[c0000000fe08b350] [c0000000003a3410] .mtdblock\_add\_mtd+0x74/0xb4
[c0000000fe08b3e0] [c0000000003a32cc] .blktrans\_notify\_add+0x64/0x94
[c0000000fe08b470] [c00000000039b5b4] .add\_mtd\_device+0x1d4/0x368
[c0000000fe08b520] [c00000000039b830] .mtd\_device\_parse\_register+0xe8/0x104
[c0000000fe08b5c0] [c0000000003b8408] .of\_flash\_probe+0x72c/0x734
[c0000000fe08b750] [c00000000035ba40] .platform\_drv\_probe+0x38/0x84
[c0000000fe08b7d0] [c0000000003599a4] .really\_probe+0xa4/0x29c
[c0000000fe08b870] [c000000000359d3c] .\_\_driver\_attach+0x100/0x104
[c0000000fe08b900] [c00000000035746c] .bus\_for\_each\_dev+0x84/0xe4
[c0000000fe08b9a0] [c0000000003593c0] .driver\_attach+0x24/0x38
[c0000000fe08ba10] [c000000000358f24] .bus\_add\_driver+0x1c8/0x2ac
[c0000000fe08bab0] [c00000000035a3a4] .driver\_register+0x8c/0x158
[c0000000fe08bb30] [c00000000035b9f4] .\_\_platform\_driver\_register+0x6c/0x80
[c0000000fe08bba0] [c00000000084e080] .of\_flash\_driver\_init+0x1c/0x30
[c0000000fe08bc10] [c000000000001864] .do\_one\_initcall+0xbc/0x238
[c0000000fe08bd00] [c00000000082cdc0] .kernel\_init\_freeable+0x188/0x268
[c0000000fe08bdb0] [c0000000000020a0] .kernel\_init+0x1c/0xf7c
[c0000000fe08be30] [c000000000000884] .ret\_from\_kernel\_thread+0x58/0xd4
Instruction dump:
41bd0010 480000c8 4bf04eb5 60000000 e94d0028 e93f0000 7cc95214 e8a60008
7fc9502a 2fbe0000 419e00c8 e93f0022 <7f7e482a> 39200000 88ed06b2 992d06b2
---[ end trace b4c9a94804a42d40 ]---
It seems that the corrupted partition header on my mtd device triggers
a bug in the ftl. In function build\_maps() it will allocate the buffers
needed by the mtd partition, but if something goes wrong such as kmalloc
failure, mtd read error or invalid partition header parameter, it will
free all allocated buffers and then return non-zero. In my case, it
seems that partition header parameter 'NumTransferUnits' is invalid.
And the ftl\_freepart() is a function which free all the partition
buffers allocated by build\_maps(). Given the build\_maps() is a self
cleaning function, so there is no need to invoke this function even
if build\_maps() return with error. Otherwise it will causes the
buffers to be freed twice and then weird things would happen.
Signed-off-by: Kevin Hao
Signed-off-by: Brian Norris
Signed-off-by: Greg Kroah-Hartman
commit f586b7680fe5aab76f5f329e50d705fc9ab5d78e
Author: Pavel Shilovsky
Date: Tue Aug 26 19:04:44 2014 +0400
CIFS: Fix wrong restart readdir for SMB1
commit f736906a7669a77cf8cabdcbcf1dc8cb694e12ef upstream.
The existing code calls server->ops->close() that is not
right. This causes XFS test generic/310 to fail. Fix this
by using server->ops->closedir() function.
Signed-off-by: Dan Carpenter
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit be462337ae21b729730565921d13738699e32604
Author: Pavel Shilovsky
Date: Fri Aug 22 13:32:11 2014 +0400
CIFS: Fix wrong filename length for SMB2
commit 1bbe4997b13de903c421c1cc78440e544b5f9064 upstream.
The existing code uses the old MAX\_NAME constant. This causes
XFS test generic/013 to fail. Fix it by replacing MAX\_NAME with
PATH\_MAX that SMB1 uses. Also remove an unused MAX\_NAME constant
definition.
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit cb22458c2d73da305ab4374cc83ae6edec2f259c
Author: Pavel Shilovsky
Date: Fri Aug 22 13:32:09 2014 +0400
CIFS: Fix directory rename error
commit a07d322059db66b84c9eb4f98959df468e88b34b upstream.
CIFS servers process nlink counts differently for files and directories.
In cifs\_rename() if we the request fails on the existing target, we
try to remove it through cifs\_unlink() but this is not what we want
to do for directories. As the result the following sequence of commands
mkdir {1,2}; mv -T 1 2; rmdir {1,2}; mkdir {1,2}; echo foo > 2/bar
and XFS test generic/023 fail with -ENOENT error. That's why the second
mkdir reuses the existing inode (target inode of the mv -T command) with
S\_DEAD flag.
Fix this by checking whether the target is directory or not and
calling cifs\_rmdir() rather than cifs\_unlink() for directories.
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 7454dc809fceb8be5844c0a4d783a832ddb7c083
Author: Pavel Shilovsky
Date: Mon Aug 18 20:49:58 2014 +0400
CIFS: Fix wrong directory attributes after rename
commit b46799a8f28c43c5264ac8d8ffa28b311b557e03 upstream.
When we requests rename we also need to update attributes
of both source and target parent directories. Not doing it
causes generic/309 xfstest to fail on SMB2 mounts. Fix this
by marking these directories for force revalidating.
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit fa7007a59216399b8873f53b5b20e83b698def70
Author: Steve French
Date: Sun Aug 17 00:22:24 2014 -0500
CIFS: Possible null ptr deref in SMB2\_tcon
commit 18f39e7be0121317550d03e267e3ebd4dbfbb3ce upstream.
As Raphael Geissert pointed out, tcon\_error\_exit can dereference tcon
and there is one path in which tcon can be null.
Signed-off-by: Steve French
Reported-by: Raphael Geissert
Signed-off-by: Greg Kroah-Hartman
commit 09f07a1461fcd0f5e4c613c45b37daeb8a030f6c
Author: Pavel Shilovsky
Date: Fri Jun 27 10:33:11 2014 +0400
CIFS: Fix async reading on reconnects
commit 038bc961c31b070269ecd07349a7ee2e839d4fec upstream.
If we get into read\_into\_pages() from cifs\_readv\_receive() and then
loose a network, we issue cifs\_reconnect that moves all mids to
a private list and issue their callbacks. The callback of the async
read request sets a mid to retry, frees it and wakes up a process
that waits on the rdata completion.
After the connection is established we return from read\_into\_pages()
with a short read, use the mid that was freed before and try to read
the remaining data from the a newly created socket. Both actions are
not what we want to do. In reconnect cases (-EAGAIN) we should not
mask off the error with a short read but should return the error
code instead.
Acked-by: Jeff Layton
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit fd6cb8b1ac405cf412e6168d0b501919401ccd23
Author: Pavel Shilovsky
Date: Fri Jul 18 18:25:52 2014 +0400
CIFS: Fix STATUS\_CANNOT\_DELETE error mapping for SMB2
commit 21496687a79424572f46a84c690d331055f4866f upstream.
The existing mapping causes unlink() call to return error after delete
operation. Changing the mapping to -EACCES makes the client process
the call like CIFS protocol does - reset dos attributes with ATTR\_READONLY
flag masked off and retry the operation.
Signed-off-by: Pavel Shilovsky
Signed-off-by: Steve French
Signed-off-by: Greg Kroah-Hartman
commit 346acdffbb4a12f7f77a3fb0f6453a2bc1454b4f
Author: Ilya Dryomov
Date: Tue Sep 9 19:39:15 2014 +0400
libceph: do not hard code max auth ticket len
commit c27a3e4d667fdcad3db7b104f75659478e0c68d8 upstream.
We hard code cephx auth ticket buffer size to 256 bytes. This isn't
enough for any moderate setups and, in case tickets themselves are not
encrypted, leads to buffer overflows (ceph\_x\_decrypt() errors out, but
ceph\_decode\_copy() doesn't - it's just a memcpy() wrapper). Since the
buffer is allocated dynamically anyway, allocated it a bit later, at
the point where we know how much is going to be needed.
Fixes: http://tracker.ceph.com/issues/8979
Signed-off-by: Ilya Dryomov
Reviewed-by: Sage Weil
Signed-off-by: Greg Kroah-Hartman
commit fc65783a2268229666c4e338389d01a597f35a29
Author: Ilya Dryomov
Date: Mon Sep 8 17:25:34 2014 +0400
libceph: add process\_one\_ticket() helper
commit 597cda357716a3cf8d994cb11927af917c8d71fa upstream.
Add a helper for processing individual cephx auth tickets. Needed for
the next commit, which deals with allocating ticket buffers. (Most of
the diff here is whitespace - view with git diff -b).
Signed-off-by: Ilya Dryomov
Reviewed-by: Sage Weil
Signed-off-by: Greg Kroah-Hartman
commit 7fa66ee488f03d1aaaff823c260b86327eec4452
Author: Sage Weil
Date: Mon Aug 4 07:01:54 2014 -0700
libceph: gracefully handle large reply messages from the mon
commit 73c3d4812b4c755efeca0140f606f83772a39ce4 upstream.
We preallocate a few of the message types we get back from the mon. If we
get a larger message than we are expecting, fall back to trying to allocate
a new one instead of blindly using the one we have.
Signed-off-by: Sage Weil
Reviewed-by: Ilya Dryomov
Signed-off-by: Greg Kroah-Hartman
commit b704f8b1ea48ca150f42847574706605e952facc
Author: Ilya Dryomov
Date: Fri Aug 8 12:43:39 2014 +0400
libceph: set last\_piece in ceph\_msg\_data\_pages\_cursor\_init() correctly
commit 5f740d7e1531099b888410e6bab13f68da9b1a4d upstream.
Determining ->last\_piece based on the value of ->page\_offset + length
is incorrect because length here is the length of the entire message.
->last\_piece set to false even if page array data item length is <=
PAGE\_SIZE, which results in invalid length passed to
ceph\_tcp\_{send,recv}page() and causes various asserts to fire.
# cat pages-cursor-init.sh
#!/bin/bash
rbd create --size 10 --image-format 2 foo
FOO\_DEV=$(rbd map foo)
dd if=/dev/urandom of=$FOO\_DEV bs=1M &>/dev/null
rbd snap create foo@snap
rbd snap protect foo@snap
rbd clone foo@snap bar
# rbd\_resize calls librbd rbd\_resize(), size is in bytes
./rbd\_resize bar $(((4 << 20) + 512))
rbd resize --size 10 bar
BAR\_DEV=$(rbd map bar)
# trigger a 512-byte copyup -- 512-byte page array data item
dd if=/dev/urandom of=$BAR\_DEV bs=1M count=1 seek=5
The problem exists only in ceph\_msg\_data\_pages\_cursor\_init(),
ceph\_msg\_data\_pages\_advance() does the right thing. The size\_t cast is
unnecessary.
Signed-off-by: Ilya Dryomov
Reviewed-by: Sage Weil
Reviewed-by: Alex Elder
Signed-off-by: Greg Kroah-Hartman
commit 2f3219f6e413ee5f9690876f3e8fa9bb0213d9ad
Author: Chris Mason
Date: Tue Sep 2 12:12:52 2014 +1000
xfs: don't zero partial page cache pages during O\_DIRECT writes
commit 85e584da3212140ee80fd047f9058bbee0bc00d5 upstream.
xfs is using truncate\_pagecache\_range to invalidate the page cache
during DIO reads. This is different from the other filesystems who
only invalidate pages during DIO writes.
truncate\_pagecache\_range is meant to be used when we are freeing the
underlying data structs from disk, so it will zero any partial
ranges in the page. This means a DIO read can zero out part of the
page cache page, and it is possible the page will stay in cache.
buffered reads will find an up to date page with zeros instead of
the data actually on disk.
This patch fixes things by using invalidate\_inode\_pages2\_range
instead. It preserves the page cache invalidation, but won't zero
any pages.
[dchinner: catch error and warn if it fails. Comment.]
Signed-off-by: Chris Mason
Reviewed-by: Dave Chinner
Reviewed-by: Brian Foster
Reviewed-by: Christoph Hellwig
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit d2f8462e2213eb237eca50b5c12bc75037f06b87
Author: Dave Chinner
Date: Tue Sep 2 12:12:52 2014 +1000
xfs: don't zero partial page cache pages during O\_DIRECT writes
commit 834ffca6f7e345a79f6f2e2d131b0dfba8a4b67a upstream.
Similar to direct IO reads, direct IO writes are using
truncate\_pagecache\_range to invalidate the page cache. This is
incorrect due to the sub-block zeroing in the page cache that
truncate\_pagecache\_range() triggers.
This patch fixes things by using invalidate\_inode\_pages2\_range
instead. It preserves the page cache invalidation, but won't zero
any pages.
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Reviewed-by: Christoph Hellwig
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 4fa1c311190415539cb9d95027f8100724f13dfc
Author: Dave Chinner
Date: Tue Sep 2 12:12:51 2014 +1000
xfs: don't dirty buffers beyond EOF
commit 22e757a49cf010703fcb9c9b4ef793248c39b0c2 upstream.
generic/263 is failing fsx at this point with a page spanning
EOF that cannot be invalidated. The operations are:
1190 mapwrite 0x52c00 thru 0x5e569 (0xb96a bytes)
1191 mapread 0x5c000 thru 0x5d636 (0x1637 bytes)
1192 write 0x5b600 thru 0x771ff (0x1bc00 bytes)
where 1190 extents EOF from 0x54000 to 0x5e569. When the direct IO
write attempts to invalidate the cached page over this range, it
fails with -EBUSY and so any attempt to do page invalidation fails.
The real question is this: Why can't that page be invalidated after
it has been written to disk and cleaned?
Well, there's data on the first two buffers in the page (1k block
size, 4k page), but the third buffer on the page (i.e. beyond EOF)
is failing drop\_buffers because it's bh->b\_state == 0x3, which is
BH\_Uptodate | BH\_Dirty. IOWs, there's dirty buffers beyond EOF. Say
what?
OK, set\_buffer\_dirty() is called on all buffers from
\_\_set\_page\_buffers\_dirty(), regardless of whether the buffer is
beyond EOF or not, which means that when we get to ->writepage,
we have buffers marked dirty beyond EOF that we need to clean.
So, we need to implement our own .set\_page\_dirty method that
doesn't dirty buffers beyond EOF.
This is messy because the buffer code is not meant to be shared
and it has interesting locking issues on the buffer dirty bits.
So just copy and paste it and then modify it to suit what we need.
Note: the solutions the other filesystems and generic block code use
of marking the buffers clean in ->writepage does not work for XFS.
It still leaves dirty buffers beyond EOF and invalidations still
fail. Hence rather than play whack-a-mole, this patch simply
prevents those buffers from being dirtied in the first place.
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 4dbaf782aea389dbdfc645902dfb1cee6d6c42d7
Author: Dave Chinner
Date: Mon Aug 4 12:43:26 2014 +1000
xfs: quotacheck leaves dquot buffers without verifiers
commit 5fd364fee81a7888af806e42ed8a91c845894f2d upstream.
When running xfs/305, I noticed that quotacheck was flushing dquot
buffers that did not have the xfs\_dquot\_buf\_ops verifiers attached:
XFS (vdb): \_xfs\_buf\_ioapply: no ops on block 0x1dc8/0x1dc8
ffff880052489000: 44 51 01 04 00 00 65 b8 00 00 00 00 00 00 00 00 DQ....e.........
ffff880052489010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
ffff880052489020: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
ffff880052489030: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 ................
CPU: 1 PID: 2376 Comm: mount Not tainted 3.16.0-rc2-dgc+ #306
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS Bochs 01/01/2011
ffff88006fe38000 ffff88004a0ffae8 ffffffff81cf1cca 0000000000000001
ffff88004a0ffb88 ffffffff814d50ca 000010004a0ffc70 0000000000000000
ffff88006be56dc4 0000000000000021 0000000000001dc8 ffff88007c773d80
Call Trace:
[] dump\_stack+0x45/0x56
[] \_xfs\_buf\_ioapply+0x3ca/0x3d0
[] ? wake\_up\_state+0x20/0x20
[] ? xfs\_bdstrat\_cb+0x55/0xb0
[] xfs\_buf\_iorequest+0x6b/0xd0
[] xfs\_bdstrat\_cb+0x55/0xb0
[] \_\_xfs\_buf\_delwri\_submit+0x15b/0x220
[] ? xfs\_buf\_delwri\_submit+0x30/0x90
[] xfs\_buf\_delwri\_submit+0x30/0x90
[] xfs\_qm\_quotacheck+0x17d/0x3c0
[] xfs\_qm\_mount\_quotas+0x151/0x1e0
[] xfs\_mountfs+0x56c/0x7d0
[] xfs\_fs\_fill\_super+0x2c2/0x340
[] mount\_bdev+0x194/0x1d0
[] ? xfs\_finish\_flags+0x170/0x170
[] xfs\_fs\_mount+0x15/0x20
[] mount\_fs+0x39/0x1b0
[] vfs\_kern\_mount+0x67/0x120
[] do\_mount+0x23e/0xad0
[] ? \_\_get\_free\_pages+0xe/0x50
[] ? copy\_mount\_options+0x36/0x150
[] SyS\_mount+0x83/0xc0
[] tracesys+0xdd/0xe2
This was caused by dquot buffer readahead not attaching a verifier
structure to the buffer when readahead was issued, resulting in the
followup read of the buffer finding a valid buffer and so not
attaching new verifiers to the buffer as part of the read.
Also, when a verifier failure occurs, we then read the buffer
without verifiers. Attach the verifiers manually after this read so
that if the buffer is then written it will be verified that the
corruption has been repaired.
Further, when flushing a dquot we don't ask for a verifier when
reading in the dquot buffer the dquot belongs to. Most of the time
this isn't an issue because the buffer is still cached, but when it
is not cached it will result in writing the dquot buffer without
having the verfier attached.
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Reviewed-by: Christoph Hellwig
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 13c22aa34be6c1634e157cfbcf76d0cba54e585b
Author: Dave Chinner
Date: Mon Aug 4 12:43:06 2014 +1000
xfs: ensure verifiers are attached to recovered buffers
commit 67dc288c21064b31a98a53dc64f6b9714b819fd6 upstream.
Crash testing of CRC enabled filesystems has resulted in a number of
reports of bad CRCs being detected after the filesystem was mounted.
Errors such as the following were being seen:
XFS (sdb3): Mounting V5 Filesystem
XFS (sdb3): Starting recovery (logdev: internal)
XFS (sdb3): Metadata CRC error detected at xfs\_agf\_read\_verify+0x5a/0x100 [xfs], block 0x1
XFS (sdb3): Unmount and run xfs\_repair
XFS (sdb3): First 64 bytes of corrupted metadata buffer:
ffff880136ffd600: 58 41 47 46 00 00 00 01 00 00 00 00 00 0f aa 40 XAGF...........@
ffff880136ffd610: 00 02 6d 53 00 02 77 f8 00 00 00 00 00 00 00 01 ..mS..w.........
ffff880136ffd620: 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 03 ................
ffff880136ffd630: 00 00 00 04 00 08 81 d0 00 08 81 a7 00 00 00 00 ................
XFS (sdb3): metadata I/O error: block 0x1 ("xfs\_trans\_read\_buf\_map") error 74 numblks 1
The errors were typically being seen in AGF, AGI and their related
btree block buffers some time after log recovery had run. Often it
wasn't until later subsequent mounts that the problem was
discovered. The common symptom was a buffer with the correct
contents, but a CRC and an LSN that matched an older version of the
contents.
Some debug added to \_xfs\_buf\_ioapply() indicated that buffers were
being written without verifiers attached to them from log recovery,
and Jan Kara isolated the cause to log recovery readahead an dit's
interactions with buffers that had a more recent LSN on disk than
the transaction being recovered. In this case, the buffer did not
get a verifier attached, and os when the second phase of log
recovery ran and recovered EFIs and unlinked inodes, the buffers
were modified and written without the verifier running. Hence they
had up to date contents, but stale LSNs and CRCs.
Fix it by attaching verifiers to buffers we skip due to future LSN
values so they don't escape into the buffer cache without the
correct verifier attached.
This patch is based on analysis and a patch from Jan Kara.
Reported-by: Jan Kara
Reported-by: Fanael Linithien
Reported-by: Grozdan
Signed-off-by: Dave Chinner
Reviewed-by: Brian Foster
Reviewed-by: Christoph Hellwig
Signed-off-by: Dave Chinner
Signed-off-by: Greg Kroah-Hartman
commit 5126045da70818e576a7e6c8d61667f0257df17b
Author: Doug Ledford
Date: Tue Aug 12 19:20:11 2014 -0400
RDMA/uapi: Include socket.h in rdma\_user\_cm.h
commit db1044d458a287c18c4d413adc4ad12e92e253b5 upstream.
added struct sockaddr\_storage to rdma\_user\_cm.h without also adding an
include for linux/socket.h to make sure it is defined. Systemtap
needs the header files to build standalone and cannot rely on other
files to pre-include other headers, so add linux/socket.h to the list
of includes in this file.
Fixes: ee7aed4528f ("RDMA/ucma: Support querying for AF\_IB addresses")
Signed-off-by: Doug Ledford
Signed-off-by: Roland Dreier
Signed-off-by: Greg Kroah-Hartman
commit c06a9fa58039bc8fb3231ffc425ee91f38547cc4
Author: Steve Wise
Date: Fri Jul 25 09:11:33 2014 -0500
RDMA/iwcm: Use a default listen backlog if needed
commit 2f0304d21867476394cd51a54e97f7273d112261 upstream.
If the user creates a listening cm\_id with backlog of 0 the IWCM ends
up not allowing any connection requests at all. The correct behavior
is for the IWCM to pick a default value if the user backlog parameter
is zero.
Lustre from version 1.8.8 onward uses a backlog of 0, which breaks
iwarp support without this fix.
Signed-off-by: Steve Wise
Signed-off-by: Roland Dreier
Signed-off-by: Greg Kroah-Hartman
commit ad70570f0421b69add346133c81755dde0f9ef17
Author: NeilBrown
Date: Mon Aug 18 13:59:50 2014 +1000
md/raid10: Fix memory leak when raid10 reshape completes.
commit b39685526f46976bcd13aa08c82480092befa46c upstream.
When a raid10 commences a resync/recovery/reshape it allocates
some buffer space.
When a resync/recovery completes the buffer space is freed. But not
when the reshape completes.
This can result in a small memory leak.
There is a subtle side-effect of this bug. When a RAID10 is reshaped
to a larger array (more devices), the reshape is immediately followed
by a "resync" of the new space. This "resync" will use the buffer
space which was allocated for "reshape". This can cause problems
including a "BUG" in the SCSI layer. So this is suitable for -stable.
Fixes: 3ea7daa5d7fde47cd41f4d56c2deb949114da9d6
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit 62906bc65363e2af506798269d18754f499365ef
Author: NeilBrown
Date: Mon Aug 18 13:56:38 2014 +1000
md/raid10: fix memory leak when reshaping a RAID10.
commit ce0b0a46955d1bb389684a2605dbcaa990ba0154 upstream.
raid10 reshape clears unwanted bits from a bio->bi\_flags using
a method which, while clumsy, worked until 3.10 when BIO\_OWNS\_VEC
was added.
Since then it clears that bit but shouldn't. This results in a
memory leak.
So change to used the approved method of clearing unwanted bits.
As this causes a memory leak which can consume all of memory
the fix is suitable for -stable.
Fixes: a38352e0ac02dbbd4fa464dc22d1352b5fbd06fd
Reported-by: mdraid.pkoch@dfgh.net (Peter Koch)
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit ba1f6592cb07d4d7025112e1ffcf279d904c7146
Author: NeilBrown
Date: Wed Aug 13 09:57:07 2014 +1000
md/raid6: avoid data corruption during recovery of double-degraded RAID6
commit 9c4bdf697c39805078392d5ddbbba5ae5680e0dd upstream.
During recovery of a double-degraded RAID6 it is possible for
some blocks not to be recovered properly, leading to corruption.
If a write happens to one block in a stripe that would be written to a
missing device, and at the same time that stripe is recovering data
to the other missing device, then that recovered data may not be written.
This patch skips, in the double-degraded case, an optimisation that is
only safe for single-degraded arrays.
Bug was introduced in 2.6.32 and fix is suitable for any kernel since
then. In an older kernel with separate handle\_stripe5() and
handle\_stripe6() functions the patch must change handle\_stripe6().
Fixes: 6c0069c0ae9659e3a91b68eaed06a5c6c37f45c8
Cc: Yuri Tikhonov
Cc: Dan Williams
Reported-by: "Manibalan P"
Tested-by: "Manibalan P"
Resolves: https://bugzilla.redhat.com/show\_bug.cgi?id=1090423
Signed-off-by: NeilBrown
Acked-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit 706d916414bf623b20c4626cc6096bb0839263dc
Author: NeilBrown
Date: Wed Aug 13 09:48:45 2014 +1000
md/raid5: avoid livelock caused by non-aligned writes.
commit a40687ff73a5b14909d6aa522f7d778b158911c5 upstream.
If a stripe in a raid6 array received a write to each data block while
the array is degraded, and if any of these writes to a missing device
are not page-aligned, then a live-lock happens.
In this case the P and Q blocks need to be read so that the part of
the missing block which is \*not\* being updated by the write can be
constructed. Due to a logic error, these blocks are not loaded, so
the update cannot proceed and the stripe is 'handled' repeatedly in an
infinite loop.
This bug is unlikely as most writes are page aligned. However as it
can lead to a livelock it is suitable for -stable. It was introduced
in 3.16.
Fixed: 67f455486d2ea20b2d94d6adf5b9b783d079e321
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit ae2a02448818b29a5fe79431530feef286c03a97
Author: NeilBrown
Date: Thu Jul 31 10:16:29 2014 +1000
md/raid1,raid10: always abort recover on write error.
commit 2446dba03f9dabe0b477a126cbeb377854785b47 upstream.
Currently we don't abort recovery on a write error if the write error
to the recovering device was triggerd by normal IO (as opposed to
recovery IO).
This means that for one bitmap region, the recovery might write to the
recovering device for a few sectors, then not bother for subsequent
sectors (as it never writes to failed devices). In this case
the bitmap bit will be cleared, but it really shouldn't.
The result is that if the recovering device fails and is then re-added
(after fixing whatever hardware problem triggerred the failure),
the second recovery won't redo the region it was in the middle of,
so some of the device will not be recovered properly.
If we abort the recovery, the region being processes will be cancelled
(bit not cleared) and the whole region will be retried.
As the bug can result in data corruption the patch is suitable for
-stable. For kernels prior to 3.11 there is a conflict in raid10.c
which will require care.
Original-from: jiao hui
Reported-and-tested-by: jiao hui
Signed-off-by: NeilBrown
Signed-off-by: Greg Kroah-Hartman
commit 3fd72a0eb33d7b391b5bba8f3bd6a9ff1fc65f8c
Author: Al Viro
Date: Sun Aug 10 03:44:55 2014 -0400
fix copy\_tree() regression
commit 12a5b5294cb1896e9a3c9fca8ff5a7e3def4e8c6 upstream.
Since 3.14 we had copy\_tree() get the shadowing wrong - if we had one
vfsmount shadowing another (i.e. if A is a slave of B, C is mounted
on A/foo, then D got mounted on B/foo creating D' on A/foo shadowed
by C), copy\_tree() of A would make a copy of D' shadow the the copy of
C, not the other way around.
It's easy to fix, fortunately - just make sure that mount follows
the one that shadows it in mnt\_child as well as in mnt\_hash, and when
copy\_tree() decides to attach a new mount, check if the last child
it has added to the same parent should be shadowing the new one.
And if it should, just use the same logics commit\_tree() has - put the
new mount into the hash and children lists right after the one that
should shadow it.
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 0fe6ae39a66c475e5ccb1511155e32a4bd704574
Author: Ilya Dryomov
Date: Mon Aug 4 18:04:39 2014 +0400
rbd: rework rbd\_request\_fn()
commit bc1ecc65a259fa9333dc8bd6a4ba0cf03b7d4bf8 upstream.
While it was never a good idea to sleep in request\_fn(), commit
34c6bc2c919a ("locking/mutexes: Add extra reschedule point") made it
a \*bad\* idea. mutex\_lock() since 3.15 may reschedule \*before\* putting
task on the mutex wait queue, which for tasks in !TASK\_RUNNING state
means block forever. request\_fn() may be called with !TASK\_RUNNING on
the way to schedule() in io\_schedule().
Offload request handling to a workqueue, one per rbd device, to avoid
calling blocking primitives from rbd\_request\_fn().
Fixes: http://tracker.ceph.com/issues/8818
Signed-off-by: Ilya Dryomov
Tested-by: Eric Eastman
Tested-by: Greg Wilson
Reviewed-by: Alex Elder
Signed-off-by: Greg Kroah-Hartman
commit 3fecf9a20b3c7dba412339d56d6ec3f2eac12345
Author: Al Viro
Date: Fri Aug 8 12:39:16 2014 -0400
\_\_generic\_file\_write\_iter(): fix handling of sync error after DIO
commit 60bb45297f7551833346c5cebc6d483ea17ea5f2 upstream.
If DIO results in short write and sync write fails, we want to bugger off
whether the DIO part has written anything or not; the logics on the return
will take care of the right return value.
Reported-by: Anton Altaparmakov
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 4156d121fa7b6840a992ccbfa9ea4170a67bb12c
Author: Vignesh Raman
Date: Tue Jul 22 19:24:25 2014 +0530
Bluetooth: Avoid use of session socket after the session gets freed
commit 32333edb82fb2009980eefc5518100068147ab82 upstream.
The commits 08c30aca9e698faddebd34f81e1196295f9dc063 "Bluetooth: Remove
RFCOMM session refcnt" and 8ff52f7d04d9cc31f1e81dcf9a2ba6335ed34905
"Bluetooth: Return RFCOMM session ptrs to avoid freed session"
allow rfcomm\_recv\_ua and rfcomm\_session\_close to delete the session
(and free the corresponding socket) and propagate NULL session pointer
to the upper callers.
Additional fix is required to terminate the loop in rfcomm\_process\_rx
function to avoid use of freed 'sk' memory.
The issue is only reproducible with kernel option CONFIG\_PAGE\_POISONING
enabled making freed memory being changed and filled up with fixed char
value used to unmask use-after-free issues.
Signed-off-by: Vignesh Raman
Signed-off-by: Vitaly Kuzmichev
Acked-by: Dean Jenkins
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit 075d3370845a28d0c2f2c7a2077cf5df7887567b
Author: Johan Hedberg
Date: Thu Jul 17 11:56:33 2014 +0300
Bluetooth: Fix using uninitialized variable when pairing
commit 9f743d7499bc2c4dc8c35af33bdb2a29bea663b9 upstream.
Commit 6c53823ae0e10e723131055e1e65dd6a328a228e reshuffled the way the
authentication requirement gets set in the hci\_io\_capa\_request\_evt()
function, but at the same time it failed to update an if-statement where
cp.authentication is used before it has been initialized. The correct
value the code should be looking for in this if-statement is
conn->auth\_type.
Signed-off-by: Johan Hedberg
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit e6b64634229fb0c0724e9b5f4c0a49656e83f12b
Author: Vladimir Davydov
Date: Tue Jul 15 12:25:28 2014 +0400
Bluetooth: never linger on process exit
commit 093facf3634da1b0c2cc7ed106f1983da901bbab upstream.
If the current process is exiting, lingering on socket close will make
it unkillable, so we should avoid it.
Reproducer:
#include
#include
#define BTPROTO\_L2CAP 0
#define BTPROTO\_SCO 2
#define BTPROTO\_RFCOMM 3
int main()
{
int fd;
struct linger ling;
fd = socket(PF\_BLUETOOTH, SOCK\_STREAM, BTPROTO\_RFCOMM);
//or: fd = socket(PF\_BLUETOOTH, SOCK\_DGRAM, BTPROTO\_L2CAP);
//or: fd = socket(PF\_BLUETOOTH, SOCK\_SEQPACKET, BTPROTO\_SCO);
ling.l\_onoff = 1;
ling.l\_linger = 1000000000;
setsockopt(fd, SOL\_SOCKET, SO\_LINGER, &ling, sizeof(ling));
return 0;
}
Signed-off-by: Vladimir Davydov
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit c8383cb6fd5d8f66fc50319e2d6f8363cecb022b
Author: Johan Hedberg
Date: Fri Jul 11 15:32:23 2014 +0300
Bluetooth: Fix tracking local SSP authentication requirement
commit 6c53823ae0e10e723131055e1e65dd6a328a228e upstream.
When we need to make the decision whether to perform just-works or real
user confirmation we need to know the exact local authentication
requirement that was passed to the controller. So far conn->auth\_type
(the local requirement) wasn't in one case updated appropriately in fear
of the user confirmation being rejected later.
The real problem however was not really that conn->auth\_type couldn't
represent the true value but that we were checking the local MITM
requirement in an incorrect way. It's perfectly fine to let auth\_type
follow what we tell the controller since we're still tracking the target
security level with conn->pending\_sec\_level.
This patch updates the check for local MITM requirement in the
hci\_user\_confirm\_request\_evt function to use the locally requested
security level and ensures that auth\_type always represents what we tell
the controller. All other code in hci\_user\_confirm\_request\_evt still
uses the auth\_type instead of pending\_sec\_level for determining whether
to do just-works or not, since that's the only value that's in sync with
what the remote device knows.
Signed-off-by: Johan Hedberg
Tested-by: Szymon Janc
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit 41466215bd7e371a70ece9f4a721f03ccb5cd613
Author: Marcel Holtmann
Date: Tue Jul 1 14:11:19 2014 +0200
Bluetooth: Fix merge of advertising data and scan response data
commit 42bd6a56ed1ab4b2cb50f4d4e674874da9b47f46 upstream.
The advertising data and scan response data are merged in the wrong
order. It should be advertsing data first and then scan response data
and not the other way around.
Signed-off-by: Marcel Holtmann
Signed-off-by: Johan Hedberg
Signed-off-by: Greg Kroah-Hartman
commit ec0c2b9cc4eb0a7a38f02fb18d405906f0ff28ad
Author: Chin-Ran Lo
Date: Tue Jul 1 14:00:14 2014 -0700
Bluetooth: btmrvl: wait for HOST\_SLEEP\_ENABLE event in suspend
commit 396e04f4bb9afefb0744715dc76d9abe18ee5fb0 upstream.
After BT\_CMD\_HOST\_SLEEP\_ENABLE command finishes, driver should
wait until getting BT\_EVENT\_HOST\_SLEEP\_ENABLE event to complete
suspend procedure.
Without this patch the suspend handler would return success
earlier. By the time when the BT\_EVENT\_HOST\_SLEEP\_ENABLE event
comes in the controller driver could have already turned off the
bus clock. This causes kernel crash or system reboot eventually.
Signed-off-by: Chin-Ran Lo
Signed-off-by: Jeff CF Chen
Signed-off-by: Amitkumar Karwar
Signed-off-by: Bing Zhao
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit cee789ed6fb0a2d38b77a573a369a9e6b924bc63
Author: Al Viro
Date: Sat Aug 30 18:32:05 2014 -0400
fix EBUSY on umount() from MNT\_SHRINKABLE
commit 81b6b06197606b4bef4e427a197aeb808e8d89e1 upstream.
We need the parents of victims alive until namespace\_unlock() gets to
dput() of the (ex-)mountpoints. However, that screws up the "is it
busy" checks in case when we have shrinkable mounts that need to be
killed. Solution: go ahead and decrement refcounts of parents right
in umount\_tree(), increment them again just before dropping rwsem in
namespace\_unlock() (and let the loop in the end of namespace\_unlock()
finally drop those references for good, as we do now). Parents can't
get freed until we drop rwsem - at least one reference is kept until
then, both in case when parent is among the victims and when it is
not. So they'll still be around when we get to namespace\_unlock().
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit a14b66064d52fb0061d20f5a2288980a55ab6b73
Author: Al Viro
Date: Mon Aug 18 15:09:26 2014 -0400
get rid of propagate\_umount() mistakenly treating slaves as busy.
commit 88b368f27a094277143d8ecd5a056116f6a41520 upstream.
The check in \_\_propagate\_umount() ("has somebody explicitly mounted
something on that slave?") is done \*before\* taking the already doomed
victims out of the child lists.
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit 27d2379a682edbf2b4d7e3005c783d1904cab217
Author: Eric W. Biederman
Date: Tue Jul 29 15:50:44 2014 -0700
mnt: Add tests for unprivileged remount cases that have found to be faulty
commit db181ce011e3c033328608299cd6fac06ea50130 upstream.
Kenton Varda  discovered that by remounting a
read-only bind mount read-only in a user namespace the
MNT\_LOCK\_READONLY bit would be cleared, allowing an unprivileged user
to the remount a read-only mount read-write.
Upon review of the code in remount it was discovered that the code allowed
nosuid, noexec, and nodev to be cleared. It was also discovered that
the code was allowing the per mount atime flags to be changed.
The first naive patch to fix these issues contained the flaw that using
default atime settings when remounting a filesystem could be disallowed.
To avoid this problems in the future add tests to ensure unprivileged
remounts are succeeding and failing at the appropriate times.
Acked-by: Serge E. Hallyn
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 72e946e24012627c160f474e62f07d45428f790d
Author: Eric W. Biederman
Date: Mon Jul 28 17:36:04 2014 -0700
mnt: Change the default remount atime from relatime to the existing value
commit ffbc6f0ead47fa5a1dc9642b0331cb75c20a640e upstream.
Since March 2009 the kernel has treated the state that if no
MS\_..ATIME flags are passed then the kernel defaults to relatime.
Defaulting to relatime instead of the existing atime state during a
remount is silly, and causes problems in practice for people who don't
specify any MS\_...ATIME flags and to get the default filesystem atime
setting. Those users may encounter a permission error because the
default atime setting does not work.
A default that does not work and causes permission problems is
ridiculous, so preserve the existing value to have a default
atime setting that is always guaranteed to work.
Using the default atime setting in this way is particularly
interesting for applications built to run in restricted userspace
environments without /proc mounted, as the existing atime mount
options of a filesystem can not be read from /proc/mounts.
In practice this fixes user space that uses the default atime
setting on remount that are broken by the permission checks
keeping less privileged users from changing more privileged users
atime settings.
Acked-by: Serge E. Hallyn
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 3ed889bb32afa24e5ee77a3b40c7c8088b16eedf
Author: Eric W. Biederman
Date: Mon Jul 28 17:26:07 2014 -0700
mnt: Correct permission checks in do\_remount
commit 9566d6742852c527bf5af38af5cbb878dad75705 upstream.
While invesgiating the issue where in "mount --bind -oremount,ro ..."
would result in later "mount --bind -oremount,rw" succeeding even if
the mount started off locked I realized that there are several
additional mount flags that should be locked and are not.
In particular MNT\_NOSUID, MNT\_NODEV, MNT\_NOEXEC, and the atime
flags in addition to MNT\_READONLY should all be locked. These
flags are all per superblock, can all be changed with MS\_BIND,
and should not be changable if set by a more privileged user.
The following additions to the current logic are added in this patch.
- nosuid may not be clearable by a less privileged user.
- nodev may not be clearable by a less privielged user.
- noexec may not be clearable by a less privileged user.
- atime flags may not be changeable by a less privileged user.
The logic with atime is that always setting atime on access is a
global policy and backup software and auditing software could break if
atime bits are not updated (when they are configured to be updated),
and serious performance degradation could result (DOS attack) if atime
updates happen when they have been explicitly disabled. Therefore an
unprivileged user should not be able to mess with the atime bits set
by a more privileged user.
The additional restrictions are implemented with the addition of
MNT\_LOCK\_NOSUID, MNT\_LOCK\_NODEV, MNT\_LOCK\_NOEXEC, and MNT\_LOCK\_ATIME
mnt flags.
Taken together these changes and the fixes for MNT\_LOCK\_READONLY
should make it safe for an unprivileged user to create a user
namespace and to call "mount --bind -o remount,... ..." without
the danger of mount flags being changed maliciously.
Acked-by: Serge E. Hallyn
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit daa4314a0c2742fb7b79d7ef7fa308bd76a29264
Author: Eric W. Biederman
Date: Mon Jul 28 17:10:56 2014 -0700
mnt: Move the test for MNT\_LOCK\_READONLY from change\_mount\_flags into do\_remount
commit 07b645589dcda8b7a5249e096fece2a67556f0f4 upstream.
There are no races as locked mount flags are guaranteed to never change.
Moving the test into do\_remount makes it more visible, and ensures all
filesystem remounts pass the MNT\_LOCK\_READONLY permission check. This
second case is not an issue today as filesystem remounts are guarded
by capable(CAP\_DAC\_ADMIN) and thus will always fail in less privileged
mount namespaces, but it could become an issue in the future.
Acked-by: Serge E. Hallyn
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 3995f446f4e51fb781467d6da1673cf4631634ff
Author: Eric W. Biederman
Date: Mon Jul 28 16:26:53 2014 -0700
mnt: Only change user settable mount flags in remount
commit a6138db815df5ee542d848318e5dae681590fccd upstream.
Kenton Varda  discovered that by remounting a
read-only bind mount read-only in a user namespace the
MNT\_LOCK\_READONLY bit would be cleared, allowing an unprivileged user
to the remount a read-only mount read-write.
Correct this by replacing the mask of mount flags to preserve
with a mask of mount flags that may be changed, and preserve
all others. This ensures that any future bugs with this mask and
remount will fail in an easy to detect way where new mount flags
simply won't change.
Acked-by: Serge E. Hallyn
Signed-off-by: "Eric W. Biederman"
Signed-off-by: Greg Kroah-Hartman
commit 39ed6dfc36293ce24734ec571569a0921d8b0745
Author: Steven Rostedt (Red Hat)
Date: Wed Aug 6 15:36:31 2014 -0400
ring-buffer: Up rb\_iter\_peek() loop count to 3
commit 021de3d904b88b1771a3a2cfc5b75023c391e646 upstream.
After writting a test to try to trigger the bug that caused the
ring buffer iterator to become corrupted, I hit another bug:
WARNING: CPU: 1 PID: 5281 at kernel/trace/ring\_buffer.c:3766 rb\_iter\_peek+0x113/0x238()
Modules linked in: ipt\_MASQUERADE sunrpc [...]
CPU: 1 PID: 5281 Comm: grep Tainted: G W 3.16.0-rc3-test+ #143
Hardware name: To Be Filled By O.E.M. To Be Filled By O.E.M./To be filled by O.E.M., BIOS SDBLI944.86P 05/08/2007
0000000000000000 ffffffff81809a80 ffffffff81503fb0 0000000000000000
ffffffff81040ca1 ffff8800796d6010 ffffffff810c138d ffff8800796d6010
ffff880077438c80 ffff8800796d6010 ffff88007abbe600 0000000000000003
Call Trace:
[] ? dump\_stack+0x4a/0x75
[] ? warn\_slowpath\_common+0x7e/0x97
[] ? rb\_iter\_peek+0x113/0x238
[] ? rb\_iter\_peek+0x113/0x238
[] ? ring\_buffer\_iter\_peek+0x2d/0x5c
[] ? tracing\_iter\_reset+0x6e/0x96
[] ? s\_start+0xd7/0x17b
[] ? kmem\_cache\_alloc\_trace+0xda/0xea
[] ? seq\_read+0x148/0x361
[] ? vfs\_read+0x93/0xf1
[] ? SyS\_read+0x60/0x8e
[] ? tracesys+0xdd/0xe2
Debugging this bug, which triggers when the rb\_iter\_peek() loops too
many times (more than 2 times), I discovered there's a case that can
cause that function to legitimately loop 3 times!
rb\_iter\_peek() is different than rb\_buffer\_peek() as the rb\_buffer\_peek()
only deals with the reader page (it's for consuming reads). The
rb\_iter\_peek() is for traversing the buffer without consuming it, and as
such, it can loop for one more reason. That is, if we hit the end of
the reader page or any page, it will go to the next page and try again.
That is, we have this:
1. iter->head > iter->head\_page->page->commit
(rb\_inc\_iter() which moves the iter to the next page)
try again
2. event = rb\_iter\_head\_event()
event->type\_len == RINGBUF\_TYPE\_TIME\_EXTEND
rb\_advance\_iter()
try again
3. read the event.
But we never get to 3, because the count is greater than 2 and we
cause the WARNING and return NULL.
Up the counter to 3.
Fixes: 69d1b839f7ee "ring-buffer: Bind time extend and data events together"
Signed-off-by: Steven Rostedt
Signed-off-by: Greg Kroah-Hartman
commit 1cfa896d6e52e3d9d2cb2133a0c495c816556ca9
Author: Steven Rostedt (Red Hat)
Date: Wed Aug 6 14:11:33 2014 -0400
ring-buffer: Always reset iterator to reader page
commit 651e22f2701b4113989237c3048d17337dd2185c upstream.
When performing a consuming read, the ring buffer swaps out a
page from the ring buffer with a empty page and this page that
was swapped out becomes the new reader page. The reader page
is owned by the reader and since it was swapped out of the ring
buffer, writers do not have access to it (there's an exception
to that rule, but it's out of scope for this commit).
When reading the "trace" file, it is a non consuming read, which
means that the data in the ring buffer will not be modified.
When the trace file is opened, a ring buffer iterator is allocated
and writes to the ring buffer are disabled, such that the iterator
will not have issues iterating over the data.
Although the ring buffer disabled writes, it does not disable other
reads, or even consuming reads. If a consuming read happens, then
the iterator is reset and starts reading from the beginning again.
My tests would sometimes trigger this bug on my i386 box:
WARNING: CPU: 0 PID: 5175 at kernel/trace/trace.c:1527 \_\_trace\_find\_cmdline+0x66/0xaa()
Modules linked in:
CPU: 0 PID: 5175 Comm: grep Not tainted 3.16.0-rc3-test+ #8
Hardware name: /DG965MQ, BIOS MQ96510J.86A.0372.2006.0605.1717 06/05/2006
00000000 00000000 f09c9e1c c18796b3 c1b5d74c f09c9e4c c103a0e3 c1b5154b
f09c9e78 00001437 c1b5d74c 000005f7 c10bd85a c10bd85a c1cac57c f09c9eb0
ed0e0000 f09c9e64 c103a185 00000009 f09c9e5c c1b5154b f09c9e78 f09c9e80^M
Call Trace:
[] dump\_stack+0x4b/0x75
[] warn\_slowpath\_common+0x7e/0x95
[] ? \_\_trace\_find\_cmdline+0x66/0xaa
[] ? \_\_trace\_find\_cmdline+0x66/0xaa
[] warn\_slowpath\_fmt+0x33/0x35
[] \_\_trace\_find\_cmdline+0x66/0xaa^M
[] trace\_find\_cmdline+0x40/0x64
[] trace\_print\_context+0x27/0xec
[] ? trace\_seq\_printf+0x37/0x5b
[] print\_trace\_line+0x319/0x39b
[] ? ring\_buffer\_read+0x47/0x50
[] s\_show+0x192/0x1ab
[] ? s\_next+0x5a/0x7c
[] seq\_read+0x267/0x34c
[] vfs\_read+0x8c/0xef
[] ? seq\_lseek+0x154/0x154
[] SyS\_read+0x54/0x7f
[] syscall\_call+0x7/0xb
---[ end trace 3f507febd6b4cc83 ]---
>>>> ##### CPU 1 buffer started ####
Which was the \_\_trace\_find\_cmdline() function complaining about the pid
in the event record being negative.
After adding more test cases, this would trigger more often. Strangely
enough, it would never trigger on a single test, but instead would trigger
only when running all the tests. I believe that was the case because it
required one of the tests to be shutting down via delayed instances while
a new test started up.
After spending several days debugging this, I found that it was caused by
the iterator becoming corrupted. Debugging further, I found out why
the iterator became corrupted. It happened with the rb\_iter\_reset().
As consuming reads may not read the full reader page, and only part
of it, there's a "read" field to know where the last read took place.
The iterator, must also start at the read position. In the rb\_iter\_reset()
code, if the reader page was disconnected from the ring buffer, the iterator
would start at the head page within the ring buffer (where writes still
happen). But the mistake there was that it still used the "read" field
to start the iterator on the head page, where it should always start
at zero because readers never read from within the ring buffer where
writes occur.
I originally wrote a patch to have it set the iter->head to 0 instead
of iter->head\_page->read, but then I questioned why it wasn't always
setting the iter to point to the reader page, as the reader page is
still valid. The list\_empty(reader\_page->list) just means that it was
successful in swapping out. But the reader\_page may still have data.
There was a bug report a long time ago that was not reproducible that
had something about trace\_pipe (consuming read) not matching trace
(iterator read). This may explain why that happened.
Anyway, the correct answer to this bug is to always use the reader page
an not reset the iterator to inside the writable ring buffer.
Fixes: d769041f8653 "ring\_buffer: implement new locking"
Signed-off-by: Steven Rostedt
Signed-off-by: Greg Kroah-Hartman
commit d52143d85c9c6962f01098935e0cf8a422bbf5b8
Author: David Vrabel
Date: Thu Jul 31 16:22:24 2014 +0100
xen/events/fifo: reset control block and local HEADs on resume
commit c12784c3d14a2110468ec4d1383f60cfd2665576 upstream.
When using the FIFO-based event channel ABI, if the control block or
the local HEADs are not reset after resuming the guest may see stale
HEAD values and will fail to traverse the FIFO correctly.
This may prevent one or more VCPUs from receiving any events following
a resume.
Signed-off-by: David Vrabel
Reviewed-by: Boris Ostrovsky
Signed-off-by: Greg Kroah-Hartman
commit 062475fc40989d68ddf0a69f6e8cdf3cbaf58610
Author: Hans de Goede
Date: Thu Aug 28 10:20:47 2014 +0200
ACPI / video: Disable native\_backlight on HP ENVY 15 Notebook PC
commit 84c34858a85ecf9dabd72847d860c7d3fb7536e7 upstream.
Link: https://bugs.freedesktop.org/show\_bug.cgi?id=81515
Reported-and-tested-by: Hohahiu
Signed-off-by: Hans de Goede
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 710ea3f575f48a7aa7bd90184d07d5117b1dcabe
Author: Hans de Goede
Date: Thu Aug 28 10:20:46 2014 +0200
ACPI / video: Add a disable\_native\_backlight quirk
commit 5f24079b021cd3147c8d24ba65833f7a0df7e80d upstream.
Some laptops have a working acpi\_video backlight control, and using native
backlight on these causes a regression where backlight control does not work
when userspace is not handling brightness key events. Disable native\_backlight
on these to fix this.
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=81691
Reported-and-tested-by: Andre Müller
Signed-off-by: Hans de Goede
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 651dd54f1e98964528459fe3242a5fd9e2e4831c
Author: Hans de Goede
Date: Thu Aug 28 10:20:45 2014 +0200
ACPI / video: Fix use\_native\_backlight selection logic
commit 25294e9f00f03b2b4f4c56e913bc8c573972f33b upstream.
Commit 751109aad583 ("ACPI / video: Change the default for
video.use\_native\_backlight to 1") has changed the default for
use\_native\_backlight from 0 to 1, but instead of changing
use\_native\_backlight\_dmi to true, and leaving use\_native\_backlight\_param at -1,
it has changed use\_native\_backlight\_param to 1.
This causes acpi\_video\_use\_native\_backlight() to always think that a value was
specified through the param, making it impossible to add a dmi based quirk
to force 0 now that the default is 1.
This fixes this by restoring the use\_native\_backlight\_param default to -1, and
instead setting the use\_native\_backlight\_dmi default to true.
Fixes: 751109aad583 (ACPI / video: Change the default for video.use\_native\_backlight to 1)
Signed-off-by: Hans de Goede
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit d1c062033bc96b74941a06ffa1922e50c24f1680
Author: Jiri Kosina
Date: Wed Sep 3 15:04:28 2014 +0200
ACPI / cpuidle: fix deadlock between cpuidle\_lock and cpu\_hotplug.lock
commit 6726655dfdd2dc60c035c690d9f10cb69d7ea075 upstream.
There is a following AB-BA dependency between cpu\_hotplug.lock and
cpuidle\_lock:
1) cpu\_hotplug.lock -> cpuidle\_lock
enable\_nonboot\_cpus()
\_cpu\_up()
cpu\_hotplug\_begin()
LOCK(cpu\_hotplug.lock)
cpu\_notify()
...
acpi\_processor\_hotplug()
cpuidle\_pause\_and\_lock()
LOCK(cpuidle\_lock)
2) cpuidle\_lock -> cpu\_hotplug.lock
acpi\_os\_execute\_deferred() workqueue
...
acpi\_processor\_cst\_has\_changed()
cpuidle\_pause\_and\_lock()
LOCK(cpuidle\_lock)
get\_online\_cpus()
LOCK(cpu\_hotplug.lock)
Fix this by reversing the order acpi\_processor\_cst\_has\_changed() does
thigs -- let it first execute the protection against CPU hotplug by
calling get\_online\_cpus() and obtain the cpuidle lock only after that (and
perform the symmentric change when allowing CPUs hotplug again and
dropping cpuidle lock).
Spotted by lockdep.
Signed-off-by: Jiri Kosina
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit ca16ec3a32087b907e18db2a4af20f4d1bd9d0ed
Author: Yasuaki Ishimatsu
Date: Wed Sep 3 13:39:13 2014 +0900
ACPI / scan: not cache \_SUN value in struct acpi\_device\_pnp
commit a383b68d9fe9864c4d3b86f67ad6488f58136435 upstream.
The \_SUN device indentification object is not guaranteed to return
the same value every time it is executed, so we should not cache its
return value, but rather execute it every time as needed. If it is
cached, an incorrect stale value may be used in some situations.
This issue was exposed by commit 202317a573b2 (ACPI / scan: Add
acpi\_device objects for all device nodes in the namespace). Fix it
by avoiding to cache the return value of \_SUN.
Fixes: 202317a573b2 (ACPI / scan: Add acpi\_device objects for all device nodes in the namespace)
Signed-off-by: Yasuaki Ishimatsu
[ rjw: Changelog ]
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 37da49c14422abbdfd6c82266952acf5c35c2ce9
Author: Lv Zheng
Date: Thu Aug 21 14:41:26 2014 +0800
ACPI / EC: Add support to disallow QR\_EC to be issued before completing previous QR\_EC
commit 558e4736f2e1b0e6323adf7a5e4df77ed6cfc1a4 upstream.
There is platform refusing to respond QR\_EC when SCI\_EVT isn't set
which is Acer Aspire V5-573G.
By disallowing QR\_EC to be issued before the previous one has been
completed we are able to reduce the possibilities to trigger issues on
such platforms.
Note that this fix can only reduce the occurrence rate of this issue, but
this issue may still occur when such a platform doesn't clear SCI\_EVT
before or immediately after completing the previous QR\_EC transaction.
This patch cannot fix the CLEAR\_ON\_RESUME quirk which also relies on
the assumption that the platforms are able to respond even when SCI\_EVT
isn't set.
But this patch is still useful as it can help to reduce the number of
scheduled QR\_EC work items.
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=82611
Reported-and-tested-by: Alexander Mezin
Signed-off-by: Lv Zheng
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 692749e855838c34894d5f336448a93509d339a9
Author: Lv Zheng
Date: Thu Aug 21 14:41:13 2014 +0800
ACPI / EC: Add support to disallow QR\_EC to be issued when SCI\_EVT isn't set
commit 3afcf2ece453e1a8c2c6de19cdf06da3772a1b08 upstream.
There is a platform refusing to respond QR\_EC when SCI\_EVT isn't set
(Acer Aspire V5-573G).
Currently, we rely on the behaviour that the EC firmware can respond
something (for example, 0x00 to indicate "no outstanding events") to
QR\_EC even when SCI\_EVT is not set, but the reporter has complained
about AC/battery pluging/unpluging and video brightness change delay
on that platform.
This is because the work item that has issued QR\_EC has to wait until
timeout in this case, and the \_Qxx method evaluation work item queued
after QR\_EC one is delayed.
It sounds reasonable to fix this issue by:
1. Implementing SCI\_EVT sanity check before issuing QR\_EC in the EC
driver's main state machine.
2. Moving QR\_EC issuing out of the work queue used by \_Qxx evaluation
to a seperate IRQ handling thread.
This patch fixes this issue using solution 1.
By disallowing QR\_EC to be issued when SCI\_EVT isn't set, we are able to
handle such platform in the EC driver's main state machine. This patch
enhances the state machine in this way to survive with such malfunctioning
EC firmware.
Note that this patch can also fix CLEAR\_ON\_RESUME quirk which also relies
on the assumption that the platforms are able to respond even when SCI\_EVT
isn't set.
Fixes: c0d653412fc8 ACPI / EC: Fix race condition in ec\_transaction\_completed()
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=82611
Reported-and-tested-by: Alexander Mezin
Signed-off-by: Lv Zheng
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit afdd3bcc760e02740b2a375a0ad6447e3da3959f
Author: Rafael J. Wysocki
Date: Tue Aug 26 01:29:21 2014 +0200
ACPI / scan: Allow ACPI drivers to bind to PNP device objects
commit fc2e0a8326d1b21d11ef8213298e5302867fed2c upstream.
We generally don't allow ACPI drivers to bind to ACPI device objects
that companion "physical" device objects are created for to avoid
situations in which two different drivers may attempt to handle one
device at the same time. Recent ACPI device enumeration rework
extended that approach to ACPI PNP devices by starting to use a scan
handler for enumerating them. However, we previously allowed ACPI
drivers to bind to ACPI device objects with existing PNP device
companions and changing that led to functional regressions on some
systems.
For this reason, add a special check for PNP devices in
acpi\_device\_probe() so that ACPI drivers can bind to ACPI device
objects having existing PNP device companions as before.
Fixes: eec15edbb0e1 (ACPI / PNP: use device ID list for PNPACPI device enumeration)
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=81511
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=81971
Reported-by: Gabriele Mazzotta
Reported-by: Dirk Griesbach
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit baf705af97bd84b867de7e16016b3be8cfd99b9a
Author: Lan Tianyu
Date: Tue Aug 26 01:29:24 2014 +0200
ACPI: Run fixed event device notifications in process context
commit 236105db632c6279a020f78c83e22eaef746006b upstream.
Currently, notify callbacks for fixed button events are run from
interrupt context. That is not necessary and after commit 0bf6368ee8f2
(ACPI / button: Add ACPI Button event via netlink routine) it causes
netlink routines to be called from interrupt context which is not
correct.
Also, that is different from non-fixed device events (including
non-fixed button events) whose notify callbacks are all executed from
process context.
For the above reasons, make fixed button device notify callbacks run
in process context which will avoid the deadlock when using netlink
to report button events to user space.
Fixes: 0bf6368ee8f2 (ACPI / button: Add ACPI Button event via netlink routine)
Link: https://lkml.org/lkml/2014/8/21/606
Reported-by: Benjamin Block
Reported-by: Knut Petersen
Signed-off-by: Lan Tianyu
[rjw: Function names, subject and changelog.]
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 5fcc3510ab989474a379cf0148d68578bfe5a147
Author: Alan Cox
Date: Wed Aug 20 13:57:26 2014 +0300
spi/pxa2xx: Add ACPI ID for Intel Braswell
commit aca26364689e00e3b2052072424682231bdae6ae upstream.
The SPI host controller is the same as used in Baytrail, only the ACPI ID
is different so add this new ID to the list.
Signed-off-by: Alan Cox
Signed-off-by: Mika Westerberg
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 02e9190b3bb4acc95b527539f6ec0f7a0982d6aa
Author: Tang Chen
Date: Fri Aug 8 10:30:45 2014 +0800
ACPI / hotplug: Check scan handlers in acpi\_scan\_hot\_remove()
commit dee1592638ab7ea35a32179b73f9284dead49c03 upstream.
When ACPI\_HOTPLUG\_MEMORY is not configured, memory\_device\_handler.attach
is not set. In acpi\_scan\_attach\_handler(), the acpi\_device->handler will
not be initialized.
In acpi\_scan\_hot\_remove(), it doesn't check if acpi\_device->handler is NULL.
If we do memory hot-remove without ACPI\_HOTPLUG\_MEMORY configured, the kernel
will panic.
BUG: unable to handle kernel NULL pointer dereference at 0000000000000088
IP: [] acpi\_device\_hotplug+0x1d7/0x4c4
PGD 0
Oops: 0000 [#1] SMP
Modules linked in: sd\_mod(E) sr\_mod(E) cdrom(E) crc\_t10dif(E) crct10dif\_common(E) ata\_piix(E) libata(E)
CPU: 0 PID: 41 Comm: kworker/u2:1 Tainted: G E 3.16.0-rc7--3.16-rc7-tangchen+ #20
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS rel-1.7.5-0-ge51488c-20140602\_164612-nilsson.home.kraxel.org 04/01/2014
Workqueue: kacpi\_hotplug acpi\_hotplug\_work\_fn
task: ffff8800182436c0 ti: ffff880018254000 task.ti: ffff880018254000
RIP: 0010:[] [] acpi\_device\_hotplug+0x1d7/0x4c4
RSP: 0000:ffff880018257da8 EFLAGS: 00000246
RAX: 0000000000000000 RBX: ffff88001cd8d800 RCX: 0000000000000000
RDX: 0000000000000000 RSI: ffff88001e40e6f8 RDI: 0000000000000246
RBP: ffff880018257df0 R08: 0000000000000096 R09: 00000000000011a0
R10: 63735f6970636120 R11: 725f746f685f6e61 R12: 0000000000000003
R13: ffff88001cc1c400 R14: ffff88001e062028 R15: 0000000000000040
FS: 0000000000000000(0000) GS:ffff88001e400000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 000000008005003b
CR2: 0000000000000088 CR3: 000000001a9a2000 CR4: 00000000000006f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 0000000000000000 DR7: 0000000000000000
Stack:
00000000523cab58 ffff88001cd8d9f8 ffff88001852d480 00000000523cab58
ffff88001852d480 ffff880018221e40 ffff88001cc1c400 ffff88001cce2d00
0000000000000040 ffff880018257e08 ffffffff813dc31d ffff88001852d480
Call Trace:
[] acpi\_hotplug\_work\_fn+0x1e/0x29
[] process\_one\_work+0x17b/0x460
[] worker\_thread+0x11d/0x5b0
[] ? rescuer\_thread+0x3a0/0x3a0
[] kthread+0xe1/0x100
[] ? kthread\_create\_on\_node+0x1a0/0x1a0
[] ret\_from\_fork+0x7c/0xb0
[] ? kthread\_create\_on\_node+0x1a0/0x1a0
This patch fixes this problem by checking if acpi\_device->handler is NULL
in acpi\_scan\_hot\_remove().
Fixes: d22ddcbc4fb7 (ACPI / hotplug: Add demand\_offline hotplug profile flag)
Signed-off-by: Tang Chen
[rjw: Subject]
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 6f02073d295f7bc80b9a04e26fbd59a408033799
Author: David E. Box
Date: Tue Jul 8 10:06:24 2014 +0800
ACPICA: Namespace: Properly null terminate objects detached from a namespace node
commit e23d9b8297546c6ceb7e70771e4915f2a41733cd upstream.
Fixes a bug exposed by an ACPICA unit test around the
acpi\_attach\_data()/acpi\_detach\_data() APIs where the failure to null
terminate a detached object led to the creation of a circular linked list
(and infinite looping) when the object is reattached.
Reported in acpica bugzilla #1063
Link: https://bugs.acpica.org/show\_bug.cgi?id=1063
Signed-off-by: David E. Box
Signed-off-by: Bob Moore
Signed-off-by: Lv Zheng
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit e2ab6731a36966d042a2d4dabd980496cd680f75
Author: David E. Box
Date: Tue Jul 8 10:05:52 2014 +0800
ACPICA: Utilities: Fix memory leak in acpi\_ut\_copy\_iobject\_to\_iobject
commit 8aa5e56eeb61a099ea6519eb30ee399e1bc043ce upstream.
Adds return status check on copy routines to delete the allocated destination
object if either copy fails. Reported by Colin Ian King on bugs.acpica.org,
Bug 1087.
The last applicable commit:
Commit: 3371c19c294a4cb3649aa4e84606be8a1d999e61
Subject: ACPICA: Remove ACPI\_GET\_OBJECT\_TYPE macro
Link: https://bugs.acpica.org/show\_bug.cgi?id=1087
Reported-by: Colin Ian King
Signed-off-by: David E. Box
Signed-off-by: Bob Moore
Signed-off-by: Lv Zheng
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit 2f6efdfcf0d4b4519ca3574884b898c86d9982d5
Author: Sebastian Reichel
Date: Mon Apr 7 13:14:04 2014 +0200
bq2415x\_charger: Fix Atomic Sleep Bug
commit 3c0185046c0ee49a6e55c714612ef3bcd5385df3 upstream.
Move sysfs\_notify and i2c\_transfer calls from bq2415x\_notifier\_call
to bq2415x\_timer\_work to avoid sleeping in atomic context.
This fixes the following bug:
[ 7.667449] Workqueue: events power\_supply\_changed\_work
[ 7.673034] [] (unwind\_backtrace+0x0/0xe0) from [] (show\_stack+0x10/0x14)
[ 7.682098] [] (show\_stack+0x10/0x14) from [] (dump\_stack+0x78/0xac)
[ 7.690704] [] (dump\_stack+0x78/0xac) from [] (\_\_schedule\_bug+0x48/0x60)
[ 7.699645] [] (\_\_schedule\_bug+0x48/0x60) from [] (\_\_schedule+0x74/0x638)
[ 7.708618] [] (\_\_schedule+0x74/0x638) from [] (schedule\_timeout+0x1dc/0x24c)
[ 7.718017] [] (schedule\_timeout+0x1dc/0x24c) from [] (wait\_for\_common+0x138/0x17c)
[ 7.727966] [] (wait\_for\_common+0x138/0x17c) from [] (omap\_i2c\_xfer+0x340/0x4a0)
[ 7.737640] [] (omap\_i2c\_xfer+0x340/0x4a0) from [] (\_\_i2c\_transfer+0x40/0x74)
[ 7.747039] [] (\_\_i2c\_transfer+0x40/0x74) from [] (i2c\_transfer+0x6c/0x90)
[ 7.756195] [] (i2c\_transfer+0x6c/0x90) from [] (bq2415x\_i2c\_write+0x48/0x78)
[ 7.765563] [] (bq2415x\_i2c\_write+0x48/0x78) from [] (bq2415x\_set\_weak\_battery\_voltage+0x4c/0x50)
[ 7.776824] [] (bq2415x\_set\_weak\_battery\_voltage+0x4c/0x50) from [] (bq2415x\_set\_mode+0xdc/0x14c)
[ 7.788085] [] (bq2415x\_set\_mode+0xdc/0x14c) from [] (bq2415x\_notifier\_call+0xa8/0xb4)
[ 7.798309] [] (bq2415x\_notifier\_call+0xa8/0xb4) from [] (notifier\_call\_chain+0x38/0x68)
[ 7.808715] [] (notifier\_call\_chain+0x38/0x68) from [] (\_\_atomic\_notifier\_call\_chain+0x2c/0x3c)
[ 7.819732] [] (\_\_atomic\_notifier\_call\_chain+0x2c/0x3c) from [] (atomic\_notifier\_call\_chain+0x14/0x18)
[ 7.831420] [] (atomic\_notifier\_call\_chain+0x14/0x18) from [] (power\_supply\_changed\_work+0x6c/0xb8)
[ 7.842864] [] (power\_supply\_changed\_work+0x6c/0xb8) from [] (process\_one\_work+0x248/0x440)
[ 7.853546] [] (process\_one\_work+0x248/0x440) from [] (worker\_thread+0x208/0x350)
[ 7.863372] [] (worker\_thread+0x208/0x350) from [] (kthread+0xc8/0xdc)
[ 7.872131] [] (kthread+0xc8/0xdc) from [] (ret\_from\_fork+0x14/0x3c)
Fixes: 32260308b4ca ("bq2415x\_charger: Use power\_supply notifier for automode")
Signed-off-by: Sebastian Reichel
Signed-off-by: Greg Kroah-Hartman
commit 20b9c4eb320553fd64e2be605445ff5aefc68ca7
Author: Ben Hutchings
Date: Sun Jun 8 23:33:25 2014 +0100
bfa: Fix undefined bit shift on big-endian architectures with 32-bit DMA address
commit 03a6c3ff3282ee9fa893089304d951e0be93a144 upstream.
bfa\_swap\_words() shifts its argument (assumed to be 64-bit) by 32 bits
each way. In two places the argument type is dma\_addr\_t, which may be
32-bit, in which case the effect of the bit shift is undefined:
drivers/scsi/bfa/bfa\_fcpim.c: In function 'bfa\_ioim\_send\_ioreq':
drivers/scsi/bfa/bfa\_fcpim.c:2497:4: warning: left shift count >= width of type [enabled by default]
addr = bfa\_sgaddr\_le(sg\_dma\_address(sg));
^
drivers/scsi/bfa/bfa\_fcpim.c:2497:4: warning: right shift count >= width of type [enabled by default]
drivers/scsi/bfa/bfa\_fcpim.c:2509:4: warning: left shift count >= width of type [enabled by default]
addr = bfa\_sgaddr\_le(sg\_dma\_address(sg));
^
drivers/scsi/bfa/bfa\_fcpim.c:2509:4: warning: right shift count >= width of type [enabled by default]
Avoid this by adding casts to u64 in bfa\_swap\_words().
Compile-tested only.
Signed-off-by: Ben Hutchings
Reviewed-by: Martin K. Petersen
Acked-by: Anil Gurumurthy
Fixes: f16a17507b09 ('[SCSI] bfa: remove all OS wrappers')
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit 411838816bbdfb59d5c59d0815ca56c8fc12a15a
Author: Peter Ujfalusi
Date: Fri Aug 29 13:30:23 2014 +0300
ASoC: omap-twl4030: Fix typo in 2nd dai link's platform\_name
commit fdaf42c0105a24de8aefa60f6f7360842c4e673e upstream.
The platform\_name should be omap-mcasp3 for the 2nd link which is used for
voice connection.
Reported-by: Tony Lindgren
Signed-off-by: Peter Ujfalusi
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit ab652f1029613cac1a0ed8c66bfa4e012288f6cd
Author: Jarkko Nikula
Date: Tue Aug 26 17:03:13 2014 +0300
ASoC: rt5640: Do not allow regmap to use bulk read-write operations
commit f4821e8e8e957fe4c601a49b9a97b7399d5f7ab1 upstream.
Debugging showed Realtek RT5642 doesn't support autoincrementing writes so
driver should set the use\_single\_rw flag for regmap.
Signed-off-by: Jarkko Nikula
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 84c1afe572e3b25fe62a22d9a708bb8714dee279
Author: Andreas Färber
Date: Mon Jul 28 15:05:03 2014 +0200
ASoC: axi: Fix ADI AXI SPDIF specification
commit d1555c407a65db42126b295425379acb393ba83a upstream.
The specification requires compatible = "adi,axi-spdif-1.00.a" but
driver and example and file name indicate "adi,axi-spdif-tx-1.00.a".
Change the specification to match the implementation.
Acked-by: Lars-Peter Clausen
Reviewed-by: Michal Simek
Fixes: d7b528eff927 ("dt: Add bindings documentation for the ADI AXI-SPDIF audio controller")
Signed-off-by: Andreas Färber
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 75de33a99a73dbf2f97e570875361504f259ddd2
Author: Daniel Mack
Date: Wed Aug 13 21:51:06 2014 +0200
ASoC: pxa-ssp: drop SNDRV\_PCM\_FMTBIT\_S24\_LE
commit 9301503af016eb537ccce76adec0c1bb5c84871e upstream.
This mode is unsupported, as the DMA controller can't do zero-padding
of samples.
Signed-off-by: Daniel Mack
Reported-by: Johannes Stezenbach
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit f30d8eb685d927ee24bbf6a1c1e03510a0834556
Author: Dan Carpenter
Date: Thu Jul 31 15:57:51 2014 +0300
ASoC: pxa: pxa-ssp: small leak in probe()
commit 4548728981de259d7d37d0ae968a777b09794168 upstream.
There is a small memory leak if probe() fails.
Fixes: 2023c90c3a2c ('ASoC: pxa: pxa-ssp: add DT bindings')
Signed-off-by: Dan Carpenter
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 398f52528d1c5827d8f993a144bfee12429cb57f
Author: Jie Yang
Date: Mon Jul 14 17:37:36 2014 +0800
ASoC: Intel: Cleanup HSW pcm format support
commit 8e89761876611f06ef4be865b4780b4361caf4af upstream.
This change removes unsupported formats from System,
Capture and Loopback FE DAIs.
Also it fixes S24\_LE support on all DAIs.
While at this fix 24 bit flag for BYT as well.
Signed-off-by: Jie Yang
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit edb6d76da78a15b44236bc984048f3caee7787cc
Author: Peter Ujfalusi
Date: Fri Jul 25 13:12:54 2014 +0300
ASoC: tlv320aic31xx: Do not ignore errors in aic31xx\_device\_init()
commit a72d2abbe5752f3a773c4d8b7b41ae41f617f772 upstream.
We need to return the error codes from aic31xx\_device\_init() and return
from the i2c\_probe with the error code.
We will have kernel panic (NULL pointer dereference) in
regulator\_register\_notifier() in case the devm\_regulator\_bulk\_get() fails
(with -EPROBE\_DEFER for example).
Signed-off-by: Peter Ujfalusi
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 5f268d25052914c803f18d74154a95284aa899df
Author: Jarkko Nikula
Date: Thu Jun 19 09:32:05 2014 +0300
ASoC: max98090: Fix missing free\_irq
commit 4adeb0ccf86a5af1825bbfe290dee9e60a5ab870 upstream.
max98090.c doesn't free the threaded interrupt it requests. This causes
an oops when doing "cat /proc/interrupts" after snd-soc-max98090.ko is
unloaded.
Fix this by requesting the interrupt by using devm\_request\_threaded\_irq().
Signed-off-by: Jarkko Nikula
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 13c227e8c6e737e15c94c8a423fc55be4b23816c
Author: Daniel Mack
Date: Thu Jul 3 16:51:36 2014 +0200
ASoC: adau1701: fix adau1701\_reg\_read()
commit 3ad80b828b2533f37c221e2df155774efd6ed814 upstream.
Fix a long standing bug in the read register routing of adau1701.
The bytes arrive in the buffer in big-endian, so the result has to be
shifted before and-ing the bytes in the loop.
Signed-off-by: Daniel Mack
Acked-by: Lars-Peter Clausen
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 2ea1777e35748d4ee71b1e1cce2e1e8ec5d7c6e0
Author: Sylwester Nawrocki
Date: Fri Jul 4 16:05:45 2014 +0200
ASoC: samsung: Correct I2S DAI suspend/resume ops
commit d3d4e5247b013008a39e4d5f69ce4c60ed57f997 upstream.
We should save/restore relevant I2S registers regardless of
the dai->active flag, otherwise some settings are being lost
after system suspend/resume cycle. E.g. I2S slave mode set only
during dai initialization is not preserved and the device ends
up in master mode after system resume.
Signed-off-by: Sylwester Nawrocki
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 77863df55076352caed4126ec1c02ad247410505
Author: Scott Jiang
Date: Fri Jul 18 16:14:57 2014 +0800
ASoC: blackfin: use samples to set silence
commit 30443408fd7201fd1911b09daccf92fae3cc700d upstream.
The third parameter for snd\_pcm\_format\_set\_silence needs the number
of samples instead of sample bytes.
Signed-off-by: Scott Jiang
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 731bd1822747f81b9c255a0c08e2611d75b76515
Author: Praveen Diwakar
Date: Fri Jul 4 11:17:41 2014 +0530
ASoC: wm\_adsp: Add missing MODULE\_LICENSE
commit 0a37c6efec4a2fdc2563c5a8faa472b814deee80 upstream.
Since MODULE\_LICENSE is missing the module load fails,
so add this for module.
Signed-off-by: Praveen Diwakar
Signed-off-by: Vinod Koul
Reviewed-by: Charles Keepax
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 4d47899c4db244a0c76f7e61b24f208a1a7f6c12
Author: Qiao Zhou
Date: Wed Jun 4 19:42:06 2014 +0800
ASoC: pcm: fix dpcm\_path\_put in dpcm runtime update
commit 7ed9de76ff342cbd717a9cf897044b99272cb8f8 upstream.
we need to release dapm widget list after dpcm\_path\_get in
soc\_dpcm\_runtime\_update. otherwise, there will be potential memory
leak. add dpcm\_path\_put to fix it.
Signed-off-by: Qiao Zhou
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 6fc3e7e50364e6367dd9cb188aeb0ef2d34fbb8c
Author: Charles Keepax
Date: Mon Jun 16 21:24:03 2014 +0100
ASoC: wm8994: Prevent double lock of accdet\_lock mutex on wm1811
commit b38314179c9ccb789e6fe967cff171fa817e8978 upstream.
wm1811\_micd\_stop takes the accdet\_lock mutex, and is called from two
places, one of which is already holding the accdet\_lock. This obviously
causes a lock up.
This patch fixes this issue by removing the lock from wm1811\_micd\_stop
and ensuring that it is always locked externally.
Signed-off-by: Charles Keepax
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 7fdcc360a97ba085c569d5bb37d696647f44fc77
Author: Markos Chandras
Date: Mon Jul 21 14:35:56 2014 +0100
MIPS: CPS: Initialize EVA before bringing up VPEs from secondary cores
commit 6521d9a436a62e83ce57d6be6e5484e1098c1380 upstream.
The CPS code is doing several memory loads when configuring the VPEs
from secondary cores, so the segmentation control registers must be
initialized in time otherwise the kernel will crash with strange
TLB exceptions.
Reviewed-by: Paul Burton
Signed-off-by: Markos Chandras
Patchwork: http://patchwork.linux-mips.org/patch/7424/
Signed-off-by: James Hogan
Signed-off-by: Greg Kroah-Hartman
commit 33ea375afc912ca1569a3bb3953d829c75986cc6
Author: Markos Chandras
Date: Mon Jul 21 14:35:55 2014 +0100
MIPS: Malta: EVA: Rename 'eva\_entry' to 'platform\_eva\_init'
commit ca4d24f7954f3746742ba350c2276ff777f21173 upstream.
Rename 'eva\_entry' to 'platform\_eva\_init' as required by the new
'eva\_init' macro in the eva.h header. Since this macro is now used
in a platform dependent way, it must not depend on its caller so move
the t1 register initialization inside this macro. Also set the .reorder
assembler option in case the caller may have previously set .noreorder.
This may allow a few assembler optimizations. Finally include missing
headers and document the register usage for this macro.
Reviewed-by: Paul Burton
Signed-off-by: Markos Chandras
Patchwork: http://patchwork.linux-mips.org/patch/7423/
Signed-off-by: James Hogan
Signed-off-by: Greg Kroah-Hartman
commit f7fcf6dcbd4fd5bc4e9995665cc72e46b56cd83f
Author: Markos Chandras
Date: Mon Jul 21 14:35:54 2014 +0100
MIPS: EVA: Add new EVA header
commit f85b71ceabb9d8d8a9e34b045b5c43ffde3623b3 upstream.
Generic code may need to perform certain operations when EVA is
enabled, for example, configure the segmentation registers during
boot. In order to avoid using more CONFIG\_EVA ifdefs in the arch code,
such functions will be added in this header instead.
Initially this header contains a macro which will be used by generic
code later on during VPEs configuration on secondary cores.
All it does is to call the platform specific EVA init code in case
EVA is enabled.
Reviewed-by: Paul Burton
Signed-off-by: Markos Chandras
Patchwork: http://patchwork.linux-mips.org/patch/7422/
Signed-off-by: James Hogan
Signed-off-by: Greg Kroah-Hartman
commit fd32ecad8e11e3b29511ef63fdfd596fb2cec100
Author: Aaro Koskinen
Date: Tue Jul 22 14:51:08 2014 +0300
MIPS: OCTEON: make get\_system\_type() thread-safe
commit 608308682addfdc7b8e2aee88f0e028331d88e4d upstream.
get\_system\_type() is not thread-safe on OCTEON. It uses static data,
also more dangerous issue is that it's calling cvmx\_fuse\_read\_byte()
every time without any synchronization. Currently it's possible to get
processes stuck looping forever in kernel simply by launching multiple
readers of /proc/cpuinfo:
(while true; do cat /proc/cpuinfo > /dev/null; done) &
(while true; do cat /proc/cpuinfo > /dev/null; done) &
...
Fix by initializing the system type string only once during the early
boot.
Signed-off-by: Aaro Koskinen
Reviewed-by: Markos Chandras
Patchwork: http://patchwork.linux-mips.org/patch/7437/
Signed-off-by: James Hogan
Signed-off-by: Greg Kroah-Hartman
commit d0fe2a761f3c17fc0aabb6a8b11e79905871c7dc
Author: Markos Chandras
Date: Mon Aug 18 15:04:11 2014 +0100
MIPS: Malta: Improve system memory detection for '{e, }memsize' >= 2G
commit 64615682658373516863b5b5971ff1d922d0ae7b upstream.
Using kstrtol to parse the "{e,}memsize" variables was wrong because this
parses signed long numbers. In case of '{e,}memsize' >= 2G, the top bit
is set, resulting to -ERANGE errors and possibly random system memory
boundaries. We fix this by replacing "kstrtol" with "kstrtoul".
We also improve the code to check the kstrtoul return value and
print a warning if an error was returned.
Signed-off-by: Markos Chandras
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7543/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 0d476962400af05b20b19524af561cca613e04d1
Author: Markos Chandras
Date: Thu Jul 24 12:10:02 2014 +0100
MIPS: scall64-o32: Fix indirect syscall detection
commit 5245689900804604fdc349c8d9b8985b0e401ae2 upstream.
Commit 4c21b8fd8f14 (MIPS: seccomp: Handle indirect system calls (o32))
added indirect syscall detection for O32 processes running on MIPS64
but it did not work as expected. The reason is the the scall64-o32
implementation differs compared to scall32-o32. In the former, the v0
(syscall number) register contains the absolute syscall number
(4000 + X) whereas in the latter it contains the relative syscall
number (X). Fix the code to avoid doing an extra addition, and load
the v0 register directly to the first argument for syscall\_trace\_enter.
Moreover, set the .reorder assembler option in order to have better
control on this part of the assembly code.
Signed-off-by: Markos Chandras
Patchwork: http://patchwork.linux-mips.org/patch/7481/
Signed-off-by: James Hogan
Signed-off-by: Greg Kroah-Hartman
commit 456ea3e786d95095b08b5091643f721b56abe141
Author: Markos Chandras
Date: Thu Jul 24 12:10:01 2014 +0100
MIPS: syscall: Fix AUDIT value for O32 processes on MIPS64
commit 40381529f84c4cda3bd2d20cab6a707508856b21 upstream.
On MIPS64, O32 processes set both TIF\_32BIT\_ADDR and
TIF\_32BIT\_REGS so the previous condition treated O32 applications
as N32 when evaluating seccomp filters. Fix the condition to check
both TIF\_32BIT\_{REGS, ADDR} for the N32 AUDIT flag.
Signed-off-by: Markos Chandras
Patchwork: http://patchwork.linux-mips.org/patch/7480/
Signed-off-by: James Hogan
Signed-off-by: Greg Kroah-Hartman
commit fa23614759ed8981b0894c4c90f33f66fc75f614
Author: Alex Smith
Date: Wed Jul 23 14:40:08 2014 +0100
MIPS: asm/reg.h: Make 32- and 64-bit definitions available at the same time
commit bcec7c8da6b092b1ff3327fd83c2193adb12f684 upstream.
Get rid of the WANT\_COMPAT\_REG\_H test and instead define both the 32-
and 64-bit register offset definitions at the same time with
MIPS{32,64}\_ prefixes, then define the existing EF\_\* names to the
correct definitions for the kernel's bitness.
This patch is a prerequisite of the following bug fix patch.
Signed-off-by: Alex Smith
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7451/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 08d874f5f8edec1db63ad5e426391e39d7077a35
Author: Huacai Chen
Date: Wed Jul 16 09:19:16 2014 +0800
MIPS: Remove BUG\_ON(!is\_fpu\_owner()) in do\_ade()
commit 2e5767a27337812f6850b3fa362419e2f085e5c3 upstream.
In do\_ade(), is\_fpu\_owner() isn't preempt-safe. For example, when an
unaligned ldc1 is executed, do\_cpu() is called and then FPU will be
enabled (and TIF\_USEDFPU will be set for the current process). Then,
do\_ade() is called because the access is unaligned. If the current
process is preempted at this time, TIF\_USEDFPU will be cleard. So when
the process is scheduled again, BUG\_ON(!is\_fpu\_owner()) is triggered.
This small program can trigger this BUG in a preemptible kernel:
int main (int argc, char \*argv[])
{
double u64[2];
while (1) {
asm volatile (
".set push \n\t"
".set noreorder \n\t"
"ldc1 $f3, 4(%0) \n\t"
".set pop \n\t"
::"r"(u64):
);
}
return 0;
}
V2: Remove the BUG\_ON() unconditionally due to Paul's suggestion.
Signed-off-by: Huacai Chen
Signed-off-by: Jie Chen
Signed-off-by: Rui Wang
Cc: John Crispin
Cc: Steven J. Hill
Cc: linux-mips@linux-mips.org
Cc: Fuxin Zhang
Cc: Zhangjin Wu
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 73acac554abadfc0b676b444ff142a672ad66010
Author: Huacai Chen
Date: Tue Jul 29 14:54:40 2014 +0800
MIPS: tlbex: Fix a missing statement for HUGETLB
commit 8393c524a25609a30129e4a8975cf3b91f6c16a5 upstream.
In commit 2c8c53e28f1 (MIPS: Optimize TLB handlers for Octeon CPUs)
build\_r4000\_tlb\_refill\_handler() is modified. But it doesn't compatible
with the original code in HUGETLB case. Because there is a copy & paste
error and one line of code is missing. It is very easy to produce a bug
with LTP's hugemmap05 test.
Signed-off-by: Huacai Chen
Signed-off-by: Binbin Zhou
Cc: John Crispin
Cc: Steven J. Hill
Cc: linux-mips@linux-mips.org
Cc: Fuxin Zhang
Cc: Zhangjin Wu
Patchwork: https://patchwork.linux-mips.org/patch/7496/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 562d55ef5b9570150fd5492772d930855f2c006c
Author: Paul Burton
Date: Tue Jul 22 14:21:21 2014 +0100
MIPS: Prevent user from setting FCSR cause bits
commit b1442d39fac2fcfbe6a4814979020e993ca59c9e upstream.
If one or more matching FCSR cause & enable bits are set in saved thread
context then when that context is restored the kernel will take an FP
exception. This is of course undesirable and considered an oops, leading
to the kernel writing a backtrace to the console and potentially
rebooting depending upon the configuration. Thus the kernel avoids this
situation by clearing the cause bits of the FCSR register when handling
FP exceptions and after emulating FP instructions.
However the kernel does not prevent userland from setting arbitrary FCSR
cause & enable bits via ptrace, using either the PTRACE\_POKEUSR or
PTRACE\_SETFPREGS requests. This means userland can trivially cause the
kernel to oops on any system with an FPU. Prevent this from happening
by clearing the cause bits when writing to the saved FCSR context via
ptrace.
This problem appears to exist at least back to the beginning of the git
era in the PTRACE\_POKEUSR case.
Signed-off-by: Paul Burton
Cc: linux-mips@linux-mips.org
Cc: Paul Burton
Cc: stable@vger.kernel.org
Patchwork: https://patchwork.linux-mips.org/patch/7438/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 488cba879f673b8513d5c6cbc69da543d1d41f9b
Author: James Hogan
Date: Fri Jul 4 11:59:46 2014 +0100
MIPS: smp-mt: Fix link error when PROC\_FS=n
commit 7d907fa1c6ccb64c7f64cc7d3dcc7f6fe30a67b4 upstream.
Commit d6d3c9afaab4 (MIPS: MT: proc: Add support for printing VPE and TC
ids) causes a link error when CONFIG\_PROC\_FS=n:
arch/mips/built-in.o: In function `proc\_cpuinfo\_notifier\_init':
smp-mt.c: undefined reference to `register\_proc\_cpuinfo\_notifier'
This is fixed by adding an ifdef around the procfs handling code
in smp-mt.c.
Signed-off-by: James Hogan
Reported-by: Markos Chandras
Reviewed-by: Markos Chandras
Cc: Ralf Baechle
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7244/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 17dcaca5dd46e37ca11d93ca3d68db35293e89d7
Author: Alex Smith
Date: Wed Jul 23 14:40:06 2014 +0100
MIPS: ptrace: Avoid smp\_processor\_id() when retrieving FPU IR
commit 656ff9bef08c19a6471b49528dacb4cbbeb1e537 upstream.
Whenever ptrace attempts to retrieve the FPU implementation register it
accesses it through current\_cpu\_data, which calls smp\_processor\_id().
Since the code may execute with preemption enabled, this can trigger
a warning. Fix this by using boot\_cpu\_data to get the IR instead.
Signed-off-by: Alex Smith
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7449/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 3d26169d4fd441e9e9078c5b2cc4c71cd45d2a9d
Author: Alex Smith
Date: Wed Jul 23 14:40:09 2014 +0100
MIPS: ptrace: Change GP regset to use correct core dump register layout
commit c23b3d1a53119849dc3c23c417124deb067aa33d upstream.
Commit 6a9c001b7ec3 ("MIPS: Switch ELF core dumper to use regsets.")
switched the core dumper to use regsets, however the GP regset code
simply makes a direct copy of the kernel's pt\_regs, which does not
match the original core dump register layout as defined in asm/reg.h.
Furthermore, the definition of pt\_regs can vary with certain Kconfig
variables, therefore the GP regset can never be relied upon to return
registers in the same layout.
Therefore, this patch changes the GP regset to match the original core
dump layout. The layout differs for 32- and 64-bit processes, so
separate implementations of the get/set functions are added for the
32- and 64-bit regsets.
Signed-off-by: Alex Smith
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7452/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 5a8f1b9122759770604094f06882ac6d382a03ed
Author: Alex Smith
Date: Wed Jul 23 14:40:07 2014 +0100
MIPS: ptrace: Test correct task's flags in task\_user\_regset\_view()
commit 65768a1a92cb12cbba87588927cf597a65d560aa upstream.
task\_user\_regset\_view() should test for TIF\_32BIT\_REGS in the flags of
the specified task, not of the current task.
Signed-off-by: Alex Smith
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7450/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 6a9c83da4fd7ae734b6604aee025bb4f11a17ff3
Author: Alex Smith
Date: Wed Jul 23 14:40:11 2014 +0100
MIPS: O32/32-bit: Fix bug which can cause incorrect system call restarts
commit e90e6fddc57055c4c6b57f92787fea1c065d440b upstream.
On 32-bit/O32, pt\_regs has a padding area at the beginning into which the
syscall arguments passed via the user stack are copied. 4 arguments
totalling 16 bytes are copied to offset 16 bytes into this area, however
the area is only 24 bytes long. This means the last 2 arguments overwrite
pt\_regs->regs[{0,1}].
If a syscall function returns an error, handle\_sys stores the original
syscall number in pt\_regs->regs[0] for syscall restart. signal.c checks
whether regs[0] is non-zero, if it is it will check whether the syscall
return value is one of the ERESTART\* codes to see if it must be
restarted.
Should a syscall be made that results in a non-zero value being copied
off the user stack into regs[0], and then returns a positive (non-error)
value that matches one of the ERESTART\* error codes, this can be mistaken
for requiring a syscall restart.
While the possibility for this to occur has always existed, it is made
much more likely to occur by commit 46e12c07b3b9 ("MIPS: O32 / 32-bit:
Always copy 4 stack arguments."), since now every syscall will copy 4
arguments and overwrite regs[0], rather than just those with 7 or 8
arguments.
Since that commit, booting Debian under a 32-bit MIPS kernel almost
always results in a hang early in boot, due to a wait4 syscall returning
a PID that matches one of the ERESTART\* codes, which then causes an
incorrect restart of the syscall.
The problem is fixed by increasing the size of the padding area so that
arguments copied off the stack will not overwrite pt\_regs->regs[{0,1}].
Signed-off-by: Alex Smith
Reviewed-by: Aurelien Jarno
Tested-by: Aurelien Jarno
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7454/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit f61e0442313415812519c0fd9405466adbd6079f
Author: Jeffrey Deans
Date: Thu Jul 17 09:20:56 2014 +0100
MIPS: GIC: Prevent array overrun
commit ffc8415afab20bd97754efae6aad1f67b531132b upstream.
A GIC interrupt which is declared as having a GIC\_MAP\_TO\_NMI\_MSK
mapping causes the cpu parameter to gic\_setup\_intr() to be increased
to 32, causing memory corruption when pcpu\_masks[] is written to again
later in the function.
Signed-off-by: Jeffrey Deans
Signed-off-by: Markos Chandras
Cc: linux-mips@linux-mips.org
Patchwork: https://patchwork.linux-mips.org/patch/7375/
Signed-off-by: Ralf Baechle
Signed-off-by: Greg Kroah-Hartman
commit 81048fbcbd07a79111277d9e608ef2afb3d90d1e
Author: Tony Battersby
Date: Fri Aug 22 15:53:35 2014 -0400
fix regression in SCSI\_IOCTL\_SEND\_COMMAND
commit 2ba136daa3ae1e881c9f586f283fcaa164767dce upstream.
blk\_rq\_set\_block\_pc() memsets rq->cmd to 0, so it should come
immediately after blk\_get\_request() to avoid overwriting the
user-supplied CDB. Also check for failure to allocate rq.
Fixes: f27b087b81b7 ("block: add blk\_rq\_set\_block\_pc()")
Signed-off-by: Tony Battersby
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 8e9f1b75adc592290d755551723c8e747a81d423
Author: Juergen Gross
Date: Mon Aug 4 13:30:02 2014 +0200
SCSI: save command pool address of Scsi\_Host
commit f6105c0808880c2c432b79bc81b37cc244c300c8 upstream.
If a scsi host driver specifies .cmd\_len in it's scsi\_host\_template, a driver's
private command pool is needed. scsi\_find\_host\_cmd\_pool() will locate it, but
scsi\_alloc\_host\_cmd\_pool() isn't saving the pool address in the host template.
This will result in an access error when the host is removed.
Avoid the problem by saving the address of a new allocated command pool where
it is expected.
Signed-off-by: Juergen Gross
Reviewed-by: Hannes Reinecke
Signed-off-by: Christoph Hellwig
Fixes: 89d9a567952baec13e26ada3e438f1b642d66b6e
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 3b1826418a950a58b00038725369709d1702a489
Author: Bart Van Assche
Date: Wed Jul 9 15:56:43 2014 +0200
scsi\_transport\_srp: Fix fast\_io\_fail\_tmo=dev\_loss\_tmo=off behavior
commit cd53eb686d2418eda938aad3c9da42b7dfa9351f upstream.
If scsi\_remove\_host() is called while an rport is in the blocked state
then scsi\_remove\_host() will only finish if the rport is unblocked
from inside a timer function. Make sure that an rport only enters the
blocked state if a timer will be started that will unblock it. This
avoids that unloading the ib\_srp kernel module after having
disconnected the initiator from the target system results in a
deadlock if both the fast\_io\_fail\_tmo and dev\_loss\_tmo parameters have
been set to "off".
Signed-off-by: Bart Van Assche
Reviewed-by: Sagi Grimberg
Reviewed-by: David Dillow
Signed-off-by: Roland Dreier
Signed-off-by: Greg Kroah-Hartman
commit 1633efbdd3ee5dccb0eba190379a0ebaf5e32cf3
Author: Janusz Dziemidowicz
Date: Thu Jul 24 15:48:46 2014 +0200
scsi: do not issue SCSI RSOC command to Promise Vtrak E610f
commit 0213436a2cc5e4a5ca2fabfaa4d3877097f3b13f upstream.
Some devices don't like REPORT SUPPORTED OPERATION CODES and will
simply timeout causing sd\_mod init to take a very very long time.
Introduce BLIST\_NO\_RSOC scsi scan flag, that stops RSOC from being
issued. Add it to Promise Vtrak E610f entry in scsi scan
blacklist. Fixes bug #79901 reported at
https://bugzilla.kernel.org/show\_bug.cgi?id=79901
Fixes: 98dcc2946adb ("SCSI: sd: Update WRITE SAME heuristics")
Signed-off-by: Janusz Dziemidowicz
Reviewed-by: Martin K. Petersen
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit fe06acc43ff994f1d8461668c40cbe4b1946c376
Author: Martin K. Petersen
Date: Tue Jul 15 12:49:17 2014 -0400
scsi: add a blacklist flag which enables VPD page inquiries
commit c1d40a527e885a40bb9ea6c46a1b1145d42b66a0 upstream.
Despite supporting modern SCSI features some storage devices continue to
claim conformance to an older version of the SPC spec. This is done for
compatibility with legacy operating systems.
Linux by default will not attempt to read VPD pages on devices that
claim SPC-2 or older. Introduce a blacklist flag that can be used to
trigger VPD page inquiries on devices that are known to support them.
Reported-by: KY Srinivasan
Tested-by: KY Srinivasan
Reviewed-by: KY Srinivasan
Signed-off-by: Martin K. Petersen
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit 689fb61cd60d2c5abf92aa65a2a3a8cc1500980a
Author: Hannes Reinecke
Date: Tue Jun 3 10:58:53 2014 +0200
scsi\_scan: Restrict sequential scan to 256 LUNs
commit 22ffeb48b7584d6cd50f2a595ed6065d86a87459 upstream.
Sequential scan for more than 256 LUNs is very fragile as
LUNs might not be numbered sequentially after that point.
SAM revisions later than SCSI-3 impose a structure on
LUNs larger than 256, making LUN numbers between 256
and 16384 illegal.
SCSI-3, however allows for plain 64-bit numbers with
no internal structure.
So restrict sequential LUN scan to 256 LUNs and add a
new blacklist flag 'BLIST\_SCSI3LUN' to scan up to
max\_lun devices.
Signed-off-by: Hannes Reinecke
Reviewed-by: Ewan Milne
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit 58ae49e974f0c1aefef0b8a1c89920268be186fd
Author: K. Y. Srinivasan
Date: Sat Jul 12 09:48:32 2014 -0700
drivers: scsi: storvsc: Correctly handle TEST\_UNIT\_READY failure
commit 3533f8603d28b77c62d75ec899449a99bc6b77a1 upstream.
On some Windows hosts on FC SANs, TEST\_UNIT\_READY can return SRB\_STATUS\_ERROR.
Correctly handle this. Note that there is sufficient sense information to
support scsi error handling even in this case.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Hannes Reinecke
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit dad79ecea0a69e2237a6d271dc6cb06178c4f523
Author: K. Y. Srinivasan
Date: Sat Jul 12 09:48:31 2014 -0700
drivers: scsi: storvsc: Set srb\_flags in all cases
commit f885fb73f64154690c2158e813de56363389ffec upstream.
Correctly set SRB flags for all valid I/O directions. Some IHV drivers on the
Windows host require this. The host validates the command and SRB flags
prior to passing the command down to native driver stack.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Hannes Reinecke
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit 29fd046376d469224a0e47cb09e7958eba5151e1
Author: K. Y. Srinivasan
Date: Sat Jul 12 09:48:29 2014 -0700
Drivers: scsi: storvsc: Fix a bug in handling VMBUS protocol version
commit adb6f9e1a8c6af1037232b59edb11277471537ea upstream.
Based on the negotiated VMBUS protocol version, we adjust the size of the storage
protocol messages. The two sizes we currently handle are pre-win8 and post-win8.
In WS2012 R2, we are negotiating higher VMBUS protocol version than the win8
version. Make adjustments to correctly handle this.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Hannes Reinecke
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit b32d9f606798ade9f1df2f5fc5b83af0e8653537
Author: K. Y. Srinivasan
Date: Sat Jul 12 09:48:27 2014 -0700
Drivers: scsi: storvsc: Set cmd\_per\_lun to reflect value supported by the Host
commit 52f9614dd8294e95d2c0929c2d4f64b077ae486f upstream.
Set cmd\_per\_lun to reflect value supported by the Host.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Hannes Reinecke
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit 0606a178c573c9425b2be321a24747a356750930
Author: K. Y. Srinivasan
Date: Sat Jul 12 09:48:26 2014 -0700
Drivers: scsi: storvsc: Change the limits to reflect the values on the host
commit 4cd83ecdac20d30725b4f96e5d7814a1e290bc7e upstream.
Hyper-V hosts can support multiple targets and multiple channels and larger number of
LUNs per target. Update the code to reflect this. With this patch we can correctly
enumerate all the paths in a multi-path storage environment.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Hannes Reinecke
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit fda813aa0353d47a41f733ba946e9576e61e72c2
Author: K. Y. Srinivasan
Date: Sat Jul 12 09:48:28 2014 -0700
Drivers: scsi: storvsc: Filter commands based on the storage protocol version
commit 8caf92d80526f3d7cc96831ec18b384ebcaccdf0 upstream.
Going forward it is possible that some of the commands that are not currently
implemented will be implemented on future Windows hosts. Even if they are not
implemented, we are told the host will corrrectly handle unsupported
commands (by returning appropriate return code and sense information).
Make command filtering depend on the host version.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Hannes Reinecke
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit cf489bce804f35cdcfb9f1be55f468b354bbe1bf
Author: K. Y. Srinivasan
Date: Sat Jul 12 09:48:30 2014 -0700
Drivers: scsi: storvsc: Implement a eh\_timed\_out handler
commit 56b26e69c8283121febedd12b3cc193384af46b9 upstream.
On Azure, we have seen instances of unbounded I/O latencies. To deal with
this issue, implement handler that can reset the timeout. Note that the
host gaurantees that it will respond to each command that has been issued.
Signed-off-by: K. Y. Srinivasan
Reviewed-by: Hannes Reinecke
[hch: added a better comment explaining the issue]
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit 33a9401e4f612a1fa9d3fac309a788676d63c228
Author: James Bottomley
Date: Sat Jul 26 12:21:26 2014 -0400
scsi: use short driver name for per-driver cmd slab caches
commit 884ffee01ddde5af260c7a5d1359c658aa1f0a11 upstream.
hostt->name might contain space, so use the ->proc\_name short name instead
when creating per-driver command slabs.
Signed-off-by: James Bottomley
Reported-by: poma
Tested-by: poma
Reviewed-by: Vladimir Davydov
Reviewed-by: Martin K. Petersen
Signed-off-by: Christoph Hellwig
Signed-off-by: Greg Kroah-Hartman
commit fe86f9f8379957b2ad25c46f496c8d09da288ce7
Author: Aneesh Kumar K.V
Date: Wed Aug 13 12:32:02 2014 +0530
powerpc/thp: Use ACCESS\_ONCE when loading pmdp
commit 7e467245bf5226db34c4b12d3cbacfa2f7a15a8b upstream.
We would get wrong results in compiler recomputed old\_pmd. Avoid
that by using ACCESS\_ONCE
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit f1a4952b4820a8526ab21b46315d2c9e4656dbed
Author: Aneesh Kumar K.V
Date: Wed Aug 13 12:32:01 2014 +0530
powerpc/thp: Invalidate with vpn in loop
commit 969b7b208f7408712a3526856e4ae60ad13f6928 upstream.
As per ISA, for 4k base page size we compare 14..65 bits of VA specified
with the entry\_VA in tlb. That implies we need to make sure we do a
tlbie with all the possible 4k va we used to access the 16MB hugepage.
With 64k base page size we compare 14..57 bits of VA. Hence we cannot
ignore the lower 24 bits of va while tlbie .We also cannot tlb
invalidate a 16MB entry with just one tlbie instruction because
we don't track which va was used to instantiate the tlb entry.
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 0de65ab57ee716b916c627d4a0f6c7eaeefd906f
Author: Aneesh Kumar K.V
Date: Wed Aug 13 12:32:00 2014 +0530
powerpc/thp: Handle combo pages in invalidate
commit fc0479557572375100ef16c71170b29a98e0d69a upstream.
If we changed base page size of the segment, either via sub\_page\_protect
or via remap\_4k\_pfn, we do a demote\_segment which doesn't flush the hash
table entries. We do a lazy hash page table flush for all mapped pages
in the demoted segment. This happens when we handle hash page fault for
these pages.
We use \_PAGE\_COMBO bit along with \_PAGE\_HASHPTE to indicate whether a
pte is backed by 4K hash pte. If we find \_PAGE\_COMBO not set on the pte,
that implies that we could possibly have older 64K hash pte entries in
the hash page table and we need to invalidate those entries.
Use \_PAGE\_COMBO to determine the page size with which we should
invalidate the hash table entries on unmap.
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit c3395a6acb808b467282037ee39966feda9749a7
Author: Aneesh Kumar K.V
Date: Wed Aug 13 12:31:59 2014 +0530
powerpc/thp: Invalidate old 64K based hash page mapping before insert of 4k pte
commit 629149fae478f0ac6bf705a535708b192e9c6b59 upstream.
If we changed base page size of the segment, either via sub\_page\_protect
or via remap\_4k\_pfn, we do a demote\_segment which doesn't flush the hash
table entries. We do a lazy hash page table flush for all mapped pages
in the demoted segment. This happens when we handle hash page fault
for these pages.
We use \_PAGE\_COMBO bit along with \_PAGE\_HASHPTE to indicate whether a
pte is backed by 4K hash pte. If we find \_PAGE\_COMBO not set on the pte,
that implies that we could possibly have older 64K hash pte entries in
the hash page table and we need to invalidate those entries.
Handle this correctly for 16M pages
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit d4597434cfe82039d63f14e2bde1871ed9e29586
Author: Aneesh Kumar K.V
Date: Wed Aug 13 12:31:58 2014 +0530
powerpc/thp: Don't recompute vsid and ssize in loop on invalidate
commit fa1f8ae80f8bb996594167ff4750a0b0a5a5bb5d upstream.
The segment identifier and segment size will remain the same in
the loop, So we can compute it outside. We also change the
hugepage\_invalidate interface so that we can use it the later patch
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 03adf1ec744e77282731b5f5056eac9d4de01121
Author: Aneesh Kumar K.V
Date: Wed Aug 13 12:31:57 2014 +0530
powerpc/thp: Add write barrier after updating the valid bit
commit b0aa44a3dfae3d8f45bd1264349aa87f87b7774f upstream.
With hugepages, we store the hpte valid information in the pte page
whose address is stored in the second half of the PMD. Use a
write barrier to make sure clearing pmd busy bit and updating
hpte valid info are ordered properly.
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 54bd94f7d19a9d23690b1421c0f1ff168c34c013
Author: Gavin Shan
Date: Mon Aug 11 19:16:20 2014 +1000
powerpc/pseries: Avoid deadlock on removing ddw
commit 5efbabe09d986f25c02d19954660238fcd7f008a upstream.
Function remove\_ddw() could be called in of\_reconfig\_notifier and
we potentially remove the dynamic DMA window property, which invokes
of\_reconfig\_notifier again. Eventually, it leads to the deadlock as
following backtrace shows.
The patch fixes the above issue by deferring releasing the dynamic
DMA window property while releasing the device node.
=============================================
[ INFO: possible recursive locking detected ]
3.16.0+ #428 Tainted: G W
---------------------------------------------
drmgr/2273 is trying to acquire lock:
((of\_reconfig\_chain).rwsem){.+.+..}, at: [] \
.\_\_blocking\_notifier\_call\_chain+0x40/0x78
but task is already holding lock:
((of\_reconfig\_chain).rwsem){.+.+..}, at: [] \
.\_\_blocking\_notifier\_call\_chain+0x40/0x78
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0
----
lock((of\_reconfig\_chain).rwsem);
lock((of\_reconfig\_chain).rwsem);
\*\*\* DEADLOCK \*\*\*
May be due to missing lock nesting notation
2 locks held by drmgr/2273:
#0: (sb\_writers#4){.+.+.+}, at: [] \
.vfs\_write+0xb0/0x1f8
#1: ((of\_reconfig\_chain).rwsem){.+.+..}, at: [] \
.\_\_blocking\_notifier\_call\_chain+0x40/0x78
stack backtrace:
CPU: 17 PID: 2273 Comm: drmgr Tainted: G W 3.16.0+ #428
Call Trace:
[c0000000137e7000] [c000000000013d9c] .show\_stack+0x88/0x148 (unreliable)
[c0000000137e70b0] [c00000000083cd34] .dump\_stack+0x7c/0x9c
[c0000000137e7130] [c0000000000b8afc] .\_\_lock\_acquire+0x128c/0x1c68
[c0000000137e7280] [c0000000000b9a4c] .lock\_acquire+0xe8/0x104
[c0000000137e7350] [c00000000083588c] .down\_read+0x4c/0x90
[c0000000137e73e0] [c000000000091890] .\_\_blocking\_notifier\_call\_chain+0x40/0x78
[c0000000137e7490] [c000000000091900] .blocking\_notifier\_call\_chain+0x38/0x48
[c0000000137e7520] [c000000000682a28] .of\_reconfig\_notify+0x34/0x5c
[c0000000137e75b0] [c000000000682a9c] .of\_property\_notify+0x4c/0x54
[c0000000137e7650] [c000000000682bf0] .of\_remove\_property+0x30/0xd4
[c0000000137e76f0] [c000000000052a44] .remove\_ddw+0x144/0x168
[c0000000137e7790] [c000000000053204] .iommu\_reconfig\_notifier+0x30/0xe0
[c0000000137e7820] [c00000000009137c] .notifier\_call\_chain+0x6c/0xb4
[c0000000137e78c0] [c0000000000918ac] .\_\_blocking\_notifier\_call\_chain+0x5c/0x78
[c0000000137e7970] [c000000000091900] .blocking\_notifier\_call\_chain+0x38/0x48
[c0000000137e7a00] [c000000000682a28] .of\_reconfig\_notify+0x34/0x5c
[c0000000137e7a90] [c000000000682e14] .of\_detach\_node+0x44/0x1fc
[c0000000137e7b40] [c0000000000518e4] .ofdt\_write+0x3ac/0x688
[c0000000137e7c20] [c000000000238430] .proc\_reg\_write+0xb8/0xd4
[c0000000137e7cd0] [c0000000001cbeac] .vfs\_write+0xec/0x1f8
[c0000000137e7d70] [c0000000001cc3b0] .SyS\_write+0x58/0xa0
[c0000000137e7e30] [c00000000000a064] syscall\_exit+0x0/0x98
Signed-off-by: Gavin Shan
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit db11f8f5b326c96062ebd973505f13e47d1e127d
Author: Gavin Shan
Date: Mon Aug 11 19:16:19 2014 +1000
powerpc/pseries: Failure on removing device node
commit f1b3929c232784580e5d8ee324b6bc634e709575 upstream.
While running command "drmgr -c phb -r -s 'PHB 528'", following
backtrace jumped out because the target device node isn't marked
with OF\_DETACHED by of\_detach\_node(), which caused by error
returned from memory hotplug related reconfig notifier when
disabling CONFIG\_MEMORY\_HOTREMOVE. The patch fixes it.
ERROR: Bad of\_node\_put() on /pci@800000020000210/ethernet@0
CPU: 14 PID: 2252 Comm: drmgr Tainted: G W 3.16.0+ #427
Call Trace:
[c000000012a776a0] [c000000000013d9c] .show\_stack+0x88/0x148 (unreliable)
[c000000012a77750] [c00000000083cd34] .dump\_stack+0x7c/0x9c
[c000000012a777d0] [c0000000006807c4] .of\_node\_release+0x58/0xe0
[c000000012a77860] [c00000000038a7d0] .kobject\_release+0x174/0x1b8
[c000000012a77900] [c00000000038a884] .kobject\_put+0x70/0x78
[c000000012a77980] [c000000000681680] .of\_node\_put+0x28/0x34
[c000000012a77a00] [c000000000681ea8] .\_\_of\_get\_next\_child+0x64/0x70
[c000000012a77a90] [c000000000682138] .of\_find\_node\_by\_path+0x1b8/0x20c
[c000000012a77b40] [c000000000051840] .ofdt\_write+0x308/0x688
[c000000012a77c20] [c000000000238430] .proc\_reg\_write+0xb8/0xd4
[c000000012a77cd0] [c0000000001cbeac] .vfs\_write+0xec/0x1f8
[c000000012a77d70] [c0000000001cc3b0] .SyS\_write+0x58/0xa0
[c000000012a77e30] [c00000000000a064] syscall\_exit+0x0/0x98
Signed-off-by: Gavin Shan
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 816b2856e5227e719fbd322d16cfc1b04d4d3523
Author: Aneesh Kumar K.V
Date: Wed Aug 13 12:32:03 2014 +0530
powerpc/mm: Use read barrier when creating real\_pte
commit 85c1fafd7262e68ad821ee1808686b1392b1167d upstream.
On ppc64 we support 4K hash pte with 64K page size. That requires
us to track the hash pte slot information on a per 4k basis. We do that
by storing the slot details in the second half of pte page. The pte bit
\_PAGE\_COMBO is used to indicate whether the second half need to be
looked while building real\_pte. We need to use read memory barrier while
doing that so that load of hidx is not reordered w.r.t \_PAGE\_COMBO
check. On the store side we already do a lwsync in \_\_hash\_page\_4K
Signed-off-by: Aneesh Kumar K.V
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 110d3bf24724ce8e7d1e29b8d9b4fe43cc0c1024
Author: Andrey Utkin
Date: Mon Aug 4 23:13:10 2014 +0300
powerpc/mm/numa: Fix break placement
commit b00fc6ec1f24f9d7af9b8988b6a198186eb3408c upstream.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=81631
Reported-by: David Binderman
Signed-off-by: Andrey Utkin
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit 41b071acdb61eb93c28812773eb44d7cb12a650c
Author: Vaidyanathan Srinivasan
Date: Sun Aug 3 13:23:08 2014 +0530
powerpc/cpuidle: Fix parsing of idle state flags from device-tree
commit 95707d852856aec1cbdad1873ff2dc5161a5cb91 upstream.
Flags from device-tree need to be parsed with accessors for
interpreting correct value in little-endian.
Signed-off-by: Vaidyanathan Srinivasan
Reviewed-by: Preeti U. Murthy
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit ca0cfb304a5edcac127daca8e71394dab2430e16
Author: Felipe Balbi
Date: Tue Jul 8 14:09:12 2014 -0500
regulator: tps65218: fix DCDC4 linear voltage range
commit 42ab0f3915f22728f54bb1f3c0dcf38ab2335b5b upstream.
The second range of this particular regulator,
starts at 1.60V, not as 1.55V as it was originally
implied by code.
Signed-off-by: Felipe Balbi
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit f50c51dbc6df53136c88d8beaa83688ca936ef15
Author: Nikesh Oswal
Date: Fri Jul 4 09:55:16 2014 +0100
regulator: arizona-ldo1: remove bypass functionality
commit 5b919f3ebb533cbe400664837e24f66a0836b907 upstream.
WM5110/8280 devices do not support bypass mode for LDO1 so remove
the bypass callbacks registered with regulator core.
Signed-off-by: Nikesh Oswal
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 216acfd79ec39da9e97ffd0102e00115f41aa727
Author: Tony Lindgren
Date: Tue Aug 19 08:24:05 2014 -0700
mfd: twl4030-power: Fix PM idle pin configuration to not conflict with regulators
commit daebabd578647440d41fc9b48d8c7a88dc2f7ab5 upstream.
Commit 43fef47f94a1 (mfd: twl4030-power: Add a configuration to turn
off oscillator during off-idle) added support for configuring the PMIC
to cut off resources during deeper idle states to save power.
This however caused regression for n900 display power that needed the
PMIC configuration to be disabled with commit d937678ab625 (ARM: dts:
Revert enabling of twl configuration for n900).
Turns out the root cause of the problem is that we must use
TWL4030\_RESCONFIG\_UNDEF instead of DEV\_GRP\_NULL to avoid disabling
regulators that may have been enabled before the init function
for twl4030-power.c runs. With TWL4030\_RESCONFIG\_UNDEF we let the
regulator framework control the regulators like it should. Here we
need to only configure the sys\_clken and sys\_off\_mode triggers for
the regulators that cannot be done by the regulator framework as
it's not running at that point.
This allows us to enable the PMIC configuration for n900.
Fixes: 43fef47f94a1 (mfd: twl4030-power: Add a configuration to turn off oscillator during off-idle)
Signed-off-by: Tony Lindgren
Tested-by: Aaro Koskinen
Signed-off-by: Lee Jones
Signed-off-by: Greg Kroah-Hartman
commit 35dca0e6c20e797175ce8c5f47b03630bb397af3
Author: Jeff Mahoney
Date: Tue Aug 12 13:46:09 2014 -0700
drivers/mfd/rtsx\_usb.c: export device table
commit 1813908986e36119228c158aae1c6a0267c99e77 upstream.
The rtsx\_usb driver contains the table for the devices it supports but
doesn't export it. As a result, no alias is generated and it doesn't
get loaded automatically.
Via https://bugzilla.novell.com/show\_bug.cgi?id=890096
Signed-off-by: Jeff Mahoney
Reported-by: Marcel Witte
Cc: Roger Tseng
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 7107d2df95b6b5d0af3759645a813e429fe16f78
Author: Michael Welling
Date: Mon Jul 28 18:01:04 2014 -0500
mfd: omap-usb-host: Fix improper mask use.
commit 46de8ff8e80a6546aa3d2fdf58c6776666301a0c upstream.
single-ulpi-bypass is a flag used for older OMAP3 silicon.
The flag when set, can excite code that improperly uses the
OMAP\_UHH\_HOSTCONFIG\_UPLI\_BYPASS define to clear the corresponding bit.
Instead it clears all of the other bits disabling all of the ports in
the process.
Signed-off-by: Michael Welling
Signed-off-by: Lee Jones
Signed-off-by: Greg Kroah-Hartman
commit 0a7e596a04fa03d0ae99c71b362055f23c6417cc
Author: Sasha Levin
Date: Wed Aug 6 16:08:14 2014 -0700
kernel/smp.c:on\_each\_cpu\_cond(): fix warning in fallback path
commit 618fde872163e782183ce574c77f1123e2be8887 upstream.
The rarely-executed memry-allocation-failed callback path generates a
WARN\_ON\_ONCE() when smp\_call\_function\_single() succeeds. Presumably
it's supposed to warn on failures.
Signed-off-by: Sasha Levin
Cc: Christoph Lameter
Cc: Gilad Ben-Yossef
Cc: David Rientjes
Cc: Joonsoo Kim
Cc: Tejun Heo
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit da574914df05176343a1f610c9edf30cd70dec0e
Author: Li Zhong
Date: Wed Aug 6 16:07:56 2014 -0700
mm: fix potential infinite loop in dissolve\_free\_huge\_pages()
commit d0177639310d23c7739500df3c6ce6fdfe34acec upstream.
It is possible for some platforms, such as powerpc to set HPAGE\_SHIFT to
0 to indicate huge pages not supported.
When this is the case, hugetlbfs could be disabled during boot time:
hugetlbfs: disabling because there are no supported hugepage sizes
Then in dissolve\_free\_huge\_pages(), order is kept maximum (64 for
64bits), and the for loop below won't end: for (pfn = start\_pfn; pfn <
end\_pfn; pfn += 1 << order)
As suggested by Naoya, below fix checks hugepages\_supported() before
calling dissolve\_free\_huge\_pages().
[rientjes@google.com: no legitimate reason to call dissolve\_free\_huge\_pages() when !hugepages\_supported()]
Signed-off-by: Li Zhong
Acked-by: Naoya Horiguchi
Acked-by: David Rientjes
Signed-off-by: David Rientjes
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit b39ff9dfd3ba34f08f4cfa8aaf1872aa2d0099d6
Author: Pranith Kumar
Date: Wed Aug 6 16:03:48 2014 -0700
sh: fix build error by adding generic ioport\_{map/unmap}()
commit e04aca4a769e16cf4f9b8a4bd3e761711640dc46 upstream.
Fix build error as reported by Geert Uytterhoeven here:
http://kisskb.ellerman.id.au/kisskb/buildresult/11607865/
The error happens when CONFIG\_HAS\_IOPORT\_MAP=n because of which there
are missing definitions of ioport\_map/unmap(). Fix this build error by
adding these prototypes.
Signed-off-by: Pranith Kumar
Reported-by: Geert Uytterhoeven
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit cb963376a2b229d6aeced5595aff9ef5e262b4b5
Author: Ben Hutchings
Date: Fri Aug 29 15:18:58 2014 -0700
ocfs2: do not write error flag to user structure we cannot copy from/to
commit 2b462638e41ea62230297c21c4da9955937b7a3c upstream.
If we failed to copy from the structure, writing back the flags leaks 31
bits of kernel memory (the rest of the ir\_flags field).
In any case, if we cannot copy from/to the structure, why should we
expect putting just the flags to work?
Also make sure ocfs2\_info\_handle\_freeinode() returns the right error
code if the copy\_to\_user() fails.
Fixes: ddee5cdb70e6 ('Ocfs2: Add new OCFS2\_IOC\_INFO ioctl for ocfs2 v8.')
Signed-off-by: Ben Hutchings
Cc: Joel Becker
Acked-by: Mark Fasheh
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5a07babe4aa8d7a67e5a4a1626f0cab421e38fd8
Author: Jan Kara
Date: Wed Aug 6 16:03:28 2014 -0700
fanotify: fix double free of pending permission events
commit 5838d4442bd5971687b72221736222637e03140d upstream.
Commit 85816794240b ("fanotify: Fix use after free for permission
events") introduced a double free issue for permission events which are
pending in group's notification queue while group is being destroyed.
These events are freed from fanotify\_handle\_event() but they are not
removed from groups notification queue and thus they get freed again
from fsnotify\_flush\_notify().
Fix the problem by removing permission events from notification queue
before freeing them if we skip processing access response. Also expand
comments in fanotify\_release() to explain group shutdown in detail.
Fixes: 85816794240b9659e66e4d9b0df7c6e814e5f603
Signed-off-by: Jan Kara
Reported-by: Douglas Leeder
Tested-by: Douglas Leeder
Reported-by: Heinrich Schuchard
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 769b2b894ee6cf55fd26149261b69579f2c3a9cd
Author: Eric Paris
Date: Wed Jul 23 15:36:26 2014 -0400
CAPABILITIES: remove undefined caps from all processes
commit 7d8b6c63751cfbbe5eef81a48c22978b3407a3ad upstream.
This is effectively a revert of 7b9a7ec565505699f503b4fcf61500dceb36e744
plus fixing it a different way...
We found, when trying to run an application from an application which
had dropped privs that the kernel does security checks on undefined
capability bits. This was ESPECIALLY difficult to debug as those
undefined bits are hidden from /proc/$PID/status.
Consider a root application which drops all capabilities from ALL 4
capability sets. We assume, since the application is going to set
eff/perm/inh from an array that it will clear not only the defined caps
less than CAP\_LAST\_CAP, but also the higher 28ish bits which are
undefined future capabilities.
The BSET gets cleared differently. Instead it is cleared one bit at a
time. The problem here is that in security/commoncap.c::cap\_task\_prctl()
we actually check the validity of a capability being read. So any task
which attempts to 'read all things set in bset' followed by 'unset all
things set in bset' will not even attempt to unset the undefined bits
higher than CAP\_LAST\_CAP.
So the 'parent' will look something like:
CapInh: 0000000000000000
CapPrm: 0000000000000000
CapEff: 0000000000000000
CapBnd: ffffffc000000000
All of this 'should' be fine. Given that these are undefined bits that
aren't supposed to have anything to do with permissions. But they do...
So lets now consider a task which cleared the eff/perm/inh completely
and cleared all of the valid caps in the bset (but not the invalid caps
it couldn't read out of the kernel). We know that this is exactly what
the libcap-ng library does and what the go capabilities library does.
They both leave you in that above situation if you try to clear all of
you capapabilities from all 4 sets. If that root task calls execve()
the child task will pick up all caps not blocked by the bset. The bset
however does not block bits higher than CAP\_LAST\_CAP. So now the child
task has bits in eff which are not in the parent. These are
'meaningless' undefined bits, but still bits which the parent doesn't
have.
The problem is now in cred\_cap\_issubset() (or any operation which does a
subset test) as the child, while a subset for valid cap bits, is not a
subset for invalid cap bits! So now we set durring commit creds that
the child is not dumpable. Given it is 'more priv' than its parent. It
also means the parent cannot ptrace the child and other stupidity.
The solution here:
1) stop hiding capability bits in status
This makes debugging easier!
2) stop giving any task undefined capability bits. it's simple, it you
don't put those invalid bits in CAP\_FULL\_SET you won't get them in init
and you won't get them in any other task either.
This fixes the cap\_issubset() tests and resulting fallout (which
made the init task in a docker container untraceable among other
things)
3) mask out undefined bits when sys\_capset() is called as it might use
~0, ~0 to denote 'all capabilities' for backward/forward compatibility.
This lets 'capsh --caps="all=eip" -- -c /bin/bash' run.
4) mask out undefined bit when we read a file capability off of disk as
again likely all bits are set in the xattr for forward/backward
compatibility.
This lets 'setcap all+pe /bin/bash; /bin/bash' run
Signed-off-by: Eric Paris
Reviewed-by: Kees Cook
Cc: Andrew Vagin
Cc: Andrew G. Morgan
Cc: Serge E. Hallyn
Cc: Kees Cook
Cc: Steve Grubb
Cc: Dan Walsh
Signed-off-by: James Morris
Signed-off-by: Greg Kroah-Hartman
commit dd7ffbb74d3cac97e7e21cafd3e08b251a57e794
Author: Stefan Berger
Date: Thu Jun 19 15:00:19 2014 -0400
tpm: Properly clean sysfs entries in error path
commit b49e1043c48dac23f64fba684d31c4a96c1ffaa0 upstream.
Properly clean the sysfs entries in the error path
Reported-by: Dmitry Kasatkin
Signed-off-by: Stefan Berger
Reviewed-by: Jason Gunthorpe
Signed-off-by: Peter Huewe
Signed-off-by: Greg Kroah-Hartman
commit 1cd6ecaa75ed92e3f10da74dfb4249f591e76911
Author: Jason Gunthorpe
Date: Wed May 21 18:26:44 2014 -0600
tpm: Provide a generic means to override the chip returned timeouts
commit 8e54caf407b98efa05409e1fee0e5381abd2b088 upstream.
Some Atmel TPMs provide completely wrong timeouts from their
TPM\_CAP\_PROP\_TIS\_TIMEOUT query. This patch detects that and returns
new correct values via a DID/VID table in the TIS driver.
Tested on ARM using an AT97SC3204T FW version 37.16
[PHuewe: without this fix these 'broken' Atmel TPMs won't function on
older kernels]
Signed-off-by: "Berg, Christopher"
Signed-off-by: Jason Gunthorpe
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Peter Huewe
commit 46a9a8a69b445d35027b762d96223903b4bed6b8
Author: Jarkko Sakkinen
Date: Fri May 9 14:23:10 2014 +0300
tpm: missing tpm\_chip\_put in tpm\_get\_random()
commit 3e14d83ef94a5806a865b85b513b4e891923c19b upstream.
Regression in 41ab999c. Call to tpm\_chip\_put is missing. This
will cause TPM device driver not to unload if tmp\_get\_random()
is called.
Signed-off-by: Jarkko Sakkinen
Signed-off-by: Peter Huewe
Signed-off-by: Greg Kroah-Hartman
commit a54ad360436e05ad5e45da99ec5c828a43d58053
Author: Guenter Roeck
Date: Wed Aug 13 11:21:34 2014 -0700
firmware: Do not use WARN\_ON(!spin\_is\_locked())
commit aee530cfecf4f3ec83b78406bac618cec35853f8 upstream.
spin\_is\_locked() always returns false for uniprocessor configurations
in several architectures, so do not use WARN\_ON with it.
Use lockdep\_assert\_held() instead to also reduce overhead in
non-debug kernels.
Signed-off-by: Guenter Roeck
Signed-off-by: Matt Fleming
Signed-off-by: Greg Kroah-Hartman
commit 12a7f32045064c7018831865c0cee9e9f0c651eb
Author: Alex Deucher
Date: Fri Aug 1 20:05:29 2014 +0200
drm/radeon: use packet2 for nop on hawaii with old firmware
commit 0e16e4cfde70e1cf00f9fe3a8f601d10e73e0ec6 upstream.
Older firmware didn't support the new nop packet.
v2 (Andreas Boll):
- Drop usage of packet3 for new firmware
Signed-off-by: Alex Deucher
Reviewed-by: Christian König  (v1)
Signed-off-by: Andreas Boll
Signed-off-by: Greg Kroah-Hartman
commit 50c24c23ce2f3959d78ea919c23e3ca4ce8b6ce6
Author: Vaidyanathan Srinivasan
Date: Sun Aug 3 14:54:05 2014 +0530
powerpc/cpufreq: Add pr\_warn() on OPAL firmware failures
commit 6174bac8c7ff73a86ae9a967d1c9cadc478023ae upstream.
Cpufreq depends on platform firmware to implement PStates. In case of
platform firmware failure, cpufreq should not panic host kernel with
BUG\_ON(). Less severe pr\_warn() will suffice.
Add firmware\_has\_feature(FW\_FEATURE\_OPALv3) check to
skip probing for device-tree on non-powernv platforms.
Signed-off-by: Vaidyanathan Srinivasan
Acked-by: Gautham R. Shenoy
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit e54d01f3f215bdc91f22dfc469d17a5bc5713ea3
Author: Christian Borntraeger
Date: Tue Aug 5 09:57:51 2014 +0200
s390/locking: Reenable optimistic spinning
commit 36e7fdaa1a04fcf65b864232e1af56a51c7814d6 upstream.
commit 4badad352a6bb202ec68afa7a574c0bb961e5ebc (locking/mutex: Disable
optimistic spinning on some architectures) fenced spinning for
architectures without proper cmpxchg.
There is no need to disable mutex spinning on s390, though:
The instructions CS,CSG and friends provide the proper guarantees.
(We dont implement cmpxchg with locks).
Signed-off-by: Christian Borntraeger
Cc: Ingo Molnar
Cc: Peter Zijlstra
Signed-off-by: Heiko Carstens
Signed-off-by: Martin Schwidefsky
Signed-off-by: Greg Kroah-Hartman
commit c301ca64d49d3f8c6a379f1d8f216f6d921d45b7
Author: Mark A. Greer
Date: Tue Jul 1 20:28:32 2014 -0700
spi: omap2-mcspi: Configure hardware when slave driver changes mode
commit 97ca0d6cc118716840ea443e010cb3d5f2d25eaf upstream.
Commit id 2bd16e3e23d9df41592c6b257c59b6860a9cc3ea
(spi: omap2-mcspi: Do not configure the controller
on each transfer unless needed) does its job too
well so omap2\_mcspi\_setup\_transfer() isn't called
even when an SPI slave driver changes 'spi->mode'.
The result is that the mode requested by the SPI
slave driver never takes effect.
Fix this by adding the 'mode' member to the
omap2\_mcspi\_cs structure which holds the mode
value that the hardware is configured for.
When the SPI slave driver changes 'spi->mode'
it will be different than the value of this new
member and the SPI master driver will know that
the hardware must be reconfigured (by calling
omap2\_mcspi\_setup\_transfer()).
Fixes: 2bd16e3e23 (spi: omap2-mcspi: Do not configure the controller on each transfer unless needed)
Signed-off-by: Mark A. Greer
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit c7a9922ea282bf6f7dea0d72a9ad77b385a0d1a5
Author: Thomas Petazzoni
Date: Sun Jul 27 23:53:19 2014 +0200
spi: orion: fix incorrect handling of cell-index DT property
commit e06871cd2c92e5c65d7ca1d32866b4ca5dd4ac30 upstream.
In commit f814f9ac5a81 ("spi/orion: add device tree binding"), Device
Tree support was added to the spi-orion driver. However, this commit
reads the "cell-index" property, without taking into account the fact
that DT properties are big-endian encoded.
Since most of the platforms using spi-orion with DT have apparently
not used anything but cell-index = <0>, the problem was not
visible. But as soon as one starts using cell-index = <1>, the problem
becomes clearly visible, as the master->bus\_num gets a wrong value
(actually it gets the value 0, which conflicts with the first bus that
has cell-index = <0>).
This commit fixes that by using of\_property\_read\_u32() to read the
property value, which does the appropriate endianness conversion when
needed.
Fixes: f814f9ac5a81 ("spi/orion: add device tree binding")
Signed-off-by: Thomas Petazzoni
Acked-by: Sebastian Hesselbarth
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit 311aaa721355422823f4f8f800b6c97444dc1548
Author: Joerg Roedel
Date: Tue Aug 5 17:50:15 2014 +0200
iommu/amd: Fix cleanup\_domain for mass device removal
commit 9b29d3c6510407d91786c1cf9183ff4debb3473a upstream.
When multiple devices are detached in \_\_detach\_device, they
are also removed from the domains dev\_list. This makes it
unsafe to use list\_for\_each\_entry\_safe, as the next pointer
might also not be in the list anymore after \_\_detach\_device
returns. So just repeatedly remove the first element of the
list until it is empty.
Tested-by: Marti Raudsepp
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit b21afca79e1ae4df9a7e5f83ae039b67ff471878
Author: Joerg Roedel
Date: Tue Aug 5 12:55:45 2014 +0200
iommu/vt-d: Defer domain removal if device is assigned to a driver
commit e7f9fa5498d91fcdc63d93007ba43f36b1a30538 upstream.
When the BUS\_NOTIFY\_DEL\_DEVICE event is received the device
might still be attached to a driver. In this case the domain
can't be released as the mappings might still be in use.
Defer the domain removal in this case until we receivce the
BUS\_NOTIFY\_UNBOUND\_DRIVER event.
Cc: Jiang Liu
Cc: David Woodhouse
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 7ff8d594f315bddf3c38886eff7b7b69d54ea106
Author: Gavin Shan
Date: Wed Aug 6 17:10:16 2014 +1000
powerpc/powernv: Fix IOMMU group lost
commit 763fe0addb8fe15ccea67c0aebddc06f4bb25439 upstream.
When we take full hotplug to recover from EEH errors, PCI buses
could be involved. For the case, the child devices of involved
PCI buses can't be attached to IOMMU group properly, which is
caused by commit 3f28c5a ("powerpc/powernv: Reduce multi-hit of
iommu\_add\_device()").
When adding the PCI devices of the newly created PCI buses to
the system, the IOMMU group is expected to be added in (C).
(A) fails to bind the IOMMU group because bus->is\_added is
false. (B) fails because the device doesn't have binding IOMMU
table yet. bus->is\_added is set to true at end of (C) and
pdev->is\_added is set to true at (D).
pcibios\_add\_pci\_devices()
pci\_scan\_bridge()
pci\_scan\_child\_bus()
pci\_scan\_slot()
pci\_scan\_single\_device()
pci\_scan\_device()
pci\_device\_add()
pcibios\_add\_device() A: Ignore
device\_add() B: Ignore
pcibios\_fixup\_bus()
pcibios\_setup\_bus\_devices()
pcibios\_setup\_device() C: Hit
pcibios\_finish\_adding\_to\_bus()
pci\_bus\_add\_devices()
pci\_bus\_add\_device() D: Add device
If the parent PCI bus isn't involved in hotplug, the IOMMU
group is expected to be bound in (B). (A) should fail as the
sysfs entries aren't populated.
The patch fixes the issue by reverting commit 3f28c5a and remove
WARN\_ON() in iommu\_add\_device() to allow calling the function
even the specified device already has associated IOMMU group.
Reported-by: Thadeu Lima de Souza Cascardo
Signed-off-by: Gavin Shan
Acked-by: Wei Yang
Signed-off-by: Benjamin Herrenschmidt
Signed-off-by: Greg Kroah-Hartman
commit c5f57c45ba9ffe115247b4cf0663a77e5c5e2305
Author: Alex Williamson
Date: Thu Jul 3 09:57:02 2014 -0600
iommu/vt-d: Exclude devices using RMRRs from IOMMU API domains
commit c875d2c1b8083cd627ea0463e20bf22c2d7421ee upstream.
The user of the IOMMU API domain expects to have full control of
the IOVA space for the domain. RMRRs are fundamentally incompatible
with that idea. We can neither map the RMRR into the IOMMU API
domain, nor can we guarantee that the device won't continue DMA with
the area described by the RMRR as part of the new domain. Therefore
we must prevent such devices from being used by the IOMMU API.
Signed-off-by: Alex Williamson
Cc: David Woodhouse
Signed-off-by: Joerg Roedel
Signed-off-by: Greg Kroah-Hartman
commit 7714941e7793edcf553c13b16ff1272636e7bc25
Author: Paul Bolle
Date: Wed Apr 16 12:47:43 2014 -0300
media: sms: Remove CONFIG\_ prefix from Kconfig symbols
commit 3c4b422adb7694418848cefc2a4669d63192c649 upstream.
X-Patchwork-Delegate: mchehab@redhat.com
Remove the CONFIG\_ prefix from two Kconfig symbols in a dependency for
SMS\_SIANO\_DEBUGFS. This prefix is invalid inside Kconfig files.
Note that the current (common sense) dependency on SMS\_USB\_DRV and
SMS\_SDIO\_DRV being equal ensures that SMS\_SIANO\_DEBUGFS will not
violate its constraints. These constraint are that:
- it should only be built if SMS\_USB\_DRV is set;
- it can't be builtin if USB support is modular.
So drop the dependency on SMS\_USB\_DRV, as it is unneeded.
Fixes: 6c84b214284e ("[media] sms: fix randconfig building error")
Reported-by: Martin Walch
Signed-off-by: Paul Bolle
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 23d5b9703056510c93360e714e7750c97d7e2596
Author: Laurent Pinchart
Date: Mon Jun 23 18:00:22 2014 -0300
media: v4l: vb2: Fix stream start and buffer completion race
commit bd994ddb2a12a3ff48cd549ec82cdceaea9614df upstream.
videobuf2 stores the driver streaming state internally in the queue in
the start\_streaming\_called variable. The state is set right after the
driver start\_stream operation returns, and checked in the
vb2\_buffer\_done() function, typically called from the frame completion
interrupt handler. A race condition exists if the hardware finishes
processing the first frame before the start\_stream operation returns.
Fix this by setting start\_streaming\_called to 1 before calling the
start\_stream operation, and resetting it to 0 if the operation fails.
Signed-off-by: Laurent Pinchart
Reviewed-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit f9cf6fb924215602c913dfbce30f971c284f5e8b
Author: Laurent Pinchart
Date: Wed May 21 17:39:16 2014 -0300
media: v4l: vsp1: Remove the unneeded vsp1\_video\_buffer video field
commit e51daefc228aa164adcc17fe8fce0f856ad0a1cc upstream.
The field is assigned but never read, remove it.
This fixes a bug caused by the struct vb2\_buffer field not being be the
very first field of the vsp1\_video\_buffer buffer structure as required
by videobuf2.
Reported-by: Takanari Hayama
Signed-off-by: Laurent Pinchart
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 85c9db42b859ec8abe846fa1d9b82e25c102c107
Author: Philipp Zabel
Date: Mon May 26 10:55:51 2014 -0300
media: mt9v032: fix hblank calculation
commit f17bc3f4707eb87bdb80b895911c551cdd606fbd upstream.
Since (min\_row\_time - crop->width) can be negative, we have to do a signed
comparison here. Otherwise max\_t casts the negative value to unsigned int
and sets min\_hblank to that invalid value.
Signed-off-by: Philipp Zabel
Signed-off-by: Laurent Pinchart
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 8d0653d418affb792181fb66b9c8484c540fcb51
Author: Salva Peiró
Date: Sat Jun 7 11:41:44 2014 -0300
media: media-device: Remove duplicated memset() in media\_enum\_entities()
commit f8ca6ac00d2ba24c5557f08f81439cd3432f0802 upstream.
After the zeroing the whole struct struct media\_entity\_desc u\_ent,
it is no longer necessary to memset(0) its u\_ent.name field.
Signed-off-by: Salva Peiró
Signed-off-by: Laurent Pinchart
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit e38eb1d85058184924ee041008b40eb131c51029
Author: Mauro Carvalho Chehab
Date: Sun Jun 8 13:54:57 2014 -0300
media: au0828: Only alt setting logic when needed
commit 64ea37bbd8a5815522706f0099ad3f11c7537e15 upstream.
It seems that there's a bug at au0828 hardware/firmware
related to alternate setting: when the device is already at
alt 5, a further call causes the URBs to receive -ESHUTDOWN.
I found two different encarnations of this issue:
1) at qv4l2, it fails the second time we try to open the
video screen;
2) at xawtv, when audio underrun occurs, with is very
frequent, at least on my test machine.
The fix is simple: just check if alt=5 before calling
set\_usb\_interface().
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit fe382d625f96935e0b978bb89d15818906ea4f41
Author: Mauro Carvalho Chehab
Date: Mon Jul 21 13:28:15 2014 -0300
media: xc4000: Fix get\_frequency()
commit 4c07e32884ab69574cfd9eb4de3334233c938071 upstream.
The programmed frequency on xc4000 is not the middle
frequency, but the initial frequency on the bandwidth range.
However, the DVB API works with the middle frequency.
This works fine on set\_frontend, as the device calculates
the needed offset. However, at get\_frequency(), the returned
value is the initial frequency. That's generally not a big
problem on most drivers, however, starting with changeset
6fe1099c7aec, the frequency drift is taken into account at
dib7000p driver.
This broke support for PCTV 340e, with uses dib7000p demod and
xc4000 tuner.
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 32b07402b65c8dc15d079f502e0dcd249858a059
Author: Mauro Carvalho Chehab
Date: Mon Jul 21 14:21:18 2014 -0300
media: xc5000: Fix get\_frequency()
commit a3eec916cbc17dc1aaa3ddf120836cd5200eb4ef upstream.
The programmed frequency on xc5000 is not the middle
frequency, but the initial frequency on the bandwidth range.
However, the DVB API works with the middle frequency.
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 9ae91b17b20eafecf8dc4416f86383c76dcdc6a4
Author: Jan Kara
Date: Wed Aug 6 19:43:56 2014 +0200
reiserfs: Fix use after free in journal teardown
commit 01777836c87081e4f68c4a43c9abe6114805f91e upstream.
If do\_journal\_release() races with do\_journal\_end() which requeues
delayed works for transaction flushing, we can leave work items for
flushing outstanding transactions queued while freeing them. That
results in use after free and possible crash in run\_timers\_softirq().
Fix the problem by not requeueing works if superblock is being shut down
(MS\_ACTIVE not set) and using cancel\_delayed\_work\_sync() in
do\_journal\_release().
Signed-off-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit 906f27708b9126cd6793e35094d283f5f259ec0b
Author: Jeff Mahoney
Date: Mon Aug 4 19:51:47 2014 -0400
reiserfs: fix corruption introduced by balance\_leaf refactor
commit 27d0e5bc85f3341b9ba66f0c23627cf9d7538c9d upstream.
Commits f1f007c308e (reiserfs: balance\_leaf refactor, pull out
balance\_leaf\_insert\_left) and cf22df182bf (reiserfs: balance\_leaf
refactor, pull out balance\_leaf\_paste\_left) missed that the `body'
pointer was getting repositioned. Subsequent users of the pointer
would expect it to be repositioned, and as a result, parts of the
tree would get overwritten. The most common observed corruption
is indirect block pointers being overwritten.
Since the body value isn't actually used anymore in the called routines,
we can pass back the offset it should be shifted. We constify the body
and ih pointers in the balance\_leaf as a mostly-free preventative measure.
Reported-and-tested-by: Jeff Chua
Signed-off-by: Jeff Mahoney
Signed-off-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman


=== Content from bugzilla.redhat.com_b29b4ec5_20250124_211317.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1142073)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1142073)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1142073)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1142073

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1142073**](show_bug.cgi?id=1142073)
(CVE-2014-6418)
- [CVE-2014-6418](https://access.redhat.com/security/cve/CVE-2014-6418) kernel: libceph: missing validation of auth reply

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2014-6418 kernel: libceph: missing validation of auth reply

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2014-6418 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1142285](show_bug.cgi?id=1142285) [1142287](show_bug.cgi?id=1142287) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1142025](show_bug.cgi?id=1142025) | | TreeView+ | [depends on](buglist.cgi?bug_id=1142073&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1142073&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2014-09-16 06:35 UTC by Wade Mealing | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-17 06:13 UTC ([History](show_activity.cgi?id=1142073)) | | [CC List:](page.cgi?id=fields.html#cclist) | 7 users (show)  aquini dhoward fhrbata kernel-mgr nmurray plougher pmatouse | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2019-08-08 13:18:23 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1142073#c0)  Wade Mealing    2014-09-16 06:35:39 UTC  ```  A flaw was found in the kernels handling of ceph authentication tickets.    The auth reply could be returned to a client unvalidated.   ```  [Comment 2](show_bug.cgi?id=1142073#c2)  Wade Mealing    2014-09-17 05:45:05 UTC  ``` Statement:  This issue did not affect the versions of the Linux kernel packages as shipped with Red Hat Enterprise Linux 5, 6, 7.0 and Red Hat Enterprise MRG 2 (as they did not include support for this feature).   ```  [Comment 3](show_bug.cgi?id=1142073#c3)  Wade Mealing    2014-09-18 01:36:31 UTC  ``` Upstream fixes:  <https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=c27a3e4d667fdcad3db7b104f75659478e0c68d8>   ```  [Comment 4](show_bug.cgi?id=1142073#c4)  Wade Mealing    2014-10-02 03:50:32 UTC  ``` The tracking bug [[bug 1142287](show_bug.cgi?id=1142287)] has been closed as dupe, being tracked in [BZ 1142285](show_bug.cgi?id=1142285).   ```  [Comment 5](show_bug.cgi?id=1142073#c5)  Product Security DevOps Team    2019-08-08 13:18:23 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2014-6418>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1142073&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from tracker.ceph.com_b5432f9f_20250124_211255.html ===


⚲

### Project

### General

### Profile

* [Sign in](/login)
* [Register](/account/register)

* [Home](/)
* [Projects](/projects)
* [Help](https://www.redmine.org/guide)

[Search](/projects/ceph-kclient/search):

 Linux kernel client[All Projects](/projects?jump=issues)
# [Ceph](/projects/ceph?jump=issues) » Linux kernel client

* [Overview](/projects/ceph-kclient)
* [Activity](/projects/ceph-kclient/activity)
* [Roadmap](/projects/ceph-kclient/roadmap)
* [Issues](/projects/ceph-kclient/issues)
* [Spent time](/projects/ceph-kclient/time_entries)
* [Gantt](/projects/ceph-kclient/issues/gantt)
* [Calendar](/projects/ceph-kclient/issues/calendar)

### Custom queries

* [Backlog](/projects/ceph-kclient/issues?query_id=26)
* [Bug queue](/projects/ceph-kclient/issues?query_id=27)
* [Bug triage](/projects/ceph-kclient/issues?query_id=40)
* [Crash queue](/projects/ceph-kclient/issues?query_id=241)
* [Crash triage](/projects/ceph-kclient/issues?query_id=240)
* [Feedback](/projects/ceph-kclient/issues?query_id=30)
* [My issues](/projects/ceph-kclient/issues?query_id=7)
* [Need Review](/projects/ceph-kclient/issues?query_id=32)
* [Pending backports](/projects/ceph-kclient/issues?query_id=60)
* [Product Backlog Scrub](/projects/ceph-kclient/issues?query_id=45)

Actions
Copy link
## Bug #8979

closed

### GPF kernel panics - auth?

Added by [Ilya Dryomov](/users/1296) [over 10 years](/projects/ceph-kclient/activity?from=2014-07-31 "07/31/2014 02:53 AM") ago.
Updated [over 9 years](/projects/ceph-kclient/activity?from=2015-06-15 "06/15/2015 08:16 AM") ago.

Status:ResolvedPriority:HighAssignee:[Ilya Dryomov](/users/1296)Category:-Target version:-% Done:

|  |
| --- |

0%

Source:Community (user)Backport:Regression:NoSeverity:3 - minorReviewed:Affected Versions:ceph-qa-suite:Crash signature (v1):Crash signature (v2):Tags (freeform):

---

**Description**

From James Eckersall, "GPF kernel panics" on ceph-users.

I've had a fun time with ceph this week.
We have a cluster with 4 OSD (20 OSD's per) servers, 3 mons and a server mapping ~200 rbd's and presenting cifs shares.

We're using cephx and the export node has its own cephx auth key.

I made a change to the key last week, adding rwx access to another pool.

Since that point, we had sporadic kernel panics of the export node.

It got to the point where it would barely finish booting up and would panic.

Once I removed the extra pool I had added to the auth key, it hasn't crashed again.

I'm a bit concerned that a change to an auth key can cause this type of crash.
There were no log entries on mon/osd/export node regarding the key at all, so it was only by searching my memory for what had changed that allowed me to resolve the problem.

From what I could tell from the key, the format was correct and the pool that I added did exist, so I am confused as to how this would have caused kernel panics.

The rbd's are mapped by the rbdmap service on boot.
All our ceph servers are running Ubuntu 14.04 (kernel 3.13.0-30-generic). Ceph packages are from the Ubuntu repos, version 0.80.1-0ubuntu1.1.
I should have probably mentioned this info in the initial mail :)

This problem also seemed to get gradually worse over time.
We had a couple of sporadic crashes at the start of the week, escalating to the node being unable to stay up for more than a couple of minutes before panicking.

```

[   32.713504] general protection fault: 0000 [#1] SMP
[   32.724718] Modules linked in: ipt_REJECT xt_tcpudp iptable_filter ip_tables x_tables rbd libceph libcrc32c gpio_ich dcdbas intel_rapl x86_pkg_temp_thermal intel_powerclamp coretemp kvm_intel kvm crct10dif_pclmul joydev crc32_pclmul ghash_clmulni_intel aesni_intel aes_x86_64 lrw gf128mul glue_helper ablk_helper cryptd sb_edac edac_core shpchp lpc_ich mei_me mei wmi ipmi_si mac_hid acpi_power_meter 8021q garp stp mrp llc bonding lp parport nfsd auth_rpcgss nfs_acl nfs lockd sunrpc fscache hid_generic igb ixgbe i2c_algo_bit usbhid dca hid ptp ahci libahci pps_core megaraid_sas mdio
[   32.843936] CPU: 18 PID: 5030 Comm: tr Not tainted 3.13.0-30-generic #54-Ubuntu
[   32.860163] Hardware name: Dell Inc. PowerEdge R620/0PXXHP, BIOS 1.6.0 03/07/2013
[   32.876774] task: ffff880417b15fc0 ti: ffff8804273f4000 task.ti: ffff8804273f4000
[   32.893384] RIP: 0010:[<ffffffff811a19c5>]  [<ffffffff811a19c5>] kmem_cache_alloc+0x75/0x1e0
[   32.912198] RSP: 0018:ffff8804273f5d40  EFLAGS: 00010286
[   32.924015] RAX: 0000000000000000 RBX: 0000000000000000 RCX: 00000000000011ed
[   32.939856] RDX: 00000000000011ec RSI: 00000000000080d0 RDI: ffff88042f803700
[   32.955696] RBP: ffff8804273f5d70 R08: 0000000000017260 R09: ffffffff811be63c
[   32.971559] R10: 8080808080808080 R11: 0000000000000000 R12: 7d10f8ec0c3cb928
[   32.987421] R13: 00000000000080d0 R14: ffff88042f803700 R15: ffff88042f803700
[   33.003284] FS:  0000000000000000(0000) GS:ffff88042fd20000(0000) knlGS:0000000000000000
[   33.021281] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   33.034068] CR2: 00007f01a8fced40 CR3: 000000040e52f000 CR4: 00000000000407e0
[   33.049929] Stack:
[   33.054456]  ffffffff811be63c 0000000000000000 ffff88041be52780 ffff880428052000
[   33.071259]  ffff8804273f5f2c 00000000ffffff9c ffff8804273f5d98 ffffffff811be63c
[   33.088084]  0000000000000080 ffff8804273f5f2c ffff8804273f5e40 ffff8804273f5e30
[   33.104908] Call Trace:
[   33.110399]  [<ffffffff811be63c>] ? get_empty_filp+0x5c/0x180
[   33.123188]  [<ffffffff811be63c>] get_empty_filp+0x5c/0x180
[   33.135593]  [<ffffffff811cc03d>] path_openat+0x3d/0x620
[   33.147422]  [<ffffffff811cd47a>] do_filp_open+0x3a/0x90
[   33.159250]  [<ffffffff811a1985>] ? kmem_cache_alloc+0x35/0x1e0
[   33.172405]  [<ffffffff811cc6bf>] ? getname_flags+0x4f/0x190
[   33.185004]  [<ffffffff811da237>] ? __alloc_fd+0xa7/0x130
[   33.197025]  [<ffffffff811bbb99>] do_sys_open+0x129/0x280
[   33.209049]  [<ffffffff81020d25>] ? syscall_trace_enter+0x145/0x250
[   33.222992]  [<ffffffff811bbd0e>] SyS_open+0x1e/0x20
[   33.234053]  [<ffffffff8172aeff>] tracesys+0xe1/0xe6
[   33.245112] Code: dc 00 00 49 8b 50 08 4d 8b 20 49 8b 40 10 4d 85 e4 0f 84 17 01 00 00 48 85 c0 0f 84 0e 01 00 00 49 63 46 20 48 8d 4a 01 4d 8b 06 <49> 8b 1c 04 4c 89 e0 65 49 0f c7 08 0f 94 c0 84 c0 74 b9 49 63
[   33.292549] RIP  [<ffffffff811a19c5>] kmem_cache_alloc+0x75/0x1e0
[   33.306192]  RSP <ffff8804273f5d40>

```

---

**Files**

| [dmesg](/attachments/1330) (103 KB) [dmesg](/attachments/download/1330/dmesg "Download") |  | Ilya Dryomov, 07/31/2014 02:53 AM |  |
| --- | --- | --- | --- |

---

**Related issues**
[2](/issues?issue_id=9560%2C9561&set_filter=true&status_id=%2A) (0 open — [2 closed](/issues?issue_id=9560%2C9561&set_filter=true&status_id=c))

|  | Related to Linux kernel client - [Bug #9560](/issues/9560): libceph: msg kmalloc failure handling on the reply path | Rejected |  | 09/22/2014 |  | |  | | --- | | Actions |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
|  | Related to Linux kernel client - [Bug #9561](/issues/9561): libceph: do not crash if auth reply is not understood | Rejected |  | 09/22/2014 |  | |  | | --- | | Actions |

Related to
Is duplicate of
Has duplicate
Blocks
Blocked by
Precedes
Follows
Copied to
Copied from
Issue #
Delay:  days

Cancel

* [History](/issues/8979?tab=history)
* [Notes](/issues/8979?tab=notes)
* [Property changes](/issues/8979?tab=properties)

ActionsCopy link
[#1](#note-1)
#### Updated by [Sage Weil](/users/3) [over 10 years](/projects/ceph-kclient/activity?from=2014-08-04 "08/04/2014 06:48 AM") ago

```

Hi,
The auth caps were as follows:

caps: [mon] allow r
caps: [osd] allow rwx pool=hosting_windows_sharedweb, allow rwx
pool=infra_systems, allow rwx pool=hosting_linux_sharedweb

I changed them (just adding a pool to the list) to:

caps: [mon] allow r
caps: [osd] allow rwx pool=hosting_windows_sharedweb, allow rwx
pool=infra_systems, allow rwx pool=hosting_linux_sharedweb, allow rwx pool=test

```

I suspect a simple buffer overflow on the auth ticket size ...

ActionsCopy link
[#2](#note-2)
#### Updated by [Sage Weil](/users/3) [over 10 years](/projects/ceph-kclient/activity?from=2014-08-04 "08/04/2014 06:57 AM") ago

yeah:

#define TEMP\_TICKET\_BUF\_LEN 256

ActionsCopy link
[#3](#note-3)
#### Updated by [Sage Weil](/users/3) [over 10 years](/projects/ceph-kclient/activity?from=2014-08-04 "08/04/2014 07:07 AM") ago

pushed wip-8979 which removes the fixed buffer size. but, we still need to make things not crash when the auth reply processing fails. that could still happen if we get a huge ticket (>4k) and kmalloc fails on a large page size. or the auth reply from the mon is simply not understood by the client.

ActionsCopy link
[#4](#note-4)
#### Updated by [Sage Weil](/users/3) [over 10 years](/projects/ceph-kclient/activity?from=2014-09-13 "09/13/2014 09:25 PM") ago

* **Status** changed from *New* to *Pending Backport*

ActionsCopy link
[#5](#note-5)
#### Updated by [Ilya Dryomov](/users/1296) [over 10 years](/projects/ceph-kclient/activity?from=2014-09-22 "09/22/2014 04:08 AM") ago

* **Status** changed from *Pending Backport* to *Resolved*

Landed in 3.17-rc5. Opened [#9560](/issues/9560 "Bug: libceph: msg kmalloc failure handling on the reply path (Rejected)") and [#9561](/issues/9561 "Bug: libceph: do not crash if auth reply is not understood (Rejected)") for the issues mentioned above.

ActionsCopy link
[#6](#note-6)
#### Updated by [Nathan Cutler](/users/2544) [over 9 years](/projects/ceph-kclient/activity?from=2015-06-15 "06/15/2015 08:16 AM") ago

* **Regression** set to *No*

<https://github.com/torvalds/linux/commit/73c3d4812b4c755efeca0140f606f83772a39ce4>

Actions
Copy link

Also available in: [Atom](/issues/8979.atom)
[PDF](/issues/8979.pdf)

Powered by [Redmine](https://www.redmine.org/) © 2006-2024 Jean-Philippe Lang

Loading...



=== Content from www.ubuntu.com_d59e4131_20250124_211311.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2377-1: Linux kernel (OMAP4) vulnerabilities

9 October 2014

Several security issues were fixed in the kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 12.04](/security/notices?release=precise)

## Packages

* [linux-ti-omap4](/security/cves?package=linux-ti-omap4) - Linux kernel for OMAP4

## Details

Steven Vittitoe reported multiple stack buffer overflows in Linux kernel's

magicmouse HID driver. A physically proximate attacker could exploit this

flaw to cause a denial of service (system crash) or possibly execute

arbitrary code via specially crafted devices. ([CVE-2014-3181](/security/CVE-2014-3181))

A bounds check error was discovered in the driver for the Logitech Unifying

receivers and devices. A physically proximate attacker could exploit this

flaw to to cause a denial of service (invalid kfree) or to execute

arbitrary code. ([CVE-2014-3182](/security/CVE-2014-3182))

Ben Hawkes reported some off by one errors for report descriptors in the

Linux kernel's HID stack. A physically proximate attacker could exploit

these flaws to cause a denial of service (out-of-bounds write) via a

specially crafted device. ([CVE-2014-3184](/security/CVE-2014-3184))

Several bounds check flaws allowing for buffer overflows were discovered in

the Linux kernel's Whiteheat USB serial driver. A physically proximate

attacker could exploit these flaws to cause a denial of service (system

crash) via a specially crafted device. ([CVE-2014-3185](/security/CVE-2014-3185))

Steven Vittitoe reported a buffer overflow in the Linux kernel's PicoLCD

HID device driver. A physically proximate attacker could exploit this flaw

to cause a denial of service (system crash) or possibly execute arbitrary

code via a specially craft device. ([CVE-2014-3186](/security/CVE-2014-3186))

A flaw was discovered in the Linux kernel's UDF filesystem (used on some

CD-ROMs and DVDs) when processing indirect ICBs. An attacker who can cause

CD, DVD or image file with a specially crafted inode to be mounted can

cause a denial of service (infinite loop or stack consumption).

([CVE-2014-6410](/security/CVE-2014-6410))

James Eckersall discovered a buffer overflow in the Ceph filesystem in the

Linux kernel. A remote attacker could exploit this flaw to cause a denial

of service (memory consumption and panic) or possibly have other

unspecified impact via a long unencrypted auth ticket. ([CVE-2014-6416](/security/CVE-2014-6416))

James Eckersall discovered a flaw in the handling of memory allocation

failures in the Ceph filesystem. A remote attacker could exploit this flaw

to cause a denial of service (system crash) or possibly have unspecified

other impact. ([CVE-2014-6417](/security/CVE-2014-6417))

James Eckersall discovered a flaw in how the Ceph filesystem validates auth

replies. A remote attacker could exploit this flaw to cause a denial of

service (system crash) or possibly have other unspecified impact.

([CVE-2014-6418](/security/CVE-2014-6418))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 12.04

* [linux-image-3.2.0-1455-omap4](https://launchpad.net/ubuntu/%2Bsource/linux-ti-omap4)
  -
  [3.2.0-1455.75](https://launchpad.net/ubuntu/%2Bsource/linux-ti-omap4/3.2.0-1455.75)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed. If

you use linux-restricted-modules, you have to update that package as

well to get modules which work with the new kernel version. Unless you

manually uninstalled the standard kernel metapackages (e.g. linux-generic,

linux-server, linux-powerpc), a standard system upgrade will automatically

perform this as well.

## References

* [CVE-2014-3181](/security/CVE-2014-3181)
* [CVE-2014-3182](/security/CVE-2014-3182)
* [CVE-2014-3184](/security/CVE-2014-3184)
* [CVE-2014-3185](/security/CVE-2014-3185)
* [CVE-2014-3186](/security/CVE-2014-3186)
* [CVE-2014-6410](/security/CVE-2014-6410)
* [CVE-2014-6416](/security/CVE-2014-6416)
* [CVE-2014-6417](/security/CVE-2014-6417)
* [CVE-2014-6418](/security/CVE-2014-6418)

## Related notices

* [USN-2378-1](/security/notices/USN-2378-1)
* [USN-2376-1](/security/notices/USN-2376-1)
* [USN-2379-1](/security/notices/USN-2379-1)
* [USN-2395-1](/security/notices/USN-2395-1)
* [USN-2394-1](/security/notices/USN-2394-1)
* [USN-2375-1](/security/notices/USN-2375-1)
* [USN-2374-1](/security/notices/USN-2374-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from access.redhat.com_b8e653f4_20250126_033329.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)


