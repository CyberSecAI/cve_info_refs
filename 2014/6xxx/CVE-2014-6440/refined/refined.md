```json
[
  {
    "Content": "Multiple vulnerabilities have been found in VLC allowing remote attackers to execute arbitrary code or cause Denial of Service.\n\n### Affected packages\n\n| Package | **media-video/vlc** on all architectures |\n| --- | --- |\n| Affected versions | < **2.2.1-r1** |\n| Unaffected versions | >= **2.2.1-r1** |\n\n### Background\n\nVLC is a cross-platform media player and streaming server.\n\n### Description\n\nMultiple vulnerabilities have been discovered in VLC. Please review the\nCVE identifiers referenced below for details.\n\n### Impact\n\nRemote attackers could possibly execute arbitrary code or cause Denial\nof Service.\n\n### Workaround\n\nThere is no known work around at this time.\n\n### Resolution\n\nAll VLC users should upgrade to the latest version:\n\n```\n # emerge --sync\n # emerge --ask --oneshot --verbose \">=media-video/vlc-2.2.1-r1\"\n```\n### References\n\n* [CVE-2014-1684](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1684)\n* [CVE-2014-6440](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6440)\n* [CVE-2014-9597](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9597)\n* [CVE-2014-9598](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9598)\n* [CVE-2014-9625](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9625)\n* [CVE-2014-9626](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9626)\n* [CVE-2014-9627](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9627)\n* [CVE-2014-9628](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9628)\n* [CVE-2014-9629](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9629)\n* [CVE-2014-9630](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9630)\n* [CVE-2015-1202](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1202)\n* [CVE-2015-1203](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1203)\n* [CVE-2015-5949](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5949)\n* [CVE-2015-5949](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-5949)\n",
    "Root cause of vulnerability": "The content references CVE-2014-6440 and indicates multiple vulnerabilities were discovered in VLC, without specifying root cause.",
    "Weaknesses/vulnerabilities present": "Multiple vulnerabilities, including a heap overflow.",
    "Impact of exploitation": "Remote attackers could possibly execute arbitrary code or cause Denial of Service.",
    "Attack vectors": "Remote",
     "Required attacker capabilities/position": "Remote attacker"
  },
  {
    "Content": "Executive Summary\n\nVLC versions before 2.1.5 contain a vulnerability in the transcode module that\nmay allow a corrupted stream to overflow buffers on the heap. With a\nnon-malicious input, this could lead to heap corruption and a crash. However,\nunder the right circumstances, a malicious attacker could potentially use this\nvulnerability to hijack program execution, and on some platforms, execute\narbitrary code.\n\nMethodology\n\nThis vulnerability was found by fuzzing using [CERT's Basic Fuzzing Framework (BFF)](https://www.cert.org/vulnerability-analysis/tools/bff.cfm)\nand a [sample file from mplayerhq](http://samples.mplayerhq.hu/Divx4-bugs/Ikari_and_Rei_in_the_hospital-Shadowcry.avi). Testing was initially performed on\nDebian Sid (x86) using the VLC version 2.1.2-2+b3 from Debian, and later on\nWindows XP 32-bit using VLC version 2.1.3 from upstream.\n\nAfter some time, BFF produced a [fuzzed file](http://billblough.net/files/sf_49e6f9517c74d73db54fb7baa29d9bed-550-minimized.avi) that caused the following crash:\n\n```\n    *** Error in `/usr/bin/vlc': free(): corrupted unsorted chunks: 0xb384fd68 ***\n    ======= Backtrace: =========\n    /lib/i386-linux-gnu/i686/cmov/libc.so.6(+0x75e52)[0xb756be52]\n    /lib/i386-linux-gnu/i686/cmov/libc.so.6(+0x76b90)[0xb756cb90]\n    /usr/lib/libvlccore.so.7(+0x7df4b)[0xb7481f4b]\n    /usr/lib/vlc/plugins/audio_filter/libmpgatofixed32_plugin.so(+0xb5a)[0xb3466b5a]\n    /usr/lib/libvlccore.so.7(aout_FiltersPlay+0x131)[0xb7477021]\n    /usr/lib/vlc/plugins/stream_out/libstream_out_transcode_plugin.so(+0x579a)[0xb47a979a]\n    /usr/lib/vlc/plugins/stream_out/libstream_out_transcode_plugin.so(+0x20f8)[0xb47a60f8]\n    /usr/lib/libvlccore.so.7(+0xa3ce1)[0xb74a7ce1]\n    /usr/lib/libvlccore.so.7(+0x3a0bf)[0xb743e0bf]\n    /lib/i386-linux-gnu/i686/cmov/libpthread.so.0(+0x6cf1)[0xb76b2cf1]\n    /lib/i386-linux-gnu/i686/cmov/libc.so.6(clone+0x5e)[0xb75e5c3e]\n\n```\n\nTesting under [valgrind](http://valgrind.org/) showed multiple invalid writes past the end of allocated\nheap chunks (heap overflow), and following the execution using [gdb](https://www.gnu.org/software/gdb/) confirmed\nthat this was not a false positive.\n\n## Root Cause\n\nFurther investigation narrowed the issue to two functions in\n`modules/audio_filter/converter/mpgatofixed32.c`.\n\nIn the function `Convert`, this code allocates heap space based on the number of samples,\nbits, and channels detected:\n\n```\n    size_t i_out_size = p_block->i_nb_samples *\n    p_filter->fmt_out.audio.i_bitspersample *\n    p_filter->fmt_out.audio.i_channels / 8;\n\n    block_t *p_out = block_Alloc( i_out_size );\n```\n\nHowever, in the function `DoWork`, the samples and channels are detected using\na different method:\n\n```\n    struct mad_pcm * p_pcm = &p_sys->mad_synth.pcm;\n    unsigned int i_samples = p_pcm->length;\n    mad_fixed_t const * p_left = p_pcm->samples[0];\n    mad_fixed_t const * p_right = p_pcm->samples[1];\n    float *p_samples = (float *)p_out_buf->p_buffer;\n\n    if( i_samples != p_out_buf->i_nb_samples )\n    {\n        msg_Err( p_filter, \"unexpected samples count (corrupt stream?): \"\n                 \"%u / %u\", i_samples, p_out_buf->i_nb_samples );\n        p_sys->i_reject_count = 3;\n        goto reject;\n    }\n\n    /* Interleave and keep buffers in mad_fixed_t format */\n    if ( p_pcm->channels == 2 )\n    {\n        while ( i_samples-- )\n        {\n            //assert( *p_left < MAD_F_ONE );\n            //assert( *p_left >= -MAD_F_ONE );\n            //assert( *p_right < MAD_F_ONE );\n            //assert( *p_right >= -MAD_F_ONE );\n            *p_samples++ = (float)*p_left++ / (float)MAD_F_ONE;\n            *p_samples++ = (float)*p_right++ / (float)MAD_F_ONE;\n        }\n    }\n    else\n    {\n        assert( p_pcm->channels == 1 );\n        while ( i_samples-- )\n        {\n            //assert( *p_left < MAD_F_ONE );\n            //assert( *p_left >= -MAD_F_ONE );\n            *p_samples++ = (float)*p_left++ / (float)MAD_F_ONE;\n        }\n    }\n\n```\n\nWith a sufficiently corrupted input stream, this allows for a situation where\nthe buffer is allocated to contain one channel of data, but then two\nchannels of data are written to it, causing the write to overflow the\nbuffer.\n\n## Remediation\n\nPrior to being notified of this issue, the VLC team had already made changes to\nthe 2.2 development branch [here](http://git.videolan.org/?p=vlc.git;a=commit;h=a3a150b91f09620dc0d81c22db591a20faf4b2a5), [here](http://git.videolan.org/?p=vlc.git;a=commit;h=39a99d25872f64dacd470fda86ba2193a55cda52), and [here](http://git.videolan.org/?p=vlc.git;a=commit;h=26989ea2d98380eef28843ffa8ca490e8f9d6dae) that corrects this\nissue by reinitializing the filters when a format change is detected. However,\nthe fixes had not yet been backported to the 2.1 maintenance branch.\n\nOnce notified, the VLC team quickly resolved the issue by backporting the\nrelevant patches to the maintenance branch [here](http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=28bd6670a26bf88c2523b7302e2c22f8ca210bb7), [here](http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=feca6658b4b84b4bc8b7a08431e811813277d31b), and\n[here](http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=e40a4a1a54be2b69e4e001451f0dd91f3857a976). They also added an additional check on both the\n[development](http://git.videolan.org/?p=vlc.git;a=commit;h=a113b849e428b71813a569021bd10d6974f6621f) and [maintenance](http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=a5bee4c5cf0c8fca0d1ddaf570aeebc78e824b15) branches for good measure.\n\n[CVE-2014-6440](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6440) was assigned to this issue.\n\n## Timeline\n\n2014-04-18: VLC team notified of issue\n\n2014-04-19: Fixed in VLC repository\n\n2014-07-06: VLC 2.1.5 maintenance release",
    "Root cause of vulnerability": "A heap overflow vulnerability exists in the VLC transcode module. The Convert function allocates heap space based on detected samples, bits and channels, but the DoWork function uses a different method to detect these values, which can result in a smaller buffer being allocated than is required.",
    "Weaknesses/vulnerabilities present": "Heap overflow in the VLC transcode module due to inconsistent detection of audio parameters.",
    "Impact of exploitation": "A corrupted stream can cause heap corruption leading to a crash, and potentially allowing a malicious attacker to hijack program execution and execute arbitrary code on some platforms.",
    "Attack vectors": "Maliciously crafted media file.",
     "Required attacker capabilities/position": "Attacker must be able to provide a malicious media file to a vulnerable version of VLC."
  },
  {
    "Content": "Executive Summary\n-----------------\n\nVLC versions before 2.1.5 contain a vulnerability in the transcode module that\nmay allow a corrupted stream to overflow buffers on the heap. With a\nnon-malicious input, this could lead to heap corruption and a crash.  However,\nunder the right circumstances, a malicious attacker could potentially use this\nvulnerability to hijack program execution, and on some platforms, execute\narbitrary code.\n\nRemediation\n-----------\n\nPrior to being notified of this issue, the VLC team had already made changes to\nthe 2.2 development branch [0][1][2] that corrects this issue by reinitilizing\nthe filters when a format change is detected. However, the fixes had not yet\nbeen backported to the 2.1 maintenance branch.\n\nOnce notified, the VLC team quickly resolved the issue by backporting the\nrelevant patches to the maintenance branch [3][4][5]. They also added an\nadditional check on both the development[6] and maintenance[7] branches for\ngood measure.\n\nCVE-2014-6440 [8] was assigned to this issue.\n\nTimeline\n--------\n\n 2014-04-18: VLC team notified of issue\n\n 2014-04-19: Fixed in VLC repository\n\n 2014-07-06: VLC 2.1.5 maintenance release\n\nA more detailed writeup can be found on my blog [9].\n\nPlease note, I am not subscribed to the list, so please CC me if you reply.\n\nBill\n\n[0]: <http://git.videolan.org/?p=vlc.git;a=commit;h=a3a150b91f09620dc0d81c22db591a20faf4b2a5>\n[1]: <http://git.videolan.org/?p=vlc.git;a=commit;h=39a99d25872f64dacd470fda86ba2193a55cda52>\n[2]: <http://git.videolan.org/?p=vlc.git;a=commit;h=26989ea2d98380eef28843ffa8ca490e8f9d6dae>\n[3]: <http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=28bd6670a26bf88c2523b7302e2c22f8ca210bb7>\n[4]: <http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=feca6658b4b84b4bc8b7a08431e811813277d31b>\n[5]: <http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=e40a4a1a54be2b69e4e001451f0dd91f3857a976>\n[6]: <http://git.videolan.org/?p=vlc.git;a=commit;h=a113b849e428b71813a569021bd10d6974f6621f>\n[7]: <http://git.videolan.org/?p=vlc/vlc-2.1.git;a=commit;h=a5bee4c5cf0c8fca0d1ddaf570aeebc78e824b15>\n[8]: <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6440>\n[9]: <http://billblough.net/blog/2015-03-04-cve-2014-6440-heap-overflow-in-vlc-transcode-module>",
    "Root cause of vulnerability": "Heap overflow in the VLC transcode module.  The allocation size is determined by one method while the actual data written is based on a different detection method. This can result in a smaller buffer being allocated than what is required to store the data leading to overflow.",
    "Weaknesses/vulnerabilities present": "Heap overflow",
    "Impact of exploitation": "Heap corruption and a crash; potential to hijack program execution and execute arbitrary code on some platforms.",
    "Attack vectors": "A corrupted stream",
    "Required attacker capabilities/position": "A user needs to open a specially crafted video file"
  }
]
```