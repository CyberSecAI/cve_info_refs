=== Content from advisories.mageia.org_035d59c7_20250125_023502.html ===

# [Advisories](index.html) » MGASA-2015-0017

## Updated glpi package fixes security vulnerabilities

Publication date: 09 Jan 2015

Modification date: 09 Jan 2015

Type: security

Affected Mageia releases :
[4](4.html)

CVE:
[CVE-2014-5032](CVE-2014-5032.html)
,
[CVE-2014-8360](CVE-2014-8360.html)
,
[CVE-2014-9258](CVE-2014-9258.html)

## Description

```
Updated glpi package fixes security vulnerabilities:

Due to a bug in GLPI before 0.84.7, a user without access to cost information
can in fact see the information when selecting cost as a search criteria
(CVE-2014-5032).

An issue in GLPI before 0.84.8 may allow arbitrary local files to be included
by PHP through an autoload function (CVE-2014-8360).

SQL injection vulnerability in ajax/getDropdownValue.php in GLPI before 0.85.1
allows remote authenticated users to execute arbitrary SQL commands via the
condition parameter (CVE-2014-9258).

```

## References

* <https://bugs.mageia.org/show_bug.cgi?id=14933>
* [http://www.glpi-project.org/spip.php?page=annonce&id\_breve=326⟨=en](http://www.glpi-project.org/spip.php?page=annonce&id_breve=326&lang=en)
* [http://www.glpi-project.org/spip.php?page=annonce&id\_breve=330⟨=en](http://www.glpi-project.org/spip.php?page=annonce&id_breve=330&lang=en)
* [http://www.glpi-project.org/spip.php?page=annonce&id\_breve=334⟨=en](http://www.glpi-project.org/spip.php?page=annonce&id_breve=334&lang=en)
* <http://tlk.tuxfamily.org/doku.php?id=writeup:cve-2014-8360>
* <https://lists.fedoraproject.org/pipermail/package-announce/2015-January/147296.html>
* <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-5032>
* <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-8360>
* <https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-9258>

## SRPMS

### 4/core

* glpi-0.84.3-1.2.mga4



=== Content from tlk.tuxfamily.org_5aecfd50_20250125_023504.html ===


* [Aller au contenu](#dokuwiki__content)

# [tlk wiki](/doku.php?id=start "[H]")

### Outils pour utilisateurs

* [S'identifier](/doku.php?id=writeup:cve-2014-8360-en&do=login&sectok=84e7b30aa8b7f49d282f15dd184f82eb "S'identifier")

### Outils du site

Rechercher
OutilsAfficher le texte sourceAnciennes révisionsLiens de retourDerniers changementsGestionnaire MultimédiaPlan du siteS'identifier>

* [Derniers changements](/doku.php?id=writeup:cve-2014-8360-en&do=recent "Derniers changements [R]")
* [Gestionnaire Multimédia](/doku.php?id=writeup:cve-2014-8360-en&do=media&ns=writeup "Gestionnaire Multimédia")
* [Plan du site](/doku.php?id=writeup:cve-2014-8360-en&do=index "Plan du site [X]")

Piste: • [cve-2014-8360-en](/doku.php?id=writeup:cve-2014-8360-en "writeup:cve-2014-8360-en")

---

writeup:cve-2014-8360-en

### Table des matières

* [GLPI - CVE-2014-8360](#glpi_-_cve-2014-8360)
  + [First Patch](#first_patch)
  + [Second patch](#second_patch)

# GLPI - CVE-2014-8360

The vulnerability can be exploited when the function `getItemForItemtype()` is called with a user controllable parameter (authenticated or not). For example, in `ajax/common.tabs.php` line 63:

```
if ($item = getItemForItemtype($_POST['itemtype'])) {
   if ($item instanceof CommonDBTM
       && $item->isNewItem()
       && (![isset](http://www.php.net/isset)($_POST["id"]) || !$item->can($_POST["id"],'r'))) {
      [exit](http://www.php.net/exit)();
   }
}
```

The function `getItemForItemtype()` tries to instantiate an object with the name given in parameter. It can be found in `inc/db.functions.php` line 200.

```
/**
 * Get new item objet for an itemtype
 *
 * @since version 0.83
 *
 * @param $itemtype   string   itemtype
 *
 * @return itemtype object or false if class does not exists
**/
function getItemForItemtype($itemtype) {

   if ([class_exists](http://www.php.net/class_exists)($itemtype)) {
      return new $itemtype();
   }
   return false;
}
```

The fact is that the function `class_exists` checks if the class exists by calling registered autoload functions. Let's see one of those function: `SimplePie_Autoloader::autoload` (which is in `inc/autoload.function.php`).

```
// SimplePie autoloader
[spl_autoload_register](http://www.php.net/spl_autoload_register)([array](http://www.php.net/array)(new SimplePie_Autoloader(), 'autoload'));

/**
 * Autoloader class
 *
 * @since version 0.84
 *
 * @package SimplePie
**/
class SimplePie_Autoloader {

   /**
    * Constructor
   **/
   public function __construct() {
      $this->path = GLPI_SIMPLEPIE_PATH;
   }

   /**
    * Autoloader
    *
    * @param string $class The name of the class to attempt to load.
   **/
   public function autoload($class) {

      // Only load the class if it starts with "SimplePie"
      if ([strpos](http://www.php.net/strpos)($class, 'SimplePie') !== 0) {
         return;
      }
      $filename = $this->path . DIRECTORY_SEPARATOR . [str_replace](http://www.php.net/str_replace)('_', DIRECTORY_SEPARATOR, $class) .
                  '.php';
      require_once($filename);
   }
}
```

If the class name begins with `SimplePie` then all `_` occurrences are remplaced with `/` and the function `require_once` is called. Thus, it is possible to include a local file by calling the page with, for example, `itemtype=SimplePie_.._.._.._.._.._.._.._.._.._tmp_ponce`.

However, there are some problems to exploit correctly this vulnerability:

* Some versions of PHP (I don't know which ones exactly) are filtering the class name before autoload functions are called. Thus it is impossible to provide a name with a `.`.
* We need a way to write a local file with the extension `.php` and control its content.
## First Patch

The first patch adds a check in the autoload function of SimplePie: [https://forge.indepnet.net/projects/glpi/repository/revisions/23191/diff/branches/0.84-bugfixes/inc/autoload.function.php](https://forge.indepnet.net/projects/glpi/repository/revisions/23191/diff/branches/0.84-bugfixes/inc/autoload.function.php "https://forge.indepnet.net/projects/glpi/repository/revisions/23191/diff/branches/0.84-bugfixes/inc/autoload.function.php")

```
Index: autoload.function.php
===================================================================
--- autoload.function.php	(révision 23190)
+++ autoload.function.php	(révision 23191)
@@ -352,6 +352,11 @@
    **/
    public function autoload($class) {

+      // empty classname or non concerted plugin or classname containing dot (leaving GLPI main treee)
+      if (empty($class) || is_numeric($class) || (strpos($class, '.') !== false)) {
+         return false;
+      }
+
       // Only load the class if it starts with "SimplePie"
       if (strpos($class, 'SimplePie') !== 0) {
          return;
```

We cannot use this autoload function anymore. But it is still possible to use another, such as Zend Framework. It is in `lib/Zend/Loader/StandardAutoloader.php`. It begins by checking if the class name begins with `Zend\` and construct the filename. So `itemtype=Zend\_.._.._.._.._.._.._tmp_ponce` still works !

## Second patch

Complete patch is available here: [https://forge.indepnet.net/projects/glpi/repository/revisions/23200/diff/trunk/inc/autoload.function.php](https://forge.indepnet.net/projects/glpi/repository/revisions/23200/diff/trunk/inc/autoload.function.php "https://forge.indepnet.net/projects/glpi/repository/revisions/23200/diff/trunk/inc/autoload.function.php")

```
Index: autoload.function.php
===================================================================
--- autoload.function.php	(révision 23199)
+++ autoload.function.php	(révision 23200)
@@ -258,9 +258,11 @@

    // empty classname or non concerted plugin or classname containing dot (leaving GLPI main treee)
    if (empty($classname) || is_numeric($classname) || (strpos($classname, '.') !== false)) {
-      return false;
+      die("Security die. trying to load an forbidden class name");
    }

+
+
    $dir = GLPI_ROOT . "/inc/";
    if ($plug = isPluginItemType($classname)) {
       $plugname = strtolower($plug['plugin']);
@@ -294,6 +296,14 @@
       if (preg_match('/^CAS_.*/', $classname)) {
          return false;
       }
+      // Do not try to load Zend using GLPI autoload
+      if (preg_match('/^Zend.*/', $classname)) {
+         return false;
+      }
+      // Do not try to load Simplepie using GLPI autoload
+      if (preg_match('/^SimplePie.*/', $classname)) {
+         return false;
+      }

       $item = strtolower($classname);
    }
@@ -312,6 +322,9 @@
    }
 }

+// Use spl autoload to allow stackable autoload.
+spl_autoload_register('glpi_autoload');
+
 require_once (GLPI_ZEND_PATH . '/Loader/StandardAutoloader.php');
 $option = array(Zend\Loader\StandardAutoloader::LOAD_NS => array('Zend' => GLPI_ZEND_PATH));
 $loader = new Zend\Loader\StandardAutoloader($option);
@@ -320,12 +333,9 @@
 // SimplePie autoloader
 spl_autoload_register(array(new SimplePie_Autoloader(), 'autoload'));

-// Use spl autoload to allow stackable autoload.
-spl_autoload_register('glpi_autoload');

-
 /**
  * Autoloader class
  *
```

Two changes:

* in `glpi_autoload`, if a `.` is found into the parameter, then `die` is called
* the registration order of autoload functions is modified, meaning that calling order is also modified …

Thus it is not possible anymore to provide a name with a `.` without stopping the script.

writeup/cve-2014-8360-en.txt · Dernière modification: 2014/12/28 17:08 par tlk

---

### Outils de la page

* [Afficher le texte source](/doku.php?id=writeup:cve-2014-8360-en&do=edit "Afficher le texte source [V]")
* [Anciennes révisions](/doku.php?id=writeup:cve-2014-8360-en&do=revisions "Anciennes révisions [O]")
* [Liens de retour](/doku.php?id=writeup:cve-2014-8360-en&do=backlink "Liens de retour")
* [Haut de page](#dokuwiki__top "Haut de page [T]")

Sauf mention contraire, le contenu de ce wiki est placé sous les termes de la licence suivante : [CC Attribution-Share Alike 3.0 Unported](http://creativecommons.org/licenses/by-sa/3.0/)
[![CC Attribution-Share Alike 3.0 Unported](/lib/images/license/button/cc-by-sa.png)](http://creativecommons.org/licenses/by-sa/3.0/) [![Donate](/lib/tpl/dokuwiki/images/button-donate.gif)](http://www.dokuwiki.org/donate "Donate")
[![Powered by PHP](/lib/tpl/dokuwiki/images/button-php.gif)](http://www.php.net "Powered by PHP")
[![Valid HTML5](/lib/tpl/dokuwiki/images/button-html5.png)](http://validator.w3.org/check/referer "Valid HTML5")
[![Valid CSS](/lib/tpl/dokuwiki/images/button-css.png)](http://jigsaw.w3.org/css-validator/check/referer?profile=css3 "Valid CSS")
[![Driven by DokuWiki](/lib/tpl/dokuwiki/images/button-dw.png)](http://dokuwiki.org/ "Driven by DokuWiki")

![](/lib/exe/indexer.php?id=writeup%3Acve-2014-8360-en&1737772504)



=== Content from www.mandriva.com_6f92bd13_20250125_023507.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us


