The provided content is a commit diff from a GitHub repository, showing changes made to address a SQL injection vulnerability.

**Root cause of vulnerability:**
The original code used string formatting (`%`) to insert user-provided data directly into SQL queries. This is vulnerable to SQL injection because malicious input could manipulate the SQL query's structure.

**Weaknesses/vulnerabilities present:**
- **SQL Injection:** The primary weakness was the use of string formatting to build SQL queries, which allowed for the possibility of injecting malicious SQL code.

**Impact of exploitation:**
An attacker could potentially:
- **Read sensitive data:** Extract data from the database that they are not authorized to access.
- **Modify data:** Alter or delete data within the database.
- **Compromise the application:** Potentially gain control of the application by manipulating the database.

**Attack vectors:**
The attack vector is through user-controlled input, specifically in the `create_poll`, `do_poll`, `show_poll`, and `show_refresh` functions where parameters are passed in the request and then used in the sql queries. An attacker could craft malicious input to manipulate the SQL queries in these functions.

**Required attacker capabilities/position:**
An attacker would need to be able to send HTTP requests to the application with manipulated parameters. This could be through the web interface or by directly crafting requests.

**Changes made to fix vulnerability:**
The code changes replace string formatting (`%`) with parameterized queries (using placeholders and a parameter tuple), which prevents SQL injection by properly escaping and sanitizing user inputs. The following changes were made in `app.py`:
- In `create_poll`, `cursor.execute(sql%param)` is changed to `cursor.execute(sql, param)`.
- In `do_poll`, `sql_s = "select FTitle, FOptionDesc from t_vote_info where FVoteId=%s;"%p_id` is changed to  `sql_s = "select FTitle, FOptionDesc from t_vote_info where FVoteId=%s;"` and `cursor.execute(sql_s)` to `cursor.execute(sql_s, (p_id,))`. Similarly in other places.
- In `do_poll`, `sql_u = "update t_vote_info set FOptionVoteNum=\"%s\" where FVoteId=\"%s\";"%(opt_new,p_id)` is changed to `sql_u = "update t_vote_info set FOptionVoteNum=%s where FVoteId=%s;"` and `cursor.execute(sql_u)` to  `cursor.execute(sql_u, (opt_new,p_id))`.
- The same replacement of string formatting is done in `show_poll` and `show_refresh` functions.