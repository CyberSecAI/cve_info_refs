The provided content is a commit diff from a GitHub repository. The commit primarily addresses SQL injection vulnerabilities and related issues in the `filebroker` application. The relevant changes are:

**Root cause of vulnerability:**
- The original code used string interpolation to construct SQL queries, making it vulnerable to SQL injection attacks.

**Weaknesses/vulnerabilities present:**
- **SQL Injection:** The code directly embeds user-supplied strings into SQL queries without sanitization, allowing an attacker to inject malicious SQL code.

**Impact of exploitation:**
- An attacker could potentially read, modify, or delete data in the database. They could also potentially execute arbitrary commands on the database server depending on the database privileges.

**Attack vectors:**
- The vulnerability is present in the SQL queries used to interact with the database. By manipulating the input parameters in the `insert_file_status`, `update_file_status`, `select_running_transfers_by_source`, `select_files_by_transfer_status`, `select_transfer_files`  functions of the `lib/common.rb` file, an attacker can inject malicious SQL code.

**Required attacker capabilities/position:**
- The attacker needs to be able to interact with the application in a way that allows the injection of malicious SQL queries through input fields. This usually means they need to be able to interact with the application's API or interface.

**Details of the fix:**
- The code is refactored to use parameterized queries with placeholders (`$1`, `$2`, etc.). The `db.exec` function now takes the query string and an array of parameters, preventing SQL injection.

**Specific code changes:**

- In `lib/common.rb`:
    - Several functions like `insert_file_status`, `update_file_status`, `select_transfer_files`, `select_running_transfers_by_source` and `select_files_by_transfer_status` have been changed to use parameterized queries instead of string interpolation.
- In `lib/filebroker.rb`
    - A change was made in the `do_list` function to include filtering out transferred files.

- The change in  `public/filebroker_service.xsd` is adding a filter attribute to the 'Path' element.