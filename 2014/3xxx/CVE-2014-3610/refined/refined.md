```
{
  "cve": "CVE-2014-3610",
  "contents": [
    {
      "type": "patch",
      "content": "KVM: x86: Prevent host from panicking on shared MSR writes.\nThe previous patch blocked invalid writes directly when the MSR\nis written. As a precaution, prevent future similar mistakes by\ngracefulling handle GPs caused by writes to shared MSRs.\n\nChanges:\n- Modifies kvm_set_shared_msr to return an integer indicating success/failure.\n- Modifies vmx_set_msr to check for errors from kvm_set_shared_msr and revert the change.\n- Modifies kvm_set_shared_msr to use wrmsrl_safe instead of wrmsrl\n",
      "vulnerabilities": [
        {
          "root_cause": "The KVM's WRMSR instruction emulation did not check for non-canonical values written to certain MSRs.",
          "weaknesses": [
            "Improper handling of non-canonical addresses during MSR writes",
            "Lack of validation on MSR values written by guest OS"
          ],
          "impact": "A privileged guest user can cause a denial of service (kernel panic) on the host by writing non-canonical values to specific MSR registers.",
          "attack_vector": "Guest OS",
           "required_capabilities": "A privileged guest user capable of writing to MSR registers"
        }
      ]
    },
    {
      "type": "bugzilla",
      "content": "It was found that KVM's Write to Model Specific Register (WRMSR) instruction emulation would write non-canonical values passed in by the guest to certain MSRs in the host's context. A privileged guest user could use this flaw to crash the host.",
     "vulnerabilities": [
        {
          "root_cause": "The KVM's WRMSR instruction emulation would write non-canonical values to certain MSRs in the host context.",
          "weaknesses": [
            "Improper handling of non-canonical MSR values",
            "Lack of validation on guest-supplied MSR values"
          ],
          "impact": "A privileged guest user could cause a denial of service (host crash).",
           "attack_vector": "Guest OS",
           "required_capabilities": "Privileged guest user"
        }
      ]
    },
    {
      "type": "patch",
        "content": "KVM: x86: Check non-canonical addresses upon WRMSR\nUpon WRMSR, the CPU should inject #GP if a non-canonical value (address) is\nwritten to certain MSRs. The behavior is \"almost\" identical for AMD and Intel\n(ignoring MSRs that are not implemented in either architecture since they would\nanyhow #GP). However, IA32_SYSENTER_ESP and IA32_SYSENTER_EIP cause #GP if\nnon-canonical address is written on Intel but not on AMD (which ignores the top\n32-bits).\n\nAccordingly, this patch injects a #GP on the MSRs which behave identically on\nIntel and AMD. To eliminate the differences between the architecutres, the\nvalue which is written to IA32_SYSENTER_ESP and IA32_SYSENTER_EIP is turned to\ncanonical value before writing instead of injecting a #GP.",
          "vulnerabilities": [
           {
              "root_cause": "The KVM subsystem did not properly check for non-canonical addresses written to specific MSRs during WRMSR instruction emulation.",
              "weaknesses": [
                "Incorrect handling of non-canonical addresses in WRMSR emulation",
                "Inconsistent behavior across Intel and AMD regarding non-canonical addresses in certain MSRs"
              ],
              "impact": "Guest OS user can cause a denial of service (host crash) by writing non-canonical address to specific MSRs",
               "attack_vector": "Guest OS",
              "required_capabilities":"A privileged guest user capable of writing to MSR registers"
             }
        ]
    },
     {
      "type": "openwall",
      "content": "kvm issues\n\nCVE-2014-3610\n  <https://git.kernel.org/cgit/virt/kvm/kvm.git/commit/?id=854e8bb1aa06c578c2c9145fa6bfe3680ef63b23>\n  <https://git.kernel.org/cgit/virt/kvm/kvm.git/commit/?id=8b3c3104c3f4f706e99365c3e0d2aa61b95f969f>",
     "vulnerabilities": [
          {
              "root_cause": "Improper handling of non-canonical MSR writes in KVM.",
              "weaknesses": [
                  "Lack of proper validation of MSR values",
                    "Incorrect handling of writes to shared MSRs"
              ],
                "impact": "Potential denial of service due to a host crash.",
               "attack_vector": "Guest OS",
                "required_capabilities": "Privileged guest user"
            }
        ]
    },
    {
      "type": "ubuntu_notice",
       "content": "Lars Bull and Nadav Amit reported a flaw in how KVM (the Kernel Virtual\nMachine) handles noncanonical writes to certain MSR registers. A privileged\nguest user can exploit this flaw to cause a denial of service (kernel\npanic) on the host. ([CVE-2014-3610](/security/CVE-2014-3610))",
      "vulnerabilities": [
        {
          "root_cause": "The KVM hypervisor does not properly handle non-canonical writes to specific MSRs.",
           "weaknesses": [
            "Lack of validation of MSR values",
                "Incorrect emulation of the WRMSR instruction"
          ],
          "impact": "A privileged guest user can cause a denial of service (kernel panic) on the host.",
           "attack_vector": "Guest OS",
           "required_capabilities": "Privileged guest user with MSR write access"
        }
      ]
    },
     {
      "type": "github_advisory",
      "content": "The WRMSR processing functionality in the KVM subsystem in the Linux kernel through 3.17.2 does not properly handle the writing of a non-canonical address to a model-specific register, which allows guest OS users to cause a denial of service (host OS crash) by leveraging guest OS privileges, related to the wrmsr_interception function in arch/x86/kvm/svm.c and the handle_wrmsr function in arch/x86/kvm/vmx.c.",
        "vulnerabilities": [
          {
            "root_cause": "The KVM subsystem does not properly handle writing of non-canonical address to a model-specific register through WRMSR instruction.",
           "weaknesses": [
              "Improper validation of MSR write values",
              "Incorrect implementation of WRMSR handling in KVM"
            ],
            "impact": "Guest OS users can cause a denial of service (host OS crash) by leveraging guest OS privileges.",
            "attack_vector": "Guest OS",
            "required_capabilities": "Privileged guest OS user with MSR write access"
          }
        ]
    },
    {
      "type": "bugzilla",
       "content": "If the guest writes a noncanonical value to certain MSR registers, KVM will write that value to the MSR in the host context and a #GP will be raised leading to kernel panic.\n\nA privileged guest user can use this flaw to crash the host.",
      "vulnerabilities": [
       {
          "root_cause": "KVM does not validate non-canonical values written to certain MSR registers by the guest.",
         "weaknesses": [
              "Improper handling of non-canonical MSR values.",
              "Lack of proper validation of guest-supplied MSR data"
         ],
          "impact": "A privileged guest user can cause a denial of service (kernel panic) on the host.",
         "attack_vector":"Guest OS",
          "required_capabilities":"Privileged guest user"
        }
       ]
    },
    {
      "type": "redhat_errata",
       "content": "It was found that KVM's Write to Model Specific Register (WRMSR)\ninstruction emulation would write non-canonical values passed in by the\nguest to certain MSRs in the host's context. A privileged guest user could\nuse this flaw to crash the host. (CVE-2014-3610)",
      "vulnerabilities": [
         {
          "root_cause": "KVM's WRMSR emulation would write non-canonical values from guest to certain MSRs in host context.",
            "weaknesses": [
                "Improper validation of MSR values",
                 "Missing checks for non-canonical MSR addresses"
            ],
           "impact": "A privileged guest user could crash the host due to the lack of validation of non-canonical MSR values.",
          "attack_vector": "Guest OS",
          "required_capabilities":"A privileged guest user"
         }
       ]
    },
    {
       "type": "opensuse_notice",
         "content": "The WRMSR processing functionality in the KVM subsystem in the Linux kernel through 3.17.2 did not properly handle\nthe writing of a non-canonical address to a model-specific register,\nwhich allowed guest OS users to cause a denial of service (host OS\ncrash) by leveraging guest OS privileges, related to the\nwrmsr_interception function in arch/x86/kvm/svm.c and the\nhandle_wrmsr function in arch/x86/kvm/vmx.c (bnc#899192).",
        "vulnerabilities": [
          {
             "root_cause":"The Linux kernel KVM subsystem does not handle non-canonical addresses correctly during WRMSR.",
             "weaknesses":[
                 "Improper validation of MSR write values",
                "Missing checks for non-canonical addresses in WRMSR"
              ],
             "impact":"Guest users can cause denial of service (host crash).",
             "attack_vector": "Guest OS",
            "required_capabilities": "Privileged guest user capable of using the WRMSR instruction"
          }
        ]
    },
        {
      "type":"ubuntu_notice",
      "content": "Nadav Amit reported that the KVM (Kernel Virtual Machine) mishandles\n\nnoncanonical addresses when emulating instructions that change the rip\n\n(Instruction Pointer). A guest user with access to I/O or the MMIO can use\n\nthis flaw to cause a denial of service (system crash) of the guest.\n\n([CVE-2014-3647](/security/CVE-2014-3647))\n\nA flaw was discovered with the handling of the invept instruction in the\n\nKVM (Kernel Virtual Machine) subsystem of the Linux kernel. An unprivileged\n\nguest user could exploit this flaw to cause a denial of service (system\n\ncrash) on the guest. ([CVE-2014-3646](/security/CVE-2014-3646))\n\nA flaw was discovered with invept instruction support when using nested EPT\n\nin the KVM (Kernel Virtual Machine). An unprivileged guest user could\n\nexploit this flaw to cause a denial of service (system crash) on the guest.\n\n([CVE-2014-3645](/security/CVE-2014-3645))\n\nLars Bull reported a race condition in the PIT (programmable interrupt\n\ntimer) emulation in the KVM (Kernel Virtual Machine) subsystem of the Linux\n\nkernel. A local guest user with access to PIT i/o ports could exploit this\n\nflaw to cause a denial of service (crash) on the host. ([CVE-2014-3611](/security/CVE-2014-3611))\n\nLars Bull and Nadav Amit reported a flaw in how KVM (the Kernel Virtual\n\nMachine) handles noncanonical writes to certain MSR registers. A privileged\n\nguest user can exploit this flaw to cause a denial of service (kernel\n\npanic) on the host. ([CVE-2014-3610](/security/CVE-2014-3610))\n\nA flaw in the handling of malformed ASCONF chunks by SCTP (Stream Control\n\nTransmission Protocol) implementation in the Linux kernel was discovered. A\n\nremote attacker could exploit this flaw to cause a denial of service\n\n(system crash). ([CVE-2014-3673](/security/CVE-2014-3673))\n\nA flaw in the handling of duplicate ASCONF chunks by SCTP (Stream Control\n\nTransmission Protocol) implementation in the Linux kernel was discovered. A\n\nremote attacker could exploit this flaw to cause a denial of service\n\n(panic). ([CVE-2014-3687](/security/CVE-2014-3687))\n\nIt was discovered that excessive queuing by SCTP (Stream Control\n\nTransmission Protocol) implementation in the Linux kernel can cause memory\n\npressure. A remote attacker could exploit this flaw to cause a denial of\n\nservice. ([CVE-2014-3688](/security/CVE-2014-3688))\n\nA flaw was discovered in how the Linux kernel's KVM (Kernel Virtual\n\nMachine) subsystem handles the CR4 control register at VM entry on Intel\n\nprocessors. A local host OS user can exploit this to cause a denial of\n\nservice (kill arbitrary processes, or system disruption) by leveraging\n\n/dev/kvm access. ([CVE-2014-3690](/security/CVE-2014-3690))\n\nDon Bailey discovered a flaw in the LZO decompress algorithm used by the\n\nLinux kernel. An attacker could exploit this flaw to cause a denial of\n\nservice (memory corruption or OOPS). ([CVE-2014-4608](/security/CVE-2014-4608))\n\nIt was discovered the Linux kernel's implementation of IPv6 did not\n\nproperly validate arguments in the ipv6_select_ident function. A local user\n\ncould exploit this flaw to cause a denial of service (system crash) by\n\nleveraging tun or macvtap device access. ([CVE-2014-7207](/security/CVE-2014-7207))\n\nAndy Lutomirski discovered that the Linux kernel was not checking the\n\nCAP_SYS_ADMIN when remounting filesystems to read-only. A local user could\n\nexploit this flaw to cause a denial of service (loss of writability).\n\n([CVE-2014-7975](/security/CVE-2014-7975))",
      "vulnerabilities":[
           {
            "root_cause": "The KVM subsystem does not validate non-canonical values during MSR writes through WRMSR instruction emulation.",
             "weaknesses":[
                 "Improper handling of non-canonical addresses",
                  "Lack of validation on MSR values written by guest"
             ],
             "impact":"A privileged guest user can cause a denial of service (kernel panic) on the host.",
            "attack_vector":"Guest OS",
             "required_capabilities":"Privileged guest user with MSR write capability"
          }
        ]
    },
    {
      "type":"ubuntu_notice",
        "content": "Lars Bull and Nadav Amit reported a flaw in how KVM (the Kernel Virtual\n\nMachine) handles noncanonical writes to certain MSR registers. A privileged\n\nguest user can exploit this flaw to cause a denial of service (kernel\n\npanic) on the host. ([CVE-2014-3610](/security/CVE-2014-3610))",
       "vulnerabilities": [
        {
           "root_cause":"The KVM hypervisor has a flaw when handling non-canonical writes to MSR registers.",
           "weaknesses":[
             "Lack of validation on MSR register values",
             "Improper handling of non-canonical values during MSR writes"
           ],
          "impact":"A privileged guest user can cause a denial of service (kernel panic) on the host.",
           "attack_vector": "Guest OS",
          "required_capabilities":"A privileged guest user"
         }
        ]
    }
  ]
}
```