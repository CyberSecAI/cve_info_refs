=== Content from github.com_959e806c_20250125_111937.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnilsteampassnet%2FTeamPass%2Fcommit%2F8820c8934d9ba0508ac345e73ad0be29049ec6de)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnilsteampassnet%2FTeamPass%2Fcommit%2F8820c8934d9ba0508ac345e73ad0be29049ec6de)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nilsteampassnet%2FTeamPass)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nilsteampassnet](/nilsteampassnet)
/
**[TeamPass](/nilsteampassnet/TeamPass)**
Public

* [Notifications](/login?return_to=%2Fnilsteampassnet%2FTeamPass) You must be signed in to change notification settings
* [Fork
  552](/login?return_to=%2Fnilsteampassnet%2FTeamPass)
* [Star
   1.7k](/login?return_to=%2Fnilsteampassnet%2FTeamPass)

* [Code](/nilsteampassnet/TeamPass)
* [Issues
  703](/nilsteampassnet/TeamPass/issues)
* [Pull requests
  9](/nilsteampassnet/TeamPass/pulls)
* [Discussions](/nilsteampassnet/TeamPass/discussions)
* [Actions](/nilsteampassnet/TeamPass/actions)
* [Projects
  0](/nilsteampassnet/TeamPass/projects)
* [Wiki](/nilsteampassnet/TeamPass/wiki)
* [Security](/nilsteampassnet/TeamPass/security)
* [Insights](/nilsteampassnet/TeamPass/pulse)

Additional navigation options

* [Code](/nilsteampassnet/TeamPass)
* [Issues](/nilsteampassnet/TeamPass/issues)
* [Pull requests](/nilsteampassnet/TeamPass/pulls)
* [Discussions](/nilsteampassnet/TeamPass/discussions)
* [Actions](/nilsteampassnet/TeamPass/actions)
* [Projects](/nilsteampassnet/TeamPass/projects)
* [Wiki](/nilsteampassnet/TeamPass/wiki)
* [Security](/nilsteampassnet/TeamPass/security)
* [Insights](/nilsteampassnet/TeamPass/pulse)

## Commit

[Permalink](/nilsteampassnet/TeamPass/commit/8820c8934d9ba0508ac345e73ad0be29049ec6de)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security/API (beta) improvements

[Browse files](/nilsteampassnet/TeamPass/tree/8820c8934d9ba0508ac345e73ad0be29049ec6de)
Browse the repository at this point in the history

* Loading branch information

[![@nilsteampassnet](https://avatars.githubusercontent.com/u/1197546?s=40&v=4)](/nilsteampassnet)

[nilsteampassnet](/nilsteampassnet/TeamPass/commits?author=nilsteampassnet "View all commits by nilsteampassnet")
committed
May 3, 2014

1 parent
[d801608](/nilsteampassnet/TeamPass/commit/d8016088b8a404123e1e50f537c6cc33e885f399)

commit 8820c89

 Show file tree

 Hide file tree

Showing
**17 changed files**
with
**112 additions**
and
**84 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* admin.php
  [admin.php](#diff-bc2bbf2801e44b5801dbd98d39b34f63ce5c7e874d8d1e5a89967b636432578c)
* admin.settings\_api.php
  [admin.settings\_api.php](#diff-230f70df3773351ef4bc73223521dbe1403ca86d8073daf4965074c8c22731fe)
* api

  + api/config.php
    [config.php](#diff-e247cd314aa65cdcb235ec4b81c9d9e76f8a99576375297ef6303a33d6862c9b)
  + api/functions.php
    [functions.php](#diff-fb188aff53d7bd0a8601c1bed3fbee4f1cfa65f7aaba1d93fd1c2253a7693676)
  + api/index.php
    [index.php](#diff-ac6719acf93fec19d96db91f5645a3c18e572e7758071b9d64fd5970d006778c)
* includes

  + includes/include.php
    [include.php](#diff-8f6bdb56a3a218535853a3db79a18287ba1bce96740e3a9bdad5331668a62323)
* items.load.php
  [items.load.php](#diff-2569b5b1b2fce55e564b64928ccc701df3a2f2972428ec69bdfe69690e5f8b85)
* items.php
  [items.php](#diff-882d1a265bd338f86e21608a5895f19c7ae25343edd4c50380942736f0742f14)
* otv.php
  [otv.php](#diff-d124459c4c118d3f1c1cc74520b6bdee2aee16aaf46a0705d80144f37dc7be8d)
* sources

  + sources/admin.queries.php
    [admin.queries.php](#diff-d2246e6463d4cd8dd48999582996bb62c33e86df15e44897910235ed461964e0)
  + datatable

    - sources/datatable/datatable.item\_edition.php
      [datatable.item\_edition.php](#diff-a98227311fc38c1015dfa5a57b7509c5fb3dd6888fc69c6c54f1aa37056ddbe7)
    - sources/datatable/datatable.kb.php
      [datatable.kb.php](#diff-4d5c173ab7b3358e1509cbd7fbe5c2777bb0a935a3c150ebb65dd41371331ae5)
    - sources/datatable/datatable.logs.php
      [datatable.logs.php](#diff-4407c653106040d43ce500b009eb32e3820871704af099fa8b8db287441d21aa)
    - sources/datatable/datatable.users\_logged.php
      [datatable.users\_logged.php](#diff-3af35c32112200c66bbb3d056d24123c3dd92885543c3ee0dba0d20b2df46766)
  + sources/find.queries.php
    [find.queries.php](#diff-6761d4fe0858b866568eeb59e8a6a9e4a80c028adb54c7cf32d3b3d6183424b7)
  + sources/items.queries.php
    [items.queries.php](#diff-258a42ebc00fce7c8a6c4c8d47a4c93ca1ff80081c35c66766fd7b66462bf0fa)
  + sources/users.queries.php
    [users.queries.php](#diff-5cfd0506488a6204d4d43c041fd4922a5c6c9a9ea51a5600de983ab263bc1902)

## There are no files selected for viewing

2 changes: 0 additions & 2 deletions

2
[admin.php](#diff-bc2bbf2801e44b5801dbd98d39b34f63ce5c7e874d8d1e5a89967b636432578c "admin.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/admin.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -42,8 +42,6 @@ |
|  |  | <h3>Some instructions</h3> |
|  |  | <span class="ui-icon ui-icon-wrench" style="float: left; margin-right: .3em;">&nbsp;</span> |
|  |  | Access to <a target="\_blank" href="http://www.teampass.net" style="font-weight:bold;font-style:italic;">TeamPass website</a><br /> |
|  |  | <span class="ui-icon ui-icon-wrench" style="float: left; margin-right: .3em;">&nbsp;</span> |
|  |  | For any kind of Help and Support, please use the <a target="\_blank" href="http://www.teampass.net/forum" style="font-weight:bold;font-style:italic;">Forum</a><br /> |
|  |  | <span class="ui-icon ui-icon-wrench" style="float: left; margin-right: .3em;">&nbsp;</span> |
|  |  | You discovered a Bug or you have an improvement Proposal, please use the <a target="\_blank" href="https://github.com/nilsteampassnet/TeamPass/issues" style="font-weight:bold;font-style:italic;">Github channel</a>. <i>If you are not sure, always use the Forum before to obtain a confirmation. This will prevent having to much open tickets at Github</i>.<br /> |
|  |  | <div style="text-align:center;margin-top:10px;"> |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[admin.settings\_api.php](#diff-230f70df3773351ef4bc73223521dbe1403ca86d8073daf4965074c8c22731fe "admin.settings_api.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/admin.settings_api.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -230,7 +230,7 @@ function newIPDB() |
|  |  |  |
|  |  | function ip\_update(id, value, ip) |
|  |  | { |
|  |  | $("#api\_db\_type").val("admin\_action\_api\_save\_key"); |
|  |  | $("#api\_db\_type").val("admin\_action\_api\_save\_ip"); |
|  |  | $("#api\_db\_id").val(id); |
|  |  | $("#api\_db\_action").val("update"); |
|  |  | $("#div\_key").show(); |
| Expand Down  Expand Up | | @@ -261,6 +261,7 @@ function ip\_update(id, value, ip) |
|  |  | $("#api\_db\_message").html("'.$txt['error\_too\_long'].'"); |
|  |  | exit; |
|  |  | } |
|  |  |  |
|  |  | $("#div\_loading").show(); |
|  |  | var $this = $(this); |
|  |  | // send query |
| Expand Down | |  |

9 changes: 0 additions & 9 deletions

9
[api/config.php](#diff-e247cd314aa65cdcb235ec4b81c9d9e76f8a99576375297ef6303a33d6862c9b "api/config.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/d8016088b8a404123e1e50f537c6cc33e885f399/api/config.php)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

50 changes: 23 additions & 27 deletions

50
[api/functions.php](#diff-fb188aff53d7bd0a8601c1bed3fbee4f1cfa65f7aaba1d93fd1c2253a7693676 "api/functions.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/api/functions.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,4 +1,19 @@ |
|  |  | <?php |
|  |  | /\*\* |
|  |  | \* |
|  |  | \* @file configapi.php |
|  |  | \* @author Nils Laumaillé |
|  |  | \* @version 2.1.20 |
|  |  | \* @copyright (c) 2009-2014 Nils Laumaillé |
|  |  | \* @licensing GNU AFFERO GPL 3.0 |
|  |  | \* @link http://www.teampass.net |
|  |  | \* |
|  |  | \* This library is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. |
|  |  | \*/ |
|  |  |  |
|  |  | $teampass\_config\_file = "../includes/settings.php"; |
|  |  |  |
|  |  | function teampass\_api\_enabled() { |
|  |  | $bdd = teampass\_connect(); |
| Expand All | | @@ -9,7 +24,7 @@ function teampass\_api\_enabled() { |
|  |  | function teampass\_whitelist() { |
|  |  | $bdd = teampass\_connect(); |
|  |  | $apiip\_pool = teampass\_get\_ips(); |
|  |  | if (count($apiip\_pool) > 0 && !array\_search($\_SERVER['REMOTE\_ADDR'], $apiip\_pool)) { |
|  |  | if (count($apiip\_pool) > 0 && array\_search($\_SERVER['REMOTE\_ADDR'], $apiip\_pool) === false) { |
|  |  | rest\_error('IPWHITELIST'); |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -169,36 +184,19 @@ function rest\_get () { |
|  |  |  |
|  |  | if ($GLOBALS['request'][0] == "read") { |
|  |  | if($GLOBALS['request'][1] == "category") { |
|  |  | $array\_category = explode(';',$GLOBALS['request'][2]); |
|  |  |  |
|  |  | foreach($array\_category as $category) { |
|  |  | if(!preg\_match\_all("/^([\w\:\'\-\sàáâãäåçèéêëìíîïðòóôõöùúûüýÿ]+)$/i", $category,$result)) { |
|  |  | rest\_error('CATEGORY\_MALFORMED'); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if(count($array\_category) > 1 && count($array\_category) < 5) { |
|  |  | for ($i = count($array\_category); $i > 0; $i--) { |
|  |  | $slot = $i - 1; |
|  |  | if (!$slot) { |
|  |  | $category\_query .= "select id from ".$GLOBALS['pre']."nested\_tree where title LIKE '".$array\_category[$slot]."' AND parent\_id = 0"; |
|  |  | } else { |
|  |  | $category\_query .= "select id from ".$GLOBALS['pre']."nested\_tree where title LIKE '".$array\_category[$slot]."' AND parent\_id = ("; |
|  |  | } |
|  |  | } |
|  |  | for ($i = 1; $i < count($array\_category); $i++) { $category\_query .= ")"; } |
|  |  | } elseif (count($array\_category) == 1) { |
|  |  | $category\_query = "select id from ".$GLOBALS['pre']."nested\_tree where title LIKE '".$array\_category[0]."' AND parent\_id = 0"; |
|  |  | // get ids |
|  |  | if (strpos($GLOBALS['request'][2],",") > 0) { |
|  |  | $condition = "id\_tree IN (".$GLOBALS['request'][2].")"; |
|  |  | } else { |
|  |  | rest\_error ('NO\_CATEGORY'); |
|  |  | $condition = "id\_tree = '".$GLOBALS['request'][2]."'"; |
|  |  | } |
|  |  | $response = $bdd->query("select id,label,login,pw from ".$GLOBALS['pre']."items where id\_tree = (".$category\_query.")"); |
|  |  | $response = $bdd->query("select id,label,login,pw from ".$GLOBALS['pre']."items where ".$condition); |
|  |  | while ($data = $response->fetch()) |
|  |  | { |
|  |  | $id = $data['id']; |
|  |  | $json[$id]['label'] = utf8\_encode($data['label']); |
|  |  | $json[$id]['login'] = utf8\_encode($data['login']); |
|  |  | // $json[$id]['pw'] = teampass\_decrypt\_pw($data['pw'],SALT,$rand\_key); |
|  |  | $json[$id]['pw'] = teampass\_decrypt\_pw($data['pw'],SALT,$rand\_key); |
|  |  | } |
|  |  | } elseif($GLOBALS['request'][1] == "item") { |
|  |  | $array\_category = explode(';',$GLOBALS['request'][2]); |
| Expand Down  Expand Up | | @@ -325,6 +323,4 @@ function teampass\_decrypt\_pw($encrypted, $salt, $rand\_key, $itcount = 2072) |
|  |  | $encrypted = substr($encrypted, 0, -64); |
|  |  | if ($mac !== hash\_hmac('sha256', $encrypted, $salt)) return null; |
|  |  | return substr(rtrim(mcrypt\_decrypt(MCRYPT\_RIJNDAEL\_256, $key, $encrypted, 'ctr', $iv), "\0\4"), strlen($rand\_key)); |
|  |  | } |
|  |  |  |
|  |  | ?> |
|  |  | } |

15 changes: 14 additions & 1 deletion

15
[api/index.php](#diff-ac6719acf93fec19d96db91f5645a3c18e572e7758071b9d64fd5970d006778c "api/index.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/api/index.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,19 @@ |
|  |  | <?php |
|  |  | /\*\* |
|  |  | \* |
|  |  | \* @file indexapi.php |
|  |  | \* @author Nils Laumaillé |
|  |  | \* @version 2.1.20 |
|  |  | \* @copyright (c) 2009-2014 Nils Laumaillé |
|  |  | \* @licensing GNU AFFERO GPL 3.0 |
|  |  | \* @link http://www.teampass.net |
|  |  | \* |
|  |  | \* This library is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. |
|  |  | \*/ |
|  |  |  |
|  |  | require\_once('config.php'); |
|  |  | //require\_once('config.php'); |
|  |  | require\_once('functions.php'); |
|  |  |  |
|  |  | header('Content-Type: application/json'); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[includes/include.php](#diff-8f6bdb56a3a218535853a3db79a18287ba1bce96740e3a9bdad5331668a62323 "includes/include.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/includes/include.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -39,4 +39,4 @@ |
|  |  | 'manage\_views' => 'views.php', |
|  |  | 'manage\_main' => 'admin.php', |
|  |  | 'manage\_settings' => 'admin.settings.php' |
|  |  | ); |
|  |  | ); |

1 change: 1 addition & 0 deletions

1
[items.load.php](#diff-2569b5b1b2fce55e564b64928ccc701df3a2f2972428ec69bdfe69690e5f8b85 "items.load.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/items.load.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2617,6 +2617,7 @@ function prepareOneTimeView() |
|  |  | function(data) { |
|  |  | //check if format error |
|  |  | if (data[0].error == "") { |
|  |  | $("#div\_dialog\_message").dialog({minHeight:500,minWidth:750}); |
|  |  | $("#div\_dialog\_message").dialog('open'); |
|  |  | $("#div\_dialog\_message\_text").html(data[0].url); |
|  |  | } else { |
| Expand Down | |  |

18 changes: 9 additions & 9 deletions

18
[items.php](#diff-882d1a265bd338f86e21608a5895f19c7ae25343edd4c50380942736f0742f14 "items.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/items.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,13 +96,13 @@ |
|  |  | <input type="hidden" id="pf\_selected" />'; |
|  |  | // Hidden objects for Item search |
|  |  | if (isset($\_GET['group']) && isset($\_GET['id'])) { |
|  |  | echo '<input type="hidden" name="open\_folder" id="open\_folder" value="'.$\_GET['group'].'" />'; |
|  |  | echo '<input type="hidden" name="open\_id" id="open\_id" value="'.$\_GET['id'].'" />'; |
|  |  | echo '<input type="hidden" name="recherche\_group\_pf" id="recherche\_group\_pf" value="', in\_array($\_GET['group'], $\_SESSION['personal\_visible\_groups']) ? '1' : '', '" />'; |
|  |  | echo '<input type="hidden" name="open\_folder" id="open\_folder" value="'.htmlspecialchars($\_GET['group']).'" />'; |
|  |  | echo '<input type="hidden" name="open\_id" id="open\_id" value="'.htmlspecialchars($\_GET['id']).'" />'; |
|  |  | echo '<input type="hidden" name="recherche\_group\_pf" id="recherche\_group\_pf" value="', in\_array(htmlspecialchars($\_GET['group']), $\_SESSION['personal\_visible\_groups']) ? '1' : '', '" />'; |
|  |  | } elseif (isset($\_GET['group']) && !isset($\_GET['id'])) { |
|  |  | echo '<input type="hidden" name="open\_folder" id="open\_folder" value="'.$\_GET['group'].'" />'; |
|  |  | echo '<input type="hidden" name="open\_folder" id="open\_folder" value="'.htmlspecialchars($\_GET['group']).'" />'; |
|  |  | echo '<input type="hidden" name="open\_id" id="open\_id" value="" />'; |
|  |  | echo '<input type="hidden" name="recherche\_group\_pf" id="recherche\_group\_pf" value="', in\_array($\_GET['group'], $\_SESSION['personal\_visible\_groups']) ? '1' : '', '" />'; |
|  |  | echo '<input type="hidden" name="recherche\_group\_pf" id="recherche\_group\_pf" value="', in\_array(htmlspecialchars($\_GET['group']), $\_SESSION['personal\_visible\_groups']) ? '1' : '', '" />'; |
|  |  | } else { |
|  |  | echo '<input type="hidden" name="open\_folder" id="open\_folder" value="" />'; |
|  |  | echo '<input type="hidden" name="open\_id" id="open\_id" value="" />'; |
| Expand Down  Expand Up | | @@ -230,7 +230,7 @@ |
|  |  | } |
|  |  | // Prepare folder |
|  |  | $folderTxt = ' |
|  |  | <li class="jstreeopen" id="li\_'.$folder->id.'">'; |
|  |  | <li class="jstreeopen" id="li\_'.$folder->id.'" title="ID ['.$folder->id.']">'; |
|  |  | if (in\_array($folder->id, $\_SESSION['groupes\_visibles'])) { |
|  |  | $folderTxt .= ' |
|  |  | <a id="fld\_'.$folder->id.'" class="folder" onclick="ListerItems(\''.$folder->id.'\', \'\', 0);">'.$fldTitle.' (<span class="items\_count" id="itcount\_'.$folder->id.'">'.$itemsNb.'</span>'; |
| Expand Down  Expand Up | | @@ -358,7 +358,7 @@ |
|  |  | <tr> |
|  |  | <td valign="top" class="td\_title"><span class="ui-icon ui-icon-carat-1-e" style="float: left; margin-right: .3em;">&nbsp;</span>'.$txt['label'].' :</td> |
|  |  | <td> |
|  |  | <input type="hidden" id="hid\_label" value="', isset($dataItem) ? $dataItem['label'] : '', '" /> |
|  |  | <input type="hidden" id="hid\_label" value="', isset($dataItem) ? htmlspecialchars($dataItem['label']) : '', '" /> |
|  |  | <div id="id\_label" style="display:inline;"></div> |
|  |  | </td> |
|  |  | </tr>'; |
| Expand All | | @@ -367,7 +367,7 @@ |
|  |  | <tr> |
|  |  | <td valign="top" class="td\_title"><span class="ui-icon ui-icon-carat-1-e" style="float: left; margin-right: .3em;">&nbsp;</span>'.$txt['description'].' :</td> |
|  |  | <td> |
|  |  | <div id="id\_desc" style="font-style:italic;display:inline;"></div><input type="hidden" id="hid\_desc" value="', isset($dataItem) ? $dataItem['description'] : '', '" /> |
|  |  | <div id="id\_desc" style="font-style:italic;display:inline;"></div><input type="hidden" id="hid\_desc" value="', isset($dataItem) ? htmlspecialchars($dataItem['description']) : '', '" /> |
|  |  | </td> |
|  |  | </tr>'; |
|  |  | // Line for PW |
| Expand Down  Expand Up | | @@ -455,7 +455,7 @@ |
|  |  | <tr class="tr\_fields itemCatName\_'.$itemCatName.'"> |
|  |  | <td valign="top" class="td\_title">&nbsp;&nbsp;<span class="ui-icon ui-icon-carat-1-e" style="float: left; margin: 0 .3em 0 15px; font-size:9px;">&nbsp;</span><i>'.$field[1].'</i> :</td> |
|  |  | <td> |
|  |  | <div id="id\_field\_'.$field[0].'" style="display:inline;" class="fields\_div"></div><input type="hidden" id="hid\_field\_'.$field[0].'" class="fields" /> |
|  |  | <div id="id\_field\_'.$field[0].'" style="display:inline;" class="fields\_div"></div><input type="hidden" id="hid\_field\_'.htmlspecialchars($field[0]).'" class="fields" /> |
|  |  | </td> |
|  |  | </tr>'; |
|  |  | } |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[otv.php](#diff-d124459c4c118d3f1c1cc74520b6bdee2aee16aaf46a0705d80144f37dc7be8d "otv.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/otv.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -70,6 +70,13 @@ |
|  |  |  |
|  |  | // get data |
|  |  | $pw = decrypt($dataItem['pw']); |
|  |  |  |
|  |  | // get key for original pw |
|  |  | $originalKey = $db->queryFirst('SELECT rand\_key FROM `'.$pre.'keys` WHERE `table` LIKE "items" AND `id` ='.intval($\_GET['item\_id'])); |
|  |  | // unsalt previous pw |
|  |  | $pw = substr(decrypt($dataItem['pw']), strlen($originalKey['rand\_key'])); |
|  |  |  |
|  |  |  |
|  |  | $label = $dataItem['label']; |
|  |  | $email = $dataItem['email']; |
|  |  | $url = $dataItem['url']; |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[sources/admin.queries.php](#diff-d2246e6463d4cd8dd48999582996bb62c33e86df15e44897910235ed461964e0 "sources/admin.queries.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/sources/admin.queries.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -919,6 +919,7 @@ |
|  |  | 'api', |
|  |  | array( |
|  |  | 'label' => $\_POST['label'], |
|  |  | 'value' => $\_POST['key'], |
|  |  | 'timestamp' => time() |
|  |  | ), |
|  |  | "id='".intval($\_POST['id'])."'" |
| Expand Down | |  |

18 changes: 15 additions & 3 deletions

18
[sources/datatable/datatable.item\_edition.php](#diff-a98227311fc38c1015dfa5a57b7509c5fb3dd6888fc69c6c54f1aa37056ddbe7 "sources/datatable/datatable.item_edition.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/sources/datatable/datatable.item_edition.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,6 +31,7 @@ |
|  |  |  |
|  |  | //Columns name |
|  |  | $aColumns = array('e.timestamp', 'u.login', 'i.label', 'u.name', 'u.lastname'); |
|  |  | $aSortTypes = array('ASC', 'DESC'); |
|  |  |  |
|  |  | //init SQL variables |
|  |  | $sOrder = $sLimit = $sWhere = ""; |
| Expand All | | @@ -39,19 +40,30 @@ |
|  |  | //Paging |
|  |  | $sLimit = ""; |
|  |  | if (isset($\_GET['iDisplayStart']) && $\_GET['iDisplayLength'] != '-1') { |
|  |  | $sLimit = "LIMIT ". $\_GET['iDisplayStart'] .", ". $\_GET['iDisplayLength'] ; |
|  |  | $sLimit = "LIMIT ". filter\_var($\_GET['iDisplayStart'], FILTER\_SANITIZE\_NUMBER\_INT) .", ". filter\_var($\_GET['iDisplayLength'], FILTER\_SANITIZE\_NUMBER\_INT).""; |
|  |  | } |
|  |  |  |
|  |  | //Ordering |
|  |  |  |
|  |  | if (isset($\_GET['iSortCol\_0'])) { |
|  |  | if (isset($\_GET['iSortCol\_0']) && in\_array($\_GET['iSortCol\_0'], $aSortTypes)) { |
|  |  | $sOrder = "ORDER BY "; |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | /\* |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ($\_GET[ 'bSortable\_'.intval($\_GET['iSortCol\_'.$i]) ] == "true") { |
|  |  | $sOrder .= $aColumns[ intval(mysql\_real\_escape\_string($\_GET['iSortCol\_'.$i])) ]." |
|  |  | ".mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  | \*/ |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ( |
|  |  | $\_GET[ 'bSortable\_'.filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT)] == "true" && |
|  |  | preg\_match("#^(asc|desc)\$#i", $\_GET['sSortDir\_'.$i]) |
|  |  | ) { |
|  |  | $sOrder .= "".$aColumns[ filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT) ]." " |
|  |  | .mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $sOrder = substr\_replace($sOrder, "", -2); |
|  |  | if ($sOrder == "ORDER BY") { |
| Expand Down | |  |

21 changes: 12 additions & 9 deletions

21
[sources/datatable/datatable.kb.php](#diff-4d5c173ab7b3358e1509cbd7fbe5c2777bb0a935a3c150ebb65dd41371331ae5 "sources/datatable/datatable.kb.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/sources/datatable/datatable.kb.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,6 +31,7 @@ |
|  |  |  |
|  |  | //Columns name |
|  |  | $aColumns = array('id', 'category\_id', 'label', 'description', 'author\_id'); |
|  |  | $aSortTypes = array('ASC', 'DESC'); |
|  |  |  |
|  |  | //init SQL variables |
|  |  | $sWhere = $sOrder = $sLimit = ""; |
| Expand All | | @@ -39,20 +40,22 @@ |
|  |  | //Paging |
|  |  | $sLimit = ""; |
|  |  | if (isset($\_GET['iDisplayStart']) && $\_GET['iDisplayLength'] != '-1') { |
|  |  | $sLimit = "LIMIT ". mysql\_real\_escape\_string($\_GET['iDisplayStart']) .", " |
|  |  | . mysql\_real\_escape\_string($\_GET['iDisplayLength']) ; |
|  |  | $sLimit = "LIMIT ". filter\_var($\_GET['iDisplayStart'], FILTER\_SANITIZE\_NUMBER\_INT) .", ". filter\_var($\_GET['iDisplayLength'], FILTER\_SANITIZE\_NUMBER\_INT).""; |
|  |  | } |
|  |  |  |
|  |  | //Ordering |
|  |  |  |
|  |  | if (isset($\_GET['iSortCol\_0'])) { |
|  |  | if (isset($\_GET['iSortCol\_0']) && in\_array($\_GET['iSortCol\_0'], $aSortTypes)) { |
|  |  | $sOrder = "ORDER BY "; |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ($\_GET[ 'bSortable\_'.intval($\_GET['iSortCol\_'.$i]) ] == "true") { |
|  |  | $sOrder .= $aColumns[ intval(mysql\_real\_escape\_string($\_GET['iSortCol\_'.$i])) ]." |
|  |  | ".mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ( |
|  |  | $\_GET[ 'bSortable\_'.filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT)] == "true" && |
|  |  | preg\_match("#^(asc|desc)\$#i", $\_GET['sSortDir\_'.$i]) |
|  |  | ) { |
|  |  | $sOrder .= "".$aColumns[ filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT) ]." " |
|  |  | .mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $sOrder = substr\_replace($sOrder, "", -2); |
|  |  | if ($sOrder == "ORDER BY") { |
| Expand Down | |  |

21 changes: 12 additions & 9 deletions

21
[sources/datatable/datatable.logs.php](#diff-4407c653106040d43ce500b009eb32e3820871704af099fa8b8db287441d21aa "sources/datatable/datatable.logs.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/sources/datatable/datatable.logs.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,7 @@ |
|  |  | if (isset($\_GET['action']) && $\_GET['action'] == "connections") { |
|  |  | //Columns name |
|  |  | $aColumns = array('l.date', 'l.label', 'l.qui', 'u.login'); |
|  |  | $aSortTypes = array('ASC', 'DESC'); |
|  |  |  |
|  |  | //init SQL variables |
|  |  | $sWhere = $sOrder = $sLimit = ""; |
| Expand All | | @@ -41,20 +42,22 @@ |
|  |  | //Paging |
|  |  | $sLimit = ""; |
|  |  | if (isset($\_GET['iDisplayStart']) && $\_GET['iDisplayLength'] != '-1') { |
|  |  | $sLimit = "LIMIT ". mysql\_real\_escape\_string($\_GET['iDisplayStart']) .", " |
|  |  | . mysql\_real\_escape\_string($\_GET['iDisplayLength']) ; |
|  |  | $sLimit = "LIMIT ". filter\_var($\_GET['iDisplayStart'], FILTER\_SANITIZE\_NUMBER\_INT) .", ". filter\_var($\_GET['iDisplayLength'], FILTER\_SANITIZE\_NUMBER\_INT).""; |
|  |  | } |
|  |  |  |
|  |  | //Ordering |
|  |  |  |
|  |  | if (isset($\_GET['iSortCol\_0'])) { |
|  |  | if (isset($\_GET['iSortCol\_0']) && in\_array($\_GET['iSortCol\_0'], $aSortTypes)) { |
|  |  | $sOrder = "ORDER BY "; |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ($\_GET[ 'bSortable\_'.intval($\_GET['iSortCol\_'.$i]) ] == "true") { |
|  |  | $sOrder .= $aColumns[ intval(mysql\_real\_escape\_string($\_GET['iSortCol\_'.$i])) ]." |
|  |  | ".mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ( |
|  |  | $\_GET[ 'bSortable\_'.filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT)] == "true" && |
|  |  | preg\_match("#^(asc|desc)\$#i", $\_GET['sSortDir\_'.$i]) |
|  |  | ) { |
|  |  | $sOrder .= "".$aColumns[ filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT) ]." " |
|  |  | .mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $sOrder = substr\_replace($sOrder, "", -2); |
|  |  | if ($sOrder == "ORDER BY") { |
| Expand Down | |  |

21 changes: 12 additions & 9 deletions

21
[sources/datatable/datatable.users\_logged.php](#diff-3af35c32112200c66bbb3d056d24123c3dd92885543c3ee0dba0d20b2df46766 "sources/datatable/datatable.users_logged.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/sources/datatable/datatable.users_logged.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,7 @@ |
|  |  |  |
|  |  | //Columns name |
|  |  | $aColumns = array('login', 'name', 'lastname', 'timestamp', 'last\_connexion'); |
|  |  | $aSortTypes = array('ASC', 'DESC'); |
|  |  |  |
|  |  | //init SQL variables |
|  |  | $sOrder = $sLimit = ""; |
| Expand All | | @@ -41,20 +42,22 @@ |
|  |  | //Paging |
|  |  | $sLimit = ""; |
|  |  | if (isset($\_GET['iDisplayStart']) && $\_GET['iDisplayLength'] != '-1') { |
|  |  | $sLimit = "LIMIT ". mysql\_real\_escape\_string($\_GET['iDisplayStart']) .", " |
|  |  | . mysql\_real\_escape\_string($\_GET['iDisplayLength']); |
|  |  | $sLimit = "LIMIT ". filter\_var($\_GET['iDisplayStart'], FILTER\_SANITIZE\_NUMBER\_INT) .", ". filter\_var($\_GET['iDisplayLength'], FILTER\_SANITIZE\_NUMBER\_INT).""; |
|  |  | } |
|  |  |  |
|  |  | //Ordering |
|  |  |  |
|  |  | if (isset($\_GET['iSortCol\_0'])) { |
|  |  | if (isset($\_GET['iSortCol\_0']) && in\_array($\_GET['iSortCol\_0'], $aSortTypes)) { |
|  |  | $sOrder = "ORDER BY "; |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ($\_GET[ 'bSortable\_'.intval($\_GET['iSortCol\_'.$i]) ] == "true") { |
|  |  | $sOrder .= $aColumns[ intval(mysql\_real\_escape\_string($\_GET['iSortCol\_'.$i])) ]." |
|  |  | ".mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  | if ( |
|  |  | $\_GET[ 'bSortable\_'.filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT)] == "true" && |
|  |  | preg\_match("#^(asc|desc)\$#i", $\_GET['sSortDir\_'.$i]) |
|  |  | ) { |
|  |  | $sOrder .= "".$aColumns[ filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT) ]." " |
|  |  | .mysql\_real\_escape\_string($\_GET['sSortDir\_'.$i]) .", "; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | $sOrder = substr\_replace($sOrder, "", -2); |
|  |  | if ($sOrder == "ORDER BY") { |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[sources/find.queries.php](#diff-6761d4fe0858b866568eeb59e8a6a9e4a80c028adb54c7cf32d3b3d6183424b7 "sources/find.queries.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/8820c8934d9ba0508ac345e73ad0be29049ec6de/sources/find.queries.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -84,7 +84,6 @@ |
|  |  | if (isset($\_GET['iSortCol\_0']) && in\_array($\_GET['iSortCol\_0'], $aSortTypes)) { |
|  |  | $sOrder = "ORDER BY "; |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  |  |
|  |  | if ( |
|  |  | $\_GET[ 'bSortable\_'.filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT)] == "true" && |
|  |  | preg\_match("#^(asc|desc)\$#i", $\_GET['sSortDir\_'.$i]) |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8820c89`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnilsteampassnet%2FTeamPass%2Fcommit%2F8820c8934d9ba0508ac345e73ad0be29049ec6de) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_8c837e5a_20250125_111935.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[<thread-prev]](../../../2014/05/18/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <201405190705.s4J74tuP026290@linus.mitre.org>
Date: Mon, 19 May 2014 03:04:55 -0400 (EDT)
From: cve-assign@...re.org
To: mattd@...fuzz.com
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: CVE requests / advisory: TeamPass <= 2.1.19

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> All the issues are found in TeamPass versions <= 2.1.19, and all were
> reported by myself.

Here are the CVE IDs for your discoveries. The commits mentioned in
your original message have many other changes that are unrelated to
your discoveries. Those other changes are not within the scope of any
of these CVE IDs. If any of those changes should be interpreted as
vulnerability fixes, one or more additional CVE IDs may be assigned.

> Issue #1: File execution protection bypass via language path injection

Use CVE-2014-3771.

> Issue #2: File execution protection bypass via incorrect use of
>           session variables

Use CVE-2014-3772.

> Issue #3: Multiple SQL injection vectors in sources/main.queries.php
> Issue #4: Multiple SQL injection vectors in sources/datatable/*; and
>           datatable.logs.php (in the root directory, *not* in
>           sources/datatable directory)

Use CVE-2014-3773 for issues 3 and 4.

> Issue #5: Multiple XSS vectors in items.php

Use CVE-2014-3774.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJTeazMAAoJEKllVAevmvms4h0H/RbumrESu6O9eS2pUJIvgkow
1oPUsqVY7WmXa/Uam5Irq27bM3f3Nt1WVgc3Fn5U7v5hXVjI7PPD9guIIN8tFado
eTpjbyuVgHXeKfukESvIgbFQHrGvvlcYDGtS3MRBIPpXSEutqtlsFIHZHRzmqhWO
roHNH2/u4dmLfPs14VV5/2iLBExBRQ1m3ZptWXGR3CL0RCAimYlYbdTTj6U6c0Ks
CGumIGZDUFDSfMkjV+R3AHSP0QdMquq0sMWTVAKOUk5N9l8rAF3SDuHFJtBGJ0jR
jz/5JzEsUPb8cAAi36tR6pwE+QtW2+hvrA4I+7W2YKG03HySlwQmWI9qLJ24D78=
=jjpO
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_19da41af_20250125_111935.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[thread-next>]](../../../2014/05/19/5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAD3Canf5xcRtcV=SJHhSxuchxmHatyQG+b+k7UeK6w45fMpyRw@mail.gmail.com>
Date: Sun, 18 May 2014 15:12:35 +1200
From: Matthew Daley <mattd@...fuzz.com>
To: oss-security@...ts.openwall.com
Subject: CVE requests / advisory: TeamPass <= 2.1.19

Hi,

I'd like to request CVE IDs for these issues. They were found in
TeamPass (www.teampass.net), an open-source collaborative password
manager.

This is the first such request and the issues are now public; this
message serves as an advisory as well.

All the issues are found in TeamPass versions <= 2.1.19, and all were
reported by myself. The fixes are in the project's 2.1.20 git branch
and not master (which is where users are directed to download the
project from on the project's homepage.)

Issue #1: File execution protection bypass via language path injection

Numerous TeamPass PHP files check for the existence and the setting of
a $_SESSION value, "CPM", in order to prevent them from being
requested by users and executed directly without going through
index.php as actually intended.

However, index.php (and sources/main.queries.php with the
"change_user_language" request) allows users to set their language by
passing it in via a POST variable. It is not checked for validity;
FILTER_SANITIZE_STRING is not sufficient. A user can set their
language so that the attempt by index.php to require_once a language
file actually leads to loading one of the aforementioned
execution-protected files. At this point, index.php has already set
the CPM session variable and hence the protection is bypassed.

For example, using this vulnerability, an unauthenticated user can
cause the administrator settings page to be rendered. They can then
change any admin settings as if they were logged in as the
administrator. Interesting settings to change include: the ldap
settings, so as to point to an attacker-controlled LDAP server to
allow login to the TeamPass instance; the custom login text, which is
shown unescaped at the login prompt, for a stored-XSS attack to
retrieve users' credentials; or the filesystem path settings, to
divert execution to other locations.

This issue is exploitable by remote unauthenticated users with a wide
impact depending on the pages/settings accessed (login bypass, remote
code execution (see example in next issue), ...).

Fix: <https://github.com/nilsteampassnet/TeamPass/commit/fd549b245c0f639a8d47bf4f74f92c37c053706f>

Issue #2: File execution protection bypass via incorrect use of
session variables

This relates to the same $_SESSION-based "CPM" checks that certain
files make in order to prevent their direct execution by users.

There is another bypass; it is simpler but allows the execution of
slightly fewer execution-protected files.

index.php sets the session CPM variable to 1 at the start of its
execution. Hence, by simply requesting index.php, a user is able to
then directly execute some of the other execution-protected files. The
files affected are limited to the ones that call session_start before
checking the CPM protection key. If they do not, then the CPM key is
obviously unset and hence the protection still works correctly.

For example:
$ curl -b /tmp/cookies -c /tmp/cookies
'<http://192.168.1.73/TeamPass/sources/upload/upload.files.php?PHPSESSID='>;
echo
Hacking attempt...
$ curl -b /tmp/cookies -c /tmp/cookies
'[http://192.168.1.73/TeamPass/index.php'](http://192.168.1.73/TeamPass/index.php%27) &> /dev/null
$ curl -b /tmp/cookies -c /tmp/cookies
'<http://192.168.1.73/TeamPass/sources/upload/upload.files.php?PHPSESSID='>;
echo
{"jsonrpc" : "2.0", "result" : null, "id" : "id"}

Observe that after requesting index.php, we have access to TeamPass's
file upload facility, obviously a sensitive component. I have tested
that file upload is indeed possible this way.

This issue is exploitable by remote unauthenticated users and
similarly has a wide impact depending on the pages/settings accessed
(login bypass, remote code execution...).

Fix: <https://github.com/nilsteampassnet/TeamPass/commit/7715512f2bd5659cc69e063a1c513c19e384340f>

Issue #3: Multiple SQL injection vectors in sources/main.queries.php

There are two SQL injection vectors in this file.

The first is in the handling of the "send_pw_by_email" request, namely
in the "login" POST variable. This is interpolated, unescaped, in the
SQL query that checks whether there is already a password reset
request key in the database.

The second is in the handling of the "generate_new_password" request,
namely in the "login" POST variable again. This is interpolated,
unescaped, in the SQL query that retrieves the password reset request
key from the database.

These vectors are accessible by remote unauthenticated users by
exploiting the first two issues, or to authenticated users directly. I
have tested each unique type of injection with sqlmap and have
confirmed that they allow the complete dump of the database,
modification of its data, remote SQL/OS shell execution, etc.

Fix: <https://github.com/nilsteampassnet/TeamPass/commit/7715512f2bd5659cc69e063a1c513c19e384340f>

Issue #4: Multiple SQL injection vectors in sources/datatable/*; and
datatable.logs.php (in the root directory, *not* in sources/datatable
directory)

There are numerous copy-pasted SQL injections in each of these files.
I'll describe the common element of each instead of splitting them
across each of the five files.

The first and second are in the "iDisplayStart" and "iDisplayLength"
GET variables. These are used to build a SQL query LIMIT fragment.
They are interpolated, unescaped, into this fragment.

These are repeated per-action in each of the five files, giving rise
to a total of 2 * (1 + 6 + 1 + 1 + 5) = 28 SQL injection vectors.

The third is in the "sSortDir_..." GET variable(s). This *is*
mysql_real_escape_string'd before interpolation into a SQL query ORDER
BY fragment, but it is not surrounded by apostrophes in the fragment.
It is therefore still open to exploitation by using injections that do
not involve any characters that are escaped.

These are repeated per-action in each of the five files, giving rise
to a total of 1 * (1 + 6 + 1 + 1 + 5) = 14 SQL injection vectors.

These vectors are accessible by remote unauthenticated users by
exploiting the first two issues, or to authenticated users directly. I
have tested each unique type of injection with sqlmap and have
confirmed that they allow the complete dump of the database,
modification of its data, remote SQL/OS shell execution, etc.

Fix: <https://github.com/nilsteampassnet/TeamPass/commit/7715512f2bd5659cc69e063a1c513c19e384340f>
and <https://github.com/nilsteampassnet/TeamPass/commit/8820c8934d9ba0508ac345e73ad0be29049ec6de>

Issue #5: Multiple XSS vectors in items.php

There are four locations where user-provided input is echoed back into
the generated page without escaping in this file:

- Three locations with the "group" GET parameter when outputting the
"hid_cat" and "open_folder" form input HTML elements
- One location with the "id" GET parameter when outputting the
"open_id" form input HTML element.

A remote unauthenticated attacker can, with limited victim input,
navigate a logged-in TeamPass user with a crafted URL and perform an
XSS attack, allowing ie. the exfiltration of the user's cookies so as
to allow the attacker to authenticate as the victim.

Fix: <https://github.com/nilsteampassnet/TeamPass/commit/fd549b245c0f639a8d47bf4f74f92c37c053706f>
and <https://github.com/nilsteampassnet/TeamPass/commit/8820c8934d9ba0508ac345e73ad0be29049ec6de>

Please let me know if you need any further information.

Thanks,

- Matthew Daley

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_14776db8_20250125_111939.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnilsteampassnet%2FTeamPass%2Fcommit%2Ffd549b245c0f639a8d47bf4f74f92c37c053706f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnilsteampassnet%2FTeamPass%2Fcommit%2Ffd549b245c0f639a8d47bf4f74f92c37c053706f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nilsteampassnet%2FTeamPass)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nilsteampassnet](/nilsteampassnet)
/
**[TeamPass](/nilsteampassnet/TeamPass)**
Public

* [Notifications](/login?return_to=%2Fnilsteampassnet%2FTeamPass) You must be signed in to change notification settings
* [Fork
  552](/login?return_to=%2Fnilsteampassnet%2FTeamPass)
* [Star
   1.7k](/login?return_to=%2Fnilsteampassnet%2FTeamPass)

* [Code](/nilsteampassnet/TeamPass)
* [Issues
  703](/nilsteampassnet/TeamPass/issues)
* [Pull requests
  9](/nilsteampassnet/TeamPass/pulls)
* [Discussions](/nilsteampassnet/TeamPass/discussions)
* [Actions](/nilsteampassnet/TeamPass/actions)
* [Projects
  0](/nilsteampassnet/TeamPass/projects)
* [Wiki](/nilsteampassnet/TeamPass/wiki)
* [Security](/nilsteampassnet/TeamPass/security)
* [Insights](/nilsteampassnet/TeamPass/pulse)

Additional navigation options

* [Code](/nilsteampassnet/TeamPass)
* [Issues](/nilsteampassnet/TeamPass/issues)
* [Pull requests](/nilsteampassnet/TeamPass/pulls)
* [Discussions](/nilsteampassnet/TeamPass/discussions)
* [Actions](/nilsteampassnet/TeamPass/actions)
* [Projects](/nilsteampassnet/TeamPass/projects)
* [Wiki](/nilsteampassnet/TeamPass/wiki)
* [Security](/nilsteampassnet/TeamPass/security)
* [Insights](/nilsteampassnet/TeamPass/pulse)

## Commit

[Permalink](/nilsteampassnet/TeamPass/commit/fd549b245c0f639a8d47bf4f74f92c37c053706f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Several security improvements

[Browse files](/nilsteampassnet/TeamPass/tree/fd549b245c0f639a8d47bf4f74f92c37c053706f)
Browse the repository at this point in the history

```
New feature: one time item view for anonymous user
```

* Loading branch information

[![@nilsteampassnet](https://avatars.githubusercontent.com/u/1197546?s=40&v=4)](/nilsteampassnet)

[nilsteampassnet](/nilsteampassnet/TeamPass/commits?author=nilsteampassnet "View all commits by nilsteampassnet")
committed
Apr 26, 2014

1 parent
[8e70cd0](/nilsteampassnet/TeamPass/commit/8e70cd09627efb1d33bbe6ad5e52f2422b3bd76e)

commit fd549b2

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**241 additions**
and
**32 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* changelog.md
  [changelog.md](#diff-3bd14d078188074c410028847113ceae68865d0ad5b844a27183ef87fbe2fcc3)
* includes

  + images

    - includes/images/globe-share.png
      [globe-share.png](#diff-b3a6098d9a100be629046eef2ff6d71985ccc4fd404da829fdc80d75891e9d87)
  + includes/include.php
    [include.php](#diff-8f6bdb56a3a218535853a3db79a18287ba1bce96740e3a9bdad5331668a62323)
  + language

    - includes/language/english.php
      [english.php](#diff-3897f21a252b4829b489c86594bb4fb302756f8aa06cc505bea48d15ffb3a2e4)
* index.php
  [index.php](#diff-7413d6453f901e939bbd840c8f0d1c7b20c2ca0e7f71741e4e07c6cf036f16c0)
* items.load.php
  [items.load.php](#diff-2569b5b1b2fce55e564b64928ccc701df3a2f2972428ec69bdfe69690e5f8b85)
* items.php
  [items.php](#diff-882d1a265bd338f86e21608a5895f19c7ae25343edd4c50380942736f0742f14)
* otv.php
  [otv.php](#diff-d124459c4c118d3f1c1cc74520b6bdee2aee16aaf46a0705d80144f37dc7be8d)
* sources

  + sources/find.queries.php
    [find.queries.php](#diff-6761d4fe0858b866568eeb59e8a6a9e4a80c028adb54c7cf32d3b3d6183424b7)
  + sources/items.queries.php
    [items.queries.php](#diff-258a42ebc00fce7c8a6c4c8d47a4c93ca1ff80081c35c66766fd7b66462bf0fa)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[changelog.md](#diff-3bd14d078188074c410028847113ceae68865d0ad5b844a27183ef87fbe2fcc3 "changelog.md")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/changelog.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -20,6 +20,7 @@ |
|  |  | #544 - DataTables warning: JSON data from server could not be parsed |
|  |  | Fork from slimm609 - Encrypted Sessions and CSRFGuard enabled |
|  |  | Issues with folder creation in "personal folder" |
|  |  | New: one time view page for anonymous user |
|  |  |  |
|  |  | 2.1.19 |
|  |  | #413 - fix for PHP Parse error: syntax error, unexpected '[' |
| Expand Down | |  |

Binary file added
BIN
+868 Bytes

[includes/images/globe-share.png](#diff-b3a6098d9a100be629046eef2ff6d71985ccc4fd404da829fdc80d75891e9d87 "includes/images/globe-share.png")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/includes/images/globe-share.png)
Edit file

Delete file

 Loading

Sorry, something went wrong. [Reload?](https://github.com/_view_fragments/Voltron%3A%3ACommitFragmentsController/show/nilsteampassnet/TeamPass/fd549b245c0f639a8d47bf4f74f92c37c053706f/commit_show_contents)
Sorry, we cannot display this file.
Sorry, this file is invalid so it cannot be displayed.
Viewer requires iframe.

3 changes: 3 additions & 0 deletions

3
[includes/include.php](#diff-8f6bdb56a3a218535853a3db79a18287ba1bce96740e3a9bdad5331668a62323 "includes/include.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/includes/include.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,11 +22,14 @@ |
|  |  | $k['admin\_full\_right'] = true; |
|  |  | $k['admin\_no\_info'] = false; |
|  |  | $k['copyright'] = " &copy; 2009 - 2014"; |
|  |  | $k['otv\_expiration\_period'] = 604800; // 1 week |
|  |  | $k['allowedTags'] = "<b><i><sup><sub><em><strong><u><br><br /><a><strike><ul><blockquote><blockquote><img><li><h1><h2><h3><h4><h5><ol><small><font>"; |
|  |  |  |
|  |  | @define('ERR\_NOT\_ALLOWED', "1000"); |
|  |  | @define('ERR\_NOT\_EXIST', "1001"); |
|  |  | @define('ERR\_SESS\_EXPIRED', "1002"); |
|  |  | @define('ERR\_NO\_MCRYPT', "1003"); |
|  |  | @define('ERR\_VALID\_SESSION', "1004"); |
|  |  |  |
|  |  | // Management Pages |
|  |  | $mngPages = array( |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[includes/language/english.php](#diff-3897f21a252b4829b489c86594bb4fb302756f8aa06cc505bea48d15ffb3a2e4 "includes/language/english.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/includes/language/english.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,6 +6,8 @@ |
|  |  | $TeamPass\_url = $\_SESSION['settings']['cpassman\_url']; |
|  |  | } |
|  |  |  |
|  |  | $txt['one\_time\_item\_view'] = "One time view link"; |
|  |  | $txt['one\_time\_view\_item\_url\_box'] = "Share the One-Time URL with a person of Trust <br><br>#URL#<br><br>Remember that this link will only be visible one time until the #DAY#"; |
|  |  | $txt['url\_copied\_clipboard'] = "URL copied in clipboard"; |
|  |  | $txt['url\_copy'] = "Copy URL in clipboard"; |
|  |  |  |
| Expand Down | |  |

45 changes: 28 additions & 17 deletions

45
[index.php](#diff-7413d6453f901e939bbd840c8f0d1c7b20c2ca0e7f71741e4e07c6cf036f16c0 "index.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/index.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,7 +10,7 @@ |
|  |  | \* |
|  |  | \* @file index.php |
|  |  | \* @author Nils Laumaillé |
|  |  | \* @version 2.1.19 |
|  |  | \* @version 2.1.20 |
|  |  | \* @copyright (c) 2009-2014 Nils Laumaillé |
|  |  | \* @licensing GNU AFFERO GPL 3.0 |
|  |  | \* @link http://www.teampass.net |
| Expand Down  Expand Up | | @@ -51,15 +51,12 @@ |
|  |  |  |
|  |  | //load main functions needed |
|  |  | require\_once 'sources/main.functions.php'; |
|  |  | // Load CORE |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/sources/core.php'; |
|  |  |  |
|  |  | /\* DEFINE WHAT LANGUAGE TO USE \*/ |
|  |  | if (!isset($\_SESSION['user\_id']) && !isset($\_POST['language'])) { |
|  |  | //get default language |
|  |  | /\*$dataLanguage = |
|  |  | $db->fetchRow( |
|  |  | "SELECT valeur FROM ".$pre."misc |
|  |  | WHERE type = 'admin' AND intitule = 'default\_language'" |
|  |  | );\*/ |
|  |  | $dataLanguage = $db->queryGetRow( |
|  |  | "misc", |
|  |  | array( |
| Expand Down  Expand Up | | @@ -91,12 +88,16 @@ |
|  |  | } |
|  |  | } |
|  |  | // Load user languages files |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/includes/language/'.$\_SESSION['user\_language'].'.php'; |
|  |  | if (isset($\_GET['page']) && $\_GET['page'] == "kb") { |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/includes/language/'.$\_SESSION['user\_language'].'\_kb.php'; |
|  |  | if (in\_array($\_SESSION['user\_language'], $languagesList)) { |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/includes/language/'.$\_SESSION['user\_language'].'.php'; |
|  |  | if (isset($\_GET['page']) && $\_GET['page'] == "kb") { |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/includes/language/'.$\_SESSION['user\_language'].'\_kb.php'; |
|  |  | } |
|  |  | } else { |
|  |  | $\_SESSION['error']['code'] = ERR\_NOT\_ALLOWED; //not allowed page |
|  |  | include 'error.php'; |
|  |  | } |
|  |  | // Load CORE |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/sources/core.php'; |
|  |  |  |
|  |  | // Load links, css and javascripts |
|  |  | @require\_once $\_SESSION['settings']['cpassman\_dir'].'/load.php'; |
|  |  | ?> |
| Expand Down  Expand Up | | @@ -208,7 +209,8 @@ |
|  |  | </div>'; |
|  |  | } |
|  |  | // Display language menu |
|  |  | echo ' |
|  |  | if (!isset($\_GET['otv'])) { |
|  |  | echo ' |
|  |  | <div style="float:right;"> |
|  |  | <dl id="flags" class="dropdown"> |
|  |  | <dt><img src="includes/images/flags/'.$\_SESSION['user\_language\_flag'].'" alt="" /></dt> |
| Expand All | | @@ -218,7 +220,9 @@ |
|  |  | </ul> |
|  |  | </dd> |
|  |  | </dl> |
|  |  | </div> |
|  |  | </div>'; |
|  |  | } |
|  |  | echo ' |
|  |  | </div>'; |
|  |  |  |
|  |  | /\* LAST SEEN \*/ |
| Expand Down  Expand Up | | @@ -299,7 +303,9 @@ |
|  |  | <br /> |
|  |  | <button title="'.$txt['history'].'" id="menu\_button\_history" class="" onclick="OpenDialog(\'div\_item\_history\', \'false\')"><img src="includes/images/report.png" id="div\_history" alt="" /></button> |
|  |  | <br /> |
|  |  | <button title="'.$txt['share'].'" id="menu\_button\_share" class="" onclick="OpenDialog(\'div\_item\_share\', \'false\')"><img src="includes/images/share.png" id="div\_share" alt="" /></button>'; |
|  |  | <button title="'.$txt['share'].'" id="menu\_button\_share" class="" onclick="OpenDialog(\'div\_item\_share\', \'false\')"><img src="includes/images/share.png" id="div\_share" alt="" /></button> |
|  |  | <br /> |
|  |  | <button title="'.$txt['one\_time\_item\_view'].'" id="menu\_button\_otv" class="" onclick="prepareOneTimeView()"><img src="includes/images/globe-share.png" id="div\_otv" alt="" /></button>'; |
|  |  | if (isset($\_SESSION['settings']['enable\_email\_notification\_on\_item\_shown']) && $\_SESSION['settings']['enable\_email\_notification\_on\_item\_shown'] == 1) { |
|  |  | echo ' |
|  |  | <br /> |
| Expand Down  Expand Up | | @@ -458,9 +464,14 @@ class="ui-state-highlight ui-corner-all" id="div\_maintenance"> |
|  |  | include 'error.php'; |
|  |  | } elseif ((!isset($\_SESSION['validite\_pw']) || empty($\_SESSION['validite\_pw']) || empty($\_SESSION['user\_id'])) && isset($\_GET['otv']) && $\_GET['otv'] == "true") { |
|  |  | // case where one-shot viewer |
|  |  | if (isset($\_GET['session']) && !empty($\_GET['session'])) { |
|  |  | include 'otv.php?session='.$\_GET['session']; |
|  |  | } else { |
|  |  | if ( |
|  |  | isset($\_GET['code']) && !empty($\_GET['code']) |
|  |  | && isset($\_GET['item\_id']) && !empty($\_GET['item\_id']) |
|  |  | && isset($\_GET['stamp']) && !empty($\_GET['stamp']) |
|  |  | && isset($\_GET['otv\_id']) |
|  |  | ) { |
|  |  | include 'otv.php'; |
|  |  | } else { |
|  |  | $\_SESSION['error']['code'] = ERR\_VALID\_SESSION; |
|  |  | $\_SESSION['initial\_url'] = substr($\_SERVER["REQUEST\_URI"], strpos($\_SERVER["REQUEST\_URI"], "index.php?")); |
|  |  | include 'error.php'; |
| Expand Down | |  |

34 changes: 30 additions & 4 deletions

34
[items.load.php](#diff-2569b5b1b2fce55e564b64928ccc701df3a2f2972428ec69bdfe69690e5f8b85 "items.load.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/items.load.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -162,7 +162,7 @@ function ListerItems(groupe\_id, restricted, start) |
|  |  | if ($(".tr\_fields") != undefined) $(".tr\_fields, .newItemCat, .editItemCat").hide(); |
|  |  |  |
|  |  | //Disable menu buttons |
|  |  | $('#menu\_button\_edit\_item,#menu\_button\_del\_item,#menu\_button\_add\_fav,#menu\_button\_del\_fav,#menu\_button\_show\_pw,#menu\_button\_copy\_pw,#menu\_button\_copy\_login,#menu\_button\_copy\_link,#menu\_button\_copy\_item,#menu\_button\_notify,#menu\_button\_history,#menu\_button\_share').attr('disabled', 'disabled'); |
|  |  | $('#menu\_button\_edit\_item,#menu\_button\_del\_item,#menu\_button\_add\_fav,#menu\_button\_del\_fav,#menu\_button\_show\_pw,#menu\_button\_copy\_pw,#menu\_button\_copy\_login,#menu\_button\_copy\_link,#menu\_button\_copy\_item,#menu\_button\_notify,#menu\_button\_history,#menu\_button\_share,#menu\_button\_otv').attr('disabled', 'disabled'); |
|  |  |  |
|  |  | // clear existing clips |
|  |  | //ZeroClipboard.destroy(); |
| Expand Down  Expand Up | | @@ -197,7 +197,7 @@ function(data) { |
|  |  | } else if (data.error == "not\_authorized") { |
|  |  | //warn user |
|  |  | $("#hid\_cat").val(""); |
|  |  | $("#menu\_button\_copy\_item, #menu\_button\_add\_group, #menu\_button\_edit\_group, #menu\_button\_del\_group, #menu\_button\_add\_item, #menu\_button\_edit\_item, #menu\_button\_del\_item, #menu\_button\_history, #menu\_button\_share").attr('disabled', 'disabled'); |
|  |  | $("#menu\_button\_copy\_item, #menu\_button\_add\_group, #menu\_button\_edit\_group, #menu\_button\_del\_group, #menu\_button\_add\_item, #menu\_button\_edit\_item, #menu\_button\_del\_item, #menu\_button\_history, #menu\_button\_share, #menu\_button\_otv").attr('disabled', 'disabled'); |
|  |  | $("#item\_details\_nok").show(); |
|  |  | $("#item\_details\_ok, #item\_details\_no\_personal\_saltkey").hide(); |
|  |  | $("#items\_list\_loader").hide(); |
| Expand Down  Expand Up | | @@ -1115,9 +1115,9 @@ function(data) { |
|  |  |  |
|  |  | // disable share button for personal folder |
|  |  | if ($("#recherche\_group\_pf").val() == 1) { |
|  |  | $("#menu\_button\_share").attr('disabled', 'disabled'); |
|  |  | $("#menu\_button\_share, #menu\_button\_otv").attr('disabled', 'disabled'); |
|  |  | } else { |
|  |  | $("#menu\_button\_share").prop("disabled", false); |
|  |  | $("#menu\_button\_share, #menu\_button\_otv").prop("disabled", false); |
|  |  | } |
|  |  |  |
|  |  | //Manage to deleted information |
| Expand Down  Expand Up | | @@ -2600,4 +2600,30 @@ function aes\_decrypt(text) |
|  |  | { |
|  |  | return Aes.Ctr.decrypt(text, "<?php echo $\_SESSION['key'];?>", 256); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* Launch the redirection to OTV page |
|  |  | \*/ |
|  |  | function prepareOneTimeView() |
|  |  | { |
|  |  | //Send query |
|  |  | $.post( |
|  |  | "sources/items.queries.php", |
|  |  | { |
|  |  | type : "generate\_OTV\_url", |
|  |  | id : $("#id\_item").val(), |
|  |  | key : "<?php echo $\_SESSION['key'];?>" |
|  |  | }, |
|  |  | function(data) { |
|  |  | //check if format error |
|  |  | if (data[0].error == "") { |
|  |  | $("#div\_dialog\_message").dialog('open'); |
|  |  | $("#div\_dialog\_message\_text").html(data[0].url); |
|  |  | } else { |
|  |  | $("#item\_history\_log\_error").html(data[0].error).show(); |
|  |  | } |
|  |  | }, |
|  |  | "json" |
|  |  | ); |
|  |  | } |
|  |  | </script> |

14 changes: 7 additions & 7 deletions

14
[items.php](#diff-882d1a265bd338f86e21608a5895f19c7ae25343edd4c50380942736f0742f14 "items.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/items.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,9 +14,9 @@ |
|  |  | \*/ |
|  |  |  |
|  |  | if ( |
|  |  | !isset($\_SESSION['CPM']) || $\_SESSION['CPM'] != 1 || |
|  |  | !isset($\_SESSION['user\_id']) || empty($\_SESSION['user\_id']) || |
|  |  | !isset($\_SESSION['key']) || empty($\_SESSION['key'])) |
|  |  | !isset($\_SESSION['CPM']) || $\_SESSION['CPM'] != 1 || |
|  |  | !isset($\_SESSION['user\_id']) || empty($\_SESSION['user\_id']) || |
|  |  | !isset($\_SESSION['key']) || empty($\_SESSION['key'])) |
|  |  | { |
|  |  | die('Hacking attempt...'); |
|  |  | } |
| Expand Down  Expand Up | | @@ -74,11 +74,11 @@ |
|  |  | $selectVisibleFoldersOptions = $selectVisibleNonPersonalFoldersOptions = ""; |
|  |  | // Hidden things |
|  |  | echo ' |
|  |  | <input type="hidden" name="hid\_cat" id="hid\_cat" value="', isset($\_GET['group']) ? $\_GET['group'] : "", '" /> |
|  |  | <input type="hidden" name="hid\_cat" id="hid\_cat" value="', isset($\_GET['group']) ? htmlspecialchars($\_GET['group']) : "", '" /> |
|  |  | <input type="hidden" id="complexite\_groupe" /> |
|  |  | <input type="hidden" name="selected\_items" id="selected\_items" /> |
|  |  | <input type="hidden" name="input\_liste\_utilisateurs" id="input\_liste\_utilisateurs" value="'.$usersString.'" /> |
|  |  | <input type="hidden" name="input\_list\_roles" id="input\_list\_roles" value="'.htmlentities($listRoles, ENT\_QUOTES, 'UTF-8').'" /> |
|  |  | <input type="hidden" name="input\_list\_roles" id="input\_list\_roles" value="'.htmlspecialchars(htmlentities($listRoles, ENT\_QUOTES, 'UTF-8')).'" /> |
|  |  | <input type="hidden" id="bloquer\_creation\_complexite" /> |
|  |  | <input type="hidden" id="bloquer\_modification\_complexite" /> |
|  |  | <input type="hidden" id="error\_detected" /> |
| Expand All | | @@ -87,7 +87,7 @@ |
|  |  | <input type="hidden" id="richtext\_on" value="1" /> |
|  |  | <input type="hidden" id="query\_next\_start" value="0" /> |
|  |  | <input type="hidden" id="display\_categories" value="0" /> |
|  |  | <input type="hidden" id="nb\_items\_to\_display\_once" value="', isset($\_SESSION['settings']['nb\_items\_by\_query']) ? $\_SESSION['settings']['nb\_items\_by\_query'] : 'auto', '" /> |
|  |  | <input type="hidden" id="nb\_items\_to\_display\_once" value="', isset($\_SESSION['settings']['nb\_items\_by\_query']) ? htmlspecialchars($\_SESSION['settings']['nb\_items\_by\_query']) : 'auto', '" /> |
|  |  | <input type="hidden" id="user\_is\_read\_only" value="', isset($\_SESSION['user\_read\_only']) && $\_SESSION['user\_read\_only'] == 1 ? '1' : '', '" /> |
|  |  | <input type="hidden" id="request\_ongoing" /> |
|  |  | <input type="hidden" id="request\_lastItem" /> |
| Expand Down  Expand Up | | @@ -118,7 +118,7 @@ |
|  |  | $firstGroup = ""; |
|  |  | } |
|  |  | echo ' |
|  |  | <input type="hidden" name="jstree\_group\_selected" id="jstree\_group\_selected" value="'.$firstGroup.'" />'; |
|  |  | <input type="hidden" name="jstree\_group\_selected" id="jstree\_group\_selected" value="'.htmlspecialchars($firstGroup).'" />'; |
|  |  |  |
|  |  | echo ' |
|  |  | <div id="div\_items">'; |
| Expand Down | |  |

103 changes: 103 additions & 0 deletions

103
[otv.php](#diff-d124459c4c118d3f1c1cc74520b6bdee2aee16aaf46a0705d80144f37dc7be8d "otv.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/otv.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,103 @@ |
|  |  | <?php |
|  |  | /\*\* |
|  |  | \* @file otv.php |
|  |  | \* @author Nils Laumaillé |
|  |  | \* @version 2.1.20 |
|  |  | \* @copyright (c) 2009-2014 Nils Laumaillé |
|  |  | \* @licensing GNU AFFERO GPL 3.0 |
|  |  | \* @link http://www.teampass.net |
|  |  | \* |
|  |  | \* This library is distributed in the hope that it will be useful, |
|  |  | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
|  |  | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. |
|  |  | \*/ |
|  |  |  |
|  |  | require\_once('sources/sessions.php'); |
|  |  | @session\_start(); |
|  |  | if (!isset($\_SESSION['CPM']) || $\_SESSION['CPM'] != 1) { |
|  |  | die('Hacking attempt...'); |
|  |  | } |
|  |  |  |
|  |  | $html = ""; |
|  |  | if ( |
|  |  | filter\_var($\_GET['code'], FILTER\_SANITIZE\_STRING) != "" |
|  |  | && filter\_var($\_GET['item\_id'], FILTER\_SANITIZE\_STRING) >= 0 |
|  |  | && filter\_var($\_GET['stamp'], FILTER\_SANITIZE\_STRING) >= 0 |
|  |  | && filter\_var($\_GET['otv\_id'], FILTER\_SANITIZE\_STRING) >= 0 |
|  |  | ) { |
|  |  | //Include files |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/includes/settings.php'; |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/includes/include.php'; |
|  |  | require\_once $\_SESSION['settings']['cpassman\_dir'].'/sources/SplClassLoader.php'; |
|  |  |  |
|  |  | // connect to DB |
|  |  | $db = new SplClassLoader('Database\Core', '../includes/libraries'); |
|  |  | $db->register(); |
|  |  | $db = new Database\Core\DbCore($server, $user, $pass, $database, $pre); |
|  |  | $db->connect(); |
|  |  |  |
|  |  | // Include main functions used by TeamPass |
|  |  | require\_once 'sources/main.functions.php'; |
|  |  |  |
|  |  | // check session validity |
|  |  | $data = $db->queryGetRow( |
|  |  | "otv", |
|  |  | array( |
|  |  | "timestamp", |
|  |  | "code", |
|  |  | "item\_id" |
|  |  | ), |
|  |  | array( |
|  |  | "id" => intval($\_GET['otv\_id']) |
|  |  | ) |
|  |  | ); |
|  |  | if ( |
|  |  | $data[0] == $\_GET['stamp'] |
|  |  | && $data[1] == $\_GET['code'] |
|  |  | && $data[2] == $\_GET['item\_id'] |
|  |  | ) { |
|  |  | // otv is too old |
|  |  | if ($data[0] < (time() - $k['otv\_expiration\_period']) ) { |
|  |  | $html = "Link is too old!"; |
|  |  | } else { |
|  |  | $dataItem = $db->queryFirst( |
|  |  | "SELECT \* |
|  |  | FROM ".$pre."items as i |
|  |  | INNER JOIN ".$pre."log\_items as l ON (l.id\_item = i.id) |
|  |  | WHERE i.id=".intval($\_GET['item\_id'])." |
|  |  | AND l.action = 'at\_creation'" |
|  |  | ); |
|  |  |  |
|  |  | // get data |
|  |  | $pw = decrypt($dataItem['pw']); |
|  |  | $label = $dataItem['label']; |
|  |  | $email = $dataItem['email']; |
|  |  | $url = $dataItem['url']; |
|  |  | $description = preg\_replace('/(?<!\\r)\\n+(?!\\r)/', '', strip\_tags($dataItem['description'], $k['allowedTags'])); |
|  |  | $login = str\_replace('"', '&quot;', $dataItem['login']); |
|  |  |  |
|  |  | // display data |
|  |  | $html = "<div style='margin:30px;'>". |
|  |  | "<div style='font-size:20px;font-weight:bold;'>Welcome to One-Time item view page.</div>". |
|  |  | "<div style='font-style:italic;'>Here are the details of the Item that has been shared to you</div>". |
|  |  | "<div style='margin-top:10px;'><table>". |
|  |  | "<tr><td>Label:</td><td>" . $label . "</td</tr>". |
|  |  | "<tr><td>Password:</td><td>" . $pw . "</td</tr>". |
|  |  | "<tr><td>Description:</td><td>" . $description . "</td</tr>". |
|  |  | "<tr><td>login:</td><td>" . $login . "</td</tr>". |
|  |  | "<tr><td>URL:</td><td>" . $url ."</td</tr>". |
|  |  | "</table></div>". |
|  |  | "<div style='margin-top:30px;'>Copy carefully the data you need. This page is only visible once.</div>". |
|  |  | "</div>"; |
|  |  |  |
|  |  | // delete entry |
|  |  | //$db->query("DELETE FROM ".$pre."otv WHERE id = '".intval($\_GET['item\_id'])."'"); |
|  |  | } |
|  |  | } else { |
|  |  | $html = "Not a valid page!"; |
|  |  | } |
|  |  | } else { |
|  |  | $html = "Not a valid page!"; |
|  |  | } |
|  |  |  |
|  |  | echo $html; |

9 changes: 7 additions & 2 deletions

9
[sources/find.queries.php](#diff-6761d4fe0858b866568eeb59e8a6a9e4a80c028adb54c7cf32d3b3d6183424b7 "sources/find.queries.php")

Show comments

[View file](/nilsteampassnet/TeamPass/blob/fd549b245c0f639a8d47bf4f74f92c37c053706f/sources/find.queries.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ |
|  |  |  |
|  |  | //Columns name |
|  |  | $aColumns = array('id', 'label', 'description', 'tags', 'id\_tree', 'folder', 'login'); |
|  |  | $aSortTypes = array('ASC', 'DESC'); |
|  |  |  |
|  |  | //init SQL variables |
|  |  | $sOrder = $sLimit = ""; |
| Expand Down  Expand Up | | @@ -80,9 +81,10 @@ |
|  |  | } |
|  |  |  |
|  |  | //Ordering |
|  |  | if (isset($\_GET['iSortCol\_0'])) { |
|  |  | if (isset($\_GET['iSortCol\_0']) && in\_array($\_GET['iSortCol\_0'], $aSortTypes)) { |
|  |  | $sOrder = "ORDER BY "; |
|  |  | for ($i=0; $i<intval($\_GET['iSortingCols']); $i++) { |
|  |  |  |
|  |  | if ( |
|  |  | $\_GET[ 'bSortable\_'.filter\_var($\_GET['iSortCol\_'.$i], FILTER\_SANITIZE\_NUMBER\_INT)] == "true" && |
|  |  | preg\_match("#^(asc|desc)\$#i", $\_GET['sSortDir\_'.$i]) |
| Expand All | | @@ -96,8 +98,11 @@ |
|  |  | if ($sOrder == "ORDER BY") { |
|  |  | $sOrder = ""; |
|  |  | } |
|  |  | } else if (!in\_array($\_GET['iSortCol\_0'], $aSortTypes)) { |
|  |  | // possible attack - stop |
|  |  | echo '[{}]'; |
|  |  | } |
|  |  | //echo $sOrder; |
|  |  |  |
|  |  | /\* |
|  |  | \* Filtering |
|  |  | \* NOTE this does not match the built-in DataTables filtering which does it |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fd549b2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnilsteampassnet%2FTeamPass%2Fcommit%2Ffd549b245c0f639a8d47bf4f74f92c37c053706f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


