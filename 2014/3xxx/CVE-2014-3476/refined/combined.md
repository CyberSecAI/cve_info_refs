=== Content from launchpad.net_de4003e8_20250126_123023.html ===

[Log in / Register](https://launchpad.net/~gmollett/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~gmollett)

## [Garth Mollett](https://launchpad.net/~gmollett)

* Overview
* [Code](https://code.launchpad.net/~gmollett)
* [Bugs](https://bugs.launchpad.net/~gmollett)
* [Blueprints](https://blueprints.launchpad.net/~gmollett)
* [Translations](https://translations.launchpad.net/~gmollett)
* [Answers](https://answers.launchpad.net/~gmollett)

* [Related packages](https://launchpad.net/~gmollett/%2Brelated-packages)
* [Related projects](https://launchpad.net/~gmollett/%2Brelated-projects)

## User information

Launchpad Id:
gmollett

Email:
[Log in](%2Blogin) for email information.

Member since:
2013-06-07

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)

Languages:

English

OpenPGP keys:

F4B1ADA16AB1B569B04BF85DF8E92F064A43C1A9

Time zone:

UTC
(UTC+0000)

Karma:
[0](https://launchpad.net/~gmollett/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~gmollett/%2Bparticipation) Latest memberships

| [OpenStack Security SIG](/~openstack-ossg)  Joined on 2014-12-04 | |
| --- | --- |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_358978c3_20250126_123023.html ===

[Log in / Register](https://launchpad.net/~hudson-openstack/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~hudson-openstack)

## [OpenStack Infra](https://launchpad.net/~hudson-openstack)

* Overview
* [Code](https://code.launchpad.net/~hudson-openstack)
* [Bugs](https://bugs.launchpad.net/~hudson-openstack)
* [Blueprints](https://blueprints.launchpad.net/~hudson-openstack)
* [Translations](https://translations.launchpad.net/~hudson-openstack)
* [Answers](https://answers.launchpad.net/~hudson-openstack)

* [Related packages](https://launchpad.net/~hudson-openstack/%2Brelated-packages)
* [Related projects](https://launchpad.net/~hudson-openstack/%2Brelated-projects)

## User information

Launchpad Id:
hudson-openstack

Email:
[Log in](%2Blogin) for email information.

Member since:
2010-07-14

[![Icon of Burrow](https://launchpadlibrarian.net/67728214/os14.png "Member of Burrow")](/~burrow)
[![Icon of Citrix OpenStack development team](https://launchpadlibrarian.net/64472709/Citrix%2014.png "Member of Citrix OpenStack development team")](/~citrix-openstack)
[![Icon of (deprecated) OpenStack PPA maintainers](https://launchpadlibrarian.net/87891894/ppa.gif "Member of (deprecated) OpenStack PPA maintainers")](/~openstack-ppa)
[![Icon of Designate Core](https://launchpadlibrarian.net/360468328/designate_14.jpg "Member of Designate Core")](/~designate-core)
[![Icon of Designate Drivers](https://launchpadlibrarian.net/360468067/designate_14.jpg "Member of Designate Drivers")](/~designate-drivers)
[![Icon of MidoNet Bugs](https://launchpadlibrarian.net/228074955/midonet_14x14.png "Member of MidoNet Bugs")](/~midonet-bugs)
[![Icon of Nova Bug Team](https://launchpadlibrarian.net/108832444/bug.gif "Member of Nova Bug Team")](/~nova-bugs)
[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

OpenPGP keys:

72571ACC301E6FE900837F5CDF85501232EE128C

SSH keys:

[hudson@hudson](%2Bsshkeys)

[jenkins@vpcslave](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[6503](https://launchpad.net/~hudson-openstack/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

## [All memberships](https://launchpad.net/~hudson-openstack/%2Bparticipation) Latest memberships

| [Compute Hyper-V Bugs](/~compute-hyperv-bugs)  Joined on 2019-08-28 | |
| --- | --- |
| [OS-Win Bugs](/~os-win-bugs)  Joined on 2019-08-28 | |
| [Networking Hyper-V Bugs](/~networking-hyperv-bugs)  Joined on 2019-08-28 | |
| [kolla-drivers](/~kolla-drivers)  Joined on 2019-05-20 | |
| [fixtures-git-bugs](/~fixtures-git-bugs)  Joined on 2018-03-25 | |

## [Recent activities](https://launchpad.net/~hudson-openstack/%2Bkarma) Most active in

| [StarlingX](/starlingx) |  |
| --- | --- |
| [kolla-ansible](/kolla-ansible) |  |
| [kolla](/kolla) |  |
| [kayobe](/kayobe) |  |
| [OpenStack Compute (nova)](/nova) |  |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_cc0db305_20250126_123020.html ===

[Log in / Register](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* [Translations](https://translations.launchpad.net/keystone)
* [Answers](https://answers.launchpad.net/keystone)

# [OSSA 2014-018] Trust scope can be circumvented by chaining trusts (CVE-2014-3476)

Bug #1324592 reported by
[Steven Hardy](https://launchpad.net/~shardy)
on 2014-05-29

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Identity (keystone)](https://bugs.launchpad.net/keystone) | Fix Released | Critical | [Adam Young](https://launchpad.net/~ayoung) | [OpenStack Identity (keystone) 2014.2 "juno"](https://launchpad.net/keystone/%2Bmilestone/2014.2) |
|  | [Havana](https://bugs.launchpad.net/keystone/havana) | Fix Released | Critical | [Adam Young](https://launchpad.net/~ayoung) | [OpenStack Identity (keystone) 2013.2.4](https://launchpad.net/keystone/%2Bmilestone/2013.2.4) |
|  | [Icehouse](https://bugs.launchpad.net/keystone/icehouse) | Fix Released | Critical | [Adam Young](https://launchpad.net/~ayoung) | [OpenStack Identity (keystone) 2014.1.2](https://launchpad.net/keystone/%2Bmilestone/2014.1.2) |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | High | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |

### Bug Description

I've been experimenting with chaining keystone trusts, and I've encountered what I think is a privilege escalation flaw, where the scope enforced by the trust when initially delegating can be circumvented by creating another trust.

I spoke about this briefly with ayoung on IRC and he seems to be in agreement that this is a bug.

Details:

1. User1 has roles admin and heat\_stack\_owner

2. User1 delegates to User2 via a trust, only delegating only heat\_stack\_owner, and enabling impersonation

3. User2 gets a trust-scoped token, impersonating User1

4. User2 creates a new trust, delegating both admin and heat\_stack\_owner to User3

5. This works, and so when User3 gets a trust scoped token, they can get elevated privileleges, effectively defeating the point of role-limited delegation via the trust.

I've attached a reproducer which demonstrates the problem.

Tags:

[in-stable-icehouse](/keystone/%2Bbugs?field.tag=in-stable-icehouse)

## CVE References

* [2014-3476](/bugs/cve/2014-3476 "OpenStack Identity (Keystone) before ...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steven Hardy (shardy)](https://launchpad.net/~shardy) wrote on 2014-05-29: |  |  | [#1](/keystone/%2Bbug/1324592/comments/1) |
| --- | --- | --- | --- |

* [Reproducer script](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122312/%2Bfiles/chained_example3.py)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122312)
  (4.2 KiB,
  text/x-python)

| **summary**: | - Trust scope can be circumvented by chaining trustts+ Trust scope can be circumvented by chaining trusts |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-05-29

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-05-29:  [**Re: Trust scope can be circumvented by chaining trusts**](/keystone/%2Bbug/1324592/comments/2) |  |  | [#2](/keystone/%2Bbug/1324592/comments/2) |
| --- | --- | --- | --- |

The OSSA task is incomplete pending additional details from security reviewers, keystone-coresec are now subscribed to the bug.

It does sounds like a practical privilege escalation, shouldn't we raise the priority ?

The OSSA task is incomplete pending additional details from security reviewers, keystone-coresec are now subscribed to the bug.
It does sounds like a practical privilege escalation, shouldn't we raise the priority ?

[Dolph Mathews (dolph)](https://launchpad.net/~dolph)
on 2014-05-29

| Changed in keystone: | |
| --- | --- |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#3](/keystone/%2Bbug/1324592/comments/3) |
| --- | --- | --- | --- |

We originally had a check that a trust token could not be used to make a trust.

Is there any existing need for impersonation?

We originally had a check that a trust token could not be used to make a trust.
Is there any existing need for impersonation?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steven Hardy (shardy)](https://launchpad.net/~shardy) wrote on 2014-05-29: |  |  | [#4](/keystone/%2Bbug/1324592/comments/4) |
| --- | --- | --- | --- |

> Is there any existing need for impersonation?

Yes, AFAIK all of the current use-cases for trusts (heat/solum/ceilometer) require impersonation.

If we need to add a temporary check which denies creating a trust with a trust-scoped token, that sounds fine to me, but then I'd like to get a spec worked out asap for explicit chaining, which is what I tried to specify in the trusts-chained-delegation BP (which was marked implemented for Icehouse), but clearly didn't explain very well because limited-use-trusts got implemented instead :)

I'm happy to work with ayoung to define a spec which enables a limited chain of delegation, and do the work to implement it, as it is needed for Solum/Heat interoperability ref [bug #1317293](/bugs/1317293) (and potentially heat/ceilometer too)

> Is there any existing need for impersonation?
Yes, AFAIK all of the current use-cases for trusts (heat/solum/ceilometer) require impersonation.
If we need to add a temporary check which denies creating a trust with a trust-scoped token, that sounds fine to me, but then I'd like to get a spec worked out asap for explicit chaining, which is what I tried to specify in the trusts-chained-delegation BP (which was marked implemented for Icehouse), but clearly didn't explain very well because limited-use-trusts got implemented instead :)
I'm happy to work with ayoung to define a spec which enables a limited chain of delegation, and do the work to implement it, as it is needed for Solum/Heat interoperability ref bug #1317293 (and potentially heat/ceilometer too)

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2014-05-29

| Changed in keystone: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#5](/keystone/%2Bbug/1324592/comments/5) |
| --- | --- | --- | --- |

* [keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122339/%2Bfiles/keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122339)
  (4.5 KiB,
  text/plain)

This patch performs an explicit test for the trust\_id. In order to perform it, we need to make sure that the context is properly populated.

This patch performs an explicit test for the trust\_id. In order to perform it, we need to make sure that the context is properly populated.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#6](/keystone/%2Bbug/1324592/comments/6) |
| --- | --- | --- | --- |

Above fails pep8.

Above fails pep8.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#7](/keystone/%2Bbug/1324592/comments/7) |
| --- | --- | --- | --- |

* [keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122351/%2Bfiles/keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122351)
  (4.5 KiB,
  text/plain)

Fixes Pep8 and test failures

Fixes Pep8 and test failures

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-29: |  |  | [#8](/keystone/%2Bbug/1324592/comments/8) |
| --- | --- | --- | --- |

Minor Issue on the first pass, the patch has an untranslated string in it:

raise exception.Forbidden(

+ 'Cannot create a trust with a trust scoped token.')

Should be:

raise exception.Forbidden(

+ \_('Cannot create a trust with a trust scoped token.'))

Will look again once I'm back online see if anything else stands out.

Minor Issue on the first pass, the patch has an untranslated string in it:
raise exception.Forbidden(
+ 'Cannot create a trust with a trust scoped token.')
Should be:
raise exception.Forbidden(
+ \_('Cannot create a trust with a trust scoped token.'))
Will look again once I'm back online see if anything else stands out.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-30: |  |  | [#9](/keystone/%2Bbug/1324592/comments/9) |
| --- | --- | --- | --- |

I think, after further analysis, this same bug extends much much further than just trusts. I will run this by ayoung and nathan kinder tomorrow morning to determine if we need a separate bug / i'm wrong / if this can all be combined into a single bug.

I think, after further analysis, this same bug extends much much further than just trusts. I will run this by ayoung and nathan kinder tomorrow morning to determine if we need a separate bug / i'm wrong / if this can all be combined into a single bug.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-30: |  |  | [#10](/keystone/%2Bbug/1324592/comments/10) |
| --- | --- | --- | --- |

I just discussed this with ayoung and confirmed it is possible to perform the same type of escalation with the oauth contrib module. It would also be possible to use Oauth based tokens to create trusts that can escalate permissions.

Oauth -> Oauth

Trust -> Oauth

Oauth -> Trust

The immediate solution should be to prevent any form of chained delegation to occur from trusts or oauth (extending the new code to cover oauth scenarios).

I just discussed this with ayoung and confirmed it is possible to perform the same type of escalation with the oauth contrib module. It would also be possible to use Oauth based tokens to create trusts that can escalate permissions.
Oauth -> Oauth
Trust -> Oauth
Oauth -> Trust
The immediate solution should be to prevent any form of chained delegation to occur from trusts or oauth (extending the new code to cover oauth scenarios).

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-05-30

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2014-05-30: |  |  | [#11](/keystone/%2Bbug/1324592/comments/11) |
| --- | --- | --- | --- |

So just to confirm, this affects only stable/icehouse and master? I assume the federated identity work for icehouse introduced the current flaw...

So just to confirm, this affects only stable/icehouse and master? I assume the federated identity work for icehouse introduced the current flaw...

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-30: |  |  | [#12](/keystone/%2Bbug/1324592/comments/12) |
| --- | --- | --- | --- |

Looking at the code, this appears to affect Master, Icehouse, and Havana.

Looking at the code, this appears to affect Master, Icehouse, and Havana.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-30: |  |  | [#13](/keystone/%2Bbug/1324592/comments/13) |
| --- | --- | --- | --- |

* [keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4123127/%2Bfiles/keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4123127)
  (9.5 KiB,
  text/plain)

Addresses the OAuth and Trust integration use cases.

Addresses the OAuth and Trust integration use cases.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-30: |  |  | [#14](/keystone/%2Bbug/1324592/comments/14) |
| --- | --- | --- | --- |

Typos in commit message ACKed. Waiting on feedback for actual patch before reposing.

Typos in commit message ACKed. Waiting on feedback for actual patch before reposing.

[Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm)
on 2014-05-31

| Changed in keystone: | |
| --- | --- |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#15](/keystone/%2Bbug/1324592/comments/15) |
| --- | --- | --- | --- |

Suggestions for the code:

It looks like the code mitigates the privilege escalation, it feels like the code should go a bit further (yes this could all be controlled via policy, but I get the feeling that most deployments would not limit in this way).

Suggestion #1:

- While it is useful to include all the OAuth information and Trust information in the credentials (common/authorization) it would be easier for both cases to set a 'is\_delegated\_auth' flag and we can universally check for that instead of having to check trust, and oauth, and oauth, and trust, and if anything else crops up.

Suggestion #2:

If you cannot create new trusts/OAuth request tokens (authorize in the case of Oauth), the user should not be able to delete them. Likely, the user shouldn't be able to list them either. Once we get to chaining of trusts / whatever else is out there that allows delegation of smaller scope that is current, we can allow those smaller-scope delegations to be managed by the user with delegated auth. At this point, it seems that it would be unexpected for a user to be able to delete a trust or OAuth related stuff because they authed as the via a delegated role.

This assessment comes from the sample policy allowing a lot of various things to occur as admin (all oauth related actions request token etc, require admin) - lets prevent people from screwing up other people's access if they were (for some reason) delegated admin on their project.

Suggestions for the code:
It looks like the code mitigates the privilege escalation, it feels like the code should go a bit further (yes this could all be controlled via policy, but I get the feeling that most deployments would not limit in this way).
Suggestion #1:
- While it is useful to include all the OAuth information and Trust information in the credentials (common/authorization) it would be easier for both cases to set a 'is\_delegated\_auth' flag and we can universally check for that instead of having to check trust, and oauth, and oauth, and trust, and if anything else crops up.
Suggestion #2:
If you cannot create new trusts/OAuth request tokens (authorize in the case of Oauth), the user should not be able to delete them. Likely, the user shouldn't be able to list them either. Once we get to chaining of trusts / whatever else is out there that allows delegation of smaller scope that is current, we can allow those smaller-scope delegations to be managed by the user with delegated auth. At this point, it seems that it would be unexpected for a user to be able to delete a trust or OAuth related stuff because they authed as the via a delegated role.
This assessment comes from the sample policy allowing a lot of various things to occur as admin (all oauth related actions request token etc, require admin) - lets prevent people from screwing up other people's access if they were (for some reason) delegated admin on their project.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#16](/keystone/%2Bbug/1324592/comments/16) |
| --- | --- | --- | --- |

This patch will require minor differences for stable/icehouse:

nullptr:keystone morgan$ git apply --reject patch

Checking patch keystone/common/authorization.py...

Hunk #1 succeeded at 87 (offset 19 lines).

Hunk #2 succeeded at 123 (offset 19 lines).

Checking patch keystone/contrib/oauth1/controllers.py...

Checking patch keystone/tests/test\_v3\_auth.py...

Hunk #1 succeeded at 2777 (offset -50 lines).

Checking patch keystone/tests/test\_v3\_oauth1.py...

Hunk #1 succeeded at 486 (offset 10 lines).

Checking patch keystone/trust/controllers.py...

error: while searching for:

        The user creating the trust must be the trustor.

"""

        if not trust:

            raise exception.ValidationError(attribute='trust',

                                            target='request')

error: patch failed: keystone/trust/controllers.py:124

Applied patch keystone/common/authorization.py cleanly.

Applied patch keystone/contrib/oauth1/controllers.py cleanly.

Applied patch keystone/tests/test\_v3\_auth.py cleanly.

Applied patch keystone/tests/test\_v3\_oauth1.py cleanly.

Applying patch keystone/trust/controllers.py with 1 reject...

Rejected hunk #1

This patch will require minor differences for stable/icehouse:
nullptr:keystone morgan$ git apply --reject patch
Checking patch keystone/common/authorization.py...
Hunk #1 succeeded at 87 (offset 19 lines).
Hunk #2 succeeded at 123 (offset 19 lines).
Checking patch keystone/contrib/oauth1/controllers.py...
Checking patch keystone/tests/test\_v3\_auth.py...
Hunk #1 succeeded at 2777 (offset -50 lines).
Checking patch keystone/tests/test\_v3\_oauth1.py...
Hunk #1 succeeded at 486 (offset 10 lines).
Checking patch keystone/trust/controllers.py...
error: while searching for:
The user creating the trust must be the trustor.
"""
if not trust:
raise exception.ValidationError(attribute='trust',
target='request')
error: patch failed: keystone/trust/controllers.py:124
Applied patch keystone/common/authorization.py cleanly.
Applied patch keystone/contrib/oauth1/controllers.py cleanly.
Applied patch keystone/tests/test\_v3\_auth.py cleanly.
Applied patch keystone/tests/test\_v3\_oauth1.py cleanly.
Applying patch keystone/trust/controllers.py with 1 reject...
Rejected hunk #1

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#17](/keystone/%2Bbug/1324592/comments/17) |
| --- | --- | --- | --- |

Where would is\_delegated\_auth flag live? In the token itself? It means a more invasive patch, and larger tokens. If outside of the token, it means we need a common library location for it, and none really suits the scoped of this patch.

Deleting a trust from a trust is a logically acceptable activity: it would give you a way to clean up.

Listing trusts from a trust is acceptable. Listing trusts provideds no additional access. It is an activity that may make sense withing some workflows.

Even creating a trust from a trust is logically acceptable, but it requires a lot more checks than can be done in the scope of this patch.

I'll work up an icehouse and havana version of the patch.

Where would is\_delegated\_auth flag live? In the token itself? It means a more invasive patch, and larger tokens. If outside of the token, it means we need a common library location for it, and none really suits the scoped of this patch.
Deleting a trust from a trust is a logically acceptable activity: it would give you a way to clean up.
Listing trusts from a trust is acceptable. Listing trusts provideds no additional access. It is an activity that may make sense withing some workflows.
Even creating a trust from a trust is logically acceptable, but it requires a lot more checks than can be done in the scope of this patch.
I'll work up an icehouse and havana version of the patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#18](/keystone/%2Bbug/1324592/comments/18) |
| --- | --- | --- | --- |

the "delegated" flag would be in creds in authorization.py, just a single check instead of checking oauth and trusts in any/all locations.

the "delegated" flag would be in creds in authorization.py, just a single check instead of checking oauth and trusts in any/all locations.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#19](/keystone/%2Bbug/1324592/comments/19) |
| --- | --- | --- | --- |

I also agree that logically you should be able to create trusts (etc). but based upon the limited policy / issues around it (notably not backporting a whole featureset to icehouse/havana) we should restrict these things down as much as possible.

I also agree that logically you should be able to create trusts (etc). but based upon the limited policy / issues around it (notably not backporting a whole featureset to icehouse/havana) we should restrict these things down as much as possible.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2014-06-02: |  |  | [#20](/keystone/%2Bbug/1324592/comments/20) |
| --- | --- | --- | --- |

I reviewed the patch in comment 13 and it looks good to me.

I reviewed the patch in comment 13 and it looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#21](/keystone/%2Bbug/1324592/comments/21) |
| --- | --- | --- | --- |

* [Updated patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124299/%2Bfiles/keystone-ayoung-0013-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124299)
  (11.8 KiB,
  text/plain)

Now also blocks list\_request\_tokens as that could potentially be abused as well.

Now also blocks list\_request\_tokens as that could potentially be abused as well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#22](/keystone/%2Bbug/1324592/comments/22) |
| --- | --- | --- | --- |

The Patch in 21 looks good to me.

The Patch in 21 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2014-06-02: |  |  | [#23](/keystone/%2Bbug/1324592/comments/23) |
| --- | --- | --- | --- |

A couple of comments on the patch in comment 21 --

1) in test\_v3\_oauth1.py at line 556, a file is created. The file should be deleted with self.addCleanup(os.remove, self.tmpfilename)

2) same file, at line 559 is extra-indented (8 chars rather than 4 as expected)

Other than that looks good to me.

A couple of comments on the patch in comment 21 --
1) in test\_v3\_oauth1.py at line 556, a file is created. The file should be deleted with self.addCleanup(os.remove, self.tmpfilename)
2) same file, at line 559 is extra-indented (8 chars rather than 4 as expected)
Other than that looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#24](/keystone/%2Bbug/1324592/comments/24) |
| --- | --- | --- | --- |

* [keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124372/%2Bfiles/keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124372)
  (11.9 KiB,
  text/plain)

Backport to Icehouse.

Backport to Icehouse.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#25](/keystone/%2Bbug/1324592/comments/25) |
| --- | --- | --- | --- |

Last patch has same issues as previously reviewed by blk-u

Last patch has same issues as previously reviewed by blk-u

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#26](/keystone/%2Bbug/1324592/comments/26) |
| --- | --- | --- | --- |

* [keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124386/%2Bfiles/keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124386)
  (11.9 KiB,
  text/plain)

Addresses comments from blk-u

Addresses comments from blk-u

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#27](/keystone/%2Bbug/1324592/comments/27) |
| --- | --- | --- | --- |

* [Backport for Icehouse](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124397/%2Bfiles/keystone-ayoung-icehouse-2-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124397)
  (12.0 KiB,
  text/plain)

Backport for Icehouse

Backport for Icehouse

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-02: |  |  | [#28](/keystone/%2Bbug/1324592/comments/28) |
| --- | --- | --- | --- |

Hello, thank you for such fast fixes :)

I'm not entirely sure what is the attack scenario for the OAuth case, so I leave it out of this first draft.

Can someone confirm there is a vulnerability specifics to the OAuth process? Or is it already covered by the following description ?

Here is the impact description draft #1:

Title: Keystone trust chained delegation privilege escalation

Reporter: Steven Hardy (RedHat)

Products: Keystone

Versions: up to 2013.2.3, and 2014.1

Description:

Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By chaining delegation from a trust token, a trustee may circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's roles. All keystone setups are affected.

Hello, thank you for such fast fixes :)
I'm not entirely sure what is the attack scenario for the OAuth case, so I leave it out of this first draft.
Can someone confirm there is a vulnerability specifics to the OAuth process? Or is it already covered by the following description ?
Here is the impact description draft #1:
Title: Keystone trust chained delegation privilege escalation
Reporter: Steven Hardy (RedHat)
Products: Keystone
Versions: up to 2013.2.3, and 2014.1
Description:
Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By chaining delegation from a trust token, a trustee may circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's roles. All keystone setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-03: |  |  | [#29](/keystone/%2Bbug/1324592/comments/29) |
| --- | --- | --- | --- |

@Tristan,

The OAuth attack scenario is similar to trust one:

\* Trustee creates an OAuth authentication delegation (with elevated privs)

\* ReAuth with new OAuth based delegation.

Alternatively, someone authenticated with an OAuth delegation could:

\* Create Trust with elevated privileges

\* ReAuthenticate with new Trust.

The fixes Adam Young has provided eliminate both of these alternate attack vectors.

@Tristan,
The OAuth attack scenario is similar to trust one:
\* Trustee creates an OAuth authentication delegation (with elevated privs)
\* ReAuth with new OAuth based delegation.
Alternatively, someone authenticated with an OAuth delegation could:
\* Create Trust with elevated privileges
\* ReAuthenticate with new Trust.
The fixes Adam Young has provided eliminate both of these alternate attack vectors.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Garth Mollett (gmollett)](https://launchpad.net/~gmollett) wrote on 2014-06-03: |  |  | [#30](/keystone/%2Bbug/1324592/comments/30) |
| --- | --- | --- | --- |

@Tristan

As this came from RedHat I can assign a CVE to this now if it saves you time?

Or I can hold off and wait for the official request if you would prefer.

@Tristan
As this came from RedHat I can assign a CVE to this now if it saves you time?
Or I can hold off and wait for the official request if you would prefer.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-03: |  |  | [#31](/keystone/%2Bbug/1324592/comments/31) |
| --- | --- | --- | --- |

* [Backport to Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124479/%2Bfiles/keystone-ayoung-Havana-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124479)
  (14.9 KiB,
  text/plain)

Backport to Havana.

Backport to Havana.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-03: |  |  | [#32](/keystone/%2Bbug/1324592/comments/32) |
| --- | --- | --- | --- |

@Morgan,

Thank, that is very helpful, I'll update the impact description.

Just to be sure, the privilege elevation can only happen with out-of-scope roles from the former authentication.

I mean, it's not to any role right ?

@Garth

I would prefer having the impact description validated before requesting a CVE. Then yes, feel free to assign the CVE thanks!

@Morgan,
Thank, that is very helpful, I'll update the impact description.
Just to be sure, the privilege elevation can only happen with out-of-scope roles from the former authentication.
I mean, it's not to any role right ?
@Garth
I would prefer having the impact description validated before requesting a CVE. Then yes, feel free to assign the CVE thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#33](/keystone/%2Bbug/1324592/comments/33) |
| --- | --- | --- | --- |

@Tristan:

1. User A trusts User B to impersonate them within the scope of Project X (using User A's roles AND identity).

2a. User B abuses the identity impersonation against keystone to delegate User A's authorization (either to User B, or to a third party) in Project Y, a secondary scope in which User A never intended to delegate authorization.

2b. Alternatively, User B abuses the identity impersonation against keystone to delegate \*additional\* authorization (either to User B, or to a third party) held by User A in Project X, including roles which User A never intended to delegate.

Also note that you should be able to avoid exposure by completely disabling support for trusts, by setting the following in keystone.conf:

[trust]

  enabled = false

Trust support is enabled by default since Grizzly.

@Tristan:
1. User A trusts User B to impersonate them within the scope of Project X (using User A's roles AND identity).
2a. User B abuses the identity impersonation against keystone to delegate User A's authorization (either to User B, or to a third party) in Project Y, a secondary scope in which User A never intended to delegate authorization.
2b. Alternatively, User B abuses the identity impersonation against keystone to delegate \*additional\* authorization (either to User B, or to a third party) held by User A in Project X, including roles which User A never intended to delegate.
Also note that you should be able to avoid exposure by completely disabling support for trusts, by setting the following in keystone.conf:
[trust]
enabled = false
Trust support is enabled by default since Grizzly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#34](/keystone/%2Bbug/1324592/comments/34) |
| --- | --- | --- | --- |

I suppose it's also worth mentioning that 2a and 2b are not mutually exclusive possibilities, and can each be repeated.

I suppose it's also worth mentioning that 2a and 2b are not mutually exclusive possibilities, and can each be repeated.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-03: |  |  | [#35](/keystone/%2Bbug/1324592/comments/35) |
| --- | --- | --- | --- |

@Dolph thanks for the clarification!

I put 2014.1.1 as an affected version because with the pre-OSSA process, this won't get in time for this release.

Here is the impact description draft #2:

Title: Keystone privilege escalation through trust chained delegation

Reporter: Steven Hardy (RedHat)

Products: Keystone

Versions: up to 2013.2.3, and 2014.1.1

Description:

Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. Note that trust support is enabled by default since Grizzly and can only be manually disabled through keystone configuration. All keystone setups are affected.

@Dolph thanks for the clarification!
I put 2014.1.1 as an affected version because with the pre-OSSA process, this won't get in time for this release.
Here is the impact description draft #2:
Title: Keystone privilege escalation through trust chained delegation
Reporter: Steven Hardy (RedHat)
Products: Keystone
Versions: up to 2013.2.3, and 2014.1.1
Description:
Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. Note that trust support is enabled by default since Grizzly and can only be manually disabled through keystone configuration. All keystone setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2014-06-03: |  |  | [#36](/keystone/%2Bbug/1324592/comments/36) |
| --- | --- | --- | --- |

Versions: up to 2013.2.3, and 2014.1 to 2014.1.1

(because 2014.1 is also affected)

Otherwise Tristan's impact description proposed in comment #35 looks great.

Versions: up to 2013.2.3, and 2014.1 to 2014.1.1
(because 2014.1 is also affected)
Otherwise Tristan's impact description proposed in comment #35 looks great.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-03: |  |  | [#37](/keystone/%2Bbug/1324592/comments/37) |
| --- | --- | --- | --- |

Impact description draft #2 looks accurate.

Impact description draft #2 looks accurate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#38](/keystone/%2Bbug/1324592/comments/38) |
| --- | --- | --- | --- |

Tristan: I feel like "All keystone setups are affected" conflicts with the previous sentence... maybe combine the two statements? Something like:

All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Tristan: I feel like "All keystone setups are affected" conflicts with the previous sentence... maybe combine the two statements? Something like:
All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2014-06-03: |  |  | [#39](/keystone/%2Bbug/1324592/comments/39) |
| --- | --- | --- | --- |

Reviewed the patch in comment 26, looks good to me.

Reviewed the icehouse backport in comment 27, looks good to me.

Reviewed the havana backport in comment 31

 - there's an unrelated change in keystone/exception.py that should be reverted.

   This change causes a unit test failure on my system.

 - there's commented-out code in test\_v3\_oauth1.py at line 529 that should be removed

Reviewed the patch in comment 26, looks good to me.
Reviewed the icehouse backport in comment 27, looks good to me.
Reviewed the havana backport in comment 31
- there's an unrelated change in keystone/exception.py that should be reverted.
This change causes a unit test failure on my system.
- there's commented-out code in test\_v3\_oauth1.py at line 529 that should be removed

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-03: |  |  | [#40](/keystone/%2Bbug/1324592/comments/40) |
| --- | --- | --- | --- |

Thanks folks, I've updated the description with your comments,

Here is the impact description draft #3:

Title: Keystone privilege escalation through trust chained delegation

Reporter: Steven Hardy (Red Hat)

Products: Keystone

Versions: up to 2013.2.3, and 2014.1 to 2014.1.1

Description:

Steven Hardy from Red Hat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Thanks folks, I've updated the description with your comments,
Here is the impact description draft #3:
Title: Keystone privilege escalation through trust chained delegation
Reporter: Steven Hardy (Red Hat)
Products: Keystone
Versions: up to 2013.2.3, and 2014.1 to 2014.1.1
Description:
Steven Hardy from Red Hat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#41](/keystone/%2Bbug/1324592/comments/41) |
| --- | --- | --- | --- |

+1 for impact description

+1 for impact description

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-06-03

| Changed in ossa: | |
| --- | --- |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Garth Mollett (gmollett)](https://launchpad.net/~gmollett) wrote on 2014-06-04: |  |  | [#42](/keystone/%2Bbug/1324592/comments/42) |
| --- | --- | --- | --- |

Ok. hope I'm not jumping in too early here: Please use CVE-2014-3476 for this issue.

Ok. hope I'm not jumping in too early here: Please use CVE-2014-3476 for this issue.

[Grant Murphy (gmurphy)](https://launchpad.net/~gmurphy)
on 2014-06-04

| **summary**: | - Trust scope can be circumvented by chaining trusts+ Trust scope can be circumvented by chaining trusts (CVE-2014-3476) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-04:  [**Re: Trust scope can be circumvented by chaining trusts (CVE-2014-3476)**](/keystone/%2Bbug/1324592/comments/43) |  |  | [#43](/keystone/%2Bbug/1324592/comments/43) |
| --- | --- | --- | --- |

* [Patch for Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4125102/%2Bfiles/keystone-ayoung-Hava-3-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4125102)
  (14.3 KiB,
  text/plain)

Updated Patch for Havana.

Removes the change to exception and the commented out code are referred to by blk-u

Updated Patch for Havana.
Removes the change to exception and the commented out code are referred to by blk-u

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-04: |  |  | [#44](/keystone/%2Bbug/1324592/comments/44) |
| --- | --- | --- | --- |

Updated Havana patch triggers a unit test failure.

Updated Havana patch triggers a unit test failure.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-04: |  |  | [#45](/keystone/%2Bbug/1324592/comments/45) |
| --- | --- | --- | --- |

Unit test failures were result of artifacts from previous runs in the git repository. Unit tests run clean.

Unit test failures were result of artifacts from previous runs in the git repository. Unit tests run clean.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-04: |  |  | [#46](/keystone/%2Bbug/1324592/comments/46) |
| --- | --- | --- | --- |

Can keystone-coresec please have a look at proposed patch before we proceed to stakeholders pre-OSSA:

stable/havana is in comment #43

stable/icehouse in comment #27

master is in comment #26

Thanks in advance

Can keystone-coresec please have a look at proposed patch before we proceed to stakeholders pre-OSSA:
stable/havana is in comment #43
stable/icehouse in comment #27
master is in comment #26
Thanks in advance

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-05: |  |  | [#47](/keystone/%2Bbug/1324592/comments/47) |
| --- | --- | --- | --- |

Patches in #43, #27, and #26 apply cleanly to the respective branches.

Tests appear to pass for all patches.

The changeset in #26 looks good to me against master

The changeset in #27 looks good to me against icehouse

The changeset in #43 looks good to me against havana

+1 on the patches and impact statement, I would like to see a second core review the patches before they are merged though.

Patches in #43, #27, and #26 apply cleanly to the respective branches.
Tests appear to pass for all patches.
The changeset in #26 looks good to me against master
The changeset in #27 looks good to me against icehouse
The changeset in #43 looks good to me against havana
+1 on the patches and impact statement, I would like to see a second core review the patches before they are merged though.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-05: |  |  | [#48](/keystone/%2Bbug/1324592/comments/48) |
| --- | --- | --- | --- |

The fix is actually over-restrictive. It's not delegated auth in general that should cause these operations to be denied, but specifically just impersonation. Regardless, the fix is certainly effective at closing the vulnerability.

+1 for master patch in #26

+1 for stable/icehouse patch in #27

+1 for stable/havana patch in #43

I have a few small nits on the request context stuff, but I'll save those for a subsequent patch to master :)

The fix is actually over-restrictive. It's not delegated auth in general that should cause these operations to be denied, but specifically just impersonation. Regardless, the fix is certainly effective at closing the vulnerability.
+1 for master patch in #26
+1 for stable/icehouse patch in #27
+1 for stable/havana patch in #43
I have a few small nits on the request context stuff, but I'll save those for a subsequent patch to master :)

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-06-09

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steven Hardy (shardy)](https://launchpad.net/~shardy) wrote on 2014-06-09: |  |  | [#49](/keystone/%2Bbug/1324592/comments/49) |
| --- | --- | --- | --- |

+1 for master patch in #26 - I've pulled that and tested it, and can confirm it resolves the reported issue.

I've not tested the stable backports.

+1 for master patch in #26 - I've pulled that and tested it, and can confirm it resolves the reported issue.
I've not tested the stable backports.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-09: |  |  | [#50](/keystone/%2Bbug/1324592/comments/50) |
| --- | --- | --- | --- |

The pre-OSSA has been sent, the proposed disclosure date/time is:

2014-06-12, 1500UTC

The pre-OSSA has been sent, the proposed disclosure date/time is:
2014-06-12, 1500UTC

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-06-12

| **information type**: | Private Security → Public Security |
| --- | --- |
| **summary**: | - Trust scope can be circumvented by chaining trusts (CVE-2014-3476)+ [OSSA 2014-018] Trust scope can be circumvented by chaining trusts+ (CVE-2014-3476) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-12:  [**Fix proposed to keystone (master)**](/keystone/%2Bbug/1324592/comments/51) |  |  | [#51](/keystone/%2Bbug/1324592/comments/51) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/99687>

Fix proposed to branch: master
Review: https://review.openstack.org/99687

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-12:  [**Fix proposed to keystone (stable/icehouse)**](/keystone/%2Bbug/1324592/comments/52) |  |  | [#52](/keystone/%2Bbug/1324592/comments/52) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/icehouse

Review: <https://review.openstack.org/99700>

Fix proposed to branch: stable/icehouse
Review: https://review.openstack.org/99700

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-12:  [**Fix proposed to keystone (stable/havana)**](/keystone/%2Bbug/1324592/comments/53) |  |  | [#53](/keystone/%2Bbug/1324592/comments/53) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/havana

Review: <https://review.openstack.org/99703>

Fix proposed to branch: stable/havana
Review: https://review.openstack.org/99703

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-13:  [**Fix merged to keystone (master)**](/keystone/%2Bbug/1324592/comments/54) |  |  | [#54](/keystone/%2Bbug/1324592/comments/54) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/99687>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=ebfc2da158d15fe2f36787bcbf7407a0fa8f551d>

Submitter: Jenkins

Branch: master

commit ebfc2da158d15fe2f36787bcbf7407a0fa8f551d

Author: Adam Young <email address hidden>

Date: Thu May 29 13:56:17 2014 -0400

Block delegation escalation of privilege

Forbids doing the following with either a trust

      or oauth based token:

      creating a trust

      approving a request\_token

      listing request tokens

Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2

    Closes-Bug: 1324592

Reviewed: https://review.openstack.org/99687
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=ebfc2da158d15fe2f36787bcbf7407a0fa8f551d
Submitter: Jenkins
Branch: master
commit ebfc2da158d15fe2f36787bcbf7407a0fa8f551d
Author: Adam Young <ayoung@redhat.com>
Date: Thu May 29 13:56:17 2014 -0400
Block delegation escalation of privilege
Forbids doing the following with either a trust
or oauth based token:
creating a trust
approving a request\_token
listing request tokens
Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2
Closes-Bug: 1324592

| Changed in keystone: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-13:  [**Fix merged to keystone (stable/icehouse)**](/keystone/%2Bbug/1324592/comments/55) |  |  | [#55](/keystone/%2Bbug/1324592/comments/55) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/99700>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=73785122eefe523bb57c819e085c7f6ec97d779c>

Submitter: Jenkins

Branch: stable/icehouse

commit 73785122eefe523bb57c819e085c7f6ec97d779c

Author: Adam Young <email address hidden>

Date: Thu May 29 13:56:17 2014 -0400

Block delegation escalation of privilege

Forbids doing the following with either a trust

      or oauth based token:

      creating a trust

      approving a request\_token

      listing request tokens

Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2

    Closes-Bug: 1324592

Reviewed: https://review.openstack.org/99700
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=73785122eefe523bb57c819e085c7f6ec97d779c
Submitter: Jenkins
Branch: stable/icehouse
commit 73785122eefe523bb57c819e085c7f6ec97d779c
Author: Adam Young <ayoung@redhat.com>
Date: Thu May 29 13:56:17 2014 -0400
Block delegation escalation of privilege
Forbids doing the following with either a trust
or oauth based token:
creating a trust
approving a request\_token
listing request tokens
Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2
Closes-Bug: 1324592

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-13:  [**Fix merged to keystone (stable/havana)**](/keystone/%2Bbug/1324592/comments/56) |  |  | [#56](/keystone/%2Bbug/1324592/comments/56) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/99703>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=9162837329665b4316afc2270a602dc8ae11f6d2>

Submitter: Jenkins

Branch: stable/havana

commit 9162837329665b4316afc2270a602dc8ae11f6d2

Author: Adam Young <email address hidden>

Date: Thu May 29 13:56:17 2014 -0400

Block delegation escalation of privilege

Forbids doing the following with either a trust

      or oauth based token:

      creating a trust

      approving a request\_token

      listing request tokens

Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2

    Closes-Bug: 1324592

Reviewed: https://review.openstack.org/99703
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=9162837329665b4316afc2270a602dc8ae11f6d2
Submitter: Jenkins
Branch: stable/havana
commit 9162837329665b4316afc2270a602dc8ae11f6d2
Author: Adam Young <ayoung@redhat.com>
Date: Thu May 29 13:56:17 2014 -0400
Block delegation escalation of privilege
Forbids doing the following with either a trust
or oauth based token:
creating a trust
approving a request\_token
listing request tokens
Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2
Closes-Bug: 1324592

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-06-16

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Russell Bryant (russellb)](https://launchpad.net/~russellb)
on 2014-07-24

| Changed in keystone: | |
| --- | --- |
| **milestone**: | none → juno-2 |
| **status**: | Fix Committed → Fix Released |

[Chuck Short (zulcss)](https://launchpad.net/~zulcss)
on 2014-08-07

| **tags**: | added: in-stable-icehouse |
| --- | --- |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-10-16

| Changed in keystone: | |
| --- | --- |
| **milestone**: | juno-2 → 2014.2 |

[See full activity log](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/keystone/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/keystone/%2Bbug/1324592/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122339/%2Bfiles/keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122339 "Change patch details")
* [keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122351/%2Bfiles/keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122351 "Change patch details")
* [keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4123127/%2Bfiles/keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4123127 "Change patch details")
* [Updated patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124299/%2Bfiles/keystone-ayoung-0013-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124299 "Change patch details")
* [keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124372/%2Bfiles/keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124372 "Change patch details")
* [keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124386/%2Bfiles/keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124386 "Change patch details")
* [Backport for Icehouse](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124397/%2Bfiles/keystone-ayoung-icehouse-2-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124397 "Change patch details")
* [Backport to Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124479/%2Bfiles/keystone-ayoung-Havana-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124479 "Change patch details")
* [Patch for Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4125102/%2Bfiles/keystone-ayoung-Hava-3-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4125102 "Change patch details")

* [Add patch](/keystone/%2Bbug/1324592/%2Baddcomment?field.patch=on)

## Bug attachments

* [Reproducer script](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122312/%2Bfiles/chained_example3.py)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122312 "Change attachment details")

* [Add attachment](/keystone/%2Bbug/1324592/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from bugzilla.novell.com_c815b632_20250126_123017.html ===




=== Content from launchpad.net_1abd7d74_20250126_123026.html ===

[Log in / Register](https://launchpad.net/~ayoung/%2Blogin)

[![](https://launchpadlibrarian.net/173595953/climbing_icon.png)](https://launchpad.net/~ayoung)

## [Adam Young](https://launchpad.net/~ayoung)

* Overview
* [Code](https://code.launchpad.net/~ayoung)
* [Bugs](https://bugs.launchpad.net/~ayoung)
* [Blueprints](https://blueprints.launchpad.net/~ayoung)
* [Translations](https://translations.launchpad.net/~ayoung)
* [Answers](https://answers.launchpad.net/~ayoung)

* [Related packages](https://launchpad.net/~ayoung/%2Brelated-packages)
* [Related projects](https://launchpad.net/~ayoung/%2Brelated-projects)

## User information

Launchpad Id:
ayoung

Email:
[Log in](%2Blogin) for email information.

Member since:
2011-12-16

[![Icon of OpenStack Security SIG](https://launchpadlibrarian.net/203991792/os14.png "Member of OpenStack Security SIG")](/~openstack-ossg)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)

Languages:

English

SSH keys:

[ayoung@ayoung.boston.devel.redhat.com](%2Bsshkeys)

Time zone:

UTC
(UTC+0000)

Karma:
[1](https://launchpad.net/~ayoung/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**admiyo**
 on
**OFTC**

![IRC](/@@/social-irc "IRC")
**ayoung**
 on
**irc.freenode.com**

## [All bugs in progress](https://launchpad.net/~ayoung/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1832848 [Set Project ID for synchronization across servers](https://bugs.launchpad.net/keystone/%2Bbug/1832848) |  |
| --- | --- | --- |
| in [OpenStack Identity (keystone)](/keystone) | | |

| --- | --- | --- | --- | --- | --- |

## Personal package archives

| [certmaster](/~ayoung/%2Barchive/ubuntu/ppa) |
| --- |

## [All memberships](https://launchpad.net/~ayoung/%2Bparticipation) Latest memberships

| [tripleo](/~tripleo)  Joined on 2016-10-11 | |
| --- | --- |
| [Oslo Policy Core](/~oslo-policy-core)  Joined on 2015-01-12 | |
| [Horizon Developers](/~horizon)  Joined on 2014-07-29 | |
| [Keystone Devs](/~keystone)  Joined on 2012-11-20 | |

## [Recent activities](https://launchpad.net/~ayoung/%2Bkarma) Most active in

| [OpenStack Identity (keystone)](/keystone) |  |
| --- | --- |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_caadd724_20250126_123025.html ===

[Log in / Register](https://launchpad.net/~gmurphy/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~gmurphy)

## [Grant Murphy](https://launchpad.net/~gmurphy)

* Overview
* [Code](https://code.launchpad.net/~gmurphy)
* [Bugs](https://bugs.launchpad.net/~gmurphy)
* [Blueprints](https://blueprints.launchpad.net/~gmurphy)
* [Translations](https://translations.launchpad.net/~gmurphy)
* [Answers](https://answers.launchpad.net/~gmurphy)

* [Related packages](https://launchpad.net/~gmurphy/%2Brelated-packages)
* [Related projects](https://launchpad.net/~gmurphy/%2Brelated-projects)

## User information

Launchpad Id:
gmurphy

Email:
[Log in](%2Blogin) for email information.

Member since:
2006-05-01

Signed Ubuntu Code of Conduct:
Yes

Languages:

English

OpenPGP keys:

D43EFD39C7104E9D3550DD3E9DE43B9E551A2252

SSH keys:

[grantcmurphy@gmail.com](%2Bsshkeys)

[gm@mbp](%2Bsshkeys)

Time zone:

Australia/Brisbane
(UTC+1000)

Karma:
[0](https://launchpad.net/~gmurphy/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**gmurphy**
 on
**irc.freenode.net**

![Jabber](/@@/social-jabber "Jabber")
<email address hidden>

## Latest memberships

Grant Murphy is not an
active member of any Launchpad teams.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from lists.opensuse.org_a9cf327c_20250125_223747.html ===


[![openSUSE](https://static.opensuse.org/favicon.svg)
Mailing Lists](/archives/ "openSUSE Mailing Lists")

[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A/)

[Manage this list](/manage/lists/security-announce.lists.opensuse.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40lists.opensuse.org/message/FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[thread](/archives/list/security-announce%40lists.opensuse.org/thread/FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A/#FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A)

# [security-announce] SUSE-SU-2014:0848-1: important: Security update for openstack-keystone

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

25 Jun
2014

25 Jun
'14

23:04

SUSE Security Update: Security update for openstack-keystone
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: SUSE-SU-2014:0848-1
Rating: important
References: #881977
Cross-References: CVE-2014-3476
Affected Products:
SUSE Cloud 3
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes one vulnerability is now available. It
includes one version update.
Description:
openstack-keystone was updated to version 2013.2.4.dev5.g9162837 to fix
one security issue and one regular bug:
\* Privilege escalation through trust chained delegation.
(CVE-2014-3476)
\* Fix invalid LDAP filter for user ID with commas.
Security Issue reference:
\* CVE-2014-3476
<[http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3476>](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3476%3E)
Patch Instructions:
To install this SUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- SUSE Cloud 3:
zypper in -t patch sleclo30sp3-openstack-keystone-9378
To bring your system up-to-date, use "zypper patch".
Package List:
- SUSE Cloud 3 (x86\_64) [New Version: 2013.2.4.dev5.g9162837]:
openstack-keystone-2013.2.4.dev5.g9162837-0.7.1
python-keystone-2013.2.4.dev5.g9162837-0.7.1
- SUSE Cloud 3 (noarch) [New Version: 2013.2.4.dev5.g9162837]:
openstack-keystone-doc-2013.2.4.dev5.g9162837-0.7.1
References:
<http://support.novell.com/security/cve/CVE-2014-3476.html>
<https://bugzilla.novell.com/881977>
[http://download.suse.com/patch/finder/?keywords=7e3827dc35a978ab61c226134478...](http://download.suse.com/patch/finder/?keywords=7e3827dc35a978ab61c2261344784e9b)
--
To unsubscribe, e-mail: opensuse-security-announce+unsubscribe@opensuse.org
For additional commands, e-mail: opensuse-security-announce+help@opensuse.org

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40lists.opensuse.org/message/FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A/)
Use email software

[Back to the thread](/archives/list/security-announce%40lists.opensuse.org/thread/FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A/#FCJSVVR6R47EQIDWOGBKR4EFGYMQRJ4A)

[Back to the list](/archives/list/security-announce%40lists.opensuse.org/)

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from www.openwall.com_f4488e5b_20250125_223748.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](../../../2014/06/13/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <5399FA3D.1050507@enovance.com>
Date: Thu, 12 Jun 2014 15:06:37 -0400
From: Tristan Cacqueray <tristan.cacqueray@...vance.com>
To: oss-security@...ts.openwall.com
Subject: [OSSA 2014-018] Keystone privilege escalation through trust chained
 delegation (CVE-2014-3476)

OpenStack Security Advisory: 2014-018
CVE: CVE-2014-3476
Date: June 12, 2014
Title: Keystone privilege escalation through trust chained delegation
Reporter: Steven Hardy (Red Hat)
Products: Keystone
Versions: up to 2013.2.3, and 2014.1 to 2014.1.1

Description:
Steven Hardy from Red Hat reported a vulnerability in Keystone chained
delegation. By creating a delegation from a trust or OAuth token, a
trustee may abuse the identity impersonation against keystone and
circumvent the enforced scope, resulting in potential elevated
privileges to any of the trustor's projects and or roles. All Keystone
deployments configured to enable trusts are affected, which has been the
default since Grizzly.

Juno (development branch) fix:
<https://review.openstack.org/99687>

Icehouse fix:
<https://review.openstack.org/99700>

Havana fix:
<https://review.openstack.org/99703>

Notes:
This fix will be included in the Juno-2 development milestone and in
future 2013.2.4 and 2014.1.2 releases.

References:
<http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-3476>
<https://launchpad.net/bugs/1324592>

--
Tristan Cacqueray
OpenStack Vulnerability Management Team

Download attachment "[signature.asc](3/1)" of type "application/pgp-signature" (539 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from bugs.launchpad.net_030b3224_20250125_223752.html ===

[Log in / Register](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* [Translations](https://translations.launchpad.net/keystone)
* [Answers](https://answers.launchpad.net/keystone)

# [OSSA 2014-018] Trust scope can be circumvented by chaining trusts (CVE-2014-3476)

Bug #1324592 reported by
[Steven Hardy](https://launchpad.net/~shardy)
on 2014-05-29

[268](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [OpenStack Identity (keystone)](https://bugs.launchpad.net/keystone) | Fix Released | Critical | [Adam Young](https://launchpad.net/~ayoung) | [OpenStack Identity (keystone) 2014.2 "juno"](https://launchpad.net/keystone/%2Bmilestone/2014.2) |
|  | [Havana](https://bugs.launchpad.net/keystone/havana) | Fix Released | Critical | [Adam Young](https://launchpad.net/~ayoung) | [OpenStack Identity (keystone) 2013.2.4](https://launchpad.net/keystone/%2Bmilestone/2013.2.4) |
|  | [Icehouse](https://bugs.launchpad.net/keystone/icehouse) | Fix Released | Critical | [Adam Young](https://launchpad.net/~ayoung) | [OpenStack Identity (keystone) 2014.1.2](https://launchpad.net/keystone/%2Bmilestone/2014.1.2) |
|  | [OpenStack Security Advisory](https://bugs.launchpad.net/ossa) | Fix Released | High | [Tristan Cacqueray](https://launchpad.net/~tristan-cacqueray) |  |

### Bug Description

I've been experimenting with chaining keystone trusts, and I've encountered what I think is a privilege escalation flaw, where the scope enforced by the trust when initially delegating can be circumvented by creating another trust.

I spoke about this briefly with ayoung on IRC and he seems to be in agreement that this is a bug.

Details:

1. User1 has roles admin and heat\_stack\_owner

2. User1 delegates to User2 via a trust, only delegating only heat\_stack\_owner, and enabling impersonation

3. User2 gets a trust-scoped token, impersonating User1

4. User2 creates a new trust, delegating both admin and heat\_stack\_owner to User3

5. This works, and so when User3 gets a trust scoped token, they can get elevated privileleges, effectively defeating the point of role-limited delegation via the trust.

I've attached a reproducer which demonstrates the problem.

Tags:

[in-stable-icehouse](/keystone/%2Bbugs?field.tag=in-stable-icehouse)

## CVE References

* [2014-3476](/bugs/cve/2014-3476 "OpenStack Identity (Keystone) before ...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steven Hardy (shardy)](https://launchpad.net/~shardy) wrote on 2014-05-29: |  |  | [#1](/keystone/%2Bbug/1324592/comments/1) |
| --- | --- | --- | --- |

* [Reproducer script](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122312/%2Bfiles/chained_example3.py)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122312)
  (4.2 KiB,
  text/x-python)

| **summary**: | - Trust scope can be circumvented by chaining trustts+ Trust scope can be circumvented by chaining trusts |
| --- | --- |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-05-29

| Changed in ossa: | |
| --- | --- |
| **status**: | New → Incomplete |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-05-29:  [**Re: Trust scope can be circumvented by chaining trusts**](/keystone/%2Bbug/1324592/comments/2) |  |  | [#2](/keystone/%2Bbug/1324592/comments/2) |
| --- | --- | --- | --- |

The OSSA task is incomplete pending additional details from security reviewers, keystone-coresec are now subscribed to the bug.

It does sounds like a practical privilege escalation, shouldn't we raise the priority ?

The OSSA task is incomplete pending additional details from security reviewers, keystone-coresec are now subscribed to the bug.
It does sounds like a practical privilege escalation, shouldn't we raise the priority ?

[Dolph Mathews (dolph)](https://launchpad.net/~dolph)
on 2014-05-29

| Changed in keystone: | |
| --- | --- |
| **importance**: | Undecided → Critical |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#3](/keystone/%2Bbug/1324592/comments/3) |
| --- | --- | --- | --- |

We originally had a check that a trust token could not be used to make a trust.

Is there any existing need for impersonation?

We originally had a check that a trust token could not be used to make a trust.
Is there any existing need for impersonation?

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steven Hardy (shardy)](https://launchpad.net/~shardy) wrote on 2014-05-29: |  |  | [#4](/keystone/%2Bbug/1324592/comments/4) |
| --- | --- | --- | --- |

> Is there any existing need for impersonation?

Yes, AFAIK all of the current use-cases for trusts (heat/solum/ceilometer) require impersonation.

If we need to add a temporary check which denies creating a trust with a trust-scoped token, that sounds fine to me, but then I'd like to get a spec worked out asap for explicit chaining, which is what I tried to specify in the trusts-chained-delegation BP (which was marked implemented for Icehouse), but clearly didn't explain very well because limited-use-trusts got implemented instead :)

I'm happy to work with ayoung to define a spec which enables a limited chain of delegation, and do the work to implement it, as it is needed for Solum/Heat interoperability ref [bug #1317293](/bugs/1317293) (and potentially heat/ceilometer too)

> Is there any existing need for impersonation?
Yes, AFAIK all of the current use-cases for trusts (heat/solum/ceilometer) require impersonation.
If we need to add a temporary check which denies creating a trust with a trust-scoped token, that sounds fine to me, but then I'd like to get a spec worked out asap for explicit chaining, which is what I tried to specify in the trusts-chained-delegation BP (which was marked implemented for Icehouse), but clearly didn't explain very well because limited-use-trusts got implemented instead :)
I'm happy to work with ayoung to define a spec which enables a limited chain of delegation, and do the work to implement it, as it is needed for Solum/Heat interoperability ref bug #1317293 (and potentially heat/ceilometer too)

[Adam Young (ayoung)](https://launchpad.net/~ayoung)
on 2014-05-29

| Changed in keystone: | |
| --- | --- |
| **assignee**: | nobody → Adam Young (ayoung) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#5](/keystone/%2Bbug/1324592/comments/5) |
| --- | --- | --- | --- |

* [keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122339/%2Bfiles/keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122339)
  (4.5 KiB,
  text/plain)

This patch performs an explicit test for the trust\_id. In order to perform it, we need to make sure that the context is properly populated.

This patch performs an explicit test for the trust\_id. In order to perform it, we need to make sure that the context is properly populated.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#6](/keystone/%2Bbug/1324592/comments/6) |
| --- | --- | --- | --- |

Above fails pep8.

Above fails pep8.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-29: |  |  | [#7](/keystone/%2Bbug/1324592/comments/7) |
| --- | --- | --- | --- |

* [keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122351/%2Bfiles/keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122351)
  (4.5 KiB,
  text/plain)

Fixes Pep8 and test failures

Fixes Pep8 and test failures

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-29: |  |  | [#8](/keystone/%2Bbug/1324592/comments/8) |
| --- | --- | --- | --- |

Minor Issue on the first pass, the patch has an untranslated string in it:

raise exception.Forbidden(

+ 'Cannot create a trust with a trust scoped token.')

Should be:

raise exception.Forbidden(

+ \_('Cannot create a trust with a trust scoped token.'))

Will look again once I'm back online see if anything else stands out.

Minor Issue on the first pass, the patch has an untranslated string in it:
raise exception.Forbidden(
+ 'Cannot create a trust with a trust scoped token.')
Should be:
raise exception.Forbidden(
+ \_('Cannot create a trust with a trust scoped token.'))
Will look again once I'm back online see if anything else stands out.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-30: |  |  | [#9](/keystone/%2Bbug/1324592/comments/9) |
| --- | --- | --- | --- |

I think, after further analysis, this same bug extends much much further than just trusts. I will run this by ayoung and nathan kinder tomorrow morning to determine if we need a separate bug / i'm wrong / if this can all be combined into a single bug.

I think, after further analysis, this same bug extends much much further than just trusts. I will run this by ayoung and nathan kinder tomorrow morning to determine if we need a separate bug / i'm wrong / if this can all be combined into a single bug.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-30: |  |  | [#10](/keystone/%2Bbug/1324592/comments/10) |
| --- | --- | --- | --- |

I just discussed this with ayoung and confirmed it is possible to perform the same type of escalation with the oauth contrib module. It would also be possible to use Oauth based tokens to create trusts that can escalate permissions.

Oauth -> Oauth

Trust -> Oauth

Oauth -> Trust

The immediate solution should be to prevent any form of chained delegation to occur from trusts or oauth (extending the new code to cover oauth scenarios).

I just discussed this with ayoung and confirmed it is possible to perform the same type of escalation with the oauth contrib module. It would also be possible to use Oauth based tokens to create trusts that can escalate permissions.
Oauth -> Oauth
Trust -> Oauth
Oauth -> Trust
The immediate solution should be to prevent any form of chained delegation to occur from trusts or oauth (extending the new code to cover oauth scenarios).

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-05-30

| Changed in ossa: | |
| --- | --- |
| **status**: | Incomplete → Confirmed |
| **importance**: | Undecided → High |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2014-05-30: |  |  | [#11](/keystone/%2Bbug/1324592/comments/11) |
| --- | --- | --- | --- |

So just to confirm, this affects only stable/icehouse and master? I assume the federated identity work for icehouse introduced the current flaw...

So just to confirm, this affects only stable/icehouse and master? I assume the federated identity work for icehouse introduced the current flaw...

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-05-30: |  |  | [#12](/keystone/%2Bbug/1324592/comments/12) |
| --- | --- | --- | --- |

Looking at the code, this appears to affect Master, Icehouse, and Havana.

Looking at the code, this appears to affect Master, Icehouse, and Havana.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-30: |  |  | [#13](/keystone/%2Bbug/1324592/comments/13) |
| --- | --- | --- | --- |

* [keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4123127/%2Bfiles/keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4123127)
  (9.5 KiB,
  text/plain)

Addresses the OAuth and Trust integration use cases.

Addresses the OAuth and Trust integration use cases.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-05-30: |  |  | [#14](/keystone/%2Bbug/1324592/comments/14) |
| --- | --- | --- | --- |

Typos in commit message ACKed. Waiting on feedback for actual patch before reposing.

Typos in commit message ACKed. Waiting on feedback for actual patch before reposing.

[Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm)
on 2014-05-31

| Changed in keystone: | |
| --- | --- |
| **status**: | New → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#15](/keystone/%2Bbug/1324592/comments/15) |
| --- | --- | --- | --- |

Suggestions for the code:

It looks like the code mitigates the privilege escalation, it feels like the code should go a bit further (yes this could all be controlled via policy, but I get the feeling that most deployments would not limit in this way).

Suggestion #1:

- While it is useful to include all the OAuth information and Trust information in the credentials (common/authorization) it would be easier for both cases to set a 'is\_delegated\_auth' flag and we can universally check for that instead of having to check trust, and oauth, and oauth, and trust, and if anything else crops up.

Suggestion #2:

If you cannot create new trusts/OAuth request tokens (authorize in the case of Oauth), the user should not be able to delete them. Likely, the user shouldn't be able to list them either. Once we get to chaining of trusts / whatever else is out there that allows delegation of smaller scope that is current, we can allow those smaller-scope delegations to be managed by the user with delegated auth. At this point, it seems that it would be unexpected for a user to be able to delete a trust or OAuth related stuff because they authed as the via a delegated role.

This assessment comes from the sample policy allowing a lot of various things to occur as admin (all oauth related actions request token etc, require admin) - lets prevent people from screwing up other people's access if they were (for some reason) delegated admin on their project.

Suggestions for the code:
It looks like the code mitigates the privilege escalation, it feels like the code should go a bit further (yes this could all be controlled via policy, but I get the feeling that most deployments would not limit in this way).
Suggestion #1:
- While it is useful to include all the OAuth information and Trust information in the credentials (common/authorization) it would be easier for both cases to set a 'is\_delegated\_auth' flag and we can universally check for that instead of having to check trust, and oauth, and oauth, and trust, and if anything else crops up.
Suggestion #2:
If you cannot create new trusts/OAuth request tokens (authorize in the case of Oauth), the user should not be able to delete them. Likely, the user shouldn't be able to list them either. Once we get to chaining of trusts / whatever else is out there that allows delegation of smaller scope that is current, we can allow those smaller-scope delegations to be managed by the user with delegated auth. At this point, it seems that it would be unexpected for a user to be able to delete a trust or OAuth related stuff because they authed as the via a delegated role.
This assessment comes from the sample policy allowing a lot of various things to occur as admin (all oauth related actions request token etc, require admin) - lets prevent people from screwing up other people's access if they were (for some reason) delegated admin on their project.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#16](/keystone/%2Bbug/1324592/comments/16) |
| --- | --- | --- | --- |

This patch will require minor differences for stable/icehouse:

nullptr:keystone morgan$ git apply --reject patch

Checking patch keystone/common/authorization.py...

Hunk #1 succeeded at 87 (offset 19 lines).

Hunk #2 succeeded at 123 (offset 19 lines).

Checking patch keystone/contrib/oauth1/controllers.py...

Checking patch keystone/tests/test\_v3\_auth.py...

Hunk #1 succeeded at 2777 (offset -50 lines).

Checking patch keystone/tests/test\_v3\_oauth1.py...

Hunk #1 succeeded at 486 (offset 10 lines).

Checking patch keystone/trust/controllers.py...

error: while searching for:

        The user creating the trust must be the trustor.

"""

        if not trust:

            raise exception.ValidationError(attribute='trust',

                                            target='request')

error: patch failed: keystone/trust/controllers.py:124

Applied patch keystone/common/authorization.py cleanly.

Applied patch keystone/contrib/oauth1/controllers.py cleanly.

Applied patch keystone/tests/test\_v3\_auth.py cleanly.

Applied patch keystone/tests/test\_v3\_oauth1.py cleanly.

Applying patch keystone/trust/controllers.py with 1 reject...

Rejected hunk #1

This patch will require minor differences for stable/icehouse:
nullptr:keystone morgan$ git apply --reject patch
Checking patch keystone/common/authorization.py...
Hunk #1 succeeded at 87 (offset 19 lines).
Hunk #2 succeeded at 123 (offset 19 lines).
Checking patch keystone/contrib/oauth1/controllers.py...
Checking patch keystone/tests/test\_v3\_auth.py...
Hunk #1 succeeded at 2777 (offset -50 lines).
Checking patch keystone/tests/test\_v3\_oauth1.py...
Hunk #1 succeeded at 486 (offset 10 lines).
Checking patch keystone/trust/controllers.py...
error: while searching for:
The user creating the trust must be the trustor.
"""
if not trust:
raise exception.ValidationError(attribute='trust',
target='request')
error: patch failed: keystone/trust/controllers.py:124
Applied patch keystone/common/authorization.py cleanly.
Applied patch keystone/contrib/oauth1/controllers.py cleanly.
Applied patch keystone/tests/test\_v3\_auth.py cleanly.
Applied patch keystone/tests/test\_v3\_oauth1.py cleanly.
Applying patch keystone/trust/controllers.py with 1 reject...
Rejected hunk #1

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#17](/keystone/%2Bbug/1324592/comments/17) |
| --- | --- | --- | --- |

Where would is\_delegated\_auth flag live? In the token itself? It means a more invasive patch, and larger tokens. If outside of the token, it means we need a common library location for it, and none really suits the scoped of this patch.

Deleting a trust from a trust is a logically acceptable activity: it would give you a way to clean up.

Listing trusts from a trust is acceptable. Listing trusts provideds no additional access. It is an activity that may make sense withing some workflows.

Even creating a trust from a trust is logically acceptable, but it requires a lot more checks than can be done in the scope of this patch.

I'll work up an icehouse and havana version of the patch.

Where would is\_delegated\_auth flag live? In the token itself? It means a more invasive patch, and larger tokens. If outside of the token, it means we need a common library location for it, and none really suits the scoped of this patch.
Deleting a trust from a trust is a logically acceptable activity: it would give you a way to clean up.
Listing trusts from a trust is acceptable. Listing trusts provideds no additional access. It is an activity that may make sense withing some workflows.
Even creating a trust from a trust is logically acceptable, but it requires a lot more checks than can be done in the scope of this patch.
I'll work up an icehouse and havana version of the patch.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#18](/keystone/%2Bbug/1324592/comments/18) |
| --- | --- | --- | --- |

the "delegated" flag would be in creds in authorization.py, just a single check instead of checking oauth and trusts in any/all locations.

the "delegated" flag would be in creds in authorization.py, just a single check instead of checking oauth and trusts in any/all locations.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#19](/keystone/%2Bbug/1324592/comments/19) |
| --- | --- | --- | --- |

I also agree that logically you should be able to create trusts (etc). but based upon the limited policy / issues around it (notably not backporting a whole featureset to icehouse/havana) we should restrict these things down as much as possible.

I also agree that logically you should be able to create trusts (etc). but based upon the limited policy / issues around it (notably not backporting a whole featureset to icehouse/havana) we should restrict these things down as much as possible.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2014-06-02: |  |  | [#20](/keystone/%2Bbug/1324592/comments/20) |
| --- | --- | --- | --- |

I reviewed the patch in comment 13 and it looks good to me.

I reviewed the patch in comment 13 and it looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#21](/keystone/%2Bbug/1324592/comments/21) |
| --- | --- | --- | --- |

* [Updated patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124299/%2Bfiles/keystone-ayoung-0013-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124299)
  (11.8 KiB,
  text/plain)

Now also blocks list\_request\_tokens as that could potentially be abused as well.

Now also blocks list\_request\_tokens as that could potentially be abused as well.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-02: |  |  | [#22](/keystone/%2Bbug/1324592/comments/22) |
| --- | --- | --- | --- |

The Patch in 21 looks good to me.

The Patch in 21 looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2014-06-02: |  |  | [#23](/keystone/%2Bbug/1324592/comments/23) |
| --- | --- | --- | --- |

A couple of comments on the patch in comment 21 --

1) in test\_v3\_oauth1.py at line 556, a file is created. The file should be deleted with self.addCleanup(os.remove, self.tmpfilename)

2) same file, at line 559 is extra-indented (8 chars rather than 4 as expected)

Other than that looks good to me.

A couple of comments on the patch in comment 21 --
1) in test\_v3\_oauth1.py at line 556, a file is created. The file should be deleted with self.addCleanup(os.remove, self.tmpfilename)
2) same file, at line 559 is extra-indented (8 chars rather than 4 as expected)
Other than that looks good to me.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#24](/keystone/%2Bbug/1324592/comments/24) |
| --- | --- | --- | --- |

* [keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124372/%2Bfiles/keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124372)
  (11.9 KiB,
  text/plain)

Backport to Icehouse.

Backport to Icehouse.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#25](/keystone/%2Bbug/1324592/comments/25) |
| --- | --- | --- | --- |

Last patch has same issues as previously reviewed by blk-u

Last patch has same issues as previously reviewed by blk-u

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#26](/keystone/%2Bbug/1324592/comments/26) |
| --- | --- | --- | --- |

* [keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124386/%2Bfiles/keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124386)
  (11.9 KiB,
  text/plain)

Addresses comments from blk-u

Addresses comments from blk-u

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-02: |  |  | [#27](/keystone/%2Bbug/1324592/comments/27) |
| --- | --- | --- | --- |

* [Backport for Icehouse](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124397/%2Bfiles/keystone-ayoung-icehouse-2-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124397)
  (12.0 KiB,
  text/plain)

Backport for Icehouse

Backport for Icehouse

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-02: |  |  | [#28](/keystone/%2Bbug/1324592/comments/28) |
| --- | --- | --- | --- |

Hello, thank you for such fast fixes :)

I'm not entirely sure what is the attack scenario for the OAuth case, so I leave it out of this first draft.

Can someone confirm there is a vulnerability specifics to the OAuth process? Or is it already covered by the following description ?

Here is the impact description draft #1:

Title: Keystone trust chained delegation privilege escalation

Reporter: Steven Hardy (RedHat)

Products: Keystone

Versions: up to 2013.2.3, and 2014.1

Description:

Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By chaining delegation from a trust token, a trustee may circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's roles. All keystone setups are affected.

Hello, thank you for such fast fixes :)
I'm not entirely sure what is the attack scenario for the OAuth case, so I leave it out of this first draft.
Can someone confirm there is a vulnerability specifics to the OAuth process? Or is it already covered by the following description ?
Here is the impact description draft #1:
Title: Keystone trust chained delegation privilege escalation
Reporter: Steven Hardy (RedHat)
Products: Keystone
Versions: up to 2013.2.3, and 2014.1
Description:
Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By chaining delegation from a trust token, a trustee may circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's roles. All keystone setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-03: |  |  | [#29](/keystone/%2Bbug/1324592/comments/29) |
| --- | --- | --- | --- |

@Tristan,

The OAuth attack scenario is similar to trust one:

\* Trustee creates an OAuth authentication delegation (with elevated privs)

\* ReAuth with new OAuth based delegation.

Alternatively, someone authenticated with an OAuth delegation could:

\* Create Trust with elevated privileges

\* ReAuthenticate with new Trust.

The fixes Adam Young has provided eliminate both of these alternate attack vectors.

@Tristan,
The OAuth attack scenario is similar to trust one:
\* Trustee creates an OAuth authentication delegation (with elevated privs)
\* ReAuth with new OAuth based delegation.
Alternatively, someone authenticated with an OAuth delegation could:
\* Create Trust with elevated privileges
\* ReAuthenticate with new Trust.
The fixes Adam Young has provided eliminate both of these alternate attack vectors.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Garth Mollett (gmollett)](https://launchpad.net/~gmollett) wrote on 2014-06-03: |  |  | [#30](/keystone/%2Bbug/1324592/comments/30) |
| --- | --- | --- | --- |

@Tristan

As this came from RedHat I can assign a CVE to this now if it saves you time?

Or I can hold off and wait for the official request if you would prefer.

@Tristan
As this came from RedHat I can assign a CVE to this now if it saves you time?
Or I can hold off and wait for the official request if you would prefer.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-03: |  |  | [#31](/keystone/%2Bbug/1324592/comments/31) |
| --- | --- | --- | --- |

* [Backport to Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124479/%2Bfiles/keystone-ayoung-Havana-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124479)
  (14.9 KiB,
  text/plain)

Backport to Havana.

Backport to Havana.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-03: |  |  | [#32](/keystone/%2Bbug/1324592/comments/32) |
| --- | --- | --- | --- |

@Morgan,

Thank, that is very helpful, I'll update the impact description.

Just to be sure, the privilege elevation can only happen with out-of-scope roles from the former authentication.

I mean, it's not to any role right ?

@Garth

I would prefer having the impact description validated before requesting a CVE. Then yes, feel free to assign the CVE thanks!

@Morgan,
Thank, that is very helpful, I'll update the impact description.
Just to be sure, the privilege elevation can only happen with out-of-scope roles from the former authentication.
I mean, it's not to any role right ?
@Garth
I would prefer having the impact description validated before requesting a CVE. Then yes, feel free to assign the CVE thanks!

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#33](/keystone/%2Bbug/1324592/comments/33) |
| --- | --- | --- | --- |

@Tristan:

1. User A trusts User B to impersonate them within the scope of Project X (using User A's roles AND identity).

2a. User B abuses the identity impersonation against keystone to delegate User A's authorization (either to User B, or to a third party) in Project Y, a secondary scope in which User A never intended to delegate authorization.

2b. Alternatively, User B abuses the identity impersonation against keystone to delegate \*additional\* authorization (either to User B, or to a third party) held by User A in Project X, including roles which User A never intended to delegate.

Also note that you should be able to avoid exposure by completely disabling support for trusts, by setting the following in keystone.conf:

[trust]

  enabled = false

Trust support is enabled by default since Grizzly.

@Tristan:
1. User A trusts User B to impersonate them within the scope of Project X (using User A's roles AND identity).
2a. User B abuses the identity impersonation against keystone to delegate User A's authorization (either to User B, or to a third party) in Project Y, a secondary scope in which User A never intended to delegate authorization.
2b. Alternatively, User B abuses the identity impersonation against keystone to delegate \*additional\* authorization (either to User B, or to a third party) held by User A in Project X, including roles which User A never intended to delegate.
Also note that you should be able to avoid exposure by completely disabling support for trusts, by setting the following in keystone.conf:
[trust]
enabled = false
Trust support is enabled by default since Grizzly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#34](/keystone/%2Bbug/1324592/comments/34) |
| --- | --- | --- | --- |

I suppose it's also worth mentioning that 2a and 2b are not mutually exclusive possibilities, and can each be repeated.

I suppose it's also worth mentioning that 2a and 2b are not mutually exclusive possibilities, and can each be repeated.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-03: |  |  | [#35](/keystone/%2Bbug/1324592/comments/35) |
| --- | --- | --- | --- |

@Dolph thanks for the clarification!

I put 2014.1.1 as an affected version because with the pre-OSSA process, this won't get in time for this release.

Here is the impact description draft #2:

Title: Keystone privilege escalation through trust chained delegation

Reporter: Steven Hardy (RedHat)

Products: Keystone

Versions: up to 2013.2.3, and 2014.1.1

Description:

Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. Note that trust support is enabled by default since Grizzly and can only be manually disabled through keystone configuration. All keystone setups are affected.

@Dolph thanks for the clarification!
I put 2014.1.1 as an affected version because with the pre-OSSA process, this won't get in time for this release.
Here is the impact description draft #2:
Title: Keystone privilege escalation through trust chained delegation
Reporter: Steven Hardy (RedHat)
Products: Keystone
Versions: up to 2013.2.3, and 2014.1.1
Description:
Steven Hardy from RedHat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. Note that trust support is enabled by default since Grizzly and can only be manually disabled through keystone configuration. All keystone setups are affected.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Jeremy Stanley (fungi)](https://launchpad.net/~fungi) wrote on 2014-06-03: |  |  | [#36](/keystone/%2Bbug/1324592/comments/36) |
| --- | --- | --- | --- |

Versions: up to 2013.2.3, and 2014.1 to 2014.1.1

(because 2014.1 is also affected)

Otherwise Tristan's impact description proposed in comment #35 looks great.

Versions: up to 2013.2.3, and 2014.1 to 2014.1.1
(because 2014.1 is also affected)
Otherwise Tristan's impact description proposed in comment #35 looks great.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-03: |  |  | [#37](/keystone/%2Bbug/1324592/comments/37) |
| --- | --- | --- | --- |

Impact description draft #2 looks accurate.

Impact description draft #2 looks accurate.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#38](/keystone/%2Bbug/1324592/comments/38) |
| --- | --- | --- | --- |

Tristan: I feel like "All keystone setups are affected" conflicts with the previous sentence... maybe combine the two statements? Something like:

All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Tristan: I feel like "All keystone setups are affected" conflicts with the previous sentence... maybe combine the two statements? Something like:
All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Brant Knudson (blk-u)](https://launchpad.net/~blk-u) wrote on 2014-06-03: |  |  | [#39](/keystone/%2Bbug/1324592/comments/39) |
| --- | --- | --- | --- |

Reviewed the patch in comment 26, looks good to me.

Reviewed the icehouse backport in comment 27, looks good to me.

Reviewed the havana backport in comment 31

 - there's an unrelated change in keystone/exception.py that should be reverted.

   This change causes a unit test failure on my system.

 - there's commented-out code in test\_v3\_oauth1.py at line 529 that should be removed

Reviewed the patch in comment 26, looks good to me.
Reviewed the icehouse backport in comment 27, looks good to me.
Reviewed the havana backport in comment 31
- there's an unrelated change in keystone/exception.py that should be reverted.
This change causes a unit test failure on my system.
- there's commented-out code in test\_v3\_oauth1.py at line 529 that should be removed

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-03: |  |  | [#40](/keystone/%2Bbug/1324592/comments/40) |
| --- | --- | --- | --- |

Thanks folks, I've updated the description with your comments,

Here is the impact description draft #3:

Title: Keystone privilege escalation through trust chained delegation

Reporter: Steven Hardy (Red Hat)

Products: Keystone

Versions: up to 2013.2.3, and 2014.1 to 2014.1.1

Description:

Steven Hardy from Red Hat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Thanks folks, I've updated the description with your comments,
Here is the impact description draft #3:
Title: Keystone privilege escalation through trust chained delegation
Reporter: Steven Hardy (Red Hat)
Products: Keystone
Versions: up to 2013.2.3, and 2014.1 to 2014.1.1
Description:
Steven Hardy from Red Hat reported a vulnerability in Keystone chained delegation. By creating a delegation from a trust or OAuth token, a trustee may abuse the identity impersonation against keystone and circumvent the enforced scope, resulting in potential elevated privileges to any of the trustor's projects and or roles. All Keystone deployments configured to enable trusts are affected, which has been the default since Grizzly.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-03: |  |  | [#41](/keystone/%2Bbug/1324592/comments/41) |
| --- | --- | --- | --- |

+1 for impact description

+1 for impact description

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-06-03

| Changed in ossa: | |
| --- | --- |
| **assignee**: | nobody → Tristan Cacqueray (tristan-cacqueray) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Garth Mollett (gmollett)](https://launchpad.net/~gmollett) wrote on 2014-06-04: |  |  | [#42](/keystone/%2Bbug/1324592/comments/42) |
| --- | --- | --- | --- |

Ok. hope I'm not jumping in too early here: Please use CVE-2014-3476 for this issue.

Ok. hope I'm not jumping in too early here: Please use CVE-2014-3476 for this issue.

[Grant Murphy (gmurphy)](https://launchpad.net/~gmurphy)
on 2014-06-04

| **summary**: | - Trust scope can be circumvented by chaining trusts+ Trust scope can be circumvented by chaining trusts (CVE-2014-3476) |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-04:  [**Re: Trust scope can be circumvented by chaining trusts (CVE-2014-3476)**](/keystone/%2Bbug/1324592/comments/43) |  |  | [#43](/keystone/%2Bbug/1324592/comments/43) |
| --- | --- | --- | --- |

* [Patch for Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4125102/%2Bfiles/keystone-ayoung-Hava-3-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4125102)
  (14.3 KiB,
  text/plain)

Updated Patch for Havana.

Removes the change to exception and the commented out code are referred to by blk-u

Updated Patch for Havana.
Removes the change to exception and the commented out code are referred to by blk-u

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-04: |  |  | [#44](/keystone/%2Bbug/1324592/comments/44) |
| --- | --- | --- | --- |

Updated Havana patch triggers a unit test failure.

Updated Havana patch triggers a unit test failure.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Adam Young (ayoung)](https://launchpad.net/~ayoung) wrote on 2014-06-04: |  |  | [#45](/keystone/%2Bbug/1324592/comments/45) |
| --- | --- | --- | --- |

Unit test failures were result of artifacts from previous runs in the git repository. Unit tests run clean.

Unit test failures were result of artifacts from previous runs in the git repository. Unit tests run clean.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-04: |  |  | [#46](/keystone/%2Bbug/1324592/comments/46) |
| --- | --- | --- | --- |

Can keystone-coresec please have a look at proposed patch before we proceed to stakeholders pre-OSSA:

stable/havana is in comment #43

stable/icehouse in comment #27

master is in comment #26

Thanks in advance

Can keystone-coresec please have a look at proposed patch before we proceed to stakeholders pre-OSSA:
stable/havana is in comment #43
stable/icehouse in comment #27
master is in comment #26
Thanks in advance

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Morgan Fainberg (mdrnstm)](https://launchpad.net/~mdrnstm) wrote on 2014-06-05: |  |  | [#47](/keystone/%2Bbug/1324592/comments/47) |
| --- | --- | --- | --- |

Patches in #43, #27, and #26 apply cleanly to the respective branches.

Tests appear to pass for all patches.

The changeset in #26 looks good to me against master

The changeset in #27 looks good to me against icehouse

The changeset in #43 looks good to me against havana

+1 on the patches and impact statement, I would like to see a second core review the patches before they are merged though.

Patches in #43, #27, and #26 apply cleanly to the respective branches.
Tests appear to pass for all patches.
The changeset in #26 looks good to me against master
The changeset in #27 looks good to me against icehouse
The changeset in #43 looks good to me against havana
+1 on the patches and impact statement, I would like to see a second core review the patches before they are merged though.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Dolph Mathews (dolph)](https://launchpad.net/~dolph) wrote on 2014-06-05: |  |  | [#48](/keystone/%2Bbug/1324592/comments/48) |
| --- | --- | --- | --- |

The fix is actually over-restrictive. It's not delegated auth in general that should cause these operations to be denied, but specifically just impersonation. Regardless, the fix is certainly effective at closing the vulnerability.

+1 for master patch in #26

+1 for stable/icehouse patch in #27

+1 for stable/havana patch in #43

I have a few small nits on the request context stuff, but I'll save those for a subsequent patch to master :)

The fix is actually over-restrictive. It's not delegated auth in general that should cause these operations to be denied, but specifically just impersonation. Regardless, the fix is certainly effective at closing the vulnerability.
+1 for master patch in #26
+1 for stable/icehouse patch in #27
+1 for stable/havana patch in #43
I have a few small nits on the request context stuff, but I'll save those for a subsequent patch to master :)

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-06-09

| Changed in ossa: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Steven Hardy (shardy)](https://launchpad.net/~shardy) wrote on 2014-06-09: |  |  | [#49](/keystone/%2Bbug/1324592/comments/49) |
| --- | --- | --- | --- |

+1 for master patch in #26 - I've pulled that and tested it, and can confirm it resolves the reported issue.

I've not tested the stable backports.

+1 for master patch in #26 - I've pulled that and tested it, and can confirm it resolves the reported issue.
I've not tested the stable backports.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray) wrote on 2014-06-09: |  |  | [#50](/keystone/%2Bbug/1324592/comments/50) |
| --- | --- | --- | --- |

The pre-OSSA has been sent, the proposed disclosure date/time is:

2014-06-12, 1500UTC

The pre-OSSA has been sent, the proposed disclosure date/time is:
2014-06-12, 1500UTC

| Changed in ossa: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-06-12

| **information type**: | Private Security → Public Security |
| --- | --- |
| **summary**: | - Trust scope can be circumvented by chaining trusts (CVE-2014-3476)+ [OSSA 2014-018] Trust scope can be circumvented by chaining trusts+ (CVE-2014-3476) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-12:  [**Fix proposed to keystone (master)**](/keystone/%2Bbug/1324592/comments/51) |  |  | [#51](/keystone/%2Bbug/1324592/comments/51) |
| --- | --- | --- | --- |

Fix proposed to branch: master

Review: <https://review.openstack.org/99687>

Fix proposed to branch: master
Review: https://review.openstack.org/99687

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-12:  [**Fix proposed to keystone (stable/icehouse)**](/keystone/%2Bbug/1324592/comments/52) |  |  | [#52](/keystone/%2Bbug/1324592/comments/52) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/icehouse

Review: <https://review.openstack.org/99700>

Fix proposed to branch: stable/icehouse
Review: https://review.openstack.org/99700

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-12:  [**Fix proposed to keystone (stable/havana)**](/keystone/%2Bbug/1324592/comments/53) |  |  | [#53](/keystone/%2Bbug/1324592/comments/53) |
| --- | --- | --- | --- |

Fix proposed to branch: stable/havana

Review: <https://review.openstack.org/99703>

Fix proposed to branch: stable/havana
Review: https://review.openstack.org/99703

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-13:  [**Fix merged to keystone (master)**](/keystone/%2Bbug/1324592/comments/54) |  |  | [#54](/keystone/%2Bbug/1324592/comments/54) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/99687>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=ebfc2da158d15fe2f36787bcbf7407a0fa8f551d>

Submitter: Jenkins

Branch: master

commit ebfc2da158d15fe2f36787bcbf7407a0fa8f551d

Author: Adam Young <email address hidden>

Date: Thu May 29 13:56:17 2014 -0400

Block delegation escalation of privilege

Forbids doing the following with either a trust

      or oauth based token:

      creating a trust

      approving a request\_token

      listing request tokens

Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2

    Closes-Bug: 1324592

Reviewed: https://review.openstack.org/99687
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=ebfc2da158d15fe2f36787bcbf7407a0fa8f551d
Submitter: Jenkins
Branch: master
commit ebfc2da158d15fe2f36787bcbf7407a0fa8f551d
Author: Adam Young <ayoung@redhat.com>
Date: Thu May 29 13:56:17 2014 -0400
Block delegation escalation of privilege
Forbids doing the following with either a trust
or oauth based token:
creating a trust
approving a request\_token
listing request tokens
Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2
Closes-Bug: 1324592

| Changed in keystone: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-13:  [**Fix merged to keystone (stable/icehouse)**](/keystone/%2Bbug/1324592/comments/55) |  |  | [#55](/keystone/%2Bbug/1324592/comments/55) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/99700>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=73785122eefe523bb57c819e085c7f6ec97d779c>

Submitter: Jenkins

Branch: stable/icehouse

commit 73785122eefe523bb57c819e085c7f6ec97d779c

Author: Adam Young <email address hidden>

Date: Thu May 29 13:56:17 2014 -0400

Block delegation escalation of privilege

Forbids doing the following with either a trust

      or oauth based token:

      creating a trust

      approving a request\_token

      listing request tokens

Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2

    Closes-Bug: 1324592

Reviewed: https://review.openstack.org/99700
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=73785122eefe523bb57c819e085c7f6ec97d779c
Submitter: Jenkins
Branch: stable/icehouse
commit 73785122eefe523bb57c819e085c7f6ec97d779c
Author: Adam Young <ayoung@redhat.com>
Date: Thu May 29 13:56:17 2014 -0400
Block delegation escalation of privilege
Forbids doing the following with either a trust
or oauth based token:
creating a trust
approving a request\_token
listing request tokens
Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2
Closes-Bug: 1324592

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [OpenStack Infra (hudson-openstack)](https://launchpad.net/~hudson-openstack) wrote on 2014-06-13:  [**Fix merged to keystone (stable/havana)**](/keystone/%2Bbug/1324592/comments/56) |  |  | [#56](/keystone/%2Bbug/1324592/comments/56) |
| --- | --- | --- | --- |

Reviewed: <https://review.openstack.org/99703>

Committed: <https://git.openstack.org/cgit/openstack/keystone/commit/?id=9162837329665b4316afc2270a602dc8ae11f6d2>

Submitter: Jenkins

Branch: stable/havana

commit 9162837329665b4316afc2270a602dc8ae11f6d2

Author: Adam Young <email address hidden>

Date: Thu May 29 13:56:17 2014 -0400

Block delegation escalation of privilege

Forbids doing the following with either a trust

      or oauth based token:

      creating a trust

      approving a request\_token

      listing request tokens

Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2

    Closes-Bug: 1324592

Reviewed: https://review.openstack.org/99703
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=9162837329665b4316afc2270a602dc8ae11f6d2
Submitter: Jenkins
Branch: stable/havana
commit 9162837329665b4316afc2270a602dc8ae11f6d2
Author: Adam Young <ayoung@redhat.com>
Date: Thu May 29 13:56:17 2014 -0400
Block delegation escalation of privilege
Forbids doing the following with either a trust
or oauth based token:
creating a trust
approving a request\_token
listing request tokens
Change-Id: I1528f9dd003f5e03cbc50b78e1b32dbbf85ffcc2
Closes-Bug: 1324592

[Tristan Cacqueray (tristan-cacqueray)](https://launchpad.net/~tristan-cacqueray)
on 2014-06-16

| Changed in ossa: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Russell Bryant (russellb)](https://launchpad.net/~russellb)
on 2014-07-24

| Changed in keystone: | |
| --- | --- |
| **milestone**: | none → juno-2 |
| **status**: | Fix Committed → Fix Released |

[Chuck Short (zulcss)](https://launchpad.net/~zulcss)
on 2014-08-07

| **tags**: | added: in-stable-icehouse |
| --- | --- |

[Thierry Carrez (ttx)](https://launchpad.net/~ttx)
on 2014-10-16

| Changed in keystone: | |
| --- | --- |
| **milestone**: | juno-2 → 2014.2 |

[See full activity log](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/keystone/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/keystone/%2Bbug/1324592/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Patches

* [keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122339/%2Bfiles/keystone-ayoung-0010-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122339 "Change patch details")
* [keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122351/%2Bfiles/keystone-ayoung-0010-2-Forbid-creating-a-trust-with-a-trust-token.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122351 "Change patch details")
* [keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4123127/%2Bfiles/keystone-ayoung-0011-Block-Delegation-esclation-of-Priveledges.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4123127 "Change patch details")
* [Updated patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124299/%2Bfiles/keystone-ayoung-0013-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124299 "Change patch details")
* [keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124372/%2Bfiles/keystone-ayoung-icehouse-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124372 "Change patch details")
* [keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124386/%2Bfiles/keystone-ayoung-0013-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124386 "Change patch details")
* [Backport for Icehouse](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124397/%2Bfiles/keystone-ayoung-icehouse-2-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124397 "Change patch details")
* [Backport to Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4124479/%2Bfiles/keystone-ayoung-Havana-1-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4124479 "Change patch details")
* [Patch for Havana](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4125102/%2Bfiles/keystone-ayoung-Hava-3-Block-delegation-escalation-of-privilege.patch)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4125102 "Change patch details")

* [Add patch](/keystone/%2Bbug/1324592/%2Baddcomment?field.patch=on)

## Bug attachments

* [Reproducer script](https://bugs.launchpad.net/keystone/%2Bbug/1324592/%2Battachment/4122312/%2Bfiles/chained_example3.py)
  [Edit](/keystone/%2Bbug/1324592/%2Battachment/4122312 "Change attachment details")

* [Add attachment](/keystone/%2Bbug/1324592/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from translations.launchpad.net_4db0e6d1_20250126_123022.html ===

[Log in / Register](https://translations.launchpad.net/keystone/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* Translations
* [Answers](https://answers.launchpad.net/keystone)

# Translation overview

[Help for translations](https://help.launchpad.net/Translations)

There are no translations for this project.

### Translation details

To see all the translation files that are waiting to be
imported, please look at
[OpenStack Identity (keystone) import queue](/keystone/%2Bimports).

### Permissions

[OpenStack Identity (keystone)](https://launchpad.net/keystone) is translated
with [Open](/%2Bhelp-translations/permissions-policies.html)
permissions.

### All translatable distribution packages

* [keystone source package in Plucky](/ubuntu/plucky/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Oracular](/ubuntu/oracular/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Noble](/ubuntu/noble/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Mantic](/ubuntu/mantic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Lunar](/ubuntu/lunar/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Kinetic](/ubuntu/kinetic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Jammy](/ubuntu/jammy/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Impish](/ubuntu/impish/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Hirsute](/ubuntu/hirsute/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Groovy](/ubuntu/groovy/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Focal](/ubuntu/focal/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Eoan](/ubuntu/eoan/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Disco](/ubuntu/disco/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Cosmic](/ubuntu/cosmic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Bionic](/ubuntu/bionic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Artful](/ubuntu/artful/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Zesty](/ubuntu/zesty/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Yakkety](/ubuntu/yakkety/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Xenial](/ubuntu/xenial/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Wily](/ubuntu/wily/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Vivid](/ubuntu/vivid/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Utopic](/ubuntu/utopic/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Trusty](/ubuntu/trusty/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Saucy](/ubuntu/saucy/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Raring](/ubuntu/raring/%2Bsources/keystone/%2Btranslations)
* [keystone source package in Quantal](/ubuntu/quantal/%2Bsources/keystone/%2Btranslations)

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from answers.launchpad.net_da5dcf83_20250126_123023.html ===

[Log in / Register](https://answers.launchpad.net/keystone/%2Blogin)

[![](https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png)](https://launchpad.net/keystone)

## [OpenStack Identity (keystone)](https://launchpad.net/keystone)

* [Overview](https://launchpad.net/keystone)
* [Code](https://code.launchpad.net/keystone)
* [Bugs](https://bugs.launchpad.net/keystone)
* [Blueprints](https://blueprints.launchpad.net/keystone)
* [Translations](https://translations.launchpad.net/keystone)
* Answers

# Questions for OpenStack Identity (keystone)

**Launchpad does not know where
OpenStack Identity (keystone)
tracks support requests.**

OpenStack Identity (keystone) questions are
tracked in:
[keystone in Ubuntu](/ubuntu/%2Bsource/keystone).

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))



=== Content from launchpad.net_5983273c_20250126_123028.html ===

[Log in / Register](https://launchpad.net/~shardy/%2Blogin)

[![](/@@/person-logo)](https://launchpad.net/~shardy)

## [Steven Hardy](https://launchpad.net/~shardy)

* Overview
* [Code](https://code.launchpad.net/~shardy)
* [Bugs](https://bugs.launchpad.net/~shardy)
* [Blueprints](https://blueprints.launchpad.net/~shardy)
* [Translations](https://translations.launchpad.net/~shardy)
* [Answers](https://answers.launchpad.net/~shardy)

* [Related packages](https://launchpad.net/~shardy/%2Brelated-packages)
* [Related projects](https://launchpad.net/~shardy/%2Brelated-projects)

## User information

Launchpad Id:
shardy

Email:
[Log in](%2Blogin) for email information.

Member since:
2012-05-16

[![Icon of Nova](https://launchpadlibrarian.net/52560219/os14.png "Member of Nova")](/~nova)
[![Icon of OpenStack Team](https://launchpadlibrarian.net/52313052/os14.png "Member of OpenStack Team")](/~openstack)
[![Icon of Swift](https://launchpadlibrarian.net/52560230/os14.png "Member of Swift")](/~swift)

Languages:

English

OpenPGP keys:

F9913FFFC92E22ACF17091FF0CE8E5974D818960

SSH keys:

[root@localhost.localdomain](%2Bsshkeys)

[root@localhost.localdomain](%2Bsshkeys)

[root@localhost.localdomain](%2Bsshkeys)

[shardy@heatlt.localdomain](%2Bsshkeys)

[stack@t430slt](%2Bsshkeys)

[root@heatlt.localdomain](%2Bsshkeys)

Time zone:

Europe/London
(UTC+0000)

Karma:
[0](https://launchpad.net/~shardy/%2Bkarma)
[Karma help](/%2Bhelp-registry/karma.html)

Social accounts:
![IRC](/@@/social-irc "IRC")
**shardy**
 on
**irc.freenode.net**

## [All bugs in progress](https://launchpad.net/~shardy/%2Bassignedbugs?search=Search&field.status=In+Progress) Assigned bugs

||  | #1801092 [OpenShift role specific variables cause warning due to missing tag](https://bugs.launchpad.net/tripleo/%2Bbug/1801092) |  |
| --- | --- | --- |
| in [tripleo](/tripleo) | | |

| --- | --- | --- | --- | --- | --- |
||  | #1751017 [Ocata doesn't support NodeTLSData for custom roles](https://bugs.launchpad.net/tripleo/ocata/%2Bbug/1751017) |  |
| --- | --- | --- |
| in [tripleo](/tripleo) | | |

||  | #1463092 [hieradata change doesn't reapply manifest](https://bugs.launchpad.net/heat-templates/%2Bbug/1463092) |  |
| --- | --- | --- |
| in [Heat Templates](/heat-templates), [tripleo](/tripleo) | | |

||  | #1453095 [failing pypy jobs with "option --single-version-externally-managed not recognized"](https://bugs.launchpad.net/python-heatclient/%2Bbug/1453095) |  |
| --- | --- | --- |
| in [python-heatclient](/python-heatclient) | | |

## [All assigned blueprints](/~shardy/%2Bspecs?role=assignee) Assigned blueprints

| **[Create an ironic resource plugin](https://blueprints.launchpad.net/heat/%2Bspec/ironic-resource "ironic-resource")** for **OpenStack Heat**  Create a (contrib) resource which exposes the ironic API, as an alternative for people who would prefer to consume the API directly instead of via nova. | |
| --- | --- |

## [All memberships](https://launchpad.net/~shardy/%2Bparticipation) Latest memberships

| [TripleO Drivers](/~tripleo-drivers)  Joined on 2016-04-20 | |
| --- | --- |
| [tripleo](/~tripleo)  Joined on 2015-09-02 | |
| [Heat Drivers](/~heat-drivers)  Joined on 2012-11-20 | |
| [Heat Core security contacts](/~heat-coresec)  Joined on 2012-11-20 | |
| [Keystone Devs](/~keystone)  Joined on 2012-10-23 | |

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


