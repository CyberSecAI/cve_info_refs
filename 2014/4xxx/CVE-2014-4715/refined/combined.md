=== Content from code.google.com_838794ca_20250124_162734.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flz4%2Flz4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flz4%2Flz4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=lz4%2Flz4)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lz4](/lz4)
/
**[lz4](/lz4/lz4)**
Public

* [Notifications](/login?return_to=%2Flz4%2Flz4) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Flz4%2Flz4)
* [Star
   10.6k](/login?return_to=%2Flz4%2Flz4)

Extremely Fast Compression algorithm

[www.lz4.org](http://www.lz4.org "http://www.lz4.org")

### License

[View license](/lz4/lz4/blob/dev/LICENSE)

[10.6k
stars](/lz4/lz4/stargazers) [1.4k
forks](/lz4/lz4/forks) [Branches](/lz4/lz4/branches) [Tags](/lz4/lz4/tags) [Activity](/lz4/lz4/activity)
 [Star](/login?return_to=%2Flz4%2Flz4)

 [Notifications](/login?return_to=%2Flz4%2Flz4) You must be signed in to change notification settings

* [Code](/lz4/lz4)
* [Issues
  27](/lz4/lz4/issues)
* [Pull requests
  12](/lz4/lz4/pulls)
* [Discussions](/lz4/lz4/discussions)
* [Actions](/lz4/lz4/actions)
* [Wiki](/lz4/lz4/wiki)
* [Security](/lz4/lz4/security)
* [Insights](/lz4/lz4/pulse)

Additional navigation options

* [Code](/lz4/lz4)
* [Issues](/lz4/lz4/issues)
* [Pull requests](/lz4/lz4/pulls)
* [Discussions](/lz4/lz4/discussions)
* [Actions](/lz4/lz4/actions)
* [Wiki](/lz4/lz4/wiki)
* [Security](/lz4/lz4/security)
* [Insights](/lz4/lz4/pulse)

# lz4/lz4

    dev[Branches](/lz4/lz4/branches)[Tags](/lz4/lz4/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[3,595 Commits](/lz4/lz4/commits/dev/) | | |
| [.circleci](/lz4/lz4/tree/dev/.circleci ".circleci") | | [.circleci](/lz4/lz4/tree/dev/.circleci ".circleci") |  |  |
| [.github](/lz4/lz4/tree/dev/.github ".github") | | [.github](/lz4/lz4/tree/dev/.github ".github") |  |  |
| [build](/lz4/lz4/tree/dev/build "build") | | [build](/lz4/lz4/tree/dev/build "build") |  |  |
| [contrib](/lz4/lz4/tree/dev/contrib "contrib") | | [contrib](/lz4/lz4/tree/dev/contrib "contrib") |  |  |
| [doc](/lz4/lz4/tree/dev/doc "doc") | | [doc](/lz4/lz4/tree/dev/doc "doc") |  |  |
| [examples](/lz4/lz4/tree/dev/examples "examples") | | [examples](/lz4/lz4/tree/dev/examples "examples") |  |  |
| [lib](/lz4/lz4/tree/dev/lib "lib") | | [lib](/lz4/lz4/tree/dev/lib "lib") |  |  |
| [ossfuzz](/lz4/lz4/tree/dev/ossfuzz "ossfuzz") | | [ossfuzz](/lz4/lz4/tree/dev/ossfuzz "ossfuzz") |  |  |
| [programs](/lz4/lz4/tree/dev/programs "programs") | | [programs](/lz4/lz4/tree/dev/programs "programs") |  |  |
| [tests](/lz4/lz4/tree/dev/tests "tests") | | [tests](/lz4/lz4/tree/dev/tests "tests") |  |  |
| [.cirrus.yml](/lz4/lz4/blob/dev/.cirrus.yml ".cirrus.yml") | | [.cirrus.yml](/lz4/lz4/blob/dev/.cirrus.yml ".cirrus.yml") |  |  |
| [.clang-format](/lz4/lz4/blob/dev/.clang-format ".clang-format") | | [.clang-format](/lz4/lz4/blob/dev/.clang-format ".clang-format") |  |  |
| [.gitattributes](/lz4/lz4/blob/dev/.gitattributes ".gitattributes") | | [.gitattributes](/lz4/lz4/blob/dev/.gitattributes ".gitattributes") |  |  |
| [.gitignore](/lz4/lz4/blob/dev/.gitignore ".gitignore") | | [.gitignore](/lz4/lz4/blob/dev/.gitignore ".gitignore") |  |  |
| [CODING\_STYLE](/lz4/lz4/blob/dev/CODING_STYLE "CODING_STYLE") | | [CODING\_STYLE](/lz4/lz4/blob/dev/CODING_STYLE "CODING_STYLE") |  |  |
| [INSTALL](/lz4/lz4/blob/dev/INSTALL "INSTALL") | | [INSTALL](/lz4/lz4/blob/dev/INSTALL "INSTALL") |  |  |
| [LICENSE](/lz4/lz4/blob/dev/LICENSE "LICENSE") | | [LICENSE](/lz4/lz4/blob/dev/LICENSE "LICENSE") |  |  |
| [Makefile](/lz4/lz4/blob/dev/Makefile "Makefile") | | [Makefile](/lz4/lz4/blob/dev/Makefile "Makefile") |  |  |
| [Makefile.inc](/lz4/lz4/blob/dev/Makefile.inc "Makefile.inc") | | [Makefile.inc](/lz4/lz4/blob/dev/Makefile.inc "Makefile.inc") |  |  |
| [NEWS](/lz4/lz4/blob/dev/NEWS "NEWS") | | [NEWS](/lz4/lz4/blob/dev/NEWS "NEWS") |  |  |
| [README.md](/lz4/lz4/blob/dev/README.md "README.md") | | [README.md](/lz4/lz4/blob/dev/README.md "README.md") |  |  |
| [SECURITY.md](/lz4/lz4/blob/dev/SECURITY.md "SECURITY.md") | | [SECURITY.md](/lz4/lz4/blob/dev/SECURITY.md "SECURITY.md") |  |  |
| [appveyor.yml](/lz4/lz4/blob/dev/appveyor.yml "appveyor.yml") | | [appveyor.yml](/lz4/lz4/blob/dev/appveyor.yml "appveyor.yml") |  |  |
| View all files | | |

## Repository files navigation

* README
* License
* Security
# LZ4 - Extremely fast compression

LZ4 is lossless compression algorithm,
providing compression speed > 500 MB/s per core,
scalable with multi-cores CPU.
It features an extremely fast decoder,
with speed in multiple GB/s per core,
typically reaching RAM speed limits on multi-core systems.

Speed can be tuned dynamically, selecting an "acceleration" factor
which trades compression ratio for faster speed.
On the other end, a high compression derivative, LZ4\_HC, is also provided,
trading CPU time for improved compression ratio.
All versions feature the same decompression speed.

LZ4 is also compatible with [dictionary compression](https://github.com/facebook/zstd#the-case-for-small-data-compression),
both at [API](https://github.com/lz4/lz4/blob/v1.8.3/lib/lz4frame.h#L481) and [CLI](https://github.com/lz4/lz4/blob/v1.8.3/programs/lz4.1.md#operation-modifiers) levels.
It can ingest any input file as dictionary, though only the final 64KB are used.
This capability can be combined with the [Zstandard Dictionary Builder](https://github.com/facebook/zstd/blob/v1.3.5/programs/zstd.1.md#dictionary-builder),
in order to drastically improve compression performance on small files.

LZ4 library is provided as open-source software using BSD 2-Clause license.

| Branch | Status |
| --- | --- |
| dev | [Build status](https://ci.appveyor.com/project/YannCollet/lz4-1lndh) |

## Benchmarks

The benchmark uses [lzbench](https://github.com/inikep/lzbench), from @inikep
compiled with GCC v8.2.0 on Linux 64-bits (Ubuntu 4.18.0-17).
The reference system uses a Core i7-9700K CPU @ 4.9GHz (w/ turbo boost).
Benchmark evaluates the compression of reference [Silesia Corpus](http://sun.aei.polsl.pl/~sdeor/index.php?page=silesia)
in single-thread mode.

| Compressor | Ratio | Compression | Decompression |
| --- | --- | --- | --- |
| memcpy | 1.000 | 13700 MB/s | 13700 MB/s |
| **LZ4 default (v1.9.0)** | **2.101** | **780 MB/s** | **4970 MB/s** |
| LZO 2.09 | 2.108 | 670 MB/s | 860 MB/s |
| QuickLZ 1.5.0 | 2.238 | 575 MB/s | 780 MB/s |
| Snappy 1.1.4 | 2.091 | 565 MB/s | 1950 MB/s |
| [Zstandard](http://www.zstd.net/) 1.4.0 -1 | 2.883 | 515 MB/s | 1380 MB/s |
| LZF v3.6 | 2.073 | 415 MB/s | 910 MB/s |
| [zlib](http://www.zlib.net/) deflate 1.2.11 -1 | 2.730 | 100 MB/s | 415 MB/s |
| **LZ4 HC -9 (v1.9.0)** | **2.721** | 41 MB/s | **4900 MB/s** |
| [zlib](http://www.zlib.net/) deflate 1.2.11 -6 | 3.099 | 36 MB/s | 445 MB/s |

LZ4 is also compatible and optimized for x32 mode (`-mx32`),
for which it provides additional speed performance.

## Installation

```
make
make install     # this command may require root permissions

```

LZ4's `Makefile` supports standard [Makefile conventions](https://www.gnu.org/prep/standards/html_node/Makefile-Conventions.html),
including [staged installs](https://www.gnu.org/prep/standards/html_node/DESTDIR.html), [redirection](https://www.gnu.org/prep/standards/html_node/Directory-Variables.html), or [command redefinition](https://www.gnu.org/prep/standards/html_node/Utilities-in-Makefiles.html).
It is compatible with parallel builds (`-j#`).

### Building LZ4 - Using vcpkg

You can download and install LZ4 using the [vcpkg](https://github.com/Microsoft/vcpkg) dependency manager:

```
git clone https://github.com/Microsoft/vcpkg.git
cd vcpkg
./bootstrap-vcpkg.sh
./vcpkg integrate install
./vcpkg.exe install lz4

```

The LZ4 port in vcpkg is kept up to date by Microsoft team members and community contributors. If the version is out of date, please [create an issue or pull request](https://github.com/Microsoft/vcpkg) on the vcpkg repository.

## Documentation

The raw LZ4 block compression format is detailed within [lz4\_Block\_format](/lz4/lz4/blob/dev/doc/lz4_Block_format.md).

Arbitrarily long files or data streams are compressed using multiple blocks,
for streaming requirements. These blocks are organized into a frame,
defined into [lz4\_Frame\_format](/lz4/lz4/blob/dev/doc/lz4_Frame_format.md).
Interoperable versions of LZ4 must also respect the frame format.

## Other source versions

Beyond the C reference source,
many contributors have created versions of lz4 in multiple languages
(Java, C#, Python, Perl, Ruby, etc.).
A list of known source ports is maintained on the [LZ4 Homepage](http://www.lz4.org).

### Packaging status

Most distributions are bundled with a package manager
which allows easy installation of both the `liblz4` library
and the `lz4` command line interface.

[![Packaging status](https://camo.githubusercontent.com/a3e785a28d3dad61e6f02f5902ec5acb9df7438ebb02fea81ac2358dbe826868/68747470733a2f2f7265706f6c6f67792e6f72672f62616467652f766572746963616c2d616c6c7265706f732f6c7a342e7376673f636f6c756d6e733d34266578636c7564655f756e737570706f727465643d31)](https://repology.org/project/lz4/versions)

### Special Thanks

* Takayuki Matsuoka, aka @t-mat, for exceptional first-class support throughout the lifetime of this project

## About

Extremely Fast Compression algorithm

[www.lz4.org](http://www.lz4.org "http://www.lz4.org")

### Topics

[c](/topics/c "Topic: c")
[compression](/topics/compression "Topic: compression")
[lz4](/topics/lz4 "Topic: lz4")

### Resources

[Readme](#readme-ov-file)
### License

[View license](#License-1-ov-file)
### Security policy

[Security policy](#security-ov-file)

[Activity](/lz4/lz4/activity)
[Custom properties](/lz4/lz4/custom-properties)
### Stars

[**10.6k**
stars](/lz4/lz4/stargazers)
### Watchers

[**249**
watching](/lz4/lz4/watchers)
### Forks

[**1.4k**
forks](/lz4/lz4/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Flz4%2Flz4&report=lz4+%28user%29)

## [Releases 31](/lz4/lz4/releases)

[LZ4 v1.10.0 - Multicores edition
Latest

Jul 22, 2024](/lz4/lz4/releases/tag/v1.10.0)
[+ 30 releases](/lz4/lz4/releases)

## [Packages 0](/orgs/lz4/packages?repo_name=lz4)

No packages published

## [Contributors 176](/lz4/lz4/graphs/contributors)

[+ 162 contributors](/lz4/lz4/graphs/contributors)

## Languages

* [C
  81.7%](/lz4/lz4/search?l=c)
* [C++
  4.5%](/lz4/lz4/search?l=c%2B%2B)
* [Makefile
  4.4%](/lz4/lz4/search?l=makefile)
* [Python
  3.5%](/lz4/lz4/search?l=python)
* [Shell
  1.7%](/lz4/lz4/search?l=shell)
* [Meson
  1.7%](/lz4/lz4/search?l=meson)
* Other
  2.5%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from code.google.com_b9d84cc9_20250124_162731.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flz4%2Flz4%2Fpull%2F134)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flz4%2Flz4%2Fpull%2F134)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=lz4%2Flz4)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[lz4](/lz4)
/
**[lz4](/lz4/lz4)**
Public

* [Notifications](/login?return_to=%2Flz4%2Flz4) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Flz4%2Flz4)
* [Star
   10.6k](/login?return_to=%2Flz4%2Flz4)

* [Code](/lz4/lz4)
* [Issues
  27](/lz4/lz4/issues)
* [Pull requests
  12](/lz4/lz4/pulls)
* [Discussions](/lz4/lz4/discussions)
* [Actions](/lz4/lz4/actions)
* [Wiki](/lz4/lz4/wiki)
* [Security](/lz4/lz4/security)
* [Insights](/lz4/lz4/pulse)

Additional navigation options

* [Code](/lz4/lz4)
* [Issues](/lz4/lz4/issues)
* [Pull requests](/lz4/lz4/pulls)
* [Discussions](/lz4/lz4/discussions)
* [Actions](/lz4/lz4/actions)
* [Wiki](/lz4/lz4/wiki)
* [Security](/lz4/lz4/security)
* [Insights](/lz4/lz4/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Flz4%2Flz4%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Flz4%2Flz4%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Avoid out-of-bounds reading #134

 Merged

[Cyan4973](/Cyan4973)
merged 1 commit into
[lz4:wildcopy](/lz4/lz4/tree/wildcopy "lz4/lz4:wildcopy")
from
[mtopolnik:wildcopy](/mtopolnik/lz4/tree/wildcopy "mtopolnik/lz4:wildcopy")

Jul 2, 2015

 Merged

# [Avoid out-of-bounds reading](#top) #134

[Cyan4973](/Cyan4973)
merged 1 commit into
[lz4:wildcopy](/lz4/lz4/tree/wildcopy "lz4/lz4:wildcopy")
from
[mtopolnik:wildcopy](/mtopolnik/lz4/tree/wildcopy "mtopolnik/lz4:wildcopy")

Jul 2, 2015

[Conversation
3](/lz4/lz4/pull/134)
[Commits
1](/lz4/lz4/pull/134/commits)
[Checks
0](/lz4/lz4/pull/134/checks)
[Files changed](/lz4/lz4/pull/134/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mtopolnik](https://avatars.githubusercontent.com/u/490953?s=60&v=4)](/mtopolnik)

Copy link

### @mtopolnik **[mtopolnik](/mtopolnik)** commented [Jun 30, 2015](#issue-92051868)

Reworked reading from before the malloc'd buffer into within-bound reading followed by a left shift (little-endian logic applies here).

Unfortunately, the performance of `MT_wildCopyNarrowLE` is halved when unaligned pointer ops are replaced with `memcpy`. More work should be applied to avoid `memcpy`.

Sorry, something went wrong.

All reactions

`[Avoid out-of-bounds reading](/lz4/lz4/pull/134/commits/c772948b052d77129e019d5acc695e2a5a3c3059 "Avoid out-of-bounds reading")`

`[c772948](/lz4/lz4/pull/134/commits/c772948b052d77129e019d5acc695e2a5a3c3059)`

 [![@mtopolnik](https://avatars.githubusercontent.com/u/490953?s=40&v=4)](/mtopolnik)
[mtopolnik](/mtopolnik)
[force-pushed](/lz4/lz4/compare/1f019e6de026d1d197b92881f558d086d18934e1..c772948b052d77129e019d5acc695e2a5a3c3059)
the
wildcopy

branch
from
[`1f019e6`](/lz4/lz4/commit/1f019e6de026d1d197b92881f558d086d18934e1) to
[`c772948`](/lz4/lz4/commit/c772948b052d77129e019d5acc695e2a5a3c3059)  [Compare](/lz4/lz4/compare/1f019e6de026d1d197b92881f558d086d18934e1..c772948b052d77129e019d5acc695e2a5a3c3059)
[June 30, 2015 13:02](#event-344183210)

[Cyan4973](/Cyan4973)
added a commit
that referenced
this pull request
[Jul 2, 2015](#ref-commit-9d8ed5c)
[![@Cyan4973](https://avatars.githubusercontent.com/u/750081?s=40&u=5c57ccd9ec69a84870fd9f1e71c3f14a2cd427d7&v=4)](/Cyan4973)

`[Merge pull request](/lz4/lz4/commit/9d8ed5ca1891c1b853bd6c5bed95a15c1ae193fa "Merge pull request #134 from mtopolnik/wildcopy

Avoid out-of-bounds reading") [#134](https://github.com/lz4/lz4/pull/134) [from mtopolnik/wildcopy](/lz4/lz4/commit/9d8ed5ca1891c1b853bd6c5bed95a15c1ae193fa "Merge pull request #134 from mtopolnik/wildcopy

Avoid out-of-bounds reading")`
…

`[9d8ed5c](/lz4/lz4/commit/9d8ed5ca1891c1b853bd6c5bed95a15c1ae193fa)`

```
Avoid out-of-bounds reading
```

[![@Cyan4973](https://avatars.githubusercontent.com/u/750081?s=40&u=5c57ccd9ec69a84870fd9f1e71c3f14a2cd427d7&v=4)](/Cyan4973)
[Cyan4973](/Cyan4973)
merged commit [`9d8ed5c`](/lz4/lz4/commit/9d8ed5ca1891c1b853bd6c5bed95a15c1ae193fa)
into
lz4:wildcopy

[Jul 2, 2015](https://github.com/lz4/lz4/pull/134#event-345966299)

 [![@mtopolnik](https://avatars.githubusercontent.com/u/490953?s=40&v=4)](/mtopolnik)
[mtopolnik](/mtopolnik)
deleted the
wildcopy

branch
[July 2, 2015 07:38](#event-346174593)

[![@mtopolnik](https://avatars.githubusercontent.com/u/490953?s=80&v=4)](/mtopolnik)

Copy link

Author

### **[mtopolnik](/mtopolnik)** commented [Jul 4, 2015](#issuecomment-118495367)

| I have completed the implementation of `MT_wildCopyNarrowLE` which uses aligned writing, but it didn't solve the performance issue. However, I also found out that the issue is specific to `clang` (on my local system) whereas `gcc` does rather well with the current code.  The code is committed [here](https://github.com/mtopolnik/lz4/blob/wildcopy_align_narrow/lib/lz4.c#L282) should there be any future need to evaluate it. |
| --- |

All reactions

Sorry, something went wrong.

[![@Cyan4973](https://avatars.githubusercontent.com/u/750081?s=80&u=5c57ccd9ec69a84870fd9f1e71c3f14a2cd427d7&v=4)](/Cyan4973)

Copy link

Member

### **[Cyan4973](/Cyan4973)** commented [Jul 6, 2015](#issuecomment-118775240)

| I guess there will be a need to work on branching predictibility to make this solution fly under "normal" conditions too. |
| --- |

All reactions

Sorry, something went wrong.

[![@mtopolnik](https://avatars.githubusercontent.com/u/490953?s=80&v=4)](/mtopolnik)

Copy link

Author

### **[mtopolnik](/mtopolnik)** commented [Jul 6, 2015](#issuecomment-118777711)

| One possile idea to try out is using `|` instead of `||` in the first `if` condition. Theoretically the compiler should already know what is best for performance, but there still may be a chance for improvement. |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Flz4%2Flz4%2Fpull%2F134)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@mtopolnik](https://avatars.githubusercontent.com/u/490953?s=52&v=4)](/mtopolnik) [![@Cyan4973](https://avatars.githubusercontent.com/u/750081?s=52&v=4)](/Cyan4973)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from blog.securitymouse.com_04de7e52_20250124_162728.html ===


# [The Mouse Trap](http://blog.securitymouse.com/)

The Lab Mouse Security research blog.

## Tuesday, July 1, 2014

### I Was Wrong - Proving LZ4 Exploitable With Less Than 4MB

### But Not In the Way You Might Think

For the uninitiated, I recently uncovered a vulnerability in LZ4 during triage with the Linux kernel team on a separate but very similar issue in LZO. Ludwig Strigeus uncovered the issue [over a year ago](https://code.google.com/p/lz4/issues/detail?id=52&can=1) and posted it to the LZ4 Google Code bug issue list. Rather than hand waving over the resulting mis communications and bug dismissal that followed, let's focus on the facts

* The bug was initially labeled a non-issue
* No fix was provided for over a year
* The bug is said to not be vulnerable for payloads less-than 8MB in size
* The LZ4 implementation demands that less-than 8MB blocks be used

All of the above information can be found on the LZ4 Google Code project page bug report that Ludwig filed. A conversation between myself and Yann follows the discussion between Ludwig and Yann.

In that discussion we can find Yann's assertion that blocks less-than 8MB are not vulnerable and that blocks less-than 4MB are the modern requirement for LZ4. Thus, no modern implementations should be affected at all.

This is only true for the exploit case where the attacker generates a 'length' value so large that it causes the 'cpy' pointer to overflow, and point to an address prior to the start of the output buffer. This is the attack that I focused on as this is the same attack I had been using successfully against LZO. I have documented this attack [in this previous blog post](http://blog.securitymouse.com/2014/06/understanding-lz4-memory-corruption.html).

What is imperative, that I completely missed because of focusing on pointer negation, is the context in which the code would execute. That is where today's post comes in, which stemmed from a conversation I had with Richard Johnson late last week.

After getting some time to evaluate the issue further, last night I realized something. I was wrong, and so was Yann. A payload greater-than or equal-to 8MB is not required. In fact, you can abuse this algorithm with less than 4MB of data.

### Switching Context

Context is an important thing, isn't it? The LZ4 code in the Linux kernel has been deemed invulnerable because each use case requires a payload that adheres to Yann's implementation requirements; the 8MB or 4MB that I cited above. But, there's a catch. This presumes that we need more than that amount of data to do something malicious.

Let's look again at the kernel code. Follow along at the LXR found [here](http://lxr.free-electrons.com/source/lib/lz4/lz4_decompress.c). This time, we're looking at the lz4\_uncompress\_unknownoutputsize function, which is the supposedly "secure" variant.

186                 length = (token >> ML\_BITS);
187                 if (length == RUN\_MASK) {
188                         int s = 255;
189                         while ((ip < iend) && (s == 255)) {
190                                 s = \*ip++;
191                                 length += s;
192                         }
193                 }
194                 /\* copy literals \*/
195                 cpy = op + length;
196                 if ((cpy > oend - COPYLENGTH) ||
197                         (ip + length > iend - COPYLENGTH)) {

We see the exact same size accumulation loop at line 189. Okay, so we can generate large sizes. We know that already. Let's take another look at line 195.

This is what I missed from my brief evaluation during LZO triage. Yes, it's vulnerable, but in a much more subtle fashion than I thought. In a kernel context, 'op' will point to an address in memory that is much more interesting than an address in a user-land application.

For contrast, let's take a brief look at the Btrfs LZO implementation code. When LZO is being used in Btrfs, a workspace is built in virtual memory. Presumably because of the larger size requirements vmalloc is used. We can see this code below, or on the LXR [here](http://lxr.free-electrons.com/source/fs/btrfs/lzo.c).

 49 static struct list\_head \*lzo\_alloc\_workspace(void)
 50 {
 51         struct workspace \*workspace;
 52
 53         workspace = kzalloc(sizeof(\*workspace), GFP\_NOFS);
 54         if (!workspace)
 55                 return ERR\_PTR(-ENOMEM);
 56
 57         workspace->mem = vmalloc(LZO1X\_MEM\_COMPRESS);
 58         workspace->buf = vmalloc(lzo1x\_worst\_compress(PAGE\_CACHE\_SIZE));
 59         workspace->cbuf = vmalloc(lzo1x\_worst\_compress(PAGE\_CACHE\_SIZE));
 60         if (!workspace->mem || !workspace->buf || !workspace->cbuf)
 61                 goto fail;

Now you may be asking "Why is this important?" and "What does this have to do with LZ4?". Everything. It has everything to do with LZ4.

Let's take an ARM platform as an example, since - as we know - that is an extremely important 32bit architecture. The Linux kernel LZ4 implementation makes special cases for use on the ARM architecture, as can be seen in [this file on LXR](http://lxr.free-electrons.com/source/lib/lz4/lz4defs.h).

 28 #if defined(CONFIG\_HAVE\_EFFICIENT\_UNALIGNED\_ACCESS)             \
 29         || defined(CONFIG\_ARM) && \_\_LINUX\_ARM\_ARCH\_\_ >= 6       \
 30         && defined(ARM\_EFFICIENT\_UNALIGNED\_ACCESS)
 31

So, knowing that LZ4 is targeted as code used on ARM, think again about the vmalloc call. Take Raspberry Pi as a simple example use case on ARM. This is the kernel's memory layout on boot in a current-day Raspberry Pi system, running Linux kernel 3.12.22+ #691 PREEMPT.

[    0.000000] Memory: 374640K/393216K available (4376K kernel code, 238K rwdata, 1340K rodata, 143K init
, 701K bss, 18576K reserved)
[    0.000000] Virtual kernel memory layout:
[    0.000000]     vector  : 0xffff0000 - 0xffff1000   (   4 kB)
[    0.000000]     fixmap  : 0xfff00000 - 0xfffe0000   ( 896 kB)
[    0.000000]     vmalloc : 0xd8800000 - 0xff000000   ( 616 MB)
[    0.000000]     lowmem  : 0xc0000000 - 0xd8000000   ( 384 MB)
[    0.000000]     modules : 0xbf000000 - 0xc0000000   (  16 MB)
[    0.000000]       .text : 0xc0008000 - 0xc059d54c   (5718 kB)
[    0.000000]       .init : 0xc059e000 - 0xc05c1ee4   ( 144 kB)
[    0.000000]       .data : 0xc05c2000 - 0xc05fd900   ( 239 kB)
[    0.000000]        .bss : 0xc05fd90c - 0xc06ad0f8   ( 702 kB)

This means that the region reserved for vmalloc starts at 0xd8800000. That's pretty high up in memory, isn't it. Now, let's look again at the LZ4 pointer arithmetic.

194                 /\* copy literals \*/
195                 cpy = op + length;
196                 if ((cpy > oend - COPYLENGTH) ||
197                         (ip + length > iend - COPYLENGTH)) {

So, presuming we are on a (very common) ARM platform, the lowest likely address in memory for the output pointer 'op' is 0xd8800000. And that is very generous. Obviously, a lot more memory will be allocated far before a call to LZ4 is ever made, meaning that the address actually used for the copy will be far higher in mem. But, for simplicity, let's focus on the lowest possible address.

For this pointer arithmetic to cause an overflow we now only need 0x100000000 - 0xd8800000 in the 'length' value. Seems like a lot? It's not. Let's do the math.

0x100000000 - 0xd8800000 = 0x27800000, or 632MB

Since we know that we increase the value of 'length' by 255 for every byte we can divide 632MB by 255. This means it takes

0x27800000 / 255 = 2,598,823

2,598,823 bytes of the value 0xff, plus one final byte of 0xa7 are required to generate the exact 'length' value of 0x27800000. When this 'length' value is added to an 'op' address of 0xd8800000, what do we get? We get nothing. That's right, the address zero.

0xd8800000 + 0x27800000 = 0x00000000

That means it only takes approximately 2.47 MB to access page zero on ARM from the vmalloc region.

### Now I'm Nothing

But, you might be asking yourself "But what the hell is at address zero? Nothing, that's what!"

Nope. On many RISC platforms, just like ARM, this is a vector area that handles interrupts, exceptions, and other traps. It's an extremely critical area. More importantly, just above this area, is where user-land sits. And, according to [this post](http://www.arm.linux.org.uk/developer/memory.txt) on older ARM kernels, user-land task structures (meaning the structure that holds running privileges) is contained there.  ***Edit:** Not being a Linux kernel guy (my ARM experience is with Real Time kernels, base bands/GPS executives, and Plan 9) I misunderstood the TASK information below. As Spender points out, this does not mean task structure.*

```
TASK_SIZE PAGE_OFFSET-1 Kernel module space
    Kernel modules inserted via insmod are
    placed here using dynamic mappings.

00001000 TASK_SIZE-1 User space mappings
    Per-thread mappings are placed here via
    the mmap() system call.

00000000 00000fff CPU vector page / null pointer trap
    CPUs which do not support vector remapping
    place their vector page here.  NULL pointer
    dereferences by both the kernel and user
    space are also caught via this mapping.

```

So what does this mean? This means that an attacker with very little memory (even in accordance to the LZ4 specification) can potentially bypass address verification checks and overwrite critical structures at low addresses in memory.

**Edit:** *While this is technically True (for some constrained cases of True) only older ARM variants keep vectors at ((void\*)0), newer ones map vectors to ((void\*)0xffff0000), so there isn't necessarily a valid page at all at such low addresses.*

### Summary

Effectively, this post proves that

* Exploits can be written against current implementations of LZ4
* Block sizes less than 8MB (and even less than 4MB) can be malicious
* Certain platforms are more affected than others (primarily RISC: ARM)
* Protecting against the 16MB and greater flaw was not sufficient

***Edit:*** It's also important to note that this means user-land applications are more affected by the LZ4 bug than previously thought. Even though modern platforms include PIE/ASLR/NX protections to diminish the impact of such a bug, this is the kind of critical arbitrary-write bug attackers look for when they have a corresponding memory information disclosure (read) that exposes addresses in memory. If the attacker can calculate the correct offset to use to overwrite memory, the attacker could affect user-land applications. Memory pressure would have to come into play here, as well.

Best,

Don A. Bailey
Founder / CEO
Lab Mouse Security
@InfoSecMouse

Posted by

[Unknown](https://www.blogger.com/profile/15216641486714883199 "author profile")

at

[1:07 PM](http://blog.securitymouse.com/2014/07/i-was-wrong-proving-lz4-exploitable.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=5803873077727212399&postID=8647631654257966835&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=5803873077727212399&postID=8647631654257966835&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=5803873077727212399&postID=8647631654257966835&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=5803873077727212399&postID=8647631654257966835&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=5803873077727212399&postID=8647631654257966835&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=5803873077727212399&postID=8647631654257966835&target=pinterest "Share to Pinterest")

#### 1 comment:

1. ![](//resources.blogblog.com/img/blank.gif)Anonymous[July 2, 2014 at 5:47 AM](http://blog.securitymouse.com/2014/07/i-was-wrong-proving-lz4-exploitable.html?showComment=1404305244624#c397009045068340982)

   So... I've lost track at this point. ZFS, vulnerable or not at this point?

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=5803873077727212399&postID=397009045068340982)Replies
   Reply

Add commentLoad more...

[Newer Post](http://blog.securitymouse.com/2014/07/the-42-year-old-vulnerability.html "Newer Post")

[Older Post](http://blog.securitymouse.com/2014/06/understanding-lz4-memory-corruption.html "Older Post")

[Home](http://blog.securitymouse.com/)

Subscribe to:
[Post Comments (Atom)](http://blog.securitymouse.com/feeds/8647631654257966835/comments/default)

## Translate

## Search The Mouse Trap

|  |  |
| --- | --- |

## Blog Archive

* ►
  [2018](http://blog.securitymouse.com/2018/)
  (2)
  + ►
    [March](http://blog.securitymouse.com/2018/03/)
    (1)
  + ►
    [January](http://blog.securitymouse.com/2018/01/)
    (1)

* ►
  [2017](http://blog.securitymouse.com/2017/)
  (4)
  + ►
    [October](http://blog.securitymouse.com/2017/10/)
    (1)
  + ►
    [May](http://blog.securitymouse.com/2017/05/)
    (1)
  + ►
    [April](http://blog.securitymouse.com/2017/04/)
    (2)

* ►
  [2016](http://blog.securitymouse.com/2016/)
  (6)
  + ►
    [November](http://blog.securitymouse.com/2016/11/)
    (1)
  + ►
    [July](http://blog.securitymouse.com/2016/07/)
    (4)
  + ►
    [June](http://blog.securitymouse.com/2016/06/)
    (1)

* ►
  [2015](http://blog.securitymouse.com/2015/)
  (3)
  + ►
    [May](http://blog.securitymouse.com/2015/05/)
    (2)
  + ►
    [April](http://blog.securitymouse.com/2015/04/)
    (1)

* ▼
  [2014](http://blog.securitymouse.com/2014/)
  (19)
  + ►
    [November](http://blog.securitymouse.com/2014/11/)
    (1)
  + ►
    [October](http://blog.securitymouse.com/2014/10/)
    (4)
  + ►
    [September](http://blog.securitymouse.com/2014/09/)
    (1)
  + ▼
    [July](http://blog.securitymouse.com/2014/07/)
    (7)
    - [Bla Bla LZ4, Bla Bla GoLang Or Whatever](http://blog.securitymouse.com/2014/07/bla-bla-lz4-bla-bla-golang-or-whatever.html)
    - [A Final LZ4 Act - Hacking Erlang](http://blog.securitymouse.com/2014/07/a-final-lz4-act-hacking-erlang.html)
    - [The LZ4-Ruby Two Hour Challenge](http://blog.securitymouse.com/2014/07/the-lz4-two-hour-challenge.html)
    - [So I Guess This Happened](http://blog.securitymouse.com/2014/07/so-i-guess-this-happened.html)
    - [Hacking CERN - Exploiting python-lz4 for Particles...](http://blog.securitymouse.com/2014/07/hacking-cern-exploiting-python-lz4-for.html)
    - [The 42 Year Old Vulnerability](http://blog.securitymouse.com/2014/07/the-42-year-old-vulnerability.html)
    - [I Was Wrong - Proving LZ4 Exploitable With Less Th...](http://blog.securitymouse.com/2014/07/i-was-wrong-proving-lz4-exploitable.html)
  + ►
    [June](http://blog.securitymouse.com/2014/06/)
    (2)
  + ►
    [April](http://blog.securitymouse.com/2014/04/)
    (3)
  + ►
    [February](http://blog.securitymouse.com/2014/02/)
    (1)

* ►
  [2013](http://blog.securitymouse.com/2013/)
  (1)
  + ►
    [July](http://blog.securitymouse.com/2013/07/)
    (1)

* ►
  [2012](http://blog.securitymouse.com/2012/)
  (1)
  + ►
    [October](http://blog.securitymouse.com/2012/10/)
    (1)

## Contributors

* [Unknown](https://www.blogger.com/profile/15216641486714883199)
* [Unknown](https://www.blogger.com/profile/14551735817821206775)

|  |  |
| --- | --- |

Picture Window theme. Powered by [Blogger](https://www.blogger.com).


