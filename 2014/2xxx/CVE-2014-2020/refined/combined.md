=== Content from www.ubuntu.com_2150156d_20250124_115724.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-2126-1: PHP vulnerabilities

3 March 2014

Several security issues were fixed in PHP.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 13.10](/security/notices?release=saucy)
* [Ubuntu 12.10](/security/notices?release=quantal)
* [Ubuntu 12.04](/security/notices?release=precise)
* [Ubuntu 10.04](/security/notices?release=lucid)

## Packages

* [php5](/security/cves?package=php5) - HTML-embedded scripting language interpreter

## Details

Bernd Melchers discovered that PHP's embedded libmagic library incorrectly

handled indirect offset values. An attacker could use this issue to cause

PHP to consume resources or crash, resulting in a denial of service.

([CVE-2014-1943](/security/CVE-2014-1943))

It was discovered that PHP incorrectly handled certain values when using

the imagecrop function. An attacker could possibly use this issue to cause

PHP to crash, resulting in a denial of service, obtain sensitive

information, or possibly execute arbitrary code. This issue only affected

Ubuntu 13.10. ([CVE-2013-7226](/security/CVE-2013-7226), [CVE-2013-7327](/security/CVE-2013-7327), [CVE-2013-7328](/security/CVE-2013-7328), [CVE-2014-2020](/security/CVE-2014-2020))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 13.10

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.5.3+dfsg-1ubuntu2.2](https://launchpad.net/ubuntu/%2Bsource/php5/5.5.3%2Bdfsg-1ubuntu2.2)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.5.3+dfsg-1ubuntu2.2](https://launchpad.net/ubuntu/%2Bsource/php5/5.5.3%2Bdfsg-1ubuntu2.2)
* [php5-gd](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.5.3+dfsg-1ubuntu2.2](https://launchpad.net/ubuntu/%2Bsource/php5/5.5.3%2Bdfsg-1ubuntu2.2)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.5.3+dfsg-1ubuntu2.2](https://launchpad.net/ubuntu/%2Bsource/php5/5.5.3%2Bdfsg-1ubuntu2.2)

##### Ubuntu 12.10

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.4.6-1ubuntu1.7](https://launchpad.net/ubuntu/%2Bsource/php5/5.4.6-1ubuntu1.7)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.4.6-1ubuntu1.7](https://launchpad.net/ubuntu/%2Bsource/php5/5.4.6-1ubuntu1.7)
* [php5-gd](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.4.6-1ubuntu1.7](https://launchpad.net/ubuntu/%2Bsource/php5/5.4.6-1ubuntu1.7)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.4.6-1ubuntu1.7](https://launchpad.net/ubuntu/%2Bsource/php5/5.4.6-1ubuntu1.7)

##### Ubuntu 12.04

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.10-1ubuntu3.10](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.10-1ubuntu3.10)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.10-1ubuntu3.10](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.10-1ubuntu3.10)
* [php5-gd](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.10-1ubuntu3.10](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.10-1ubuntu3.10)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.10-1ubuntu3.10](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.10-1ubuntu3.10)

##### Ubuntu 10.04

* [php5-cli](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.23](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.23)
* [php5-cgi](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.23](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.23)
* [php5-gd](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.23](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.23)
* [libapache2-mod-php5](https://launchpad.net/ubuntu/%2Bsource/php5)
  -
  [5.3.2-1ubuntu4.23](https://launchpad.net/ubuntu/%2Bsource/php5/5.3.2-1ubuntu4.23)

In general, a standard system update will make all the necessary changes.

## References

* [CVE-2013-7226](/security/CVE-2013-7226)
* [CVE-2013-7327](/security/CVE-2013-7327)
* [CVE-2013-7328](/security/CVE-2013-7328)
* [CVE-2014-1943](/security/CVE-2014-1943)
* [CVE-2014-2020](/security/CVE-2014-2020)

## Related notices

* [USN-2123-1](/security/notices/USN-2123-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from bugs.php.net_28b94921_20250124_115725.html ===


| [Bugs](/) | [php.net](https://php.net/) |  [support](https://php.net/support.php) |  [documentation](https://php.net/docs.php) |  [report a bug](report.php) |  [advanced search](search.php) |  [search howto](search-howto.php) |  [statistics](stats.php) |  [random bug](random) |  [login](login.php) |
| --- | --- |
| go to bug id or search bugs for | |

| | [Sec Bug](bug.php?id=66356) #66356 | Heap Overflow Vulnerability in imagecrop() | | | | | | --- | --- | --- | --- | --- | --- | | Submitted: | 2013-12-27 02:57 UTC | Modified: | 2014-02-15 17:28 UTC |  | | From: | kuba dot brecka at gmail dot com | Assigned: | [pajoye](search.php?cmd=display&assign=pajoye) ([profile](https://people.php.net/pajoye)) | | Status: | Closed | Package: | [GD related](search.php?cmd=display&package_name[]=GD+related) | | PHP Version: | 5.5.7 | OS: | all | | Private report: | No | CVE-ID: | [2013-7226](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2013-7226) |   View [Developer](bug.php?id=66356&edit=1) [Edit](bug.php?id=66356&edit=2)   **[2013-12-27 02:57 UTC] kuba dot brecka at gmail dot com** ``` Description: ------------ The imagecrop() function can be used to crop an image with the following call:  	$dimensions = array("x" => 10, "y" => 10, "width" => 50, "height" => 50); 	$new_image = image($image, $dimensions);  The implementation of imagecrop() in ext/gd/gd.c performs very little checking of the supplied dimensions:  	gdRect rect; 	... 	if (zend_hash_find(HASH_OF(z_rect), "x", sizeof("x"), (void **)&tmp) != FAILURE) { 		rect.x = Z_LVAL_PP(tmp); 	} else { 	...  One issue here is that there is no check of tmp's type nor a conversion. This means that if the dimensions array contains the key "x", its zval's value will be treated as an integer even if it's really a string or an array. This can be used as an information leak vulnerability, because strings and array contain pointers which can be used for subsequent exploits. See POC #1.  The "rect" variable is then used in a call to "gdImageCrop":  	im_crop = gdImageCrop(im, &rect);  This function then uses the user-supplied dimensions for various calculations:  	if (src->trueColor) { 		dst = gdImageCreateTrueColor(crop->width, crop->height); 		gdImageSaveAlpha(dst, 1); 	} else { 		dst = gdImageCreate(crop->width, crop->height); 		gdImagePaletteCopy(dst, src); 	} 	dst->transparent = src->transparent;  The gdImageCreateTrueColor() and gdImageCreate() functions are smart enough to block any attempt to overflow the width and height parameters, returning a NULL pointer when this happens. However, this code has an issue of not checking the return value of these functions, using the "dst" variable for memory writes unconditionally. This means it can cause a NULL pointer (or a close-to-NULL pointer) write, which is probably just crash the process, but since the gd image structure is very large, it could happen to even touch allocated memory. See POC #2.  The function then performs some bounds checks:  	if (src->sx < (crop->x + crop->width -1)) { 		crop->width = src->sx - crop->x + 1; 	} 	if (src->sy < (crop->y + crop->height -1)) { 		crop->height = src->sy - crop->y + 1; 	}  These are using signed integer arithmetics and can be overflown and tricked into incorrect calculations. Later, for true-color, the pixels are copied with this code:  	int y = crop->y; 	... 	unsigned int dst_y = 0; 	while (y < (crop->y + (crop->height - 1))) { 		/* TODO: replace 4 w/byte per channel||pitch once available */ 		memcpy(dst->tpixels[dst_y++], src->tpixels[y++] + crop->x, crop->width * 4); 	}  Remember that crop->x and crop->y are completely user-supplied values and we can supply negative values. This way we can force the copying code to read outside of the source image pixel data, causing a crash or an information leak. See POC #3.  We must however keep the crop->width and crop->height positive, and reasonable, because they are used at the beginning of the function to create a destination bitmap. We can however trick the already mentioned bounds checking code:   	if (src->sx < (crop->x + crop->width -1)) { 		crop->width = src->sx - crop->x + 1; 	}  When supplying a very large crop->x value, we can make the condition pass, assigning a value to crop->width which is larger than the real destination's pixel buffer width. The memcpy will then copy more data than the heap-based buffers can hold, causing a heap-based buffer overflow. See POC #4.  All the supplied POCs will cause a crash on 32-bit systems. First the POCs will segfault due to invalid memory read, the last one will crash due to a heap overflow (gdb output attached, but the backtrace is useless because the crash occurs much later, at PHP's shutdown and cleanup). Tested on a 32-bit Ubuntu Server machine. All versions of PHP containing the imagecrop() function are vulnerable, i.e. PHP 5.5.0 and newer. Proposed patch to fix the mentioned vulnerabilities is attached and it also adds a test for the POCs into the PHP test suite.   Test script: --------------- POC 1: ------  <? 	// POC #1 	$img = imagecreatetruecolor(10, 10); 	$img = imagecrop($img, array("x" => "a", "y" => 0, "width" => 10, "height" => 10));  POC 2: ------  <? 	// POC #2 	$img = imagecreatetruecolor(10, 10); 	$img = imagecrop($img, array("x" => 0, "y" => 0, "width" => -1, "height" => 10));  POC 3: ------  <? 	// POC #3 	$img = imagecreatetruecolor(10, 10); 	$img = imagecrop($img, array("x" => -20, "y" => -20, "width" => 10, "height" => 10));  POC 4: ------  <? 	// POC #4 	$img = imagecreatetruecolor(10, 10); 	$img = imagecrop($img, array("x" => 0x7fffff00, "y" => 0, "width" => 10, "height" => 10));   Actual result: -------------- GDB session from POC #4:   kuba@sonny:~/php/php-src$ gdb ./sapi/cli/php (gdb) r ../crop.php Starting program: /home/kuba/php/php-src/sapi/cli/php ../crop.php [Fri Dec 27 01:47:50 2013]  Script:  '/home/kuba/php/crop.php' --------------------------------------- /home/kuba/php/php-src/ext/gd/libgd/gd.c(242) : Block 0xb7c09d6c status: Invalid pointer: ((size=0x00000055) != (next.prev=0x00000094)) --------------------------------------- [Fri Dec 27 01:47:50 2013]  Script:  '/home/kuba/php/crop.php' --------------------------------------- /home/kuba/php/php-src/ext/gd/libgd/gd.c(242) : Block 0xb7c09dc0 status: Invalid pointer: ((size=0x00000000) != (next.prev=0x00000094)) Invalid pointer: ((prev=0x00000094) != (prev.size=0x00000000)) --------------------------------------- [Fri Dec 27 01:47:50 2013]  Script:  '/home/kuba/php/crop.php' --------------------------------------- /home/kuba/php/php-src/ext/gd/libgd/gd.c(242) : Block 0xb7c09e4c status: Invalid pointer: ((size=0x00000002) != (next.prev=0x00000000)) Invalid pointer: ((prev=0x00000000) != (prev.size=0x00000002)) ---------------------------------------  Program received signal SIGSEGV, Segmentation fault. 0x083d2cce in zend_mm_check_ptr (heap=0x8919398, ptr=0xb7c09ed8, silent=1, __zend_filename=0x87c02fc "/home/kuba/php/php-src/ext/gd/libgd/gd.c", __zend_lineno=242,     __zend_orig_filename=0x0, __zend_orig_lineno=0) at /home/kuba/php/php-src/Zend/zend_alloc.c:1384 1384            if (p->info._size != ZEND_MM_NEXT_BLOCK(p)->info._prev) { (gdb) bt #0  0x083d2cce in zend_mm_check_ptr (heap=0x8919398, ptr=0xb7c09ed8, silent=1, __zend_filename=0x87c02fc "/home/kuba/php/php-src/ext/gd/libgd/gd.c", __zend_lineno=242,     __zend_orig_filename=0x0, __zend_orig_lineno=0) at /home/kuba/php/php-src/Zend/zend_alloc.c:1384 #1  0x083d436c in _zend_mm_free_int (heap=0x8919398, p=0xb7c09ed8, __zend_filename=0x87c02fc "/home/kuba/php/php-src/ext/gd/libgd/gd.c", __zend_lineno=242,     __zend_orig_filename=0x0, __zend_orig_lineno=0) at /home/kuba/php/php-src/Zend/zend_alloc.c:2068 #2  0x083d538d in _efree (ptr=0xb7c09ed8, __zend_filename=0x87c02fc "/home/kuba/php/php-src/ext/gd/libgd/gd.c", __zend_lineno=242, __zend_orig_filename=0x0, __zend_orig_lineno=0)     at /home/kuba/php/php-src/Zend/zend_alloc.c:2440 #3  0x081e0f31 in php_gd_gdImageDestroy (im=0xb7c08000) at /home/kuba/php/php-src/ext/gd/libgd/gd.c:242 #4  0x081d5bba in php_free_gd_image (rsrc=0xb7838038) at /home/kuba/php/php-src/ext/gd/gd.c:1077 #5  0x084140ab in list_entry_destructor (ptr=0xb7838038) at /home/kuba/php/php-src/Zend/zend_list.c:183 #6  0x08411419 in zend_hash_del_key_or_index (ht=0x8915c98 <executor_globals+344>, arKey=0x0, nKeyLength=0, h=5, flag=1) at /home/kuba/php/php-src/Zend/zend_hash.c:508 #7  0x08413d99 in _zend_list_delete (id=5) at /home/kuba/php/php-src/Zend/zend_list.c:57 #8  0x083ff6fb in _zval_dtor_func (zvalue=0xb7c07fc0, __zend_filename=0x887972c "/home/kuba/php/php-src/Zend/zend_execute.h", __zend_lineno=79)     at /home/kuba/php/php-src/Zend/zend_variables.c:62 #9  0x083ef20a in _zval_dtor (zvalue=0xb7c07fc0, __zend_filename=0x887972c "/home/kuba/php/php-src/Zend/zend_execute.h", __zend_lineno=79)     at /home/kuba/php/php-src/Zend/zend_variables.h:35 #10 0x083ef2b7 in i_zval_ptr_dtor (zval_ptr=0xb7c07fc0, __zend_filename=0x887ab6c "/home/kuba/php/php-src/Zend/zend_variables.c", __zend_lineno=182)     at /home/kuba/php/php-src/Zend/zend_execute.h:79 #11 0x083effd2 in _zval_ptr_dtor (zval_ptr=0xb7c05798, __zend_filename=0x887ab6c "/home/kuba/php/php-src/Zend/zend_variables.c", __zend_lineno=182)     at /home/kuba/php/php-src/Zend/zend_execute_API.c:427 #12 0x083ffa56 in _zval_ptr_dtor_wrapper (zval_ptr=0xb7c05798) at /home/kuba/php/php-src/Zend/zend_variables.c:182 #13 0x084118c0 in zend_hash_apply_deleter (ht=0x8915bfc <executor_globals+188>, p=0xb7c0578c) at /home/kuba/php/php-src/Zend/zend_hash.c:626 #14 0x08411a4e in zend_hash_graceful_reverse_destroy (ht=0x8915bfc <executor_globals+188>) at /home/kuba/php/php-src/Zend/zend_hash.c:663 #15 0x083efa97 in shutdown_executor () at /home/kuba/php/php-src/Zend/zend_execute_API.c:247 #16 0x08401781 in zend_deactivate () at /home/kuba/php/php-src/Zend/zend.c:953 #17 0x08384405 in php_request_shutdown (dummy=0x0) at /home/kuba/php/php-src/main/main.c:1807 #18 0x0849ddac in do_cli (argc=2, argv=0x89191e0) at /home/kuba/php/php-src/sapi/cli/php_cli.c:1177 #19 0x0849e3fb in main (argc=2, argv=0x89191e0) at /home/kuba/php/php-src/sapi/cli/php_cli.c:1378    ``` Patches[libgd-v2.patch](patch-display.php?bug_id=66356&patch=libgd-v2.patch&revision=latest) (last revision 2013-12-28 08:13 UTC by remi@php.net) [libgd-v1.patch](patch-display.php?bug_id=66356&patch=libgd-v1.patch&revision=latest) (last revision 2013-12-28 08:13 UTC by remi@php.net) [bug66356.patch](patch-display.php?bug_id=66356&patch=bug66356.patch&revision=latest) (last revision 2013-12-28 05:34 UTC by laruence@php.net) Pull RequestsHistoryAllCommentsChangesGit/SVN commitsRelated reports  **[2013-12-27 05:39 UTC] [laruence@php.net](//people.php.net/laruence)** -Assigned To: +Assigned To: pierre **[2013-12-27 05:51 UTC] [pajoye@php.net](//people.php.net/pajoye)** ``` Thanks for the detailed report!  As far as I remember it is fixed upstream (see Bitbucket repo).   I cannot read the patch yet but if not already fixed upstream it should be done on two parts:  . type checks and conversions in php's binding . bound check in libgd  I can check it on the 6 of January when I am back online (with laptop :)  Thanks again for your report!  ``` **[2013-12-27 06:15 UTC] [laruence@php.net](//people.php.net/laruence)** -Status: Assigned +Status: Closed -Assigned To: pierre +Assigned To: laruence **[2013-12-27 06:15 UTC] [laruence@php.net](//people.php.net/laruence)** ``` The fix for this bug has been committed.  Snapshots of the sources are packaged every three hours; this change will be in the next snapshot. You can grab the snapshot at <http://snaps.php.net/>.   For Windows:  <http://windows.php.net/snapshots/>   Thank you for the report, and for helping us make PHP better.  fixed in <https://github.com/php/php-src/commit/2938329ce19cb8c4197dec146c3ec887c6f61d01>  ``` **[2013-12-27 06:17 UTC] [laruence@php.net](//people.php.net/laruence)** -Assigned To: laruence +Assigned To: pajoye **[2013-12-27 06:17 UTC] [laruence@php.net](//people.php.net/laruence)** ``` pierre, sorry I didn't read your comment...  I get a fix and committed. there are also one issue, that is , the arguments could be modified.. I fixed it in the mean time..   could you please review the commit?  thanks  ``` **[2013-12-27 11:17 UTC] kuba dot brecka at gmail dot com** ``` The fix at <https://github.com/php/php-src/commit/2938329ce19cb8c4197dec146c3ec887c6f61d01> only fixes the first POC I submitted. All the others, including the POC for heap overflow, still produce a crash.  ``` **[2013-12-27 19:58 UTC] [stas@php.net](//people.php.net/stas)** -Status: Closed +Status: Re-Opened **[2013-12-28 04:46 UTC] [laruence@php.net](//people.php.net/laruence)** ``` where is the patch you mentioned? thanks :)  ``` **[2013-12-28 05:34 UTC] [laruence@php.net](//people.php.net/laruence)** ``` The following patch has been added/updated:  Patch Name: bug66356.patch Revision:   1388208897 URL:        <https://bugs.php.net/patch-display.php?bug=66356&patch=bug66356.patch&revision=1388208897>  ``` **[2013-12-28 05:35 UTC] [laruence@php.net](//people.php.net/laruence)** ``` I attached a patch for fixing rest POCs.  but I am not sure(not familiar with gd lib), whether we should also check if   dst->x + dst->width > src->sx?  thanks  ``` **[2013-12-28 07:27 UTC] [remi@php.net](//people.php.net/remi)** ``` Notice: libgd 2.1 is not affected by this issue.  gdImageCrop now use gdImageCopy which is protected by the use of gdImageBoundsSafeMacro.  Tested with php 5.5.7 + system libgd 2.1.0, all POC pass without any segfault.  ``` **[2013-12-28 08:13 UTC] [remi@php.net](//people.php.net/remi)** ``` The following patch has been added/updated:  Patch Name: libgd-v1.patch Revision:   1388218399 URL:        <https://bugs.php.net/patch-display.php?bug=66356&patch=libgd-v1.patch&revision=1388218399>  ``` **[2013-12-28 08:13 UTC] [remi@php.net](//people.php.net/remi)** ``` The following patch has been added/updated:  Patch Name: libgd-v2.patch Revision:   1388218414 URL:        <https://bugs.php.net/patch-display.php?bug=66356&patch=libgd-v2.patch&revision=1388218414>  ``` **[2013-12-28 08:20 UTC] [remi@php.net](//people.php.net/remi)** ``` 2 patches proposal (tested on php 5.5)  v1: position out of src image will return NULL.  v2: position out of the src image, will return a blank image, which is consistent with current size check: As the size check is done "after" image allocation, so, result image could be partially blank, but always of requested size.  We could also think of moving size check "before" allocation, but this will be a  BC break.  New size check seems better (even if the test is not really readable) and should be integer overflow free.  For PHP 5.6, I will prefer to see bundled libgd updated to upstream version 2.1.x  ``` **[2013-12-28 09:45 UTC] [pajoye@php.net](//people.php.net/pajoye)** ``` @remi Please sync with gd 2.1.x tree isntead, there are all bug fixes in it and no new features.  ``` **[2013-12-28 13:31 UTC] [remi@php.net](//people.php.net/remi)** -Status: Re-Opened +Status: Closed **[2013-12-28 13:31 UTC] [remi@php.net](//people.php.net/remi)** ``` The fix for this bug has been committed.  Snapshots of the sources are packaged every three hours; this change will be in the next snapshot. You can grab the snapshot at <http://snaps.php.net/>.   For Windows:  <http://windows.php.net/snapshots/>   Thank you for the report, and for helping us make PHP better.  See <http://git.php.net/?p=php-src.git;a=commitdiff;h=8f4a5373bb71590352fd934028d6dde5bc18530b>  ``` **[2013-12-28 13:33 UTC] [remi@php.net](//people.php.net/remi)** ``` @laruence, I think it could make sense to apply your check in the PHP side...  ``` **[2013-12-28 21:07 UTC] kuba dot brecka at gmail dot com** ``` Please use CVE-2013-7226 for this issue.  ``` **[2014-02-12 16:40 UTC] [remi@php.net](//people.php.net/remi)** -Type: Security +Type: Bug **[2014-02-12 16:40 UTC] [remi@php.net](//people.php.net/remi)** ``` Drop the security type as 5.5.9 is now released.  ``` **[2014-02-12 16:52 UTC] [remi@php.net](//people.php.net/remi)** -Type: Bug +Type: Security **[2014-02-15 17:28 UTC] [tyrael@php.net](//people.php.net/tyrael)** -CVE-ID: +CVE-ID: 2013-7226 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

|  | |
| --- | --- |
| [PHP](https://php.net/) [Copyright © 2001-2025 The PHP Group](https://php.net/copyright.php) All rights reserved. | Last updated: Fri Jan 24 11:01:29 2025 UTC |



=== Content from github.com_b7b68a00_20250124_115726.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F2938329ce19cb8c4197dec146c3ec887c6f61d01)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F2938329ce19cb8c4197dec146c3ec887c6f61d01)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=php%2Fphp-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[php](/php)
/
**[php-src](/php/php-src)**
Public

* [Notifications](/login?return_to=%2Fphp%2Fphp-src) You must be signed in to change notification settings
* [Fork
  7.8k](/login?return_to=%2Fphp%2Fphp-src)
* [Star
   38.5k](/login?return_to=%2Fphp%2Fphp-src)

* [Code](/php/php-src)
* [Issues
  746](/php/php-src/issues)
* [Pull requests
  562](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

Additional navigation options

* [Code](/php/php-src)
* [Issues](/php/php-src/issues)
* [Pull requests](/php/php-src/pulls)
* [Actions](/php/php-src/actions)
* [Security](/php/php-src/security)
* [Insights](/php/php-src/pulse)

## Commit

[Permalink](/php/php-src/commit/2938329ce19cb8c4197dec146c3ec887c6f61d01)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed bug #66356 (Heap Overflow Vulnerability in imagecrop())

[Browse files](/php/php-src/tree/2938329ce19cb8c4197dec146c3ec887c6f61d01)
Browse the repository at this point in the history

```
And also fixed the bug: arguments are altered after some calls
```

* Loading branch information

[![@laruence](https://avatars.githubusercontent.com/u/382813?s=40&v=4)](/laruence)

[laruence](/php/php-src/commits?author=laruence "View all commits by laruence")
committed
Dec 27, 2013

1 parent
[6414fe2](/php/php-src/commit/6414fe283e3931d87416a155f4cfbaaf5ffca1ad)

commit 2938329

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**173 additions**
and
**37 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* NEWS
  [NEWS](#diff-7ee66c4f1536ac84dc5bbff1b8312e2eef24b974b3e48a5c5c2bcfdf2eb8f3ce)
* ext/gd

  + ext/gd/gd.c
    [gd.c](#diff-00d1efef2247b288c86a6c3bfefac111a4774fbc5453fdc02dcf36c4a23da283)
  + tests

    - ext/gd/tests/bug66356.phpt
      [bug66356.phpt](#diff-8075f453a94ec05a64bdcabce051995b9e699ec5827ce8f281d8ff7895a03376)
* main

  + main/php\_version.h
    [php\_version.h](#diff-3933ca1aa7bba245792444585d9606e787efdf65fa83e8d5b2be6df2b4a83346)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[NEWS](#diff-7ee66c4f1536ac84dc5bbff1b8312e2eef24b974b3e48a5c5c2bcfdf2eb8f3ce "NEWS")

Show comments

[View file](/php/php-src/blob/2938329ce19cb8c4197dec146c3ec887c6f61d01/NEWS)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -29,6 +29,7 @@ PHP NEWS |
|  |  | . Fixed bug #66229 (128.0.0.0/16 isn't reserved any longer). (Adam) |
|  |  |  |
|  |  | - GD: |
|  |  | . Fixed bug #66356 (Heap Overflow Vulnerability in imagecrop()). (Laruence) |
|  |  | . Fixed bug #64405 (Use freetype-config for determining freetype2 dir(s)). |
|  |  | (Adam) |
|  |  |  |
| Expand Down | |  |

181 changes: 147 additions & 34 deletions

181
[ext/gd/gd.c](#diff-00d1efef2247b288c86a6c3bfefac111a4774fbc5453fdc02dcf36c4a23da283 "ext/gd/gd.c")

Show comments

[View file](/php/php-src/blob/2938329ce19cb8c4197dec146c3ec887c6f61d01/ext/gd/gd.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1538,9 +1538,15 @@ PHP\_FUNCTION(imagesetstyle) |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | convert\_to\_long\_ex(item); |
|  |  |  |
|  |  | stylearr[index++] = Z\_LVAL\_PP(item); |
|  |  | if (Z\_TYPE\_PP(item) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*item; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | stylearr[index++] = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | stylearr[index++] = Z\_LVAL\_PP(item); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | gdImageSetStyle(im, stylearr, index); |
| Expand Down  Expand Up | | @@ -3346,14 +3352,26 @@ static void php\_imagepolygon(INTERNAL\_FUNCTION\_PARAMETERS, int filled) |
|  |  |  |
|  |  | for (i = 0; i < npoints; i++) { |
|  |  | if (zend\_hash\_index\_find(Z\_ARRVAL\_P(POINTS), (i \* 2), (void \*\*) &var) == SUCCESS) { |
|  |  | SEPARATE\_ZVAL((var)); |
|  |  | convert\_to\_long(\*var); |
|  |  | points[i].x = Z\_LVAL\_PP(var); |
|  |  | if (Z\_TYPE\_PP(var) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*var; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | points[i].x = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | points[i].x = Z\_LVAL\_PP(var); |
|  |  | } |
|  |  | } |
|  |  | if (zend\_hash\_index\_find(Z\_ARRVAL\_P(POINTS), (i \* 2) + 1, (void \*\*) &var) == SUCCESS) { |
|  |  | SEPARATE\_ZVAL(var); |
|  |  | convert\_to\_long(\*var); |
|  |  | points[i].y = Z\_LVAL\_PP(var); |
|  |  | if (Z\_TYPE\_PP(var) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*var; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | points[i].y = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | points[i].y = Z\_LVAL\_PP(var); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -4859,9 +4877,15 @@ PHP\_FUNCTION(imageconvolution) |
|  |  |  |
|  |  | for (j=0; j<3; j++) { |
|  |  | if (zend\_hash\_index\_find(Z\_ARRVAL\_PP(var), (j), (void \*\*) &var2) == SUCCESS) { |
|  |  | SEPARATE\_ZVAL(var2); |
|  |  | convert\_to\_double(\*var2); |
|  |  | matrix[i][j] = (float)Z\_DVAL\_PP(var2); |
|  |  | if (Z\_TYPE\_PP(var2) != IS\_DOUBLE) { |
|  |  | zval dval; |
|  |  | dval = \*\*var; |
|  |  | zval\_copy\_ctor(&dval); |
|  |  | convert\_to\_double(&dval); |
|  |  | matrix[i][j] = (float)Z\_DVAL(dval); |
|  |  | } else { |
|  |  | matrix[i][j] = (float)Z\_DVAL\_PP(var2); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "You must have a 3x3 matrix"); |
|  |  | RETURN\_FALSE; |
| Expand Down  Expand Up | | @@ -4954,28 +4978,60 @@ PHP\_FUNCTION(imagecrop) |
|  |  | ZEND\_FETCH\_RESOURCE(im, gdImagePtr, &IM, -1, "Image", le\_gd); |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "x", sizeof("x"), (void \*\*)&tmp) != FAILURE) { |
|  |  | rect.x = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.x = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.x = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing x position"); |
|  |  | RETURN\_FALSE; |
|  |  | } |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "y", sizeof("x"), (void \*\*)&tmp) != FAILURE) { |
|  |  | rect.y = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.y = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.y = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing y position"); |
|  |  | RETURN\_FALSE; |
|  |  | } |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "width", sizeof("width"), (void \*\*)&tmp) != FAILURE) { |
|  |  | rect.width = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.width = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.width = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing width"); |
|  |  | RETURN\_FALSE; |
|  |  | } |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "height", sizeof("height"), (void \*\*)&tmp) != FAILURE) { |
|  |  | rect.height = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.height = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.height = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing height"); |
|  |  | RETURN\_FALSE; |
| Expand Down  Expand Up | | @@ -5124,8 +5180,13 @@ PHP\_FUNCTION(imageaffine) |
|  |  | affine[i] = Z\_DVAL\_PP(zval\_affine\_elem); |
|  |  | break; |
|  |  | case IS\_STRING: |
|  |  | convert\_to\_double\_ex(zval\_affine\_elem); |
|  |  | affine[i] = Z\_DVAL\_PP(zval\_affine\_elem); |
|  |  | { |
|  |  | zval dval; |
|  |  | dval = \*\*zval\_affine\_elem; |
|  |  | zval\_copy\_ctor(&dval); |
|  |  | convert\_to\_double(&dval); |
|  |  | affine[i] = Z\_DVAL(dval); |
|  |  | } |
|  |  | break; |
|  |  | default: |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Invalid type for element %i", i); |
| Expand All | | @@ -5136,32 +5197,60 @@ PHP\_FUNCTION(imageaffine) |
|  |  |  |
|  |  | if (z\_rect != NULL) { |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "x", sizeof("x"), (void \*\*)&tmp) != FAILURE) { |
|  |  | convert\_to\_long\_ex(tmp); |
|  |  | rect.x = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.x = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.x = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing x position"); |
|  |  | RETURN\_FALSE; |
|  |  | } |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "y", sizeof("x"), (void \*\*)&tmp) != FAILURE) { |
|  |  | convert\_to\_long\_ex(tmp); |
|  |  | rect.y = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.y = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.y = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing y position"); |
|  |  | RETURN\_FALSE; |
|  |  | } |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "width", sizeof("width"), (void \*\*)&tmp) != FAILURE) { |
|  |  | convert\_to\_long\_ex(tmp); |
|  |  | rect.width = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.width = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.width = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing width"); |
|  |  | RETURN\_FALSE; |
|  |  | } |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(z\_rect), "height", sizeof("height"), (void \*\*)&tmp) != FAILURE) { |
|  |  | convert\_to\_long\_ex(tmp); |
|  |  | rect.height = Z\_LVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_LONG) { |
|  |  | zval lval; |
|  |  | lval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&lval); |
|  |  | convert\_to\_long(&lval); |
|  |  | rect.height = Z\_LVAL(lval); |
|  |  | } else { |
|  |  | rect.height = Z\_LVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing height"); |
|  |  | RETURN\_FALSE; |
| Expand Down  Expand Up | | @@ -5211,16 +5300,30 @@ PHP\_FUNCTION(imageaffinematrixget) |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Array expected as options"); |
|  |  | } |
|  |  | if (zend\_hash\_find(HASH\_OF(options), "x", sizeof("x"), (void \*\*)&tmp) != FAILURE) { |
|  |  | convert\_to\_double\_ex(tmp); |
|  |  | x = Z\_DVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_DOUBLE) { |
|  |  | zval dval; |
|  |  | dval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&dval); |
|  |  | convert\_to\_double(&dval); |
|  |  | x = Z\_DVAL(dval); |
|  |  | } else { |
|  |  | x = Z\_DVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing x position"); |
|  |  | RETURN\_FALSE; |
|  |  | } |
|  |  |  |
|  |  | if (zend\_hash\_find(HASH\_OF(options), "y", sizeof("y"), (void \*\*)&tmp) != FAILURE) { |
|  |  | convert\_to\_double\_ex(tmp); |
|  |  | y = Z\_DVAL\_PP(tmp); |
|  |  | if (Z\_TYPE\_PP(tmp) != IS\_DOUBLE) { |
|  |  | zval dval; |
|  |  | dval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&dval); |
|  |  | convert\_to\_double(&dval); |
|  |  | y = Z\_DVAL(dval); |
|  |  | } else { |
|  |  | y = Z\_DVAL\_PP(tmp); |
|  |  | } |
|  |  | } else { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Missing y position"); |
|  |  | RETURN\_FALSE; |
| Expand Down  Expand Up | | @@ -5300,8 +5403,13 @@ PHP\_FUNCTION(imageaffinematrixconcat) |
|  |  | m1[i] = Z\_DVAL\_PP(tmp); |
|  |  | break; |
|  |  | case IS\_STRING: |
|  |  | convert\_to\_double\_ex(tmp); |
|  |  | m1[i] = Z\_DVAL\_PP(tmp); |
|  |  | { |
|  |  | zval dval; |
|  |  | dval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&dval); |
|  |  | convert\_to\_double(&dval); |
|  |  | m1[i] = Z\_DVAL(dval); |
|  |  | } |
|  |  | break; |
|  |  | default: |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Invalid type for element %i", i); |
| Expand All | | @@ -5317,8 +5425,13 @@ PHP\_FUNCTION(imageaffinematrixconcat) |
|  |  | m2[i] = Z\_DVAL\_PP(tmp); |
|  |  | break; |
|  |  | case IS\_STRING: |
|  |  | convert\_to\_double\_ex(tmp); |
|  |  | m2[i] = Z\_DVAL\_PP(tmp); |
|  |  | { |
|  |  | zval dval; |
|  |  | dval = \*\*tmp; |
|  |  | zval\_copy\_ctor(&dval); |
|  |  | convert\_to\_double(&dval); |
|  |  | m2[i] = Z\_DVAL(dval); |
|  |  | } |
|  |  | break; |
|  |  | default: |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_WARNING, "Invalid type for element %i", i); |
| Expand Down | |  |

22 changes: 22 additions & 0 deletions

22
[ext/gd/tests/bug66356.phpt](#diff-8075f453a94ec05a64bdcabce051995b9e699ec5827ce8f281d8ff7895a03376 "ext/gd/tests/bug66356.phpt")

Show comments

[View file](/php/php-src/blob/2938329ce19cb8c4197dec146c3ec887c6f61d01/ext/gd/tests/bug66356.phpt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,22 @@ |
|  |  | --TEST-- |
|  |  | Bug #66356 (Heap Overflow Vulnerability in imagecrop()) |
|  |  | --SKIPIF-- |
|  |  | <?php |
|  |  | if(!extension\_loaded('gd')){ die('skip gd extension not available'); } |
|  |  | ?> |
|  |  | --FILE-- |
|  |  | <?php |
|  |  | $img = imagecreatetruecolor(10, 10); |
|  |  | $img = imagecrop($img, array("x" => "a", "y" => 0, "width" => 10, "height" => 10)); |
|  |  | $arr = array("x" => "a", "y" => "12b", "width" => 10, "height" => 10); |
|  |  | $img = imagecrop($img, $arr); |
|  |  | print\_r($arr); |
|  |  | ?> |
|  |  | --EXPECTF-- |
|  |  | Array |
|  |  | ( |
|  |  | [x] => a |
|  |  | [y] => 12b |
|  |  | [width] => 10 |
|  |  | [height] => 10 |
|  |  | ) |

6 changes: 3 additions & 3 deletions

6
[main/php\_version.h](#diff-3933ca1aa7bba245792444585d9606e787efdf65fa83e8d5b2be6df2b4a83346 "main/php_version.h")

Show comments

[View file](/php/php-src/blob/2938329ce19cb8c4197dec146c3ec887c6f61d01/main/php_version.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,7 +2,7 @@ |
|  |  | /\* edit configure.in to change version number \*/ |
|  |  | #define PHP\_MAJOR\_VERSION 5 |
|  |  | #define PHP\_MINOR\_VERSION 5 |
|  |  | #define PHP\_RELEASE\_VERSION 8 |
|  |  | #define PHP\_RELEASE\_VERSION 5 |
|  |  | #define PHP\_EXTRA\_VERSION "-dev" |
|  |  | #define PHP\_VERSION "5.5.8-dev" |
|  |  | #define PHP\_VERSION\_ID 50508 |
|  |  | #define PHP\_VERSION "5.5.5-dev" |
|  |  | #define PHP\_VERSION\_ID 50505 |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2938329`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fphp%2Fphp-src%2Fcommit%2F2938329ce19cb8c4197dec146c3ec887c6f61d01) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from lists.ubuntu.com_be8ed54b_20250126_005709.html ===


| **ubuntu-hardened -- Ubuntu security discussion** | |
| --- | --- |
|  | |
| **About ubuntu-hardened** | English (USA)   Chinese (Taiwan) |
| Discussion on Ubuntu security updates, development of new security technologies, and general "hardening" of the operating system.  A place to talk about MAC systems (SELinux, AppArmor, Smack) in Ubuntu, about both kernel-level and user-land security improvements and technologies, etc.  To see the collection of prior postings to the list, visit the [ubuntu-hardened Archives](https://lists.ubuntu.com/archives/ubuntu-hardened). | |
| **Using ubuntu-hardened** | |
| To post a message to all the list members, send email to ubuntu-hardened@lists.ubuntu.com. You can subscribe to the list, or change your existing subscription, in the sections below. | |
| **Subscribing to ubuntu-hardened** | |
| Subscribe to ubuntu-hardened by filling out the following form. You will be sent email requesting confirmation, to prevent others from gratuitously subscribing you. This is a hidden list, which means that the list of members is available only to the list administrator.    | Your email address: |  |  | | --- | --- | --- | | Your name (optional): |  |  | | You may enter a privacy password below. This provides only mild security, but should prevent others from messing with your subscription. **Do not use a valuable password** as it will occasionally be emailed back to you in cleartext. If you choose not to enter a password, one will be automatically generated for you, and it will be sent to you once you've confirmed your subscription. You can always request a mail-back of your password when you edit your personal options. | | | | Pick a password: |  |  | | Reenter password to confirm: |  |  | | Which language do you prefer to display your messages? | English (USA)   Chinese (Taiwan) |  | | Would you like to receive list mail batched in a daily digest? | No  Yes | |  | | | | |

| **ubuntu-hardened Subscribers** | |
| (*The subscribers list is only available to the list administrator.*) Enter your admin address and password to visit the subscribers list: Admin address: Password:  To unsubscribe from ubuntu-hardened, get a password reminder, or change your subscription options enter your subscription email address: If you leave the field blank, you will be prompted for your email address | |

---

[ubuntu-hardened](../listinfo/ubuntu-hardened) list run by jamie at ubuntu.com, mdeslaur at ubuntu.com, sbeattie at ubuntu.com, alex.murray at canonical.com
[ubuntu-hardened administrative interface](../admin/ubuntu-hardened) (requires authorization)
[Overview of all lists.ubuntu.com mailing lists](../listinfo)

| [Delivered by Mailmanversion 2.1.20](http://www.gnu.org/software/mailman/index.html) | [Python Powered](http://www.python.org/) | [GNU's Not Unix](http://www.gnu.org/) | [Debian Powered](http://www.debian.org/) |
| --- | --- | --- | --- |

[![](http://tuxedo-es.org/images/hardened_debian.png)](http://www.debian-hardened.org)


