=== Content from www.kernel.org_2b8e4382_20250125_003735.html ===
commit a91990493d107dfa6b21ae3f28665b5ea8987dac
Author: Greg Kroah-Hartman
Date: Fri Jan 6 14:19:58 2012 -0800
Linux 3.1.8
commit 3cd9332f9e8fc79020b34c3f8cfb1a1a5f8a9bf4
Author: Mohammed Shafi Shajakhan
Date: Mon Dec 26 10:42:15 2011 +0530
ath9k: Fix kernel panic in AR2427 in AP mode
commit b25bfda38236f349cde0d1b28952f4eea2148d3f upstream.
don't do aggregation related stuff for 'AP mode client power save
handling' if aggregation is not enabled in the driver, otherwise it
will lead to panic because those data structures won't be never
intialized in 'ath\_tx\_node\_init' if aggregation is disabled
EIP is at ath\_tx\_aggr\_wakeup+0x37/0x80 [ath9k]
EAX: e8c09a20 EBX: f2a304e8 ECX: 00000001 EDX: 00000000
ESI: e8c085e0 EDI: f2a304ac EBP: f40e1ca4 ESP: f40e1c8c
DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068
Process swapper/1 (pid: 0, ti=f40e0000 task=f408e860
task.ti=f40dc000)
Stack:
0001e966 e8c09a20 00000000 f2a304ac e8c085e0 f2a304ac
f40e1cb0 f8186741
f8186700 f40e1d2c f922988d f2a304ac 00000202 00000001
c0b4ba43 00000000
0000000f e8eb75c0 e8c085e0 205b0001 34383220 f2a304ac
f2a30000 00010020
Call Trace:
[] ath9k\_sta\_notify+0x41/0x50 [ath9k]
[] ? ath9k\_get\_survey+0x110/0x110 [ath9k]
[] ieee80211\_sta\_ps\_deliver\_wakeup+0x9d/0x350
[mac80211]
[] ? \_\_module\_address+0x95/0xb0
[] ap\_sta\_ps\_end+0x63/0xa0 [mac80211]
[] ieee80211\_rx\_h\_sta\_process+0x156/0x2b0
[mac80211]
[] ieee80211\_rx\_handlers+0xce/0x510 [mac80211]
[] ? trace\_hardirqs\_on+0xb/0x10
[] ? skb\_queue\_tail+0x3e/0x50
[] ieee80211\_prepare\_and\_rx\_handle+0x111/0x750
[mac80211]
[] ieee80211\_rx+0x349/0xb20 [mac80211]
[] ? ieee80211\_rx+0x99/0xb20 [mac80211]
[] ath\_rx\_tasklet+0x818/0x1d00 [ath9k]
[] ? ath9k\_tasklet+0x35/0x1c0 [ath9k]
[] ? ath9k\_tasklet+0x35/0x1c0 [ath9k]
[] ath9k\_tasklet+0xf3/0x1c0 [ath9k]
[] tasklet\_action+0xbe/0x180
Cc: Senthil Balasubramanian
Cc: Rajkumar Manoharan
Reported-by: Ashwin Mendonca
Tested-by: Ashwin Mendonca
Signed-off-by: Mohammed Shafi Shajakhan
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 2c60e18b07e8e08c7e3b6cc8288b0e04e18844f7
Author: Oleg Nesterov
Date: Wed Jan 4 17:29:20 2012 +0100
ptrace: ensure JOBCTL\_STOP\_SIGMASK is not zero after detach
commit 8a88951b5878dc475dcd841cefc767e36397d14e upstream.
This is the temporary simple fix for 3.2, we need more changes in this
area.
1. do\_signal\_stop() assumes that the running untraced thread in the
stopped thread group is not possible. This was our goal but it is
not yet achieved: a stopped-but-resumed tracee can clone the running
thread which can initiate another group-stop.
Remove WARN\_ON\_ONCE(!current->ptrace).
2. A new thread always starts with ->jobctl = 0. If it is auto-attached
and this group is stopped, \_\_ptrace\_unlink() sets JOBCTL\_STOP\_PENDING
but JOBCTL\_STOP\_SIGMASK part is zero, this triggers WANR\_ON(!signr)
in do\_jobctl\_trap() if another debugger attaches.
Change \_\_ptrace\_unlink() to set the artificial SIGSTOP for report.
Alternatively we could change ptrace\_init\_task() to copy signr from
current, but this means we can copy it for no reason and hide the
possible similar problems.
Acked-by: Tejun Heo
Signed-off-by: Oleg Nesterov
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 9e83ca1fcff0eee2ea7ef2508de95691a0cdeb0c
Author: Oleg Nesterov
Date: Wed Jan 4 17:29:02 2012 +0100
ptrace: partially fix the do\_wait(WEXITED) vs EXIT\_DEAD->EXIT\_ZOMBIE race
commit 50b8d257486a45cba7b65ca978986ed216bbcc10 upstream.
Test-case:
int main(void)
{
int pid, status;
pid = fork();
if (!pid) {
for (;;) {
if (!fork())
return 0;
if (waitpid(-1, &status, 0) < 0) {
printf("ERR!! wait: %m\n");
return 0;
}
}
}
assert(ptrace(PTRACE\_ATTACH, pid, 0,0) == 0);
assert(waitpid(-1, NULL, 0) == pid);
assert(ptrace(PTRACE\_SETOPTIONS, pid, 0,
PTRACE\_O\_TRACEFORK) == 0);
do {
ptrace(PTRACE\_CONT, pid, 0, 0);
pid = waitpid(-1, NULL, 0);
} while (pid > 0);
return 1;
}
It fails because ->real\_parent sees its child in EXIT\_DEAD state
while the tracer is going to change the state back to EXIT\_ZOMBIE
in wait\_task\_zombie().
The offending commit is 823b018e which moved the EXIT\_DEAD check,
but in fact we should not blame it. The original code was not
correct as well because it didn't take ptrace\_reparented() into
account and because we can't really trust ->ptrace.
This patch adds the additional check to close this particular
race but it doesn't solve the whole problem. We simply can't
rely on ->ptrace in this case, it can be cleared if the tracer
is multithreaded by the exiting ->parent.
I think we should kill EXIT\_DEAD altogether, we should always
remove the soon-to-be-reaped child from ->children or at least
we should never do the DEAD->ZOMBIE transition. But this is too
complex for 3.2.
Reported-and-tested-by: Denys Vlasenko
Tested-by: Lukasz Michalik
Acked-by: Tejun Heo
Signed-off-by: Oleg Nesterov
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f63f475a7edbe389ceb01cd430efb2d2a127eb6e
Author: Linus Torvalds
Date: Tue Jan 3 17:32:13 2012 -0800
Revert "rtc: Disable the alarm in the hardware"
commit 157e8bf8b4823bfcdefa6c1548002374b61f61df upstream.
This reverts commit c0afabd3d553c521e003779c127143ffde55a16f.
It causes failures on Toshiba laptops - instead of disabling the alarm,
it actually seems to enable it on the affected laptops, resulting in
(for example) the laptop powering on automatically five minutes after
shutdown.
There's a patch for it that appears to work for at least some people,
but it's too late to play around with this, so revert for now and try
again in the next merge window.
See for example
http://bugs.debian.org/652869
Reported-and-bisected-by: Andreas Friedrich  (Toshiba Tecra)
Reported-by: Antonio-M. Corbi Bellot  (Toshiba Portege R500)
Reported-by: Marco Santos  (Toshiba Portege Z830)
Reported-by: Christophe Vu-Brugier  (Toshiba Portege R830)
Cc: Jonathan Nieder
Requested-by: John Stultz
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 12ed227da1fb7099978c73b65a756caf51a95553
Author: Mandeep Singh Baines
Date: Tue Jan 3 14:41:13 2012 -0800
hung\_task: fix false positive during vfork
commit f9fab10bbd768b0e5254e53a4a8477a94bfc4b96 upstream.
vfork parent uninterruptibly and unkillably waits for its child to
exec/exit. This wait is of unbounded length. Ignore such waits
in the hung\_task detector.
Signed-off-by: Mandeep Singh Baines
Reported-by: Sasha Levin
LKML-Reference: <1325344394.28904.43.camel@lappy>
Cc: Linus Torvalds
Cc: Ingo Molnar
Cc: Peter Zijlstra
Cc: Andrew Morton
Cc: John Kacur
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit e5697e5158f562e3e7130e2880a5d0abea6cd4cd
Author: Alexander Müller
Date: Fri Dec 30 12:55:48 2011 -0500
drm/radeon/kms/atom: fix possible segfault in pm setup
commit 4376eee92e5a8332b470040e672ea99cd44c826a upstream.
If we end up with no power states, don't look up
current vddc.
fixes:
https://bugs.freedesktop.org/show\_bug.cgi?id=44130
agd5f: fix patch formatting
Signed-off-by: Alex Deucher
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit b7ef0c519dd78c3bbd2e9903675c2ec16e38831e
Author: Kyle Manna
Date: Thu Aug 11 22:33:13 2011 -0500
mfd: Turn on the twl4030-madc MADC clock
commit 3d6271f92e98094584fd1e609a9969cd33e61122 upstream.
Without turning the MADC clock on, no MADC conversions occur.
$ cat /sys/class/hwmon/hwmon0/device/in8\_input
[ 53.428436] twl4030\_madc twl4030\_madc: conversion timeout!
cat: read error: Resource temporarily unavailable
Signed-off-by: Kyle Manna
Signed-off-by: Samuel Ortiz
Signed-off-by: Greg Kroah-Hartman
commit d5700ae8cfc1b3243ca9f96f6dd0bbf95b05b5e6
Author: Emmanuel Grumbach
Date: Mon Dec 26 08:47:34 2011 +0200
iwlwifi: update SCD BC table for all SCD queues
commit 96f1f05af76b601ab21a7dc603ae0a1cea4efc3d upstream.
Since we configure all the queues as CHAINABLE, we need to update the
byte count for all the queues, not only the AGGREGATABLE ones.
Not doing so can confuse the SCD and make the fw assert.
Signed-off-by: Emmanuel Grumbach
Signed-off-by: Wey-Yi Guy
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit e3b22a8ecc595fd80bc3cd84d32e7d4ee7fe9ad8
Author: Stephen Rothwell
Date: Thu Dec 22 17:03:29 2011 +1100
ipv4: using prefetch requires including prefetch.h
[ Upstream commit b9eda06f80b0db61a73bd87c6b0eb67d8aca55ad ]
Signed-off-by: Stephen Rothwell
Acked-by: Eric Dumazet
Acked-by: David Miller
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 44f6d7e64fc76fe710b95afee4fee984c19d0e64
Author: Eric Dumazet
Date: Wed Dec 21 15:47:16 2011 -0500
ipv4: reintroduce route cache garbage collector
[ Upstream commit 9f28a2fc0bd77511f649c0a788c7bf9a5fd04edb ]
Commit 2c8cec5c10b (ipv4: Cache learned PMTU information in inetpeer)
removed IP route cache garbage collector a bit too soon, as this gc was
responsible for expired routes cleanup, releasing their neighbour
reference.
As pointed out by Robert Gladewitz, recent kernels can fill and exhaust
their neighbour cache.
Reintroduce the garbage collection, since we'll have to wait our
neighbour lookups become refcount-less to not depend on this stuff.
Reported-by: Robert Gladewitz
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d23270aae3214c26691f95922a63c70549232c22
Author: Eric Dumazet
Date: Thu Dec 22 04:15:53 2011 +0000
net: introduce DST\_NOPEER dst flag
[ Upstream commit e688a604807647c9450f9c12a7cb6d027150a895 ]
Chris Boot reported crashes occurring in ipv6\_select\_ident().
[ 461.457562] RIP: 0010:[] []
ipv6\_select\_ident+0x31/0xa7
[ 461.578229] Call Trace:
[ 461.580742]
[ 461.582870] [] ? udp6\_ufo\_fragment+0x124/0x1a2
[ 461.589054] [] ? ipv6\_gso\_segment+0xc0/0x155
[ 461.595140] [] ? skb\_gso\_segment+0x208/0x28b
[ 461.601198] [] ? ipv6\_confirm+0x146/0x15e
[nf\_conntrack\_ipv6]
[ 461.608786] [] ? nf\_iterate+0x41/0x77
[ 461.614227] [] ? dev\_hard\_start\_xmit+0x357/0x543
[ 461.620659] [] ? nf\_hook\_slow+0x73/0x111
[ 461.626440] [] ? br\_parse\_ip\_options+0x19a/0x19a
[bridge]
[ 461.633581] [] ? dev\_queue\_xmit+0x3af/0x459
[ 461.639577] [] ? br\_dev\_queue\_push\_xmit+0x72/0x76
[bridge]
[ 461.646887] [] ? br\_nf\_post\_routing+0x17d/0x18f
[bridge]
[ 461.653997] [] ? nf\_iterate+0x41/0x77
[ 461.659473] [] ? br\_flood+0xfa/0xfa [bridge]
[ 461.665485] [] ? nf\_hook\_slow+0x73/0x111
[ 461.671234] [] ? br\_flood+0xfa/0xfa [bridge]
[ 461.677299] [] ?
nf\_bridge\_update\_protocol+0x20/0x20 [bridge]
[ 461.684891] [] ? nf\_ct\_zone+0xa/0x17 [nf\_conntrack]
[ 461.691520] [] ? br\_flood+0xfa/0xfa [bridge]
[ 461.697572] [] ? NF\_HOOK.constprop.8+0x3c/0x56
[bridge]
[ 461.704616] [] ?
nf\_bridge\_push\_encap\_header+0x1c/0x26 [bridge]
[ 461.712329] [] ? br\_nf\_forward\_finish+0x8a/0x95
[bridge]
[ 461.719490] [] ?
nf\_bridge\_pull\_encap\_header+0x1c/0x27 [bridge]
[ 461.727223] [] ? br\_nf\_forward\_ip+0x1c0/0x1d4 [bridge]
[ 461.734292] [] ? nf\_iterate+0x41/0x77
[ 461.739758] [] ? \_\_br\_deliver+0xa0/0xa0 [bridge]
[ 461.746203] [] ? nf\_hook\_slow+0x73/0x111
[ 461.751950] [] ? \_\_br\_deliver+0xa0/0xa0 [bridge]
[ 461.758378] [] ? NF\_HOOK.constprop.4+0x56/0x56
[bridge]
This is caused by bridge netfilter special dst\_entry (fake\_rtable), a
special shared entry, where attaching an inetpeer makes no sense.
Problem is present since commit 87c48fa3b46 (ipv6: make fragment
identifications less predictable)
Introduce DST\_NOPEER dst flag and make sure ipv6\_select\_ident() and
\_\_ip\_select\_ident() fallback to the 'no peer attached' handling.
Reported-by: Chris Boot
Tested-by: Chris Boot
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ea67f1fb5976ad72d27e45dff42017894f30b563
Author: David S. Miller
Date: Tue Dec 13 17:35:06 2011 -0500
ipv6: Check dest prefix length on original route not copied one in rt6\_alloc\_cow().
[ Upstream commit bb3c36863e8001fc21a88bebfdead4da4c23e848 ]
After commit 8e2ec639173f325977818c45011ee176ef2b11f6 ("ipv6: don't
use inetpeer to store metrics for routes.") the test in rt6\_alloc\_cow()
for setting the ANYCAST flag is now wrong.
'rt' will always now have a plen of 128, because it is set explicitly
to 128 by ip6\_rt\_copy.
So to restore the semantics of the test, check the destination prefix
length of 'ort'.
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4e1a937bf13f758c7be089f614e7e84bdafcc0af
Author: Weiping Pan
Date: Thu Dec 1 15:47:06 2011 +0000
ipv4: flush route cache after change accept\_local
[ Upstream commit d01ff0a049f749e0bf10a35bb23edd012718c8c2 ]
After reset ipv4\_devconf->data[IPV4\_DEVCONF\_ACCEPT\_LOCAL] to 0,
we should flush route cache, or it will continue receive packets with local
source address, which should be dropped.
Signed-off-by: Weiping Pan
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 6561c4fa576a9e83f4e2faf7b62dbd1d9b598c39
Author: Steffen Klassert
Date: Wed Dec 21 16:48:08 2011 -0500
net: Add a flow\_cache\_flush\_deferred function
[ Upstream commit c0ed1c14a72ca9ebacd51fb94a8aca488b0d361e ]
flow\_cach\_flush() might sleep but can be called from
atomic context via the xfrm garbage collector. So add
a flow\_cache\_flush\_deferred() function and use this if
the xfrm garbage colector is invoked from within the
packet path.
Signed-off-by: Steffen Klassert
Acked-by: Timo Teräs
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit fd4199603bbc8851051b45299b7cf73b07b4daac
Author: Thomas Graf
Date: Mon Dec 19 04:11:40 2011 +0000
sctp: Do not account for sizeof(struct sk\_buff) in estimated rwnd
[ Upstream commit a76c0adf60f6ca5ff3481992e4ea0383776b24d2 ]
When checking whether a DATA chunk fits into the estimated rwnd a
full sizeof(struct sk\_buff) is added to the needed chunk size. This
quickly exhausts the available rwnd space and leads to packets being
sent which are much below the PMTU limit. This can lead to much worse
performance.
The reason for this behaviour was to avoid putting too much memory
pressure on the receiver. The concept is not completely irational
because a Linux receiver does in fact clone an skb for each DATA chunk
delivered. However, Linux also reserves half the available socket
buffer space for data structures therefore usage of it is already
accounted for.
When proposing to change this the last time it was noted that this
behaviour was introduced to solve a performance issue caused by rwnd
overusage in combination with small DATA chunks.
Trying to reproduce this I found that with the sk\_buff overhead removed,
the performance would improve significantly unless socket buffer limits
are increased.
The following numbers have been gathered using a patched iperf
supporting SCTP over a live 1 Gbit ethernet network. The -l option
was used to limit DATA chunk sizes. The numbers listed are based on
the average of 3 test runs each. Default values have been used for
sk\_(r|w)mem.
Chunk
Size Unpatched No Overhead
-------------------------------------
4 15.2 Kbit [!] 12.2 Mbit [!]
8 35.8 Kbit [!] 26.0 Mbit [!]
16 95.5 Kbit [!] 54.4 Mbit [!]
32 106.7 Mbit 102.3 Mbit
64 189.2 Mbit 188.3 Mbit
128 331.2 Mbit 334.8 Mbit
256 537.7 Mbit 536.0 Mbit
512 766.9 Mbit 766.6 Mbit
1024 810.1 Mbit 808.6 Mbit
Signed-off-by: Thomas Graf
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 74631fca684d7a475f1eed5f6823c11b62bbd2bc
Author: Xi Wang
Date: Fri Dec 16 12:44:15 2011 +0000
sctp: fix incorrect overflow check on autoclose
[ Upstream commit 2692ba61a82203404abd7dd2a027bda962861f74 ]
Commit 8ffd3208 voids the previous patches f6778aab and 810c0719 for
limiting the autoclose value. If userspace passes in -1 on 32-bit
platform, the overflow check didn't work and autoclose would be set
to 0xffffffff.
This patch defines a max\_autoclose (in seconds) for limiting the value
and exposes it through sysctl, with the following intentions.
1) Avoid overflowing autoclose \* HZ.
2) Keep the default autoclose bound consistent across 32- and 64-bit
platforms (INT\_MAX / HZ in this patch).
3) Keep the autoclose value consistent between setsockopt() and
getsockopt() calls.
Suggested-by: Vlad Yasevich
Signed-off-by: Xi Wang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 79a25778ca9fbc4ea2bd8c1f32d73bd73a1a3817
Author: Eric Dumazet
Date: Sun Dec 11 23:42:53 2011 +0000
sch\_gred: should not use GFP\_KERNEL while holding a spinlock
[ Upstream commit 3f1e6d3fd37bd4f25e5b19f1c7ca21850426c33f ]
gred\_change\_vq() is called under sch\_tree\_lock(sch).
This means a spinlock is held, and we are not allowed to sleep in this
context.
We might pre-allocate memory using GFP\_KERNEL before taking spinlock,
but this is not suitable for stable material.
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 77fe0b97b750a3064e67330b131811edeebbc29b
Author: Gerlando Falauto
Date: Mon Dec 19 22:58:04 2011 +0000
net: have ipconfig not wait if no dev is available
[ Upstream commit cd7816d14953c8af910af5bb92f488b0b277e29d ]
previous commit 3fb72f1e6e6165c5f495e8dc11c5bbd14c73385c
makes IP-Config wait for carrier on at least one network device.
Before waiting (predefined value 120s), check that at least one device
was successfully brought up. Otherwise (e.g. buggy bootloader
which does not set the MAC address) there is no point in waiting
for carrier.
Cc: Micha Nelissen
Cc: Holger Brunck
Signed-off-by: Gerlando Falauto
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ad24a5287dd16619b31b9c30917615ab1fcb56b0
Author: Thomas Graf
Date: Thu Dec 22 02:05:07 2011 +0000
mqprio: Avoid panic if no options are provided
[ Upstream commit 7838f2ce36b6ab5c13ef20b1857e3bbd567f1759 ]
Userspace may not provide TCA\_OPTIONS, in fact tc currently does
so not do so if no arguments are specified on the command line.
Return EINVAL instead of panicing.
Signed-off-by: Thomas Graf
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 3515cb57df914810fc5c0cca5037e2ad3663c6ad
Author: Alex Juncu
Date: Thu Dec 15 23:01:25 2011 +0000
llc: llc\_cmsg\_rcv was getting called after sk\_eat\_skb.
[ Upstream commit 9cef310fcdee12b49b8b4c96fd8f611c8873d284 ]
Received non stream protocol packets were calling llc\_cmsg\_rcv that used a
skb after that skb was released by sk\_eat\_skb. This caused received STP
packets to generate kernel panics.
Signed-off-by: Alexandru Juncu
Signed-off-by: Kunjan Naik
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9bf78b2e47083ebf3363c7017cbcda8bb9ceb30b
Author: Djalal Harouni
Date: Tue Dec 6 15:47:12 2011 +0000
ppp: fix pptp double release\_sock in pptp\_bind()
[ Upstream commit a454daceb78844a09c08b6e2d8badcb76a5d73b9 ]
Signed-off-by: Djalal Harouni
Acked-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b8b7320109c5fc492688d63fc3089fd0868a0aa1
Author: Markus Kötter
Date: Sat Dec 17 11:39:08 2011 +0000
net: bpf\_jit: fix an off-one bug in x86\_64 cond jump target
[ Upstream commit a03ffcf873fe0f2565386ca8ef832144c42e67fa ]
x86 jump instruction size is 2 or 5 bytes (near/long jump), not 2 or 6
bytes.
In case a conditional jump is followed by a long jump, conditional jump
target is one byte past the start of target instruction.
Signed-off-by: Markus Kötter
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 904bc58192c45c132938a97629578a954f26478d
Author: David S. Miller
Date: Mon Dec 26 12:30:13 2011 -0500
sparc: Fix handling of orig\_i0 wrt. debugging when restarting syscalls.
[ A combination of upstream commits 1d299bc7732c34d85bd43ac1a8745f5a2fed2078 and
e88d2468718b0789b4c33da2f7e1cef2a1eee279 ]
Although we provide a proper way for a debugger to control whether
syscall restart occurs, we run into problems because orig\_i0 is not
saved and restored properly.
Luckily we can solve this problem without having to make debuggers
aware of the issue. Across system calls, several registers are
considered volatile and can be safely clobbered.
Therefore we use the pt\_regs save area of one of those registers, %g6,
as a place to save and restore orig\_i0.
Debuggers transparently will do the right thing because they save and
restore this register already.
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d8e8670b16cd66ceb1ac5c42a0f784a657f069e3
Author: David S. Miller
Date: Mon Oct 31 01:05:49 2011 -0700
sparc64: Fix masking and shifting in VIS fpcmp emulation.
[ Upstream commit 2e8ecdc008a16b9a6c4b9628bb64d0d1c05f9f92 ]
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 382ae5b35768be56473c8e92d68e2f3c74bf1422
Author: David S. Miller
Date: Wed Oct 19 15:31:55 2011 -0700
sparc32: Correct the return value of memcpy.
[ Upstream commit a52312b88c8103e965979a79a07f6b34af82ca4b ]
Properly return the original destination buffer pointer.
Signed-off-by: David S. Miller
Tested-by: Kjetil Oftedal
Signed-off-by: Greg Kroah-Hartman
commit 1515c20b1bcb29e9d32fedaa7fc2af3bfea265cb
Author: David S. Miller
Date: Wed Oct 19 15:30:14 2011 -0700
sparc32: Remove uses of %g7 in memcpy implementation.
[ Upstream commit 21f74d361dfd6a7d0e47574e315f780d8172084a ]
This is setting things up so that we can correct the return
value, so that it properly returns the original destination
buffer pointer.
Signed-off-by: David S. Miller
Tested-by: Kjetil Oftedal
Signed-off-by: Greg Kroah-Hartman
commit 469c7a79eaa35d3b5dcc1e6c1468174aa96dd87f
Author: David S. Miller
Date: Wed Oct 19 15:15:58 2011 -0700
sparc32: Remove non-kernel code from memcpy implementation.
[ Upstream commit 045b7de9ca0cf09f1adc3efa467f668b89238390 ]
Signed-off-by: David S. Miller
Tested-by: Kjetil Oftedal
Signed-off-by: Greg Kroah-Hartman
commit 6817a588d5422f96a100466db56d11c33aa39ec4
Author: David S. Miller
Date: Thu Nov 17 18:17:59 2011 -0800
sparc: Kill custom io\_remap\_pfn\_range().
[ Upstream commit 3e37fd3153ac95088a74f5e7c569f7567e9f993a ]
To handle the large physical addresses, just make a simple wrapper
around remap\_pfn\_range() like MIPS does.
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 52459596488560825f22a9eb4c4afb3c0e2b3428
Author: David S. Miller
Date: Thu Nov 17 22:44:58 2011 -0800
sparc64: Patch sun4v code sequences properly on module load.
[ Upstream commit 0b64120cceb86e93cb1bda0dc055f13016646907 ]
Some of the sun4v code patching occurs in inline functions visible
to, and usable by, modules.
Therefore we have to patch them up during module load.
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 588195deba991fe368241abdc4f270d6d3792e7d
Author: David S. Miller
Date: Wed Dec 14 10:05:22 2011 -0800
sparc32: Be less strict in matching %lo part of relocation.
[ Upstream commit b1f44e13a525d2ffb7d5afe2273b7169d6f2222e ]
The "(insn & 0x01800000) != 0x01800000" test matches 'restore'
but that is a legitimate place to see the %lo() part of a 32-bit
symbol relocation, particularly in tail calls.
Signed-off-by: David S. Miller
Tested-by: Sergei Trofimovich
Signed-off-by: Greg Kroah-Hartman
commit 6c1c9cf6f1336fc332d2e1fc0453e2bc16a7089b
Author: David S. Miller
Date: Thu Dec 22 13:23:59 2011 -0800
sparc64: Fix MSIQ HV call ordering in pci\_sun4v\_msiq\_build\_irq().
[ Upstream commit 7cc8583372a21d98a23b703ad96cab03180b5030 ]
This silently was working for many years and stopped working on
Niagara-T3 machines.
We need to set the MSIQ to VALID before we can set it's state to IDLE.
On Niagara-T3, setting the state to IDLE first was causing HV\_EINVAL
errors. The hypervisor documentation says, rather ambiguously, that
the MSIQ must be "initialized" before one can set the state.
I previously understood this to mean merely that a successful setconf()
operation has been performed on the MSIQ, which we have done at this
point. But it seems to also mean that it has been set VALID too.
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit ec89dadb52f3dee5e49588613ad3bf66cf140141
Author: Nagalakshmi Nandigama
Date: Wed Jan 4 09:25:13 2012 -0600
mpt2sas: fix non-x86 crash on shutdown
Upstrem commit: 911ae9434f83e7355d343f6c2be3ef5b00ea7aed
There's a bug in the MSIX backup and restore routines that cause a crash on
non-x86 (direct access to PCI space not via read/write). These routines are
unnecessary and were removed by the above commit, so also remove them from
stable to fix the crash.
Signed-off-by: Nagalakshmi Nandigama
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 43dc85715b04c36ba118d6e63c96786c634e2eea
Author: KOSAKI Motohiro
Date: Wed Dec 28 15:57:11 2011 -0800
mm/mempolicy.c: refix mbind\_range() vma issue
commit e26a51148f3ebd859bca8bf2e0f212839b447f62 upstream.
commit 8aacc9f550 ("mm/mempolicy.c: fix pgoff in mbind vma merge") is the
slightly incorrect fix.
Why? Think following case.
1. map 4 pages of a file at offset 0
[0123]
2. map 2 pages just after the first mapping of the same file but with
page offset 2
[0123][23]
3. mbind() 2 pages from the first mapping at offset 2.
mbind\_range() should treat new vma is,
[0123][23]
|23|
mbind vma
but it does
[0123][23]
|01|
mbind vma
Oops. then, it makes wrong vma merge and splitting ([01][0123] or similar).
This patch fixes it.
[testcase]
test result - before the patch
case4: 126: test failed. expect '2,4', actual '2,2,2'
case5: passed
case6: passed
case7: passed
case8: passed
case\_n: 246: test failed. expect '4,2', actual '1,4'
------------[ cut here ]------------
kernel BUG at mm/filemap.c:135!
invalid opcode: 0000 [#4] SMP DEBUG\_PAGEALLOC
(snip long bug on messages)
test result - after the patch
case4: passed
case5: passed
case6: passed
case7: passed
case8: passed
case\_n: passed
source: mbind\_vma\_test.c
============================================================
#include
#include
#include
#include
#include
#include
#include
static unsigned long pagesize;
void\* mmap\_addr;
struct bitmask \*nmask;
char buf[1024];
FILE \*file;
char retbuf[10240] = "";
int mapped\_fd;
char \*rubysrc = "ruby -e '\
pid = %d; \
vstart = 0x%llx; \
vend = 0x%llx; \
s = `pmap -q #{pid}`; \
rary = []; \
s.each\_line {|line|; \
ary=line.split(\" \"); \
addr = ary[0].to\_i(16); \
if(vstart <= addr && addr < vend) then \
rary.push(ary[1].to\_i()/4); \
end; \
}; \
print rary.join(\",\"); \
'";
void init(void)
{
void\* addr;
char buf[128];
nmask = numa\_allocate\_nodemask();
numa\_bitmask\_setbit(nmask, 0);
pagesize = getpagesize();
sprintf(buf, "%s", "mbind\_vma\_XXXXXX");
mapped\_fd = mkstemp(buf);
if (mapped\_fd == -1)
perror("mkstemp "), exit(1);
unlink(buf);
if (lseek(mapped\_fd, pagesize\*8, SEEK\_SET) < 0)
perror("lseek "), exit(1);
if (write(mapped\_fd, "\0", 1) < 0)
perror("write "), exit(1);
addr = mmap(NULL, pagesize\*8, PROT\_NONE,
MAP\_SHARED, mapped\_fd, 0);
if (addr == MAP\_FAILED)
perror("mmap "), exit(1);
if (mprotect(addr+pagesize, pagesize\*6, PROT\_READ|PROT\_WRITE) < 0)
perror("mprotect "), exit(1);
mmap\_addr = addr + pagesize;
/\* make page populate \*/
memset(mmap\_addr, 0, pagesize\*6);
}
void fin(void)
{
void\* addr = mmap\_addr - pagesize;
munmap(addr, pagesize\*8);
memset(buf, 0, sizeof(buf));
memset(retbuf, 0, sizeof(retbuf));
}
void mem\_bind(int index, int len)
{
int err;
err = mbind(mmap\_addr+pagesize\*index, pagesize\*len,
MPOL\_BIND, nmask->maskp, nmask->size, 0);
if (err)
perror("mbind "), exit(err);
}
void mem\_interleave(int index, int len)
{
int err;
err = mbind(mmap\_addr+pagesize\*index, pagesize\*len,
MPOL\_INTERLEAVE, nmask->maskp, nmask->size, 0);
if (err)
perror("mbind "), exit(err);
}
void mem\_unbind(int index, int len)
{
int err;
err = mbind(mmap\_addr+pagesize\*index, pagesize\*len,
MPOL\_DEFAULT, NULL, 0, 0);
if (err)
perror("mbind "), exit(err);
}
void Assert(char \*expected, char \*value, char \*name, int line)
{
if (strcmp(expected, value) == 0) {
fprintf(stderr, "%s: passed\n", name);
return;
}
else {
fprintf(stderr, "%s: %d: test failed. expect '%s', actual '%s'\n",
name, line,
expected, value);
// exit(1);
}
}
/\*
AAAA
PPPPPPNNNNNN
might become
PPNNNNNNNNNN
case 4 below
\*/
void case4(void)
{
init();
sprintf(buf, rubysrc, getpid(), mmap\_addr, mmap\_addr+pagesize\*6);
mem\_bind(0, 4);
mem\_unbind(2, 2);
file = popen(buf, "r");
fread(retbuf, sizeof(retbuf), 1, file);
Assert("2,4", retbuf, "case4", \_\_LINE\_\_);
fin();
}
/\*
AAAA
PPPPPPNNNNNN
might become
PPPPPPPPPPNN
case 5 below
\*/
void case5(void)
{
init();
sprintf(buf, rubysrc, getpid(), mmap\_addr, mmap\_addr+pagesize\*6);
mem\_bind(0, 2);
mem\_bind(2, 2);
file = popen(buf, "r");
fread(retbuf, sizeof(retbuf), 1, file);
Assert("4,2", retbuf, "case5", \_\_LINE\_\_);
fin();
}
/\*
AAAA
PPPPNNNNXXXX
might become
PPPPPPPPPPPP 6
\*/
void case6(void)
{
init();
sprintf(buf, rubysrc, getpid(), mmap\_addr, mmap\_addr+pagesize\*6);
mem\_bind(0, 2);
mem\_bind(4, 2);
mem\_bind(2, 2);
file = popen(buf, "r");
fread(retbuf, sizeof(retbuf), 1, file);
Assert("6", retbuf, "case6", \_\_LINE\_\_);
fin();
}
/\*
AAAA
PPPPNNNNXXXX
might become
PPPPPPPPXXXX 7
\*/
void case7(void)
{
init();
sprintf(buf, rubysrc, getpid(), mmap\_addr, mmap\_addr+pagesize\*6);
mem\_bind(0, 2);
mem\_interleave(4, 2);
mem\_bind(2, 2);
file = popen(buf, "r");
fread(retbuf, sizeof(retbuf), 1, file);
Assert("4,2", retbuf, "case7", \_\_LINE\_\_);
fin();
}
/\*
AAAA
PPPPNNNNXXXX
might become
PPPPNNNNNNNN 8
\*/
void case8(void)
{
init();
sprintf(buf, rubysrc, getpid(), mmap\_addr, mmap\_addr+pagesize\*6);
mem\_bind(0, 2);
mem\_interleave(4, 2);
mem\_interleave(2, 2);
file = popen(buf, "r");
fread(retbuf, sizeof(retbuf), 1, file);
Assert("2,4", retbuf, "case8", \_\_LINE\_\_);
fin();
}
void case\_n(void)
{
init();
sprintf(buf, rubysrc, getpid(), mmap\_addr, mmap\_addr+pagesize\*6);
/\* make redundunt mappings [0][1234][34][7] \*/
mmap(mmap\_addr + pagesize\*4, pagesize\*2, PROT\_READ|PROT\_WRITE,
MAP\_FIXED|MAP\_SHARED, mapped\_fd, pagesize\*3);
/\* Expect to do nothing. \*/
mem\_unbind(2, 2);
file = popen(buf, "r");
fread(retbuf, sizeof(retbuf), 1, file);
Assert("4,2", retbuf, "case\_n", \_\_LINE\_\_);
fin();
}
int main(int argc, char\*\* argv)
{
case4();
case5();
case6();
case7();
case8();
case\_n();
return 0;
}
=============================================================
Signed-off-by: KOSAKI Motohiro
Acked-by: Johannes Weiner
Cc: Minchan Kim
Cc: Caspar Zhang
Cc: KOSAKI Motohiro
Cc: Christoph Lameter
Cc: Hugh Dickins
Cc: Mel Gorman
Cc: Lee Schermerhorn
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 82b34c64333393dc83d2c892114c9fb5cf432ea4
Author: Hillf Danton
Date: Wed Dec 28 15:57:16 2011 -0800
mm: hugetlb: fix non-atomic enqueue of huge page
commit b0365c8d0cb6e79eb5f21418ae61ab511f31b575 upstream.
If a huge page is enqueued under the protection of hugetlb\_lock, then the
operation is atomic and safe.
Signed-off-by: Hillf Danton
Reviewed-by: Michal Hocko
Acked-by: KAMEZAWA Hiroyuki
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit f40c06e7f41a1489e9c75619d2e4d40a23d915b4
Author: Alex Deucher
Date: Wed Dec 21 11:58:17 2011 -0500
drm/radeon/kms: bail on BTC parts if MC ucode is missing
commit 77e00f2ea94abee1ad13bdfde19cf7aa25992b0e upstream.
We already do this for cayman, need to also do it for
BTC parts. The default memory and voltage setup is not
adequate for advanced operation. Continuing will
result in an unusable display.
Signed-off-by: Alex Deucher
Cc: Jean Delvare
Signed-off-by: Dave Airlie
Signed-off-by: Greg Kroah-Hartman
commit 118282df5d0a473c72f5609a71a5cb25e86ea416
Author: Mingarelli, Thomas
Date: Mon Nov 7 10:59:00 2011 +0100
watchdog: hpwdt: Changes to handle NX secure bit in 32bit path
commit e67d668e147c3b4fec638c9e0ace04319f5ceccd upstream.
This patch makes use of the set\_memory\_x() kernel API in order
to make necessary BIOS calls to source NMIs.
This is needed for SLES11 SP2 and the latest upstream kernel as it appears
the NX Execute Disable has grown in its control.
Signed-off by: Thomas Mingarelli
Signed-off by: Wim Van Sebroeck
Signed-off-by: Greg Kroah-Hartman
commit 04a763aed3c611460ef4888d14a1f5101e8373bc
Author: Hugh Dickins
Date: Sat Dec 31 11:44:01 2011 -0800
futex: Fix uninterruptible loop due to gate\_area
commit e6780f7243eddb133cc20ec37fa69317c218b709 upstream.
It was found (by Sasha) that if you use a futex located in the gate
area we get stuck in an uninterruptible infinite loop, much like the
ZERO\_PAGE issue.
While looking at this problem, PeterZ realized you'll get into similar
trouble when hitting any install\_special\_pages() mapping. And are there
still drivers setting up their own special mmaps without page->mapping,
and without special VM or pte flags to make get\_user\_pages fail?
In most cases, if page->mapping is NULL, we do not need to retry at all:
Linus points out that even /proc/sys/vm/drop\_caches poses no problem,
because it ends up using remove\_mapping(), which takes care not to
interfere when the page reference count is raised.
But there is still one case which does need a retry: if memory pressure
called shmem\_writepage in between get\_user\_pages\_fast dropping page
table lock and our acquiring page lock, then the page gets switched from
filecache to swapcache (and ->mapping set to NULL) whatever the refcount.
Fault it back in to get the page->mapping needed for key->shared.inode.
Reported-by: Sasha Levin
Signed-off-by: Hugh Dickins
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 6a8f198e5d3573276fba8efa3d2e006da5f02e1f
Author: Vladimir Zapolskiy
Date: Thu Dec 22 16:15:40 2011 +0100
oprofile, arm/sh: Fix oprofile\_arch\_exit() linkage issue
commit 55205c916e179e09773d98d290334d319f45ac6b upstream.
This change fixes a linking problem, which happens if oprofile
is selected to be compiled as built-in:
`oprofile\_arch\_exit' referenced in section `.init.text' of
arch/arm/oprofile/built-in.o: defined in discarded section
`.exit.text' of arch/arm/oprofile/built-in.o
The problem is appeared after commit 87121ca504, which
introduced oprofile\_arch\_exit() calls from \_\_init function. Note
that the aforementioned commit has been backported to stable
branches, and the problem is known to be reproduced at least
with 3.0.13 and 3.1.5 kernels.
Signed-off-by: Vladimir Zapolskiy
Signed-off-by: Robert Richter
Cc: Will Deacon
Cc: oprofile-list
Link: http://lkml.kernel.org/r/20111222151540.GB16765@erda.amd.com
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit d2b0cc97b7da31bb0e2bad0653bc387dbe760134
Author: Ulf Hansson
Date: Tue Dec 13 16:58:43 2011 +0100
ARM: 7220/1: mmc: mmci: Fixup error handling for dma
commit 3b6e3c73851a9a4b0e6ed9d378206341dd65e8a5 upstream.
When getting a cmd irq during an ongoing data transfer
with dma, the dma job were never terminated. This is now
corrected.
Tested-by: Linus Walleij
Signed-off-by: Per Forlin
Signed-off-by: Ulf Hansson
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 62f75a5704eb27b1e67d28235f6aa6a8d3798662
Author: Ulf Hansson
Date: Tue Dec 13 16:51:04 2011 +0100
ARM: 7214/1: mmc: mmci: Fixup handling of MCI\_STARTBITERR
commit b63038d6f4ca5d1849ce01d9fc5bb9cb426dec73 upstream.
The interrupt was previously enabled and then correctly cleared.
Now we also handle it correctly.
Tested-by: Linus Walleij
Signed-off-by: Ulf Hansson
Signed-off-by: Russell King
Signed-off-by: Greg Kroah-Hartman
commit 2afb2920cb25c74bbb16a6b60c6316fb02f434c0
Author: Jason Chen
Date: Mon Dec 19 11:23:28 2011 +0800
ARM:imx:fix pwm period value
commit 5776ac2eb33164c77cdb4d2b48feee15616eaba3 upstream.
According to imx pwm RM, the real period value should be
PERIOD value in PWMPR plus 2.
PWMO (Hz) = PCLK(Hz) / (period +2)
Signed-off-by: Jason Chen
Signed-off-by: Sascha Hauer
Signed-off-by: Greg Kroah-Hartman
commit 27c57858531c4829a1446ebb5fd606d07846b2e5
Author: Srivatsa S. Bhat
Date: Thu Dec 22 02:45:29 2011 +0530
VFS: Fix race between CPU hotplug and lglocks
commit e30e2fdfe56288576ee9e04dbb06b4bd5f282203 upstream.
Currently, the \*\_global\_[un]lock\_online() routines are not at all synchronized
with CPU hotplug. Soft-lockups detected as a consequence of this race was
reported earlier at https://lkml.org/lkml/2011/8/24/185. (Thanks to Cong Meng
for finding out that the root-cause of this issue is the race condition
between br\_write\_[un]lock() and CPU hotplug, which results in the lock states
getting messed up).
Fixing this race by just adding {get,put}\_online\_cpus() at appropriate places
in \*\_global\_[un]lock\_online() is not a good option, because, then suddenly
br\_write\_[un]lock() would become blocking, whereas they have been kept as
non-blocking all this time, and we would want to keep them that way.
So, overall, we want to ensure 3 things:
1. br\_write\_lock() and br\_write\_unlock() must remain as non-blocking.
2. The corresponding lock and unlock of the per-cpu spinlocks must not happen
for different sets of CPUs.
3. Either prevent any new CPU online operation in between this lock-unlock, or
ensure that the newly onlined CPU does not proceed with its corresponding
per-cpu spinlock unlocked.
To achieve all this:
(a) We introduce a new spinlock that is taken by the \*\_global\_lock\_online()
routine and released by the \*\_global\_unlock\_online() routine.
(b) We register a callback for CPU hotplug notifications, and this callback
takes the same spinlock as above.
(c) We maintain a bitmap which is close to the cpu\_online\_mask, and once it is
initialized in the lock\_init() code, all future updates to it are done in
the callback, under the above spinlock.
(d) The above bitmap is used (instead of cpu\_online\_mask) while locking and
unlocking the per-cpu locks.
The callback takes the spinlock upon the CPU\_UP\_PREPARE event. So, if the
br\_write\_lock-unlock sequence is in progress, the callback keeps spinning,
thus preventing the CPU online operation till the lock-unlock sequence is
complete. This takes care of requirement (3).
The bitmap that we maintain remains unmodified throughout the lock-unlock
sequence, since all updates to it are managed by the callback, which takes
the same spinlock as the one taken by the lock code and released only by the
unlock routine. Combining this with (d) above, satisfies requirement (2).
Overall, since we use a spinlock (mentioned in (a)) to prevent CPU hotplug
operations from racing with br\_write\_lock-unlock, requirement (1) is also
taken care of.
By the way, it is to be noted that a CPU offline operation can actually run
in parallel with our lock-unlock sequence, because our callback doesn't react
to notifications earlier than CPU\_DEAD (in order to maintain our bitmap
properly). And this means, since we use our own bitmap (which is stale, on
purpose) during the lock-unlock sequence, we could end up unlocking the
per-cpu lock of an offline CPU (because we had locked it earlier, when the
CPU was online), in order to satisfy requirement (2). But this is harmless,
though it looks a bit awkward.
Debugged-by: Cong Meng
Signed-off-by: Srivatsa S. Bhat
Signed-off-by: Al Viro
Signed-off-by: Greg Kroah-Hartman
commit b38fb531508f5c250e9e52f6dc3432db32c315ad
Author: Hillf Danton
Date: Mon Dec 19 17:11:57 2011 -0800
memcg: keep root group unchanged if creation fails
commit a41c58a6665cc995e237303b05db42100b71b65e upstream.
If the request is to create non-root group and we fail to meet it, we
should leave the root unchanged.
Signed-off-by: Hillf Danton
Signed-off-by: Hugh Dickins
Acked-by: KAMEZAWA Hiroyuki
Acked-by: Michal Hocko
Cc: Balbir Singh
Cc: David Rientjes
Cc: Andrea Arcangeli
Cc: Johannes Weiner
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit db3be35a9693545112a3d22f35efe31bc6efab06
Author: Wey-Yi Guy
Date: Wed Dec 14 08:22:36 2011 -0800
iwlwifi: allow to switch to HT40 if not associated
commit 78feb35b8161acd95c33a703ed6ab6f554d29387 upstream.
My previous patch
34a5b4b6af104cf18eb50748509528b9bdbc4036 iwlwifi: do not re-configure
HT40 after associated
Fix the case of HT40 after association on specified AP, but it break the
association for some APs and cause not able to establish connection.
We need to address HT40 before and after addociation.
Reported-by: Andrej Gelenberg
Signed-off-by: Wey-Yi Guy
Tested-by: Andrej Gelenberg
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 3b610f6383fc35467b8451621b7ce4d154196e4a
Author: Wey-Yi Guy
Date: Thu Dec 8 15:52:00 2011 -0800
iwlwifi: do not set the sequence control bit is not needed
commit 123877b80ed62c3b897c53357b622574c023b642 upstream.
Check the IEEE80211\_TX\_CTL\_ASSIGN\_SEQ flag from mac80211, then decide how to
set the TX\_CMD\_FLG\_SEQ\_CTL\_MSK bit. Setting the wrong bit in BAR frame whill
make the firmware to increment the sequence number which is incorrect and
cause unknown behavior.
Signed-off-by: Wey-Yi Guy
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 240606b385bb9d0a5c4dec19dfd364289bf478ab
Author: Rajkumar Manoharan
Date: Sat Dec 10 18:59:43 2011 +0530
ath9k: fix max phy rate at rate control init
commit 10636bc2d60942254bda149827b922c41f4cb4af upstream.
The stations always chooses 1Mbps for all trasmitting frames,
whenever the AP is configured to lock the supported rates.
As the max phy rate is always set with the 4th from highest phy rate,
this assumption might be wrong if we have less than that. Fix that.
Cc: Paul Stewart
Reported-by: Ajay Gummalla
Signed-off-by: Rajkumar Manoharan
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 192b2a0d9c24c2906af52aa69c7c386b9c505a82
Author: Sylwester Nawrocki
Date: Fri Nov 4 10:07:06 2011 -0300
media: s5p-fimc: Use correct fourcc for RGB565 colour format
commit f83f71fda27650ae43558633be93652577dbc38c upstream.
With 16-bit RGB565 colour format pixels are stored by the device in memory
in the following order:
| b3 | b2 | b1 | b0 |
~+-----+-----+-----+-----+
| R5 G6 B5 | R5 G6 B5 |
This corresponds to V4L2\_PIX\_FMT\_RGB565 fourcc, not V4L2\_PIX\_FMT\_RGB565X.
This change is required to avoid trouble when setting up video pipeline
with the s5p-tv devices, so the colour formats at both devices can be
properly matched.
Signed-off-by: Sylwester Nawrocki
Signed-off-by: Kyungmin Park
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 200c86387cc650dbfb33c8a22ae943ed6996648a
Author: Dave Kleikamp
Date: Wed Dec 21 11:05:48 2011 -0600
vfs: \_\_read\_cache\_page should use gfp argument rather than GFP\_KERNEL
commit e6f67b8c05f5e129e126f4409ddac6f25f58ffcb upstream.
lockdep reports a deadlock in jfs because a special inode's rw semaphore
is taken recursively. The mapping's gfp mask is GFP\_NOFS, but is not
used when \_\_read\_cache\_page() calls add\_to\_page\_cache\_lru().
Signed-off-by: Dave Kleikamp
Acked-by: Hugh Dickins
Acked-by: Al Viro
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 5518e7a8f7964cb79760b2ca6736e8997a6e388b
Author: Ilya Yanok
Date: Mon Aug 1 23:00:28 2011 +0200
mfd: Fix twl-core oops while calling twl\_i2c\_\* for unbound driver
commit 8653be1afd60d6e8c36139b487e375b70357d9ef upstream.
Check inuse variable before trying to access twl\_map to prevent
dereferencing of uninitialized variable.
Signed-off-by: Ilya Yanok
Signed-off-by: Samuel Ortiz
Signed-off-by: Greg Kroah-Hartman
commit 61bf2d48574d6ce5418b988e9547937c2efdd084
Author: Mandeep Singh Baines
Date: Thu Dec 15 11:36:43 2011 -0800
cgroups: fix a css\_set not found bug in cgroup\_attach\_proc
commit e0197aae59e55c06db172bfbe1a1cdb8c0e1cab3 upstream.
There is a BUG when migrating a PF\_EXITING proc. Since css\_set\_prefetch()
is not called for the PF\_EXITING case, find\_existing\_css\_set() will return
NULL inside cgroup\_task\_migrate() causing a BUG.
This bug is easy to reproduce. Create a zombie and echo its pid to
cgroup.procs.
$ cat zombie.c
\#include
int main()
{
if (fork())
pause();
return 0;
}
$
We are hitting this bug pretty regularly on ChromeOS.
This bug is already fixed by Tejun Heo's cgroup patchset which is
targetted for the next merge window:
https://lkml.org/lkml/2011/11/1/356
I've create a smaller patch here which just fixes this bug so that a
fix can be merged into the current release and stable.
Signed-off-by: Mandeep Singh Baines
Downstream-Bug-Report: http://crosbug.com/23953
Reviewed-by: Li Zefan
Signed-off-by: Tejun Heo
Cc: containers@lists.linux-foundation.org
Cc: cgroups@vger.kernel.org
Cc: KAMEZAWA Hiroyuki
Cc: Frederic Weisbecker
Cc: Oleg Nesterov
Cc: Andrew Morton
Cc: Paul Menage
Cc: Olof Johansson
Signed-off-by: Greg Kroah-Hartman
commit e1bf69d93f497cb12740c85f9271e154d34bbb89
Author: Rusty Russell
Date: Thu Dec 15 13:34:50 2011 +1030
mmc: vub300: fix type of firmware\_rom\_wait\_states module parameter
commit 61074287c2965edf0fc75b54ae8f4ce99f182669 upstream.
You didn't mean this to be a bool.
Signed-off-by: Rusty Russell
Acked-by: Tony Olech
Signed-off-by: Chris Ball
Signed-off-by: Greg Kroah-Hartman
commit 125655948842b824d2c0c0032578e41071d952b6
Author: Thomas Meyer
Date: Mon Dec 19 17:11:55 2011 -0800
nilfs2: unbreak compat ioctl
commit 695c60f21c69e525a89279a5f35bae4ff237afbc upstream.
commit 828b1c50ae ("nilfs2: add compat ioctl") incidentally broke all
other NILFS compat ioctls. Make them work again.
Signed-off-by: Thomas Meyer
Signed-off-by: Ryusuke Konishi
Tested-by: Ryusuke Konishi
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit ef9a3646b41226da3aa5b7681e42a6e25a46e08b
Author: Gary Thomas
Date: Thu Dec 1 08:51:09 2011 -0300
media: omap\_vout: Fix compile error in 3.1
commit d1ee8878a142f81ea1b40d602c6360b752829437 upstream.
This patch is against the mainline v3.1 release (c3b92c8) and
fixes a compile error when building for OMAP3+DSS+VOUT
Acked-by: Laurent Pinchart
Signed-off-by: Gary Thomas
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 82e2cbd2370e6339bac6d125dc2c016cdcce193f
Author: David Howells
Date: Tue Dec 13 14:49:04 2011 +0000
SELinux: Fix RCU deref check warning in sel\_netport\_insert()
commit 50345f1ea9cda4618d9c26e590a97ecd4bc7ac75 upstream.
Fix the following bug in sel\_netport\_insert() where rcu\_dereference() should
be rcu\_dereference\_protected() as sel\_netport\_lock is held.
===================================================
[ INFO: suspicious rcu\_dereference\_check() usage. ]
---------------------------------------------------
security/selinux/netport.c:127 invoked rcu\_dereference\_check() without protection!
other info that might help us debug this:
rcu\_scheduler\_active = 1, debug\_locks = 0
1 lock held by ossec-rootcheck/3323:
#0: (sel\_netport\_lock){+.....}, at: [] sel\_netport\_sid+0xbb/0x226
stack backtrace:
Pid: 3323, comm: ossec-rootcheck Not tainted 3.1.0-rc8-fsdevel+ #1095
Call Trace:
[] lockdep\_rcu\_dereference+0xa7/0xb0
[] sel\_netport\_sid+0x1b7/0x226
[] ? sel\_netport\_avc\_callback+0xbc/0xbc
[] selinux\_socket\_bind+0x115/0x230
[] ? might\_fault+0x4e/0x9e
[] ? might\_fault+0x97/0x9e
[] security\_socket\_bind+0x11/0x13
[] sys\_bind+0x56/0x95
[] ? sysret\_check+0x27/0x62
[] ? trace\_hardirqs\_on\_caller+0x11e/0x155
[] ? audit\_syscall\_entry+0x17b/0x1ae
[] ? trace\_hardirqs\_on\_thunk+0x3a/0x3f
[] system\_call\_fastpath+0x16/0x1b
Signed-off-by: David Howells
Acked-by: Paul Moore
Acked-by: Eric Dumazet
Signed-off-by: James Morris
Signed-off-by: Greg Kroah-Hartman
commit dd21b5590495d004dd965433df6a089f46f682bd
Author: Trond Myklebust
Date: Thu Dec 1 16:37:42 2011 -0500
NFSv4.1: Ensure that we handle \_all\_ SEQUENCE status bits.
commit 111d489f0fb431f4ae85d96851fbf8d3248c09d8 upstream.
Currently, the code assumes that the SEQUENCE status bits are mutually
exclusive. They are not...
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 4030564c1503d782139279e6741c819acbb0fb8f
Author: Trond Myklebust
Date: Thu Dec 15 18:38:10 2011 -0500
NFS: Fix a regression in nfs\_file\_llseek()
commit 6c52961743f38747401b47127b82159ab6d8a7a4 upstream.
After commit 06222e491e663dac939f04b125c9dc52126a75c4 (fs: handle
SEEK\_HOLE/SEEK\_DATA properly in all fs's that define their own llseek)
the behaviour of llseek() was changed so that it always revalidates
the file size. The bug appears to be due to a logic error in the
afore-mentioned commit, which always evaluates to 'true'.
Reported-by: Roel Kluin
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit 9aeeebb28c4bd8c3a2382ff909e82989d22b97a1
Author: Trond Myklebust
Date: Thu Dec 1 14:16:17 2011 -0500
SUNRPC: Ensure we always bump the backlog queue in xprt\_free\_slot
commit c25573b5134294c0be82bfaecc6d08136835b271 upstream.
Whenever we free a slot, we know that the resulting xprt->num\_reqs will
be less than xprt->max\_reqs, so we know that we can release at least one
backlogged rpc\_task.
Signed-off-by: Trond Myklebust
Signed-off-by: Greg Kroah-Hartman
commit c9b5dd12ec6e93b609b0e61acd02944352cd436d
Author: Robert Richter
Date: Mon Dec 19 16:38:30 2011 +0100
oprofile: Fix uninitialized memory access when writing to writing to oprofilefs
commit 913050b91eb94f194392dd797b1ff3779f606ac0 upstream.
If oprofilefs\_ulong\_from\_user() is called with count equals
zero, \*val remains unchanged. Depending on the implementation it
might be uninitialized.
Change oprofilefs\_ulong\_from\_user()'s interface to return count
on success. Thus, we are able to return early if count equals
zero which avoids using \*val uninitialized. Fixing all users of
oprofilefs\_ulong\_ from\_user().
This follows write syscall implementation when count is zero:
"If count is zero ... [and if] no errors are detected, 0 will be
returned without causing any other effect." (man 2 write)
Reported-By: Mike Waychison
Signed-off-by: Robert Richter
Cc: Andrew Morton
Cc: oprofile-list
Link: http://lkml.kernel.org/r/20111219153830.GH16765@erda.amd.com
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 56c6a8a4aadca809e04276eabe5552935c51387f
Author: Frantisek Hrbata
Date: Mon Dec 19 17:11:59 2011 -0800
oom: fix integer overflow of points in oom\_badness
commit ff05b6f7ae762b6eb464183eec994b28ea09f6dd upstream.
An integer overflow will happen on 64bit archs if task's sum of rss,
swapents and nr\_ptes exceeds (2^31)/1000 value. This was introduced by
commit
f755a04 oom: use pte pages in OOM score
where the oom score computation was divided into several steps and it's no
longer computed as one expression in unsigned long(rss, swapents, nr\_pte
are unsigned long), where the result value assigned to points(int) is in
range(1..1000). So there could be an int overflow while computing
176 points \*= 1000;
and points may have negative value. Meaning the oom score for a mem hog task
will be one.
196 if (points <= 0)
197 return 1;
For example:
[ 3366] 0 3366 35390480 24303939 5 0 0 oom01
Out of memory: Kill process 3366 (oom01) score 1 or sacrifice child
Here the oom1 process consumes more than 24303939(rss)\*4096~=92GB physical
memory, but it's oom score is one.
In this situation the mem hog task is skipped and oom killer kills another and
most probably innocent task with oom score greater than one.
The points variable should be of type long instead of int to prevent the
int overflow.
Signed-off-by: Frantisek Hrbata
Acked-by: KOSAKI Motohiro
Acked-by: Oleg Nesterov
Acked-by: David Rientjes
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit a6c066b0703eeafc61eafdd5addf157ee671bd68
Author: Michel Lespinasse
Date: Mon Dec 19 17:12:06 2011 -0800
binary\_sysctl(): fix memory leak
commit 3d3c8f93a237b64580c5c5e138edeb1377e98230 upstream.
binary\_sysctl() calls sysctl\_getname() which allocates from names\_cache
slab usin \_\_getname()
The matching function to free the name is \_\_putname(), and not putname()
which should be used only to match getname() allocations.
This is because when auditing is enabled, putname() calls audit\_putname
\*instead\* (not in addition) to \_\_putname(). Then, if a syscall is in
progress, audit\_putname does not release the name - instead, it expects
the name to get released when the syscall completes, but that will happen
only if audit\_getname() was called previously, i.e. if the name was
allocated with getname() rather than the naked \_\_getname(). So,
\_\_getname() followed by putname() ends up leaking memory.
Signed-off-by: Michel Lespinasse
Acked-by: Al Viro
Cc: Christoph Hellwig
Cc: Eric Paris
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 8b6984422659dd49fdbf9ef3c829bd2bb3798053
Author: Roland Dreier
Date: Tue Dec 6 10:47:37 2011 -0800
IB/mlx4: Fix shutdown crash accessing a non-existent bitmap
commit 4af3ce0de0c12e5c17811eaefad36ab8e146c0fd upstream.
Commit cfcde11c3d7a ("IB/mlx4: Use flow counters on IBoE ports") added
code that sets elements of counters[] to -1 if no counter is allocated,
but then goes ahead and passes every entry to mlx4\_counter\_free() on
shutdown. This is a bad idea, especially if MLX4\_DEV\_CAP\_FLAG\_COUNTERS
isn't set so there isn't even an underlying bitmap to free from.
Tested-by: Sean Hefty
Signed-off-by: Roland Dreier
Signed-off-by: Greg Kroah-Hartman
commit 2c141bbe1ddfb7f91749af4411f884125ea6e14e
Author: Eugene Surovegin
Date: Thu Dec 15 11:25:59 2011 -0800
percpu: fix per\_cpu\_ptr\_to\_phys() handling of non-page-aligned addresses
commit 9f57bd4d6dc69a4e3bf43044fa00fcd24dd363e3 upstream.
per\_cpu\_ptr\_to\_phys() incorrectly rounds up its result for non-kmalloc
case to the page boundary, which is bogus for any non-page-aligned
address.
This affects the only in-tree user of this function - sysfs handler
for per-cpu 'crash\_notes' physical address. The trouble is that the
crash\_notes per-cpu variable is not page-aligned:
crash\_notes = 0xc08e8ed4
PER-CPU OFFSET VALUES:
CPU 0: 3711f000
CPU 1: 37129000
CPU 2: 37133000
CPU 3: 3713d000
So, the per-cpu addresses are:
crash\_notes on CPU 0: f7a07ed4 => phys 36b57ed4
crash\_notes on CPU 1: f7a11ed4 => phys 36b4ded4
crash\_notes on CPU 2: f7a1bed4 => phys 36b43ed4
crash\_notes on CPU 3: f7a25ed4 => phys 36b39ed4
However, /sys/devices/system/cpu/cpu\*/crash\_notes says:
/sys/devices/system/cpu/cpu0/crash\_notes: 36b57000
/sys/devices/system/cpu/cpu1/crash\_notes: 36b4d000
/sys/devices/system/cpu/cpu2/crash\_notes: 36b43000
/sys/devices/system/cpu/cpu3/crash\_notes: 36b39000
As you can see, all values are rounded down to a page
boundary. Consequently, this is where kexec sets up the NOTE segments,
and thus where the secondary kernel is looking for them. However, when
the first kernel crashes, it saves the notes to the unaligned
addresses, where they are not found.
Fix it by adding offset\_in\_page() to the translated page address.
-tj: Combined Eugene's and Petr's commit messages.
Signed-off-by: Eugene Surovegin
Signed-off-by: Tejun Heo
Reported-by: Petr Tesarik
Signed-off-by: Greg Kroah-Hartman
commit 8246905d452b12e1ce535705c746c3ff66660e09
Author: Dmitry Torokhov
Date: Mon Dec 12 00:05:53 2011 -0800
Input: synaptics - fix touchpad not working after S2R on Vostro V13
commit 8521478f67e95ada4e87970c7b41e504c724b2cf upstream.
Synaptics touchpads on several Dell laptops, particularly Vostro V13
systems, may not respond properly to PS/2 commands and queries immediately
after resuming from suspend to RAM. This leads to unresponsive touchpad
after suspend/resume cycle.
Adding a 1-second delay after resetting the device allows touchpad to
finish initializing (calibrating?) and start reacting properly.
Reported-by: Daniel Manrique
Tested-by: Daniel Manrique
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit cc9894300313f95acc1f44580d96f7b4cb81afa3
Author: Jason Chen
Date: Wed Nov 30 11:34:27 2011 +0800
MXC PWM: should active during DOZE/WAIT/DBG mode
commit c0d96aed8c6dd925afe9ea35491a0cd458642a86 upstream.
Signed-off-by: Jason Chen
Signed-off-by: Sascha Hauer
Signed-off-by: Greg Kroah-Hartman
commit 4244546343a9d37d6302373d8a1cbb57e1be4334
Author: Philipp Dreimann
Date: Wed Dec 7 13:43:31 2011 -0600
rtl8192{ce,cu,de,se}: avoid problems because of possible ERFOFF -> ERFSLEEP transition
commit 91ddff8a3b9cc7ac2252aca138220939cf6cc2cf upstream.
In drivers rtl8192ce, rtl8192cu, rtl8192se, and rtl8192de, break
statements would allow ppsc->rfpwr\_state to be changed to ERFSLEEP
even though the device is actually in ERFOFF.
Signed-off-by: Philipp Dreimann
Signed-off-by: Larry Finger
Cc: Chaoming Li
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 105bad88a8944eac1e9652f6473b0ae5853b8985
Author: Hauke Mehrtens
Date: Mon Dec 5 23:19:51 2011 +0100
ssb: fix init regression with SoCs
commit 329456d1ffb416c220813725b7363cda9975c9aa upstream.
This fixes a Data bus error on some SoCs. The first fix for this
problem did not solve it on all devices.
commit 6ae8ec27868bfdbb815287bee8146acbefaee867
Author: Rafał Miłecki
Date: Tue Jul 5 17:25:32 2011 +0200
ssb: fix init regression of hostmode PCI core
In ssb\_pcicore\_fix\_sprom\_core\_index() the sprom on the PCI core is
accessed, but the sprom only exists when the ssb bus is connected over
a PCI bus to the rest of the system and not when the SSB Bus is the
main system bus. SoCs sometimes have a PCI host controller and there
this code will not be executed, but there are some old SoCs with an PCI
controller in client mode around and ssb\_pcicore\_fix\_sprom\_core\_index()
should not be called on these devices too. The PCI controller on these
devices are unused, but without this fix it results in an Data bus
error when it gets initialized.
Cc: Michael Buesch
Cc: Rafał Miłecki
Signed-off-by: Hauke Mehrtens
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 24b14588aef6226f3bcdf37e78af61cbe9a31fd2
Author: Mike Snitzer
Date: Wed Nov 23 10:59:13 2011 +0100
block: initialize request\_queue's numa node during
commit 5151412dd4338b273afdb107c3772528e9e67d92 upstream.
struct request\_queue is allocated with \_\_GFP\_ZERO so its "node" field is
zero before initialization. This causes an oops if node 0 is offline in
the page allocator because its zonelists are not initialized. From Dave
Young's dmesg:
SRAT: Node 1 PXM 2 0-d0000000
SRAT: Node 1 PXM 2 100000000-330000000
SRAT: Node 0 PXM 1 330000000-630000000
Initmem setup node 1 0000000000000000-000000000affb000
...
Built 1 zonelists in Node order, mobility grouping on.
...
BUG: unable to handle kernel paging request at 0000000000001c08
IP: [] \_\_alloc\_pages\_nodemask+0xb5/0x870
and \_\_alloc\_pages\_nodemask+0xb5 translates to a NULL pointer on
zonelist->\_zonerefs.
The fix is to initialize q->node at the time of allocation so the correct
node is passed to the slab allocator later.
Since blk\_init\_allocated\_queue\_node() is no longer needed, merge it with
blk\_init\_allocated\_queue().
[rientjes@google.com: changelog, initializing q->node]
Reported-by: Dave Young
Signed-off-by: Mike Snitzer
Signed-off-by: David Rientjes
Tested-by: Dave Young
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit fd4d1165bc59b4cb35a3d30e43ebba442c67a68c
Author: Mark Brown
Date: Sat Dec 10 20:38:32 2011 +0800
ASoC: Fix WM8996 24.576MHz clock operation
commit 37d5993c5cc9bc83762ae1b5bd287438022e8afe upstream.
Record the clock after the divider as that is what all SYSCLK users see.
Without this the other clock configuration in the device comes out at
half rate.
Signed-off-by: Mark Brown
Signed-off-by: Greg Kroah-Hartman
commit c5bebbd132f1d56ef3d99143f5386d58b4da318e
Author: Johannes Berg
Date: Wed Dec 7 09:02:21 2011 +0100
mac80211: fix another race in aggregation start
commit 15062e6a8524f5977f2cbdf6e3eb2f144262f74e upstream.
Emmanuel noticed that when mac80211 stops the queues
for aggregation that can leave a packet pending. This
packet will be given to the driver after the AMPDU
callback, but as a non-aggregated packet which messes
up the sequence number etc.
I also noticed by looking at the code that if packets
are being processed while we clear the WANT\_START bit,
they might see it cleared already and queue up on
tid\_tx->pending. If the driver then rejects the new
aggregation session we leak the packet.
Fix both of these issues by changing this code to not
stop the queues at all. Instead, let packets queue up
on the tid\_tx->pending queue instead of letting them
get to the driver, and add code to recover properly
in case the driver rejects the session.
(The patch looks large because it has to move two
functions to before their new use.)
Reported-by: Emmanuel Grumbach
Signed-off-by: Johannes Berg
Signed-off-by: John W. Linville
Signed-off-by: Greg Kroah-Hartman
commit 7533e9cb9ce687424e344cf07a815ffc08734825
Author: Thomas Gleixner
Date: Fri Nov 11 20:52:01 2011 +0100
SCSI: fcoe: Fix preempt count leak in fcoe\_filter\_frames()
commit 7e1e7ead88dff75b11b86ee0d5232c4591be1326 upstream.
The error exit path leaks preempt count. Add the missing put\_cpu().
Signed-off-by: Thomas Gleixner
Reviewed-by: Yi Zou
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 4c9ddbf69e5d6ea938804af78df524ea08535c63
Author: Anton Blanchard
Date: Mon Nov 7 22:05:21 2011 +1100
SCSI: mpt2sas: \_scsih\_smart\_predicted\_fault uses GFP\_KERNEL in interrupt context
commit f6a290b419a2675c4b77a6b0731cd2a64332365e upstream.
\_scsih\_smart\_predicted\_fault is called in an interrupt and therefore
must allocate memory using GFP\_ATOMIC.
Signed-off-by: Anton Blanchard
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 4e8a616faeb24d919c5249039394fcfa78365986
Author: Steffen Maier
Date: Fri Nov 18 20:00:40 2011 +0100
SCSI: zfcp: return early from slave\_destroy if slave\_alloc returned early
commit 44f747fff6e9f027a4866c1a6864e26ae7c510c8 upstream.
zfcp\_scsi\_slave\_destroy erroneously always tried to finish its task
even if the corresponding previous zfcp\_scsi\_slave\_alloc returned
early. This can lead to kernel page faults on accessing uninitialized
fields of struct zfcp\_scsi\_dev in zfcp\_erp\_lun\_shutdown\_wait. Take the
port field of the struct to determine if slave\_alloc returned early.
This zfcp bug is exposed by 4e6c82b (in turn fixing f7c9c6b to be
compatible with 21208ae) which can call slave\_destroy for a
corresponding previous slave\_alloc that did not finish.
This patch is based on James Bottomley's fix suggestion in
http://www.spinics.net/lists/linux-scsi/msg55449.html.
Signed-off-by: Steffen Maier
Signed-off-by: James Bottomley
Signed-off-by: Greg Kroah-Hartman
commit 679b98b517dcddd7c3568081b50948a786884ad1
Author: Yasuaki Ishimatsu
Date: Fri Dec 2 10:07:07 2011 +0100
cfq-iosched: fix cfq\_cic\_link() race confition
commit 5eb46851de3904cd1be9192fdacb8d34deadc1fc upstream.
cfq\_cic\_link() has race condition. When some processes which shared ioc
issue I/O to same block device simultaneously, cfq\_cic\_link() returns -EEXIST
sometimes. The race condition might stop I/O by following steps:
step 1: Process A: Issue an I/O to /dev/sda
step 2: Process A: Get an ioc (iocA here) in get\_io\_context() which does not
linked with a cic for the device
step 3: Process A: Get a new cic for the device (cicA here) in
cfq\_alloc\_io\_context()
step 4: Process B: Issue an I/O to /dev/sda
step 5: Process B: Get iocA in get\_io\_context() since process A and B share the
same ioc
step 6: Process B: Get a new cic for the device (cicB here) in
cfq\_alloc\_io\_context() since iocA has not been linked with a
cic for the device yet
step 7: Process A: Link cicA to iocA in cfq\_cic\_link()
step 8: Process A: Dispatch I/O to driver and finish it
step 9: Process B: Try to link cicB to iocA in cfq\_cic\_link()
But it fails with showing "cfq: cic link failed!" kernel
message, since iocA has already linked with cicA at step 7.
step 10: Process B: Wait for finishig I/O in get\_request\_wait()
The function does not wake up, when there is no I/O to the
device.
When cfq\_cic\_link() returns -EEXIST, it means ioc has already linked with cic.
So when cfq\_cic\_link() return -EEXIST, retry cfq\_cic\_lookup().
Signed-off-by: Yasuaki Ishimatsu
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit e0b58526fabbd53e2343f9ee0474f2070d717967
Author: majianpeng
Date: Wed Nov 30 15:47:48 2011 +0100
cfq-iosched: free cic\_index if blkio\_alloc\_blkg\_stats fails
commit 2984ff38ccf6cbc02a7a996a36c7d6f69f3c6146 upstream.
If we fail allocating the blkpg stats, we free cfqd and cfgq.
But we need to free the IDA cfqd->cic\_index as well.
Signed-off-by: majianpeng
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit c86534499300b66168ad29ac08ab1e1f987de909
Author: Eugeni Dodonov
Date: Thu Nov 10 13:55:15 2011 -0200
drm/i915: prevent division by zero when asking for chipset power
commit 4ed0b577457eb6aeb7cdc7e7316576e63d15abb2 upstream.
This prevents an in-kernel division by zero which happens when we are
asking for i915\_chipset\_val too quickly, or within a race condition
between the power monitoring thread and userspace accesses via debugfs.
The issue can be reproduced easily via the following command:
while ``; do cat /sys/kernel/debug/dri/0/i915\_emon\_status; done
This is particularly dangerous because it can be triggered by
a non-privileged user by just reading the debugfs entry.
This issue was also found independently by Konstantin Belousov
, who proposed a similar patch.
Reported-by: Konstantin Belousov
Acked-by: Jesse Barnes
Acked-by: Keith Packard
Reviewed-by: Chris Wilson
Signed-off-by: Eugeni Dodonov
Signed-off-by: Keith Packard
Signed-off-by: Greg Kroah-Hartman
commit bebaa677dcb502f900d3571e7a65eafed3796418
Author: Paulo Zanoni
Date: Fri Oct 14 18:16:22 2011 -0300
drm/i915: set the right SDVO transcoder for CPT
commit 3573c4103f7a486838bb6b5b8353788103f91802 upstream.
v2: add a CPT-specific macro, make code cleaner
v3: fix commit message
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=41272
Signed-off-by: Paulo Zanoni
Reviewed-by: Chris Wilson
Signed-off-by: Keith Packard
Signed-off-by: Greg Kroah-Hartman
commit 3ea268b8e7550106ed98b87299394d13e36ff537
Author: David Henningsson
Date: Mon Dec 12 14:01:17 2011 +0800
ALSA: HDA: Set position fix to LPIB for an Atom/Poulsbo based device
commit 1c89fe3b51a2f8068f2f9faa9c48584151416583 upstream.
For the Asus 1101HA, reporting position by reading the DMA position
buffer map seems unstable and often wrong. The reporter says that
position\_fix=LPIB works much better (although not 100%, but this is
probably due to other issues).
The controller chip is an Intel Poulsbo 8086:811b (rev 07) controller,
and complete alsa-info is available here:
https://launchpadlibrarian.net/86691768/alsa-info.txt.1TNwyE5Ea7
BugLink: http://bugs.launchpad.net/bugs/825709
Tested-by: Stefano Lodi
Signed-off-by: David Henningsson
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit dbb49a2b153a9da2a281e927f14e4a15a676987d
Author: John Stultz
Date: Mon Dec 12 13:57:52 2011 -0800
rtc: m41t80: Workaround broken alarm functionality
commit c3b79770e51ab1fd4201f3b54edf30113b9ce74f upstream.
The m41t80 driver can read and set the alarm, but it doesn't
seem to have a functional alarm irq.
This causes failures when the generic core sees alarm functions,
but then cannot use them properly for things like UIE mode.
Disabling the alarm functions allows proper error reporting,
and possible fallback to emulated modes. Once someone fixes
the alarm irq functionality, this can be restored.
CC: Matt Turner
CC: Nico Macrionitis
CC: Atsushi Nemoto
Reported-by: Matt Turner
Reported-by: Nico Macrionitis
Tested-by: Nico Macrionitis
Signed-off-by: John Stultz
Signed-off-by: Greg Kroah-Hartman
commit d853ba9cde9afd951d9bc8a86c7e90dfed2ad60b
Author: Ted Feng
Date: Thu Dec 8 00:46:21 2011 +0000
ipip, sit: copy parms.name after register\_netdevice
commit 72b36015ba43a3cca5303f5534d2c3e1899eae29 upstream.
Same fix as 731abb9cb2 for ipip and sit tunnel.
Commit 1c5cae815d removed an explicit call to dev\_alloc\_name in
ipip\_tunnel\_locate and ipip6\_tunnel\_locate, because register\_netdevice
will now create a valid name, however the tunnel keeps a copy of the
name in the private parms structure. Fix this by copying the name back
after register\_netdevice has successfully returned.
This shows up if you do a simple tunnel add, followed by a tunnel show:
$ sudo ip tunnel add mode ipip remote 10.2.20.211
$ ip tunnel
tunl0: ip/ip remote any local any ttl inherit nopmtudisc
tunl%d: ip/ip remote 10.2.20.211 local any ttl inherit
$ sudo ip tunnel add mode sit remote 10.2.20.212
$ ip tunnel
sit0: ipv6/ip remote any local any ttl 64 nopmtudisc 6rd-prefix 2002::/16
sit%d: ioctl 89f8 failed: No such device
sit%d: ipv6/ip remote 10.2.20.212 local any ttl inherit
Signed-off-by: Ted Feng
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 3d121b72126c37320b1485ba98a67f3a132e22cc
Author: Felipe Contreras
Date: Thu Dec 8 22:23:00 2011 +0200
ARM: OMAP: rx51: fix USB
commit e5fe29c7198a1f6616286dfc8602a69da165cb3f upstream.
Commit 10299e2e4e3ed3b16503d4e04edd48b33083f4e2 (ARM: RX-51:
Enable isp1704 power on/off) added power management for isp1704.
However, the transceiver should be powered on by default,
otherwise USB doesn't work at all for networking during
boot.
All kernels after v3.0 are affected.
Signed-off-by: Felipe Contreras
Reviewed-by: Sebastian Reichel
[tony@atomide.com: updated comments]
Signed-off-by: Tony Lindgren
Signed-off-by: Greg Kroah-Hartman


=== Content from www.openwall.com_d4bebc95_20250125_003735.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](5) [[next>]](7) [[<thread-prev]](../../../2014/04/15/5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <201404180658.s3I6wd2E024497@linus.mitre.org>
Date: Fri, 18 Apr 2014 02:58:39 -0400 (EDT)
From: cve-assign@...re.org
To: ppandit@...hat.com
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: CVE request Linux kernel: arch: x86: net: bpf_jit: an off-by-one bug in x86_64 cond jump target

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> An off-by-one bug is found in the x86_64 cond jump target of the BPF JIT
> filter code. In case a conditional jump is followed by a long jump,
> conditional jump target is one byte past the start of target instruction.
>
> A user/program could use this flaw to crash the kernel resulting in DoS, or
> potentially escalate user privileges on a system to gain root access.
>
> <https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa>

Use CVE-2014-2889.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJTUMwvAAoJEKllVAevmvmsz+IIAKwl69aIi5WPttTAnTfCWsCP
8t+Q1ncbwc0fe1U2NdO3Wz2LwsCHs3LiP/skTNREa3r8vZO3UIpl17iE22K7fREL
O3kRqacWzRRr5M/y8b0AJbRJ7WiTu1O3363gYFAwWeUN8KUA8YDcT5K1Yp98EIdA
eSyabe3sHxupDcGrJgeuCWG2QOY3BLb4qm0nO5se+VpEXym3zMefFv3e/Sl0Mhw/
QifRpIGfaggI3dDGblMjhVyeKCAm0ak3w72nNfEj/8F3JgaUQA5elINDBUYAnQWh
P8diXwR4EK3gtib0G0PEbNrp8LPmugDrfXBr2L4yOoxh+gzlAYsLEutLjhR0op0=
=yduS
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from git.kernel.org_e83da639_20250126_044943.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Markus Kötter <nepenthesdev@gmail.com> | 2011-12-17 11:39:08 +0000 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2011-12-19 15:47:29 -0500 |
| commit | [a03ffcf873fe0f2565386ca8ef832144c42e67fa](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa)) | |
| tree | [fd83a7eefe03946bba72c5a087d6c9aabb7aadb8](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa) | |
| parent | [d1388dacbbb1d1b2bc208a4ba18de9316dc49ce9](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d1388dacbbb1d1b2bc208a4ba18de9316dc49ce9) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa&id2=d1388dacbbb1d1b2bc208a4ba18de9316dc49ce9)) | |
| download | [linux-a03ffcf873fe0f2565386ca8ef832144c42e67fa.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-a03ffcf873fe0f2565386ca8ef832144c42e67fa.tar.gz) | |

net: bpf\_jit: fix an off-one bug in x86\_64 cond jump targetx86 jump instruction size is 2 or 5 bytes (near/long jump), not 2 or 6
bytes.
In case a conditional jump is followed by a long jump, conditional jump
target is one byte past the start of target instruction.
Signed-off-by: Markus Kötter <nepenthesdev@gmail.com>
Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa)

| -rw-r--r-- | [arch/x86/net/bpf\_jit\_comp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/net/bpf_jit_comp.c?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/arch/x86/net/bpf\_jit\_comp.c b/arch/x86/net/bpf\_jit\_comp.cindex bfab3fa10edc63..7b65f752c5f8fd 100644--- a/[arch/x86/net/bpf\_jit\_comp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/net/bpf_jit_comp.c?id=d1388dacbbb1d1b2bc208a4ba18de9316dc49ce9)+++ b/[arch/x86/net/bpf\_jit\_comp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/net/bpf_jit_comp.c?id=a03ffcf873fe0f2565386ca8ef832144c42e67fa)@@ -568,8 +568,8 @@ cond\_branch: f\_offset = addrs[i + filter[i].jf] - addrs[i]; break; } if (filter[i].jt != 0) {- if (filter[i].jf)- t\_offset += is\_near(f\_offset) ? 2 : 6;+ if (filter[i].jf && f\_offset)+ t\_offset += is\_near(f\_offset) ? 2 : 5; EMIT\_COND\_JMP(t\_op, t\_offset); if (filter[i].jf) EMIT\_JMP(f\_offset); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-26 04:48:21 +0000



=== Content from github.com_cfbba5ef_20250125_003736.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa03ffcf873fe0f2565386ca8ef832144c42e67fa)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa03ffcf873fe0f2565386ca8ef832144c42e67fa)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/a03ffcf873fe0f2565386ca8ef832144c42e67fa)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

net: bpf\_jit: fix an off-one bug in x86\_64 cond jump target

[Browse files](/torvalds/linux/tree/a03ffcf873fe0f2565386ca8ef832144c42e67fa)
Browse the repository at this point in the history

```
x86 jump instruction size is 2 or 5 bytes (near/long jump), not 2 or 6
bytes.

In case a conditional jump is followed by a long jump, conditional jump
target is one byte past the start of target instruction.

Signed-off-by: Markus Kötter <nepenthesdev@gmail.com>
Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
```

* Loading branch information

[![@davem330](https://avatars.githubusercontent.com/u/1053866?s=40&v=4)](/davem330)

Markus Kötter
authored and
[davem330](/torvalds/linux/commits?author=davem330 "View all commits by davem330")
committed
Dec 19, 2011

1 parent
[d1388da](/torvalds/linux/commit/d1388dacbbb1d1b2bc208a4ba18de9316dc49ce9)

commit a03ffcf

Showing
**1 changed file**
with
**2 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[arch/x86/net/bpf\_jit\_comp.c](#diff-630410486cc87a0525a709c6f33d3b51476c7ebae6f10720324284c2c4a008dd "arch/x86/net/bpf_jit_comp.c")

Show comments

[View file](/torvalds/linux/blob/a03ffcf873fe0f2565386ca8ef832144c42e67fa/arch/x86/net/bpf_jit_comp.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -568,8 +568,8 @@ cond\_branch: f\_offset = addrs[i + filter[i].jf] - addrs[i]; |
|  |  | break; |
|  |  | } |
|  |  | if (filter[i].jt != 0) { |
|  |  | if (filter[i].jf) |
|  |  | t\_offset += is\_near(f\_offset) ? 2 : 6; |
|  |  | if (filter[i].jf && f\_offset) |
|  |  | t\_offset += is\_near(f\_offset) ? 2 : 5; |
|  |  | EMIT\_COND\_JMP(t\_op, t\_offset); |
|  |  | if (filter[i].jf) |
|  |  | EMIT\_JMP(f\_offset); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a03ffcf`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fa03ffcf873fe0f2565386ca8ef832144c42e67fa) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


