=== Content from issues.asterisk.org_b0739ab1_20250125_170540.html ===

[[Home](/)]

| Summary: | ASTERISK-23210: Security: Remote crash in res\_pjsip. | | |
| --- | --- | --- | --- |
| Reporter: | Joshua C. Colp (jcolp) | Labels: | Security |
| Date Opened: | 2014-01-29 08:04:18.000-0600 | Date Closed: | 2014-03-10 15:14:49 |
| Priority: | Critical | Regression? | No |
| Status: | Closed/Complete | Components: | Resources/res\_pjsip |
| Versions: | 12.0.0 | Frequency ofOccurrence |  |
| RelatedIssues: |  | | |
| Environment: |  | Attachments: |  |
| Description: | When sending qualifies to a permanent contact a crash will occur if no local endpoint is found and the remote server sends a 401 to the OPTIONS. This occurs whether authenticate\_qualify is set to yes or no.   This is caused by send\_request\_cb in res\_pjsip.c assuming that out of dialog requests will always have an endpoint associated with them. | | |
| Comments: |  | | |



=== Content from downloads.asterisk.org_4e65ebb8_20250125_170537.html ===
Index: res/res\_pjsip/pjsip\_options.c
===================================================================
--- res/res\_pjsip/pjsip\_options.c (revision 409828)
+++ res/res\_pjsip/pjsip\_options.c (working copy)
@@ -226,7 +226,7 @@
RAII\_VAR(struct ast\_sip\_endpoint \*, endpoint\_local, ao2\_bump(endpoint), ao2\_cleanup);
- if (!endpoint\_local) {
+ if (!endpoint\_local && contact->authenticate\_qualify) {
struct ao2\_iterator \*endpoint\_iterator = find\_endpoints(contact);
/\* try to find endpoints that are associated with the contact \*/
@@ -256,7 +256,7 @@
init\_start\_time(contact);
ao2\_ref(contact, +1);
- if (ast\_sip\_send\_request(tdata, NULL, endpoint\_local, contact,
+ if (ast\_sip\_send\_request(tdata, NULL, contact->authenticate\_qualify ? endpoint\_local : NULL, contact,
qualify\_contact\_cb) != PJ\_SUCCESS) {
/\* The callback will be called so we don't need to drop the contact ref\*/
ast\_log(LOG\_ERROR, "Unable to send request to qualify contact %s\n",
Index: res/res\_pjsip.c
===================================================================
--- res/res\_pjsip.c (revision 409828)
+++ res/res\_pjsip.c (working copy)
@@ -1850,7 +1850,7 @@
}
AST\_RWLIST\_UNLOCK(&supplements);
- if (tsx->status\_code == 401 || tsx->status\_code == 407) {
+ if ((tsx->status\_code == 401 || tsx->status\_code == 407) && req\_data->endpoint) {
if (!ast\_sip\_create\_request\_with\_auth(&req\_data->endpoint->outbound\_auths, challenge, tsx, &tdata)) {
pjsip\_endpt\_send\_request(ast\_sip\_get\_pjsip\_endpoint(), tdata, -1, req\_data->token, req\_data->callback);
}


=== Content from downloads.asterisk.org_e0f7636e_20250125_170538.html ===


Asterisk
Project Security Advisory - AST-2014-003

| **Product** | Asterisk |
| **Summary** | Remote Crash Vulnerability in PJSIP channel driver |
| **Nature of Advisory** | Denial of Service |
| **Susceptibility** | Remote Unauthenticated Sessions |
| **Severity** | Moderate |
| **Exploits Known** | No |
| **Reported On** | January 29, 2014 |
| **Reported By** | Joshua Colp <jcolp AT digium DOT com> |
| **Posted On** | March 10, 2014 |
| **Last Updated On** | March 10, 2014 |
| **Advisory Contact** | Joshua Colp <jcolp AT digium DOT com> |
| **CVE Name** | CVE-2014-2288 |

| **Description** | A remotely exploitable crash vulnerability exists in the PJSIP channel driver if the "qualify\_frequency" configuration option is enabled on an AOR and the remote SIP server challenges for authentication of the resulting OPTIONS request. The response handling code wrongly assumes that a PJSIP endpoint will always be associated with an outgoing request which is incorrect. |

| **Resolution** | This patch adds a check when handling responses challenging for authentication. If no endpoint is associated with the request no retry with authentication will occur. |

| **Affected Versions** | | |
| **Product** | **Release Series** |  |
| Asterisk Open Source | 12.x | All |

| **Corrected In** | |
| **Product** | **Release** |
| Asterisk Open Source 12.x | 12.1.1 |

| **Patches** | |
| **SVN URL** | **Revision** |
| http://downloads.asterisk.org/pub/security/AST-2014-003-12.diff | Asterisk 12 |

| **Links** | https://issues.asterisk.org/jira/browse/ASTERISK-23210 |

| Asterisk Project Security Advisories are posted at <http://www.asterisk.org/security>  This document may be superseded by later versions; if so, the latest version will be posted at http://downloads.digium.com/pub/security/AST-2014-003.pdf and http://downloads.digium.com/pub/security/AST-2014-003.html |

| **Revision History** | | |
| **Date** | **Editor** | **Revisions Made** |
| 03/05/14 | Joshua Colp | Document Creation |

Asterisk
Project Security Advisory - AST-2014-003
Copyright
Â© 2014
Digium, Inc. All Rights Reserved.
Permission is hereby granted
to distribute and publish this advisory in its original, unaltered
form.


