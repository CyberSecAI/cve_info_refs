=== Content from downloads.asterisk.org_c6b708e3_20250124_145048.html ===
Index: main/http.c
===================================================================
--- main/http.c (revision 409629)
+++ main/http.c (working copy)
@@ -187,9 +187,7 @@
break;
}
}
- if (cookies) {
- ast\_variables\_destroy(cookies);
- }
+ ast\_variables\_destroy(cookies);
return mngid;
}
@@ -824,12 +822,13 @@
}\*/
#endif /\* DO\_SSL \*/
-static struct ast\_variable \*parse\_cookies(char \*cookies)
+static struct ast\_variable \*parse\_cookies(const char \*cookies)
{
+ char \*parse = ast\_strdupa(cookies);
char \*cur;
struct ast\_variable \*vars = NULL, \*var;
- while ((cur = strsep(&cookies, ";"))) {
+ while ((cur = strsep(&parse, ";"))) {
char \*name, \*val;
name = val = cur;
@@ -859,21 +858,19 @@
/\* get cookie from Request headers \*/
struct ast\_variable \*ast\_http\_get\_cookies(struct ast\_variable \*headers)
{
- struct ast\_variable \*v, \*cookies=NULL;
+ struct ast\_variable \*v, \*cookies = NULL;
for (v = headers; v; v = v->next) {
if (!strcasecmp(v->name, "Cookie")) {
- char \*tmp = ast\_strdupa(v->value);
- if (cookies) {
- ast\_variables\_destroy(cookies);
- }
-
- cookies = parse\_cookies(tmp);
+ ast\_variables\_destroy(cookies);
+ cookies = parse\_cookies(v->value);
}
}
return cookies;
}
+/\*! Limit the number of request headers in case the sender is being ridiculous. \*/
+#define MAX\_HTTP\_REQUEST\_HEADERS 100
static void \*httpd\_helper\_thread(void \*data)
{
@@ -884,6 +881,7 @@
struct ast\_variable \*tail = headers;
char \*uri, \*method;
enum ast\_http\_method http\_method = AST\_HTTP\_UNKNOWN;
+ int remaining\_headers;
if (ast\_atomic\_fetchadd\_int(&session\_count, +1) >= session\_limit) {
goto done;
@@ -918,9 +916,13 @@
if (\*c) {
\*c = '\0';
}
+ } else {
+ ast\_http\_error(ser, 400, "Bad Request", "Invalid Request");
+ goto done;
}
/\* process "Request Headers" lines \*/
+ remaining\_headers = MAX\_HTTP\_REQUEST\_HEADERS;
while (fgets(header\_line, sizeof(header\_line), ser->f)) {
char \*name, \*value;
@@ -943,6 +945,11 @@
ast\_trim\_blanks(name);
+ if (!remaining\_headers--) {
+ /\* Too many headers. \*/
+ ast\_http\_error(ser, 413, "Request Entity Too Large", "Too many headers");
+ goto done;
+ }
if (!headers) {
headers = ast\_variable\_new(name, value, \_\_FILE\_\_);
tail = headers;
@@ -950,11 +957,17 @@
tail->next = ast\_variable\_new(name, value, \_\_FILE\_\_);
tail = tail->next;
}
- }
+ if (!tail) {
+ /\*
+ \* Variable allocation failure.
+ \* Try to make some room.
+ \*/
+ ast\_variables\_destroy(headers);
+ headers = NULL;
- if (!\*uri) {
- ast\_http\_error(ser, 400, "Bad Request", "Invalid Request");
- goto done;
+ ast\_http\_error(ser, 500, "Server Error", "Out of memory");
+ goto done;
+ }
}
handle\_uri(ser, uri, http\_method, headers);
@@ -963,9 +976,7 @@
ast\_atomic\_fetchadd\_int(&session\_count, -1);
/\* clean up all the header information \*/
- if (headers) {
- ast\_variables\_destroy(headers);
- }
+ ast\_variables\_destroy(headers);
if (ser->f) {
fclose(ser->f);


=== Content from www.mandriva.com_9b23f51e_20250124_145050.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from issues.asterisk.org_e5178073_20250124_145051.html ===

[[Home](/)]

| Summary: | ASTERISK-23340: Security Vulnerability: stack allocation of cookie headers in loop allows for unauthenticated remote denial of service attack | | |
| --- | --- | --- | --- |
| Reporter: | Matt Jordan (mjordan) | Labels: | Security |
| Date Opened: | 2014-02-21 09:36:22.000-0600 | Date Closed: | 2014-03-10 15:48:29 |
| Priority: | Critical | Regression? |  |
| Status: | Closed/Complete | Components: | Core/HTTP |
| Versions: | 1.8.25.0 11.7.0 12.0.0 | Frequency ofOccurrence |  |
| RelatedIssues: |  | | |
| Environment: |  | Attachments: |  |
| Description: | From the vulnerability reporter:   {quote}  We are still writing the advisory but I will provide the gist of the problem below so you can start looking into it.  It's really a simple bug.   The parsing of HTTP Cookie header is done as seen below:  {quote}   [http://svnview.digium.com/svn/asterisk/trunk/main/http.c?view=markup&pathrev=394901]   {noformat}  854 /\* get cookie from Request headers \*/  855 structast\_variable\*ast\_http\_get\_cookies(structast\_variable\*headers)  856 {  857 structast\_variable\*v,\*cookies=NULL;  858  859 for(v=headers;v;v=v->next){  860 if(!strcasecmp(v->name,"Cookie")){  861 char\*tmp=ast\_strdupa(v->value);  862 if(cookies){  863 ast\_variables\_destroy(cookies);  864 }  865  866 cookies=parse\_cookies(tmp);  867 }  868 }  869 returncookies;  870 }  {noformat}   {quote}  Note that multiple Cookie headers are supported and each of them is parsed within the loop.  A temporary copy of the the header's content is made in line 861 before parsing the  actual (name, value) pairs with parse\_cookies in line 866.   The copy is made using ast\_strdupa() which is just a wrapper for alloca() + memcpy() :  {quote}   {noformat}  #define ast\_strdupa(s) \  (\_\_extension\_\_ \  ({ \  const char \*\_\_old = (s); \  size\_t \_\_len = strlen(\_\_old) + 1; \  char \*\_\_new = \_\_builtin\_alloca(\_\_len); \  memcpy (\_\_new, \_\_old, \_\_len); \  \_\_new; \  }))  #endif  {noformat}   {quote}  alloca() simple moves the stack pointer to make room in the stack for a len bytes  [http://man7.org/linux/man-pages/man3/alloca.3.html]   Since the call to ast\_strdupa() is made within a loop for each Cookie header found  and the number of Coookie headers is not bounded, a remote attacker could send  an HTTP POST request with as many Cookie headers as necessary to make the thread's  stack grow and overlap with another thread's stack.   The immediate obvious effect of this is a remote denial of service via an  unauthenticated HTPP POST request.   Besides that, we have explored the possibility of using this bug for remote code execution  with techniques similar to those explained here:   http://blog.exodusintel.com/tag/asterisk-exploit/   The relevant difference in our case is that the alloca() is followed by a memcpy() and  on Linux or other glibc platforms each thread created with pthread\_create() gets a  no-rw guard page allocated by default as explained here:   http://man7.org/linux/man-pages/man3/pthread\_attr\_setguardsize.3.html   So far we have not found anyway to exploit this vulnerability for remote code execution on  platforms where glibc pthreads is used with default settings but we do not yet discard  the possibility. Exploitation on platforms where no guard page is allocated to prevent  threads from overlapping each other's stack should be relatively easy.   Attached is a Python script that will help you to repro the problem agsinst an Asterisk  server runnign on localhost.   Please let us know when you are able to repro and give us an estimate date for the  release of a fix and a corresponding security advisory.   Should you want to credit the finder of the bug please use the following:   Found by Lucas Molas, researcher at Programa STIC, FundaciÃ³n Dr. Manuel Sadosky,  Buenos Aires, Argentina    regards,   -ivan  {quote} | | |
| Comments: | By: Matt Jordan (mjordan) 2014-02-21 09:40:51.313-0600This one is old: been around since r215070.  ---   By: Richard Mudgett (rmudgett) 2014-03-10 14:04:05.847-0500The issue is resolved as fixed.  JIRA currently doesn't request the resolution status so it just states as unresolved.  --- | | |



=== Content from downloads.asterisk.org_4e582a8f_20250124_145048.html ===


Asterisk
Project Security Advisory - AST-2014-001

| **Product** | Asterisk |
| **Summary** | Stack Overflow in HTTP Processing of Cookie Headers. |
| **Nature of Advisory** | Denial Of Service |
| **Susceptibility** | Remote Unauthenticated Sessions |
| **Severity** | Moderate |
| **Exploits Known** | No |
| **Reported On** | February 21, 2014 |
| **Reported By** | Lucas Molas, researcher at Programa STIC, FundaciÃ³n  Dr. Manuel Sadosky, Buenos Aires, Argentina |
| **Posted On** | March 10, 2014 |
| **Last Updated On** | March 10, 2014 |
| **Advisory Contact** | Richard Mudgett <rmudgett AT digium DOT com> |
| **CVE Name** | CVE-2014-2286 |

| **Description** | Sending a HTTP request that is handled by Asterisk with a large number of Cookie headers could overflow the stack. You could even exhaust memory if you sent an unlimited number of headers in the request. |

| **Resolution** | The patched versions now handle headers in a fashion that prevents a stack overflow. Users should upgrade to a corrected version, apply the released patches, or disable HTTP support. |

| **Affected Versions** | | |
| **Product** | **Release Series** |  |
| Asterisk Open Source | 1.8.x | All versions |
| Asterisk Open Source | 11.x | All versions |
| Asterisk Open Source | 12.x | All versions |
| Certified Asterisk | 1.8.x | All versions |
| Certified Asterisk | 11.x | All versions |

| **Corrected In** | |
| **Product** | **Release** |
| Asterisk Open Source | 1.8.26.1, 11.8.1, 12.1.1 |
| Certified Asterisk | 1.8.15-cert5, 11.6-cert2 |

| **Patches** | |
| **SVN URL** | **Revision** |
| <http://downloads.asterisk.org/pub/security/AST-2014-001-1.8.diff> | Asterisk 1.8 |
| <http://downloads.asterisk.org/pub/security/AST-2014-001-11.diff> | Asterisk 11 |
| <http://downloads.asterisk.org/pub/security/AST-2014-001-12.diff> | Asterisk 12 |
| <http://downloads.asterisk.org/pub/security/AST-2014-001-1.8.15.diff> | Certified Asterisk 1.8.15 |
| <http://downloads.asterisk.org/pub/security/AST-2014-001-11.6.diff> | Certified Asterisk 11.6 |

| **Links** | https://issues.asterisk.org/jira/browse/ASTERISK-23340 |

| Asterisk Project Security Advisories are posted at <http://www.asterisk.org/security>  This document may be superseded by later versions; if so, the latest version will be posted at http://downloads.digium.com/pub/security/AST-2014-001.pdf and http://downloads.digium.com/pub/security/AST-2014-001.html |

| **Revision History** | | |
| **Date** | **Editor** | **Revisions Made** |
| 03/10/14 | Richard Mudgett | Initial Revision. |

Asterisk
Project Security Advisory - AST-2014-001
Copyright
Â© 2014
Digium, Inc. All Rights Reserved.
Permission is hereby granted
to distribute and publish this advisory in its original, unaltered
form.


