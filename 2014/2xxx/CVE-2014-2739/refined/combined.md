=== Content from git.kernel.org_3f2cf844_20250126_123401.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Moni Shoua <monis@mellanox.com> | 2014-03-27 10:52:58 +0200 |
| --- | --- | --- |
| committer | Roland Dreier <roland@purestorage.com> | 2014-04-01 14:05:26 -0700 |
| commit | [b2853fd6c2d0f383dbdf7427e263eb576a633867](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)) | |
| tree | [c82122c657ab89679fc10a298ac3c8ffef31deac](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867) | |
| parent | [cfbf8d4857c26a8a307fb7cd258074c9dcd8c691](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cfbf8d4857c26a8a307fb7cd258074c9dcd8c691) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867&id2=cfbf8d4857c26a8a307fb7cd258074c9dcd8c691)) | |
| download | [linux-b2853fd6c2d0f383dbdf7427e263eb576a633867.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-b2853fd6c2d0f383dbdf7427e263eb576a633867.tar.gz) | |

IB/core: Don't resolve passive side RoCE L2 address in CMA REQ handlerThe code that resolves the passive side source MAC within the rdma\_cm
connection request handler was both redundant and buggy, so remove it.
It was redundant since later, when an RC QP is modified to RTR state,
the resolution will take place in the ib\_core module. It was buggy
because this callback also deals with UD SIDR exchange, for which we
incorrectly looked at the REQ member of the CM event and dereferenced
a random value.
Fixes: dd5f03beb4f7 ("IB/core: Ethernet L2 attributes in verbs/cm structures")
Signed-off-by: Moni Shoua <monis@mellanox.com>
Signed-off-by: Or Gerlitz <ogerlitz@mellanox.com>
Signed-off-by: Roland Dreier <roland@purestorage.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)

| -rw-r--r-- | [drivers/infiniband/core/cm.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/infiniband/core/cm.c?id=b2853fd6c2d0f383dbdf7427e263eb576a633867) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/infiniband/core/cma.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/infiniband/core/cma.c?id=b2853fd6c2d0f383dbdf7427e263eb576a633867) | 26 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [include/rdma/ib\_cm.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/rdma/ib_cm.h?id=b2853fd6c2d0f383dbdf7427e263eb576a633867) | 1 | |  |  |  | | --- | --- | --- | |

3 files changed, 0 insertions, 44 deletions

| diff --git a/drivers/infiniband/core/cm.c b/drivers/infiniband/core/cm.cindex 0601b9daf8407a..c3239170d8b789 100644--- a/[drivers/infiniband/core/cm.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/infiniband/core/cm.c?id=cfbf8d4857c26a8a307fb7cd258074c9dcd8c691)+++ b/[drivers/infiniband/core/cm.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/infiniband/core/cm.c?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)@@ -349,23 +349,6 @@ static void cm\_init\_av\_for\_response(struct cm\_port \*port, struct ib\_wc \*wc, grh, &av->ah\_attr); } -int ib\_update\_cm\_av(struct ib\_cm\_id \*id, const u8 \*smac, const u8 \*alt\_smac)-{- struct cm\_id\_private \*cm\_id\_priv;-- cm\_id\_priv = container\_of(id, struct cm\_id\_private, id);-- if (smac != NULL)- memcpy(cm\_id\_priv->av.smac, smac, sizeof(cm\_id\_priv->av.smac));-- if (alt\_smac != NULL)- memcpy(cm\_id\_priv->alt\_av.smac, alt\_smac,- sizeof(cm\_id\_priv->alt\_av.smac));-- return 0;-}-EXPORT\_SYMBOL(ib\_update\_cm\_av);- static int cm\_init\_av\_by\_path(struct ib\_sa\_path\_rec \*path, struct cm\_av \*av) { struct cm\_device \*cm\_dev;diff --git a/drivers/infiniband/core/cma.c b/drivers/infiniband/core/cma.cindex 199958d9ddc808..42c3058e6e9cdb 100644--- a/[drivers/infiniband/core/cma.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/infiniband/core/cma.c?id=cfbf8d4857c26a8a307fb7cd258074c9dcd8c691)+++ b/[drivers/infiniband/core/cma.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/infiniband/core/cma.c?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)@@ -1284,15 +1284,6 @@ static int cma\_req\_handler(struct ib\_cm\_id \*cm\_id, struct ib\_cm\_event \*ib\_event) struct rdma\_id\_private \*listen\_id, \*conn\_id; struct rdma\_cm\_event event; int offset, ret;- u8 smac[ETH\_ALEN];- u8 alt\_smac[ETH\_ALEN];- u8 \*psmac = smac;- u8 \*palt\_smac = alt\_smac;- int is\_iboe = ((rdma\_node\_get\_transport(cm\_id->device->node\_type) ==- RDMA\_TRANSPORT\_IB) &&- (rdma\_port\_get\_link\_layer(cm\_id->device,- ib\_event->param.req\_rcvd.port) ==- IB\_LINK\_LAYER\_ETHERNET));  listen\_id = cm\_id->context; if (!cma\_check\_req\_qp\_type(&listen\_id->id, ib\_event))@@ -1336,28 +1327,11 @@ static int cma\_req\_handler(struct ib\_cm\_id \*cm\_id, struct ib\_cm\_event \*ib\_event) ret = conn\_id->id.event\_handler(&conn\_id->id, &event); if (ret) goto err3;-- if (is\_iboe) {- if (ib\_event->param.req\_rcvd.primary\_path != NULL)- rdma\_addr\_find\_smac\_by\_sgid(- &ib\_event->param.req\_rcvd.primary\_path->sgid,- psmac, NULL);- else- psmac = NULL;- if (ib\_event->param.req\_rcvd.alternate\_path != NULL)- rdma\_addr\_find\_smac\_by\_sgid(- &ib\_event->param.req\_rcvd.alternate\_path->sgid,- palt\_smac, NULL);- else- palt\_smac = NULL;- } /\* \* Acquire mutex to prevent user executing rdma\_destroy\_id() \* while we're accessing the cm\_id. \*/ mutex\_lock(&lock);- if (is\_iboe)- ib\_update\_cm\_av(cm\_id, psmac, palt\_smac); if (cma\_comp(conn\_id, RDMA\_CM\_CONNECT) && (conn\_id->id.qp\_type != IB\_QPT\_UD)) ib\_send\_cm\_mra(cm\_id, CMA\_CM\_MRA\_SETTING, NULL, 0);diff --git a/include/rdma/ib\_cm.h b/include/rdma/ib\_cm.hindex f29e3a27c2cccc..0e3ff30647d518 100644--- a/[include/rdma/ib\_cm.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/rdma/ib_cm.h?id=cfbf8d4857c26a8a307fb7cd258074c9dcd8c691)+++ b/[include/rdma/ib\_cm.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/rdma/ib_cm.h?id=b2853fd6c2d0f383dbdf7427e263eb576a633867)@@ -601,5 +601,4 @@ struct ib\_cm\_sidr\_rep\_param { int ib\_send\_cm\_sidr\_rep(struct ib\_cm\_id \*cm\_id, struct ib\_cm\_sidr\_rep\_param \*param); -int ib\_update\_cm\_av(struct ib\_cm\_id \*id, const u8 \*smac, const u8 \*alt\_smac); #endif /\* IB\_CM\_H \*/ |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-26 12:32:39 +0000



=== Content from www.openwall.com_14326ab0_20250125_225212.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](8) [[next>]](10) [[<thread-prev]](../../../2014/04/08/6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <201404101126.s3ABQ7pe003427@linus.mitre.org>
Date: Thu, 10 Apr 2014 07:26:07 -0400 (EDT)
From: cve-assign@...re.org
To: ppandit@...hat.com
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com
Subject: Re: CVE request Linux kernel: IB/core: crash while resolving passive side RoCE L2 address in cma_req_handler

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> Linux kernel built with the InfiniBand communication link(CONFIG_INFINIBAND)
> along with the support for Remote Direct Memory Access(RDMA) over Convered
> Ethernet(RoCE), is vulnerable to a crash caused by invalid memory access.
> It occurs while trying to resolve RoCE L2 address on the server side.
>
> A remote unprivileged user/program could use this flaw to crash the kernel,
> resulting in DoS.
>
> <https://patchwork.kernel.org/patch/3896781/>
> <https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=b2853fd6c2d0f383dbdf7427e263eb576a633867>

Use CVE-2014-2739.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJTRn7rAAoJEKllVAevmvmsfTcIALjPNjHagE/k+E+Uh8x8gf4O
HmW834RHsyV+nHiwwa0TBMiE3phh9spgsLKzADsuc6Uj2v5NfW3clz8j/FJLv4vq
uAb4wCAff/YE6+al9aJOiLtDmXk4ZS5w54o9baYU+KXqAPk26lyMRVDDKJWD5h3G
QwbUhNFnWuSdXo46Q/sWC3FHgCkF6EhtgOOcGsiiPv39jdtd1HZEcuYl8tqnjVT+
fBP0bEaPQs5E7CVRQ9nnPkYRNeZSHGnibN1n1ZPykIAGxDHAjZX1sGjYfEQ6dCq9
bQce4CcFQW5wG4dnLsaMzcEmU84rjzilFYYKsh3oJFTn+575RIiOI71ZXs2ulFU=
=b+5a
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_3aad1569_20250125_225214.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fb2853fd6c2d0f383dbdf7427e263eb576a633867)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fb2853fd6c2d0f383dbdf7427e263eb576a633867)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  438](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/b2853fd6c2d0f383dbdf7427e263eb576a633867)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

IB/core: Don't resolve passive side RoCE L2 address in CMA REQ handler

[Browse files](/torvalds/linux/tree/b2853fd6c2d0f383dbdf7427e263eb576a633867)
Browse the repository at this point in the history

```
The code that resolves the passive side source MAC within the rdma_cm
connection request handler was both redundant and buggy, so remove it.

It was redundant since later, when an RC QP is modified to RTR state,
the resolution will take place in the ib_core module.  It was buggy
because this callback also deals with UD SIDR exchange, for which we
incorrectly looked at the REQ member of the CM event and dereferenced
a random value.

Fixes: [dd5f03b](https://github.com/torvalds/linux/commit/dd5f03beb4f76ae65d76d8c22a8815e424fc607c) ("IB/core: Ethernet L2 attributes in verbs/cm structures")
Signed-off-by: Moni Shoua <monis@mellanox.com>
Signed-off-by: Or Gerlitz <ogerlitz@mellanox.com>
Signed-off-by: Roland Dreier <roland@purestorage.com>
```

* Loading branch information

[![@monis410](https://avatars.githubusercontent.com/u/10449779?s=40&v=4)](/monis410) [![@rolandd](https://avatars.githubusercontent.com/u/3670?s=40&v=4)](/rolandd)

[monis410](/torvalds/linux/commits?author=monis410 "View all commits by monis410")
authored and
[rolandd](/torvalds/linux/commits?author=rolandd "View all commits by rolandd")
committed
Apr 1, 2014

1 parent
[cfbf8d4](/torvalds/linux/commit/cfbf8d4857c26a8a307fb7cd258074c9dcd8c691)

commit b2853fd

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**0 additions**
and
**44 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* drivers/infiniband/core

  + drivers/infiniband/core/cm.c
    [cm.c](#diff-f742d1921ad94a8749599868850e72c37e6ba68c0245a44008616662723e4793)
  + drivers/infiniband/core/cma.c
    [cma.c](#diff-bfc93aa0507f4bf971b43f30d45a923b07252119db26bde4f7934e6fd2470933)
* include/rdma

  + include/rdma/ib\_cm.h
    [ib\_cm.h](#diff-b376a4a0353c9034127c863faaba0b874635c80d03b4d319932d7ee1ffb5e3a8)

## There are no files selected for viewing

17 changes: 0 additions & 17 deletions

17
[drivers/infiniband/core/cm.c](#diff-f742d1921ad94a8749599868850e72c37e6ba68c0245a44008616662723e4793 "drivers/infiniband/core/cm.c")

Show comments

[View file](/torvalds/linux/blob/b2853fd6c2d0f383dbdf7427e263eb576a633867/drivers/infiniband/core/cm.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -349,23 +349,6 @@ static void cm\_init\_av\_for\_response(struct cm\_port \*port, struct ib\_wc \*wc, |
|  |  | grh, &av->ah\_attr); |
|  |  | } |
|  |  |  |
|  |  | int ib\_update\_cm\_av(struct ib\_cm\_id \*id, const u8 \*smac, const u8 \*alt\_smac) |
|  |  | { |
|  |  | struct cm\_id\_private \*cm\_id\_priv; |
|  |  |  |
|  |  | cm\_id\_priv = container\_of(id, struct cm\_id\_private, id); |
|  |  |  |
|  |  | if (smac != NULL) |
|  |  | memcpy(cm\_id\_priv->av.smac, smac, sizeof(cm\_id\_priv->av.smac)); |
|  |  |  |
|  |  | if (alt\_smac != NULL) |
|  |  | memcpy(cm\_id\_priv->alt\_av.smac, alt\_smac, |
|  |  | sizeof(cm\_id\_priv->alt\_av.smac)); |
|  |  |  |
|  |  | return 0; |
|  |  | } |
|  |  | EXPORT\_SYMBOL(ib\_update\_cm\_av); |
|  |  |  |
|  |  | static int cm\_init\_av\_by\_path(struct ib\_sa\_path\_rec \*path, struct cm\_av \*av) |
|  |  | { |
|  |  | struct cm\_device \*cm\_dev; |
| Expand Down | |  |

26 changes: 0 additions & 26 deletions

26
[drivers/infiniband/core/cma.c](#diff-bfc93aa0507f4bf971b43f30d45a923b07252119db26bde4f7934e6fd2470933 "drivers/infiniband/core/cma.c")

Show comments

[View file](/torvalds/linux/blob/b2853fd6c2d0f383dbdf7427e263eb576a633867/drivers/infiniband/core/cma.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1284,15 +1284,6 @@ static int cma\_req\_handler(struct ib\_cm\_id \*cm\_id, struct ib\_cm\_event \*ib\_event) |
|  |  | struct rdma\_id\_private \*listen\_id, \*conn\_id; |
|  |  | struct rdma\_cm\_event event; |
|  |  | int offset, ret; |
|  |  | u8 smac[ETH\_ALEN]; |
|  |  | u8 alt\_smac[ETH\_ALEN]; |
|  |  | u8 \*psmac = smac; |
|  |  | u8 \*palt\_smac = alt\_smac; |
|  |  | int is\_iboe = ((rdma\_node\_get\_transport(cm\_id->device->node\_type) == |
|  |  | RDMA\_TRANSPORT\_IB) && |
|  |  | (rdma\_port\_get\_link\_layer(cm\_id->device, |
|  |  | ib\_event->param.req\_rcvd.port) == |
|  |  | IB\_LINK\_LAYER\_ETHERNET)); |
|  |  |  |
|  |  | listen\_id = cm\_id->context; |
|  |  | if (!cma\_check\_req\_qp\_type(&listen\_id->id, ib\_event)) |
| Expand Down  Expand Up | | @@ -1336,28 +1327,11 @@ static int cma\_req\_handler(struct ib\_cm\_id \*cm\_id, struct ib\_cm\_event \*ib\_event) |
|  |  | ret = conn\_id->id.event\_handler(&conn\_id->id, &event); |
|  |  | if (ret) |
|  |  | goto err3; |
|  |  |  |
|  |  | if (is\_iboe) { |
|  |  | if (ib\_event->param.req\_rcvd.primary\_path != NULL) |
|  |  | rdma\_addr\_find\_smac\_by\_sgid( |
|  |  | &ib\_event->param.req\_rcvd.primary\_path->sgid, |
|  |  | psmac, NULL); |
|  |  | else |
|  |  | psmac = NULL; |
|  |  | if (ib\_event->param.req\_rcvd.alternate\_path != NULL) |
|  |  | rdma\_addr\_find\_smac\_by\_sgid( |
|  |  | &ib\_event->param.req\_rcvd.alternate\_path->sgid, |
|  |  | palt\_smac, NULL); |
|  |  | else |
|  |  | palt\_smac = NULL; |
|  |  | } |
|  |  | /\* |
|  |  | \* Acquire mutex to prevent user executing rdma\_destroy\_id() |
|  |  | \* while we're accessing the cm\_id. |
|  |  | \*/ |
|  |  | mutex\_lock(&lock); |
|  |  | if (is\_iboe) |
|  |  | ib\_update\_cm\_av(cm\_id, psmac, palt\_smac); |
|  |  | if (cma\_comp(conn\_id, RDMA\_CM\_CONNECT) && |
|  |  | (conn\_id->id.qp\_type != IB\_QPT\_UD)) |
|  |  | ib\_send\_cm\_mra(cm\_id, CMA\_CM\_MRA\_SETTING, NULL, 0); |
| Expand Down | |  |

1 change: 0 additions & 1 deletion

1
[include/rdma/ib\_cm.h](#diff-b376a4a0353c9034127c863faaba0b874635c80d03b4d319932d7ee1ffb5e3a8 "include/rdma/ib_cm.h")

Show comments

[View file](/torvalds/linux/blob/b2853fd6c2d0f383dbdf7427e263eb576a633867/include/rdma/ib_cm.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -601,5 +601,4 @@ struct ib\_cm\_sidr\_rep\_param { |
|  |  | int ib\_send\_cm\_sidr\_rep(struct ib\_cm\_id \*cm\_id, |
|  |  | struct ib\_cm\_sidr\_rep\_param \*param); |
|  |  |  |
|  |  | int ib\_update\_cm\_av(struct ib\_cm\_id \*id, const u8 \*smac, const u8 \*alt\_smac); |
|  |  | #endif /\* IB\_CM\_H \*/ |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b2853fd`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fb2853fd6c2d0f383dbdf7427e263eb576a633867) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from access.redhat.com_2065fe97_20250126_123403.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from patchwork.kernel.org_1eafe1e9_20250126_123402.html ===

Toggle navigation

[Patchwork](/)
Linux RDMA and InfiniBand

* [Patches](/project/linux-rdma/list/)
* [Bundles](/project/linux-rdma/bundles/)
* [About this project](/project/linux-rdma/)

* [Login](/user/login/)
* [Register](/register/)
* [Mail settings](/mail/)

3896781

[diff](/project/linux-rdma/patch/1395910378-28519-1-git-send-email-ogerlitz%40mellanox.com/raw/ "Download patch diff")
[mbox](/project/linux-rdma/patch/1395910378-28519-1-git-send-email-ogerlitz%40mellanox.com/mbox/ "Download patch mbox")
# [V2,for-next] IB/core: Don't resolve passive side RoCE L2 address in cma req handler

| Message ID | 1395910378-28519-1-git-send-email-ogerlitz@mellanox.com ([mailing list archive](https://lore.kernel.org/r/1395910378-28519-1-git-send-email-ogerlitz%40mellanox.com)) |
| --- | --- |
| State | Accepted, archived |
| Headers | show ``` Return-Path: <linux-rdma-owner@kernel.org> X-Original-To: patchwork-linux-rdma@patchwork.kernel.org Delivered-To: patchwork-parsemail@patchwork2.web.kernel.org Received: from mail.kernel.org (mail.kernel.org [198.145.19.201]) 	by patchwork2.web.kernel.org (Postfix) with ESMTP id 76603BF540 	for <patchwork-linux-rdma@patchwork.kernel.org>; 	Thu, 27 Mar 2014 08:53:35 +0000 (UTC) Received: from mail.kernel.org (localhost [127.0.0.1]) 	by mail.kernel.org (Postfix) with ESMTP id 8385520237 	for <patchwork-linux-rdma@patchwork.kernel.org>; 	Thu, 27 Mar 2014 08:53:34 +0000 (UTC) Received: from vger.kernel.org (vger.kernel.org [209.132.180.67]) 	by mail.kernel.org (Postfix) with ESMTP id 9B24520225 	for <patchwork-linux-rdma@patchwork.kernel.org>; 	Thu, 27 Mar 2014 08:53:33 +0000 (UTC) Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand 	id S1754588AbaC0Ixa (ORCPT 	<rfc822;patchwork-linux-rdma@patchwork.kernel.org>); 	Thu, 27 Mar 2014 04:53:30 -0400 Received: from mailp.voltaire.com ([193.47.165.129]:43150 "EHLO 	mellanox.co.il" 	rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org with ESMTP 	id S1753406AbaC0IxF (ORCPT <rfc822;linux-rdma@vger.kernel.org>); 	Thu, 27 Mar 2014 04:53:05 -0400 Received: from Internal Mail-Server by MTLPINE1 (envelope-from 	ogerlitz@mellanox.com) with SMTP; 27 Mar 2014 10:53:01 +0200 Received: from r-vnc04.mtr.labs.mlnx (r-vnc04.mtr.labs.mlnx [10.208.0.116]) 	by labmailer.mlnx (8.13.8/8.13.8) with ESMTP id s2R8r0RN002792; 	Thu, 27 Mar 2014 10:53:00 +0200 From: Or Gerlitz <ogerlitz@mellanox.com> To: roland@kernel.org Cc: linux-rdma@vger.kernel.org, matanb@mellanox.com, 	Moni Shoua <monis@mellanox.com>, Or Gerlitz <ogerlitz@mellanox.com> Subject: [PATCH V2 for-next] IB/core: Don't resolve passive side RoCE L2 	address in cma req handler Date: Thu, 27 Mar 2014 10:52:58 +0200 Message-Id: <1395910378-28519-1-git-send-email-ogerlitz@mellanox.com> X-Mailer: git-send-email 1.7.8.2 Sender: linux-rdma-owner@vger.kernel.org Precedence: bulk List-ID: <linux-rdma.vger.kernel.org> X-Mailing-List: linux-rdma@vger.kernel.org X-Spam-Status: No, score=-7.3 required=5.0 tests=BAYES_00, RCVD_IN_DNSWL_HI,  	RP_MATCHES_RCVD, 	UNPARSEABLE_RELAY autolearn=unavailable version=3.3.1 X-Spam-Checker-Version: SpamAssassin 3.3.1 (2010-03-16) on mail.kernel.org X-Virus-Scanned: ClamAV using ClamSMTP  ``` |

## Commit Message

[Or Gerlitz](/project/linux-rdma/list/?submitter=23341)
March 27, 2014, 8:52 a.m. UTC
```

From: Moni Shoua <monis@mellanox.com>

The code that resolves the passive side source mac within the rdma_cm
connection request handler was both redundant and buggy, remove it.

It was redundant since later, when an RC QP is modified to RTR state
the resolution will take place in the ib_core module. It was buggy b/c
this callback also deals with UD SIDR exchange under which we wrongly
looked on the REQ member of the CM event and dereferenced a random value.

Fixes: dd5f03beb4f7 'IB/core: Ethernet L2 attributes in verbs/cm structures'
Signed-off-by: Moni Shoua <monis@mellanox.com>
Signed-off-by: Or Gerlitz <ogerlitz@mellanox.com>
---

Hi Roland, we're post 3.14-rc8 and hence I assume will go to 3.15-rc1
and once there we will post it to -stable to it gets into 3.14.y

That nasty random deref wasn't causing instant crashes, but rather only
when running on lengthy QA loops, so we missed it through the submission.

V1 changes: removed unused variables from cma_req_handler

V2 changes: added pointer to the commit this fixes in the change-log

 drivers/infiniband/core/cm.c  |   17 -----------------
 drivers/infiniband/core/cma.c |   26 --------------------------
 include/rdma/ib_cm.h          |    1 -
 3 files changed, 0 insertions(+), 44 deletions(-)

```
## Comments

[Or Gerlitz](/project/linux-rdma/list/?submitter=3621)
April 1, 2014, 6:44 p.m. UTC | [#1](/comment/8320331/)
```

On Thu, Mar 27, 2014 at 11:52 AM, Or Gerlitz <ogerlitz@mellanox.com> wrote:
> From: Moni Shoua <monis@mellanox.com>
>
> The code that resolves the passive side source mac within the rdma_cm
> connection request handler was both redundant and buggy, remove it.

Hi Roland,

I see that you've picked the iser 3.15 updates which I posted  today,
thanks for the quick handling, this one you skipped, so here's a
reminder.
--
To unsubscribe from this list: send the line "unsubscribe linux-rdma" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html

```

3896781

[diff](/project/linux-rdma/patch/1395910378-28519-1-git-send-email-ogerlitz%40mellanox.com/raw/ "Download patch diff")
[mbox](/project/linux-rdma/patch/1395910378-28519-1-git-send-email-ogerlitz%40mellanox.com/mbox/ "Download patch mbox")
## Patch

```

diff --git a/drivers/infiniband/core/cm.c b/drivers/infiniband/core/cm.c
index 0601b9d..c323917 100644
--- a/drivers/infiniband/core/cm.c
+++ b/drivers/infiniband/core/cm.c
@@ -349,23 +349,6 @@  static void cm_init_av_for_response(struct cm_port *port, struct ib_wc *wc,
 			   grh, &av->ah_attr);
 }

-int ib_update_cm_av(struct ib_cm_id *id, const u8 *smac, const u8 *alt_smac)
-{
-	struct cm_id_private *cm_id_priv;
-
-	cm_id_priv = container_of(id, struct cm_id_private, id);
-
-	if (smac != NULL)
-		memcpy(cm_id_priv->av.smac, smac, sizeof(cm_id_priv->av.smac));
-
-	if (alt_smac != NULL)
-		memcpy(cm_id_priv->alt_av.smac, alt_smac,
-		       sizeof(cm_id_priv->alt_av.smac));
-
-	return 0;
-}
-EXPORT_SYMBOL(ib_update_cm_av);
-
 static int cm_init_av_by_path(struct ib_sa_path_rec *path, struct cm_av *av)
 {
 	struct cm_device *cm_dev;
diff --git a/drivers/infiniband/core/cma.c b/drivers/infiniband/core/cma.c
index 199958d..42c3058 100644
--- a/drivers/infiniband/core/cma.c
+++ b/drivers/infiniband/core/cma.c
@@ -1284,15 +1284,6 @@  static int cma_req_handler(struct ib_cm_id *cm_id, struct ib_cm_event *ib_event)
 	struct rdma_id_private *listen_id, *conn_id;
 	struct rdma_cm_event event;
 	int offset, ret;
-	u8 smac[ETH_ALEN];
-	u8 alt_smac[ETH_ALEN];
-	u8 *psmac = smac;
-	u8 *palt_smac = alt_smac;
-	int is_iboe = ((rdma_node_get_transport(cm_id->device->node_type) ==
-			RDMA_TRANSPORT_IB) &&
-		       (rdma_port_get_link_layer(cm_id->device,
-			ib_event->param.req_rcvd.port) ==
-			IB_LINK_LAYER_ETHERNET));

 	listen_id = cm_id->context;
 	if (!cma_check_req_qp_type(&listen_id->id, ib_event))
@@ -1336,28 +1327,11 @@  static int cma_req_handler(struct ib_cm_id *cm_id, struct ib_cm_event *ib_event)
 	ret = conn_id->id.event_handler(&conn_id->id, &event);
 	if (ret)
 		goto err3;
-
-	if (is_iboe) {
-		if (ib_event->param.req_rcvd.primary_path != NULL)
-			rdma_addr_find_smac_by_sgid(
-				&ib_event->param.req_rcvd.primary_path->sgid,
-				psmac, NULL);
-		else
-			psmac = NULL;
-		if (ib_event->param.req_rcvd.alternate_path != NULL)
-			rdma_addr_find_smac_by_sgid(
-				&ib_event->param.req_rcvd.alternate_path->sgid,
-				palt_smac, NULL);
-		else
-			palt_smac = NULL;
-	}
 	/*
 	 * Acquire mutex to prevent user executing rdma_destroy_id()
 	 * while we're accessing the cm_id.
 	 */
 	mutex_lock(&lock);
-	if (is_iboe)
-		ib_update_cm_av(cm_id, psmac, palt_smac);
 	if (cma_comp(conn_id, RDMA_CM_CONNECT) &&
 	    (conn_id->id.qp_type != IB_QPT_UD))
 		ib_send_cm_mra(cm_id, CMA_CM_MRA_SETTING, NULL, 0);
diff --git a/include/rdma/ib_cm.h b/include/rdma/ib_cm.h
index f29e3a2..0e3ff30 100644
--- a/include/rdma/ib_cm.h
+++ b/include/rdma/ib_cm.h
@@ -601,5 +601,4 @@  struct ib_cm_sidr_rep_param {
 int ib_send_cm_sidr_rep(struct ib_cm_id *cm_id,
 			struct ib_cm_sidr_rep_param *param);

-int ib_update_cm_av(struct ib_cm_id *id, const u8 *smac, const u8 *alt_smac);
 #endif /* IB_CM_H */

```

[patchwork](http://jk.ozlabs.org/projects/patchwork/)
patch tracking system | version v2.2.6 | [about patchwork](/about/)



=== Content from bugzilla.redhat.com_946c0a8c_20250125_225213.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1085415)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1085415)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1085415)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1085415

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1085415**](show_bug.cgi?id=1085415)
(CVE-2014-2739)
- [CVE-2014-2739](https://access.redhat.com/security/cve/CVE-2014-2739) Kernel: IB/core: crash while resolving passive side RoCE L2 address in cma req handler

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2014-2739 Kernel: IB/core: crash while resolving passive side RoCE L2 add...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2014-2739 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1082033](show_bug.cgi?id=1082033) | | TreeView+ | [depends on](buglist.cgi?bug_id=1085415&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1085415&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2014-04-08 14:32 UTC by Prasad Pandit | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-02-17 06:42 UTC ([History](show_activity.cgi?id=1085415)) | | [CC List:](page.cgi?id=fields.html#cclist) | 31 users (show)  agordeev anton aquini bhu davej dhoward esammons fhrbata gansalmon iboverma itamar jforbes jkacur jkurik jonathan jross jwboyer kernel-maint kernel-mgr lgoncalv lwang madhu.chinakonda matt mchehab mcressma npajkovs pholasek plougher rt-maint rvrbovsk williams | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2014-06-16 13:24:09 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1085415#c0)  Prasad Pandit    2014-04-08 14:32:33 UTC  ``` Linux kernel built with the InfiniBand communication link(CONFIG_INFINIBAND) along with the support for Remote Direct Memory Access(RDMA) over Convered Ethernet(RoCE), is vulnerable to a crash caused by invalid memory access. It occurs while trying to resolve RoCE L2 address on the server side.  A remote unprivileged user/program could use this flaw to crash the kernel, resulting in DoS.  Upstream fix: -------------   -> <http://git.kernel.org/linus/b2853fd6c2d0f383dbdf7427e263eb576a633867>  Issue introduced by commit:  -> <https://git.kernel.org/linus/dd5f03beb4f76ae65d76d8c22a8815e424fc607c>   ```  [Comment 2](show_bug.cgi?id=1085415#c2)  Prasad Pandit    2014-04-10 11:41:58 UTC  ``` Statement:  This issue does not affect the versions of the kernel package as shipped with Red Hat Enterprise Linux 5, 6 and Red Hat Enterprise MRG 2.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1085415&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)


