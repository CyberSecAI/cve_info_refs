=== Content from blog.mozilla.org_214f5ef1_20250126_064139.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_1302ecb4_20250125_062758.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1020041)
* [XML](/show_bug.cgi?ctype=xml&id=1020041)

Closed
[Bug 1020041](/show_bug.cgi?id=1020041)

Opened 11 years ago
Closed 11 years ago

# nsStandardURL::SetHost called net\_ToLowerCase with a bogus pointer, #3

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

nsStandardURL::SetHost called net\_ToLowerCase with a bogus pointer, #3

## Categories

### (Core :: Networking, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking#Networking)

Networking
▾

Core :: Networking
For bugs in Mozilla's modular networking library (aka "Netlib" or "Necko".) The networking library supplies the software interface that Mozilla uses to access physical transports (e.g. the Internet and local drives), perform URL resolutions, and handle a variety of networking protocols.

Examples of appropriate bugs: URLs with backslash not fetched; URLs starting with a single slash turn into http:///; Cannot access authenticated FTP site.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified) |
| firefox32 | [+](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified) |
| firefox33 | --- | [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed) |
| b2g-v1.3T | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=fixed) |
| b2g-v1.4 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |
| b2g-v2.1 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 |  | verified |
| firefox32 | + | verified |
| firefox33 |  | verified |
| firefox-esr24 |  | unaffected |
| b2g-v1.3 |  | fixed |
| b2g-v1.3T |  | fixed |
| b2g-v1.4 |  | fixed |
| b2g-v2.0 |  | fixed |
| b2g-v2.1 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: baku)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=40)  [baku](/user_profile?user_id=446257)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[fuzz-urlutils](/show_bug.cgi?id=1020040 "NEW - [meta] Fuzz URLUtils interface and DOM URL objects")

Dependency [tree](/showdependencytree.cgi?id=1020041&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1020041)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[qawanted](/buglist.cgi?keywords=qawanted&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c27 "11 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 4 obsolete files)

| [testcase (crashes Firefox)](/attachment.cgi?id=8433759)  [11 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   285 bytes, text/html |  | [Details](/attachment.cgi?id=8433759&action=edit) |
| --- | --- | --- |
| [stack](/attachment.cgi?id=8433761)  [11 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   10.79 KB, text/plain |  | [Details](/attachment.cgi?id=8433761&action=edit) |
| [bug.patch](/attachment.cgi?id=8434155)  [11 years ago](#c5)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   14.52 KB, patch |  | [Details](/attachment.cgi?id=8434155&action=edit) | [Diff](/attachment.cgi?id=8434155&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434155) |
| [bug.patch](/attachment.cgi?id=8434195)  [11 years ago](#c9)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   5.19 KB, patch |  | [Details](/attachment.cgi?id=8434195&action=edit) | [Diff](/attachment.cgi?id=8434195&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434195) |
| [bug.patch](/attachment.cgi?id=8434263)  [11 years ago](#c12)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   6.24 KB, patch | jduell.mcbugs : [review+](#c14 "11 years ago") | [Details](/attachment.cgi?id=8434263&action=edit) | [Diff](/attachment.cgi?id=8434263&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434263) |
| [bug.patch](/attachment.cgi?id=8436922)  [11 years ago](#c15)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   8.91 KB, patch | valentin : [review+](#c19 "11 years ago")  valentin : [feedback+](#c17 "11 years ago")  lmandel : [approval-mozilla-aurora+](#c23 "11 years ago") | [Details](/attachment.cgi?id=8436922&action=edit) | [Diff](/attachment.cgi?id=8436922&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922) |
| [beta](/attachment.cgi?id=8441961)  [11 years ago](#c24)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   8.41 KB, patch | valentin : [review+](#c26 "11 years ago") | [Details](/attachment.cgi?id=8441961&action=edit) | [Diff](/attachment.cgi?id=8441961&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8441961) |
| [id.patch](/attachment.cgi?id=8442434)  [11 years ago](#c28)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   1.57 KB, patch | valentin : [review+](#a1285039_415378 "11 years ago") | [Details](/attachment.cgi?id=8442434&action=edit) | [Diff](/attachment.cgi?id=8442434&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8442434) |
| [beta](/attachment.cgi?id=8442435)  [11 years ago](#c29)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   8.84 KB, patch | valentin : [review+](#a1357134_415378 "11 years ago")  Sylvestre : [approval-mozilla-beta+](#a1411228_495955 "11 years ago")  Sylvestre : [approval-mozilla-release-](#c45 "11 years ago") | [Details](/attachment.cgi?id=8442435&action=edit) | [Diff](/attachment.cgi?id=8442435&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8442435) |
| [b2g](/attachment.cgi?id=8445341)  [11 years ago](#c40)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   8.83 KB, patch |  | [Details](/attachment.cgi?id=8445341&action=edit) | [Diff](/attachment.cgi?id=8445341&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8445341) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1020041#c0)• 11 years ago |
|  | |

Attached file
[testcase (crashes Firefox)](attachment.cgi?id=8433759)
— [Details](attachment.cgi?id=8433759&action=edit)

Same symptoms as [bug 991471](/show_bug.cgi?id=991471 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer") and [bug 1005578](/show_bug.cgi?id=1005578 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #2"), different testcase.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1020041#c1)• 11 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=8433761)
— [Details](attachment.cgi?id=8433761&action=edit)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1020041#c2)• 11 years ago |
|  | |

I think the main problem is that SetHost does not validate the hostname. When we set the hostname to '?' and then the pathname to 'j', nsStandardURL parses the new URL and considers '?' as the beginning of the query string.
var url = new URL("<http://foo.bar/j>");
url.host = '?';
url.pathname = 'j'
alert(url.host) // expected '?' but it shows ''
alert(url.searchParam) // expected '', it shows '?/j'

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a43519_446257)• 11 years ago |

Assignee: nobody → amarchesiniFlags: needinfo?(bzbarsky)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a43536_446257)• 11 years ago |

Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1020041#c3)• 11 years ago |
|  | |

Very probable, yes. In general, none of the nsIURI stuff expects to be directly exposed to web pages... and until URL it wasn't.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1020041#c4)• 11 years ago |
|  | |

The validation should probably be done in nsStandardURL::ValidIPv6orHostname.
I can do it if that's ok.

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1020041#c5)• 11 years ago |
|  | |

Attached patch

[bug.patch](attachment.cgi?id=8434155&action=diff) (obsolete)
— [Details](attachment.cgi?id=8434155&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434155)

[Attachment #8434155](/attachment.cgi?id=8434155&action=edit "bug.patch") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1020041#c6)• 11 years ago |
|  | |

Comment on [attachment 8434155](/attachment.cgi?id=8434155 "bug.patch") [[details]](/attachment.cgi?id=8434155&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8434155&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434155)
bug.patch
1) I'm not a necko peer, so you'll need someone else to review the nsStandardURL change.
2) What does the spec say to do here? I thought we tried pretty hard to not have any of these setters ever throw on HTMLAnchorElement (no-opping instead of throwing, basically), but what ended up in the spec?Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1020041#c7)• 11 years ago |
|  | |

> 2) What does the spec say to do here? I thought we tried pretty hard to
> not have any of these setters ever throw on HTMLAnchorElement (no-opping
> instead of throwing, basically), but what ended up in the spec?
<http://url.spec.whatwg.org/#host-state> and <http://url.spec.whatwg.org/#concept-host-parser> talk about 'return failure'. Annevk?Flags: needinfo?(amarchesini) → needinfo?(annevk)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a47323_446257)• 11 years ago |

[Attachment #8434155](/attachment.cgi?id=8434155&action=edit "bug.patch") -
Flags: review?(bzbarsky) → review?(jduell.mcbugs)

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1020041#c8)• 11 years ago |
|  | |

If you set .host to "?" buffer will be the empty string when the host parser is invoked on it. That returns failure because it does not support empty host names. That means the URL remains unchanged and no exceptions are thrown.

|  | [Anne (:annevk)](/user_profile?user_id=102998) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a47539_102998)• 11 years ago |

Flags: needinfo?(annevk)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1020041#c9)• 11 years ago |
|  | |

Attached patch

[bug.patch](attachment.cgi?id=8434195&action=diff) (obsolete)
— [Details](attachment.cgi?id=8434195&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434195)

No exceptions are thrown with this patch.
[Attachment #8434155](/attachment.cgi?id=8434155&action=edit "bug.patch") -
Attachment is obsolete: true
[Attachment #8434155](/attachment.cgi?id=8434155&action=edit "bug.patch") -
Flags: review?(jduell.mcbugs)
[Attachment #8434195](/attachment.cgi?id=8434195&action=edit "bug.patch") -
Flags: review?(jduell.mcbugs)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1020041#c10)• 11 years ago |
|  | |

I don't think the check in nsStandardURL is correct. First of all SetHostPort isn't even called when doing url.hostname = "?"
Maybe moving it to ValidIPv6orHostname would be a better idea?Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1020041#c11)• 11 years ago |
|  | |

(In reply to Valentin Gosu [:valentin] from [comment #10](/show_bug.cgi?id=1020041#c10 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #3"))
> I don't think the check in nsStandardURL is correct. First of all
> SetHostPort isn't even called when doing url.hostname = "?"
> Maybe moving it to ValidIPv6orHostname would be a better idea?
if the hostname is: 'some.thing?' this is not "invalid" for the URL API but just "some.thing" must be used as hostname. This is the reason why ValidIPv6orHostname is not the right place for this check.
I'm adding a similar check in SetHost.Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1020041#c12)• 11 years ago |
|  | |

Attached patch

[bug.patch](attachment.cgi?id=8434263&action=diff) (obsolete)
— [Details](attachment.cgi?id=8434263&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434263)

[Attachment #8434195](/attachment.cgi?id=8434195&action=edit "bug.patch") -
Attachment is obsolete: true
[Attachment #8434195](/attachment.cgi?id=8434195&action=edit "bug.patch") -
Flags: review?(jduell.mcbugs)
[Attachment #8434263](/attachment.cgi?id=8434263&action=edit "bug.patch") -
Flags: review?(jduell.mcbugs)

|  | [David Bolter [:davidb] (NeedInfo me for attention)](/user_profile?user_id=152868) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1020041#c13)• 11 years ago |
|  | |

How far back does this bug go (FF version)?
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)
[tracking-firefox32](/buglist.cgi?f1=cf_tracking_firefox32&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%2B)

|  | [Jason Duell](/user_profile?user_id=334931) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1020041#c14)• 11 years ago |
|  | |

Comment on [attachment 8434263](/attachment.cgi?id=8434263 "bug.patch") [[details]](/attachment.cgi?id=8434263&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8434263&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434263)
bug.patch
Review of [attachment 8434263](/attachment.cgi?id=8434263 "bug.patch") [[details]](/attachment.cgi?id=8434263&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8434263&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8434263):
-----------------------------------------------------------------
> I'm not a necko peer, so you'll need someone else to review
bz: consider yourself delegated to review URI stuff (and really, most other necko stuff) whenever it's expedient. You actually know it better than anyone else. That said I know you're busy.
The patch looks fine to me, but this is one of the first times I've looked at this code. So I'd like Valentin, who's been fixing this code recently, to also review.
::: netwerk/base/src/nsStandardURL.cpp
@@ +1509,5 @@
> + nsACString::const\_iterator start, end;
> + hostname.BeginReading(start);
> + hostname.EndReading(end);
> +
> + const char limit[] = { '/', '\\', '?', '#', 0 };
It would be nice to have some of this code--at least the list of chars?--in a single function or macro, etc. Not a deal-breaker, though--I can live with it, it's not that much code duplication.
[Attachment #8434263](/attachment.cgi?id=8434263&action=edit "bug.patch") -
Flags: review?(valentin.gosu)
[Attachment #8434263](/attachment.cgi?id=8434263&action=edit "bug.patch") -
Flags: review?(jduell.mcbugs)
[Attachment #8434263](/attachment.cgi?id=8434263&action=edit "bug.patch") -
Flags: review+

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1020041#c15)• 11 years ago |
|  | |

Attached patch

[bug.patch](attachment.cgi?id=8436922&action=diff)
— [Details](attachment.cgi?id=8436922&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922)

I moved the check in a method called FindHostLimit.
[Attachment #8434263](/attachment.cgi?id=8434263&action=edit "bug.patch") -
Attachment is obsolete: true
[Attachment #8434263](/attachment.cgi?id=8434263&action=edit "bug.patch") -
Flags: review?(valentin.gosu)
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: review?(valentin.gosu)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1020041#c16)• 11 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=7f21e1564560> green on try

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1020041#c17)• 11 years ago |
|  | |

Comment on [attachment 8436922](/attachment.cgi?id=8436922 "bug.patch") [[details]](/attachment.cgi?id=8436922&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8436922&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922)
bug.patch
r? :mcmanus, since I am not a Necko peer.
But it all looks good to me.
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: review?(valentin.gosu)
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: review?(mcmanus)
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: feedback+

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1020041#c18)• 11 years ago |
|  | |

Comment on [attachment 8436922](/attachment.cgi?id=8436922 "bug.patch") [[details]](/attachment.cgi?id=8436922&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8436922&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922)
bug.patch
Review of [attachment 8436922](/attachment.cgi?id=8436922 "bug.patch") [[details]](/attachment.cgi?id=8436922&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8436922&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922):
-----------------------------------------------------------------
I'll delegate the review to valentin
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: review?(mcmanus) → review?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1020041#c19)• 11 years ago |
|  | |

Comment on [attachment 8436922](/attachment.cgi?id=8436922 "bug.patch") [[details]](/attachment.cgi?id=8436922&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8436922&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922)
bug.patch
Review of [attachment 8436922](/attachment.cgi?id=8436922 "bug.patch") [[details]](/attachment.cgi?id=8436922&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8436922&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922):
-----------------------------------------------------------------
The patch looks good. r=me with the following change
::: netwerk/base/src/nsStandardURL.cpp
@@ +1464,5 @@
> // if the first char isn't [ then there should be no ] character
> return NS\_ERROR\_MALFORMED\_URI;
> }
> +
> + FindHostLimit(start, end);
The ipv6 case bypasses this check.
Move the check right before << if (\*start == '[') { >>
and add another test for { host: '[2001::1]#bla:10', expected: '[2001::1]'}
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: review?(valentin.gosu) → review+

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1020041#c20)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/412a7f011ebb>

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1020041#c21)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/412a7f011ebb>
Does this need uplifted to Aurora now that the trains moved?Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Flags: needinfo?(amarchesini)Resolution: --- → FIXEDTarget Milestone: --- → mozilla33

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1020041#c22)• 11 years ago |
|  | |

Comment on [attachment 8436922](/attachment.cgi?id=8436922 "bug.patch") [[details]](/attachment.cgi?id=8436922&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8436922&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922)
bug.patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): 887364
User impact if declined: a crash
Testing completed (on m-c, etc.): m-c
Risk to taking this patch (and alternatives if risky): This patch touches nsStnadardURL that is a important component in gecko, but it has been reviewed by 2 necko peers and the change is not so complex.
String or IDL/UUID changes made by this patch: none
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: approval-mozilla-aurora?Flags: needinfo?(amarchesini)

|  | [Lawrence Mandel [:lmandel] (use needinfo)](/user_profile?user_id=424995) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1020041#c23)• 11 years ago |
|  | |

Comment on [attachment 8436922](/attachment.cgi?id=8436922 "bug.patch") [[details]](/attachment.cgi?id=8436922&action=edit "bug.patch") [[diff]](/attachment.cgi?id=8436922&action=diff "bug.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8436922)
bug.patch
Aurora approval granted.
Given that this is sec-critical and, according to the referenced bug, introduced in Firefox 26, I think we need to consider taking this on beta as well. If you agree, please request beta approval and ensure that the patch applies cleanly on beta as well.
[Attachment #8436922](/attachment.cgi?id=8436922&action=edit "bug.patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1020041#c24)• 11 years ago |
|  | |

Attached patch

[beta](attachment.cgi?id=8441961&action=diff) (obsolete)
— [Details](attachment.cgi?id=8441961&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8441961)

This patch is fore beta. Changes:
1. FindHostLimit is not used in SetHostPort because this calls SetHost.
2. The test test\_url\_malformedHost.html doesn't parse [2001::1] and this check has been removed.
[Attachment #8441961](/attachment.cgi?id=8441961&action=edit "beta") -
Flags: review?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1020041#c25)• 11 years ago |
|  | |

(In reply to Andrea Marchesini (:baku) from [comment #24](/show_bug.cgi?id=1020041#c24 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #3"))
> Created [attachment 8441961](/attachment.cgi?id=8441961 "beta") [[details]](/attachment.cgi?id=8441961&action=edit "beta") [[diff]](/attachment.cgi?id=8441961&action=diff "beta") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8441961)
> beta
>
> This patch is fore beta. Changes:
>
> 1. FindHostLimit is not used in SetHostPort because this calls SetHost.
> 2. The test test\_url\_malformedHost.html doesn't parse [2001::1] and this
> check has been removed.
Hi Andrea,
Please keep the call in SetHostPort and change the test to
{ host: 'abcd#bla:10', expected: 'abcd'}
According to the spec, the parsing should not move past the # marker.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1020041#c26)• 11 years ago |
|  | |

Comment on [attachment 8441961](/attachment.cgi?id=8441961 "beta") [[details]](/attachment.cgi?id=8441961&action=edit "beta") [[diff]](/attachment.cgi?id=8441961&action=diff "beta") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8441961)
beta
Review of [attachment 8441961](/attachment.cgi?id=8441961 "beta") [[details]](/attachment.cgi?id=8441961&action=edit "beta") [[diff]](/attachment.cgi?id=8441961&action=diff "beta") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8441961):
-----------------------------------------------------------------
r+ with the issues noted in [comment 25](/show_bug.cgi?id=1020041#c25 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #3").
[Attachment #8441961](/attachment.cgi?id=8441961&action=edit "beta") -
Flags: review?(valentin.gosu) → review+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1020041#c27)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/b110a17ac17b>
(In reply to Lawrence Mandel [:lmandel] from [comment #23](/show_bug.cgi?id=1020041#c23 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #3"))
> Given that this is sec-critical and, according to the referenced bug,
> introduced in Firefox 26, I think we need to consider taking this on beta as
> well. If you agree, please request beta approval and ensure that the patch
> applies cleanly on beta as well.
Taking that one step further, this should have had security approval before ever landing in the first place. And probably not with a test. And we may want to consider this as a ride-along in the event of an Fx30 chemspill release.
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)Flags: in-testsuite+

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1020041#c28)• 11 years ago |
|  | |

Attached patch

[id.patch](attachment.cgi?id=8442434&action=diff)
— [Details](attachment.cgi?id=8442434&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8442434)

Interdiff for the beta.
[Attachment #8442434](/attachment.cgi?id=8442434&action=edit "id.patch") -
Flags: review?(valentin.gosu)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1020041#c29)• 11 years ago |
|  | |

Attached patch

[beta](attachment.cgi?id=8442435&action=diff)
— [Details](attachment.cgi?id=8442435&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8442435)

it should be OK, but if you can take another glance.
[Attachment #8441961](/attachment.cgi?id=8441961&action=edit "beta") -
Attachment is obsolete: true
[Attachment #8442435](/attachment.cgi?id=8442435&action=edit "beta") -
Flags: review?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a1285039_415378)• 11 years ago |

[Attachment #8442434](/attachment.cgi?id=8442434&action=edit "id.patch") -
Flags: review?(valentin.gosu) → review+

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1020041#c30)• 11 years ago |
|  | |

Comment on [attachment 8442435](/attachment.cgi?id=8442435 "beta") [[details]](/attachment.cgi?id=8442435&action=edit "beta") [[diff]](/attachment.cgi?id=8442435&action=diff "beta") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8442435)
beta
[Approval Request Comment]
Bug caused by (feature/regressing bug #): 887364
User impact if declined: a crash
Testing completed (on m-c, etc.): m-c
Risk to taking this patch (and alternatives if risky): This patch touches nsStnadardURL that is a important component in gecko, but it has been reviewed by 2 necko peers and the change is not so complex.
String or IDL/UUID changes made by this patch: none
[Attachment #8442435](/attachment.cgi?id=8442435&action=edit "beta") -
Flags: approval-mozilla-beta?

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a1357134_415378)• 11 years ago |

[Attachment #8442435](/attachment.cgi?id=8442435&action=edit "beta") -
Flags: review?(valentin.gosu) → review+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a1411228_495955)• 11 years ago |

[Attachment #8442435](/attachment.cgi?id=8442435&action=edit "beta") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a1411271_495955)• 11 years ago |

Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---),
[verifyme](/buglist.cgi?keywords=verifyme&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1020041#c31)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/ca2e553fcd1b>
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1020041#c32)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g30_v1_4/rev/c2e0f245d909>
<https://hg.mozilla.org/releases/mozilla-b2g28_v1_3/rev/3373cd35d4c7>
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1020041#c33)• 11 years ago |
|  | |

Comment on [attachment 8442435](/attachment.cgi?id=8442435 "beta") [[details]](/attachment.cgi?id=8442435&action=edit "beta") [[diff]](/attachment.cgi?id=8442435&action=diff "beta") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8442435)
beta
We should consider this for an Fx30 chemspill release if we end up making one given that it's a sec-crit that landed w/o sec-approval and with tests no less.
[Attachment #8442435](/attachment.cgi?id=8442435&action=edit "beta") -
Flags: approval-mozilla-release?

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1020041#c34)• 11 years ago |
|  | |

Will leave the nom so it's on our radar, but this is a long-time issue and not a serious driver for a chemspill. We're still continuing to collect data and will look at this as a ridealong should the need arise.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1020041#c35)• 11 years ago |
|  | |

Backed out from b2g28 and b2g30 for test failures. Andrea, any idea what the problem is?
<https://hg.mozilla.org/releases/mozilla-b2g30_v1_4/rev/4e9d3d4412f9>
<https://hg.mozilla.org/releases/mozilla-b2g28_v1_3/rev/295033efc42e>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=42301777&tree=Mozilla-B2g30-v1.4>
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected)Flags: needinfo?(amarchesini)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1020041#c36)• 11 years ago |
|  | |

I think the problem is before [Bug 996055](/show_bug.cgi?id=996055 "RESOLVED FIXED - Prevent url.hostname from clearing the hostname") you were allowed to set an empty hostname.
We could either uplift that one too, or change the tests to take this issue into account.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1020041#c37)• 11 years ago |
|  | |

Let's modify the tests. Thanks!Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1020041#c38)• 11 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM UTC-4] from [comment #37](/show_bug.cgi?id=1020041#c37 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #3"))
> Let's modify the tests. Thanks!
Should I modify the test? or somebody else is doing it?Flags: needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1020041#c39)• 11 years ago |
|  | |

As the original test author, it would be good if you did :)Flags: needinfo?(ryanvm)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1020041#c40)• 11 years ago |
|  | |

Attached patch

[b2g](attachment.cgi?id=8445341&action=diff)
— [Details](attachment.cgi?id=8445341&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8445341)

Test updated: <https://tbpl.mozilla.org/?tree=Try&rev=8c2f215517c4>

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1020041#c41)• 11 years ago |
|  | |

RyanMV, should you take care of this patch when/if green on try? Thanks.Flags: needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1020041#c42)• 11 years ago |
|  | |

Sure thing :)Flags: needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1020041#c43)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-b2g30_v1_4/rev/da45cc741860>
<https://hg.mozilla.org/releases/mozilla-b2g28_v1_3/rev/8405b3819ac8>
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a1807391_75935)• 11 years ago |

[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a2501407_272375)• 11 years ago |

[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1020041#c44)• 11 years ago |
|  | |

Reproduced the original issue from [comment #0](/show_bug.cgi?id=1020041#c0 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #3") using the following build: (crashed as soon as the poc was opened)
\* <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014/06/2014-06-04-03-02-02-mozilla-central/>
Went through verification using the following builds:
\* fx-33.0a1:
\*\* OSX 10.9.4 x64: [Passed]
\*\* Ubuntu 13.10 x64: [Passed]
\*\* Win 8.1 x64: [Passed]
\*\* Build Used: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-08-03-02-03-mozilla-central/>
\* fx-32.0a2:
\*\* OSX 10.9.4 x64: [Passed]
\*\* Ubuntu 13.10 x64: [Passed]
\*\* Win 8.1 x64: [Passed]
\*\* Build Used: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-08-00-40-01-mozilla-aurora/>
\* fx-31.0b8:
\*\* OSX 10.9.4 x64: [Passed]
\*\* Ubuntu 13.10 x64: [Passed]
\*\* Win 8.1 x64: [Passed]
\*\* Build Used: <http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/31.0b8/>Status: RESOLVED → VERIFIED
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a3106013_280903)• 11 years ago |

[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)Whiteboard: [adv-main31+]

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1020041#c45)• 11 years ago |
|  | |

Comment on [attachment 8442435](/attachment.cgi?id=8442435 "beta") [[details]](/attachment.cgi?id=8442435&action=edit "beta") [[diff]](/attachment.cgi?id=8442435&action=diff "beta") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020041&attachment=8442435)
beta
31 is going to ship next week. So, not taking the patch in release.
[Attachment #8442435](/attachment.cgi?id=8442435&action=edit "beta") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a39331635_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020041#a63235851_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1020041&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_404f4ca7_20250125_062811.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1035438)
* [XML](/show_bug.cgi?ctype=xml&id=1035438)

Closed
[Bug 1035438](/show_bug.cgi?id=1035438)

Opened 11 years ago
Closed 11 years ago

# AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack

## Categories

### (Core :: Graphics: Text, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20Text#Graphics%3A%20Text)

Graphics: Text
▾

Core :: Graphics: Text

Issues with glyph rasterization and painting, font format support, and interfacing with platform font APIs. For issues with font selection, text shaping, and glyph selection, see the Layout: Text and Fonts component.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20Text)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) |
| firefox33 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) |
| b2g-v1.3T | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |
| b2g-v2.0 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected) |
| b2g-v2.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 |  | fixed |
| firefox32 |  | fixed |
| firefox33 |  | fixed |
| firefox-esr24 |  | unaffected |
| b2g-v1.3 |  | unaffected |
| b2g-v1.3T |  | unaffected |
| b2g-v1.4 |  | unaffected |
| b2g-v2.0 |  | unaffected |
| b2g-v2.1 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/029a38b9773f1943419c24b7c3d93761?d=mm&size=40)  [lsalzman](/user_profile?user_id=536714)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

### (Blocks 1 open bug, [URL](http://spectrum.ieee.org/static/interactive-the-top-programming-languages "http://spectrum.ieee.org/static/interactive-the-top-programming-languages") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")

Dependency [tree](/showdependencytree.cgi?id=1035438&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1035438)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[spectrum.ieee.org/static/interactive-...](http://spectrum.ieee.org/static/interactive-the-top-programming-languages "http://spectrum.ieee.org/static/interactive-the-top-programming-languages")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reproducible, sec-low, Whiteboard: [adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack](/attachment.cgi?id=8451933)  [11 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   9.02 KB, text/plain |  | [Details](/attachment.cgi?id=8451933&action=edit) |
| --- | --- | --- |
| [ensure tags are limited to 4 chars in OTS error messages.](/attachment.cgi?id=8452165)  [11 years ago](#c3)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   8.49 KB, patch | jtd : [review+](#a56637_280585 "11 years ago")  Sylvestre : [approval-mozilla-aurora+](#c10 "11 years ago")  Sylvestre : [approval-mozilla-beta+](#c10 "11 years ago") | [Details](/attachment.cgi?id=8452165&action=edit) | [Diff](/attachment.cgi?id=8452165&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1035438&attachment=8452165) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1035438#c0)• 11 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=8451933)
— [Details](attachment.cgi?id=8451933&action=edit)

+++ This bug was initially created as a clone of [Bug #1030667](/show_bug.cgi?id=1030667 "RESOLVED FIXED - AddressSanitizer: double-free with zero-length XHR, depending on behavior of realloc(p, 0)") +++
+++ This bug was initially created as a clone of [Bug #1023758](/show_bug.cgi?id=1023758 "RESOLVED FIXED - Incremental cycle collection does not properly handle dead traversed nodes, leading to CSS use-after-free") +++
+++ This bug was initially created as a clone of [Bug #1021612](/show_bug.cgi?id=1021612 "VERIFIED FIXED - AddressSanitizer: heap-buffer-overflow [@ mozilla::net::CacheFileMetadata::OnDataRead]") +++
I tested Steven's asan build ( <http://people.mozilla.org/~stmichaud/bmo/firefox-asan.dmg> ) from Jul 02 ([bug 1030667 comment 30](/show_bug.cgi?id=1030667#c30 "RESOLVED FIXED - AddressSanitizer: double-free with zero-length XHR, depending on behavior of realloc(p, 0)")) and when I went to <http://spectrum.ieee.org/static/interactive-the-top-programming-languages> , the asan build crashed with a stack buffer overflow with gfxUserFontSet::OTSMessage on the stack.
Steven Michaud could reproduce this on 10.8.5 and I reproduced this on 10.9.4. He advises that this might be a font issue, so cc'ing John Daggett and Jonathan Kew.
Setting s-s and sec-critical until we know what is going on. Please feel free to re-rate this as necessary. Setting needinfo? from John and Jonathan.Flags: needinfo?(jfkthame)Flags: needinfo?(jdaggett)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1035438#c1)• 11 years ago |
|  | |

By the way, someone should test with a Linux ASan build:
<https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Firefox_and_Address_Sanitizer#Public_Builds>

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1035438#c2)• 11 years ago |
|  | |

Looks like this is an OTS bug; it (consistently) has things like
return OTS\_FAILURE\_MSG("Failed to read script header for table %4s", (char \*)&tag);
where I believe it should have
return OTS\_FAILURE\_MSG("Failed to read script header for table %4.4s", (char \*)&tag);
to ensure that it doesn't attempt to write more than 4 chars for the (32-bit) tag.
I'll report this upstream, and work up a patch shortly.
I don't think this is too dangerous, AFAICS. It means we'll potentially include some garbage bytes (whatever happens to be on the stack adjacent to the tag being printed) in the console messages OTS logs for downloadable font errors, but those messages are purely informational. We won't overrun the buffer where the message is being generated (thus trampling other stack contents), as that's done with vsnprintf, passing sizeof(buf) as a safe length limit.Flags: needinfo?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1035438#c3)• 11 years ago |
|  | |

Attached patch

[ensure tags are limited to 4 chars in OTS error messages.](attachment.cgi?id=8452165&action=diff)
— [Details](attachment.cgi?id=8452165&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1035438&attachment=8452165)

This should prevent the ASan errors due to trying to read tags as strings. Also submitted as PR to upstream: <https://github.com/khaledhosny/ots/pull/30>.
[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: review?(jdaggett)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1035438#a56637_280585)• 11 years ago |

[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: review?(jdaggett) → review+Flags: needinfo?(jdaggett)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1035438#c4)• 11 years ago |
|  | |

Downgrading this to sec-low, as I don't think anything sinister can actually be done here... just possibly, it might lead to a crash if we try to read an inaccessible location, but even that seems unlikely; in practice, the only effect I expect is a garbage byte or two within the text of a console-log message.Keywords: [sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---) → [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1035438#c5)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/373ec3f226af>Assignee: nobody → jfkthameSeverity: critical → normalTarget Milestone: --- → mozilla33

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1035438#c6)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/373ec3f226af>
Does this need to get to Aurora or Beta?Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Flags: needinfo?(jfkthame)Resolution: --- → FIXED

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1035438#c7)• 11 years ago |
|  | |

I don't think it's essential, since AFAICS there's nothing really dangerous here; but OTOH it's clearly a code bug with a simple and safe fix, and cleaning this up will improve things for anyone who tries to run ASan builds.
So I'll nominate the patch, and see what drivers decide.Flags: needinfo?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1035438#c8)• 11 years ago |
|  | |

Comment on [attachment 8452165](/attachment.cgi?id=8452165 "ensure tags are limited to 4 chars in OTS error messages.") [[details]](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") [[diff]](/attachment.cgi?id=8452165&action=diff "ensure tags are limited to 4 chars in OTS error messages.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1035438&attachment=8452165)
ensure tags are limited to 4 chars in OTS error messages.
Approval Request Comment
[Feature/regressing bug #]:
Bug in upstream OTS (now fixed there).
[User impact if declined]:
Minor: potential garbage character(s) in certain console log warnings for downloadable fonts.
Possible crash for developers/testers who run ASan or similar strict-memory-checking tools; risk of a crash in a standard release build is probably minimal.
[Describe test coverage new/current, TBPL]:
Landed in m-c; tested locally. We don't have specific unit tests for the precise content of the warning messages; that would be a pain to maintain in the face of upstream changes.
[Risks and why]:
No risk, just enforces correct field width in printf strings.
[String/UUID change made/needed]:
None.
[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: approval-mozilla-beta?
[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: approval-mozilla-aurora?

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1035438#a124178_495955)• 11 years ago |

[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=%3F)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1035438#c9)• 11 years ago |
|  | |

Is ESR affected?

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1035438#c10)• 11 years ago |
|  | |

Comment on [attachment 8452165](/attachment.cgi?id=8452165 "ensure tags are limited to 4 chars in OTS error messages.") [[details]](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") [[diff]](/attachment.cgi?id=8452165&action=diff "ensure tags are limited to 4 chars in OTS error messages.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1035438&attachment=8452165)
ensure tags are limited to 4 chars in OTS error messages.
Low risk and 31 is an ESR. Taking it
[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: approval-mozilla-beta?
[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: approval-mozilla-beta+
[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: approval-mozilla-aurora?
[Attachment #8452165](/attachment.cgi?id=8452165&action=edit "ensure tags are limited to 4 chars in OTS error messages.") -
Flags: approval-mozilla-aurora+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1035438#c11)• 11 years ago |
|  | |

(In reply to Sylvestre Ledru [:sylvestre] from [comment #9](/show_bug.cgi?id=1035438#c9 "VERIFIED FIXED - AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack"))
> Is ESR affected?
ESR24 is not affected; the bug arrived with the OTS update we took in [bug 941019](/show_bug.cgi?id=941019 "RESOLVED FIXED - Update OTS to r106 or Later"), which landed for mozilla-29.
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1035438#c12)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/15c397ebfd14>
<https://hg.mozilla.org/releases/mozilla-beta/rev/edd37821774c>
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=unaffected)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1035438#a182069_280903)• 11 years ago |

Whiteboard: [adv-main31+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1035438#c13)• 11 years ago |
|  | |

Not able to reproduce with smichaud's ASan build from [comment 0](/show_bug.cgi?id=1035438#c0 "VERIFIED FIXED - AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack") or with my own ASan build of Fx31 from 2014-07-01.
Gary, if you have the ability to confirm that it no longer crashes for you, that would be great. Otherwise, I will mark it [qa-] for verification purposes. Thank you.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1035438#c14)• 11 years ago |
|  | |

(In reply to Matt Wobensmith from [comment #13](/show_bug.cgi?id=1035438#c13 "VERIFIED FIXED - AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack"))
> Not able to reproduce with smichaud's ASan build from [comment 0](/show_bug.cgi?id=1035438#c0 "VERIFIED FIXED - AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack") or with my
> own ASan build of Fx31 from 2014-07-01.
Matt, that's because Steven has updated his ASan build earlier today at the same address, so you're likely testing a recent build with the fix. (I'm not sure about your build though)
>
> Gary, if you have the ability to confirm that it no longer crashes for you,
> that would be great. Otherwise, I will mark it [qa-] for verification
> purposes. Thank you.
Yes, I've confirmed that it no longer crashes for me.Status: RESOLVED → VERIFIED

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1035438#a36407826_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1035438#a60312007_1689)• 9 years ago |

Group: core-security-release

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1035438#a178118566_495955)• 5 years ago |

Blocks: [asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")
You need to [log in](/show_bug.cgi?id=1035438&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from security.gentoo.org_d439654f_20250125_062815.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Products: Multiple vulnerabilities — GLSA **201504-01**

Multiple vulnerabilities have been found in Mozilla Firefox,
Thunderbird, and SeaMonkey, the worst of which may allow user-assisted
execution of arbitrary code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **31.5.3** |
| Unaffected versions | >= **31.5.3** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **31.5.3** |
| Unaffected versions | >= **31.5.3** |

| Package | **mail-client/thunderbird** on all architectures |
| --- | --- |
| Affected versions | < **31.5.0** |
| Unaffected versions | >= **31.5.0** |

| Package | **mail-client/thunderbird-bin** on all architectures |
| --- | --- |
| Affected versions | < **31.5.0** |
| Unaffected versions | >= **31.5.0** |

| Package | **www-client/seamonkey** on all architectures |
| --- | --- |
| Affected versions | < **2.33.1** |
| Unaffected versions | >= **2.33.1** |

| Package | **www-client/seamonkey-bin** on all architectures |
| --- | --- |
| Affected versions | < **2.33.1** |
| Unaffected versions | >= **2.33.1** |

| Package | **dev-libs/nspr** on all architectures |
| --- | --- |
| Affected versions | < **4.10.6** |
| Unaffected versions | >= **4.10.6** |

### Background

Mozilla Firefox is an open-source web browser and Mozilla Thunderbird an
open-source email client, both from the Mozilla Project. The SeaMonkey
project is a community effort to deliver production-quality releases of
code derived from the application formerly known as the ‘Mozilla
Application Suite’.

### Description

Multiple vulnerabilities have been discovered in Firefox, Thunderbird,
and SeaMonkey. Please review the CVE identifiers referenced below for
details.

### Impact

A remote attacker could entice a user to view a specially crafted web
page or email, possibly resulting in execution of arbitrary code or a
Denial of Service condition. Furthermore, a remote attacker may be able
to perform Man-in-the-Middle attacks, obtain sensitive information, spoof
the address bar, conduct clickjacking attacks, bypass security
restrictions and protection mechanisms, or have other unspecified
impact.

### Workaround

There are no known workarounds at this time.

### Resolution

All firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-31.5.3"

```

All firefox-bin users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-31.5.3"

```

All thunderbird users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=mail-client/thunderbird-31.5.0"

```

All thunderbird-bin users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose
 ">=mail-client/thunderbird-bin-31.5.0"

```

All seamonkey users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/seamonkey-2.33.1"

```

All seamonkey-bin users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/seamonkey-bin-2.33.1"

```

All nspr users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=dev-libs/nspr-4.10.6"

```
### References

* [CVE-2013-1741](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-1741)
* [CVE-2013-2566](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-2566)
* [CVE-2013-5590](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5590)
* [CVE-2013-5591](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5591)
* [CVE-2013-5592](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5592)
* [CVE-2013-5593](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5593)
* [CVE-2013-5595](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5595)
* [CVE-2013-5596](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5596)
* [CVE-2013-5597](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5597)
* [CVE-2013-5598](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5598)
* [CVE-2013-5599](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5599)
* [CVE-2013-5600](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5600)
* [CVE-2013-5601](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5601)
* [CVE-2013-5602](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5602)
* [CVE-2013-5603](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5603)
* [CVE-2013-5604](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5604)
* [CVE-2013-5605](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5605)
* [CVE-2013-5606](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5606)
* [CVE-2013-5607](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5607)
* [CVE-2013-5609](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5609)
* [CVE-2013-5610](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5610)
* [CVE-2013-5612](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5612)
* [CVE-2013-5613](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5613)
* [CVE-2013-5614](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5614)
* [CVE-2013-5615](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5615)
* [CVE-2013-5616](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5616)
* [CVE-2013-5618](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5618)
* [CVE-2013-5619](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-5619)
* [CVE-2013-6671](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-6671)
* [CVE-2013-6672](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-6672)
* [CVE-2013-6673](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-6673)
* [CVE-2014-1477](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1477)
* [CVE-2014-1478](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1478)
* [CVE-2014-1479](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1479)
* [CVE-2014-1480](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1480)
* [CVE-2014-1481](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1481)
* [CVE-2014-1482](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1482)
* [CVE-2014-1483](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1483)
* [CVE-2014-1485](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1485)
* [CVE-2014-1486](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1486)
* [CVE-2014-1487](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1487)
* [CVE-2014-1488](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1488)
* [CVE-2014-1489](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1489)
* [CVE-2014-1490](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1490)
* [CVE-2014-1491](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1491)
* [CVE-2014-1492](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1492)
* [CVE-2014-1493](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1493)
* [CVE-2014-1494](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1494)
* [CVE-2014-1496](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1496)
* [CVE-2014-1497](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1497)
* [CVE-2014-1498](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1498)
* [CVE-2014-1499](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1499)
* [CVE-2014-1500](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1500)
* [CVE-2014-1502](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1502)
* [CVE-2014-1504](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1504)
* [CVE-2014-1505](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1505)
* [CVE-2014-1508](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1508)
* [CVE-2014-1509](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1509)
* [CVE-2014-1510](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1510)
* [CVE-2014-1511](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1511)
* [CVE-2014-1512](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1512)
* [CVE-2014-1513](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1513)
* [CVE-2014-1514](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1514)
* [CVE-2014-1518](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1518)
* [CVE-2014-1519](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1519)
* [CVE-2014-1520](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1520)
* [CVE-2014-1522](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1522)
* [CVE-2014-1523](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1523)
* [CVE-2014-1524](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1524)
* [CVE-2014-1525](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1525)
* [CVE-2014-1526](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1526)
* [CVE-2014-1529](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1529)
* [CVE-2014-1530](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1530)
* [CVE-2014-1531](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1531)
* [CVE-2014-1532](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1532)
* [CVE-2014-1533](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1533)
* [CVE-2014-1534](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1534)
* [CVE-2014-1536](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1536)
* [CVE-2014-1537](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1537)
* [CVE-2014-1538](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1538)
* [CVE-2014-1539](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1539)
* [CVE-2014-1540](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1540)
* [CVE-2014-1541](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1541)
* [CVE-2014-1542](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1542)
* [CVE-2014-1543](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1543)
* [CVE-2014-1544](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1544)
* [CVE-2014-1545](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1545)
* [CVE-2014-1547](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1547)
* [CVE-2014-1548](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1548)
* [CVE-2014-1549](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1549)
* [CVE-2014-1550](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1550)
* [CVE-2014-1551](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1551)
* [CVE-2014-1552](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1552)
* [CVE-2014-1553](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1553)
* [CVE-2014-1554](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1554)
* [CVE-2014-1555](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1555)
* [CVE-2014-1556](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1556)
* [CVE-2014-1557](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1557)
* [CVE-2014-1558](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1558)
* [CVE-2014-1559](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1559)
* [CVE-2014-1560](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1560)
* [CVE-2014-1561](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1561)
* [CVE-2014-1562](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1562)
* [CVE-2014-1563](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1563)
* [CVE-2014-1564](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1564)
* [CVE-2014-1565](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1565)
* [CVE-2014-1566](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1566)
* [CVE-2014-1567](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1567)
* [CVE-2014-1568](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1568)
* [CVE-2014-1574](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1574)
* [CVE-2014-1575](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1575)
* [CVE-2014-1576](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1576)
* [CVE-2014-1577](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1577)
* [CVE-2014-1578](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1578)
* [CVE-2014-1580](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1580)
* [CVE-2014-1581](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1581)
* [CVE-2014-1582](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1582)
* [CVE-2014-1583](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1583)
* [CVE-2014-1584](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1584)
* [CVE-2014-1585](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1585)
* [CVE-2014-1586](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1586)
* [CVE-2014-1587](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1587)
* [CVE-2014-1588](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1588)
* [CVE-2014-1589](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1589)
* [CVE-2014-1590](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1590)
* [CVE-2014-1591](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1591)
* [CVE-2014-1592](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1592)
* [CVE-2014-1593](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1593)
* [CVE-2014-1594](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-1594)
* [CVE-2014-5369](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-5369)
* [CVE-2014-8631](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8631)
* [CVE-2014-8632](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8632)
* [CVE-2014-8634](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8634)
* [CVE-2014-8635](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8635)
* [CVE-2014-8636](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8636)
* [CVE-2014-8637](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8637)
* [CVE-2014-8638](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8638)
* [CVE-2014-8639](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8639)
* [CVE-2014-8640](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8640)
* [CVE-2014-8641](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8641)
* [CVE-2014-8642](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2014-8642)
* [CVE-2015-0817](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0817)
* [CVE-2015-0818](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0818)
* [CVE-2015-0819](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0819)
* [CVE-2015-0820](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0820)
* [CVE-2015-0821](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0821)
* [CVE-2015-0822](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0822)
* [CVE-2015-0823](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0823)
* [CVE-2015-0824](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0824)
* [CVE-2015-0825](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0825)
* [CVE-2015-0826](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0826)
* [CVE-2015-0827](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0827)
* [CVE-2015-0828](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0828)
* [CVE-2015-0829](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0829)
* [CVE-2015-0830](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0830)
* [CVE-2015-0831](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0831)
* [CVE-2015-0832](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0832)
* [CVE-2015-0833](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0833)
* [CVE-2015-0834](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0834)
* [CVE-2015-0835](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0835)
* [CVE-2015-0836](https://nvd.nist.gov/nvd.cfm?cvename=CVE-2015-0836)

**Release date**

April 07, 2015

**Latest revision**

April 08, 2015: 2

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [489796](https://bugs.gentoo.org/show_bug.cgi?id=489796)
* [491234](https://bugs.gentoo.org/show_bug.cgi?id=491234)
* [493850](https://bugs.gentoo.org/show_bug.cgi?id=493850)
* [500320](https://bugs.gentoo.org/show_bug.cgi?id=500320)
* [505072](https://bugs.gentoo.org/show_bug.cgi?id=505072)
* [509050](https://bugs.gentoo.org/show_bug.cgi?id=509050)
* [512896](https://bugs.gentoo.org/show_bug.cgi?id=512896)
* [517876](https://bugs.gentoo.org/show_bug.cgi?id=517876)
* [522020](https://bugs.gentoo.org/show_bug.cgi?id=522020)
* [523652](https://bugs.gentoo.org/show_bug.cgi?id=523652)
* [525474](https://bugs.gentoo.org/show_bug.cgi?id=525474)
* [531408](https://bugs.gentoo.org/show_bug.cgi?id=531408)
* [536564](https://bugs.gentoo.org/show_bug.cgi?id=536564)
* [541316](https://bugs.gentoo.org/show_bug.cgi?id=541316)
* [544056](https://bugs.gentoo.org/show_bug.cgi?id=544056)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugzilla.mozilla.org_99201121_20250125_062751.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1002702)
* [XML](/show_bug.cgi?ctype=xml&id=1002702)

Closed
[Bug 1002702](/show_bug.cgi?id=1002702)

Opened 11 years ago
Closed 11 years ago

# "Assertion failure: !mWorkerPrivate" with port.close(), GC

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"Assertion failure: !mWorkerPrivate" with port.close(), GC

## Categories

### (Core :: DOM: Workers, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Workers#DOM%3A%20Workers)

DOM: Workers
▾

Core :: DOM: Workers
This component covers the [Web Workers](https://developer.mozilla.org/En/DOM/Worker) implementation in Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Workers)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified) |
| firefox32 | --- | [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified) |
| firefox33 | --- | [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) |
| b2g-v1.3T | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected) |
| b2g-v1.4 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |
| b2g-v2.1 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 |  | verified |
| firefox32 |  | verified |
| firefox33 |  | verified |
| firefox-esr24 |  | unaffected |
| b2g-v1.3 |  | unaffected |
| b2g-v1.3T |  | unaffected |
| b2g-v1.4 |  | fixed |
| b2g-v2.0 |  | fixed |
| b2g-v2.1 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: baku)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=40)  [baku](/user_profile?user_id=446257)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: assertion, sec-high, testcase, Whiteboard: [adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c19 "11 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 3 obsolete files)

| [testcase](/attachment.cgi?id=8413991)  [11 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   264 bytes, text/html |  | [Details](/attachment.cgi?id=8413991&action=edit) |
| --- | --- | --- |
| [stack](/attachment.cgi?id=8413992)  [11 years ago](#c1)  [Jesse Ruderman](/user_profile?user_id=11608)   4.53 KB, text/plain |  | [Details](/attachment.cgi?id=8413992&action=edit) |
| [sw.patch](/attachment.cgi?id=8424930)  [11 years ago](#c4)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   802 bytes, patch |  | [Details](/attachment.cgi?id=8424930&action=edit) | [Diff](/attachment.cgi?id=8424930&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8424930) |
| [sw.patch](/attachment.cgi?id=8424981)  [11 years ago](#c6)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   2.35 KB, patch | khuey : [review-](#c7 "11 years ago") | [Details](/attachment.cgi?id=8424981&action=edit) | [Diff](/attachment.cgi?id=8424981&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8424981) |
| [sw.patch](/attachment.cgi?id=8427920)  [11 years ago](#c8)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   2.35 KB, patch |  | [Details](/attachment.cgi?id=8427920&action=edit) | [Diff](/attachment.cgi?id=8427920&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8427920) |
| [sw.patch](/attachment.cgi?id=8427965)  [11 years ago](#c9)  [Andrea Marchesini [:baku]](/user_profile?user_id=446257)   2.35 KB, patch | khuey : [review+](#a5167536_336670 "11 years ago")  Sylvestre : [approval-mozilla-aurora+](#a6001693_495955 "11 years ago")  Sylvestre : [approval-mozilla-beta+](#a6001693_495955 "11 years ago") | [Details](/attachment.cgi?id=8427965&action=edit) | [Diff](/attachment.cgi?id=8427965&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8427965) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1002702#c0)• 11 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=8413991)
— [Details](attachment.cgi?id=8413991&action=edit)

1. Load the testcase
2. Use about:memory to force a GC
OR
1. Install <https://www.squarefree.com/extensions/domFuzzLite3.xpi>
2. Load the testcase
Assertion failure: !mWorkerPrivate, at dom/workers/SharedWorker.cpp:43
Security-sensitive because (1) it's similar to [bug 998474](/show_bug.cgi?id=998474 "RESOLVED FIXED - \"Assertion failure: current (Wrong thread!)\" calling port.start() on main thread") and (2) it involves GC.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1002702#c1)• 11 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=8413992)
— [Details](attachment.cgi?id=8413992&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1002702#c2)• 11 years ago |
|  | |

It looks like this assertion means we've failed to run some kind of cleanup code, which sounds bad, so I'm going to set this to sec-high. Please adjust as appropriate.Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1002702#c3)• 11 years ago |
|  | |

Can you look into this Andrea? Thanks.Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a1798806_446257)• 11 years ago |

Assignee: nobody → amarchesiniFlags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1002702#c4)• 11 years ago |
|  | |

Attached patch

[sw.patch](attachment.cgi?id=8424930&action=diff) (obsolete)
— [Details](attachment.cgi?id=8424930&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8424930)

The reason of this crash is because we call "Close()" only when we Unlink is running becaue of GC. This is not enough for this test-case. This patch forces Close() in the dtor of SharedWorker.
[Attachment #8424930](/attachment.cgi?id=8424930&action=edit "sw.patch") -
Flags: review?(nsm.nikhil)

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1002702#c5)• 11 years ago |
|  | |

Comment on [attachment 8424930](/attachment.cgi?id=8424930 "sw.patch") [[details]](/attachment.cgi?id=8424930&action=edit "sw.patch") [[diff]](/attachment.cgi?id=8424930&action=diff "sw.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8424930)
sw.patch
It's probably better to have khuey sanity-check this.
[Attachment #8424930](/attachment.cgi?id=8424930&action=edit "sw.patch") -
Flags: review?(nsm.nikhil) → review?(khuey)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1002702#c6)• 11 years ago |
|  | |

Attached patch

[sw.patch](attachment.cgi?id=8424981&action=diff) (obsolete)
— [Details](attachment.cgi?id=8424981&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8424981)

Mochitest added
[Attachment #8424930](/attachment.cgi?id=8424930&action=edit "sw.patch") -
Attachment is obsolete: true
[Attachment #8424930](/attachment.cgi?id=8424930&action=edit "sw.patch") -
Flags: review?(khuey)
[Attachment #8424981](/attachment.cgi?id=8424981&action=edit "sw.patch") -
Flags: review?(khuey)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a1892283_1689)• 11 years ago |

Group: dom-core-security

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1002702#c7)• 11 years ago |
|  | |

Comment on [attachment 8424981](/attachment.cgi?id=8424981 "sw.patch") [[details]](/attachment.cgi?id=8424981&action=edit "sw.patch") [[diff]](/attachment.cgi?id=8424981&action=diff "sw.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8424981)
sw.patch
Review of [attachment 8424981](/attachment.cgi?id=8424981 "sw.patch") [[details]](/attachment.cgi?id=8424981&action=edit "sw.patch") [[diff]](/attachment.cgi?id=8424981&action=diff "sw.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8424981):
-----------------------------------------------------------------
You haven't actually run the test ...
[Attachment #8424981](/attachment.cgi?id=8424981&action=edit "sw.patch") -
Flags: review?(khuey) → review-

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1002702#c8)• 11 years ago |
|  | |

Attached patch

[sw.patch](attachment.cgi?id=8427920&action=diff) (obsolete)
— [Details](attachment.cgi?id=8427920&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8427920)

0:05.59 TEST-PASS | unknown test url | No crash \o/
I don't know why I lost an 's' in SpecialPowers saving the test file.
Can you review it again, please?
[Attachment #8424981](/attachment.cgi?id=8424981&action=edit "sw.patch") -
Attachment is obsolete: true
[Attachment #8427920](/attachment.cgi?id=8427920&action=edit "sw.patch") -
Flags: review?(khuey)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1002702#c9)• 11 years ago |
|  | |

Attached patch

[sw.patch](attachment.cgi?id=8427965&action=diff)
— [Details](attachment.cgi?id=8427965&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8427965)

Still the 's' was missing :)
[Attachment #8427920](/attachment.cgi?id=8427920&action=edit "sw.patch") -
Attachment is obsolete: true
[Attachment #8427920](/attachment.cgi?id=8427920&action=edit "sw.patch") -
Flags: review?(khuey)
[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: review?(khuey)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1002702#c10)• 11 years ago |
|  | |

Kyle, can you review this patch, or should somebody else? It has been sitting here for over a month.Flags: needinfo?(khuey)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a5167536_336670)• 11 years ago |

[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: review?(khuey) → review+

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a5167548_336670)• 11 years ago |

Flags: needinfo?(khuey)

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1002702#c11)• 11 years ago |
|  | |

This is a bit weird, it means that error events stop being delivered to the SharedWorker once close() is called on the port object... Since there's no other way to disconnect the SharedWorker, and this is just error events, I guess this is ok for now.

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1002702#c12)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/9dafb9b56b5c>

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1002702#c13)• 11 years ago |
|  | |

This appears to affect more than trunk, so it should have gotten sec-approval, though it is too late now. What versions does this affect?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a5170606_406194)• 11 years ago |

Flags: needinfo?(amarchesini)

|  | [Andrea Marchesini [:baku]](/user_profile?user_id=446257)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1002702#c14)• 11 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #13](/show_bug.cgi?id=1002702#c13 "VERIFIED FIXED - \"Assertion failure: !mWorkerPrivate\" with port.close(), GC"))
> This appears to affect more than trunk, so it should have gotten
> sec-approval, though it is too late now. What versions does this affect?
Sorry, I completely forgot the set-approval. I would say: ff 29 till now.Flags: needinfo?(amarchesini)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a5178844_406194)• 11 years ago |

[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1002702#c15)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/9dafb9b56b5c>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla33

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1002702#c16)• 11 years ago |
|  | |

Not only did this land without sec-approval, it landed with a test too.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a5950668_1689)• 11 years ago |

Group: dom-core-security

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1002702#c17)• 11 years ago |
|  | |

Please try to get beta and aurora approval for this. We're almost at the final beta for this cycle.Flags: needinfo?(amarchesini)

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1002702#c18)• 11 years ago |
|  | |

Comment on [attachment 8427965](/attachment.cgi?id=8427965 "sw.patch") [[details]](/attachment.cgi?id=8427965&action=edit "sw.patch") [[diff]](/attachment.cgi?id=8427965&action=diff "sw.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1002702&attachment=8427965)
sw.patch
Andrea is on PTO.
Approval Request Comment
[Feature/regressing bug #]: [bug 924089](/show_bug.cgi?id=924089 "RESOLVED FIXED - Enable SharedWorker by default")
[User impact if declined]: It's probably a use-after-free opportunity, so crash or exploit is possible
[Describe test coverage new/current, TBPL]: There's a test in the tree already...
[Risks and why]: Should be low risk, this just removes a dangling pointer from a hashtable.
[String/UUID change made/needed]: None
[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: approval-mozilla-beta?
[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: approval-mozilla-aurora?Flags: needinfo?(amarchesini)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a6001693_495955)• 11 years ago |

[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: approval-mozilla-beta?
[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: approval-mozilla-beta+
[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: approval-mozilla-aurora?
[Attachment #8427965](/attachment.cgi?id=8427965&action=edit "sw.patch") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1002702#c19)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/2bbc56ea0d3d>
<https://hg.mozilla.org/releases/mozilla-beta/rev/cc906edb11c0>
<https://hg.mozilla.org/releases/mozilla-b2g30_v1_4/rev/32d95dfd0a3b>
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)Flags: in-testsuite+

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1002702#c20)• 11 years ago |
|  | |

Reproduced the original issue on OSX 10.9.4, Ubuntu 13.10 and Win 8.1 using the STR from [comment #0](/show_bug.cgi?id=1002702#c0 "VERIFIED FIXED - \"Assertion failure: !mWorkerPrivate\" with port.close(), GC"). Used build:
\* <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014/04/2014-04-28-03-02-03-mozilla-central/>
Went through verification using the following builds:
\* fx-33.0a1 (Nightly)
\*\* OSX 10.9.4 x64: [Passed]
\*\* Ubuntu 13.10 x64: [Passed]
\*\* Win 8.1 x64: [Passed]
\*\* Build: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-08-03-02-03-mozilla-central/>
fx-32.0a2 (Aurora)
\*\* OSX 10.9.4 x64: [Passed]
\*\* Ubuntu 13.10 x64: [Passed]
\*\* Win 8.1 x64: [Passed]
\*\* Build: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-08-00-40-01-mozilla-aurora/>
\* fx-31.0b8 (BETA)
\*\* OSX 10.9.4 x64: [Passed]
\*\* Ubuntu 13.10 x64: [Passed]
\*\* Win 8.1 x64: [Passed]
\*\* Build: <http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/31.0b8/>
- opened the poc and waited a few minutes and ensured that the browser wasn't crashing
- opened the poc using multiple tabs and windows and ensured that the browser wasn't crashing
- opened several tabs and windows and invoked the GC through about:memory, ensured that the browser wasn't crashingStatus: RESOLVED → VERIFIED
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a6231634_280903)• 11 years ago |

Whiteboard: [adv-main31+]

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a42457313_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1002702#a66361489_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1002702&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_aa3d00e0_20250125_062748.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2014-56

## Miscellaneous memory safety hazards (rv:31.0 / rv:24.7)

Announced
July 22, 2014
Reporter
Mozilla Developers
Impact
Critical
Products
Firefox, Firefox ESR, Thunderbird
Fixed in

* Firefox 31
* Firefox ESR 24.7
* Thunderbird 24.7
* Thunderbird 31

### Description

Mozilla developers and community identified identified and fixed several
memory safety bugs in the browser engine used in Firefox and other Mozilla-based
products. Some of these bugs showed evidence of memory corruption under certain
circumstances, and we presume that with enough effort at least some of these
could be exploited to run arbitrary code.

In general these flaws cannot be exploited through email in the
Thunderbird product because scripting is disabled, but are potentially a risk in
browser or browser-like contexts.

### References

Christian Holler, David Keeler, and Byron Campen reported memory safety problems and crashes that affect Firefox ESR 24.6 and Firefox 30.

* [Memory safety bugs fixed in Firefox ESR 24.7 and Firefox 31.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1012694,1019684,985070,1024765) ([CVE-2014-1547](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-1547))

Christian Holler, Gary Kwong, Jesse Ruderman, Andrew McCreight, Alon Zakai,
Bobby Holley, Jonathan Watt, Shu-yu Guo, Steve Fink, Terrence Cole, Gijs Kruitbosch,
and Cătălin Badea reported memory safety problems and crashes that affect
Firefox 30.

* [Memory safety bugs fixed in Firefox 31.0](https://bugzilla.mozilla.org/buglist.cgi?bug_id=990096,1013056,1034383,1035438,1002702,1020041,1020008,1009675,1021312,1020219,994444,1022773,1028358,1021969,1021240) ([CVE-2014-1548](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-1548))

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_835cb19c_20250125_062754.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1009675)
* [XML](/show_bug.cgi?ctype=xml&id=1009675)

Closed
[Bug 1009675](/show_bug.cgi?id=1009675)

Opened 11 years ago
Closed 11 years ago

# Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>]

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

31 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | [+](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified) |
| firefox32 | [+](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified) |
| firefox33 | [+](/buglist.cgi?f1=cf_tracking_firefox33&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) |
| b2g-v1.3T | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |
| b2g-v2.1 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 | + | verified |
| firefox32 | + | verified |
| firefox33 | + | verified |
| firefox-esr24 |  | unaffected |
| b2g-v1.3 |  | unaffected |
| b2g-v1.3T |  | unaffected |
| b2g-v1.4 |  | unaffected |
| b2g-v2.0 |  | fixed |
| b2g-v2.1 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: azakai, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/eb99fcafb63ef68fdb19a269f4d3e3eb?d=mm&size=40)  [azakai](/user_profile?user_id=381546)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

37 people

## References

### (Blocks 1 open bug, [URL](https://crash-stats.mozilla.com/report/list?product=Firefox&signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JS%3A%3AHandle%3CJS%3A%3AValue%3E%29 "https://crash-stats.mozilla.com/report/list?product=Firefox&signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JS%3A%3AHandle%3CJS%3A%3AValue%3E%29") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1029652](/show_bug.cgi?id=1029652 "RESOLVED WONTFIX - 4.14% win8 tresize regression on mozilla-beta (fx31) from revision f97b33e8ec22 on June 17th")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[GC.stability](/show_bug.cgi?id=1008341 "NEW - [meta] GC Correctness & Stability"), [GenerationalGC](/show_bug.cgi?id=619558 "RESOLVED FIXED - [meta] Implement generational garbage collection"), [ExactRooting](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting"), [1022201](/show_bug.cgi?id=1022201 "RESOLVED WORKSFORME - Intermittent base.py, test_animations_omta.html | application crashed [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>)]")

Dependency [tree](/showdependencytree.cgi?id=1009675&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1009675)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1009749](/show_bug.cgi?id=1009749 "RESOLVED DUPLICATE - crash in mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>)"), [1010280](/show_bug.cgi?id=1010280 "RESOLVED DUPLICATE - crash while entering a comment on a GitHub pull request")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[crash-stats.mozilla.com/report/list?p...](https://crash-stats.mozilla.com/report/list?product=Firefox&signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JS%3A%3AHandle%3CJS%3A%3AValue%3E%29 "https://crash-stats.mozilla.com/report/list?product=Firefox&signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JS%3A%3AHandle%3CJS%3A%3AValue%3E%29")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1022773](/show_bug.cgi?id=1022773 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC")

## Details

### (5 keywords, Whiteboard: [GGC][testcase in comment 57][adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[GGC][testcase in comment 57][adv-main31+]

QA Whiteboard:

[qa!]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c79 "11 years ago") | ? |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>) ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JS%3A%3AHandle%3CJS%3A%3AValue%3E%29)

[[@ mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>) ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JSContext%2A%2C%20JS%3A%3AHandle%3CJS%3A%3AValue%3E%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (8 files, 3 obsolete files)

| [part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit](/attachment.cgi?id=8437929)  [11 years ago](#c62)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   8.20 KB, patch | peterv : [review+](#c65 "11 years ago") | [Details](/attachment.cgi?id=8437929&action=edit) | [Diff](/attachment.cgi?id=8437929&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437929) |
| --- | --- | --- |
| [part 2. Return WebIDL 'any' values as handles](/attachment.cgi?id=8437930)  [11 years ago](#c63)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   97.53 KB, patch | peterv : [review+](#c66 "11 years ago") | [Details](/attachment.cgi?id=8437930&action=edit) | [Diff](/attachment.cgi?id=8437930&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437930) |
| [part 3. Return WebIDL 'object' values as handles](/attachment.cgi?id=8437931)  [11 years ago](#c64)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   56.72 KB, patch | peterv : [review+](#c68 "11 years ago") | [Details](/attachment.cgi?id=8437931&action=edit) | [Diff](/attachment.cgi?id=8437931&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437931) |
| [part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit](/attachment.cgi?id=8438523)  [11 years ago](#c70)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   8.19 KB, patch | Sylvestre : [approval-mozilla-aurora+](#a2557965_495955 "11 years ago")  Sylvestre : [approval-mozilla-beta+](#a2988669_495955 "11 years ago")  abillings : [sec-approval+](#c75 "11 years ago") | [Details](/attachment.cgi?id=8438523&action=edit) | [Diff](/attachment.cgi?id=8438523&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438523) |
| [part 2. Return WebIDL 'any' values as handles](/attachment.cgi?id=8438524)  [11 years ago](#c71)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   97.49 KB, patch |  | [Details](/attachment.cgi?id=8438524&action=edit) | [Diff](/attachment.cgi?id=8438524&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438524) |
| [part 3. Return WebIDL 'object' values as handles](/attachment.cgi?id=8438526)  [11 years ago](#c72)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   56.50 KB, patch | Sylvestre : [approval-mozilla-aurora+](#a2557980_495955 "11 years ago") | [Details](/attachment.cgi?id=8438526&action=edit) | [Diff](/attachment.cgi?id=8438526&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438526) |
| [Part 2 for Aurora 32](/attachment.cgi?id=8438558)  [11 years ago](#c74)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   97.33 KB, patch | Sylvestre : [approval-mozilla-aurora+](#a2557993_495955 "11 years ago") | [Details](/attachment.cgi?id=8438558&action=edit) | [Diff](/attachment.cgi?id=8438558&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438558) |
| [Addendum to part 2 for beta 31](/attachment.cgi?id=8438663)  [11 years ago](#c76)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   5.66 KB, patch | peterv : [review+](#a2517849_24295 "11 years ago") | [Details](/attachment.cgi?id=8438663&action=edit) | [Diff](/attachment.cgi?id=8438663&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438663) |
| [Addendum to part 3 for beta 31](/attachment.cgi?id=8438664)  [11 years ago](#c77)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   1.99 KB, patch | peterv : [review+](#a2517887_24295 "11 years ago") | [Details](/attachment.cgi?id=8438664&action=edit) | [Diff](/attachment.cgi?id=8438664&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438664) |
| [Part 2 for beta 31](/attachment.cgi?id=8438680)  [11 years ago](#c80)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   95.63 KB, patch | Sylvestre : [approval-mozilla-beta+](#a2988660_495955 "11 years ago") | [Details](/attachment.cgi?id=8438680&action=edit) | [Diff](/attachment.cgi?id=8438680&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438680) |
| [Part 3 for beta 31](/attachment.cgi?id=8438683)  [11 years ago](#c81)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   51.78 KB, patch | Sylvestre : [approval-mozilla-beta+](#a2988664_495955 "11 years ago") | [Details](/attachment.cgi?id=8438683&action=edit) | [Diff](/attachment.cgi?id=8438683&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438683) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Alon Zakai (:azakai)](/user_profile?user_id=381546)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1009675#c0)• 11 years ago |
|  | |

This bug was filed from the Socorro interface and is
report [bp-0e3f20b3-f50e-401f-b1a9-c2c312140513](https://crash-stats.mozilla.org/report/index/0e3f20b3-f50e-401f-b1a9-c2c312140513).
=============================================================
I've seen this twice in an hour today, both times when clicking to respond on a github issue or pull request.
Here's the other report: <https://crash-stats.mozilla.com/report/index/d6a754ad-37f8-4ab9-bd2c-f96b22140513>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1009675#c1)• 11 years ago |
|  | |

Those are both null-derefs at line 603 of jsfriendapi.h:
600 inline const js::Class \*
601 GetObjectClass(JSObject \*obj)
602 {
603 return reinterpret\_cast<const shadow::Object\*>(obj)->type->clasp;
604 }
sadly the bits that would tell me who called GetObjectClass are missing from the stack, because of inlining. :(
The caller we do have is Promise::RunTask doing callbacks[i]->Call(cx, value), and I guess breakpad thinks this is calling WrapperPromiseCallback::Call.
I \_think\_ that the AnyCallback::Call that calls doesn't do any GetObjectClass calls in its inline part, but I'm not sure. WrapperPromiseCallback::Call definitely does GetObjectClass via UNWRAP\_OBJECT, but we're checking isObject() before doing that...
Catching this in a debug build that would give us more stack info would be really helpful.

|  | [Logan Rosen [:Logan]](/user_profile?user_id=356925) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1009675#c2)• 11 years ago |
|  | |

Happening on OS X, too. I merged a pull request on GitHub, and, although it was successful, Nightly (2014-05-13) crashed with this signature. Would a regression window be helpful?OS: Linux → All

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1009675#c4)• 11 years ago |
|  | |

This crash signature first appeared on 2014-02-07 and is the #18 crash for Firefox 31.0a2 with 72 out of 8660 crashes in the last week.
From the comments and urls in the crash reports, it appears to commonly happen during pull requests or merges on github.
Crashing thread:
0 XUL mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>) obj-firefox/x86\_64/dist/include/jsfriendapi.h
1 XUL mozilla::dom::Promise::RunTask() dom/promise/Promise.cpp
2 XUL mozilla::dom::PromiseResolverTask::Run() dom/promise/Promise.cpp
3 XUL nsThread::ProcessNextEvent(bool, bool\*) xpcom/threads/nsThread.cpp
4 XUL NS\_ProcessPendingEvents(nsIThread\*, unsigned int) xpcom/glue/nsThreadUtils.cpp
5 XUL nsBaseAppShell::NativeEventCallback() widget/xpwidgets/nsBaseAppShell.cpp
6 XUL nsAppShell::ProcessGeckoEvents(void\*) widget/cocoa/nsAppShell.mm
7 CoreFoundation CoreFoundation@0x12b31
8 CoreFoundation CoreFoundation@0x12455
9 CoreFoundation CoreFoundation@0x357f5
10 AppKit AppKit@0x119b37Keywords: [topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1009675#c5)• 11 years ago |
|  | |

Interestingly, none of the crashes are on Windows. All are Mac or Linux... That's pretty odd.
Logan, a regression range would definitely be helpful.

|  | [Logan Rosen [:Logan]](/user_profile?user_id=356925) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1009675#c6)• 11 years ago |
|  | |

I can't seem to reproduce the issue, unfortunately. It was a very specific situation for me (accepting a pull request). Commenting on issues doesn't appear to make it crash.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1009675#c7)• 11 years ago |
|  | |

Mozilla/5.0 (X11; Linux x86\_64; rv:31.0) Gecko/20100101 Firefox/31.0 ID:20140511004003 CSet: b122b633fe71
I also hit this crash on github when I clicked the middle-button of my mouse onto the comment field:
[bp-88979999-6ad3-48ad-89ef-940b62140515](https://crash-stats.mozilla.org/report/index/88979999-6ad3-48ad-89ef-940b62140515)
A lot of the comments on crashstats actually talk about github.URL: [https://crash-stats.mozilla.com/repor...](https://crash-stats.mozilla.com/report/list?product=Firefox&signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JS%3A%3AHandle%3CJS%3A%3AValue%3E%29)Crash Signature: [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>)] → [@ mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>)]
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1009675#c8)• 11 years ago |
|  | |

I may have been wrong with my last comment. It actually crashed when I clicked the Submit button to post my comment. I hit one more crash. I will try to figure out a pattern to get it crashing reproducible.

|  | [Nikhil Marathe [:nsm] (No longer reading bugmail, please needinfo?)](/user_profile?user_id=415061) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1009675#c9)• 11 years ago |
|  | |

(In reply to Henrik Skupin (:whimboo) from [comment #8](/show_bug.cgi?id=1009675#c8 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]"))
> I may have been wrong with my last comment. It actually crashed when I
> clicked the Submit button to post my comment. I hit one more crash. I will
> try to figure out a pattern to get it crashing reproducible.
Unable to reproduce this on 31a2
Mozilla/5.0 (X11; Linux x86\_64; rv:31.0) Gecko/20100101 Firefox/31.0
ID: 20140429004000

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1009675#c10)• 11 years ago |
|  | |

I'm going through the list of top crashers on nightly 32a1, and this is currently in the top 10, happening mostly on OS X and Linux (there were at least a couple of reports on Windows). Most of the comments in the reports have to do with interactions in GitHub, like commenting on GitHub; pushing a Git commit; clicking on various anchor tag links on github.com.
In crash stats, the column corresponding to "First Appearance" says that this started happening on 32a1 around 5/2, but it looks like it started earlier by looking at the reports in 31a2.
0 XUL mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>) obj-firefox/x86\_64/dist/include/jsfriendapi.h
1 XUL mozilla::dom::Promise::RunTask() dom/promise/Promise.cpp
2 XUL mozilla::dom::PromiseResolverTask::Run() dom/promise/Promise.cpp
3 XUL nsThread::ProcessNextEvent(bool, bool\*) xpcom/threads/nsThread.cpp
4 XUL NS\_ProcessPendingEvents(nsIThread\*, unsigned int) xpcom/glue/nsThreadUtils.cpp
5 XUL nsBaseAppShell::NativeEventCallback() widget/xpwidgets/nsBaseAppShell.cpp
6 XUL nsAppShell::ProcessGeckoEvents(void\*) widget/cocoa/nsAppShell.mm
7 CoreFoundation CoreFoundation@0x7f731
8 CoreFoundation CoreFoundation@0x70ea2
9 CoreFoundation CoreFoundation@0x7062f
10 libnss3.dylib PR\_GetCurrentThread
11 XUL XPCJSContextStack::Pop() obj-firefox/x86\_64/dist/include/nsTArray-inl.h
12 CoreFoundation CoreFoundation@0x700b5
13 HIToolbox HIToolbox@0x2ea0d
14 HIToolbox HIToolbox@0x2e685
15 HIToolbox HIToolbox@0x2e5bc
16 AppKit AppKit@0x243de
17 AppKit AppKit@0xa506d8
18 AppKit AppKit@0xa50795
19 AppKit AppKit@0xa50779
20 AppKit AppKit@0xa5075e
21 libobjc.A.dylib libobjc.A.dylib@0x1d3fe
22 libobjc.A.dylib libobjc.A.dylib@0x51c4
23 XUL nsAutoRetainCocoaObject::~nsAutoRetainCocoaObject() widget/cocoa/nsCocoaUtils.h
24 AppKit AppKit@0x23a2b
25 CoreFoundation CoreFoundation@0x63abb
26 CoreFoundation CoreFoundation@0x78fd2
27 libobjc.A.dylib libobjc.A.dylib@0x5080
28 AppKit AppKit@0x23947
29 AppKit AppKit@0x3bb703
30 AppKit AppKit@0x3bb6d0
31 AppKit AppKit@0x3bb6f0
32 XUL -[ToolbarWindow sendEvent:] widget/cocoa/nsCocoaWindow.mm
33 XUL -[GeckoNSApplication nextEventMatchingMask:untilDate:inMode:dequeue:] widget/cocoa/nsAppShell.mm
34 AppKit AppKit@0x17b2c
35 AppKit AppKit@0xa50779
36 AppKit AppKit@0xa50795
37 AppKit AppKit@0xa5078f
38 XUL nsAppShell::Run() widget/cocoa/nsAppShell.mm
39 XUL nsAppStartup::Run() toolkit/components/startup/nsAppStartup.cpp
40 XUL XREMain::XRE\_mainRun() toolkit/xre/nsAppRunner.cpp
41 XUL XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) toolkit/xre/nsAppRunner.cpp
42 XUL XRE\_main toolkit/xre/nsAppRunner.cpp
43 firefox main browser/app/nsBrowserApp.cpp
44 firefox start
[tracking-firefox32](/buglist.cgi?f1=cf_tracking_firefox32&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%3F)Version: 24 Branch → 32 Branch

|  | [Chris DeCairos (:cade)](/user_profile?user_id=490149) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1009675#c11)• 11 years ago |
|  | |

Just hit this: <https://crash-stats.mozilla.com/report/index/f17f2d50-964d-4083-a2e6-1369c2140516>
I was submitting a comment on a GitHub pull request

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1009675#c12)• 11 years ago |
|  | |

All of that has the issues from [comment 1](/show_bug.cgi?id=1009675#c1 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]"). We need a stack from a debug build or info on regression range or something more to go on.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1009675#c13)• 11 years ago |
|  | |

I created a Mozmill script earlier today to create comments and close/reopen issues via automation. But even after a couple of minutes no crash happened. Not sure about per-requisits we might have to setup first.

|  | [Chris DeCairos (:cade)](/user_profile?user_id=490149) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1009675#c14)• 11 years ago |
|  | |

Maybe it's unrelated, but this happened after I referenced an issue in the comment box.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1009675#c15)• 11 years ago |
|  | |

What I tried so far on an issue is:
\* referencing another issue
\* referencing a user
\* setting/removing labels
\* open/close the issue
\* close the issue with adding a comment
Nothing broke it so far. When I re-read the last comments I wonder if that is more PR related.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a264107_20209)• 11 years ago |

Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a264121_20209)• 11 years ago |

[tracking-firefox31](/buglist.cgi?f1=cf_tracking_firefox31&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%3F)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1009675#c16)• 11 years ago |
|  | |

Top crash, tracking!
[tracking-firefox31](/buglist.cgi?f1=cf_tracking_firefox31&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%2B)
[tracking-firefox32](/buglist.cgi?f1=cf_tracking_firefox32&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%2B)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a514839_67806)• 11 years ago |

Crash Signature: [@ mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>)] → [@ mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>)]
[@ mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>) ]

|  | [(not reading bugmail) Nick Desaulniers [:\n]](/user_profile?user_id=443618) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1009675#c17)• 11 years ago |
|  | |

I just saw this commenting on a pull request. [0] As soon as I click submit, FF crashes. I just submitted a second comment and did not experience a crash, so there must be more to it.
[0] <https://github.com/mozilla/calculator/pull/71/files#r12855957>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1009675#c18)• 11 years ago |
|  | |

I'd really appreciate it if people who use github regularly did that with debug builds for a while here. A crash in a debug build might give use some information about what's actually going on here...

|  | [(not reading bugmail) Nick Desaulniers [:\n]](/user_profile?user_id=443618) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1009675#c19)• 11 years ago |
|  | |

Noob question; I just need to add to my .mozconfig:
ac\_add\_options --enable-debug-symbols
export MOZ\_DEBUG\_SYMBOLS=1
export CFLAGS="-gdwarf-2"
export CXXFLAGS="-gdwarf-2"
and run a build, and paste the link to the crash report here?

|  | [(not reading bugmail) Nick Desaulniers [:\n]](/user_profile?user_id=443618) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1009675#c20)• 11 years ago |
|  | |

nvm, got all set up with a debug build.

|  | [(not reading bugmail) Nick Desaulniers [:\n]](/user_profile?user_id=443618) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1009675#c21)• 11 years ago |
|  | |

haven't had any luck trying to reproduce.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1009675#c22)• 11 years ago |
|  | |

Sorry but I cannot use a debug version of Aurora with that profile. I get segfaults one after the other. I may have to file another bug, and investigate first.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1009675#c23)• 11 years ago |
|  | |

Henrik, are you on Linux and not setting the JS\_DISABLE\_SLOW\_SCRIPT\_SIGNALS environment variable? See <https://developer.mozilla.org/en-US/docs/Debugging_Mozilla_with_gdb#I_keep_getting_a_SIG32_in_the_debugger._How_do_I_fix_it.3F>

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1009675#c24)• 11 years ago |
|  | |

Looks like that this wasn't the problem. I still get lots of those SIGSEVs, something similar to:
Assertion failure: offset < length(), at /mozilla/code/firefox/aurora/js/src/jsscript.h:942
Program received signal SIGSEGV, Segmentation fault.
0x00007ffff2ea094c in offsetToPC (offset=<optimized out>, this=<optimized out>) at /mozilla/code/firefox/aurora/js/src/jsscript.h:942
942 JS\_ASSERT(offset < length());
Any debug symbols seem to have been optimized out, so stacks I get contain 'libxul.so +0x02F0ED67' like lines. That's with debug builds from ftp.m.o, and self-build debug builds.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1009675#c25)• 11 years ago |
|  | |

I hit a lot of SIGSEVs when running Firefox. But I finally hit this crash with a debug build of Aurora. Sadly I hit 'c' in the debugger, so no way to further debug it. Boris, please let me know which commands I have to issue to give you more details.
Program received signal SIGSEGV, Segmentation fault.
0x00007ffff292b8ef in mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>) () from /mozilla/bin/aurora/libxul.so
(gdb) bt
#0 0x00007ffff292b8ef in mozilla::dom::WrapperPromiseCallback::Call(JS::Handle<JS::Value>) () from /mozilla/bin/aurora/libxul.so
#1 0x00007ffff292985d in mozilla::dom::Promise::RunTask() () from /mozilla/bin/aurora/libxul.so
#2 0x00007ffff292afc0 in mozilla::dom::PromiseResolverMixin::RunInternal() () from /mozilla/bin/aurora/libxul.so
#3 0x00007ffff292afda in mozilla::dom::PromiseResolverTask::Run() () from /mozilla/bin/aurora/libxul.so
#4 0x00007ffff1bcff41 in nsThread::ProcessNextEvent(bool, bool\*) () from /mozilla/bin/aurora/libxul.so
#5 0x00007ffff1bba4a9 in NS\_ProcessNextEvent(nsIThread\*, bool) () from /mozilla/bin/aurora/libxul.so
#6 0x00007ffff1be2e3b in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate\*) () from /mozilla/bin/aurora/libxul.so
#7 0x00007ffff203fcb3 in MessageLoop::Run() () from /mozilla/bin/aurora/libxul.so
#8 0x00007ffff27319f5 in nsBaseAppShell::Run() () from /mozilla/bin/aurora/libxul.so
#9 0x00007ffff301e091 in nsAppStartup::Run() () from /mozilla/bin/aurora/libxul.so
#10 0x00007ffff2fea98a in XREMain::XRE\_mainRun() () from /mozilla/bin/aurora/libxul.so
#11 0x00007ffff2fed069 in XREMain::XRE\_main(int, char\*\*, nsXREAppData const\*) () from /mozilla/bin/aurora/libxul.so
#12 0x00007ffff2fed2e8 in XRE\_main () from /mozilla/bin/aurora/libxul.so
#13 0x00000000004063bb in do\_main(int, char\*\*, nsIFile\*) ()
#14 0x0000000000403834 in main ()

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1009675#c26)• 11 years ago |
|  | |

Henrik, that backtrace doesn't have any filenames or line numbers. :(
In fact, this stack is identical to the breakpad stacks, but breakpad thinks the actual crash is in jsfriendapi... Are you using an --enable-debug \_and\_ --enable-optimize build or something? :(

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1009675#c27)• 11 years ago |
|  | |

Oh, and as far as what to look for, I'd like to know which thing here is actually null and how it got into the code that crashes.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1009675#c28)• 11 years ago |
|  | |

Yeah, that's what I was wondering too. Optimizations are disabled. So I talked with Glandium on IRC, and we setup a better mozconfig for me now. Once the build is ready I will continue.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a1260938_76551)• 11 years ago |

Summary: crash in mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>) → Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>]

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1009675#c30)• 11 years ago |
|  | |

Ok, I was able to fix my constant SIGSEVs by putting 'handle SIG32 noprint' in my .gdbinit file. Lets hope the next crash doesn't take that long, given that using a debug build is absolutely slow on my machine and causes lot of hangs.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1009675#c31)• 11 years ago |
|  | |

This is the #9 topcrash for Firefox 31 right now, with 99/4154 crashes in the last 7 days. There don't appear to be crashes with this signature for other versions of Firefox. 77 of the 99 crashes are in Mac OSX 10.9 - maybe that will help reproduce the bug.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1009675#c32)• 11 years ago |
|  | |

I've been trying to reproduce on Mac for weeks now; using debug builds for all my GitHub interactions. But I just don't use github that much. :(

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1009675#c33)• 11 years ago |
|  | |

For what it's worth, I have a workable (and portable) Mac ASan build at <http://people.mozilla.org/~stmichaud/bmo/firefox-asan.dmg>. It's a universal build, though only the 64-bit component actually uses ASan.
But we've never had portable ASan builds before -- even semi-official ones like mine. So there's probably a large backlog of bugs waiting to be discovered, which may interfere with diagnosing this one. (One was discovered only the day after I posted my build -- [bug 1021612](/show_bug.cgi?id=1021612 "VERIFIED FIXED - AddressSanitizer: heap-buffer-overflow [@ mozilla::net::CacheFileMetadata::OnDataRead]").) But it may be worth a try.
I will keep updating my Mac ASan build to current m-c code, roughly once a week.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1009675#c34)• 11 years ago |
|  | |

> I will keep updating my Mac ASan build to current m-c code, roughly once a week.
I'll also fix LLVM bugs (locally) that interfere with its usability on the Mac. I've already fixed one.

|  | [Dirkjan Ochtman (:djc)](/user_profile?user_id=110217) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1009675#c35)• 11 years ago |
|  | |

BTW, pretty sure this is not \*just\* GitHub. I forgot when it crashed for me, but I'm pretty sure it wasn't while I was using GitHub.

|  | [Hubert Figuiere [:hub]](/user_profile?user_id=8558) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1009675#c36)• 11 years ago |
|  | |

I get it, and I really only use Linux. I have had it without github as well. Non debug build (from source)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1009675#c37)• 11 years ago |
|  | |

> I get it, and I really only use Linux.
Then you might want to try one of the official Linux ASan builds, here:
<https://ftp.mozilla.org/pub/mozilla.org/firefox/tinderbox-builds/mozilla-central-linux64-asan/>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1009675#c38)• 11 years ago |
|  | |

> Non debug build (from source)
Were you able to get a better stack than the one breakpad gives here?
Note that I'm 99% sure this is not an issue ASan will help with: we have a null deref, not a bogus-memory deref...

|  | [Hubert Figuiere [:hub]](/user_profile?user_id=8558) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1009675#c39)• 11 years ago |
|  | |

I should attach gdb to it. Will do that.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1009675#c40)• 11 years ago |
|  | |

If you're going to attach gdb, don't use a debug build -- debug builds have their symbols stripped. Use a "regular" (non-debug) m-c nightly instead (which doesn't have its symbols stripped, because it needs to support the Gecko profiler).
Gdb, like ASan builds, is much more likely to give you a good (complete) stack than Breakpad.
Also, I'm not yet convinced these are null-dereferences -- see [bug 1018360](/show_bug.cgi?id=1018360 "RESOLVED FIXED - Publicly display thread state for crashing thread on Intel 64-bit processors"). But I'm currently checking.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1009675#c41)• 11 years ago |
|  | |

If the OS X and Linux crashes are anything like the crashes on Windows, they aren't null-dereferences:
[https://crash-stats.mozilla.com/report/list?signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JSContext\*%2C+JS%3A%3AHandle%3CJS%3A%3AValue%3E%29&product=Firefox&query\_type=contains&range\_unit=weeks&process\_type=any&platform=win&hang\_type=any&date=2014-06-08+15%3A00%3A00&range\_value=1#tab-reports](https://crash-stats.mozilla.com/report/list?signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JSContext*%2C+JS%3A%3AHandle%3CJS%3A%3AValue%3E%29&product=Firefox&query_type=contains&range_unit=weeks&process_type=any&platform=win&hang_type=any&date=2014-06-08+15%3A00%3A00&range_value=1#tab-reports)
Note that these are all on 64-bit Windows, and that the supposed crash address is 0xffffffffffffffff.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1009675#c42)• 11 years ago |
|  | |

The Windows crash addresses are 0x2b2b2b2b2b2b2b2b ("++++++++") or 0x4b4b4b4b4b4b4b4b ("KKKKKKKK"). I think that's reason enough to mark this bug security sensitive.
Those who have permission to download minidumps can do that and then run minidump-stackwalk on them. The latest version of minidump-stackwalk displays the entire "thread state" (the values of all the user-level registers) for the crashing thread.
All the minidumps I looked at had either
rax = 0x2b2b2b2b2b2b2b2b
or
rax = 0x4b4b4b4b4b4b4b4b
These were the only register values > 0x7fffffffffffffff -- so the crashes must have happened dereferencing the "address" in rax.
Here's how to download and build the latest minidump-stackwalk (on OS X):
1) Install a reasonably recent XCode (I have 4.5.2) and the latest XCode commandline tools.
2) Visit <https://github.com/mozilla/socorro> and click "download zip".
3) CC=clang CXX=clang++ make breakpad
4) CC="clang -Wno-switch" CXX="clang++ -Wno-switch" make stackwalkerGroup: core-security

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1009675#c43)• 11 years ago |
|  | |

> These were the only register values > 0x7fffffffffffffff
I meant to say:
These were the only register values > 0x7fffffffffff

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1009675#c44)• 11 years ago |
|  | |

Needless to say, people should start testing with ASan builds.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1009675#c45)• 11 years ago |
|  | |

At least for the 2014-06-06-03-02-06-mozilla-central nightly on OS X, the crash address is also 0x2b2b2b2b2b2b2b2b ("++++++++").
I loaded XUL from this m-c nightly into a disassembler (Hopper Disassembler, <http://www.hopperapp.com/>), then found the following assembly code at the address where these crashes happen in that copy of XUL (offset 0x1370818):
0000000001370809 488D8538FEFFFF lea rax, qword [ss:rbp-0x2a0+var\_216]
0000000001370810 49894718 mov qword [ds:r15+0x18], rax
0000000001370814 488B4308 mov rax, qword [ds:rbx+0x8]
0000000001370818 488B00 mov rax, qword [ds:rax]
000000000137081b 8B4808 mov ecx, dword [ds:rax+0x8]
Then I downloaded minidumps corresponding to several of this bug's crashes in this particular m-c nightly and ran the latest minidump-stackwalk on them. They all showed the following as part of the crashing thread's crash state:
rax = 0x2b2b2b2b2b2b2b2b

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1009675#c46)• 11 years ago |
|  | |

0x2b2b2b2b2b2b2b2b and 0x4b4b4b4b4b4b4b4b could conceivably be values used for "poisoning" memory that's been freed. But I thought we always used 0x5a5a5a5a5a5a5a5a for memory poisoning.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1009675#c47)• 11 years ago |
|  | |

> If the OS X and Linux crashes are anything like the crashes on Windows
They're not. They all seem to list 0x0 as "Address" in the summary table at [https://crash-stats.mozilla.com/report/list?signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JSContext\*%2C+JS%3A%3AHandle%3CJS%3A%3AValue%3E%29&product=Firefox&query\_type=contains&range\_unit=weeks&process\_type=any&hang\_type=any&date=2014-06-09+02%3A00%3A00&range\_value=1#tab-reports](https://crash-stats.mozilla.com/report/list?signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JSContext*%2C+JS%3A%3AHandle%3CJS%3A%3AValue%3E%29&product=Firefox&query_type=contains&range_unit=weeks&process_type=any&hang_type=any&date=2014-06-09+02%3A00%3A00&range_value=1#tab-reports)
<https://crash-stats.mozilla.com/report/index/753e42bd-744a-4498-9b4e-a20892140606> is an example of a 014-06-06-03-02-06 build in crash-stats and it claims 0.
All that said, here's what firebot has to say about 0x2b2b2b2b and 0x4b4b4b4b, if that's where we're crashing:
\*firebot\* 0x2b2b2b2b is The poison value written over the nursery after it is
swept. When debugging a GGC crash, 0x2b or not 0x2b: that is the question.
\*firebot\* 0x4b4b4b4b is the poison value (JS\_SWEPT\_TENURED\_PATTERN) written over
tenured heap things and arenas after they are swept.
Terrence, can I somehow enable some sort of "gc more often" mode at runtime after I've loaded github?Flags: needinfo?(terrence)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1009675#c48)• 11 years ago |
|  | |

> They all seem to list 0x0 as "Address" in the summary table
But that's wrong. See [bug 1018360](/show_bug.cgi?id=1018360 "RESOLVED FIXED - Publicly display thread state for crashing thread on Intel 64-bit processors").

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1009675#c49)• 11 years ago |
|  | |

Oh, good to know!
So knowing that we have a swept object, not a null pointer, is actually pretty useful. It means we should be looking for GC hazards in particular, I'd think.
I'll do some auditing of the Promise code tomorrow with that in mind.

|  | [Tim Taubert [:ttaubert] (inactive)](/user_profile?user_id=402526) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1009675#c50)• 11 years ago |
|  | |

Was able to catch this in a debug build with bz's suggestion to force GC more often:
\* thread #1: tid = 0x71f414, 0x00000001015f8860 XUL`js::GetObjectClass(obj=0x00000001141f7638) + 16 at jsfriendapi.h:610, queue = 'com.apple.main-thread', stop reason = EXC\_BAD\_ACCESS (code=EXC\_I386\_GPFLT)
\* frame #0: 0x00000001015f8860 XUL`js::GetObjectClass(obj=0x00000001141f7638) + 16 at jsfriendapi.h:610
frame #1: 0x00000001015f8965 XUL`mozilla::dom::GetDOMClass(obj=0x00000001141f7638) + 21 at BindingUtils.h:185
frame #2: 0x0000000103b9b16f XUL`tag\_nsresult mozilla::dom::UnwrapObject<mozilla::dom::Promise, mozilla::dom::Promise\*>(obj=0x00000001141f7638, value=0x00007fff5fbfcb78, protoID=Promise, protoDepth=0) + 31 at BindingUtils.h:223
frame #3: 0x0000000103b97ee7 XUL`tag\_nsresult mozilla::dom::UnwrapObject<(obj=0x00000001141f7638, value=0x00007fff5fbfcb78)331, mozilla::dom::Promise, mozilla::dom::Promise\*>(JSObject\*, mozilla::dom::Promise\*&) + 39 at BindingUtils.h:259
frame #4: 0x0000000103ba08d2 XUL`mozilla::dom::WrapperPromiseCallback::Call(this=0x0000000130760340, aCx=0x00000001117df170, aValue=Handle<JS::Value> at 0x00007fff5fbfcc88) + 946 at PromiseCallback.cpp:244
frame #5: 0x0000000103b95b41 XUL`mozilla::dom::Promise::RunTask(this=0x000000012d20cce0) + 897 at Promise.cpp:1025
frame #6: 0x0000000103b96447 XUL`mozilla::dom::Promise::RunResolveTask(this=0x000000012d20cce0, aValue=Handle<JS::Value> at 0x00007fff5fbfcf18, aState=Resolved, aAsynchronous=SyncTask) + 871 at Promise.cpp:1219
frame #7: 0x0000000103b9cc9f XUL`mozilla::dom::PromiseResolverMixin::RunInternal(this=0x000000012b37b658) + 207 at Promise.cpp:116
frame #8: 0x0000000103b9cd5c XUL`mozilla::dom::PromiseResolverTask::Run(this=0x000000012b37b640) + 28 at Promise.cpp:144
frame #9: 0x00000001016b6272 XUL`nsThread::ProcessNextEvent(this=0x0000000100321aa0, aMayWait=false, aResult=0x00007fff5fbfd163) + 1570 at nsThread.cpp:766
frame #10: 0x000000010159f36a XUL`NS\_ProcessPendingEvents(thread=0x0000000100321aa0, timeout=20) + 154 at nsThreadUtils.cpp:210
frame #11: 0x0000000103454859 XUL`nsBaseAppShell::NativeEventCallback(this=0x0000000111642600) + 201 at nsBaseAppShell.cpp:98
frame #12: 0x00000001033e03dd XUL`nsAppShell::ProcessGeckoEvents(aInfo=0x0000000111642600) + 445 at nsAppShell.mm:286
It's still open (and I'll try to leave it) so if I can do some more investigation, let me know.

|  | [Tim Taubert [:ttaubert] (inactive)](/user_profile?user_id=402526) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1009675#c51)• 11 years ago |
|  | |

Took me some time but I think I have a solid STR:
1) Open <https://github.com/mozilla/rust/issues/414>
2) Open the web console
3) Paste and execute this:
setInterval(function () $("#discussion\_bucket").updateContent("<div id='discussion\_bucket'>" + new Array(100).join("<h1>foobar</h1>") + "</div>"), 10)
4) Wait a few seconds until Firefox crashes.

|  | [Tim Taubert [:ttaubert] (inactive)](/user_profile?user_id=402526) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1009675#c52)• 11 years ago |
|  | |

BTW, you don't need to be logged in to try the STR above.

|  | [Tim Taubert [:ttaubert] (inactive)](/user_profile?user_id=402526) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1009675#c53)• 11 years ago |
|  | |

Last good nightly: 2014-03-28
First bad nightly: 2014-03-29
Pushlog:
<https://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=6fa163ff81a3&tochange=4f3443da36a1>
I guess this has been around since we enabled generational GC in [bug 619558](/show_bug.cgi?id=619558 "RESOLVED FIXED - [meta] Implement generational garbage collection"), then?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2322616_406194)• 11 years ago |

[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=unaffected)Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2322636_406194)• 11 years ago |

Version: 32 Branch → 31 Branch

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2325693_5189)• 11 years ago |

Whiteboard: [GGC]

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1009675#c54)• 11 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #47](/show_bug.cgi?id=1009675#c47 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]"))
> > If the OS X and Linux crashes are anything like the crashes on Windows
>
> They're not. They all seem to list 0x0 as "Address" in the summary table at
> <https://crash-stats.mozilla.com/report/>
> list?signature=mozilla%3A%3Adom%3A%3AWrapperPromiseCallback%3A%3ACall%28JSCon
> text\*%2C+JS%3A%3AHandle%3CJS%3A%3AValue%3E%29&product=Firefox&query\_type=cont
> ains&range\_unit=weeks&process\_type=any&hang\_type=any&date=2014-06-
> 09+02%3A00%3A00&range\_value=1#tab-reports
>
> <https://crash-stats.mozilla.com/report/index/753e42bd-744a-4498-9b4e>-
> a20892140606 is an example of a 014-06-06-03-02-06 build in crash-stats and
> it claims 0.
>
> All that said, here's what firebot has to say about 0x2b2b2b2b and
> 0x4b4b4b4b, if that's where we're crashing:
>
> \*firebot\* 0x2b2b2b2b is The poison value written over the nursery after it is
> swept. When debugging a GGC crash, 0x2b or not 0x2b: that is the
> question.
> \*firebot\* 0x4b4b4b4b is the poison value (JS\_SWEPT\_TENURED\_PATTERN) written
> over
> tenured heap things and arenas after they are swept.
>
> Terrence, can I somehow enable some sort of "gc more often" mode at runtime
> after I've loaded github?
Yes, absolutely. In an --enable-debug or --enable-gczeal build, you can set the environment JS\_GC\_ZEAL to a flag to trigger several helpful tools. Use JS\_GC\_ZEAL=help to get a list of the various modes.Flags: needinfo?(terrence)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1009675#c55)• 11 years ago |
|  | |

> you can set the environment JS\_GC\_ZEAL to a flag to trigger several helpful tools.
That fails the "at runtime after I've loaded github" criterion. ;)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1009675#c56)• 11 years ago |
|  | |

From terrence on IRC:
the C interface you want is JS\_SetGCZeal(cx, zealMode, frequency)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1009675#c57)• 11 years ago |
|  | |

Tim, thank you for coming up with those STR and for the stack. And Steven, thank you \_very\_ much for figuring out the right direction to be poking here!
So we're on this line in WrapperPromiseCallback::Call:
244 nsresult r = UNWRAP\_OBJECT(Promise, valueObj, returnedPromise);
and we have:
(gdb) p valueObj.ptr->type\_.value
$7 = ('js::types::TypeObject' \*) 0x2b2b2b2b2b2b2b2b
valueObj came from here:
JS::Rooted<JSObject\*> valueObj(aCx, &retValue.toObject());
and retValue came from here:
JS::Rooted<JS::Value> retValue(aCx,
mCallback->Call(value, rv, CallbackObject::eRethrowExceptions));
What I think we have here is a rooting hazard that the analysis is missing for some reason. In particular, in AnyCallback::Call we do this (with some error handling elided):
CallSetup s(this, aRv, aExceptionHandling);
return Call(s.GetContext(), JS::UndefinedHandleValue, value, aRv);
where the Call() function returns a JS::Value. So between when that inner call returns and when we ourselves return there's an unrooted Value hanging out. But ~CallSetup can GC, and then we end up with a dead object.
Here's a testcase that reliably reproduces the crash, in every build going back to Firefox 29 (when we enabled Promise). All you have to do is install <https://www.squarefree.com/extensions/domFuzzLite3.xpi> and run this:
<script>
var s = document.querySelector("script");
var obs = new MutationObserver(function() { fuzzPriv.forceGC(); });
obs.observe(s, { childList: true });
Promise.resolve(5).then(function() {
s.appendChild(document.createTextNode("x"));
return {};
})
</script>
or use your favorite less-reliable method of triggering GC if you don't want the extension.
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=unaffected) → [affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected)
[tracking-firefox30](/buglist.cgi?f1=cf_tracking_firefox30&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%3F)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1009675#c58)• 11 years ago |
|  | |

Looks like we only enabled exact rooting in Firefox 28, so builds before that should not be affected at all. Firefox 28 is \_probably\_ affected only if there is a non-Promise API that's calling WebIDL callbacks that return "any" or "object".
Oh, and the reason the testcase in [comment 57](/show_bug.cgi?id=1009675#c57 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]") crashes is that ~CallSetup runs mutation observers, so that lets us explicitly trigger a gc in ~CallSetup.
Steve Fink is going to fix the analysis; I'll fix the bindings bug here.Assignee: nobody → bzbarsky

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1009675#c59)• 11 years ago |
|  | |

[Bug 1022773](/show_bug.cgi?id=1022773 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC") is the analysis bug.See Also: → [1022773](/show_bug.cgi?id=1022773 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC")

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2332003_279076)• 11 years ago |

Blocks: [GenerationalGC](/show_bug.cgi?id=619558 "RESOLVED FIXED - [meta] Implement generational garbage collection")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2341192_406194)• 11 years ago |

[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2366640_75935)• 11 years ago |

Blocks: [1022201](/show_bug.cgi?id=1022201 "RESOLVED WORKSFORME - Intermittent base.py, test_animations_omta.html | application crashed [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>)]")

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1009675#c60)• 11 years ago |
|  | |

While this might show up on the release population, it doesn't currently show up as a topcrasher there and that is likely due to more GitHub devs using pre-release channels. Will track this for FF30 and it could be a potential ride-along, depending on risk, but right now doesn't look like a chemspill driver - let's wait and watch what happens in the next day or two as we absorb users on FF30 release.
[tracking-firefox30](/buglist.cgi?f1=cf_tracking_firefox30&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%2B)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1009675#c61)• 11 years ago |
|  | |

For what it's worth, I suspect risk will be pretty low and the bigger worry for me is potential exploitability than stability...
I agree we shouldn't block the release on this, but we should strongly consider it as a ride-along.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1009675#c62)• 11 years ago |
|  | |

Attached patch

[part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit](attachment.cgi?id=8437929&action=diff) (obsolete)
— [Details](attachment.cgi?id=8437929&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437929)

Peter, if you won't be able to get to this stuff pretty soon, let me know, please. This needs backporting to beta 31.
[Attachment #8437929](/attachment.cgi?id=8437929&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: review?(peterv)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1009675#c63)• 11 years ago |
|  | |

Attached patch

[part 2. Return WebIDL 'any' values as handles](attachment.cgi?id=8437930&action=diff) (obsolete)
— [Details](attachment.cgi?id=8437930&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437930)

[Attachment #8437930](/attachment.cgi?id=8437930&action=edit "part 2.  Return WebIDL 'any' values as handles") -
Flags: review?(peterv)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1009675#c64)• 11 years ago |
|  | |

Attached patch

[part 3. Return WebIDL 'object' values as handles](attachment.cgi?id=8437931&action=diff) (obsolete)
— [Details](attachment.cgi?id=8437931&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437931)

[Attachment #8437931](/attachment.cgi?id=8437931&action=edit "part 3.  Return WebIDL 'object' values as handles") -
Flags: review?(peterv)

|  | [Kyle Huey (Exited; not receiving bugmail, old account, do not use)](/user_profile?user_id=336670) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2465082_336670)• 11 years ago |

Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---) → [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1009675#c65)• 11 years ago |
|  | |

Comment on [attachment 8437929](/attachment.cgi?id=8437929 "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[details]](/attachment.cgi?id=8437929&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[diff]](/attachment.cgi?id=8437929&action=diff "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437929)
part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit
Review of [attachment 8437929](/attachment.cgi?id=8437929 "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[details]](/attachment.cgi?id=8437929&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[diff]](/attachment.cgi?id=8437929&action=diff "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437929):
-----------------------------------------------------------------
::: dom/bindings/Codegen.py
@@ +5808,5 @@
> + args.append(CGGeneric("result"))
> + else:
> + assert resultOutParam is "ptr"
> + args.append(CGGeneric("&result"))
> +
Trailing whitespace.
[Attachment #8437929](/attachment.cgi?id=8437929&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: review?(peterv) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2498617_231770)• 11 years ago |

Blocks: [GC.stability](/show_bug.cgi?id=1008341 "NEW - [meta] GC Correctness & Stability")

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1009675#c66)• 11 years ago |
|  | |

Comment on [attachment 8437930](/attachment.cgi?id=8437930 "part 2.  Return WebIDL 'any' values as handles") [[details]](/attachment.cgi?id=8437930&action=edit "part 2.  Return WebIDL 'any' values as handles") [[diff]](/attachment.cgi?id=8437930&action=diff "part 2.  Return WebIDL 'any' values as handles") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437930)
part 2. Return WebIDL 'any' values as handles
Review of [attachment 8437930](/attachment.cgi?id=8437930 "part 2.  Return WebIDL 'any' values as handles") [[details]](/attachment.cgi?id=8437930&action=edit "part 2.  Return WebIDL 'any' values as handles") [[diff]](/attachment.cgi?id=8437930&action=diff "part 2.  Return WebIDL 'any' values as handles") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437930):
-----------------------------------------------------------------
::: content/html/content/src/nsGenericHTMLElement.h
@@ +132,2 @@
> {
> + return GetItemValue(aCx, GetWrapperPreserveColor(), aRetval, aError);
I'd drop |return |.
::: dom/base/DOMRequest.cpp
@@ +82,5 @@
>
> NS\_IMETHODIMP
> DOMRequest::GetResult(JS::MutableHandle<JS::Value> aResult)
> {
> + GetResult(aResult);
This doesn't seem right, I think you wanted to pass null for the context.
::: dom/base/DOMRequest.h
@@ +60,5 @@
> + /\* void GetResult(JS::MutableHandle<JS::Value> aRetval) const
> + {
> + GetResult(nullptr, aRetval);
> + }
> + \*/
And this can go.
::: dom/base/nsGlobalWindow.cpp
@@ +10587,5 @@
> +nsGlobalWindow::GetInterface(JSContext\* aCx, nsIJSID\* aIID,
> + JS::MutableHandle<JS::Value> aRetval,
> + ErrorResult& aError)
> +{
> + return dom::GetInterface(aCx, this, aIID, aRetval, aError);
I'd drop |return |.
::: dom/bindings/BindingUtils.h
@@ +1661,2 @@
> {
> + return GetInterfaceImpl(aCx, aThis, aThis, aIID, aRetval, aError);
I'd drop |return |.
::: dom/events/MessageEvent.cpp
@@ +78,2 @@
> JS::Rooted<JS::Value> data(aCx, mData);
> if (!JS\_WrapValue(aCx, &data)) {
Could just do
aData.set(mData);
if (!JS\_WrapValue(aCx, aData)) {
?
::: js/xpconnect/src/event\_impl\_gen.py
@@ +311,2 @@
> fd.write(" nsresult rv = NS\_ERROR\_UNEXPECTED;\n")
> + fd.write(" if (m%s && !XPCVariant::VariantDataToJS(m%s, &rv, aRetval)) {\n" % (firstCap(a.name), firstCap(a.name)))
Hmm, this used to return null if the member was null, shouldn't we keep that behaviour?
[Attachment #8437930](/attachment.cgi?id=8437930&action=edit "part 2.  Return WebIDL 'any' values as handles") -
Flags: review?(peterv) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1009675#c67)• 11 years ago |
|  | |

> Could just do
Yes, done.
> Hmm, this used to return null if the member was null
Good catch. Fixed like so:
fd.write(" nsresult rv = NS\_ERROR\_UNEXPECTED;\n")
fd.write(" if (!m%s) {\n" % firstCap(a.name))
fd.write(" aRetval.setNull();\n")
fd.write(" } else if (!XPCVariant::VariantDataToJS(m%s, &rv, aRetval)) {\n" % (firstCap(a.name)))
fd.write(" aRv.Throw(NS\_ERROR\_FAILURE);\n")
fd.write(" }\n")
Applied the rest of the [comment 65](/show_bug.cgi?id=1009675#c65 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]") and [comment 66](/show_bug.cgi?id=1009675#c66 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]") comments.

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1009675#c68)• 11 years ago |
|  | |

Comment on [attachment 8437931](/attachment.cgi?id=8437931 "part 3.  Return WebIDL 'object' values as handles") [[details]](/attachment.cgi?id=8437931&action=edit "part 3.  Return WebIDL 'object' values as handles") [[diff]](/attachment.cgi?id=8437931&action=diff "part 3.  Return WebIDL 'object' values as handles") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437931)
part 3. Return WebIDL 'object' values as handles
Review of [attachment 8437931](/attachment.cgi?id=8437931 "part 3.  Return WebIDL 'object' values as handles") [[details]](/attachment.cgi?id=8437931&action=edit "part 3.  Return WebIDL 'object' values as handles") [[diff]](/attachment.cgi?id=8437931&action=diff "part 3.  Return WebIDL 'object' values as handles") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8437931):
-----------------------------------------------------------------
::: content/base/src/nsDocument.cpp
@@ +5998,2 @@
> JSObject\* constructorObject = JS\_GetFunctionObject(constructor);
> + if (!constructorObject) {
This shouldn't ever happen, no? IIRC it returns the same object.
::: dom/base/nsGlobalWindow.h
@@ +1000,5 @@
> {
> if (mDoc) {
> mDoc->WarnOnceAbout(nsIDocument::eWindow\_Content);
> }
> + return GetContent(aCx, aRetval, aError);
I'd drop |return |.
::: dom/nfc/MozNDEFRecord.h
@@ +70,1 @@
> }
This could just be:
if (mType) {
JS::ExposeObjectToActiveJS(mType);
}
retval.set(mType);
@@ +76,5 @@
> + JS::ExposeObjectToActiveJS(mId);
> + retval.set(mId);
> + } else {
> + retval.set(nullptr);
> + }
Same here.
@@ +90,1 @@
> }
And here.
[Attachment #8437931](/attachment.cgi?id=8437931&action=edit "part 3.  Return WebIDL 'object' values as handles") -
Flags: review?(peterv) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1009675#c69)• 11 years ago |
|  | |

> This shouldn't ever happen, no? IIRC it returns the same object.
Indeed. Changed to just do:
aRetval.set(JS\_GetFunctionObject(constructor));
Applied the other comments.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1009675#c70)• 11 years ago |
|  | |

Attached patch

[part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit](attachment.cgi?id=8438523&action=diff)
— [Details](attachment.cgi?id=8438523&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438523)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2501275_20209)• 11 years ago |

[Attachment #8437929](/attachment.cgi?id=8437929&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Attachment is obsolete: true

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1009675#c71)• 11 years ago |
|  | |

Attached patch

[part 2. Return WebIDL 'any' values as handles](attachment.cgi?id=8438524&action=diff)
— [Details](attachment.cgi?id=8438524&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438524)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2501291_20209)• 11 years ago |

[Attachment #8437930](/attachment.cgi?id=8437930&action=edit "part 2.  Return WebIDL 'any' values as handles") -
Attachment is obsolete: true

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1009675#c72)• 11 years ago |
|  | |

Attached patch

[part 3. Return WebIDL 'object' values as handles](attachment.cgi?id=8438526&action=diff)
— [Details](attachment.cgi?id=8438526&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438526)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2501340_20209)• 11 years ago |

[Attachment #8437931](/attachment.cgi?id=8437931&action=edit "part 3.  Return WebIDL 'object' values as handles") -
Attachment is obsolete: true

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1009675#c73)• 11 years ago |
|  | |

Comment on [attachment 8438523](/attachment.cgi?id=8438523 "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[details]](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[diff]](/attachment.cgi?id=8438523&action=diff "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438523)
part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit
This is actually a sec-approval request for all three patches.
[Security approval request comment]
How easily could an exploit be constructed based on the patch? Not very easily, imo.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem? No.
Which older supported branches are affected by this flaw? Anything based on Gecko 28 or later. I think that means just 29, 30, beta 31, aurora 32
If not all supported branches, which bug introduced the flaw?
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be? I have backports for Aurora 32 and beta 31. It should be pretty simple to create them for 30 and 29 as needed, I expect.
How likely is this patch to cause regressions; how much testing does it need? This has moderate risk of me and Peter missing something about the mass-changes... In some ways the more testing we can get the better.
[Attachment #8438523](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2503969_280903)• 11 years ago |

[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected)
[tracking-firefox30](/buglist.cgi?f1=cf_tracking_firefox30&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%2B) → ---
[tracking-firefox33](/buglist.cgi?f1=cf_tracking_firefox33&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox33&o1=equals&v1=%2B)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1009675#c74)• 11 years ago |
|  | |

Attached patch

[Part 2 for Aurora 32](attachment.cgi?id=8438558&action=diff)
— [Details](attachment.cgi?id=8438558&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438558)

Part 1 and part 3 apply on Aurora as-is

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2504372_20209)• 11 years ago |

[Attachment #8438524](/attachment.cgi?id=8438524&action=edit "part 2.  Return WebIDL 'any' values as handles") -
Attachment is obsolete: true

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1009675#c75)• 11 years ago |
|  | |

Comment on [attachment 8438523](/attachment.cgi?id=8438523 "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[details]](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[diff]](/attachment.cgi?id=8438523&action=diff "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438523)
part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit
sec-approval+ for this to go into trunk. Since there is some risk, putting it in sooner is probably better.
[Attachment #8438523](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: sec-approval? → sec-approval+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1009675#c76)• 11 years ago |
|  | |

Attached patch

[Addendum to part 2 for beta 31](attachment.cgi?id=8438663&action=diff)
— [Details](attachment.cgi?id=8438663&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438663)

[Attachment #8438663](/attachment.cgi?id=8438663&action=edit "Addendum to part 2 for beta 31") -
Flags: review?(peterv)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1009675#c77)• 11 years ago |
|  | |

Attached patch

[Addendum to part 3 for beta 31](attachment.cgi?id=8438664&action=diff)
— [Details](attachment.cgi?id=8438664&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438664)

[Attachment #8438664](/attachment.cgi?id=8438664&action=edit "Addendum to part 3 for beta 31") -
Flags: review?(peterv)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515303_20209)• 11 years ago |

Blocks: [ExactRooting](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1009675#c78)• 11 years ago |
|  | |

Comment on [attachment 8438523](/attachment.cgi?id=8438523 "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[details]](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[diff]](/attachment.cgi?id=8438523&action=diff "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438523)
part 1. Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [Bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting"), effectively.
User impact if declined: Crashes that are pretty easy to trigger from content and
may be exploitable.
Testing completed (on m-c, etc.): Passes tests.
Risk to taking this patch (and alternatives if risky): Medium-ish risk; there
were a lot of changes here...
String or IDL/UUID changes made by this patch: None.
[Attachment #8438523](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: approval-mozilla-beta?
[Attachment #8438523](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: approval-mozilla-aurora?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515394_20209)• 11 years ago |

[Attachment #8438558](/attachment.cgi?id=8438558&action=edit "Part 2 for Aurora 32") -
Flags: approval-mozilla-aurora?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515408_20209)• 11 years ago |

[Attachment #8438526](/attachment.cgi?id=8438526&action=edit "part 3.  Return WebIDL 'object' values as handles") -
Flags: approval-mozilla-aurora?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=1009675#c79)• 11 years ago |
|  | |

 <https://hg.mozilla.org/integration/mozilla-inbound/rev/e394ea8b5171>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/35314cd05df3>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/72961f73cb4a>
I did NOT check in the test from [comment 57](/show_bug.cgi?id=1009675#c57 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]").Flags: in-testsuite?Whiteboard: [GGC] → [GGC][testcase in comment 57]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=1009675#c80)• 11 years ago |
|  | |

Attached patch

[Part 2 for beta 31](attachment.cgi?id=8438680&action=diff)
— [Details](attachment.cgi?id=8438680&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438680)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515640_20209)• 11 years ago |

[Attachment #8438558](/attachment.cgi?id=8438558&action=edit "Part 2 for Aurora 32") -
Attachment is obsolete: true
[Attachment #8438558](/attachment.cgi?id=8438558&action=edit "Part 2 for Aurora 32") -
Flags: approval-mozilla-aurora?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515720_20209)• 11 years ago |

[Attachment #8438524](/attachment.cgi?id=8438524&action=edit "part 2.  Return WebIDL 'any' values as handles") -
Attachment is obsolete: false

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515723_20209)• 11 years ago |

[Attachment #8438558](/attachment.cgi?id=8438558&action=edit "Part 2 for Aurora 32") -
Attachment is obsolete: false

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515831_20209)• 11 years ago |

[Attachment #8438558](/attachment.cgi?id=8438558&action=edit "Part 2 for Aurora 32") -
Flags: approval-mozilla-aurora?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=1009675#c81)• 11 years ago |
|  | |

Attached patch

[Part 3 for beta 31](attachment.cgi?id=8438683&action=diff)
— [Details](attachment.cgi?id=8438683&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1009675&attachment=8438683)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2515950_20209)• 11 years ago |

[Attachment #8438680](/attachment.cgi?id=8438680&action=edit "Part 2 for beta 31") -
Flags: approval-mozilla-beta?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2516127_20209)• 11 years ago |

[Attachment #8438683](/attachment.cgi?id=8438683&action=edit "Part 3 for beta 31") -
Flags: approval-mozilla-beta?

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2517849_24295)• 11 years ago |

[Attachment #8438663](/attachment.cgi?id=8438663&action=edit "Addendum to part 2 for beta 31") -
Flags: review?(peterv) → review+

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2517887_24295)• 11 years ago |

[Attachment #8438664](/attachment.cgi?id=8438664&action=edit "Addendum to part 3 for beta 31") -
Flags: review?(peterv) → review+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=1009675#c82)• 11 years ago |
|  | |

For the record, this is the updated analysis's hazard output for this bug:
Function '\_ZN7mozilla3dom11AnyCallback4CallEN2JS6HandleINS2\_5ValueEEERNS\_11ErrorResultENS0\_14CallbackObject17ExceptionHandlingE|JS::Value mozilla::dom::AnyCallback::Call(class JS::Handle<JS::Value>, mozilla::ErrorResult\*, uint32)' has unrooted '<returnvalue>' of type 'JS::Value' live across GC call '\_ZN7mozilla3dom14CallbackObject9CallSetupD1Ev|void mozilla::dom::CallbackObject::CallSetup::~CallSetup()' at dist/include/mozilla/dom/PromiseBinding.h:126
dist/include/mozilla/dom/PromiseBinding.h:129
GC Function: \_ZN7mozilla3dom14CallbackObject9CallSetupD1Ev|void mozilla::dom::CallbackObject::CallSetup::~CallSetup()
void mozilla::dom::CallbackObject::CallSetup::~CallSetup(int32)
uint8 JS\_ReportPendingException(JSContext\*)
uint8 js\_ReportUncaughtException(JSContext\*)
void js::CallErrorReporter(JSContext\*, int8\*, JSErrorReport\*)
IndirectCall: hook

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=1009675#c83)• 11 years ago |
|  | |

Steve, that looks lovely.

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=1009675#c84)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e394ea8b5171>
<https://hg.mozilla.org/mozilla-central/rev/35314cd05df3>
<https://hg.mozilla.org/mozilla-central/rev/72961f73cb4a>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla33

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2557965_495955)• 11 years ago |

[Attachment #8438523](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2557980_495955)• 11 years ago |

[Attachment #8438526](/attachment.cgi?id=8438526&action=edit "part 3.  Return WebIDL 'object' values as handles") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2557993_495955)• 11 years ago |

[Attachment #8438558](/attachment.cgi?id=8438558&action=edit "Part 2 for Aurora 32") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=1009675#c85)• 11 years ago |
|  | |

Since there are some risks, I've only approved the aurora change. I will approve the beta changes for beta 3.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=1009675#c86)• 11 years ago |
|  | |

Updated the documentation at <https://developer.mozilla.org/en-US/docs/Mozilla/WebIDL_bindings#any> and <https://developer.mozilla.org/en-US/docs/Mozilla/WebIDL_bindings#object>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=1009675#c87)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/1d4e44c32383>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/e993e93566fe>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/d740cc08d966>
Should we consider this for b2g30 (v1.4) backporting as well?
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=%3F)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2589248_451704)• 11 years ago |

[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=1009675#c88)• 11 years ago |
|  | |

This hasn't actually landed on beta 31 yet, has it?Flags: needinfo?(lhenry)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 89](/show_bug.cgi?id=1009675#c89)• 11 years ago |
|  | |

Correct. It has not.
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2592491_406194)• 11 years ago |

Flags: needinfo?(lhenry)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 90](/show_bug.cgi?id=1009675#c90)• 11 years ago |
|  | |

Beta 2 built. Taking the patches for beta 3.

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2988660_495955)• 11 years ago |

[Attachment #8438680](/attachment.cgi?id=8438680&action=edit "Part 2 for beta 31") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2988664_495955)• 11 years ago |

[Attachment #8438683](/attachment.cgi?id=8438683&action=edit "Part 3 for beta 31") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a2988669_495955)• 11 years ago |

[Attachment #8438523](/attachment.cgi?id=8438523&action=edit "part 1.  Change the return value of getRetvalDeclarationForType to allow more than two states for the outparam bit") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 91](/show_bug.cgi?id=1009675#c91)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/52c63eeaf297>
<https://hg.mozilla.org/releases/mozilla-beta/rev/f69c307f1ebf>
<https://hg.mozilla.org/releases/mozilla-beta/rev/f97b33e8ec22>
(In reply to Ryan VanderMeulen [:RyanVM UTC-4] from [comment #87](/show_bug.cgi?id=1009675#c87 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]"))
> Should we consider this for b2g30 (v1.4) backporting as well?
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)Flags: needinfo?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 92](/show_bug.cgi?id=1009675#c92)• 11 years ago |
|  | |

If it applies cleanly there, might be worth it just to reduce the differences between the branches. It's not high priority, though, since afaik exact marking is not enabled on b2g30.Flags: needinfo?(bzbarsky)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 93](/show_bug.cgi?id=1009675#c93)• 11 years ago |
|  | |

Lots of tedious unbitrotting trying to get the beta patches to apply to b2g30.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 94](/show_bug.cgi?id=1009675#c94)• 11 years ago |
|  | |

Given that exact rooting is required to hit this, marking v1.4 as unaffected since the benefits of any backport don't justify the effort in getting these patches to apply.
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)

|  | [Joel Maher ( :jmaher ) (UTC -8)](/user_profile?user_id=324370) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a3628113_324370)• 11 years ago |

Depends on: [1029652](/show_bug.cgi?id=1029652 "RESOLVED WONTFIX - 4.14% win8 tresize regression on mozilla-beta (fx31) from revision f97b33e8ec22 on June 17th")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a5014151_280903)• 11 years ago |

Whiteboard: [GGC][testcase in comment 57] → [GGC][testcase in comment 57][adv-main31+]

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 95](/show_bug.cgi?id=1009675#c95)• 11 years ago |
|  | |

Rerpoduced the original issue using the following build:
- <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014/05/2014-05-13-03-02-01-mozilla-central/>
- Used the STR from [comment # 52](/show_bug.cgi?id=1009675#c52 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]") and reproduced the issue several times
Went through the following verification:
Win 8.1: [PASSED]
- fx 33.0a1 [20140714030201]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-14-03-02-01-mozilla-central/>
- fx 32.0a2 [20140714004001]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-14-00-40-01-mozilla-aurora/>
- fx 31.0b9 [20140710141843]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/31.0b9/win32/en-US/>
Ubuntu 13.10 x64: [PASSED]
- fx 33.0a1 [20140714030201]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-14-03-02-01-mozilla-central/>
- fx 32.0a2 [20140714004001]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-14-00-40-01-mozilla-aurora/>
- fx 31.0b9 [20140710141843]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/31.0b9/linux-x86_64/en-US/>
OSX 10.9.4 x64: [PASSED]
- fx 33.0a1 [20140714030201]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-14-03-02-01-mozilla-central/>
- fx 32.0a2 [20140714004001]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-07-14-00-40-01-mozilla-aurora/>
- fx 31.0b9 [20140710141843]: <http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/31.0b9/mac/en-US/>
- ran through the STR using several different tabs
- ran through the STR using several different windows
- ran through the STR using private windows/tabs
- ran through the STR using e10s windows/tabsStatus: RESOLVED → VERIFIEDQA Whiteboard: [qa!]
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a41173862_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a65078065_1689)• 9 years ago |

Group: core-security-release

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1009675#a152481289_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=1009675&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_476ff17b_20250125_062757.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1020008)
* [XML](/show_bug.cgi?ctype=xml&id=1020008)

Closed
[Bug 1020008](/show_bug.cgi?id=1020008)

Opened 11 years ago
Closed 11 years ago

# Out-of-bounds read in gfxPlatform::GetPrefLangName

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Out-of-bounds read in gfxPlatform::GetPrefLangName

## Categories

### (Core :: Graphics: Text, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20Text#Graphics%3A%20Text)

Graphics: Text
▾

Core :: Graphics: Text

Issues with glyph rasterization and painting, font format support, and interfacing with platform font APIs. For issues with font selection, text shaping, and glyph selection, see the Layout: Text and Fonts component.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20Text&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20Text)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla32

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) |
| firefox-esr24 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix) |
| b2g-v1.3 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=wontfix) |
| b2g-v1.3T | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=wontfix) |
| b2g-v1.4 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=wontfix) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 |  | fixed |
| firefox32 |  | fixed |
| firefox-esr24 |  | wontfix |
| b2g-v1.3 |  | wontfix |
| b2g-v1.3T |  | wontfix |
| b2g-v1.4 |  | wontfix |
| b2g-v2.0 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mccr8, Assigned: jfkthame)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e0f9759e1d7514ae4adfd806869e3c5d?d=mm&size=40)  [jfkthame](/user_profile?user_id=329583)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/029a38b9773f1943419c24b7c3d93761?d=mm&size=40)  [lsalzman](/user_profile?user_id=536714)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[coverity-analysis](/show_bug.cgi?id=1230156 "NEW - [meta] Coverity Static Analysis fixes")

Dependency [tree](/showdependencytree.cgi?id=1020008&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1020008)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: coverity, csectype-bounds, sec-low, Whiteboard: [adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[coverity](/buglist.cgi?keywords=coverity&resolution=---),
[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+]

QA Whiteboard:

[qa-]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [use mozilla::ArrayLength for array size.](/attachment.cgi?id=8433999)  [11 years ago](#c1)  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)   2.63 KB, patch | smontagu : [review+](#c2 "11 years ago")  Sylvestre : [approval-mozilla-beta+](#c9 "11 years ago") | [Details](/attachment.cgi?id=8433999&action=edit) | [Diff](/attachment.cgi?id=8433999&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020008&attachment=8433999) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1020008#c0)• 11 years ago |
|  | |

Here is code from gfxPlatform::GetPrefLangName:
if (uint32\_t(aLang) < uint32\_t(eFontPrefLang\_AllCount))
return gPrefLangNames[uint32\_t(aLang)];
eFontPrefLang\_AllCount is 32, whereas gPrefLangNames has 31 entries in it. Thus if you pass in 31, you'll end up reading past the end of gPrefLangNames. Maybe the check should be against eFontPrefLang\_LangCount (which is 30) instead of eFontPrefLang\_AllCount? Presumably a static assert could catch problems here in the future.
At first I thought this was a regression from [bug 213517](/show_bug.cgi?id=213517 "RESOLVED FIXED - Consider making x-user-defined an alias of windows-1252 for IE/Chrome/Safari compat"), but it looks like that \_removed\_ an entry from eFontPrefLang, so I think it made it slightly better. I did a bit of digging, but I'm not sure when this was introduced. Coverity first noticed this in December 2012.

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1020008#c1)• 11 years ago |
|  | |

Attached patch

[use mozilla::ArrayLength for array size.](attachment.cgi?id=8433999&action=diff)
— [Details](attachment.cgi?id=8433999&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020008&attachment=8433999)

Looks to me like the simple solution here is to scrap the enum constants for the count of lang names, and just use ArraySize when referring to the array of strings.
[Attachment #8433999](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") -
Flags: review?(smontagu)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a32535_329583)• 11 years ago |

Assignee: nobody → jfkthameStatus: NEW → ASSIGNED

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a61765_406194)• 11 years ago |

Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1020008#c2)• 11 years ago |
|  | |

Comment on [attachment 8433999](/attachment.cgi?id=8433999 "use mozilla::ArrayLength for array size.") [[details]](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") [[diff]](/attachment.cgi?id=8433999&action=diff "use mozilla::ArrayLength for array size.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020008&attachment=8433999)
use mozilla::ArrayLength for array size.
Review of [attachment 8433999](/attachment.cgi?id=8433999 "use mozilla::ArrayLength for array size.") [[details]](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") [[diff]](/attachment.cgi?id=8433999&action=diff "use mozilla::ArrayLength for array size.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020008&attachment=8433999):
-----------------------------------------------------------------
Makes sense
[Attachment #8433999](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") -
Flags: review?(smontagu) → review+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1020008#c3)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/cbb2e610473e>Target Milestone: --- → mozilla32

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1020008#c4)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/cbb2e610473e>
Should this go to Aurora or anything?Status: ASSIGNED → RESOLVEDClosed: 11 years ago
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)Flags: needinfo?(jfkthame)Resolution: --- → FIXED

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1020008#c5)• 11 years ago |
|  | |

(In reply to Wes Kocher (:KWierso) from [comment #4](/show_bug.cgi?id=1020008#c4 "RESOLVED FIXED - Out-of-bounds read in gfxPlatform::GetPrefLangName"))
> <https://hg.mozilla.org/mozilla-central/rev/cbb2e610473e>
>
> Should this go to Aurora or anything?
There's no compelling need for it to do so IMO. We may sometimes read an out-of-bounds value, but we don't do anything dangerous with it, AFAICS.Flags: needinfo?(jfkthame)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1020008#c6)• 11 years ago |
|  | |

The next ESR is FF31 so does that make a more compelling case for uplifting this?Flags: needinfo?(jfkthame)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a2507289_272375)• 11 years ago |

[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1020008#c7)• 11 years ago |
|  | |

Any security risk here looks low (AFAICS), but the patch itself is also extremely low risk, so there's no reason -not- to take it.Flags: needinfo?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1020008#c8)• 11 years ago |
|  | |

Comment on [attachment 8433999](/attachment.cgi?id=8433999 "use mozilla::ArrayLength for array size.") [[details]](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") [[diff]](/attachment.cgi?id=8433999&action=diff "use mozilla::ArrayLength for array size.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020008&attachment=8433999)
use mozilla::ArrayLength for array size.
Nominating for beta (this is currently on aurora) so that it'll go into ESR31. It's minor, but very safe, and nicer for future maintenance if the ESR code is correct and matches trunk code going forward.
Approval Request Comment
[Feature/regressing bug #]: Longstanding flaw, found by coverity analysis rather than observed buggy/crashy behavior.
[User impact if declined]: Probably none; it's not entirely clear to me whether the error here can actually be reached from web content, nor that anything worse than perhaps choosing the wrong font would happen. But -perhaps- in exactly the right conditions, it'd be possible to reach an out-of-bounds read, and crash with a protection violation if the location happens to be unreadable.
[Describe test coverage new/current, TBPL]: There's no directly testable behavior exposed here. (Only if it were thoroughly broken, font-related reftests would start to fail.)
[Risks and why]: Minimal risk, just avoids potentially reading one element too far from a static array and getting junk.
[String/UUID change made/needed]: none
[Attachment #8433999](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") -
Flags: approval-mozilla-beta?

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a2549833_495955)• 11 years ago |

[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1020008#c9)• 11 years ago |
|  | |

Comment on [attachment 8433999](/attachment.cgi?id=8433999 "use mozilla::ArrayLength for array size.") [[details]](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") [[diff]](/attachment.cgi?id=8433999&action=diff "use mozilla::ArrayLength for array size.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020008&attachment=8433999)
use mozilla::ArrayLength for array size.
As Lukas said, 31 is an ESR release. We are going to maintain it for a while.
[Attachment #8433999](/attachment.cgi?id=8433999&action=edit "use mozilla::ArrayLength for array size.") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1020008#c10)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/de8176e8f333>
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=wontfix)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=wontfix)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=wontfix)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) → ---

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a3111131_280903)• 11 years ago |

Whiteboard: [adv-main31+]

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1020008#c11)• 11 years ago |
|  | |

Marking this as [qa-] due to the lack of STR/POC that could be used for verification. If anything can be provided to help test and verify, I'll happily go through it!QA Whiteboard: [qa-]

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a39336237_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a63240464_1689)• 9 years ago |

Group: core-security-release

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020008#a129062122_495955)• 7 years ago |

Blocks: [coverity-analysis](/show_bug.cgi?id=1230156 "NEW - [meta] Coverity Static Analysis fixes")
You need to [log in](/show_bug.cgi?id=1020008&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.oracle.com_1aa3bc48_20250125_062749.html ===


* [Skip to content](#maincontent)
* [Accessibility Policy](https://www.oracle.com/corporate/accessibility/)

Products
Industries
Resources
Customers
Partners
Developers
Company

Close Search

Search Oracle.com

* QUICK LINKS
* [Oracle Cloud Infrastructure](/cloud/)
* [Oracle Fusion Cloud Applications](/applications/)
* [Oracle Database](/database/technologies/)
* [Download Java](/java/technologies/downloads/)
* [Careers at Oracle](/careers/)

Search

[Country
![]()](/countries-list.html#countries)

View Accounts

Back
Cloud Account
[Sign in to Cloud](/cloud/sign-in.html)
[Sign Up for Free Cloud Tier](/cloud/free/)

Oracle Account

* [Sign-In](https://www.oracle.com/webapps/redirect/signon?nexturl=)
* [Create an Account](https://profile.oracle.com/myprofile/account/create-account.jspx)

* [Help](/corporate/contact/help.html)
* Sign Out

[Contact Sales](/corporate/contact/ "Contact Sales")

[Menu

Menu](/global-menu-v2/)

* [Security Alerts](/security-alerts/)

# Oracle Solaris Third Party Bulletin - April 2016

## Oracle Solaris Third Party Bulletin - April 2016

### Description

The Oracle Solaris Third Party Bulletin announces patches for one or more security vulnerabilities fixed in third party software that is included in Oracle Solaris distributions. Starting January 20, 2015, Third Party Bulletins are released on the same day when Oracle Critical Patch Updates are released. These bulletins will also be updated on the Tuesday closest to the 17th of the following two months after their release (i.e. the two months between the normal quarterly Critical Patch Update publication dates). In addition, Third Party Bulletins may also be updated for vulnerability fixes deemed too critical to wait for the next monthly update.

**Due to the threat posed by a successful attack, Oracle strongly recommends that customers apply Third Party Bulletin fixes as soon as possible.**

### Patch Availability

Please see My Oracle Support Note [1448883.1](https://support.oracle.com/epmos/faces/DocumentDisplay?_afrLoop=98356520554156&id=1448883.1)

### Third Party Bulletin Schedule

Third Party Bulletins are released on the Tuesday closest to the 17th day of January, April, July and October. The next four dates are:

* 19 July 2016
* 18 October 2016
* 17 January 2017
* 18 April 2017

### References

* Oracle Critical Patch Updates and Security Alerts main page  [ [Oracle Technology Network](/security-alerts/) ]
* Oracle Critical Patch Updates and Security Alerts - Frequently Asked Questions [ [CPU FAQ](/security-alerts/cpufaq.html) ]
* Risk Matrix definitions   [ [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html) ]
* Use of Common Vulnerability Scoring System (CVSS) by Oracle   [ [Oracle CVSS Scoring](/security-alerts/cvssscoringsystem.html) ]

### Modification History

| 2017-October-16 | Rev 8. Added 11.3 as Supported Versions Affected for CVE-2016-2108 |
| --- | --- |
| 2016-September-21 | Rev 7. Added new CVEs fixed via Firefox upgrade |
| 2016-July-08 | Rev 6. Added NTP CVEs |
| 2016-June-27 | Rev 5. Added OpenSSL CVE-2016-2177, CVE-2016-2178 |
| 2016-June-20 | Rev 4. Added all CVEs fixed in Solaris 11.3 SRU9.4 |
| 2016-June-10 | Rev 3. Added OpenSSL CVEs |
| 2016-May-31 | Rev 2. Added all CVEs fixed in Solaris 11.3 SRU8.7 |
| 2016-April-19 | Rev 1. Initial Release |

### Oracle Solaris Executive Summary

This Third Party Bulletin contains 53 new security fixes for the Oracle Solaris.  41 of these vulnerabilities may be remotely exploitable without authentication, i.e., may be exploited over a network without the need for a username and password.

### Oracle Solaris Risk Matrix

#### Revision 7: Published on 2016-09-21

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2014-1545 | Solaris | Multiple | Firefox | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3 | See Note 13 |

#### Revision 6: Published on 2016-07-08

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-1548 | Solaris | NTP | NTP | Yes | 6.4 | Network | Low | None | None | Partial | Partial | 11.3, 10 | See Note 11 |
| CVE-2016-4957 | Solaris | NTP | NTP | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4956 | Solaris | NTP | NTP | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4953 | Solaris | NTP | NTP | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4954 | Solaris | NTP | NTP | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-4955 | Solaris | NTP | NTP | Yes | 2.6 | Network | High | None | None | None | Partial | 11.3, 10 |  |

#### Revision 5: Published on 2016-06-27

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-2177 | Solaris | SSL/TLS | OpenSSL | Yes | 7.5 | Network | Low | None | Partial | Partial | Partial | 11.3, 10 |  |
| CVE-2016-2178 | Solaris | SSL/TLS | OpenSSL | No | 2.1 | Local | Low | None | Partial | None | None | 11.3, 10 |  |

#### Revision 4: Published on 2016-06-20

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2015-2806 | Solaris | Multiple | GNU Libtasn1 | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3 |  |
| CVE-2014-9679 | Solaris | Multiple | Common Unix Printing System (CUPS) | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-8786 | Solaris | Multiple | RabbitMQ | No | 6.8 | Network | Low | Single | None | None | Complete | 11.3 |  |
| CVE-2015-7546 | Solaris | Multiple | OpenStack Identity (Keystone) | No | 6.0 | Network | Medium | Single | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-5295 | Solaris | Multiple | OpenStack Orchestration API (Heat) | No | 5.5 | Network | Low | Single | Partial | None | Partial | 11.3 |  |
| CVE-2016-3115 | Solaris | SSH | OpenSSH | No | 5.5 | Network | Low | Single | Partial | Partial | None | 11.3 |  |
| CVE-2015-5223 | Solaris | Multiple | OpenStack Object Storage (Swift) | Yes | 5.0 | Network | Low | None | Partial | None | None | 11.3 |  |
| CVE-2016-0738 | Solaris | Multiple | OpenStack Object Storage (Swift) | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3 | See Note 8 |
| CVE-2015-8853 | Solaris | Multiple | Perl | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3 |  |
| CVE-2015-8665 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 |  |
| CVE-2015-8683 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 |  |
| CVE-2015-8781 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 | See Note 9 |
| CVE-2015-1547 | Solaris | Multiple | LibTIFF | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3, 10 | See Note 10 |
| CVE-2016-2512 | Solaris | Multiple | Django Python web framework | Yes | 4.3 | Network | Medium | None | None | Partial | None | 11.3 |  |
| CVE-2016-4085 | Solaris | Multiple | Wireshark | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 | See Note 12 |
| CVE-2016-2513 | Solaris | Multiple | Django Python web framework | Yes | 2.6 | Network | High | None | Partial | None | None | 11.3 |  |

#### Revision 3: Published on 2016-06-10

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-2108 | Solaris | SSL/TLS | OpenSSL | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3, 10 |  |
| CVE-2016-2109 | Solaris | SSL/TLS | OpenSSL | Yes | 7.8 | Network | Low | None | None | None | Complete | 11.3, 10 |  |
| CVE-2016-2176 | Solaris | SSL/TLS | OpenSSL | Yes | 6.4 | Network | Low | None | Partial | None | Partial | 11.3, 10 |  |
| CVE-2016-2105 | Solaris | SSL/TLS | OpenSSL | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-2106 | Solaris | SSL/TLS | OpenSSL | Yes | 5.0 | Network | Low | None | None | None | Partial | 11.3, 10 |  |
| CVE-2016-2107 | Solaris | SSL/TLS | OpenSSL | Yes | 2.6 | Network | High | None | Partial | None | None | 11.3, 10 | See Note 7 |

#### Revision 2: Published on 2016-05-31

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-2315 | Solaris | Multiple | Git | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3 | See Note 5 |
| CVE-2016-2342 | Solaris | Multiple | Quagga | Yes | 7.6 | Network | High | None | Complete | Complete | Complete | 11.3 |  |
| CVE-2015-7545 | Solaris | Multiple | Git | Yes | 7.5 | Network | Low | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-2695 | Solaris | Kerberos | Kerberos | Yes | 7.1 | Network | Medium | None | None | None | Complete | 11.3 |  |
| CVE-2015-2697 | Solaris | Kerberos | Kerberos | No | 6.8 | Network | Low | Single | None | None | Complete | 11.3 |  |
| CVE-2016-3068 | Solaris | Multiple | Mercurial source code management | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3 | See Note 4 |
| CVE-2016-3115 | Solaris | SSH | SSH | No | 5.5 | Network | Low | Single | Partial | Partial | None | 11.3, 10 |  |
| CVE-2014-3566 | Solaris | SSL | Evolution | Yes | 5.0 | Network | Low | None | Partial | None | None | 11.3 |  |
| CVE-2015-7551 | Solaris | None | Ruby | No | 4.6 | Local | Low | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2015-8629 | Solaris | Kerberos | Kerberos | No | 2.1 | Network | High | Single | Partial | None | None | 11.3, 10 |  |

#### Revision 1: Published on 2016-04-19

| CVE# | Component | Protocol | Third Party ­component | Remote Exploit without Auth.? | CVSS VERSION 2.0 RISK (see [Risk Matrix Definitions](/security-alerts/advisorymatrixglossary.html)) | | | | | | | Supported Versions Affected | Notes |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Base Score | Access Vector | Access Complexity | Authen­tication | Confid­entiality | Inte­grity | Avail­ability |
| CVE-2016-0705 | Solaris | SSL/TLS | OpenSSL | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 11.3, 10 |  |
| CVE-2016-0799 | Solaris | SSL/TLS | WanBoot | Yes | 10.0 | Network | Low | None | Complete | Complete | Complete | 10 | See Note 1 |
| CVE-2016-0798 | Solaris | SSL/TLS | OpenSSL | Yes | 7.8 | Network | Low | None | None | None | Complete | 11.3, 10 |  |
| CVE-2015-3415 | Solaris | Multiple | SQLite3 | Yes | 7.5 | Network | Low | None | Partial | Partial | Partial | 11.3, 10 | See Note 3 |
| CVE-2015-5602 | Solaris | None | Sudo | No | 7.2 | Local | Low | None | Complete | Complete | Complete | 11.3, 10 |  |
| CVE-2015-4752 | Solaris | None | MySQL | No | 7.2 | Local | Low | None | Complete | Complete | Complete | 11.3 | See Note 2 |
| CVE-2016-2523 | Solaris | Multiple | Wireshark | Yes | 7.1 | Network | Medium | None | None | None | Complete | 11.3 |  |
| CVE-2016-1283 | Solaris | Multiple | PCRE | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3 |  |
| CVE-2014-9766 | Solaris | Multiple | X.Org | Yes | 6.8 | Network | Medium | None | Partial | Partial | Partial | 11.3, 10 |  |
| CVE-2015-3885 | Solaris | Multiple | Dcraw | Yes | 4.3 | Network | Medium | None | None | None | Partial | 11.3 |  |
| CVE-2007-6720 | Solaris | Multiple | Libmikmod | Yes | 2.6 | Network | High | None | None | None | Partial | 11.3 |  |
| CVE-2016-0702 | Solaris | None | OpenSSL | No | 1.9 | Local | Medium | None | Partial | None | None | 11.3, 10 | See Note 6 |

#### Notes:

1. This fix also addresses CVE-2016-0703 CVE-2016-0704 CVE-2016-0797 CVE-2016-0800.
2. This fix also addresses CVE-2014-6464 CVE-2014-6469 CVE-2014-6491 CVE-2014-6494 CVE-2014-6500 CVE-2014-6507 CVE-2014-6555 CVE-2014-6559 CVE-2014-6568 CVE-2015-0374 CVE-2015-0382 CVE-2015-0411 CVE-2015-0432 CVE-2015-0433 CVE-2015-0499 CVE-2015-0505 CVE-2015-2568 CVE-2015-2571 CVE-2015-2573 CVE-2015-2582 CVE-2015-2620 CVE-2015-2643 CVE-2015-2648 CVE-2015-4737 CVE-2015-4792 CVE-2015-4802 CVE-2015-4807 CVE-2015-4815 CVE-2015-4816 CVE-2015-4819 CVE-2015-4826 CVE-2015-4830 CVE-2015-4836 CVE-2015-4858 CVE-2015-4861 CVE-2015-4864 CVE-2015-4870 CVE-2015-4879 CVE-2015-4913 CVE-2015-7744 CVE-2016-0505 CVE-2016-0546 CVE-2016-0596 CVE-2016-0597 CVE-2016-0598 CVE-2016-0600 CVE-2016-0606 CVE-2016-0608 CVE-2016-0609 CVE-2016-0616.
3. This fix also addresses CVE-2015-3414 CVE-2015-3416.
4. This fix also addresses CVE-2016-3069 CVE-2016-3630.
5. This fix also addresses CVE-2016-2324.
6. This fix also addresses CVE-2016-0702 CVE-2016-0797 CVE-2016-0799.
7. This fix also addresses CVE-2016-2106 CVE-2016-2107 CVE-2016-2108 CVE-2016-2109 CVE-2016-2176.
8. This fix also addresses CVE-2016-0737.
9. This fix also addresses CVE-2015-8782 CVE-2015-8783.
10. This fix also addresses CVE-2015-8784.
11. This fix also addresses CVE-2016-1551 CVE-2016-1549 CVE-2016-2516 CVE-2016-2517 CVE-2016-2518 CVE-2016-2519 CVE-2016-1547 CVE-2015-7704 CVE-2015-8138 CVE-2016-1550.
12. This fix also addresses CVE-2016-4085.
13. This fix also addresses CVE-2013-5609 CVE-2013-5610 CVE-2013-5611 CVE-2013-5612 CVE-2013-5613 CVE-2013-5614 CVE-2013-5615 CVE-2013-5616 CVE-2013-5618 CVE-2013-5619 CVE-2013-6629 CVE-2013-6630 CVE-2013-6671 CVE-2013-6672 CVE-2013-6673 CVE-2014-1477 CVE-2014-1478 CVE-2014-1479 CVE-2014-1480 CVE-2014-1481 CVE-2014-1482 CVE-2014-1483 CVE-2014-1484 CVE-2014-1485 CVE-2014-1486 CVE-2014-1487 CVE-2014-1488 CVE-2014-1489 CVE-2014-1493 CVE-2014-1494 CVE-2014-1496 CVE-2014-1497 CVE-2014-1498 CVE-2014-1499 CVE-2014-1500 CVE-2014-1501 CVE-2014-1502 CVE-2014-1504 CVE-2014-1505 CVE-2014-1506 CVE-2014-1507 CVE-2014-1508 CVE-2014-1509 CVE-2014-1510 CVE-2014-1511 CVE-2014-1512 CVE-2014-1513 CVE-2014-1514 CVE-2014-1518 CVE-2014-1519 CVE-2014-1520 CVE-2014-1522 CVE-2014-1523 CVE-2014-1524 CVE-2014-1525 CVE-2014-1526 CVE-2014-1527 CVE-2014-1528 CVE-2014-1529 CVE-2014-1530 CVE-2014-1531 CVE-2014-1532 CVE-2014-1533 CVE-2014-1534 CVE-2014-1536 CVE-2014-1537 CVE-2014-1538 CVE-2014-1539 CVE-2014-1540 CVE-2014-1541 CVE-2014-1542 CVE-2014-1543 CVE-2014-1544 CVE-2014-1547 CVE-2014-1548 CVE-2014-1549 CVE-2014-1550 CVE-2014-1551 CVE-2014-1552 CVE-2014-1553 CVE-2014-1554 CVE-2014-1555 CVE-2014-1556 CVE-2014-1557 CVE-2014-1559 CVE-2014-1561 CVE-2014-1562 CVE-2014-1563 CVE-2014-1564 CVE-2014-1565 CVE-2014-1566 CVE-2014-1567 CVE-2014-1568 CVE-2014-1569 CVE-2014-1575 CVE-2014-1580 CVE-2014-1582 CVE-2014-1584 CVE-2014-1588 CVE-2014-1589 CVE-2014-1591 CVE-2014-1595 CVE-2014-2018 CVE-2014-8631 CVE-2014-8632 CVE-2014-8635 CVE-2014-8636 CVE-2014-8637 CVE-2014-8640 CVE-2014-8642 CVE-2014-8643 CVE-2015-0797 CVE-2015-0798 CVE-2015-0799 CVE-2015-0800 CVE-2015-0802 CVE-2015-0803 CVE-2015-0804 CVE-2015-0805 CVE-2015-0806 CVE-2015-0808 CVE-2015-0810 CVE-2015-0811 CVE-2015-0812 CVE-2015-0814 CVE-2015-0819 CVE-2015-0820 CVE-2015-0821 CVE-2015-0823 CVE-2015-0824 CVE-2015-0825 CVE-2015-0826 CVE-2015-0828 CVE-2015-0829 CVE-2015-0830 CVE-2015-0832 CVE-2015-0833 CVE-2015-0834 CVE-2015-0835 CVE-2015-2706 CVE-2015-2708 CVE-2015-2709 CVE-2015-2710 CVE-2015-2711 CVE-2015-2712 CVE-2015-2713 CVE-2015-2714 CVE-2015-2715 CVE-2015-2716 CVE-2015-2717 CVE-2015-2718 CVE-2015-2720 CVE-2015-2721 CVE-2015-2722 CVE-2015-2724 CVE-2015-2725 CVE-2015-2726 CVE-2015-2727 CVE-2015-2728 CVE-2015-2729 CVE-2015-2730 CVE-2015-2731 CVE-2015-2733 CVE-2015-2734 CVE-2015-2735 CVE-2015-2736 CVE-2015-2737 CVE-2015-2738 CVE-2015-2739 CVE-2015-2740 CVE-2015-2741 CVE-2015-2742 CVE-2015-2743 CVE-2015-4473 CVE-2015-4474 CVE-2015-4475 CVE-2015-4476 CVE-2015-4477 CVE-2015-4478 CVE-2015-4479 CVE-2015-4480 CVE-2015-4481 CVE-2015-4482 CVE-2015-4483 CVE-2015-4484 CVE-2015-4485 CVE-2015-4486 CVE-2015-4487 CVE-2015-4488 CVE-2015-4489 CVE-2015-4490 CVE-2015-4491 CVE-2015-4492 CVE-2015-4493 CVE-2015-4495 CVE-2015-4496 CVE-2015-4497 CVE-2015-4498 CVE-2015-4500 CVE-2015-4501 CVE-2015-4502 CVE-2015-4503 CVE-2015-4504 CVE-2015-4505 CVE-2015-4506 CVE-2015-4507 CVE-2015-4508 CVE-2015-4509 CVE-2015-4510 CVE-2015-4511 CVE-2015-4512 CVE-2015-4513 CVE-2015-4514 CVE-2015-4515 CVE-2015-4516 CVE-2015-4517 CVE-2015-4518 CVE-2015-4519 CVE-2015-4520 CVE-2015-4521 CVE-2015-4522 CVE-2015-7174 CVE-2015-7175 CVE-2015-7176 CVE-2015-7177 CVE-2015-7178 CVE-2015-7179 CVE-2015-7180 CVE-2015-7181 CVE-2015-7182 CVE-2015-7183 CVE-2015-7184 CVE-2015-7185 CVE-2015-7186 CVE-2015-7187 CVE-2015-7188 CVE-2015-7189 CVE-2015-7190 CVE-2015-7191 CVE-2015-7192 CVE-2015-7193 CVE-2015-7194 CVE-2015-7195 CVE-2015-7196 CVE-2015-7197 CVE-2015-7198 CVE-2015-7199 CVE-2015-7200.

Resources for

* [Careers](/careers/)
* [Developers](/developer/)
* [Investors](https://investor.oracle.com/home/default.aspx)
* [Partners](/partner/)
* [Researchers](/research/)
* [Students and Educators](https://academy.oracle.com/en/oa-web-overview.html)

Why Oracle

* [Analyst Reports](/corporate/analyst-reports/)
* [Best cloud-based
  ERP](/erp/what-is-erp/best-erp/)
* [Cloud Economics](/cloud/economics/)
* [Social Impact](/social-impact/)
* [Culture and Inclusion](/careers/diversity-inclusion/)
* [Security Practices](/corporate/security-practices/)

Learn

* [What is cloud
  computing?](/cloud/what-is-cloud-computing/)
* [What is CRM?](/cx/what-is-crm/)
* [What is
  Docker?](/cloud/cloud-native/container-registry/what-is-docker/)
* [What is
  Kubernetes?](/cloud/cloud-native/kubernetes-engine/what-is-kubernetes/)
* [What is
  Python?](/developer/what-is-python-for-developers/)
* [What is SaaS?](/applications/what-is-saas/)

News and Events

* [News](/news/)
* [Oracle CloudWorld](/cloudworld/)
* [Oracle CloudWorld Tour](/cloudworld-tour/)
* [Oracle Health Summit](/health/health-summit/)
* [Oracle Dev Tour](/developer/dev-tour/)
* [Search all events](https://search.oracle.com/events?q=&lang=english)

Contact Us

* US Sales: +1.800.633.0738
* [How can we help?](/corporate/contact/)
* [Subscribe to emails](https://go.oracle.com/subscribe/?l_code=en&src1=OW:O:FO)
* [Integrity Helpline](https://secure.ethicspoint.com/domain/media/en/gui/31053/index.html)
* [Accessibility](/corporate/accessibility/)

---

* [Country/Region](/universal-menu/#u10countrymenu)

* [© 2025 Oracle](/legal/copyright/)
* [Privacy](/legal/privacy/)/[Do Not Sell My
  Info](/legal/privacy/privacy-choices/)
* [Ad
  Choices](/legal/privacy/privacy-policy/#adchoices)
* [Careers](/corporate/careers/)



=== Content from bugzilla.mozilla.org_288e400c_20250125_062809.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1028358)
* [XML](/show_bug.cgi?ctype=xml&id=1028358)

Closed
[Bug 1028358](/show_bug.cgi?id=1028358)

Opened 11 years ago
Closed 11 years ago

# We are not firing any post-barriers on Heap<T> for JSFunction\*

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

We are not firing any post-barriers on Heap<T> for JSFunction\*

## Categories

### (Core :: JavaScript: GC, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%3A%20GC#JavaScript%3A%20GC)

JavaScript: GC
▾

Core :: JavaScript: GC
File bugs here for issues involving the garbage collector (crashes, leaks, etc.), where the issue is *not* one caused by failure to use the JSAPI correctly.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%3A%20GC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%3A%20GC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%3A%20GC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox31 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) |
| firefox33 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |
| b2g-v2.1 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox31 |  | fixed |
| firefox32 |  | fixed |
| firefox33 |  | fixed |
| firefox-esr24 |  | unaffected |
| b2g-v1.2 |  | unaffected |
| b2g-v1.3 |  | unaffected |
| b2g-v1.4 |  | unaffected |
| b2g-v2.0 |  | fixed |
| b2g-v2.1 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: terrence, Assigned: terrence)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/045baa1e1ab4c1401b5ee569f11eaabf?d=mm&size=40)  [terrence](/user_profile?user_id=231770)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/045baa1e1ab4c1401b5ee569f11eaabf?d=mm&size=40)  [terrence](/user_profile?user_id=231770)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[GC.stability](/show_bug.cgi?id=1008341 "NEW - [meta] GC Correctness & Stability")

Dependency [tree](/showdependencytree.cgi?id=1028358&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1028358)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-high, Whiteboard: [qa-][adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[qa-][adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c10 "11 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [fire\_barriers\_on\_heap\_function-v0.diff](/attachment.cgi?id=8443689)  [11 years ago](#c1)  [Terrence Cole [:terrence]](/user_profile?user_id=231770)   1.41 KB, patch | jonco : [review+](#c2 "11 years ago")  Sylvestre : [approval-mozilla-aurora+](#a505713_495955 "11 years ago")  Sylvestre : [approval-mozilla-beta+](#a505713_495955 "11 years ago") | [Details](/attachment.cgi?id=8443689&action=edit) | [Diff](/attachment.cgi?id=8443689&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8443689) |
| --- | --- | --- |
| [add-heap-test](/attachment.cgi?id=8444452)  [11 years ago](#c3)  [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194)   4.60 KB, patch | terrence : [review+](#c4 "11 years ago") | [Details](/attachment.cgi?id=8444452&action=edit) | [Diff](/attachment.cgi?id=8444452&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8444452) |
| [rebased\_for\_beta-v0.diff](/attachment.cgi?id=8448295)  [11 years ago](#c12)  [Terrence Cole [:terrence]](/user_profile?user_id=231770)   4.73 KB, patch | terrence : [review+](#c12 "11 years ago") | [Details](/attachment.cgi?id=8448295&action=edit) | [Diff](/attachment.cgi?id=8448295&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8448295) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1028358#c0)• 11 years ago |
|  | |

JSFunction is a sub-class of JSObject, but gecko users of RootingAPI.h have no way of knowing this. The upshot is that we end up using GCMethods<JSFunction\*>::needsPostBarrier (which returns false unconditionally), instead of GCMethods<JSObject\*>::needsPostBarrier. We absolutely allocate some JSFUnction in the nursery, so I guess we're just getting mostly lucky right now.
Luckily, this is only a problem for Heap<T>: the internal barrier classes use InternalGCMethods<T>, which dispatches to T::needsPostBarrier, which will follow the class hierarchy and always find JSObject::needsPostBarrier.
The trivial fix is to dup GCMethods<JSObject\*> for JSFunction\*. If there were other gecko-exposed object users of GCMethods<T>, they would have to be in SpecificRootKind too, so we can be fairly confident that JSFunction is the only subclass we need to worry about.
Will patch after lunch.

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1028358#a1191_231770)• 11 years ago |

[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected)

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1028358#c1)• 11 years ago |
|  | |

Attached patch

[fire\_barriers\_on\_heap\_function-v0.diff](attachment.cgi?id=8443689&action=diff)
— [Details](attachment.cgi?id=8443689&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8443689)

I hate to duplicate this much code, but I don't see another way.
[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: review?(jcoppeard)

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1028358#a1796_231770)• 11 years ago |

Severity: normal → majorComponent: JavaScript Engine → JavaScript: GCKeywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1028358#c2)• 11 years ago |
|  | |

Comment on [attachment 8443689](/attachment.cgi?id=8443689 "fire_barriers_on_heap_function-v0.diff") [[details]](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") [[diff]](/attachment.cgi?id=8443689&action=diff "fire_barriers_on_heap_function-v0.diff") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8443689)
fire\_barriers\_on\_heap\_function-v0.diff
Review of [attachment 8443689](/attachment.cgi?id=8443689 "fire_barriers_on_heap_function-v0.diff") [[details]](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") [[diff]](/attachment.cgi?id=8443689&action=diff "fire_barriers_on_heap_function-v0.diff") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8443689):
-----------------------------------------------------------------
Ah, good catch.
[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: review?(jcoppeard) → review+

|  | [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1028358#c3)• 11 years ago |
|  | |

Attached patch

[add-heap-test](attachment.cgi?id=8444452&action=diff)
— [Details](attachment.cgi?id=8444452&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8444452)

Here's some test code for this.
[Attachment #8444452](/attachment.cgi?id=8444452&action=edit "add-heap-test") -
Flags: review?(terrence)

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1028358#c4)• 11 years ago |
|  | |

Comment on [attachment 8444452](/attachment.cgi?id=8444452 "add-heap-test") [[details]](/attachment.cgi?id=8444452&action=edit "add-heap-test") [[diff]](/attachment.cgi?id=8444452&action=diff "add-heap-test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8444452)
add-heap-test
Review of [attachment 8444452](/attachment.cgi?id=8444452 "add-heap-test") [[details]](/attachment.cgi?id=8444452&action=edit "add-heap-test") [[diff]](/attachment.cgi?id=8444452&action=diff "add-heap-test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8444452):
-----------------------------------------------------------------
Great idea! I'll push adjacent to the other.
[Attachment #8444452](/attachment.cgi?id=8444452&action=edit "add-heap-test") -
Flags: review?(terrence) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1028358#c5)• 11 years ago |
|  | |

remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/1fbc93b30f16>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/dd07ffb3af82>

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1028358#c6)• 11 years ago |
|  | |

Namespacing problems hidden by unified build:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/c0abbe272076>

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1028358#c7)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/1fbc93b30f16>
<https://hg.mozilla.org/mozilla-central/rev/dd07ffb3af82>
<https://hg.mozilla.org/mozilla-central/rev/c0abbe272076>
<https://hg.mozilla.org/mozilla-central/rev/db3e7febe0a4>Status: ASSIGNED → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla33

|  | [Jon Coppeard (:jonco) (PTO until 27th Jan)](/user_profile?user_id=443194) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1028358#c8)• 11 years ago |
|  | |

(In reply to Steve Fink [:sfink] from [comment #6](/show_bug.cgi?id=1028358#c6 "RESOLVED FIXED - We are not firing any post-barriers on Heap<T> for JSFunction*"))
Ugh, thanks for fixing that.

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1028358#c9)• 11 years ago |
|  | |

Comment on [attachment 8443689](/attachment.cgi?id=8443689 "fire_barriers_on_heap_function-v0.diff") [[details]](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") [[diff]](/attachment.cgi?id=8443689&action=diff "fire_barriers_on_heap_function-v0.diff") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8443689)
fire\_barriers\_on\_heap\_function-v0.diff
[Approval Request Comment]
Bug caused by (feature/regressing bug #): Generational GC.
User impact if declined: Random crashes.
Testing completed (on m-c, etc.): On m-c with complete unit tests.
Risk to taking this patch (and alternatives if risky): Low to none.
String or IDL/UUID changes made by this patch: None.
[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: approval-mozilla-beta?
[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: approval-mozilla-aurora?

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1028358#a505713_495955)• 11 years ago |

[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: approval-mozilla-beta?
[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: approval-mozilla-beta+
[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: approval-mozilla-aurora?
[Attachment #8443689](/attachment.cgi?id=8443689&action=edit "fire_barriers_on_heap_function-v0.diff") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1028358#c10)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/8494ff92590e>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/7ee79c993016>
<https://hg.mozilla.org/releases/mozilla-beta/rev/759a69c36dcf>
<https://hg.mozilla.org/releases/mozilla-beta/rev/be30b037ff07>
BTW, this should have had sec-approval before landing since it affects more than just trunk.
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)Flags: in-testsuite+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1028358#c11)• 11 years ago |
|  | |

Aurora bustage follow-up:
<https://hg.mozilla.org/releases/mozilla-aurora/rev/248da3015a51>
Backed out from beta for other bustage:
<https://hg.mozilla.org/releases/mozilla-beta/rev/23c915c46d6e>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=42554294&tree=Mozilla-Beta>
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1028358#c12)• 11 years ago |
|  | |

Attached patch

[rebased\_for\_beta-v0.diff](attachment.cgi?id=8448295&action=diff)
— [Details](attachment.cgi?id=8448295&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1028358&attachment=8448295)

Beta used a different mechanism for specifying the ThingRootKind and did not have IsInsideNursery(Cell\*) exposed yet, so cast a wider net for barriers. The attached patch adjusts for these changes and folds in the test and the 2 followup bustage fixes.
I tested with on jsapi-tests locally with both clang and gcc, so I believe this should be ready for landing.
[Attachment #8448295](/attachment.cgi?id=8448295&action=edit "rebased_for_beta-v0.diff") -
Flags: review+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1028358#c13)• 11 years ago |
|  | |

Terrence landed the beta patch:
<https://hg.mozilla.org/releases/mozilla-beta/rev/efbf65d0d3a0>
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1028358#c14)• 11 years ago |
|  | |

I suspect this is not affecting ESR24 because Generational GC is newer than that, but can someone confirm?
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=%3F)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%3F)Flags: needinfo?(terrence)

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1028358#c15)• 11 years ago |
|  | |

(In reply to Lukas Blakk [:lsblakk] from [comment #14](/show_bug.cgi?id=1028358#c14 "RESOLVED FIXED - We are not firing any post-barriers on Heap<T> for JSFunction*"))
> I suspect this is not affecting ESR24 because Generational GC is newer than
> that, but can someone confirm?
You are correct.
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%3F) → ---Flags: needinfo?(terrence)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1028358#c16)• 11 years ago |
|  | |

Marking [qa-] for verification purposes. Feel free to add STR or other info if you feel you need QA to test this. Thank you.Whiteboard: [qa-]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1028358#a2089668_280903)• 11 years ago |

Whiteboard: [qa-] → [qa-][adv-main31+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1028358#c17)• 11 years ago |
|  | |

If GGC landed in Firefox 31 ([bug 619558](/show_bug.cgi?id=619558 "RESOLVED FIXED - [meta] Implement generational garbage collection")) then b2g28 and b2g30 (1.3/1.4) don't need this fix
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=unaffected)
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1028358#a37884912_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1028358#a61789148_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1028358&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Terrence Cole [:terrence]](/user_profile?user_id=231770)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_585266f4_20250125_062800.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1020219)
* [XML](/show_bug.cgi?ctype=xml&id=1020219)

Closed
[Bug 1020219](/show_bug.cgi?id=1020219)

Opened 11 years ago
Closed 11 years ago

# Fix a bug that can cause DataSourceSurface buffers to be smaller than the DataSourceSurface expects them to be

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Fix a bug that can cause DataSourceSurface buffers to be smaller than the DataSourceSurface expects them to be

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox29 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=wontfix) |
| firefox30 | [+](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | [+](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | [+](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) |
| firefox33 | [+](/buglist.cgi?f1=cf_tracking_firefox33&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.2 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=wontfix) |
| b2g-v1.3 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed) |
| b2g-v1.3T | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=fixed) |
| b2g-v1.4 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |
| b2g-v2.1 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox29 |  | wontfix |
| firefox30 | + | wontfix |
| firefox31 | + | fixed |
| firefox32 | + | fixed |
| firefox33 | + | fixed |
| firefox-esr24 |  | unaffected |
| b2g-v1.2 |  | wontfix |
| b2g-v1.3 |  | fixed |
| b2g-v1.3T |  | fixed |
| b2g-v1.4 |  | fixed |
| b2g-v2.0 |  | fixed |
| b2g-v2.1 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jwatt, Assigned: jwatt)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [jwatt](/user_profile?user_id=32767)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[892505](/show_bug.cgi?id=892505 "RESOLVED FIXED - Implement gfx::Factory::CreateDataSourceSurface"), [1019753](/show_bug.cgi?id=1019753 "RESOLVED FIXED - Use Moz2D DataSourceSurfaces instead of Thebes gfxImageSurfaces in DocumentRendererParent.cpp and ImageEncoder.cpp")

Dependency [tree](/showdependencytree.cgi?id=1020219&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1020219)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-bounds, regression, sec-critical, Whiteboard: [adv-main31+][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 obsolete file)

| [patch](/attachment.cgi?id=8434038)  [11 years ago](#c1)  [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)   1.54 KB, patch | bas.schouten : [review+](#a552_272464 "11 years ago")  dveditz : [approval-mozilla-aurora-](#c8 "11 years ago")  dveditz : [approval-mozilla-beta-](#c8 "11 years ago")  dveditz : [approval-mozilla-release-](#c8 "11 years ago")  dveditz : [sec-approval-](#c8 "11 years ago") | [Details](/attachment.cgi?id=8434038&action=edit) | [Diff](/attachment.cgi?id=8434038&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020219&attachment=8434038) |
| --- | --- | --- |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1020219#c0)• 11 years ago |
|  | |

Yikes. In SourceSurfaceAlignedRawData::Init and SourceSurfaceAlignedRawData::InitWithStride the temporary that is passed to Realloc may not have enough precision to store the result of |mStride \* aSize.height|. That can cause us to have a buffer that is much smaller than the DataSourceSurface expects and needs it to be.

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1020219#c1)• 11 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=8434038&action=diff) (obsolete)
— [Details](attachment.cgi?id=8434038&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1020219&attachment=8434038)

[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: review?(bas)

|  | [Bas Schouten (:bas.schouten)](/user_profile?user_id=272464) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a552_272464)• 11 years ago |

[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: review?(bas) → review+

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a3606_495955)• 11 years ago |

Group: gfx-core-security

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a3646_495955)• 11 years ago |

[status-firefox29](/buglist.cgi?f1=cf_status_firefox29&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=%3F)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=%3F)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a3714_495955)• 11 years ago |

[tracking-firefox30](/buglist.cgi?f1=cf_tracking_firefox30&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%2B)
[tracking-firefox31](/buglist.cgi?f1=cf_tracking_firefox31&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%2B)
[tracking-firefox32](/buglist.cgi?f1=cf_tracking_firefox32&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox32&o1=equals&v1=%2B)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%3F)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1020219#c2)• 11 years ago |
|  | |

Tagged as a security issue after an IRC chat with Jonathan.

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1020219#c3)• 11 years ago |
|  | |

The broken code came from [bug 892505](/show_bug.cgi?id=892505 "RESOLVED FIXED - Implement gfx::Factory::CreateDataSourceSurface").

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1020219#c4)• 11 years ago |
|  | |

OK. Therefor ESR 24 is unaffected (this landed in 25).
[status-firefox29](/buglist.cgi?f1=cf_status_firefox29&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=wontfix)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=%3F) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%3F) → ---

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a25257_406194)• 11 years ago |

Keywords: [csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a28332_1689)• 11 years ago |

[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=affected)
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1020219#c5)• 11 years ago |
|  | |

We can take this in the FF30 release now please nominate for uplift all the way to mozilla-release asap.Flags: needinfo?(jwatt)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1020219#c6)• 11 years ago |
|  | |

Comment on [attachment 8434038](/attachment.cgi?id=8434038 "patch") [[details]](/attachment.cgi?id=8434038&action=edit "patch") [[diff]](/attachment.cgi?id=8434038&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020219&attachment=8434038)
patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 892505](/show_bug.cgi?id=892505 "RESOLVED FIXED - Implement gfx::Factory::CreateDataSourceSurface")
User impact if declined: sg bug
Testing completed (on m-c, etc.): none (simultaneous landing?
Risk to taking this patch (and alternatives if risky): essentially zero risk
String or IDL/UUID changes made by this patch: none
The reason I say this is essentially zero risk is because it only changes the code to use a temporary of a larger type, which is the type of the parameter the function the temporary is being passed to is.
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-release?
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-aurora?Flags: needinfo?(jwatt)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a41559_1689)• 11 years ago |

Blocks: [892505](/show_bug.cgi?id=892505 "RESOLVED FIXED - Implement gfx::Factory::CreateDataSourceSurface")Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1020219#c7)• 11 years ago |
|  | |

Comment on [attachment 8434038](/attachment.cgi?id=8434038 "patch") [[details]](/attachment.cgi?id=8434038&action=edit "patch") [[diff]](/attachment.cgi?id=8434038&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020219&attachment=8434038)
patch
sec-approval+ for landing as long as this can land in Firefox 30. Otherwise we should wait a few weeks into the next cycle. I'd be happier without the comment pointing at the overflow risk though I guess the patch would be pretty obvious without it anyway.
a=dveditz for landing on the aurora, beta, and release branches.
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: sec-approval+
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-release?
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-release+
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-beta?
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-aurora?
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1020219#c8)• 11 years ago |
|  | |

Comment on [attachment 8434038](/attachment.cgi?id=8434038 "patch") [[details]](/attachment.cgi?id=8434038&action=edit "patch") [[diff]](/attachment.cgi?id=8434038&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020219&attachment=8434038)
patch
Removing approvals, we don't think this fixes Win32 builds (our most popular). Since we really need a more thorough fix in the future anyway we should just do that rather than rush an incomplete fix into Firefox 30.
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: sec-approval-
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: sec-approval+
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-release-
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-release+
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-beta-
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-beta+
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-aurora-
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Flags: approval-mozilla-aurora+

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1020219#c9)• 11 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #8](/show_bug.cgi?id=1020219#c8 "RESOLVED FIXED - Fix a bug that can cause DataSourceSurface buffers to be smaller than the DataSourceSurface expects them to be"))
> we don't think this fixes Win32 builds
(Because size\_t is 32-bits there, so AlignedArray::Realloc(size\_t aSize) can't be passed a value big enough.)

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a48232_272375)• 11 years ago |

[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a537744_32767)• 11 years ago |

Whiteboard: [being fixed in bug 1023336]

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1020219#c10)• 11 years ago |
|  | |

Please don't anyone link the two bugs. The idea here is to get the patches in quietly.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a630008_280903)• 11 years ago |

[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected)
[tracking-firefox33](/buglist.cgi?f1=cf_tracking_firefox33&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox33&o1=equals&v1=%2B)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1020219#c11)• 11 years ago |
|  | |

[Bug 1023336](/show_bug.cgi?id=1023336 "RESOLVED FIXED - Avoid jank caused by oversized data wrapping DataSourceSurfaces") seems to be fixed in m-c. Do we want an uplift in aurora et beta?Flags: needinfo?(jwatt)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1020219#c12)• 11 years ago |
|  | |

Patches in [bug 1023336](/show_bug.cgi?id=1023336 "RESOLVED FIXED - Avoid jank caused by oversized data wrapping DataSourceSurfaces") have landed on branches.Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Flags: needinfo?(jwatt)Resolution: --- → FIXEDWhiteboard: [being fixed in bug 1023336]Target Milestone: --- → mozilla33

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1020219#c13)• 11 years ago |
|  | |

How should we get this fixed on the B2G release branches, namely b2g28 (v1.3) and b2g30 (v1.4)?
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=wontfix)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed)Flags: needinfo?(jwatt)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1020219#c14)• 11 years ago |
|  | |

dveditz, what do you think?Flags: needinfo?(jwatt) → needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a2793310_1689)• 11 years ago |

Group: gfx-core-security → core-securityFlags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1020219#c15)• 11 years ago |
|  | |

Can we just land [bug 1023336](/show_bug.cgi?id=1023336 "RESOLVED FIXED - Avoid jank caused by oversized data wrapping DataSourceSurfaces") on those branches? It's quite plausible that we would take a bug to "Avoid jank caused by oversized data" for low memory devices and wouldn't attract attention that way.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1020219#c16)• 11 years ago |
|  | |

[Bug 1023336](/show_bug.cgi?id=1023336 "RESOLVED FIXED - Avoid jank caused by oversized data wrapping DataSourceSurfaces") applied pretty cleanly to b2g30 (just some context differences in the first patch), but it's causing crashtest crashes:
<https://tbpl.mozilla.org/php/getParsedLog.php?id=43281427&tree=Mozilla-B2g30-v1.4>
b2g28 has more changes that complicate the backport. Jonathan, can you please take a look? :)Flags: needinfo?(jwatt)

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1020219#c17)• 11 years ago |
|  | |

Landed on both b2g30 and b2g28. See [bug 1023336 comment 12](/show_bug.cgi?id=1023336#c12 "RESOLVED FIXED - Avoid jank caused by oversized data wrapping DataSourceSurfaces") and 13.Flags: needinfo?(jwatt)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a2994567_75935)• 11 years ago |

[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=fixed)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a3498190_280903)• 11 years ago |

Whiteboard: [adv-main31+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1020219#c18)• 11 years ago |
|  | |

Marking [qa-], please feel free to include tests or STR if you'd like this tested. Thank you.Whiteboard: [adv-main31+] → [adv-main31+][qa-]

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a39300310_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1020219#a63204474_1689)• 9 years ago |

Group: core-security-release

|  | [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1020219#c19)• 8 years ago |
|  | |

Comment on [attachment 8434038](/attachment.cgi?id=8434038 "patch") [[details]](/attachment.cgi?id=8434038&action=edit "patch") [[diff]](/attachment.cgi?id=8434038&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1020219&attachment=8434038)
patch
This is not what landed in [bug 1023336](/show_bug.cgi?id=1023336 "RESOLVED FIXED - Avoid jank caused by oversized data wrapping DataSourceSurfaces").
[Attachment #8434038](/attachment.cgi?id=8434038&action=edit "patch") -
Attachment is obsolete: true
You need to [log in](/show_bug.cgi?id=1020219&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jonathan Watt [:jwatt]](/user_profile?user_id=32767)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_66463e5f_20250125_062813.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/990096)
* [XML](/show_bug.cgi?ctype=xml&id=990096)

Closed
[Bug 990096](/show_bug.cgi?id=990096)

Opened 11 years ago
Closed 11 years ago

# AddressSanitizer: global-buffer-overflow due to unhandled OOM [@ JSC::Yarr::digitsCreate()]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

AddressSanitizer: global-buffer-overflow due to unhandled OOM [@ JSC::Yarr::digitsCreate()]

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla31

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox31 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=unaffected) |
| firefox33 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=unaffected) |
| firefox-esr24 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox31 |  | fixed |
| firefox32 |  | unaffected |
| firefox33 |  | unaffected |
| firefox-esr24 | - | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: decoder, Assigned: jorendorff)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5a83f46f9f97d184457cb2dedfa19173?d=mm&size=40)  [jorendorff](/user_profile?user_id=281791)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=40)  [mwobensmith](/user_profile?user_id=452604)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b29b83d12aba827b8ff68296e473bec5?d=mm&size=40)  [decoder](/user_profile?user_id=395101)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

### (Blocks 2 open bugs)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[912928](/show_bug.cgi?id=912928 "NEW - The number of crash and assertion OOM bugs is too damn high [meta]")

[asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")

Dependency [tree](/showdependencytree.cgi?id=990096&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=990096)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[877459](/show_bug.cgi?id=877459 "RESOLVED DUPLICATE - YARR Crash [@ ~Vector] with OOM"), [877462](/show_bug.cgi?id=877462 "RESOLVED DUPLICATE - YARR Crash [@ JSC::Yarr::Parser<JSC::Yarr::YarrPatternConstructor, unsigned short>::parseCharacterClass] with OOM")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-bounds, sec-high, Whiteboard: [adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-bounds](/buglist.cgi?keywords=csectype-bounds&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+]

QA Whiteboard:

[qa-]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [bug-990096-part-1-wtfbridge-v1.patch](/attachment.cgi?id=8400265)  [11 years ago](#c1)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   2.38 KB, patch | h4writer : [review+](#c3 "11 years ago") | [Details](/attachment.cgi?id=8400265&action=edit) | [Diff](/attachment.cgi?id=8400265&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400265) |
| --- | --- | --- |
| [bug-990096-part-2-newOrCrash-v1.patch](/attachment.cgi?id=8400266)  [11 years ago](#c2)  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)   14.57 KB, patch | h4writer : [review+](#c4 "11 years ago")  abillings : [sec-approval+](#c15 "11 years ago") | [Details](/attachment.cgi?id=8400266&action=edit) | [Diff](/attachment.cgi?id=8400266&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400266) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=990096#c0)• 11 years ago |
|  | |

I'm seeing the following ASan error in OOM fuzzing:
==59119==ERROR: AddressSanitizer: global-buffer-overflow on address 0x00000234bb60 at pc 0x11f1c14 bp 0x7fffffff57b0 sp 0x7fffffff57a8
WRITE of size 16 at 0x00000234bb60 thread T0
#0 0x11f1c13 in VectorBase opt64asan-oom/js/src/../../dist/include/mozilla/Vector.h:588
#1 0x11f1c13 in Vector opt64asan-oom/js/src/../../dist/include/js/Vector.h:57
#2 0x11f1c13 in Vector yarr/wtfbridge.h:130
#3 0x11f1c13 in js\_malloc(unsigned long) yarr/YarrPattern.h:99
#4 0x11f1c13 in \_ZL6js\_newIN3JSC4Yarr14CharacterClassEEPT\_v opt64asan-oom/js/src/../../dist/include/js/Utility.h:325
#5 0x11f1c13 in JSC::Yarr::digitsCreate() yarr/RegExpJitTables.h:2635
#6 0x11ffea3 in JSC::Yarr::YarrPattern::digitsCharacterClass() yarr/YarrPattern.h:405
#7 0x11ffea3 in JSC::Yarr::YarrPatternConstructor::atomBuiltInCharacterClass(JSC::Yarr::BuiltInCharacterClassID, bool) yarr/YarrPattern.cpp:350
#8 0x120858a in bool JSC::Yarr::Parser<JSC::Yarr::YarrPatternConstructor, char16\_t>::parseEscape<false, JSC::Yarr::YarrPatternConstructor>(JSC::Yarr::YarrPatternConstructor&) yarr/YarrParser.h:266
#9 0x11fe31d in JSC::Yarr::Parser<JSC::Yarr::YarrPatternConstructor, char16\_t>::parseAtomEscape() yarr/YarrParser.h:406
#10 0x11fe31d in JSC::Yarr::Parser<JSC::Yarr::YarrPatternConstructor, char16\_t>::parseTokens() yarr/YarrParser.h:586
#11 0x11f5db6 in Parser yarr/YarrParser.h:674
#12 0x11f5db6 in JSC::Yarr::ErrorCode JSC::Yarr::parse<JSC::Yarr::YarrPatternConstructor>(JSC::Yarr::YarrPatternConstructor&, JSLinearString const&, unsigned int) yarr/YarrParser.h:855
#13 0x11f5db6 in JSC::Yarr::YarrPattern::compile(JSLinearString const&) yarr/YarrPattern.cpp:870
According to the OOM backtraces, the OOM is happening in JSC::Yarr::digitsCreate() but the debug information seems to be garbled and didn't point me to any location. However, I identified this as the possible problem:
> 2633 CharacterClass\* digitsCreate()
> 2634 {
> 2635 CharacterClass\* characterClass = js\_new<CharacterClass>();
> 2636 characterClass->m\_ranges.append(CharacterRange(0x30, 0x39));
> 2637 return characterClass;
> 2638 }
Line 2635 is allocating characterClass but not checking the return value of js\_new. With the next line this \*should\* lead to a null crash, but it doesn't. Maybe some weird inlining+optimizing is happening here (this is all in a header file).
When I add a null check right after the js\_new and return NULL, then the signature changes and YARR hits MOZ\_CRASH instead, so that confirms my theory.
Should we just add the null check right after the js\_new?

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=990096#c1)• 11 years ago |
|  | |

Attached patch

[bug-990096-part-1-wtfbridge-v1.patch](attachment.cgi?id=8400265&action=diff)
— [Details](attachment.cgi?id=8400265&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400265)

Crash on OOM in vector methods.Assignee: choller → jorendorff
[Attachment #8400265](/attachment.cgi?id=8400265&action=edit "bug-990096-part-1-wtfbridge-v1.patch") -
Flags: review?(hv1989)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=990096#c2)• 11 years ago |
|  | |

Attached patch

[bug-990096-part-2-newOrCrash-v1.patch](attachment.cgi?id=8400266&action=diff)
— [Details](attachment.cgi?id=8400266&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400266)

Crash on OOM in places that were using js\_new.
[Attachment #8400266](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") -
Flags: review?(hv1989)

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=990096#c3)• 11 years ago |
|  | |

Comment on [attachment 8400265](/attachment.cgi?id=8400265 "bug-990096-part-1-wtfbridge-v1.patch") [[details]](/attachment.cgi?id=8400265&action=edit "bug-990096-part-1-wtfbridge-v1.patch") [[diff]](/attachment.cgi?id=8400265&action=diff "bug-990096-part-1-wtfbridge-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400265)
bug-990096-part-1-wtfbridge-v1.patch
Review of [attachment 8400265](/attachment.cgi?id=8400265 "bug-990096-part-1-wtfbridge-v1.patch") [[details]](/attachment.cgi?id=8400265&action=edit "bug-990096-part-1-wtfbridge-v1.patch") [[diff]](/attachment.cgi?id=8400265&action=diff "bug-990096-part-1-wtfbridge-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400265):
-----------------------------------------------------------------
Really dislike the fact of crashing instead of handling OOM, but better to crash correctly. So r+
[Attachment #8400265](/attachment.cgi?id=8400265&action=edit "bug-990096-part-1-wtfbridge-v1.patch") -
Flags: review?(hv1989) → review+

|  | [Hannes Verschore [:h4writer]](/user_profile?user_id=196399) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=990096#c4)• 11 years ago |
|  | |

Comment on [attachment 8400266](/attachment.cgi?id=8400266 "bug-990096-part-2-newOrCrash-v1.patch") [[details]](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") [[diff]](/attachment.cgi?id=8400266&action=diff "bug-990096-part-2-newOrCrash-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400266)
bug-990096-part-2-newOrCrash-v1.patch
Review of [attachment 8400266](/attachment.cgi?id=8400266 "bug-990096-part-2-newOrCrash-v1.patch") [[details]](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") [[diff]](/attachment.cgi?id=8400266&action=diff "bug-990096-part-2-newOrCrash-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400266):
-----------------------------------------------------------------
Again would have been nice to this properly instead of crashing. Now since this is already present for so long and we will replace yarr, it is not worth it. So this indeed seems the best way forward.
::: js/src/yarr/YarrPattern.h
@@ +30,5 @@
> #define yarr\_YarrPattern\_h
>
> #include "yarr/wtfbridge.h"
> #include "yarr/ASCIICType.h"
> +#include "yarr/Yarr.h"
Is this needed? newOrCrash is defined in wtfbridge.h which already gets included...
[Attachment #8400266](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") -
Flags: review?(hv1989) → review+

|  | [Phil Ringnalda (:philor)](/user_profile?user_id=135518) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=990096#c5)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/96d5b6816785>
<https://hg.mozilla.org/mozilla-central/rev/9a491dcb9c7f>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla31

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=990096#c8)• 11 years ago |
|  | |

Was this trunk (31) only?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=990096#c9)• 11 years ago |
|  | |

I'm pretty sure this is a long standing bug, but I'm not sure if it's a good idea to backport this. It's an OOM issue, so not easy to trigger, but the fix is making all of these conditions controlled crash conditions so this could possibly impact stability.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=990096#c10)• 11 years ago |
|  | |

I'm trying to figure out why it didn't get sec-approval as a sec-high before checkin if it isn't trunk only and how far back it goes. Does it affect ESR24, for example?
Any sec-high that isn't trunk only should go through sec-approval. See <https://wiki.mozilla.org/Security/Bug_Approval_Process>
Getting the questions answered that show up in the template when someone sets sec-approval? would still be a good idea. Jason?Flags: needinfo?(jorendorff)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=990096#c11)• 11 years ago |
|  | |

Ugh. Confusion on my part --- I fixed a ton of these OOM bugs in the past week and though we've been doing it in sec bugs out of caution, most of them are not sensitive.
The good news is, the check-in really reveals nothing whatsoever about the bug.
Also, I'm not sure this is actually sec-high either. Or sec-anything. Christian looked at it, to try to figure out why ASan was calling this a "global-buffer-overrun"; I don't think he ever found anything though. Christian?
I'll answer the usual questions, in a sec...Flags: needinfo?(jorendorff) → needinfo?(choller)

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=990096#c12)• 11 years ago |
|  | |

Comment on [attachment 8400266](/attachment.cgi?id=8400266 "bug-990096-part-2-newOrCrash-v1.patch") [[details]](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") [[diff]](/attachment.cgi?id=8400266&action=diff "bug-990096-part-2-newOrCrash-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400266)
bug-990096-part-2-newOrCrash-v1.patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #):
[Bug 625600](/show_bug.cgi?id=625600 "RESOLVED FIXED - Update Yarr import") maybe? it's old.
Might be hard to bisect since it's apparently due to an optimization.
User impact if declined:
None, unless this turns out to be exploitable.
Testing completed (on m-c, etc.):
Yes, it's on m-c, seems fine.
Risk to taking this patch (and alternatives if risky):
Well, probably nothing... The patch that landed in
m-c looks super harmless. Maybe it'll be ignored. If we push it
to aurora, beta, release, and esr24, that won't be ignored.
I don't think we usually worry about that kind of thing though.
String or IDL/UUID changes made by this patch:
none

|  | [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=990096#c13)• 11 years ago |
|  | |

Comment on [attachment 8400266](/attachment.cgi?id=8400266 "bug-990096-part-2-newOrCrash-v1.patch") [[details]](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") [[diff]](/attachment.cgi?id=8400266&action=diff "bug-990096-part-2-newOrCrash-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400266)
bug-990096-part-2-newOrCrash-v1.patch
Wrong questions. Trying again.
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Hard. The patch gives no hint of what the problem is; a determined
adversary would have to recreate decoder's OOM-testing stuff and run
everything under ASan to find the bug.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
No.
Which older supported branches are affected by this flaw?
All... maybe?
All branches fail to crash on OOM here, but whether they're affected
depends on compiler optimizations.
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
I don't. They should be fairly easy to create, and low risk.
How likely is this patch to cause regressions; how much testing does it need?
Unlikely to cause regressions. Ordinary testing would be sufficient.
[Attachment #8400266](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") -
Flags: sec-approval?

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=990096#c14)• 11 years ago |
|  | |

As far as I can remember, I figured out that ASan itself is required here for Clang to perform the optimizations that lead to the global-buffer-overflow here. That doesn't mean it can't happen without ASan, just that it influences Clang's will to inline something here. I think aggressive inlining and exploiting the fact that null dereferencing is undefined behavior (and doesn't need to crash) lead to this problem. The resulting code didn't actually call anything on the null pointer anymore but somehow instead directly messed with the address in the trace.
I don't think this is easy to exploit (if possible at all), but if the uplift is trivial like Jason says, then we should of course just uplift it and be safe.Flags: needinfo?(choller)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=990096#c15)• 11 years ago |
|  | |

Comment on [attachment 8400266](/attachment.cgi?id=8400266 "bug-990096-part-2-newOrCrash-v1.patch") [[details]](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") [[diff]](/attachment.cgi?id=8400266&action=diff "bug-990096-part-2-newOrCrash-v1.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=990096&attachment=8400266)
bug-990096-part-2-newOrCrash-v1.patch
Ok. Well, sec-approval+ for trunk. Let's get it onto Aurora and Beta if we have time (make and nom patches for those). I'm not sure we need to take this on ESR24.
[Attachment #8400266](/attachment.cgi?id=8400266&action=edit "bug-990096-part-2-newOrCrash-v1.patch") -
Flags: sec-approval? → sec-approval+

|  | [Lawrence Mandel [:lmandel] (use needinfo)](/user_profile?user_id=424995) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=990096#c16)• 11 years ago |
|  | |

I'm going to mark this esr24- based on [comment 13](/show_bug.cgi?id=990096#c13 "RESOLVED FIXED - AddressSanitizer: global-buffer-overflow due to unhandled OOM [@ JSC::Yarr::digitsCreate()]") and [comment 15](/show_bug.cgi?id=990096#c15 "RESOLVED FIXED - AddressSanitizer: global-buffer-overflow due to unhandled OOM [@ JSC::Yarr::digitsCreate()]").
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=affected)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
--- → [-](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=-)

|  | [Lawrence Mandel [:lmandel] (use needinfo)](/user_profile?user_id=424995) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=990096#a4846657_424995)• 11 years ago |

[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=990096#c17)• 11 years ago |
|  | |

matt, is this something you might verify for 31? thanks!Flags: needinfo?(mwobensmith)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=990096#c18)• 11 years ago |
|  | |

Yes, thanks.Flags: needinfo?(mwobensmith)QA Contact: mwobensmith

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=990096#a8665460_280903)• 11 years ago |

Whiteboard: [adv-main31+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=990096#c19)• 11 years ago |
|  | |

I take back what I said in [comment 17](/show_bug.cgi?id=990096#c17 "RESOLVED FIXED - AddressSanitizer: global-buffer-overflow due to unhandled OOM [@ JSC::Yarr::digitsCreate()]"). :)
Based on comments, it does not appear easy to reproduce and appears harder to exploit, so I am marking [qa-] as a result. As usual, a test case or STR would help us verify - feel free to provide help in that direction if a verification is needed.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=990096#a8834201_279076)• 11 years ago |

QA Whiteboard: [qa-]

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=990096#a9060502_5189)• 11 years ago |

[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=unaffected)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=unaffected)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=990096#a44892136_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=990096#a68794669_1689)• 9 years ago |

Group: core-security-release

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=990096#a186602806_495955)• 5 years ago |

Blocks: [asan-maintenance](/show_bug.cgi?id=863846 "NEW - [meta] Maintain Firefox ASan build process and compatibility")
You need to [log in](/show_bug.cgi?id=990096&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jason Orendorff [:jorendorff]](/user_profile?user_id=281791)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_56cf9feb_20250125_062805.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1021969)
* [XML](/show_bug.cgi?ctype=xml&id=1021969)

Closed
[Bug 1021969](/show_bug.cgi?id=1021969)

Opened 11 years ago
Closed 11 years ago

# mozMediaStatisticsShowing property shouldn't be content-exposed

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

mozMediaStatisticsShowing property shouldn't be content-exposed

## Categories

### (Toolkit :: Video/Audio Controls, defect)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Video%2FAudio%20Controls#Video%2FAudio%20Controls)

Video/Audio Controls
▾

Toolkit :: Video/Audio Controls
For problems related to the default controls used in HTML 5 media
elements (<video> and <audio>).
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Video%2FAudio%20Controls&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Video%2FAudio%20Controls&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Video%2FAudio%20Controls)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla32

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox29 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=wontfix) |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified) |
| firefox32 | --- | [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified) |
| firefox-esr24 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox29 |  | wontfix |
| firefox30 |  | wontfix |
| firefox31 |  | verified |
| firefox32 |  | verified |
| firefox-esr24 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: Gijs, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=40)  [mwobensmith](/user_profile?user_id=452604)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/3ba00bb99f41523d041bb1e150ee7de4?d=mm&size=40)  [kpatenio](/user_profile?user_id=690690)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

18 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1021240](/show_bug.cgi?id=1021240 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[999034](/show_bug.cgi?id=999034 "RESOLVED FIXED - List of known possibly security sensitive issues")

Dependency [tree](/showdependencytree.cgi?id=1021969&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1021969)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-low, Whiteboard: p=2 s=33.1 [adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

p=2 s=33.1 [adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [Gijs](/user_profile?user_id=159069) | [firefox-backlog](#c1 "11 years ago") | + |
| --- | --- | --- |
| [Gijs](/user_profile?user_id=159069) | firefox-backlog | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Branch patch](/attachment.cgi?id=8436897)  [11 years ago](#c8)  [:Gijs (he/him)](/user_profile?user_id=159069)   8.73 KB, patch | Gijs : [review+](#c9 "11 years ago")  Sylvestre : [approval-mozilla-aurora+](#c11 "11 years ago") | [Details](/attachment.cgi?id=8436897&action=edit) | [Diff](/attachment.cgi?id=8436897&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021969&attachment=8436897) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1021969#c0)• 11 years ago |
|  | |

+++ This bug was initially created as a clone of [Bug #1021240](/show_bug.cgi?id=1021240 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox") +++
1. Create a video element with controls = true
2. Set the getter for the 'mozMediaStatisticsShowing' property to a function that calls alert
3. Add the video element to the dom tree.
4. Firefox freeze
We'll work around this by avoiding the mozMediaStatisticsShowing property from influencing chrome by sticking it in a webidl property.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1021969#c1)• 11 years ago |
|  | |

Landed
<https://bugzilla.mozilla.org/attachment.cgi?id=8435888>
as
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/9e19217a1042>
Marco, can you add this to the current iteration?Status: NEW → ASSIGNEDFlags: needinfo?(mmucci)Flags: firefox-backlog+Whiteboard: [fixed-in-inbound] p=2 s=it-32c-31a-30b.3 [qa-]

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1021969#c2)• 11 years ago |
|  | |

+ reordering bustage fix @ <https://hg.mozilla.org/integration/mozilla-inbound/rev/115ea0cc4b22>

|  | [Marco Mucci [:MarcoM]](/user_profile?user_id=458208) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1021969#c3)• 11 years ago |
|  | |

Added to Iteration 32.3Flags: needinfo?(mmucci)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1021969#c4)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/9e19217a1042>
<https://hg.mozilla.org/mozilla-central/rev/115ea0cc4b22>
Should this have had sec-approval to land?
<https://wiki.mozilla.org/Security/Bug_Approval_Process>Status: ASSIGNED → RESOLVEDClosed: 11 years ago
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)Flags: needinfo?(gijskruitbosch+bugs)Resolution: --- → FIXEDWhiteboard: [fixed-in-inbound] p=2 s=it-32c-31a-30b.3 [qa-] → p=2 s=it-32c-31a-30b.3 [qa-]Target Milestone: --- → mozilla32

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1021969#c5)• 11 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM UTC-4] from [comment #4](/show_bug.cgi?id=1021969#c4 "VERIFIED FIXED - mozMediaStatisticsShowing property shouldn't be content-exposed"))
> <https://hg.mozilla.org/mozilla-central/rev/9e19217a1042>
> <https://hg.mozilla.org/mozilla-central/rev/115ea0cc4b22>
>
> Should this have had sec-approval to land?
> <https://wiki.mozilla.org/Security/Bug_Approval_Process>
Presumably yes. I'm sorry; I actually quite literally didn't realize we had process for landing sec fixes on m-c/nightly-integration. I /believe/ this wasn't sec-high or sec-crit, but I'm needinfo'ing bholley and dveditz to be sure. I also believe it is a well-known fact that XPCN.unwrap should be avoided, and so I don't think the patch really gives any information that any people looking for exploits wouldn't have already by applying simple grepping to our source.
I also think that this could easily and therefore should be uplifted to 31. I don't think it's a severe enough issue that it warrants a respin of 30 rc.
The original issue is a hang (OSX-only, I \*think\* ?), which is being tracked in [bug 1021240](/show_bug.cgi?id=1021240 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"). I checked when writing the patch and wasn't able to abuse the exposed unwrapped flag into privilege escalation or something of the sort, but I'm not exactly a security researcher so that's hardly a guarantee that there genuinely isn't such a possibility.Flags: needinfo?(gijskruitbosch+bugs)Flags: needinfo?(dveditz)Flags: needinfo?(bobbyholley)

|  | [Marco Mucci [:MarcoM]](/user_profile?user_id=458208) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a98090_458208)• 11 years ago |

Status: RESOLVED → VERIFIED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1021969#c6)• 11 years ago |
|  | |

I think this was a sec:low, personally.

|  | [Cody Crews](/user_profile?user_id=457276) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1021969#c7)• 11 years ago |
|  | |

Definitely a sec-low as it stands. Put all the original issues together and it might manage sec-moderate.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a174405_159069)• 11 years ago |

Flags: needinfo?(dveditz)Flags: needinfo?(bobbyholley)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a176248_406194)• 11 years ago |

Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1021969#c8)• 11 years ago |
|  | |

Attached patch

[Branch patch](attachment.cgi?id=8436897&action=diff)
— [Details](attachment.cgi?id=8436897&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021969&attachment=8436897)

Patch for 31

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1021969#c9)• 11 years ago |
|  | |

Comment on [attachment 8436897](/attachment.cgi?id=8436897 "Branch patch") [[details]](/attachment.cgi?id=8436897&action=edit "Branch patch") [[diff]](/attachment.cgi?id=8436897&action=diff "Branch patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021969&attachment=8436897)
Branch patch
[Approval Request Comment]
Bug caused by (feature/regressing bug #): n/a
User impact if declined: freeze when website defines getter calling alert() for mozMediaStatisticsShowing
Testing completed (on m-c, etc.): on m-c
Risk to taking this patch (and alternatives if risky): low
String or IDL/UUID changes made by this patch: none
[Attachment #8436897](/attachment.cgi?id=8436897&action=edit "Branch patch") -
Flags: review+
[Attachment #8436897](/attachment.cgi?id=8436897&action=edit "Branch patch") -
Flags: approval-mozilla-beta?
[Attachment #8436897](/attachment.cgi?id=8436897&action=edit "Branch patch") -
Flags: approval-mozilla-aurora?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1021969#c10)• 11 years ago |
|  | |

(to be clear, requesting approval for 31, not for 30)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a227037_159069)• 11 years ago |

[status-firefox29](/buglist.cgi?f1=cf_status_firefox29&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=wontfix)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1021969#c11)• 11 years ago |
|  | |

Comment on [attachment 8436897](/attachment.cgi?id=8436897 "Branch patch") [[details]](/attachment.cgi?id=8436897&action=edit "Branch patch") [[diff]](/attachment.cgi?id=8436897&action=diff "Branch patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021969&attachment=8436897)
Branch patch
Approving for 31. Leaving the "?" for beta in case it does not reach aurora before the merge.
[Attachment #8436897](/attachment.cgi?id=8436897&action=edit "Branch patch") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1021969#c12)• 11 years ago |
|  | |

Comment on [attachment 8436897](/attachment.cgi?id=8436897 "Branch patch") [[details]](/attachment.cgi?id=8436897&action=edit "Branch patch") [[diff]](/attachment.cgi?id=8436897&action=diff "Branch patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021969&attachment=8436897)
Branch patch
remote: <https://hg.mozilla.org/releases/mozilla-aurora/rev/31275157dca3>
[Attachment #8436897](/attachment.cgi?id=8436897&action=edit "Branch patch") -
Flags: approval-mozilla-beta?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a231795_159069)• 11 years ago |

[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1021969#c13)• 11 years ago |
|  | |

Hi Marco - you marked the bug verified, but the flags for Fx31/Fx32 remain unchanged. Has the bug actually been verified fixed by someone other than the developer? If so, could you set those flags to indicate which branches you verified on?
QA relies on these flags to know what security bugs need verification, and the state of this bug is unclear. Thank you very much.Flags: needinfo?(mmucci)

|  | [Marco Mucci [:MarcoM]](/user_profile?user_id=458208) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1021969#c14)• 11 years ago |
|  | |

(In reply to Matt Wobensmith from [comment #13](/show_bug.cgi?id=1021969#c13 "VERIFIED FIXED - mozMediaStatisticsShowing property shouldn't be content-exposed"))
> Hi Marco - you marked the bug verified, but the flags for Fx31/Fx32 remain
> unchanged. Has the bug actually been verified fixed by someone other than
> the developer? If so, could you set those flags to indicate which branches
> you verified on?
>
> QA relies on these flags to know what security bugs need verification, and
> the state of this bug is unclear. Thank you very much.
Hi Matt, the bug was marked as [qa-] as not required further QA verification. That's why I changed the status to verified after it was resolved. If this is not the case and the bug requires further verification I can mark it as [qa+] and change the status back to resolved. Let me know what is the best way to proceed for this particular bug.Flags: needinfo?(mmucci)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1021969#c15)• 11 years ago |
|  | |

I set this to qa-, and thinking about it more, that's probably a mistake.
Matt, you can verify that this fixes the freeze with the testcase at <https://bugzilla.mozilla.org/attachment.cgi?id=8435220> (from [bug 1021240](/show_bug.cgi?id=1021240 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox")).Status: VERIFIED → RESOLVEDClosed: 11 years ago → 11 years agoQA Contact: mwobensmithWhiteboard: p=2 s=it-32c-31a-30b.3 [qa-] → p=2 s=it-32c-31a-30b.3 [qa+]

|  | [Marco Mucci [:MarcoM]](/user_profile?user_id=458208) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1021969#c16)• 11 years ago |
|  | |

Added to Iteration 33.1Whiteboard: p=2 s=it-32c-31a-30b.3 [qa+] → p=2 s=33.1 [qa+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1021969#c17)• 11 years ago |
|  | |

Thanks Marco and Gijs for clearing up that mystery. :)
Confirmed issue on Fx31, 2014-06-05.
Verified fixed on Fx31 and Fx32, 2014-06-16.Status: RESOLVED → VERIFIED
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified)Whiteboard: p=2 s=33.1 [qa+] → p=2 s=33.1

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a2258394_272375)• 11 years ago |

[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a2928220_280903)• 11 years ago |

Whiteboard: p=2 s=33.1 → p=2 s=33.1 [adv-main31+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a3292480_280903)• 11 years ago |

Alias: CVE-2014-1554

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a3872328_280903)• 11 years ago |

Alias: CVE-2014-1554

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a39087007_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021969#a62991252_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1021969&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [:Gijs (he/him)](/user_profile?user_id=159069)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_7a2c33d6_20250125_062804.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1021312)
* [XML](/show_bug.cgi?ctype=xml&id=1021312)

Closed
[Bug 1021312](/show_bug.cgi?id=1021312)

Opened 11 years ago
Closed 11 years ago

# Zone Mismatch in CloneNonReflectors

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Zone Mismatch in CloneNonReflectors

## Categories

### (Core :: XPConnect, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XPConnect#XPConnect)

XPConnect
▾

Core :: XPConnect
Facilitates calling between JavaScript and XPCOM components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XPConnect&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XPConnect)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla32

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.2 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=wontfix) |
| b2g-v1.3 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=wontfix) |
| b2g-v1.3T | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=wontfix) |
| b2g-v1.4 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=wontfix) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 |  | fixed |
| firefox32 |  | fixed |
| firefox-esr24 |  | unaffected |
| b2g-v1.2 |  | wontfix |
| b2g-v1.3 |  | wontfix |
| b2g-v1.3T |  | wontfix |
| b2g-v1.4 |  | wontfix |
| b2g-v2.0 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bholley, Assigned: bholley)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=40)  [bholley](/user_profile?user_id=313730)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

9 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[987111](/show_bug.cgi?id=987111 "RESOLVED FIXED - Implement Xrays to Object objects"), [1021244](/show_bug.cgi?id=1021244 "RESOLVED FIXED - Switch the browser-element API to Cu.exportFunction")

Dependency [tree](/showdependencytree.cgi?id=1021312&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1021312)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: [adv-main31+][qa-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+][qa-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c8 "11 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Part 1 - Wrap strings in CloneNonReflectors. v1](/attachment.cgi?id=8435350)  [11 years ago](#c1)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   954 bytes, patch | mccr8 : [review+](#a3265_406194 "11 years ago")  Sylvestre : [approval-mozilla-aurora+](#a66300_495955 "11 years ago") | [Details](/attachment.cgi?id=8435350&action=edit) | [Diff](/attachment.cgi?id=8435350&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021312&attachment=8435350) |
| --- | --- | --- |
| [Part 2 - use a fresh zone for xpcshell. v1](/attachment.cgi?id=8435351)  [11 years ago](#c2)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.43 KB, patch | mccr8 : [review+](#a3025_406194 "11 years ago") | [Details](/attachment.cgi?id=8435351&action=edit) | [Diff](/attachment.cgi?id=8435351&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021312&attachment=8435351) |
| [Part 3 - Tests. v1](/attachment.cgi?id=8435352)  [11 years ago](#c3)  [Bobby Holley (:bholley)](/user_profile?user_id=313730)   1.57 KB, patch | mccr8 : [review+](#a3157_406194 "11 years ago") | [Details](/attachment.cgi?id=8435352&action=edit) | [Diff](/attachment.cgi?id=8435352&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021312&attachment=8435352) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1021312#c0)• 11 years ago |
|  | |

CloneNonReflectors currently assumes that it only needs to worry about compartments in the v.isObject() case. However, we can still get mismatches with cross-zone strings. The solution is to wrap the string, which causes non-interned strings to be copied into the target zone.
The mismatch is mitigated to sec-moderate because this can only be triggered by a privileged API that doesn't currently have any in-tree consumers.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1021312#c1)• 11 years ago |
|  | |

Attached patch

[Part 1 - Wrap strings in CloneNonReflectors. v1](attachment.cgi?id=8435350&action=diff)
— [Details](attachment.cgi?id=8435350&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021312&attachment=8435350)

[Attachment #8435350](/attachment.cgi?id=8435350&action=edit "Part 1 - Wrap strings in CloneNonReflectors. v1") -
Flags: review?(continuation)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1021312#c2)• 11 years ago |
|  | |

Attached patch

[Part 2 - use a fresh zone for xpcshell. v1](attachment.cgi?id=8435351&action=diff)
— [Details](attachment.cgi?id=8435351&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021312&attachment=8435351)

[Attachment #8435351](/attachment.cgi?id=8435351&action=edit "Part 2 - use a fresh zone for xpcshell. v1") -
Flags: review?(continuation)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1021312#c3)• 11 years ago |
|  | |

Attached patch

[Part 3 - Tests. v1](attachment.cgi?id=8435352&action=diff)
— [Details](attachment.cgi?id=8435352&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021312&attachment=8435352)

[Attachment #8435352](/attachment.cgi?id=8435352&action=edit "Part 3 - Tests. v1") -
Flags: review?(continuation)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a3025_406194)• 11 years ago |

[Attachment #8435351](/attachment.cgi?id=8435351&action=edit "Part 2 - use a fresh zone for xpcshell. v1") -
Flags: review?(continuation) → review+

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a3157_406194)• 11 years ago |

[Attachment #8435352](/attachment.cgi?id=8435352&action=edit "Part 3 - Tests. v1") -
Flags: review?(continuation) → review+

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a3265_406194)• 11 years ago |

[Attachment #8435350](/attachment.cgi?id=8435350&action=edit "Part 1 - Wrap strings in CloneNonReflectors. v1") -
Flags: review?(continuation) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a3459_313730)• 11 years ago |

Blocks: [1021244](/show_bug.cgi?id=1021244 "RESOLVED FIXED - Switch the browser-element API to Cu.exportFunction")

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1021312#c4)• 11 years ago |
|  | |

<https://tbpl.mozilla.org/?tree=Try&rev=0872c62a17e2>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1021312#c5)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/pushloghtml?changeset=8501686e4923>

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1021312#c6)• 11 years ago |
|  | |

Comment on [attachment 8435350](/attachment.cgi?id=8435350 "Part 1 - Wrap strings in CloneNonReflectors. v1") [[details]](/attachment.cgi?id=8435350&action=edit "Part 1 - Wrap strings in CloneNonReflectors. v1") [[diff]](/attachment.cgi?id=8435350&action=diff "Part 1 - Wrap strings in CloneNonReflectors. v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021312&attachment=8435350)
Part 1 - Wrap strings in CloneNonReflectors. v1
[Approval Request Comment]
Bug caused by (feature/regressing bug #): the introduction of exportFunction - longstanding
User impact if declined: potential memory hazard
Testing completed (on m-c, etc.): just pushed to m-i
Risk to taking this patch (and alternatives if risky): Extremely low risk.
String or IDL/UUID changes made by this patch: None
[Attachment #8435350](/attachment.cgi?id=8435350&action=edit "Part 1 - Wrap strings in CloneNonReflectors. v1") -
Flags: approval-mozilla-aurora?

|  | [Ed Morley [:emorley]](/user_profile?user_id=373476) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1021312#c7)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/1ab8174e097f>
<https://hg.mozilla.org/mozilla-central/rev/08045ba9192f>
<https://hg.mozilla.org/mozilla-central/rev/340e016163ed>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla32

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a66275_495955)• 11 years ago |

[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a66300_495955)• 11 years ago |

[Attachment #8435350](/attachment.cgi?id=8435350&action=edit "Part 1 - Wrap strings in CloneNonReflectors. v1") -
Flags: approval-mozilla-aurora? → approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1021312#c8)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/9bcea7802320>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/2b3f51c3c5a7>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/999c34fa59a2>
Should we consider taking this on b2g30 for v1.4 as well?
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=wontfix)
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=wontfix)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=wontfix)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)Flags: needinfo?(bobbyholley)Flags: in-testsuite+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1021312#c9)• 11 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM UTC-4] from [comment #8](/show_bug.cgi?id=1021312#c8 "RESOLVED FIXED - Zone Mismatch in CloneNonReflectors"))
> Should we consider taking this on b2g30 for v1.4 as well?
Naw. [Bug 1021244](/show_bug.cgi?id=1021244 "RESOLVED FIXED - Switch the browser-element API to Cu.exportFunction") is the first in-tree usage of this outside of testing, so the uplift is primarily concerned with addons (which aren't a problem for b2g).Flags: needinfo?(bobbyholley)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a69041_75935)• 11 years ago |

[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=wontfix)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1021312#c10)• 11 years ago |
|  | |

Backed out from Aurora for failures in the new test.
<https://hg.mozilla.org/releases/mozilla-aurora/rev/95deb57e283b>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=41223994&tree=Mozilla-Aurora>
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1021312#c11)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/965578443062>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1021312#c12)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/a5967705754e>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/68ee1d33fc83>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/b982a8afab52>
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1021312#c13)• 11 years ago |
|  | |

Backed out along with [bug 1020460](/show_bug.cgi?id=1020460 "RESOLVED FIXED - Array.prototype.toSource should be generic") in <https://hg.mozilla.org/integration/mozilla-inbound/rev/6502442e6133>
Relanded in <https://hg.mozilla.org/integration/mozilla-inbound/rev/c0f0a8689dab> since it wasn't part of the bustage.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1021312#c14)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/c0f0a8689dab>

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a3362827_280903)• 11 years ago |

Whiteboard: [adv-main31+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1021312#c15)• 11 years ago |
|  | |

Marking [qa-] in the absence of test media or STR, please feel free to provide if you'd like help testing.Whiteboard: [adv-main31+] → [adv-main31+][qa-]

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a39169701_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021312#a53660669_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1021312&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bobby Holley (:bholley)](/user_profile?user_id=313730)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_9b8b8f85_20250125_062808.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1022773)
* [XML](/show_bug.cgi?ctype=xml&id=1022773)

Closed
[Bug 1022773](/show_bug.cgi?id=1022773)

Opened 11 years ago
Closed 11 years ago

# Static hazard analysis does not detect a return value held live across a GC

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Static hazard analysis does not detect a return value held live across a GC

## Categories

### (Core :: JavaScript: GC, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%3A%20GC#JavaScript%3A%20GC)

JavaScript: GC
▾

Core :: JavaScript: GC
File bugs here for issues involving the garbage collector (crashes, leaks, etc.), where the issue is *not* one caused by failure to use the JSAPI correctly.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%3A%20GC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%3A%20GC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%3A%20GC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86\_64

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) |
| firefox33 | [+](/buglist.cgi?f1=cf_tracking_firefox33&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) |
| b2g-v1.3T | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |
| b2g-v2.1 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 |  | fixed |
| firefox32 |  | fixed |
| firefox33 | + | fixed |
| firefox-esr24 |  | unaffected |
| b2g-v1.3 |  | unaffected |
| b2g-v1.3T |  | unaffected |
| b2g-v1.4 |  | unaffected |
| b2g-v2.0 |  | fixed |
| b2g-v2.1 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sfink, Assigned: sfink)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/d269c0228684029dedb75d73b81a64c3?d=mm&size=40)  [sfink](/user_profile?user_id=359004)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d269c0228684029dedb75d73b81a64c3?d=mm&size=40)  [sfink](/user_profile?user_id=359004)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

18 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1028629](/show_bug.cgi?id=1028629 "RESOLVED FIXED - Remove a function pointer (encodeVFP)"), [1029227](/show_bug.cgi?id=1029227 "RESOLVED FIXED - Annotate GetSafeJSContext as never overridden by GCing implementation"), [1035092](/show_bug.cgi?id=1035092 "RESOLVED FIXED - bool functions shouldn't return nullptr")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1022773&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1022773)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1009675](/show_bug.cgi?id=1009675 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]")

## Details

### (Keywords: sec-high, Whiteboard: [qa-][adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[qa-][adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (16 files, 3 obsolete files)

| [Include return values in analysis](/attachment.cgi?id=8444620)  [11 years ago](#c1)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   5.24 KB, patch |  | [Details](/attachment.cgi?id=8444620&action=edit) | [Diff](/attachment.cgi?id=8444620&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444620) |
| --- | --- | --- |
| [Consider internal function names in analysis](/attachment.cgi?id=8444630)  [11 years ago](#c3)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   3.64 KB, patch |  | [Details](/attachment.cgi?id=8444630&action=edit) | [Diff](/attachment.cgi?id=8444630&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444630) |
| [Consider internal function names in analysis](/attachment.cgi?id=8444634)  [11 years ago](#c4)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   3.65 KB, patch | bhackett1024 : [review+](#c21 "11 years ago")  sfink : [checkin+](#a1909348_359004 "11 years ago") | [Details](/attachment.cgi?id=8444634&action=edit) | [Diff](/attachment.cgi?id=8444634&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444634) |
| [Debugging helper setup for analyzeRoots.js](/attachment.cgi?id=8444639)  [11 years ago](#c5)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   2.91 KB, patch | sfink : [checkin+](#a1909352_359004 "11 years ago") | [Details](/attachment.cgi?id=8444639&action=edit) | [Diff](/attachment.cgi?id=8444639&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444639) |
| [Ignore trivial |return nullptr;| statements that cross GC boundaries](/attachment.cgi?id=8444645)  [11 years ago](#c6)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   3.50 KB, patch | bhackett1024 : [review+](#c22 "11 years ago")  sfink : [checkin+](#a1909356_359004 "11 years ago") | [Details](/attachment.cgi?id=8444645&action=edit) | [Diff](/attachment.cgi?id=8444645&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444645) |
| [hazard analysis output improvements](/attachment.cgi?id=8444651)  [11 years ago](#c7)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   7.11 KB, patch | terrence : [review+](#c20 "11 years ago")  sfink : [checkin+](#a1909360_359004 "11 years ago") | [Details](/attachment.cgi?id=8444651&action=edit) | [Diff](/attachment.cgi?id=8444651&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444651) |
| [Include return values in analysis](/attachment.cgi?id=8444656)  [11 years ago](#c8)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   7.10 KB, patch | bhackett1024 : [review+](#c23 "11 years ago")  sfink : [checkin+](#a1909365_359004 "11 years ago") | [Details](/attachment.cgi?id=8444656&action=edit) | [Diff](/attachment.cgi?id=8444656&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444656) |
| [Resolve hazard by switching Compile to MutableHandle](/attachment.cgi?id=8444819)  [11 years ago](#c9)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   17.36 KB, patch | terrence : [review+](#a1292036_231770 "11 years ago")  smaug : [review+](#a1233505_39966 "11 years ago")  bholley : [review+](#a1382415_313730 "11 years ago")  abillings : [approval-mozilla-aurora+](#c27 "11 years ago")  abillings : [approval-mozilla-beta+](#c27 "11 years ago")  abillings : [sec-approval+](#c27 "11 years ago")  sfink : [checkin+](#a1909369_359004 "11 years ago") | [Details](/attachment.cgi?id=8444819&action=edit) | [Diff](/attachment.cgi?id=8444819&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444819) |
| [Switch all JS Compile functions to use MutableHandle](/attachment.cgi?id=8444827)  [11 years ago](#c10)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   63.39 KB, patch | terrence : [review+](#c18 "11 years ago")  sfink : [checkin+](#a1909373_359004 "11 years ago") | [Details](/attachment.cgi?id=8444827&action=edit) | [Diff](/attachment.cgi?id=8444827&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444827) |
| [Return value rooting for content/](/attachment.cgi?id=8444831)  [11 years ago](#c11)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   6.74 KB, patch | smaug : [review+](#a1234720_39966 "11 years ago")  abillings : [approval-mozilla-aurora+](#a1405930_280903 "11 years ago")  abillings : [approval-mozilla-beta+](#a1405930_280903 "11 years ago")  abillings : [sec-approval+](#a1405930_280903 "11 years ago")  sfink : [checkin+](#a1909377_359004 "11 years ago") | [Details](/attachment.cgi?id=8444831&action=edit) | [Diff](/attachment.cgi?id=8444831&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444831) |
| [Return value rooting for dom/](/attachment.cgi?id=8444832)  [11 years ago](#c12)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   6.86 KB, patch | bzbarsky : [review+](#c19 "11 years ago")  abillings : [approval-mozilla-aurora+](#a1406469_280903 "11 years ago")  abillings : [approval-mozilla-beta+](#a1406469_280903 "11 years ago")  abillings : [sec-approval+](#a1406469_280903 "11 years ago")  sfink : [checkin+](#a1909381_359004 "11 years ago") | [Details](/attachment.cgi?id=8444832&action=edit) | [Diff](/attachment.cgi?id=8444832&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444832) |
| [Return value rooting for workers](/attachment.cgi?id=8444833)  [11 years ago](#c13)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   4.86 KB, patch | bent.mozilla : [review+](#a1244963_200444 "11 years ago")  abillings : [approval-mozilla-aurora+](#a1406498_280903 "11 years ago")  abillings : [approval-mozilla-beta+](#a1406498_280903 "11 years ago")  abillings : [sec-approval+](#a1406498_280903 "11 years ago")  sfink : [checkin+](#a1909386_359004 "11 years ago") | [Details](/attachment.cgi?id=8444833&action=edit) | [Diff](/attachment.cgi?id=8444833&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444833) |
| [Return value rooting for JS engine](/attachment.cgi?id=8444834)  [11 years ago](#c14)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   24.62 KB, patch | terrence : [review+](#c17 "11 years ago")  abillings : [approval-mozilla-aurora+](#a1406508_280903 "11 years ago")  abillings : [approval-mozilla-beta+](#a1406508_280903 "11 years ago")  sfink : [checkin+](#a1909390_359004 "11 years ago") | [Details](/attachment.cgi?id=8444834&action=edit) | [Diff](/attachment.cgi?id=8444834&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834) |
| [Return value rooting for XPConnect](/attachment.cgi?id=8444839)  [11 years ago](#c15)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   7.40 KB, patch | bholley : [review+](#a1248875_313730 "11 years ago")  abillings : [approval-mozilla-aurora+](#a1406522_280903 "11 years ago")  abillings : [approval-mozilla-beta+](#a1406522_280903 "11 years ago")  abillings : [sec-approval+](#a1406522_280903 "11 years ago")  sfink : [checkin+](#a1909394_359004 "11 years ago") | [Details](/attachment.cgi?id=8444839&action=edit) | [Diff](/attachment.cgi?id=8444839&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444839) |
| [Return value rooting for SPS](/attachment.cgi?id=8444841)  [11 years ago](#c16)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   2.50 KB, patch | ehsan.akhgari : [review+](#a1237923_251051 "11 years ago")  abillings : [approval-mozilla-aurora+](#a1406535_280903 "11 years ago")  abillings : [approval-mozilla-beta+](#a1406535_280903 "11 years ago")  abillings : [sec-approval+](#a1406535_280903 "11 years ago")  sfink : [checkin+](#a1909398_359004 "11 years ago") | [Details](/attachment.cgi?id=8444841&action=edit) | [Diff](/attachment.cgi?id=8444841&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444841) |
| [Return value rooting for content/](/attachment.cgi?id=8446153)  [11 years ago](#c29)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   1.62 KB, patch | abillings : [approval-mozilla-aurora+](#a1406545_280903 "11 years ago")  abillings : [approval-mozilla-beta+](#a1406545_280903 "11 years ago")  abillings : [sec-approval+](#a1406545_280903 "11 years ago")  sfink : [checkin+](#a1909403_359004 "11 years ago") | [Details](/attachment.cgi?id=8446153&action=edit) | [Diff](/attachment.cgi?id=8446153&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8446153) |
| [Return value rooting for dom/](/attachment.cgi?id=8447274)  [11 years ago](#c38)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   5.99 KB, patch | sfink : [checkin+](#a1909408_359004 "11 years ago") | [Details](/attachment.cgi?id=8447274&action=edit) | [Diff](/attachment.cgi?id=8447274&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8447274) |
| [AutoJSAPI initialization rooting](/attachment.cgi?id=8447850)  [11 years ago](#c39)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   1.23 KB, patch | bholley : [review-](#c40 "11 years ago") | [Details](/attachment.cgi?id=8447850&action=edit) | [Diff](/attachment.cgi?id=8447850&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8447850) |
| [Fix AutoJSAPI initialization rooting by annotating nsIScriptContext.GetWindowProxy](/attachment.cgi?id=8448368)  [11 years ago](#c41)  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)   2.32 KB, patch | bholley : [review+](#a1836837_313730 "11 years ago") | [Details](/attachment.cgi?id=8448368&action=edit) | [Diff](/attachment.cgi?id=8448368&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8448368) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1022773#c0)• 11 years ago |
|  | |

bz found a real live hazard in the wild that the analysis should catch but does not. See [bug 1009675](/show_bug.cgi?id=1009675 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]").
Consider:
Value foo() {
CallSetup s;
return bar();
}
where CallSetup::~CallSetup can gc. The relevant bit of the CFG is:
pentry: 1
pexit: 14
Call(11,12, \_\_temp\_3 := this\*.Call(\_\_temp\_4\*,\_\_temp\_5\*,\_\_temp\_6\*,aRv\*))
Assign(12,13, return := \_\_temp\_3\*)
Call(13,14, s.~CallSetup())
The problem is that \_\_temp\_3 gets stored into a magical 'return' variable, which is never considered to be used, and only then does ~CallSetup get invoked. Given that we always have a single unique exit point (14, here), it seems like I should be able to just say that the exit point implicitly uses 'return'. (Or at least, I'm assuming from the existence of a 'pexit' field that there's always a single unique exit point.)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a555_20209)• 11 years ago |

See Also: → [1009675](/show_bug.cgi?id=1009675 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a90288_1689)• 11 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a179253_280903)• 11 years ago |

[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected)
[tracking-firefox33](/buglist.cgi?f1=cf_tracking_firefox33&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox33&o1=equals&v1=%2B)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1216208_359004)• 11 years ago |

Depends on: [1028629](/show_bug.cgi?id=1028629 "RESOLVED FIXED - Remove a function pointer (encodeVFP)")

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1022773#c1)• 11 years ago |
|  | |

Attached patch

[Include return values in analysis](attachment.cgi?id=8444620&action=diff) (obsolete)
— [Details](attachment.cgi?id=8444620&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444620)

Treat the final point in a function as using the return value.
[Attachment #8444620](/attachment.cgi?id=8444620&action=edit "Include return values in analysis") -
Flags: review?(bhackett1024)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1022773#c2)• 11 years ago |
|  | |

Comment on [attachment 8444620](/attachment.cgi?id=8444620 "Include return values in analysis") [[details]](/attachment.cgi?id=8444620&action=edit "Include return values in analysis") [[diff]](/attachment.cgi?id=8444620&action=diff "Include return values in analysis") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444620)
Include return values in analysis
Doh! Sorry bhackett, this patch is wrong. (Nice and simple, but wrong.) I have later changes that fix it -- which endpoint of the return value edge you want is different for this "last edge uses the return value" case vs the normal case. Cancelling review request.
[Attachment #8444620](/attachment.cgi?id=8444620&action=edit "Include return values in analysis") -
Flags: review?(bhackett1024)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1022773#c3)• 11 years ago |
|  | |

Attached patch

[Consider internal function names in analysis](attachment.cgi?id=8444630&action=diff) (obsolete)
— [Details](attachment.cgi?id=8444630&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444630)

Ok, here's the proper patch. The full description of the tricky part is in a comment.
[Attachment #8444630](/attachment.cgi?id=8444630&action=edit "Consider internal function names in analysis") -
Flags: review?(bhackett1024)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1022773#c4)• 11 years ago |
|  | |

Attached patch

[Consider internal function names in analysis](attachment.cgi?id=8444634&action=diff)
— [Details](attachment.cgi?id=8444634&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444634)

Shouldn't really be in this same bug, but I introduced another hole in the analysis when I switched to matching mangled names. When gcc generates a "not in charge" constructor/destructor, and it is identical to the "in charge" body, then it only generates the code for the "not in charge" variant and somehow aliases the "in charge" variant to it. But the call graph will only show the "in charge" version, since the analysis knows nothing about the aliasing. That loses a call edge that is very important when you have an RAII destructor that can GC.
I fix it up by pretending that the "in charge" version is a simple stub function that calls the "not in charge" version. To be fully precise, I really shouldn't do this in the cases where they \*are\* different and therefore both get emitted, but that's a PITA and very probably irrelevant, so I'm just making it safe and conservative.
[Attachment #8444634](/attachment.cgi?id=8444634&action=edit "Consider internal function names in analysis") -
Flags: review?(bhackett1024)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1217883_359004)• 11 years ago |

[Attachment #8444630](/attachment.cgi?id=8444630&action=edit "Consider internal function names in analysis") -
Attachment is obsolete: true
[Attachment #8444630](/attachment.cgi?id=8444630&action=edit "Consider internal function names in analysis") -
Flags: review?(bhackett1024)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1022773#c5)• 11 years ago |
|  | |

Attached patch

[Debugging helper setup for analyzeRoots.js](attachment.cgi?id=8444639&action=diff)
— [Details](attachment.cgi?id=8444639&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444639)

I keep putting this stuff back in manually. I think I'll leave it there. r=me.

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1022773#c6)• 11 years ago |
|  | |

Attached patch

[Ignore trivial |return nullptr;| statements that cross GC boundaries](attachment.cgi?id=8444645&action=diff)
— [Details](attachment.cgi?id=8444645&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444645)

An annoying source of false positives with the return value is the pattern
RAII\_GC foo;
if (!SomeOperation())
return nullptr;
because this is putting a JSObject\* (nullptr) on the stack, then running a destructor that could GC. But as long as we don't relocate NULL, we're safe. :-) It turns out to be annoying to restructure things to avoid these.
If necessary, I'll extend this to cover |UndefinedValue()| and |NullValue()|, but those may not be so easy to pattern match so I'm not going to bother until I know they're needed.
[Attachment #8444645](/attachment.cgi?id=8444645&action=edit "Ignore trivial |return nullptr;| statements that cross GC boundaries") -
Flags: review?(bhackett1024)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1022773#c7)• 11 years ago |
|  | |

Attached patch

[hazard analysis output improvements](attachment.cgi?id=8444651&action=diff)
— [Details](attachment.cgi?id=8444651&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444651)

Continuing on the pattern of piling unrelated crap into this bug, here's another set of changes that I made to the analysis while working on this stuff. It adds some entries to the CFG dumps in gcFunctions.txt that make it a lot easier to understand what's going on. (Right now, it's kind of missing the critical endpoints, so it all just seems like irrelevant noise.)
[Attachment #8444651](/attachment.cgi?id=8444651&action=edit "hazard analysis output improvements") -
Flags: review?(terrence)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1022773#c8)• 11 years ago |
|  | |

Attached patch

[Include return values in analysis](attachment.cgi?id=8444656&action=diff)
— [Details](attachment.cgi?id=8444656&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444656)

I meant to upload this first, but this is the interesting patch that adds the return value handling.
[Attachment #8444656](/attachment.cgi?id=8444656&action=edit "Include return values in analysis") -
Flags: review?(bhackett1024)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1219459_359004)• 11 years ago |

[Attachment #8444620](/attachment.cgi?id=8444620&action=edit "Include return values in analysis") -
Attachment is obsolete: true

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1231365_359004)• 11 years ago |

Depends on: [1029227](/show_bug.cgi?id=1029227 "RESOLVED FIXED - Annotate GetSafeJSContext as never overridden by GCing implementation")

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1022773#c9)• 11 years ago |
|  | |

Attached patch

[Resolve hazard by switching Compile to MutableHandle](attachment.cgi?id=8444819&action=diff)
— [Details](attachment.cgi?id=8444819&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444819)

The hazards here are in the JS engine, but I had to update several things in Gecko. The changes are pretty trivial, but people might have opinions on error handling. (I could also do this entirely internal to the engine, but this seems less footgunny.)
Function '\_ZN2JS7CompileEP9JSContextNS\_6HandleIP8JSObjectEERKNS\_22ReadOnlyCompileOptionsERNS\_18SourceBufferHolderE|JSScript\* JS::Compile(JSContext\*, class JS::Handle<JSObject\*>, JS::ReadOnlyCompileOptions\*, JS::SourceBufferHolder\*)' has unrooted '<returnvalue>' of type 'JSScript\*' live across GC call '\_ZN18AutoLastFrameCheckD1Ev|void AutoLastFrameCheck::~AutoLastFrameCheck()' at js/src/jsapi.cpp:4626
Function '\_ZN2JS15CompileFunctionEP9JSContextNS\_6HandleIP8JSObjectEERKNS\_22ReadOnlyCompileOptionsEPKcjPKSA\_RNS\_18SourceBufferHolderE|JSFunction\* JS::CompileFunction(JSContext\*, class JS::Handle<JSObject\*>, JS::ReadOnlyCompileOptions\*, int8\*, uint32, int8\*\*, JS::SourceBufferHolder\*)' has unrooted '<returnvalue>' of type 'JSFunction\*' live across GC call '\_ZN18AutoLastFrameCheckD1Ev|void AutoLastFrameCheck::~AutoLastFrameCheck()' at js/src/jsapi.cpp:4833
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: review?(terrence)
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: review?(bugs)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1233072_359004)• 11 years ago |

[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: review?(bobbyholley)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1233505_39966)• 11 years ago |

[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: review?(bugs) → review+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1022773#c10)• 11 years ago |
|  | |

Attached patch

[Switch all JS Compile functions to use MutableHandle](attachment.cgi?id=8444827&action=diff)
— [Details](attachment.cgi?id=8444827&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444827)

One ugliness of the previous patch is that it makes one variant of JS::Compile mismatch the rest. If we don't mind the churn, we could change all of them. I don't know if it's worth it, so I'll punt the decision to my reviewer. :-)
[Attachment #8444827](/attachment.cgi?id=8444827&action=edit "Switch all JS Compile functions to use MutableHandle") -
Flags: review?(terrence)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1022773#c11)• 11 years ago |
|  | |

Attached patch

[Return value rooting for content/](attachment.cgi?id=8444831&action=diff)
— [Details](attachment.cgi?id=8444831&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444831)

[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: review?(bugs)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1022773#c12)• 11 years ago |
|  | |

Attached patch

[Return value rooting for dom/](attachment.cgi?id=8444832&action=diff)
— [Details](attachment.cgi?id=8444832&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444832)

[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: review?(bzbarsky)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1022773#c13)• 11 years ago |
|  | |

Attached patch

[Return value rooting for workers](attachment.cgi?id=8444833&action=diff)
— [Details](attachment.cgi?id=8444833&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444833)

[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: review?(bent.mozilla)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1022773#c14)• 11 years ago |
|  | |

Attached patch

[Return value rooting for JS engine](attachment.cgi?id=8444834&action=diff)
— [Details](attachment.cgi?id=8444834&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834)

[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: review?(terrence)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1022773#c15)• 11 years ago |
|  | |

Attached patch

[Return value rooting for XPConnect](attachment.cgi?id=8444839&action=diff)
— [Details](attachment.cgi?id=8444839&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444839)

[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: review?(bobbyholley)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1022773#c16)• 11 years ago |
|  | |

Attached patch

[Return value rooting for SPS](attachment.cgi?id=8444841&action=diff)
— [Details](attachment.cgi?id=8444841&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444841)

[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: review?(ehsan)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1234720_39966)• 11 years ago |

[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: review?(bugs) → review+

|  | [(no longer active)](/user_profile?user_id=251051) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1237923_251051)• 11 years ago |

[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: review?(ehsan) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1022773#c17)• 11 years ago |
|  | |

Comment on [attachment 8444834](/attachment.cgi?id=8444834 "Return value rooting for JS engine") [[details]](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") [[diff]](/attachment.cgi?id=8444834&action=diff "Return value rooting for JS engine") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834)
Return value rooting for JS engine
Review of [attachment 8444834](/attachment.cgi?id=8444834 "Return value rooting for JS engine") [[details]](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") [[diff]](/attachment.cgi?id=8444834&action=diff "Return value rooting for JS engine") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834):
-----------------------------------------------------------------
These are amazingly subtle.
::: js/src/jsfun.cpp
@@ +1541,5 @@
>
> bool isStarGenerator = generatorKind == StarGenerator;
> JS\_ASSERT(generatorKind != LegacyGenerator);
>
> + RootedScript maybeScript(cx, nullptr);
Remove the ,nullptr.
::: js/src/vm/Stack.cpp
@@ +666,5 @@
> #ifdef JS\_ION
> , ionInlineFrames\_(cx, (js::jit::JitFrameIterator\*) nullptr)
> #endif
> {
> + // settleOnActivation can only GC if principals are given
End with a period.
@@ +678,5 @@
> #ifdef JS\_ION
> , ionInlineFrames\_(cx, (js::jit::JitFrameIterator\*) nullptr)
> #endif
> {
> + // settleOnActivation can only GC if principals are given
Ditto.
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: review?(terrence) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1022773#c18)• 11 years ago |
|  | |

Comment on [attachment 8444827](/attachment.cgi?id=8444827 "Switch all JS Compile functions to use MutableHandle") [[details]](/attachment.cgi?id=8444827&action=edit "Switch all JS Compile functions to use MutableHandle") [[diff]](/attachment.cgi?id=8444827&action=diff "Switch all JS Compile functions to use MutableHandle") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444827)
Switch all JS Compile functions to use MutableHandle
Review of [attachment 8444827](/attachment.cgi?id=8444827 "Switch all JS Compile functions to use MutableHandle") [[details]](/attachment.cgi?id=8444827&action=edit "Switch all JS Compile functions to use MutableHandle") [[diff]](/attachment.cgi?id=8444827&action=diff "Switch all JS Compile functions to use MutableHandle") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444827):
-----------------------------------------------------------------
::: js/src/jsapi-tests/testCloneScript.cpp
@@ +109,5 @@
> JSAutoCompartment a(cx, A);
> JS::CompileOptions options(cx);
> options.setFileAndLine(\_\_FILE\_\_, 1);
> + JS::RootedFunction fun(cx);
> + JS\_CompileFunction(cx, A, "f",
We should probably check these for clarity, even though we're generally also checking the outparam after. Please audit the uses in this patch and add a CHECK on any that are missing it now.
[Attachment #8444827](/attachment.cgi?id=8444827&action=edit "Switch all JS Compile functions to use MutableHandle") -
Flags: review?(terrence) → review+

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1244963_200444)• 11 years ago |

[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: review?(bent.mozilla) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1022773#c19)• 11 years ago |
|  | |

Comment on [attachment 8444832](/attachment.cgi?id=8444832 "Return value rooting for dom/") [[details]](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") [[diff]](/attachment.cgi?id=8444832&action=diff "Return value rooting for dom/") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444832)
Return value rooting for dom/
>+ NS\_ENSURE\_TRUE(unrootedScopeObj, JSVAL\_NULL);
JS::NullValue.
r=me
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: review?(bzbarsky) → review+

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1248875_313730)• 11 years ago |

[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: review?(bobbyholley) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1292036_231770)• 11 years ago |

[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: review?(terrence) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1022773#c20)• 11 years ago |
|  | |

Comment on [attachment 8444651](/attachment.cgi?id=8444651 "hazard analysis output improvements") [[details]](/attachment.cgi?id=8444651&action=edit "hazard analysis output improvements") [[diff]](/attachment.cgi?id=8444651&action=diff "hazard analysis output improvements") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444651)
hazard analysis output improvements
Review of [attachment 8444651](/attachment.cgi?id=8444651 "hazard analysis output improvements") [[details]](/attachment.cgi?id=8444651&action=edit "hazard analysis output improvements") [[diff]](/attachment.cgi?id=8444651&action=diff "hazard analysis output improvements") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444651):
-----------------------------------------------------------------
::: js/src/devtools/rootAnalysis/analyzeRoots.js
@@ +112,5 @@
> if (ignoreEdgeUse(edge, variable))
> return 0;
>
> if (variable.Kind == "Return" && body.Index[1] == edge.Index[1] && body.BlockId.Kind == "Function")
> + return edge.Index[1]; // Last point in function body uses the return value
Period at the end, since you're here.
[Attachment #8444651](/attachment.cgi?id=8444651&action=edit "hazard analysis output improvements") -
Flags: review?(terrence) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1022773#c21)• 11 years ago |
|  | |

Comment on [attachment 8444634](/attachment.cgi?id=8444634 "Consider internal function names in analysis") [[details]](/attachment.cgi?id=8444634&action=edit "Consider internal function names in analysis") [[diff]](/attachment.cgi?id=8444634&action=diff "Consider internal function names in analysis") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444634)
Consider internal function names in analysis
Review of [attachment 8444634](/attachment.cgi?id=8444634 "Consider internal function names in analysis") [[details]](/attachment.cgi?id=8444634&action=edit "Consider internal function names in analysis") [[diff]](/attachment.cgi?id=8444634&action=diff "Consider internal function names in analysis") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444634):
-----------------------------------------------------------------
::: js/src/devtools/rootAnalysis/computeCallgraph.js
@@ +257,5 @@
>
> var minStream = xdb.min\_data\_stream();
> var maxStream = xdb.max\_data\_stream();
>
> +const internalMarker = " \*INTERNAL\* ";
Maybe put this in utility.js and avoid the explicit use in analyzeRoots.js
@@ +289,5 @@
> + // This is slightly conservative in the case where they are \*not\*
> + // identical, but that should be rare enough that we don't care. (The other
> + // much simpler but unsafe alternative would be to simply delete any
> + // " \*INTERNAL\* " substring, but I wasn't sure how possible it was for one
> + // version of the constructor to be different enough to GC.)
Remove parenthetical
[Attachment #8444634](/attachment.cgi?id=8444634&action=edit "Consider internal function names in analysis") -
Flags: review?(bhackett1024) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1022773#c22)• 11 years ago |
|  | |

Comment on [attachment 8444645](/attachment.cgi?id=8444645 "Ignore trivial |return nullptr;| statements that cross GC boundaries") [[details]](/attachment.cgi?id=8444645&action=edit "Ignore trivial |return nullptr;| statements that cross GC boundaries") [[diff]](/attachment.cgi?id=8444645&action=diff "Ignore trivial |return nullptr;| statements that cross GC boundaries") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444645)
Ignore trivial |return nullptr;| statements that cross GC boundaries
Review of [attachment 8444645](/attachment.cgi?id=8444645 "Ignore trivial |return nullptr;| statements that cross GC boundaries") [[details]](/attachment.cgi?id=8444645&action=edit "Ignore trivial |return nullptr;| statements that cross GC boundaries") [[diff]](/attachment.cgi?id=8444645&action=diff "Ignore trivial |return nullptr;| statements that cross GC boundaries") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444645):
-----------------------------------------------------------------
::: js/src/devtools/rootAnalysis/analyzeRoots.js
@@ +126,5 @@
> + else if (expressionUsesVariable(edge.Exp[1], variable))
> + rv = src;
> + if (rv && isReturningImmobileValue(edge, variable))
> + rv = 0;
> + return rv;
It looks like you can restructure this to avoid the rv variable by putting the test for isReturningImmobileValue first.
[Attachment #8444645](/attachment.cgi?id=8444645&action=edit "Ignore trivial |return nullptr;| statements that cross GC boundaries") -
Flags: review?(bhackett1024) → review+

|  | [Brian Hackett [Laid off!]](/user_profile?user_id=346231) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1022773#c23)• 11 years ago |
|  | |

Comment on [attachment 8444656](/attachment.cgi?id=8444656 "Include return values in analysis") [[details]](/attachment.cgi?id=8444656&action=edit "Include return values in analysis") [[diff]](/attachment.cgi?id=8444656&action=diff "Include return values in analysis") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444656)
Include return values in analysis
Review of [attachment 8444656](/attachment.cgi?id=8444656 "Include return values in analysis") [[details]](/attachment.cgi?id=8444656&action=edit "Include return values in analysis") [[diff]](/attachment.cgi?id=8444656&action=diff "Include return values in analysis") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444656):
-----------------------------------------------------------------
::: js/src/devtools/rootAnalysis/analyzeRoots.js
@@ +84,5 @@
> }
> return false;
> }
>
> +// If the edge uses the given variable, return the point at earliest point at
mangled comment
[Attachment #8444656](/attachment.cgi?id=8444656&action=edit "Include return values in analysis") -
Flags: review?(bhackett1024) → review+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1022773#c24)• 11 years ago |
|  | |

(In reply to Terrence Cole [:terrence] from [comment #17](/show_bug.cgi?id=1022773#c17 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC"))
> Comment on [attachment 8444834](/attachment.cgi?id=8444834 "Return value rooting for JS engine") [[details]](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") [[diff]](/attachment.cgi?id=8444834&action=diff "Return value rooting for JS engine") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834)
> Return value rooting for JS engine
>
> Review of [attachment 8444834](/attachment.cgi?id=8444834 "Return value rooting for JS engine") [[details]](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") [[diff]](/attachment.cgi?id=8444834&action=diff "Return value rooting for JS engine") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834):
> -----------------------------------------------------------------
>
> These are amazingly subtle.
>
> ::: js/src/jsfun.cpp
> @@ +1541,5 @@
> >
> > bool isStarGenerator = generatorKind == StarGenerator;
> > JS\_ASSERT(generatorKind != LegacyGenerator);
> >
> > + RootedScript maybeScript(cx, nullptr);
>
> Remove the ,nullptr.
Ok, but fair warning -- at some point, I'd like to add valgrind annotations to these to mark them as uninitialized if you don't pass in a value. (valgrind annotations instead of compiler annotations because I don't think the compiler will be able to figure out the common use patterns statically.) I suspect we have bugs where we use things that weren't set to a value. As long as we're force-initializing to InitialValue when you don't pass any arguments, those are safe, but I've seen enough funky error handling patterns to want as much automated checking on them as possible.

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1300642_359004)• 11 years ago |

Summary: Static hazard analysis misses does not detect a return value held live across a GC → Static hazard analysis does not detect a return value held live across a GC

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1382415_313730)• 11 years ago |

[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: review?(bobbyholley) → review+

|  | [Terrence Cole [:terrence]](/user_profile?user_id=231770) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1022773#c25)• 11 years ago |
|  | |

(In reply to Steve Fink [:sfink] from [comment #24](/show_bug.cgi?id=1022773#c24 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC"))
> (In reply to Terrence Cole [:terrence] from [comment #17](/show_bug.cgi?id=1022773#c17 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC"))
> > Comment on [attachment 8444834](/attachment.cgi?id=8444834 "Return value rooting for JS engine") [[details]](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") [[diff]](/attachment.cgi?id=8444834&action=diff "Return value rooting for JS engine") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834)
> > Return value rooting for JS engine
> >
> > Review of [attachment 8444834](/attachment.cgi?id=8444834 "Return value rooting for JS engine") [[details]](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") [[diff]](/attachment.cgi?id=8444834&action=diff "Return value rooting for JS engine") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834):
> > -----------------------------------------------------------------
> >
> > These are amazingly subtle.
> >
> > ::: js/src/jsfun.cpp
> > @@ +1541,5 @@
> > >
> > > bool isStarGenerator = generatorKind == StarGenerator;
> > > JS\_ASSERT(generatorKind != LegacyGenerator);
> > >
> > > + RootedScript maybeScript(cx, nullptr);
> >
> > Remove the ,nullptr.
>
> Ok, but fair warning -- at some point, I'd like to add valgrind annotations
> to these to mark them as uninitialized if you don't pass in a value.
> (valgrind annotations instead of compiler annotations because I don't think
> the compiler will be able to figure out the common use patterns statically.)
> I suspect we have bugs where we use things that weren't set to a value. As
> long as we're force-initializing to InitialValue when you don't pass any
> arguments, those are safe, but I've seen enough funky error handling
> patterns to want as much automated checking on them as possible.
Oh, neat!

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1022773#c26)• 11 years ago |
|  | |

Comment on [attachment 8444819](/attachment.cgi?id=8444819 "Resolve hazard by switching Compile to MutableHandle") [[details]](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") [[diff]](/attachment.cgi?id=8444819&action=diff "Resolve hazard by switching Compile to MutableHandle") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444819)
Resolve hazard by switching Compile to MutableHandle
[Security approval request comment]
> How easily could an exploit be constructed based on the patch?
Seems very hard but not impossible. You'd have to get GC triggered at just the right time, then somehow cause a new script to be created with a different security or something.
> Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
It mentions a "hazard" in the check-in comment, which describes the general sort of problem it addresses. But that's obvious from the patch too.
> Which older supported branches are affected by this flaw?
Exact rooting landed in 28.
> If not all supported branches, which bug introduced the flaw?
[bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting") made it relevant. Before then, conservative stack scanning would have rooted the pointer.
> Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
For the release branch, it's somewhat different, but I don't think we need to land there. It applied cleanly to beta, so I'm assuming it'll be easy everywhere else.
> How likely is this patch to cause regressions; how much testing does it need?
Pretty unlikely. The only thing I can think of is if I messed up somewhere in getting the script assigned to the right place, but that would immediately show up in tests.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")
User impact if declined: difficult to trigger, but a GC at the wrong time could collect a newborn script and something else might get put into that location and used. Basically, a use-after-free. With GGC, the problems are slightly more likely. But either way, it would probably crash somehow.
Testing completed (on m-c, etc.): try pushes
Risk to taking this patch (and alternatives if risky): low risk, it's just registering more pointers with the GC.
String or IDL/UUID changes made by this patch: none
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: sec-approval?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-beta?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-b2g30?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-b2g28?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-aurora?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1389024_75935)• 11 years ago |

[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=affected)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1022773#c27)• 11 years ago |
|  | |

Comment on [attachment 8444819](/attachment.cgi?id=8444819 "Resolve hazard by switching Compile to MutableHandle") [[details]](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") [[diff]](/attachment.cgi?id=8444819&action=diff "Resolve hazard by switching Compile to MutableHandle") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444819)
Resolve hazard by switching Compile to MutableHandle
sec-approval+ for trunk. Once it is green there, please land on Aurora and Beta branches.
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: sec-approval?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: sec-approval+
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-beta?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-beta+
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-aurora?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-aurora+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1022773#c28)• 11 years ago |
|  | |

Comment on [attachment 8444831](/attachment.cgi?id=8444831 "Return value rooting for content/") [[details]](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") [[diff]](/attachment.cgi?id=8444831&action=diff "Return value rooting for content/") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444831)
Return value rooting for content/
[Security approval request comment]
> How easily could an exploit be constructed based on the patch?
My best guess is "difficult". This is a use-after-free, but the timing is hard to control (you need a GC at a very weird time). And beta only has one problematic site; most of the problems were introduced later.
> Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
It's a rooting hazard. That can be figured out from the patch. The fact that it's a security problem (assuming it is?) is not obvious.
> Which older supported branches are affected by this flaw?
Hard to say. Beta doesn't have most of the problems, but it does have one instance. Conservatively, everything since 28 has it.
> If not all supported branches, which bug introduced the flaw?
[Bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting") made the flaw matter.
> Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
I have a backport for beta. I haven't made one for aurora yet. It'll be the mozilla-central patch with some pieces removed, for stuff that hadn't been added yet. The variation is low risk.
> How likely is this patch to cause regressions; how much testing does it need?
It's just adding some roots, so low risk for regressions. If it passes the test suite, it shouldn't break anything.
The higher risk is in missing hazards that existed in earlier versions but have since been removed. Once I have a full set of backports, I'll have to rerun the updated hazard analysis on each branch.
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting"), sort of
User impact if declined: rare crashes, maybe a high effort exploit
Testing completed: try server
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: none
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: sec-approval?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-beta?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g30?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g28?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-aurora?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1022773#c29)• 11 years ago |
|  | |

Attached patch

[Return value rooting for content/](attachment.cgi?id=8446153&action=diff)
— [Details](attachment.cgi?id=8446153&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8446153)

content/ patch for beta. Hardly anything left. I don't think this needs re-review; it's just deleting the irrelevant chunks from the m-c patch.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1405930_280903)• 11 years ago |

[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: sec-approval?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: sec-approval+
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-beta?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-beta+
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-aurora?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-aurora+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1022773#c30)• 11 years ago |
|  | |

Comment on [attachment 8444832](/attachment.cgi?id=8444832 "Return value rooting for dom/") [[details]](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") [[diff]](/attachment.cgi?id=8444832&action=diff "Return value rooting for dom/") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444832)
Return value rooting for dom/
[Approval Request Comment]
Bug caused by (feature/regressing bug #): exact rooting, [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")
User impact if declined: crashes, possibly exploitable
Testing completed: try server
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: none
[Security approval request comment]
Same as the other patches in this bug. I have all of the backports done. They are very minor variations. Almost everything is just removing fixes that weren't needed earlier.
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: sec-approval?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-beta?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-b2g30?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-b2g28?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-aurora?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1022773#c31)• 11 years ago |
|  | |

Comment on [attachment 8444833](/attachment.cgi?id=8444833 "Return value rooting for workers") [[details]](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") [[diff]](/attachment.cgi?id=8444833&action=diff "Return value rooting for workers") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444833)
Return value rooting for workers
[Approval Request Comment]
Bug caused by (feature/regressing bug #): exact rooting, [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")
User impact if declined: crashes, possibly exploitable
Testing completed: try server
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: none
[Security approval request comment]
Same as the other patches in this bug. I have all of the backports done. They are very minor variations. Almost everything is just removing fixes that weren't needed earlier.
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: sec-approval?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-beta?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-b2g30?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-b2g28?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-aurora?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1022773#c32)• 11 years ago |
|  | |

Comment on [attachment 8444834](/attachment.cgi?id=8444834 "Return value rooting for JS engine") [[details]](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") [[diff]](/attachment.cgi?id=8444834&action=diff "Return value rooting for JS engine") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444834)
Return value rooting for JS engine
[Approval Request Comment]
Bug caused by (feature/regressing bug #): exact rooting, [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")
User impact if declined: crashes, possibly exploitable
Testing completed: try server
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: none
[Security approval request comment]
Same as the other patches in this bug. I have all of the backports done. They are very minor variations. Almost everything is just removing fixes that weren't needed earlier.
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-beta?
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-b2g30?
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-b2g28?
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-aurora?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1022773#c33)• 11 years ago |
|  | |

Comment on [attachment 8444839](/attachment.cgi?id=8444839 "Return value rooting for XPConnect") [[details]](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") [[diff]](/attachment.cgi?id=8444839&action=diff "Return value rooting for XPConnect") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444839)
Return value rooting for XPConnect
[Approval Request Comment]
Bug caused by (feature/regressing bug #): exact rooting, [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")
User impact if declined: crashes, possibly exploitable
Testing completed: try server
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: none
[Security approval request comment]
Same as the other patches in this bug. I have all of the backports done. They are very minor variations. Almost everything is just removing fixes that weren't needed earlier.
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: sec-approval?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-beta?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-b2g30?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-b2g28?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-aurora?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1022773#c34)• 11 years ago |
|  | |

Comment on [attachment 8444841](/attachment.cgi?id=8444841 "Return value rooting for SPS") [[details]](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") [[diff]](/attachment.cgi?id=8444841&action=diff "Return value rooting for SPS") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8444841)
Return value rooting for SPS
[Approval Request Comment]
Bug caused by (feature/regressing bug #): exact rooting, [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")
User impact if declined: crashes, possibly exploitable
Testing completed: try server
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: none
[Security approval request comment]
Same as the other patches in this bug. I have all of the backports done. They are very minor variations. Almost everything is just removing fixes that weren't needed earlier.
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: sec-approval?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-beta?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-b2g30?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-b2g28?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-aurora?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1022773#c35)• 11 years ago |
|  | |

Comment on [attachment 8446153](/attachment.cgi?id=8446153 "Return value rooting for content/") [[details]](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") [[diff]](/attachment.cgi?id=8446153&action=diff "Return value rooting for content/") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8446153)
Return value rooting for content/
[Approval Request Comment]
Bug caused by (feature/regressing bug #): exact rooting, [bug 753203](/show_bug.cgi?id=753203 "RESOLVED FIXED - [meta] GC: Exact Stack Rooting")
User impact if declined: crashes, possibly exploitable
Testing completed: try server
Risk to taking this patch (and alternatives if risky): low
String or UUID changes made by this patch: none
[Security approval request comment]
Same as the other patches in this bug. I have all of the backports done. They are very minor variations. Almost everything is just removing fixes that weren't needed earlier.
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: sec-approval?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-beta?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g30?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g28?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-aurora?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1022773#c36)• 11 years ago |
|  | |

So many approvals.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1406469_280903)• 11 years ago |

[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: sec-approval?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: sec-approval+
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-beta?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-beta+
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-aurora?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1406498_280903)• 11 years ago |

[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: sec-approval?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: sec-approval+
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-beta?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-beta+
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-aurora?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1406508_280903)• 11 years ago |

[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-beta?
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-beta+
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-aurora?
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1406522_280903)• 11 years ago |

[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: sec-approval?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: sec-approval+
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-beta?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-beta+
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-aurora?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1406535_280903)• 11 years ago |

[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: sec-approval?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: sec-approval+
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-beta?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-beta+
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-aurora?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-aurora+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1406545_280903)• 11 years ago |

[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: sec-approval?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: sec-approval+
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-beta?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-beta+
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-aurora?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-aurora+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1022773#c37)• 11 years ago |
|  | |

Oh. Come to think of it, b2g doesn't need these unless it has exact rooting, which only landed in 32.
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1477918_359004)• 11 years ago |

[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-b2g30?
[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1477938_359004)• 11 years ago |

[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g30?
[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1477955_359004)• 11 years ago |

[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-b2g30?
[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1477981_359004)• 11 years ago |

[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-b2g30?
[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1478002_359004)• 11 years ago |

[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-b2g30?
[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1478016_359004)• 11 years ago |

[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-b2g30?
[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1478039_359004)• 11 years ago |

[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-b2g30?
[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1478054_359004)• 11 years ago |

[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g30?
[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: approval-mozilla-b2g28?

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1022773#c38)• 11 years ago |
|  | |

Attached patch

[Return value rooting for dom/](attachment.cgi?id=8447274&action=diff)
— [Details](attachment.cgi?id=8447274&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8447274)

dom/ patch for aurora

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1022773#c39)• 11 years ago |
|  | |

Attached patch

[AutoJSAPI initialization rooting](attachment.cgi?id=8447850&action=diff) (obsolete)
— [Details](attachment.cgi?id=8447850&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8447850)

While I've been flailing around trying to get this finished up, a few more rooting hazards have been introduced that are only detected with the analysis fixes. This is one. The hazard itself is simple -- AutoJSAPI::InitInternal holds aGlobal live across the AutoCxPusher constructor, which can GC. But the fix isn't completely straightforward because the cx used to root must be in a request already, and the request is currently only entered in the middle of the AutoCxPusher construction. So I've just added an additional request entry just for the rooting.
[Attachment #8447850](/attachment.cgi?id=8447850&action=edit "AutoJSAPI initialization rooting") -
Flags: review?(bobbyholley)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1022773#c40)• 11 years ago |
|  | |

Comment on [attachment 8447850](/attachment.cgi?id=8447850 "AutoJSAPI initialization rooting") [[details]](/attachment.cgi?id=8447850&action=edit "AutoJSAPI initialization rooting") [[diff]](/attachment.cgi?id=8447850&action=diff "AutoJSAPI initialization rooting") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8447850)
AutoJSAPI initialization rooting
Review of [attachment 8447850](/attachment.cgi?id=8447850 "AutoJSAPI initialization rooting") [[details]](/attachment.cgi?id=8447850&action=edit "AutoJSAPI initialization rooting") [[diff]](/attachment.cgi?id=8447850&action=diff "AutoJSAPI initialization rooting") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8447850):
-----------------------------------------------------------------
Talked with sfink about this on IRC. AutoCxPusher shouldn't GC, and we're going to make sure the analysis understands that.
[Attachment #8447850](/attachment.cgi?id=8447850&action=edit "AutoJSAPI initialization rooting") -
Flags: review?(bobbyholley) → review-

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1022773#c41)• 11 years ago |
|  | |

Attached patch

[Fix AutoJSAPI initialization rooting by annotating nsIScriptContext.GetWindowProxy](attachment.cgi?id=8448368&action=diff)
— [Details](attachment.cgi?id=8448368&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1022773&attachment=8448368)

[Attachment #8448368](/attachment.cgi?id=8448368&action=edit "Fix AutoJSAPI initialization rooting by annotating nsIScriptContext.GetWindowProxy") -
Flags: review?(bobbyholley)

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1836837_313730)• 11 years ago |

[Attachment #8448368](/attachment.cgi?id=8448368&action=edit "Fix AutoJSAPI initialization rooting by annotating nsIScriptContext.GetWindowProxy") -
Flags: review?(bobbyholley) → review+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909233_359004)• 11 years ago |

[Attachment #8447850](/attachment.cgi?id=8447850&action=edit "AutoJSAPI initialization rooting") -
Attachment is obsolete: true

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909348_359004)• 11 years ago |

[Attachment #8444634](/attachment.cgi?id=8444634&action=edit "Consider internal function names in analysis") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909352_359004)• 11 years ago |

[Attachment #8444639](/attachment.cgi?id=8444639&action=edit "Debugging helper setup for analyzeRoots.js") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909356_359004)• 11 years ago |

[Attachment #8444645](/attachment.cgi?id=8444645&action=edit "Ignore trivial |return nullptr;| statements that cross GC boundaries") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909360_359004)• 11 years ago |

[Attachment #8444651](/attachment.cgi?id=8444651&action=edit "hazard analysis output improvements") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909365_359004)• 11 years ago |

[Attachment #8444656](/attachment.cgi?id=8444656&action=edit "Include return values in analysis") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909369_359004)• 11 years ago |

[Attachment #8444819](/attachment.cgi?id=8444819&action=edit "Resolve hazard by switching Compile to MutableHandle") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909373_359004)• 11 years ago |

[Attachment #8444827](/attachment.cgi?id=8444827&action=edit "Switch all JS Compile functions to use MutableHandle") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909377_359004)• 11 years ago |

[Attachment #8444831](/attachment.cgi?id=8444831&action=edit "Return value rooting for content/") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909381_359004)• 11 years ago |

[Attachment #8444832](/attachment.cgi?id=8444832&action=edit "Return value rooting for dom/") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909386_359004)• 11 years ago |

[Attachment #8444833](/attachment.cgi?id=8444833&action=edit "Return value rooting for workers") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909390_359004)• 11 years ago |

[Attachment #8444834](/attachment.cgi?id=8444834&action=edit "Return value rooting for JS engine") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909394_359004)• 11 years ago |

[Attachment #8444839](/attachment.cgi?id=8444839&action=edit "Return value rooting for XPConnect") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909398_359004)• 11 years ago |

[Attachment #8444841](/attachment.cgi?id=8444841&action=edit "Return value rooting for SPS") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909403_359004)• 11 years ago |

[Attachment #8446153](/attachment.cgi?id=8446153&action=edit "Return value rooting for content/") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1909408_359004)• 11 years ago |

[Attachment #8447274](/attachment.cgi?id=8447274&action=edit "Return value rooting for dom/") -
Flags: checkin+

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1022773#c42)• 11 years ago |
|  | |

<http://hg.mozilla.org/integration/mozilla-inbound/rev/f8feedcca432>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/92065bea99d2>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/a76b54b14c7e>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/210a1a8bfe7d>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/965c8f8bce9a>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/3bff0ddf73b3>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/70eab71d392b>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/635b82606806>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/073ff2d2db9c>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/830b491a8fa3>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/d4bd5c2fdce2>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/5885dc571d0f>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/c01a6dcd4b22>
<http://hg.mozilla.org/integration/mozilla-inbound/rev/4ef6aeac24e1>

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1022773#c43)• 11 years ago |
|  | |

Backed out on Aurora for build bustage across the board apparently from a bad merge: <https://hg.mozilla.org/releases/mozilla-aurora/rev/ee727fe51f06>
<https://tbpl.mozilla.org/php/getParsedLog.php?id=42877395&tree=Mozilla-Aurora>Flags: needinfo?(sphink)

|  | [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1022773#c44)• 11 years ago |
|  | |

Aurora initial doomed landing:
<https://hg.mozilla.org/releases/mozilla-aurora/rev/5b44fa1cea34>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/60e8b99055e9>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/127429f7dd19>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/2505eb1fd336>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/9b5ade54f72a>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/cde190482d72>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/232abc366696>
Aurora backout:
<https://hg.mozilla.org/releases/mozilla-aurora/rev/ee727fe51f06>
Aurora re-landing:
<https://hg.mozilla.org/releases/mozilla-aurora/rev/ac90b02a034a>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/adec0f465782>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/87216353f2dc>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/17e442446904>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/07d419bd7fd0>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/97ef8ef6033f>
<https://hg.mozilla.org/releases/mozilla-aurora/rev/d0275ba5f438>
Beta landing:
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/f95da240e806>
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/0c9489046e05>
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/60476fb8c23a>
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/5ec5fca25325>
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/6f5f91a5dae3>
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/1dc6d67685a8>
remote: <https://hg.mozilla.org/releases/mozilla-beta/rev/0db64aa7af8d>

|  | [Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)](/user_profile?user_id=308534) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1022773#c45)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/4ef6aeac24e1>
<https://hg.mozilla.org/mozilla-central/rev/92065bea99d2>
<https://hg.mozilla.org/mozilla-central/rev/a76b54b14c7e>
<https://hg.mozilla.org/mozilla-central/rev/210a1a8bfe7d>
<https://hg.mozilla.org/mozilla-central/rev/965c8f8bce9a>
<https://hg.mozilla.org/mozilla-central/rev/3bff0ddf73b3>
<https://hg.mozilla.org/mozilla-central/rev/70eab71d392b>
<https://hg.mozilla.org/mozilla-central/rev/635b82606806>
<https://hg.mozilla.org/mozilla-central/rev/073ff2d2db9c>
<https://hg.mozilla.org/mozilla-central/rev/830b491a8fa3>
<https://hg.mozilla.org/mozilla-central/rev/d4bd5c2fdce2>
<https://hg.mozilla.org/mozilla-central/rev/5885dc571d0f>
<https://hg.mozilla.org/mozilla-central/rev/c01a6dcd4b22>
<https://hg.mozilla.org/mozilla-central/rev/4ef6aeac24e1>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla33

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a1925695_75935)• 11 years ago |

[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)Flags: needinfo?(sphink)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1022773#c46)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/14b7d2e3794a>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a2408104_20209)• 11 years ago |

Depends on: [1035092](/show_bug.cgi?id=1035092 "RESOLVED FIXED - bool functions shouldn't return nullptr")

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1022773#c47)• 11 years ago |
|  | |

Marking [qa-] for verification purposes based on [comment 26](/show_bug.cgi?id=1022773#c26 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC"). Feel free to add STR or other info if you feel you need QA to test this. Thank you.Whiteboard: [qa-]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a3047507_280903)• 11 years ago |

Whiteboard: [qa-] → [qa-][adv-main31+]

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a38842958_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1022773#a62747111_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1022773&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Steve Fink [:sfink] [:s:]](/user_profile?user_id=359004)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_1761241e_20250126_064138.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sat Jan 25 2025 22:41:37 PST

* **Bug ID:**
  990096,
  1013056,
  1034383,
  1035438,
  1002702,
  1020041,
  1020008,
  1009675,
  1021312,
  1020219,
  994444,
  1022773,
  1028358,
  1021969,
  1021240

---

15 bugs found.

| [ID](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [1021312](/show_bug.cgi?id=1021312 "RESOLVED FIXED - Zone Mismatch in CloneNonReflectors") |  | [Zone Mismatch in CloneNonReflectors](/show_bug.cgi?id=1021312) | Core | XPConnect | bholley | RESO | FIXE | 2016-02-16 |
| [1020008](/show_bug.cgi?id=1020008 "RESOLVED FIXED - Out-of-bounds read in gfxPlatform::GetPrefLangName") |  | [Out-of-bounds read in gfxPlatform::GetPrefLangName](/show_bug.cgi?id=1020008) | Core | Graphics: Text | jfkthame | RESO | FIXE | 2018-07-06 |
| [990096](/show_bug.cgi?id=990096 "RESOLVED FIXED - AddressSanitizer: global-buffer-overflow due to unhandled OOM [@ JSC::Yarr::digitsCreate()]") |  | [AddressSanitizer: global-buffer-overflow due to unhandled OOM [@ JSC::Yarr::digitsCreate()]](/show_bug.cgi?id=990096) | Core | JavaScript Engine | jorendorff | RESO | FIXE | 2020-02-28 |
| [1020219](/show_bug.cgi?id=1020219 "RESOLVED FIXED - Fix a bug that can cause DataSourceSurface buffers to be smaller than the DataSourceSurface expects them to be") |  | [Fix a bug that can cause DataSourceSurface buffers to be smaller than the DataSourceSurface expects them to be](/show_bug.cgi?id=1020219) | Core | Graphics | jwatt | RESO | FIXE | 2017-03-17 |
| [1034383](/show_bug.cgi?id=1034383 "RESOLVED FIXED - Assertion failure: hasScript(), at jsfun.h") |  | [Assertion failure: hasScript(), at jsfun.h](/show_bug.cgi?id=1034383) | Core | JavaScript Engine: J | nobody | RESO | FIXE | 2016-06-04 |
| [1022773](/show_bug.cgi?id=1022773 "RESOLVED FIXED - Static hazard analysis does not detect a return value held live across a GC") |  | [Static hazard analysis does not detect a return value held live across a GC](/show_bug.cgi?id=1022773) | Core | JavaScript: GC | sphink | RESO | FIXE | 2016-06-04 |
| [1028358](/show_bug.cgi?id=1028358 "RESOLVED FIXED - We are not firing any post-barriers on Heap<T> for JSFunction*") |  | [We are not firing any post-barriers on Heap<T> for JSFunction\*](/show_bug.cgi?id=1028358) | Core | JavaScript: GC | terrence.d.cole | RESO | FIXE | 2016-06-04 |
| [1002702](/show_bug.cgi?id=1002702 "VERIFIED FIXED - \"Assertion failure: !mWorkerPrivate\" with port.close(), GC") |  | ["Assertion failure: !mWorkerPrivate" with port.close(), GC](/show_bug.cgi?id=1002702) | Core | DOM: Workers | amarchesini | VERI | FIXE | 2016-06-04 |
| [1020041](/show_bug.cgi?id=1020041 "VERIFIED FIXED - nsStandardURL::SetHost called net_ToLowerCase with a bogus pointer, #3") |  | [nsStandardURL::SetHost called net\_ToLowerCase with a bogus pointer, #3](/show_bug.cgi?id=1020041) | Core | Networking | amarchesini | VERI | FIXE | 2016-06-04 |
| [1009675](/show_bug.cgi?id=1009675 "VERIFIED FIXED - Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext*, JS::Handle<JS::Value>]") |  | [Crash when commenting on github.com [@ mozilla::dom::WrapperPromiseCallback::Call(JSContext\*, JS::Handle<JS::Value>]](/show_bug.cgi?id=1009675) | Core | DOM: Core & HTML | bzbarsky | VERI | FIXE | 2019-03-13 |
| [1021969](/show_bug.cgi?id=1021969 "VERIFIED FIXED - mozMediaStatisticsShowing property shouldn't be content-exposed") |  | [mozMediaStatisticsShowing property shouldn't be content-exposed](/show_bug.cgi?id=1021969) | Toolkit | Video/Audio Controls | gijskruitbosch+bugs | VERI | FIXE | 2016-06-04 |
| [1035438](/show_bug.cgi?id=1035438 "VERIFIED FIXED - AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack") |  | [AddressSanitizer: stack-buffer-overflow with gfxUserFontSet::OTSMessage on the stack](/show_bug.cgi?id=1035438) | Core | Graphics: Text | jfkthame | VERI | FIXE | 2020-02-28 |
| [1013056](/show_bug.cgi?id=1013056 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar") |  | [Crash at a weird memory address involving RegExp and filterPar](/show_bug.cgi?id=1013056) | Core | JavaScript Engine | marty.rosenberg | VERI | FIXE | 2016-06-04 |
| [994444](/show_bug.cgi?id=994444 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout") |  | [Fix !resumeAfter for JSOP\_LOOPENTRY in Ion-to-Baseline bailout](/show_bug.cgi?id=994444) | Core | JavaScript Engine: J | shu | VERI | FIXE | 2016-06-04 |
| [1021240](/show_bug.cgi?id=1021240 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox") |  | [Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox](/show_bug.cgi?id=1021240) | Core | DOM: Core & HTML | smichaud | VERI | FIXE | 2019-03-13 |

15 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=990096%2C1013056%2C1034383%2C1035438%2C1002702%2C1020041%2C1020008%2C1009675%2C1021312%2C1020219%2C994444%2C1022773%2C1028358%2C1021969%2C1021240&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |



=== Content from secunia.com_32cbda55_20250125_062747.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from blog.mozilla.org_a1905f2a_20250126_064137.html ===

[Skip to content](#content)

[Mozilla](https://blog.mozilla.org/en/)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

* [Internet Culture](https://blog.mozilla.org/en/category/internet-culture/)
  + [Deep Dives](https://blog.mozilla.org/en/category/internet-culture/deep-dives/)
  + [Mozilla Explains](https://blog.mozilla.org/en/category/internet-culture/mozilla-explains/)
  + [Interviews](https://blog.mozilla.org/en/category/internet-culture/interviews/)
  + [Videos](https://blog.mozilla.org/en/category/videos/)
* [Privacy & Security](https://blog.mozilla.org/en/category/privacy-security/)
* [Products](https://blog.mozilla.org/en/category/products/)
  + [Firefox](https://blog.mozilla.org/en/category/products/firefox/)
  + [Pocket](https://blog.mozilla.org/en/category/products/pocket/)
  + [Mozilla VPN](https://blog.mozilla.org/en/category/products/mozilla-vpn/)
* [Mozilla](https://blog.mozilla.org/en/category/mozilla/)
  + [News](https://blog.mozilla.org/en/category/mozilla/news/)
  + [Internet Policy](https://blog.mozilla.org/en/category/mozilla/internet-policy/)
  + [Leadership](https://blog.mozilla.org/en/category/mozilla/leadership/)
    - [Mitchell Baker, CEO](https://blog.mozilla.org/en/author/mitchellmozillacom/)
    - [Mark Surman, ED Foundation](https://blog.mozilla.org/en/author/markmozillafoundation-org/)
    - [Eric Rescorla, Firefox CTO](https://blog.mozilla.org/en/author/ekrmozilla-com/)

[Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_medium=referral&utm_campaign=blog-nav)

![search](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/icons/search.svg)

#### Search

Search for:

![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2019/01/mozilla-logo-bw-rgb.png)
## News

Official announcements and press releases

[![Room filled with people listening to a speaker on stage. Demo Day visual image in the background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/Demo_Day_Blog_Header_-1-800x800.jpg)
Mozilla
## Mozilla Builders: Celebrating community-driven innovation in AI

Read More](https://blog.mozilla.org/en/mozilla/mozilla-builders-demo-day/)

[![The Mozilla logo in green on a black background](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/12/logo-lockup-video-poster-800x800.png)
Mozilla
## Mozilla welcomes new executive team members

Read More](https://blog.mozilla.org/en/mozilla/new-executives/)

[![Decorative image of wrapped gifts in front of an iphone](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/11/moz_header_holiday_firefox-phone-gifts_blue-03.png-800x800.png)
Products
## Shopping for everyone? We’ve got you covered with the Fakespot Holiday Gift Guide 2024

Read More](https://blog.mozilla.org/en/products/shopping-for-everyone-weve-got-you-covered-with-the-fakespot-holiday-gift-guide-2024/)

[![Text: Mozilla Builders](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/Blog-16_9-1920x1080-1-800x800.png)
Mozilla
## 14 AI projects to watch: Mozilla’s first Builders Accelerator cohort kicks off

Read More](https://blog.mozilla.org/en/mozilla/14-ai-projects-to-watch-mozillas-first-builders-accelerator-cohort-kicks-off/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot’s guide to trending back-to-school products

Read More](https://blog.mozilla.org/en/mozilla/news/fakespots-guide-to-trending-back-to-school-products/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## BAFTA Award-Winner Siobhán McSweeney to host Mozilla’s 2nd Annual Rise25 Awards in Dublin, Ireland on Aug. 13

Read More](https://blog.mozilla.org/en/mozilla/bafta-award-winner-siobhan-mcsweeney-to-host-mozillas-2nd-annual-rise25-awards-in-dublin-ireland-on-august-13/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/05/fx_website_meta-image_tips-tricks_alt-04-1-800x800.webp)
Mozilla
## Here’s what we’re working on in Firefox

Read More](https://blog.mozilla.org/en/mozilla/heres-what-were-working-on-in-firefox/)

[![A check mark next to the text "Fakespot."](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2023/07/Fakespot_ProductBlog-2-800x800.jpg)
News
## Fakespot reveals the product categories with the most and least reliable product reviews

Read More](https://blog.mozilla.org/en/mozilla/news/fakespot-reveals-the-product-categories-with-the-most-and-least-reliable-product-reviews-for-summer-and-back-to-school-shopping/)

[![A dark blue speech bubble with horizontal purple and red bars on a pink background.](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2020/03/fx_blog_header_announcements_001_1920x1080-800x800.jpg)
Firefox
## Engaging with our Firefox community: Highlights from our recent AMA

Read More](https://blog.mozilla.org/en/products/firefox/engaging-with-our-firefox-community-highlights-from-our-recent-ama/)

[![](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/IG_Highlights_Icon-800x800.png)
Mozilla
## Mozilla announces finalists for the 2nd annual Rise25 Awards

Read More](https://blog.mozilla.org/en/mozilla/mozilla-announces-finalists-for-the-2nd-annual-rise25-awards/)

[![Mozilla and Anonym logos](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/blog_1200x800_v2-800x800.png)
Mozilla
## Introducing Anonym: Raising the bar for privacy-preserving digital advertising

Read More](https://blog.mozilla.org/en/mozilla/mozilla-anonym-raising-the-bar-for-privacy-preserving-digital-advertising/)

[![logo - zero with a diagonal line through it, and the letters D, I, N](https://blog.mozilla.org/wp-content/blogs.dir/278/files/2024/06/odintbanner-500x500.png)
Mozilla
## Keeping GenAI technologies secure is a shared responsibility

Read More](https://blog.mozilla.org/en/mozilla/keeping-genai-technologies-secure-is-a-shared-responsibility/)

1
[2](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[3](https://blog.mozilla.org/en/category/mozilla/news/page/3?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
…
[24](https://blog.mozilla.org/en/category/mozilla/news/page/24?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)
[next](https://blog.mozilla.org/en/category/mozilla/news/page/2?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=compa)

![newsletter](https://blog.mozilla.org/wp-content/themes/foxtail/assets/images/newsletter.png)

### Keep up with all things Firefox

Get how-tos, advice and news to make your Firefox experience work best for you.

Your e-mail address

Country
- select -
Afghanistan
Akrotiri
Albania
Algeria
American Samoa
Andorra
Angola
Anguilla
Antarctica
Antigua and Barbuda
Argentina
Armenia
Aruba
Ashmore and Cartier Islands
Australia
Austria
Azerbaijan
Bahamas, The
Bahrain
Baker Island
Bangladesh
Barbados
Bassas da India
Belarus
Belgium
Belize
Benin
Bermuda
Bhutan
Bolivia
Bonaire, Sint Eustatius, and Saba
Bosnia and Herzegovina
Botswana
Bouvet Island
Brazil
British Indian Ocean Territory
Brunei
Bulgaria
Burkina Faso
Burma
Burundi
Cabo Verde
Cambodia
Cameroon
Canada
Cayman Islands
Central African Republic
Chad
Chile
China
Christmas Island
Clipperton Island
Cocos (Keeling) Islands
Colombia
Comoros
Congo (Brazzaville)
Congo (Kinshasa)
Cook Islands
Coral Sea Islands
Costa Rica
Croatia
Cuba
Curaçao
Cyprus
Czech Republic
Côte d’Ivoire
Denmark
Dhekelia
Diego Garcia
Djibouti
Dominica
Dominican Republic
Ecuador
Egypt
El Salvador
Equatorial Guinea
Eritrea
Estonia
Ethiopia
Europa Island
Falkland Islands (Islas Malvinas)
Faroe Islands
Fiji
Finland
France
French Guiana
French Polynesia
French Southern and Antarctic Lands
Gabon
Gambia, The
Gaza Strip
Georgia
Germany
Ghana
Gibraltar
Glorioso Islands
Greece
Greenland
Grenada
Guadeloupe
Guam
Guatemala
Guernsey
Guinea
Guinea-Bissau
Guyana
Haiti
Heard Island and McDonald Islands
Honduras
Hong Kong
Howland Island
Hungary
Iceland
India
Indonesia
Iran
Iraq
Ireland
Isle of Man
Israel
Italy
Jamaica
Jan Mayen
Japan
Jarvis Island
Jersey
Johnston Atoll
Jordan
Juan de Nova Island
Kazakhstan
Kenya
Kingman Reef
Kiribati
Korea, North
Korea, South
Kosovo
Kuwait
Kyrgyzstan
Laos
Latvia
Lebanon
Lesotho
Liberia
Libya
Liechtenstein
Lithuania
Luxembourg
Macau
Macedonia
Madagascar
Malawi
Malaysia
Maldives
Mali
Malta
Marshall Islands
Martinique
Mauritania
Mauritius
Mayotte
Mexico
Micronesia, Federated States of
Midway Islands
Moldova
Monaco
Mongolia
Montenegro
Montserrat
Morocco
Mozambique
Namibia
Nauru
Navassa Island
Nepal
Netherlands
New Caledonia
New Zealand
Nicaragua
Niger
Nigeria
Niue
Norfolk Island
Northern Mariana Islands
Norway
Oman
Pakistan
Palau
Palmyra Atoll
Panama
Papua New Guinea
Paracel Islands
Paraguay
Peru
Philippines
Pitcairn Islands
Poland
Portugal
Puerto Rico
Qatar
Reunion
Romania
Russia
Rwanda
Saint Barthelemy
Saint Helena, Ascension, and Tristan da Cunha
Saint Kitts and Nevis
Saint Lucia
Saint Martin
Saint Pierre and Miquelon
Saint Vincent and the Grenadines
Samoa
San Marino
Sao Tome and Principe
Saudi Arabia
Senegal
Serbia
Seychelles
Sierra Leone
Singapore
Sint Maarten
Slovakia
Slovenia
Solomon Islands
Somalia
South Africa
South Georgia and South Sandwich Islands
South Sudan
Spain
Spratly Islands
Sri Lanka
Sudan
Suriname
Svalbard
Swaziland
Sweden
Switzerland
Syria
Taiwan
Tajikistan
Tanzania
Thailand
Timor-Leste
Togo
Tokelau
Tonga
Trinidad and Tobago
Tromelin Island
Tunisia
Turkey
Turkmenistan
Turks and Caicos Islands
Tuvalu
Uganda
Ukraine
United Arab Emirates
United Kingdom
United States
Uruguay
Uzbekistan
Vanuatu
Vatican City
Venezuela
Vietnam
Virgin Islands, British
Virgin Islands, U.S.
Wake Island
Wallis and Futuna
West Bank
Western Sahara
Yemen
Zambia
Zimbabwe

Language
English
Bahasa Indonesia
Deutsch
Español
Français
Polski
Português
Русский
正體中文

Format

 HTML

 Text

I’m okay with Mozilla handling my info as explained in this [Privacy Policy](https://www.mozilla.org/privacy/).

Sign up now
We will only send you
Mozilla-related information.

## Thanks!

If you haven’t previously confirmed a subscription to a Mozilla-related newsletter you may have to do so. Please check your inbox or your spam filter for an e-mail from us.

[Mozilla](https://www.mozilla.org/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Mozilla

* [About](https://www.mozilla.org/about/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Contact Us](https://www.mozilla.org/contact/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Donate](https://donate.mozilla.org/?presets=50,30,20,10&amount=30¤cy=usd&utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Firefox

* [Download Firefox](https://www.mozilla.org/firefox/new/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Desktop](https://www.mozilla.org/firefox/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Mobile](https://www.mozilla.org/firefox/mobile/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Features](https://www.mozilla.org/firefox/features/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Beta, Nightly, Developer Edition](https://www.mozilla.org/firefox/channel/desktop/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Resources

* [Privacy Hub](https://www.mozilla.org/privacy/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Browser Comparison](https://www.mozilla.org/firefox/browsers/compare/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Brand Standards](https://mozilla.design/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)

##### Social

Follow @Firefox

* [Twitter (@mozilla)](https://twitter.com/firefox)
* [Instagram (@mozilla)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)

Follow @Mozilla

* [Twitter (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)

* [Website Privacy Notice](https://www.mozilla.org/privacy/websites/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)
* [Legal](https://www.mozilla.org/about/legal/?utm_source=blog.mozilla.org&utm_campaign=footer&utm_medium=referral)



=== Content from bugzilla.mozilla.org_3c1aa81f_20250125_062814.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/994444)
* [XML](/show_bug.cgi?ctype=xml&id=994444)

Closed
[Bug 994444](/show_bug.cgi?id=994444)

Opened 11 years ago
Closed 11 years ago

# Fix !resumeAfter for JSOP\_LOOPENTRY in Ion-to-Baseline bailout

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Fix !resumeAfter for JSOP\_LOOPENTRY in Ion-to-Baseline bailout

## Categories

### (Core :: JavaScript Engine: JIT, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT#JavaScript%20Engine%3A%20JIT)

JavaScript Engine: JIT
▾

Core :: JavaScript Engine: JIT
JavaScript engine's JIT compilers
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla31

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox28 | [-](/buglist.cgi?f1=cf_tracking_firefox28&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox28&o1=equals&v1=wontfix) |
| firefox29 | [-](/buglist.cgi?f1=cf_tracking_firefox29&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=wontfix) |
| firefox30 | [-](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | [-](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=-) | [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified) |
| firefox-esr24 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix) |
| b2g18 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected) |
| b2g-v1.1hd | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=unaffected) |
| b2g-v1.2 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=wontfix) |
| b2g-v1.3 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=wontfix) |
| b2g-v1.3T | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=wontfix) |
| b2g-v1.4 | --- | [wontfix](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=wontfix) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox28 | - | wontfix |
| firefox29 | - | wontfix |
| firefox30 | - | wontfix |
| firefox31 | - | verified |
| firefox-esr24 | - | wontfix |
| b2g18 |  | unaffected |
| b2g-v1.1hd |  | unaffected |
| b2g-v1.2 |  | wontfix |
| b2g-v1.3 |  | wontfix |
| b2g-v1.3T |  | wontfix |
| b2g-v1.4 |  | wontfix |
| b2g-v2.0 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: shu, Assigned: shu)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/3d32950049beb9cc36bee9899d54f28d?d=mm&size=40)  [shu](/user_profile?user_id=381259)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/3d32950049beb9cc36bee9899d54f28d?d=mm&size=40)  [shu](/user_profile?user_id=381259)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-dos, sec-low, Whiteboard: [adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [cbook](/user_profile?user_id=277293) | [in-testsuite](#c21 "11 years ago") | ? |
| --- | --- | --- |
| [cbook](/user_profile?user_id=277293) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [0001-Fix-resumeAfter-case-in-baseline-bailout.patch](/attachment.cgi?id=8404381)  [11 years ago](#c1)  [Shu-yu Guo [:shu]](/user_profile?user_id=381259)   3.21 KB, patch | nbp : [review+](#c4 "11 years ago") | [Details](/attachment.cgi?id=8404381&action=edit) | [Diff](/attachment.cgi?id=8404381&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404381) |
| --- | --- | --- |
| [fix](/attachment.cgi?id=8404906)  [11 years ago](#c9)  [Shu-yu Guo [:shu]](/user_profile?user_id=381259)   3.20 KB, patch | shu : [review+](#c10 "11 years ago")  Sylvestre : [approval-mozilla-aurora-](#c18 "11 years ago")  Sylvestre : [approval-mozilla-beta-](#c18 "11 years ago")  Sylvestre : [approval-mozilla-release-](#c18 "11 years ago")  Sylvestre : [approval-mozilla-esr24-](#c18 "11 years ago") | [Details](/attachment.cgi?id=8404906&action=edit) | [Diff](/attachment.cgi?id=8404906&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=994444#c0)• 11 years ago |
|  | |

We try to find the next non-LOOPENTRY/NOP/LOOPHEAD/GOTO pc when bailing out on a !resumeAfter loopentry. If the loop body is empty, we get caught in an infinite loop.

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=994444#c1)• 11 years ago |
|  | |

Attached patch

[0001-Fix-resumeAfter-case-in-baseline-bailout.patch](attachment.cgi?id=8404381&action=diff) (obsolete)
— [Details](attachment.cgi?id=8404381&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404381)

We need to do the general cycle detection instead of just pattern matching on empty loops because we can nest them:
js> dis(function() { for(;;) for(;;); })
flags: LAMBDA
loc op
----- --
main:
00000: nop
00001: loophead
00002: loopentry 129
00004: nop
00005: loophead
00006: loopentry 130
00008: goto 5 (-3)
00013: goto 1 (-12)
00018: retrvalAssignee: nobody → shuStatus: NEW → ASSIGNED
[Attachment #8404381](/attachment.cgi?id=8404381&action=edit "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") -
Flags: review?(kvijayan)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=994444#c2)• 11 years ago |
|  | |

Oops, the comment should read "Cycles can cause ..."

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=994444#c3)• 11 years ago |
|  | |

Also, the test should be run with --ion-parallel-compile=off --ion-eager

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a35460_422187)• 11 years ago |

Group: core-security, javascript-core-security

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=994444#c4)• 11 years ago |
|  | |

Comment on [attachment 8404381](/attachment.cgi?id=8404381 "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") [[details]](/attachment.cgi?id=8404381&action=edit "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") [[diff]](/attachment.cgi?id=8404381&action=diff "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404381)
0001-Fix-resumeAfter-case-in-baseline-bailout.patch
Review of [attachment 8404381](/attachment.cgi?id=8404381 "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") [[details]](/attachment.cgi?id=8404381&action=edit "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") [[diff]](/attachment.cgi?id=8404381&action=diff "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404381):
-----------------------------------------------------------------
This patch needs to be backported to all versions where Ion is enabled by default, which basically means everything except b2g18 and b2g1.1.
::: js/src/jit/BaselineBailouts.cpp
@@ +792,5 @@
> size\_t endOfBaselineJSFrameStack = builder.framePushed();
>
> // If we are resuming at a LOOPENTRY op, resume at the next op to avoid
> // a bailout -> enter Ion -> bailout loop with --ion-eager. See also
> // ThunkToInterpreter.
Kannan, would we still have this issue with Baseline?
Do we still need this hack that I added back in the day of ThunkToInterpreter?
@@ +809,5 @@
> + // Advance the pc.
> + jsbytecode \*oldPc = pc;
> + pc = GetNextNonLoopEntryPc(pc);
> + if (oldPc == pc)
> + break;
This condition is not needed, as the following condition will catch this case if this is a cycle of 1 instruction.
@@ +815,5 @@
> + // Advance fasterPc twice as fast.
> + fasterPc = GetNextNonLoopEntryPc(GetNextNonLoopEntryPc(fasterPc));
> +
> + // Break on cycles.
> + if (fasterPc == pc)
nit: This is either breaking on cycles or at the end of the goto sequence.
[Attachment #8404381](/attachment.cgi?id=8404381&action=edit "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") -
Flags: review+

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=994444#c5)• 11 years ago |
|  | |

This issue can cause a DOS of Firefox if such malicious code is executed. The interruption callback is not even honored (no slow script dialog), which means that there is no way to get back to the main thread.
[status-b2g18](/buglist.cgi?f1=cf_status_b2g18&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g18&o1=equals&v1=unaffected)
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=affected)
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected)
[status-firefox28](/buglist.cgi?f1=cf_status_firefox28&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox28&o1=equals&v1=affected)
[status-firefox29](/buglist.cgi?f1=cf_status_firefox29&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=affected)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=affected)
[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F)
[tracking-b2g-v1.2](/buglist.cgi?f1=cf_tracking_b2g_v1_2&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g_v1_2&o1=equals&v1=%3F)
[tracking-b2g-v1.3](/buglist.cgi?f1=cf_tracking_b2g_v1_3&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_b2g_v1_3&o1=equals&v1=%3F)
[tracking-firefox28](/buglist.cgi?f1=cf_tracking_firefox28&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox28&o1=equals&v1=%3F)
[tracking-firefox29](/buglist.cgi?f1=cf_tracking_firefox29&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox29&o1=equals&v1=%3F)
[tracking-firefox30](/buglist.cgi?f1=cf_tracking_firefox30&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%3F)
[tracking-firefox31](/buglist.cgi?f1=cf_tracking_firefox31&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%3F)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%3F)

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a47159_11608)• 11 years ago |

Keywords: [csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---)

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=994444#c7)• 11 years ago |
|  | |

Not sure why I didn't catch this. My DOM fuzzer doesn't \*intentionally\* create infinite loops, but that usually doesn't stop it from finding such simple bugs.

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a54377_495955)• 11 years ago |

[status-firefox28](/buglist.cgi?f1=cf_status_firefox28&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox28&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox28&o1=equals&v1=wontfix)
[tracking-firefox28](/buglist.cgi?f1=cf_tracking_firefox28&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox28&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox28&o1=equals&v1=-)
[tracking-firefox29](/buglist.cgi?f1=cf_tracking_firefox29&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox29&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox29&o1=equals&v1=%2B)
[tracking-firefox30](/buglist.cgi?f1=cf_tracking_firefox30&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%2B)
[tracking-firefox31](/buglist.cgi?f1=cf_tracking_firefox31&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%2B)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%2B)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=994444#c8)• 11 years ago |
|  | |

(In reply to Jesse Ruderman from [comment #7](/show_bug.cgi?id=994444#c7 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout"))
> Not sure why I didn't catch this. My DOM fuzzer doesn't \*intentionally\*
> create infinite loops, but that usually doesn't stop it from finding such
> simple bugs.
The loops have to be infinite \*and\* have an empty body.

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=994444#c9)• 11 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=8404906&action=diff)
— [Details](attachment.cgi?id=8404906&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906)

Addressed review comments.

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=994444#c10)• 11 years ago |
|  | |

Comment on [attachment 8404906](/attachment.cgi?id=8404906 "fix") [[details]](/attachment.cgi?id=8404906&action=edit "fix") [[diff]](/attachment.cgi?id=8404906&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906)
fix
Review of [attachment 8404906](/attachment.cgi?id=8404906 "fix") [[details]](/attachment.cgi?id=8404906&action=edit "fix") [[diff]](/attachment.cgi?id=8404906&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906):
-----------------------------------------------------------------
Carrying r=nbp
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: review+

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a63071_381259)• 11 years ago |

[Attachment #8404381](/attachment.cgi?id=8404381&action=edit "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") -
Attachment is obsolete: true
[Attachment #8404381](/attachment.cgi?id=8404381&action=edit "0001-Fix-resumeAfter-case-in-baseline-bailout.patch") -
Flags: review?(kvijayan)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=994444#c11)• 11 years ago |
|  | |

Comment on [attachment 8404906](/attachment.cgi?id=8404906 "fix") [[details]](/attachment.cgi?id=8404906&action=edit "fix") [[diff]](/attachment.cgi?id=8404906&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906)
fix
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
A DOS patch can be constructed pretty easily.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Comments and tests give you a DOS exploit, yes. The test can be removed, but I feel the comment is important for posterity.
Which older supported branches are affected by this flaw?
See tracking flags.
If not all supported branches, which bug introduced the flaw?
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
I don't, but patch is small and probably applies cleanly.
How likely is this patch to cause regressions; how much testing does it need?
Unlikely to cause regressions.
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: sec-approval?

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=994444#c12)• 11 years ago |
|  | |

Comment on [attachment 8404906](/attachment.cgi?id=8404906 "fix") [[details]](/attachment.cgi?id=8404906&action=edit "fix") [[diff]](/attachment.cgi?id=8404906&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906)
fix
[Approval Request Comment]
Bug caused by (feature/regressing bug #): [Bug 848679](/show_bug.cgi?id=848679 "RESOLVED FIXED - BaselineCompiler: Sync Ion and Baseline's treatment of where loops begin")
User impact if declined: Possible DOS attacks
Testing completed (on m-c, etc.): None yet, waiting on sec-approval
Risk to taking this patch (and alternatives if risky): None
String or IDL/UUID changes made by this patch: None
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-release?
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-esr24?
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-aurora?

|  | [Nicolas B. Pierron [:nbp]](/user_profile?user_id=422187) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=994444#c13)• 11 years ago |
|  | |

(In reply to Shu-yu Guo [:shu] from [comment #11](/show_bug.cgi?id=994444#c11 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout"))
> [Security approval request comment]
> Do comments in the patch, the check-in comment, or tests included in the
> patch paint a bulls-eye on the security problem?
>
> Comments and tests give you a DOS exploit, yes. The test can be removed, but
> I feel the comment is important for posterity.
I think we can remove the comment as well as the test case from the original patch and land both the comment and the test case later. If you still want some comment for posterity, we can replace it by
// See [Bug 994444](/show_bug.cgi?id=994444 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout") for a better comment.

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=994444#c14)• 11 years ago |
|  | |

(In reply to Nicolas B. Pierron [:nbp] from [comment #13](/show_bug.cgi?id=994444#c13 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout"))
> (In reply to Shu-yu Guo [:shu] from [comment #11](/show_bug.cgi?id=994444#c11 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout"))
> > [Security approval request comment]
> > Do comments in the patch, the check-in comment, or tests included in the
> > patch paint a bulls-eye on the security problem?
> >
> > Comments and tests give you a DOS exploit, yes. The test can be removed, but
> > I feel the comment is important for posterity.
>
> I think we can remove the comment as well as the test case from the original
> patch and land both the comment and the test case later. If you still want
> some comment for posterity, we can replace it by
>
> // See [Bug 994444](/show_bug.cgi?id=994444 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout") for a better comment.
Okay, I'll remove the test and comment and replace with a ref to this bug.

|  | [Kannan Vijayan [:djvj]](/user_profile?user_id=436087) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=994444#c15)• 11 years ago |
|  | |

(In reply to Nicolas B. Pierron [:nbp] from [comment #4](/show_bug.cgi?id=994444#c4 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout"))
> Kannan, would we still have this issue with Baseline?
> Do we still need this hack that I added back in the day of
> ThunkToInterpreter?
Yes, I'm reasonably sure we do still need this.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=994444#c16)• 11 years ago |
|  | |

This seems like a sec-low. Is there a reason that this DOS is higher than sec-low? If not, I'll clear the sec-approval? as you don't need approval to check in a low. That said, we're unlikely to take it on ESR24 or branches if it is low as well. It would ride the trains.

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=994444#c17)• 11 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #16](/show_bug.cgi?id=994444#c16 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout"))
> This seems like a sec-low. Is there a reason that this DOS is higher than
> sec-low? If not, I'll clear the sec-approval? as you don't need approval to
> check in a low. That said, we're unlikely to take it on ESR24 or branches if
> it is low as well. It would ride the trains.
I didn't close it, but I agree more or less. In fact, I left the bug open in the beginning. Aren't there a million ways to DOS the browser already?

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=994444#c18)• 11 years ago |
|  | |

Comment on [attachment 8404906](/attachment.cgi?id=8404906 "fix") [[details]](/attachment.cgi?id=8404906&action=edit "fix") [[diff]](/attachment.cgi?id=8404906&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906)
fix
Taking in account Al [comment #16](/show_bug.cgi?id=994444#c16 "VERIFIED FIXED - Fix !resumeAfter for JSOP_LOOPENTRY in Ion-to-Baseline bailout"), we are going to let the patch ride the train.
FYI, We no longer accept "None" as a risk evaluation.
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-release?
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-release-
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-esr24?
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-esr24-
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-beta?
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-beta-
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-aurora?
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: approval-mozilla-aurora-

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=994444#c19)• 11 years ago |
|  | |

Comment on [attachment 8404906](/attachment.cgi?id=8404906 "fix") [[details]](/attachment.cgi?id=8404906&action=edit "fix") [[diff]](/attachment.cgi?id=8404906&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=994444&attachment=8404906)
fix
Clearing sec-approval?. You can check this into trunk whenever you want.
[Attachment #8404906](/attachment.cgi?id=8404906&action=edit "fix") -
Flags: sec-approval?

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a367165_495955)• 11 years ago |

[tracking-firefox29](/buglist.cgi?f1=cf_tracking_firefox29&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox29&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox29&o1=equals&v1=-)
[tracking-firefox30](/buglist.cgi?f1=cf_tracking_firefox30&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox30&o1=equals&v1=-)
[tracking-firefox31](/buglist.cgi?f1=cf_tracking_firefox31&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox31&o1=equals&v1=-)
[tracking-firefox-esr24](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr24&o1=equals&v1=-)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=994444#c20)• 11 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/a71e790f9652>

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=994444#c21)• 11 years ago |
|  | |

landed on central <https://hg.mozilla.org/mozilla-central/rev/a71e790f9652>Status: ASSIGNED → RESOLVEDClosed: 11 years ago
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla31

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a487660_75935)• 11 years ago |

[status-b2g-v1.1hd](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_1_hd&o1=equals&v1=unaffected)
[status-b2g-v1.2](/buglist.cgi?f1=cf_status_b2g_1_2&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_2&o1=equals&v1=wontfix)
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=wontfix)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=wontfix)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=wontfix)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-firefox29](/buglist.cgi?f1=cf_status_firefox29&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox29&o1=equals&v1=wontfix)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix)
[tracking-b2g18](/buglist.cgi?f1=cf_tracking_b2g18&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g18&o1=equals&v1=%3F) → ---
[tracking-b2g-v1.2](/buglist.cgi?f1=cf_tracking_b2g_v1_2&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g_v1_2&o1=equals&v1=%3F) → ---
[tracking-b2g-v1.3](/buglist.cgi?f1=cf_tracking_b2g_v1_3&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_b2g_v1_3&o1=equals&v1=%3F) → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a1612007_1689)• 11 years ago |

Group: javascript-core-security

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a8287222_280903)• 11 years ago |

Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)Whiteboard: [adv-main31+]

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=994444#c22)• 11 years ago |
|  | |

Confirmed DoS on Fx31 from 2014-04-08.
Verified fixed on Fx31 from 2014-04-16.Status: RESOLVED → VERIFIED
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a44082756_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=994444#a67985247_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=994444&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Shu-yu Guo [:shu]](/user_profile?user_id=381259)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_de139b5f_20250125_062756.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1013056)
* [XML](/show_bug.cgi?ctype=xml&id=1013056)

Closed
[Bug 1013056](/show_bug.cgi?id=1013056)

Opened 11 years ago
Closed 11 years ago

# Crash at a weird memory address involving RegExp and filterPar

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash at a weird memory address involving RegExp and filterPar

## Categories

### (Core :: JavaScript Engine, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

ARM

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix) |
| firefox31 | --- | [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified) |
| firefox32 | --- | [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified) |
| firefox33 | --- | [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed) |
| b2g-v1.3T | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=fixed) |
| b2g-v1.4 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed) |
| b2g-v2.0 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed) |
| b2g-v2.1 | --- | [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | wontfix |
| firefox31 |  | verified |
| firefox32 |  | verified |
| firefox33 |  | verified |
| firefox-esr24 |  | unaffected |
| b2g-v1.3 |  | fixed |
| b2g-v1.3T |  | fixed |
| b2g-v1.4 |  | fixed |
| b2g-v2.0 |  | fixed |
| b2g-v2.1 |  | fixed |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Assigned: mjrosenb)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/b00d3efc283ff1d77f56f01b78f60713?d=mm&size=40)  [mjrosenb](/user_profile?user_id=419881)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058"), [1034383](/show_bug.cgi?id=1034383 "RESOLVED FIXED - Assertion failure: hasScript(), at jsfun.h")

Dependency [tree](/showdependencytree.cgi?id=1013056&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1013056)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [jsbugmon:][adv-main31+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[jsbugmon:][adv-main31+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 4 obsolete files)

| [stack](/attachment.cgi?id=8425230)  [11 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   1.13 KB, text/plain |  | [Details](/attachment.cgi?id=8425230&action=edit) |
| --- | --- | --- |
| [stack from rev 4876594bacaa](/attachment.cgi?id=8439149)  [11 years ago](#c10)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   1.25 KB, text/plain |  | [Details](/attachment.cgi?id=8439149&action=edit) |
| [fixCacheFlusher-r0.patch](/attachment.cgi?id=8446176)  [11 years ago](#c18)  [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)   3.25 KB, patch | shu : [review+](#c19 "11 years ago")  dougc : [review-](#a3172649_25650 "11 years ago") | [Details](/attachment.cgi?id=8446176&action=edit) | [Diff](/attachment.cgi?id=8446176&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176) |
| [Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.](/attachment.cgi?id=8446272)  [11 years ago](#c22)  [Douglas Crosher [:dougc]](/user_profile?user_id=25650)   1.45 KB, patch |  | [Details](/attachment.cgi?id=8446272&action=edit) | [Diff](/attachment.cgi?id=8446272&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446272) |
| [Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.](/attachment.cgi?id=8446280)  [11 years ago](#c25)  [Douglas Crosher [:dougc]](/user_profile?user_id=25650)   2.53 KB, patch | shu : [review+](#c30 "11 years ago") | [Details](/attachment.cgi?id=8446280&action=edit) | [Diff](/attachment.cgi?id=8446280&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446280) |
| [Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.](/attachment.cgi?id=8452036)  [11 years ago](#c31)  [Douglas Crosher [:dougc]](/user_profile?user_id=25650)   2.68 KB, patch | dougc : [review+](#c31 "11 years ago")  abillings : [approval-mozilla-aurora+](#c34 "11 years ago")  abillings : [approval-mozilla-beta+](#c34 "11 years ago")  abillings : [sec-approval+](#c34 "11 years ago") | [Details](/attachment.cgi?id=8452036&action=edit) | [Diff](/attachment.cgi?id=8452036&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452036) |
| [Sub-patch for backporting to ESR 24.](/attachment.cgi?id=8452807)  [11 years ago](#c36)  [Douglas Crosher [:dougc]](/user_profile?user_id=25650)   1.49 KB, patch |  | [Details](/attachment.cgi?id=8452807&action=edit) | [Diff](/attachment.cgi?id=8452807&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452807) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1013056#c0)• 11 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=8425230) (obsolete)
— [Details](attachment.cgi?id=8425230&action=edit)

b = RegExp("(?=())")
y = new Object;
a = b.exec('')
a[3] = undefined
Array.prototype.unshift.call(a, undefined)
try {
a.filterPar(function() {})
} catch (e) {}
crashes js opt shell on m-c changeset 2893f60d5903 with --ion-parallel-compile=off --ion-eager at a weird memory address intermittently.
Setting s-s and assuming sec-critical prior to further analysis, as crashing at a weird address seems bad.
My configure flags are:
CC="gcc-4.7 -mfloat-abi=softfp -B/usr/lib/gcc/arm-linux-gnueabi/4.7" CXX="g++-4.7 -mfloat-abi=softfp -B/usr/lib/gcc/arm-linux-gnueabi/4.7" AR=ar sh /home/fuzz5lin/trees/mozilla-central/js/src/configure --target=arm-linux-gnueabi --enable-optimize --disable-debug --enable-profiling --enable-gczeal --enable-debug-symbols --disable-tests --enable-more-deterministic --with-ccache --enable-threadsafe <other NSPR options>
Run this anytime from 1-100 times, or (set disable-randomization if necessary) within gdb, repeatedly run it till it crashes.
I will try to see if I can get a bisection, but no promises yet.
Setting needinfo? from Marty to see what's going on here.Flags: needinfo?(mrosenberg)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1013056#c1)• 11 years ago |
|  | |

autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: <http://hg.mozilla.org/mozilla-central/rev/7a1c696cade6>
user: Shu-yu Guo
date: Mon Apr 07 13:02:20 2014 -0700
summary: [Bug 974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result") - Remove filterPar chunking. (r=nmatsakis)
Shu-yu, is [bug 974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result") likely related in any way?Blocks: [974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result")Flags: needinfo?(shu)Summary: Crash at a weird memory address involving RegExp → Crash at a weird memory address involving RegExp and filterPar

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a24369_132034)• 11 years ago |

[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=unaffected)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1013056#c2)• 11 years ago |
|  | |

I don't have any ARM hardware to try to reproduce this. Did this start after irregexp landed?

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1013056#c3)• 11 years ago |
|  | |

(In reply to Shu-yu Guo [:shu] from [comment #2](/show_bug.cgi?id=1013056#c2 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> I don't have any ARM hardware to try to reproduce this. Did this start after
> irregexp landed?
That is, can you reproduce with YARR?

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1013056#c4)• 11 years ago |
|  | |

I am unable to reproduce this with the ARM simulator after running the test in a loop for about half an hour.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1013056#c5)• 11 years ago |
|  | |

(In reply to Shu-yu Guo [:shu] from [comment #2](/show_bug.cgi?id=1013056#c2 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> I don't have any ARM hardware to try to reproduce this. Did this start after
> irregexp landed?
The bisection says [bug 974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result") is where it starts happening, and that was before irregexp landed.

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1013056#c6)• 11 years ago |
|  | |

Clearing NI because I have no idea how to reproduce this. Gary, please re-NI me if you come up with a machine I can ssh into or something.Flags: needinfo?(shu)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1013056#c7)• 11 years ago |
|  | |

(Shu-yu and I are trying to sort this out asap)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a1346858_395101)• 11 years ago |

Whiteboard: [jsbugmon:update]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a1387700_395101)• 11 years ago |

Whiteboard: [jsbugmon:update] → [jsbugmon:]

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1013056#c8)• 11 years ago |
|  | |

JSBugMon: Cannot process bug: Unable to automatically reproduce, please track manually.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1013056#c9)• 11 years ago |
|  | |

Critsmash check: needs a recheck.Flags: needinfo?(gary)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a1943352_280903)• 11 years ago |

[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1013056#c10)• 11 years ago |
|  | |

Attached file
[stack from rev 4876594bacaa](attachment.cgi?id=8439149)
— [Details](attachment.cgi?id=8439149&action=edit)

This still reproduces with m-c rev 4876594bacaa.
[Attachment #8425230](/attachment.cgi?id=8425230&action=edit "stack") -
Attachment is obsolete: trueFlags: needinfo?(gary)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1013056#c11)• 11 years ago |
|  | |

(In reply to Shu-yu Guo [:shu] from [comment #6](/show_bug.cgi?id=1013056#c6 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> Clearing NI because I have no idea how to reproduce this. Gary, please re-NI
> me if you come up with a machine I can ssh into or something.
Shu-yu, I now have a machine with access and an updated rev - let's sync up on IRC sometime soon.Flags: needinfo?(shu)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1013056#c12)• 11 years ago |
|  | |

Shu-yu handed this off to Marty, who took a look at it on my machine. Any discoveries?Flags: needinfo?(shu)

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1013056#c13)• 11 years ago |
|  | |

; so here isthe code that was likely executed right before the code that crashed:
0xb52feec4: beq 0xb52feedc
0xb52feec8: cmn r3, #123 ; 0x7b
0xb52feecc: beq 0xb52feedc
0xb52feed0: ldr r9, [r9, #4]
0xb52feed4: ldr r0, [r9]
0xb52feed8: bx r0
0xb52feedc: mov pc, lr
0xb52feee0: andeq r0, r0, r0
0xb52feee4: andeq r0, r0, r0
0xb52feee8: andeq r0, r0, r0
0xb52feeec: ldrlt r0, [r4, #-2936]! ; 0xb78
0xb52feef0: ldr lr, [r9]
0xb52feef4: movw r12, #59424 ; 0xe820
0xb52feef8: movt r12, #46387 ; 0xb533
0xb52feefc: cmp lr, r12
0xb52fef00: bne 0xb52fef44
0xb52fef04: cmn r10, #127 ; 0x7f
0xb52fef08: bne 0xb52fef44
0xb52fef0c: mov r11, r3
0xb52fef10: push {r9} ; (str r9, [sp, #-4]!)
0xb52fef14: ldr r9, [r9, #12]
0xb52fef18: ldr r12, [r9, #-12]
0xb52fef1c: cmp r12, r11
0xb52fef20: bls 0xb52fef40
0xb52fef24: add r12, r9, r11, lsl #3
0xb52fef28: ldr r11, [r12]
0xb52fef2c: ldr r0, [r12, #4]
0xb52fef30: cmn r0, #124 ; 0x7c
0xb52fef34: beq 0xb52fef40
0xb52fef38: pop {r9} ; (ldr r9, [sp], #4)
0xb52fef3c: b 0xb52ee224
0xb52fef40: pop {r9} ; (ldr r9, [sp], #4)
0xb52fef44: b 0xb52ee8a4
0xb52fef48: b 0xb52fef58
0xb52fef4c: ; <UNDEFINED> instruction: 0xffff0003
0xb52fef50: cdple 14, 10, cr11, cr13, cr15, {7}
0xb52fef54: cdple 14, 10, cr11, cr13, cr15, {7}
0xb52fef58: andeq r0, r0, r8
0xb52fef5c: andeq r0, r0, r0
0xb52fef60: andeq r0, r0, r0
0xb52fef64: andeq r0, r0, r0
0xb52fef68: andeq r0, r0, r0
0xb52fef6c: andeq r0, r0, r0
---Type <return> to continue, or q <return> to quit---
0xb52fef70: andeq r0, r0, r0
0xb52fef74: andeq r0, r0, r0
0xb52fef78: andeq r0, r0, r0
0xb52fef7c: andeq r0, r0, r0
0xb52fef80: andeq r0, r0, r0
0xb52fef84: andeq r0, r0, r0
0xb52fef88: andeq r0, r0, r0
0xb52fef8c: andeq r0, r0, r0
0xb52fef90: andeq r0, r0, r0
0xb52fef94: andeq r0, r0, r0
0xb52fef98: andeq r0, r0, r0
0xb52fef9c: andeq r0, r0, r0
0xb52fefa0: andeq r0, r0, r0
0xb52fefa4: andeq r0, r0, r0
0xb52fefa8: andeq r0, r0, r0
0xb52fefac: andeq r0, r0, r0
0xb52fefb0: andeq r0, r0, r0
0xb52fefb4: andeq r0, r0, r0
0xb52fefb8: andeq r0, r0, r0
0xb52fefbc: andeq r0, r0, r0
0xb52fefc0: andeq r0, r0, r0
0xb52fefc4: andeq r0, r0, r0
0xb52fefc8: andeq r0, r0, r0
0xb52fefcc: andeq r0, r0, r0
0xb52fefd0: andeq r0, r0, r0
0xb52fefd4: andeq r0, r0, r0
0xb52fefd8: andeq r0, r0, r0
0xb52fefdc: andeq r0, r0, r0
0xb52fefe0: andeq r0, r0, r0
0xb52fefe4: andeq r0, r0, r0
0xb52fefe8: andeq r0, r0, r0
0xb52fefec: andeq r0, r0, r0
0xb52feff0: andeq r0, r0, r0
0xb52feff4: andeq r0, r0, r0
0xb52feff8: andeq r0, r0, r0
0xb52feffc: andeq r0, r0, r0
the tldr is normal code; normal code; branch around pool; goose eggs.
My current guesses are 1) for whatever reason, we got here and the copying never finished.
or 2) the correct code was stomped over with all zeros, which are a pretty nice nop. I'll look into this more on monday.Flags: needinfo?(mrosenberg)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1013056#c14)• 11 years ago |
|  | |

(In reply to Marty Rosenberg [:mjrosenb] from [comment #13](/show_bug.cgi?id=1013056#c13 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> the tldr is normal code; normal code; branch around pool; goose eggs.
> My current guesses are 1) for whatever reason, we got here and the copying
> never finished.
> or 2) the correct code was stomped over with all zeros, which are a pretty
> nice nop. I'll look into this more on monday.
Thanks Marty! Assigning to you...Assignee: nobody → mrosenbergStatus: NEW → ASSIGNED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1013056#c15)• 11 years ago |
|  | |

Marty, when do you think this will get in?Flags: needinfo?(mrosenberg)

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a3159604_419881)• 11 years ago |

Flags: needinfo?(mrosenberg)

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1013056#c16)• 11 years ago |
|  | |

interesting that adding a cc cleared needinfo.
After lots of debugging, I now suspect that the issue is a lack of cache flushing.
Changing the code to always flush the caches immediately seems to make the issue go away (currently in the middle of running it 1,000 times to verify). gary, can you possibly test this with a simulator build, and ARM\_SIM\_ICACHE\_CHECKS=1 (it is an environment variable)?
At this point, I can just munge the auto flush cache code until this issue goes away, or I can attempt to actually figure out what is going wrong beyond "caches aren't flushed." I'm leaning towards the latter, but the former is certainly doable, if we want this to go away asap.Flags: needinfo?(gary)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1013056#c17)• 11 years ago |
|  | |

(In reply to Marty Rosenberg [:mjrosenb] from [comment #16](/show_bug.cgi?id=1013056#c16 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> gary, can you possibly test this with a simulator build, and
> ARM\_SIM\_ICACHE\_CHECKS=1 (it is an environment variable)?
No, this does not reproduce with a simulator build with or without that environment variable. (I ran about 500 times) Tested on m-c rev da1dbcff9493.Flags: needinfo?(gary)

|  | [Marty Rosenberg [:mjrosenb]](/user_profile?user_id=419881)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1013056#c18)• 11 years ago |
|  | |

Attached patch

[fixCacheFlusher-r0.patch](attachment.cgi?id=8446176&action=diff) (obsolete)
— [Details](attachment.cgi?id=8446176&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176)

dougc for the refactoring of the AutoFlushICache. I didn't see any way to make the current flusher flush its contents. I suspect this may not actually be needed, but it certainly seems simpler than adding in a new AFIC for ever call between the IC top level, and here where code can be modified.
shu for the actual location of forceFlush. I perused the code, and I \*think\* that is the only place where it is needed. I ran the test 100 times with this in place, and didn't see any crashes.
[Attachment #8446176](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") -
Flags: review?(shu)
[Attachment #8446176](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") -
Flags: review?(dtc-moz)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1013056#c19)• 11 years ago |
|  | |

Comment on [attachment 8446176](/attachment.cgi?id=8446176 "fixCacheFlusher-r0.patch") [[details]](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") [[diff]](/attachment.cgi?id=8446176&action=diff "fixCacheFlusher-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176)
fixCacheFlusher-r0.patch
Review of [attachment 8446176](/attachment.cgi?id=8446176 "fixCacheFlusher-r0.patch") [[details]](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") [[diff]](/attachment.cgi?id=8446176&action=diff "fixCacheFlusher-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176):
-----------------------------------------------------------------
Great work, Marty.
::: js/src/jit/IonCaches.cpp
@@ +334,5 @@
> // have not yet executed the code we're patching the jump in.
> nextStubOffset\_.fixup(&masm);
> CodeLocationJump nextStubJump(code, nextStubOffset\_);
> PatchJump(nextStubJump, CodeLocationLabel(cache\_.firstStub\_));
> + AutoFlushICache::ForceFlush();
Nit: keep the newline after the ForceFlush
::: js/src/jit/IonCode.h
@@ +787,5 @@
>
> public:
> static void setRange(uintptr\_t p, size\_t len);
> static void flush(uintptr\_t p, size\_t len);
> + static void ForceFlush();
Does SM capitalize static methods?
[Attachment #8446176](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") -
Flags: review?(shu) → review+

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1013056#c20)• 11 years ago |
|  | |

Comment on [attachment 8446176](/attachment.cgi?id=8446176 "fixCacheFlusher-r0.patch") [[details]](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") [[diff]](/attachment.cgi?id=8446176&action=diff "fixCacheFlusher-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176)
fixCacheFlusher-r0.patch
Review of [attachment 8446176](/attachment.cgi?id=8446176 "fixCacheFlusher-r0.patch") [[details]](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") [[diff]](/attachment.cgi?id=8446176&action=diff "fixCacheFlusher-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176):
-----------------------------------------------------------------
There should be no forcing of the instruction cache flushing because the region pending flushing should never be executed. Flushing that occurs outside the pending region occurs immediately. The PatchJump should be flushing the cache immediately, unless it is in a pending region in which case it should not be executed until after the AutoFlushICache destructor is called. The patch might be a good clue, but the problem needs to be analysed first and there might be some other issue causing problems here.

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a3172649_25650)• 11 years ago |

[Attachment #8446176](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") -
Flags: review?(dtc-moz) → review-

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1013056#c21)• 11 years ago |
|  | |

Comment on [attachment 8446176](/attachment.cgi?id=8446176 "fixCacheFlusher-r0.patch") [[details]](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") [[diff]](/attachment.cgi?id=8446176&action=diff "fixCacheFlusher-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176)
fixCacheFlusher-r0.patch
Review of [attachment 8446176](/attachment.cgi?id=8446176 "fixCacheFlusher-r0.patch") [[details]](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") [[diff]](/attachment.cgi?id=8446176&action=diff "fixCacheFlusher-r0.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446176):
-----------------------------------------------------------------
In IonCache::attachStub, |attacher.patchStubCodePointer(masm, code);| should be called before |attacher.patchNextStubJump(masm, code);| too, since patchNextStubJump is what makes the new stub reachable.

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1013056#c22)• 11 years ago |
|  | |

Attached patch

[Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.](attachment.cgi?id=8446272&action=diff) (obsolete)
— [Details](attachment.cgi?id=8446272&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446272)

Here's part of the problem. I would prefer to fix it this way, to keep the code as simple as possible. Strange that the ARM simulator did not pick this up, maybe because it's a race.
Shu: could you combine this with the changes you advised in [comment 21](/show_bug.cgi?id=1013056#c21 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar")?Flags: needinfo?(shu)

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1013056#c23)• 11 years ago |
|  | |

Sorry, I created this problem in [Bug 988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058").Blocks: [988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058")

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1013056#c24)• 11 years ago |
|  | |

(In reply to Douglas Crosher [:dougc] from [comment #23](/show_bug.cgi?id=1013056#c23 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> Sorry, I created this problem in [Bug 988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058").
Updating flags - [bug 988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058") landed in 30, 31 and 32, but too late for 30. Thanks for fixing this!No longer blocks: [974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result")
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=unaffected) → [wontfix](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=wontfix)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a3181239_75935)• 11 years ago |

[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=affected)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1013056#c25)• 11 years ago |
|  | |

Attached patch

[Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.](attachment.cgi?id=8446280&action=diff) (obsolete)
— [Details](attachment.cgi?id=8446280&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446280)

Add the changes advised in [comment 21](/show_bug.cgi?id=1013056#c21 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"), and add some comments.
[Attachment #8446272](/attachment.cgi?id=8446272&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Attachment is obsolete: trueFlags: needinfo?(shu)

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1013056#c26)• 11 years ago |
|  | |

Are you able to verify that the patch in [comment 25](/show_bug.cgi?id=1013056#c25 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar") corrects this issue?Flags: needinfo?(gary)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1013056#c27)• 11 years ago |
|  | |

I'm behind on stuff, but nonetheless this is on my list.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1013056#c28)• 11 years ago |
|  | |

(In reply to Douglas Crosher [:dougc] from [comment #26](/show_bug.cgi?id=1013056#c26 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> Are you able to verify that the patch in [comment 25](/show_bug.cgi?id=1013056#c25 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar") corrects this issue?
Yes, without the patch, it crashes within 40-50 runs most of the time. However, with the patch, it did not crash after 400-odd runs.Flags: needinfo?(gary) → needinfo?(dtc-moz)

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a3919667_25650)• 11 years ago |

[Attachment #8446280](/attachment.cgi?id=8446280&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: review?(shu)Flags: needinfo?(dtc-moz)

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a3919712_25650)• 11 years ago |

[Attachment #8446176](/attachment.cgi?id=8446176&action=edit "fixCacheFlusher-r0.patch") -
Attachment is obsolete: true

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1013056#c29)• 11 years ago |
|  | |

The same patch also applies to Aurora and Beta. Try builds:
m-c: <https://tbpl.mozilla.org/?tree=Try&rev=478254293a5b>
Aurora: <https://tbpl.mozilla.org/?tree=Try&rev=cc6035bbbd70>
Beta: <https://tbpl.mozilla.org/?tree=Try&rev=3fe8d322ab28>

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1013056#c30)• 11 years ago |
|  | |

Comment on [attachment 8446280](/attachment.cgi?id=8446280 "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[details]](/attachment.cgi?id=8446280&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[diff]](/attachment.cgi?id=8446280&action=diff "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446280)
Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.
Review of [attachment 8446280](/attachment.cgi?id=8446280 "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[details]](/attachment.cgi?id=8446280&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[diff]](/attachment.cgi?id=8446280&action=diff "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8446280):
-----------------------------------------------------------------
Clean fix. Thanks!
::: js/src/jit/IonCaches.cpp
@@ +393,5 @@
> // as it can be kept alive even if the cache is flushed (see
> // MarkJitExitFrame).
> attacher.patchStubCodePointer(masm, code);
> +
> + // Update the failure path.
Could you add a comment for posterity that this patch is what makes the stub accessible for parallel ICs, and should not be moved unless the author really knows what's going on?
[Attachment #8446280](/attachment.cgi?id=8446280&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: review?(shu) → review+

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1013056#c31)• 11 years ago |
|  | |

Attached patch

[Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.](attachment.cgi?id=8452036&action=diff)
— [Details](attachment.cgi?id=8452036&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452036)

Address reviewer feedback. Carrying forward r+.
[Attachment #8446280](/attachment.cgi?id=8446280&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Attachment is obsolete: true
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: review+

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1013056#c32)• 11 years ago |
|  | |

Comment on [attachment 8452036](/attachment.cgi?id=8452036 "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[details]](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[diff]](/attachment.cgi?id=8452036&action=diff "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452036)
Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.
[Security approval request comment]
How easily could an exploit be constructed based on the patch? Difficult, it's a thread race issue.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem? For someone looking, yes.
Which older supported branches are affected by this flaw? Release 30, Beta 21, Aurora 32.
If not all supported branches, which bug introduced the flaw? [bug 988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058").
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be? The same patch applies to beta 31 and aurora 32.
How likely is this patch to cause regressions; how much testing does it need? It was hard to reproduce, and has been tested to resolve the issue, see [comment 28](/show_bug.cgi?id=1013056#c28 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar").
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: sec-approval?

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1013056#c33)• 11 years ago |
|  | |

Comment on [attachment 8452036](/attachment.cgi?id=8452036 "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[details]](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[diff]](/attachment.cgi?id=8452036&action=diff "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452036)
Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.
Approval Request Comment
[Feature/regressing bug #]: [bug 988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058").
[User impact if declined]: Intermittent crashes in some JS code.
[Describe test coverage new/current, TBPL]: Tested locally, tbpl try builds.
[Risks and why]: Low. It was an obvious programming mistake. The problem has been reproduced, and the patch tested to resolve the issue.
[String/UUID change made/needed]: n/a
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: approval-mozilla-beta?
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: approval-mozilla-aurora?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1013056#c34)• 11 years ago |
|  | |

Comment on [attachment 8452036](/attachment.cgi?id=8452036 "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[details]](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[diff]](/attachment.cgi?id=8452036&action=diff "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452036)
Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.
sec-approval+ for trunk. I approved Aurora and Branch for after trunk is green.
Does this affect ESR24?
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: sec-approval?
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: sec-approval+
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: approval-mozilla-beta?
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: approval-mozilla-beta+
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: approval-mozilla-aurora?
[Attachment #8452036](/attachment.cgi?id=8452036&action=edit "Exit an AutoFlushICache dynamic context to ensure the cache has been flushed before the code is executed.") -
Flags: approval-mozilla-aurora+

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1013056#c35)• 11 years ago |
|  | |

Landed after obfuscating commit message:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/5c805d803e11>
(and no, looking at [bug 988789](/show_bug.cgi?id=988789 "VERIFIED FIXED - Assertion failure: memcmp(reinterpret_cast<void*>(instr), cache_page->cachedData(offset), SimInstruction::kInstrSize) == 0, at jit/arm/Simulator-arm.cpp:1058"), ESR24 should not be affected.)Target Milestone: --- → mozilla33

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1013056#c36)• 11 years ago |
|  | |

Attached patch

[Sub-patch for backporting to ESR 24.](attachment.cgi?id=8452807&action=diff)
— [Details](attachment.cgi?id=8452807&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452807)

Looking at this further, part of the fix addresses an issue introduced in [bug 849469](/show_bug.cgi?id=849469 "RESOLVED FIXED - IonMonkey: Refactor GetNativePropertyStub") which landed on 22. This patch includes only the part of the patch that needs backporting to 29 to 22 inclusive. This patch is relative to m-c but should be easy to backport if there is any interest.

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1013056#c37)• 11 years ago |
|  | |

Changing ESR24 to be "affected" then, based on [comment 36](/show_bug.cgi?id=1013056#c36 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar").
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) → [affected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=affected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1013056#c38)• 11 years ago |
|  | |

Might as well request esr24 approval on the patch then.
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) → [affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected)
[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=unaffected) → [affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected)

|  | [Douglas Crosher [:dougc]](/user_profile?user_id=25650) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1013056#c39)• 11 years ago |
|  | |

Comment on [attachment 8452807](/attachment.cgi?id=8452807 "Sub-patch for backporting to ESR 24.") [[details]](/attachment.cgi?id=8452807&action=edit "Sub-patch for backporting to ESR 24.") [[diff]](/attachment.cgi?id=8452807&action=diff "Sub-patch for backporting to ESR 24.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452807)
Sub-patch for backporting to ESR 24.
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration: It is thread race with a simple fix.
User impact if declined: Low. Crashes in some rare JS code. No attempt has been made to reproduce a crash for this issue alone and it might be hard to exploit.
Fix Landed on Version: 33
Risk to taking this patch (and alternatives if risky): Low because it's a small obvious fix.
String or UUID changes made by this patch: n/a
shu: could you double check this?
[Attachment #8452807](/attachment.cgi?id=8452807&action=edit "Sub-patch for backporting to ESR 24.") -
Flags: feedback?(shu)
[Attachment #8452807](/attachment.cgi?id=8452807&action=edit "Sub-patch for backporting to ESR 24.") -
Flags: approval-mozilla-esr24?

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1013056#c40)• 11 years ago |
|  | |

Comment on [attachment 8452807](/attachment.cgi?id=8452807 "Sub-patch for backporting to ESR 24.") [[details]](/attachment.cgi?id=8452807&action=edit "Sub-patch for backporting to ESR 24.") [[diff]](/attachment.cgi?id=8452807&action=diff "Sub-patch for backporting to ESR 24.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452807)
Sub-patch for backporting to ESR 24.
Review of [attachment 8452807](/attachment.cgi?id=8452807 "Sub-patch for backporting to ESR 24.") [[details]](/attachment.cgi?id=8452807&action=edit "Sub-patch for backporting to ESR 24.") [[diff]](/attachment.cgi?id=8452807&action=diff "Sub-patch for backporting to ESR 24.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1013056&attachment=8452807):
-----------------------------------------------------------------
You don't need to backport this. PJS isn't turned on anywhere except on Nightly, for precisely this reason of not wanting to have to backport.
[Attachment #8452807](/attachment.cgi?id=8452807&action=edit "Sub-patch for backporting to ESR 24.") -
Flags: feedback?(shu)
[Attachment #8452807](/attachment.cgi?id=8452807&action=edit "Sub-patch for backporting to ESR 24.") -
Flags: approval-mozilla-esr24?

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1013056#c41)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/5c805d803e11>Status: ASSIGNED → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Resolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1013056#c42)• 11 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/ceb34c8aeb95>
<https://hg.mozilla.org/releases/mozilla-beta/rev/eba5d3400944>
<https://hg.mozilla.org/releases/mozilla-b2g30_v1_4/rev/374b1b6250db>
<https://hg.mozilla.org/releases/mozilla-b2g28_v1_3/rev/9365d44d678e>
[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=fixed)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=fixed)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=fixed)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=fixed)
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)
[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a4375050_75935)• 11 years ago |

[status-b2g-v1.3T](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_b2g_1_3t&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a4387387_280903)• 11 years ago |

Whiteboard: [jsbugmon:] → [jsbugmon:][adv-main31+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a4755917_1689)• 11 years ago |

Group: javascript-core-security

|  | [Matt Wobensmith [:mwobensmith][:matt:]](/user_profile?user_id=452604) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1013056#c43)• 11 years ago |
|  | |

Gary, can we assume that this was verified on Fx31 based on [comment 28](/show_bug.cgi?id=1013056#c28 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar")?Flags: needinfo?(gary)

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1013056#c44)• 11 years ago |
|  | |

(In reply to Matt Wobensmith from [comment #43](/show_bug.cgi?id=1013056#c43 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"))
> Gary, can we assume that this was verified on Fx31 based on [comment 28](/show_bug.cgi?id=1013056#c28 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar")?
I just retested that the intermittent crash does not occur on mozilla-beta tip rev 6befadcaa685 but occurs on mozilla-beta regressor rev 7a1c696cade6, so yes, verified.Status: RESOLVED → VERIFIED
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=verified)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=verified)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified)Flags: needinfo?(gary)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a5229674_1689)• 11 years ago |

Blocks: [1034383](/show_bug.cgi?id=1034383 "RESOLVED FIXED - Assertion failure: hasScript(), at jsfun.h")

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a40613339_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1013056#a64517578_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1013056&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_03ffc45d_20250125_062810.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1034383)
* [XML](/show_bug.cgi?ctype=xml&id=1034383)

Closed
[Bug 1034383](/show_bug.cgi?id=1034383)

Opened 11 years ago
Closed 11 years ago

# Assertion failure: hasScript(), at jsfun.h

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Assertion failure: hasScript(), at jsfun.h

## Categories

### (Core :: JavaScript Engine: JIT, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT#JavaScript%20Engine%3A%20JIT)

JavaScript Engine: JIT
▾

Core :: JavaScript Engine: JIT
JavaScript engine's JIT compilers
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine%3A%20JIT)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

ARM

Linux

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=unaffected) |
| firefox31 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed) |
| firefox32 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed) |
| firefox33 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) |
| firefox-esr24 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected) |
| b2g-v1.3 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox30 |  | unaffected |
| firefox31 |  | fixed |
| firefox32 |  | fixed |
| firefox33 |  | fixed |
| firefox-esr24 |  | unaffected |
| b2g-v1.3 |  | unaffected |
| b2g-v1.4 |  | unaffected |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: gkw, Unassigned)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

*Unassigned*

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [gkw](/user_profile?user_id=132034)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1013056](/show_bug.cgi?id=1013056 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result")

Dependency [tree](/showdependencytree.cgi?id=1034383&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1034383)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main31+] fixed by bug 1013056)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main31+] fixed by bug 1013056

QA Whiteboard:

[qa-]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [stack](/attachment.cgi?id=8450684)  [11 years ago](#c0)  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)   1.95 KB, text/plain |  | [Details](/attachment.cgi?id=8450684&action=edit) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1034383#c0)• 11 years ago |
|  | |

Attached file
[stack](attachment.cgi?id=8450684)
— [Details](attachment.cgi?id=8450684&action=edit)

x = [];
Object.defineProperty(x, 8, {
get: (function(j) {})
});
Object.defineProperty(this, "y", {
get: function() {
return x.filterPar(function() {});
}
});
for (var a = 0; a < 99; a++) {
Array.prototype.shift.call(y);
}
asserts js debug shell on m-c changeset 613bc15ccf05 with --ion-eager --ion-offthread-compile=off at Assertion failure: hasScript(), at jsfun.h
My configure flags are:
CC="gcc-4.7 -mfloat-abi=softfp -B/usr/lib/gcc/arm-linux-gnueabi/4.7" CXX="g++-4.7 -mfloat-abi=softfp -B/usr/lib/gcc/arm-linux-gnueabi/4.7" AR=ar sh /home/fuzz5lin/trees/mozilla-central/js/src/configure --target=arm-linux-gnueabi --enable-debug --enable-optimize --enable-profiling --enable-gczeal --enable-debug-symbols --disable-tests --enable-more-deterministic --with-ccache --enable-threadsafe <other NSPR options>
This is intermittent and mutates its signatures (sometimes unreliably crashes), so it would be nice to have this fixed. I'll see if I can get a bisection, but no promises here.
Setting s-s and sec-high as a start. Shu-yu, would you be able to take a look?Flags: needinfo?(shu)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1034383#c1)• 11 years ago |
|  | |

Can't repro locally on emulator again. You know the drill. Could you trap it in gdb and get me access to a machine?Flags: needinfo?(shu)

|  | [Shu-yu Guo [:shu]](/user_profile?user_id=381259) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1034383#c2)• 11 years ago |
|  | |

Also see if it's reproducible with thread count of 1

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1034383#c3)• 11 years ago |
|  | |

autoBisect shows this is probably related to the following changeset:
The first bad revision is:
changeset: <https://hg.mozilla.org/mozilla-central/rev/7a1c696cade6>
user: Shu-yu Guo
date: Mon Apr 07 13:02:20 2014 -0700
summary: [Bug 974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result") - Remove filterPar chunking. (r=nmatsakis)
Also, no, I don't think this is reproducible with --thread-count=1.Blocks: [974201](/show_bug.cgi?id=974201 "RESOLVED FIXED - filterPar produces incorrect result")

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1034383#c4)• 11 years ago |
|  | |

autoBisect shows this is probably related to the following changeset:
The first good revision is:
changeset: <https://hg.mozilla.org/mozilla-central/rev/5c805d803e11>
user: Douglas Crosher
date: Tue Jul 08 09:42:00 2014 +1000
summary: [Bug 1013056](/show_bug.cgi?id=1013056 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar"). r=shu
Probably fixed by 1013056, which Shu-yu confirmed over IRC.Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox31](/buglist.cgi?f1=cf_status_firefox31&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox31&o1=equals&v1=fixed)
[status-firefox32](/buglist.cgi?f1=cf_status_firefox32&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox32&o1=equals&v1=fixed)
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla33

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1034383#a517110_280903)• 11 years ago |

[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=unaffected)Whiteboard: [adv-main31+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1034383#a885557_1689)• 11 years ago |

Group: javascript-core-security

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1034383#c5)• 11 years ago |
|  | |

I'm going to mark this as [qa-] due to not being able to reproduce the original issue. I've tried reproducing using the flags in [comment #0](/show_bug.cgi?id=1034383#c0 "RESOLVED FIXED - Assertion failure: hasScript(), at jsfun.h") on the emulator with no luck :/ Looks like :shu was also having issues reproducing the original issue in [comment #1](/show_bug.cgi?id=1034383#c1 "RESOLVED FIXED - Assertion failure: hasScript(), at jsfun.h").
Also tried reproducing the issue using --thread-count=1 as suggested in [comment #2](/show_bug.cgi?id=1034383#c2 "RESOLVED FIXED - Assertion failure: hasScript(), at jsfun.h").Status: RESOLVED → VERIFIEDQA Whiteboard: [qa-]

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1034383#a945566_455785)• 11 years ago |

Status: VERIFIED → RESOLVEDClosed: 11 years ago → 11 years ago

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1034383#a1359295_1689)• 11 years ago |

[status-b2g-v1.3](/buglist.cgi?f1=cf_status_b2g_1_3&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_3&o1=equals&v1=unaffected)
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)
[status-firefox30](/buglist.cgi?f1=cf_status_firefox30&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox30&o1=equals&v1=unaffected)Depends on: [1013056](/show_bug.cgi?id=1013056 "VERIFIED FIXED - Crash at a weird memory address involving RegExp and filterPar")Whiteboard: [adv-main31+] → [adv-main31+] fixed by bug 1013056

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1034383#a36742976_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1034383#a60647191_1689)• 9 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1034383&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_3c48c726_20250125_062802.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1021240)
* [XML](/show_bug.cgi?ctype=xml&id=1021240)

Closed
[Bug 1021240](/show_bug.cgi?id=1021240)

Opened 11 years ago
Closed 11 years ago

# Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla33

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox33 | --- | [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified) |
| firefox-esr24 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix) |
| firefox-esr31 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=wontfix) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox33 |  | verified |
| firefox-esr24 |  | wontfix |
| firefox-esr31 |  | wontfix |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: catalinb, Assigned: smichaud)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/f4932c37bcceaf71fd2472886282a3cb?d=mm&size=40)  [smichaud](/user_profile?user_id=67806)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/87e3213e4c2ccbf859894566982a1e54?d=mm&size=40)  [catalinb](/user_profile?user_id=488358)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

14 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[999034](/show_bug.cgi?id=999034 "RESOLVED FIXED - List of known possibly security sensitive issues"), [1021969](/show_bug.cgi?id=1021969 "VERIFIED FIXED - mozMediaStatisticsShowing property shouldn't be content-exposed")

Dependency [tree](/showdependencytree.cgi?id=1021240&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1021240)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-other, Whiteboard: [adv-main33-])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main33-]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [cbook](/user_profile?user_id=277293) | [in-testsuite](#c56 "11 years ago") | ? |
| --- | --- | --- |
| [cbook](/user_profile?user_id=277293) | in-testsuite | ? |
| --- | --- | --- |
| [kjozwiak](/user_profile?user_id=455785) | [qe-verify](#c57 "10 years ago") | + |
| --- | --- | --- |
| [kjozwiak](/user_profile?user_id=455785) | qe-verify | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 2 obsolete files)

| [Test case](/attachment.cgi?id=8435220)  [11 years ago](#c0)  [Cătălin Badea (:catalinb)](/user_profile?user_id=488358)   393 bytes, text/html |  | [Details](/attachment.cgi?id=8435220&action=edit) |
| --- | --- | --- |
| [gdb all thread stack trace of hang](/attachment.cgi?id=8435262)  [11 years ago](#c7)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   33.99 KB, text/plain |  | [Details](/attachment.cgi?id=8435262&action=edit) |
| [,](/attachment.cgi?id=8435815)  [11 years ago](#c23)  [:Gijs (he/him)](/user_profile?user_id=159069)   5.81 KB, patch | bzbarsky : [feedback+](#c24 "11 years ago") | [Details](/attachment.cgi?id=8435815&action=edit) | [Diff](/attachment.cgi?id=8435815&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435815) |
| [,](/attachment.cgi?id=8435888)  [11 years ago](#c25)  [:Gijs (he/him)](/user_profile?user_id=159069)   8.71 KB, patch | bholley : [review+](#c27 "11 years ago")  jaws : [review+](#a79193_409754 "11 years ago") | [Details](/attachment.cgi?id=8435888&action=edit) | [Diff](/attachment.cgi?id=8435888&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435888) |
| [Debug logging patch (not a fix)](/attachment.cgi?id=8446812)  [11 years ago](#c39)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   6.01 KB, patch |  | [Details](/attachment.cgi?id=8446812&action=edit) | [Diff](/attachment.cgi?id=8446812&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8446812) |
| [Fix](/attachment.cgi?id=8447496)  [11 years ago](#c46)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   3.68 KB, patch | bzbarsky : [review+](#c47 "11 years ago") | [Details](/attachment.cgi?id=8447496&action=edit) | [Diff](/attachment.cgi?id=8447496&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8447496) |
| [Fix rev1](/attachment.cgi?id=8448846)  [11 years ago](#c52)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   4.20 KB, patch | bzbarsky : [review+](#c53 "11 years ago") | [Details](/attachment.cgi?id=8448846&action=edit) | [Diff](/attachment.cgi?id=8448846&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8448846) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Cătălin Badea (:catalinb)](/user_profile?user_id=488358)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1021240#c0)• 11 years ago |
|  | |

Attached file
[Test case](attachment.cgi?id=8435220)
— [Details](attachment.cgi?id=8435220&action=edit)

1. Create a video element with controls = true
2. Set the getter for the 'mozMediaStatisticsShowing' property to a function that calls alert
3. Add the video element to the dom tree.
4. Firefox freeze

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1021240#c1)• 11 years ago |
|  | |

This is OSX specific, right?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1021240#c2)• 11 years ago |
|  | |

Hrm... We're spinning the event loop in openTabPrompt in nsPrompter.js but for some reason not responding to clicks on the alert....

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1021240#c3)• 11 years ago |
|  | |

So is this a variant of [bug 953435](/show_bug.cgi?id=953435 "RESOLVED WORKSFORME - Browser hang on Mac if an AfterProcessNextEvent callback tries to spin the event loop")?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1021240#c4)• 11 years ago |
|  | |

Uh.... wait. WAIT. Why is videocontrols (and the browser context menu) doing:
XPCNativeWrapper.unwrap(this.video).mozMediaStatisticsShowing
? Is this a carryover from when we had no separate XBL scope that fields lived in or something?
Or put another way, why are we exposing this thing to the web page?Group: core-securityFlags: needinfo?(bobbyholley)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1021240#c5)• 11 years ago |
|  | |

> So is this a variant of [bug 953435](/show_bug.cgi?id=953435 "RESOLVED WORKSFORME - Browser hang on Mac if an AfterProcessNextEvent callback tries to spin the event loop")?
No (as best I can tell). That was fixed by my patch for [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281").

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1021240#c6)• 11 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #4](/show_bug.cgi?id=1021240#c4 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> ? Is this a carryover from when we had no separate XBL scope that fields
> lived in or something?
Fields don't work with XBL scopes - they have to live on the underlying object, which means that the binding can't see them.
> Or put another way, why are we exposing this thing to the web page?
Because that's the only place where this can live. Both XBL and chrome code need to munge this property, so it can't live as an expando on either Xray, since they're not same-origin.
<http://mxr.mozilla.org/mozilla-central/source/browser/base/content/nsContextMenu.js#448>
If it's a security problem for content to see this property, then yes, this is a problem. :-(Flags: needinfo?(bobbyholley)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1021240#c7)• 11 years ago |
|  | |

Attached file
[gdb all thread stack trace of hang](attachment.cgi?id=8435262)
— [Details](attachment.cgi?id=8435262&action=edit)

This was made with today's m-c nightly on OS X 10.8.5. Note that the native event loop is not being spun a second time.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1021240#c8)• 11 years ago |
|  | |

The hangs don't happen (with today's m-c nightly) on Windows 7.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1021240#c9)• 11 years ago |
|  | |

They also don't happen in FF 29.0.1 (on the Mac). I'll look for a regression range.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1021240#c10)• 11 years ago |
|  | |

The hang doesn't happen on Linux.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1021240#c11)• 11 years ago |
|  | |

These start happening with the following m-c nightly:
firefox-2014-04-17-03-02-03-mozilla-nightly
This implies the following regression range:
<http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=dd50745d7f35&tochange=e71ed4135461>

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1021240#c12)• 11 years ago |
|  | |

I can't figure out which patch triggered these hangs.
No, it's not my bandaid patch for [bug 959281](/show_bug.cgi?id=959281 "RESOLVED FIXED - http://paperjs.org/examples/voronoi/ drawing performance has regressed badly") (which is long gone from the trunk -- having been replaced by my patch for [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281")). And I've already checked that these hangs happen with or without my patch for [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281").

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1021240#c13)• 11 years ago |
|  | |

Could it possibly be this?
<http://hg.mozilla.org/mozilla-central/rev/9f9528ccd44b>
author Fabrice Desré <fabrice@mozilla.com>
Wed Apr 16 10:48:01 2014 -0700 (at Wed Apr 16 10:48:01 2014 -0700)
changeset 178889 9f9528ccd44b
I'll check when I get the chance.

|  | [John Schoenick [:johns]](/user_profile?user_id=429621) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1021240#c14)• 11 years ago |
|  | |

Another possible candidate?
[Bug 959787](/show_bug.cgi?id=959787 "RESOLVED FIXED - Handlify all unhandlified GCing interfaces in JSAPI") - Handlify JS\_DefineProperty; r=Waldo, r=bz
<http://hg.mozilla.org/mozilla-central/rev/1b7eef53c08a>

|  | [Cătălin Badea (:catalinb)](/user_profile?user_id=488358)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1021240#c15)• 11 years ago |
|  | |

(In reply to Steven Michaud from [comment #13](/show_bug.cgi?id=1021240#c13 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> Could it possibly be this?
>
> <http://hg.mozilla.org/mozilla-central/rev/9f9528ccd44b>
>
> author Fabrice Desré <fabrice@mozilla.com>
> Wed Apr 16 10:48:01 2014 -0700 (at Wed Apr 16 10:48:01 2014 -0700)
> changeset 178889 9f9528ccd44b
>
> I'll check when I get the chance.
I've checked this revision, the hang doesn't occur.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1021240#c16)• 11 years ago |
|  | |

I'm having trouble finding the patch that triggered these hangs. Reproducing this bug may require a universal build -- which I haven't been using since making them takes so long.
I'll try again tomorrow.

|  | [Cătălin Badea (:catalinb)](/user_profile?user_id=488358)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1021240#c17)• 11 years ago |
|  | |

(In reply to Steven Michaud from [comment #12](/show_bug.cgi?id=1021240#c12 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> I can't figure out which patch triggered these hangs.
>
> No, it's not my bandaid patch for [bug 959281](/show_bug.cgi?id=959281 "RESOLVED FIXED - http://paperjs.org/examples/voronoi/ drawing performance has regressed badly") (which is long gone from the
> trunk -- having been replaced by my patch for [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281")). And I've already
> checked that these hangs happen with or without my patch for [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281").
I've ran a git bisect on the range you mentioned and the bug was introduced on:
<http://hg.mozilla.org/mozilla-central/rev/c1a8921153d9>
author Steven Michaud <smichaud@pobox.com>
Wed Apr 16 09:59:15 2014 -0500 (at Wed Apr 16 09:59:15 2014 -0500)
changeset 178822 c1a8921153d9
[Bug 959281](/show_bug.cgi?id=959281 "RESOLVED FIXED - http://paperjs.org/examples/voronoi/ drawing performance has regressed badly") - <http://paperjs.org/examples/voronoi/> drawing performance has regressed badly. r=spohl

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1021240#c18)• 11 years ago |
|  | |

I'm \*very\* skeptical. Were you testing with universal builds, Cătălin?
In any case I'll continue my own tests tomorrow.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1021240#c19)• 11 years ago |
|  | |

> If it's a security problem for content to see this property, then yes, this is a
> problem.
I'm not sure it's a problem for content to see it, at first glance. What I don't know is whether it's a problem for content to \_spoof\_ it.
But also, this doesn't seem to be a field. It's just a property we set. Can we just move it to an actual IDL property exposed only to chrome and XBL scopes?
Note that the current setup was added in [bug 845555](/show_bug.cgi?id=845555 "VERIFIED FIXED - After showing statistics, context menu item to switch to hide statistics instead of offering to show statistics again") looks like.Flags: needinfo?(gijskruitbosch+bugs)

|  | [Cătălin Badea (:catalinb)](/user_profile?user_id=488358)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1021240#c20)• 11 years ago |
|  | |

(In reply to Steven Michaud from [comment #18](/show_bug.cgi?id=1021240#c18 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> I'm \*very\* skeptical. Were you testing with universal builds, Cătălin?
>
> In any case I'll continue my own tests tomorrow.
No, just 64-bit builds. Maybe the bug was fixed and reintroduced?

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1021240#c21)• 11 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #19](/show_bug.cgi?id=1021240#c19 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> But also, this doesn't seem to be a field. It's just a property we set.
There's not really any difference.
> Can we just move it to an actual IDL property exposed only to chrome and XBL
> scopes?
SGTM.
> Note that the current setup was added in [bug 845555](/show_bug.cgi?id=845555 "VERIFIED FIXED - After showing statistics, context menu item to switch to hide statistics instead of offering to show statistics again") looks like.
Yeah. See in particular [https://bugzilla.mozilla.org/show\_bug.cgi?id=845555#c7](/show_bug.cgi?id=845555#c7 "VERIFIED FIXED - After showing statistics, context menu item to switch to hide statistics instead of offering to show statistics again").

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1021240#c22)• 11 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #19](/show_bug.cgi?id=1021240#c19 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> > If it's a security problem for content to see this property, then yes, this is a
> > problem.
>
> I'm not sure it's a problem for content to see it, at first glance. What I
> don't know is whether it's a problem for content to \_spoof\_ it.
>
> But also, this doesn't seem to be a field. It's just a property we set.
> Can we just move it to an actual IDL property exposed only to chrome and XBL
> scopes?
>
> Note that the current setup was added in [bug 845555](/show_bug.cgi?id=845555 "VERIFIED FIXED - After showing statistics, context menu item to switch to hide statistics instead of offering to show statistics again") looks like.
See [https://bugzilla.mozilla.org/show\_bug.cgi?id=845555#c24](/show_bug.cgi?id=845555#c24 "VERIFIED FIXED - After showing statistics, context menu item to switch to hide statistics instead of offering to show statistics again") . I'm guessing that yes, we could theoretically move it to an actual IDL property, but as Bobby noted that he thought this was a design flaw, I'd rather do something better - I'm just not sure what that is. :-)
As for content spoofing the value: as far as I can tell, we basically treat it as a boolean throughout, and so content spoofing it would only mean that you wouldn't be able to show the statistics for a video (ie they'd set it to true constantly and you wouldn't be able to toggle it on) or would constantly show statistics (ie they set it to false when they notice you toggle them on, so you wouldn't be able to toggle it off)... which might be annoying but not life-threatening.Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1021240#c23)• 11 years ago |
|  | |

Attached patch

[,](attachment.cgi?id=8435815&action=diff) (obsolete)
— [Details](attachment.cgi?id=8435815&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435815)

So I presume that the suggestion is to do something like this, but this breaks the video controls code as it no longer gets access to the property in question. I've been poking at webidl docs and source but I can't find a way to give XBL access to the webidl chromeonly property.
[Attachment #8435815](/attachment.cgi?id=8435815&action=edit ",") -
Flags: feedback?(bzbarsky)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a65519_159069)• 11 years ago |

Assignee: cbadea → gijskruitbosch+bugsStatus: NEW → ASSIGNED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1021240#c24)• 11 years ago |
|  | |

Comment on [attachment 8435815](/attachment.cgi?id=8435815 ",") [[details]](/attachment.cgi?id=8435815&action=edit ",") [[diff]](/attachment.cgi?id=8435815&action=diff ",") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435815)
,
You need to set the member to false in the HTMLMediaElement constructor, presumably.
>+ [ChromeOnly] attribute boolean mozMediaStatisticsShowing;
s/ChromeOnly/Func="IsChromeOrXBL"/ should make this do what you want.
Also, please put it on the "Mozilla extensions" partial interface further in this file, not on the standards-stuff interface.
[Attachment #8435815](/attachment.cgi?id=8435815&action=edit ",") -
Flags: feedback?(bzbarsky) → feedback+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1021240#c25)• 11 years ago |
|  | |

Attached patch

[,](attachment.cgi?id=8435888&action=diff)
— [Details](attachment.cgi?id=8435888&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435888)

So this works, AFAICT. Thanks to Boris for dealing with my newbie questions and mistakes. :-) However, I'm concerned that (a) Bobby previously said this might not be the right approach, and (b) there are other bits of code in videocontrols.xml and in other parts of the tree (social, browser-element, the devtools actors, the TCPSocket implementation, the tps extension, ...) that use XPCNW.unwrap. I don't know how much of this is caused by .unwrap, and how much by other factors like alert-ing in the middle of showing a context menu, but I guess we should be sure that we're not painting too much of a bullseye on other code using XPCNW.unwrap if we think it's also (potentially) vulnerable in one way or another.
[Attachment #8435888](/attachment.cgi?id=8435888&action=edit ",") -
Flags: review?(jaws)
[Attachment #8435888](/attachment.cgi?id=8435888&action=edit ",") -
Flags: review?(bobbyholley)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a74002_159069)• 11 years ago |

[Attachment #8435815](/attachment.cgi?id=8435815&action=edit ",") -
Attachment is obsolete: true

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1021240#c26)• 11 years ago |
|  | |

I think we should fundamentally assume that any use of .wrappedJSObject or XPCNW.unwrap is a security bug unless proven otherwise, and we've known that (and have been telling people that) for years...
For this bug, there are two separate issues:
1) The freezing. That's an issue with alert running when it runs in this testcase, and needs fixing no matter what.
2) The fact that we let content spoof this property. That's what your patch fixes.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1021240#c27)• 11 years ago |
|  | |

Comment on [attachment 8435888](/attachment.cgi?id=8435888 ",") [[details]](/attachment.cgi?id=8435888&action=edit ",") [[diff]](/attachment.cgi?id=8435888&action=diff ",") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435888)
,
Review of [attachment 8435888](/attachment.cgi?id=8435888 ",") [[details]](/attachment.cgi?id=8435888&action=edit ",") [[diff]](/attachment.cgi?id=8435888&action=diff ",") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435888):
-----------------------------------------------------------------
LGTM
(In reply to :Gijs Kruitbosch from [comment #25](/show_bug.cgi?id=1021240#c25 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> However, I'm concerned that (a) Bobby previously said this
> might not be the right approach
What specifically are you referring to?
[Attachment #8435888](/attachment.cgi?id=8435888&action=edit ",") -
Flags: review?(bobbyholley) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1021240#c28)• 11 years ago |
|  | |

(In reply to Bobby Holley (:bholley) from [comment #27](/show_bug.cgi?id=1021240#c27 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> Comment on [attachment 8435888](/attachment.cgi?id=8435888 ",") [[details]](/attachment.cgi?id=8435888&action=edit ",") [[diff]](/attachment.cgi?id=8435888&action=diff ",") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435888)
> ,
>
> Review of [attachment 8435888](/attachment.cgi?id=8435888 ",") [[details]](/attachment.cgi?id=8435888&action=edit ",") [[diff]](/attachment.cgi?id=8435888&action=diff ",") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8435888):
> -----------------------------------------------------------------
>
> LGTM
>
> (In reply to :Gijs Kruitbosch from [comment #25](/show_bug.cgi?id=1021240#c25 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> > However, I'm concerned that (a) Bobby previously said this
> > might not be the right approach
>
> What specifically are you referring to?
[https://bugzilla.mozilla.org/show\_bug.cgi?id=845555#c24](/show_bug.cgi?id=845555#c24 "VERIFIED FIXED - After showing statistics, context menu item to switch to hide statistics instead of offering to show statistics again")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1021240#c29)• 11 years ago |
|  | |

Could you file a new sec bug for the spoofing issue, assuming that you aren't also planning on fixing the hang issue? Thanks.

|  | [Jared Wein [:jaws] (please needinfo? me)](/user_profile?user_id=409754) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a79193_409754)• 11 years ago |

[Attachment #8435888](/attachment.cgi?id=8435888&action=edit ",") -
Flags: review?(jaws) → review+

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1021240#c30)• 11 years ago |
|  | |

My bandaid patch for [bug 959281](/show_bug.cgi?id=959281 "RESOLVED FIXED - http://paperjs.org/examples/voronoi/ drawing performance has regressed badly") \*does\* trigger these hangs, as Cătălin reported in [comment #17](/show_bug.cgi?id=1021240#c17 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox").
I was confused by the fact that "later" patches in the regression range \*didn't\* include that patch in the tree they were based upon.
The hangs aren't going to be easy to fix. Fortunately they don't seem to happen often.
Once we decide which bug follows the hangs, I'll assign it to myself. If need be I'll open a new bug.

|  | [Bobby Holley (:bholley)](/user_profile?user_id=313730) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1021240#c31)• 11 years ago |
|  | |

(In reply to :Gijs Kruitbosch from [comment #28](/show_bug.cgi?id=1021240#c28 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> > What specifically are you referring to?
>
> [https://bugzilla.mozilla.org/show\_bug.cgi?id=845555#c24](/show_bug.cgi?id=845555#c24 "VERIFIED FIXED - After showing statistics, context menu item to switch to hide statistics instead of offering to show statistics again")
That was about Xray expandos, not WebIDL properties with visibility restrictions, which is what this new patch does.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a91052_159069)• 11 years ago |

Blocks: [1021969](/show_bug.cgi?id=1021969 "VERIFIED FIXED - mozMediaStatisticsShowing property shouldn't be content-exposed")

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1021240#c32)• 11 years ago |
|  | |

(In reply to Andrew McCreight [:mccr8] from [comment #29](/show_bug.cgi?id=1021240#c29 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> Could you file a new sec bug for the spoofing issue, assuming that you
> aren't also planning on fixing the hang issue? Thanks.
Done.Assignee: gijskruitbosch+bugs → nobodyStatus: ASSIGNED → NEW

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1021240#c33)• 11 years ago |
|  | |

(note that the patch here, for [bug 1021969](/show_bug.cgi?id=1021969 "VERIFIED FIXED - mozMediaStatisticsShowing property shouldn't be content-exposed") does 'fix' this issue by making us ignore the content-defined getter, but not the underlying issue of the hang)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1021240#c34)• 11 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] from [comment #2](/show_bug.cgi?id=1021240#c2 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> Hrm... We're spinning the event loop in openTabPrompt in nsPrompter.js but
> for some reason not responding to clicks on the alert....
FWIW, when I run this testcase pre-patch with tab-modal dialogs turned off, I get an app-modal rather than tab-modal dialog (as expected), and it \*does\* show up, but I can't interact with it, and switching to a different app and back with cmd-tab doesn't reshow the browser window - in other words, it also hangs.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1021240#c35)• 11 years ago |
|  | |

Steven, this bug is about the hang.Assignee: nobody → smichaud

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1021240#c36)• 11 years ago |
|  | |

(In reply to [comment #34](/show_bug.cgi?id=1021240#c34 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
What you say makes it more likely that these hangs are a bug uncovered by my patches (the bandaid patch for [bug 959281](/show_bug.cgi?id=959281 "RESOLVED FIXED - http://paperjs.org/examples/voronoi/ drawing performance has regressed badly") and the patch for [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281")). I sounds like nsAppShell::ProcessNextNativeEvent() is being called with aMayWait == false while the alert (a modal dialog) is open (aMayWait should be true in that case).
If so, this bug won't be so hard to fix. But it may be a week or two before I can get back to it -- I've got other, more urgent stuff to deal with.

|  | [Cody Crews](/user_profile?user_id=457276) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1021240#c37)• 11 years ago |
|  | |

This is really intense for such a simple thing. My aim here was to try to use this as part of the two way bridge you have to build to clone or manipulate any anonymous(XBL) content. I do know that it can cause a hang on linux too if used in combination with multiple modal dialogs being opened. BTW its right that a simple grep led me this and other instances of XPCNativeWrapper.unwrap being used. You could do a quick search on mxr.mozilla.org and have a nice set of potential code to try to target. I also have my eyes on breaking the XPCNativeWrapper captive out of its cross domain sandbox prison!

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a410032_406194)• 11 years ago |

Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1021240#c38)• 11 years ago |
|  | |

I think I finally understand why these hangs are happening, and (at
least in part) why only on OS X.
As I discovered working on [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281"), we want to do as little as
possible when nsAppShell::ProcessNextNativeEvent() is called with
!aMayWait. (For more information see [bug 996848 comment #0](/show_bug.cgi?id=996848#c0 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281"), and
particularly the two comments it refers to from [bug 959281](/show_bug.cgi?id=959281 "RESOLVED FIXED - http://paperjs.org/examples/voronoi/ drawing performance has regressed badly").)
aMayWait is normally true in nsAppShell::ProcessNextNativeEvent() when
a modal dialog is open (and it's processing events). In this case
it's normally called from here:
<https://hg.mozilla.org/mozilla-central/annotate/3519e987aa3b/widget/xpwidgets/nsBaseAppShell.cpp#l298>
But this call doesn't happen if there are events remaining to be
processed in the Gecko event queue. And in this bug's case, a
pathological condition prevents the Gecko event queue from ever being
empty at that point.
To decipher this bug I backed out the patches for [bug 1021969](/show_bug.cgi?id=1021969 "VERIFIED FIXED - mozMediaStatisticsShowing property shouldn't be content-exposed") (so that
this bug's testcase would continue to "work"), and added some debug
logging (which I'll post in a later comment). With this patch I saw
the Gecko event queue continuously being refilled with the following
two nsIRunnable events:
20nsRunnableMethodImplIM16nsBindingManagerFvvEvLb1EE
(nsRunnableMethodImpl<void (nsBindingManager::\*)(), void, true>)
20nsUnblockOnloadEvent
(nsUnblockOnloadEvent)
The "refilling" takes place here:
<https://hg.mozilla.org/mozilla-central/annotate/3519e987aa3b/dom/xbl/nsBindingManager.cpp#l387>
This code fights back against "someone [evil] doing event processing
from inside a constructor". I assume "constructor" means an
nsCSSFrameConstructor, invoked from
nsBindingManager::ProcessAttachedQueue().
If you look at the stack trace from [comment #7](/show_bug.cgi?id=1021240#c7 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"), you'll see calls to
nsThread::ProcessNextEvent() being made while
nsBindingManager::ProcessAttachedQueue() is on the stack. I assume
this is the "evil" that nsBindingManager::DoProcessAttachedQueue() is
fighting back against.
I'm not sure what we can or should do about this. Ultimately I think
we need to disallow modal dialogs while
nsBindingManager::DoProcessAttachedQueue() is on the stack. But in
the meantime I suspect we can get away with doing nothing. I doubt
very much that this situation comes up often.
I intend to mark this bug WONTFIX. Please comment if you don't think
we should do that.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1021240#c39)• 11 years ago |
|  | |

Attached patch

[Debug logging patch (not a fix)](attachment.cgi?id=8446812&action=diff)
— [Details](attachment.cgi?id=8446812&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8446812)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1021240#c40)• 11 years ago |
|  | |

Comment on [attachment 8446812](/attachment.cgi?id=8446812 "Debug logging patch (not a fix)") [[details]](/attachment.cgi?id=8446812&action=edit "Debug logging patch (not a fix)") [[diff]](/attachment.cgi?id=8446812&action=diff "Debug logging patch (not a fix)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8446812)
Debug logging patch (not a fix)
I forgot to mention that you need to add the following to your mozconfig to use this patch:
ac\_add\_options --enable-cpp-rtti

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1021240#c41)• 11 years ago |
|  | |

> I assume "constructor" means an nsCSSFrameConstructor,
No, it means an XBL <constructor> (so basically some JS that ProcessAttachedQueue causes to run). In this case, that's exactly what we have: the <binding id="videoControls"> in videocontrols.xml has a <constructor> that in the attached testcase is calling some web page script that does alert(), which spins the event loop.
> I assume this is the "evil" that nsBindingManager::DoProcessAttachedQueue() is
> fighting back against.
That's the theory.
So basically, we end up in a situation where we're asked to fire XBL constructors while we're already inside an XBL constructor. The binding manager tries to deal with that situation by deferring the firing until that other constructor finishes.
Would it work to post a 0ms (or longer?) timer instead of directly posting an event to the event queue? That might at least give the main-thread event queue a chance to clear and process some OS events, right?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1021240#c42)• 11 years ago |
|  | |

main thread event loop should always process OS level events occasionally while it is processing
nsIRunnables. (And in case of non-performance-mode, it should even prioritize OS level events.)
<http://mxr.mozilla.org/mozilla-central/source/widget/xpwidgets/nsBaseAppShell.cpp#274>
But I don't really understand the main event loop handling on OSX. It seems to be all different
to other platforms.
Do we in this case end up having mBlockNativeEvent == true, and then pass mayWait == false ?
But even then we have starvation limit
<http://mxr.mozilla.org/mozilla-central/source/widget/xpwidgets/nsBaseAppShell.cpp#98>

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1021240#c43)• 11 years ago |
|  | |

(In reply to [comment #42](/show_bug.cgi?id=1021240#c42 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
As of my bandaid patch for [bug 959281](/show_bug.cgi?id=959281 "RESOLVED FIXED - http://paperjs.org/examples/voronoi/ drawing performance has regressed badly") and my patch for [bug 996848](/show_bug.cgi?id=996848 "VERIFIED FIXED - Rewrite nsAppShell native event handling in light of what's been learned at bug 959281") that superseded it, we do very little processing of native events (on OS X) in nsAppShell::ProcessNextNativeEvent() when aMayWait is false. And we don't process any "user events" (e.g. mouse events and keyboard events) at all. For complicated reasons alluded to in the second paragraph of [comment #38](/show_bug.cgi?id=1021240#c38 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox") above, this can't be changed. (When we refuse to process a native event in nsAppShell::ProcessNextNativeEvent(), we leave it in the event queue and it eventually gets processed under [NSApp run], called from nsAppShell::Run().)
(In reply to [comment #41](/show_bug.cgi?id=1021240#c41 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
I'll try what you suggest and see if I can get it working.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1021240#c44)• 11 years ago |
|  | |

Here's what I see as the most significant difference in how events are handled between Windows and Linux on the one hand, and OS X on the other:
Windows and Linux have a native event queue for each window. So it isn't too difficult to add a Gecko event queue (for processing nsIRunnable events) on top of that.
OS X has just one native event queue, for the entire app. So it's much more complicated to add a Gecko event queue on top of it, and to avoid bad interactions between them. Over time we've found that it's best to avoid "interleaving" them (to have multiple instances of each kind of event loop on the stack at the same time). This is unavoidable with modal dialogs, but we still want to keep the "interleaving" as simple as possible (to have as few instances of event loops on the stack as possible on the stack at the same time).

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1021240#c45)• 11 years ago |
|  | |

(Following up [comment #43](/show_bug.cgi?id=1021240#c43 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox"))
> (When we refuse to process a native event in
> nsAppShell::ProcessNextNativeEvent(), we leave it in the event queue
> and it eventually gets processed under [NSApp run], called from
> nsAppShell::Run().)
Unless a modal dialog is running, as in this bug's case.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1021240#c46)• 11 years ago |
|  | |

Attached patch

[Fix](attachment.cgi?id=8447496&action=diff) (obsolete)
— [Details](attachment.cgi?id=8447496&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8447496)

Thanks, Boris. Your suggestion worked like a charm!
A delay of 0 didn't work -- the Gecko event queue still stayed full. Next I tried a delay of 100 (1/10th of a second), which does work in my tests. Not wanting to cut things too finely, I didn't test values in between. A polling interval of 1/10th of a second doesn't seem unreasonable to me -- neither too long nor too short. And I made sure that we won't leave dangling pointers.
[Attachment #8447496](/attachment.cgi?id=8447496&action=edit "Fix") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1021240#c47)• 11 years ago |
|  | |

Comment on [attachment 8447496](/attachment.cgi?id=8447496 "Fix") [[details]](/attachment.cgi?id=8447496&action=edit "Fix") [[diff]](/attachment.cgi?id=8447496&action=diff "Fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8447496)
Fix
I worry a bit about this introducing ordering issues. I'd much prefer a 10ms timer here, not a 100ms one.
>+ nsRefPtr<nsBindingManager> mgr = static\_cast<nsBindingManager\*>(aClosure);
How about:
nsRefPtr<nsBindingManager> mgr =
already\_AddRefed<nsBindingManager>(static\_cast<nsBindingManager\*>(aClosure));
and then you don't need the manual NS\_RELEASE.
You can just forward-declare nsITimer in the header, and include nsITimer.h just in the cpp.
r=me with that
[Attachment #8447496](/attachment.cgi?id=8447496&action=edit "Fix") -
Flags: review?(bzbarsky) → review+

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1021240#c48)• 11 years ago |
|  | |

> I'd much prefer a 10ms timer here, not a 100ms one.
I'll test with one next week.
I'll incorporate your other comments into my next patch.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1021240#c49)• 11 years ago |
|  | |

I don't quite understand [comment 44](/show_bug.cgi?id=1021240#c44 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox").
For example on gtk we end up calling
<https://developer.gnome.org/glib/2.32/glib-The-Main-Event-Loop.html#g-main-context-iteration>
between nsIRunnable handling. g\_main\_context\_iteration isn't per window, like our appshell isn't per window.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1021240#c50)• 11 years ago |
|  | |

I don't know a whole lot about Linux event handling. But I thought X, like Windows, has separate event loops for each window.
> like our appshell isn't per window
Correct. The Gecko event loop is per-app. But I was talking about \*native\* event loops.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1021240#c51)• 11 years ago |
|  | |

And AppShell on linux calls g\_main\_context\_iteration, which spins gdk event loop. Nothing window specific there.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1021240#c52)• 11 years ago |
|  | |

Attached patch

[Fix rev1](attachment.cgi?id=8448846&action=diff)
— [Details](attachment.cgi?id=8448846&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8448846)

> I'd much prefer a 10ms timer here, not a 100ms one.
A 10ms timer doesn't work.
For some reason, faster machines require longer timer delays. On my fastest machine (a two-year old Retina MacBook Pro), testing in 5ms increments, I discovered that the shortest workable timer delay is 60ms. But if we want this patch to work on all machines, we shouldn't cut things so close. So I've stuck with my original 100ms delay.
This patch follows your other recommendations.
[Attachment #8447496](/attachment.cgi?id=8447496&action=edit "Fix") -
Attachment is obsolete: true
[Attachment #8448846](/attachment.cgi?id=8448846&action=edit "Fix rev1") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1021240#c53)• 11 years ago |
|  | |

Comment on [attachment 8448846](/attachment.cgi?id=8448846 "Fix rev1") [[details]](/attachment.cgi?id=8448846&action=edit "Fix rev1") [[diff]](/attachment.cgi?id=8448846&action=diff "Fix rev1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8448846)
Fix rev1
r=me, but we should expect extension/UI regressions....
[Attachment #8448846](/attachment.cgi?id=8448846&action=edit "Fix rev1") -
Flags: review?(bzbarsky) → review+

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1021240#c54)• 11 years ago |
|  | |

Thanks Boris. I'll land my patch on trunk.
> but we should expect extension/UI regressions....
If we get them, I'd say we should back out my patch and go back to my original plan of WONTFIXing this bug. And we should then consider disallowing modal dialogs while nsBindingManager::DoProcessAttachedQueue() is on the stack.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1021240#c55)• 11 years ago |
|  | |

Comment on [attachment 8448846](/attachment.cgi?id=8448846 "Fix rev1") [[details]](/attachment.cgi?id=8448846&action=edit "Fix rev1") [[diff]](/attachment.cgi?id=8448846&action=diff "Fix rev1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1021240&attachment=8448846)
Fix rev1
Landed on mozilla-inbound:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/e07896399710>

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1021240#c56)• 11 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e07896399710>Status: NEW → RESOLVEDClosed: 11 years ago
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla33

|  | [Lukas Blakk [:lsblakk] use ?needinfo](/user_profile?user_id=272375) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a2349351_272375)• 11 years ago |

[status-firefox-esr24](/buglist.cgi?f1=cf_status_firefox_esr24&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr24&o1=equals&v1=wontfix)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a10641172_280903)• 10 years ago |

Whiteboard: [adv-main33-]

|  | [Kamil Jozwiak [:kjozwiak]](/user_profile?user_id=455785) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1021240#c57)• 10 years ago |
|  | |

Reproduced the original issue using the following build:
- <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014/06/2014-06-05-03-02-02-mozilla-central/>
- used the poc from [comment #0](/show_bug.cgi?id=1021240#c0 "VERIFIED FIXED - Calling alert from 'mozMediaStatisticsShowing' property getter freezes Firefox") and clicked in the window, m-c completely froze
Verified using the following builds:
- <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014/07/2014-07-05-03-02-03-mozilla-central/>
- <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-10-07-03-02-02-mozilla-central/>
- <http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/2014-10-07-00-40-03-mozilla-aurora/>
- <http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/33.0b9/mac/en-US/>
For each of the above builds, I opened the poc in several windows/tabs (including Private/e10s) and ensured the issue wasn't occurring.Status: RESOLVED → VERIFIED
[status-firefox33](/buglist.cgi?f1=cf_status_firefox33&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox33&o1=equals&v1=verified)Flags: qe-verify+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a10804439_1689)• 10 years ago |

[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=wontfix)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a39178059_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a63082293_1689)• 9 years ago |

Group: core-security-release

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1021240#a150485481_1)• 6 years ago |

Component: DOM → DOM: Core & HTML
You need to [log in](/show_bug.cgi?id=1021240&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Cătălin Badea (:catalinb)](/user_profile?user_id=488358)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


