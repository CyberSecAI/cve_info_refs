=== Content from bazaar.launchpad.net_a8f864f8_20250124_170216.html ===


[← Back to branch summary](https://code.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging)
# ~ubuntu-sdk-team/ubuntu-ui-toolkit/staging

* [Changes](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/changes "Changes")
* [Files](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/files "Files")

[~ubuntu-sdk-team/ubuntu-ui-toolkit/staging](https://code.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging)
» Revision
1182

# Viewing all changes in revision 1182.

* [browse files at revision 1182](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/files/1182 "browse files at revision 1182")
* [compare with another revision](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182?remember=1182 "compare with another revision")
* [download diff](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/diff/1182)
* [download tarball](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/tarball/1182)
* [view history from revision 1182](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/changes/1182 "view history from revision 1182")

* **Committer:**
  Tarmac
* **Author(s):**
  Zsombor Egri
* **Date:**
  2014-08-07 00:40:00 UTC
* **mfrom:**
  [(1181.1.2 10-statesaverpath)](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1181.1.2 "Merged From 1181.1.2")
* **Revision ID:**
  tarmac-20140807004000-yspd7onznq6zfq1a

StateSaverÂ toÂ saveÂ stateÂ filesÂ toÂ runtimeÂ locationÂ insteadÂ ofÂ /tmpÂ folder.Â Fixes:Â https://bugs.launchpad.net/bugs/1348241.

ApprovedÂ byÂ PSÂ JenkinsÂ bot,Â ChristianÂ Dywan.

+ files modified:
+ [modules/Ubuntu/Components/plugin/statesaverbackend\_p.cpp](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182/modules/Ubuntu/Components/plugin/statesaverbackend_p.cpp#modules/Ubuntu/Components/plugin/statesaverbackend_p.cpp "View changes to modules/Ubuntu/Components/plugin/statesaverbackend_p.cpp in revision 1182")

+ [tests/unit\_x11/tst\_statesaver/tst\_statesaver.cpp](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182/tests/unit_x11/tst_statesaver/tst_statesaver.cpp#tests/unit_x11/tst_statesaver/tst_statesaver.cpp "View changes to tests/unit_x11/tst_statesaver/tst_statesaver.cpp in revision 1182")

![expand all](/static/images/treeCollapsed.png) expand all

![collapse all](/static/images/treeExpanded.png) collapse all

Show diffs side-by-side

![added](/static/images/newCode.gif) added

![removed](/static/images/deleteCode.gif) removed

Lines of Context:

[![](/static/images/treeCollapsed.png)
modules/Ubuntu/Components/plugin/statesaverbackend\_p.cpp](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182/modules/Ubuntu/Components/plugin/statesaverbackend_p.cpp "View changes to modules/Ubuntu/Components/plugin/statesaverbackend_p.cpp only")

![](/static/images/spinner.gif)

[![](/static/images/treeCollapsed.png)
tests/unit\_x11/tst\_statesaver/tst\_statesaver.cpp](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182/tests/unit_x11/tst_statesaver/tst_statesaver.cpp "View changes to tests/unit_x11/tst_statesaver/tst_statesaver.cpp only")

![](/static/images/spinner.gif)

* [Older »](/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/2189?start_revid=2190)

Loggerhead is a web-based interface for [Breezy](https://www.breezy-vcs.org/)

Version: 2.0.1



=== Content from launchpad.net_cae6b9f8_20250124_170218.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu-ui-toolkit/%2Bbug/1348241/%2Blogin)

[![](/@@/product-logo)](https://launchpad.net/ubuntu-ui-toolkit)

## [Ubuntu UI Toolkit](https://launchpad.net/ubuntu-ui-toolkit)

* [Overview](https://launchpad.net/ubuntu-ui-toolkit)
* [Code](https://code.launchpad.net/ubuntu-ui-toolkit)
* [Bugs](https://bugs.launchpad.net/ubuntu-ui-toolkit)
* [Blueprints](https://blueprints.launchpad.net/ubuntu-ui-toolkit)
* [Translations](https://translations.launchpad.net/ubuntu-ui-toolkit)
* [Answers](https://answers.launchpad.net/ubuntu-ui-toolkit)

# StateSaver serializes potentially sensitive data under /tmp, doesn’t use O\_EXCL

Bug #1348241 reported by
[Olivier Tilloy](https://launchpad.net/~osomon)
on 2014-07-24

[258](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Ubuntu UI Toolkit](https://bugs.launchpad.net/ubuntu-ui-toolkit) | Fix Released | Critical | [Zsombor Egri](https://launchpad.net/~zsombi) |  |
|  | [ubuntu-ui-toolkit (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-ui-toolkit "Latest release: 1.3.1918+16.04.20160404-0ubuntu1, uploaded to main on 2016-04-08 14:19:12.699722+00:00 by Zoltan Balogh (bzoltan), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Fix Released | Undecided | Unassigned |  |
|  | [Trusty](https://bugs.launchpad.net/ubuntu/trusty/%2Bsource/ubuntu-ui-toolkit) | Confirmed | Low | Unassigned |  |
|  | [Utopic](https://bugs.launchpad.net/ubuntu/utopic/%2Bsource/ubuntu-ui-toolkit) | Fix Released | Undecided | Unassigned |  |
|  | [Vivid](https://bugs.launchpad.net/ubuntu/vivid/%2Bsource/ubuntu-ui-toolkit) | New | Undecided | Unassigned |  |

### Bug Description

This issue applies to desktop only, where StateSaver serializes data in files under /tmp. On devices, confined applications have their own TMPDIR, which makes it a non-issue, as far as I understand it.

StateSaver uses QSettings under the hood to persist data on disk, which issues a plain QFile::open(QFile::ReadWrite) call to open the file, which does not set the O\_EXCL flag.

This makes it vulnerable to symlink attacks.

Using QTemporaryFile would solve this issue, but it might not be easy to do with QSettings.

See [original description](comments/0)

Tags:

[statesaver](/ubuntu-ui-toolkit/%2Bbugs?field.tag=statesaver)

## Related branches

[lp:~zsombi/ubuntu-ui-toolkit/statesaver-path](https://code.launchpad.net/~zsombi/ubuntu-ui-toolkit/statesaver-path)
![](/@@/merge-proposal-icon)
[Merged](https://code.launchpad.net/~zsombi/ubuntu-ui-toolkit/statesaver-path/%2Bmerge/229762)
into
[lp:ubuntu-ui-toolkit/staging](https://code.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging)
at
[revision 1182](https://bazaar.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182)

[PS Jenkins bot](https://launchpad.net/~ps-jenkins):
Approve
(continuous-integration)
on 2014-08-07

[Cris Dywan](https://launchpad.net/~kalikiana):
Approve
on 2014-08-06

Diff: [24 lines (+2/-2)](https://code.launchpad.net/~zsombi/ubuntu-ui-toolkit/statesaver-path/%2Bmerge/229762/%2Bpreview-diff/545685/%2Bfiles/preview.diff)2 files modifiedmodules/Ubuntu/Components/plugin/statesaverbackend\_p.cpp (+1/-1)
tests/unit\_x11/tst\_statesaver/tst\_statesaver.cpp (+1/-1)
[api](/~zsombi/ubuntu-ui-toolkit/statesaver-path/%2Bmerge/229762/%2Bpreview-diff/545685)

## CVE References

* [2014-1420](/bugs/cve/2014-1420 "On desktop, Ubuntu UI Toolkit's State...")

[Olivier Tilloy (osomon)](https://launchpad.net/~osomon)
on 2014-07-24

| **description**: | updated |
| --- | --- |

[Zsombor Egri (zsombi)](https://launchpad.net/~zsombi)
on 2014-07-24

| Changed in ubuntu-ui-toolkit: | |
| --- | --- |
| **assignee**: | nobody → Zsombor Egri (zsombi) |
| **tags**: | added: statesaver |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur) wrote on 2014-07-24: |  |  | [#1](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/1) |
| --- | --- | --- | --- |

from modules/Ubuntu/Components/plugin/statesaverbackend\_p.cpp:

m\_archive = new QSettings(QString("%1/%2.state")

                              .arg(QStandardPaths::standardLocations(QStandardPaths::TempLocation)[0])

                              .arg(applicationName), QSettings::NativeFormat);

QStandardPaths::TempLocation is /tmp by default.

This gets CVE-2014-1420

from modules/Ubuntu/Components/plugin/statesaverbackend\_p.cpp:
m\_archive = new QSettings(QString("%1/%2.state")
.arg(QStandardPaths::standardLocations(QStandardPaths::TempLocation)[0])
.arg(applicationName), QSettings::NativeFormat);
QStandardPaths::TempLocation is /tmp by default.
This gets CVE-2014-1420

| Changed in ubuntu-ui-toolkit (Ubuntu Trusty): | |
| --- | --- |
| **status**: | New → Confirmed |
| Changed in ubuntu-ui-toolkit (Ubuntu Utopic): | |
| **status**: | New → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Zsombor Egri (zsombi)](https://launchpad.net/~zsombi) wrote on 2014-07-25: |  |  | [#2](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/2) |
| --- | --- | --- | --- |

Yes, the temp folder has been used until we get a proper path for it. Seems we can use XDG\_RUNTIME\_DIR i.e. QStandardPaths::RuntimeLocation for it as it will be cleared on reboot same way as /tmp is.

Yes, the temp folder has been used until we get a proper path for it. Seems we can use XDG\_RUNTIME\_DIR i.e. QStandardPaths::RuntimeLocation for it as it will be cleared on reboot same way as /tmp is.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Zsombor Egri (zsombi)](https://launchpad.net/~zsombi) wrote on 2014-08-06: |  |  | [#3](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/3) |
| --- | --- | --- | --- |

I'm afraid we are not gonna be able to fix this for Trusty, only for Utopic. We have been asked not to back port toolkit to Trusty.

I'm afraid we are not gonna be able to fix this for Trusty, only for Utopic. We have been asked not to back port toolkit to Trusty.

| Changed in ubuntu-ui-toolkit: | |
| --- | --- |
| **importance**: | Undecided → Critical |
| **status**: | New → Confirmed |
| Changed in ubuntu-ui-toolkit (Ubuntu Trusty): | |
| **status**: | Confirmed → Invalid |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Olivier Tilloy (osomon)](https://launchpad.net/~osomon) wrote on 2014-08-06: |  |  | [#4](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/4) |
| --- | --- | --- | --- |

Then the status should probably be "Won’t Fix", not "Invalid".

Then the status should probably be "Won’t Fix", not "Invalid".

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Zsombor Egri (zsombi)](https://launchpad.net/~zsombi) wrote on 2014-08-06: |  |  | [#5](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/5) |
| --- | --- | --- | --- |

I'm sorry, Olivier, I cannot set it to "Won't fix". It doesn't let me do that.

I'm sorry, Olivier, I cannot set it to "Won't fix". It doesn't let me do that.

[David Planella (dpm)](https://launchpad.net/~dpm)
on 2014-08-06

| Changed in ubuntu-ui-toolkit (Ubuntu Trusty): | |
| --- | --- |
| **status**: | Invalid → Won't Fix |

[Zsombor Egri (zsombi)](https://launchpad.net/~zsombi)
on 2014-08-06

| Changed in ubuntu-ui-toolkit: | |
| --- | --- |
| **status**: | Confirmed → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur) wrote on 2014-08-06: |  |  | [#6](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/6) |
| --- | --- | --- | --- |

Not fixing this for trusty is not an option. This package is in the main pocket, which means it is officially supported for the life of the LTS release, including security updates.

If someone can confirm that the fix in the merge request above also applies to Trusty, the security team can push out the fix.

Not fixing this for trusty is not an option. This package is in the main pocket, which means it is officially supported for the life of the LTS release, including security updates.
If someone can confirm that the fix in the merge request above also applies to Trusty, the security team can push out the fix.

| Changed in ubuntu-ui-toolkit (Ubuntu Trusty): | |
| --- | --- |
| **status**: | Won't Fix → Confirmed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [PS Jenkins bot (ps-jenkins)](https://launchpad.net/~ps-jenkins) wrote on 2014-08-07: |  |  | [#7](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/7) |
| --- | --- | --- | --- |

Fix committed into [lp:~ubuntu-sdk-team/ubuntu-ui-toolkit/staging](/%2Bcode/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging) at revision None, scheduled for release in ubuntu-ui-toolkit, milestone Unknown

Fix committed into lp:~ubuntu-sdk-team/ubuntu-ui-toolkit/staging at revision None, scheduled for release in ubuntu-ui-toolkit, milestone Unknown

| Changed in ubuntu-ui-toolkit: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Zsombor Egri (zsombi)](https://launchpad.net/~zsombi) wrote on 2014-08-07: |  |  | [#8](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/8) |
| --- | --- | --- | --- |

Marc, as you said, Trusty has this, and therefore the fix also applies to Trusty too.

Marc, as you said, Trusty has this, and therefore the fix also applies to Trusty too.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marc Deslauriers (mdeslaur)](https://launchpad.net/~mdeslaur) wrote on 2014-09-05: |  |  | [#9](/ubuntu-ui-toolkit/%2Bbug/1348241/comments/9) |
| --- | --- | --- | --- |

This was fixed in ubuntu-ui-toolkit (1.1.1188+14.10.20140813.4-0ubuntu1)

by <http://bazaar.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182>

This was fixed in ubuntu-ui-toolkit (1.1.1188+14.10.20140813.4-0ubuntu1)
by http://bazaar.launchpad.net/~ubuntu-sdk-team/ubuntu-ui-toolkit/staging/revision/1182

| **information type**: | Private Security → Public Security |
| --- | --- |
| Changed in ubuntu-ui-toolkit (Ubuntu Utopic): | |
| **status**: | Confirmed → Fix Released |
| Changed in ubuntu-ui-toolkit (Ubuntu Trusty): | |
| **importance**: | Undecided → Low |

[Zoltan Balogh (bzoltan)](https://launchpad.net/~bzoltan)
on 2014-10-01

| Changed in ubuntu-ui-toolkit: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[See full activity log](https://bugs.launchpad.net/ubuntu-ui-toolkit/%2Bbug/1348241/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu-ui-toolkit/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu-ui-toolkit/%2Bbug/1348241/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu-ui-toolkit/%2Bbug/1348241/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu-ui-toolkit/%2Bbug/1348241/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
4d55102
([Get the code!](https://dev.launchpad.net/))


