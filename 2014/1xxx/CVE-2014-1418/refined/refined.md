```
Message-ID: <20140514193755.GA21035@eldamar.local>
Date: Wed, 14 May 2014 21:37:55 +0200
From: Salvatore Bonaccorso <carnil@...ian.org>
To: oss-security@...ts.openwall.com
Cc: cve-assign@...re.org, security@...ngoproject.com
Subject: CVE Reuest: Django: Malformed URLs from user input incorrectly
 validated

Hi

The Django project announced a new security release today:

<https://www.djangoproject.com/weblog/2014/may/14/security-releases-issued/>

It fixes two issues, for which one has already a CVE (CVE-2014-1418).
It also fixes a second issue, for which a CVE is missing, quoting from
the announcement:

> Issue: Malformed URLs from user input incorrectly validated
> The validation for redirects did not correctly validate some malformed
> URLs, which are accepted by some browsers. This allows a user to be
> redirected to an unsafe URL unexpectedly.
>
> Django relies on user input in some cases (e.g.
> django.contrib.auth.views.login, django.contrib.comments, and i18n) to
> redirect the user to an "on success" URL. The security checks for
> these redirects (namely django.util.http.is_safe_url()) did not
> correctly validate some malformed URLs, such as
> http:\\\djangoproject.com, which are accepted by some browsers with
> more liberal URL parsing.
>
> To remedy this, the validation in is_safe_url() has been tightened to
> be able to handle and correctly validate these malformed URLs.
>
> Thanks to Peter Kuma and Gavin Wahl for reporting this issue to us.

Fixes for the various branches are also referenced. Could a CVE also
be assigned for this second issue?

Thanks in advance.

Regards,
Salvatore
```

```
Message-Id: <201405150308.s4F382QO024922@linus.mitre.org>
Date: Wed, 14 May 2014 23:08:02 -0400 (EDT)
From: cve-assign@...re.org
To: carnil@...ian.org
Cc: cve-assign@...re.org, oss-security@...ts.openwall.com,
        security@...ngoproject.com
Subject: Re: CVE Reuest: Django: Malformed URLs from user input incorrectly validated

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> <https://www.djangoproject.com/weblog/2014/may/14/security-releases-issued/>

> It also fixes a second issue, for which a CVE is missing, quoting from
> the announcement:

>> Issue: Malformed URLs from user input incorrectly validated
>> The validation for redirects did not correctly validate some malformed
>> URLs, which are accepted by some browsers. This allows a user to be
>> redirected to an unsafe URL unexpectedly.
>>
>> Django relies on user input in some cases (e.g.
>> django.contrib.auth.views.login, django.contrib.comments, and i18n) to
>> redirect the user to an "on success" URL. The security checks for
>> these redirects (namely django.util.http.is_safe_url()) did not
>> correctly validate some malformed URLs, such as
>> http:\\\djangoproject.com, which are accepted by some browsers with
>> more liberal URL parsing.
>>
>> To remedy this, the validation in is_safe_url() has been tightened to
>> be able to handle and correctly validate these malformed URLs.

> <https://github.com/django/django/commit/255449c1ee61c14778658caae8c430fa4d76afd6>

> url = url.replace('\\', '/')
>
> if url.startswith('///'):
>     return False
>
> Forbid URLs like http:///example.com - with a scheme, but without a hostname.

Use CVE-2014-3730.

- --
CVE assignment team, MITRE CVE Numbering Authority
M/S M300
202 Burlington Road, Bedford, MA 01730 USA
[ PGP key available through <http://cve.mitre.org/cve/request_id.html> ]
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.14 (SunOS)

iQEcBAEBAgAGBQJTdC8jAAoJEKllVAevmvmsX9kIAKlhUlg8UwBHt/xmmPAwiXjs
WrMV5kbkEvEDjfz2IWYY3We8NkGeuSLFzD27j8LaBSzeS6c6ARX57B5xfXZMLnV6
2wmXl75mz/vZFc9+7IYtMZ53nbOE7I5occLi69zH0gX208uuW3F+hFqf6735sYgt
FGoXIZfkfDYA+j8fyXlxkfDPMVKolsiFGfidgbmK7J3D3YPBshneI77wYq//nwlO
ihSs55P+T9tZctlOUfdBvSWzIzbOfi3w3WcXcFPE+n61XpHpVq7bDeCB/GlpBkcA
GiyVT9mkM9dC1CykY4WGbQUoXP9JZ4fg/eoowXnKNn8q20/e5pHCHhM2vBkYVxw=
=LjKL
-----END PGP SIGNATURE-----

```

```
python-django (1.1.1-2ubuntu1.12) lucid-security; urgency=medium

  * SECURITY UPDATE: cache coherency problems in old Internet Explorer
    compatibility functions lead to loss of privacy and cache poisoning
    attacks. (LP: [#1317663](/bugs/1317663))
    - debian/patches/drop_fix_ie_for_vary_1_4.diff: remove fix_IE_for_vary()
      and fix_IE_for_attach() functions so Cache-Control and Vary headers are
      no longer modified. This may introduce some regressions for IE 6 and IE 7
      users. Patch from upstream.
    - CVE-2014-1418
 -- Seth Arnold <email address hidden>   Wed, 14 May 2014 11:24:15 -0700
```

```
# USN-2212-1: Django vulnerabilities

15 May 2014

Django applications could be made to expose sensitive information over
the network.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 14.04 ESM](/security/notices?release=trusty)
* [Ubuntu 13.10](/security/notices?release=saucy)
* [Ubuntu 12.10](/security/notices?release=quantal)
* [Ubuntu 12.04](/security/notices?release=precise)
* [Ubuntu 10.04](/security/notices?release=lucid)

## Packages

* [python-django](/security/cves?package=python-django) - High-level Python web development framework

## Details

Stephen Stewart, Michael Nelson, Natalia Bidart and James Westby

discovered that Django improperly removed Vary and Cache-Control headers

from HTTP responses when replying to a request from an Internet Explorer

or Chrome Frame client. An attacker may use this to retrieve private data

or poison caches. This update removes workarounds for bugs in Internet

Explorer 6 and 7. ([CVE-2014-1418](/security/CVE-2014-1418))

Peter Kuma and Gavin Wahl discovered that Django did not correctly

validate some malformed URLs, which are accepted by some browsers. An

attacker may use this to cause unexpected redirects. An update has been

provided for 12.04 LTS, 12.10, 13.10, and 14.04 LTS; this issue remains

unfixed for 10.04 LTS as no "is\_safe\_url()" functionality existed in

this version.
```

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-2934-1                   security@debian.org
<http://www.debian.org/security/>                      Salvatore Bonaccorso
May 19, 2014                           <http://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : python-django
CVE ID         : CVE-2014-0472 CVE-2014-0473 CVE-2014-0474 CVE-2014-1418
                 CVE-2014-3730

Several vulnerabilities were discovered in Django, a high-level Python
web development framework. The Common Vulnerabilities and Exposures
project identifies the following problems:

CVE-2014-0472

    Benjamin Bach discovered that Django incorrectly handled dotted
    Python paths when using the reverse() URL resolver function. An
    attacker able to request a specially crafted view from a Django
    application could use this issue to cause Django to import arbitrary
    modules from the Python path, resulting in possible code execution.

CVE-2014-0473

    Paul McMillan discovered that Django incorrectly cached certain
    pages that contained CSRF cookies. A remote attacker could use this
    flaw to acquire the CSRF token of a different user and bypass
    intended CSRF protections in a Django application.

CVE-2014-0474

    Michael Koziarski discovered that certain Django model field classes
    did not properly perform type conversion on their arguments, which
    allows remote attackers to obtain unexpected results.

CVE-2014-1418

    Michael Nelson, Natalia Bidart and James Westby discovered that
    cached data in Django could be served to a different session, or to
    a user with no session at all. An attacker may use this to retrieve
    private data or poison caches.

CVE-2014-3730

    Peter Kuma and Gavin Wahl discovered that Django incorrectly
    validated certain malformed URLs from user input. An attacker may
    use this to cause unexpected redirects.

For the oldstable distribution (squeeze), these problems have been fixed in
version 1.2.3-3+squeeze10.

For the stable distribution (wheezy), these problems have been fixed in
version 1.4.5-1+deb7u7.

For the testing distribution (jessie), these problems have been fixed in
version 1.6.5-1.

For the unstable distribution (sid), these problems have been fixed in
version 1.6.5-1.

We recommend that you upgrade your python-django packages.

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <http://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCgAGBQJTemvyAAoJEAVMuPMTQ89EtfQQAJiAPQJLzcGCjp+zvp9JJywJ
+/xkbwJOC5B3BDGZ9DOWRZwLSkVVLYA36bpGz/yFursKsTHqP0MshcBh5kvCC7JA
uFdX7MQCTz2jh9YmEK3Vqf9Y7xihWBsVuBonVy0m+HmBPB/g34GZJ488XBZMK5E3
omvp0PF4q0+u7O8uE+fk2V+zwYy3HiQkz1ZBifT1Fwd5OYoSV6nXRhJdJbrvHxt0
0XTM9v9YjQLW90GOXUh5IZZ1sx+oF0sS3BHXWpPFVt6w8hZJADSBGQTujnq5rk7L
Ph7iRctig3aeb22UToRE/g4OsPtrsSwFIUetg9NVQm41Aov0vlDkR2OUvOAQ8Bax
4vMyH64LU/ti2UjmRmc1MEZsuFkhUcYLUcSupXRYTBbwwHT5Vbbnw+AZR6sJUXPD
+mUUp4y/DsVThJlrK0VyMcrpuUK2nCytU6C8VHLTncHj5GSTcXGKwCEyYxsfZCmt
HdgEV0/GsObuU/qP86mShfKbWeI+RgKpm4bB9/j6yPu5oQkGWPGk5yd+O2QbRMND
QHd4nq1fTZFxYDSI17V8JzAjNbwVsyrigDed571OUBQdTLHarWnh7B9Co0T4oC/b
wxRZriEheqvvBnYOtOxAJcoSUb837ztLSCxX79lGAIz4fCKzEvDv+/HNeqdjqdhR
6SkVES2g4mTwHbtQy8Ep
=7/zi
-----END PGP SIGNATURE-----
```

```
# openSUSE-SU-2014:1132-1: moderate: python-django: security and bugfix update

![](https://seccdn.libravatar.org/avatar/099a17325bdf082b643d1a6bbacde279.jpg?s=120&d=mm&r=g)
## [opensuse-security＠opensuse.org](/archives/users/1b72def497ef4503896cd7a5fe9fb8e0/ "See the profile for opensuse-security＠opensuse.org")

16 Sep
2014

16 Sep
'14

13:04

openSUSE Security Update: python-django: security and bugfix update
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
Announcement ID: openSUSE-SU-2014:1132-1
Rating: moderate
References: #874950 #874955 #874956 #877993 #878641 #893087
#893088 #893089 #893090
Cross-References: CVE-2014-0472 CVE-2014-0473 CVE-2014-0474
CVE-2014-0480 CVE-2014-0481 CVE-2014-0482
CVE-2014-0483 CVE-2014-1418 CVE-2014-3730
Affected Products:
openSUSE 13.1
openSUSE 12.3
\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
An update that fixes 9 vulnerabilities is now available.
Description:
Python Django was updated to fix security issues and bugs.
Update to version 1.4.15 on openSUSE 12.3:
+ Prevented reverse() from generating URLs pointing to other hosts to
prevent phishing attacks (bnc#893087, CVE-2014-0480)
+ Removed O(n) algorithm when uploading duplicate file names to fix file
upload denial of service (bnc#893088, CVE-2014-0481)
+ Modified RemoteUserMiddleware to logout on REMOTE\_USE change to prevent
session hijacking (bnc#893089, CVE-2014-0482)
+ Prevented data leakage in contrib.admin via query string manipulation
(bnc#893090, CVE-2014-0483)
+ Fixed: Caches may incorrectly be allowed to store and serve private data
(bnc#877993, CVE-2014-1418)
+ Fixed: Malformed redirect URLs from user input not correctly validated
(bnc#878641, CVE-2014-3730)
+ Fixed queries that may return unexpected results on MySQL due to
typecasting (bnc#874956, CVE-2014-0474)
+ Prevented leaking the CSRF token through caching (bnc#874955,
CVE-2014-0473)
+ Fixed a remote code execution vulnerabilty in URL reversing (bnc#874950,
CVE-2014-0472)
Update to version 1.5.10 on openSUSE 13.1:
+ Prevented reverse() from generating URLs pointing to other hosts to
prevent phishing attacks (bnc#893087, CVE-2014-0480)
+ Removed O(n) algorithm when uploading duplicate file names to fix file
upload denial of service (bnc#893088, CVE-2014-0481)
+ Modified RemoteUserMiddleware to logout on REMOTE\_USE change to prevent
session hijacking (bnc#893089, CVE-2014-0482)
+ Prevented data leakage in contrib.admin via query string manipulation
(bnc#893090, CVE-2014-0483)
- Update to version 1.5.8:
+ Fixed: Caches may incorrectly be allowed to store and serve private data
(bnc#877993, CVE-2014-1418)
+ Fixed: Malformed redirect URLs from user input not correctly validated
(bnc#878641, CVE-2014-3730)
+ Fixed queries that may return unexpected results on MySQL due to
typecasting (bnc#874956, CVE-2014-0474)
+ Prevented leaking the CSRF token through caching (bnc#874955,
CVE-2014-0473)
+ Fixed a remote code execution vulnerabilty in URL reversing (bnc#874950,
CVE-2014-0472)
Patch Instructions:
To install this openSUSE Security Update use YaST online\_update.
Alternatively you can run the command listed for your product:
- openSUSE 13.1:
zypper in -t patch openSUSE-2014-542
- openSUSE 12.3:
zypper in -t patch openSUSE-2014-542
To bring your system up-to-date, use "zypper patch".
Package List:
- openSUSE 13.1 (noarch):
python-django-1.5.10-0.2.8.1
- openSUSE 12.3 (noarch):
python-django-1.4.15-2.12.1
References:
<http://support.novell.com/security/cve/CVE-2014-0472.html>
<http://support.novell.com/security/cve/CVE-2014-0473.html>
<http://support.novell.com/security/cve/CVE-2014-0474.html>
<http://support.novell.com/security/cve/CVE-2014-0480.html>
<http://support.novell.com/security/cve/CVE-2014-0481.html>
<http://support.novell.com/security/cve/CVE-2014-0482.html>
<http://support.novell.com/security/cve/CVE-2014-0483.html>
<http://support.novell.com/security/cve/CVE-2014-1418.html>
<http://support.novell.com/security/cve/CVE-2014-3730.html>
<https://bugzilla.novell.com/874950>
<https://bugzilla.novell.com/874955>
<https://bugzilla.novell.com/874956>
<https://bugzilla.novell.com/877993>
<https://bugzilla.novell.com/878641>
<https://bugzilla.novell.com/893087>
<https://bugzilla.novell.com/893088>
<https://bugzilla.novell.com/893089>
<https://bugzilla.novell.com/893090>
```

```
Today the Django team is issuing multiple releases -- Django 1.4.13, Django 1.5.8, Django 1.6.5 and Django 1.7 beta 4 -- as part of our security process. These releases are now available on PyPI and our download page.

These releases address a caching issue which might lead to cache poisoning and an incorrect validation of safe redirect targets. Since these issues will affect the majority of users we strongly encourage everyone to upgrade.

For more details, read on.

#### Issue: Caches may be allowed to store and serve private data (CVE-2014-1418)

In certain situations, Django may allow caches to store private data
related to a particular session and then serve that data to requests
with a different session, or no session at all. This can both lead to
information disclosure, and can be a vector for cache poisoning.

When using Django sessions, Django will set a Vary: Cookie header
to ensure caches do not serve cached data to requests from other
sessions. However, older versions of Internet Explorer (most likely
only Internet Explorer 6, and Internet Explorer 7 if run on Windows XP
or Windows Server 2003) are unable to handle the Vary header in
combination with many content types. Therefore, Django would remove
the header if the request was made by Internet Explorer.

To remedy this, the special behavior for these older Internet
Explorer versions has been removed, and the Vary header is no
longer stripped from the response. In addition, modifications to the
Cache-Control header for all Internet Explorer requests with a
Content-Disposition header, have also been removed as they were
found to have similar issues.

Thanks to Seth Arnold at Canonical for reporting this issue to us, and to Michael Nelson, Natalia Bidart, James Westby for discovering the issue and reporting it to Canonical.

#### Issue: Malformed URLs from user input incorrectly validated (CVE-2014-3730)

The validation for redirects did not correctly validate some malformed
URLs, which are accepted by some browsers. This allows a user to be
redirected to an unsafe URL unexpectedly.

Django relies on user input in some cases (e.g.
django.contrib.auth.views.login, django.contrib.comments,
and i18n) to redirect the user to an "on
success" URL. The security checks for these redirects (namely
django.util.http.is\_safe\_url()) did not correctly validate some
malformed URLs, such as http:\\\djangoproject.com, which are
accepted by some browsers with more liberal URL parsing.

To remedy this, the validation in is\_safe\_url() has been tightened
to be able to handle and correctly validate these malformed URLs.

Thanks to Peter Kuma and Gavin Wahl for reporting this issue to us.
```
Based on the provided content, here's an analysis of CVE-2014-1418:

**Root cause of vulnerability:**
- Django's handling of HTTP `Vary` and `Cache-Control` headers was flawed for older Internet Explorer versions (IE6 and IE7). To work around bugs in these browsers, Django would remove the Vary header when requests came from them, which could lead to caches storing and serving private data related to a session to other sessions or users with no session.

**Weaknesses/vulnerabilities present:**
- Improper handling of HTTP headers (specifically `Vary` and `Cache-Control`) in responses.
- Conditional removal of security headers based on user-agent, leading to inconsistent caching behavior.
- Potential for information disclosure and cache poisoning.

**Impact of exploitation:**
- Exposure of private user data due to incorrect caching.
- Cache poisoning, where an attacker could inject malicious content into the cache, affecting other users.

**Attack vectors:**
- The vulnerability is triggered when a user with an older Internet Explorer version makes a request to a Django application.

**Required attacker capabilities/position:**
- The attacker needs to be able to cause a request to be made to the application that would trigger the caching of a response where the vary header would normally be used, and use an old IE user agent
- The attacker needs to induce another user (potentially any user) to request the malicious cached page, or be on the same network and have their traffic routed through the same cache.

**Summary:**
- The vulnerability arises from Django's attempt to work around bugs in older Internet Explorer versions, leading to a situation where private data could be incorrectly cached and exposed to other users. The fix involves removing the browser-specific workarounds, ensuring that the `Vary` and `Cache-Control` headers are always present.