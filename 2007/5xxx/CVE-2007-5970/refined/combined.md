=== Content from bugs.mysql.com_6967a74b_20250125_063400.html ===

[![MySQL](/images/mysql_100x52-64.gif)](http://dev.mysql.com/)

[Login](https://dev.mysql.com/auth/login/?dest=http%3A%2F%2Fbugs.mysql.com%2Fbug.php%3Fid%3D32091) /
[Register](https://dev.mysql.com/auth/register/)

* [Developer Zone](http://dev.mysql.com/)
* [Bugs Home](/)
* [Report a bug](/report.php)
* [Advanced search](/search.php)
* [Saved searches](/search-saved.php)
* [Tags](/tags.php)

| Bug #32091 | Partitions: Security Breach via directory changes | | |
| --- | --- | --- | --- |
| Submitted: | 4 Nov 2007 21:03 | Modified: | 15 Nov 2007 14:52 |
| Reporter: | [Peter Gulutzan](/search.php?cmd=display&status=All&severity=all&reporter=20221) | Email Updates: |  |
| Status: | [Closed](http://lists.mysql.com/commits/37652) | Impact on me: | None |
| Category: | MySQL Server: Partitions | Severity: | S1 (Critical) |
| Version: | 5.1.23-rc-debug | OS: | Linux (SUSE 10 64-bit) |
| Assigned to: | [Mattias Jonsson](/search.php?cmd=display&status=Under+Development&assign=1450814) | CPU Architecture: | Any |

* View
* [Add Comment](/bug.php?id=32091&edit=3)
* [Files](/bug.php?id=32091&files=1)
* [Developer](/bug.php?id=32091&edit=1)
* [Edit Submission](/bug.php?id=32091&edit=2)
* [View Progress Log](/bug.php?id=32091&log=1)
* [Contributions](/bug.php?id=32091&contribs=1)

[4 Nov 2007 21:03]
Peter Gulutzan
```
Description:
As root, I grant USAGE on test.* to joe@localhost.
As root, I create a table cuckoo in database k.
As joe@localhost, I create a table cuckoo in database test,
with partitioning, with DATA DIRECTORY and INDEX DIRECTORY
clauses pointing to '/usr/local/mysql/var/k'.
(The value of @@datadir is '/usr/local/mysql/var'.)
As joe@localhost, I remove the partitioning.
As joe@localhost, I insert '44' in test.cuckoo.
As root, I select from k.cuckoo.
The result is: '44'.

So anybody with privileges on test.* can change
any table in any database.

How to repeat:
As root, say:
SELECT @@datadir;
If this doesn't say /usr/local/mysql/var, then adjust
occurrence of '/usr/local/mysql/var' accordingly for
the subsequent instructions.

As root, say:
GRANT USAGE ON test.* TO joe@localhost;
CREATE DATABASE k;
USE k
CREATE TABLE cuckoo (s1 INT);

As joe@localhost, say:
USE test
CREATE TABLE cuckoo (s1 INT)
PARTITION BY LIST (s1)
(PARTITION p1 VALUES IN (1)
 DATA DIRECTORY '/usr/local/mysql/var/k'
 INDEX DIRECTORY '/usr/local/mysql/var/k');
ALTER TABLE cuckoo REMOVE PARTITIONING;
INSERT INTO cuckoo VALUES (44);

As root, say:
USE k
SELECT * FROM cuckoo;
```

[6 Nov 2007 11:36]
Mattias Jonsson
```
The bug is that when reparsing the partitioning clause it sets the DATA and INDEX DIRECTORY for the table from the first partition.

I will probably remove the possibility to have DATA/INDEX DIR in BOTH the table clause AND the partitioning clause. (have to verify how this works, maybe disallow DATA/INDEX dir for the table clause at all, only allowing it for the partitioning clause when using partitions)
```

[6 Nov 2007 17:09]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37201>

ChangeSet@1.2605, 2007-11-06 18:09:21+01:00, mattiasj@mattiasj-laptop.(none) +3 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  Problem: the table's INDEX and DATA DIR was taken
    directly from the tables first partition,
    and opening for a rename attack similar to
    [bug#32111](https://bugs.mysql.com/bug.php?id=32111) when ALTER TABLE REMOVE PARTITIONING

  Solution: Silently ignore (like some other storage
    engines) the INDEX/DATA DIR for the table.
    (Only use INDEX/DATA DIR for each partitions,
    not for the whole table)
```

[7 Nov 2007 10:15]
Ingo Strüwing
```
IMHO we would be much better off if we would take DATA/INDEX DIRECTORY as an alternate root data directory. So that we append the database name as the last element of the final directory path for the files. In other words, handle it the same as the default data directory. But for compatibility reasons it's too late to change that now, I think.
```

[7 Nov 2007 10:28]
Ingo Strüwing
```
What I wanted to add before: IMHO it is not correct that we do not check the permission for the final target of the files. If it is in a database directory, we should check permission for this database in addition to the usual checks. But I guess this is also a general MySQL behavior and not related to partitioning.
```

[7 Nov 2007 11:54]
Mattias Jonsson
```
The security flaw with overwriting of symlinked files should be fixed in [bug#32111](https://bugs.mysql.com/bug.php?id=32111) (that fixes this bug as well).

This bug also include that it uses the DATA/INDEX DIR from the first partition as the tables DATA/INDEX DIR. What the patch do is to avoid setting the tables DATA/INDEX DIR from the first partitions DATA/INDEX DIR. (with this patch it can not match a different DATA/INDEX DIR for the table, only the table's default database-dir)

When partitioning is used, the table's DATA/INDEX DIR is silently IGNORED (as it was before the patch). It is only the DATA/INDEX DIR specified in the PARTITION's clause (per partition) that is used. (so, the patch only disables that the table's DATA/INDEX DIR is taken from the first partition, leaving the table's DATA/INDEX DIR completely IGNORED for a partitioned table, both when CREATE TABLE and SHOW/ALTER/? TABLE)

Another hint --keep_files_on_create can also help to stop the reversed trick in MyISAM:
good user: use securedb; CREATE TABLE t1 DATA/INDEX DIR = '..var/test';
evil user: use test: CREATE TABLE t1;
```

[9 Nov 2007 16:49]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37449>

ChangeSet@1.2605, 2007-11-09 17:48:52+01:00, mattiasj@mattiasj-laptop.(none) +3 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  Problem: the table's INDEX and DATA DIR was taken
    directly from the table's first partition.
    This allowed rename attack similar to
    [bug#32111](https://bugs.mysql.com/bug.php?id=32111) when ALTER TABLE REMOVE PARTITIONING

  Solution: Silently ignore the INDEX/DATA DIR
    for the table. (Like some other storage engines
    do).
    Partitioned tables do not support DATA/INDEX
    DIR on the table level, only on its partitions.
```

[9 Nov 2007 22:22]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37495>

ChangeSet@1.2605, 2007-11-09 23:22:00+01:00, mattiasj@mattiasj-laptop.(none) +3 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  Problem: the table's INDEX and DATA DIR was taken
    directly from the table's first partition.
    This allowed rename attack similar to
    [bug#32111](https://bugs.mysql.com/bug.php?id=32111) when ALTER TABLE REMOVE PARTITIONING

  Solution: Silently ignore the INDEX/DATA DIR
    for the table. (Like some other storage engines
    do).
    Partitioned tables do not support DATA/INDEX
    DIR on the table level, only on its partitions.
```

[10 Nov 2007 7:07]
Mikael Ronström
```
Patch reapproved after checking new test cases
```

[10 Nov 2007 13:56]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37515>

ChangeSet@1.2606, 2007-11-10 14:56:21+01:00, mattiasj@mattiasj-laptop.(none) +2 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  small fix of test case (when running make test after
  merge, it did not substitute MYSQLTEST_VARDIR in
  the error)
```

[10 Nov 2007 20:29]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37527>

ChangeSet@1.2607, 2007-11-10 21:29:39+01:00, mattiasj@mattiasj-laptop.(none) +2 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  Changed test case from GRANT to CREATE USER
```

[12 Nov 2007 12:23]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37572>

ChangeSet@1.2608, 2007-11-12 13:23:45+01:00, mattiasj@mattiasj-laptop.(none) +4 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  Merge fix

  partition_mgm did not require have_symlink.

  Moved the test case to partition_symlink, which
  require have_symlink, and should work on both *nix and
  Windows
```

[13 Nov 2007 9:51]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37648>

ChangeSet@1.2613, 2007-11-13 10:51:32+01:00, mattiasj@mattiasj-laptop.(none) +3 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  Post pushbuild fix

  Disabled test on windows due to [bug#30459](https://bugs.mysql.com/bug.php?id=30459)
  (DATA/INDEX DIR for partitions not working on windows)
```

[13 Nov 2007 10:13]
Bugs System
```
A patch for this bug has been committed. After review, it may
be pushed to the relevant source trees for release in the next
version. You can access the patch from:

  <http://lists.mysql.com/commits/37652>

ChangeSet@1.2614, 2007-11-13 11:12:53+01:00, istruewing@stella.local +3 -0
  [Bug#32091](https://bugs.mysql.com/bug.php?id=32091): Security breach via directory changes

  Post pushbuild fix

  Disabled test on windows due to [bug#30459](https://bugs.mysql.com/bug.php?id=30459)
  (DATA/INDEX DIR for partitions not working on windows)

  Patch from Mattias Jonsson.
```

[14 Nov 2007 9:41]
Bugs System
```
Pushed into 6.0.4-alpha
```

[14 Nov 2007 9:45]
Bugs System
```
Pushed into 5.1.23-rc
```

[14 Nov 2007 10:10]
Mattias Jonsson
```
Pushed into 5.1 and 6.0 (now in main)
```

[14 Nov 2007 19:35]
Sergei Golubchik
```
CVE-2007-5970
```

[15 Nov 2007 14:52]
Jon Stephens
```
Thank you for your bug report. This issue has been committed to our source repository of that product and will be incorporated into the next release.

If necessary, you can access the source repository and build the latest available version, including the bug fix. More information about accessing the source trees is available at

    <http://dev.mysql.com/doc/en/installing-source.html>

Documented in 5.1.23 and 6.0.4 changelogs as follows:

        Security Fix: It was possible, by creating a partitioned table
        using the DATA DIRECTORY and INDEX DIRECTORY options to gain
        privileges on other tables having the same name as the
        partitioned table. As a result of this fix, any table-level DATA
        DIRECTORY or INDEX DIRECTORY options are now ignored for
        partitioned tables.
```

* [Legal Policies](http://www.mysql.com/about/legal/)
* [Your Privacy Rights](http://www.oracle.com/us/legal/privacy/index.htm)
* [Terms of Use](http://www.oracle.com/html/terms.html)
* [Contact Us](https://www.mysql.com/about/contact/)

Portions of this website are [copyright © 2001, 2002 The PHP Group](http://www.php.net/copyright.php)

Page generated in 0.086 sec. using MySQL 8.0.36-u5-cloud

Timestamp references displayed by the system are UTC.

Content reproduced on this site is the property of the
respective copyright holders.
It is not reviewed in advance
by Oracle and does not necessarily represent the opinion of
Oracle or any other party.

[![Oracle](/images/logo-oracle-red-91x22.gif)](http://www.oracle.com/)  © 2025, Oracle Corporation and/or its affiliates



=== Content from www.vupen.com_51bffbc9_20250125_063401.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61


