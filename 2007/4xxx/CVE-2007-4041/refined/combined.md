=== Content from www.kb.cert.org_a5b0a2f9_20250125_104715.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#783400

## Mozilla Firefox URI filtering vulnerability

#### Vulnerability Note VU#783400

Original Release Date: 2007-07-26 | Last Revised: 2007-07-31

---

### Overview

Mozilla Firefox does not filter input when sending certain URIs to registered protocol handlers. This may allow a remote, authenticated attacker to use Firefox as a vector for executing commands on a vulnerable system.

### Description

| A Uniform Resource Identifier (URI) is a string of characters that can be used to identify a location, resource, or protocol. Mozilla Firefox will rely on Microsoft Windows to determine the appropriate protocol handler for certain URIs that it does not handle internally.  Firefox does not filter data passed to certain URI protocol handlers. This allows Firefox to be used as an attack vector for vulnerabilities in other applications. For example, Firefox can be used as an attack vector for the vulnerability in how Microsoft Windows itself determines the appropriate protocol handler [[VU#403150](http://www.kb.cert.org/vuls/id/403150)]. Public exploit code for this vulnerability exists, which uses mailto, news, nntp, snews, and telnet URI handlers.Note this vulnerability is only present in the Windows version of Firefox. |
| --- |

### Impact

| A remote, unauthenticated attacker may be able to execute arbitrary commands, using Firefox as an attack vector. |
| --- |

### Solution

| Mozilla has addressed this issue in Firefox [2.0.0.6](http://en-us.www.mozilla.com/en-US/firefox/2.0.0.6/releasenotes/). |
| --- |

| **Workarounds for users**Using the [about:config](http://kb.mozillazine.org/Firefox_%3A_FAQs_%3A_About%3Aconfig_Entries) interface, setting the following options to **true** will make Firefox display a prompt before sending a URI to an external handler. network.protocol-handler.warn-external-defaultnetwork.protocol-handler.warn-external.mailtonetwork.protocol-handler.warn-external.newsnetwork.protocol-handler.warn-external.nntpnetwork.protocol-handler.warn-external.snews**Workarounds for administrators**Blocking mailto:%00, nntp:%00, news:%00, snews:%00, telnet:%00 strings inside of HTML pages or other network streams using an [application layer firewall](http://en.wikipedia.org/wiki/Application_layer_firewall) or IPS may mitigate this vulnerability. See the xs-sniper [blog](http://xs-sniper.com/blog/2007/07/24/remote-command-execution-in-firefox-2005/) for more information about known vulnerable URIs. Please note that these filters may only work for the public exploit code that is currently available. Other variations of the exploit code can bypass these restrictions. |
| --- |

### Vendor Information

783400
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23783400/) to view vendors.**
### [Mozilla](#RGII-75GHSW) Affected

Updated:  July 26, 2007

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

See <https://bugzilla.mozilla.org/show_bug.cgi?id=389580> for more details.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://en-us.www.mozilla.com/en-US/firefox/2.0.0.6/releasenotes/>
* <https://bugzilla.mozilla.org/show_bug.cgi?id=389106>
* <https://bugzilla.mozilla.org/show_bug.cgi?id=389580>
* <http://xs-sniper.com/blog/2007/07/24/remote-command-execution-in-firefox-2005/>
* <http://xs-sniper.com/blog/remote-command-exec-firefox-2005/>
* [http://kb.mozillazine.org/Firefox\_:\_FAQs\_:\_About:config\_Entries](http://kb.mozillazine.org/Firefox_%3A_FAQs_%3A_About%3Aconfig_Entries)
* <http://support.microsoft.com/kb/224816>
* <http://en.wikipedia.org/wiki/Uniform_Resource_Identifier>
* <http://secunia.com/advisories/26201/>
* <http://www.w3schools.com/tags/ref_urlencode.asp>
### Acknowledgements

This vulnerability was disclosed by Billy (BK) Rios.

This document was written by Ryan Giobbi, Jeff Gennari, and Will Dormann..

### Other Information

| **CVE IDs:** | [CVE-2007-3845](http://web.nvd.nist.gov/vuln/detail/CVE-2007-3845) |
| --- | --- |
| **Severity Metric:** | 25.52 |
| **Date Public:** | 2007-07-25 |
| **Date First Published:** | 2007-07-26 |
| **Date Last Updated:** | 2007-07-31 15:21 UTC |
| **Document Revision:** | 48 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from bugzilla.mozilla.org_6786f07d_20250125_104818.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/389106)
* [XML](/show_bug.cgi?ctype=xml&id=389106)

Closed
[Bug 389106](/show_bug.cgi?id=389106)
(CVE-2007-3845)

Opened 18 years ago
Closed 18 years ago

# Escape URIs (especially quotes) when passing them to external protocol handlers

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Escape URIs (especially quotes) when passing them to external protocol handlers

## Categories

### (Core :: Security, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Security#Security)

Security
▾

Core :: Security
For non-crypto security bugs. Or use this general component if you know you have a Browser security bug, but not sure what component to use. Bug will be reviewed for proper component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Security&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Security&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Security)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mconnor, Assigned: Biesinger)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/80ef9e8cf2739567a75dbd94e6eb124a?d=mm&size=40)  [Biesinger](/user_profile?user_id=15661)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/634e23acaee53ab34532f04ec03b14a8?d=mm&size=40)  [mconnor](/user_profile?user_id=96908)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=40)  [dveditz](/user_profile?user_id=1689)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

31 people

## References

### (Depends on 1 open bug, [URL](http://msinfluentials.com/blogs/jesper/archive/2007/07/20/hey-mozilla-quotes-are-not-legal-in-a-url.aspx "http://msinfluentials.com/blogs/jesper/archive/2007/07/20/hey-mozilla-quotes-are-not-legal-in-a-url.aspx") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[389469](/show_bug.cgi?id=389469 "NEW - Protocol-handler applications that don't work when the browser escapes back-ticks, double-quotes, and spaces"), [390126](/show_bug.cgi?id=390126 "RESOLVED FIXED - base64 encoded images no longer display if they contain spaces"), [392240](/show_bug.cgi?id=392240 "RESOLVED WONTFIX - doesn't execute the commands in the url."), [422609](/show_bug.cgi?id=422609 "RESOLVED WORKSFORME - Evaluating Javascript with leading spaces fails in some cases")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[CVE-2021-43541](/show_bug.cgi?id=1696685 "RESOLVED FIXED - URIs passed to external application protocol / URL handlers should have spaces escaped")

Dependency [tree](/showdependencytree.cgi?id=389106&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=389106)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[msinfluentials.com/blogs/jesper/archi...](http://msinfluentials.com/blogs/jesper/archive/2007/07/20/hey-mozilla-quotes-are-not-legal-in-a-url.aspx "http://msinfluentials.com/blogs/jesper/archive/2007/07/20/hey-mozilla-quotes-are-not-legal-in-a-url.aspx")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed1.8.1.6, fixed1.8.1.8, verified1.8.0.13, Whiteboard: [sg:critical])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2007-3845

[Keywords:](/describekeywords.cgi)

[fixed1.8.1.6](/buglist.cgi?keywords=fixed1.8.1.6&resolution=---),
[fixed1.8.1.8](/buglist.cgi?keywords=fixed1.8.1.8&resolution=---),
[verified1.8.0.13](/buglist.cgi?keywords=verified1.8.0.13&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [mconnor](/user_profile?user_id=96908) | [blocking1.8.1.6](#a78750_96908 "18 years ago") | + |
| --- | --- | --- |
| [mconnor](/user_profile?user_id=96908) | blocking1.8.1.6 | + |
| --- | --- | --- |
| [mconnor](/user_profile?user_id=96908) | [blocking1.8.1.8](#c0 "18 years ago") | + |
| --- | --- | --- |
| [mconnor](/user_profile?user_id=96908) | blocking1.8.1.8 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [in-testsuite](#a2345078_1689 "17 years ago") | ? |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (8 files, 4 obsolete files)

| [patch](/attachment.cgi?id=273260)  [18 years ago](#c1)  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)   1.31 KB, patch | bzbarsky : [review+](#c4 "18 years ago")  dveditz : [superreview+](#c15 "18 years ago") | [Details](/attachment.cgi?id=273260&action=edit) | [Diff](/attachment.cgi?id=273260&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273260) |
| --- | --- | --- |
| [alternative patch](/attachment.cgi?id=273284)  [18 years ago](#c7)  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)   1.47 KB, patch | bzbarsky : [review+](#c11 "18 years ago")  dveditz : [superreview+](#c16 "18 years ago") | [Details](/attachment.cgi?id=273284&action=edit) | [Diff](/attachment.cgi?id=273284&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273284) |
| [alternative patch (branch version)](/attachment.cgi?id=273285)  [18 years ago](#c8)  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)   1.69 KB, patch | mconnor : [approval1.8.1.6+](#c19 "18 years ago")  mconnor : [approval1.8.1.8+](#c0 "18 years ago")  mconnor : [approval1.8.0.13+](#c19 "18 years ago") | [Details](/attachment.cgi?id=273285&action=edit) | [Diff](/attachment.cgi?id=273285&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273285) |
| [windows exe test handler](/attachment.cgi?id=273424)  [18 years ago](#c26)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   40.00 KB, application/octet-stream |  | [Details](/attachment.cgi?id=273424&action=edit) |
| [escape spaces](/attachment.cgi?id=273434)  [18 years ago](#c27)  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)   1.18 KB, patch | bzbarsky : [review+](#c29 "18 years ago")  dveditz : [superreview+](#c33 "18 years ago") | [Details](/attachment.cgi?id=273434&action=edit) | [Diff](/attachment.cgi?id=273434&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273434) |
| [escape spaces, branch version](/attachment.cgi?id=273501)  [18 years ago](#c31)  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)   1005 bytes, patch | bzbarsky : [review+](#a192605_20209 "18 years ago")  dveditz : [superreview+](#c32 "18 years ago")  mconnor : [approval1.8.1.6+](#c35 "18 years ago")  mconnor : [approval1.8.0.13+](#c35 "18 years ago") | [Details](/attachment.cgi?id=273501&action=edit) | [Diff](/attachment.cgi?id=273501&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273501) |
| [Handlers in html format](/attachment.cgi?id=273528)  [18 years ago](#c38)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   36.47 KB, text/html |  | [Details](/attachment.cgi?id=273528&action=edit) |
| [updated handlers in html format](/attachment.cgi?id=273560)  [18 years ago](#c40)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   47.40 KB, text/html |  | [Details](/attachment.cgi?id=273560&action=edit) |
| [equivalent test program for mac os x](/attachment.cgi?id=273580)  [18 years ago](#c41)  [Colin Barrett [:cbarrett]](/user_profile?user_id=56157)   46.57 KB, application/octet-stream |  | [Details](/attachment.cgi?id=273580&action=edit) |
| [equivalent test program for linux i686](/attachment.cgi?id=273645)  [18 years ago](#c45)  [Reed Loden [:reed]](/user_profile?user_id=159758)   10.00 KB, application/x-tar |  | [Details](/attachment.cgi?id=273645&action=edit) |
| [updated handlers in html format](/attachment.cgi?id=273656)  [18 years ago](#c48)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   48.85 KB, text/html |  | [Details](/attachment.cgi?id=273656&action=edit) |
| [equivalent test bash script](/attachment.cgi?id=273738)  [18 years ago](#c53)  [Karl Tomlinson (:karlt)](/user_profile?user_id=274246)   106 bytes, text/x-sh |  | [Details](/attachment.cgi?id=273738&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Mike Connor [:mconnor]](/user_profile?user_id=96908)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=389106#c0)• 18 years ago |
|  | |

different takes on this from different people, biesi has a patch for nsOSHelperAppService.cppFlags: blocking1.8.1.6+

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=389106#c1)• 18 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=273260&action=diff) (obsolete)
— [Details](attachment.cgi?id=273260&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273260)

[Attachment #273260](/attachment.cgi?id=273260&action=edit "patch") -
Flags: superreview?(dveditz)
[Attachment #273260](/attachment.cgi?id=273260&action=edit "patch") -
Flags: review?

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a242_15661)• 18 years ago |

[Attachment #273260](/attachment.cgi?id=273260&action=edit "patch") -
Flags: review? → review?(bzbarsky)

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=389106#c2)• 18 years ago |
|  | |

I should note... this patch patches windows only and it doesn't affect the URL in the dialog, just what's executed.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=389106#c3)• 18 years ago |
|  | |

Is there an XP location we could patch?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=389106#c4)• 18 years ago |
|  | |

Comment on [attachment 273260](/attachment.cgi?id=273260 "patch") [[details]](/attachment.cgi?id=273260&action=edit "patch") [[diff]](/attachment.cgi?id=273260&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273260)
patch
This does look ok for now, though...
[Attachment #273260](/attachment.cgi?id=273260&action=edit "patch") -
Flags: review?(bzbarsky) → review+

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=389106#c5)• 18 years ago |
|  | |

The XP locations are basically the external helper app service, which only has an nsIURI object, and the nsSimpleURI implementation, changing which affects much more than just this code, so I decided to patch this here instead.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=389106#c6)• 18 years ago |
|  | |

Comment on [attachment 273260](/attachment.cgi?id=273260 "patch") [[details]](/attachment.cgi?id=273260&action=edit "patch") [[diff]](/attachment.cgi?id=273260&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273260)
patch
To be safe all around, I'd do this in nsExternalHelperAppService::LoadURI -- get the spec, substitute, create a new URI, load that.
Otherwise we have to worry about various platforms...

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=389106#c7)• 18 years ago |
|  | |

Attached patch

[alternative patch](attachment.cgi?id=273284&action=diff)
— [Details](attachment.cgi?id=273284&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273284)

something like this then?
[Attachment #273284](/attachment.cgi?id=273284&action=edit "alternative patch") -
Flags: superreview?(dveditz)
[Attachment #273284](/attachment.cgi?id=273284&action=edit "alternative patch") -
Flags: review?(bzbarsky)

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=389106#c8)• 18 years ago |
|  | |

Attached patch

[alternative patch (branch version)](attachment.cgi?id=273285&action=diff)
— [Details](attachment.cgi?id=273285&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273285)

branch version of alternative patch (context changed due to thread manager)

|  | [Ben Bucksch (:BenB)](/user_profile?user_id=22599) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=389106#c9)• 18 years ago |
|  | |

Possibly another (additional) way to fix this: IIRC, Unix has a way to launch applications directly, not via a shell, and passing commandline options one by one. I.e. instead of launching 'firefox.exe -url "foo:bar"', you say something alike exec("firefox.exe", ["-url", "foo:bar"]); - This has the advantage that the shell commandline parsing is not involved and spaces can appear in an argument without splitting it and without having to escape or quote it.
I don't know, if Windows supports that as well, but a superficial look at
nsIProcess:run() says it does (and if not, maybe it's possible?).
<http://mxr.mozilla.org/seamonkey/source/xpcom/threads/nsIProcess.idl>
unsigned long run(in boolean blocking, [array, size\_is(count)] in string args, in unsigned long count);

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=389106#c10)• 18 years ago |
|  | |

On at least some platforms nsProcessCommon just pastes the args together into a string. Or at least it used to,,,,

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=389106#c11)• 18 years ago |
|  | |

Comment on [attachment 273284](/attachment.cgi?id=273284 "alternative patch") [[details]](/attachment.cgi?id=273284&action=edit "alternative patch") [[diff]](/attachment.cgi?id=273284&action=diff "alternative patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273284)
alternative patch
Indeed.
[Attachment #273284](/attachment.cgi?id=273284&action=edit "alternative patch") -
Flags: review?(bzbarsky) → review+

|  | [Mike Connor [:mconnor]](/user_profile?user_id=96908)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a78750_96908)• 18 years ago |

Flags: blocking1.8.1.6+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=389106#c12)• 18 years ago |
|  | |

I'm uneasy seeing the apostrophe escaped. Although the old rfc 1738 explicitly calls out quote (") as an "unsafe" character, the apostrophe is enumerated as a "special" character allowed to appear unencoded.
rfc 1738 was superseded by rfc 3986 which puts apostrophe in the reserved "sub-delims" set, and says "URIs that differ in the replacement of a reserved character with its corresponding percent-encoded octet are not equivalent."

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=389106#c13)• 18 years ago |
|  | |

I can remove the apostrophe from the list, sure. I'm not quite clear on what the original bug was, would an unescaped apostrophe cause the issue too?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=389106#c14)• 18 years ago |
|  | |

The original problem is [bug 384384](/show_bug.cgi?id=384384 "RESOLVED FIXED - Multiple Vendor Multiple Browser Interaction URI Handler Command Injection Vulnerability")
<iframe src='myscheme:foo" -injected evil'></iframe>
Which when we pass to ShellExecute is replaced in something like
schemehandler.exe "%1"
so the stuff after the dquote ends up being seen as extra params by schemehandler
MS docs that the registry keys should look like the above, with dquotes, so I don't think we need to worry too much about similar problems with single quotes -- though it could be a problem if some handler registers the wrong way (similarly spaces would cause the same problem if the registry key had no quotes at all).
Worrying about platform differences is one consequence of putting the patch in a common point.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=389106#c15)• 18 years ago |
|  | |

Comment on [attachment 273260](/attachment.cgi?id=273260 "patch") [[details]](/attachment.cgi?id=273260&action=edit "patch") [[diff]](/attachment.cgi?id=273260&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273260)
patch
sr=dveditz without the %27 line
[Attachment #273260](/attachment.cgi?id=273260&action=edit "patch") -
Flags: superreview?(dveditz) → superreview+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=389106#c16)• 18 years ago |
|  | |

Comment on [attachment 273284](/attachment.cgi?id=273284 "alternative patch") [[details]](/attachment.cgi?id=273284&action=edit "alternative patch") [[diff]](/attachment.cgi?id=273284&action=diff "alternative patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273284)
alternative patch
sr=dveditz for this, too, without the %27 line, though I worry a little that some platform somewhere will need that escaped too. For the trunk, platform-specific escaping might be a better way to go.
[Attachment #273284](/attachment.cgi?id=273284&action=edit "alternative patch") -
Flags: superreview?(dveditz) → superreview+

|  | [Ben Bucksch (:BenB)](/user_profile?user_id=22599) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=389106#c17)• 18 years ago |
|  | |

As dveditz said, it's easy for apps to forget the quotes in the registration, and I don't think spaces in URLs are/should be legal, so I'd escape them, too.

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=389106#c18)• 18 years ago |
|  | |

spaces are already escaped.

|  | [Mike Connor [:mconnor]](/user_profile?user_id=96908)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=389106#c19)• 18 years ago |
|  | |

Comment on [attachment 273285](/attachment.cgi?id=273285 "alternative patch (branch version)") [[details]](/attachment.cgi?id=273285&action=edit "alternative patch (branch version)") [[diff]](/attachment.cgi?id=273285&action=diff "alternative patch (branch version)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273285)
alternative patch (branch version)
a=mconnor on behalf of drivers, please land on GECKO181\_20070712\_RELBRANCH for
2.0.0.6, MOZILLA\_1\_8\_BRANCH for 2.0.0.7, and MOZILLA\_1\_8\_0\_BRANCH for Thunderbird 1.5.0.13
[Attachment #273285](/attachment.cgi?id=273285&action=edit "alternative patch (branch version)") -
Flags: approval1.8.1.7+
[Attachment #273285](/attachment.cgi?id=273285&action=edit "alternative patch (branch version)") -
Flags: approval1.8.1.6+
[Attachment #273285](/attachment.cgi?id=273285&action=edit "alternative patch (branch version)") -
Flags: approval1.8.0.13+

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=389106#c20)• 18 years ago |
|  | |

alternative patch (branch version) checked in:
GECKO181\_20070712\_RELBRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.12.6.1; previous revision: 1.290.4.12
done
MOZILLA\_1\_8\_BRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.13; previous revision: 1.290.4.12
done
MOZILLA\_1\_8\_0\_BRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.2.4.2; previous revision: 1.290.4.2.4.1
done
alternative patch / HEAD:
Enter passphrase for key '/c/Dokumente und Einstellungen/chb/.ssh/id\_dsa':
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.317; previous revision: 1.316
doneStatus: NEW → RESOLVEDClosed: 18 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=389106#c21)• 18 years ago |
|  | |

Adding tracking keywords fixed1.8.0.13, fixed1.8.1.6, fixed1.8.1.7 per aboveKeywords: [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---),
[fixed1.8.1.6](/buglist.cgi?keywords=fixed1.8.1.6&resolution=---),
[fixed1.8.1.7](/buglist.cgi?keywords=fixed1.8.1.7&resolution=---)

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=389106#c22)• 18 years ago |
|  | |

QA could use some help identifying which areas we should examine more closely for possible regressions. Thanks.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=389106#c23)• 18 years ago |
|  | |

I don't have aim installed so I can't verify this but I suspect that the IE / Trillian demo modified to use an iframe's src attribute would work as a testcase.
<http://www.xs-sniper.com/nmcfeters/Cross-App-Scripting-2.html>

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=389106#c24)• 18 years ago |
|  | |

Hm, actually, let me verify that statement about spaces...

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=389106#c25)• 18 years ago |
|  | |

OK, I'm not sure now what made me think that we escaped spaces, but we don'tStatus: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=389106#c26)• 18 years ago |
|  | |

Attached file
[windows exe test handler](attachment.cgi?id=273424)
— [Details](attachment.cgi?id=273424&action=edit)

Heres a compiled version of the test program from the blog post. Put it on your machine somewhere (c:\tmp\testurl.exe) and then add the registry keys as described in the blog post.
Create a test page that has
<a href='testurl:one" extra parameters'>double-quote test</a>
<iframe src='testurl:two" extra parameters'></iframe>
The patch also escapes the back-tick (`) so make some urls that use that, too.
<a href="testurl:three' single-quote-test">single quote</a>
<a href='testurl:four` back-tick-test'>back-tick test</a>
The testurl source should work on linux just fine if someone compiles it, but I'm not sure how to register a protocol handler there. Ditto Mac.

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=389106#c27)• 18 years ago |
|  | |

Attached patch

[escape spaces](attachment.cgi?id=273434&action=diff)
— [Details](attachment.cgi?id=273434&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273434)

Escape spaces. I'll have to test javascript: and data: URLs too once this build finishes...
[Attachment #273260](/attachment.cgi?id=273260&action=edit "patch") -
Attachment is obsolete: true
[Attachment #273434](/attachment.cgi?id=273434&action=edit "escape spaces") -
Flags: superreview?(dveditz)
[Attachment #273434](/attachment.cgi?id=273434&action=edit "escape spaces") -
Flags: review?(bzbarsky)

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=389106#c28)• 18 years ago |
|  | |

ok, spaces in javascript: and data: seem to work fine even with the patch.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=389106#c29)• 18 years ago |
|  | |

Comment on [attachment 273434](/attachment.cgi?id=273434 "escape spaces") [[details]](/attachment.cgi?id=273434&action=edit "escape spaces") [[diff]](/attachment.cgi?id=273434&action=diff "escape spaces") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273434)
escape spaces
r=bzbarsky
[Attachment #273434](/attachment.cgi?id=273434&action=edit "escape spaces") -
Flags: review?(bzbarsky) → review+

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=389106#c30)• 18 years ago |
|  | |

Re: %1 being quoted... a quick scan shows that several handlers do not quote %1. For starters
callto URL: CallTo Protocol rundll32.exe msconf.dll,CallToProtocolHandler %l
ftp URL:File Transfer Protocol "C:\Program Files\Internet Explorer\IEXPLORE.EXE" %1
LDAP URL:LDAP Protocol "C:\Program Files\Outlook Express\wab.exe" /ldap:%1
mailto URL:MailTo Protocol "%ProgramFiles%\Outlook Express\msimn.exe" /mailurl:%1

|  | [Window Snyder](/user_profile?user_id=254605) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a188193_254605)• 18 years ago |

Group: security

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=389106#c31)• 18 years ago |
|  | |

Attached patch

[escape spaces, branch version](attachment.cgi?id=273501&action=diff)
— [Details](attachment.cgi?id=273501&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273501)

this one just adds a ReplaceSubstring call, should be safer than touching NS\_EscapeURL
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: superreview?(dveditz)
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: review?(bzbarsky)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=389106#c32)• 18 years ago |
|  | |

Comment on [attachment 273501](/attachment.cgi?id=273501 "escape spaces, branch version") [[details]](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") [[diff]](/attachment.cgi?id=273501&action=diff "escape spaces, branch version") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273501)
escape spaces, branch version
sr=dveditz
I'm happier with this more conservative fix for the FF2 re-spin release. If the NS\_EscapeURL fix looks OK on trunk we can do that perhaps for 2.0.0.7
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: superreview?(dveditz)
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: superreview+
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: approval1.8.1.6?
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: approval1.8.0.13?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a190588_1689)• 18 years ago |

Keywords: [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---),
[fixed1.8.1.6](/buglist.cgi?keywords=fixed1.8.1.6&resolution=---),
[fixed1.8.1.7](/buglist.cgi?keywords=fixed1.8.1.7&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=389106#c33)• 18 years ago |
|  | |

Comment on [attachment 273434](/attachment.cgi?id=273434 "escape spaces") [[details]](/attachment.cgi?id=273434&action=edit "escape spaces") [[diff]](/attachment.cgi?id=273434&action=diff "escape spaces") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273434)
escape spaces
sr=dveditz for trunk and possibly 1.8 branch.
[Attachment #273434](/attachment.cgi?id=273434&action=edit "escape spaces") -
Flags: superreview?(dveditz)
[Attachment #273434](/attachment.cgi?id=273434&action=edit "escape spaces") -
Flags: superreview+
[Attachment #273434](/attachment.cgi?id=273434&action=edit "escape spaces") -
Flags: approval1.8.1.7?

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=389106#c34)• 18 years ago |
|  | |

Comment on [attachment 273434](/attachment.cgi?id=273434 "escape spaces") [[details]](/attachment.cgi?id=273434&action=edit "escape spaces") [[diff]](/attachment.cgi?id=273434&action=diff "escape spaces") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273434)
escape spaces
trunk:
Checking in nsEscape.cpp;
/cvsroot/mozilla/xpcom/io/nsEscape.cpp,v <-- nsEscape.cpp
new revision: 1.37; previous revision: 1.36
done

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a192605_20209)• 18 years ago |

[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: review?(bzbarsky) → review+

|  | [Mike Connor [:mconnor]](/user_profile?user_id=96908)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=389106#c35)• 18 years ago |
|  | |

Comment on [attachment 273501](/attachment.cgi?id=273501 "escape spaces, branch version") [[details]](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") [[diff]](/attachment.cgi?id=273501&action=diff "escape spaces, branch version") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389106&attachment=273501)
escape spaces, branch version
please land on all of the same branches as the previous patch
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: approval1.8.1.6?
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: approval1.8.1.6+
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: approval1.8.0.13?
[Attachment #273501](/attachment.cgi?id=273501&action=edit "escape spaces, branch version") -
Flags: approval1.8.0.13+

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=389106#c36)• 18 years ago |
|  | |

MOZILLA\_1\_8\_BRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.14; previous revision: 1.290.4.13
done
MOZILLA\_1\_8\_0\_BRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.2.4.3; previous revision: 1.290.4.2.4.2
done
GECKO181\_20070712\_RELBRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.12.6.2; previous revision: 1.290.4.12.6.1
done
Status: REOPENED → RESOLVEDClosed: 18 years ago → 18 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=389106#c37)• 18 years ago |
|  | |

Fixes checked into branches, adding fix-tracking keywordsKeywords: [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---),
[fixed1.8.1.6](/buglist.cgi?keywords=fixed1.8.1.6&resolution=---),
[fixed1.8.1.7](/buglist.cgi?keywords=fixed1.8.1.7&resolution=---)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=389106#c38)• 18 years ago |
|  | |

Attached file
[Handlers in html format](attachment.cgi?id=273528) (obsolete)
— [Details](attachment.cgi?id=273528&action=edit)

There are 188 URL Protocol handlers in this list... I removed the vast majority of duplicates but some may have slipped through.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=389106#c39)• 18 years ago |
|  | |

Comment on [attachment 273528](/attachment.cgi?id=273528 "Handlers in html format") [[details]](/attachment.cgi?id=273528&action=edit "Handlers in html format")
Handlers in html format
Actually, a lot slipped through but it is quite a bit cleaner than it was. ;)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=389106#c40)• 18 years ago |
|  | |

Attached file
[updated handlers in html format](attachment.cgi?id=273560) (obsolete)
— [Details](attachment.cgi?id=273560&action=edit)

Same list after I went through a bunch of the handlers. There is a very large number of protocol handlers that can be excluded by verifying that the param can be an escaped url. I've denoted these with an x in the "Safe?" column and would appreciate another set of eyes going over these just in case as well as checking the remaining ones.
[Attachment #273528](/attachment.cgi?id=273528&action=edit "Handlers in html format") -
Attachment is obsolete: true

|  | [Colin Barrett [:cbarrett]](/user_profile?user_id=56157) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=389106#c41)• 18 years ago |
|  | |

Attached file
[equivalent test program for mac os x](attachment.cgi?id=273580)
— [Details](attachment.cgi?id=273580&action=edit)

I wrote a quick app to act like the main.c test program that Jesper wrote. This one. however, works on Mac OS X.
Unzip it, open the .xcodeproj (with Xcode), and click the Build button (hammer shaped). That's enough to get it to register for the testurl:// protocol handler. FYI, on Mac OS X to register an application to handle specific URL types, you add an entry to it's Info.plist. Unlike Windows or Linux, URLs aren't passed in as command line arguments, the application is notified via an Apple Event (an RPC method on the Mac).
What's curious is that running this test app, it doesn't appear Firefox on the Mac is vulnerable. At least in the tests I did. I'm not entirely sure \*why\*, though.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=389106#c42)• 18 years ago |
|  | |

Because we're not passing the URL on the command line on Mac? The actual call we use is:
108 rv = ::LSOpenCFURLRef(myURLRef, NULL);
presumably this does the right thing. ;)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=389106#c43)• 18 years ago |
|  | |

I believe we do have one scenario on Mac OS X where the data received by the Apple Event is converted to a command line
<http://lxr.mozilla.org/seamonkey/source/toolkit/xre/nsCommandLineServiceMac.cpp>
This is due to needing a restart during startup. We should be able to use similar handling in Windows if the need to restart on startup is removed.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=389106#c44)• 18 years ago |
|  | |

Colin: Thanks for creating this test program. I am able to run the program fine, but I am wondering if it is expected to get a blank window (no error message or feedback)? Is it necessary for me to edit the plist file with a URL?
(In reply to [comment #41](/show_bug.cgi?id=389106#c41 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> Created an attachment (id=273580) [details]
> equivalent test program for mac os x
>
> I wrote a quick app to act like the main.c test program that Jesper wrote. This
> one. however, works on Mac OS X.
>

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=389106#c45)• 18 years ago |
|  | |

Attached file
[equivalent test program for linux i686](attachment.cgi?id=273645) (obsolete)
— [Details](attachment.cgi?id=273645&action=edit)

I took the code from the blog that reported this, corrected it to work with C99, and compiled it on my Linux i686 machine. Included is a compiled binary and the source code.

|  | [Adam Guthrie](/user_profile?user_id=195226) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=389106#c46)• 18 years ago |
|  | |

Comment on [attachment 273645](/attachment.cgi?id=273645 "equivalent test program for linux i686") [[details]](/attachment.cgi?id=273645&action=edit "equivalent test program for linux i686")
equivalent test program for linux i686
This is not going to be of any use unless someone can figure out how to do to GNOME what the Windows Registry entries in the blog post do to Windows (assuming it's even possible).
[Attachment #273645](/attachment.cgi?id=273645&action=edit "equivalent test program for linux i686") -
Attachment is obsolete: true

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=389106#c47)• 18 years ago |
|  | |

To register a protocol handler on linux, just do this (I think gconf-editor can probably do that):
Create /desktop/gnome/url-handlers/foo/enabled (type boolean), set it to true
Create /desktop/gnome/url-handlers/foo/command (type string), set it to /usr/local/bin/foo "%s"
(replace that path with wherever you put the program; replace "foo" with whatever you want to call the protocol)

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=389106#c48)• 18 years ago |
|  | |

Attached file
[updated handlers in html format](attachment.cgi?id=273656)
— [Details](attachment.cgi?id=273656&action=edit)

[Attachment #273560](/attachment.cgi?id=273560&action=edit "updated  handlers in html format") -
Attachment is obsolete: true

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=389106#c49)• 18 years ago |
|  | |

Steps to verify that the patch does what it is supposed to do:
1. Register a protocol handler for the test apps ([attachment 273424](/attachment.cgi?id=273424 "windows exe test handler") [[details]](/attachment.cgi?id=273424&action=edit "windows exe test handler") etc)
For Windows, the URL in the URL field has instructions for how to do that
For Mac, see [comment 41](/show_bug.cgi?id=389106#c41 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers")
For Linux, see [comment 47](/show_bug.cgi?id=389106#c47 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"), although I haven't tested that
2. Run that protocol handler
Assuming you named the protocol "foo", enter this in the URL bar:
foo://"foo" 'bar' `baz`
The test app should show two arguments; the second one should be:
foo://%22foo%22%20'bar'%20%60baz%60/

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a269630_141755)• 18 years ago |

Depends on: [389469](/show_bug.cgi?id=389469 "NEW - Protocol-handler applications that don't work when the browser escapes back-ticks, double-quotes, and spaces")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=389106#c50)• 18 years ago |
|  | |

'foo://"foo" blah' doesn't show the original problem in non-fixed builds on Windows -- the first dquote encountered needs to be followed by a space, otherwise it and it's closing dquote are just concatenated as part of the same "argument". Make a page containing the tests in [comment 26](/show_bug.cgi?id=389106#c26 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"), too.

|  | [Harry Johnston](/user_profile?user_id=149841) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=389106#c51)• 18 years ago |
|  | |

Wouldn't the correct way to respond to a URI with unencoded characters not permitted by STD66 be to inform the user that the link is invalid and refuse to follow it?

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=389106#c52)• 18 years ago |
|  | |

(In reply to [comment #47](/show_bug.cgi?id=389106#c47 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> To register a protocol handler on linux, just do this (I think gconf-editor
> can probably do that):
I can't work out how to make my gconf-editor do that, but this works:
gconftool-2 --type string --set /desktop/gnome/url-handlers/args/command
"args \"%s\""
gconftool-2 --type boolean --set /desktop/gnome/url-handlers/args/enabled true
(The extra "" around %s makes no difference.)

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=389106#c53)• 18 years ago |
|  | |

Attached file
[equivalent test bash script](attachment.cgi?id=273738)
— [Details](attachment.cgi?id=273738&action=edit)

for Linux, any hardware,
but I doubt Linux argument handling suffered the same problems as the Windows URL protocol handler registration.

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a308933_274246)• 18 years ago |

[Attachment #273738](/attachment.cgi?id=273738&action=edit "equivalent test bash script") -
Attachment description: equivalant test bash script → equivalent test bash script
[Attachment #273738](/attachment.cgi?id=273738&action=edit "equivalent test bash script") -
Attachment mime type: application/x-sh → text/x-sh

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=389106#c54)• 18 years ago |
|  | |

(In reply to [comment #50](/show_bug.cgi?id=389106#c50 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> 'foo://"foo" blah' doesn't show the original problem in non-fixed builds on
> Windows -- the first dquote encountered needs to be followed by a space,
> otherwise it and it's closing dquote are just concatenated as part of the same
> "argument". Make a page containing the tests in [comment 26](/show_bug.cgi?id=389106#c26 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"), too.
>
For the Testcase from [comment #26](/show_bug.cgi?id=389106#c26 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers") and #49 i can confirm this bug fixed for Vista and XP and show the expected results - the detailed test results for xp and Vista are on [http://wiki.mozilla.org/Firefox:2.0.0.6:Test\_Plan:protocol\_handler#Windows\_Tomcat](http://wiki.mozilla.org/Firefox%3A2.0.0.6%3ATest_Plan%3Aprotocol_handler#Windows_Tomcat)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=389106#c55)• 18 years ago |
|  | |

(In reply to [comment #51](/show_bug.cgi?id=389106#c51 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> Wouldn't the correct way to respond to a URI with unencoded characters not
> permitted by STD66 be to inform the user that the link is invalid and refuse to
> follow it?
space and dquote are perfectly valid characters according to rfc 3986 (std66), encoded or not. Previous specs (rfc 1738) considered them "unsafe" and recommended encoding them, but the most recent leaves it up to the application to figure out when it wants to encode them or not. The spec does make clear that single-quote/apostrophe is a reserved sub-delim and encoded and unencoded forms are NOT equivalent unlike space and dquote.

|  | [Colin Barrett [:cbarrett]](/user_profile?user_id=56157) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=389106#c56)• 18 years ago |
|  | |

No, it just prints to standard output. I should have included that in the directions. Open up Console.app (/Applications/Utilities/Console.app), and you'll see it print out the URL that it was passed there.
(In reply to [comment #44](/show_bug.cgi?id=389106#c44 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> Colin: Thanks for creating this test program. I am able to run the program
> fine, but I am wondering if it is expected to get a blank window (no error
> message or feedback)? Is it necessary for me to edit the plist file with a URL?
>
> (In reply to [comment #41](/show_bug.cgi?id=389106#c41 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> > Created an attachment (id=273580) [details] [details]
> > equivalent test program for mac os x
> >
> > I wrote a quick app to act like the main.c test program that Jesper wrote. This
> > one. however, works on Mac OS X.
> >
>

|  | [Ben Bucksch (:BenB)](/user_profile?user_id=22599) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=389106#c57)• 18 years ago |
|  | |

FWIW, RFC 2394 2.4.3 even called spaces explicitly "disallowed".

|  | [Harry Johnston](/user_profile?user_id=149841) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=389106#c58)• 18 years ago |
|  | |

(In reply to [comment #55](/show_bug.cgi?id=389106#c55 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> space and dquote are perfectly valid characters according to rfc 3986 (std66),
> encoded or not.
I've just double checked and they are not permitted (unless encoded). Are we reading the same document?
<http://www.faqs.org/rfc/std/std66.txt>
The only characters this permits are (a) the "reserved characters" which schemes may use as delimiters:
gen-delims = ":" / "/" / "?" / "#" / "[" / "]" / "@"
sub-delims = "!" / "$" / "&" / "'" / "(" / ")"
/ "\*" / "+" / "," / ";" / "="
(b) the "unreserved characters":
unreserved = ALPHA / DIGIT / "-" / "." / "\_" / "~"
and (c) percent-encoded characters. Anything else is illegal.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=389106#c59)• 18 years ago |
|  | |

Using 2.0.0.5 release source tarball, confirmed that we are indeed relying on the system routine LSOpenCFURLRef to handle escaping the URL passed in. In the code below, the "url" value is an unescaped url but stepping over the LSOpenCFURLRef with Colin's testapp URL, the escaped version of this URL appears in the console window. So the system routine is escaping it before passing it along.
// void LaunchURL (in string url);
// Given a url string, call ICLaunchURL using url
// Under OS X use LaunchServices instead of IC
NS\_IMETHODIMP nsInternetConfigService::LaunchURL(const char \*url)
{
nsresult rv = NS\_ERROR\_FAILURE;
CFURLRef myURLRef = ::CFURLCreateWithBytes(
kCFAllocatorDefault,
(const UInt8\*)url,
strlen(url),
kCFStringEncodingUTF8, NULL);
if (myURLRef)
{
rv = ::LSOpenCFURLRef(myURLRef, NULL);
::CFRelease(myURLRef);
}
return rv;
}
#0 0x14a1daba in nsInternetConfigService::LaunchURL at nsInternetConfigService.cpp:112
#1 0x14a1c4b7 in nsOSHelperAppService::LoadUriInternal at nsOSHelperAppService.cpp:184
#2 0x14a17111 in nsExternalHelperAppService::handleExternalLoadEvent at nsExternalHelperAppService.cpp:1096
#3 0x01069527 in PL\_HandleEvent at plevent.c:688
#4 0x010693d0 in PL\_ProcessPendingEvents at plevent.c:623
#5 0x010698f3 in \_md\_EventReceiverProc at plevent.c:1559
#6 0x9082cf92 in CFRunLoopRunSpecific
#7 0x9082cace in CFRunLoopRunInMode
#8 0x92dec8d8 in RunCurrentEventLoopInMode
#9 0x92debf19 in ReceiveNextEventCommon
#10 0x92e34a74 in \_AcquireNextEvent
#11 0x92e348bc in RunApplicationEventLoop
#12 0x2d96cc99 in nsAppShell::Run at nsAppShell.cpp:93
#13 0x2ad8dd36 in nsAppStartup::Run at nsAppStartup.cpp:151
#14 0x0000b144 in XRE\_main at nsAppRunner.cpp:2711
#15 0x00002b88 in main at nsBrowserApp.cpp:61

|  | [John Daggett (:jtd)](/user_profile?user_id=280585) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=389106#c60)• 18 years ago |
|  | |

Found an interesting article on potential Mac OS X URL handler attacks:
<http://www.kernelthread.com/mac/apme/security/url.html>
To list URL handlers on the system, type into a Terminal window:
cd /System/Library/Frameworks/ApplicationServices.framework/Frameworks/LaunchServices.framework/Support
./lsregister -dump
To filter out only the list of URL handlers:
./lsregister -dump | grep bindings | egrep -v '[\.]' | awk '{print $2 " " $3 " " $4}' | sort -u | grep ':'
This outputs the following on my machine:
acrobat:
addressbook:
afp:
aim:
applescript:
daap:
dict:
feed:
feed:, feeds:, feedsearch:
file:
ftp:
gopher:
help:
http:
http:, https:
https:
ical:
ichat:
irc:
itms:, itmss:
keynote:
magnet:
mailto:
nib:
pcast:, itpc:
photo:
qs:
qsinstall:
qss-http:
qssp-http:
rtsp:
see:
sherlock:
silc:
ssh:
telnet:
testurl:
txmt:
vdownload:
webcal:
x-man-page:
xtorrentsearch:

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=389106#c61)• 18 years ago |
|  | |

(In reply to [comment #53](/show_bug.cgi?id=389106#c53 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> Created an attachment (id=273738) [details]
> equivalant test bash script
>
> for Linux, any hardware,
> but I doubt Linux argument handling suffered the same problems as the Windows
> URL protocol handler registration.
>
was linux vulnerable even before the patch?
according to my tests it shows a single argv[1] according to 'cat /proc/PID/cmdline | od -c" ?

|  | [georgi - hopefully not receiving bugspam](/user_profile?user_id=23768) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=389106#c62)• 18 years ago |
|  | |

is there working linux exploit involving external protocol handlers?

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=389106#c63)• 17 years ago |
|  | |

(In reply to [comment #61](/show_bug.cgi?id=389106#c61 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> was linux vulnerable even before the patch?
I don't believe so, as no shell was used to launch the other application, so there was always only one argv.
The issue on Linux is probably just that applications are registered to receive a url, so, if we use them, we should give them a "legal" url.

|  | [Robert Longson [:longsonr]](/user_profile?user_id=218550) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a765100_218550)• 17 years ago |

Depends on: [390126](/show_bug.cgi?id=390126 "RESOLVED FIXED - base64 encoded images no longer display if they contain spaces")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a801737_1689)• 17 years ago |

Alias: CVE-2007-3845

|  | [JakartaDean](/user_profile?user_id=284940) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=389106#c64)• 17 years ago |
|  | |

I'm new around here; please excuse me if this is the wrong place or a previously beaten-to-death issue. I'm also far from knowledgeable about this stuff; I did search bugzilla a few different ways without success.
I'm wondering about handling of the at-sign "@" included in the query portion of a URI. One site I like, the site www.cuetable.com used to work fine with a long query, which often included this symbol. It has stopped when the at-sign is included, from at least 2.0.0.5 but likely earlier. My reading of RFC3986 is that the at-sign is allowed:
query = \*( pchar / "/" / "?" ) ; and
pchar = unreserved / pct-encoded / sub-delims / ":" / "@"
yet Firefox now percent-encodes the at-sign, which has broken the argument handler of the above Shockwave application. Am I wrong, or has someone perhaps overzealously limited the use of reserved characters?

|  | [Harry Johnston](/user_profile?user_id=149841) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=389106#c65)• 17 years ago |
|  | |

(In reply to [comment #64](/show_bug.cgi?id=389106#c64 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> I'm wondering about handling of the at-sign "@" included in the query portion
> of a URI. One site I like, the site www.cuetable.com used to work fine with a
> long query, which often included this symbol. It has stopped when the at-sign
> is included, from at least 2.0.0.5 but likely earlier.
Works for me on 2.0.0.5. Do you have any plugins or extensions installed that might be responsible? Or perhaps a proxy server?

|  | [JakartaDean](/user_profile?user_id=284940) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=389106#c66)• 17 years ago |
|  | |

I've got the following extensions (time for some house cleaning, I see) none of which look like they could be responsible:
All-In-One Sidebar
ColorfulTabs
CustomizeGoogle
Duplicate Tab
infoRSS
NoScript
OpenDownload
Tab Clicking Options
Tabbrowser Preferences
To clarify, if I click on the following link:
<http://cuetable.com/P/?@4AdOx3BBKy3CYjd4DHgd4EEIq4FWFl1GHeJ2HdYA1PWEn4QVWl4RTll3WaAd3Wape3WYSc4lVWl3lbRS3lPpp4lbXc4lVxu4lbNq1lWMk1lWMj4mTll3mbEG3mbUH>@
Firefox tries to open the following:
<http://cuetable.com/P/?%404AdOx3BBKy3CYjd4DHgd4EEIq4FWFl1GHeJ2HdYA1PWEn4QVWl4RTll3WaAd3Wape3WYSc4lVWl3lbRS3lPpp4lbXc4lVxu4lbNq1lWMk1lWMj4mTll3mbEG3mbUH%40>
i.e. the at-signs have been converted to %40, which breaks the format the query expects.

|  | [Harry Johnston](/user_profile?user_id=149841) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=389106#c67)• 17 years ago |
|  | |

(In reply to [comment #66](/show_bug.cgi?id=389106#c66 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> I've got the following extensions (time for some house cleaning, I see)
Please try disabling them, restarting Firefox and repeating the test.
Try the following (much simpler) link which works for me:
[http://www.scms.waikato.ac.nz/~harry/test@hi.html](http://www.scms.waikato.ac.nz/~harry/test%40hi.html)

|  | [JakartaDean](/user_profile?user_id=284940) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=389106#c68)• 17 years ago |
|  | |

It was NoScript. It aggressively blocks XSS stuff, either disabling NoScript or enabling it but disabling the Anti-XSS option clears the problem up. I didn't even know it was there. Thanks very much for your help Harry.
BTW, your link worked fine, even with all add-ons enabled including the Anti-XSS feature of NoScript.
Regards,
Dean

|  | [Harry Johnston](/user_profile?user_id=149841) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=389106#c69)• 17 years ago |
|  | |

(In reply to [comment #68](/show_bug.cgi?id=389106#c68 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))
> BTW, your link worked fine, even with all add-ons enabled including the
> Anti-XSS feature of NoScript.
Yep, my mistake - of course a regular file will work either way because the web server will decode the URL as necessary. Glad the problem is resolved.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a963388_1689)• 17 years ago |

Whiteboard: [sg:critical]

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a2109534_11608)• 17 years ago |

Summary: firefox may not escape quotes everywhere → Escape URIs (especially quotes) when passing them to external protocol handlers

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a2109649_11608)• 17 years ago |

Depends on: [392240](/show_bug.cgi?id=392240 "RESOLVED WONTFIX - doesn't execute the commands in the url.")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a2345078_1689)• 17 years ago |

Flags: in-testsuite?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a2688165_1689)• 17 years ago |

[Attachment #273434](/attachment.cgi?id=273434&action=edit "escape spaces") -
Flags: approval1.8.1.7?

|  | [Stephen Donner [:stephend] Not actively reading bugmail](/user_profile?user_id=79002) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=389106#c70)• 17 years ago |
|  | |

I ran Rob's NSIS installer script to register some protocols listed on <https://bugzilla.mozilla.org/attachment.cgi?id=274255>, as well as the testurl.exe command-line shell, to verify that the first URI in the bugzilla attachment triggers the testurl.exe to run, but not the 2nd and 3rd ones, which usually have "%00" or "%[invalid char]". Verifying this as fixed, then, using a Thunderbird version 1.5.0.13 (20070809) (release candidate) build.
Replacing fixed1.8.0.13 with verified1.8.0.13.Keywords: [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---) → [verified1.8.0.13](/buglist.cgi?keywords=verified1.8.0.13&resolution=---)

|  | [Stephen Donner [:stephend] Not actively reading bugmail](/user_profile?user_id=79002) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=389106#c71)• 17 years ago |
|  | |

Sorry, the above is actually meant for [bug 389580](/show_bug.cgi?id=389580 "RESOLVED FIXED - some schemes with %00 launch unexpected handlers on windows"); reverting verified1.8.0.13 back to fixed1.8.0.13; I'll come back and list the steps I used to verify this bug. Sorry about that...Keywords: [verified1.8.0.13](/buglist.cgi?keywords=verified1.8.0.13&resolution=---) → [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---)

|  | [Stephen Donner [:stephend] Not actively reading bugmail](/user_profile?user_id=79002) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=389106#c72)• 17 years ago |
|  | |

Using Thunderbird 1.5.0.13 release candidate 1 (build ID: version 1.5.0.13 (20070809)) on Windows XP, I tested:
1) Making HTML testcases out of the three testcase snippets from dveditz in [comment 26](/show_bug.cgi?id=389106#c26 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"). I then:
2) Sent myself three emails, each with its own "foo 1", "foo 2", and "foo 3" testcases.
3) Next, I read each email and clicked on the <a href> in the testcase, which in all cases launched the "External Protocol Request", each of whose strings I compared, making sure that the back-tick (`) and the double-quotes (") were escaped by %60 and %22, respectively.
From my talks with biesi and juanb (and reading the bug), I think this is enough to verify that we're doing the right thing. This VM image has the setup from [comment 70](/show_bug.cgi?id=389106#c70 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"), but the steps to verify this particular bug are different, of course.
Replacing fixed1.8.0.13 keyword with verified1.8.0.13.Keywords: [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---) → [verified1.8.0.13](/buglist.cgi?keywords=verified1.8.0.13&resolution=---)

|  | [Stephen Donner [:stephend] Not actively reading bugmail](/user_profile?user_id=79002) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=389106#c73)• 17 years ago |
|  | |

Oh, and I forgot to mention that the single quote in the second testcase wasn't escaped (seems that's intended, from [comment 12](/show_bug.cgi?id=389106#c12 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers") and [comment 13](/show_bug.cgi?id=389106#c13 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers")).

|  | [Giorgio Maone [:ma1]](/user_profile?user_id=151994) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=389106#c74)• 17 years ago |
|  | |

Looks like fixing this bug made some difference, after all:
<http://www.gnucitizen.org/blog/ie-pwns-secondlife>

|  | [Ria Klaassen (not reading all bugmail)](/user_profile?user_id=154309) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a20447121_154309)• 17 years ago |

Depends on: [422609](/show_bug.cgi?id=422609 "RESOLVED WORKSFORME - Evaluating Javascript with leading spaces fails in some cases")

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389106#a430158786_159069)• 4 years ago |

Blocks: [CVE-2021-43541](/show_bug.cgi?id=1696685 "RESOLVED FIXED - URIs passed to external application protocol / URL handlers should have spaces escaped")
You need to [log in](/show_bug.cgi?id=389106&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_38cb32f3_20250125_104819.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/389580)
* [XML](/show_bug.cgi?ctype=xml&id=389580)

Closed
[Bug 389580](/show_bug.cgi?id=389580)
(CVE-2007-4041)

Opened 18 years ago
Closed 18 years ago

# some schemes with %00 launch unexpected handlers on windows

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

some schemes with %00 launch unexpected handlers on windows

## Categories

### (Core Graveyard :: File Handling, defect)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=File%20Handling#File%20Handling)

File Handling
▾

Core Graveyard :: File Handling
For issues dealing with helper applications, and guessing
Content Types when they aren't specified/known (ftp:, file:, jar:, but generally not http:). This component does not cover: backend networking issues, such as those covered by **Networking: FTP** or **Networking: File**, nor does it cover the **Download Manager** which has its own component in **Toolkit.**
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=File%20Handling&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=File%20Handling&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=File%20Handling)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (Not tracked)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |

## People

### (Reporter: dveditz, Assigned: Biesinger)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/80ef9e8cf2739567a75dbd94e6eb124a?d=mm&size=40)  [Biesinger](/user_profile?user_id=15661)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=40)  [dveditz](/user_profile?user_id=1689)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

26 people

## References

### ( [URL](http://xs-sniper.com/blog/remote-command-exec-firefox-2005/ "http://xs-sniper.com/blog/remote-command-exec-firefox-2005/") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[xs-sniper.com/blog/remote-command-exe...](http://xs-sniper.com/blog/remote-command-exec-firefox-2005/ "http://xs-sniper.com/blog/remote-command-exec-firefox-2005/")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed1.8.1.6, verified1.8.0.13, verified1.8.1.8, Whiteboard: [sg:investigate])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2007-4041

[Keywords:](/describekeywords.cgi)

[fixed1.8.1.6](/buglist.cgi?keywords=fixed1.8.1.6&resolution=---),
[verified1.8.0.13](/buglist.cgi?keywords=verified1.8.0.13&resolution=---),
[verified1.8.1.8](/buglist.cgi?keywords=verified1.8.1.8&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:investigate]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [blocking1.9](#a2239_1689 "18 years ago") | ? |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9 | ? |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.8.1.6](#a2239_1689 "18 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.8.1.6 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.8.1.8](#c0 "18 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.8.1.8 | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (7 files, 3 obsolete files)

| [patch](/attachment.cgi?id=273843)  [18 years ago](#c1)  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)   968 bytes, patch | bzbarsky : [review+](#c3 "18 years ago")  dveditz : [superreview+](#c7 "18 years ago")  dveditz : [approval1.8.1.6+](#c9 "18 years ago")  dveditz : [approval1.8.1.8+](#c0 "18 years ago")  dveditz : [approval1.8.0.13+](#c9 "18 years ago") | [Details](/attachment.cgi?id=273843&action=edit) | [Diff](/attachment.cgi?id=273843&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389580&attachment=273843) |
| --- | --- | --- |
| [TESTCASE: Based on code in comment #14](/attachment.cgi?id=273999)  [18 years ago](#c15)  [u279076](/user_profile?user_id=279076)   387 bytes, text/html |  | [Details](/attachment.cgi?id=273999&action=edit) |
| [TESTCASE: Revised above](/attachment.cgi?id=274002)  [18 years ago](#c16)  [u279076](/user_profile?user_id=279076)   377 bytes, text/html |  | [Details](/attachment.cgi?id=274002&action=edit) |
| [Testcase for Secunia mailto:%](/attachment.cgi?id=274154)  [18 years ago](#c18)  [Juergen Schmidt](/user_profile?user_id=151448)   864 bytes, text/html |  | [Details](/attachment.cgi?id=274154&action=edit) |
| [% triggers the bug](/attachment.cgi?id=274230)  [17 years ago](#c20)  [Juergen Schmidt](/user_profile?user_id=151448)   1.10 KB, text/html |  | [Details](/attachment.cgi?id=274230&action=edit) |
| [installer that sets up all of the protocol handlers](/attachment.cgi?id=274232)  [17 years ago](#c21)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   66.11 KB, application/octet-stream |  | [Details](/attachment.cgi?id=274232&action=edit) |
| [a couple of testcases using % and not containing any %00](/attachment.cgi?id=274236)  [17 years ago](#c23)  [Juergen Schmidt](/user_profile?user_id=151448)   1.12 KB, text/html |  | [Details](/attachment.cgi?id=274236&action=edit) |
| [NSIS script](/attachment.cgi?id=274237)  [17 years ago](#c25)  [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755)   13.07 KB, text/plain |  | [Details](/attachment.cgi?id=274237&action=edit) |
| [testpage for the protocol list](/attachment.cgi?id=274255)  [17 years ago](#c28)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   35.14 KB, text/html |  | [Details](/attachment.cgi?id=274255&action=edit) |
| [createuri experimental patch](/attachment.cgi?id=274522)  [17 years ago](#c37)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   6.26 KB, patch |  | [Details](/attachment.cgi?id=274522&action=edit) | [Diff](/attachment.cgi?id=274522&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389580&attachment=274522) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=389580#c0)• 18 years ago |
|  | |

On Windows XP some urls for "web" protocols that contain %00 launch the wrong handler and appear to be able to launch local programs, with limited argument passing. It is not yet clear that this can be used to compromise a machine but we can always fear the worst.
The same behavior is observed using "Run" from the Windows Start menu for the affected protocols (http, https, ftp, gopher, telnet, mailto, news, snews, nttp, possibly others?).
The behavior seems to be that if there's a %00 in the URL for these schemes then the URL Protocol handler is not called, instead the FileType handler is called based on the extension of the full url. The url is then passed to that File handler. For "non-web" URL handlers the URL is passed to the expected handler.
In Firefox browser protocols are handled internally so are not vulnerable, but the mailnews protocols are handed off to the OS and can be abused in this way.
The fix in [bug 389106](/show_bug.cgi?id=389106 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers") mitigates the published testcases but doesn't actually "fix" the problem.
<http://xs-sniper.com/blog/remote-command-exec-firefox-2005/>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389580#a2239_1689)• 18 years ago |

Flags: blocking1.9?Flags: blocking1.8.1.7+Flags: blocking1.8.1.6+Whiteboard: [sg:investigate]

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=389580#c1)• 18 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=273843&action=diff)
— [Details](attachment.cgi?id=273843&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389580&attachment=273843)

don't load external URLs containing %00
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: superreview?(dveditz)
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: review?(bzbarsky)

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=389580#c2)• 18 years ago |
|  | |

Should we do anything about escaped newlines/carriage returns/tabs?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=389580#c3)• 18 years ago |
|  | |

Comment on [attachment 273843](/attachment.cgi?id=273843 "patch") [[details]](/attachment.cgi?id=273843&action=edit "patch") [[diff]](/attachment.cgi?id=273843&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389580&attachment=273843)
patch
r=bzbarsky. I assume that at this point there will never be unescaped nulls in that string, right?
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: review?(bzbarsky) → review+

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=389580#c4)• 18 years ago |
|  | |

correct, nsSimpleURI::SetSpec escapes them (NS\_EscapeURI does that even with OnlyNonASCII flag)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=389580#c5)• 18 years ago |
|  | |

I think escaped whitespace should just be passed through, personally... just like escaped spaces, escaped quotes, etc.

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=389580#c6)• 18 years ago |
|  | |

XP Pro SP2 - IE 7 and full updates/patches with Firefox 2.0.0.5 installed is vulnerable
XP Pro SP2 - IE 6 and Firefox 2.0.0.5 - not vulnerable
Tested with a clean new VM.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=389580#c7)• 18 years ago |
|  | |

Comment on [attachment 273843](/attachment.cgi?id=273843 "patch") [[details]](/attachment.cgi?id=273843&action=edit "patch") [[diff]](/attachment.cgi?id=273843&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389580&attachment=273843)
patch
sr=dveditz
Seems a shame to hurt any handler legitimately using %00 just because IE7 damaged a subset of common protocols.
On the other hand %00 has caused trouble in the past, maybe on the trunk we should kill it in a more common layer.
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: superreview?(dveditz) → superreview+

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=389580#c8)• 18 years ago |
|  | |

hrm... I don't really want to kill it in more places than necessary, because it can be used for legitimate reasons too

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389580#a10011_15661)• 18 years ago |

[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: approval1.8.1.6?
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: approval1.8.0.13?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=389580#c9)• 18 years ago |
|  | |

Comment on [attachment 273843](/attachment.cgi?id=273843 "patch") [[details]](/attachment.cgi?id=273843&action=edit "patch") [[diff]](/attachment.cgi?id=273843&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=389580&attachment=273843)
patch
approved for 1.8.0.13, 1.8.1.6 and 1.8.1.7.
Remember that 1.8.1.6 is off GECKO181\_20070712\_RELBRANCH and needs a separate checkin from the 1.8.1.7 on the main 1.8 branch
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: approval1.8.1.7+
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: approval1.8.1.6?
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: approval1.8.1.6+
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: approval1.8.0.13?
[Attachment #273843](/attachment.cgi?id=273843&action=edit "patch") -
Flags: approval1.8.0.13+

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=389580#c10)• 18 years ago |
|  | |

HEAD:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.323; previous revision: 1.322
done
GECKO181\_20070712\_RELBRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.12.6.3; previous revision: 1.290.4.12.6.2
done
MOZILLA\_1\_8\_BRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.15; previous revision: 1.290.4.14
done
MOZILLA\_1\_8\_0\_BRANCH:
Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.290.4.2.4.4; previous revision: 1.290.4.2.4.3
done
Status: NEW → RESOLVEDClosed: 18 years agoResolution: --- → FIXED

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=389580#c11)• 18 years ago |
|  | |

I backed this out of trunk for the moment, the tree was redStatus: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389580#a16076_1689)• 18 years ago |

Keywords: [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---),
[fixed1.8.1.6](/buglist.cgi?keywords=fixed1.8.1.6&resolution=---),
[fixed1.8.1.7](/buglist.cgi?keywords=fixed1.8.1.7&resolution=---)

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=389580#c12)• 18 years ago |
|  | |

Please help us with tests cases to verify this bug. Not being able to reproduce the problem explained in the blog may serve as verification, but if there's anything else we could test that you can think of, please make suggestions.

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=389580#c13)• 18 years ago |
|  | |

Checking in nsExternalHelperAppService.cpp;
/cvsroot/mozilla/uriloader/exthandler/nsExternalHelperAppService.cpp,v <-- nsExternalHelperAppService.cpp
new revision: 1.326; previous revision: 1.325
done
Status: REOPENED → RESOLVEDClosed: 18 years ago → 18 years agoResolution: --- → FIXED

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=389580#c14)• 18 years ago |
|  | |

As for testcases, make sure that URLs containing null bytes don't work, e.g.:
<a href="mailto:foo@bar.com?subject=foo%00bar">Link</a>
<a href="mailto:foo@bar.com?subject=foo&#x00;bar">Link</a>
Perhaps also a JavaScript-created link with \x00 in the href.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=389580#c15)• 18 years ago |
|  | |

Attached file
[TESTCASE: Based on code in comment #14](attachment.cgi?id=273999) (obsolete)
— [Details](attachment.cgi?id=273999&action=edit)

I have tested the 2 mailto links to not launch the mail client.
The j/s link does however. Not sure if I coded this right as I am not adept at j/s.

|  | [u279076](/user_profile?user_id=279076) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=389580#c16)• 18 years ago |
|  | |

Attached file
[TESTCASE: Revised above](attachment.cgi?id=274002)
— [Details](attachment.cgi?id=274002&action=edit)

[Attachment #273999](/attachment.cgi?id=273999&action=edit "TESTCASE: Based on code in comment #14") -
Attachment is obsolete: true

|  | [Juergen Schmidt](/user_profile?user_id=151448) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=389580#c17)• 18 years ago |
|  | |

Secunia has done some more research on this issue. They claim, that not "%00" but "%" itself triggers the problem. In fact the modified link
<a href="mailto:%../../../../../../windows/system32/cmd".exe ../../../../../../../../windows/system32/calc.exe " - " blah.bat>Mailto:%</a>
starts calc.exe on my Windows XP system. So please check, that your patch includes this.
bye, ju

|  | [Juergen Schmidt](/user_profile?user_id=151448) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=389580#c18)• 18 years ago |
|  | |

Attached file
[Testcase for Secunia mailto:%](attachment.cgi?id=274154) (obsolete)
— [Details](attachment.cgi?id=274154&action=edit)

Secunia detected, that "mailto:%" is enough to trigger the bug.

|  | [Mike Schroepfer](/user_profile?user_id=210162) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=389580#c19)• 17 years ago |
|  | |

It appears that IE7 changes \*both\* the behavior of windows and its own encoding of the URLs. We could use some help trying to understand the behavior of Windows and IE with the different scenarios here. In particular in [bug 389106](/show_bug.cgi?id=389106 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers") there is a nice list of protocol handlers for windows and an exe that you can register to get the URL output. The tests to run:
For each protocol register in that list register the .exe as the handler and try URLs's with % and %00 in each of the following scenarios:
System: XPsp2IE6:
Run from Start Menu -> resulting URL passed to handler
Run from IE6 -> resulting URL passed to handler
Run for FF2006 -> resulting URL passed to handler
System XPsp2IE7
Run from Start Menu -> resulting URL passed to handler
Run from IE7 -> resulting URL passed to handler
Run for FF2006 -> resulting URL passed to handler

|  | [Juergen Schmidt](/user_profile?user_id=151448) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=389580#c20)• 17 years ago |
|  | |

Attached file
[% triggers the bug](attachment.cgi?id=274230) (obsolete)
— [Details](attachment.cgi?id=274230&action=edit)

added Secunias original demo without detour over cmd.exe.
[Attachment #274154](/attachment.cgi?id=274154&action=edit "Testcase for Secunia mailto:%") -
Attachment is obsolete: true

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=389580#c21)• 17 years ago |
|  | |

Attached file
[installer that sets up all of the protocol handlers](attachment.cgi?id=274232)
— [Details](attachment.cgi?id=274232&action=edit)

This will add the windows protocol handlers under HKEY\_CURRENT\_USER pointing to the testurl.exe which is also contained within this installer. After you have finished it will attempt to restore any protocol handlers it replaced and it will just delete protocol handler it has added. I say attempt because I found that it wasn't reliable but I found that displaying a messagebox in the macro appears to have fixed this. If it doesn't work the original regkey has been saved to the installation directory's backup directory and can manually delete the key under HKEY\_CURRENT\_USER\Software\Classes\ and add it back by double clicking the protocol's file (e.g. protocolname.reg).
The default install location is in your documents folder and to uninstall you will have to run uninstall.exe from within this folder (the default name is protocoltest).

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=389580#c22)• 17 years ago |
|  | |

Also, if testurl.exe doesn't launch you may have the associated app for a protocol running. By using the HKEY\_CURRENT\_USER registry keys - which is safer in regards to restoring the settings - I am unable to overwrite the ddeexec keys so the app uses them they will pick up the url if it is already running. All you should have to do to remedy this is exit that app. I also didn't add keys for the shell protocol so don't bother testing it. So far my tests show that the keys are restored successfully with the additional messagebox.

|  | [Juergen Schmidt](/user_profile?user_id=151448) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=389580#c23)• 17 years ago |
|  | |

Attached file
[a couple of testcases using % and not containing any %00](attachment.cgi?id=274236)
— [Details](attachment.cgi?id=274236&action=edit)

sorry - had the encoding wrong in the last testcase.
[Attachment #274230](/attachment.cgi?id=274230&action=edit "% triggers the bug") -
Attachment is obsolete: true

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=389580#c24)• 17 years ago |
|  | |

One last note... hopefully... if the app does support dde the OS will display an error even though testurl.exe launched successfully. The error can be ignored and the test output is just as valid.

|  | [Robert Strong (they/them - no direct email)](/user_profile?user_id=141755) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=389580#c25)• 17 years ago |
|  | |

Attached file
[NSIS script](attachment.cgi?id=274237)
— [Details](attachment.cgi?id=274237&action=edit)

Besides NSIS this requires the testurl.exe to be in the same dir as the script when compiling and the registry plugin from <http://nsis.sourceforge.net/Registry_plug-in>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=389580#c26)• 17 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=389580#c17 "RESOLVED FIXED - some schemes with %00 launch unexpected handlers on windows"))
> They claim, that not "%00" but "%" itself triggers the problem.
It's not mere presence of '%', a valid percent-encoded value (other than %00) does NOT trigger the problem (e.g. %20, %FF). % followed by two characters that are not valid hex digits, or %00 trigger the problem.
> So please check, that your patch includes this.
Our patch does not. But IE7 will pass an unencoded '%' to most protocols (except the "web" ones) so we can't strip it willy-nilly and still be compatible. We're in kind of a bind here. Systems with IE6 installed are different, too, as is Vista.
Leaving apart the system-specific aspects we could do something like
webprotocols = /^https?:|^ftp:|^mailto:|^s?news:|^nntp:|^telnet:|^gopher:/;
badencoding = /(^[^?#]\*)%(.?[^0-9a-fA-F]|00|$)/;
if (webprotocols.test(uri) && uri.match(badencoding)) {
throw "bad encoding in schemes treated special by Windows";
}
Except we'd have to do that in C++ in the windows-specific LoadURIInternal()

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=389580#c27)• 17 years ago |
|  | |

... and first verify that the list of "web" protocols is complete and that our conclusion that only %00 and %-invalid trigger the problem is correct.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=389580#c28)• 17 years ago |
|  | |

Attached file
[testpage for the protocol list](attachment.cgi?id=274255)
— [Details](attachment.cgi?id=274255&action=edit)

Here's a testpage built from the protocol list in [attachment 273656](/attachment.cgi?id=273656 "updated handlers in html format") [[details]](/attachment.cgi?id=273656&action=edit "updated handlers in html format") ([bug 389106](/show_bug.cgi?id=389106 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers"))

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=389580#c29)• 17 years ago |
|  | |

Using an unreadable/unmaintainable regexp is asking for trouble. Maybe we should just give up and bypass ShellExecute() entirely, pulling the command-line out of the registry and call it ourselves.
But then we have to reverse-engineer what replacement parameters ShellExecute() will handle. In the list Rob put together in [bug 389106](/show_bug.cgi?id=389106 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers") I can see "%L" and "%l" (upper- and lower-case L) mixed in with the usual "%1" (digit 1), as well as a couple with %1 %2 (?). Is it just the first %x?
The docs for registering a protocol handler on windows say to use "%1"

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=389580#c30)• 17 years ago |
|  | |

Based on the email discussions going on, it looks pretty obvious we need to rework this handling completely. I'll try and get things kicked off here -
In general, with IE6 installed we appears immune to the mailto example, however this isn't really important. As someone pointed out via email, we don't handle these web protocol handlers correctly. We generally trust SE to keep us safe, and that doesn't appear to have been the right approach.
The current proposal is to do something along these lines with some comments added -
1. Detect that an external protocol handler is invoked (mailto:blah)
2. Parse out the protocol definition, i.e. everything to the left of the first colon (mailto)
3. Look up the protocol definition in the registry under HKCR
4. If there is no value under the protocol definition called “URL Protocol” this is not a valid protocol. Error out.
5. If it is a valid protocol open HKCR\<protocol>\shell\open\command and read the default value
This is where things get a little sticky, there are multiple formats here we would need to deal with, and we may want to expand environment strings at this point as well.
- read the full command template from shell/open/command
- detect "known" executable types we want to support (an application, a rundll32.exe handler, others)
There are other ways in which these handlers can be configured besides an app or rundll, a good example might be rlogin on vista -
url.dll,TelnetProtocolHandler %l
(To mitigate this quickly we might adopt a short list of supported handler templates, and expand on that as bugs related to the more exotic handlers show up.)
- separate the handler from the parameter template
- replace the appropriate parameter token with our url (%1, %l %L - we need to track down the docs on what the differences are here, honestly ive not run into '%L' until today.)
Also should we be applying any security related sanity checks on the URL were about to hand off?
6. Use shellexecute to launch the handler, with the appropriate parameter string.
Just a start, more research is needed to make sure we do not open up a new hole by handling these inappropriately.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=389580#c31)• 17 years ago |
|  | |

Also, some test results - last night I spent mostly with IE6, and was unable to get calc to launch. After an upgrade to IE7, I've confirmed the calc / mailto thing works. The parameter looks like this:
There are 1 arguments in the URL
Argument 0: mailto:test%../../../../testurl.exe.cmd

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=389580#c32)• 17 years ago |
|  | |

Some additional notes -
- %l or %L vs. %1 implies the use of a long file name
- a dll handler without rundll in the template implies the use of rundll32.exe.

|  | [Harry Johnston](/user_profile?user_id=149841) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=389580#c33)• 17 years ago |
|  | |

I haven't found any way to exploit this without having an unencoded double quote in the URL; so perhaps the changes in [bug 389106](/show_bug.cgi?id=389106 "RESOLVED FIXED - Escape URIs (especially quotes) when passing them to external protocol handlers") would also protect us from this?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=389580#c34)• 17 years ago |
|  | |

Although I haven't run across any that actually use these yet, %d and %0 also replaced with the URL for registered handlers. Other %-digits are replaced with nothing, most other %-letter are replaced with the letter except:
%h is replaced with 0
%i is :#:PID where PID is the process ID of the calling program
(IE or Firefox) and the number (#) changes every call
but I'm not sure what it is. Handle? Clock slice?
%s is replaced with 1
Multiple replacements happen, too, so at least we don't have to look for one or the other. "%1" "%L" "d" results in 3 copies of the URL passed to the handler.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=389580#c35)• 17 years ago |
|  | |

And then we'd have to duplicate the DDE calling path, too.
#4 in [comment 30](/show_bug.cgi?id=389580#c30 "RESOLVED FIXED - some schemes with %00 launch unexpected handlers on windows") is bug regardless of whether we use ShellExecute as we are now or do the more indepth duplication of Windows behavior. [bug 389611](/show_bug.cgi?id=389611 "RESOLVED FIXED - Don't treat filetypes as protocol handlers on windows"), fixed on trunk, ready to land on branch if we want to re-spin for it.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=389580#c36)• 17 years ago |
|  | |

We received a response from Microsoft that in addition to the schemes listed in [comment 0](/show_bug.cgi?id=389580#c0 "RESOLVED FIXED - some schemes with %00 launch unexpected handlers on windows") they also treat "wais", "file", and "mk" in this manner when IE7 is installed. The normalization is done by the CreateUri function in accord with RFC 3986 as described at <http://msdn2.microsoft.com/en-us/library/ms775098.aspx>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=389580#c37)• 17 years ago |
|  | |

Attached patch

[createuri experimental patch](attachment.cgi?id=274522&action=diff)
— [Details](attachment.cgi?id=274522&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=389580&attachment=274522)

This is purely an experimental patch that avoids major changes by vetting URI through the newer CreateUri available post IE7.

|  | [Stephen Donner [:stephend] Not actively reading bugmail](/user_profile?user_id=79002) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=389580#c38)• 17 years ago |
|  | |

I ran Rob's NSIS installer script to register some protocols listed on
<https://bugzilla.mozilla.org/attachment.cgi?id=274255>, as well as the
testurl.exe command-line shell, to verify that the first URI in the bugzilla
attachment triggers the testurl.exe to run, but not the 2nd and 3rd ones, which
usually have "%00" or "%[invalid char]". Verifying this as fixed, then, using
a Thunderbird version 1.5.0.13 (20070809) (release candidate) build.
Replacing fixed1.8.0.13 with verified1.8.0.13.Keywords: [fixed1.8.0.13](/buglist.cgi?keywords=fixed1.8.0.13&resolution=---) → [verified1.8.0.13](/buglist.cgi?keywords=verified1.8.0.13&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)  Reporter |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=389580#c39)• 17 years ago |
|  | |

Created [bug 394974](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7") to track the remaining work (namely, addressing [comment 17](/show_bug.cgi?id=389580#c17 "RESOLVED FIXED - some schemes with %00 launch unexpected handlers on windows") on including the work done in [comment 37](/show_bug.cgi?id=389580#c37 "RESOLVED FIXED - some schemes with %00 launch unexpected handlers on windows"))

|  | [Josh Bressers](/user_profile?user_id=190763) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389580#a7161529_190763)• 17 years ago |

Alias: CVE-2007-4041

|  | [Stephen Donner [:stephend] Not actively reading bugmail](/user_profile?user_id=79002) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=389580#c40)• 17 years ago |
|  | |

I've actually done the verification legwork for both this and [bug 394974](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7") over in that bug (I did more than I mentioned there, actually; I ran the first of the set of three as well, but only reported on the others).
See [https://bugzilla.mozilla.org/show\_bug.cgi?id=394974#c27](/show_bug.cgi?id=394974#c27 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7") for more details.
Additionally, I ran Juergen Schmidt's testcases in this bug using Windows XP SP2 with IE 6 installed, Windows XP SP2 with IE 7, and Vista.
Replacing fixed1.8.1.8 keyword with verified1.8.1.8 keyword, since I used Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.8) Gecko/20071008 Firefox/2.0.0.8 on the three OS flavors to test.Keywords: [fixed1.8.1.8](/buglist.cgi?keywords=fixed1.8.1.8&resolution=---) → [verified1.8.1.8](/buglist.cgi?keywords=verified1.8.1.8&resolution=---)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=389580#a281229678_1)• 9 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=389580&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_3659d679_20250126_080511.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_73f8d6fa_20250126_080512.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)


