```
{
  "cve": "CVE-2007-3257",
  "contents": [
    {
      "type": "ubuntu advisory",
      "content": "### USN-475-1: evolution-data-server vulnerability\n\n21 June 2007\n\nevolution-data-server vulnerability\n\n## Details\n\nPhilip Van Hoof discovered that the IMAP client in Evolution did not\n\ncorrectly verify the SEQUENCE value. A malicious or spoofed server\n\ncould exploit this to execute arbitrary code with user privileges.\n\n\n## References\n\n* [CVE-2007-3257](/security/CVE-2007-3257)"
    },
    {
      "type": "debian advisory",
      "content": "Package        : evolution\nVulnerability  : several\nProblem-Type   : remote\nDebian-specific: no\nCVE ID         : CVE-2007-1002 CVE-2007-3257\n\nCVE-2007-3257\n\n    It was discovered that the IMAP code in the Evolution Data Server\n    performs insufficient sanitising of a value later used an array index,\n    which can lead to the execution of arbitrary code."
    },
    {
      "type": "debian advisory",
      "content": "Package        : evolution-data-server\nVulnerability  : programming error\nProblem-Type   : remote\nDebian-specific: no\nCVE ID         : CVE-2007-3257\n\nIt was discovered that the IMAP code in the Evolution Data Server\nperforms insufficient sanitising of a value later used an array index,\nwhich can lead to the execution of arbitrary code."
    },
    {
      "type": "gentoo advisory",
      "content": "### Description\n\nThe imap_rescan() function of the file camel-imap-folder.c does not\nproperly sanitize the \"SEQUENCE\" response sent by an IMAP server before\nbeing used to index arrays.\n\n### Impact\n\nA malicious or compromised IMAP server could trigger the vulnerability\nand execute arbitrary code with the permissions of the user running\nEvolution.\n\n### References\n\n* [CVE-2007-3257](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-3257)"
    },
        {
      "type": "gentoo advisory",
      "content": "### Description\n\nThe imap_rescan() function of the file camel-imap-folder.c does not\nproperly sanitize the \"SEQUENCE\" response sent by an IMAP server before\nbeing used to index arrays.\n\n### Impact\n\nA malicious or compromised IMAP server could trigger the vulnerability\nand execute arbitrary code with the permissions of the user running\nEvolution.\n\n### References\n\n* [CVE-2007-3257](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-3257)"
    },
    {
      "type": "gnome bugzilla",
        "content": "The \"SEQUENCE\" value in the GData of the IMAP code (camel-imap-folder.c) is converted from a string using strtol. This allows for negative values.\n\nThe imap_rescan uses this value as an int. It checks for !seq and seq>summary.length. It doesn't check for seq < 0. Although seq is used as the index of an array.\n\nThis means that a negative index number can be fed to the array lookup by altering the output of an IMAP server.\n\nThis is a blocker (very very serious) security bug as this is remotely exploitable (I can put shell code in the UID field of the IMAP code, and make it execute on the victim's computer, as at the seq'd field of the index a g_strdup of the UID is written to memory. By carefully calculating the negative value and overwriting the instruction pointer near the array's start, I can let it point to that memory and get it to execute).\n\nIt can be fixed by either checking for seq < 0 or by using strtoul in stead of strtol."
      }
  ],
  "summary": "The vulnerability is due to improper sanitization of the 'SEQUENCE' value in the IMAP client of Evolution. A malicious IMAP server can send a negative sequence value which is later used as an array index without proper bounds checking, leading to arbitrary code execution with the user's privileges.",
  "details": {
    "root_cause": "The root cause is the lack of proper input sanitization of the SEQUENCE value from an IMAP server response. The `imap_rescan()` function uses `strtol` to convert the sequence value, which allows for negative integers. This value is later used as an index in an array without proper bounds checking.",
    "vulnerabilities": [
      "Improper input sanitization",
      "Array index out of bounds",
      "Remote code execution"
    ],
    "impact": "A malicious or compromised IMAP server can execute arbitrary code on the client machine with the privileges of the user running the Evolution email client.",
    "attack_vectors": [
      "Spoofed or compromised IMAP server"
    ],
    "attacker_capabilities": "The attacker needs to control or compromise an IMAP server that the victim connects to. They can then manipulate the server's response to include malicious sequence values.",
    "patches": [
      "Use `strtoul` instead of `strtol` to convert the sequence value to an unsigned integer, preventing negative indexes.",
      "Add an explicit check for `seq < 0` to prevent negative index access."
    ]
  }
}
```