=== Content from git.kernel.org_567894c1_20250125_163232.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=0b29669c065f60501e7289e1950fa2a618962358)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=0b29669c065f60501e7289e1950fa2a618962358)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0b29669c065f60501e7289e1950fa2a618962358)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=0b29669c065f60501e7289e1950fa2a618962358)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Brandon Philips <bphilips@suse.de> | 2007-12-08 23:05:53 -0300 |
| --- | --- | --- |
| committer | Mauro Carvalho Chehab <mchehab@infradead.org> | 2007-12-11 18:08:22 -0200 |
| commit | [0b29669c065f60501e7289e1950fa2a618962358](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0b29669c065f60501e7289e1950fa2a618962358) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=0b29669c065f60501e7289e1950fa2a618962358)) | |
| tree | [d6352cce3e42354e2f142fc6ac21cfce9c8a5934](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=0b29669c065f60501e7289e1950fa2a618962358) | |
| parent | [843b1378c2ab47ab1ed9cb471938e0f0ec839fcd](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=843b1378c2ab47ab1ed9cb471938e0f0ec839fcd) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=0b29669c065f60501e7289e1950fa2a618962358&id2=843b1378c2ab47ab1ed9cb471938e0f0ec839fcd)) | |
| download | [linux-0b29669c065f60501e7289e1950fa2a618962358.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-0b29669c065f60501e7289e1950fa2a618962358.tar.gz) | |

V4L/DVB (6751): V4L: Memory leak! Fix count in videobuf-vmalloc mmapThis is pretty serious bug. map->count is never initialized after the
call to kmalloc making the count start at some random trash value. The
end result is leaking videobufs.
Also, fix up the debug statements to print unsigned values.
Pushed to http://ifup.org/hg/v4l-dvb too
Signed-off-by: Brandon Philips <bphilips@suse.de>
Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=0b29669c065f60501e7289e1950fa2a618962358)

| -rw-r--r-- | [drivers/media/video/videobuf-vmalloc.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/media/video/videobuf-vmalloc.c?id=0b29669c065f60501e7289e1950fa2a618962358) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/drivers/media/video/videobuf-vmalloc.c b/drivers/media/video/videobuf-vmalloc.cindex cd74341c984fd0..e01259438bb275 100644--- a/[drivers/media/video/videobuf-vmalloc.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/media/video/videobuf-vmalloc.c?id=843b1378c2ab47ab1ed9cb471938e0f0ec839fcd)+++ b/[drivers/media/video/videobuf-vmalloc.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/media/video/videobuf-vmalloc.c?id=0b29669c065f60501e7289e1950fa2a618962358)@@ -51,7 +51,7 @@ videobuf\_vm\_open(struct vm\_area\_struct \*vma) { struct videobuf\_mapping \*map = vma->vm\_private\_data; - dprintk(2,"vm\_open %p [count=%d,vma=%08lx-%08lx]\n",map,+ dprintk(2,"vm\_open %p [count=%u,vma=%08lx-%08lx]\n",map, map->count,vma->vm\_start,vma->vm\_end);  map->count++;@@ -64,7 +64,7 @@ videobuf\_vm\_close(struct vm\_area\_struct \*vma) struct videobuf\_queue \*q = map->q; int i; - dprintk(2,"vm\_close %p [count=%d,vma=%08lx-%08lx]\n",map,+ dprintk(2,"vm\_close %p [count=%u,vma=%08lx-%08lx]\n",map, map->count,vma->vm\_start,vma->vm\_end);  map->count--;@@ -221,7 +221,7 @@ static int \_\_videobuf\_mmap\_mapper(struct videobuf\_queue \*q, }  /\* create mapping + update buffer list \*/- map = q->bufs[first]->map = kmalloc(sizeof(struct videobuf\_mapping),GFP\_KERNEL);+ map = q->bufs[first]->map = kzalloc(sizeof(struct videobuf\_mapping),GFP\_KERNEL); if (NULL == map) return -ENOMEM; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 16:31:09 +0000



=== Content from bugs.debian.org_519dfceb_20250125_163231.html ===

# Debian Bug report logs - #827340 linux: CVE-2010-5321 memory leak in videobuf on multiple calls to mmap()

[![version graph](version.cgi?height=2;found=linux%2F4.6.2-1;found=linux%2F3.2.41-2;found=linux%2F3.2.78-1;width=2;collapse=1;absolute=0;package=src%3Alinux)](version.cgi?found=linux%2F4.6.2-1;found=linux%2F3.2.41-2;found=linux%2F3.2.78-1;info=1;collapse=1;package=src%3Alinux;absolute=0)

Package:
[src:linux](pkgreport.cgi?src=linux);
Maintainer for [src:linux](pkgreport.cgi?src=linux) is [Debian Kernel Team <debian-kernel@lists.debian.org>](pkgreport.cgi?maint=debian-kernel%40lists.debian.org);

Reported by: [Petter Reinholdtsen <pere@hungry.com>](pkgreport.cgi?submitter=pere%40hungry.com)

Date: Wed, 15 Jun 2016 06:51:01 UTC

Severity: minor

Tags: security, upstream

Found in versions linux/4.6.2-1, linux/3.2.41-2, linux/3.2.78-1

Forwarded to <https://bugzilla.kernel.org/show_bug.cgi?id=120571>

Reply or subscribe to this bug.

Display info messages

View this report as an [mbox folder](bugreport.cgi?bug=827340;mbox=yes), [status mbox](bugreport.cgi?bug=827340;mbox=yes;mboxstatus=yes), [maintainer mbox](bugreport.cgi?bug=827340;mbox=yes;mboxmaint=yes)

---

**Report forwarded**
to `debian-bugs-dist@lists.debian.org, Debian Kernel Team <debian-kernel@lists.debian.org>`:

`Bug#827340`; Package `src:linux`.
(Wed, 15 Jun 2016 06:51:05 GMT) ([full text](bugreport.cgi?bug=827340;msg=2), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=2), [link](#1)).

---

**Acknowledgement sent**
to `Petter Reinholdtsen <pere@hungry.com>`:

New Bug report received and forwarded. Copy sent to `Debian Kernel Team <debian-kernel@lists.debian.org>`.
(Wed, 15 Jun 2016 06:51:05 GMT) ([full text](bugreport.cgi?bug=827340;msg=4), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=4), [link](#3)).

---

[Message #5](#5) received at submit@bugs.debian.org ([full text](bugreport.cgi?bug=827340;msg=5), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=5), reply):

![](/cgi-bin/libravatar.cgi?email=pere%40hungry.com)
From: Petter Reinholdtsen <pere@hungry.com>
To: submit@bugs.debian.org
Subject: linux: CVE-2010-5321 memory leak in videobuf on multiple calls to mmap()
Date: Wed, 15 Jun 2016 08:46:05 +0200
```

Package: src:linux
Version: 3.2.78-1
Severity: minor
Tags: security

In 2010 an issue with the linux kernel implementation of v4l was
discovered and reported to RedHat as
<URL: <https://bugzilla.redhat.com/show_bug.cgi?id=620629> >.  It was
assigned a CVE last year in
<URL: <http://www.openwall.com/lists/oss-security/2015/02/08/4> > and is
still unsolved as far as I can tell.

If I understand the issue correctly, a user with access to /dev/video
can cause the kernel to leak memory and eventually run out of memory by
doing repeated calls to mmap().  In other words, users with video group
membership can bring down the machine.

According to
<URL: <https://security-tracker.debian.org/tracker/CVE-2010-5321> > the
issue is present in Wheezy and onwards.  It is probably present in
earlier versions too.  I picked the kernel version number used in wheezy
for this report.

I noticed this issue, as it is the oldest non-fixed CVE number reported
by debsecan on my laptop, and decided it was time to track its progress
in a bug report.

--
Happy hacking
Petter Reinholdtsen

```

---

**Added tag(s) upstream.**
Request was from `Ben Hutchings <ben@decadent.org.uk>`
to `control@bugs.debian.org`.
(Wed, 15 Jun 2016 11:21:13 GMT) ([full text](bugreport.cgi?bug=827340;msg=7), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=7), [link](#6)).

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian Kernel Team <debian-kernel@lists.debian.org>`:

`Bug#827340`; Package `src:linux`.
(Fri, 17 Jun 2016 22:27:03 GMT) ([full text](bugreport.cgi?bug=827340;msg=9), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=9), [link](#8)).

---

**Acknowledgement sent**
to `Petter Reinholdtsen <pere@hungry.com>`:

Extra info received and forwarded to list. Copy sent to `Debian Kernel Team <debian-kernel@lists.debian.org>`.
(Fri, 17 Jun 2016 22:27:03 GMT) ([full text](bugreport.cgi?bug=827340;msg=11), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=11), [link](#10)).

---

[Message #12](#12) received at 827340@bugs.debian.org ([full text](bugreport.cgi?bug=827340;msg=12), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=12), reply):

![](/cgi-bin/libravatar.cgi?email=pere%40hungry.com)
From: Petter Reinholdtsen <pere@hungry.com>
To: 827340@bugs.debian.org
Subject: Re: linux: CVE-2010-5321 memory leak in videobuf on multiple calls
to mmap()
Date: Sat, 18 Jun 2016 00:25:44 +0200
```
Control: found -1 4.6.2-1

[Petter Reinholdtsen]
> If I understand the issue correctly, a user with access to /dev/video
> can cause the kernel to leak memory and eventually run out of memory by
> doing repeated calls to mmap().  In other words, users with video group
> membership can bring down the machine.

I've tried to track down a way to reproduce the problem without any
luck so far.  I asked on #v4l to see if anyone there could help and got
some more information:

<pere> hi.  I'm trying to figure out if [CVE-2010-5321](https://security-tracker.debian.org/tracker/CVE-2010-5321) reported via
   <URL: <https://bugzilla.redhat.com/show_bug.cgi?id=620629> > still
   exist in the linux kernel, and it links to
   <URL: <https://linuxtv.org/irc/v4l/index.php?date=2010-07-29> > for
   more information.  But that IRC log page is empty.  Anyone here know
   how to reproduce the problem or find the log from that day?
<pinchartl> pere: that's old
<pinchartl> the bug seems to affect videobuf only, not videobuf2
<pere> yeah.  at it seem to be unsolved, but I have not been able to verify it.
<pinchartl> not all drivers have been converted to videobuf2
<pinchartl> but if the drivers you are interested in have been, then you
   should be safe from that point of view
<pere> my focus is tracking CVEs in Debian, to know if the issue still
   exist or not.
<pere> <URL: <https://security-tracker.debian.org/tracker/CVE-2010-5321> >
   show the kernel still vulnerable...
<pinchartl> I don't know I'm afraid
<pinchartl> (one more reason to get rid of videobuf)
<pere> how can I tell if a driver/device uses videobuf and not videobuf2?
   I assume some specific hardware is needed to reproduce the problem.
<pinchartl> search for #include <media/videobuf-.*.h> in the sources
<pinchartl> there's 9 of them left if I count properly
<pinchartl> via-camera, fsl-viu, bttv, cx18, tm6000, zr364xx, cx231xx,
   pxa_camera and omap_vout
<pinchartl> ah, and omap1_camera and timblogiw in staging
<pinchartl> so that's 11
<pere> hm, wonder if I have a PCI card supported by bttv...
<pinchartl> patches would be great :-)
<pere> I am sure it would, but lack the capacity too look into that. :)
<pere> pinchartl: is the description in that bug report enough for you to
   know how to reproduce it?  I've tried writing a test program, but only
   got a v4l2 device and got EBUSY when calling mmap() several times there.
<pere> but I suspect my test program is flawed, as I did not really quite
   understand the description.
<pere> the redhat bug report was very short, and I suspect the details are
   in one of the referred bug reports, which are not available to the public. :(

According to this report the issue still exist in the kernel for a small
number of camera drivers, so I mark it as found in the unstable kernel too.

I notice this bug is tagged upstream.  Is there a bug report upstream too?
I've been unable to find any.

--
Happy hacking
Petter Reinholdtsen

```

---

**Marked as found in versions linux/4.6.2-1.**
Request was from `Petter Reinholdtsen <pere@hungry.com>`
to `827340-submit@bugs.debian.org`.
(Fri, 17 Jun 2016 22:27:03 GMT) ([full text](bugreport.cgi?bug=827340;msg=14), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=14), [link](#13)).

---

**Information forwarded**
to `debian-bugs-dist@lists.debian.org, Debian Kernel Team <debian-kernel@lists.debian.org>`:

`Bug#827340`; Package `src:linux`.
(Fri, 17 Jun 2016 23:12:08 GMT) ([full text](bugreport.cgi?bug=827340;msg=16), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=16), [link](#15)).

---

**Acknowledgement sent**
to `Petter Reinholdtsen <pere@hungry.com>`:

Extra info received and forwarded to list. Copy sent to `Debian Kernel Team <debian-kernel@lists.debian.org>`.
(Fri, 17 Jun 2016 23:12:08 GMT) ([full text](bugreport.cgi?bug=827340;msg=18), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=18), [link](#17)).

---

[Message #19](#19) received at 827340@bugs.debian.org ([full text](bugreport.cgi?bug=827340;msg=19), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=19), reply):

![](/cgi-bin/libravatar.cgi?email=pere%40hungry.com)
From: Petter Reinholdtsen <pere@hungry.com>
To: 827340@bugs.debian.org
Subject: Re: linux: CVE-2010-5321 memory leak in videobuf on multiple calls to mmap()
Date: Sat, 18 Jun 2016 01:10:28 +0200
```
Control: forwarded -1 <https://bugzilla.kernel.org/show_bug.cgi?id=120571>

I got some more information on the #v4l IRC channel and decided to
report the issue upstream while I was at it.

<pinchartl> which driver are you using ?
<pere> I guess uvcvideo based on the lsmod output.
<pinchartl> uvcvideo uses videobuf2
<pinchartl> I quickly looked at the videobuf code and the bug seems to
   still be present
<pere> easy to fix?
<pinchartl> that I can't tell without a deeper analysis of the code
<pinchartl> it would need to be fixed in four places, as there are four
   memory allocator backends for videobuf
<pinchartl> moving drivers to videobuf2 would be much better
<pinchartl> especially the bttv driver
<pinchartl> and if Debian decides to disable the above 11 drivers by
   default until they get fixed, I won't complain
<pinchartl> although users might
<pere> what is the upstream location for v4l bugs?  I guess it should be
   reported somewhere else than in redhat and debian?
<pere> perhaps it already is reported and I can't find it.
<pinchartl> there's a bugzilla instance on kernel.org
<pinchartl> <https://bugzilla.kernel.org/>
<pinchartl> bugs are usually reported on the linux-media mailing list
<pere> hm,
  <URL:
  <http://www.gossamer-threads.com/lists/linux/kernel/852719?page=last> >
  seem related
<pere> reported upstream as
   <URL: <https://bugzilla.kernel.org/show_bug.cgi?id=120571> >
--
Happy hacking
Petter Reinholdtsen

```

---

**Set Bug forwarded-to-address to '<https://bugzilla.kernel.org/show_bug.cgi?id=120571>'.**
Request was from `Petter Reinholdtsen <pere@hungry.com>`
to `827340-submit@bugs.debian.org`.
(Fri, 17 Jun 2016 23:12:08 GMT) ([full text](bugreport.cgi?bug=827340;msg=21), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=21), [link](#20)).

---

**Marked as found in versions linux/3.2.41-2.**
Request was from `Salvatore Bonaccorso <carnil@debian.org>`
to `control@bugs.debian.org`.
(Sat, 18 Jun 2016 04:30:04 GMT) ([full text](bugreport.cgi?bug=827340;msg=23), [mbox](bugreport.cgi?bug=827340;mbox=yes;msg=23), [link](#22)).

---

Send a report that [this bug log contains spam](https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=827340).

---

Debian bug tracking system administrator <owner@bugs.debian.org>.
Last modified:
Sat Jan 25 16:32:31 2025;
Machine Name:
bembo

[Debian Bug tracking system](https://www.debian.org/Bugs/)

Debbugs is free software and licensed under the terms of the GNU General
Public License version 2. The current version can be obtained
from <https://bugs.debian.org/debbugs-source/>.

Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.



=== Content from github.com_a893a32e_20250125_163233.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F0b29669c065f60501e7289e1950fa2a618962358)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F0b29669c065f60501e7289e1950fa2a618962358)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/0b29669c065f60501e7289e1950fa2a618962358)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

V4L/DVB (6751): V4L: Memory leak! Fix count in videobuf-vmalloc mmap

[Browse files](/torvalds/linux/tree/0b29669c065f60501e7289e1950fa2a618962358)
Browse the repository at this point in the history

```
This is pretty serious bug.  map->count is never initialized after the
call to kmalloc making the count start at some random trash value.  The
end result is leaking videobufs.

Also, fix up the debug statements to print unsigned values.

Pushed to <http://ifup.org/hg/v4l-dvb> too

Signed-off-by: Brandon Philips <bphilips@suse.de>
Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>
```

* Loading branch information

[![@mchehab](https://avatars.githubusercontent.com/u/6566927?s=40&v=4)](/mchehab)

Brandon Philips
authored and
[mchehab](/torvalds/linux/commits?author=mchehab "View all commits by mchehab")
committed
Dec 11, 2007

1 parent
[843b137](/torvalds/linux/commit/843b1378c2ab47ab1ed9cb471938e0f0ec839fcd)

commit 0b29669

Showing
**1 changed file**
with
**3 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[drivers/media/video/videobuf-vmalloc.c](#diff-461f6a83d0c6ef7e0fd2fbef57df2b93d7b77858f9da6af8692db269a8f80b70 "drivers/media/video/videobuf-vmalloc.c")

Show comments

[View file](/torvalds/linux/blob/0b29669c065f60501e7289e1950fa2a618962358/drivers/media/video/videobuf-vmalloc.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,7 +51,7 @@ videobuf\_vm\_open(struct vm\_area\_struct \*vma) |
|  |  | { |
|  |  | struct videobuf\_mapping \*map = vma->vm\_private\_data; |
|  |  |  |
|  |  | dprintk(2,"vm\_open %p [count=%d,vma=%08lx-%08lx]\n",map, |
|  |  | dprintk(2,"vm\_open %p [count=%u,vma=%08lx-%08lx]\n",map, |
|  |  | map->count,vma->vm\_start,vma->vm\_end); |
|  |  |  |
|  |  | map->count++; |
| Expand All | | @@ -64,7 +64,7 @@ videobuf\_vm\_close(struct vm\_area\_struct \*vma) |
|  |  | struct videobuf\_queue \*q = map->q; |
|  |  | int i; |
|  |  |  |
|  |  | dprintk(2,"vm\_close %p [count=%d,vma=%08lx-%08lx]\n",map, |
|  |  | dprintk(2,"vm\_close %p [count=%u,vma=%08lx-%08lx]\n",map, |
|  |  | map->count,vma->vm\_start,vma->vm\_end); |
|  |  |  |
|  |  | map->count--; |
| Expand Down  Expand Up | | @@ -221,7 +221,7 @@ static int \_\_videobuf\_mmap\_mapper(struct videobuf\_queue \*q, |
|  |  | } |
|  |  |  |
|  |  | /\* create mapping + update buffer list \*/ |
|  |  | map = q->bufs[first]->map = kmalloc(sizeof(struct videobuf\_mapping),GFP\_KERNEL); |
|  |  | map = q->bufs[first]->map = kzalloc(sizeof(struct videobuf\_mapping),GFP\_KERNEL); |
|  |  | if (NULL == map) |
|  |  | return -ENOMEM; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0b29669`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F0b29669c065f60501e7289e1950fa2a618962358) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


