=== Content from bugzilla.nasm.us_d23071fc_20250125_152557.html ===


Bugzilla – Bug 3392528
There is an illegal address access at asm/preproc.c:4677(function:is\_mmacro) in nasm2.14rc16 that will cause dos attack.
Last modified: 2018-11-13 23:29:15 PST

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](docs/en/html/using/understanding.html)
* |
  [Log In](show_bug.cgi?id=3392528&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=3392528&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

Self-registration is disabled due to spam issue (mail gorcunov@gmail.com or hpa@zytor.com to create an account)

[**Bug 3392528**](show_bug.cgi?id=3392528)
- There is an illegal address access at asm/preproc.c:4677(function:is\_mmacro) in nasm2.14rc16 that will cause dos attack.

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
There is an illegal address access at asm/preproc.c:4677(function:is\_mmacro) ...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | NASM | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=NASM "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Assembler ([show other bugs](buglist.cgi?component=Assembler&product=NASM&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.14.xx | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | Medium blocker | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | nobody | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2018-11-12 23:42 PST by ganshuitao | | --- | --- | | Modified: | 2018-11-13 23:29 PST ([History](show_activity.cgi?id=3392528)) | | CC List: | 3 users (show)  gorcunov hpa nasm-bugs | |  | | | [Obtained from:](page.cgi?id=fields.html#cf_build "Please indicate where you obtained and/or built your version of NASM.") | Binary from nasm.us | | [Generated by:](page.cgi?id=fields.html#cf_robot "Was this bug report generated by an automatic tool, such as a memory leak detector or fuzzer, *without* including a human validation description or analysis of the problem?") | --- | | [Bug category:](page.cgi?id=fields.html#cf_category "The general category of this bug oor request.") |  | | [Breaks existing code:](page.cgi?id=fields.html#cf_breaks "This bug report breaks existing code in production or under development.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**./nasm -f bin POC6 -o xxx**](attachment.cgi?id=411688 "View the content of the attachment") (1.08 KB, application/octet-stream)  [2018-11-12 23:42 PST](#attach_411688 "Go to the comment associated with the attachment"), ganshuitao | [Details](attachment.cgi?id=411688&action=edit) | | [Add an attachment](attachment.cgi?bugid=3392528&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=3392528&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=3392528#c0)  ganshuitao    2018-11-12 23:42:03 PST  ``` Created [attachment 411688](attachment.cgi?id=411688 "./nasm -f bin POC6 -o xxx") [[details]](attachment.cgi?id=411688&action=edit "./nasm -f bin POC6 -o xxx") ./nasm -f bin POC6 -o xxx  version:nasm2.14rc16 Summary:   There is an illegal address access at asm/preproc.c:4677(function:is_mmacro) in nasm2.14rc16 that will cause dos attack.   Description:  The ubsan debug is as follows:  $./nasm -f bin POC6 -o xxx  ASAN:SIGSEGV ================================================================= ==19284==ERROR: AddressSanitizer: SEGV on unknown address 0x60bc23a416b0 (pc 0x00000042f707 bp 0x000084746b8e sp  0x7ffd4c38b410 T0)     #0 0x42f706 in is_mmacro asm/preproc.c:4677     #1 0x445ce0 in expand_mmacro asm/preproc.c:4766     #2 0x445ce0 in pp_getline asm/preproc.c:5252     #3 0x40d791 in assemble_file asm/nasm.c:1442     #4 0x40640d in main asm/nasm.c:573     #5 0x7f10f746fa3f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x20a3f)     #6 0x4072f8 in _start (/home/company/real_sanitize/poc_check/nasm/nasm_new_addr+0x4072f8)  AddressSanitizer can not provide additional info. SUMMARY: AddressSanitizer: SEGV asm/preproc.c:4677 is_mmacro ==19284==ABORTING ```  [Comment 1](show_bug.cgi?id=3392528#c1)  Cyrill Gorcunov    2018-11-12 23:53:50 PST  ``` Will take a look, thanks! ```  [Comment 2](show_bug.cgi?id=3392528#c2)  Cyrill Gorcunov    2018-11-13 14:52:58 PST  ``` OK, I found a reason, and create a preliminary patch to fix it. Still I think it might be 2.15 material since it requires specially crafted data which usually doesn't appear in regular programs. ```  [Comment 3](show_bug.cgi?id=3392528#c3)  Cyrill Gorcunov    2018-11-13 23:29:15 PST  ``` Fixed in 3079f7966dbed4497e36d5067cbfd896a90358cb. Will be in 2.15 series. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=3392528)
* - [XML](show_bug.cgi?ctype=xml&id=3392528)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=3392528)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [Log In](show_bug.cgi?id=3392528&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=3392528&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from repo.or.cz_324f720e_20250125_152557.html ===

[![git](/git-logo.png)](http://git-scm.com/ "git homepage") [repo.or.cz](/) / [nasm.git](/nasm.git) / commit

commit
grep
author
committer
pickaxe
[?](/nasm.git/search_help "search help") search:

re

[summary](/nasm.git) | [log](/nasm.git/shortlog/3079f7966dbed4497e36d5067cbfd896a90358cb) | [graphiclog1](/git-browser/by-commit.html?r=nasm.git) | [graphiclog2](/git-browser/by-date.html?r=nasm.git) | commit | [commitdiff](/nasm.git/commitdiff/3079f7966dbed4497e36d5067cbfd896a90358cb) | [tree](/nasm.git/tree/3079f7966dbed4497e36d5067cbfd896a90358cb) | [refs](/nasm.git/refs) | [edit](/editproj.cgi?name=nasm.git) | [fork](/regproj.cgi?fork=nasm.git)

(parent: [feabd74](/nasm.git/commit/feabd742a3520d0835428f47d474979b4566c4ce)) | [patch](/nasm.git/patch/3079f7966dbed4497e36d5067cbfd896a90358cb)

[preproc: Fix malformed parameter count](/nasm.git/commitdiff/3079f7966dbed4497e36d5067cbfd896a90358cb)

| commit | 3079f7966dbed4497e36d5067cbfd896a90358cb |
| --- | --- |
| author | [Cyrill Gorcunov](/nasm.git/search/3079f7966dbed4497e36d5067cbfd896a90358cb?s=Cyrill+Gorcunov;st=author "Search for commits authored by Cyrill Gorcunov") [<gorcunov@gmail.com>](/nasm.git/search/3079f7966dbed4497e36d5067cbfd896a90358cb?s=gorcunov@gmail.com;st=author "Search for commits authored by gorcunov@gmail.com") |  |
|  | Wed, 14 Nov 2018 07:03:42 +0000 (14 10:03 +0300) |
| committer | [Cyrill Gorcunov](/nasm.git/search/3079f7966dbed4497e36d5067cbfd896a90358cb?s=Cyrill+Gorcunov;st=committer "Search for commits committed by Cyrill Gorcunov") [<gorcunov@gmail.com>](/nasm.git/search/3079f7966dbed4497e36d5067cbfd896a90358cb?s=gorcunov@gmail.com;st=committer "Search for commits committed by gorcunov@gmail.com") |  |
|  | Wed, 14 Nov 2018 07:26:26 +0000 (14 10:26 +0300) |
| tree | [f88e5c0ff834ee8b4b16a25106cc49ac83bf8de3](/nasm.git/tree/3079f7966dbed4497e36d5067cbfd896a90358cb) | [tree](/nasm.git/tree/3079f7966dbed4497e36d5067cbfd896a90358cb) | snapshot ([tar.gz](/nasm.git/snapshot/3079f7966dbed4497e36d5067cbfd896a90358cb.tar.gz) [zip](/nasm.git/snapshot/3079f7966dbed4497e36d5067cbfd896a90358cb.zip)) |
| parent | [feabd742a3520d0835428f47d474979b4566c4ce](/nasm.git/commit/feabd742a3520d0835428f47d474979b4566c4ce) | [commit](/nasm.git/commit/feabd742a3520d0835428f47d474979b4566c4ce) | [diff](/nasm.git/commitdiff/3079f7966dbed4497e36d5067cbfd896a90358cb?hp=feabd742a3520d0835428f47d474979b4566c4ce) |

preproc: Fix malformed parameter count

readnum returns 64bit number which may become

a negative integer upon conversion which in

turn lead to out of bound array access.

Fix it by explicit conversion with bounds check

 | POC6:2: error: parameter count `[2222222222](/nasm.git/object/2222222222)' is out of bounds [0; [2147483647](/nasm.git/object/2147483647)]

https://bugzilla.nasm.us/show\_bug.cgi?id=[3392528](/nasm.git/object/3392528)

Signed-off-by: Cyrill Gorcunov <gorcunov@gmail.com>

| [asm/preproc.c](/nasm.git/blob/3079f7966dbed4497e36d5067cbfd896a90358cb%3A/asm/preproc.c) |  | [diff](/nasm.git/blobdiff/feabd742a3520d0835428f47d474979b4566c4ce..3079f7966dbed4497e36d5067cbfd896a90358cb%3A/asm/preproc.c) | [blob](/nasm.git/blob/3079f7966dbed4497e36d5067cbfd896a90358cb%3A/asm/preproc.c) | [blame](/nasm.git/blame/3079f7966dbed4497e36d5067cbfd896a90358cb%3A/asm/preproc.c) | [history](/nasm.git/history/3079f7966dbed4497e36d5067cbfd896a90358cb%3A/asm/preproc.c) |
| --- | --- | --- |

The Netwide Assembler
[RSS](/nasm.git/rss "log RSS feed")
[Atom](/nasm.git/atom "log Atom feed")


