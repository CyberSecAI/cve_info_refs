=== Content from www.digitalinterruption.com_5e040a3e_20250126_074805.html ===


[Skip to content](#content)
[![Digital Interruption](https://www.digitalinterruption.com/wp-content/uploads/2019/01/digialInterruption-final-logo-edit.png)](https://www.digitalinterruption.com/ "Digital Interruption")

* [Services](https://www.digitalinterruption.com/)
  + [Penetration Testing](https://www.digitalinterruption.com/testing-2)
  + [Vulnerability Scanning](https://www.digitalinterruption.com/vulnerability-scanning)
  + [Cyber Essentials](https://www.digitalinterruption.com/cyber-essentials)
  + [Consultancy](https://www.digitalinterruption.com/consultancy-2)
  + [Training](https://www.digitalinterruption.com/training-2)
  + [Tooling](https://www.digitalinterruption.com/toolin)
* [Research](https://www.digitalinterruption.com/)
  + [Blog](https://www.digitalinterruption.com/di-blog)
  + [WhitePapers](https://research.digitalinterruption.com/whitepapers)
  + [CVEs](https://www.digitalinterruption.com/cves)
  + [Talks](https://research.digitalinterruption.com/talks)
  + [Technical Blog](https://research.digitalinterruption.com/)
* [FAQ](https://www.digitalinterruption.com/faq)
* [About Us](https://www.digitalinterruption.com/about)
* [Contact Us](https://www.digitalinterruption.com/contact-us)
* [REX](https://rexscan.com)
* [Pterodactyl](https://www.digitalinterruption.com/pterodactyl)

![](//www.digitalinterruption.com/wp-content/uploads/2020/04/Testing-scaled.jpg)![](//www.digitalinterruption.com/wp-content/uploads/2020/04/47695637821_3279ccc8fe_o-3-scaled.jpg)![](//www.digitalinterruption.com/wp-content/uploads/2020/04/arif-riyanto-G1N9kDHqBrQ-unsplash-scaled.jpg)![](//www.digitalinterruption.com/wp-content/uploads/2020/04/45168758494_ab8ec3c451_o-scaled.jpg)![](//www.digitalinterruption.com/wp-content/uploads/2020/04/Research.jpeg)
Testing![Image is not available](//www.digitalinterruption.com/wp-content/uploads/2020/04/Website-Landing-Page-V.5.006.png)We understand that you want the best protection for your business and your customers.

That’s why we offer a range of mobile, web and network penetration testing, using industry standard methodologies such as OWASP Top Ten, OSSTMM and NIST 800-15 as well as vulnerability scanning and Cyber Essentials.

[READ MORE](https://www.digitalinterruption.com/testing-2)Consultancy![Image is not available](//www.digitalinterruption.com/wp-content/uploads/2020/04/Website-Landing-Page-V.5.007.png)At Digital Interruption we offer more than just a penetration test, our Virtual SME Service puts us at the heart of your pipeline.

From threat modelling, to DevSecOps and everything in between, our diverse team of experts work with you and your teams; offering advice and guidance when you need it the most.

From threat modelling, to DevSecOps and everything in between, our diverse team of experts work with you and your teams; offering advice and guidance when you need it the most.

From threat modelling, to DevSecOps and everything in between, our diverse team of experts work with you and your teams; offering advice and guidance when you need it the most.

[READ MORE](https://www.digitalinterruption.com/consultancy-2)Tooling![Image is not available](//www.digitalinterruption.com/wp-content/uploads/2020/04/Website-Landing-Page-V.5.008.png)Hacker tools are made for hackers right? Wrong. Ours are made for developers and customers.

Whether it’s tools to help you run your own security tests, integrate security in to your pipeline, or help you understand your threats better, we have tools that can help.

Whether it’s tools to help you run your own security tests, integrate security in to your pipeline, or help you understand your threats better, we have tools that can help.

Whether it’s tools to help you run your own security tests, integrate security in to your pipeline, or help you understand your threats better, we have tools that can help.

[READ MORE](https://www.digitalinterruption.com/tooling-2)Training![Image is not available](//www.digitalinterruption.com/wp-content/uploads/2020/04/Website-Landing-Page-V.5.009.png)Since we started Digital Interruption we've trained hundreds of people in security.

Training technical teams on security can save you both time and money. From secure coding to offensive hacking, our consultants deliver training to organisations, conferences and universities all over the world.

Training technical teams on security can save you both time and money. From secure coding to offensive hacking, our consultants deliver training to organisations, conferences and universities all over the world.

Training technical teams on security can save you both time and money. From secure coding to offensive hacking, our consultants deliver training to organisations, conferences and universities all over the world.

[READ MORE](https://www.digitalinterruption.com/training-2)Research![Image is not available](//www.digitalinterruption.com/wp-content/uploads/2020/04/Website-Landing-Page-V.5.010.png)Our research is at the core of what we do, our consultants were some of the first to find vulnerabilities in VR applications and Android Wear.

We release regular blogs and white papers on secure application development, hardware hacking, how to embed security and compliance and have numerous CVEs.

We release regular blogs and white papers on secure application development, hardware hacking, how to embed security and compliance and have numerous CVEs.

We release regular blogs and white papers on secure application development, hardware hacking, how to embed security and compliance and have numerous CVEs.

[READ MORE](https://www.digitalinterruption.com/di-blog)

![previous arrow](data:image/svg+xml;base64...)![previous arrow](data:image/svg+xml;base64...)![next arrow](data:image/svg+xml;base64...)![next arrow](data:image/svg+xml;base64...)
![Digital Interruption](https://www.digitalinterruption.com/wp-content/uploads/2020/03/cropped-aswin-mahesh-4_LGBLe6VZA-unsplash-1-scaled-1.jpg "Digital Interruption")

### [Penetration Testing](https://www.digitalinterruption.com/testing-2)

Our range of penetration testing and vulnerability scanning services help to protect both your business and your customers.

### [Vulnerability Scanning](https://www.digitalinterruption.com/vulnerability-scanning)

We can scan your networks and applications for you, giving you actionable reports that are easy to understand.

### [Security Consultancy](https://www.digitalinterruption.com/consultancy-2)

Our diverse team of experts work with you and your teams; offering advice and guidance when you need it the most.

### [Security Integration](https://www.digitalinterruption.com/tooling-2)

Whether you want to run your own in-house security testing or just start to understand your threats better, our tools can help.

### [Security Training](https://www.digitalinterruption.com/training-2)

From secure coding to offensive hacking, we deliver training to organisations and conferences all over the world.

## Security Tools

You can intergrate security in to your pipeline, but for it to work well it needs to be the right fit for your comapany.

Whether you’re looking to test your own products,  train staff, or develop new processes to embed security in to your culture, we can provide the tools to help.

CONTACT US

## Security Designed for SMEs

Small or large, we all need security. That’s why we’ve tailored our services to SMEs and Startups.

Our years of experiece with big banks make us ideal for fintech and our regualtory knowledege can protect your tech-for-good products.

CONTACT US

## Remote Security Services

From our Virtual AppSec SME to off site penetration testing, all our services are designed to be offered remote. Even our training and worhops can be delivered virtually.

This saves you money and time, and limits the disruption to your business.

CONTACT US

## Conferences and Events

We speak about all aspects of ethical hacking and Cybersecurity. Our consultants give talks and workshops  at conferences and events world wide.

To book one of our specialists for a talk or workshop please get in touch.

CONTACT US

### About us

Digital Interruption is a Manchester based CyberSecurity Consultancy founded by Jahmel Harris and Saskia Coplans in 2017.

We believe that security should be universal which means it should be accessible to everyone. That’s why we offer a range of testing, scanning and consultancy services all available remotely.

We’ve designed our services to meet the needs of organisations who need it the most.

READ MORE

![](https://www.digitalinterruption.com/wp-content/uploads/2020/04/Consultancy-1024x776.jpg)

### What our clients say

> As a developer, I’ve often seen pen testing as little more than a checkbox exercise, where senior management bring in a big name who run some automated scans and give you a certificate at the end. Digital Interruption were different, they understood the domain and the architecture of the app which allowed them to test in a more thorough way which gave us a lot of confidence when talking to clients about the security of the app.

Chris Northwood; Lead Developer and author of The Full Stack Developer

> Reports were especially useful for our management to understand their business risks and for developers to quickly remediate the discovered vulnerabilities. Needless to say, our team was very thankful to have had the opportunity to work with Jahmel!

Senior Security Engineer; Company Name under NDA

> We really enjoyed working with Jahmel and the team on the pen test. They were extremely professional and diligent in their work, and their report was extensively detailed. Their knowledge of all matters security was second to none, and their advice proved invaluable to our business.

Kieran Innes; Co-founder and CTO at Tootoot | Forbes 30 under 30

## CONTACT

### [Phone](https://www.digitalinterruption.com/contact-us)

0161 820 3056

### [Email](https://www.digitalinterruption.com/contact-us)

contact@digitalinterruption.com

### [Message](https://www.digitalinterruption.com/contact-us#form)

Contact us

[Twitter](https://twitter.com/di_security)

[Linkedin](https://www.linkedin.com/company/digitalinterruption/)

**Digital Interruption**

Colony, 5 Piccadilly Place, Manchester, M1 3BR

+44 (0) 161 820 3056

contact@digitalinterruption.com

![](https://www.digitalinterruption.com/wp-content/uploads/2020/04/digialInterruption-final-logo-block-colour-white-text-300x79.png)

Digital Interruption Limited is a company registered in England and Wales with company number 10629757

ICO Registration Number: ZA446620

VAT Number: 279 2798 36

**[Privacy Notice](https://www.digitalinterruption.com/privacy-notice)** | **[Cookie Policy](https://www.digitalinterruption.com/cookie-policy)**

![](https://www.digitalinterruption.com/wp-content/uploads/2018/12/Cyber-Essentials-Badge-Large-72dpi-1-230x194.png)



=== Content from research.digitalinterruption.com_4dfb3f33_20250125_093106.html ===

[![](/assets/img/logo.png)
![](/assets/img/cropped-di-security-logo1-small-72x72.png)](/)

* [Blog](/)
   -
* [Talks](/talks/)
   -
* [White Papers](/whitepapers/)
   -
* [RSS Feed](/feed.xml "Follow RSS feed")
* [GitHub](https://github.com/DigitalInterruption "Follow on GitHub")
* [LinkedIn](https://www.linkedin.com/company/digitalinterruption/ "Follow on LinkedIn")
* [Twitter](https://twitter.com/di_security "Follow on Twitter")

# Privilege Escalation in ManageEngine ADManager Plus 6.6

April 15, 2019

During a recent review of the ADManager Plus software offered by Zoho, we were able to identify a privilege escalation vulnerability which would allow authenticated users to escalate to `NT AUTHORITY\SYSTEM` in versions up to and including 6.6 (build 6657).

### The Cause of the Vulnerability

After completing the installation, the software can be found in `C:\ManageEngine\ADManager Plus`, assuming the default location is not changed. Within this directory are several directories with weak security settings. The affected directories are:

* `bin`
* `lib`
* `tools`

The issue affecting these directories is that they are created with full control assigned to the `Authenticated Users` group:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/permissions.png)

The `Authenticated Users` group in Windows is not a typical group in which users can be added or removed. If an account authenticates with the system, be it a local account or domain account, it will be deemed to be part of the `Authenticated Users` group. The built-in accounts such as `LOCAL SERVICE` do not get included in this group, as they are accounts without a password that do not require authentication.

By assigning full control to `Authenticated Users`, any user that is logged in is capable of modifying the contents of the aforementioned directories. The `bin` directory is of significance, as the entry point of the software is found in this directory, along with several other core executables.

An example of two files being accessed during startup can be seen in the screenshot of procmon below:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/bin_access.png)

As the nature of the software requires administrator privileges, due to it serving the purpose of managing an active directory environment, there is no reason to provide write access to all authenticated users. This misconfiguration is particularly dangerous due to the previously touched upon point - the software *requires* administrator level access. The `ManageEngine ADManager Plus` service is by default installed to launch using the local system account:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/sc.png)

### Exploitation

To exploit this vulnerability, one of the core files used by ADManager in the `bin` directory needs to be modified or replaced to execute a payload that will elevate one’s privileges. As previously mentioned, one must be in the context of an authenticated user, in this example, we will start as a low privilege user aptly named `lowpriv`:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/lowpriv-shell.png)

It was previously noted that when the service starts, the `wrapper.exe` and `admanager.exe` files are both accessed. Whilst it is possible to backdoor these files, they cannot be overwritten whilst the service is running. Instead, an alternative file must be found which either:

* Is not persistently running after startup
* Can be modified whilst being executed

Running procmon again and looking at the results show several other files being accessed during startup - in particular, `ChangeJRE.bat`. As this is a batch script, even if this script continues to execute throughout the lifetime of the process, it can still be modified in place.

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/changejre.png)

The purpose of this file appears to be to upgrade several files if newer versions are present. For example, if a file is present in `lib/native` named `ntlmauth.dll_new`, the `ntlmauth.dll` file will be deleted and replaced with `ntlmauth.dll_new`. Although this mechanism can be abused, it would mean creating a DLL that is compatible with the previous one; there is much simpler way to utilise this file.

By adding an extra line to the batch file, we can make it run another executable. Rather than just launching the executable directly, it should ideally be launched using `start`. This will make the executable launch in a non-blocking manner and allow `ChangeJRE.bat` to continue executing seamlessly:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/changejre-modification.png)

The highlighted change in the above screenshot will launch `C:\ManageEngine\ADManager Plus\bin\privesc.exe` alongside `ChangeJRE.bat`. In this case, we created `privesc.exe` using `msfvenom`:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/msfvenom.png)

With a payload ready and the backdoored batch file, all that is left to do is upload them and wait:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/upload.png)

After initiating a reboot on the server, the previous session (running as `lowpriv`) drops, and a new session is initiated as the server comes back up; this time running as `NT AUTHORITY\SYSTEM`:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/privesc.png)

Looking at the task list after acquiring the SYSTEM shell also confirms that the modification made to `ChangeJRE.bat` is not blocking execution; meaning that ADManager Plus will continue to function as normal:

![](/assets/img/2019-04-15-privilege-escalation-in-manageengine-admanager-plus-6/tasklist.png)

### Timeline

* **2018-11-15**: Vulnerability identified in build 6653
* **2019-01-31**: Vendor contacted via their bug bounty program
* **2019-01-31**: Acknowledgement from vendor and investigation opened
* **2019-04-15**: Vulnerability confirmed to be in the latest build (6657)
* **2019-02-28**: Update released to fix vulnerability
* **2019-04-15**: Public disclosure

[#active directory](/tags#active+directory)
[#ADManager](/tags#ADManager)
[#CVE-2018-19374](/tags#CVE-2018-19374)

Copyright 2019 [Digital Interruption](https://www.digitalinterruption.com/)


