=== Content from github.com_2cab5f53_20250125_041921.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysstat%2Fsysstat%2Fissues%2F196)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsysstat%2Fsysstat%2Fissues%2F196)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=sysstat%2Fsysstat)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sysstat](/sysstat)
/
**[sysstat](/sysstat/sysstat)**
Public

* [Notifications](/login?return_to=%2Fsysstat%2Fsysstat) You must be signed in to change notification settings
* [Fork
  457](/login?return_to=%2Fsysstat%2Fsysstat)
* [Star
   3.1k](/login?return_to=%2Fsysstat%2Fsysstat)

* [Code](/sysstat/sysstat)
* [Issues
  61](/sysstat/sysstat/issues)
* [Pull requests
  3](/sysstat/sysstat/pulls)
* [Discussions](/sysstat/sysstat/discussions)
* [Actions](/sysstat/sysstat/actions)
* [Projects
  0](/sysstat/sysstat/projects)
* [Wiki](/sysstat/sysstat/wiki)
* [Security](/sysstat/sysstat/security)
* [Insights](/sysstat/sysstat/pulse)

Additional navigation options

* [Code](/sysstat/sysstat)
* [Issues](/sysstat/sysstat/issues)
* [Pull requests](/sysstat/sysstat/pulls)
* [Discussions](/sysstat/sysstat/discussions)
* [Actions](/sysstat/sysstat/actions)
* [Projects](/sysstat/sysstat/projects)
* [Wiki](/sysstat/sysstat/wiki)
* [Security](/sysstat/sysstat/security)
* [Insights](/sysstat/sysstat/pulse)

# [bug report]: out of bound read in sadf which may lead to code execution #196

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[[bug report]: out of bound read in sadf which may lead to code execution](#top)#196Copy link[![@bash-c](https://avatars.githubusercontent.com/u/24247697?u=c511314dd352d8c46ef2fa13958fe7c231702b51&v=4&size=80)](/bash-c)
## Description

[![@bash-c](https://avatars.githubusercontent.com/u/24247697?u=c511314dd352d8c46ef2fa13958fe7c231702b51&v=4&size=48)](/bash-c)[bash-c](https://github.com/bash-c)opened [on Nov 21, 2018](https://github.com/sysstat/sysstat/issues/196#issue-382939700)

Information:

* version:

```
analyses ./sadf -V
sysstat 版本 12.1.1
(C) Sebastien Godard (sysstat <at> orange.fr)
```

* related code(sa\_common.c:1293)

```
1290   │     /* Remap [unsigned] long fields */
1291   │     d = gtypes_nr[0] - ftypes_nr[0];
1292   │     if (d) {
1293   │         memmove(((char *) ps) + gtypes_nr[0] * ULL_ALIGNMENT_WIDTH,
1294   │             ((char *) ps) + ftypes_nr[0] * ULL_ALIGNMENT_WIDTH,
1295   │             MINIMUM(f_size - ftypes_nr[0] * ULL_ALIGNMENT_WIDTH,
1296   │                 g_size - gtypes_nr[0] * ULL_ALIGNMENT_WIDTH));
1297   │         if (d > 0) {
1298   │             memset(((char *) ps) + ftypes_nr[0] * ULL_ALIGNMENT_WIDTH,
1299   │                    0, d * ULL_ALIGNMENT_WIDTH);
1300   │         }
1301   │     }
```

* Description:

  `memmove()` doesn't check the args and `sadf` crashes when the args is invalid. The following is my debug info

```
pwndbg>
memmove (__len=8, __src=0x8000ffffcf00, __dest=0x7fffffffd700) at /usr/include/x86_64-linux-gnu/bits/string_fortified.h:40
40	  return __builtin___memmove_chk (__dest, __src, __len, __bos0 (__dest));
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
────────────────────────────────────────────────────────────────────[ REGISTERS ]─────────────────────────────────────────────────────────────────────
 RAX  0x800
 RBX  0x5555557aba88 (file_hdr+40) ◂— 0xffffffff02
 RCX  0x10
 RDX  0x8
 RDI  0x7fffffffd700 ◂— 0x3
 RSI  0x8000ffffcf00
 R8   0x18
 R9   0xfffff810
 R10  0x8
 R11  0x1
 R12  0x5555557a5b50 (rec_types_nr) ◂— 0x2
 R13  0x18
 R14  0x7fffffffd6f0 ◂— 0x3030303030303030 ('00000000')
 R15  0x100
 RBP  0x10
 RSP  0x7fffffffd630 ◂— 0x0
 RIP  0x55555558cd8a (remap_struct+346) ◂— call   0x555555557e70
──────────────────────────────────────────────────────────────────────[ DISASM ]──────────────────────────────────────────────────────────────────────
   0x55555558cd7c <remap_struct+332>    sub    edx, edi
   0x55555558cd7e <remap_struct+334>    sub    eax, r9d
   0x55555558cd81 <remap_struct+337>    cmp    edx, eax
   0x55555558cd83 <remap_struct+339>    cmova  rdx, rax
   0x55555558cd87 <remap_struct+343>    add    rdi, r14
 ► 0x55555558cd8a <remap_struct+346>    call   memmove@plt <0x555555557e70>
        dest: 0x7fffffffd700 ◂— 0x3
        src: 0x8000ffffcf00
        n: 0x8

   0x55555558cd8f <remap_struct+351>    test   r15d, r15d
   0x55555558cd92 <remap_struct+354>    jle    remap_struct+386 <0x55555558cdb2>

   0x55555558cd94 <remap_struct+356>    mov    eax, dword ptr [rbx]
   0x55555558cd96 <remap_struct+358>    lea    edx, [r15*8]
   0x55555558cd9e <remap_struct+366>    xor    esi, esi
──────────────────────────────────────────────────────────────────[ SOURCE (CODE) ]───────────────────────────────────────────────────────────────────
   35 }
   36
   37 __fortify_function void *
   38 __NTH (memmove (void *__dest, const void *__src, size_t __len))
   39 {
 ► 40   return __builtin___memmove_chk (__dest, __src, __len, __bos0 (__dest));
   41 }
   42
   43 #ifdef __USE_GNU
   44 __fortify_function void *
   45 __NTH (mempcpy (void *__restrict __dest, const void *__restrict __src,
──────────────────────────────────────────────────────────────────────[ STACK ]───────────────────────────────────────────────────────────────────────
00:0000│ rsp  0x7fffffffd630 ◂— 0x0
01:0008│      0x7fffffffd638 —▸ 0x5555557aba60 (file_hdr) ◂— 0x3030303030303030 ('00000000')
02:0010│      0x7fffffffd640 —▸ 0x7fffffffd6f0 ◂— 0x3030303030303030 ('00000000')
03:0018│      0x7fffffffd648 —▸ 0x5555557abc80 (record_hdr) ◂— 0x0
04:0020│      0x7fffffffd650 ◂— 0x0
... ↓
06:0030│      0x7fffffffd660 —▸ 0x7fffffffda40 ◂— 0x20 /* ' ' */
07:0038│      0x7fffffffd668 —▸ 0x55555558cfa0 (read_record_hdr+96) ◂— movdqu xmm0, xmmword ptr [rbp]
```

If we control `src` and `n` of `memmove`, stack overflow may happen which lead to ROP even code execution!

* ASAN

```
sa_common_1293 ./sadf stack_oob
ASAN:DEADLYSIGNAL
=================================================================
==12760==ERROR: AddressSanitizer: SEGV on unknown address 0x100089c809c6 (pc 0x7f03a0cf6b85 bp 0x7fff4e445550 sp 0x7fff4e444cc0 T0)
==12760==The signal is caused by a READ memory access.
    #0 0x7f03a0cf6b84 in __interceptor_memmove (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x7ab84)
    #1 0x55d39dbc7e5e in memmove /usr/include/x86_64-linux-gnu/bits/string_fortified.h:40
    #2 0x55d39dbc7e5e in remap_struct /home/m4x/Projects/sysstat-12.1.1/sa_common.c:1293
    #3 0x55d39dbc806f in read_record_hdr /home/m4x/Projects/sysstat-12.1.1/sa_common.c:1424
    #4 0x55d39db93f7b in read_next_sample /home/m4x/Projects/sysstat-12.1.1/sadf.c:239
    #5 0x55d39db958e5 in logic2_display_loop /home/m4x/Projects/sysstat-12.1.1/sadf.c:1173
    #6 0x55d39db9625c in read_stats_from_file /home/m4x/Projects/sysstat-12.1.1/sadf.c:1432
    #7 0x55d39db931f0 in main /home/m4x/Projects/sysstat-12.1.1/sadf.c:1799
    #8 0x7f03a08acb96 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b96)
    #9 0x55d39db93c59 in _start (/home/m4x/Projects/huawei/crash/analyses/sysstat-sadf/sa_common_1293/sadf+0x4c59)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV (/usr/lib/x86_64-linux-gnu/libasan.so.4+0x7ab84) in __interceptor_memmove
==12760==ABORTING
```

[poc here](https://drive.google.com/open?id=1115jr2Fw40usDdVKKUZaDEE9GLzHx2uh)

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


