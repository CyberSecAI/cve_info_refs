=== Content from downloads.asterisk.org_7a4d3ca7_20250124_233449.html ===


Asterisk
Project Security Advisory - AST-2018-010

| **Product** | Asterisk |
| **Summary** | Remote crash vulnerability DNS SRV and NAPTR lookups |
| **Nature of Advisory** | Denial Of Service |
| **Susceptibility** | Remote Unauthenticated Sessions |
| **Severity** | Moderate |
| **Exploits Known** | No |
| **Reported On** | October 23, 2018 |
| **Reported By** | Jan Hoffmann |
| **Posted On** | November 14,2018 |
| **Last Updated On** | November 14, 2018 |
| **Advisory Contact** | gjoseph AT digium DOT com |
| **CVE Name** | CVE-2018-19278 |

| **Description** | There is a buffer overflow vulnerability in dns\_srv and dns\_naptr functions of Asterisk that allows an attacker to crash Asterisk via a specially crafted DNS SRV or NAPTR response. The attackerâs request causes Asterisk to segfault and crash. |

| **Resolution** | Upgrade Asterisk to a fixed version. |

| **Affected Versions** | | |
| **Product** | **Release Series** |  |
| Asterisk Open Source | 15.x | All releases |
| Asterisk Open Source | 16.x | All releases |

| **Corrected In** | |
| **Product** | **Release** |
| Asterisk Open Source | 15.6.2 |
| Asterisk Open Source | 16.0.1 |

| **Patches** | |
| **SVN URL** | **Revision** |
| [http://downloads.asterisk.org/pub/security/AST-2018-0](http://downloads.asterisk.org/pub/security/AST-2018-009-13.diff)[1](http://downloads.asterisk.org/pub/security/AST-2018-009-13.diff)[0](http://downloads.asterisk.org/pub/security/AST-2018-009-13.diff)[-1](http://downloads.asterisk.org/pub/security/AST-2018-009-13.diff)[5](http://downloads.asterisk.org/pub/security/AST-2018-009-13.diff)[.diff](http://downloads.asterisk.org/pub/security/AST-2018-009-13.diff) | Asterisk 15 |
| [http://downloads.asterisk.org/pub/security/AST-2018-0](http://downloads.asterisk.org/pub/security/AST-2018-009-15)[1](http://downloads.asterisk.org/pub/security/AST-2018-009-15)[0](http://downloads.asterisk.org/pub/security/AST-2018-009-15)[-1](http://downloads.asterisk.org/pub/security/AST-2018-009-15)6[.diff](http://downloads.asterisk.org/pub/security/AST-2018-009-13.diff) | Asterisk 16 |

| **Links** | https://issues.asterisk.org/jira/browse/ASTERISK-28127 |

| Asterisk Project Security Advisories are posted at <http://www.asterisk.org/security>  This document may be superseded by later versions; if so, the latest version will be posted at http://downloads.digium.com/pub/security/AST-2018-010.pdf and http://downloads.digium.com/pub/security/AST-2018-010.html |

| **Revision History** | | |
| **Date** | **Editor** | **Revisions Made** |
| October 25, 2018 | George Joseph | Initial revision |
| November 14, 2018 | George Joseph | Updated with CVE |

Asterisk
Project Security Advisory - AST-2018-010

Copyright
Â© 2018
Digium, Inc. All Rights Reserved.

Permission is hereby granted
to distribute and publish this advisory in its original, unaltered
form.



=== Content from issues.asterisk.org_49faf514_20250124_233452.html ===

[[Home](/)]

| Summary: | ASTERISK-28127: Buffer overflow for DNS SRV/NAPTR records | | |
| --- | --- | --- | --- |
| Reporter: | Jan Hoffmann (janhoffmann) | Labels: | patch security |
| Date Opened: | 2018-10-23 16:48:11 | Date Closed: | 2018-11-14 10:12:37.000-0600 |
| Priority: | Blocker | Regression? |  |
| Status: | Closed/Complete | Components: | Core/DNS |
| Versions: | 16.0.0 | Frequency ofOccurrence |  |
| RelatedIssues: |  | | |
| Environment: |  | Attachments: | ( 0) [patch.diff](../attachments/28/ASTERISK-28127/00-patch.diff)( 1) [patch.diff](../attachments/28/ASTERISK-28127/01-patch.diff) |
| Description: | There is a possible buffer overflow in {{dns\_srv\_alloc}} and {{dns\_naptr\_alloc}} when a SRV/NAPTR record contains a compressed domain name. I am using Asterisk 16, but it looks like this issue exists since Asterisk 14.   In both functions, {{dn\_expand}} is used to expand a compressed domain name. The return value is used to calculate the size of the buffer for the {{ast\_dns\_srv\_record}} / {{ast\_dns\_naptr\_record}} struct, where the expanded domain name will be stored. However, the return value of {{dn\_expand}} is actually the length of the compressed domain name, so this can lead to a buffer overflow.   This can be fixed by using the actual string length of the expanded domain name instead of the return value of {{dn\_expand}} to calculate the buffer size.   The specific case where this bug occurred for me is {{\_sip.\_udp.tel.t-online.de}}, which resolves to the following here:   {noformat}  \_sip.\_udp.tel.t-online.de. 325 IN SRV 10 0 5060 do-epp-801.edns.t-ipnet.de.  \_sip.\_udp.tel.t-online.de. 325 IN SRV 20 0 5060 h2-epp-801.edns.t-ipnet.de.  {noformat}   For the first record, the first three labels of the name are encoded directly. Only the last label ({{de}}) is encoded as a reference. In this case, the length of the compressed name happens to be identical to length of the expanded name at 26 bytes. Contents of the data parameter (domain name starts at 7th byte):  {noformat}  00 0A 00 00 13 C4 0A 64 6F 2D 65 70 70 2D 38 30 31 04 65 64 6E 73 07 74 2D 69 70 6E 65 74 C0 23  {noformat}   For the second record, only the first label ({{h2-epp-801}}) is encoded directly, and the rest is a reference. The expanded name has a length of 26 bytes, while the compressed name is only 13 bytes long. Contents of the data parameter (domain name starts at 7th byte):  {noformat}  00 14 00 00 13 C4 0A 68 32 2D 65 70 70 2D 38 30 31 C0 48  {noformat} | | |
| Comments: | By: Asterisk Team (asteriskteam) 2018-10-23 16:48:15.084-0500This issue has been automatically restricted and set to a blocker due to being a security type issue. If this is not a security vulnerability issue it will be moved to the appropriate issue type when triaged.  ---   By: Asterisk Team (asteriskteam) 2018-10-23 16:48:15.331-0500Thanks for creating a report! The issue has entered the triage process. That means the issue will wait in this status until a Bug Marshal has an opportunity to review the issue. Once the issue has been reviewed you will receive comments regarding the next steps towards resolution.   A good first step is for you to review the [Asterisk Issue Guidelines|https://wiki.asterisk.org/wiki/display/AST/Asterisk+Issue+Guidelines] if you haven't already. The guidelines detail what is expected from an Asterisk issue report.   Then, if you are submitting a patch, please review the [Patch Contribution Process|https://wiki.asterisk.org/wiki/display/AST/Patch+Contribution+Process].  ---   By: Jan Hoffmann (janhoffmann) 2018-10-27 06:43:18.361-0500I just noticed that my original patch is faulty, since host\_size is used again later in dns\_srv\_alloc to explicitly set the terminating null byte. Thus, the domain name is truncated.   Setting the null byte there does not actually seem necessary to me, as it is already done by strcpy. It also isn't done at the equivalent place in dns\_naptr\_alloc.  ---   By: Jan Hoffmann (janhoffmann) 2018-10-27 06:44:12.886-0500Updated patch  ---   By: Friendly Automation (friendly-automation) 2018-11-14 10:12:38.186-0600Change 10644 merged by George Joseph:  AST-2018-010: Fix length of buffer needed for SRV and NAPTR results   [https://gerrit.asterisk.org/10644|https://gerrit.asterisk.org/10644]  ---   By: Friendly Automation (friendly-automation) 2018-11-14 10:13:06.106-0600Change 10641 merged by George Joseph:  AST-2018-010: Fix length of buffer needed for SRV and NAPTR results   [https://gerrit.asterisk.org/10641|https://gerrit.asterisk.org/10641]  ---   By: Friendly Automation (friendly-automation) 2018-11-14 10:13:29.653-0600Change 10643 merged by George Joseph:  AST-2018-010: Fix length of buffer needed for SRV and NAPTR results   [https://gerrit.asterisk.org/10643|https://gerrit.asterisk.org/10643]  ---   By: Friendly Automation (friendly-automation) 2018-11-14 10:13:58.335-0600Change 10642 merged by George Joseph:  AST-2018-010: Fix length of buffer needed for SRV and NAPTR results   [https://gerrit.asterisk.org/10642|https://gerrit.asterisk.org/10642]  ---   By: Friendly Automation (friendly-automation) 2018-11-14 10:31:23.624-0600Change 10645 merged by George Joseph:  AST-2018-010: Fix length of buffer needed for SRV and NAPTR results   [https://gerrit.asterisk.org/10645|https://gerrit.asterisk.org/10645]  --- | | |


