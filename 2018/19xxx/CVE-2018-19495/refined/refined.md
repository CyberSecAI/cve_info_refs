- **Root cause of vulnerability**: The GitLab Prometheus integration did not properly check URLs after redirects, allowing an attacker to bypass the localhost URL input block by providing an external URL that redirects to an internal address (e.g., 127.0.0.1).
- **Weaknesses/vulnerabilities present**: Server-Side Request Forgery (SSRF) due to insufficient validation of URLs after redirection.
- **Impact of exploitation**: An attacker could make requests to internal services by providing a redirecting URL to the Prometheus integration API URL. This could potentially expose sensitive information or allow further exploitation of internal network resources.
- **Attack vectors**:
    - The attacker provides a URL to an external site in the Prometheus integration settings.
    - The external site redirects the request to an internal address.
    - GitLab, after following the redirect, makes a request to the internal address specified in the redirect.
    - The attacker can also evade path restrictions using the "#" character.
- **Required attacker capabilities/position**:
    - The attacker needs to be logged into GitLab and have the ability to create a project and configure its integration settings.
    - The attacker needs to control an external web server to setup the redirect.