```
{
  "vulnerability": {
    "root_cause": "The `imap_open` function in the PHP IMAP extension does not sanitize or validate the server URI, allowing an attacker to inject shell commands via the `-oProxyCommand` option of the `ssh` command.",
    "weaknesses": [
      "Insufficient input validation",
      "Command injection"
    ],
    "impact": "Remote code execution on the server where the imap_open function is called if rsh/ssh logins are enabled or a shell command execution on the local system (depending on how rsh is configured). This can be used to bypass `disabled_functions` and `open_basedir` restrictions.",
    "attack_vectors": [
      "Manipulating the server URI parameter passed to the `imap_open` function."
    ],
    "required_capabilities": "An attacker needs to be able to control or inject data into the server URI parameter of the `imap_open` function."
  },
  "additional_details": {
    "more_info": "The vulnerability exists because the imap_open() function in PHP uses the underlying libc-client library, which executes the `rsh` command (or `ssh` command if rsh is a symlink to ssh in Debian-based systems) to check the connection using user-provided server URI. The library does not properly sanitize the input before passing it to the command-line, allowing for command injection using the -oProxyCommand option of SSH. The vulnerability is mitigated by disabling rsh/ssh functionality by default and introducing an option to enable it, with the understanding that the mailbox name is not sanitized before being passed to the rsh/ssh command.",
   "affected_software": "This vulnerability is present in the PHP IMAP extension and thus affects any application using the imap_open(), imap_createmailbox(), and imap_append() functions when processing user-provided server URIs. Some of the vulnerable applications listed are e107 v2, prestashop, SuiteCRM, SugarCRM, osTicket, Postie (wordpress plugin), faveo-helpdesk, yetiforceCRM, and postfixadmin. This also affects the University of Washington IMAP toolkit.",
    "php_versions": "The vulnerability affects PHP versions prior to 5.6.39, 7.0.33, 7.1.25, 7.2.13, and 7.3.0.  PHP 7.0 reached end of life on Dec 8th, 2018 but it has a fix as well in version 7.0.33.",
    "debian_info": "The vulnerability is fixed in uw-imap version 8:2007f~dfsg-5+deb9u1 for Debian 9 stretch, and uw-imap version 8:2007f~dfsg-4+deb8u1 for Debian 8 Jessie. In php7.0 version 7.0.33-0+deb9u1 fixes the issue for Debian 9 Stretch and php7.3/7.3.0-1 for Debian 10 Buster. Also, php5 versions are affected, 5.6.39+dfsg-0+deb8u1 fixes the vulnerability in Debian 8 Jessie.",
    "ubuntu_info": "The vulnerability is fixed in php versions in Ubuntu, including versions in Ubuntu 19.04, 18.04 ESM, 16.04 ESM. For uw-imap, the vulnerability is fixed in version 8:2007f~dfsg-4+deb8u1build0.16.04.1 for Ubuntu 16.04 Xenial.",
    "mitigation": "The vulnerability is mitigated in newer PHP versions by disabling rsh/ssh by default and introducing a new `imap.enable_insecure_rsh` ini option (default is false). The imap_open() function also now uses `mail_parameters()` function to set rsh and ssh timeouts to zero. It is advised to sanitize all user input if the rsh/ssh functionality is enabled."
  }
}
```