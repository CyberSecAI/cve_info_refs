=== Content from arstechnica.com_37e74fd4_20250125_023749.html ===


[Skip to content](#main)

[Ars Technica home](https://arstechnica.com/)

Sections

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

* [Feature](/features/)
* [Reviews](/reviews/)
* [Store](/store/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Pin to story

Theme

* HyperLight
* Day & Night
* Dark
* System

Search dialog...

Sign In

Sign in dialog...

Sign in

Stick a fork in me

# As predicted, more branch prediction processor attacks are discovered

New attack focuses on a different part of the branch prediction system.

[Ars Staff](https://arstechnica.com/author/ars-staff/)
–
Mar 26, 2018 6:15 pm

| [123](https://arstechnica.com/gadgets/2018/03/its-not-just-spectre-researchers-reveal-more-branch-prediction-attacks/#comments "123 comments")

[![](https://cdn.arstechnica.net/wp-content/uploads/2018/03/branches.jpg)](https://cdn.arstechnica.net/wp-content/uploads/2018/03/branches.jpg)

Credit:
[Ed Dunens](https://www.flickr.com/photos/blachswan/14990404869/in/photolist-oQDK7n-qhVPZ6-7Q61Eo-7SMn2r-mAsQh-juKPyL-bxo2jz-4wmHhL-bZR4AC-7W1Rmi-aNvJzD-8KpHSp-juHXkP-5LBgEZ-juL1gh-5GPNzK-4vGC9i-7Hfjnp-bw1EVR-boG6yH-7bcMmv-zN76o-7Kw7nH-hUGJ4o-iPfiir-b6fsi8-4ztAme-dNE6ze-3iCBqs-fWBV78-s8FS3U-b4BbdM-9qo3mQ-br1YkX-aR6x4-9zC8ad-7ZBvs-5tKYBj-22KARpf-iMMZh5-6m2vxX-9eVJqF-hUGJuy-ngg5m2-E5fsyY-by6tiF-8WbAC7-r3jVxK-7v1Y6H-vDVqk)

Credit:
[Ed Dunens](https://www.flickr.com/photos/blachswan/14990404869/in/photolist-oQDK7n-qhVPZ6-7Q61Eo-7SMn2r-mAsQh-juKPyL-bxo2jz-4wmHhL-bZR4AC-7W1Rmi-aNvJzD-8KpHSp-juHXkP-5LBgEZ-juL1gh-5GPNzK-4vGC9i-7Hfjnp-bw1EVR-boG6yH-7bcMmv-zN76o-7Kw7nH-hUGJ4o-iPfiir-b6fsi8-4ztAme-dNE6ze-3iCBqs-fWBV78-s8FS3U-b4BbdM-9qo3mQ-br1YkX-aR6x4-9zC8ad-7ZBvs-5tKYBj-22KARpf-iMMZh5-6m2vxX-9eVJqF-hUGJuy-ngg5m2-E5fsyY-by6tiF-8WbAC7-r3jVxK-7v1Y6H-vDVqk)

Text
settings

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Minimize to nav

Researchers from the College of William and Mary, Carnegie Mellon, the University of California Riverside, and Binghamton University have [described a security attack](http://www.cs.ucr.edu/~nael/pubs/asplos18.pdf) that uses the speculative execution features of modern processors to leak sensitive information and undermine the security boundaries that operating systems and software erect to protect important data.

That probably sounds familiar.

The Spectre attacks, [published earlier this year](https://arstechnica.com/gadgets/2018/01/meltdown-and-spectre-every-modern-processor-has-unfixable-security-flaws/), take advantage of the speculative execution features of modern processors to leak sensitive information. The new attack, named BranchScope by the researchers, shares some similarity with variant 2 of the Spectre attack, as both BranchScope and Spectre 2 take advantage of the behavior of the processor's branch predictor.

With speculative execution, the processor runs ahead of where the program actually is, and it tries to execute instructions before it can be certain if those instructions will actually be run. For example, if a program tests whether two numbers are equal and does one thing if they are and another thing if they aren't, the processor will guess the outcome and speculatively execute the resulting action. If it later turns out that the processor guessed wrong, the speculative results are thrown away and, at least in an abstract sense, it's as if the bad guess never happened. The processor picks up from where it left off, performing the action that it should have taken instead.

The Spectre attacks as a whole occur because the processor doesn't quite put things back the way they should be. While the processor does revert to its speculative execution correctly—if it didn't, programs would simply stop working correctly—it doesn't quite do so perfectly. This is particularly noticeable when it comes to the processor's cache: speculative execution can cause the processor to load data into cache (or, alternatively, evict data *from* cache), and these cache changes persist even if a bad speculation is made. Carefully written software can detect these cache changes and use them to infer secret information.

The processor's branch predictor is one of its core pieces of speculative execution machinery. While the branch predictors in the latest processors are complex, in broad terms they operate in a similar way. The processor tracks the address of branch instructions, whether the branch was taken or not, and if the branch is taken, the address of the next instruction that should execute—that is, the target of the branch. The branch predictor provides two related predictions: whether the branch is taken or not, and if it's taken, what the target is.

BranchScope and Spectre 2 both take advantage of different parts of the branch predictor. Spectre 2 relied on a part called the Branch Target Buffer (BTB)—the data structure within the processor that records the branch target. BranchScope, instead, leaks information using the direction of the prediction—whether it's likely to be taken or not—which is stored in the pattern history table (PHT).

The PHT keeps a kind of running score of recently taken branches to remember if those branches were taken or not. Typically, it's a two-bit counter with four states: strongly taken, weakly taken, weakly not taken, and strongly not taken. Each time a branch is taken, the counter's value is moved toward "strongly taken;" each time it's not taken, it's moved toward "strongly not taken." This design means that an occasional mispredict won't change the result of the prediction: a branch that's almost always taken will still predict as taken, even if it's occasionally not actually taken. Changing the prediction requires two back-to-back mispredicts. This design is proven to provide better results than a one-bit counter that simply predicts a branch based on what happened the last time it was taken.

For Spectre 2, an attacker primes the BTB, carefully executing branch instructions so that the BTB has a predictable content with a target instruction that will, if speculatively executed, disturb the processor's cache in a detectable way. The victim program then runs and makes a branch. The attacker then checks to see if the cache was disturbed; the measurement of that disturbance leaks information.

In the new attack, an attacker primes the PHT and running branch instructions so that the PHT will always assume a particular branch is taken or not taken. The victim code then runs and makes a branch, which is potentially disturbing the PHT. The attacker then runs more branch instructions of its own to detect that disturbance to the PHT; the attacker knows that some branches should be predicted in a particular direction and tests to see if the victim's code has changed that prediction.

The researchers looked only at Intel processors, using the attacks to leak information protected using Intel's SGX (Software Guard Extensions), a feature found on certain chips to carve out small sections of encrypted code and data such that even the operating system (or virtualization software) cannot access it. They also described ways the attack could be used against address space layout randomization and to infer data in encryption and image libraries.

Spectre 2 has provoked [both operating system and hardware changes](https://arstechnica.com/gadgets/2018/01/heres-how-and-why-the-spectre-and-meltdown-patches-will-hurt-performance/), with [more hardware fixes planned](https://arstechnica.com/gadgets/2018/03/intel-outlines-plans-for-meltdown-and-spectre-fixes-microcode-for-older-chips/). The researchers suggest that a similar combination of solutions would be needed for BranchScope; some software can be modified to eliminate branches, and hardware could be altered to partition the speculative execution data structures on the processor so that one process could not attack another.

As with Spectre 2, it's not clear just how much software is truly vulnerable to BranchScope attacks. In both cases, attackers need the ability to run code on a victim system, so these attacks will never be used for initial entry into a system. What they do, however, is demonstrate that the isolation boundaries that have long been assumed to exist are rendered somewhat permeable by the speculative execution hardware that is essential to high-performance processors. Moreover, BranchScope shows that Spectre isn't the only avenue through which this speculative execution can be exploited.

Fundamentally, the processor contains lots of internal states (including registers, caches, branch predictor, store buffers, and more) that speculative execution can modify. The architectural state—the parts directly exposed and manipulated by the processor's published, documented instructions—is preserved properly by the speculative hardware. Attacks like Spectre and BranchScope exist because the non-architectural state—the parts that represent implementation details of the processor that may change from family to family, and which aren't directly accessible to programs—isn't being preserved fully. Speculative execution (and the non-architectural state it depends on) is designed to happen invisibly, with no indication to the running program that it's occurring.

Attacks like Spectre 2 and BranchScope are the result. It's likely to be years before researchers have determined all the various ways in which the speculative execution hardware can be used to leak information this way, and it will be longer still before robust, universal defenses are available to stop the attacks.

**Update**: in a statement, Intel says: *We have been working with these researchers and we have determined the method they describe is similar to previously known side channel exploits. We anticipate that existing software mitigations for previously known side channel exploits, such as the use of side channel resistant cryptography, will be similarly effective against the method described in this paper. We believe close partnership with the research community is one of the best ways to protect customers and their data, and we are appreciative of the work from these researchers.*

Listing image:
[Ed Dunens](https://www.flickr.com/photos/blachswan/14990404869/in/photolist-oQDK7n-qhVPZ6-7Q61Eo-7SMn2r-mAsQh-juKPyL-bxo2jz-4wmHhL-bZR4AC-7W1Rmi-aNvJzD-8KpHSp-juHXkP-5LBgEZ-juL1gh-5GPNzK-4vGC9i-7Hfjnp-bw1EVR-boG6yH-7bcMmv-zN76o-7Kw7nH-hUGJ4o-iPfiir-b6fsi8-4ztAme-dNE6ze-3iCBqs-fWBV78-s8FS3U-b4BbdM-9qo3mQ-br1YkX-aR6x4-9zC8ad-7ZBvs-5tKYBj-22KARpf-iMMZh5-6m2vxX-9eVJqF-hUGJuy-ngg5m2-E5fsyY-by6tiF-8WbAC7-r3jVxK-7v1Y6H-vDVqk)

[123 Comments](https://arstechnica.com/gadgets/2018/03/its-not-just-spectre-researchers-reveal-more-branch-prediction-attacks/#comments "123 comments")

Comments

[Forum view](https://arstechnica.com/civis/threads/it%E2%80%99s-not-just-spectre-researchers-reveal-more-branch-prediction-attacks.1426317/)

![Loading](https://arstechnica.com/wp-content/themes/ars-v9/public/images/firework-loader.75ab30.gif)
Loading comments...

[Prev story](https://arstechnica.com/science/2018/03/scientists-try-to-study-bacterial-membranes-end-up-killing-bacteria/ "Go to: Scientists try to study bacterial membranes, end up killing bacteria")

[Next story](https://arstechnica.com/cars/2018/03/uber-told-to-stop-testing-driverless-tech-in-arizona/ "Go to: Uber told to stop testing driverless tech in Arizona")

Most Read

1. [![Listing image for first story in Most Read: Florida man eats diet of butter, cheese, beef; cholesterol oozes from his body](https://cdn.arstechnica.net/wp-content/uploads/2025/01/GettyImages-486885317-768x432.jpg)](https://arstechnica.com/health/2025/01/florida-man-eats-diet-of-butter-cheese-beef-cholesterol-oozes-from-his-body/)

   1.
   [Florida man eats diet of butter, cheese, beef; cholesterol oozes from his body](https://arstechnica.com/health/2025/01/florida-man-eats-diet-of-butter-cheese-beef-cholesterol-oozes-from-his-body/)
2. 2.
   [All federal agencies ordered to terminate remote work—ideally within 30 days](https://arstechnica.com/tech-policy/2025/01/all-federal-agencies-ordered-to-terminate-remote-work-ideally-within-30-days/)
3. 3.
   [For real, we may be taking blood pressure readings all wrong](https://arstechnica.com/health/2025/01/for-real-we-may-be-taking-blood-pressure-readings-all-wrong/)
4. 4.
   [Trump’s FCC chair gets to work on punishing TV news stations accused of bias](https://arstechnica.com/tech-policy/2025/01/trumps-fcc-chair-gets-to-work-on-punishing-news-stations-accused-of-bias/)
5. 5.
   [Rocket Report: Did China’s reusable rocket work?; DOT may review SpaceX fines](https://arstechnica.com/space/2025/01/rocket-report-dot-may-review-spacex-fines-did-chinas-reusable-rocket-work/)

Customize

Ars Technica has been separating the signal from
the noise for over 25 years. With our unique combination of
technical savvy and wide-ranging interest in the technological arts
and sciences, Ars is the trusted source in a sea of information. After
all, you don’t need to know everything, only what’s important.

More
from Ars

* [About Us](https://arstechnica.com/about-us/)
* [Staff Directory](https://arstechnica.com/staff-directory/)
* [Newsletters](https://arstechnica.com/newsletters/)
* [Ars Videos](https://arstechnica.com/video/)
* [General FAQ](https://arstechnica.com/general-faq/)
* [RSS Feeds](https://arstechnica.com/rss-feeds/)

Contact

* [Contact us](https://arstechnica.com/contact-us/)
* [Advertise with us](https://www.condenast.com/brands/ars-technica)
* [Reprints](https://arstechnica.com/reprints/)

Do Not Sell My Personal
Information

© 2025 Condé Nast. All rights reserved. Use of and/or
registration on any portion of this site constitutes acceptance of our [User Agreement](https://www.condenast.com/user-agreement/) and
[Privacy Policy and
Cookie Statement](https://www.condenast.com/privacy-policy/) and [Ars
Technica Addendum](/amendment-to-conde-nast-user-agreement-privacy-policy/) and [Your
California Privacy Rights](https://www.condenast.com/privacy-policy/#california). Ars Technica may earn compensation on
sales from links on this site. [Read our
affiliate link policy](/affiliate-link-policy/). The material on this site may not be
reproduced, distributed, transmitted, cached or otherwise used, except
with the prior written permission of Condé Nast. [Ad
Choices](https://www.aboutads.info/)


