=== Content from gcc.gnu.org_6f617c2d_20250125_160330.html ===


GCC Bugzilla – Bug 85304
Segmentation fault
Last modified: 2021-03-09 08:59:23 UTC

* [Home](./)
* | [New](enter_bug.cgi?product=gcc)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=85304&GoAheadAndLogIn=1)

  Remember

  [x]
* |
  [Forgot Password](show_bug.cgi?id=85304&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 85304**](show_bug.cgi?id=85304)
- Segmentation fault

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
Segmentation fault

| | [Status](page.cgi?id=fields.html#bug_status): | UNCONFIRMED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | gcc | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=gcc "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | demangler ([show other bugs](buglist.cgi?component=demangler&product=gcc&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unknown | |  | | | [Importance](page.cgi?id=fields.html#importance): | P3 normal | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Not yet assigned to anyone | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2018-04-09 17:36 UTC by 慕冬亮 | | --- | --- | | Modified: | 2021-03-09 08:59 UTC ([History](show_activity.cgi?id=85304)) | | CC List: | 4 users (show)  matz nmahalle rrakesh2 trupti\_pardeshi | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Host:](page.cgi?id=fields.html#cf_gcchost "The machine that you are building for. That's the value you passed to ./configure --host.") |  | | [Target:](page.cgi?id=fields.html#cf_gcctarget "The machine that GCC will produce code for. That's the value you passed to ./configure --target.") |  | | [Build:](page.cgi?id=fields.html#cf_gccbuild "The machine you are building on. That's the value you passed to ./configure --build.") |  | | [Known to work:](page.cgi?id=fields.html#cf_known_to_work "Known versions for which the issue is not reproducible.") |  | | [Known to fail:](page.cgi?id=fields.html#cf_known_to_fail "Known versions for which the issue is reproducible.") |  | | [Last reconfirmed:](page.cgi?id=fields.html#cf_reconfirmed_on "Last time the issue was confirmed as still being present.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**PoC to trigger segment fault**](attachment.cgi?id=43887 "View the content of the attachment") (106 bytes, application/octet-stream)  [2018-04-09 17:36 UTC](#attach_43887 "Go to the comment associated with the attachment"), 慕冬亮 | [Details](attachment.cgi?id=43887&action=edit) | | [View All](attachment.cgi?bugid=85304&action=viewall)  [Add an attachment](attachment.cgi?bugid=85304&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=85304&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=85304#c0)  慕冬亮    2018-04-09 17:36:35 UTC  ``` Created [attachment 43887](attachment.cgi?id=43887 "PoC to trigger segment fault") [[details]](attachment.cgi?id=43887&action=edit "PoC to trigger segment fault") PoC to trigger segment fault  We found one segment fault in C++ Demangle Functions. From our simple analysis, one callq instruction exceed the range of stack region and then cxxfilt segments fault.  The triggering method is as follows:   ``` mkdir obj_test CFLAGS="-O2 -g -fstack-protector-all -fsanitize=address" ../configure --enable-shared=no --enable-static=yes make cd binutils gdb ./cxxfilt (gdb) r < poc_test ```  The corresponding Stack Trace in the gdb:  ``` Program received signal SIGSEGV, Segmentation fault. 0x00007ffff4e5931d in ?? () from /usr/lib/x86_64-linux-gnu/libasan.so.0 (gdb) info stack #0  0x00007ffff4e5931d in ?? () from /usr/lib/x86_64-linux-gnu/libasan.so.0 #1  0x00000000006a0126 in string_appendn (p=0x7fffffffe120, s=0x753f60 "(", n=1) at ./cplus-dem.c:4986 #2  0x000000000068db7d in demangle_expression (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120, tk=tk_integral) at ./cplus-dem.c:1860 #3  0x000000000068e20a in demangle_integral_value (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120) at ./cplus-dem.c:1916 #4  0x000000000068eef5 in demangle_template_value_parm (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120, tk=tk_integral) at ./cplus-dem.c:2069 #5  0x000000000068dfac in demangle_expression (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120, tk=tk_integral) at ./cplus-dem.c:1895 #6  0x000000000068e20a in demangle_integral_value (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120) at ./cplus-dem.c:1916 #7  0x000000000068eef5 in demangle_template_value_parm (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120, tk=tk_integral) at ./cplus-dem.c:2069 #8  0x000000000068dfac in demangle_expression (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120, tk=tk_integral) at ./cplus-dem.c:1895 #9  0x000000000068e20a in demangle_integral_value (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120) at ./cplus-dem.c:1916 #10 0x000000000068eef5 in demangle_template_value_parm (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120, tk=tk_integral) at ./cplus-dem.c:2069 #11 0x000000000068dfac in demangle_expression (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120, tk=tk_integral) at ./cplus-dem.c:1895 #12 0x000000000068e20a in demangle_integral_value (work=0x7fffffffe3b0, mangled=0x7fffffffe2c0,      s=0x7fffffffe120) at ./cplus-dem.c:1916 ...... ```  We will try to analyze more deeply to give a detailed report on this bug. ```  [Comment 1](show_bug.cgi?id=85304#c1)  Michael Matz    2018-04-16 12:45:54 UTC  ``` Similar to <https://sourceware.org/bugzilla/show_bug.cgi?id=23008>, the testcase contains a mangled name with roughly 29000 successive 'E' characters.  Processing one 'E' character involves calling these three routines:  5  0x00000000004e8901 in demangle_expression (work=0x7fffffffd810, mangled=0x7fffffffd710,      s=0x7fffffffd540, tk=tk_integral) at ../../libiberty/cplus-dem.c:1895 1895          success = demangle_template_value_parm (work, mangled, s, tk); (gdb)  #4  0x00000000004e98cb in demangle_template_value_parm (work=0x7fffffffd810, mangled=0x7fffffffd710,      s=0x7fffffffd540, tk=tk_integral) at ../../libiberty/cplus-dem.c:2069 2069        success = demangle_integral_value (work, mangled, s); (gdb)  #3  0x00000000004e8b82 in demangle_integral_value (work=0x7fffffffd810, mangled=0x7fffffffd710,      s=0x7fffffffd540) at ../../libiberty/cplus-dem.c:1916 1916        success = demangle_expression (work, mangled, s, tk_integral);  That advances *mangled by one character and uses 496 bytes of stack while doing that (when compiled by gcc-6 with address sanitizer).  The linux default stack of 8 MB is good for 16893 of the E characters until stack overflow occurs. Without sanitizer we need less stack per recursion level, so that the testcase doesn't cause a proplem (but just increasing the number of 'E' will make it segfault there as well).  It seems all is working as designed, you request it to demangle a recursive structure of > 20000 levels deep and get what can be expected from that, a stack overflow. ```  [Comment 2](show_bug.cgi?id=85304#c2)  Carlo B.    2018-07-05 16:58:17 UTC  ``` Hello Michael, any update for this issue? or do we have other sources to make it fixed? Thanks  Castro B. <https://alternatives.co/> ```  [Comment 3](show_bug.cgi?id=85304#c3)  Trupti Pardeshi    2020-05-20 11:35:35 UTC  ``` Hi,  May I know whether this bug is fixed? And if fixed, in which version of binutils this fix has gone?  Any heads up will be appreciated.  Thanks in advance.  Best Regards, ```  [Comment 4](show_bug.cgi?id=85304#c4)  Trupti Pardeshi    2020-07-17 11:51:01 UTC  ``` (In reply to Trupti Pardeshi from [comment #3](show_bug.cgi?id=85304#c3)) > Hi, >  > May I know whether this bug is fixed? And if fixed, in which version of > binutils this fix has gone? >  > Any heads up will be appreciated. >  > Thanks in advance. >  > Best Regards,  Can someone please answer above mentioned query? Many Thanks. ```  [Comment 5](show_bug.cgi?id=85304#c5)  Nikhil    2020-11-18 04:37:47 UTC  ``` Hi,  May I know whether this bug is fixed? And if fixed, in which version of binutils this fix has gone?  Any heads up will be appreciated.  Thanks in advance.  Best Regards, ```  [Comment 6](show_bug.cgi?id=85304#c6)  Rakesh    2021-03-08 13:11:45 UTC  ``` Hi,  Is this flaw fixed?  Thanks, Rakesh ```  [Comment 7](show_bug.cgi?id=85304#c7)  Rakesh    2021-03-09 08:59:23 UTC  ``` Hi Team,  Is binutils-2.36 affected by  this flaw?  Thanks, Rakesh ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=85304)
* - [XML](show_bug.cgi?ctype=xml&id=85304)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=85304)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?product=gcc)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=85304&GoAheadAndLogIn=1)

    Remember

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=85304&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


