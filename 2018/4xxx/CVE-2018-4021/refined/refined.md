This document provides detailed information about CVE-2018-4021.

**Root cause of vulnerability:**
The vulnerability lies in the improper sanitization of the `powerd_battery_mode` POST parameter within the `system_advanced_misc.php` file of the pfSense system. This lack of sanitization allows an attacker to inject and execute arbitrary OS commands.

**Weaknesses/vulnerabilities present:**
- **OS Command Injection (CWE-78):** The core vulnerability is that the value of the `powerd_battery_mode` POST parameter is directly used in a system command executed by `mwexec()`.
- **Lack of Input Sanitization:** The system fails to properly sanitize user-supplied input before using it in shell commands.

**Impact of exploitation:**
- **Arbitrary Command Execution:** An attacker can execute arbitrary commands on the affected system with the privileges of the web server process.
- **Full System Compromise:** Successful exploitation can lead to a complete compromise of the pfSense system.

**Attack vectors:**
- **HTTP POST Request:** The vulnerability is triggered by sending a crafted HTTP POST request to the `/system_advanced_misc.php` page.
- **`powerd_battery_mode` Parameter:** The malicious payload is injected via the `powerd_battery_mode` POST parameter.

**Required attacker capabilities/position:**
- **Authenticated Access:** The attacker needs to have valid administrative credentials to access the pfSense web interface. This access is required to send authenticated POST requests.