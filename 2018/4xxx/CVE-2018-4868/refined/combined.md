=== Content from github.com_64036967_20250125_230455.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FExiv2%2Fexiv2%2Fissues%2F202)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FExiv2%2Fexiv2%2Fissues%2F202)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=Exiv2%2Fexiv2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Exiv2](/Exiv2)
/
**[exiv2](/Exiv2/exiv2)**
Public

* [Notifications](/login?return_to=%2FExiv2%2Fexiv2) You must be signed in to change notification settings
* [Fork
  286](/login?return_to=%2FExiv2%2Fexiv2)
* [Star
   966](/login?return_to=%2FExiv2%2Fexiv2)

* [Code](/Exiv2/exiv2)
* [Issues
  148](/Exiv2/exiv2/issues)
* [Pull requests
  21](/Exiv2/exiv2/pulls)
* [Discussions](/Exiv2/exiv2/discussions)
* [Actions](/Exiv2/exiv2/actions)
* [Projects
  0](/Exiv2/exiv2/projects)
* [Wiki](/Exiv2/exiv2/wiki)
* [Security](/Exiv2/exiv2/security)
* [Insights](/Exiv2/exiv2/pulse)

Additional navigation options

* [Code](/Exiv2/exiv2)
* [Issues](/Exiv2/exiv2/issues)
* [Pull requests](/Exiv2/exiv2/pulls)
* [Discussions](/Exiv2/exiv2/discussions)
* [Actions](/Exiv2/exiv2/actions)
* [Projects](/Exiv2/exiv2/projects)
* [Wiki](/Exiv2/exiv2/wiki)
* [Security](/Exiv2/exiv2/security)
* [Insights](/Exiv2/exiv2/pulse)

# CVE-2018-4868: LargeMmapAllocator error in sanitizer\_posix.cc #202

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#207](https://github.com/Exiv2/exiv2/pull/207)Closed[CVE-2018-4868: LargeMmapAllocator error in sanitizer\_posix.cc](#top)#202[#207](https://github.com/Exiv2/exiv2/pull/207)Copy link[![@xcainiao](https://avatars.githubusercontent.com/u/18696108?u=62be4b4deba63257c17d0dc03c63659c819be378&v=4&size=80)](/xcainiao)
## Description

[![@xcainiao](https://avatars.githubusercontent.com/u/18696108?u=62be4b4deba63257c17d0dc03c63659c819be378&v=4&size=48)](/xcainiao)[xcainiao](https://github.com/xcainiao)opened [on Jan 1, 2018](https://github.com/Exiv2/exiv2/issues/202#issue-285308726)

version: exiv2 0.26 001a00 (64 bit build)

./exiv2 ./poc

### when memory not enough output this error

found by afl

```
==103308==ERROR: AddressSanitizer failed to allocate 0xff803000 (4286590976) bytes of LargeMmapAllocator (errno: 12)
==103308==Process memory map follows:
	0x000000400000-0x000000e49000	/home/fuzz/fuzz/exiv2/bin/exiv2
	0x000001049000-0x00000104a000	/home/fuzz/fuzz/exiv2/bin/exiv2
	0x00000104a000-0x00000113a000	/home/fuzz/fuzz/exiv2/bin/exiv2
	0x00000113a000-0x000001159000
	0x00007fff7000-0x00008fff7000
	0x00008fff7000-0x02008fff7000
	0x02008fff7000-0x10007fff8000
	0x600000000000-0x602000000000
	0x602000000000-0x602000010000
	0x602000010000-0x603000000000
	0x603000000000-0x603000010000
	0x603000010000-0x604000000000
	0x604000000000-0x604000010000
	0x604000010000-0x606000000000
	0x606000000000-0x606000010000
	0x606000010000-0x607000000000
	0x607000000000-0x607000010000
	0x607000010000-0x608000000000
	0x608000000000-0x608000010000
	0x608000010000-0x60b000000000
	0x60b000000000-0x60b000010000
	0x60b000010000-0x60c000000000
	0x60c000000000-0x60c000010000
	0x60c000010000-0x60f000000000
	0x60f000000000-0x60f000010000
	0x60f000010000-0x610000000000
	0x610000000000-0x610000010000
	0x610000010000-0x611000000000
	0x611000000000-0x611000010000
	0x611000010000-0x612000000000
	0x612000000000-0x612000010000
	0x612000010000-0x614000000000
	0x614000000000-0x614000020000
	0x614000020000-0x616000000000
	0x616000000000-0x616000020000
	0x616000020000-0x618000000000
	0x618000000000-0x618000020000
	0x618000020000-0x619000000000
	0x619000000000-0x619000020000
	0x619000020000-0x621000000000
	0x621000000000-0x621000020000
	0x621000020000-0x624000000000
	0x624000000000-0x624000020000
	0x624000020000-0x631000000000
	0x631000000000-0x631000030000
	0x631000030000-0x640000000000
	0x640000000000-0x640000003000
	0x7f08fb328000-0x7f08fb600000	/usr/lib/locale/locale-archive
	0x7f08fb600000-0x7f08fb700000
	0x7f08fb800000-0x7f08fb900000
	0x7f08fb9aa000-0x7f08fdcfc000
	0x7f08fdcfc000-0x7f08fdcff000	/lib/x86_64-linux-gnu/libdl-2.23.so
	0x7f08fdcff000-0x7f08fdefe000	/lib/x86_64-linux-gnu/libdl-2.23.so
	0x7f08fdefe000-0x7f08fdeff000	/lib/x86_64-linux-gnu/libdl-2.23.so
	0x7f08fdeff000-0x7f08fdf00000	/lib/x86_64-linux-gnu/libdl-2.23.so
	0x7f08fdf00000-0x7f08fe0c0000	/lib/x86_64-linux-gnu/libc-2.23.so
	0x7f08fe0c0000-0x7f08fe2c0000	/lib/x86_64-linux-gnu/libc-2.23.so
	0x7f08fe2c0000-0x7f08fe2c4000	/lib/x86_64-linux-gnu/libc-2.23.so
	0x7f08fe2c4000-0x7f08fe2c6000	/lib/x86_64-linux-gnu/libc-2.23.so
	0x7f08fe2c6000-0x7f08fe2ca000
	0x7f08fe2ca000-0x7f08fe2e0000	/lib/x86_64-linux-gnu/libgcc_s.so.1
	0x7f08fe2e0000-0x7f08fe4df000	/lib/x86_64-linux-gnu/libgcc_s.so.1
	0x7f08fe4df000-0x7f08fe4e0000	/lib/x86_64-linux-gnu/libgcc_s.so.1
	0x7f08fe4e0000-0x7f08fe5e8000	/lib/x86_64-linux-gnu/libm-2.23.so
	0x7f08fe5e8000-0x7f08fe7e7000	/lib/x86_64-linux-gnu/libm-2.23.so
	0x7f08fe7e7000-0x7f08fe7e8000	/lib/x86_64-linux-gnu/libm-2.23.so
	0x7f08fe7e8000-0x7f08fe7e9000	/lib/x86_64-linux-gnu/libm-2.23.so
	0x7f08fe7e9000-0x7f08fe95b000	/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
	0x7f08fe95b000-0x7f08feb5b000	/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
	0x7f08feb5b000-0x7f08feb65000	/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
	0x7f08feb65000-0x7f08feb67000	/usr/lib/x86_64-linux-gnu/libstdc++.so.6.0.21
	0x7f08feb67000-0x7f08feb6b000
	0x7f08feb6b000-0x7f08feb83000	/lib/x86_64-linux-gnu/libpthread-2.23.so
	0x7f08feb83000-0x7f08fed82000	/lib/x86_64-linux-gnu/libpthread-2.23.so
	0x7f08fed82000-0x7f08fed83000	/lib/x86_64-linux-gnu/libpthread-2.23.so
	0x7f08fed83000-0x7f08fed84000	/lib/x86_64-linux-gnu/libpthread-2.23.so
	0x7f08fed84000-0x7f08fed88000
	0x7f08fed88000-0x7f08fedae000	/lib/x86_64-linux-gnu/libexpat.so.1.6.0
	0x7f08fedae000-0x7f08fefae000	/lib/x86_64-linux-gnu/libexpat.so.1.6.0
	0x7f08fefae000-0x7f08fefb0000	/lib/x86_64-linux-gnu/libexpat.so.1.6.0
	0x7f08fefb0000-0x7f08fefb1000	/lib/x86_64-linux-gnu/libexpat.so.1.6.0
	0x7f08fefb1000-0x7f08fefca000	/lib/x86_64-linux-gnu/libz.so.1.2.8
	0x7f08fefca000-0x7f08ff1c9000	/lib/x86_64-linux-gnu/libz.so.1.2.8
	0x7f08ff1c9000-0x7f08ff1ca000	/lib/x86_64-linux-gnu/libz.so.1.2.8
	0x7f08ff1ca000-0x7f08ff1cb000	/lib/x86_64-linux-gnu/libz.so.1.2.8
	0x7f08ff1cb000-0x7f08ff2bf000	/usr/lib/x86_64-linux-gnu/libasan.so.2.0.0
	0x7f08ff2bf000-0x7f08ff4bf000	/usr/lib/x86_64-linux-gnu/libasan.so.2.0.0
	0x7f08ff4bf000-0x7f08ff4c2000	/usr/lib/x86_64-linux-gnu/libasan.so.2.0.0
	0x7f08ff4c2000-0x7f08ff4c3000	/usr/lib/x86_64-linux-gnu/libasan.so.2.0.0
	0x7f08ff4c3000-0x7f0900138000
	0x7f0900138000-0x7f090015e000	/lib/x86_64-linux-gnu/ld-2.23.so
	0x7f09002c3000-0x7f0900352000
	0x7f0900352000-0x7f090035d000
	0x7f090035d000-0x7f090035e000	/lib/x86_64-linux-gnu/ld-2.23.so
	0x7f090035e000-0x7f090035f000	/lib/x86_64-linux-gnu/ld-2.23.so
	0x7f090035f000-0x7f0900360000
	0x7ffd1d376000-0x7ffd1d397000	[stack]
	0x7ffd1d3a9000-0x7ffd1d3ab000	[vvar]
	0x7ffd1d3ab000-0x7ffd1d3ad000	[vdso]
	0xffffffffff600000-0xffffffffff601000	[vsyscall]
==103308==End of process memory map.
==103308==AddressSanitizer CHECK failed: ../../../../src/libsanitizer/sanitizer_common/sanitizer_posix.cc:121 "(("unable to mmap" && 0)) != (0)" (0x0, 0x0)
    #0 0x7f08ff26b631  (/usr/lib/x86_64-linux-gnu/libasan.so.2+0xa0631)
    #1 0x7f08ff270613 in __sanitizer::CheckFailed(char const*, int, char const*, unsigned long long, unsigned long long) (/usr/lib/x86_64-linux-gnu/libasan.so.2+0xa5613)
    #2 0x7f08ff278641  (/usr/lib/x86_64-linux-gnu/libasan.so.2+0xad641)
    #3 0x7f08ff1edc0c  (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x22c0c)
    #4 0x7f08ff26467e in operator new[](unsigned long) (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x9967e)
    #5 0x67831a in Exiv2::DataBuf::DataBuf(long) ../include/exiv2/types.hpp:206
    #6 0x67831a in Exiv2::Jp2Image::readMetadata() /home/fuzz/fuzz/exiv2/src/jp2image.cpp:271
    #7 0x4f572c in Action::Print::printSummary() /home/fuzz/fuzz/exiv2/src/actions.cpp:296
    #8 0x4f9dc7 in Action::Print::run(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) /home/fuzz/fuzz/exiv2/src/actions.cpp:242
    #9 0x40a18c in main /home/fuzz/fuzz/exiv2/src/exiv2.cpp:166
    #10 0x7f08fdf2082f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)
    #11 0x490c38 in _start (/home/fuzz/fuzz/exiv2/bin/exiv2+0x490c38)

```

testcase: <https://github.com/xcainiao/poc/blob/master/exiv2-memorymmap-error>

found : topsecLab

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2f694bc0_20250126_123942.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FExiv2%2Fexiv2%2Fpull%2F207)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FExiv2%2Fexiv2%2Fpull%2F207)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=Exiv2%2Fexiv2)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Exiv2](/Exiv2)
/
**[exiv2](/Exiv2/exiv2)**
Public

* [Notifications](/login?return_to=%2FExiv2%2Fexiv2) You must be signed in to change notification settings
* [Fork
  285](/login?return_to=%2FExiv2%2Fexiv2)
* [Star
   966](/login?return_to=%2FExiv2%2Fexiv2)

* [Code](/Exiv2/exiv2)
* [Issues
  148](/Exiv2/exiv2/issues)
* [Pull requests
  21](/Exiv2/exiv2/pulls)
* [Discussions](/Exiv2/exiv2/discussions)
* [Actions](/Exiv2/exiv2/actions)
* [Projects
  0](/Exiv2/exiv2/projects)
* [Wiki](/Exiv2/exiv2/wiki)
* [Security](/Exiv2/exiv2/security)
* [Insights](/Exiv2/exiv2/pulse)

Additional navigation options

* [Code](/Exiv2/exiv2)
* [Issues](/Exiv2/exiv2/issues)
* [Pull requests](/Exiv2/exiv2/pulls)
* [Discussions](/Exiv2/exiv2/discussions)
* [Actions](/Exiv2/exiv2/actions)
* [Projects](/Exiv2/exiv2/projects)
* [Wiki](/Exiv2/exiv2/wiki)
* [Security](/Exiv2/exiv2/security)
* [Insights](/Exiv2/exiv2/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FExiv2%2Fexiv2%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FExiv2%2Fexiv2%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix CVE-2018-4868 #207

 Merged

[D4N](/D4N)
merged 2 commits into
[Exiv2:master](/Exiv2/exiv2/tree/master "Exiv2/exiv2:master")
from
[D4N:fix\_cve\_2018\_4868](/D4N/exiv2/tree/fix_cve_2018_4868 "D4N/exiv2:fix_cve_2018_4868")

Feb 1, 2018

 Merged

# [Fix CVE-2018-4868](#top) #207

[D4N](/D4N)
merged 2 commits into
[Exiv2:master](/Exiv2/exiv2/tree/master "Exiv2/exiv2:master")
from
[D4N:fix\_cve\_2018\_4868](/D4N/exiv2/tree/fix_cve_2018_4868 "D4N/exiv2:fix_cve_2018_4868")

Feb 1, 2018

[Conversation
10](/Exiv2/exiv2/pull/207)
[Commits
2](/Exiv2/exiv2/pull/207/commits)
[Checks
0](/Exiv2/exiv2/pull/207/checks)
[Files changed](/Exiv2/exiv2/pull/207/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![D4N](https://avatars.githubusercontent.com/u/786021?s=60&v=4)](/D4N)

Copy link

Member

### @D4N **[D4N](/D4N)** commented [Jan 9, 2018](#issue-287225766)

When parsing a subBox that is a ColorHeader, a length is extracted from the input file and fed directly into DataBuf() (which calls malloc). A crafted input file can provide arbitrarily (up to max(uint32\_t)-8) large values and result in excessive memory allocation.

This PR adds a check for the new size of DataBuf so that it is not larger than the remaining size of the file. The reproducer is also added to the test suite.

This fixes [#202](https://github.com/Exiv2/exiv2/issues/202) aka [CVE-2018-4868](https://github.com/advisories/GHSA-8x93-7gj9-73c3 "CVE-2018-4868").

Sorry, something went wrong.

All reactions

 [![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)
[D4N](/D4N)
[force-pushed](/Exiv2/exiv2/compare/8f6f69730a0c17e5622455dbf13738ead3bb0392..2d183e4cf2547519922057e0c4747d3a59e4a96c)
the
fix\_cve\_2018\_4868

branch
from
[`8f6f697`](/Exiv2/exiv2/commit/8f6f69730a0c17e5622455dbf13738ead3bb0392) to
[`2d183e4`](/Exiv2/exiv2/commit/2d183e4cf2547519922057e0c4747d3a59e4a96c)  [Compare](/Exiv2/exiv2/compare/8f6f69730a0c17e5622455dbf13738ead3bb0392..2d183e4cf2547519922057e0c4747d3a59e4a96c)
[January 13, 2018 20:34](#event-1423098367)

 [![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)
[D4N](/D4N)
requested review from
[piponazo](/piponazo),
[clanmills](/clanmills) and
[Kicer86](/Kicer86)
[January 13, 2018 20:34](#event-1423098490)

 [![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)
[D4N](/D4N)
[force-pushed](/Exiv2/exiv2/compare/2d183e4cf2547519922057e0c4747d3a59e4a96c..bf615daaa6d5fabc917c63f9281ff4591584cd85)
the
fix\_cve\_2018\_4868

branch
from
[`2d183e4`](/Exiv2/exiv2/commit/2d183e4cf2547519922057e0c4747d3a59e4a96c) to
[`bf615da`](/Exiv2/exiv2/commit/bf615daaa6d5fabc917c63f9281ff4591584cd85)  [Compare](/Exiv2/exiv2/compare/2d183e4cf2547519922057e0c4747d3a59e4a96c..bf615daaa6d5fabc917c63f9281ff4591584cd85)
[January 27, 2018 21:29](#event-1444969868)

[![clanmills](https://avatars.githubusercontent.com/u/529982?s=60&v=4)](/clanmills)

**[clanmills](/clanmills)**
approved these changes
[Feb 1, 2018](#pullrequestreview-93351412)

 [View reviewed changes](/Exiv2/exiv2/pull/207/files)

Copy link

Collaborator

### @clanmills **[clanmills](/clanmills)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This looks good to me, Dan. I've "updated the branch" and when it passes appveyor/travis I will merge this to master. Thanks for working on this.

Sorry, something went wrong.

All reactions

 [D4N](/D4N)
added 2 commits
[February 1, 2018 17:55](#commits-pushed-fcb4257)

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)

`[Add check for DataBuf.size_ in Jp2Image::readMetadata()](/Exiv2/exiv2/pull/207/commits/fcb42570519f8cf924b0302b09062a60aa565fbe "Add check for DataBuf.size_ in Jp2Image::readMetadata()

When parsing a subBox that is a ColorHeader, a length is extracted
from the input file and fed directly into DataBuf() (which calls
malloc). A crafted input file can provide arbitrarily (up to
max(uint32_t)-8) large values and result in excessive memory
allocation.

This commit adds a check for the new size of DataBuf so that it is not
larger than the remaining size of the file.

This fixes #202 aka CVE-2018-4868")`
 …

`[fcb4257](/Exiv2/exiv2/pull/207/commits/fcb42570519f8cf924b0302b09062a60aa565fbe)`

```
When parsing a subBox that is a ColorHeader, a length is extracted
from the input file and fed directly into DataBuf() (which calls
malloc). A crafted input file can provide arbitrarily (up to
max(uint32_t)-8) large values and result in excessive memory
allocation.

This commit adds a check for the new size of DataBuf so that it is not
larger than the remaining size of the file.

This fixes [Exiv2#202](https://github.com/Exiv2/exiv2/issues/202) aka [CVE-2018-4868](https://github.com/advisories/GHSA-8x93-7gj9-73c3 "CVE-2018-4868")
```

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)

`[Added reproducer for](/Exiv2/exiv2/pull/207/commits/72de0f96f35d05ba68b28f4fa82f51a1df2778ca "Added reproducer for CVE-2018-4868 to the test suite") [CVE-2018-4868](https://github.com/advisories/GHSA-8x93-7gj9-73c3 "CVE-2018-4868") [to the test suite](/Exiv2/exiv2/pull/207/commits/72de0f96f35d05ba68b28f4fa82f51a1df2778ca "Added reproducer for CVE-2018-4868 to the test suite")`

`[72de0f9](/Exiv2/exiv2/pull/207/commits/72de0f96f35d05ba68b28f4fa82f51a1df2778ca)`

 [![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)
[D4N](/D4N)
[force-pushed](/Exiv2/exiv2/compare/651a0d575ce8616f161e7e8241caa7327f3dc3e4..72de0f96f35d05ba68b28f4fa82f51a1df2778ca)
the
fix\_cve\_2018\_4868

branch
from
[`651a0d5`](/Exiv2/exiv2/commit/651a0d575ce8616f161e7e8241caa7327f3dc3e4) to
[`72de0f9`](/Exiv2/exiv2/commit/72de0f96f35d05ba68b28f4fa82f51a1df2778ca)  [Compare](/Exiv2/exiv2/compare/651a0d575ce8616f161e7e8241caa7327f3dc3e4..72de0f96f35d05ba68b28f4fa82f51a1df2778ca)
[February 1, 2018 16:56](#event-1453416073)

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=80&v=4)](/D4N)

Copy link

Member

Author

### **[D4N](/D4N)** commented [Feb 1, 2018](#issuecomment-362332754)

| Please do not use the update branch button, it results in an extremely messy history when a PR exits for a longer time (especially if you press the button multiple times). It is harder to cherry-pick commits in a non-linear history and is a burden for package maintainers who have to backport patches.  The contribution guide mentions that we should instead rebase the changes on top of master before merging them, that way the commit history stays linear. I have just done that & we can merge this once travis is green again. |
| --- |

All reactions

Sorry, something went wrong.

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=80&v=4)](/D4N)

Copy link

Member

Author

### **[D4N](/D4N)** commented [Feb 1, 2018](#issuecomment-362334800)

| Sorry if I sounded a little harsh, I was typing that in a hurry.  Thanks for your review :) |
| --- |

All reactions

Sorry, something went wrong.

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)
[D4N](/D4N)
merged commit [`9cddfa5`](/Exiv2/exiv2/commit/9cddfa514d4fddf7a5f93be74dae2e93d9722204)
into
Exiv2:master

[Feb 1, 2018](https://github.com/Exiv2/exiv2/pull/207#event-1453444878)

 [![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)
[D4N](/D4N)
deleted the
fix\_cve\_2018\_4868

branch
[February 1, 2018 17:08](#event-1453445391)

[![@clanmills](https://avatars.githubusercontent.com/u/529982?s=80&v=4)](/clanmills)

Copy link

Collaborator

### **[clanmills](/clanmills)** commented [Feb 1, 2018](#issuecomment-362337602)

| So many hidden rules in GitHub. Well they might be in a documentation, however I can't understand the documentation! We'll get there with many things. You'll see.  Incidentally, I will do everything that I can to avoid changing test/data/bugfixes-test.out and going to run `$ cd tests ; python3 runner.py` from test/Makefile. I don't think we need to rewrite test/bugfixes-test.out at the moment. For new tests, I'll try to add them to the "new" test harness. If I'm unable to do that, I'll add a simple bash script for the moment on a case-by-case basis. For sure, I don't know how to test [#223](https://github.com/Exiv2/exiv2/pull/223) using the new test harness and that's what I'd like to discuss with you 1-to-1. |
| --- |

All reactions

Sorry, something went wrong.

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=80&v=4)](/D4N)

Copy link

Member

Author

### **[D4N](/D4N)** commented [Feb 2, 2018](#issuecomment-362726585)

| The rebase stuff is our "rule" and not from github, it's point `5.` in [CONTRIBUTING.md](https://github.com/Exiv2/exiv2/blob/master/CONTRIBUTING.md) |
| --- |

All reactions

Sorry, something went wrong.

[![@clanmills](https://avatars.githubusercontent.com/u/529982?s=80&v=4)](/clanmills)

Copy link

Collaborator

### **[clanmills](/clanmills)** commented [Feb 3, 2018](#issuecomment-362834442)

| Dan: I've written my test for [#223](https://github.com/Exiv2/exiv2/pull/223) in bash and it fetches binary images using curl from the buildserver.  Sure, I want to write it using your python test harness. I tried to do this during the week and didn't know how to get the job done. Of course, I can read all your python code and figure it out - however I would prefer to discuss it with you 1-to-1. Or, if you prefer, I can document my puzzles and you can answer them for me. Here's the current version of my bash script:  ``` #!/bin/bash  source ./functions.source cd "$testdir"  mkdir -p reference this=$(basename $0) reference=reference output=$this.out  ## # Reference output cat > $reference/$output <<END_OF_FILE Exif.Fujifilm.Color                          Short       1  Monochrome Exif.Fujifilm.Color                          Short       1  Sepia Exif.Fujifilm.Color                          Short       1  Monochrome+G Filter Exif.Fujifilm.Color                          Short       1  Monochrome+R Filter Exif.Fujifilm.Color                          Short       1  Monochrome+Ye Filter END_OF_FILE  ## # run the tests rm -rf $output for testfile in 223-Monochrome.jpg 223-Sepia.jpg \                 223-Monochrome+G.jpg 223-Monochrome+R.jpg 223-Monochrome+Y.jpg ; do 	if [ ! -e $reference/$testfile ]; then ( 	   cd   $reference 	   curl --silent -O http://exiv2.dyndns.org:8080/userContent/testfiles/223/$testfile 	) fi 	runTest exiv2 -pa --grep Fujifilm.Color $reference/$testfile >>$output done  ## # report result cat $output | tr -d $'\r' > $output.stripped mv  $output.stripped $output echo -n "$this " ; reportTest   $output $reference/$output  # That's all Folks! ##  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=80&v=4)](/D4N)

Copy link

Member

Author

### **[D4N](/D4N)** commented [Feb 4, 2018](#issuecomment-362945704) via email

| I think we really shouldn't be pulling in data over the internet during tests, as that makes the tests depend on a functioning internet connection or silently fail. Imho we should consider Luis' suggestion from a few weeks ago to create a new repository for testfiles for exiv2 that manages them via git lfs. You'll essentially get the same, the files are stored on a webserver and do not blow up the repo size, but it all still looks like git. We could then embed that repository via a git submodule. Concerning your actual problem, this will involve some additional work, as the test suite was not intended to download files. Could you take a look at tests/doc.md? That should cover everything that the test suite can do. This would be especially helpful for me, as I could find out where the documentation is lacking & improve it. I'll take a look how to pull in the test files, shouldn't be that hard with Python's urllib. Robin Mills <notifications@github.com> writes: …  Dan: I've written my test for [#223](https://github.com/Exiv2/exiv2/pull/223) in bash and it fetches binary images using curl from the buildserver. Sure, I want to write it using your python test harness. I tried to do this during the week and didn't know how to get the job done. Of course, I can read all your python code and figure it out - however I would prefer to discuss it with you 1-to-1. Or, if you prefer, I can document my puzzles and you can answer them for me. Here's the current version of my bash script: ``` #!/bin/bash source ./functions.source cd "$testdir" mkdir -p reference this=$(basename $0) reference=reference output=$this.out ## # Reference output cat > $reference/$output <<END\_OF\_FILE Exif.Fujifilm.Color Short 1 Monochrome Exif.Fujifilm.Color Short 1 Sepia Exif.Fujifilm.Color Short 1 Monochrome+G Filter Exif.Fujifilm.Color Short 1 Monochrome+R Filter Exif.Fujifilm.Color Short 1 Monochrome+Ye Filter END\_OF\_FILE ## # run the tests rm -rf $output for testfile in 223-Monochrome.jpg 223-Sepia.jpg \ 223-Monochrome+G.jpg 223-Monochrome+R.jpg 223-Monochrome+Y.jpg ; do if [ ! -e $reference/$testfile ]; then ( cd $reference curl --silent -O [http://exiv2.dyndns.org:8080/userContent/testfiles/223/$testfile](http://exiv2.dyndns.org:8080/userContent/testfiles/223/%24testfile) ) fi runTest exiv2 -pa --grep Fujifilm.Color $reference/$testfile >>$output done ## # report result cat $output | tr -d $'\r' > $output.stripped mv $output.stripped $output echo -n "$this " ; reportTest $output $reference/$output # That's all Folks! ## ``` -- You are receiving this because you modified the open/close state. Reply to this email directly or view it on GitHub: [#207 (comment)](https://github.com/Exiv2/exiv2/pull/207#issuecomment-362834442) |
| --- |

All reactions

Sorry, something went wrong.

[![@clanmills](https://avatars.githubusercontent.com/u/529982?s=80&v=4)](/clanmills)

Copy link

Collaborator

### **[clanmills](/clanmills)** commented [Feb 5, 2018](#issuecomment-362993388)

| Thanks, Dan. I used svn to store test files for video and eps. Git? Sure, why not. Because of my lack of skill with git, you'll understand why I haven't adopted that solution in this script.  However both the "new" test harness and my efforts here use the concept of storing the "reference output" in the script and not in an external monolith such as test/data/bugfixes-test.out.  The puzzle isn't how to get the file (with curl/svn/git/urllib), the puzzle is that I haven't discovered how to run the test on multiple files and how to represent the "reference output". For me, another important object is to be able to run a single script (rather than a collection such as test/bugfixes-text.sh).  So, we are in strong agreement about the direction and I'm asking for a little assistance to get onto our agreed/chosen road. |
| --- |

All reactions

Sorry, something went wrong.

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=80&v=4)](/D4N)

Copy link

Member

Author

### **[D4N](/D4N)** commented [Feb 5, 2018](#issuecomment-363012929) via email

| Robin Mills <notifications@github.com> writes:  Thanks, Dan. I used svn to store test files for video and eps. Git? Sure, why not. Because of my lack of skill with git, you'll understand why I haven't adopted that solution in this script.  Sure, no problem. Creating another repository for that is also a little bit more work. I'll put this on my todo list.  However both the "new" test harness and my efforts here use the concept of storing the "reference output" in the script and not in an external monolith such as test/data/bugfixes-test.out. The puzzle isn't how to get the file (with curl/svn/git/urllib), the puzzle is that I haven't discovered how to run the test on multiple files and how to represent the "reference output". For me, another important object is to be able to run a single script (rather than a collection such as test/bugfixes-text.sh).  Take a look at tests/bugfixes/github/test\_issue\_20.py To run exiv2 multiple times, you just have provide the test suite with a list of commands to run (and of course a list of stdout, stderr and return values). To download your files, you have to write a custom setUp() function (that is the standard pre-test function in python's unittest framework) and a tearDown() that will delete them again. But this might be a little tricky for the start, so we can discuss that on slack. …  So, we are in strong agreement about the direction and I'm asking for a little assistance to get onto our agreed/chosen road. -- You are receiving this because you modified the open/close state. Reply to this email directly or view it on GitHub: [#207 (comment)](https://github.com/Exiv2/exiv2/pull/207#issuecomment-362993388) |
| --- |

All reactions

Sorry, something went wrong.

[![@clanmills](https://avatars.githubusercontent.com/u/529982?s=80&v=4)](/clanmills)

Copy link

Collaborator

### **[clanmills](/clanmills)** commented [Feb 5, 2018](#issuecomment-363016638)

| Thanks for those pointers.  It's a dry cold frosty sunny morning (1℃) in England so I'm going out to run and will investigate your suggestions after lunch. I don't want to delete downloaded test images as they will never change. It's the script (and reference output) that may change and will be checked in with the code.  I hope things are good with you at work. Thank You for all the effort you are putting into Exiv2. |
| --- |

All reactions

Sorry, something went wrong.

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=40&v=4)](/D4N)
[D4N](/D4N)
mentioned this pull request
[Mar 21, 2018](#ref-issue-290051046)

[Vulnerability Roundup 33 (master)
NixOS/nixpkgs#34054](/NixOS/nixpkgs/issues/34054)

Closed

2 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FExiv2%2Fexiv2%2Fpull%2F207)

Reviewers

[![@clanmills](https://avatars.githubusercontent.com/u/529982?s=40&v=4)](/clanmills) [clanmills](/clanmills)

clanmills approved these changes

[![@piponazo](https://avatars.githubusercontent.com/u/102645?s=40&v=4)](/piponazo) [piponazo](/piponazo)

 Awaiting requested review from piponazo

[![@Kicer86](https://avatars.githubusercontent.com/u/8647228?s=40&v=4)](/Kicer86) [Kicer86](/Kicer86)

 Awaiting requested review from Kicer86

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [CVE-2018-4868: LargeMmapAllocator error in sanitizer\_posix.cc](https://github.com/Exiv2/exiv2/issues/202)

2 participants

[![@D4N](https://avatars.githubusercontent.com/u/786021?s=52&v=4)](/D4N) [![@clanmills](https://avatars.githubusercontent.com/u/529982?s=52&v=4)](/clanmills)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


