=== Content from bitcoincore.org_8efe171e_20250125_062016.html ===


[![bitcoin core logo](/assets/images/bitcoin_core_logo_colored_reversed.png)](/)

* [About](/en/about/)
* [Download](/en/download)
* [blog](/en/blog/)
* [releases](/en/releases/)
* Development
  + [contribute](/en/contribute/)
  + [contributing code](/en/faq/contributing-code/)
  + [meetings](/en/meetings/)
  + [Lifecycle](/en/lifecycle)
  + [Security Advisories](/en/security-advisories/)
  + [RPC Docs](/en/doc/)
    - [28.0.0](/en/doc/28.0.0/)
    - [27.0.0](/en/doc/27.0.0/)
    - [26.0.0](/en/doc/26.0.0/)
    - [25.0.0](/en/doc/25.0.0/)
    - [24.0.0](/en/doc/24.0.0/)
    - [23.0.0](/en/doc/23.0.0/)
    - [22.0.0](/en/doc/22.0.0/)
    - [0.21.0](/en/doc/0.21.0/)
    - [0.20.0](/en/doc/0.20.0/)
    - [0.19.0](/en/doc/0.19.0/)
    - [0.18.0](/en/doc/0.18.0/)
    - [0.17.0](/en/doc/0.17.0/)
    - [0.16.3](/en/doc/0.16.3/)
    - [0.16.2](/en/doc/0.16.2/)
    - [0.16.1](/en/doc/0.16.1/)
    - [0.16.0](/en/doc/0.16.0/)
* Contact
  + [Contact Us](/en/contact/)
  + [Announcements](/en/list/announcements/join/)
  + [Twitter impersonation](/en/twitter-impersonation)
* English
  æ¥æ¬èª

# [Bitcoin Core 0.16.3 Released](/en/2018/09/18/release-0.16.3/ "Bitcoin Core 0.16.3 Released")

by .

Bitcoin Core version 0.16.3 is now available for [download](/en/download) with a fix for a denial-of-service vulnerability introduced in
Bitcoin Core 0.14.0 and affecting all subsequent versions though to
0.16.2. We highly recommend users of all affected versions immediately
upgrade to 0.16.3.

Security issue [CVE-2018-17144](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-17144): it was discovered that older versions of Bitcoin Core
will crash if they try to process a block containing a transaction that
attempts to spend the same input twice. Such blocks are invalid, so
they can only be created by a miner willing to sacrifice their allowed
income for creating a block of at least 12.5 BTC (about $80,000 USD as
of this writing). This release eliminates the crash, allowing the
software to quietly reject such invalid blocks.

For a complete list of changes, please see the [release notes](/en/releases/0.16.3/). If
have any questions, please stop by our [IRC chatroom](https://en.bitcoin.it/wiki/IRC_channels) and weâll do
our best to help you.

---

**Bitcoin Core 0.16.3 Released**
was published on
September 18, 2018

.

#### Recommended ([View all posts](/en/blog/))

* [Bitcoin Core 28.1 released](/en/2025/01/09/release-28.1/ "Bitcoin Core 28.1 released")
* [Bitcoin Core 27.2 released](/en/2024/11/04/release-27.2/ "Bitcoin Core 27.2 released")

---

[Twitter](https://twitter.com/bitcoincoreorg)

[Legal](/en/legal/) | [Privacy Policy](/en/legal/privacy) | [RSS ![rss feeds](/assets/images/rss-24x24.png)](/en/rss/)

![bitcoin core logo](/assets/images/bitcoin_core_logo.png)

© 2025 Bitcoin Core



=== Content from github.com_2095d7f4_20250125_062020.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbitcoin%2Fbitcoin%2Fblob%2Fv0.16.3%2Fdoc%2Frelease-notes.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbitcoin%2Fbitcoin%2Fblob%2Fv0.16.3%2Fdoc%2Frelease-notes.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=bitcoin%2Fbitcoin)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bitcoin](/bitcoin)
/
**[bitcoin](/bitcoin/bitcoin)**
Public

* [Notifications](/login?return_to=%2Fbitcoin%2Fbitcoin) You must be signed in to change notification settings
* [Fork
  36.6k](/login?return_to=%2Fbitcoin%2Fbitcoin)
* [Star
   81.6k](/login?return_to=%2Fbitcoin%2Fbitcoin)

* [Code](/bitcoin/bitcoin/tree/v0.16.3)
* [Issues
  382](/bitcoin/bitcoin/issues)
* [Pull requests
  306](/bitcoin/bitcoin/pulls)
* [Actions](/bitcoin/bitcoin/actions)
* [Projects
  5](/bitcoin/bitcoin/projects)
* [Security](/bitcoin/bitcoin/security)
* [Insights](/bitcoin/bitcoin/pulse)

Additional navigation options

* [Code](/bitcoin/bitcoin/tree/v0.16.3)
* [Issues](/bitcoin/bitcoin/issues)
* [Pull requests](/bitcoin/bitcoin/pulls)
* [Actions](/bitcoin/bitcoin/actions)
* [Projects](/bitcoin/bitcoin/projects)
* [Security](/bitcoin/bitcoin/security)
* [Insights](/bitcoin/bitcoin/pulse)

## Files

 v0.16.3
## Breadcrumbs

1. [bitcoin](/bitcoin/bitcoin/tree/v0.16.3)
2. /[doc](/bitcoin/bitcoin/tree/v0.16.3/doc)
/
# release-notes.md

Copy path Blame  Blame
## Latest commit

## History

[History](/bitcoin/bitcoin/commits/v0.16.3/doc/release-notes.md)90 lines (61 loc) · 2.92 KB v0.16.3
## Breadcrumbs

1. [bitcoin](/bitcoin/bitcoin/tree/v0.16.3)
2. /[doc](/bitcoin/bitcoin/tree/v0.16.3/doc)
/
# release-notes.md

Top
## File metadata and controls

* Preview
* Code
* Blame

90 lines (61 loc) · 2.92 KB[Raw](https://github.com/bitcoin/bitcoin/raw/refs/tags/v0.16.3/doc/release-notes.md)

Bitcoin Core version 0.16.3 is now available from:

<https://bitcoincore.org/bin/bitcoin-core-0.16.3/>

This is a new minor version release, with various bugfixes
as well as updated translations.

Please report bugs using the issue tracker at GitHub:

<https://github.com/bitcoin/bitcoin/issues>

To receive security and update notifications, please subscribe to:

<https://bitcoincore.org/en/list/announcements/join/>

# How to Upgrade

If you are running an older version, shut it down. Wait until it has completely
shut down (which might take a few minutes for older versions), then run the
installer (on Windows) or just copy over `/Applications/Bitcoin-Qt` (on Mac)
or `bitcoind`/`bitcoin-qt` (on Linux).

The first time you run version 0.15.0 or newer, your chainstate database will be converted to a
new format, which will take anywhere from a few minutes to half an hour,
depending on the speed of your machine.

Note that the block database format also changed in version 0.8.0 and there is no
automatic upgrade code from before version 0.8 to version 0.15.0 or higher. Upgrading
directly from 0.7.x and earlier without re-downloading the blockchain is not supported.
However, as usual, old wallet versions are still supported.

## Downgrading warning

Wallets created in 0.16 and later are not compatible with versions prior to 0.16
and will not work if you try to use newly created wallets in older versions. Existing
wallets that were created with older versions are not affected by this.

# Compatibility

Bitcoin Core is extensively tested on multiple operating systems using
the Linux kernel, macOS 10.8+, and Windows Vista and later. Windows XP is not supported.

Bitcoin Core should also work on most other Unix-like systems but is not
frequently tested on them.

# Notable changes

## Denial-of-Service vulnerability

A denial-of-service vulnerability exploitable by miners has been discovered in
Bitcoin Core versions 0.14.0 up to 0.16.2. It is recommended to upgrade any of
the vulnerable versions to 0.16.3 as soon as possible.

## 0.16.3 change log

### Consensus

* #14249 `696b936` Fix crash bug with duplicate inputs within a transaction (TheBlueMatt, sdaftuar)

### RPC and other APIs

* #13547 `212ef1f` Make `signrawtransaction*` give an error when amount is needed but missing (ajtowns)

### Miscellaneous

* #13655 `1cdbea7` bitcoinconsensus: invalid flags error should be set to `bitcoinconsensus_err` (afk11)

### Documentation

* #13844 `11b9dbb` correct the help output for -prune (hebasto)

# Credits

Thanks to everyone who directly contributed to this release:

* Anthony Towns
* Hennadii Stepanov
* Matt Corallo
* Suhas Daftuar
* Thomas Kerin
* Wladimir J. van der Laan

And to those that reported security issues:

* beardnboobies

As well as everyone that helped translating on [Transifex](https://www.transifex.com/projects/p/bitcoin/).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e0296fff_20250125_062018.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=JinBean%2FCVE-Extension)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JinBean](/JinBean)
/
**[CVE-Extension](/JinBean/CVE-Extension)**
Public

* [Notifications](/login?return_to=%2FJinBean%2FCVE-Extension) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2FJinBean%2FCVE-Extension)
* [Star
   3](/login?return_to=%2FJinBean%2FCVE-Extension)

This repository is an extension of our research on cryptocurrency clones and documents existing vulnerabilities discovered in those clones

[3
stars](/JinBean/CVE-Extension/stargazers) [4
forks](/JinBean/CVE-Extension/forks) [Branches](/JinBean/CVE-Extension/branches) [Tags](/JinBean/CVE-Extension/tags) [Activity](/JinBean/CVE-Extension/activity)
 [Star](/login?return_to=%2FJinBean%2FCVE-Extension)

 [Notifications](/login?return_to=%2FJinBean%2FCVE-Extension) You must be signed in to change notification settings

* [Code](/JinBean/CVE-Extension)
* [Issues
  0](/JinBean/CVE-Extension/issues)
* [Pull requests
  0](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects
  0](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

Additional navigation options

* [Code](/JinBean/CVE-Extension)
* [Issues](/JinBean/CVE-Extension/issues)
* [Pull requests](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

# JinBean/CVE-Extension

    master[Branches](/JinBean/CVE-Extension/branches)[Tags](/JinBean/CVE-Extension/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[23 Commits](/JinBean/CVE-Extension/commits/master/) | | |
| [CVE-2016-10724](/JinBean/CVE-Extension/tree/master/CVE-2016-10724 "CVE-2016-10724") | | [CVE-2016-10724](/JinBean/CVE-Extension/tree/master/CVE-2016-10724 "CVE-2016-10724") |  |  |
| [CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144 "CVE-2018-17144") | | [CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144 "CVE-2018-17144") |  |  |
| [CVE-2019-7167](/JinBean/CVE-Extension/tree/master/CVE-2019-7167 "CVE-2019-7167") | | [CVE-2019-7167](/JinBean/CVE-Extension/tree/master/CVE-2019-7167 "CVE-2019-7167") |  |  |
| [README.md](/JinBean/CVE-Extension/blob/master/README.md "README.md") | | [README.md](/JinBean/CVE-Extension/blob/master/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
# CVE Extensions

This repository is an extension of our research on cryptocurrency clones and vulnerabilities that takes existing vulnerabilities in major coins and uses clone detection tools as a method of identifying propagation of these vulnerabilities in other coins.

List of documented CVEs

1. [CVE-2018-17144](#cve-2018-17144)
2. [CVE-2019-7167](#cve-2019-7167)
3. [CVE-2016-10724](#cve-2016-10724)
4. [CVE-2016-10725](#cve-2016-10725)

---

## CVE-2018-17144

[National Vulnerability Database (NVD) Report](https://nvd.nist.gov/vuln/detail/CVE-2018-17144)

A reachable assert statement in Bitcoin Core allows a remote denial of service (application crash) exploitable by miners via attempting to double-spend a transaction insinde a mined block. This CVE also later leads to an inflation bug, which we do not focus on here.

The code relevant to this vulnerability can be found in the file `validation.cpp` of Bitcoin Core 0.14.X.
This specific file can be found [here](https://github.com/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X).

When a block containing a double spent transaction is validated, it skips the duplicate input check because of the false parameter [here](https://github.com/JinBean/CVE-Extension/blob/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp#L2883). The double spend will reach the function [UpdateCoins()](https://github.com/JinBean/CVE-Extension/blob/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp#L1323), and the inputs to the transaction are being marked as spent in the Unspent Transaction Output(UTXO) database. The first time the transaction is seen, the coins involved are marked as spent. Since the coins involved in the transaction are already marked as spent, the second time the transaction is seen, `coins->vout[nPos].IsNull()` will be true. It will then enter this [if statement](https://github.com/JinBean/CVE-Extension/blob/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp#L1332) and subsequently execute the assert statement that follows. The assert then causes the node to crash, resulting in the denial of service vulnerability. (Paraphrased from Source 2)

The coin(s) that we found to still contain this vulnerability as of 26/3/2019 include:

* [Irlecoin](https://github.com/irlecoin/irlecoin)
* [MinexCoin](https://github.com/minexcoin/minexcoin) (Fixed)
* [MktCoin](https://github.com/mktcoin/mktcoin)
* [PlatinCoin](https://github.com/platincoin-project/platincoin)
* [QuasarCoin](https://github.com/quasarcoin/quasar)
* [TCOIN](https://github.com/koba24/tcoin)

**Total Coins: 6**

These coin(s) still contain unpatched instances of the vulnerability in their code base which can be found [here](https://github.com/JinBean/CVE-Extension/tree/master/CVE-2018-17144)

### Sources:

1. [CVE-2018-17144 Full Disclosure](https://bitcoincore.org/en/2018/09/20/notice/)
2. [Andrew Chow, Bitcoin StackExchange](https://bitcoin.stackexchange.com/questions/79481/how-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work/79484#79484)

---

## CVE-2019-7167

[National Vulnerability Database (NVD) Report](https://nvd.nist.gov/vuln/detail/CVE-2019-7167)

BCTV14 setup produces elements that violate soundness, misleading the original Sprout zk-SNARK verifier into accepting the correctness of a transaction. This allows an attacker to create very large, virtually unlimited amounts of counterfeit shielded tokens without detection. Zcash has switched to different parameters using a new “Sprout-on-Groth16” proving system as of the Sapling network upgrade on October 28th 2018, and so is not affected by the bug.

The code relevant to this vulnerability can be found in the file `JoinSplit.cpp` of Zcash 1.X.
This specific file can be found [here](https://github.com/JinBean/CVE-Extension/blob/master/CVE-2019-7167/Zcash-1.X/JoinSplit.cpp).

The coin(s) that we found to still contain this vulnerability as of 27/5/2019 include:

* [Hush](https://github.com/MyHush/hush)

**Total Coins: 1**

These coin(s) still contain unpatched instances of the vulnerability in their code base which can be found [here](https://github.com/JinBean/CVE-Extension/tree/master/CVE-2019-7167)

### Sources:

1. [Zcash blog disclosure])(<https://z.cash/blog/zcash-counterfeiting-vulnerability-successfully-remediated/>)

---

## CVE-2016-10724 / CVE-2016-10725

These two vulnerabilites are closely related and hence are grouped in the same section. All coins presented in this section are vulnerable to both vulnerabilities.

### CVE-2016-10724

[National Vulnerability Database (NVD) Report](https://nvd.nist.gov/vuln/detail/CVE-2016-10724)

A remote network alert system originating from Bitcoin allows the denial of service (memory exhaustion) if an attacker can sign a message with a certain private key that had been known by unintended actors. Due to an infinitely sized map, an attacker can send a large number of alerts (or very large alerts, or both) to a node, causing the node to run out of memory and crash.

### CVE-2016-10725

[National Vulnerability Database (NVD) Report](https://nvd.nist.gov/vuln/detail/CVE-2016-10725)

A 'final alert' was developed to prevent attackers from abusing CVE-2016-10724, which comprises a maximum ID alert that overrides all previous alerts. A final alert is an alert that meets the following conditions [here](https://github.com/JinBean/CVE-Extension/blob/master/CVE-2016-10724/Bitcoin-0.12.X/alert.cpp#L190-L196). However, due to alerts being classified by their hashes, any alert can be classified as a final alert, which can also cause the the node to run out of memory.
Final alerts are also supposed to be uncancellable, but can inadvertently be cancelled. Alerts first check they cancel any existing alert. Then they are checked for whether any of the remaining alerts cancel it. Because of this order, it is possible to create an alert which cancels a final alert before the node checks whether that alert is cancelled by the final alert. Thus an attacker can cancel a final alert with another alert allowing a node to also be vulnerable to CVE-2016-10724.

The alert system in itself also creates a centralized source in the cryptocurrency. Bitcoin has since deprecated the alert system entirely.
Bitcoin has also released a patch for the alert vulnerability which can be found [here](https://gist.github.com/achow101/02d03238090691558a68010a9ccbbf9d)

The code relevant to these vulnerabilities can be found in the file `alert.cpp` of Bitcoin 0.12.X.
This specific file can be found [here](https://github.com/JinBean/CVE-Extension/blob/master/CVE-2016-10724/Bitcoin-0.12.X/alert.cpp).

The coin(s) that we found to still contain both CVE-2016-10724 and CVE-2016-10745 as of 14/6/2019 include:

* [Absolute](https://github.com/absolute-community/absolute)
* [Adirondack](https://github.com/adirondackcoin/Adirondack)
* [AdultChain](https://github.com/AdultChain/AdultChain)
* [Advance](https://github.com/AdvanceProtocol/advance)
* [Aegeus](https://github.com/AegeusCoin/aegeus)
* [Afro](https://github.com/afro/afro)
* [AGNI coin](https://github.com/agnicoin/agni)
* [Airin](https://github.com/airincoin/airin)
* [Alpha](https://github.com/alp-project/AlphaCoin)
* [ALQO](https://github.com/alqocrypto/alqo)
* [Amero](https://github.com/bitcosur/Amero)
* [Amnesia](https://github.com/amnesiacoin/amnesia)
* [ANODOS](https://github.com/anodoscoin/anodoscoin)
* [ANON](https://github.com/anonymousbitcoin/anon)
* [APEIRON](https://github.com/apeironcoin/apeiron)
* [Apollon](https://github.com/apollondeveloper/ApollonCoin)
* [AquariusCoin](https://github.com/AquariusNetwork/ARCO)
* [Aquila](https://github.com/aquilacoin/AquilaX)
* [ArcticCoin](https://github.com/ArcticCore/arcticcoin)
* [ARGO](https://github.com/argocoins/argo)
* [Aricoin](https://github.com/aricoin/aricoin)
* [Arion](https://github.com/arioncoin/arioncoin)
* [ARTAX](https://github.com/artaxcommittee/Artax)
* [Artiqox](https://github.com/artiqox/artiqox)
* [AudioCoin](https://github.com/aurovine/audiocoin)
* [Auroracoin](https://github.com/aurarad/auroracoin)
* [B3Coin](https://github.com/B3-Coin/B3-CoinV2)
* [BANQ](https://github.com/banq-platform/banq)
* [Baxur](https://github.com/baxurdev/baxur)
* [Bettex coin](https://github.com/bettexproject/bettexcoin)
* [BiblePay](https://github.com/biblepay/biblepay)
* [Bifrost](https://github.com/bifrost-actual/bifrost-coin)
* [Birake](https://github.com/birake/birakecoin)
* [BitBay](https://github.com/dzimbeck/BitBay)
* [Bitcloud](https://github.com/LIMXTEC/Bitcloud)
* [Bitcoin 2](https://github.com/BITC2/bitcoin2)
* [Bitcoin Adult](https://github.com/BitcoinAdult/BitcoinAdult-Source-Code)
* [Bitcoin Final](https://github.com/bitcoinfinal/BitcoinFinal)
* [Bitcoin Lightning](https://github.com/Bitcoinlightning/Bitcoin-Lightning)
* [Bitcoin Private](https://github.com/BTCPrivate/BitcoinPrivate)
* [Bitcoin W Spectrum](https://github.com/raymaker/bitcoinwspectrum)
* [BitcoinZ](https://github.com/bitcoinz-pod/bitcoinz)
* [Bitcurrency](https://github.com/tokyoghetto/BitCurrencyPro)
* [BitF](https://github.com/BitFdev/BitF-source-code)
* [Bithold](https://github.com/Bitholddev/Bithold)
* [BitNodes Pro](https://github.com/bitnodes/bitnodespro)
* [Bitradio](https://github.com/thebitradio/Bitradio)
* [BitRewards](https://github.com/BitRewardsCoin/BitRewards)
* [BlackCoin](https://github.com/CoinBlack/blackcoin)
* [Blocknet](https://github.com/BlocknetDX/BlockDX)
* [Blocknode](https://github.com/blocknodetech/blocknode)
* [Braincoin](https://github.com/axelxod/braincoin)
* [BUCK](https://github.com/BuckCoin/buck)
* [Bullion](https://github.com/elambert2014/bullion)
* [Bulwark](https://github.com/bulwark-crypto/Bulwark)
* [BuzzCoin](https://github.com/buzzcoin-project/BUZZ)
* [Capital Coin](https://github.com/Cap-Project/CapitalCoin)
* [Capra Coin](https://github.com/zero24x/capracoin)
* [Carboncoin](https://github.com/carboncointrust/CarboncoinCore)
* [CardBuyers](https://github.com/CARDbuyers/BCARD)
* [Carebit](https://github.com/carebitcoin/carebitcoin)
* [CatoCoin](https://github.com/CatoCoin/CatoCoin)
* [Cazcoin](https://github.com/copicogithub1/cazcoin)
* [Cerberus](https://github.com/cerberus-ng/cerberus)
* [CHEESE](https://github.com/CheeseCoin/CheeseMasternode)
* [Clams](https://github.com/nochowderforyou/clams)
* [Coin2Play](https://github.com/Coin2Play/c2pcore)
* [CoinonatX](https://github.com/xcxt-community/CoinonatX)
* [ColossusXT](https://github.com/ColossusCoinXT/ColossusCoinXT)
* [Community coin](https://github.com/cmccommunity/communitycoin)
* [Concierge coin](https://github.com/ConciergeCoin/Concierge)
* [Condominium Coin](https://github.com/condominium/CondominiumCore)
* [Copico](https://github.com/copicogithub1/copico)
* [COREZ](https://github.com/corezcrypto/corez)
* [Cosmos Coin](https://github.com/CMOS-Project/Cosmos)
* [Crave](https://github.com/Crave-Project/Crave-NG)
* [Cropcoin](https://github.com/Cropdev/CropDev)
* [CrowdCoin](https://github.com/crowdcoinChain/Crowdcoin)
* [Crown](https://github.com/Crowndev/crown-core)
* [Cryply](https://github.com/cryply/cryply-wallet)
* [Cryptoflow](https://github.com/CryptoFlowCoin/CryptoFlowCoin)
* [Cryptonite](https://github.com/MiniblockchainProject/Cryptonite)
* [Cryptonodes](https://github.com/cryptonodes-core/cryptonodes-core)
* [CUBEX](https://github.com/cubex-network/cubex)
* [Curium](https://github.com/curiumofficial/curium)
* [CurveCoin](https://github.com/curvecoin/curve)
* [DEMOS PAY](https://github.com/DemosPay/DemosPay)
* [Desire](https://github.com/lazyboozer/Desire)
* [Deuscoin](https://github.com/deuscoin-org/deuscoin-core)
* [Deutsche eMark](https://github.com/emarkproject/eMark)
* [Deviant Coin](https://github.com/Deviantcoin/Source)
* [Dextro](https://github.com/dextrocoin/dextro)
* [Diamond](https://github.com/DMDcoin/Diamond)
* [DigiMoney](https://github.com/digimoneydgm/digimoney)
* [Digitalcoin](https://github.com/DGCDev/digitalcoin)
* [DigitalPrice](https://github.com/DigitalPrice/DigitalPrice)
* [Digiwage](https://github.com/digiwage/digiwage)
* [Dividend Cash](https://github.com/dividendcash/dividendcash)
* [DIXIcoin](https://github.com/Dixicoin-DXC/Dixicoin)
* [Dogecoin](https://github.com/dogecoin/dogecoin)
* [Dravite](https://github.com/dravitecoin/dravite)
* [Dynamic](https://github.com/duality-solutions/Dynamic)
* [Dystem](https://github.com/Dystem/dystem-core)
* [EA Coin](https://github.com/eacoin-project/eacore)
* [EarnzCoin](https://github.com/Frenzel1337/EarnzCoin)
* [Elbrus](https://github.com/Elbruscurrency/EBSCoin)
* [Ellerium Project](https://github.com/ElleriumProject/Elleriumv2)
* [Elliot Coin](https://github.com/elliotproject/elli)
* [Elliotcoin](https://github.com/elliotproject/elli)
* [EmerCoin](https://github.com/EvgenijM86/emercoin)
* [Emrals](https://github.com/Emrals/emrals)
* [Epic](https://github.com/EpicCoinDev/Epic)
* [Eternity](https://github.com/eternity-group/eternity)
* [Ethereum Cash](https://github.com/ethereumcashdev/ethereumcash)
* [ExclusiveCoin](https://github.com/exclfork/ExclusiveCoin)
* [Exsolution](https://github.com/exsolution/ext-wallet)
* [EXUS Coin](https://github.com/exuscoin/exus)
* [Fantasy Cash](https://github.com/FootyCash/FootyCashV2)
* [Fantasy Gold](https://github.com/FantasyGold/FantasyGold-Core)
* [FEIRM](https://github.com/feirm/feirm)
* [FLCoin](https://github.com/cryptofreelance/FLCoin)
* [Folm](https://github.com/folm/folm)
* [Force Network](https://github.com/forceunited/force)
* [Francs](https://github.com/FRN-Crypto/FRN)
* [Freicoin](https://github.com/freicoin/freicoin)
* [FriendshipCoin](https://github.com/friendshipCoin/friendshipcoin-core)
* [Frozen](https://github.com/frznice/frozen)
* [FuturoCoin](https://github.com/futuro-coin/Futuro)
* [Gainer](https://github.com/gainercoin/gainercoin)
* [GambleCoin](https://github.com/GambleCoin-Project/GambleCoin)
* [GameCredits](https://github.com/gamers-coin/GameCredits)
* [GenesisX](https://github.com/genesis-x/genesis-x)
* [Gentarium](https://github.com/genterium-project/gentarium)
* [GeyserCoin](https://github.com/geysercoin/geysercoin)
* [Giant](https://github.com/GiantPay/GiantCore)
* [Globycoin](https://github.com/Globycoin/glbcore)
* [GoaCoin](https://github.com/goacoincore/goacoin)
* [GoByte](https://github.com/gobytecoin/gobyte)
* [Gold Poker](https://github.com/GoldPoker/GoldPoker-coin)
* [GoldBlocks](https://github.com/goldblockscoin/goldblocks)
* [Graphcoin](https://github.com/Graphcoin/source)
* [Gravium](https://github.com/Gravium/gravium)
* [Growers International](https://github.com/growersintl/growers)
* [Guardian Coin](https://github.com/guardiancoin/GDNC)
* [Harvest Masternode Coin](https://github.com/HarvestMasternodecoin/Harvestcoin)
* [HeldCoin](https://github.com/heldcoindev/HeldCoin)
* [Helium Chain](https://github.com/heliumchain/helium)
* [Help The Homeless Coin](https://github.com/HTHcoin/HTH)
* [Helpico](https://github.com/AnonymousDo/Helpico)
* [Hera Coin](https://github.com/Heraproject/HeraCoin)
* [HERB](https://github.com/herbcoin/herb)
* [HiddenTalk](https://github.com/htkcoin/htk)
* [High Temperature Coin](https://github.com/htrcoin/htrcoin)
* [HIGHLAND](https://github.com/highlandpay/highlandcoin)
* [Hilux](https://github.com/swatchie-1/hilux)
* [Hobonickels](https://github.com/Crypto-Expert/HoboNickels)
* [Horizen](https://github.com/ZencashOfficial/zen)
* [Hush](https://github.com/J-Stuhlman/zdash)
* [I0Coin](https://github.com/domob1812/i0coin)
* [Ignition](https://github.com/ignitioncoin/ignitioncoin)
* [ImageCash](https://github.com/mceme/ImageCash)
* [INDINODE](https://github.com/coinwebfactory/indinode)
* [Infinex](https://github.com/InfinexOfficial/Infinex)
* [Infinipay](https://github.com/infinipay/infinipay)
* [Innoket](https://github.com/innoket-dev/innoket-master)
* [Innova](https://github.com/innovacoin/innova)
* [INSaNe](https://github.com/CryptoCoderz/INSN)
* [InstaDEX](https://github.com/InstaDex-Coin/InstaDEX)
* [Interstellar Holdings](https://github.com/InterstellarHoldings/InterstellarHoldings)
* [Interzone](https://github.com/projectinterzone/ITZ)
* [ION](https://github.com/ionomy/ion)
* [IPSUM](https://github.com/ipsum-network/ips)
* [Jiyo](https://github.com/jiyocoin/jiyo-core)
* [Joulecoin](https://github.com/joulecoin/joulecoin)
* [Kaicoin](https://github.com/kaicoin-io/kaicoin-full-node)
* [Kalkulus](https://github.com/kalkulusteam/klks)
* [Keyco](https://github.com/keycoteam/keyco)
* [KRAIT](https://github.com/KRAITcoin/Krait)
* [Kraken Coin](https://github.com/KrakenCoins/Kraken)
* [Kzcash](https://github.com/kzcashteam/kzcash)
* [LanaCoin](https://github.com/LanaCoin/lanacoin)
* [Landcoin](https://github.com/landcoin-ldc/landcoin)
* [LasVegasCoin](https://github.com/Vegas-Guy/LasVegasCoin2)
* [League Coin](https://github.com/LGACoin/League)
* [Legion Coin](https://github.com/Legioncrypto/Legion)
* [LemonCoin](https://github.com/lemoncoin-project/lemoncoin)
* [LetItRide](https://github.com/shogdite/letitride)
* [Liberty](https://github.com/project-liberty/libertycoin)
* [LightPayCoin](https://github.com/lpcproject/LightPayCoin)
* [Linda](https://github.com/Lindacoin/Linda)
* [LINUX PAY](https://github.com/linuxpaycoin/linuxpay)
* [Lizus Payments](https://github.com/lizuspayments/lizus-core)
* [LOBSTEX Coin](https://github.com/avymantech/lobstex)
* [LogisCoin](https://github.com/lgsproject/LogisCoin)
* [LUNIQUE](https://github.com/RottenCoin/LuniqueCoin)
* [Macro](https://github.com/doomdorf/Macro)
* [MagnaCoin](https://github.com/MagnaCoinProject/MagnaCoin)
* [MAKETRIP](https://github.com/maketripcoin/maketrip-MTRIP)
* [Mambo Coin](https://github.com/MMBcoin/MamboCoin)
* [MarteXcoin](https://github.com/martexcoin/martexcoin)
* [MasterBit](https://github.com/MasterBit-Coin/masterbit)
* [Masternode Community Coin](https://github.com/mcc-project/mccproject)
* [Masternodecoin](https://github.com/masternodecoin/masternodecoin)
* [Medic Coin](https://github.com/MEDICCOIN/MedicCoin)
* [Memetic](https://github.com/pepeteam/pepecoin)
* [Mero](https://github.com/merocoin/mero)
* [Mirai](https://github.com/bumbacoin/Mirai-Master)
* [MNPCoin](https://github.com/MasterNodesPro/MNPCoin)
* [MonetaryUnit](https://github.com/MonetaryUnit/MUE-Src)
* [MoneyBag](https://github.com/MoneyBagCoin/MoneyBagCoin)
* [Monkey Project](https://github.com/MONKEYPROJECT/Monkey)
* [MontBlanc 3000](https://github.com/MontBlancCoin/MontBlanc)
* [MotileCoin](https://github.com/MotileCoin/MotileCoin)
* [Motion](https://github.com/motioncrypto/motion)
* [MOUSE](https://github.com/m1ckeym0us3/Mouse)
* [MTI Coin](https://github.com/mticryptocoins/MTI-Coin)
* [MUNcoin](https://github.com/muncrypto/muncoin)
* [MYCE](https://github.com/mycelliumcoin/MycelliumMN)
* [Nanucoin](https://github.com/rodrigodepeder/nanucoin)
* [NewYorkCoin](https://github.com/NewYorkCoin-NYC/nycoin)
* [NextON](https://github.com/Next-ON/NextON)
* [Nitrous](https://github.com/Nitrous-Core/nitrous)
* [Nodium](https://github.com/nodiumproject/zNodium)
* [Northern](https://github.com/zabtc/Northern)
* [NulleX](https://github.com/white92d15b7/NLX)
* [Nyerium](https://github.com/nyerium-core/nyerium)
* [NYXCoin](https://github.com/nyxpay/nyx)
* [OASIS](https://github.com/OasisCoinTeam/Oasis)
* [Obsidian](https://github.com/obsidianproject/Obsidian-Qt)
* [Ondori](https://github.com/ondori-project/rstr)
* [Over Powered Coin](https://github.com/opcoinx/OPCoinX)
* [Oyster Platform](https://github.com/oysterplatform/oyster)
* [PACcoin](https://github.com/PACCommunity/PAC)
* [Pandacoin](https://github.com/pandacoin-official/pandacoin)
* [PapelCoin](https://github.com/papelcoin/papelcoin)
* [Parlay](https://github.com/parlaychain/parlay)
* [PAXEX](https://github.com/paxex/paxchange)
* [PayDay Coin](https://github.com/PayDayCoinIo/PayDayCoin)
* [Peony Coin](https://github.com/peonyCoin/Peony)
* [PepeCoin](https://github.com/pepeteam/pepecoin)
* [Pesetacoin](https://github.com/FundacionPesetacoin/Pesetacoin-0.9.1-Oficial)
* [PHOBOS](https://github.com/Phoboscurrency/PBSCoin)
* [Phonecoin](https://github.com/phonecoin-PHON/PhoneCoinCore)
* [Phore](https://github.com/phoreproject/Phore)
* [PICPOTO](https://github.com/picpoto/picpotocoin)
* [PIVX](https://github.com/PIVX-Project/PIVX)
* [PlatinumBAR](https://github.com/xptx/PlatinumBar)
* [Plexus](https://github.com/PlexusCoin/Plexus)
* [Printex](https://github.com/Printex-official/printex-core)
* [ProCurrency](https://github.com/procurrency/procurrency)
* [Profit Hunters Coin](https://github.com/ProfitHuntersCoin/phc)
* [Project Coin](https://github.com/projectcoincore/ProjectCoin)
* [Prototanium](https://github.com/Prototanium/Pr)
* [Pura](https://github.com/PURAcore/PURA)
* [Purealt](https://github.com/puredev321/pure)
* [PZDC Project](https://github.com/pzdc-project/pzdc)
* [Qbic](https://github.com/qbic-platform/qbic)
* [Quantis](https://github.com/QuantisNetwork/Quantis-public)
* [Quark](https://github.com/MaxGuevara/quark)
* [Qubitcoin](https://github.com/willowrose/QubitCoin)
* [Quix](https://github.com/quixcoin/quix)
* [QYNO](https://github.com/qyno/qynocoin)
* [Rabbit](https://github.com/RabbitcoreDEV/RabbitCore)
* [Race](https://github.com/racecrypto/racecoin)
* [Radium](https://github.com/RadiumCore/radium-0.11)
* [Ragnarok](https://github.com/ragnaproject/Ragnarok)
* [Rampant Coin](https://github.com/rampantco/Rampant)
* [Rapture](https://github.com/RaptureCore/Rapture)
* [Reddcoin](https://github.com/reddcoin-project/reddcoin)
* [Reliance](https://github.com/relianceproject/Rel)
* [Renos](https://github.com/RenosCoin/RenosCoin)
* [Revolvercoin](https://github.com/RevolverCoin/revolvercoin)
* [Rhenium](https://github.com/Rheniumnetwork/Rhenium)
* [Ride My Car](https://github.com/RideMyCar/RideMyCar-Coin)
* [Riecoin](https://github.com/riecoin/riecoin)
* [Roi Coin](https://github.com/ROIcoin/ROIcoin)
* [Rover Coin](https://github.com/RoverCoin/Rovercoin)
* [RPICoin](https://github.com/rpicoin/rpicore)
* [Rubycoin](https://github.com/rubycoinorg/rubycoin)
* [Safe](https://github.com/bankledger/safe)
* [SafeCoin](https://github.com/Fair-Exchange/safecoin)
* [SafeInsure](https://github.com/safeinsure/sins-coin)
* [SagaCoin](https://github.com/sagacrypto/SagaCoin)
* [SaluS](https://github.com/saluscoin/salus)
* [Sanchezium](https://github.com/sanchezium/sanchezium)
* [SAROS](https://github.com/sarospay/saros)
* [Satoshicoin](https://github.com/SatoshiCoin-Crypto/SatoshiCoin)
* [savenode](https://github.com/savenode/SaveNodeCore)
* [Scorecoin](https://github.com/marksteven2017/Scorecoin)
* [SCRIV](https://github.com/ScrivNetwork/scriv)
* [SecureCloudCoin](https://github.com/SecureCloudCoin/securecloudcoin)
* [SecureTag](https://github.com/securetag/securetag)
* [Seedcoin](https://github.com/seedcoinfoundation/Seedcoin)
* [Shard Coin](https://github.com/ShardcoinRepo/shard)
* [Sharingmarketcoin](https://github.com/sharingmarketcoin/sharingmarketcoin)
* [SIBCoin](https://github.com/ivansib/sibcoin)
* [SimpleBank](https://github.com/Simplebankdev/Simple.)
* [SJWCoin](https://github.com/sjwcoin/sjwcoin-core)
* [Smart Quorum](https://github.com/smartquorum/sqrcoin)
* [SmartFox](https://github.com/smartfoxteam/smartfox)
* [SnowGem](https://github.com/Snowgem/Snowgem)
* [Social Send](https://github.com/SocialSend/SocialSend)
* [Solaris](https://github.com/Solaris-Project/Solaris)
* [Solarium](https://github.com/solariumcoin/solarium-XLRC)
* [Somnio](https://github.com/SMNcoin/SMNCoin)
* [SoomCoin](https://github.com/soom-4th-blockchain/soom-core)
* [Sovereign Coin](https://github.com/SovCoinX/SovCoin)
* [SPEDO](https://github.com/spedo-tech/spedo)
* [Sphere](https://github.com/SphereDevs/sphere)
* [Stakecube](https://github.com/stakecube/stakecube)
* [StarCash Network](https://github.com/cybernetik7/StarCash-Network-2.0)
* [Stipend](https://github.com/Stipend-Developer/stipend)
* [StoneCoin](https://github.com/stonecoinproject/Stonecoin)
* [StrongHands Masternode](https://github.com/bitcoinbabys/StrongHandsMasterNode)
* [SUB1X](https://github.com/SuB1X-Coin/zSub1x)
* [Sucre](https://github.com/sucremoneda/SucreCore)
* [SunCoin](https://github.com/suncoin-network/suncoin-core)
* [SuppoCoin](https://github.com/codeclock/sc)
* [Supro](https://github.com/suprodev/supro)
* [SwagBucks](https://github.com/pinkmagicdev/SwagBucks)
* [SwapCash](https://github.com/SwapCash/swapcash)
* [Swipp](https://github.com/teamswipp/swippcore)
* [SwisscoinCash](https://github.com/SwisscoinTM/SwisscoinNode)
* [Syndicate](https://github.com/SyndicateLabs/SyndicateQT)
* [TajCoin](https://github.com/Taj-Coin/tajcoin)
* [Talium](https://github.com/taliumtech/talium)
* [Talus](https://github.com/talusdev/TAL)
* [Tao](https://github.com/taoblockchain/tao-core)
* [Teloscoin](https://github.com/phoenixkonsole/transcendence)
* [Terracoin](https://github.com/terracoin/terracoin)
* [The Freedom Coin](https://github.com/TheFreedomCoin/Freedom-Coin)
* [TIMEISMONEY](https://github.com/rmcpartner/timeismoneycrypto)
* [Timicoin](https://github.com/timihealth/timicoin)
* [Tincoin](https://github.com/tincoinpay/tincoin)
* [Tokugawa](https://github.com/tokugawacoin/tokugawa)
* [Traid](https://github.com/TraidPlatform/traidcoin)
* [Transfercoin](https://github.com/transferdev/Transfercoin)
* [TravelPay](https://github.com/TravelPay/TravelPay)
* [Tribe](https://github.com/TribeCrypto/tribe)
* [Trittium](https://github.com/Trittium/trittium)
* [Trollcoin](https://github.com/TrollCoin2/TrollCoin-2.0)
* [Ultranatum](https://github.com/ultranatum/ultranatum)
* [United Crypto Community](https://github.com/unitedcryptocommunity/ucom)
* [Unobtanium](https://github.com/unobtanium-official/Unobtanium)
* [UservCoin](https://github.com/uservapp/uservcoin)
* [Vantaur](https://github.com/vantaur/vantaur)
* [VapersCoin](https://github.com/vaperscoin/vaperscoin)
* [VectorAI](https://github.com/vectorcoindev/Vector)
* [Velum](https://github.com/VelumPlatform/VelumPlatform)
* [VIOG](https://github.com/ViogCommunity/VIOG)
* [Vitae](https://github.com/VitaeTeam/Vitae)
* [Vivid Coin](https://github.com/vividplatform/vividcoin)
* [VIVO](https://github.com/vivocoin/vivo)
* [VIZZOTOP](https://github.com/VizzoTopCore/vizzotop)
* [VoteCoin](https://github.com/Tomas-M/VoteCoin)
* [Vsync](https://github.com/VsyncCrypto/VSX)
* [Wavi](https://github.com/wavidev-the-man/wavi)
* [Worx](https://github.com/worxcoin/worx)
* [XANO](https://github.com/XanoCoin/Xano-Coin)
* [Xchange](https://github.com/Xcgtech/Wallet)
* [Xdna](https://github.com/XDNA-Core/XDNA)
* [xGalaxy](https://github.com/officialXGalaxy/XGalaxy)
* [XORN](https://github.com/XORNcore/XORN)
* [XUEZ](https://github.com/XUEZ/XUEZ)
* [Xuma](https://github.com/xumacoin/xuma-core)
* [YICOIN](https://github.com/YiDeveloper/Yi)
* [Zcash](https://github.com/zcash/zcash)
* [ZCore](https://github.com/zcore-coin/zcore-source)
* [Zealium](https://github.com/zealiumcoin/Zealium)
* [ZelCash](https://github.com/zelcash/zelcash)
* [Zennies](https://github.com/zennies/zennies)
* [Zero](https://github.com/zerocurrency/zero)
* [Zest](https://github.com/ZestFoundation/ZestCoin)
* [Zixx](https://github.com/zixxcrypto/zixxcore)
* [Zoomba](https://github.com/zoombacoin/zoomba)
* [ZoZoCoin](https://github.com/ZoZoCoin/ZoZo-blockchain)
* [zXFLEA](https://github.com/zxfleacoin/xflea)

**Total Coins: 377**

These coin(s) still contain unpatched instances of the vulnerability in their code base which can be found [here](https://github.com/JinBean/CVE-Extension/tree/master/CVE-2016-10724)

### Sources:

1. [Bitcoin disclosure](https://bitcoin.org/en/posts/alert-key-and-vulnerabilities-disclosure)
2. [Linux Foundation](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-July/016189.html)

---

## Contributors

* [Hum Qing Ze](https://github.com/Fishbiscuit)
* [Latasha Lenus](https://github.com/latashalenus)
* [Tan Wei Jin](https://github.com/JinBean)
* [Tey Shi Ying](https://github.com/shiyingt)

---

\*All files uploaded have been cloned from their respective coin repositories.

## About

This repository is an extension of our research on cryptocurrency clones and documents existing vulnerabilities discovered in those clones

### Topics

[cve-2018-17144](/topics/cve-2018-17144 "Topic: cve-2018-17144")
[cve-2019-7176](/topics/cve-2019-7176 "Topic: cve-2019-7176")
[cve-2016-10724](/topics/cve-2016-10724 "Topic: cve-2016-10724")
[cve-2016-10725](/topics/cve-2016-10725 "Topic: cve-2016-10725")

### Resources

[Readme](#readme-ov-file)

[Activity](/JinBean/CVE-Extension/activity)
### Stars

[**3**
stars](/JinBean/CVE-Extension/stargazers)
### Watchers

[**1**
watching](/JinBean/CVE-Extension/watchers)
### Forks

[**4**
forks](/JinBean/CVE-Extension/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension&report=JinBean+%28user%29)

## [Releases](/JinBean/CVE-Extension/releases)

No releases published

## [Packages 0](/users/JinBean/packages?repo_name=CVE-Extension)

No packages published

## Languages

* [C++
  100.0%](/JinBean/CVE-Extension/search?l=c%2B%2B)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bitcoincore.org_582cc42a_20250126_064128.html ===


[![bitcoin core logo](/assets/images/bitcoin_core_logo_colored_reversed.png)](/)

* [About](/en/about/)
* [Download](/en/download)
* [blog](/en/blog/)
* [releases](/en/releases/)
* Development
  + [contribute](/en/contribute/)
  + [contributing code](/en/faq/contributing-code/)
  + [meetings](/en/meetings/)
  + [Lifecycle](/en/lifecycle)
  + [Security Advisories](/en/security-advisories/)
  + [RPC Docs](/en/doc/)
    - [28.0.0](/en/doc/28.0.0/)
    - [27.0.0](/en/doc/27.0.0/)
    - [26.0.0](/en/doc/26.0.0/)
    - [25.0.0](/en/doc/25.0.0/)
    - [24.0.0](/en/doc/24.0.0/)
    - [23.0.0](/en/doc/23.0.0/)
    - [22.0.0](/en/doc/22.0.0/)
    - [0.21.0](/en/doc/0.21.0/)
    - [0.20.0](/en/doc/0.20.0/)
    - [0.19.0](/en/doc/0.19.0/)
    - [0.18.0](/en/doc/0.18.0/)
    - [0.17.0](/en/doc/0.17.0/)
    - [0.16.3](/en/doc/0.16.3/)
    - [0.16.2](/en/doc/0.16.2/)
    - [0.16.1](/en/doc/0.16.1/)
    - [0.16.0](/en/doc/0.16.0/)
* Contact
  + [Contact Us](/en/contact/)
  + [Announcements](/en/list/announcements/join/)
  + [Twitter impersonation](/en/twitter-impersonation)
* English
  æ¥æ¬èª

# [Disclosure of CVE-2018-17144](/en/2018/09/20/notice/ "Disclosure of CVE-2018-17144")

by .

# Full disclosure

CVE-2018-17144, a fix for which was released on September 18th in Bitcoin Core versions 0.16.3 and 0.17.0rc4, includes both a Denial of Service component and a critical inflation vulnerability. It was originally reported to several developers working on Bitcoin Core, as well as projects supporting other cryptocurrencies, including ABC and Unlimited on September 17th as a Denial of Service bug only, however we quickly determined that the issue was also an inflation vulnerability with the same root cause and fix.

In order to encourage rapid upgrades, the decision was made to immediately patch and disclose the less serious Denial of Service vulnerability, concurrently with reaching out to miners, businesses, and other affected systems while delaying publication of the full issue to give times for systems to upgrade. On September 20th a post in a public forum reported the full impact and although it was quickly retracted the claim was further circulated.

At this time we believe over half of the Bitcoin hashrate has upgraded to patched nodes. We are unaware of any attempts to exploit this vulnerability.

However, it still remains critical that affected users upgrade and apply the latest patches to ensure no possibility of large reorganizations, mining of invalid blocks, or acceptance of invalid transactions occurs.

# Technical Details

In Bitcoin Core 0.14, an optimization was added (Bitcoin Core PR #9049) which avoided a costly check during initial pre-relay block validation that multiple inputs within a single transaction did not spend the same input twice which was added in 2012 (PR #443). While the UTXO-updating logic has sufficient knowledge to check that such a condition is not violated in 0.14 it only did so in a sanity check assertion and not with full error handling (it did, however, fully handle this case twice in prior to 0.8).

Thus, in Bitcoin Core 0.14.X, any attempts to double-spend a transaction output within a single transaction inside of a block will result in an assertion failure and a crash, as was originally reported.

In Bitcoin Core 0.15, as a part of a larger redesign to simplify unspent transaction output tracking and correct a resource exhaustion attack the assertion was changed subtly. Instead of asserting that the output being marked spent was previously unspent, it only asserts that it exists.

Thus, in Bitcoin Core 0.15.X, 0.16.0, 0.16.1, and 0.16.2, any attempts to double-spend a transaction output within a single transaction inside of a block where the output being spent was created in the same block, the same assertion failure will occur (as exists in the test case which was included in the 0.16.3 patch). However, if the output being double-spent was created in a previous block, an entry will still remain in the CCoin map with the DIRTY flag set and having been marked as spent, resulting in no such assertion. This could allow a miner to inflate the supply of Bitcoin as they would be then able to claim the value being spent twice.

# Timeline

Timeline for September 17, 2018: (all times UTC)

* 14:57 anonymous reporter reports crash bug to: Pieter Wuille, Greg Maxwell, Wladimir Van Der Laan of Bitcoin Core, deadalnix of Bitcoin ABC, and sickpig of Bitcoin Unlimited.
* 15:15 Greg Maxwell shares the original report with Cory Fields, Suhas Daftuar, Alex Morcos and Matt Corallo
* 17:47 Matt Corallo identifies inflation bug
* 19:15 Matt Corallo first tries to reach slushpool CEO to have a line of communication open to apply a patch quickly
* 19:29 Greg Maxwell timestamps the hash of a test-case which demonstrates the inflation vulnerability (a47344b7dceddff6c6cc1c7e97f1588d99e6dba706011b6ccc2e615b88fe4350)
* 20:15 John Newbery and James OâBeirne are informed of the vulnerability so they can assist in alerting companies to a pending patch for a DoS vulnerability
* 20:30 Matt Corallo speaks with slushpool CTO and CEO and shares patch with disclosure of the Denial of Service
* 20:48 slushpool confirmed upgraded
* 21:08 Alert was sent to Bitcoin ABC that a patch will be posted publicly by 22:00
* 21:30 (approx) Responded to original reporter with an acknowledgment
* 21:57 Bitcoin Core PR 14247 published with patch and test demonstrating the Denial of Service bug
* 21:58 Bitcoin ABC publishes their patch
* 22:07 Advisory email with link to Bitcoin Core PR and patch goes out to Optech members, among others
* 23:21 Bitcoin Core version 0.17.0rc4 tagged

September 18, 2018:

* 00:24 Bitcoin Core version 0.16.3 tagged
* 20:44 Bitcoin Core release binaries and release announcements were available
* 21:47 Bitcointalk and reddit have public banners urging people to upgrade

September 19, 2018:

* 14:06 The mailing list distributes an additional message urging people to upgrade by Pieter Wuille

September 20, 2018:

* 19:50 David Jaenson independently discovered the vulnerability, and it was reported to the Bitcoin Core security contact email.

---

**Disclosure of CVE-2018-17144**
was published on
September 20, 2018

.

#### Recommended ([View all posts](/en/blog/))

* [Bitcoin Core 28.1 released](/en/2025/01/09/release-28.1/ "Bitcoin Core 28.1 released")
* [Bitcoin Core 27.2 released](/en/2024/11/04/release-27.2/ "Bitcoin Core 27.2 released")

---

[Twitter](https://twitter.com/bitcoincoreorg)

[Legal](/en/legal/) | [Privacy Policy](/en/legal/privacy) | [RSS ![rss feeds](/assets/images/rss-24x24.png)](/en/rss/)

![bitcoin core logo](/assets/images/bitcoin_core_logo.png)

© 2025 Bitcoin Core



=== Content from github.com_da8b45d9_20250126_064130.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Ftree%2Fmaster%2FCVE-2018-17144)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Ftree%2Fmaster%2FCVE-2018-17144)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Ffiles%2Fdisambiguate&source=header-repo&source_repo=JinBean%2FCVE-Extension)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JinBean](/JinBean)
/
**[CVE-Extension](/JinBean/CVE-Extension)**
Public

* [Notifications](/login?return_to=%2FJinBean%2FCVE-Extension) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2FJinBean%2FCVE-Extension)
* [Star
   3](/login?return_to=%2FJinBean%2FCVE-Extension)

* [Code](/JinBean/CVE-Extension)
* [Issues
  0](/JinBean/CVE-Extension/issues)
* [Pull requests
  0](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects
  0](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

Additional navigation options

* [Code](/JinBean/CVE-Extension)
* [Issues](/JinBean/CVE-Extension/issues)
* [Pull requests](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

## Files

 master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
/
# CVE-2018-17144

/Copy path
## Directory actions

## More options

## Directory actions

## More options

## Latest commit

## History

[History](/JinBean/CVE-Extension/commits/master/CVE-2018-17144) master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
/
# CVE-2018-17144

/Top
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| parent directory[..](/JinBean/CVE-Extension/tree/master) | | |
| [Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X "Bitcoin-0.14.X") | | [Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X "Bitcoin-0.14.X") |  |  |
| [IrleCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/IrleCoin "IrleCoin") | | [IrleCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/IrleCoin "IrleCoin") |  |  |
| [MinexCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/MinexCoin "MinexCoin") | | [MinexCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/MinexCoin "MinexCoin") |  |  |
| [MktCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/MktCoin "MktCoin") | | [MktCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/MktCoin "MktCoin") |  |  |
| [PlatinCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/PlatinCoin "PlatinCoin") | | [PlatinCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/PlatinCoin "PlatinCoin") |  |  |
| [QuasarCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/QuasarCoin "QuasarCoin") | | [QuasarCoin](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/QuasarCoin "QuasarCoin") |  |  |
| [TCOIN](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/TCOIN "TCOIN") | | [TCOIN](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/TCOIN "TCOIN") |  |  |
| View all files | | |

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_55144b16_20250126_064120.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Fblob%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X%2Fvalidation.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Fblob%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X%2Fvalidation.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=JinBean%2FCVE-Extension)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JinBean](/JinBean)
/
**[CVE-Extension](/JinBean/CVE-Extension)**
Public

* [Notifications](/login?return_to=%2FJinBean%2FCVE-Extension) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2FJinBean%2FCVE-Extension)
* [Star
   3](/login?return_to=%2FJinBean%2FCVE-Extension)

* [Code](/JinBean/CVE-Extension)
* [Issues
  0](/JinBean/CVE-Extension/issues)
* [Pull requests
  0](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects
  0](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

Additional navigation options

* [Code](/JinBean/CVE-Extension)
* [Issues](/JinBean/CVE-Extension/issues)
* [Pull requests](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

## Files

 master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
3. /[Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X)
/
# validation.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/JinBean/CVE-Extension/commits/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)4330 lines (3798 loc) · 187 KB master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
3. /[Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X)
/
# validation.cpp

Top
## File metadata and controls

* Code
* Blame

4330 lines (3798 loc) · 187 KB[Raw](https://github.com/JinBean/CVE-Extension/raw/refs/heads/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000// Copyright (c) 2009-2010 Satoshi Nakamoto// Copyright (c) 2009-2016 The Bitcoin Core developers// Distributed under the MIT software license, see the accompanying// file COPYING or http://www.opensource.org/licenses/mit-license.php.
#include "validation.h"
#include "arith\_uint256.h"#include "chainparams.h"#include "checkpoints.h"#include "checkqueue.h"#include "consensus/consensus.h"#include "consensus/merkle.h"#include "consensus/validation.h"#include "hash.h"#include "init.h"#include "policy/fees.h"#include "policy/policy.h"#include "pow.h"#include "primitives/block.h"#include "primitives/transaction.h"#include "random.h"#include "script/script.h"#include "script/sigcache.h"#include "script/standard.h"#include "timedata.h"#include "tinyformat.h"#include "txdb.h"#include "txmempool.h"#include "ui\_interface.h"#include "undo.h"#include "util.h"#include "utilmoneystr.h"#include "utilstrencodings.h"#include "validationinterface.h"#include "versionbits.h"#include "warnings.h"
#include <atomic>#include <sstream>
#include <boost/algorithm/string/replace.hpp>#include <boost/algorithm/string/join.hpp>#include <boost/filesystem.hpp>#include <boost/filesystem/fstream.hpp>#include <boost/math/distributions/poisson.hpp>#include <boost/thread.hpp>
#if defined(NDEBUG)# error "Bitcoin cannot be compiled without assertions."#endif
/\*\* \* Global state \*/
CCriticalSection cs\_main;
BlockMap mapBlockIndex;CChain chainActive;CBlockIndex \*pindexBestHeader = NULL;CWaitableCriticalSection csBestBlock;CConditionVariable cvBlockChange;int nScriptCheckThreads = 0;std::atomic\_bool fImporting(false);bool fReindex = false;bool fTxIndex = false;bool fHavePruned = false;bool fPruneMode = false;bool fIsBareMultisigStd = DEFAULT\_PERMIT\_BAREMULTISIG;bool fRequireStandard = true;bool fCheckBlockIndex = false;bool fCheckpointsEnabled = DEFAULT\_CHECKPOINTS\_ENABLED;size\_t nCoinCacheUsage = 5000 \* 300;uint64\_t nPruneTarget = 0;int64\_t nMaxTipAge = DEFAULT\_MAX\_TIP\_AGE;bool fEnableReplacement = DEFAULT\_ENABLE\_REPLACEMENT;
uint256 hashAssumeValid;
CFeeRate minRelayTxFee = CFeeRate(DEFAULT\_MIN\_RELAY\_TX\_FEE);CAmount maxTxFee = DEFAULT\_TRANSACTION\_MAXFEE;
CTxMemPool mempool(::minRelayTxFee);
static void CheckBlockIndex(const Consensus::Params& consensusParams);
/\*\* Constant stuff for coinbase transactions we create: \*/CScript COINBASE\_FLAGS;
const std::string strMessageMagic = "Bitcoin Signed Message:\n";
// Internal stuffnamespace {
 struct CBlockIndexWorkComparator { bool operator()(CBlockIndex \*pa, CBlockIndex \*pb) const { // First sort by most total work, ... if (pa->nChainWork > pb->nChainWork) return false; if (pa->nChainWork < pb->nChainWork) return true;
 // ... then by earliest time received, ... if (pa->nSequenceId < pb->nSequenceId) return false; if (pa->nSequenceId > pb->nSequenceId) return true;
 // Use pointer address as tie breaker (should only happen with blocks // loaded from disk, as those all have id 0). if (pa < pb) return false; if (pa > pb) return true;
 // Identical blocks. return false; } };
 CBlockIndex \*pindexBestInvalid;
 /\*\* \* The set of all CBlockIndex entries with BLOCK\_VALID\_TRANSACTIONS (for itself and all ancestors) and \* as good as our current tip or better. Entries may be failed, though, and pruning nodes may be \* missing the data for the block. \*/ std::set<CBlockIndex\*, CBlockIndexWorkComparator> setBlockIndexCandidates; /\*\* All pairs A->B, where A (or one of its ancestors) misses transactions, but B has transactions. \* Pruned nodes may have entries where B is missing data. \*/ std::multimap<CBlockIndex\*, CBlockIndex\*> mapBlocksUnlinked;
 CCriticalSection cs\_LastBlockFile; std::vector<CBlockFileInfo> vinfoBlockFile; int nLastBlockFile = 0; /\*\* Global flag to indicate we should check to see if there are \* block/undo files that should be deleted. Set on startup \* or if we allocate more file space when we're in prune mode \*/ bool fCheckForPruning = false;
 /\*\* \* Every received block is assigned a unique and increasing identifier, so we \* know which one to give priority in case of a fork. \*/ CCriticalSection cs\_nBlockSequenceId; /\*\* Blocks loaded from disk are assigned id 0, so start the counter at 1. \*/ int32\_t nBlockSequenceId = 1; /\*\* Decreasing counter (used by subsequent preciousblock calls). \*/ int32\_t nBlockReverseSequenceId = -1; /\*\* chainwork for the last block that preciousblock has been applied to. \*/ arith\_uint256 nLastPreciousChainwork = 0;
 /\*\* Dirty block index entries. \*/ std::set<CBlockIndex\*> setDirtyBlockIndex;
 /\*\* Dirty block file entries. \*/ std::set<int> setDirtyFileInfo;} // anon namespace
/\* Use this class to start tracking transactions that are removed from the \* mempool and pass all those transactions through SyncTransaction when the \* object goes out of scope. This is currently only used to call SyncTransaction \* on conflicts removed from the mempool during block connection. Applied in \* ActivateBestChain around ActivateBestStep which in turn calls: \* ConnectTip->removeForBlock->removeConflicts \*/class MemPoolConflictRemovalTracker{private: std::vector<CTransactionRef> conflictedTxs; CTxMemPool &pool;
public: MemPoolConflictRemovalTracker(CTxMemPool &\_pool) : pool(\_pool) { pool.NotifyEntryRemoved.connect(boost::bind(&MemPoolConflictRemovalTracker::NotifyEntryRemoved, this, \_1, \_2)); }
 void NotifyEntryRemoved(CTransactionRef txRemoved, MemPoolRemovalReason reason) { if (reason == MemPoolRemovalReason::CONFLICT) { conflictedTxs.push\_back(txRemoved); } }
 ~MemPoolConflictRemovalTracker() { pool.NotifyEntryRemoved.disconnect(boost::bind(&MemPoolConflictRemovalTracker::NotifyEntryRemoved, this, \_1, \_2)); for (const auto& tx : conflictedTxs) { GetMainSignals().SyncTransaction(\*tx, NULL, CMainSignals::SYNC\_TRANSACTION\_NOT\_IN\_BLOCK); } conflictedTxs.clear(); }};
CBlockIndex\* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator){ // Find the first block the caller has in the main chain BOOST\_FOREACH(const uint256& hash, locator.vHave) { BlockMap::iterator mi = mapBlockIndex.find(hash); if (mi != mapBlockIndex.end()) { CBlockIndex\* pindex = (\*mi).second; if (chain.Contains(pindex)) return pindex; if (pindex->GetAncestor(chain.Height()) == chain.Tip()) { return chain.Tip(); } } } return chain.Genesis();}
CCoinsViewCache \*pcoinsTip = NULL;CBlockTreeDB \*pblocktree = NULL;
enum FlushStateMode { FLUSH\_STATE\_NONE, FLUSH\_STATE\_IF\_NEEDED, FLUSH\_STATE\_PERIODIC, FLUSH\_STATE\_ALWAYS};
// See definition for documentationbool static FlushStateToDisk(CValidationState &state, FlushStateMode mode, int nManualPruneHeight=0);void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight);
bool IsFinalTx(const CTransaction &tx, int nBlockHeight, int64\_t nBlockTime){ if (tx.nLockTime == 0) return true; if ((int64\_t)tx.nLockTime < ((int64\_t)tx.nLockTime < LOCKTIME\_THRESHOLD ? (int64\_t)nBlockHeight : nBlockTime)) return true; for (const auto& txin : tx.vin) { if (!(txin.nSequence == CTxIn::SEQUENCE\_FINAL)) return false; } return true;}
bool CheckFinalTx(const CTransaction &tx, int flags){ AssertLockHeld(cs\_main);
 // By convention a negative value for flags indicates that the // current network-enforced consensus rules should be used. In // a future soft-fork scenario that would mean checking which // rules would be enforced for the next block and setting the // appropriate flags. At the present time no soft-forks are // scheduled, so no flags are set. flags = std::max(flags, 0);
 // CheckFinalTx() uses chainActive.Height()+1 to evaluate // nLockTime because when IsFinalTx() is called within // CBlock::AcceptBlock(), the height of the block \*being\* // evaluated is what is used. Thus if we want to know if a // transaction can be part of the \*next\* block, we need to call // IsFinalTx() with one more than chainActive.Height(). const int nBlockHeight = chainActive.Height() + 1;
 // BIP113 will require that time-locked transactions have nLockTime set to // less than the median time of the previous block they're contained in. // When the next block is created its previous block will be the current // chain tip, so we use that to calculate the median time passed to // IsFinalTx() if LOCKTIME\_MEDIAN\_TIME\_PAST is set. const int64\_t nBlockTime = (flags & LOCKTIME\_MEDIAN\_TIME\_PAST) ? chainActive.Tip()->GetMedianTimePast() : GetAdjustedTime();
 return IsFinalTx(tx, nBlockHeight, nBlockTime);}
/\*\* \* Calculates the block height and previous block's median time past at \* which the transaction will be considered final in the context of BIP 68. \* Also removes from the vector of input heights any entries which did not \* correspond to sequence locked inputs as they do not affect the calculation. \*/static std::pair<int, int64\_t> CalculateSequenceLocks(const CTransaction &tx, int flags, std::vector<int>\* prevHeights, const CBlockIndex& block){ assert(prevHeights->size() == tx.vin.size());
 // Will be set to the equivalent height- and time-based nLockTime // values that would be necessary to satisfy all relative lock- // time constraints given our view of block chain history. // The semantics of nLockTime are the last invalid height/time, so // use -1 to have the effect of any height or time being valid. int nMinHeight = -1; int64\_t nMinTime = -1;
 // tx.nVersion is signed integer so requires cast to unsigned otherwise // we would be doing a signed comparison and half the range of nVersion // wouldn't support BIP 68. bool fEnforceBIP68 = static\_cast<uint32\_t>(tx.nVersion) >= 2 && flags & LOCKTIME\_VERIFY\_SEQUENCE;
 // Do not enforce sequence numbers as a relative lock time // unless we have been instructed to if (!fEnforceBIP68) { return std::make\_pair(nMinHeight, nMinTime); }
 for (size\_t txinIndex = 0; txinIndex < tx.vin.size(); txinIndex++) { const CTxIn& txin = tx.vin[txinIndex];
 // Sequence numbers with the most significant bit set are not // treated as relative lock-times, nor are they given any // consensus-enforced meaning at this point. if (txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_DISABLE\_FLAG) { // The height of this input is not relevant for sequence locks (\*prevHeights)[txinIndex] = 0; continue; }
 int nCoinHeight = (\*prevHeights)[txinIndex];
 if (txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_TYPE\_FLAG) { int64\_t nCoinTime = block.GetAncestor(std::max(nCoinHeight-1, 0))->GetMedianTimePast(); // NOTE: Subtract 1 to maintain nLockTime semantics // BIP 68 relative lock times have the semantics of calculating // the first block or time at which the transaction would be // valid. When calculating the effective block time or height // for the entire transaction, we switch to using the // semantics of nLockTime which is the last invalid block // time or height. Thus we subtract 1 from the calculated // time or height.
 // Time-based relative lock-times are measured from the // smallest allowed timestamp of the block containing the // txout being spent, which is the median time past of the // block prior. nMinTime = std::max(nMinTime, nCoinTime + (int64\_t)((txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_MASK) << CTxIn::SEQUENCE\_LOCKTIME\_GRANULARITY) - 1); } else { nMinHeight = std::max(nMinHeight, nCoinHeight + (int)(txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_MASK) - 1); } }
 return std::make\_pair(nMinHeight, nMinTime);}
static bool EvaluateSequenceLocks(const CBlockIndex& block, std::pair<int, int64\_t> lockPair){ assert(block.pprev); int64\_t nBlockTime = block.pprev->GetMedianTimePast(); if (lockPair.first >= block.nHeight || lockPair.second >= nBlockTime) return false;
 return true;}
bool SequenceLocks(const CTransaction &tx, int flags, std::vector<int>\* prevHeights, const CBlockIndex& block){ return EvaluateSequenceLocks(block, CalculateSequenceLocks(tx, flags, prevHeights, block));}
bool TestLockPointValidity(const LockPoints\* lp){ AssertLockHeld(cs\_main); assert(lp); // If there are relative lock times then the maxInputBlock will be set // If there are no relative lock times, the LockPoints don't depend on the chain if (lp->maxInputBlock) { // Check whether chainActive is an extension of the block at which the LockPoints // calculation was valid. If not LockPoints are no longer valid if (!chainActive.Contains(lp->maxInputBlock)) { return false; } }
 // LockPoints still valid return true;}
bool CheckSequenceLocks(const CTransaction &tx, int flags, LockPoints\* lp, bool useExistingLockPoints){ AssertLockHeld(cs\_main); AssertLockHeld(mempool.cs);
 CBlockIndex\* tip = chainActive.Tip(); CBlockIndex index; index.pprev = tip; // CheckSequenceLocks() uses chainActive.Height()+1 to evaluate // height based locks because when SequenceLocks() is called within // ConnectBlock(), the height of the block \*being\* // evaluated is what is used. // Thus if we want to know if a transaction can be part of the // \*next\* block, we need to use one more than chainActive.Height() index.nHeight = tip->nHeight + 1;
 std::pair<int, int64\_t> lockPair; if (useExistingLockPoints) { assert(lp); lockPair.first = lp->height; lockPair.second = lp->time; } else { // pcoinsTip contains the UTXO set for chainActive.Tip() CCoinsViewMemPool viewMemPool(pcoinsTip, mempool); std::vector<int> prevheights; prevheights.resize(tx.vin.size()); for (size\_t txinIndex = 0; txinIndex < tx.vin.size(); txinIndex++) { const CTxIn& txin = tx.vin[txinIndex]; CCoins coins; if (!viewMemPool.GetCoins(txin.prevout.hash, coins)) { return error("%s: Missing input", \_\_func\_\_); } if (coins.nHeight == MEMPOOL\_HEIGHT) { // Assume all mempool transaction confirm in the next block prevheights[txinIndex] = tip->nHeight + 1; } else { prevheights[txinIndex] = coins.nHeight; } } lockPair = CalculateSequenceLocks(tx, flags, &prevheights, index); if (lp) { lp->height = lockPair.first; lp->time = lockPair.second; // Also store the hash of the block with the highest height of // all the blocks which have sequence locked prevouts. // This hash needs to still be on the chain // for these LockPoint calculations to be valid // Note: It is impossible to correctly calculate a maxInputBlock // if any of the sequence locked inputs depend on unconfirmed txs, // except in the special case where the relative lock time/height // is 0, which is equivalent to no sequence lock. Since we assume // input height of tip+1 for mempool txs and test the resulting // lockPair from CalculateSequenceLocks against tip+1. We know // EvaluateSequenceLocks will fail if there was a non-zero sequence // lock on a mempool input, so we can use the return value of // CheckSequenceLocks to indicate the LockPoints validity int maxInputHeight = 0; BOOST\_FOREACH(int height, prevheights) { // Can ignore mempool inputs since we'll fail if they had non-zero locks if (height != tip->nHeight+1) { maxInputHeight = std::max(maxInputHeight, height); } } lp->maxInputBlock = tip->GetAncestor(maxInputHeight); } } return EvaluateSequenceLocks(index, lockPair);}
unsigned int GetLegacySigOpCount(const CTransaction& tx){ unsigned int nSigOps = 0; for (const auto& txin : tx.vin) { nSigOps += txin.scriptSig.GetSigOpCount(false); } for (const auto& txout : tx.vout) { nSigOps += txout.scriptPubKey.GetSigOpCount(false); } return nSigOps;}
unsigned int GetP2SHSigOpCount(const CTransaction& tx, const CCoinsViewCache& inputs){ if (tx.IsCoinBase()) return 0;
 unsigned int nSigOps = 0; for (unsigned int i = 0; i < tx.vin.size(); i++) { const CTxOut &prevout = inputs.GetOutputFor(tx.vin[i]); if (prevout.scriptPubKey.IsPayToScriptHash()) nSigOps += prevout.scriptPubKey.GetSigOpCount(tx.vin[i].scriptSig); } return nSigOps;}
int64\_t GetTransactionSigOpCost(const CTransaction& tx, const CCoinsViewCache& inputs, int flags){ int64\_t nSigOps = GetLegacySigOpCount(tx) \* WITNESS\_SCALE\_FACTOR;
 if (tx.IsCoinBase()) return nSigOps;
 if (flags & SCRIPT\_VERIFY\_P2SH) { nSigOps += GetP2SHSigOpCount(tx, inputs) \* WITNESS\_SCALE\_FACTOR; }
 for (unsigned int i = 0; i < tx.vin.size(); i++) { const CTxOut &prevout = inputs.GetOutputFor(tx.vin[i]); nSigOps += CountWitnessSigOps(tx.vin[i].scriptSig, prevout.scriptPubKey, &tx.vin[i].scriptWitness, flags); } return nSigOps;}
bool CheckTransaction(const CTransaction& tx, CValidationState &state, bool fCheckDuplicateInputs){ // Basic checks that don't depend on any context if (tx.vin.empty()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-vin-empty"); if (tx.vout.empty()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-vout-empty"); // Size limits (this doesn't take the witness into account, as that hasn't been checked for malleability) if (::GetSerializeSize(tx, SER\_NETWORK, PROTOCOL\_VERSION | SERIALIZE\_TRANSACTION\_NO\_WITNESS) > MAX\_BLOCK\_BASE\_SIZE) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-oversize");
 // Check for negative or overflow output values CAmount nValueOut = 0; for (const auto& txout : tx.vout) { if (txout.nValue < 0) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-vout-negative"); if (txout.nValue > MAX\_MONEY) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-vout-toolarge"); nValueOut += txout.nValue; if (!MoneyRange(nValueOut)) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-txouttotal-toolarge"); }
 // Check for duplicate inputs - note that this check is slow so we skip it in CheckBlock if (fCheckDuplicateInputs) { std::set<COutPoint> vInOutPoints; for (const auto& txin : tx.vin) { if (!vInOutPoints.insert(txin.prevout).second) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-inputs-duplicate"); } }
 if (tx.IsCoinBase()) { if (tx.vin[0].scriptSig.size() < 2 || tx.vin[0].scriptSig.size() > 100) return state.DoS(100, false, REJECT\_INVALID, "bad-cb-length"); } else { for (const auto& txin : tx.vin) if (txin.prevout.IsNull()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-prevout-null"); }
 return true;}
void LimitMempoolSize(CTxMemPool& pool, size\_t limit, unsigned long age) { int expired = pool.Expire(GetTime() - age); if (expired != 0) LogPrint("mempool", "Expired %i transactions from the memory pool\n", expired);
 std::vector<uint256> vNoSpendsRemaining; pool.TrimToSize(limit, &vNoSpendsRemaining); BOOST\_FOREACH(const uint256& removed, vNoSpendsRemaining) pcoinsTip->Uncache(removed);}
/\*\* Convert CValidationState to a human-readable message for logging \*/std::string FormatStateMessage(const CValidationState &state){ return strprintf("%s%s (code %i)", state.GetRejectReason(), state.GetDebugMessage().empty() ? "" : ", "+state.GetDebugMessage(), state.GetRejectCode());}
static bool IsCurrentForFeeEstimation(){ AssertLockHeld(cs\_main); if (IsInitialBlockDownload()) return false; if (chainActive.Tip()->GetBlockTime() < (GetTime() - MAX\_FEE\_ESTIMATION\_TIP\_AGE)) return false; if (chainActive.Height() < pindexBestHeader->nHeight - 1) return false; return true;}
bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const CTransactionRef& ptx, bool fLimitFree, bool\* pfMissingInputs, int64\_t nAcceptTime, std::list<CTransactionRef>\* plTxnReplaced, bool fOverrideMempoolLimit, const CAmount& nAbsurdFee, std::vector<uint256>& vHashTxnToUncache){ const CTransaction& tx = \*ptx; const uint256 hash = tx.GetHash(); AssertLockHeld(cs\_main); if (pfMissingInputs) \*pfMissingInputs = false;
 if (!CheckTransaction(tx, state)) return false; // state filled in by CheckTransaction
 // Coinbase is only valid in a block, not as a loose transaction if (tx.IsCoinBase()) return state.DoS(100, false, REJECT\_INVALID, "coinbase");
 // Reject transactions with witness before segregated witness activates (override with -prematurewitness) bool witnessEnabled = IsWitnessEnabled(chainActive.Tip(), Params().GetConsensus()); if (!GetBoolArg("-prematurewitness",false) && tx.HasWitness() && !witnessEnabled) { return state.DoS(0, false, REJECT\_NONSTANDARD, "no-witness-yet", true); }
 // Rather not work on nonstandard transactions (unless -testnet/-regtest) std::string reason; if (fRequireStandard && !IsStandardTx(tx, reason, witnessEnabled)) return state.DoS(0, false, REJECT\_NONSTANDARD, reason);
 // Only accept nLockTime-using transactions that can be mined in the next // block; we don't want our mempool filled up with transactions that can't // be mined yet. if (!CheckFinalTx(tx, STANDARD\_LOCKTIME\_VERIFY\_FLAGS)) return state.DoS(0, false, REJECT\_NONSTANDARD, "non-final");
 // is it already in the memory pool? if (pool.exists(hash)) return state.Invalid(false, REJECT\_ALREADY\_KNOWN, "txn-already-in-mempool");
 // Check for conflicts with in-memory transactions std::set<uint256> setConflicts; { LOCK(pool.cs); // protect pool.mapNextTx BOOST\_FOREACH(const CTxIn &txin, tx.vin) { auto itConflicting = pool.mapNextTx.find(txin.prevout); if (itConflicting != pool.mapNextTx.end()) { const CTransaction \*ptxConflicting = itConflicting->second; if (!setConflicts.count(ptxConflicting->GetHash())) { // Allow opt-out of transaction replacement by setting // nSequence >= maxint-1 on all inputs. // // maxint-1 is picked to still allow use of nLockTime by // non-replaceable transactions. All inputs rather than just one // is for the sake of multi-party protocols, where we don't // want a single party to be able to disable replacement. // // The opt-out ignores descendants as anyone relying on // first-seen mempool behavior should be checking all // unconfirmed ancestors anyway; doing otherwise is hopelessly // insecure. bool fReplacementOptOut = true; if (fEnableReplacement) { BOOST\_FOREACH(const CTxIn &\_txin, ptxConflicting->vin) { if (\_txin.nSequence < std::numeric\_limits<unsigned int>::max()-1) { fReplacementOptOut = false; break; } } } if (fReplacementOptOut) return state.Invalid(false, REJECT\_CONFLICT, "txn-mempool-conflict");
 setConflicts.insert(ptxConflicting->GetHash()); } } } }
 { CCoinsView dummy; CCoinsViewCache view(&dummy);
 CAmount nValueIn = 0; LockPoints lp; { LOCK(pool.cs); CCoinsViewMemPool viewMemPool(pcoinsTip, pool); view.SetBackend(viewMemPool);
 // do we already have it? bool fHadTxInCache = pcoinsTip->HaveCoinsInCache(hash); if (view.HaveCoins(hash)) { if (!fHadTxInCache) vHashTxnToUncache.push\_back(hash); return state.Invalid(false, REJECT\_ALREADY\_KNOWN, "txn-already-known"); }
 // do all inputs exist? // Note that this does not check for the presence of actual outputs (see the next check for that), // and only helps with filling in pfMissingInputs (to determine missing vs spent). BOOST\_FOREACH(const CTxIn txin, tx.vin) { if (!pcoinsTip->HaveCoinsInCache(txin.prevout.hash)) vHashTxnToUncache.push\_back(txin.prevout.hash); if (!view.HaveCoins(txin.prevout.hash)) { if (pfMissingInputs) \*pfMissingInputs = true; return false; // fMissingInputs and !state.IsInvalid() is used to detect this condition, don't set state.Invalid() } }
 // are the actual inputs available? if (!view.HaveInputs(tx)) return state.Invalid(false, REJECT\_DUPLICATE, "bad-txns-inputs-spent");
 // Bring the best block into scope view.GetBestBlock();
 nValueIn = view.GetValueIn(tx);
 // we have all inputs cached now, so switch back to dummy, so we don't need to keep lock on mempool view.SetBackend(dummy);
 // Only accept BIP68 sequence locked transactions that can be mined in the next // block; we don't want our mempool filled up with transactions that can't // be mined yet. // Must keep pool.cs for this unless we change CheckSequenceLocks to take a // CoinsViewCache instead of create its own if (!CheckSequenceLocks(tx, STANDARD\_LOCKTIME\_VERIFY\_FLAGS, &lp)) return state.DoS(0, false, REJECT\_NONSTANDARD, "non-BIP68-final"); }
 // Check for non-standard pay-to-script-hash in inputs if (fRequireStandard && !AreInputsStandard(tx, view)) return state.Invalid(false, REJECT\_NONSTANDARD, "bad-txns-nonstandard-inputs");
 // Check for non-standard witness in P2WSH if (tx.HasWitness() && fRequireStandard && !IsWitnessStandard(tx, view)) return state.DoS(0, false, REJECT\_NONSTANDARD, "bad-witness-nonstandard", true);
 int64\_t nSigOpsCost = GetTransactionSigOpCost(tx, view, STANDARD\_SCRIPT\_VERIFY\_FLAGS);
 CAmount nValueOut = tx.GetValueOut(); CAmount nFees = nValueIn-nValueOut; // nModifiedFees includes any fee deltas from PrioritiseTransaction CAmount nModifiedFees = nFees; double nPriorityDummy = 0; pool.ApplyDeltas(hash, nPriorityDummy, nModifiedFees);
 CAmount inChainInputValue; double dPriority = view.GetPriority(tx, chainActive.Height(), inChainInputValue);
 // Keep track of transactions that spend a coinbase, which we re-scan // during reorgs to ensure COINBASE\_MATURITY is still met. bool fSpendsCoinbase = false; BOOST\_FOREACH(const CTxIn &txin, tx.vin) { const CCoins \*coins = view.AccessCoins(txin.prevout.hash); if (coins->IsCoinBase()) { fSpendsCoinbase = true; break; } }
 CTxMemPoolEntry entry(ptx, nFees, nAcceptTime, dPriority, chainActive.Height(), inChainInputValue, fSpendsCoinbase, nSigOpsCost, lp); unsigned int nSize = entry.GetTxSize();
 // Check that the transaction doesn't have an excessive number of // sigops, making it impossible to mine. Since the coinbase transaction // itself can contain sigops MAX\_STANDARD\_TX\_SIGOPS is less than // MAX\_BLOCK\_SIGOPS; we still consider this an invalid rather than // merely non-standard transaction. if (nSigOpsCost > MAX\_STANDARD\_TX\_SIGOPS\_COST) return state.DoS(0, false, REJECT\_NONSTANDARD, "bad-txns-too-many-sigops", false, strprintf("%d", nSigOpsCost));
 CAmount mempoolRejectFee = pool.GetMinFee(GetArg("-maxmempool", DEFAULT\_MAX\_MEMPOOL\_SIZE) \* 1000000).GetFee(nSize); if (mempoolRejectFee > 0 && nModifiedFees < mempoolRejectFee) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "mempool min fee not met", false, strprintf("%d < %d", nFees, mempoolRejectFee)); } else if (GetBoolArg("-relaypriority", DEFAULT\_RELAYPRIORITY) && nModifiedFees < ::minRelayTxFee.GetFee(nSize) && !AllowFree(entry.GetPriority(chainActive.Height() + 1))) { // Require that free transactions have sufficient priority to be mined in the next block. return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient priority"); }
 // Continuously rate-limit free (really, very-low-fee) transactions // This mitigates 'penny-flooding' -- sending thousands of free transactions just to // be annoying or make others' transactions take longer to confirm. if (fLimitFree && nModifiedFees < ::minRelayTxFee.GetFee(nSize)) { static CCriticalSection csFreeLimiter; static double dFreeCount; static int64\_t nLastTime; int64\_t nNow = GetTime();
 LOCK(csFreeLimiter);
 // Use an exponentially decaying ~10-minute window: dFreeCount \*= pow(1.0 - 1.0/600.0, (double)(nNow - nLastTime)); nLastTime = nNow; // -limitfreerelay unit is thousand-bytes-per-minute // At default rate it would take over a month to fill 1GB if (dFreeCount + nSize >= GetArg("-limitfreerelay", DEFAULT\_LIMITFREERELAY) \* 10 \* 1000) return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "rate limited free transaction"); LogPrint("mempool", "Rate limit dFreeCount: %g => %g\n", dFreeCount, dFreeCount+nSize); dFreeCount += nSize; }
 if (nAbsurdFee && nFees > nAbsurdFee) return state.Invalid(false, REJECT\_HIGHFEE, "absurdly-high-fee", strprintf("%d > %d", nFees, nAbsurdFee));
 // Calculate in-mempool ancestors, up to a limit. CTxMemPool::setEntries setAncestors; size\_t nLimitAncestors = GetArg("-limitancestorcount", DEFAULT\_ANCESTOR\_LIMIT); size\_t nLimitAncestorSize = GetArg("-limitancestorsize", DEFAULT\_ANCESTOR\_SIZE\_LIMIT)\*1000; size\_t nLimitDescendants = GetArg("-limitdescendantcount", DEFAULT\_DESCENDANT\_LIMIT); size\_t nLimitDescendantSize = GetArg("-limitdescendantsize", DEFAULT\_DESCENDANT\_SIZE\_LIMIT)\*1000; std::string errString; if (!pool.CalculateMemPoolAncestors(entry, setAncestors, nLimitAncestors, nLimitAncestorSize, nLimitDescendants, nLimitDescendantSize, errString)) { return state.DoS(0, false, REJECT\_NONSTANDARD, "too-long-mempool-chain", false, errString); }
 // A transaction that spends outputs that would be replaced by it is invalid. Now // that we have the set of all ancestors we can detect this // pathological case by making sure setConflicts and setAncestors don't // intersect. BOOST\_FOREACH(CTxMemPool::txiter ancestorIt, setAncestors) { const uint256 &hashAncestor = ancestorIt->GetTx().GetHash(); if (setConflicts.count(hashAncestor)) { return state.DoS(10, false, REJECT\_INVALID, "bad-txns-spends-conflicting-tx", false, strprintf("%s spends conflicting transaction %s", hash.ToString(), hashAncestor.ToString())); } }
 // Check if it's economically rational to mine this transaction rather // than the ones it replaces. CAmount nConflictingFees = 0; size\_t nConflictingSize = 0; uint64\_t nConflictingCount = 0; CTxMemPool::setEntries allConflicting;
 // If we don't hold the lock allConflicting might be incomplete; the // subsequent RemoveStaged() and addUnchecked() calls don't guarantee // mempool consistency for us. LOCK(pool.cs); const bool fReplacementTransaction = setConflicts.size(); if (fReplacementTransaction) { CFeeRate newFeeRate(nModifiedFees, nSize); std::set<uint256> setConflictsParents; const int maxDescendantsToVisit = 100; CTxMemPool::setEntries setIterConflicting; BOOST\_FOREACH(const uint256 &hashConflicting, setConflicts) { CTxMemPool::txiter mi = pool.mapTx.find(hashConflicting); if (mi == pool.mapTx.end()) continue;
 // Save these to avoid repeated lookups setIterConflicting.insert(mi);
 // Don't allow the replacement to reduce the feerate of the // mempool. // // We usually don't want to accept replacements with lower // feerates than what they replaced as that would lower the // feerate of the next block. Requiring that the feerate always // be increased is also an easy-to-reason about way to prevent // DoS attacks via replacements. // // The mining code doesn't (currently) take children into // account (CPFP) so we only consider the feerates of // transactions being directly replaced, not their indirect // descendants. While that does mean high feerate children are // ignored when deciding whether or not to replace, we do // require the replacement to pay more overall fees too, // mitigating most cases. CFeeRate oldFeeRate(mi->GetModifiedFee(), mi->GetTxSize()); if (newFeeRate <= oldFeeRate) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s; new feerate %s <= old feerate %s", hash.ToString(), newFeeRate.ToString(), oldFeeRate.ToString())); }
 BOOST\_FOREACH(const CTxIn &txin, mi->GetTx().vin) { setConflictsParents.insert(txin.prevout.hash); }
 nConflictingCount += mi->GetCountWithDescendants(); } // This potentially overestimates the number of actual descendants // but we just want to be conservative to avoid doing too much // work. if (nConflictingCount <= maxDescendantsToVisit) { // If not too many to replace, then calculate the set of // transactions that would have to be evicted BOOST\_FOREACH(CTxMemPool::txiter it, setIterConflicting) { pool.CalculateDescendants(it, allConflicting); } BOOST\_FOREACH(CTxMemPool::txiter it, allConflicting) { nConflictingFees += it->GetModifiedFee(); nConflictingSize += it->GetTxSize(); } } else { return state.DoS(0, false, REJECT\_NONSTANDARD, "too many potential replacements", false, strprintf("rejecting replacement %s; too many potential replacements (%d > %d)\n", hash.ToString(), nConflictingCount, maxDescendantsToVisit)); }
 for (unsigned int j = 0; j < tx.vin.size(); j++) { // We don't want to accept replacements that require low // feerate junk to be mined first. Ideally we'd keep track of // the ancestor feerates and make the decision based on that, // but for now requiring all new inputs to be confirmed works. if (!setConflictsParents.count(tx.vin[j].prevout.hash)) { // Rather than check the UTXO set - potentially expensive - // it's cheaper to just check if the new input refers to a // tx that's in the mempool. if (pool.mapTx.find(tx.vin[j].prevout.hash) != pool.mapTx.end()) return state.DoS(0, false, REJECT\_NONSTANDARD, "replacement-adds-unconfirmed", false, strprintf("replacement %s adds unconfirmed input, idx %d", hash.ToString(), j)); } }
 // The replacement must pay greater fees than the transactions it // replaces - if we did the bandwidth used by those conflicting // transactions would not be paid for. if (nModifiedFees < nConflictingFees) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s, less fees than conflicting txs; %s < %s", hash.ToString(), FormatMoney(nModifiedFees), FormatMoney(nConflictingFees))); }
 // Finally in addition to paying more fees than the conflicts the // new transaction must pay for its own bandwidth. CAmount nDeltaFees = nModifiedFees - nConflictingFees; if (nDeltaFees < ::incrementalRelayFee.GetFee(nSize)) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s, not enough additional fees to relay; %s < %s", hash.ToString(), FormatMoney(nDeltaFees), FormatMoney(::incrementalRelayFee.GetFee(nSize)))); } }
 unsigned int scriptVerifyFlags = STANDARD\_SCRIPT\_VERIFY\_FLAGS; if (!Params().RequireStandard()) { scriptVerifyFlags = GetArg("-promiscuousmempoolflags", scriptVerifyFlags); }
 // Check against previous transactions // This is done last to help prevent CPU exhaustion denial-of-service attacks. PrecomputedTransactionData txdata(tx); if (!CheckInputs(tx, state, view, true, scriptVerifyFlags, true, txdata)) { // SCRIPT\_VERIFY\_CLEANSTACK requires SCRIPT\_VERIFY\_WITNESS, so we // need to turn both off, and compare against just turning off CLEANSTACK // to see if the failure is specifically due to witness validation. CValidationState stateDummy; // Want reported failures to be from first CheckInputs if (!tx.HasWitness() && CheckInputs(tx, stateDummy, view, true, scriptVerifyFlags & ~(SCRIPT\_VERIFY\_WITNESS | SCRIPT\_VERIFY\_CLEANSTACK), true, txdata) && !CheckInputs(tx, stateDummy, view, true, scriptVerifyFlags & ~SCRIPT\_VERIFY\_CLEANSTACK, true, txdata)) { // Only the witness is missing, so the transaction itself may be fine. state.SetCorruptionPossible(); } return false; // state filled in by CheckInputs }
 // Check again against just the consensus-critical mandatory script // verification flags, in case of bugs in the standard flags that cause // transactions to pass as valid when they're actually invalid. For // instance the STRICTENC flag was incorrectly allowing certain // CHECKSIG NOT scripts to pass, even though they were invalid. // // There is a similar check in CreateNewBlock() to prevent creating // invalid blocks, however allowing such transactions into the mempool // can be exploited as a DoS attack. if (!CheckInputs(tx, state, view, true, MANDATORY\_SCRIPT\_VERIFY\_FLAGS, true, txdata)) { return error("%s: BUG! PLEASE REPORT THIS! ConnectInputs failed against MANDATORY but not STANDARD flags %s, %s", \_\_func\_\_, hash.ToString(), FormatStateMessage(state)); }
 // Remove conflicting transactions from the mempool BOOST\_FOREACH(const CTxMemPool::txiter it, allConflicting) { LogPrint("mempool", "replacing tx %s with %s for %s BTC additional fees, %d delta bytes\n", it->GetTx().GetHash().ToString(), hash.ToString(), FormatMoney(nModifiedFees - nConflictingFees), (int)nSize - (int)nConflictingSize); if (plTxnReplaced) plTxnReplaced->push\_back(it->GetSharedTx()); } pool.RemoveStaged(allConflicting, false, MemPoolRemovalReason::REPLACED);
 // This transaction should only count for fee estimation if it isn't a // BIP 125 replacement transaction (may not be widely supported), the // node is not behind, and the transaction is not dependent on any other // transactions in the mempool. bool validForFeeEstimation = !fReplacementTransaction && IsCurrentForFeeEstimation() && pool.HasNoInputsOf(tx);
 // Store transaction in memory pool.addUnchecked(hash, entry, setAncestors, validForFeeEstimation);[View remainder of file in raw view](https://github.com/JinBean/CVE-Extension/raw/refs/heads/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bitcoin.stackexchange.com_0ecaf364_20250126_064127.html ===


[Skip to main content](#content)

#### Stack Exchange Network

Stack Exchange network consists of 183 Q&A communities including [Stack Overflow](https://stackoverflow.com), the largest, most trusted online community for developers to learn, share their knowledge, and build their careers.

[Visit Stack Exchange](https://stackexchange.com)

Loading…

* [Tour
  Start here for a quick overview of the site](/tour)
* [Help Center
  Detailed answers to any questions you might have](/help)
* [Meta
  Discuss the workings and policies of this site](https://bitcoin.meta.stackexchange.com)
* [About Us
  Learn more about Stack Overflow the company, and our products](https://stackoverflow.co/)

4. ### [current community](https://bitcoin.stackexchange.com)

   * [Bitcoin](https://bitcoin.stackexchange.com)

     [help](https://bitcoin.stackexchange.com/help)
     [chat](https://chat.stackexchange.com?tab=site&host=bitcoin.stackexchange.com)
   * [Bitcoin Meta](https://bitcoin.meta.stackexchange.com)
   ### your communities

   [Sign up](https://bitcoin.stackexchange.com/users/signup?ssrc=site_switcher&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work) or [log in](https://bitcoin.stackexchange.com/users/login?ssrc=site_switcher&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work) to customize your list.

   ### [more stack exchange communities](https://stackexchange.com/sites)

   [company blog](https://stackoverflow.blog)
6. [Log in](https://bitcoin.stackexchange.com/users/login?ssrc=head&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work)
7. [Sign up](https://bitcoin.stackexchange.com/users/signup?ssrc=head&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work)

[![Bitcoin](https://cdn.sstatic.net/Sites/bitcoin/Img/logo.svg?v=65edcd6e45f3)](https://bitcoin.stackexchange.com)

1. 1. [Home](/)
   2. [Questions](/questions)
   3. [Tags](/tags)
   5. [Users](/users)
   6. [Companies](https://stackoverflow.com/jobs/companies?so_medium=bitcoin&so_source=SiteNav)
   7. [Unanswered](/unanswered)
2. Teams
   ![](https://cdn.sstatic.net/Img/teams/teams-promo.svg?v=e507948b81bf)

   Ask questions, find answers and collaborate at work with Stack Overflow for Teams.

   [Try Teams for free](https://stackoverflowteams.com/teams/create/free/?utm_medium=referral&utm_source=bitcoin-community&utm_campaign=side-bar&utm_content=explore-teams)
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=bitcoin-community&utm_campaign=side-bar&utm_content=explore-teams)
3. Teams
4. Ask questions, find answers and collaborate at work with Stack Overflow for Teams.
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=bitcoin-community&utm_campaign=side-bar&utm_content=explore-teams-compact)

**Teams**

Q&A for work

Connect and share knowledge within a single location that is structured and easy to search.

[Learn more about Teams](https://stackoverflow.co/teams/)

# [How does the most recently found critical vulnerability (CVE-2018-17144) work?](/questions/79481/how-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work)

[Ask Question](/questions/ask)

Asked
6 years, 4 months ago

Modified
[6 years, 4 months ago](?lastactivity "2018-09-22 01:23:49Z")

Viewed
1k times

21

If you were a miner, what are the steps you would take to create the extra (21,000,012.5th) bitcoin?

Where in the source code is this exactly (link)?

Why can't this be done by a non-miner?

Also, which forks are/were vulnerable?

* [reward-schedule](/questions/tagged/reward-schedule "show questions tagged 'reward-schedule'")
* [error](/questions/tagged/error "show questions tagged 'error'")
* [weaknesses](/questions/tagged/weaknesses "show questions tagged 'weaknesses'")
* [source-code](/questions/tagged/source-code "show questions tagged 'source-code'")

[Share](/q/79481 "Short permalink to this question")

[Improve this question](/posts/79481/edit)

Follow

asked Sep 22, 2018 at 0:03

[![hedgedandlevered's user avatar](https://www.gravatar.com/avatar/040b21236346b0d22ef032e63fc06a04?s=64&d=identicon&r=PG)](/users/7144/hedgedandlevered)

[hedgedandlevered](/users/7144/hedgedandlevered)hedgedandlevered
1,50311 gold badge1010 silver badges2323 bronze badges

1

* 21 upvotes, very meta, good job everyone
  – [hedgedandlevered](/users/7144/hedgedandlevered "1,503 reputation")

  Commented
  Nov 29, 2023 at 19:19

Add a comment
 |

## 1 Answer 1

Sorted by:

[Reset to default](/questions/79481/how-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work?answertab=scoredesc#tab-top)

Highest score (default)

Date modified (newest first)

Date created (oldest first)

30

> If you were a miner, what are the steps you would take to create the extra (21,000,012.5th) bitcoin?
>
> Where in the source code is this exactly (link)?

There are two components to CVE-2018-17144. There is a crash bug and an inflation bug. Both are triggered by almost the same scenario: a transaction contains an input multiple times.

In general, how this would work is as follows: lets suppose a miner has an unspent output A for 1 BTC. They create a transaction with that input in twice, so input 1 spends from output A and input 2 *also* spends from output A. The output of that transaction has a value of 2 BTC. Note how the output's value is larger than the value of output A, but if you had output A twice, the value is correct.

The miner would then take this transaction and include it in a block that he is mining. Once the miner find a block with his transaction included in it, he broadcasts it to the Bitcoin network.

When a Bitcoin Core 0.14.x node receives this block, it will validate the block, but it will skip the duplicate input check because of [the `false` parameter on this line](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L2883). So the transaction the miner made will pass this step of validation, and the other transaction validation steps, including input script validation, until it reaches [this loop](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L1328). In this loop, the inputs to the transaction are being marked as spent in the UTXO database. The first time the duplicated input is seen, it is marked as spent. But the second time it is seen, the coin is already marked as spent so `coins->vout[nPos].IsNull()` will be true. This means that it will go into [this if statement](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L1332) and subsequently hit the [`assert` statement that follows](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L1333). The assert causes the software to crash.

For Bitcoin Core 0.15.0 - 0.16.2, the behavior is different. This is due to the change in how the UTXO database is structured. Everything is largely the same until the [same loop](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/validation.cpp#L1183) is reached. Here, instead of returning whether the output was spent, `SpendCoin` actually returns whether the input *exists* in the database. So the first time, it will pass as expected, but the second time, instead of returning `false`, it still returns `true`.

Looking at [`SpendCoin`](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/coins.cpp#L101), you can see that it only returns false when it is unable to fetch the coin (object representing a UTXO) from the database. With the new database structure, this makes sense as the output should be removed from the database when it is spent. But, if you [look a few lines down](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/coins.cpp#L109), you see that it only deletes the coin when it is marked as `FRESH`. In the case the coin was `FRESH`, `SpendCoin` would delete the object on the first pass so the second pass the coin would not be found and thus it would return false. This triggers the [`assert` following the function call](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/validation.cpp#L1186) causing the node to shutdown.

If the coin was not `FRESH`, the coin object itself is not deleted, but its contents are cleared. This means that the second time the input is seen, if the coin was not `FRESH`, `SpendCoin` would still return true as the object still exists in memory, which means that it passes the assert that follows the `SpendCoin` (which caused the crash when the coin was not `FRESH`). Then validation continues as normal, and the output this transaction created is added to the UTXO database, which means that money that shouldn't exist now exists in the UTXO database.

So now the question is, when are UTXOs marked as `FRESH`? They are marked `FRESH` when they are added to the UTXO database. But the UTXO database is still only in memory (as a cache). When it is saved to disk, the entries in memory are then no longer marked as `FRESH`. This saving to disk happens after every block (as well as at other times, but that is not important).

Thus, if a miner has an output that was part of a transaction that has already confirmed, and he spends the output twice in the same transaction (so the transaction has two inputs that refer to the same output), and this transaction is not broadcast to the network but instead included in a block that he mines, he is able to create a new output that has twice the value of the output that he spent, thereby creating coins.

> Why can't this be done by a non-miner?

The reason that this cannot be done by a non-miner is because transactions that are received outside of blocks are still checked for duplicate inputs. The transaction will be rejected as invalid and not added to the node's mempool, so the transaction will never get into a block. It is only transactions with duplicate inputs that get into blocks that trigger this vulnerability, and thus only miners can do this as they must knowingly insert an invalid transaction into their block.

> Also, which forks are/were vulnerable?

Any fork whose software includes commit [`eecffe50efc3944d713c701fa375dacbf17fb7cf`](https://github.com/bitcoin/bitcoin/pull/9049/commits/eecffe50efc3944d713c701fa375dacbf17fb7cf). This would mean any software forked from or pulled in changes from Bitcoin Core after November 10th, 2016.

[Share](/a/79484 "Short permalink to this answer")

[Improve this answer](/posts/79484/edit)

Follow

[edited Jun 16, 2020 at 11:10](/posts/79484/revisions "show all edits to this post")

[![Community's user avatar](https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=64&d=identicon&r=PG)](/users/-1/community)

[Community](/users/-1/community)Bot
1

answered Sep 22, 2018 at 1:23

[![Ava Chow's user avatar](https://www.gravatar.com/avatar/9276bf37b46395e93c63ef1c9ce34011?s=64&d=identicon&r=PG)](/users/48884/ava-chow)

[Ava Chow](/users/48884/ava-chow)♦Ava Chow
72.3k55 gold badges8484 silver badges162162 bronze badges

3

* Would a node that receives the block as a compact block check for the duplicate?
  – [Murch](/users/5406/murch "78,110 reputation")
  ♦
  Commented
  Sep 22, 2018 at 18:16
* 3

  No, it would not. The transaction with the duplicate input would not be in the mempool so it would be sent along with the block (as part of a `blocktxn` message). Such transactions are not run through the mempool acceptance code. Instead the block is reconstructed and run through the normal block acceptance code.
  – [Ava Chow](/users/48884/ava-chow "72,296 reputation")
  ♦
  Commented
  Sep 22, 2018 at 19:04
* Great write-up, thank you! It seems to me having a bool flag such as `fCheckDuplicateInputs` seems pretty unfortunate. It is quite easy to set it to an invalid value. I'm just wondering if we shouldn't be more explicit and verbose in those critical parts
  – [tsusanka](/users/61424/tsusanka "365 reputation")

  Commented
  Sep 26, 2018 at 7:54

Add a comment
 |

## Your Answer

Thanks for contributing an answer to Bitcoin Stack Exchange!

* Please be sure to *answer the question*. Provide details and share your research!

But *avoid* …

* Asking for help, clarification, or responding to other answers.
* Making statements based on opinion; back them up with references or personal experience.

To learn more, see our [tips on writing great answers](/help/how-to-answer).

Draft saved
Draft discarded

### Sign up or [log in](/users/login?ssrc=question_page&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work%23new-answer)

 Sign up using Google

 Sign up using Email and Password

Submit
### Post as a guest

Name

Email

Required, but never shown

### Post as a guest

Name

Email

Required, but never shown

Post Your Answer

Discard

By clicking “Post Your Answer”, you agree to our [terms of service](https://stackoverflow.com/legal/terms-of-service/public) and acknowledge you have read our [privacy policy](https://stackoverflow.com/legal/privacy-policy).

## Not the answer you're looking for? Browse other questions tagged * [reward-schedule](/questions/tagged/reward-schedule "show questions tagged 'reward-schedule'") * [error](/questions/tagged/error "show questions tagged 'error'") * [weaknesses](/questions/tagged/weaknesses "show questions tagged 'weaknesses'") * [source-code](/questions/tagged/source-code "show questions tagged 'source-code'") or [ask your own question](/questions/ask).

* The Overflow Blog
* [How the internet changed in 2024](https://stackoverflow.blog/2025/01/24/how-the-internet-changed-in-2024/)
* [Why all developers should adopt a safety-critical mindset](https://stackoverflow.blog/2025/01/22/why-all-developers-should-adopt-a-safety-critical-mindset/)

#### Linked

[3](/q/79630 "Question score (upvotes - downvotes)")
[Why was this transaction accepted?](/questions/79630/why-was-this-transaction-accepted?noredirect=1)

#### Related

[9](/q/20247 "Question score (upvotes - downvotes)")
[Why does bitcoind say "error: couldn't connect to server" for the first few minutes of boot-up?](/questions/20247/why-does-bitcoind-say-error-couldnt-connect-to-server-for-the-first-few-minu)

[4](/q/22404 "Question score (upvotes - downvotes)")
[Why is Enjoy Sochi a malicious spam attack](/questions/22404/why-is-enjoy-sochi-a-malicious-spam-attack)

[1](/q/30440 "Question score (upvotes - downvotes)")
[What does this mean? RPC\_CLIENT\_NOT\_CONNECTED = -9, // Bitcoin is not connected](/questions/30440/what-does-this-mean-rpc-client-not-connected-9-bitcoin-is-not-connected)

[0](/q/69673 "Question score (upvotes - downvotes)")
[Bitcoin Source Code genesisOutputScript](/questions/69673/bitcoin-source-code-genesisoutputscript)

[1](/q/79979 "Question score (upvotes - downvotes)")
[Where in the source code are transaction validation checks implemented?](/questions/79979/where-in-the-source-code-are-transaction-validation-checks-implemented)

[0](/q/83170 "Question score (upvotes - downvotes)")
[Is there a way to create 9995000 spendable BTC on regtest?](/questions/83170/is-there-a-way-to-create-9995000-spendable-btc-on-regtest)

[1](/q/84791 "Question score (upvotes - downvotes)")
[where in the source code is the the proof of work checking the blockheader hash and nonce?](/questions/84791/where-in-the-source-code-is-the-the-proof-of-work-checking-the-blockheader-hash)

[0](/q/110268 "Question score (upvotes - downvotes)")
[How are there over 18M bitcoins when the reward halves every 210,000 bitcoins?](/questions/110268/how-are-there-over-18m-bitcoins-when-the-reward-halves-every-210-000-bitcoins)

[6](/q/114216 "Question score (upvotes - downvotes)")
[What is the purpose of indexing the mempool by these five criteria?](/questions/114216/what-is-the-purpose-of-indexing-the-mempool-by-these-five-criteria)

[6](/q/118367 "Question score (upvotes - downvotes)")
[How could Bitcoin developers handle and resolve severe software vulnerability without drawing public attention?](/questions/118367/how-could-bitcoin-developers-handle-and-resolve-severe-software-vulnerability-wi)

#### [Hot Network Questions](https://stackexchange.com/questions?tab=hot)

* [Are ought-statements simply is-statements in disguise?](https://philosophy.stackexchange.com/questions/121860/are-ought-statements-simply-is-statements-in-disguise)
* [Why is doctrine so important when salvation is a direct result of believing alone like Abraham?](https://christianity.stackexchange.com/questions/104910/why-is-doctrine-so-important-when-salvation-is-a-direct-result-of-believing-alon)
* [How to disable "Empty the Trash without confirmation dialog." of Finder?](https://apple.stackexchange.com/questions/478225/how-to-disable-empty-the-trash-without-confirmation-dialog-of-finder)
* [What software shall I use for DFT on an organic molecule?](https://mattermodeling.stackexchange.com/questions/13938/what-software-shall-i-use-for-dft-on-an-organic-molecule)
* [Is intelligence the ability to reduce entropy in systems?](https://philosophy.stackexchange.com/questions/121890/is-intelligence-the-ability-to-reduce-entropy-in-systems)
* [What's stopping us from smuggling complexity and uncomputability into standard models of computation?](https://cs.stackexchange.com/questions/171106/whats-stopping-us-from-smuggling-complexity-and-uncomputability-into-standard-m)
* [What can a bear superhero use as a projectile?](https://worldbuilding.stackexchange.com/questions/264254/what-can-a-bear-superhero-use-as-a-projectile)
* [How to draw a book title using a trochoid in TikZ](https://tex.stackexchange.com/questions/735804/how-to-draw-a-book-title-using-a-trochoid-in-tikz)
* [I submitted a paper to a conference that I should not be submitting and it was accepted. What should I do?](https://academia.stackexchange.com/questions/216372/i-submitted-a-paper-to-a-conference-that-i-should-not-be-submitting-and-it-was-a)
* [primary outcomes in a non-inferiority clinical trial](https://stats.stackexchange.com/questions/660527/primary-outcomes-in-a-non-inferiority-clinical-trial)
* [Why is Surface Area to Volume Ratio different in different units?](https://math.stackexchange.com/questions/5027118/why-is-surface-area-to-volume-ratio-different-in-different-units)
* [Is the Origin header trustworthy for requests sent by the browser?](https://security.stackexchange.com/questions/280303/is-the-origin-header-trustworthy-for-requests-sent-by-the-browser)
* [Can I program a navigational great circle?](https://aviation.stackexchange.com/questions/107801/can-i-program-a-navigational-great-circle)
* [TVP vs JSON vs XML as input parameters in SQL Server](https://dba.stackexchange.com/questions/344921/tvp-vs-json-vs-xml-as-input-parameters-in-sql-server)
* [Is it okay to play two adjacent notes hammer-on when playing fast?](https://music.stackexchange.com/questions/138685/is-it-okay-to-play-two-adjacent-notes-hammer-on-when-playing-fast)
* [In Huxley's "Brave New World", what did these words mean "China's was hopelessly insecure by comparison"?](https://literature.stackexchange.com/questions/28662/in-huxleys-brave-new-world-what-did-these-words-mean-chinas-was-hopelessly)
* [What's the longest time period between an Executive Order being issued and revoked?](https://politics.stackexchange.com/questions/90393/whats-the-longest-time-period-between-an-executive-order-being-issued-and-revok)
* [Do pre-registered hypotheses need a correction for multiple comparisons?](https://stats.stackexchange.com/questions/660522/do-pre-registered-hypotheses-need-a-correction-for-multiple-comparisons)
* [Dissect shape into as few pieces as possible that can be reassembled into a square](https://puzzling.stackexchange.com/questions/130196/dissect-shape-into-as-few-pieces-as-possible-that-can-be-reassembled-into-a-squa)
* [Will the golem's recovery ability also apply to a golem copy created with the simulacrum spell?](https://rpg.stackexchange.com/questions/214482/will-the-golems-recovery-ability-also-apply-to-a-golem-copy-created-with-the-si)
* [Sci Fi movie from 70s where an alien plant would burn space explorers](https://scifi.stackexchange.com/questions/294459/sci-fi-movie-from-70s-where-an-alien-plant-would-burn-space-explorers)
* [When can we replace a function with some another function in a limit?](https://math.stackexchange.com/questions/5027643/when-can-we-replace-a-function-with-some-another-function-in-a-limit)
* [Could a lawyer be disbarred for fighting for a 'frankly unconstitutional position'?](https://law.stackexchange.com/questions/107012/could-a-lawyer-be-disbarred-for-fighting-for-a-frankly-unconstitutional-positio)
* [How to choose a suitable color for an eggshell?](https://mathematica.stackexchange.com/questions/310449/how-to-choose-a-suitable-color-for-an-eggshell)

more hot questions

[Question feed](/feeds/question/79481 "Feed of this question and its answers")

# Subscribe to RSS

Question feed

To subscribe to this RSS feed, copy and paste this URL into your RSS reader.

![](/posts/79481/ivc/e660?prg=d4995477-f377-4cdd-a52a-31de8414e56e)

##### [Bitcoin](/)

* [Tour](/tour)
* [Help](/help)
* [Chat](https://chat.stackexchange.com?tab=site&host=bitcoin.stackexchange.com)
* [Contact](/contact)
* [Feedback](https://bitcoin.meta.stackexchange.com)

##### [Company](https://stackoverflow.co/)

* [Stack Overflow](https://stackoverflow.com)
* [Teams](https://stackoverflow.co/teams/)
* [Advertising](https://stackoverflow.co/advertising/)
* [Talent](https://stackoverflow.co/advertising/employer-branding/)
* [About](https://stackoverflow.co/)
* [Press](https://stackoverflow.co/company/press/)
* [Legal](https://stackoverflow.com/legal)
* [Privacy Policy](https://stackoverflow.com/legal/privacy-policy)
* [Terms of Service](https://stackoverflow.com/legal/terms-of-service/public)
* Cookie Settings
* [Cookie Policy](https://stackoverflow.com/legal/cookie-policy)

##### [Stack Exchange Network](https://stackexchange.com)

* [Technology](https://stackexchange.com/sites#technology)
* [Culture & recreation](https://stackexchange.com/sites#culturerecreation)
* [Life & arts](https://stackexchange.com/sites#lifearts)
* [Science](https://stackexchange.com/sites#science)
* [Professional](https://stackexchange.com/sites#professional)
* [Business](https://stackexchange.com/sites#business)
* [API](https://api.stackexchange.com/)
* [Data](https://data.stackexchange.com/)

* [Blog](https://stackoverflow.blog?blb=1)
* [Facebook](https://www.facebook.com/officialstackoverflow/)
* [Twitter](https://twitter.com/stackoverflow)
* [LinkedIn](https://linkedin.com/company/stack-overflow)
* [Instagram](https://www.instagram.com/thestackoverflow)

Site design / logo © 2025 Stack Exchange Inc;
user contributions licensed under
[CC BY-SA](https://stackoverflow.com/help/licensing)
.
rev 2025.1.23.21485



=== Content from bitcoin.stackexchange.com_8b9ec2af_20250126_064129.html ===


[Skip to main content](#content)

#### Stack Exchange Network

Stack Exchange network consists of 183 Q&A communities including [Stack Overflow](https://stackoverflow.com), the largest, most trusted online community for developers to learn, share their knowledge, and build their careers.

[Visit Stack Exchange](https://stackexchange.com)

Loading…

* [Tour
  Start here for a quick overview of the site](/tour)
* [Help Center
  Detailed answers to any questions you might have](/help)
* [Meta
  Discuss the workings and policies of this site](https://bitcoin.meta.stackexchange.com)
* [About Us
  Learn more about Stack Overflow the company, and our products](https://stackoverflow.co/)

4. ### [current community](https://bitcoin.stackexchange.com)

   * [Bitcoin](https://bitcoin.stackexchange.com)

     [help](https://bitcoin.stackexchange.com/help)
     [chat](https://chat.stackexchange.com?tab=site&host=bitcoin.stackexchange.com)
   * [Bitcoin Meta](https://bitcoin.meta.stackexchange.com)
   ### your communities

   [Sign up](https://bitcoin.stackexchange.com/users/signup?ssrc=site_switcher&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work) or [log in](https://bitcoin.stackexchange.com/users/login?ssrc=site_switcher&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work) to customize your list.

   ### [more stack exchange communities](https://stackexchange.com/sites)

   [company blog](https://stackoverflow.blog)
6. [Log in](https://bitcoin.stackexchange.com/users/login?ssrc=head&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work)
7. [Sign up](https://bitcoin.stackexchange.com/users/signup?ssrc=head&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work)

[![Bitcoin](https://cdn.sstatic.net/Sites/bitcoin/Img/logo.svg?v=65edcd6e45f3)](https://bitcoin.stackexchange.com)

1. 1. [Home](/)
   2. [Questions](/questions)
   3. [Tags](/tags)
   5. [Users](/users)
   6. [Companies](https://stackoverflow.com/jobs/companies?so_medium=bitcoin&so_source=SiteNav)
   7. [Unanswered](/unanswered)
2. Teams
   ![](https://cdn.sstatic.net/Img/teams/teams-promo.svg?v=e507948b81bf)

   Ask questions, find answers and collaborate at work with Stack Overflow for Teams.

   [Try Teams for free](https://stackoverflowteams.com/teams/create/free/?utm_medium=referral&utm_source=bitcoin-community&utm_campaign=side-bar&utm_content=explore-teams)
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=bitcoin-community&utm_campaign=side-bar&utm_content=explore-teams)
3. Teams
4. Ask questions, find answers and collaborate at work with Stack Overflow for Teams.
   [Explore Teams](https://stackoverflow.co/teams/?utm_medium=referral&utm_source=bitcoin-community&utm_campaign=side-bar&utm_content=explore-teams-compact)

**Teams**

Q&A for work

Connect and share knowledge within a single location that is structured and easy to search.

[Learn more about Teams](https://stackoverflow.co/teams/)

# [How does the most recently found critical vulnerability (CVE-2018-17144) work?](/questions/79481/how-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work)

[Ask Question](/questions/ask)

Asked
6 years, 4 months ago

Modified
[6 years, 4 months ago](?lastactivity "2018-09-22 01:23:49Z")

Viewed
1k times

21

If you were a miner, what are the steps you would take to create the extra (21,000,012.5th) bitcoin?

Where in the source code is this exactly (link)?

Why can't this be done by a non-miner?

Also, which forks are/were vulnerable?

* [reward-schedule](/questions/tagged/reward-schedule "show questions tagged 'reward-schedule'")
* [error](/questions/tagged/error "show questions tagged 'error'")
* [weaknesses](/questions/tagged/weaknesses "show questions tagged 'weaknesses'")
* [source-code](/questions/tagged/source-code "show questions tagged 'source-code'")

[Share](/q/79481 "Short permalink to this question")

[Improve this question](/posts/79481/edit)

Follow

asked Sep 22, 2018 at 0:03

[![hedgedandlevered's user avatar](https://www.gravatar.com/avatar/040b21236346b0d22ef032e63fc06a04?s=64&d=identicon&r=PG)](/users/7144/hedgedandlevered)

[hedgedandlevered](/users/7144/hedgedandlevered)hedgedandlevered
1,50311 gold badge1010 silver badges2323 bronze badges

1

* 21 upvotes, very meta, good job everyone
  – [hedgedandlevered](/users/7144/hedgedandlevered "1,503 reputation")

  Commented
  Nov 29, 2023 at 19:19

Add a comment
 |

## 1 Answer 1

Sorted by:

[Reset to default](/questions/79481/how-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work?answertab=scoredesc#tab-top)

Highest score (default)

Date modified (newest first)

Date created (oldest first)

30

> If you were a miner, what are the steps you would take to create the extra (21,000,012.5th) bitcoin?
>
> Where in the source code is this exactly (link)?

There are two components to CVE-2018-17144. There is a crash bug and an inflation bug. Both are triggered by almost the same scenario: a transaction contains an input multiple times.

In general, how this would work is as follows: lets suppose a miner has an unspent output A for 1 BTC. They create a transaction with that input in twice, so input 1 spends from output A and input 2 *also* spends from output A. The output of that transaction has a value of 2 BTC. Note how the output's value is larger than the value of output A, but if you had output A twice, the value is correct.

The miner would then take this transaction and include it in a block that he is mining. Once the miner find a block with his transaction included in it, he broadcasts it to the Bitcoin network.

When a Bitcoin Core 0.14.x node receives this block, it will validate the block, but it will skip the duplicate input check because of [the `false` parameter on this line](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L2883). So the transaction the miner made will pass this step of validation, and the other transaction validation steps, including input script validation, until it reaches [this loop](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L1328). In this loop, the inputs to the transaction are being marked as spent in the UTXO database. The first time the duplicated input is seen, it is marked as spent. But the second time it is seen, the coin is already marked as spent so `coins->vout[nPos].IsNull()` will be true. This means that it will go into [this if statement](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L1332) and subsequently hit the [`assert` statement that follows](https://github.com/bitcoin/bitcoin/blob/v0.14.2/src/validation.cpp#L1333). The assert causes the software to crash.

For Bitcoin Core 0.15.0 - 0.16.2, the behavior is different. This is due to the change in how the UTXO database is structured. Everything is largely the same until the [same loop](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/validation.cpp#L1183) is reached. Here, instead of returning whether the output was spent, `SpendCoin` actually returns whether the input *exists* in the database. So the first time, it will pass as expected, but the second time, instead of returning `false`, it still returns `true`.

Looking at [`SpendCoin`](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/coins.cpp#L101), you can see that it only returns false when it is unable to fetch the coin (object representing a UTXO) from the database. With the new database structure, this makes sense as the output should be removed from the database when it is spent. But, if you [look a few lines down](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/coins.cpp#L109), you see that it only deletes the coin when it is marked as `FRESH`. In the case the coin was `FRESH`, `SpendCoin` would delete the object on the first pass so the second pass the coin would not be found and thus it would return false. This triggers the [`assert` following the function call](https://github.com/bitcoin/bitcoin/blob/v0.15.0/src/validation.cpp#L1186) causing the node to shutdown.

If the coin was not `FRESH`, the coin object itself is not deleted, but its contents are cleared. This means that the second time the input is seen, if the coin was not `FRESH`, `SpendCoin` would still return true as the object still exists in memory, which means that it passes the assert that follows the `SpendCoin` (which caused the crash when the coin was not `FRESH`). Then validation continues as normal, and the output this transaction created is added to the UTXO database, which means that money that shouldn't exist now exists in the UTXO database.

So now the question is, when are UTXOs marked as `FRESH`? They are marked `FRESH` when they are added to the UTXO database. But the UTXO database is still only in memory (as a cache). When it is saved to disk, the entries in memory are then no longer marked as `FRESH`. This saving to disk happens after every block (as well as at other times, but that is not important).

Thus, if a miner has an output that was part of a transaction that has already confirmed, and he spends the output twice in the same transaction (so the transaction has two inputs that refer to the same output), and this transaction is not broadcast to the network but instead included in a block that he mines, he is able to create a new output that has twice the value of the output that he spent, thereby creating coins.

> Why can't this be done by a non-miner?

The reason that this cannot be done by a non-miner is because transactions that are received outside of blocks are still checked for duplicate inputs. The transaction will be rejected as invalid and not added to the node's mempool, so the transaction will never get into a block. It is only transactions with duplicate inputs that get into blocks that trigger this vulnerability, and thus only miners can do this as they must knowingly insert an invalid transaction into their block.

> Also, which forks are/were vulnerable?

Any fork whose software includes commit [`eecffe50efc3944d713c701fa375dacbf17fb7cf`](https://github.com/bitcoin/bitcoin/pull/9049/commits/eecffe50efc3944d713c701fa375dacbf17fb7cf). This would mean any software forked from or pulled in changes from Bitcoin Core after November 10th, 2016.

[Share](/a/79484 "Short permalink to this answer")

[Improve this answer](/posts/79484/edit)

Follow

[edited Jun 16, 2020 at 11:10](/posts/79484/revisions "show all edits to this post")

[![Community's user avatar](https://www.gravatar.com/avatar/a007be5a61f6aa8f3e85ae2fc18dd66e?s=64&d=identicon&r=PG)](/users/-1/community)

[Community](/users/-1/community)Bot
1

answered Sep 22, 2018 at 1:23

[![Ava Chow's user avatar](https://www.gravatar.com/avatar/9276bf37b46395e93c63ef1c9ce34011?s=64&d=identicon&r=PG)](/users/48884/ava-chow)

[Ava Chow](/users/48884/ava-chow)♦Ava Chow
72.3k55 gold badges8484 silver badges162162 bronze badges

3

* Would a node that receives the block as a compact block check for the duplicate?
  – [Murch](/users/5406/murch "78,110 reputation")
  ♦
  Commented
  Sep 22, 2018 at 18:16
* 3

  No, it would not. The transaction with the duplicate input would not be in the mempool so it would be sent along with the block (as part of a `blocktxn` message). Such transactions are not run through the mempool acceptance code. Instead the block is reconstructed and run through the normal block acceptance code.
  – [Ava Chow](/users/48884/ava-chow "72,296 reputation")
  ♦
  Commented
  Sep 22, 2018 at 19:04
* Great write-up, thank you! It seems to me having a bool flag such as `fCheckDuplicateInputs` seems pretty unfortunate. It is quite easy to set it to an invalid value. I'm just wondering if we shouldn't be more explicit and verbose in those critical parts
  – [tsusanka](/users/61424/tsusanka "365 reputation")

  Commented
  Sep 26, 2018 at 7:54

Add a comment
 |

## Your Answer

Thanks for contributing an answer to Bitcoin Stack Exchange!

* Please be sure to *answer the question*. Provide details and share your research!

But *avoid* …

* Asking for help, clarification, or responding to other answers.
* Making statements based on opinion; back them up with references or personal experience.

To learn more, see our [tips on writing great answers](/help/how-to-answer).

Draft saved
Draft discarded

### Sign up or [log in](/users/login?ssrc=question_page&returnurl=https%3a%2f%2fbitcoin.stackexchange.com%2fquestions%2f79481%2fhow-does-the-most-recently-found-critical-vulnerability-cve-2018-17144-work%23new-answer)

 Sign up using Google

 Sign up using Email and Password

Submit
### Post as a guest

Name

Email

Required, but never shown

### Post as a guest

Name

Email

Required, but never shown

Post Your Answer

Discard

By clicking “Post Your Answer”, you agree to our [terms of service](https://stackoverflow.com/legal/terms-of-service/public) and acknowledge you have read our [privacy policy](https://stackoverflow.com/legal/privacy-policy).

## Not the answer you're looking for? Browse other questions tagged * [reward-schedule](/questions/tagged/reward-schedule "show questions tagged 'reward-schedule'") * [error](/questions/tagged/error "show questions tagged 'error'") * [weaknesses](/questions/tagged/weaknesses "show questions tagged 'weaknesses'") * [source-code](/questions/tagged/source-code "show questions tagged 'source-code'") or [ask your own question](/questions/ask).

* The Overflow Blog
* [How the internet changed in 2024](https://stackoverflow.blog/2025/01/24/how-the-internet-changed-in-2024/)
* [Why all developers should adopt a safety-critical mindset](https://stackoverflow.blog/2025/01/22/why-all-developers-should-adopt-a-safety-critical-mindset/)

#### Linked

[3](/q/79630 "Question score (upvotes - downvotes)")
[Why was this transaction accepted?](/questions/79630/why-was-this-transaction-accepted?noredirect=1)

#### Related

[9](/q/20247 "Question score (upvotes - downvotes)")
[Why does bitcoind say "error: couldn't connect to server" for the first few minutes of boot-up?](/questions/20247/why-does-bitcoind-say-error-couldnt-connect-to-server-for-the-first-few-minu)

[4](/q/22404 "Question score (upvotes - downvotes)")
[Why is Enjoy Sochi a malicious spam attack](/questions/22404/why-is-enjoy-sochi-a-malicious-spam-attack)

[1](/q/30440 "Question score (upvotes - downvotes)")
[What does this mean? RPC\_CLIENT\_NOT\_CONNECTED = -9, // Bitcoin is not connected](/questions/30440/what-does-this-mean-rpc-client-not-connected-9-bitcoin-is-not-connected)

[0](/q/69673 "Question score (upvotes - downvotes)")
[Bitcoin Source Code genesisOutputScript](/questions/69673/bitcoin-source-code-genesisoutputscript)

[1](/q/79979 "Question score (upvotes - downvotes)")
[Where in the source code are transaction validation checks implemented?](/questions/79979/where-in-the-source-code-are-transaction-validation-checks-implemented)

[0](/q/83170 "Question score (upvotes - downvotes)")
[Is there a way to create 9995000 spendable BTC on regtest?](/questions/83170/is-there-a-way-to-create-9995000-spendable-btc-on-regtest)

[1](/q/84791 "Question score (upvotes - downvotes)")
[where in the source code is the the proof of work checking the blockheader hash and nonce?](/questions/84791/where-in-the-source-code-is-the-the-proof-of-work-checking-the-blockheader-hash)

[0](/q/110268 "Question score (upvotes - downvotes)")
[How are there over 18M bitcoins when the reward halves every 210,000 bitcoins?](/questions/110268/how-are-there-over-18m-bitcoins-when-the-reward-halves-every-210-000-bitcoins)

[6](/q/114216 "Question score (upvotes - downvotes)")
[What is the purpose of indexing the mempool by these five criteria?](/questions/114216/what-is-the-purpose-of-indexing-the-mempool-by-these-five-criteria)

[6](/q/118367 "Question score (upvotes - downvotes)")
[How could Bitcoin developers handle and resolve severe software vulnerability without drawing public attention?](/questions/118367/how-could-bitcoin-developers-handle-and-resolve-severe-software-vulnerability-wi)

#### [Hot Network Questions](https://stackexchange.com/questions?tab=hot)

* [Am I exercising if my legs are being moved by a powered mechanical device?](https://fitness.stackexchange.com/questions/47461/am-i-exercising-if-my-legs-are-being-moved-by-a-powered-mechanical-device)
* [How do TARTs work (Transient Array Radio Telescopes), and can anyone build one and join the effort?](https://astronomy.stackexchange.com/questions/59344/how-do-tarts-work-transient-array-radio-telescopes-and-can-anyone-build-one-a)
* [Ideas to remount garage door bracket that is unable to attach securely to rotted part](https://diy.stackexchange.com/questions/313661/ideas-to-remount-garage-door-bracket-that-is-unable-to-attach-securely-to-rotted)
* [Could a lawyer be disbarred for fighting for a 'frankly unconstitutional position'?](https://law.stackexchange.com/questions/107012/could-a-lawyer-be-disbarred-for-fighting-for-a-frankly-unconstitutional-positio)
* [How old was King David when he took Bathsheba](https://judaism.stackexchange.com/questions/147264/how-old-was-king-david-when-he-took-bathsheba)
* [How to draw a book title using a trochoid in TikZ](https://tex.stackexchange.com/questions/735804/how-to-draw-a-book-title-using-a-trochoid-in-tikz)
* [Can these squares fit?](https://puzzling.stackexchange.com/questions/130223/can-these-squares-fit)
* [Is there a legal basis to challenge the executive order on federal gender markers?](https://law.stackexchange.com/questions/107035/is-there-a-legal-basis-to-challenge-the-executive-order-on-federal-gender-marker)
* [Fracture object without adding volume/internal faces](https://blender.stackexchange.com/questions/330291/fracture-object-without-adding-volume-internal-faces)
* [Can common diodes replace Zener diodes in ideal and purely theoretical circuits?](https://electronics.stackexchange.com/questions/737078/can-common-diodes-replace-zener-diodes-in-ideal-and-purely-theoretical-circuits)
* [Why is Surface Area to Volume Ratio different in different units?](https://math.stackexchange.com/questions/5027118/why-is-surface-area-to-volume-ratio-different-in-different-units)
* [Will the golem's recovery ability also apply to a golem copy created with the simulacrum spell?](https://rpg.stackexchange.com/questions/214482/will-the-golems-recovery-ability-also-apply-to-a-golem-copy-created-with-the-si)
* [Direct proof that every finitary algebraic category is well-copowered](https://mathoverflow.net/questions/486607/direct-proof-that-every-finitary-algebraic-category-is-well-copowered)
* [For a nation of super-intelligent children, why would childish doodles be the most efficient visual communication for them?](https://worldbuilding.stackexchange.com/questions/264237/for-a-nation-of-super-intelligent-children-why-would-childish-doodles-be-the-mo)
* [With the Invisibility spell, can you remain invisible while throwing vials?](https://rpg.stackexchange.com/questions/214476/with-the-invisibility-spell-can-you-remain-invisible-while-throwing-vials)
* [mkfs.ext4 to loop: 128-byte inodes cannot handle dates beyond 2038 and are deprecated](https://unix.stackexchange.com/questions/790031/mkfs-ext4-to-loop-128-byte-inodes-cannot-handle-dates-beyond-2038-and-are-depre)
* [Can pardons be discriminatory?](https://law.stackexchange.com/questions/106999/can-pardons-be-discriminatory)
* [primary outcomes in a non-inferiority clinical trial](https://stats.stackexchange.com/questions/660527/primary-outcomes-in-a-non-inferiority-clinical-trial)
* [What does the following message from editor mean?](https://academia.stackexchange.com/questions/216353/what-does-the-following-message-from-editor-mean)
* [How would a military with advanced tech compared to all others develop differently from those that must deal with genuine equals?](https://worldbuilding.stackexchange.com/questions/264276/how-would-a-military-with-advanced-tech-compared-to-all-others-develop-different)
* ["You’ve got quite THE load to carry." | "You’ve got quite A load to carry."](https://ell.stackexchange.com/questions/361588/you-ve-got-quite-the-load-to-carry-you-ve-got-quite-a-load-to-carry)
* [Are ought-statements simply is-statements in disguise?](https://philosophy.stackexchange.com/questions/121860/are-ought-statements-simply-is-statements-in-disguise)
* [When flying a great circle route, does the pilot have to continuously "turn the plane" to stay on the arc?](https://aviation.stackexchange.com/questions/107791/when-flying-a-great-circle-route-does-the-pilot-have-to-continuously-turn-the)
* [What software shall I use for DFT on an organic molecule?](https://mattermodeling.stackexchange.com/questions/13938/what-software-shall-i-use-for-dft-on-an-organic-molecule)

more hot questions

[Question feed](/feeds/question/79481 "Feed of this question and its answers")

# Subscribe to RSS

Question feed

To subscribe to this RSS feed, copy and paste this URL into your RSS reader.

![](/posts/79481/ivc/e660?prg=ad00e8ce-5ca8-4312-b83e-da39a82755a3)

##### [Bitcoin](/)

* [Tour](/tour)
* [Help](/help)
* [Chat](https://chat.stackexchange.com?tab=site&host=bitcoin.stackexchange.com)
* [Contact](/contact)
* [Feedback](https://bitcoin.meta.stackexchange.com)

##### [Company](https://stackoverflow.co/)

* [Stack Overflow](https://stackoverflow.com)
* [Teams](https://stackoverflow.co/teams/)
* [Advertising](https://stackoverflow.co/advertising/)
* [Talent](https://stackoverflow.co/advertising/employer-branding/)
* [About](https://stackoverflow.co/)
* [Press](https://stackoverflow.co/company/press/)
* [Legal](https://stackoverflow.com/legal)
* [Privacy Policy](https://stackoverflow.com/legal/privacy-policy)
* [Terms of Service](https://stackoverflow.com/legal/terms-of-service/public)
* Cookie Settings
* [Cookie Policy](https://stackoverflow.com/legal/cookie-policy)

##### [Stack Exchange Network](https://stackexchange.com)

* [Technology](https://stackexchange.com/sites#technology)
* [Culture & recreation](https://stackexchange.com/sites#culturerecreation)
* [Life & arts](https://stackexchange.com/sites#lifearts)
* [Science](https://stackexchange.com/sites#science)
* [Professional](https://stackexchange.com/sites#professional)
* [Business](https://stackexchange.com/sites#business)
* [API](https://api.stackexchange.com/)
* [Data](https://data.stackexchange.com/)

* [Blog](https://stackoverflow.blog?blb=1)
* [Facebook](https://www.facebook.com/officialstackoverflow/)
* [Twitter](https://twitter.com/stackoverflow)
* [LinkedIn](https://linkedin.com/company/stack-overflow)
* [Instagram](https://www.instagram.com/thestackoverflow)

Site design / logo © 2025 Stack Exchange Inc;
user contributions licensed under
[CC BY-SA](https://stackoverflow.com/help/licensing)
.
rev 2025.1.23.21485



=== Content from github.com_3c81d796_20250126_064121.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Ftree%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Ftree%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Ffiles%2Fdisambiguate&source=header-repo&source_repo=JinBean%2FCVE-Extension)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JinBean](/JinBean)
/
**[CVE-Extension](/JinBean/CVE-Extension)**
Public

* [Notifications](/login?return_to=%2FJinBean%2FCVE-Extension) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2FJinBean%2FCVE-Extension)
* [Star
   3](/login?return_to=%2FJinBean%2FCVE-Extension)

* [Code](/JinBean/CVE-Extension)
* [Issues
  0](/JinBean/CVE-Extension/issues)
* [Pull requests
  0](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects
  0](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

Additional navigation options

* [Code](/JinBean/CVE-Extension)
* [Issues](/JinBean/CVE-Extension/issues)
* [Pull requests](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

## Files

 master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
/
# Bitcoin-0.14.X

/Copy path
## Directory actions

## More options

## Directory actions

## More options

## Latest commit

## History

[History](/JinBean/CVE-Extension/commits/master/CVE-2018-17144/Bitcoin-0.14.X) master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
/
# Bitcoin-0.14.X

/Top
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| parent directory[..](/JinBean/CVE-Extension/tree/master/CVE-2018-17144) | | |
| [validation.cpp](/JinBean/CVE-Extension/blob/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp "validation.cpp") | | [validation.cpp](/JinBean/CVE-Extension/blob/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp "validation.cpp") |  |  |
| View all files | | |

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from en.bitcoin.it_ef92f3e2_20250125_062017.html ===


# Common Vulnerabilities and Exposures

From Bitcoin Wiki

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)

| CVE | Announced | Affects | Severity | Attack is... | Flaw | Net |
| --- | --- | --- | --- | --- | --- | --- |
| Pre-BIP protocol changes | n/a | All Bitcoin clients | Netsplit[[1]](#cite_note-Netsplit-1) | Implicit[[2]](#cite_note-hardfork-2) | [Various hardforks and softforks](/wiki/Consensus_versions "Consensus versions") | 100% |
| [CVE-2010-5137](#CVE-2010-5137) | 2010-07-28 | wxBitcoin and bitcoind | DoS[[3]](#cite_note-DoS-3) | Easy | OP\_LSHIFT crash | 100% |
| [CVE-2010-5141](#CVE-2010-5141) | 2010-07-28 | wxBitcoin and bitcoind | Theft[[4]](#cite_note-Theft-4) | Easy | OP\_RETURN could be used to spend any output. | 100% |
| [CVE-2010-5138](#CVE-2010-5138) | 2010-07-29 | wxBitcoin and bitcoind | DoS[[3]](#cite_note-DoS-3) | Easy | Unlimited SigOp DoS | 100% |
| **[CVE-2010-5139](/wiki/CVE-2010-5139 "CVE-2010-5139")** | 2010-08-15 | wxBitcoin and bitcoind | Inflation[[5]](#cite_note-inflation-5) | Easy | Combined output overflow | 100% |
| [CVE-2010-5140](#CVE-2010-5140) | 2010-09-29 | wxBitcoin and bitcoind | DoS[[3]](#cite_note-DoS-3) | Easy | Never confirming transactions | 100% |
| [CVE-2011-4447](#CVE-2011-4447) | 2011-11-11 | wxBitcoin and bitcoind | Exposure[[6]](#cite_note-Exposure-6) | Hard | Wallet non-encryption | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/CVE-2011-4447.html) |
| [CVE-2012-1909](#CVE-2012-1909) | 2012-03-07 | Bitcoin protocol and all clients | Netsplit[[1]](#cite_note-Netsplit-1) | Very hard | Transaction overwriting | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/CVE-2012-1909.html) |
| [CVE-2012-1910](#CVE-2012-1910) | 2012-03-17 | bitcoind & Bitcoin-Qt for Windows | Unknown[[7]](#cite_note-Unknown-7) | Hard | Non-thread safe MingW exceptions | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/CVE-2012-1910.html) |
| [BIP 0016](#BIP-0016) | 2012-04-01 | All Bitcoin clients | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softfork: P2SH | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/BIP-0016.html) |
| [CVE-2012-2459](#CVE-2012-2459) | 2012-05-14 | bitcoind and Bitcoin-Qt | Netsplit[[1]](#cite_note-Netsplit-1) | Easy | Block hash collision (via merkle root) | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/CVE-2012-2459.html) |
| **[CVE-2012-3789](/wiki/CVE-2012-3789 "CVE-2012-3789")** | 2012-06-20 | bitcoind and Bitcoin-Qt | DoS[[3]](#cite_note-DoS-3) | Easy | (Lack of) orphan txn resource limits | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20123789) |
| [CVE-2012-4682](#CVE-2012-4682) |  | bitcoind and Bitcoin-Qt | DoS[[3]](#cite_note-DoS-3) |  |  | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/CVE-2012-4682.html) |
| **[CVE-2012-4683](/wiki/CVE-2012-4683 "CVE-2012-4683")** | 2012-08-23 | bitcoind and Bitcoin-Qt | DoS[[3]](#cite_note-DoS-3) | Easy | Targeted DoS by CPU exhaustion using alerts | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/CVE-2012-4683.html) |
| **[CVE-2012-4684](/wiki/CVE-2012-4684 "CVE-2012-4684")** | 2012-08-24 | bitcoind and Bitcoin-Qt | DoS[[3]](#cite_note-DoS-3) | Easy | Network-wide DoS using malleable signatures in alerts | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20124684) |
| [CVE-2013-2272](#CVE-2013-2272) | 2013-01-11 | bitcoind and Bitcoin-Qt | Exposure[[6]](#cite_note-Exposure-6) | Easy | Remote discovery of node's wallet addresses | [99.99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20132272) |
| [CVE-2013-2273](#CVE-2013-2273) | 2013-01-30 | bitcoind and Bitcoin-Qt | Exposure[[6]](#cite_note-Exposure-6) | Easy | Predictable change output | [99.99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20132273) |
| [CVE-2013-2292](#CVE-2013-2292) | 2013-01-30 | bitcoind and Bitcoin-Qt | DoS[[3]](#cite_note-DoS-3) | Hard | A transaction that takes at least 3 minutes to verify | [0%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20132292) |
| **[CVE-2013-2293](/wiki/CVE-2013-2293 "CVE-2013-2293")** | 2013-02-14 | bitcoind and Bitcoin-Qt | DoS[[3]](#cite_note-DoS-3) | Easy | Continuous hard disk seek | [99.99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20132293) |
| [CVE-2013-3219](#CVE-2013-3219) | 2013-03-11 | bitcoind and Bitcoin-Qt 0.8.0 | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Unenforced block protocol rule | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20133219) |
| [CVE-2013-3220](#CVE-2013-3220) | 2013-03-11 | bitcoind and Bitcoin-Qt | Netsplit[[1]](#cite_note-Netsplit-1) | Hard | Inconsistent BDB lock limit interactions | [99.99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20133220) |
| [BIP 0034](#BIP-0034) | 2013-03-25 | All Bitcoin clients | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softfork: Height in coinbase | [100%](http://luke.dashjr.org/programs/bitcoin/files/charts/BIP-0034.html) |
| [BIP 0050](#BIP-0050) | 2013-05-15 | All Bitcoin clients | Netsplit[[1]](#cite_note-Netsplit-1) | Implicit[[2]](#cite_note-hardfork-2) | Hard fork to remove txid limit protocol rule | [99.99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?50) |
| [CVE-2013-4627](#CVE-2013-4627) | 2013-06-?? | bitcoind and Bitcoin-Qt | DoS[[3]](#cite_note-DoS-3) | Easy | Memory exhaustion with excess tx message data | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20134627) |
| [CVE-2013-4165](#CVE-2013-4165) | 2013-07-20 | bitcoind and Bitcoin-Qt | Theft[[10]](#cite_note-theft-local-timing-10) | Local | Timing leak in RPC authentication | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20134165) |
| [CVE-2013-5700](#CVE-2013-5700) | 2013-09-04 | bitcoind and Bitcoin-Qt 0.8.x | DoS[[3]](#cite_note-DoS-3) | Easy | Remote p2p crash via bloom filters | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20135700) |
| [CVE-2014-0160](#CVE-2014-0160) | 2014-04-07 | Anything using OpenSSL for TLS | Unknown[[7]](#cite_note-Unknown-7) | Easy | Remote memory leak via payment protocol | Unknown |
| [CVE-2015-3641](https://bitcoincore.org/en/2024/07/03/disclose_receive_buffer_oom/) | 2014-07-07 | bitcoind and Bitcoin-Qt prior to 0.10.2 | DoS[[3]](#cite_note-DoS-3) | Easy | OOM via p2p | [99.9%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20135700) |
| BIP 66 | 2015-02-13 | All Bitcoin clients | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softfork: Strict DER signatures | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?66) |
| BIP 65 | 2015-11-12 | All Bitcoin clients | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softfork: OP\_CHECKLOCKTIMEVERIFY | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?65) |
| BIPs 68, 112 & 113 | 2016-04-11 | All Bitcoin clients | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softforks: Rel locktime, CSV & MTP locktime | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?68) |
| CVE-2015-6031 | 2015-09-15 | MiniUPnPcBitcoin Core/Knots prior to 0.11.2 | Anything | LAN | Buffer overflow |
| BIPs 141, 143 & 147 | 2016-10-27 | All Bitcoin clients | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softfork: Segwit | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?141) |
| [CVE-2016-8889](#CVE-2016-8889) | 2016-10-27 | Bitcoin Knots GUI 0.11.0 - 0.13.0 | Exposure | Hard | Debug console history storing sensitive info | 100% |
| CVE-2017-9230 | ? | Bitcoin | ? | ? | ASICBoost | 0% |
| BIP 148 | 2017-03-12 | All Bitcoin clients | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softfork: Segwit UASF | ? |
| [CVE-2017-12842](#CVE-2017-12842) | 2018-06-09 |  |  |  | No commitment to block merkle tree depth |  |
| [CVE-2016-10724](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-July/016189.html) | 2018-07-02 | bitcoind and Bitcoin-Qt prior to 0.13.0 | DoS[[3]](#cite_note-DoS-3) | Keyholders[[11]](#cite_note-KeyholderEasy-11) | Alert memory exhaustion | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?201610724) |
| [TBD](https://bitcoincore.org/en/2024/07/03/disclose-header-spam/) | 2024-07-03 | Bitcoin Core/Knots prior to 0.15.0 | DoS[[3]](#cite_note-DoS-3) | Easy | OOM via fake block headers |
| [CVE-2016-10725](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2018-July/016189.html) | 2018-07-02 | bitcoind and Bitcoin-Qt prior to 0.13.0 | DoS[[3]](#cite_note-DoS-3) | Keyholders[[11]](#cite_note-KeyholderEasy-11) | Final alert cancellation | [99%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?201610724) |
| [CVE-2018-17144](#CVE-2018-17144) | 2018-09-17 | bitcoind and Bitcoin-Qt prior to 0.16.3 | Inflation[[5]](#cite_note-inflation-5) | Miners[[9]](#cite_note-MinerEasy-9) | Missing check for duplicate inputs | [80%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?201817144) |
| [CVE-2018-20587](https://medium.com/%40lukedashjr/cve-2018-20587-advisory-and-full-disclosure-a3105551e78b) | 2019-02-08 | Bitcoin Knots prior to 0.17.1, and all current Bitcoin Core releases | Theft[[10]](#cite_note-theft-local-timing-10) | Local | No alert for RPC service binding failure | [<1%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?201820587) |
| [CVE-2017-18350](#CVE-2017-18350) | 2019-06-22 | bitcoind and Bitcoin-Qt prior to 0.15.1 | Unknown | Varies[[12]](#cite_note-12) | Buffer overflow from SOCKS proxy | [94%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?201718350) |
| [CVE-2018-20586](#CVE-2018-20586) | 2019-06-22 | bitcoind and Bitcoin-Qt prior to 0.17.1 | Deception | RPC access | Debug log injection via unauthenticated RPC | [77%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?201820586) |
| [TBD](https://bitcoincore.org/en/2024/07/03/disclose-orphan-dos/) | 2024-07-03 | Bitcoin Core/Knots prior to 0.18.0 | DoS | Easy | Orphan transaction CPU tieup |
| [CVE-2019-12998](https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-September/002174.html) | 2019-08-30 | c-lightning prior to 0.7.1 | Theft | Easy | Missing check of channel funding UTXO |
| [CVE-2019-12999](https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-September/002174.html) | 2019-08-30 | lnd prior to 0.7 | Theft | Easy | Missing check of channel funding UTXO amount |
| [CVE-2019-13000](https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-September/002174.html) | 2019-08-30 | eclair prior to 0.3 | Theft | Easy | Missing check of channel funding UTXO |
| [TBD](https://bitcoincore.org/en/2024/07/03/disclose-inv-buffer-blowup/) | 2024-07-03 | Bitcoin Core/Knots prior to 0.20.0 | DoS | Easy | Network buffer OOM |
| [TBD](https://bitcoincore.org/en/2024/07/03/disclose-getdata-cpu/) | 2024-07-03 | Bitcoin Core/Knots prior to 0.20.0 | CPU usage | Easy | Infinite loop via p2p |
| [TBD](https://bitcoincore.org/en/2024/07/03/disclose-bip70-crash/) | 2024-07-03 | Bitcoin Core/Knots prior to 0.20.0 | DoS | Recipient[[13]](#cite_note-Recipient-13) | OOM via malicious BIP72 URI |
| [CVE-2020-14199](#CVE-2020-14199) | 2020-06-03 | Trezor and others | Theft | Social[[14]](#cite_note-14) | Double-signing can enable unintended fees |
| [CVE-2018-17145](https://invdos.net/) | 2020-09-09 | Bitcoin Core prior to 0.16.2Bitcoin Knots prior to 0.16.1Bcoin prior to 1.0.2Btcd prior to 0.21.0 | DoS[[3]](#cite_note-DoS-3) | Easy | p2p memory blow-up | [87%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?201817145) |
| [CVE-2020-26895](#CVE-2020-26895) | 2020-10-08 | lnd prior to 0.10 | Theft | Easy | Missing low-S normalization for HTLC signatures |
| [CVE-2020-26896](#CVE-2020-26896) | 2020-10-08 | lnd prior to 0.11 | Theft | Varies[[15]](#cite_note-15) | Invoice preimage extraction via forwarded HTLC |
| [CVE-2020-14198](https://bitcoincore.org/en/2024/07/03/disclose-unbounded-banlist/) |  | Bitcoin Core 0.20.1 | DoS[[3]](#cite_note-DoS-3) | Easy | Remote DoS | [93%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?202014198) |
| [TBD](https://bitcoincore.org/en/2024/07/03/disclose-timestamp-overflow/) | 2024-07-03 | Bitcoin Core/Knots prior to 0.20.2 | Netsplit[[1]](#cite_note-Netsplit-1) | Varies | Adjusted time manipulation |
| [CVE-2021-3401](#CVE-2021-3401) | 2021-02-01 | Bitcoin Core GUI prior to 0.19.0Bitcoin Knots GUI prior to 0.18.1 | Theft | Hard | Qt5 remote execution | [64%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?20213401) |
| [TBD](https://bitcoincore.org/en/2024/07/31/disclose-upnp-oom/) | 2024-07-31 | Bitcoin Core/Knots prior to 22.0 with UPnP enabled | DoS | Local | OOM via LAN spam |
| [TBD](https://bitcoincore.org/en/2024/07/31/disclose-addrman-int-overflow/) | 2024-07-31 | Bitcoin Core/Knots prior to 22.0 | DoS | Easy | OOM via p2p spam |
| [CVE-2021-31876](#CVE-2021-31876) | 2021-05-06 | Various wallets |  |  |  |
| CVE-2021-41591 | 2021-10-04 | Lightning software |  |  |  |
| CVE-2021-41592 | 2021-10-04 | Lightning software |  |  |  |
| CVE-2021-41593 | 2021-10-04 | Lightning software |  |  |  |
| BIPs 341-343 | 2021-11-13 | All Bitcoin nodes | Fake Conf[[8]](#cite_note-FakeConf-8) | Miners[[9]](#cite_note-MinerEasy-9) | Softfork: Taproot | [57%](http://luke.dashjr.org/programs/bitcoin/files/charts/security.html?343) |
| [CVE-2022-31246](https://github.com/spesmilo/electrum/security/advisories/GHSA-4fh4-hx35-r355) | 2022-06-07 | Electrum 2.1 until before 4.2.2 | Theft | Social |  |
| [CVE-2023-50428](#CVE-2023-50428) | 2023 | All Bitcoin nodes | DoS[[3]](#cite_note-DoS-3) | Easy | Bypass of datacarriersize limit using OP\_FALSE,OP\_IF |  |
| [CVE-2024-34149](#CVE-2024-34149) | 2024-03-30 | Bitcoin Core 0.21.1 and newer (not fixed)Bitcoin Knots 0.21.1 - 0.23.0 | DoS[[3]](#cite_note-DoS-3) | Easy | Script size limit not enforced for Tapscript |  |

1. ↑ [1.0](#cite_ref-Netsplit_1-0) [1.1](#cite_ref-Netsplit_1-1) [1.2](#cite_ref-Netsplit_1-2) [1.3](#cite_ref-Netsplit_1-3) [1.4](#cite_ref-Netsplit_1-4) [1.5](#cite_ref-Netsplit_1-5) Attacker can create multiple views of the network, enabling [double-spending](/wiki/Double-spending "Double-spending") with over 1 confirmation
2. ↑ [2.0](#cite_ref-hardfork_2-0) [2.1](#cite_ref-hardfork_2-1) This is a protocol "hard-fork" that old clients will reject as invalid and must therefore not be used.
3. ↑ [3.00](#cite_ref-DoS_3-0) [3.01](#cite_ref-DoS_3-1) [3.02](#cite_ref-DoS_3-2) [3.03](#cite_ref-DoS_3-3) [3.04](#cite_ref-DoS_3-4) [3.05](#cite_ref-DoS_3-5) [3.06](#cite_ref-DoS_3-6) [3.07](#cite_ref-DoS_3-7) [3.08](#cite_ref-DoS_3-8) [3.09](#cite_ref-DoS_3-9) [3.10](#cite_ref-DoS_3-10) [3.11](#cite_ref-DoS_3-11) [3.12](#cite_ref-DoS_3-12) [3.13](#cite_ref-DoS_3-13) [3.14](#cite_ref-DoS_3-14) [3.15](#cite_ref-DoS_3-15) [3.16](#cite_ref-DoS_3-16) [3.17](#cite_ref-DoS_3-17) [3.18](#cite_ref-DoS_3-18) Attacker can disable some functionality, for example by crashing clients
4. [↑](#cite_ref-Theft_4-0) Attacker can take coins outside known network rules
5. ↑ [5.0](#cite_ref-inflation_5-0) [5.1](#cite_ref-inflation_5-1) Attacker can create coins outside known network rules
6. ↑ [6.0](#cite_ref-Exposure_6-0) [6.1](#cite_ref-Exposure_6-1) [6.2](#cite_ref-Exposure_6-2) Attacker can access user data outside known acceptable methods
7. ↑ [7.0](#cite_ref-Unknown_7-0) [7.1](#cite_ref-Unknown_7-1) Extent of possible abuse is unknown
8. ↑ [8.0](#cite_ref-FakeConf_8-0) [8.1](#cite_ref-FakeConf_8-1) [8.2](#cite_ref-FakeConf_8-2) [8.3](#cite_ref-FakeConf_8-3) [8.4](#cite_ref-FakeConf_8-4) [8.5](#cite_ref-FakeConf_8-5) [8.6](#cite_ref-FakeConf_8-6) [8.7](#cite_ref-FakeConf_8-7) [8.8](#cite_ref-FakeConf_8-8) Attacker can double-spend with 1 confirmation
9. ↑ [9.00](#cite_ref-MinerEasy_9-0) [9.01](#cite_ref-MinerEasy_9-1) [9.02](#cite_ref-MinerEasy_9-2) [9.03](#cite_ref-MinerEasy_9-3) [9.04](#cite_ref-MinerEasy_9-4) [9.05](#cite_ref-MinerEasy_9-5) [9.06](#cite_ref-MinerEasy_9-6) [9.07](#cite_ref-MinerEasy_9-7) [9.08](#cite_ref-MinerEasy_9-8) [9.09](#cite_ref-MinerEasy_9-9) Attacking requires mining block(s)
10. ↑ [10.0](#cite_ref-theft-local-timing_10-0) [10.1](#cite_ref-theft-local-timing_10-1) Local attacker could potentially determine the RPC passphrase via a timing sidechannel.
11. ↑ [11.0](#cite_ref-KeyholderEasy_11-0) [11.1](#cite_ref-KeyholderEasy_11-1) Attacking requires signing with the publicly-disclosed alert key
12. [↑](#cite_ref-12) Depends on software configuration
13. [↑](#cite_ref-Recipient_13-0) Can only be exploited by the recipient the victim intends to pay
14. [↑](#cite_ref-14) User must be tricked into cooperating (social engineering)
15. [↑](#cite_ref-15) Depends on node configuration, only affects routable merchants, requires external knowledge of receiver's invoices and/or luck to identify receiver, only works against single-shot HTLCs (legacy or MPP)

## CVE-2010-5137

```
Date: 2010-07-28
Summary: OP_LSHIFT crash
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| bitcoindwxBitcoin | \* - 0.3.4 | 0.3.5 |

On July 28 2010, two bugs were discovered and demonstrated on the test network. One caused bitcoin to crash on some machines when processing a transaction containing an OP\_LSHIFT. This was never exploited on the main network, and was fixed by Bitcoin version 0.3.5.

After these bugs were discovered, many currently-unused script words were disabled for safety.

### References

* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2010-5137)

## CVE-2010-5141

```
Date: 2010-07-28
Summary: ?
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| bitcoindwxBitcoin | \* - 0.3.4 | 0.3.5 |

On July 28 2010, two bugs were discovered and demonstrated on the test network. One exploited a bug in the transaction handling code and allowed an attacker to spend coins that they did not own. This was never exploited on the main network, and was fixed by Bitcoin version 0.3.5.

After these bugs were discovered, many currently-unused script words were disabled for safety.

### References

* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2010-5141)

## CVE-2010-5138

```
Date: 2010-07-29
Summary: Unlimited SigOp DoS
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| bitcoindwxBitcoin | \* - 0.3.? | 0.3.? |

On July 29 2010, it was discovered that block [71036](http://blockexplorer.com/block/00000000000997f9fd2fe1ee376293ef8c42ad09193a5d2086dddf8e5c426b56) contained several transactions with a ton of OP\_CHECKSIG commands. There should only ever be one such command. This caused every node to do extra unnecessary work, and it could have been used as a denial-of-service attack. A new version of Bitcoin was quickly released. The new version did not cause a fork on the main network, though it did cause one on the test network (where someone had played around with the attack more).

### References

* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2010-5138)

## CVE-2010-5139

*Main article: [CVE-2010-5139](/wiki/CVE-2010-5139 "CVE-2010-5139")*
```
Date: 2010-08-15
Summary: Combined output overflow
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| bitcoindwxBitcoin | \* - 0.3.10 | 0.3.11 |

On August 15 2010, it was [discovered](http://bitcointalk.org/index.php?topic=822.0) that block 74638 contained a transaction that created over 184 billion bitcoins for two different addresses. This was possible because the code used for checking transactions before including them in a block didn't account for the case of outputs so large that they overflowed when summed. A new version was published within a few hours of the discovery. The block chain had to be forked. Although many unpatched nodes continued to build on the "bad" block chain, the "good" block chain overtook it at a block height of 74691. The bad transaction no longer exists for people using the longest chain.

The block and transaction:

```
CBlock(hash=0000000000790ab3, ver=1, hashPrevBlock=0000000000606865, hashMerkleRoot=618eba,
nTime=1281891957, nBits=1c00800e, nNonce=28192719, vtx=2)
  CTransaction(hash=012cd8, ver=1, vin.size=1, vout.size=1, nLockTime=0)
    CTxIn(COutPoint(000000, -1), coinbase 040e80001c028f00)
    CTxOut(nValue=50.51000000, scriptPubKey=0x4F4BA55D1580F8C3A8A2C7)
  CTransaction(hash=1d5e51, ver=1, vin.size=1, vout.size=2, nLockTime=0)
    CTxIn(COutPoint(237fe8, 0), scriptSig=0xA87C02384E1F184B79C6AC)
    CTxOut(nValue=92233720368.54275808, scriptPubKey=OP_DUP OP_HASH160 0xB7A7)
    CTxOut(nValue=92233720368.54275808, scriptPubKey=OP_DUP OP_HASH160 0x1512)
  vMerkleTree: 012cd8 1d5e51 618eba

Block hash: 0000000000790ab3f22ec756ad43b6ab569abf0bddeb97c67a6f7b1470a7ec1c
Transaction hash: 1d5e512a9723cbef373b970eb52f1e9598ad67e7408077a82fdac194b65333c9
```
### References

* [Discovery](https://bitcointalk.org/index.php?topic=822.0)
* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2010-5139)

## CVE-2010-5140

```
Date: 2010-09-29
Summary: Never confirming transactions
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| bitcoindwxBitcoin | \* - 0.3.12 | 0.3.13 |

Around September 29, 2010, people started [reporting](https://bitcointalk.org/index.php?topic=1306.0) that their sent transactions would not confirm. This happened because people modified Bitcoin to send sub-0.01 transactions without any fees. A 0.01 fee was at that time required by the network for such transactions (essentially prohibiting them), so the transactions remained at 0 confirmations forever. This became a more serious issue because Bitcoin would send transactions using bitcoins gotten from transactions with 0 confirmations, and these resulting transactions would also never confirm. Because Bitcoin tends to prefer sending smaller coins, these invalid transactions quickly multiplied, contaminating the wallets of everyone who received them.

Bitcoin was changed to only select coins with at least 1 confirmation. The remaining sub-0.01 transactions were cleared by generators who modified their version of Bitcoin to not require the micropayment fee. It took a while for everything to get cleared, though, because many of the intermediate transactions had been forgotten by the network by this point and had to be rebroadcast by the original senders.

### References

* [Initial reports](https://bitcointalk.org/index.php?topic=1306.0)
* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2010-5140)

## CVE-2011-4447

```
Date: 2011-11-11
Summary: Wallet non-encryption
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| bitcoindwxBitcoin | 0.4.0 - 0.4.1rc6 | 0.4.10.5.0 |

### References

* [Announcement](https://bitcointalk.org/index.php?topic=51604.0)
* [Finding](https://bitcointalk.org/index.php?topic=51474.0)
* [0.5.0](http://bitcoin.org/releases/2011/11/21/v0.5.0.html)
* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2011-4447)

## CVE-2012-1909

```
Date: 2012-03-07
Summary: Transaction overwriting
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin protocol | Before March 15th, 2012 | BIP 30 |
| Bitcoin-Qtbitcoind | \* - 0.4.4rc20.5.0rc1 - 0.5.0.4rc20.5.1rc1 - 0.5.3rc20.6.0rc1 - 0.6.0rc2 | 0.4.40.5.0.40.5.30.6.0rc3 |
| wxBitcoin | ALL | NONE |

### References

* [Announcement](https://bitcointalk.org/index.php?topic=67738.0)
* [Fix](https://en.bitcoin.it/wiki/BIP_0030)
* [Gentoo bug tracker](https://bugs.gentoo.org/show_bug.cgi?id=407793)
* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2012-1909)

## CVE-2012-1910

```
Date: 2012-03-17
Summary: Non-thread safe MingW exceptions
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| bitcoind for WindowsBitcoin-Qt for Windows | 0.5.0rc1 - 0.5.0.40.5.1rc1 - 0.5.3.00.6.0rc1 - 0.6.0rc3 | 0.5.0.50.5.3.10.5.40.6.0rc4 |

### References

* [Announcement](https://bitcointalk.org/index.php?topic=69120.0)
* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2012-1910)
* [Full disclosure](http://gavintech.blogspot.com/2012/03/full-disclosure-bitcoin-qt-on-windows.html)

## BIP-0016

```
Date: 2012-04-01
Summary: Mandatory P2SH protocol update
Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.40.5.0rc1 - 0.5.0.50.5.1rc1 - 0.5.30.6.0rc1 | 0.4.50.5.0.60.5.4rc10.6.0rc2 |
| wxBitcoin | ALL | NONE |

### References

* [BIP 0016](/wiki/BIP_0016 "BIP 0016")

## CVE-2012-2459

```
Date: 2012-05-14
Summary: Block hash collision (via merkle tree)
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.6rc10.5.0rc1 - 0.5.5rc10.6.0rc1 - 0.6.0.7rc10.6.1rc1 - 0.6.1rc1 | 0.4.60.5.50.6.0.70.6.1rc2 |

Block hash collisions can easily be made by duplicating transactions in the merkle tree.
Such a collision is invalid, but if recorded (as Bitcoin-Qt and bitcoind prior to 0.6.1 did) would prevent acceptance of the legitimate block with the same hash.
This could be used to fork the blockchain, including deep double-spend attacks.

### References

* [Announcement](https://bitcointalk.org/?topic=81749)
* [Gentoo bug tracker](https://bugs.gentoo.org/show_bug.cgi?id=415973)
* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2012-2459)
* [Full Disclosure](https://bitcointalk.org/?topic=102395)

## CVE-2012-3789

*Main article: [CVE-2012-3789](/wiki/CVE-2012-3789 "CVE-2012-3789")*
```
Date: 2012-06-20
Summary: (Lack of) orphan txn resource limits
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.7rc20.5.0rc1 - 0.5.6rc20.6.0rc1 - 0.6.0.8rc20.6.1rc1 - 0.6.2.2 | 0.4.7rc30.5.6rc30.6.0.9rc10.6.3rc1 |

### References

* [CVE-2012-3789](/wiki/CVE-2012-3789 "CVE-2012-3789")
* [0.6.3rc1 Announcement](https://bitcointalk.org/?topic=88734)
* [US-CERT/NIST](http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2012-3789)

## CVE-2012-4682

```
Date:
Summary:
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.7rc20.5.0rc1 - 0.5.6rc20.6.0rc1 - 0.6.0.8rc20.6.1rc1 - 0.6.2.2 | 0.4.7rc30.5.6rc30.6.0.9rc10.6.3rc1 |

### References

* [CVE-2012-4682](/w/index.php?title=CVE-2012-4682&action=edit&redlink=1 "CVE-2012-4682 (page does not exist)")
* [Gentoo bug](https://bugs.gentoo.org/show_bug.cgi?id=435216)

## CVE-2012-4683

*Main article: [CVE-2012-4683](/wiki/CVE-2012-4683 "CVE-2012-4683")*
```
Date: 2012-08-23
Summary: Targeted DoS by CPU exhaustion using alerts
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.7rc20.5.0rc1 - 0.5.6rc20.6.0rc1 - 0.6.0.8rc20.6.1rc1 - 0.6.2.2 | 0.7.0 |

### References

* [CVE-2012-4683](/wiki/CVE-2012-4683 "CVE-2012-4683")
* [Announcement](https://bitcointalk.org/index.php?topic=148038.0)
* [Gentoo bug](https://bugs.gentoo.org/show_bug.cgi?id=435216)

## CVE-2012-4684

*Main article: [CVE-2012-4684](/wiki/CVE-2012-4684 "CVE-2012-4684")*
```
Date: 2012-08-24
Summary: Network-wide DoS using malleable signatures in alerts
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.7rc20.5.0rc1 - 0.5.6rc20.6.0rc1 - 0.6.0.8rc20.6.1rc1 - 0.6.2.2 - 0.6.3rc1 | 0.7.0 |

### References

* [CVE-2012-4684](/wiki/CVE-2012-4684 "CVE-2012-4684")
* [Announcement](https://bitcointalk.org/index.php?topic=148109.0)

## CVE-2013-2272

```
Date: 2013-01-11
Summary: Remote discovery of node's wallet addresses
Fix Deployment: 99.99%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.8rc40.5.0rc1 - 0.5.70.6.0rc1 - 0.6.0.10rc40.6.1rc1 - 0.6.4rc40.7.0rc1 - 0.7.2 | 0.4.9rc10.5.8rc10.6.0.11rc10.6.5rc10.7.3rc1 |

### References

* [Announcement](https://bitcointalk.org/?topic=135856)
* [Gentoo bug](https://bugs.gentoo.org/show_bug.cgi?id=462046)

## CVE-2013-2273

```
Date: 2013-01-30
Summary: Predictable change output
Fix Deployment: 99.99%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.8rc40.5.0rc1 - 0.5.70.6.0rc1 - 0.6.0.10rc40.6.1rc1 - 0.6.4rc40.7.0rc1 - 0.7.2 | 0.4.9rc10.5.8rc10.6.0.11rc10.6.5rc10.7.3rc1 |

### References

* [Gentoo bug](https://bugs.gentoo.org/show_bug.cgi?id=462046)

## CVE-2013-2292

```
Date: 2013-01-30
Summary: A transaction that takes at least 3 minutes to verify
Fix Deployment: 0%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | All versions | No fix yet |

### References

* [CVE-2013-2292](/w/index.php?title=CVE-2013-2292&action=edit&redlink=1 "CVE-2013-2292 (page does not exist)")
* [Announcement](https://bitcointalk.org/?topic=140078)
* [Gentoo bug](https://bugs.gentoo.org/show_bug.cgi?id=462046)

## CVE-2013-2293

*Main article: [CVE-2013-2293](/wiki/CVE-2013-2293 "CVE-2013-2293")*
```
Date: 2013-02-14
Summary: Continuous hard disk seek
Fix Deployment: 99.99%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.7.3rc1 | No fix yet (0.8.0 unaffected) |

### References

* [CVE-2013-2293](/wiki/CVE-2013-2293 "CVE-2013-2293")
* [Announcement](https://bitcointalk.org/?topic=144122)
* [Gentoo bug](https://bugs.gentoo.org/show_bug.cgi?id=462046)

## CVE-2013-3219

```
Date: 2013-03-11
Summary: Unenforced block protocol rule
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | 0.8.0rc1 - 0.8.0 | 0.8.1 |

### References

* [BIP 50](/wiki/BIP_0050 "BIP 0050")

## CVE-2013-3220

```
Date: 2013-03-11
Summary: Inconsistent BDB lock limit interactions
Fix Deployment: 99.99%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.9rc10.5.0rc1 - 0.5.8rc10.6.0rc1 - 0.6.5rc10.7.0rc1 - 0.7.3rc1 | 0.4.9rc20.5.8rc20.6.5rc20.7.3rc2 |
| wxBitcoin | ALL | NONE |

### References

* [BIP 50](/wiki/BIP_0050 "BIP 0050")

## BIP-0034

```
Date: 2013-03-25
Summary: Mandatory block protocol update
Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.70.5.0rc1 - 0.5.70.6.0rc1 - 0.6.0.90.6.1rc1 - 0.6.3 | 0.4.8rc10.5.7rc10.6.0.10rc10.6.4rc1 |
| wxBitcoin | ALL | NONE |

### References

* [BIP 0034](/wiki/BIP_0034 "BIP 0034")

## BIP-0050

```
Date: 2013-05-15
Summary: Hard fork to remove txid limit protocol rule
Deployment: 99.99%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.9rc10.5.0rc1 - 0.5.8rc10.6.0rc1 - 0.6.5rc10.7.0rc1 - 0.7.3rc1 | 0.4.9rc20.5.8rc20.6.5rc20.7.3rc2 |
| wxBitcoin | ALL | NONE |

### References

* [BIP 0050](/wiki/BIP_0050 "BIP 0050")

## CVE-2013-4627

```
Date: 2013-06-??
Summary: Memory exhaustion with excess tx message data
Fix Deployment: 99.9%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.9rc30.5.0rc1 - 0.5.8rc30.6.0rc1 - 0.6.5rc30.7.0rc1 - 0.7.3rc30.8.0rc1 - 0.8.3 | 0.4.9rc40.5.8rc40.6.5rc40.7.3rc40.8.4 |
| wxBitcoin | ALL | NONE |

### References

## CVE-2013-4165

```
Date: 2013-07-20
Summary: Timing leak in RPC authentication
Fix Deployment: 99.9%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | \* - 0.4.9rc30.5.0rc1 - 0.5.8rc30.6.0rc1 - 0.6.5rc30.7.0rc1 - 0.7.3rc30.8.0rc1 - 0.8.3 | 0.4.9rc40.5.8rc40.6.5rc40.7.3rc40.8.4rc1 |
| wxBitcoin | ALL | NONE |

### References

* [Bitcoin-Qt 0.8.4 release notes](https://bitcointalk.org/index.php?topic=287351)
* [The initial bug report](https://github.com/bitcoin/bitcoin/issues/2838)

## CVE-2013-5700

```
Date: 2013-09-04
Summary: Remote p2p crash via bloom filters
Fix Deployment: 99.9%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | 0.8.0rc1 - 0.8.3 | 0.8.4rc1 |

### References

* [Bitcoin-Qt 0.8.4 release notes](https://bitcointalk.org/index.php?topic=287351)
* [The fix](https://github.com/bitcoin/bitcoin/commit/37c6389c5a0ca63ae3573440ecdfe95d28ad8f07)
* [An added test](https://github.com/bitcoin/bitcoin/pull/18515)

## CVE-2016-8889

```
Date: 2016-10-27
Summary: Debug console history storing sensitive info
Fix Deployment: 100%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin Knots GUI | 0.11.0 - 0.13.0 | 0.13.1 |

### References

* [Bitcoin Knots 0.16.1.knots20161027 release notes](https://github.com/bitcoinknots/bitcoin/blob/v0.13.1.knots20161027/doc/release-notes.md)
* [US-CERT/NIST](https://nvd.nist.gov/vuln/detail/CVE-2016-8889)

## CVE-2017-12842

```
Date: 2018-06-09
Summary: No commitment to block merkle tree depth

```
### References

* [Explanation by Sergio Demian Lerner](https://bitslog.wordpress.com/2018/06/09/leaf-node-weakness-in-bitcoin-merkle-tree-design/)
* [Further elaboration by Suhas Daftuar](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-February/016697.html)

## CVE-2017-18350

```
Date: 2019-06-22
Summary: Buffer overflow from SOCKS proxy

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | 0.7.0rc1 - 0.15.0 | 0.15.1rc1 |

### References

* [Disclosure of details](https://medium.com/%40lukedashjr/cve-2017-18350-disclosure-fe6d695f45d5)

## CVE-2018-17144

```
Date: 2018-09-17
Summary: Missing check for duplicate inputs
Fix Deployment: 31%

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | 0.14.0rc1 - 0.14.20.15.0rc1 - 0.15.10.16.0rc1 - 0.16.2 | 0.14.30.15.20.16.3 |

### References

* [Full disclosure by Bitcoin Core](https://bitcoincore.org/en/2018/09/20/notice/)
* [Bitcoin Core 0.16.3 release notes](https://bitcoincore.org/en/2018/09/18/release-0.16.3/)
* [Bitcoin Knots 0.16.3.knots20180918 release notes](https://github.com/bitcoinknots/bitcoin/blob/v0.16.3.knots20180918/doc/release-notes.md)
* [US-CERT/NIST](https://nvd.nist.gov/vuln/detail/CVE-2018-17144)
* [Gentoo bug](https://bugs.gentoo.org/show_bug.cgi?id=666669)

## CVE-2018-20586

```
Date: 2019-06-22
Summary: Debug log injection via unauthenticated RPC

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin-Qtbitcoind | 0.12.0rc1 - 0.17.0 | 0.17.1rc1 |

## CVE-2020-14199

```
Date: 2020-06-03
Summary: Double-signing can enable unintended fees

```

| Affected | | Fix |
| --- | --- | --- |
| Trezor One |  | 1.9.1 |
| Trezor Model T |  | 2.3.1 |
| ??? |

### References

* [Disclosure of details by Trezor team](https://blog.trezor.io/details-of-firmware-updates-for-trezor-one-version-1-9-1-and-trezor-model-t-version-2-3-1-1eba8f60f2dd)

## CVE-2020-26895

```
Date: 2020-10-08
Summary: Missing low-S normalization for HTLC signatures.

```

| Affected | | Fix |
| --- | --- | --- |
| lnd |  | 0.10.0 |

### References

* [CVE-2020-26895: LND Low-S Tx-Relay Standardness](https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-October/002858.html)
* [Full Disclosure: Full Disclosure: CVE-2020-26895 LND "Hodl my Shitsig"](https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-October/002856.html)

## CVE-2020-26896

```
Date: 2020-10-08
Summary: Invoice preimage extraction via forwarded HTLC.

```

| Affected | | Fix |
| --- | --- | --- |
| lnd |  | 0.11.0 |

### References

* [CVE-2020-26896: LND Invoice Preimage Extraction](https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-October/002857.html)
* [Full Disclosure: CVE-2020-26896 LND "The (un)covert channel"](https://lists.linuxfoundation.org/pipermail/lightning-dev/2020-October/002855.html)

## CVE-2021-3401

```
Date: 2021-02-01
Summary: Qt5 remote execution

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin Core GUI |  | 0.19.0 |
| Bitcoin Knots GUI |  | 0.18.1 |

## CVE-2021-31876

```
Date: 2021-05-06

```
### References

* [Full Disclosure: CVE-2021-31876 Defect in Bitcoin Core's bip125 logic](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-May/018893.html)

### References

* [URI Argument Injection Vulnerability in Bitcoin Core 0.18 and Earlier](https://achow101.com/2021/02/0.18-uri-vuln)

## CVE-2023-50428

```
Date: 2023
Summary: Bypass of datacarriersize limit using OP_FALSE,OP_IF

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin Core | 0.9 and later | NOT FIXED |
| Bitcoin Knots | 0.9 - 23.0 | 25.1.knots20231115 |
| btcd | ? | NOT FIXED |
| libbitcoin | ? | NOT FIXED |

## CVE-2024-34149

```
Date: 2024-03-30
Summary: Script size limit not enforced for Tapscript

```

| Affected | | Fix |
| --- | --- | --- |
| Bitcoin Core | 0.21.1 and later | NOT FIXED |
| Bitcoin Knots | 0.21.1 - 23.0 | 25.1.knots20231115 |
| btcd | ? | ? |
| libbitcoin | ? | ? |

## Definitions

A critical vulnerability is one that will have disastrous consequences if it is exploited. A serious vulnerability is one that will have serious consequences if it is exploited[[1]](#cite_note-16).

## See Also

* [Changelog](/wiki/Changelog "Changelog")
* <https://blog.bitmex.com/bitcoins-consensus-forks/>

## References

1. [↑](#cite_ref-16) <http://bitcointalk.org/index.php?topic=88892.0>

| | [Bitcoin Core](/wiki/Bitcoin_Core "Bitcoin Core") documentation | | | --- | --- | |  | | User documentation | [Alert system](/wiki/Alert_system "Alert system") • [Bitcoin Core compatible devices](/wiki/Bitcoin_Core_compatible_devices "Bitcoin Core compatible devices") • [Data directory](/wiki/Data_directory "Data directory") • [Fallback Nodes](/wiki/Fallback_Nodes "Fallback Nodes") • [How to import private keys in Bitcoin Core 0.7+](/wiki/Help%3AHow_to_import_private_keys_in_Bitcoin_Core_0.7%2B "Help:How to import private keys in Bitcoin Core 0.7+") • [Installing Bitcoin Core](/wiki/Help%3AInstalling_Bitcoin_Core "Help:Installing Bitcoin Core") • [Running Bitcoin](/wiki/Running_Bitcoin "Running Bitcoin") • [Transaction fees](/wiki/Transaction_fees "Transaction fees") • [Vocabulary](/wiki/Vocabulary "Vocabulary") | |  | | Developer documentation | [Accounts explained](/wiki/Help%3AAccounts_explained "Help:Accounts explained") • [API calls list](/wiki/Original_Bitcoin_client/API_calls_list "Original Bitcoin client/API calls list") • [API reference (JSON-RPC)](/wiki/API_reference_%28JSON-RPC%29 "API reference (JSON-RPC)") • [Block chain download](/wiki/Block_chain_download "Block chain download") • [Dump format](/wiki/Dump_format "Dump format") • [getblocktemplate](/wiki/Getblocktemplate "Getblocktemplate") • [List of address prefixes](/wiki/List_of_address_prefixes "List of address prefixes") • [Protocol documentation](/wiki/Protocol_documentation "Protocol documentation") • [Script](/wiki/Script "Script") • [Technical background of version 1 Bitcoin addresses](/wiki/Technical_background_of_version_1_Bitcoin_addresses "Technical background of version 1 Bitcoin addresses") • [Testnet](/wiki/Testnet "Testnet") • [Transaction Malleability](/wiki/Transaction_Malleability "Transaction Malleability") • [Wallet import format](/wiki/Wallet_import_format "Wallet import format") | |  | | History & theory | Common Vulnerabilities and Exposures • [DOS/STONED incident](/wiki/DOS/STONED_incident "DOS/STONED incident") • [Economic majority](/wiki/Economic_majority "Economic majority") • [Full node](/wiki/Full_node "Full node") • [Original Bitcoin client](/wiki/Original_Bitcoin_client "Original Bitcoin client") • [Value overflow incident](/wiki/Value_overflow_incident "Value overflow incident") | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

Retrieved from "<https://en.bitcoin.it/w/index.php?title=Common_Vulnerabilities_and_Exposures&oldid=70310>"
[Categories](/wiki/Special%3ACategories "Special:Categories"):

* [Security](/wiki/Category%3ASecurity "Category:Security")
* [Bitcoin Core documentation](/wiki/Category%3ABitcoin_Core_documentation "Category:Bitcoin Core documentation")

## Navigation menu

### Personal tools

* [Create account](/w/index.php?title=Special:CreateAccount&returnto=Common+Vulnerabilities+and+Exposures "You are encouraged to create an account and log in; however, it is not mandatory")
* [Log in](/w/index.php?title=Special:UserLogin&returnto=Common+Vulnerabilities+and+Exposures "You are encouraged to log in; however, it is not mandatory [o]")

### Namespaces

* [Page](/wiki/Common_Vulnerabilities_and_Exposures "View the content page [c]")
* [Discussion](/wiki/Talk%3ACommon_Vulnerabilities_and_Exposures "Discussion about the content page [t]")

English

### Views

* [Read](/wiki/Common_Vulnerabilities_and_Exposures)
* [View source](/w/index.php?title=Common_Vulnerabilities_and_Exposures&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/w/index.php?title=Common_Vulnerabilities_and_Exposures&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/wiki/Main_Page "Visit the main page [z]")
* [Bitcoin FAQ](/wiki/Help%3AFAQ)
* [Editing help](/wiki/Bitcoin_Wiki%3AHelp)
* [Forums](/wiki/Forums)
* [Chatrooms](/wiki/IRC_channels)
* [Recent changes](/wiki/Special%3ARecentChanges)
* [Page index](/wiki/Special%3AAllPages)

### Tools

* [What links here](/wiki/Special%3AWhatLinksHere/Common_Vulnerabilities_and_Exposures "A list of all wiki pages that link here [j]")
* [Related changes](/wiki/Special%3ARecentChangesLinked/Common_Vulnerabilities_and_Exposures "Recent changes in pages linked from this page [k]")
* [Special pages](/wiki/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/w/index.php?title=Common_Vulnerabilities_and_Exposures&oldid=70310 "Permanent link to this revision of this page")
* [Page information](/w/index.php?title=Common_Vulnerabilities_and_Exposures&action=info "More information about this page")

### Sister projects

* [Essays](/wiki/Bitcoin_Wiki%3AEssay_main_page)
* [Source](/wiki/Bitcoin_Wiki%3ASource_main_page)

* This page was last edited on 31 July 2024, at 17:40.
* Content is available under [Creative Commons Attribution 3.0](http://creativecommons.org/licenses/by/3.0/) unless otherwise noted.

* [Privacy policy](/wiki/Bitcoin_Wiki%3APrivacy_policy)
* [About Bitcoin Wiki](/wiki/Bitcoin_Wiki%3AAbout)
* [Disclaimers](/wiki/Bitcoin_Wiki%3AGeneral_disclaimer)

* [![Powered by MediaWiki](/w/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from github.com_039929de_20250126_064124.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Fblob%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X%2Fvalidation.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Fblob%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X%2Fvalidation.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=JinBean%2FCVE-Extension)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JinBean](/JinBean)
/
**[CVE-Extension](/JinBean/CVE-Extension)**
Public

* [Notifications](/login?return_to=%2FJinBean%2FCVE-Extension) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2FJinBean%2FCVE-Extension)
* [Star
   3](/login?return_to=%2FJinBean%2FCVE-Extension)

* [Code](/JinBean/CVE-Extension)
* [Issues
  0](/JinBean/CVE-Extension/issues)
* [Pull requests
  0](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects
  0](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

Additional navigation options

* [Code](/JinBean/CVE-Extension)
* [Issues](/JinBean/CVE-Extension/issues)
* [Pull requests](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

## Files

 master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
3. /[Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X)
/
# validation.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/JinBean/CVE-Extension/commits/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)4330 lines (3798 loc) · 187 KB master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
3. /[Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X)
/
# validation.cpp

Top
## File metadata and controls

* Code
* Blame

4330 lines (3798 loc) · 187 KB[Raw](https://github.com/JinBean/CVE-Extension/raw/refs/heads/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000// Copyright (c) 2009-2010 Satoshi Nakamoto// Copyright (c) 2009-2016 The Bitcoin Core developers// Distributed under the MIT software license, see the accompanying// file COPYING or http://www.opensource.org/licenses/mit-license.php.
#include "validation.h"
#include "arith\_uint256.h"#include "chainparams.h"#include "checkpoints.h"#include "checkqueue.h"#include "consensus/consensus.h"#include "consensus/merkle.h"#include "consensus/validation.h"#include "hash.h"#include "init.h"#include "policy/fees.h"#include "policy/policy.h"#include "pow.h"#include "primitives/block.h"#include "primitives/transaction.h"#include "random.h"#include "script/script.h"#include "script/sigcache.h"#include "script/standard.h"#include "timedata.h"#include "tinyformat.h"#include "txdb.h"#include "txmempool.h"#include "ui\_interface.h"#include "undo.h"#include "util.h"#include "utilmoneystr.h"#include "utilstrencodings.h"#include "validationinterface.h"#include "versionbits.h"#include "warnings.h"
#include <atomic>#include <sstream>
#include <boost/algorithm/string/replace.hpp>#include <boost/algorithm/string/join.hpp>#include <boost/filesystem.hpp>#include <boost/filesystem/fstream.hpp>#include <boost/math/distributions/poisson.hpp>#include <boost/thread.hpp>
#if defined(NDEBUG)# error "Bitcoin cannot be compiled without assertions."#endif
/\*\* \* Global state \*/
CCriticalSection cs\_main;
BlockMap mapBlockIndex;CChain chainActive;CBlockIndex \*pindexBestHeader = NULL;CWaitableCriticalSection csBestBlock;CConditionVariable cvBlockChange;int nScriptCheckThreads = 0;std::atomic\_bool fImporting(false);bool fReindex = false;bool fTxIndex = false;bool fHavePruned = false;bool fPruneMode = false;bool fIsBareMultisigStd = DEFAULT\_PERMIT\_BAREMULTISIG;bool fRequireStandard = true;bool fCheckBlockIndex = false;bool fCheckpointsEnabled = DEFAULT\_CHECKPOINTS\_ENABLED;size\_t nCoinCacheUsage = 5000 \* 300;uint64\_t nPruneTarget = 0;int64\_t nMaxTipAge = DEFAULT\_MAX\_TIP\_AGE;bool fEnableReplacement = DEFAULT\_ENABLE\_REPLACEMENT;
uint256 hashAssumeValid;
CFeeRate minRelayTxFee = CFeeRate(DEFAULT\_MIN\_RELAY\_TX\_FEE);CAmount maxTxFee = DEFAULT\_TRANSACTION\_MAXFEE;
CTxMemPool mempool(::minRelayTxFee);
static void CheckBlockIndex(const Consensus::Params& consensusParams);
/\*\* Constant stuff for coinbase transactions we create: \*/CScript COINBASE\_FLAGS;
const std::string strMessageMagic = "Bitcoin Signed Message:\n";
// Internal stuffnamespace {
 struct CBlockIndexWorkComparator { bool operator()(CBlockIndex \*pa, CBlockIndex \*pb) const { // First sort by most total work, ... if (pa->nChainWork > pb->nChainWork) return false; if (pa->nChainWork < pb->nChainWork) return true;
 // ... then by earliest time received, ... if (pa->nSequenceId < pb->nSequenceId) return false; if (pa->nSequenceId > pb->nSequenceId) return true;
 // Use pointer address as tie breaker (should only happen with blocks // loaded from disk, as those all have id 0). if (pa < pb) return false; if (pa > pb) return true;
 // Identical blocks. return false; } };
 CBlockIndex \*pindexBestInvalid;
 /\*\* \* The set of all CBlockIndex entries with BLOCK\_VALID\_TRANSACTIONS (for itself and all ancestors) and \* as good as our current tip or better. Entries may be failed, though, and pruning nodes may be \* missing the data for the block. \*/ std::set<CBlockIndex\*, CBlockIndexWorkComparator> setBlockIndexCandidates; /\*\* All pairs A->B, where A (or one of its ancestors) misses transactions, but B has transactions. \* Pruned nodes may have entries where B is missing data. \*/ std::multimap<CBlockIndex\*, CBlockIndex\*> mapBlocksUnlinked;
 CCriticalSection cs\_LastBlockFile; std::vector<CBlockFileInfo> vinfoBlockFile; int nLastBlockFile = 0; /\*\* Global flag to indicate we should check to see if there are \* block/undo files that should be deleted. Set on startup \* or if we allocate more file space when we're in prune mode \*/ bool fCheckForPruning = false;
 /\*\* \* Every received block is assigned a unique and increasing identifier, so we \* know which one to give priority in case of a fork. \*/ CCriticalSection cs\_nBlockSequenceId; /\*\* Blocks loaded from disk are assigned id 0, so start the counter at 1. \*/ int32\_t nBlockSequenceId = 1; /\*\* Decreasing counter (used by subsequent preciousblock calls). \*/ int32\_t nBlockReverseSequenceId = -1; /\*\* chainwork for the last block that preciousblock has been applied to. \*/ arith\_uint256 nLastPreciousChainwork = 0;
 /\*\* Dirty block index entries. \*/ std::set<CBlockIndex\*> setDirtyBlockIndex;
 /\*\* Dirty block file entries. \*/ std::set<int> setDirtyFileInfo;} // anon namespace
/\* Use this class to start tracking transactions that are removed from the \* mempool and pass all those transactions through SyncTransaction when the \* object goes out of scope. This is currently only used to call SyncTransaction \* on conflicts removed from the mempool during block connection. Applied in \* ActivateBestChain around ActivateBestStep which in turn calls: \* ConnectTip->removeForBlock->removeConflicts \*/class MemPoolConflictRemovalTracker{private: std::vector<CTransactionRef> conflictedTxs; CTxMemPool &pool;
public: MemPoolConflictRemovalTracker(CTxMemPool &\_pool) : pool(\_pool) { pool.NotifyEntryRemoved.connect(boost::bind(&MemPoolConflictRemovalTracker::NotifyEntryRemoved, this, \_1, \_2)); }
 void NotifyEntryRemoved(CTransactionRef txRemoved, MemPoolRemovalReason reason) { if (reason == MemPoolRemovalReason::CONFLICT) { conflictedTxs.push\_back(txRemoved); } }
 ~MemPoolConflictRemovalTracker() { pool.NotifyEntryRemoved.disconnect(boost::bind(&MemPoolConflictRemovalTracker::NotifyEntryRemoved, this, \_1, \_2)); for (const auto& tx : conflictedTxs) { GetMainSignals().SyncTransaction(\*tx, NULL, CMainSignals::SYNC\_TRANSACTION\_NOT\_IN\_BLOCK); } conflictedTxs.clear(); }};
CBlockIndex\* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator){ // Find the first block the caller has in the main chain BOOST\_FOREACH(const uint256& hash, locator.vHave) { BlockMap::iterator mi = mapBlockIndex.find(hash); if (mi != mapBlockIndex.end()) { CBlockIndex\* pindex = (\*mi).second; if (chain.Contains(pindex)) return pindex; if (pindex->GetAncestor(chain.Height()) == chain.Tip()) { return chain.Tip(); } } } return chain.Genesis();}
CCoinsViewCache \*pcoinsTip = NULL;CBlockTreeDB \*pblocktree = NULL;
enum FlushStateMode { FLUSH\_STATE\_NONE, FLUSH\_STATE\_IF\_NEEDED, FLUSH\_STATE\_PERIODIC, FLUSH\_STATE\_ALWAYS};
// See definition for documentationbool static FlushStateToDisk(CValidationState &state, FlushStateMode mode, int nManualPruneHeight=0);void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight);
bool IsFinalTx(const CTransaction &tx, int nBlockHeight, int64\_t nBlockTime){ if (tx.nLockTime == 0) return true; if ((int64\_t)tx.nLockTime < ((int64\_t)tx.nLockTime < LOCKTIME\_THRESHOLD ? (int64\_t)nBlockHeight : nBlockTime)) return true; for (const auto& txin : tx.vin) { if (!(txin.nSequence == CTxIn::SEQUENCE\_FINAL)) return false; } return true;}
bool CheckFinalTx(const CTransaction &tx, int flags){ AssertLockHeld(cs\_main);
 // By convention a negative value for flags indicates that the // current network-enforced consensus rules should be used. In // a future soft-fork scenario that would mean checking which // rules would be enforced for the next block and setting the // appropriate flags. At the present time no soft-forks are // scheduled, so no flags are set. flags = std::max(flags, 0);
 // CheckFinalTx() uses chainActive.Height()+1 to evaluate // nLockTime because when IsFinalTx() is called within // CBlock::AcceptBlock(), the height of the block \*being\* // evaluated is what is used. Thus if we want to know if a // transaction can be part of the \*next\* block, we need to call // IsFinalTx() with one more than chainActive.Height(). const int nBlockHeight = chainActive.Height() + 1;
 // BIP113 will require that time-locked transactions have nLockTime set to // less than the median time of the previous block they're contained in. // When the next block is created its previous block will be the current // chain tip, so we use that to calculate the median time passed to // IsFinalTx() if LOCKTIME\_MEDIAN\_TIME\_PAST is set. const int64\_t nBlockTime = (flags & LOCKTIME\_MEDIAN\_TIME\_PAST) ? chainActive.Tip()->GetMedianTimePast() : GetAdjustedTime();
 return IsFinalTx(tx, nBlockHeight, nBlockTime);}
/\*\* \* Calculates the block height and previous block's median time past at \* which the transaction will be considered final in the context of BIP 68. \* Also removes from the vector of input heights any entries which did not \* correspond to sequence locked inputs as they do not affect the calculation. \*/static std::pair<int, int64\_t> CalculateSequenceLocks(const CTransaction &tx, int flags, std::vector<int>\* prevHeights, const CBlockIndex& block){ assert(prevHeights->size() == tx.vin.size());
 // Will be set to the equivalent height- and time-based nLockTime // values that would be necessary to satisfy all relative lock- // time constraints given our view of block chain history. // The semantics of nLockTime are the last invalid height/time, so // use -1 to have the effect of any height or time being valid. int nMinHeight = -1; int64\_t nMinTime = -1;
 // tx.nVersion is signed integer so requires cast to unsigned otherwise // we would be doing a signed comparison and half the range of nVersion // wouldn't support BIP 68. bool fEnforceBIP68 = static\_cast<uint32\_t>(tx.nVersion) >= 2 && flags & LOCKTIME\_VERIFY\_SEQUENCE;
 // Do not enforce sequence numbers as a relative lock time // unless we have been instructed to if (!fEnforceBIP68) { return std::make\_pair(nMinHeight, nMinTime); }
 for (size\_t txinIndex = 0; txinIndex < tx.vin.size(); txinIndex++) { const CTxIn& txin = tx.vin[txinIndex];
 // Sequence numbers with the most significant bit set are not // treated as relative lock-times, nor are they given any // consensus-enforced meaning at this point. if (txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_DISABLE\_FLAG) { // The height of this input is not relevant for sequence locks (\*prevHeights)[txinIndex] = 0; continue; }
 int nCoinHeight = (\*prevHeights)[txinIndex];
 if (txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_TYPE\_FLAG) { int64\_t nCoinTime = block.GetAncestor(std::max(nCoinHeight-1, 0))->GetMedianTimePast(); // NOTE: Subtract 1 to maintain nLockTime semantics // BIP 68 relative lock times have the semantics of calculating // the first block or time at which the transaction would be // valid. When calculating the effective block time or height // for the entire transaction, we switch to using the // semantics of nLockTime which is the last invalid block // time or height. Thus we subtract 1 from the calculated // time or height.
 // Time-based relative lock-times are measured from the // smallest allowed timestamp of the block containing the // txout being spent, which is the median time past of the // block prior. nMinTime = std::max(nMinTime, nCoinTime + (int64\_t)((txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_MASK) << CTxIn::SEQUENCE\_LOCKTIME\_GRANULARITY) - 1); } else { nMinHeight = std::max(nMinHeight, nCoinHeight + (int)(txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_MASK) - 1); } }
 return std::make\_pair(nMinHeight, nMinTime);}
static bool EvaluateSequenceLocks(const CBlockIndex& block, std::pair<int, int64\_t> lockPair){ assert(block.pprev); int64\_t nBlockTime = block.pprev->GetMedianTimePast(); if (lockPair.first >= block.nHeight || lockPair.second >= nBlockTime) return false;
 return true;}
bool SequenceLocks(const CTransaction &tx, int flags, std::vector<int>\* prevHeights, const CBlockIndex& block){ return EvaluateSequenceLocks(block, CalculateSequenceLocks(tx, flags, prevHeights, block));}
bool TestLockPointValidity(const LockPoints\* lp){ AssertLockHeld(cs\_main); assert(lp); // If there are relative lock times then the maxInputBlock will be set // If there are no relative lock times, the LockPoints don't depend on the chain if (lp->maxInputBlock) { // Check whether chainActive is an extension of the block at which the LockPoints // calculation was valid. If not LockPoints are no longer valid if (!chainActive.Contains(lp->maxInputBlock)) { return false; } }
 // LockPoints still valid return true;}
bool CheckSequenceLocks(const CTransaction &tx, int flags, LockPoints\* lp, bool useExistingLockPoints){ AssertLockHeld(cs\_main); AssertLockHeld(mempool.cs);
 CBlockIndex\* tip = chainActive.Tip(); CBlockIndex index; index.pprev = tip; // CheckSequenceLocks() uses chainActive.Height()+1 to evaluate // height based locks because when SequenceLocks() is called within // ConnectBlock(), the height of the block \*being\* // evaluated is what is used. // Thus if we want to know if a transaction can be part of the // \*next\* block, we need to use one more than chainActive.Height() index.nHeight = tip->nHeight + 1;
 std::pair<int, int64\_t> lockPair; if (useExistingLockPoints) { assert(lp); lockPair.first = lp->height; lockPair.second = lp->time; } else { // pcoinsTip contains the UTXO set for chainActive.Tip() CCoinsViewMemPool viewMemPool(pcoinsTip, mempool); std::vector<int> prevheights; prevheights.resize(tx.vin.size()); for (size\_t txinIndex = 0; txinIndex < tx.vin.size(); txinIndex++) { const CTxIn& txin = tx.vin[txinIndex]; CCoins coins; if (!viewMemPool.GetCoins(txin.prevout.hash, coins)) { return error("%s: Missing input", \_\_func\_\_); } if (coins.nHeight == MEMPOOL\_HEIGHT) { // Assume all mempool transaction confirm in the next block prevheights[txinIndex] = tip->nHeight + 1; } else { prevheights[txinIndex] = coins.nHeight; } } lockPair = CalculateSequenceLocks(tx, flags, &prevheights, index); if (lp) { lp->height = lockPair.first; lp->time = lockPair.second; // Also store the hash of the block with the highest height of // all the blocks which have sequence locked prevouts. // This hash needs to still be on the chain // for these LockPoint calculations to be valid // Note: It is impossible to correctly calculate a maxInputBlock // if any of the sequence locked inputs depend on unconfirmed txs, // except in the special case where the relative lock time/height // is 0, which is equivalent to no sequence lock. Since we assume // input height of tip+1 for mempool txs and test the resulting // lockPair from CalculateSequenceLocks against tip+1. We know // EvaluateSequenceLocks will fail if there was a non-zero sequence // lock on a mempool input, so we can use the return value of // CheckSequenceLocks to indicate the LockPoints validity int maxInputHeight = 0; BOOST\_FOREACH(int height, prevheights) { // Can ignore mempool inputs since we'll fail if they had non-zero locks if (height != tip->nHeight+1) { maxInputHeight = std::max(maxInputHeight, height); } } lp->maxInputBlock = tip->GetAncestor(maxInputHeight); } } return EvaluateSequenceLocks(index, lockPair);}
unsigned int GetLegacySigOpCount(const CTransaction& tx){ unsigned int nSigOps = 0; for (const auto& txin : tx.vin) { nSigOps += txin.scriptSig.GetSigOpCount(false); } for (const auto& txout : tx.vout) { nSigOps += txout.scriptPubKey.GetSigOpCount(false); } return nSigOps;}
unsigned int GetP2SHSigOpCount(const CTransaction& tx, const CCoinsViewCache& inputs){ if (tx.IsCoinBase()) return 0;
 unsigned int nSigOps = 0; for (unsigned int i = 0; i < tx.vin.size(); i++) { const CTxOut &prevout = inputs.GetOutputFor(tx.vin[i]); if (prevout.scriptPubKey.IsPayToScriptHash()) nSigOps += prevout.scriptPubKey.GetSigOpCount(tx.vin[i].scriptSig); } return nSigOps;}
int64\_t GetTransactionSigOpCost(const CTransaction& tx, const CCoinsViewCache& inputs, int flags){ int64\_t nSigOps = GetLegacySigOpCount(tx) \* WITNESS\_SCALE\_FACTOR;
 if (tx.IsCoinBase()) return nSigOps;
 if (flags & SCRIPT\_VERIFY\_P2SH) { nSigOps += GetP2SHSigOpCount(tx, inputs) \* WITNESS\_SCALE\_FACTOR; }
 for (unsigned int i = 0; i < tx.vin.size(); i++) { const CTxOut &prevout = inputs.GetOutputFor(tx.vin[i]); nSigOps += CountWitnessSigOps(tx.vin[i].scriptSig, prevout.scriptPubKey, &tx.vin[i].scriptWitness, flags); } return nSigOps;}
bool CheckTransaction(const CTransaction& tx, CValidationState &state, bool fCheckDuplicateInputs){ // Basic checks that don't depend on any context if (tx.vin.empty()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-vin-empty"); if (tx.vout.empty()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-vout-empty"); // Size limits (this doesn't take the witness into account, as that hasn't been checked for malleability) if (::GetSerializeSize(tx, SER\_NETWORK, PROTOCOL\_VERSION | SERIALIZE\_TRANSACTION\_NO\_WITNESS) > MAX\_BLOCK\_BASE\_SIZE) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-oversize");
 // Check for negative or overflow output values CAmount nValueOut = 0; for (const auto& txout : tx.vout) { if (txout.nValue < 0) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-vout-negative"); if (txout.nValue > MAX\_MONEY) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-vout-toolarge"); nValueOut += txout.nValue; if (!MoneyRange(nValueOut)) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-txouttotal-toolarge"); }
 // Check for duplicate inputs - note that this check is slow so we skip it in CheckBlock if (fCheckDuplicateInputs) { std::set<COutPoint> vInOutPoints; for (const auto& txin : tx.vin) { if (!vInOutPoints.insert(txin.prevout).second) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-inputs-duplicate"); } }
 if (tx.IsCoinBase()) { if (tx.vin[0].scriptSig.size() < 2 || tx.vin[0].scriptSig.size() > 100) return state.DoS(100, false, REJECT\_INVALID, "bad-cb-length"); } else { for (const auto& txin : tx.vin) if (txin.prevout.IsNull()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-prevout-null"); }
 return true;}
void LimitMempoolSize(CTxMemPool& pool, size\_t limit, unsigned long age) { int expired = pool.Expire(GetTime() - age); if (expired != 0) LogPrint("mempool", "Expired %i transactions from the memory pool\n", expired);
 std::vector<uint256> vNoSpendsRemaining; pool.TrimToSize(limit, &vNoSpendsRemaining); BOOST\_FOREACH(const uint256& removed, vNoSpendsRemaining) pcoinsTip->Uncache(removed);}
/\*\* Convert CValidationState to a human-readable message for logging \*/std::string FormatStateMessage(const CValidationState &state){ return strprintf("%s%s (code %i)", state.GetRejectReason(), state.GetDebugMessage().empty() ? "" : ", "+state.GetDebugMessage(), state.GetRejectCode());}
static bool IsCurrentForFeeEstimation(){ AssertLockHeld(cs\_main); if (IsInitialBlockDownload()) return false; if (chainActive.Tip()->GetBlockTime() < (GetTime() - MAX\_FEE\_ESTIMATION\_TIP\_AGE)) return false; if (chainActive.Height() < pindexBestHeader->nHeight - 1) return false; return true;}
bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const CTransactionRef& ptx, bool fLimitFree, bool\* pfMissingInputs, int64\_t nAcceptTime, std::list<CTransactionRef>\* plTxnReplaced, bool fOverrideMempoolLimit, const CAmount& nAbsurdFee, std::vector<uint256>& vHashTxnToUncache){ const CTransaction& tx = \*ptx; const uint256 hash = tx.GetHash(); AssertLockHeld(cs\_main); if (pfMissingInputs) \*pfMissingInputs = false;
 if (!CheckTransaction(tx, state)) return false; // state filled in by CheckTransaction
 // Coinbase is only valid in a block, not as a loose transaction if (tx.IsCoinBase()) return state.DoS(100, false, REJECT\_INVALID, "coinbase");
 // Reject transactions with witness before segregated witness activates (override with -prematurewitness) bool witnessEnabled = IsWitnessEnabled(chainActive.Tip(), Params().GetConsensus()); if (!GetBoolArg("-prematurewitness",false) && tx.HasWitness() && !witnessEnabled) { return state.DoS(0, false, REJECT\_NONSTANDARD, "no-witness-yet", true); }
 // Rather not work on nonstandard transactions (unless -testnet/-regtest) std::string reason; if (fRequireStandard && !IsStandardTx(tx, reason, witnessEnabled)) return state.DoS(0, false, REJECT\_NONSTANDARD, reason);
 // Only accept nLockTime-using transactions that can be mined in the next // block; we don't want our mempool filled up with transactions that can't // be mined yet. if (!CheckFinalTx(tx, STANDARD\_LOCKTIME\_VERIFY\_FLAGS)) return state.DoS(0, false, REJECT\_NONSTANDARD, "non-final");
 // is it already in the memory pool? if (pool.exists(hash)) return state.Invalid(false, REJECT\_ALREADY\_KNOWN, "txn-already-in-mempool");
 // Check for conflicts with in-memory transactions std::set<uint256> setConflicts; { LOCK(pool.cs); // protect pool.mapNextTx BOOST\_FOREACH(const CTxIn &txin, tx.vin) { auto itConflicting = pool.mapNextTx.find(txin.prevout); if (itConflicting != pool.mapNextTx.end()) { const CTransaction \*ptxConflicting = itConflicting->second; if (!setConflicts.count(ptxConflicting->GetHash())) { // Allow opt-out of transaction replacement by setting // nSequence >= maxint-1 on all inputs. // // maxint-1 is picked to still allow use of nLockTime by // non-replaceable transactions. All inputs rather than just one // is for the sake of multi-party protocols, where we don't // want a single party to be able to disable replacement. // // The opt-out ignores descendants as anyone relying on // first-seen mempool behavior should be checking all // unconfirmed ancestors anyway; doing otherwise is hopelessly // insecure. bool fReplacementOptOut = true; if (fEnableReplacement) { BOOST\_FOREACH(const CTxIn &\_txin, ptxConflicting->vin) { if (\_txin.nSequence < std::numeric\_limits<unsigned int>::max()-1) { fReplacementOptOut = false; break; } } } if (fReplacementOptOut) return state.Invalid(false, REJECT\_CONFLICT, "txn-mempool-conflict");
 setConflicts.insert(ptxConflicting->GetHash()); } } } }
 { CCoinsView dummy; CCoinsViewCache view(&dummy);
 CAmount nValueIn = 0; LockPoints lp; { LOCK(pool.cs); CCoinsViewMemPool viewMemPool(pcoinsTip, pool); view.SetBackend(viewMemPool);
 // do we already have it? bool fHadTxInCache = pcoinsTip->HaveCoinsInCache(hash); if (view.HaveCoins(hash)) { if (!fHadTxInCache) vHashTxnToUncache.push\_back(hash); return state.Invalid(false, REJECT\_ALREADY\_KNOWN, "txn-already-known"); }
 // do all inputs exist? // Note that this does not check for the presence of actual outputs (see the next check for that), // and only helps with filling in pfMissingInputs (to determine missing vs spent). BOOST\_FOREACH(const CTxIn txin, tx.vin) { if (!pcoinsTip->HaveCoinsInCache(txin.prevout.hash)) vHashTxnToUncache.push\_back(txin.prevout.hash); if (!view.HaveCoins(txin.prevout.hash)) { if (pfMissingInputs) \*pfMissingInputs = true; return false; // fMissingInputs and !state.IsInvalid() is used to detect this condition, don't set state.Invalid() } }
 // are the actual inputs available? if (!view.HaveInputs(tx)) return state.Invalid(false, REJECT\_DUPLICATE, "bad-txns-inputs-spent");
 // Bring the best block into scope view.GetBestBlock();
 nValueIn = view.GetValueIn(tx);
 // we have all inputs cached now, so switch back to dummy, so we don't need to keep lock on mempool view.SetBackend(dummy);
 // Only accept BIP68 sequence locked transactions that can be mined in the next // block; we don't want our mempool filled up with transactions that can't // be mined yet. // Must keep pool.cs for this unless we change CheckSequenceLocks to take a // CoinsViewCache instead of create its own if (!CheckSequenceLocks(tx, STANDARD\_LOCKTIME\_VERIFY\_FLAGS, &lp)) return state.DoS(0, false, REJECT\_NONSTANDARD, "non-BIP68-final"); }
 // Check for non-standard pay-to-script-hash in inputs if (fRequireStandard && !AreInputsStandard(tx, view)) return state.Invalid(false, REJECT\_NONSTANDARD, "bad-txns-nonstandard-inputs");
 // Check for non-standard witness in P2WSH if (tx.HasWitness() && fRequireStandard && !IsWitnessStandard(tx, view)) return state.DoS(0, false, REJECT\_NONSTANDARD, "bad-witness-nonstandard", true);
 int64\_t nSigOpsCost = GetTransactionSigOpCost(tx, view, STANDARD\_SCRIPT\_VERIFY\_FLAGS);
 CAmount nValueOut = tx.GetValueOut(); CAmount nFees = nValueIn-nValueOut; // nModifiedFees includes any fee deltas from PrioritiseTransaction CAmount nModifiedFees = nFees; double nPriorityDummy = 0; pool.ApplyDeltas(hash, nPriorityDummy, nModifiedFees);
 CAmount inChainInputValue; double dPriority = view.GetPriority(tx, chainActive.Height(), inChainInputValue);
 // Keep track of transactions that spend a coinbase, which we re-scan // during reorgs to ensure COINBASE\_MATURITY is still met. bool fSpendsCoinbase = false; BOOST\_FOREACH(const CTxIn &txin, tx.vin) { const CCoins \*coins = view.AccessCoins(txin.prevout.hash); if (coins->IsCoinBase()) { fSpendsCoinbase = true; break; } }
 CTxMemPoolEntry entry(ptx, nFees, nAcceptTime, dPriority, chainActive.Height(), inChainInputValue, fSpendsCoinbase, nSigOpsCost, lp); unsigned int nSize = entry.GetTxSize();
 // Check that the transaction doesn't have an excessive number of // sigops, making it impossible to mine. Since the coinbase transaction // itself can contain sigops MAX\_STANDARD\_TX\_SIGOPS is less than // MAX\_BLOCK\_SIGOPS; we still consider this an invalid rather than // merely non-standard transaction. if (nSigOpsCost > MAX\_STANDARD\_TX\_SIGOPS\_COST) return state.DoS(0, false, REJECT\_NONSTANDARD, "bad-txns-too-many-sigops", false, strprintf("%d", nSigOpsCost));
 CAmount mempoolRejectFee = pool.GetMinFee(GetArg("-maxmempool", DEFAULT\_MAX\_MEMPOOL\_SIZE) \* 1000000).GetFee(nSize); if (mempoolRejectFee > 0 && nModifiedFees < mempoolRejectFee) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "mempool min fee not met", false, strprintf("%d < %d", nFees, mempoolRejectFee)); } else if (GetBoolArg("-relaypriority", DEFAULT\_RELAYPRIORITY) && nModifiedFees < ::minRelayTxFee.GetFee(nSize) && !AllowFree(entry.GetPriority(chainActive.Height() + 1))) { // Require that free transactions have sufficient priority to be mined in the next block. return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient priority"); }
 // Continuously rate-limit free (really, very-low-fee) transactions // This mitigates 'penny-flooding' -- sending thousands of free transactions just to // be annoying or make others' transactions take longer to confirm. if (fLimitFree && nModifiedFees < ::minRelayTxFee.GetFee(nSize)) { static CCriticalSection csFreeLimiter; static double dFreeCount; static int64\_t nLastTime; int64\_t nNow = GetTime();
 LOCK(csFreeLimiter);
 // Use an exponentially decaying ~10-minute window: dFreeCount \*= pow(1.0 - 1.0/600.0, (double)(nNow - nLastTime)); nLastTime = nNow; // -limitfreerelay unit is thousand-bytes-per-minute // At default rate it would take over a month to fill 1GB if (dFreeCount + nSize >= GetArg("-limitfreerelay", DEFAULT\_LIMITFREERELAY) \* 10 \* 1000) return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "rate limited free transaction"); LogPrint("mempool", "Rate limit dFreeCount: %g => %g\n", dFreeCount, dFreeCount+nSize); dFreeCount += nSize; }
 if (nAbsurdFee && nFees > nAbsurdFee) return state.Invalid(false, REJECT\_HIGHFEE, "absurdly-high-fee", strprintf("%d > %d", nFees, nAbsurdFee));
 // Calculate in-mempool ancestors, up to a limit. CTxMemPool::setEntries setAncestors; size\_t nLimitAncestors = GetArg("-limitancestorcount", DEFAULT\_ANCESTOR\_LIMIT); size\_t nLimitAncestorSize = GetArg("-limitancestorsize", DEFAULT\_ANCESTOR\_SIZE\_LIMIT)\*1000; size\_t nLimitDescendants = GetArg("-limitdescendantcount", DEFAULT\_DESCENDANT\_LIMIT); size\_t nLimitDescendantSize = GetArg("-limitdescendantsize", DEFAULT\_DESCENDANT\_SIZE\_LIMIT)\*1000; std::string errString; if (!pool.CalculateMemPoolAncestors(entry, setAncestors, nLimitAncestors, nLimitAncestorSize, nLimitDescendants, nLimitDescendantSize, errString)) { return state.DoS(0, false, REJECT\_NONSTANDARD, "too-long-mempool-chain", false, errString); }
 // A transaction that spends outputs that would be replaced by it is invalid. Now // that we have the set of all ancestors we can detect this // pathological case by making sure setConflicts and setAncestors don't // intersect. BOOST\_FOREACH(CTxMemPool::txiter ancestorIt, setAncestors) { const uint256 &hashAncestor = ancestorIt->GetTx().GetHash(); if (setConflicts.count(hashAncestor)) { return state.DoS(10, false, REJECT\_INVALID, "bad-txns-spends-conflicting-tx", false, strprintf("%s spends conflicting transaction %s", hash.ToString(), hashAncestor.ToString())); } }
 // Check if it's economically rational to mine this transaction rather // than the ones it replaces. CAmount nConflictingFees = 0; size\_t nConflictingSize = 0; uint64\_t nConflictingCount = 0; CTxMemPool::setEntries allConflicting;
 // If we don't hold the lock allConflicting might be incomplete; the // subsequent RemoveStaged() and addUnchecked() calls don't guarantee // mempool consistency for us. LOCK(pool.cs); const bool fReplacementTransaction = setConflicts.size(); if (fReplacementTransaction) { CFeeRate newFeeRate(nModifiedFees, nSize); std::set<uint256> setConflictsParents; const int maxDescendantsToVisit = 100; CTxMemPool::setEntries setIterConflicting; BOOST\_FOREACH(const uint256 &hashConflicting, setConflicts) { CTxMemPool::txiter mi = pool.mapTx.find(hashConflicting); if (mi == pool.mapTx.end()) continue;
 // Save these to avoid repeated lookups setIterConflicting.insert(mi);
 // Don't allow the replacement to reduce the feerate of the // mempool. // // We usually don't want to accept replacements with lower // feerates than what they replaced as that would lower the // feerate of the next block. Requiring that the feerate always // be increased is also an easy-to-reason about way to prevent // DoS attacks via replacements. // // The mining code doesn't (currently) take children into // account (CPFP) so we only consider the feerates of // transactions being directly replaced, not their indirect // descendants. While that does mean high feerate children are // ignored when deciding whether or not to replace, we do // require the replacement to pay more overall fees too, // mitigating most cases. CFeeRate oldFeeRate(mi->GetModifiedFee(), mi->GetTxSize()); if (newFeeRate <= oldFeeRate) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s; new feerate %s <= old feerate %s", hash.ToString(), newFeeRate.ToString(), oldFeeRate.ToString())); }
 BOOST\_FOREACH(const CTxIn &txin, mi->GetTx().vin) { setConflictsParents.insert(txin.prevout.hash); }
 nConflictingCount += mi->GetCountWithDescendants(); } // This potentially overestimates the number of actual descendants // but we just want to be conservative to avoid doing too much // work. if (nConflictingCount <= maxDescendantsToVisit) { // If not too many to replace, then calculate the set of // transactions that would have to be evicted BOOST\_FOREACH(CTxMemPool::txiter it, setIterConflicting) { pool.CalculateDescendants(it, allConflicting); } BOOST\_FOREACH(CTxMemPool::txiter it, allConflicting) { nConflictingFees += it->GetModifiedFee(); nConflictingSize += it->GetTxSize(); } } else { return state.DoS(0, false, REJECT\_NONSTANDARD, "too many potential replacements", false, strprintf("rejecting replacement %s; too many potential replacements (%d > %d)\n", hash.ToString(), nConflictingCount, maxDescendantsToVisit)); }
 for (unsigned int j = 0; j < tx.vin.size(); j++) { // We don't want to accept replacements that require low // feerate junk to be mined first. Ideally we'd keep track of // the ancestor feerates and make the decision based on that, // but for now requiring all new inputs to be confirmed works. if (!setConflictsParents.count(tx.vin[j].prevout.hash)) { // Rather than check the UTXO set - potentially expensive - // it's cheaper to just check if the new input refers to a // tx that's in the mempool. if (pool.mapTx.find(tx.vin[j].prevout.hash) != pool.mapTx.end()) return state.DoS(0, false, REJECT\_NONSTANDARD, "replacement-adds-unconfirmed", false, strprintf("replacement %s adds unconfirmed input, idx %d", hash.ToString(), j)); } }
 // The replacement must pay greater fees than the transactions it // replaces - if we did the bandwidth used by those conflicting // transactions would not be paid for. if (nModifiedFees < nConflictingFees) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s, less fees than conflicting txs; %s < %s", hash.ToString(), FormatMoney(nModifiedFees), FormatMoney(nConflictingFees))); }
 // Finally in addition to paying more fees than the conflicts the // new transaction must pay for its own bandwidth. CAmount nDeltaFees = nModifiedFees - nConflictingFees; if (nDeltaFees < ::incrementalRelayFee.GetFee(nSize)) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s, not enough additional fees to relay; %s < %s", hash.ToString(), FormatMoney(nDeltaFees), FormatMoney(::incrementalRelayFee.GetFee(nSize)))); } }
 unsigned int scriptVerifyFlags = STANDARD\_SCRIPT\_VERIFY\_FLAGS; if (!Params().RequireStandard()) { scriptVerifyFlags = GetArg("-promiscuousmempoolflags", scriptVerifyFlags); }
 // Check against previous transactions // This is done last to help prevent CPU exhaustion denial-of-service attacks. PrecomputedTransactionData txdata(tx); if (!CheckInputs(tx, state, view, true, scriptVerifyFlags, true, txdata)) { // SCRIPT\_VERIFY\_CLEANSTACK requires SCRIPT\_VERIFY\_WITNESS, so we // need to turn both off, and compare against just turning off CLEANSTACK // to see if the failure is specifically due to witness validation. CValidationState stateDummy; // Want reported failures to be from first CheckInputs if (!tx.HasWitness() && CheckInputs(tx, stateDummy, view, true, scriptVerifyFlags & ~(SCRIPT\_VERIFY\_WITNESS | SCRIPT\_VERIFY\_CLEANSTACK), true, txdata) && !CheckInputs(tx, stateDummy, view, true, scriptVerifyFlags & ~SCRIPT\_VERIFY\_CLEANSTACK, true, txdata)) { // Only the witness is missing, so the transaction itself may be fine. state.SetCorruptionPossible(); } return false; // state filled in by CheckInputs }
 // Check again against just the consensus-critical mandatory script // verification flags, in case of bugs in the standard flags that cause // transactions to pass as valid when they're actually invalid. For // instance the STRICTENC flag was incorrectly allowing certain // CHECKSIG NOT scripts to pass, even though they were invalid. // // There is a similar check in CreateNewBlock() to prevent creating // invalid blocks, however allowing such transactions into the mempool // can be exploited as a DoS attack. if (!CheckInputs(tx, state, view, true, MANDATORY\_SCRIPT\_VERIFY\_FLAGS, true, txdata)) { return error("%s: BUG! PLEASE REPORT THIS! ConnectInputs failed against MANDATORY but not STANDARD flags %s, %s", \_\_func\_\_, hash.ToString(), FormatStateMessage(state)); }
 // Remove conflicting transactions from the mempool BOOST\_FOREACH(const CTxMemPool::txiter it, allConflicting) { LogPrint("mempool", "replacing tx %s with %s for %s BTC additional fees, %d delta bytes\n", it->GetTx().GetHash().ToString(), hash.ToString(), FormatMoney(nModifiedFees - nConflictingFees), (int)nSize - (int)nConflictingSize); if (plTxnReplaced) plTxnReplaced->push\_back(it->GetSharedTx()); } pool.RemoveStaged(allConflicting, false, MemPoolRemovalReason::REPLACED);
 // This transaction should only count for fee estimation if it isn't a // BIP 125 replacement transaction (may not be widely supported), the // node is not behind, and the transaction is not dependent on any other // transactions in the mempool. bool validForFeeEstimation = !fReplacementTransaction && IsCurrentForFeeEstimation() && pool.HasNoInputsOf(tx);
 // Store transaction in memory pool.addUnchecked(hash, entry, setAncestors, validForFeeEstimation);[View remainder of file in raw view](https://github.com/JinBean/CVE-Extension/raw/refs/heads/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from medium.com_5e4b600b_20250126_064132.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ffe6d695f45d5&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40lukedashjr%2Fcve-2017-18350-disclosure-fe6d695f45d5&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40lukedashjr%2Fcve-2017-18350-disclosure-fe6d695f45d5&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# CVE-2017–18350 disclosure

[![Luke Dashjr](https://miro.medium.com/v2/resize:fill:88:88/1*_BvgnaAjptM6nOVIe-c9hQ.jpeg)](/%40lukedashjr?source=post_page---byline--fe6d695f45d5--------------------------------)

[Luke Dashjr](/%40lukedashjr?source=post_page---byline--fe6d695f45d5--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fb30f61693938&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40lukedashjr%2Fcve-2017-18350-disclosure-fe6d695f45d5&user=Luke+Dashjr&userId=b30f61693938&source=post_page-b30f61693938--byline--fe6d695f45d5---------------------post_header-----------)

2 min read·Nov 8, 2019

--

Listen

Share

CVE-2017–18350 is a buffer overflow vulnerability which allows a malicious SOCKS proxy server to overwrite the program stack on systems with a signed `char` type (including common 32-bit and 64-bit x86 PCs).

The vulnerability was introduced in [60a87bce873ce1f76a80b7b8546e83a0cd4e07a5 (SOCKS5 support)](https://github.com/bitcoin/bitcoin/commit/60a87bce873ce1f76a80b7b8546e83a0cd4e07a5) and first released in Bitcoin Core v0.7.0rc1 in 2012 Aug 27. A fix was hidden in [d90a00eabed0f3f1acea4834ad489484d0012372 (“Improve and document SOCKS code”)](https://github.com/bitcoin/bitcoin/commit/d90a00eabed0f3f1acea4834ad489484d0012372) released in v0.15.1, 2017 Nov 6.

To be vulnerable, the node must be configured to use such a malicious proxy in the first place. Note that using *any* proxy over an insecure network (such as the Internet) is potentially a vulnerability since the connection could be intercepted for such a purpose.

Upon a connection request from the node, the malicious proxy would respond with an acknowledgement of a different target domain name than the one requested. Normally this acknowledgement is entirely ignored, but if the length uses the high bit (ie, a length 128–255 inclusive), it will be interpreted by vulnerable versions as a negative number instead. When the negative number is passed to the recv() system call to read the domain name, it is converted back to an unsigned/positive number, but at a much wider size (typically 32-bit), resulting in an effectively infinite read into and beyond the 256-byte dummy stack buffer.

To fix this vulnerability, the dummy buffer was changed to an explicitly unsigned data type, avoiding the conversion to/from a negative number.

Credit goes to [practicalswift (https://twitter.com/practicalswift)](https://twitter.com/practicalswift) for discovering and providing the initial fix for the vulnerability, and Wladimir J. van der Laan for a disguised version of the fix as well as general cleanup to the at-risk code.

## Timeline

- 2012–04–01: Vulnerability introduced in [PR #1141](https://github.com/bitcoin/bitcoin/pull/1141).
- 2012–05–08: Vulnerability merged to master git repository.
- 2012–08–27: Vulnerability published in v0.7.0rc1.
- 2012–09–17: Vulnerability released in v0.7.0.
…
- 2017–09–21: practicalswift discloses vulnerability to security team.
- 2017–09–23: Wladimir opens [PR #11397](https://github.com/bitcoin/bitcoin/pull/11397) to quietly fix vulnerability.
- 2017–09–27: Fix merged to master git repository.
- 2017–10–18: Fix merged to 0.15 git repository.
- 2017–11–04: Fix published in v0.15.1rc1.
- 2017–11–09: Fix released in v0.15.1.
…
- 2019–06–22: Vulnerability existence disclosed to bitcoin-dev ML.
- 2019–11–08: Vulnerability details disclosure to bitcoin-dev ML.

--

--

[![Luke Dashjr](https://miro.medium.com/v2/resize:fill:96:96/1*_BvgnaAjptM6nOVIe-c9hQ.jpeg)](/%40lukedashjr?source=post_page---post_author_info--fe6d695f45d5--------------------------------)[![Luke Dashjr](https://miro.medium.com/v2/resize:fill:128:128/1*_BvgnaAjptM6nOVIe-c9hQ.jpeg)](/%40lukedashjr?source=post_page---post_author_info--fe6d695f45d5--------------------------------)Follow[## Written by Luke Dashjr](/%40lukedashjr?source=post_page---post_author_info--fe6d695f45d5--------------------------------)[1.7K Followers](/%40lukedashjr/followers?source=post_page---post_author_info--fe6d695f45d5--------------------------------)·[9 Following](/%40lukedashjr/following?source=post_page---post_author_info--fe6d695f45d5--------------------------------)

Bitcoin Core developer

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----fe6d695f45d5--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----fe6d695f45d5--------------------------------)[About](/about?autoplay=1&source=post_page-----fe6d695f45d5--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----fe6d695f45d5--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----fe6d695f45d5--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----fe6d695f45d5--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----fe6d695f45d5--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----fe6d695f45d5--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----fe6d695f45d5--------------------------------)[Teams](/business?source=post_page-----fe6d695f45d5--------------------------------)



=== Content from github.com_bc457f50_20250126_064127.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Fblob%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X%2Fvalidation.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FJinBean%2FCVE-Extension%2Fblob%2Fmaster%2FCVE-2018-17144%2FBitcoin-0.14.X%2Fvalidation.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=JinBean%2FCVE-Extension)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[JinBean](/JinBean)
/
**[CVE-Extension](/JinBean/CVE-Extension)**
Public

* [Notifications](/login?return_to=%2FJinBean%2FCVE-Extension) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2FJinBean%2FCVE-Extension)
* [Star
   3](/login?return_to=%2FJinBean%2FCVE-Extension)

* [Code](/JinBean/CVE-Extension)
* [Issues
  0](/JinBean/CVE-Extension/issues)
* [Pull requests
  0](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects
  0](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

Additional navigation options

* [Code](/JinBean/CVE-Extension)
* [Issues](/JinBean/CVE-Extension/issues)
* [Pull requests](/JinBean/CVE-Extension/pulls)
* [Actions](/JinBean/CVE-Extension/actions)
* [Projects](/JinBean/CVE-Extension/projects)
* [Security](/JinBean/CVE-Extension/security)
* [Insights](/JinBean/CVE-Extension/pulse)

## Files

 master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
3. /[Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X)
/
# validation.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/JinBean/CVE-Extension/commits/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)4330 lines (3798 loc) · 187 KB master
## Breadcrumbs

1. [CVE-Extension](/JinBean/CVE-Extension/tree/master)
2. /[CVE-2018-17144](/JinBean/CVE-Extension/tree/master/CVE-2018-17144)
3. /[Bitcoin-0.14.X](/JinBean/CVE-Extension/tree/master/CVE-2018-17144/Bitcoin-0.14.X)
/
# validation.cpp

Top
## File metadata and controls

* Code
* Blame

4330 lines (3798 loc) · 187 KB[Raw](https://github.com/JinBean/CVE-Extension/raw/refs/heads/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000// Copyright (c) 2009-2010 Satoshi Nakamoto// Copyright (c) 2009-2016 The Bitcoin Core developers// Distributed under the MIT software license, see the accompanying// file COPYING or http://www.opensource.org/licenses/mit-license.php.
#include "validation.h"
#include "arith\_uint256.h"#include "chainparams.h"#include "checkpoints.h"#include "checkqueue.h"#include "consensus/consensus.h"#include "consensus/merkle.h"#include "consensus/validation.h"#include "hash.h"#include "init.h"#include "policy/fees.h"#include "policy/policy.h"#include "pow.h"#include "primitives/block.h"#include "primitives/transaction.h"#include "random.h"#include "script/script.h"#include "script/sigcache.h"#include "script/standard.h"#include "timedata.h"#include "tinyformat.h"#include "txdb.h"#include "txmempool.h"#include "ui\_interface.h"#include "undo.h"#include "util.h"#include "utilmoneystr.h"#include "utilstrencodings.h"#include "validationinterface.h"#include "versionbits.h"#include "warnings.h"
#include <atomic>#include <sstream>
#include <boost/algorithm/string/replace.hpp>#include <boost/algorithm/string/join.hpp>#include <boost/filesystem.hpp>#include <boost/filesystem/fstream.hpp>#include <boost/math/distributions/poisson.hpp>#include <boost/thread.hpp>
#if defined(NDEBUG)# error "Bitcoin cannot be compiled without assertions."#endif
/\*\* \* Global state \*/
CCriticalSection cs\_main;
BlockMap mapBlockIndex;CChain chainActive;CBlockIndex \*pindexBestHeader = NULL;CWaitableCriticalSection csBestBlock;CConditionVariable cvBlockChange;int nScriptCheckThreads = 0;std::atomic\_bool fImporting(false);bool fReindex = false;bool fTxIndex = false;bool fHavePruned = false;bool fPruneMode = false;bool fIsBareMultisigStd = DEFAULT\_PERMIT\_BAREMULTISIG;bool fRequireStandard = true;bool fCheckBlockIndex = false;bool fCheckpointsEnabled = DEFAULT\_CHECKPOINTS\_ENABLED;size\_t nCoinCacheUsage = 5000 \* 300;uint64\_t nPruneTarget = 0;int64\_t nMaxTipAge = DEFAULT\_MAX\_TIP\_AGE;bool fEnableReplacement = DEFAULT\_ENABLE\_REPLACEMENT;
uint256 hashAssumeValid;
CFeeRate minRelayTxFee = CFeeRate(DEFAULT\_MIN\_RELAY\_TX\_FEE);CAmount maxTxFee = DEFAULT\_TRANSACTION\_MAXFEE;
CTxMemPool mempool(::minRelayTxFee);
static void CheckBlockIndex(const Consensus::Params& consensusParams);
/\*\* Constant stuff for coinbase transactions we create: \*/CScript COINBASE\_FLAGS;
const std::string strMessageMagic = "Bitcoin Signed Message:\n";
// Internal stuffnamespace {
 struct CBlockIndexWorkComparator { bool operator()(CBlockIndex \*pa, CBlockIndex \*pb) const { // First sort by most total work, ... if (pa->nChainWork > pb->nChainWork) return false; if (pa->nChainWork < pb->nChainWork) return true;
 // ... then by earliest time received, ... if (pa->nSequenceId < pb->nSequenceId) return false; if (pa->nSequenceId > pb->nSequenceId) return true;
 // Use pointer address as tie breaker (should only happen with blocks // loaded from disk, as those all have id 0). if (pa < pb) return false; if (pa > pb) return true;
 // Identical blocks. return false; } };
 CBlockIndex \*pindexBestInvalid;
 /\*\* \* The set of all CBlockIndex entries with BLOCK\_VALID\_TRANSACTIONS (for itself and all ancestors) and \* as good as our current tip or better. Entries may be failed, though, and pruning nodes may be \* missing the data for the block. \*/ std::set<CBlockIndex\*, CBlockIndexWorkComparator> setBlockIndexCandidates; /\*\* All pairs A->B, where A (or one of its ancestors) misses transactions, but B has transactions. \* Pruned nodes may have entries where B is missing data. \*/ std::multimap<CBlockIndex\*, CBlockIndex\*> mapBlocksUnlinked;
 CCriticalSection cs\_LastBlockFile; std::vector<CBlockFileInfo> vinfoBlockFile; int nLastBlockFile = 0; /\*\* Global flag to indicate we should check to see if there are \* block/undo files that should be deleted. Set on startup \* or if we allocate more file space when we're in prune mode \*/ bool fCheckForPruning = false;
 /\*\* \* Every received block is assigned a unique and increasing identifier, so we \* know which one to give priority in case of a fork. \*/ CCriticalSection cs\_nBlockSequenceId; /\*\* Blocks loaded from disk are assigned id 0, so start the counter at 1. \*/ int32\_t nBlockSequenceId = 1; /\*\* Decreasing counter (used by subsequent preciousblock calls). \*/ int32\_t nBlockReverseSequenceId = -1; /\*\* chainwork for the last block that preciousblock has been applied to. \*/ arith\_uint256 nLastPreciousChainwork = 0;
 /\*\* Dirty block index entries. \*/ std::set<CBlockIndex\*> setDirtyBlockIndex;
 /\*\* Dirty block file entries. \*/ std::set<int> setDirtyFileInfo;} // anon namespace
/\* Use this class to start tracking transactions that are removed from the \* mempool and pass all those transactions through SyncTransaction when the \* object goes out of scope. This is currently only used to call SyncTransaction \* on conflicts removed from the mempool during block connection. Applied in \* ActivateBestChain around ActivateBestStep which in turn calls: \* ConnectTip->removeForBlock->removeConflicts \*/class MemPoolConflictRemovalTracker{private: std::vector<CTransactionRef> conflictedTxs; CTxMemPool &pool;
public: MemPoolConflictRemovalTracker(CTxMemPool &\_pool) : pool(\_pool) { pool.NotifyEntryRemoved.connect(boost::bind(&MemPoolConflictRemovalTracker::NotifyEntryRemoved, this, \_1, \_2)); }
 void NotifyEntryRemoved(CTransactionRef txRemoved, MemPoolRemovalReason reason) { if (reason == MemPoolRemovalReason::CONFLICT) { conflictedTxs.push\_back(txRemoved); } }
 ~MemPoolConflictRemovalTracker() { pool.NotifyEntryRemoved.disconnect(boost::bind(&MemPoolConflictRemovalTracker::NotifyEntryRemoved, this, \_1, \_2)); for (const auto& tx : conflictedTxs) { GetMainSignals().SyncTransaction(\*tx, NULL, CMainSignals::SYNC\_TRANSACTION\_NOT\_IN\_BLOCK); } conflictedTxs.clear(); }};
CBlockIndex\* FindForkInGlobalIndex(const CChain& chain, const CBlockLocator& locator){ // Find the first block the caller has in the main chain BOOST\_FOREACH(const uint256& hash, locator.vHave) { BlockMap::iterator mi = mapBlockIndex.find(hash); if (mi != mapBlockIndex.end()) { CBlockIndex\* pindex = (\*mi).second; if (chain.Contains(pindex)) return pindex; if (pindex->GetAncestor(chain.Height()) == chain.Tip()) { return chain.Tip(); } } } return chain.Genesis();}
CCoinsViewCache \*pcoinsTip = NULL;CBlockTreeDB \*pblocktree = NULL;
enum FlushStateMode { FLUSH\_STATE\_NONE, FLUSH\_STATE\_IF\_NEEDED, FLUSH\_STATE\_PERIODIC, FLUSH\_STATE\_ALWAYS};
// See definition for documentationbool static FlushStateToDisk(CValidationState &state, FlushStateMode mode, int nManualPruneHeight=0);void FindFilesToPruneManual(std::set<int>& setFilesToPrune, int nManualPruneHeight);
bool IsFinalTx(const CTransaction &tx, int nBlockHeight, int64\_t nBlockTime){ if (tx.nLockTime == 0) return true; if ((int64\_t)tx.nLockTime < ((int64\_t)tx.nLockTime < LOCKTIME\_THRESHOLD ? (int64\_t)nBlockHeight : nBlockTime)) return true; for (const auto& txin : tx.vin) { if (!(txin.nSequence == CTxIn::SEQUENCE\_FINAL)) return false; } return true;}
bool CheckFinalTx(const CTransaction &tx, int flags){ AssertLockHeld(cs\_main);
 // By convention a negative value for flags indicates that the // current network-enforced consensus rules should be used. In // a future soft-fork scenario that would mean checking which // rules would be enforced for the next block and setting the // appropriate flags. At the present time no soft-forks are // scheduled, so no flags are set. flags = std::max(flags, 0);
 // CheckFinalTx() uses chainActive.Height()+1 to evaluate // nLockTime because when IsFinalTx() is called within // CBlock::AcceptBlock(), the height of the block \*being\* // evaluated is what is used. Thus if we want to know if a // transaction can be part of the \*next\* block, we need to call // IsFinalTx() with one more than chainActive.Height(). const int nBlockHeight = chainActive.Height() + 1;
 // BIP113 will require that time-locked transactions have nLockTime set to // less than the median time of the previous block they're contained in. // When the next block is created its previous block will be the current // chain tip, so we use that to calculate the median time passed to // IsFinalTx() if LOCKTIME\_MEDIAN\_TIME\_PAST is set. const int64\_t nBlockTime = (flags & LOCKTIME\_MEDIAN\_TIME\_PAST) ? chainActive.Tip()->GetMedianTimePast() : GetAdjustedTime();
 return IsFinalTx(tx, nBlockHeight, nBlockTime);}
/\*\* \* Calculates the block height and previous block's median time past at \* which the transaction will be considered final in the context of BIP 68. \* Also removes from the vector of input heights any entries which did not \* correspond to sequence locked inputs as they do not affect the calculation. \*/static std::pair<int, int64\_t> CalculateSequenceLocks(const CTransaction &tx, int flags, std::vector<int>\* prevHeights, const CBlockIndex& block){ assert(prevHeights->size() == tx.vin.size());
 // Will be set to the equivalent height- and time-based nLockTime // values that would be necessary to satisfy all relative lock- // time constraints given our view of block chain history. // The semantics of nLockTime are the last invalid height/time, so // use -1 to have the effect of any height or time being valid. int nMinHeight = -1; int64\_t nMinTime = -1;
 // tx.nVersion is signed integer so requires cast to unsigned otherwise // we would be doing a signed comparison and half the range of nVersion // wouldn't support BIP 68. bool fEnforceBIP68 = static\_cast<uint32\_t>(tx.nVersion) >= 2 && flags & LOCKTIME\_VERIFY\_SEQUENCE;
 // Do not enforce sequence numbers as a relative lock time // unless we have been instructed to if (!fEnforceBIP68) { return std::make\_pair(nMinHeight, nMinTime); }
 for (size\_t txinIndex = 0; txinIndex < tx.vin.size(); txinIndex++) { const CTxIn& txin = tx.vin[txinIndex];
 // Sequence numbers with the most significant bit set are not // treated as relative lock-times, nor are they given any // consensus-enforced meaning at this point. if (txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_DISABLE\_FLAG) { // The height of this input is not relevant for sequence locks (\*prevHeights)[txinIndex] = 0; continue; }
 int nCoinHeight = (\*prevHeights)[txinIndex];
 if (txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_TYPE\_FLAG) { int64\_t nCoinTime = block.GetAncestor(std::max(nCoinHeight-1, 0))->GetMedianTimePast(); // NOTE: Subtract 1 to maintain nLockTime semantics // BIP 68 relative lock times have the semantics of calculating // the first block or time at which the transaction would be // valid. When calculating the effective block time or height // for the entire transaction, we switch to using the // semantics of nLockTime which is the last invalid block // time or height. Thus we subtract 1 from the calculated // time or height.
 // Time-based relative lock-times are measured from the // smallest allowed timestamp of the block containing the // txout being spent, which is the median time past of the // block prior. nMinTime = std::max(nMinTime, nCoinTime + (int64\_t)((txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_MASK) << CTxIn::SEQUENCE\_LOCKTIME\_GRANULARITY) - 1); } else { nMinHeight = std::max(nMinHeight, nCoinHeight + (int)(txin.nSequence & CTxIn::SEQUENCE\_LOCKTIME\_MASK) - 1); } }
 return std::make\_pair(nMinHeight, nMinTime);}
static bool EvaluateSequenceLocks(const CBlockIndex& block, std::pair<int, int64\_t> lockPair){ assert(block.pprev); int64\_t nBlockTime = block.pprev->GetMedianTimePast(); if (lockPair.first >= block.nHeight || lockPair.second >= nBlockTime) return false;
 return true;}
bool SequenceLocks(const CTransaction &tx, int flags, std::vector<int>\* prevHeights, const CBlockIndex& block){ return EvaluateSequenceLocks(block, CalculateSequenceLocks(tx, flags, prevHeights, block));}
bool TestLockPointValidity(const LockPoints\* lp){ AssertLockHeld(cs\_main); assert(lp); // If there are relative lock times then the maxInputBlock will be set // If there are no relative lock times, the LockPoints don't depend on the chain if (lp->maxInputBlock) { // Check whether chainActive is an extension of the block at which the LockPoints // calculation was valid. If not LockPoints are no longer valid if (!chainActive.Contains(lp->maxInputBlock)) { return false; } }
 // LockPoints still valid return true;}
bool CheckSequenceLocks(const CTransaction &tx, int flags, LockPoints\* lp, bool useExistingLockPoints){ AssertLockHeld(cs\_main); AssertLockHeld(mempool.cs);
 CBlockIndex\* tip = chainActive.Tip(); CBlockIndex index; index.pprev = tip; // CheckSequenceLocks() uses chainActive.Height()+1 to evaluate // height based locks because when SequenceLocks() is called within // ConnectBlock(), the height of the block \*being\* // evaluated is what is used. // Thus if we want to know if a transaction can be part of the // \*next\* block, we need to use one more than chainActive.Height() index.nHeight = tip->nHeight + 1;
 std::pair<int, int64\_t> lockPair; if (useExistingLockPoints) { assert(lp); lockPair.first = lp->height; lockPair.second = lp->time; } else { // pcoinsTip contains the UTXO set for chainActive.Tip() CCoinsViewMemPool viewMemPool(pcoinsTip, mempool); std::vector<int> prevheights; prevheights.resize(tx.vin.size()); for (size\_t txinIndex = 0; txinIndex < tx.vin.size(); txinIndex++) { const CTxIn& txin = tx.vin[txinIndex]; CCoins coins; if (!viewMemPool.GetCoins(txin.prevout.hash, coins)) { return error("%s: Missing input", \_\_func\_\_); } if (coins.nHeight == MEMPOOL\_HEIGHT) { // Assume all mempool transaction confirm in the next block prevheights[txinIndex] = tip->nHeight + 1; } else { prevheights[txinIndex] = coins.nHeight; } } lockPair = CalculateSequenceLocks(tx, flags, &prevheights, index); if (lp) { lp->height = lockPair.first; lp->time = lockPair.second; // Also store the hash of the block with the highest height of // all the blocks which have sequence locked prevouts. // This hash needs to still be on the chain // for these LockPoint calculations to be valid // Note: It is impossible to correctly calculate a maxInputBlock // if any of the sequence locked inputs depend on unconfirmed txs, // except in the special case where the relative lock time/height // is 0, which is equivalent to no sequence lock. Since we assume // input height of tip+1 for mempool txs and test the resulting // lockPair from CalculateSequenceLocks against tip+1. We know // EvaluateSequenceLocks will fail if there was a non-zero sequence // lock on a mempool input, so we can use the return value of // CheckSequenceLocks to indicate the LockPoints validity int maxInputHeight = 0; BOOST\_FOREACH(int height, prevheights) { // Can ignore mempool inputs since we'll fail if they had non-zero locks if (height != tip->nHeight+1) { maxInputHeight = std::max(maxInputHeight, height); } } lp->maxInputBlock = tip->GetAncestor(maxInputHeight); } } return EvaluateSequenceLocks(index, lockPair);}
unsigned int GetLegacySigOpCount(const CTransaction& tx){ unsigned int nSigOps = 0; for (const auto& txin : tx.vin) { nSigOps += txin.scriptSig.GetSigOpCount(false); } for (const auto& txout : tx.vout) { nSigOps += txout.scriptPubKey.GetSigOpCount(false); } return nSigOps;}
unsigned int GetP2SHSigOpCount(const CTransaction& tx, const CCoinsViewCache& inputs){ if (tx.IsCoinBase()) return 0;
 unsigned int nSigOps = 0; for (unsigned int i = 0; i < tx.vin.size(); i++) { const CTxOut &prevout = inputs.GetOutputFor(tx.vin[i]); if (prevout.scriptPubKey.IsPayToScriptHash()) nSigOps += prevout.scriptPubKey.GetSigOpCount(tx.vin[i].scriptSig); } return nSigOps;}
int64\_t GetTransactionSigOpCost(const CTransaction& tx, const CCoinsViewCache& inputs, int flags){ int64\_t nSigOps = GetLegacySigOpCount(tx) \* WITNESS\_SCALE\_FACTOR;
 if (tx.IsCoinBase()) return nSigOps;
 if (flags & SCRIPT\_VERIFY\_P2SH) { nSigOps += GetP2SHSigOpCount(tx, inputs) \* WITNESS\_SCALE\_FACTOR; }
 for (unsigned int i = 0; i < tx.vin.size(); i++) { const CTxOut &prevout = inputs.GetOutputFor(tx.vin[i]); nSigOps += CountWitnessSigOps(tx.vin[i].scriptSig, prevout.scriptPubKey, &tx.vin[i].scriptWitness, flags); } return nSigOps;}
bool CheckTransaction(const CTransaction& tx, CValidationState &state, bool fCheckDuplicateInputs){ // Basic checks that don't depend on any context if (tx.vin.empty()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-vin-empty"); if (tx.vout.empty()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-vout-empty"); // Size limits (this doesn't take the witness into account, as that hasn't been checked for malleability) if (::GetSerializeSize(tx, SER\_NETWORK, PROTOCOL\_VERSION | SERIALIZE\_TRANSACTION\_NO\_WITNESS) > MAX\_BLOCK\_BASE\_SIZE) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-oversize");
 // Check for negative or overflow output values CAmount nValueOut = 0; for (const auto& txout : tx.vout) { if (txout.nValue < 0) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-vout-negative"); if (txout.nValue > MAX\_MONEY) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-vout-toolarge"); nValueOut += txout.nValue; if (!MoneyRange(nValueOut)) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-txouttotal-toolarge"); }
 // Check for duplicate inputs - note that this check is slow so we skip it in CheckBlock if (fCheckDuplicateInputs) { std::set<COutPoint> vInOutPoints; for (const auto& txin : tx.vin) { if (!vInOutPoints.insert(txin.prevout).second) return state.DoS(100, false, REJECT\_INVALID, "bad-txns-inputs-duplicate"); } }
 if (tx.IsCoinBase()) { if (tx.vin[0].scriptSig.size() < 2 || tx.vin[0].scriptSig.size() > 100) return state.DoS(100, false, REJECT\_INVALID, "bad-cb-length"); } else { for (const auto& txin : tx.vin) if (txin.prevout.IsNull()) return state.DoS(10, false, REJECT\_INVALID, "bad-txns-prevout-null"); }
 return true;}
void LimitMempoolSize(CTxMemPool& pool, size\_t limit, unsigned long age) { int expired = pool.Expire(GetTime() - age); if (expired != 0) LogPrint("mempool", "Expired %i transactions from the memory pool\n", expired);
 std::vector<uint256> vNoSpendsRemaining; pool.TrimToSize(limit, &vNoSpendsRemaining); BOOST\_FOREACH(const uint256& removed, vNoSpendsRemaining) pcoinsTip->Uncache(removed);}
/\*\* Convert CValidationState to a human-readable message for logging \*/std::string FormatStateMessage(const CValidationState &state){ return strprintf("%s%s (code %i)", state.GetRejectReason(), state.GetDebugMessage().empty() ? "" : ", "+state.GetDebugMessage(), state.GetRejectCode());}
static bool IsCurrentForFeeEstimation(){ AssertLockHeld(cs\_main); if (IsInitialBlockDownload()) return false; if (chainActive.Tip()->GetBlockTime() < (GetTime() - MAX\_FEE\_ESTIMATION\_TIP\_AGE)) return false; if (chainActive.Height() < pindexBestHeader->nHeight - 1) return false; return true;}
bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState& state, const CTransactionRef& ptx, bool fLimitFree, bool\* pfMissingInputs, int64\_t nAcceptTime, std::list<CTransactionRef>\* plTxnReplaced, bool fOverrideMempoolLimit, const CAmount& nAbsurdFee, std::vector<uint256>& vHashTxnToUncache){ const CTransaction& tx = \*ptx; const uint256 hash = tx.GetHash(); AssertLockHeld(cs\_main); if (pfMissingInputs) \*pfMissingInputs = false;
 if (!CheckTransaction(tx, state)) return false; // state filled in by CheckTransaction
 // Coinbase is only valid in a block, not as a loose transaction if (tx.IsCoinBase()) return state.DoS(100, false, REJECT\_INVALID, "coinbase");
 // Reject transactions with witness before segregated witness activates (override with -prematurewitness) bool witnessEnabled = IsWitnessEnabled(chainActive.Tip(), Params().GetConsensus()); if (!GetBoolArg("-prematurewitness",false) && tx.HasWitness() && !witnessEnabled) { return state.DoS(0, false, REJECT\_NONSTANDARD, "no-witness-yet", true); }
 // Rather not work on nonstandard transactions (unless -testnet/-regtest) std::string reason; if (fRequireStandard && !IsStandardTx(tx, reason, witnessEnabled)) return state.DoS(0, false, REJECT\_NONSTANDARD, reason);
 // Only accept nLockTime-using transactions that can be mined in the next // block; we don't want our mempool filled up with transactions that can't // be mined yet. if (!CheckFinalTx(tx, STANDARD\_LOCKTIME\_VERIFY\_FLAGS)) return state.DoS(0, false, REJECT\_NONSTANDARD, "non-final");
 // is it already in the memory pool? if (pool.exists(hash)) return state.Invalid(false, REJECT\_ALREADY\_KNOWN, "txn-already-in-mempool");
 // Check for conflicts with in-memory transactions std::set<uint256> setConflicts; { LOCK(pool.cs); // protect pool.mapNextTx BOOST\_FOREACH(const CTxIn &txin, tx.vin) { auto itConflicting = pool.mapNextTx.find(txin.prevout); if (itConflicting != pool.mapNextTx.end()) { const CTransaction \*ptxConflicting = itConflicting->second; if (!setConflicts.count(ptxConflicting->GetHash())) { // Allow opt-out of transaction replacement by setting // nSequence >= maxint-1 on all inputs. // // maxint-1 is picked to still allow use of nLockTime by // non-replaceable transactions. All inputs rather than just one // is for the sake of multi-party protocols, where we don't // want a single party to be able to disable replacement. // // The opt-out ignores descendants as anyone relying on // first-seen mempool behavior should be checking all // unconfirmed ancestors anyway; doing otherwise is hopelessly // insecure. bool fReplacementOptOut = true; if (fEnableReplacement) { BOOST\_FOREACH(const CTxIn &\_txin, ptxConflicting->vin) { if (\_txin.nSequence < std::numeric\_limits<unsigned int>::max()-1) { fReplacementOptOut = false; break; } } } if (fReplacementOptOut) return state.Invalid(false, REJECT\_CONFLICT, "txn-mempool-conflict");
 setConflicts.insert(ptxConflicting->GetHash()); } } } }
 { CCoinsView dummy; CCoinsViewCache view(&dummy);
 CAmount nValueIn = 0; LockPoints lp; { LOCK(pool.cs); CCoinsViewMemPool viewMemPool(pcoinsTip, pool); view.SetBackend(viewMemPool);
 // do we already have it? bool fHadTxInCache = pcoinsTip->HaveCoinsInCache(hash); if (view.HaveCoins(hash)) { if (!fHadTxInCache) vHashTxnToUncache.push\_back(hash); return state.Invalid(false, REJECT\_ALREADY\_KNOWN, "txn-already-known"); }
 // do all inputs exist? // Note that this does not check for the presence of actual outputs (see the next check for that), // and only helps with filling in pfMissingInputs (to determine missing vs spent). BOOST\_FOREACH(const CTxIn txin, tx.vin) { if (!pcoinsTip->HaveCoinsInCache(txin.prevout.hash)) vHashTxnToUncache.push\_back(txin.prevout.hash); if (!view.HaveCoins(txin.prevout.hash)) { if (pfMissingInputs) \*pfMissingInputs = true; return false; // fMissingInputs and !state.IsInvalid() is used to detect this condition, don't set state.Invalid() } }
 // are the actual inputs available? if (!view.HaveInputs(tx)) return state.Invalid(false, REJECT\_DUPLICATE, "bad-txns-inputs-spent");
 // Bring the best block into scope view.GetBestBlock();
 nValueIn = view.GetValueIn(tx);
 // we have all inputs cached now, so switch back to dummy, so we don't need to keep lock on mempool view.SetBackend(dummy);
 // Only accept BIP68 sequence locked transactions that can be mined in the next // block; we don't want our mempool filled up with transactions that can't // be mined yet. // Must keep pool.cs for this unless we change CheckSequenceLocks to take a // CoinsViewCache instead of create its own if (!CheckSequenceLocks(tx, STANDARD\_LOCKTIME\_VERIFY\_FLAGS, &lp)) return state.DoS(0, false, REJECT\_NONSTANDARD, "non-BIP68-final"); }
 // Check for non-standard pay-to-script-hash in inputs if (fRequireStandard && !AreInputsStandard(tx, view)) return state.Invalid(false, REJECT\_NONSTANDARD, "bad-txns-nonstandard-inputs");
 // Check for non-standard witness in P2WSH if (tx.HasWitness() && fRequireStandard && !IsWitnessStandard(tx, view)) return state.DoS(0, false, REJECT\_NONSTANDARD, "bad-witness-nonstandard", true);
 int64\_t nSigOpsCost = GetTransactionSigOpCost(tx, view, STANDARD\_SCRIPT\_VERIFY\_FLAGS);
 CAmount nValueOut = tx.GetValueOut(); CAmount nFees = nValueIn-nValueOut; // nModifiedFees includes any fee deltas from PrioritiseTransaction CAmount nModifiedFees = nFees; double nPriorityDummy = 0; pool.ApplyDeltas(hash, nPriorityDummy, nModifiedFees);
 CAmount inChainInputValue; double dPriority = view.GetPriority(tx, chainActive.Height(), inChainInputValue);
 // Keep track of transactions that spend a coinbase, which we re-scan // during reorgs to ensure COINBASE\_MATURITY is still met. bool fSpendsCoinbase = false; BOOST\_FOREACH(const CTxIn &txin, tx.vin) { const CCoins \*coins = view.AccessCoins(txin.prevout.hash); if (coins->IsCoinBase()) { fSpendsCoinbase = true; break; } }
 CTxMemPoolEntry entry(ptx, nFees, nAcceptTime, dPriority, chainActive.Height(), inChainInputValue, fSpendsCoinbase, nSigOpsCost, lp); unsigned int nSize = entry.GetTxSize();
 // Check that the transaction doesn't have an excessive number of // sigops, making it impossible to mine. Since the coinbase transaction // itself can contain sigops MAX\_STANDARD\_TX\_SIGOPS is less than // MAX\_BLOCK\_SIGOPS; we still consider this an invalid rather than // merely non-standard transaction. if (nSigOpsCost > MAX\_STANDARD\_TX\_SIGOPS\_COST) return state.DoS(0, false, REJECT\_NONSTANDARD, "bad-txns-too-many-sigops", false, strprintf("%d", nSigOpsCost));
 CAmount mempoolRejectFee = pool.GetMinFee(GetArg("-maxmempool", DEFAULT\_MAX\_MEMPOOL\_SIZE) \* 1000000).GetFee(nSize); if (mempoolRejectFee > 0 && nModifiedFees < mempoolRejectFee) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "mempool min fee not met", false, strprintf("%d < %d", nFees, mempoolRejectFee)); } else if (GetBoolArg("-relaypriority", DEFAULT\_RELAYPRIORITY) && nModifiedFees < ::minRelayTxFee.GetFee(nSize) && !AllowFree(entry.GetPriority(chainActive.Height() + 1))) { // Require that free transactions have sufficient priority to be mined in the next block. return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient priority"); }
 // Continuously rate-limit free (really, very-low-fee) transactions // This mitigates 'penny-flooding' -- sending thousands of free transactions just to // be annoying or make others' transactions take longer to confirm. if (fLimitFree && nModifiedFees < ::minRelayTxFee.GetFee(nSize)) { static CCriticalSection csFreeLimiter; static double dFreeCount; static int64\_t nLastTime; int64\_t nNow = GetTime();
 LOCK(csFreeLimiter);
 // Use an exponentially decaying ~10-minute window: dFreeCount \*= pow(1.0 - 1.0/600.0, (double)(nNow - nLastTime)); nLastTime = nNow; // -limitfreerelay unit is thousand-bytes-per-minute // At default rate it would take over a month to fill 1GB if (dFreeCount + nSize >= GetArg("-limitfreerelay", DEFAULT\_LIMITFREERELAY) \* 10 \* 1000) return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "rate limited free transaction"); LogPrint("mempool", "Rate limit dFreeCount: %g => %g\n", dFreeCount, dFreeCount+nSize); dFreeCount += nSize; }
 if (nAbsurdFee && nFees > nAbsurdFee) return state.Invalid(false, REJECT\_HIGHFEE, "absurdly-high-fee", strprintf("%d > %d", nFees, nAbsurdFee));
 // Calculate in-mempool ancestors, up to a limit. CTxMemPool::setEntries setAncestors; size\_t nLimitAncestors = GetArg("-limitancestorcount", DEFAULT\_ANCESTOR\_LIMIT); size\_t nLimitAncestorSize = GetArg("-limitancestorsize", DEFAULT\_ANCESTOR\_SIZE\_LIMIT)\*1000; size\_t nLimitDescendants = GetArg("-limitdescendantcount", DEFAULT\_DESCENDANT\_LIMIT); size\_t nLimitDescendantSize = GetArg("-limitdescendantsize", DEFAULT\_DESCENDANT\_SIZE\_LIMIT)\*1000; std::string errString; if (!pool.CalculateMemPoolAncestors(entry, setAncestors, nLimitAncestors, nLimitAncestorSize, nLimitDescendants, nLimitDescendantSize, errString)) { return state.DoS(0, false, REJECT\_NONSTANDARD, "too-long-mempool-chain", false, errString); }
 // A transaction that spends outputs that would be replaced by it is invalid. Now // that we have the set of all ancestors we can detect this // pathological case by making sure setConflicts and setAncestors don't // intersect. BOOST\_FOREACH(CTxMemPool::txiter ancestorIt, setAncestors) { const uint256 &hashAncestor = ancestorIt->GetTx().GetHash(); if (setConflicts.count(hashAncestor)) { return state.DoS(10, false, REJECT\_INVALID, "bad-txns-spends-conflicting-tx", false, strprintf("%s spends conflicting transaction %s", hash.ToString(), hashAncestor.ToString())); } }
 // Check if it's economically rational to mine this transaction rather // than the ones it replaces. CAmount nConflictingFees = 0; size\_t nConflictingSize = 0; uint64\_t nConflictingCount = 0; CTxMemPool::setEntries allConflicting;
 // If we don't hold the lock allConflicting might be incomplete; the // subsequent RemoveStaged() and addUnchecked() calls don't guarantee // mempool consistency for us. LOCK(pool.cs); const bool fReplacementTransaction = setConflicts.size(); if (fReplacementTransaction) { CFeeRate newFeeRate(nModifiedFees, nSize); std::set<uint256> setConflictsParents; const int maxDescendantsToVisit = 100; CTxMemPool::setEntries setIterConflicting; BOOST\_FOREACH(const uint256 &hashConflicting, setConflicts) { CTxMemPool::txiter mi = pool.mapTx.find(hashConflicting); if (mi == pool.mapTx.end()) continue;
 // Save these to avoid repeated lookups setIterConflicting.insert(mi);
 // Don't allow the replacement to reduce the feerate of the // mempool. // // We usually don't want to accept replacements with lower // feerates than what they replaced as that would lower the // feerate of the next block. Requiring that the feerate always // be increased is also an easy-to-reason about way to prevent // DoS attacks via replacements. // // The mining code doesn't (currently) take children into // account (CPFP) so we only consider the feerates of // transactions being directly replaced, not their indirect // descendants. While that does mean high feerate children are // ignored when deciding whether or not to replace, we do // require the replacement to pay more overall fees too, // mitigating most cases. CFeeRate oldFeeRate(mi->GetModifiedFee(), mi->GetTxSize()); if (newFeeRate <= oldFeeRate) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s; new feerate %s <= old feerate %s", hash.ToString(), newFeeRate.ToString(), oldFeeRate.ToString())); }
 BOOST\_FOREACH(const CTxIn &txin, mi->GetTx().vin) { setConflictsParents.insert(txin.prevout.hash); }
 nConflictingCount += mi->GetCountWithDescendants(); } // This potentially overestimates the number of actual descendants // but we just want to be conservative to avoid doing too much // work. if (nConflictingCount <= maxDescendantsToVisit) { // If not too many to replace, then calculate the set of // transactions that would have to be evicted BOOST\_FOREACH(CTxMemPool::txiter it, setIterConflicting) { pool.CalculateDescendants(it, allConflicting); } BOOST\_FOREACH(CTxMemPool::txiter it, allConflicting) { nConflictingFees += it->GetModifiedFee(); nConflictingSize += it->GetTxSize(); } } else { return state.DoS(0, false, REJECT\_NONSTANDARD, "too many potential replacements", false, strprintf("rejecting replacement %s; too many potential replacements (%d > %d)\n", hash.ToString(), nConflictingCount, maxDescendantsToVisit)); }
 for (unsigned int j = 0; j < tx.vin.size(); j++) { // We don't want to accept replacements that require low // feerate junk to be mined first. Ideally we'd keep track of // the ancestor feerates and make the decision based on that, // but for now requiring all new inputs to be confirmed works. if (!setConflictsParents.count(tx.vin[j].prevout.hash)) { // Rather than check the UTXO set - potentially expensive - // it's cheaper to just check if the new input refers to a // tx that's in the mempool. if (pool.mapTx.find(tx.vin[j].prevout.hash) != pool.mapTx.end()) return state.DoS(0, false, REJECT\_NONSTANDARD, "replacement-adds-unconfirmed", false, strprintf("replacement %s adds unconfirmed input, idx %d", hash.ToString(), j)); } }
 // The replacement must pay greater fees than the transactions it // replaces - if we did the bandwidth used by those conflicting // transactions would not be paid for. if (nModifiedFees < nConflictingFees) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s, less fees than conflicting txs; %s < %s", hash.ToString(), FormatMoney(nModifiedFees), FormatMoney(nConflictingFees))); }
 // Finally in addition to paying more fees than the conflicts the // new transaction must pay for its own bandwidth. CAmount nDeltaFees = nModifiedFees - nConflictingFees; if (nDeltaFees < ::incrementalRelayFee.GetFee(nSize)) { return state.DoS(0, false, REJECT\_INSUFFICIENTFEE, "insufficient fee", false, strprintf("rejecting replacement %s, not enough additional fees to relay; %s < %s", hash.ToString(), FormatMoney(nDeltaFees), FormatMoney(::incrementalRelayFee.GetFee(nSize)))); } }
 unsigned int scriptVerifyFlags = STANDARD\_SCRIPT\_VERIFY\_FLAGS; if (!Params().RequireStandard()) { scriptVerifyFlags = GetArg("-promiscuousmempoolflags", scriptVerifyFlags); }
 // Check against previous transactions // This is done last to help prevent CPU exhaustion denial-of-service attacks. PrecomputedTransactionData txdata(tx); if (!CheckInputs(tx, state, view, true, scriptVerifyFlags, true, txdata)) { // SCRIPT\_VERIFY\_CLEANSTACK requires SCRIPT\_VERIFY\_WITNESS, so we // need to turn both off, and compare against just turning off CLEANSTACK // to see if the failure is specifically due to witness validation. CValidationState stateDummy; // Want reported failures to be from first CheckInputs if (!tx.HasWitness() && CheckInputs(tx, stateDummy, view, true, scriptVerifyFlags & ~(SCRIPT\_VERIFY\_WITNESS | SCRIPT\_VERIFY\_CLEANSTACK), true, txdata) && !CheckInputs(tx, stateDummy, view, true, scriptVerifyFlags & ~SCRIPT\_VERIFY\_CLEANSTACK, true, txdata)) { // Only the witness is missing, so the transaction itself may be fine. state.SetCorruptionPossible(); } return false; // state filled in by CheckInputs }
 // Check again against just the consensus-critical mandatory script // verification flags, in case of bugs in the standard flags that cause // transactions to pass as valid when they're actually invalid. For // instance the STRICTENC flag was incorrectly allowing certain // CHECKSIG NOT scripts to pass, even though they were invalid. // // There is a similar check in CreateNewBlock() to prevent creating // invalid blocks, however allowing such transactions into the mempool // can be exploited as a DoS attack. if (!CheckInputs(tx, state, view, true, MANDATORY\_SCRIPT\_VERIFY\_FLAGS, true, txdata)) { return error("%s: BUG! PLEASE REPORT THIS! ConnectInputs failed against MANDATORY but not STANDARD flags %s, %s", \_\_func\_\_, hash.ToString(), FormatStateMessage(state)); }
 // Remove conflicting transactions from the mempool BOOST\_FOREACH(const CTxMemPool::txiter it, allConflicting) { LogPrint("mempool", "replacing tx %s with %s for %s BTC additional fees, %d delta bytes\n", it->GetTx().GetHash().ToString(), hash.ToString(), FormatMoney(nModifiedFees - nConflictingFees), (int)nSize - (int)nConflictingSize); if (plTxnReplaced) plTxnReplaced->push\_back(it->GetSharedTx()); } pool.RemoveStaged(allConflicting, false, MemPoolRemovalReason::REPLACED);
 // This transaction should only count for fee estimation if it isn't a // BIP 125 replacement transaction (may not be widely supported), the // node is not behind, and the transaction is not dependent on any other // transactions in the mempool. bool validForFeeEstimation = !fReplacementTransaction && IsCurrentForFeeEstimation() && pool.HasNoInputsOf(tx);
 // Store transaction in memory pool.addUnchecked(hash, entry, setAncestors, validForFeeEstimation);[View remainder of file in raw view](https://github.com/JinBean/CVE-Extension/raw/refs/heads/master/CVE-2018-17144/Bitcoin-0.14.X/validation.cpp)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_19cdc19c_20250126_064131.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbitcoinknots%2Fbitcoin%2Fblob%2Fv0.16.3.knots20180918%2Fdoc%2Frelease-notes.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbitcoinknots%2Fbitcoin%2Fblob%2Fv0.16.3.knots20180918%2Fdoc%2Frelease-notes.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=bitcoinknots%2Fbitcoin)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bitcoinknots](/bitcoinknots)
/
**[bitcoin](/bitcoinknots/bitcoin)**
Public

forked from [bitcoin/bitcoin](/bitcoin/bitcoin)

* [Notifications](/login?return_to=%2Fbitcoinknots%2Fbitcoin) You must be signed in to change notification settings
* [Fork
  70](/login?return_to=%2Fbitcoinknots%2Fbitcoin)
* [Star
   231](/login?return_to=%2Fbitcoinknots%2Fbitcoin)

* [Code](/bitcoinknots/bitcoin/tree/v0.16.3.knots20180918)
* [Issues
  30](/bitcoinknots/bitcoin/issues)
* [Pull requests
  5](/bitcoinknots/bitcoin/pulls)
* [Discussions](/bitcoinknots/bitcoin/discussions)
* [Actions](/bitcoinknots/bitcoin/actions)
* [Security](/bitcoinknots/bitcoin/security)
* [Insights](/bitcoinknots/bitcoin/pulse)

Additional navigation options

* [Code](/bitcoinknots/bitcoin/tree/v0.16.3.knots20180918)
* [Issues](/bitcoinknots/bitcoin/issues)
* [Pull requests](/bitcoinknots/bitcoin/pulls)
* [Discussions](/bitcoinknots/bitcoin/discussions)
* [Actions](/bitcoinknots/bitcoin/actions)
* [Security](/bitcoinknots/bitcoin/security)
* [Insights](/bitcoinknots/bitcoin/pulse)

## Files

 v0.16.3.knots20180918
## Breadcrumbs

1. [bitcoin](/bitcoinknots/bitcoin/tree/v0.16.3.knots20180918)
2. /[doc](/bitcoinknots/bitcoin/tree/v0.16.3.knots20180918/doc)
/
# release-notes.md

Copy path Blame  Blame
## Latest commit

## History

[History](/bitcoinknots/bitcoin/commits/v0.16.3.knots20180918/doc/release-notes.md)79 lines (54 loc) · 2.61 KB v0.16.3.knots20180918
## Breadcrumbs

1. [bitcoin](/bitcoinknots/bitcoin/tree/v0.16.3.knots20180918)
2. /[doc](/bitcoinknots/bitcoin/tree/v0.16.3.knots20180918/doc)
/
# release-notes.md

Top
## File metadata and controls

* Preview
* Code
* Blame

79 lines (54 loc) · 2.61 KB[Raw](https://github.com/bitcoinknots/bitcoin/raw/refs/tags/v0.16.3.knots20180918/doc/release-notes.md)

Bitcoin Knots version *0.16.3.knots20180918* is now available from:

<https://bitcoinknots.org/files/0.16.x/0.16.3.knots20180918/>

This is a new minor version release, including new features, various bugfixes
and performance improvements, as well as updated translations.

Please report bugs using the issue tracker at GitHub:

<https://github.com/bitcoinknots/bitcoin/issues>

# How to Upgrade

If you are running an older version, shut it down. Wait until it has completely
shut down (which might take a few minutes for older versions), then run the
installer (on Windows) or just copy over `/Applications/Bitcoin-Qt` (on Mac)
or `bitcoind`/`bitcoin-qt` (on Linux).

The first time you run version 0.15.0 or newer, your chainstate database will be converted to a
new format, which will take anywhere from a few minutes to half an hour,
depending on the speed of your machine.

Note that the block database format also changed in version 0.8.0 and there is no
automatic upgrade code from before version 0.8 to version 0.15.0 or higher. Upgrading
directly from 0.7.x and earlier without re-downloading the blockchain is not supported.
However, as usual, old wallet versions are still supported.

## Downgrading warning

Wallets created in 0.16 and later are not compatible with versions prior to 0.16
and will not work if you try to use newly created wallets in older versions. Existing
wallets that were created with older versions are not affected by this.

# Compatibility

Bitcoin Knots is supported on multiple operating systems using the Linux kernel,
macOS 10.8+, and Windows Vista and later. Windows XP is not supported.

Bitcoin Knots should also work on most other Unix-like systems but is not
frequently tested on them.

# Notable changes

## Denial-of-Service vulnerability

A denial-of-service vulnerability exploitable by miners has been discovered in
Bitcoin Core versions 0.14.0 up to 0.16.2. It is recommended to upgrade any of
the vulnerable versions to 0.16.3 as soon as possible.

## 0.16.3 change log

### Consensus

* #14249 `696b936` Fix crash bug with duplicate inputs within a transaction (TheBlueMatt, sdaftuar)

### Documentation

* #13844 `11b9dbb` correct the help output for -prune (hebasto)

# Credits

Thanks to everyone who directly contributed to this release:

* Hennadii Stepanov
* Luke Dashjr
* Matt Corallo
* Suhas Daftuar
* Wladimir J. van der Laan

And to those that reported security issues:

* beardnboobies

As well as everyone that helped translating on [Transifex](https://www.transifex.com/projects/p/bitcoin/).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.gentoo.org_1e7c5206_20250126_064131.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 666669
<net-p2p/bitcoin{-qt,d}-0.16.3: (CVE-2018-17144)
Last modified: 2021-02-05 04:12:09 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=666669&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=666669&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 666669**](show_bug.cgi?id=666669)
- <net-p2p/bitcoin{-qt,d}-0.16.3: (CVE-2018-17144)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
<net-p2p/bitcoin{-qt,d}-0.16.3: (CVE-2018-17144)

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal minor | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | [https://github.com/gentoo/gentoo/pull...](https://github.com/gentoo/gentoo/pull/9907) | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | B3 [noglsa cve] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | Duplicates (1): | [666665](show_bug.cgi?id=666665 "RESOLVED DUPLICATE - net-p2p/bitcoin{d, -qt}: version bump to 0.16.3")  ([view as bug list](buglist.cgi?bug_id=666665)) | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [CVE-2018-17144](show_bug.cgi?id=768765 "RESOLVED FIXED - [Tracker] Denial of service in bitcoind (CVE-2018-17144)") | |  | Show dependency [tree](showdependencytree.cgi?id=666669&hide_resolved=1) | |  | | Reported: | 2018-09-21 01:46 UTC by Luke-Jr | | --- | --- | | Modified: | 2021-02-05 04:12 UTC ([History](show_activity.cgi?id=666669)) | | CC List: | 3 users (show)  andrius proxy-maint vdupras | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * <https://github.com/gentoo/gentoo/pull/9907> | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | | Flags: | stable-bot: sanity-check+ | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=666669&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=666669&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Luke-Jr    2018-09-21 01:46:30 UTC  ``` The full severity of CVE-2018-17144 has been prematurely leaked/disclosed (see <https://bitcoincore.org/en/2018/09/20/notice/> for details), so it's kind of urgent to get this merged ASAP.  PR at <https://github.com/gentoo/gentoo/pull/9907> ```  [Comment 1](#c1)  Andreas Sturmlechner   gentoo-dev  2018-09-21 07:10:52 UTC  ``` *** [Bug 666665](show_bug.cgi?id=666665 "RESOLVED DUPLICATE - net-p2p/bitcoin{d, -qt}: version bump to 0.16.3") has been marked as a duplicate of this bug. *** ```  [Comment 2](#c2)  Larry the Git Cow   gentoo-dev  2018-09-21 12:40:19 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=35caca435f172d52f62b9a9119a7234770f662f9>  commit 35caca435f172d52f62b9a9119a7234770f662f9 Author:     Luke Dashjr <luke-jr+git@utopios.org> AuthorDate: 2018-09-18 15:57:26 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-09-21 12:38:01 +0000      dev-util/bitcoin-tx: Bump to 0.16.3          Signed-off-by: Luke Dashjr <luke-jr+git@utopios.org>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Bug: <https://bugs.gentoo.org/666669>   dev-util/bitcoin-tx/Manifest                 |  2 +  dev-util/bitcoin-tx/bitcoin-tx-0.16.3.ebuild | 98 ++++++++++++++++++++++++++++  2 files changed, 100 insertions(+)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=f826abec95faa662523e1ce797ee2b9256d9c562>  commit f826abec95faa662523e1ce797ee2b9256d9c562 Author:     Luke Dashjr <luke-jr+git@utopios.org> AuthorDate: 2018-09-18 15:55:14 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-09-21 12:37:57 +0000      net-libs/libbitcoinconsensus: Bump to 0.16.3          Signed-off-by: Luke Dashjr <luke-jr+git@utopios.org>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Bug: <https://bugs.gentoo.org/666669>   net-libs/libbitcoinconsensus/Manifest              |  2 +  .../libbitcoinconsensus-0.16.3.ebuild              | 95 ++++++++++++++++++++++  2 files changed, 97 insertions(+)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=2bb81035351ee4da03befedbce1c41765ad09a11>  commit 2bb81035351ee4da03befedbce1c41765ad09a11 Author:     Luke Dashjr <luke-jr+git@utopios.org> AuthorDate: 2018-09-18 15:53:51 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-09-21 12:37:57 +0000      net-p2p/bitcoin-cli: Bump to 0.16.3          Signed-off-by: Luke Dashjr <luke-jr+git@utopios.org>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Bug: <https://bugs.gentoo.org/666669>   net-p2p/bitcoin-cli/Manifest                  |  2 +  net-p2p/bitcoin-cli/bitcoin-cli-0.16.3.ebuild | 97 +++++++++++++++++++++++++++  2 files changed, 99 insertions(+)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=d2d3e52654733b3f973d8ea7b3f0ea41bf00dec8>  commit d2d3e52654733b3f973d8ea7b3f0ea41bf00dec8 Author:     Luke Dashjr <luke-jr+git@utopios.org> AuthorDate: 2018-09-18 15:50:53 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-09-21 12:37:57 +0000      net-p2p/bitcoind: Bump to 0.16.3          Signed-off-by: Luke Dashjr <luke-jr+git@utopios.org>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Bug: <https://bugs.gentoo.org/666669>   net-p2p/bitcoind/Manifest               |   2 +  net-p2p/bitcoind/bitcoind-0.16.3.ebuild | 163 ++++++++++++++++++++++++++++++++  2 files changed, 165 insertions(+)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=9f73c62f7d8ebc6689028191b516c81440869c4a>  commit 9f73c62f7d8ebc6689028191b516c81440869c4a Author:     Luke Dashjr <luke-jr+git@utopios.org> AuthorDate: 2018-09-18 15:46:59 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-09-21 12:37:55 +0000      net-p2p/bitcoin-qt: Bump to 0.16.3          Signed-off-by: Luke Dashjr <luke-jr+git@utopios.org>     Closes: <https://github.com/gentoo/gentoo/pull/9907>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Bug: <https://bugs.gentoo.org/666669>   net-p2p/bitcoin-qt/Manifest                 |   2 +  net-p2p/bitcoin-qt/bitcoin-qt-0.16.3.ebuild | 182 ++++++++++++++++++++++++++++  2 files changed, 184 insertions(+) ```  [Comment 3](#c3)  Virgil Dupras (RETIRED)   gentoo-dev  2018-09-24 18:57:35 UTC  ``` The vulnerability hasn't been categorized by the security team yet, but let's start a stable request regardless... ```  [Comment 4](#c4)  Stabilization helper bot   gentoo-dev  2018-09-24 19:06:23 UTC  ``` An automated check of this bug failed - repoman reported dependency errors (101 lines truncated):   > dependency.bad net-p2p/bitcoin-qt/bitcoin-qt-0.16.3.ebuild: DEPEND: arm(default/linux/arm/13.0) ['dev-qt/qtcore:5', 'dev-qt/qtgui:5', 'dev-qt/qtnetwork:5', 'dev-qt/qtwidgets:5', 'dev-qt/qtdbus:5', 'dev-qt/linguist-tools:5'] > dependency.bad net-p2p/bitcoin-qt/bitcoin-qt-0.16.3.ebuild: RDEPEND: arm(default/linux/arm/13.0) ['dev-qt/qtcore:5', 'dev-qt/qtgui:5', 'dev-qt/qtnetwork:5', 'dev-qt/qtwidgets:5', 'dev-qt/qtdbus:5'] > dependency.bad net-p2p/bitcoin-qt/bitcoin-qt-0.16.3.ebuild: DEPEND: arm(default/linux/arm/17.0) ['dev-qt/qtcore:5', 'dev-qt/qtgui:5', 'dev-qt/qtnetwork:5', 'dev-qt/qtwidgets:5', 'dev-qt/qtdbus:5', 'dev-qt/linguist-tools:5'] ```  [Comment 5](#c5)  Stabilization helper bot   gentoo-dev  2018-09-24 20:03:53 UTC  ``` An automated check of this bug succeeded - the previous repoman errors are now resolved. ```  [Comment 6](#c6)  Agostino Sarubbo   gentoo-dev  2018-09-25 11:17:20 UTC  ``` amd64 stable ```  [Comment 7](#c7)  Thomas Deutschmann (RETIRED)   gentoo-dev  2018-10-01 00:09:57 UTC  ``` x86 stable ```  [Comment 8](#c8)  Virgil Dupras (RETIRED)   gentoo-dev  2018-10-15 19:23:14 UTC  ``` arm: we missed the security delay of 20 days. In a week, I'll proceed to cleanup whether this is stabilized or not. ```  [Comment 9](#c9)  Larry the Git Cow   gentoo-dev  2018-10-23 20:38:53 UTC  ``` The bug has been referenced in the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=6b0b2fb607337ffc92be3d8313498e55616e6963>  commit 6b0b2fb607337ffc92be3d8313498e55616e6963 Author:     Virgil Dupras <vdupras@gentoo.org> AuthorDate: 2018-10-23 20:37:40 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-10-23 20:38:28 +0000      dev-util/bitcoin-tx: remove old and vulnerable          Bug: <https://bugs.gentoo.org/666669>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Package-Manager: Portage-2.3.51, Repoman-2.3.11   dev-util/bitcoin-tx/Manifest                 |   2 -  dev-util/bitcoin-tx/bitcoin-tx-0.15.1.ebuild | 102 ---------------------------  2 files changed, 104 deletions(-)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=a51f2a1855e1dd6c62eb7a8ee17ca27531f9d146>  commit a51f2a1855e1dd6c62eb7a8ee17ca27531f9d146 Author:     Virgil Dupras <vdupras@gentoo.org> AuthorDate: 2018-10-23 20:36:16 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-10-23 20:38:27 +0000      net-libs/libbitcoinconsensus: remove old and vulnerable          Bug: <https://bugs.gentoo.org/666669>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Package-Manager: Portage-2.3.51, Repoman-2.3.11   net-libs/libbitcoinconsensus/Manifest              |  2 -  .../libbitcoinconsensus-0.15.1.ebuild              | 99 ----------------------  2 files changed, 101 deletions(-)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=3c847a77d54b0910d52d4852859651fa49510eb3>  commit 3c847a77d54b0910d52d4852859651fa49510eb3 Author:     Virgil Dupras <vdupras@gentoo.org> AuthorDate: 2018-10-23 20:35:00 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-10-23 20:38:27 +0000      net-p2p/bitcoind: remove old and vulnerable          Bug: <https://bugs.gentoo.org/666669>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Package-Manager: Portage-2.3.51, Repoman-2.3.11   net-p2p/bitcoind/Manifest                          |   2 -  net-p2p/bitcoind/bitcoind-0.15.1.ebuild            | 167 ---------------------  .../files/bitcoind-0.15.1-test-build-fix.patch     |  24 ---  .../files/bitcoind-0.15.1-test-util-fix.patch      |  15 --  4 files changed, 208 deletions(-)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=aa43f6f2847e6779d6bea9c2242be1fc76b86f20>  commit aa43f6f2847e6779d6bea9c2242be1fc76b86f20 Author:     Virgil Dupras <vdupras@gentoo.org> AuthorDate: 2018-10-23 20:32:44 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-10-23 20:38:26 +0000      net-p2p/bitcoin-cli: remove old and vulnerable          Bug: <https://bugs.gentoo.org/666669>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Package-Manager: Portage-2.3.51, Repoman-2.3.11   net-p2p/bitcoin-cli/Manifest                  |   2 -  net-p2p/bitcoin-cli/bitcoin-cli-0.15.1.ebuild | 101 --------------------------  2 files changed, 103 deletions(-)  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=1b957e3983c5b664df340102d7311e266244f019>  commit 1b957e3983c5b664df340102d7311e266244f019 Author:     Virgil Dupras <vdupras@gentoo.org> AuthorDate: 2018-10-23 20:31:22 +0000 Commit:     Virgil Dupras <vdupras@gentoo.org> CommitDate: 2018-10-23 20:38:26 +0000      net-p2p/bitcoin-qt: remove old and vulnerable          Bug: <https://bugs.gentoo.org/666669>     Signed-off-by: Virgil Dupras <vdupras@gentoo.org>     Package-Manager: Portage-2.3.51, Repoman-2.3.11   net-p2p/bitcoin-qt/Manifest                        |   2 -  net-p2p/bitcoin-qt/bitcoin-qt-0.15.1.ebuild        | 255 ---------------------  .../files/bitcoin-qt-0.15.1-test-build-fix.patch   |  24 --  .../files/bitcoin-qt-0.15.1-test-util-fix.patch    |  15 --  net-p2p/bitcoin-qt/metadata.xml                    |   2 -  5 files changed, 298 deletions(-) ```  [Comment 10](#c10)  Aaron Bauman (RETIRED)   gentoo-dev  2018-11-24 22:13:40 UTC  ``` This bug is evil... ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=666669)
* - [XML](show_bug.cgi?ctype=xml&id=666669)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=666669)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=666669&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=666669&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=666669&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


