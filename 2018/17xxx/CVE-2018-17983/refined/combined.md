=== Content from www.mercurial-scm.org_7fe5eed4_20250124_135850.html ===

[![mercurial](/hg/static/hglogo.png)](https://mercurial-scm.org/)

* [log](/hg/shortlog/5405cb1a7901)
* [graph](/hg/graph/5405cb1a7901)
* [tags](/hg/tags)
* [bookmarks](/hg/bookmarks)
* [branches](/hg/branches)

* changeset
* [raw](/hg/raw-rev/5405cb1a7901)
* [browse](/hg/file/5405cb1a7901)

* [zip](/hg/archive/5405cb1a7901.zip)
* [gz](/hg/archive/5405cb1a7901.tar.gz)
* [bz2](/hg/archive/5405cb1a7901.tar.bz2)

* [help](/hg/help)

## [Mercurial](/) > [hg](/hg)

### changeset 39940:[5405cb1a7901](/hg/rev/5405cb1a7901) stable 4.7.2

Find changesets by keywords (author, files, the commit message), revision
number or hash, or [revset expression](/hg/help/revsets).

manifest: fix out-of-bounds read of corrupted manifest entry
Spotted by ASAN.

| author | Yuya Nishihara <yuya@tcha.org> |
| --- | --- |
| date | Wed, 05 Sep 2018 21:23:29 +0900 |
| parents | [e85462d48cb3](/hg/rev/e85462d48cb3) |
| children | [636a0e390634](/hg/rev/636a0e390634) |
| files | [mercurial/cext/manifest.c](/hg/file/5405cb1a7901/mercurial/cext/manifest.c) |
| diffstat | 1 files changed, 10 insertions(+), 2 deletions(-) [+] [-]  | [mercurial/cext/manifest.c](#l1.1) | 12 |  | | --- | --- | --- | |

line wrap: on
 line diff
```

--- a/mercurial/cext/manifest.c	Wed Sep 05 21:32:45 2018 +0900
+++ b/mercurial/cext/manifest.c	Wed Sep 05 21:23:29 2018 +0900
@@ -51,7 +51,12 @@
 {
 	char *s = l->start;
 	ssize_t llen = pathlen(l);
-	PyObject *hash = unhexlify(s + llen + 1, 40);
+	PyObject *hash;
+	if (llen + 1 + 40 + 1 > l->len) { /* path '\0' hash '\n' */
+		PyErr_SetString(PyExc_ValueError, "manifest line too short");
+		return NULL;
+	}
+	hash = unhexlify(s + llen + 1, 40);
 	if (!hash) {
 		return NULL;
 	}
@@ -249,10 +254,13 @@
 	pl = pathlen(l);
 	path = PyBytes_FromStringAndSize(l->start, pl);
 	hash = nodeof(l);
+	if (!path || !hash) {
+		goto done;
+	}
 	consumed = pl + 41;
 	flags = PyBytes_FromStringAndSize(l->start + consumed,
 					   l->len - consumed - 1);
-	if (!path || !hash || !flags) {
+	if (!flags) {
 		goto done;
 	}
 	ret = PyTuple_Pack(3, path, hash, flags);
```



=== Content from www.mercurial-scm.org_946f39ec_20250124_135855.html ===


Search:

[![Mercurial](https://www.mercurial-scm.org/logo-droplets-50.png)](/Mercurial)
[Login](/WhatsNew?action=login)
# [WhatsNew](/WhatsNew)

* [RecentChanges](/RecentChanges)
* [FindPage](/FindPage)
* [HelpContents](/HelpContents)
* [WhatsNew](/WhatsNew)

---

* Immutable Page
* Comments
* [Info](/WhatsNew?action=info)
* [Attachments](/WhatsNew?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  Sync Pages
  ------------------------
  Load
  Save
  SlideShow

# Release Notes

Features and bugfixes in our latest releases. Please see the [Download](/Download) page for links to source and binaries.

Note that Mercurial follows a time-based release plan with major releases every three months and minor (bugfix) releases on the first of every month (see [TimeBasedReleasePlan](/TimeBasedReleasePlan)).

![{i}](/moin-static/modernized/img/icon-info.png "{i}")

WhatsNew (last edited 2025-01-16 16:19:31 by [RaphaelGomes](/RaphaelGomes "RaphaelGomes @ brc29-h03-89-89-147-228.dsl.sta.abo.bbox.fr[89.89.147.228]"))

* Immutable Page
* Comments
* [Info](/WhatsNew?action=info)
* [Attachments](/WhatsNew?action=AttachFile)
* More Actions:
  Raw Text
  Print View
  Render as Docbook
  Delete Cache
  ------------------------
  Check Spelling
  Like Pages
  Local Site Map
  ------------------------
  Rename Page
  Delete Page
  ------------------------
  Subscribe User
  ------------------------
  Remove Spam
  Revert to this revision
  Package Pages
  Sync Pages
  ------------------------
  Load
  Save
  SlideShow

* [MoinMoin Powered](http://moinmo.in/ "This site uses the MoinMoin Wiki software.")
* [Python Powered](http://moinmo.in/Python "MoinMoin is written in Python.")
* [GPL licensed](http://moinmo.in/GPL "MoinMoin is GPL licensed.")
* [Valid HTML 4.01](http://validator.w3.org/check?uri=referer "Click here to validate this page.")


