=== Content from wordpress.org_b487ed35_20250125_223304.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ‚ÜóÔ∏é](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ‚ÜóÔ∏é](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ‚ÜóÔ∏é](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ‚ÜóÔ∏é](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Feed Statistics

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fwordpress-feed-statistics&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fwordpress-feed-statistics&locale=en_US)

Search plugins

![](https://s.w.org/plugins/geopattern-icon/wordpress-feed-statistics.svg)
# wordpress-feed-statistics

* [Details](https://wordpress.org/plugins/wordpress-feed-statistics/#description)
* [Reviews](https://wordpress.org/plugins/wordpress-feed-statistics/#reviews)
* [Development](https://wordpress.org/plugins/wordpress-feed-statistics/#developers)

[Support](https://wordpress.org/support/plugin/wordpress-feed-statistics/)

## Description

This plugin has been closed as of March 31, 2023 and is not available for download. This closure is permanent. Reason: Author Request.

## Reviews

![](https://secure.gravatar.com/avatar/cfd4727acbdb0370dbf648ad52cda73de9b5010e6a4d8b3fba1c9dbc0627270f?s=60&d=retro&r=g)
### [works fine, simple and clear](https://wordpress.org/support/topic/works-fine-simple-and-clear/)

[teamheartcode](https://profiles.wordpress.org/teamheartcode/ "Posts by teamheartcode")
September 3, 2016

I would appreciate a dashboard support for faster view. Right now it works fine.
It says I do X subs, but over 2X clickthroughs, I do not really believe that, but that‚Äôs fine for me. I get a hint in % üôÇ

[Read all 4 reviews](https://wordpress.org/support/plugin/wordpress-feed-statistics/reviews/)
## Contributors & Developers

‚ÄúFeed Statistics‚Äù is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/942f91a542ccc0d21a1b1b9de17296dceb648bb278011f76386aedbb96f37684?s=32&d=mm&r=g) [Christopher Finke](https://profiles.wordpress.org/cfinke/)

[Translate ‚ÄúFeed Statistics‚Äù into your language.](https://translate.wordpress.org/projects/wp-plugins/wordpress-feed-statistics)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/wordpress-feed-statistics/), check out the [SVN repository](https://plugins.svn.wordpress.org/wordpress-feed-statistics/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/wordpress-feed-statistics/) by [RSS](https://plugins.trac.wordpress.org/log/wordpress-feed-statistics/?limit=100&mode=stop_on_copy&format=rss).

## Meta

* Version **4.1**
* Last updated **7 years ago**
* Active installations **N/A**
* WordPress version **4.7 or higher**
* Tested up to **4.9.26**
* [Advanced View](https://wordpress.org/plugins/wordpress-feed-statistics/advanced/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ‚Üó](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ‚Üó](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ‚Üó](https://wordpress.com/?ref=wporg-footer)
* [Matt ‚Üó](https://ma.tt/)
* [bbPress ‚Üó](https://bbpress.org/)
* [BuddyPress ‚Üó](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_2685f793_20250125_223304.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ‚ÜóÔ∏é](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ‚ÜóÔ∏é](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ‚ÜóÔ∏é](https://central.wordcamp.org/)
  + [Meetups ‚ÜóÔ∏é](https://www.meetup.com/pro/wordpress/)
  + [Job Board ‚ÜóÔ∏é](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ‚ÜóÔ∏é](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ‚ÜóÔ∏é](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwordpress-feed-statistics%2Ftrunk%2Ffeed-statistics.php%3Frev%3D960868)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ‚Üê [Previous Revision](/browser/wordpress-feed-statistics/trunk/feed-statistics.php?rev=960859 "Revision 960859")
* [Latest Revision](/browser/wordpress-feed-statistics/trunk/feed-statistics.php)
* [Next Revision](/browser/wordpress-feed-statistics/trunk/feed-statistics.php?rev=960870 "Revision 960870") ‚Üí
* [Blame](/browser/wordpress-feed-statistics/trunk/feed-statistics.php?annotate=blame&rev=960868 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wordpress-feed-statistics/trunk/feed-statistics.php?rev=960868)

---

# [source:](/browser?rev=960868&order=name "Go to repository root") [wordpress-feed-statistics](/browser/wordpress-feed-statistics?rev=960868&order=name "View wordpress-feed-statistics")/[trunk](/browser/wordpress-feed-statistics/trunk?rev=960868&order=name "View trunk")/[feed-statistics.php](/browser/wordpress-feed-statistics/trunk/feed-statistics.php?rev=960868&order=name "View feed-statistics.php") @ [960868](/changeset/960868/ "View changeset 960868")

View diff against:

View revision:

| [Last change](/changeset/960868/wordpress-feed-statistics/trunk/feed-statistics.php "View differences") on this file since 960868 was [960868](/changeset/960868/ "View changeset 960868"), checked in by cfinke, [10 years ago](/timeline?from=2014-08-06T00%3A19%3A20Z&precision=second "See timeline at 08/06/2014 12:19:20 AM") |
| --- |
| Prevent the use of Feed Statistics as an open redirect. |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 29.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\* |
| [4](#L4) | Plugin Name: Feed Statistics |
| [5](#L5) | Plugin URI: http://www.chrisfinke.com/wordpress/plugins/feed-statistics/ |
| [6](#L6) | Description: Compiles statistics about who is reading your blog via a feed reader and what posts they're reading. |
| [7](#L7) | Version: 4.0a1 |
| [8](#L8) | Author: Christopher Finke |
| [9](#L9) | Author URI: http://www.chrisfinke.com/ |
| [10](#L10) | License: GPL2 |
| [11](#L11) | Domain Path: /languages/ |
| [12](#L12) | Text Domain: feed-statistics |
| [13](#L13) | \*/ |
| [14](#L14) |  |
| [15](#L15) | define(¬†'FEED\_STATISTICS\_VERSION',¬†'4.0a1'¬†); |
| [16](#L16) |  |
| [17](#L17) | class¬†FEED\_STATS¬†{ |
| [18](#L18) | const¬†LINK\_REGEX¬†=¬†"(<a[^>]+href=)(['\"])([^\#][^'\"]+)(['\"])([^>]\*>)"; |
| [19](#L19) |  |
| [20](#L20) | static¬†function¬†init(){ |
| [21](#L21) | global¬†$wpdb; |
| [22](#L22) |  |
| [23](#L23) | if¬†(¬†isset(¬†$\_GET['feed-stats-post-id']¬†)¬†)¬†{ |
| [24](#L24) | if¬†(¬†!¬†empty(¬†$\_GET['feed-stats-post-id']¬†)¬†&&¬†get\_option(¬†"feed\_statistics\_track\_postviews"¬†)¬†)¬†{ |
| [25](#L25) | $wpdb->insert( |
| [26](#L26) | $wpdb->prefix¬†.¬†'feed\_postviews', |
| [27](#L27) | array( |
| [28](#L28) | 'post\_id'¬†=>¬†$\_GET['feed-stats-post-id'], |
| [29](#L29) | 'time'¬†=>¬†date(¬†'Y-m-d H:i:s'¬†) |
| [30](#L30) | ), |
| [31](#L31) | array( |
| [32](#L32) | '%d', |
| [33](#L33) | '%s' |
| [34](#L34) | ) |
| [35](#L35) | ); |
| [36](#L36) | } |
| [37](#L37) |  |
| [38](#L38) | header("Content-Type: image/gif"); |
| [39](#L39) | echo¬†base64\_decode("R0lGODlhAQABAIAAANvf7wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="); |
| [40](#L40) | die(); |
| [41](#L41) | } |
| [42](#L42) |  |
| [43](#L43) | add\_action('admin\_menu',¬†array('FEED\_STATS','add\_options\_menu')); |
| [44](#L44) | add\_action('admin\_head',¬†array('FEED\_STATS','admin\_head')); |
| [45](#L45) |  |
| [46](#L46) | if¬†(get\_option("feed\_statistics\_track\_clickthroughs"))¬†{ |
| [47](#L47) | add\_filter('the\_content',¬†array('FEED\_STATS','clickthrough\_replace')); |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) | if¬†(get\_option("feed\_statistics\_track\_postviews"))¬†{ |
| [51](#L51) | add\_filter('the\_content',¬†array('FEED\_STATS','postview\_tracker')); |
| [52](#L52) | } |
| [53](#L53) |  |
| [54](#L54) | add\_filter(¬†'plugin\_action\_links',¬†'feed\_statistics\_action\_links',¬†10,¬†2¬†); |
| [55](#L55) |  |
| [56](#L56) | self::widget\_register(); |
| [57](#L57) |  |
| [58](#L58) | if¬†(¬†isset(¬†$\_GET['feed-stats-url']¬†)¬†)¬†{ |
| [59](#L59) | $url¬†=¬†trim(¬†base64\_decode(¬†$\_GET['feed-stats-url']¬†)¬†); |
| [60](#L60) |  |
| [61](#L61) | if¬†(¬†!¬†$url¬†)¬†die; |
| [62](#L62) |  |
| [63](#L63) | if¬†(¬†get\_option(¬†'feed\_statistics\_track\_clickthroughs'¬†)¬†)¬†{ |
| [64](#L64) | $link\_id¬†=¬†0; |
| [65](#L65) |  |
| [66](#L66) | $wpdb->hide\_errors(); |
| [67](#L67) |  |
| [68](#L68) | $link\_id¬†=¬†$wpdb->get\_var( |
| [69](#L69) | $wpdb->prepare( |
| [70](#L70) | "SELECT id FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_links WHERE url=%d", |
| [71](#L71) | $url |
| [72](#L72) | ) |
| [73](#L73) | ); |
| [74](#L74) |  |
| [75](#L75) | if¬†(¬†!¬†$link\_id¬†)¬†{ |
| [76](#L76) | if¬†( |
| [77](#L77) | $wpdb->insert( |
| [78](#L78) | $wpdb->prefix¬†.¬†'feed\_links', |
| [79](#L79) | array( |
| [80](#L80) | 'url'¬†=>¬†$url, |
| [81](#L81) | 'url\_hash'¬†=>¬†md5(¬†$url¬†) |
| [82](#L82) | ), |
| [83](#L83) | array(¬†'%s',¬†'%s'¬†) |
| [84](#L84) | ) |
| [85](#L85) | )¬†{ |
| [86](#L86) | $link\_id¬†=¬†$wpdb->insert\_id; |
| [87](#L87) | } |
| [88](#L88) | } |
| [89](#L89) |  |
| [90](#L90) | if¬†(¬†$link\_id¬†)¬†{ |
| [91](#L91) | $wpdb->insert( |
| [92](#L92) | $wpdb->prefix¬†.¬†'feed\_clickthroughs', |
| [93](#L93) | array( |
| [94](#L94) | 'link\_id'¬†=>¬†$link\_id, |
| [95](#L95) | 'time'¬†=>¬†date(¬†'Y-m-d H:i:s'¬†) |
| [96](#L96) | ), |
| [97](#L97) | array( |
| [98](#L98) | '%d', |
| [99](#L99) | '%s' |
| [100](#L100) | ) |
| [101](#L101) | ); |
| [102](#L102) | } |
| [103](#L103) | } |
| [104](#L104) |  |
| [105](#L105) | $wpdb->show\_errors(); |
| [106](#L106) |  |
| [107](#L107) | $whitelisted\_redirect¬†=¬†false; |
| [108](#L108) |  |
| [109](#L109) | if¬†(¬†isset(¬†$\_GET['feed-stats-url-post-id']¬†)¬†)¬†{ |
| [110](#L110) | $post¬†=¬†get\_post(¬†$\_GET['feed-stats-url-post-id']¬†); |
| [111](#L111) |  |
| [112](#L112) | if¬†(¬†$post¬†)¬†{ |
| [113](#L113) | preg\_match\_all(¬†"/"¬†.¬†self::LINK\_REGEX¬†.¬†"/i",¬†$post->post\_content,¬†$anchor\_tags¬†); |
| [114](#L114) |  |
| [115](#L115) | $links¬†=¬†$anchor\_tags[3]; |
| [116](#L116) |  |
| [117](#L117) | if¬†(¬†in\_array(¬†$url,¬†$links¬†)¬†)¬†{ |
| [118](#L118) | $whitelisted\_redirect¬†=¬†true; |
| [119](#L119) | } |
| [120](#L120) | } |
| [121](#L121) | } |
| [122](#L122) |  |
| [123](#L123) | if¬†(¬†!¬†$whitelisted\_redirect¬†)¬†{ |
| [124](#L124) | $redirection\_warning¬†=¬†'<p>'¬†.¬†sprintf(¬†\_\_(¬†'The link you clicked is attempting to send you to %s If you do not want to visit that site, please close this page or return to the previous page. If you want to continue, copy and paste the URL above into your browser&#8217;s address bar.',¬†'feed-statistics'¬†)¬†.¬†'</p>',¬†'</p><p><code>'¬†.¬†esc\_html(¬†$url¬†)¬†.¬†'</code></p><p>'¬†); |
| [125](#L125) |  |
| [126](#L126) | wp\_die(¬†$redirection\_warning,¬†\_\_(¬†'Redirection Notice',¬†'feed-statistics'¬†),¬†array(¬†'back\_link'¬†=>¬†true,¬†'response'¬†=>¬†403¬†)¬†); |
| [127](#L127) | } |
| [128](#L128) | else¬†{ |
| [129](#L129) | header(¬†'Location: '¬†.¬†$url¬†); |
| [130](#L130) | die(); |
| [131](#L131) | } |
| [132](#L132) | } |
| [133](#L133) |  |
| [134](#L134) | if¬†(¬†isset(¬†$\_POST["feed\_statistics\_update"]¬†)¬†)¬†{ |
| [135](#L135) | // Handle settings changes here so that the menus can show the right options. |
| [136](#L136) | update\_option(¬†"feed\_statistics\_expiration\_days",¬†intval(¬†$\_POST["feed\_statistics\_expiration\_days"]¬†)¬†); |
| [137](#L137) | update\_option(¬†"feed\_statistics\_track\_clickthroughs",¬†intval(¬†isset(¬†$\_POST["feed\_statistics\_track\_clickthroughs"]¬†)¬†)¬†); |
| [138](#L138) | update\_option(¬†"feed\_statistics\_track\_postviews",¬†intval(¬†isset(¬†$\_POST["feed\_statistics\_track\_postviews"]¬†)¬†)¬†); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | load\_plugin\_textdomain(¬†'feed-statistics',¬†false,¬†dirname(¬†plugin\_basename(¬†\_\_FILE\_\_¬†)¬†)¬†.¬†'/languages/'¬†); |
| [142](#L142) |  |
| [143](#L143) | if¬†(FEED\_STATS::is\_feed\_url()){ |
| [144](#L144) | $user\_agent¬†=¬†$\_SERVER["HTTP\_USER\_AGENT"]; |
| [145](#L145) |  |
| [146](#L146) | if¬†(!preg\_match("/(Mozilla|Opera|subscriber|user|feed)/Uis",¬†$user\_agent)){ |
| [147](#L147) | if¬†(strlen($user\_agent)¬†>¬†3){ |
| [148](#L148) | return; |
| [149](#L149) | } |
| [150](#L150) | } |
| [151](#L151) |  |
| [152](#L152) | if¬†(!preg\_match("/(readers|subscriber|user|feed)/Uis",¬†$user\_agent)){ |
| [153](#L153) | if¬†(preg\_match("/(slurp|bot|spider)/Uis",¬†$user\_agent)){ |
| [154](#L154) | return; |
| [155](#L155) | } |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | $m¬†=¬†array(); |
| [159](#L159) |  |
| [160](#L160) | if¬†(preg\_match("/([0-9]+) subscriber/Uis",¬†$user\_agent,¬†$m))¬†{ |
| [161](#L161) | // Not a typo below - should have been replacing $m[1], but screwed it up the first time around, so it's here to stay |
| [162](#L162) | $identifier¬†=¬†str\_replace($m[0],¬†"###",¬†$user\_agent); |
| [163](#L163) | $subscribers¬†=¬†$m[1]; |
| [164](#L164) | } |
| [165](#L165) | else¬†if¬†(preg\_match("/users ([0-9]+);/Uis",¬†$user\_agent,¬†$m))¬†{ |
| [166](#L166) | // For Yahoo!'s bot |
| [167](#L167) | $identifier¬†=¬†str\_replace($m[1],¬†"###",¬†$user\_agent); |
| [168](#L168) | $subscribers¬†=¬†$m[1]; |
| [169](#L169) | } |
| [170](#L170) | else¬†if¬†(preg\_match("/ ([0-9]+) readers/Uis",¬†$user\_agent,¬†$m))¬†{ |
| [171](#L171) | // For LiveJournal's bot |
| [172](#L172) | $identifier¬†=¬†str\_replace($m[1],¬†"###",¬†$user\_agent); |
| [173](#L173) | $subscribers¬†=¬†$m[1]; |
| [174](#L174) | } |
| [175](#L175) | else¬†{ |
| [176](#L176) | $identifier¬†=¬†$\_SERVER["REMOTE\_ADDR"]; |
| [177](#L177) | $subscribers¬†=¬†1; |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | $feed¬†=¬†$\_SERVER["REQUEST\_URI"]; |
| [181](#L181) |  |
| [182](#L182) | if¬†(!preg\_match("/(\/|\.php|\?.\*)$/Uis",¬†$feed)){ |
| [183](#L183) | $feed¬†.=¬†"/"; |
| [184](#L184) | } |
| [185](#L185) |  |
| [186](#L186) | $results¬†=¬†$wpdb->get\_results(¬†$wpdb->prepare(¬†"SELECT \* FROM ".$wpdb->prefix."feed\_subscribers WHERE identifier=%s AND feed=''",¬†$identifier¬†)¬†); |
| [187](#L187) |  |
| [188](#L188) | if¬†(¬†!¬†empty(¬†$results¬†)¬†)¬†{ |
| [189](#L189) | $wpdb->update( |
| [190](#L190) | $wpdb->prefix¬†.¬†'feed\_subscribers', |
| [191](#L191) | array( |
| [192](#L192) | 'subscribers'¬†=>¬†$susbcribers, |
| [193](#L193) | 'user\_agent'¬†=>¬†$user\_agent, |
| [194](#L194) | 'feed'¬†=>¬†$feed, |
| [195](#L195) | 'date'¬†=>¬†date(¬†'Y-m-d H:i:s'¬†) |
| [196](#L196) | ), |
| [197](#L197) | array( |
| [198](#L198) | 'identifier'¬†=>¬†$identifier, |
| [199](#L199) | 'feed'¬†=>¬†'' |
| [200](#L200) | ), |
| [201](#L201) | array( |
| [202](#L202) | '%d', |
| [203](#L203) | '%s', |
| [204](#L204) | '%s', |
| [205](#L205) | '%s' |
| [206](#L206) | ), |
| [207](#L207) | array( |
| [208](#L208) | '%s', |
| [209](#L209) | '%s' |
| [210](#L210) | ) |
| [211](#L211) | ); |
| [212](#L212) | } |
| [213](#L213) | else¬†{ |
| [214](#L214) | $row¬†=¬†$wpdb->get\_row(¬†$wpdb->prepare(¬†"SELECT \* FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_subscribers WHERE identifier=%s AND feed=%s",¬†$identifier,¬†$feed¬†)¬†); |
| [215](#L215) |  |
| [216](#L216) | if¬†(¬†empty(¬†$row¬†)¬†)¬†{ |
| [217](#L217) | $wpdb->insert( |
| [218](#L218) | $wpdb->prefix¬†.¬†'feed\_subscribers', |
| [219](#L219) | array( |
| [220](#L220) | 'subscribers'¬†=>¬†$subscribers, |
| [221](#L221) | 'identifier'¬†=>¬†$identifier, |
| [222](#L222) | 'user\_agent'¬†=>¬†$user\_agent, |
| [223](#L223) | 'feed'¬†=>¬†$feed, |
| [224](#L224) | 'date'¬†=>¬†date(¬†'Y-m-d H:i:s'¬†) |
| [225](#L225) | ), |
| [226](#L226) | array( |
| [227](#L227) | '%d', |
| [228](#L228) | '%s', |
| [229](#L229) | '%s', |
| [230](#L230) | '%s', |
| [231](#L231) | '%s' |
| [232](#L232) | ) |
| [233](#L233) | ); |
| [234](#L234) | } |
| [235](#L235) | else¬†if¬†(¬†$user\_agent¬†!=¬†$row->user\_agent¬†||¬†$subscribers¬†!=¬†$row->subscribers¬†)¬†{ |
| [236](#L236) | $wpdb->update( |
| [237](#L237) | $wpdb->prefix¬†.¬†'feed\_subscribers', |
| [238](#L238) | array( |
| [239](#L239) | 'date'¬†=>¬†date(¬†'Y-m-d H:i:s'¬†), |
| [240](#L240) | 'user\_agent'¬†=>¬†$user\_agent, |
| [241](#L241) | 'subscribers'¬†=>¬†$subscribers |
| [242](#L242) | ), |
| [243](#L243) | array( |
| [244](#L244) | 'identifier'¬†=>¬†$identifier, |
| [245](#L245) | 'feed'¬†=>¬†$feed |
| [246](#L246) | ), |
| [247](#L247) | array( |
| [248](#L248) | '%s', |
| [249](#L249) | '%s', |
| [250](#L250) | '%d' |
| [251](#L251) | ), |
| [252](#L252) | array( |
| [253](#L253) | '%s', |
| [254](#L254) | '%s' |
| [255](#L255) | ) |
| [256](#L256) | ); |
| [257](#L257) | } |
| [258](#L258) | } |
| [259](#L259) | } |
| [260](#L260) | } |
| [261](#L261) |  |
| [262](#L262) | static¬†function¬†db\_setup()¬†{ |
| [263](#L263) | $installed\_version¬†=¬†get\_option(¬†'feed\_statistics\_version'¬†); |
| [264](#L264) |  |
| [265](#L265) | if¬†(¬†FEED\_STATISTICS\_VERSION¬†!=¬†$installed\_version¬†)¬†{ |
| [266](#L266) | FEED\_STATS::sql(); |
| [267](#L267) |  |
| [268](#L268) | update\_option(¬†'feed\_statistics\_version',¬†FEED\_STATISTICS\_VERSION¬†); |
| [269](#L269) |  |
| [270](#L270) | add\_option(¬†'feed\_statistics\_track\_clickthroughs',¬†'0'¬†); |
| [271](#L271) | add\_option(¬†'feed\_statistics\_track\_postviews',¬† ¬† ¬†'1'¬†); |
| [272](#L272) | add\_option(¬†'feed\_statistics\_expiration\_days',¬† ¬† ¬†'3'¬†); |
| [273](#L273) | } |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | static¬†function¬†sql()¬†{ |
| [277](#L277) | global¬†$wpdb; |
| [278](#L278) |  |
| [279](#L279) | $last\_version¬†=¬†get\_option(¬†'feed\_statistics\_version'¬†); |
| [280](#L280) |  |
| [281](#L281) | switch¬†(¬†$last\_version¬†)¬†{ |
| [282](#L282) | case¬†'1.0': |
| [283](#L283) | case¬†'1.0.1': |
| [284](#L284) | case¬†'1.0.2': |
| [285](#L285) | case¬†'1.0.3': |
| [286](#L286) | case¬†'1.0.4': |
| [287](#L287) | $sql¬†=¬†"ALTER TABLE `".$wpdb->prefix."feed\_subscribers` ADD `user\_agent` VARCHAR(255) NOT NULL DEFAULT ''"; |
| [288](#L288) | $wpdb->query($sql); |
| [289](#L289) |  |
| [290](#L290) | $sql¬†=¬†"CREATE TABLE IF NOT EXISTS `".$wpdb->prefix."feed\_clickthroughs` ( |
| [291](#L291) | `id` INT(11) NOT NULL auto\_increment, |
| [292](#L292) | `link\_id` INT(11) NOT NULL DEFAULT '0', |
| [293](#L293) | `referrer\_id` INT(11) NOT NULL DEFAULT '0', |
| [294](#L294) | `time` DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00', |
| [295](#L295) | PRIMARY KEY (id) |
| [296](#L296) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1"; |
| [297](#L297) | $wpdb->query($sql); |
| [298](#L298) |  |
| [299](#L299) | $sql¬†=¬†"CREATE TABLE IF NOT EXISTS `".$wpdb->prefix."feed\_links` ( |
| [300](#L300) | `id` INT(11) NOT NULL auto\_increment, |
| [301](#L301) | `url` VARCHAR(255) NOT NULL DEFAULT '', |
| [302](#L302) | PRIMARY KEY (`id`), |
| [303](#L303) | UNIQUE KEY `url` (`url`) |
| [304](#L304) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1"; |
| [305](#L305) | $wpdb->query($sql); |
| [306](#L306) |  |
| [307](#L307) | $sql¬†=¬†"CREATE TABLE IF NOT EXISTS `".$wpdb->prefix."feed\_referrers` ( |
| [308](#L308) | `id` INT(11) NOT NULL auto\_increment, |
| [309](#L309) | `url` VARCHAR(255) NOT NULL DEFAULT '', |
| [310](#L310) | PRIMARY KEY (`id`), |
| [311](#L311) | UNIQUE KEY `url` (`url`) |
| [312](#L312) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1"; |
| [313](#L313) | $wpdb->query($sql); |
| [314](#L314) |  |
| [315](#L315) | $sql¬†=¬†"CREATE TABLE IF NOT EXISTS `".$wpdb->prefix."feed\_postviews` ( |
| [316](#L316) | `id` INT(11) NOT NULL auto\_increment, |
| [317](#L317) | `post\_id` INT(11) NOT NULL DEFAULT '0', |
| [318](#L318) | `time` DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00', |
| [319](#L319) | PRIMARY KEY (id) |
| [320](#L320) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1"; |
| [321](#L321) | $wpdb->query($sql); |
| [322](#L322) |  |
| [323](#L323) | update\_option("feed\_statistics\_track\_clickthroughs",¬†"0"); |
| [324](#L324) | update\_option("feed\_statistics\_track\_postviews",¬†"1"); |
| [325](#L325) | case¬†'1.1': |
| [326](#L326) | case¬†'1.1.1': |
| [327](#L327) | case¬†'1.1.2': |
| [328](#L328) | $sql¬†=¬†"ALTER TABLE `".$wpdb->prefix."feed\_subscribers` ADD `feed` VARCHAR( 120 ) NOT NULL AFTER `identifier`"; |
| [329](#L329) | $wpdb->query($sql); |
| [330](#L330) |  |
| [331](#L331) | $sql¬†=¬†"ALTER TABLE `".$wpdb->prefix."feed\_subscribers` DROP PRIMARY KEY, ADD PRIMARY KEY (`identifier`, `feed`)"; |
| [332](#L332) | $wpdb->query($sql); |
| [333](#L333) | case¬†'1.2': |
| [334](#L334) | case¬†'1.3': |
| [335](#L335) | $sql¬†=¬†"DROP TABLE `".$wpdb->prefix."feed\_referrers`"; |
| [336](#L336) | $wpdb->query($sql); |
| [337](#L337) |  |
| [338](#L338) | $sql¬†=¬†"ALTER TABLE `".$wpdb->prefix."feed\_clickthroughs` DROP `referrer\_id`"; |
| [339](#L339) | $wpdb->query($sql); |
| [340](#L340) | case¬†'1.3.1': |
| [341](#L341) | $sql¬†=¬†"ALTER TABLE `".$wpdb->prefix."feed\_subscribers` CHANGE `feed` `feed` VARCHAR(120) NOT NULL"; |
| [342](#L342) | $wpdb->query($sql); |
| [343](#L343) | case¬†'1.3.2': |
| [344](#L344) | case¬†'1.4': |
| [345](#L345) | case¬†'1.4.1'; |
| [346](#L346) | case¬†'1.4.2': |
| [347](#L347) | case¬†'1.4.3': |
| [348](#L348) | case¬†'1.5': |
| [349](#L349) | // Seeing some errors about a 1000-byte key being too long. Go figure. |
| [350](#L350) | $wpdb->query(¬†"ALTER TABLE "¬†.¬†$wpdb->prefix¬†.¬†"feed\_links DROP KEY url"¬†); |
| [351](#L351) | $wpdb->query(¬†"ALTER TABLE "¬†.¬†$wpdb->prefix¬†.¬†"feed\_links ADD url\_hash VARCHAR(32) NOT NULL"¬†); |
| [352](#L352) | $wpdb->query(¬†"UPDATE "¬†.¬†$wpdb->prefix¬†.¬†"feed\_links SET url\_hash=MD5(url)"¬†); |
| [353](#L353) | $wpdb->query(¬†"ALTER TABLE "¬†.¬†$wpdb->prefix¬†.¬†"feed\_links ADD KEY url\_hash (url\_hash)"¬†); |
| [354](#L354) | break; |
| [355](#L355) | default: |
| [356](#L356) | // Full SQL of current schema. |
| [357](#L357) |  |
| [358](#L358) | $wpdb->query(¬†"CREATE TABLE IF NOT EXISTS ".$wpdb->prefix."feed\_links |
| [359](#L359) | ( |
| [360](#L360) | id int(11) NOT NULL AUTO\_INCREMENT, |
| [361](#L361) | url\_hash varchar(32) NOT NULL, |
| [362](#L362) | url varchar(1000) NOT NULL, |
| [363](#L363) | PRIMARY KEY¬† (id), |
| [364](#L364) | UNIQUE KEY url\_hash (url\_hash) |
| [365](#L365) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1" |
| [366](#L366) | ); |
| [367](#L367) |  |
| [368](#L368) | $wpdb->query(¬†"CREATE TABLE IF NOT EXISTS ".$wpdb->prefix."feed\_postviews |
| [369](#L369) | ( |
| [370](#L370) | id int(11) NOT NULL AUTO\_INCREMENT, |
| [371](#L371) | post\_id int(11) NOT NULL DEFAULT '0', |
| [372](#L372) | time datetime NOT NULL DEFAULT '0000-00-00 00:00:00', |
| [373](#L373) | PRIMARY KEY¬† (id) |
| [374](#L374) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1" |
| [375](#L375) | ); |
| [376](#L376) |  |
| [377](#L377) | $wpdb->query(¬†"CREATE TABLE IF NOT EXISTS ".$wpdb->prefix."feed\_subscribers |
| [378](#L378) | ( |
| [379](#L379) | subscribers int(11) NOT NULL DEFAULT '0', |
| [380](#L380) | identifier varchar(255) NOT NULL DEFAULT '', |
| [381](#L381) | feed varchar(120) NOT NULL, |
| [382](#L382) | date datetime NOT NULL DEFAULT '0000-00-00 00:00:00', |
| [383](#L383) | user\_agent varchar(255) DEFAULT NULL, |
| [384](#L384) | PRIMARY KEY¬† (identifier,feed) |
| [385](#L385) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1" |
| [386](#L386) | ); |
| [387](#L387) |  |
| [388](#L388) | $wpdb->query(¬†"CREATE TABLE IF NOT EXISTS ".$wpdb->prefix."feed\_clickthroughs |
| [389](#L389) | ( |
| [390](#L390) | id int(11) NOT NULL AUTO\_INCREMENT, |
| [391](#L391) | link\_id int(11) NOT NULL DEFAULT '0', |
| [392](#L392) | time datetime NOT NULL DEFAULT '0000-00-00 00:00:00', |
| [393](#L393) | PRIMARY KEY¬† (id) |
| [394](#L394) | ) ENGINE=MyISAM DEFAULT CHARSET=latin1" |
| [395](#L395) | ); |
| [396](#L396) | break; |
| [397](#L397) | } |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) | static¬†function¬†is\_feed\_url()¬†{ |
| [401](#L401) | switch¬†(basename($\_SERVER['PHP\_SELF']))¬†{ |
| [402](#L402) | case¬†'wp-rdf.php': |
| [403](#L403) | case¬†'wp-rss.php': |
| [404](#L404) | case¬†'wp-rss2.php': |
| [405](#L405) | case¬†'wp-atom.php': |
| [406](#L406) | case¬†'feed': |
| [407](#L407) | case¬†'rss2': |
| [408](#L408) | case¬†'atom': |
| [409](#L409) | return¬†true; |
| [410](#L410) | break; |
| [411](#L411) | } |
| [412](#L412) |  |
| [413](#L413) | if¬†(isset($\_GET["feed"]))¬†{ |
| [414](#L414) | return¬†true; |
| [415](#L415) | } |
| [416](#L416) |  |
| [417](#L417) | if¬†(preg\_match("/^\/(feed|rss2?|atom|rdf)/Uis",¬†$\_SERVER["REQUEST\_URI"]))¬†{ |
| [418](#L418) | return¬†true; |
| [419](#L419) | } |
| [420](#L420) |  |
| [421](#L421) | if¬†(preg\_match("/\/(feed|rss2?|atom|rdf)\/?$/Uis",¬†$\_SERVER["REQUEST\_URI"])){ |
| [422](#L422) | return¬†true; |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | return¬†apply\_filters(¬†'feed\_statistics\_is\_feed\_url',¬†false¬†); |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) | static¬†function¬†how\_many\_subscribers()¬†{ |
| [429](#L429) | global¬†$wpdb; |
| [430](#L430) |  |
| [431](#L431) | $results¬†=¬†$wpdb->get\_results( |
| [432](#L432) | $wpdb->prepare( |
| [433](#L433) | "SELECT |
| [434](#L434) | `subscribers`, |
| [435](#L435) | CASE WHEN `subscribers` = 1 THEN `identifier` ELSE CONCAT(`identifier`, `feed`) END AS `ident` |
| [436](#L436) | FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_subscribers |
| [437](#L437) | WHERE |
| [438](#L438) | ( |
| [439](#L439) | (`date` > %s) |
| [440](#L440) | OR |
| [441](#L441) | ( |
| [442](#L442) | LOCATE('###',`identifier`) != 0 AND |
| [443](#L443) | `date` > %s |
| [444](#L444) | ) |
| [445](#L445) | ) |
| [446](#L446) | ORDER BY `ident` ASC, `date` DESC", |
| [447](#L447) | date(¬†"Y-m-d H:i:s",¬†time()¬†-¬†(¬†60¬†\*¬†60¬†\*¬†24¬†\*¬†get\_option(¬†"feed\_statistics\_expiration\_days"¬†)¬†)¬†), |
| [448](#L448) | date(¬†"Y-m-d H:i:s",¬†time()¬†-¬†(¬†60¬†\*¬†60¬†\*¬†24¬†\*¬†get\_option(¬†"feed\_statistics\_expiration\_days"¬†)¬†\*¬†3¬†)¬†) |
| [449](#L449) | ) |
| [450](#L450) | ); |
| [451](#L451) |  |
| [452](#L452) | $s¬†=¬†0; |
| [453](#L453) |  |
| [454](#L454) | if¬†(¬†!¬†empty(¬†$results¬†)¬†)¬†{ |
| [455](#L455) | $current\_ident¬†=¬†''; |
| [456](#L456) |  |
| [457](#L457) | foreach¬†(¬†$results¬†as¬†$row¬†)¬†{ |
| [458](#L458) | if¬†(¬†$row->ident¬†!=¬†$current\_ident¬†)¬†{ |
| [459](#L459) | $s¬†+=¬†$row->subscribers; |
| [460](#L460) | $current\_ident¬†=¬†$row->ident; |
| [461](#L461) | } |
| [462](#L462) | } |
| [463](#L463) | } |
| [464](#L464) |  |
| [465](#L465) | return¬†intval(¬†$s¬†); |
| [466](#L466) | } |
| [467](#L467) |  |
| [468](#L468) | static¬†function¬†add\_options\_menu()¬†{ |
| [469](#L469) | add\_menu\_page(¬†\_\_(¬†'Feed Statistics Settings',¬†'feed-statistics'¬†),¬†\_\_(¬†'Feed Statistics',¬†'feed-statistics'¬†),¬†'publish\_posts',¬†basename(\_\_FILE\_\_),¬†'feed\_statistics\_feed\_page'¬†); |
| [470](#L470) |  |
| [471](#L471) | add\_submenu\_page(¬†basename(¬†\_\_FILE\_\_¬†),¬†\_\_(¬†'Top Feeds',¬†'feed-statistics'¬†),¬†\_\_(¬†'Top Feeds',¬†'feed-statistics'¬†),¬†'publish\_posts',¬†'feedstats-topfeeds',¬†'feed\_statistics\_topfeeds\_page'¬†); |
| [472](#L472) | add\_submenu\_page(¬†basename(¬†\_\_FILE\_\_¬†),¬†\_\_(¬†'Feed Readers',¬†'feed-statistics'¬†),¬†\_\_(¬†'Feed Readers',¬†'feed-statistics'¬†),¬†'publish\_posts',¬†'feedstats-feedreaders',¬†'feed\_statistics\_feedreaders\_page'¬†); |
| [473](#L473) |  |
| [474](#L474) | if¬†(get\_option("feed\_statistics\_track\_postviews")) |
| [475](#L475) | add\_submenu\_page(¬†basename(¬†\_\_FILE\_\_¬†),¬†\_\_(¬†'Post Views',¬†'feed-statistics'¬†),¬†\_\_(¬†'Post Views',¬†'feed-statistics'¬†),¬†'publish\_posts',¬†'feedstats-postviews',¬†'feed\_statistics\_postviews\_page'¬†); |
| [476](#L476) |  |
| [477](#L477) | if¬†(get\_option("feed\_statistics\_track\_clickthroughs")) |
| [478](#L478) | add\_submenu\_page(¬†basename(¬†\_\_FILE\_\_¬†),¬†\_\_(¬†'Clickthroughs',¬†'feed-statistics'¬†),¬†\_\_(¬†'Clickthroughs',¬†'feed-statistics'¬†),¬†'publish\_posts',¬†'feedstats-clickthroughs',¬†'feed\_statistics\_clickthroughs\_page'¬†); |
| [479](#L479) | } |
| [480](#L480) |  |
| [481](#L481) | static¬†function¬†clickthroughs\_page(){ |
| [482](#L482) | global¬†$wpdb; |
| [483](#L483) |  |
| [484](#L484) | ?> |
| [485](#L485) | <div class="wrap"> |
| [486](#L486) | <div class="icon32" id="icon-options-general"> |
| [487](#L487) | <br /> |
| [488](#L488) | </div> |
| [489](#L489) | <h2><?php¬†esc\_html\_e(¬†'Most popular links in your feed (last 30 days)',¬†'feed-statistics'¬†);¬†?></h2> |
| [490](#L490) | <p> |
| [491](#L491) | <?php |
| [492](#L492) |  |
| [493](#L493) | if¬†(¬†get\_option(¬†'feed\_statistics\_track\_clickthroughs'¬†)¬†) |
| [494](#L494) | esc\_html\_e(¬†'You currently have clickthrough tracking turned on.',¬†'feed-statistics'¬†); |
| [495](#L495) | else |
| [496](#L496) | esc\_html\_e(¬†'You currently have clickthrough tracking turned off.',¬†'feed-statistics'¬†); |
| [497](#L497) |  |
| [498](#L498) | ?> |
| [499](#L499) | </p> |
| [500](#L500) |  |
| [501](#L501) | <table style="width: 100%;"> |
| [502](#L502) | <thead> |
| [503](#L503) | <tr> |
| [504](#L504) | <th>&nbsp;</th> |
| [505](#L505) | <th style="width: 45%; text-align: left;"><?php¬†esc\_html\_e(¬†'Outgoing Link',¬†'feed-statistics'¬†);¬†?></th> |
| [506](#L506) | <th><?php¬†esc\_html\_e(¬†'Clicks',¬†'feed-statistics'¬†);¬†?></th> |
| [507](#L507) | <th style="width: 35%;">&nbsp;</th> |
| [508](#L508) | </tr> |
| [509](#L509) | </thead> |
| [510](#L510) | <tbody> |
| [511](#L511) | <?php |
| [512](#L512) |  |
| [513](#L513) | $wpdb->query( |
| [514](#L514) | $wpdb->prepare( |
| [515](#L515) | "DELETE FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_clickthroughs WHERE time < %s", |
| [516](#L516) | date(¬†"Y-m-d H:i:s",¬†time()¬†-¬†(¬†60¬†\*¬†60¬†\*¬†24¬†\*¬†30¬†)¬†) |
| [517](#L517) | ) |
| [518](#L518) | ); |
| [519](#L519) |  |
| [520](#L520) | $results¬†=¬†$wpdb->get\_results( |
| [521](#L521) | $wpdb->prepare( |
| [522](#L522) | "SELECT |
| [523](#L523) | COUNT(\*) AS `clicks`, |
| [524](#L524) | `l`.`url` AS `link` |
| [525](#L525) | FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_clickthroughs AS `c` |
| [526](#L526) | LEFT JOIN `".$wpdb->prefix."feed\_links` AS `l` ON `c`.`link\_id`=`l`.`id` |
| [527](#L527) | WHERE `c`.`time` > %s |
| [528](#L528) | GROUP BY `c`.`link\_id` |
| [529](#L529) | ORDER BY `clicks` DESC", |
| [530](#L530) | date(¬†'Y-m-d H:i:s',¬†time()¬†-¬†(¬†60¬†\*¬†60¬†\*¬†24¬†\*¬†30¬†)¬†) |
| [531](#L531) | ) |
| [532](#L532) | ); |
| [533](#L533) |  |
| [534](#L534) | $i¬†=¬†1; |
| [535](#L535) |  |
| [536](#L536) | if¬†(¬†!¬†empty(¬†$results¬†)¬†)¬†{ |
| [537](#L537) | $max¬†=¬†$results[0]->clicks; |
| [538](#L538) |  |
| [539](#L539) | foreach¬†(¬†$results¬†as¬†$row¬†)¬†{ |
| [540](#L540) | $percentage¬†=¬†ceil(¬†$row->clicks¬†/¬†$max¬†\*¬†100¬†); |
| [541](#L541) |  |
| [542](#L542) | ?> |
| [543](#L543) | <tr> |
| [544](#L544) | <td> |
| [545](#L545) | <?php¬†echo¬†$i++;¬†?> |
| [546](#L546) | </td> |
| [547](#L547) | <td> |
| [548](#L548) | <a href="<?php¬†echo¬†esc\_url(¬†$row->link¬†);¬†?>"><?php¬†echo¬†esc\_url(¬†$row->link¬†);¬†?></a> |
| [549](#L549) | </td> |
| [550](#L550) | <td> |
| [551](#L551) | <?php¬†echo¬†$row->clicks;¬†?> |
| [552](#L552) | </td> |
| [553](#L553) | <td> |
| [554](#L554) | <div class="graph" style="width: <?php¬†echo¬†$percentage;¬†?>%;">&nbsp;</div> |
| [555](#L555) | </td> |
| [556](#L556) | </tr> |
| [557](#L557) | <?php |
| [558](#L558) | } |
| [559](#L559) | } |
| [560](#L560) |  |
| [561](#L561) | ?> |
| [562](#L562) | </tbody> |
| [563](#L563) | </table> |
| [564](#L564) | </div> |
| [565](#L565) | <?php |
| [566](#L566) | } |
| [567](#L567) |  |
| [568](#L568) | static¬†function¬†topfeeds\_page(){ |
| [569](#L569) | global¬†$wpdb; |
| [570](#L570) |  |
| [571](#L571) | ?> |
| [572](#L572) | <div class="wrap"> |
| [573](#L573) | <div class="icon32" id="icon-options-general"> |
| [574](#L574) | <br /> |
| [575](#L575) | </div> |
| [576](#L576) | <h2><?php¬†esc\_html\_e(¬†'Your most popular feeds',¬†'feed-statistics'¬†);¬†?></h2> |
| [577](#L577) | <table style="width: 100%;"> |
| [578](#L578) | <thead> |
| [579](#L579) | <tr> |
| [580](#L580) | <th>&nbsp;</th> |
| [581](#L581) | <th style="width: 50%; text-align: left;"><?php¬†esc\_html\_e(¬†'Feed URL',¬†'feed-statistics'¬†);¬†?></th> |
| [582](#L582) | <th style="text-align: left;"><?php¬†esc\_html\_e(¬†'Subscribers',¬†'feed-statistics'¬†);¬†?></th> |
| [583](#L583) | <th style="width: 35%;">&nbsp;</th> |
| [584](#L584) | </tr> |
| [585](#L585) | </thead> |
| [586](#L586) | <tbody> |
| [587](#L587) | <?php |
| [588](#L588) |  |
| [589](#L589) | $results¬†=¬†$wpdb->get\_results( |
| [590](#L590) | $wpdb->prepare( |
| [591](#L591) | "SELECT |
| [592](#L592) | `feed`, |
| [593](#L593) | SUM(`subscribers`) `subscribers` |
| [594](#L594) | FROM `".$wpdb->prefix."feed\_subscribers` |
| [595](#L595) | WHERE |
| [596](#L596) | `feed` != '' |
| [597](#L597) | AND |
| [598](#L598) | ( |
| [599](#L599) | (`date` > %s) |
| [600](#L600) | OR |
| [601](#L601) | ( |
| [602](#L602) | LOCATE('###',`identifier`) != 0 AND |
| [603](#L603) | `date` > %s |
| [604](#L604) | ) |
| [605](#L605) | ) |
| [606](#L606) | GROUP BY `feed` |
| [607](#L607) | ORDER BY `subscribers` DESC", |
| [608](#L608) | date("Y-m-d H:i:s",¬†time()¬†-¬†(60¬†\*¬†60¬†\*¬†24¬†\*¬†get\_option("feed\_statistics\_expiration\_days"))), |
| [609](#L609) | date("Y-m-d H:i:s",¬†time()¬†-¬†(60¬†\*¬†60¬†\*¬†24¬†\*¬†get\_option("feed\_statistics\_expiration\_days")¬†\*¬†3)) |
| [610](#L610) | ) |
| [611](#L611) | ); |
| [612](#L612) |  |
| [613](#L613) | $feeds¬†=¬†array(); |
| [614](#L614) |  |
| [615](#L615) | $i¬†=¬†1; |
| [616](#L616) |  |
| [617](#L617) | if¬†(¬†!¬†empty(¬†$results¬†)¬†)¬†{ |
| [618](#L618) | foreach¬†(¬†$results¬†as¬†$feed¬†)¬†{ |
| [619](#L619) | if¬†(¬†!¬†isset(¬†$max¬†)¬†) |
| [620](#L620) | $max¬†=¬†$feed->subscribers; |
| [621](#L621) |  |
| [622](#L622) | $percentage¬†=¬†ceil(¬†$feed->subscribers¬†/¬†$max¬†\*¬†100¬†); |
| [623](#L623) |  |
| [624](#L624) | ?> |
| [625](#L625) | <tr> |
| [626](#L626) | <td><?php¬†echo¬†$i++;¬†?></td> |
| [627](#L627) | <td style="width: 40%;"> |
| [628](#L628) | <a href="<?php¬†echo¬†esc\_url(¬†$feed->feed¬†);¬†?>"><?php¬†echo¬†esc\_url(¬†$feed->feed¬†);¬†?></a> |
| [629](#L629) | </td> |
| [630](#L630) | <td style="width: 15%;"><?php¬†echo¬†$feed->subscribers;¬†?></td> |
| [631](#L631) | <td style="width: 40%;"> |
| [632](#L632) | <div class="graph" style="width: <?php¬†echo¬†$percentage;¬†?>%;">&nbsp;</div> |
| [633](#L633) | </td> |
| [634](#L634) | </tr> |
| [635](#L635) | <?php |
| [636](#L636) | } |
| [637](#L637) | } |
| [638](#L638) |  |
| [639](#L639) | ?> |
| [640](#L640) | </tbody> |
| [641](#L641) | </table> |
| [642](#L642) | </div> |
| [643](#L643) | <?php |
| [644](#L644) | } |
| [645](#L645) |  |
| [646](#L646) | static¬†function¬†postviews\_page(){ |
| [647](#L647) | global¬†$wpdb; |
| [648](#L648) |  |
| [649](#L649) | ?> |
| [650](#L650) | <div class="wrap"> |
| [651](#L651) | <div class="icon32" id="icon-options-general"> |
| [652](#L652) | <br /> |
| [653](#L653) | </div> |
| [654](#L654) | <h2><?php¬†esc\_html\_e(¬†'Your most popular posts (last 30 days)',¬†'feed-statistics'¬†);¬†?></h2> |
| [655](#L655) | <p> |
| [656](#L656) | <?php |
| [657](#L657) |  |
| [658](#L658) | if¬†(¬†get\_option(¬†'feed\_statistics\_track\_postviews'¬†)¬†)¬†{ |
| [659](#L659) | if¬†(¬†1¬†==¬†get\_option(¬†'rss\_use\_excerpt'¬†)¬†)¬†{ |
| [660](#L660) | printf(¬†\_\_(¬†'You have post view tracking turned on, but you have your feeds set to "Summary" mode. To track post views, you should select "Full text" mode on the <a href="%s">Reading settings</a> page.',¬†'feed-statistics'¬†),¬†admin\_url(¬†'options-reading.php'¬†)¬†); |
| [661](#L661) | } |
| [662](#L662) | else¬†{ |
| [663](#L663) | esc\_html\_e(¬†'You have post view tracking turned on.',¬†'feed-statistics'¬†); |
| [664](#L664) | } |
| [665](#L665) | } |
| [666](#L666) | else¬†{ |
| [667](#L667) | esc\_html\_e(¬†'You have post view tracking turned off.',¬†'feed-statistics'¬†); |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) | ?> |
| [671](#L671) | </p> |
| [672](#L672) | <table style="width: 100%;"> |
| [673](#L673) | <thead> |
| [674](#L674) | <tr> |
| [675](#L675) | <th>&nbsp;</th> |
| [676](#L676) | <th style="width: 50%; text-align: left;"><?php¬†esc\_html\_e(¬†'Post Title',¬†'feed-statistics'¬†);¬†?></th> |
| [677](#L677) | <th style="text-align: left;"><?php¬†esc\_html\_e(¬†'Views',¬†'feed-statistics'¬†);¬†?></th> |
| [678](#L678) | <th style="width: 35%;">&nbsp;</th> |
| [679](#L679) | </tr> |
| [680](#L680) | </thead> |
| [681](#L681) | <tbody> |
| [682](#L682) | <?php |
| [683](#L683) |  |
| [684](#L684) | // Delete entries older than 30 days. |
| [685](#L685) | $wpdb->query( |
| [686](#L686) | $wpdb->prepare( |
| [687](#L687) | "DELETE FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_postviews WHERE `time` < %s", |
| [688](#L688) | date("Y-m-d H:i:s",¬†time()¬†-¬†(60¬†\*¬†60¬†\*¬†24¬†\*¬†30)) |
| [689](#L689) | ) |
| [690](#L690) | ); |
| [691](#L691) |  |
| [692](#L692) | $results¬†=¬†$wpdb->get\_results( |
| [693](#L693) | $wpdb->prepare( |
| [694](#L694) | "SELECT |
| [695](#L695) | COUNT(\*) AS `views`, |
| [696](#L696) | `v`.`post\_id`, |
| [697](#L697) | `p`.`post\_title` `title`, |
| [698](#L698) | `p`.`guid` `permalink` |
| [699](#L699) | FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_postviews AS `v` |
| [700](#L700) | LEFT JOIN "¬†.¬†$wpdb->prefix¬†.¬†"posts AS `p` ON `v`.`post\_id`=`p`.`ID` |
| [701](#L701) | WHERE `v`.`time` > %s |
| [702](#L702) | GROUP BY `v`.`post\_id` |
| [703](#L703) | ORDER BY `views` DESC |
| [704](#L704) | LIMIT 20", |
| [705](#L705) | date("Y-m-d H:i:s",¬†time()¬†-¬†(60¬†\*¬†60¬†\*¬†24¬†\*¬†30)) |
| [706](#L706) | ) |
| [707](#L707) | ); |
| [708](#L708) |  |
| [709](#L709) | if¬†(¬†!¬†empty(¬†$results¬†)¬†)¬†{ |
| [710](#L710) | $i¬†=¬†1; |
| [711](#L711) | $max¬†=¬†$results[0]->views; |
| [712](#L712) |  |
| [713](#L713) | foreach¬†(¬†$results¬†as¬†$row¬†)¬†{ |
| [714](#L714) | $percentage¬†=¬†ceil($row->views¬†/¬†$max¬†\*¬†100); |
| [715](#L715) |  |
| [716](#L716) | ?> |
| [717](#L717) | <tr> |
| [718](#L718) | <td><?php¬†echo¬†$i++;¬†?></td> |
| [719](#L719) | <td><a href="<?php¬†echo¬†esc\_url(¬†$row->permalink¬†);¬†?>"><?php¬†esc\_html\_e(¬†$row->title¬†);¬†?></a></td> |
| [720](#L720) | <td><?php¬†echo¬†$row->views;¬†?></td> |
| [721](#L721) | <td> |
| [722](#L722) | <div class="graph" style="width: <?php¬†echo¬†$percentage;¬†?>%;">&nbsp;</div> |
| [723](#L723) | </td> |
| [724](#L724) | </tr> |
| [725](#L725) | <?php |
| [726](#L726) | } |
| [727](#L727) | } |
| [728](#L728) |  |
| [729](#L729) | ?> |
| [730](#L730) | </tbody> |
| [731](#L731) | </table> |
| [732](#L732) | </div> |
| [733](#L733) | <?php |
| [734](#L734) | } |
| [735](#L735) |  |
| [736](#L736) | static¬†function¬†feedreaders\_page(){ |
| [737](#L737) | global¬†$wpdb; |
| [738](#L738) |  |
| [739](#L739) | ?> |
| [740](#L740) | <div class="wrap"> |
| [741](#L741) | <div class="icon32" id="icon-options-general"> |
| [742](#L742) | <br /> |
| [743](#L743) | </div> |
| [744](#L744) | <h2><?php¬†esc\_html\_e(¬†'Top Feed Readers',¬†'feed-statistics'¬†);¬†?></h2> |
| [745](#L745) | <?php |
| [746](#L746) |  |
| [747](#L747) | $expiration\_days¬†=¬†get\_option("feed\_statistics\_expiration\_days"); |
| [748](#L748) |  |
| [749](#L749) | $wpdb->query( |
| [750](#L750) | $wpdb->prepare( |
| [751](#L751) | "DELETE FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_subscribers WHERE `date` < %s", |
| [752](#L752) | date(¬†"Y-m-d H:i:s",¬†time()¬†-¬†(¬†60¬†\*¬†60¬†\*¬†24¬†\*¬†get\_option(¬†"feed\_statistics\_expiration\_days"¬†)¬†\*¬†3¬†)¬†) |
| [753](#L753) | ) |
| [754](#L754) | ); |
| [755](#L755) |  |
| [756](#L756) | $results¬†=¬†$wpdb->get\_results( |
| [757](#L757) | $wpdb->prepare( |
| [758](#L758) | "SELECT |
| [759](#L759) | CASE |
| [760](#L760) | WHEN |
| [761](#L761) | LOCATE('###',`identifier`) != 0 THEN SUBSTRING(`identifier`, 1, LOCATE(' ',`identifier`)) |
| [762](#L762) | ELSE |
| [763](#L763) | `user\_agent` |
| [764](#L764) | END AS `reader`, |
| [765](#L765) | SUM(`subscribers`) `readers` |
| [766](#L766) | FROM "¬†.¬†$wpdb->prefix¬†.¬†"feed\_subscribers |
| [767](#L767) | WHERE `date` > %s |
| [768](#L768) | GROUP BY `reader` |
| [769](#L769) | ORDER BY `readers` DESC", |
| [770](#L770) | date("Y-m-d H:i:s",¬†time()¬†-¬†(60¬†\*¬†60¬†\*¬†24¬†\*¬†get\_option("feed\_statistics\_expiration\_days"))) |
| [771](#L771) | ) |
| [772](#L772) | ); |
| [773](#L773) |  |
| [774](#L774) | $readers¬†=¬†array(); |
| [775](#L775) |  |
| [776](#L776) | if¬†(!empty($results)){ |
| [777](#L777) | foreach¬†($results¬†as¬†$row){ |
| [778](#L778) | $reader¬†=¬†$row->reader; |
| [779](#L779) |  |
| [780](#L780) | $version¬†=¬†array(); |
| [781](#L781) |  |
| [782](#L782) | if¬†($reader¬†==¬†'')¬†{ |
| [783](#L783) | $reader¬†=¬†"Unknown (Pending)"; |
| [784](#L784) | } |
| [785](#L785) | else¬†if¬†(preg\_match("/Navigator\/([0-9abpre\.]+)/is",¬†$reader,¬†$version)){ |
| [786](#L786) | $reader¬†=¬†"Netscape Navigator ".$version[1]; |
| [787](#L787) | } |
| [788](#L788) | else¬†if¬†(preg\_match("/Opera\/([0-9abpre\.]+)/is",¬†$reader,¬†$version)){ |
| [789](#L789) | $reader¬†=¬†"Opera ".$version[1]; |
| [790](#L790) | } |
| [791](#L791) | else¬†if¬†(preg\_match("/Flock\/([0-9abpre\.]+)/is",¬†$reader,¬†$version)){ |
| [792](#L792) | $reader¬†=¬†"Flock ".$version[1]; |
| [793](#L793) | } |
| [794](#L794) | else¬†if¬†(preg\_match("/(Firefox|BonEcho|GranParadiso|Aurora|Minefield)\/([0-9abpre\.]+)/is",¬†$reader,¬†$version))¬†{ |
| [795](#L795) | $reader¬†=¬†"Mozilla ".$version[1]." ".$version[2]; |
| [796](#L796) | } |
| [797](#L797) | else¬†if¬†(preg\_match("/MSIE ([0-9abpre\.]+)/is",¬†$reader,¬†$version)){ |
| [798](#L798) | $reader¬†=¬†"Internet Explorer ".$version[1]; |
| [799](#L799) | } |
| [800](#L800) | else¬†if¬†(preg\_match("/RockMelt\/([^\s\.]+)/is",¬†$reader,¬†$version))¬†{ |
| [801](#L801) | $reader¬†=¬†"RockMelt ".$version[1]; |
| [802](#L802) | } |
| [803](#L803) | else¬†if¬†(preg\_match("/Chrome\/([^\s\.]+)/is",¬†$reader,¬†$version))¬†{ |
| [804](#L804) | $reader¬†=¬†"Chrome ".$version[1]; |
| [805](#L805) | } |
| [806](#L806) | else¬†if¬†(preg\_match("/Safari/is",¬†$reader))¬†{ |
| [807](#L807) | $reader¬†=¬†"Safari"; |
| [808](#L808) | } |
| [809](#L809) | else¬†if¬†(preg\_match("/Gecko/Uis",¬†$reader))¬†{ |
| [810](#L810) | $reader¬†=¬†"Other Mozilla browser"; |
| [811](#L811) | } |
| [812](#L812) | else¬†if¬†(!preg\_match("/Mozilla/Uis",¬†$reader)){ |
| [813](#L813) | $reader¬†=¬†preg\_replace("/[\/;].\*$/Uis",¬†"",¬†$reader); |
| [814](#L814) | } |
| [815](#L815) | else¬†{ |
| [816](#L816) | continue; |
| [817](#L817) | } |
| [818](#L818) |  |
| [819](#L819) | foreach¬†($readers¬†as¬†$key¬†=>¬†$d)¬†{ |
| [820](#L820) | if¬†($d["reader"]¬†==¬†$reader){ |
| [821](#L821) | $readers[$key]["readers"]¬†+=¬†$row->readers; |
| [822](#L822) | continue¬†2; |
| [823](#L823) | } |
| [824](#L824) | } |
| [825](#L825) |  |
| [826](#L826) | $readers[]¬†=¬†array("reader"¬†=>¬†$reader,¬†"readers"¬†=>¬†$row->readers); |
| [827](#L827) | } |
| [828](#L828) | } |
| [829](#L829) |  |
| [830](#L830) | function¬†sort\_reader\_array($a,¬†$b)¬†{ |
| [831](#L831) | return¬†$b["readers"]¬†-¬†$a["readers"]; |
| [832](#L832) | } |
| [833](#L833) |  |
| [834](#L834) | usort($readers,¬†'sort\_reader\_array'); |
| [835](#L835) |  |
| [836](#L836) | $max¬†=¬†$readers[0]["readers"]; |
| [837](#L837) |  |
| [838](#L838) | ob\_start(); |
| [839](#L839) |  |
| [840](#L840) | ?> |
| [841](#L841) | <table style="width: 100%;"> |
| [842](#L842) | <thead> |
| [843](#L843) | <tr> |
| [844](#L844) | <th>&nbsp;</th> |
| [845](#L845) | <th style="text-align: left;"><?php¬†esc\_html\_e(¬†'Reader',¬†'feed-statistics'¬†);¬†?></th> |
| [846](#L846) | <th style="text-align: left;"><?php¬†esc\_html\_e(¬†'Subscribers',¬†'feed-statistics'¬†);¬†?></th> |
| [847](#L847) | <th>&nbsp;</th> |
| [848](#L848) | </tr> |
| [849](#L849) | </thead> |
| [850](#L850) | <tbody> |
| [851](#L851) | <?php |
| [852](#L852) |  |
| [853](#L853) | $i¬†=¬†1; |
| [854](#L854) |  |
| [855](#L855) | foreach¬†($readers¬†as¬†$reader)¬†{ |
| [856](#L856) | $percentage¬†=¬†ceil($reader["readers"]¬†/¬†$max¬†\*¬†100); |
| [857](#L857) |  |
| [858](#L858) | ?> |
| [859](#L859) | <tr> |
| [860](#L860) | <td><?php¬†echo¬†$i++;¬†?></td> |
| [861](#L861) | <td style="width: 40%;"><?php¬†echo¬†esc\_html(¬†$reader["reader"]¬†);¬†?></td> |
| [862](#L862) | <td style="width: 15%;"><?php¬†echo¬†esc\_html(¬†$reader["readers"]¬†);¬†?></td> |
| [863](#L863) | <td style="width: 40%;"> |
| [864](#L864) | <div class="graph" style="width: <?php¬†echo¬†$percentage;¬†?>%;">&nbsp;</div> |
| [865](#L865) | </td> |
| [866](#L866) | </tr> |
| [867](#L867) | <?php |
| [868](#L868) | } |
| [869](#L869) |  |
| [870](#L870) | ?> |
| [871](#L871) | </tbody> |
| [872](#L872) | </table> |
| [873](#L873) | </div> |
| [874](#L874) | <?php |
| [875](#L875) | } |
| [876](#L876) |  |
| [877](#L877) | static¬†function¬†feed\_page()¬†{ |
| [878](#L878) | ?> |
| [879](#L879) | <div class="wrap"> |
| [880](#L880) | <?php¬†if¬†(¬†!¬†empty(¬†$\_POST['feed\_statistics\_update']¬†)¬†)¬†{¬†?> |
| [881](#L881) | <div class="updated"><p><?php¬†esc\_html\_e(¬†'Settings have been saved.',¬†'feed-statistics'¬†);¬†?></p></div> |
| [882](#L882) | <?php¬†}¬†?> |
| [883](#L883) |  |
| [884](#L884) | <div class="icon32" id="icon-options-general"> |
| [885](#L885) | <br /> |
| [886](#L886) | </div> |
| [887](#L887) | <h2><?php¬†esc\_html\_e(¬†'Feed Statistics Settings',¬†'feed-statistics'¬†);¬†?></h2> |
| [888](#L888) | <form method="post"> |
| [889](#L889) | <input type="hidden" name="feed\_statistics\_update" value="1"/> |
| [890](#L890) |  |
| [891](#L891) | <table class="form-table"> |
| [892](#L892) | <tbody> |
| [893](#L893) | <tr valign="top"> |
| [894](#L894) | <th scope="row"><?php¬†esc\_html\_e(¬†'Subscribers',¬†'feed-statistics'¬†);¬†?></th> |
| [895](#L895) | <td> |
| [896](#L896) | <?php¬†printf(¬†esc\_html\_\_(¬†'Count users who have requested a feed within the last %1$s days as subscribers. You currently have %2$s subscribers.',¬†'feed-statistics'¬†),¬†'<input type="text" size="2" name="feed\_statistics\_expiration\_days" value="'¬†.¬†intval(¬†get\_option("feed\_statistics\_expiration\_days")¬†)¬†.¬†'" />',¬†number\_format\_i18n(¬†FEED\_STATS::how\_many\_subscribers()¬†)¬†);¬†?> |
| [897](#L897) | </td> |
| [898](#L898) | </tr> |
| [899](#L899) | <tr valign="top"> |
| [900](#L900) | <th scope="row"><?php¬†esc\_html\_e(¬†'Clickthroughs',¬†'feed-statistics'¬†);¬†?></th> |
| [901](#L901) | <td> |
| [902](#L902) | <input type="checkbox" name="feed\_statistics\_track\_clickthroughs" value="1" <?php¬†checked(¬†get\_option(¬†'feed\_statistics\_track\_clickthroughs'¬†)¬†);¬†?>¬†/> |
| [903](#L903) | <?php¬†esc\_html\_e(¬†'Track which links your subscribers click',¬†'feed-statistics'¬†);¬†?> |
| [904](#L904) | <p class="description"> |
| [905](#L905) | <?php¬†esc\_html\_e(¬†'This requires WordPress to route all links in your posts back through your site so that clicks can be recorded.¬† The user shouldn\'t notice a difference.',¬†'feed-statistics'¬†);¬†?> |
| [906](#L906) | </p> |
| [907](#L907) | </td> |
| [908](#L908) | </tr> |
| [909](#L909) | <tr valign="top"> |
| [910](#L910) | <th scope="row"><?php¬†esc\_html\_e(¬†'Post views',¬†'feed-statistics'¬†);¬†?></th> |
| [911](#L911) | <td> |
| [912](#L912) | <input type="checkbox" name="feed\_statistics\_track\_postviews" value="1" <?php¬†checked(¬†get\_option(¬†'feed\_statistics\_track\_postviews'¬†)¬†);¬†?>¬†/> |
| [913](#L913) | <?php¬†esc\_html\_e(¬†'Track individual post views',¬†'feed-statistics'¬†);¬†?> |
| [914](#L914) | <p class="description"> |
| [915](#L915) | <?php¬†esc\_html\_e(¬†'This is done via an invisible tracking image and will track views of posts by users that use feed readers that load images from your site.',¬†'feed-statistics'¬†);¬†?> |
| [916](#L916) | </p> |
| [917](#L917) | </td> |
| [918](#L918) | </tr> |
| [919](#L919) | </tbody> |
| [920](#L920) | </table> |
| [921](#L921) | <p class="submit"> |
| [922](#L922) | <input class="button-primary" type="submit" name="Submit" value="<?php¬†esc\_attr\_e(¬†'Update Options',¬†'feed-statistics'¬†);¬†?>" /> |
| [923](#L923) | </p> |
| [924](#L924) | </form> |
| [925](#L925) | </div> |
| [926](#L926) | <?php |
| [927](#L927) | } |
| [928](#L928) |  |
| [929](#L929) | static¬†function¬†widget\_register()¬†{ |
| [930](#L930) | wp\_register\_sidebar\_widget(¬†'feed-statistics-widget',¬†\_\_(¬†'Feed Statistics',¬†'feed-statistics'¬†),¬†array(¬†'FEED\_STATS',¬†'widget'¬†)¬†); |
| [931](#L931) | } |
| [932](#L932) |  |
| [933](#L933) | static¬†function¬†widget($args)¬†{ |
| [934](#L934) | echo¬†$args['before\_widget']; |
| [935](#L935) |  |
| [936](#L936) | echo¬†'<span class="subscriber\_count">'; |
| [937](#L937) | feed\_subscribers(); |
| [938](#L938) | echo¬†'</span>'; |
| [939](#L939) |  |
| [940](#L940) | echo¬†$args['after\_widget']; |
| [941](#L941) | } |
| [942](#L942) |  |
| [943](#L943) | static¬†function¬†clickthrough\_replace($content)¬†{ |
| [944](#L944) | if¬†(is\_feed())¬†{ |
| [945](#L945) | $this\_file¬†=¬†\_\_FILE\_\_; |
| [946](#L946) |  |
| [947](#L947) | $redirect\_url¬†=¬†home\_url(¬†'/?feed-stats-url='¬†); |
| [948](#L948) |  |
| [949](#L949) | $content¬†=¬†preg\_replace(¬†"/"¬†.¬†self::LINK\_REGEX¬†.¬†"/ie",¬†"'$1\"' . FEED\_STATS::generate\_clickthrough\_url( '\\3' ) . '\"$5'",¬†$content); |
| [950](#L950) | } |
| [951](#L951) |  |
| [952](#L952) | return¬†$content; |
| [953](#L953) | } |
| [954](#L954) |  |
| [955](#L955) | static¬†function¬†generate\_clickthrough\_url(¬†$url¬†)¬†{ |
| [956](#L956) | if¬†(¬†strpos(¬†$url,¬†"//"¬†)¬†===¬†false¬†)¬†{ |
| [957](#L957) | return¬†$url; |
| [958](#L958) | } |
| [959](#L959) |  |
| [960](#L960) | $post\_id¬†=¬†get\_the\_ID(); |
| [961](#L961) |  |
| [962](#L962) | return¬†esc\_url(¬†home\_url(¬†'/?feed-stats-url='¬†.¬†urlencode(¬†base64\_encode(¬†$url¬†)¬†)¬†)¬†.¬†'&feed-stats-url-post-id='¬†.¬†urlencode(¬†$post\_id¬†)¬†); |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) | static¬†function¬†postview\_tracker($content)¬†{ |
| [966](#L966) | global¬†$id; |
| [967](#L967) |  |
| [968](#L968) | if¬†(is\_feed())¬†{ |
| [969](#L969) | $content¬†.=¬†' <img src="'¬†.¬†esc\_url(¬†home\_url(¬†'/?feed-stats-post-id='¬†.¬†$id¬†)¬†)¬†.¬†'" width="1" height="1" style="display: none;" />'; |
| [970](#L970) | } |
| [971](#L971) |  |
| [972](#L972) | return¬†$content; |
| [973](#L973) | } |
| [974](#L974) |  |
| [975](#L975) | static¬†function¬†admin\_head()¬†{ |
| [976](#L976) | ?> |
| [977](#L977) | <style type="text/css"> |
| [978](#L978) | div.graph { |
| [979](#L979) | border: 1px solid rgb(13, 50, 79); |
| [980](#L980) | background-color: rgb(131, 180, 216); |
| [981](#L981) | } |
| [982](#L982) | </style> |
| [983](#L983) | <?php |
| [984](#L984) | } |
| [985](#L985) | } |
| [986](#L986) |  |
| [987](#L987) | function¬†feed\_subscribers(){ |
| [988](#L988) | $s¬†=¬†FEED\_STATS::how\_many\_subscribers(); |
| [989](#L989) |  |
| [990](#L990) | printf(¬†\_n(¬†'%s feed subscriber',¬†'%s feed subscribers',¬†$s¬†),¬†number\_format\_i18n(¬†$s¬†)¬†); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | function¬†feed\_statistics\_options()¬†{ |
| [994](#L994) | FEED\_STATS::options(); |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | function¬†feed\_statistics\_widget($args)¬†{ |
| [998](#L998) | FEED\_STATS::widget($args); |
| [999](#L999) | } |
| [1000](#L1000) |  |
| [1001](#L1001) | function¬†feed\_statistics\_feed\_page()¬†{ |
| [1002](#L1002) | FEED\_STATS::feed\_page(); |
| [1003](#L1003) | } |
| [1004](#L1004) | function¬†feed\_statistics\_feedreaders\_page()¬†{ |
| [1005](#L1005) | FEED\_STATS::feedreaders\_page(); |
| [1006](#L1006) | } |
| [1007](#L1007) | function¬†feed\_statistics\_clickthroughs\_page()¬†{ |
| [1008](#L1008) | FEED\_STATS::clickthroughs\_page(); |
| [1009](#L1009) | } |
| [1010](#L1010) | function¬†feed\_statistics\_postviews\_page()¬†{ |
| [1011](#L1011) | FEED\_STATS::postviews\_page(); |
| [1012](#L1012) | } |
| [1013](#L1013) | function¬†feed\_statistics\_topfeeds\_page()¬†{ |
| [1014](#L1014) | FEED\_STATS::topfeeds\_page(); |
| [1015](#L1015) | } |
| [1016](#L1016) |  |
| [1017](#L1017) | function¬†feed\_statistics\_action\_links(¬†$links,¬†$file¬†)¬†{ |
| [1018](#L1018) | if¬†(¬†$file¬†==¬†plugin\_basename(¬†dirname(\_\_FILE\_\_)¬†.¬†'/feed-statistics.php'¬†)¬†)¬†{ |
| [1019](#L1019) | $links[]¬†=¬†'<a href="admin.php?page=feed-statistics.php">'¬†.¬†esc\_html\_\_(¬†'Settings',¬†'feed-statistics'¬†)¬†.' </a>'; |
| [1020](#L1020) | } |
| [1021](#L1021) |  |
| [1022](#L1022) | return¬†$links; |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) | add\_action('init',¬†array('FEED\_STATS','init')); |
| [1026](#L1026) |  |
| [1027](#L1027) | add\_action(¬†'plugins\_loaded',¬†array(¬†'FEED\_STATS',¬†'db\_setup'¬†)¬†); |
| [1028](#L1028) |  |
| [1029](#L1029) | register\_activation\_hook(¬†\_\_FILE\_\_,¬†array(¬†'FEED\_STATS',¬†'sql'¬†)¬†); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wordpress-feed-statistics/trunk/feed-statistics.php?rev=960868&format=txt)
* [Original Format](/export/960868/wordpress-feed-statistics/trunk/feed-statistics.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


