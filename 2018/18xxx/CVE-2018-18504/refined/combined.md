=== Content from www.mozilla.org_3e1c97f2_20250126_004220.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-01

## Security vulnerabilities fixed in Firefox 65

Announced
January 29, 2019
Impact
critical
Products
Firefox
Fixed in

* Firefox 65

#### [#CVE-2018-18500: Use-after-free parsing HTML5 stream](#CVE-2018-18500)

Reporter
Yaniv Frank with SophosLabs
Impact
critical
##### Description

A use-after-free vulnerability can occur while parsing an HTML5 stream in concert with custom HTML elements. This results in the stream parser object being freed while still in use, leading to a potentially exploitable crash.

##### References

* [Bug 1510114](https://bugzilla.mozilla.org/show_bug.cgi?id=1510114)

#### [#CVE-2018-18504: Memory corruption and out-of-bounds read of texture client buffer](#CVE-2018-18504)

Reporter
Markus Vervier of X41 D-SEC GmbH
Impact
high
##### Description

A crash and out-of-bounds read can occur when the buffer of a texture client is freed while it is still in use during graphic operations. This results in a potentially exploitable crash and the possibility of reading from the memory of the freed buffers.

##### References

* [Bug 1496413](https://bugzilla.mozilla.org/show_bug.cgi?id=1496413)

#### [#CVE-2018-18505: Privilege escalation through IPC channel messages](#CVE-2018-18505)

Reporter
Jed Davis
Impact
high
##### Description

An earlier fix for an Inter-process Communication (IPC) vulnerability, CVE-2011-3079, added authentication to communication between IPC endpoints and server parents during IPC process creation. This authentication is insufficient for channels created after the IPC process is started, leading to the authentication not being correctly applied to later channels. This could allow for a sandbox escape through IPC channels due to lack of message validation in the listener process.

##### References

* [Bug 1497749](https://bugzilla.mozilla.org/show_bug.cgi?id=1497749)
* [CVE-2011-3079](https://bugzilla.mozilla.org/show_bug.cgi?id=1087565)

#### [#CVE-2018-18503: Memory corruption with Audio Buffer](#CVE-2018-18503)

Reporter
Nils
Impact
moderate
##### Description

When JavaScript is used to create and manipulate an audio buffer, a potentially exploitable crash may occur because of a compartment mismatch in some situations.

##### References

* [Bug 1509442](https://bugzilla.mozilla.org/show_bug.cgi?id=1509442)

#### [#CVE-2018-18506: Proxy Auto-Configuration file can define localhost access to be proxied](#CVE-2018-18506)

Reporter
Jann Horn
Impact
moderate
##### Description

When proxy auto-detection is enabled, if a web server serves a Proxy Auto-Configuration (PAC) file or if a PAC file is loaded locally, this PAC file can specify that requests to the localhost are to be sent through the proxy to another server. This behavior is disallowed by default when a proxy is manually configured, but when enabled could allow for attacks on services and tools that bind to the localhost for networked behavior if they are accessed through browsing.

##### References

* [Bug 1503393](https://bugzilla.mozilla.org/show_bug.cgi?id=1503393)

#### [#CVE-2018-18502: Memory safety bugs fixed in Firefox 65](#CVE-2018-18502)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Arthur Iakab, Christoph Diehl, Christian Holler, Kalel, Emilio Cobos Álvarez, Cristina Coroiu, Noemi Erli, Natalia Csoregi, Julian Seward, Gary Kwong, Tyson Smith, Yaron Tausky, and Ronald Crane reported memory safety bugs present in Firefox 64. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 65](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1499426%2C1480090%2C1472990%2C1514762%2C1501482%2C1505887%2C1508102%2C1508618%2C1511580%2C1493497%2C1510145%2C1516289%2C1506798%2C1512758)

#### [#CVE-2018-18501: Memory safety bugs fixed in Firefox 65 and Firefox ESR 60.5](#CVE-2018-18501)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alex Gaynor, Christoph Diehl, Steven Crane, Jason Kratzer, Gary Kwong, and Christian Holler reported memory safety bugs present in Firefox 64 and Firefox ESR 60.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 65 and Firefox ESR 60.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1512450%2C1517542%2C1513201%2C1460619%2C1502871%2C1516738%2C1516514)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_1a2003cc_20250126_131153.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1510114)
* [XML](/show_bug.cgi?ctype=xml&id=1510114)

Closed
[Bug 1510114](/show_bug.cgi?id=1510114)
(CVE-2018-18500)

Opened 6 years ago
Closed 6 years ago

# Heap write-after-free in Custom Elements / HTML5 Parser

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Heap write-after-free in Custom Elements / HTML5 Parser

## Categories

### (Core :: DOM: HTML Parser, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20HTML%20Parser#DOM%3A%20HTML%20Parser)

DOM: HTML Parser
▾

Core :: DOM: HTML Parser
This system consumes content from the web, parses, validates and builds a content model (document)
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20HTML%20Parser)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla66

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified) |
| firefox63 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=wontfix) |
| firefox64 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix) |
| firefox65 | [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=verified) |
| firefox66 | [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 | 65+ | verified |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox63 |  | wontfix |
| firefox64 |  | wontfix |
| firefox65 | + | verified |
| firefox66 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: yaniv.frank, Assigned: hsivonen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0030426a5e04e85c33fe02480bc4ca81?d=mm&size=40)  [hsivonen](/user_profile?user_id=5490)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b3e3cfea1436ee66867ae306d0787cd2?d=mm&size=40)  [yaniv.frank](/user_profile?user_id=628924)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1378079](/show_bug.cgi?id=1378079 "RESOLVED FIXED - Creating an custom element from parser will synchronously call constructor")

Dependency [tree](/showdependencytree.cgi?id=1510114&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1510114)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1524711](/show_bug.cgi?id=1524711 "NEW - Crash Annotation GraphicsCriticalError |[C0][GFX1-]")

## Details

### (4 keywords, Whiteboard: [post-critsmash-triage][adv-main65+][adv-esr60.5+][coordinate disclosure with bug 1524711])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-18500

[Keywords:](/describekeywords.cgi)

[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main65+][adv-esr60.5+][coordinate disclosure with bug 1524711]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a3608033_1689 "6 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [ASAN log from mozilla-central linux64-asan-debug 20181126161820](/attachment.cgi?id=9027785)  [6 years ago](#c0)  [yaniv.frank](/user_profile?user_id=628924)   14.11 KB, text/plain |  | [Details](/attachment.cgi?id=9027785&action=edit) |
| --- | --- | --- |
| [customelements\_uaf\_poc.html](/attachment.cgi?id=9027787)  [6 years ago](#c1)  [yaniv.frank](/user_profile?user_id=628924)   1.72 KB, text/html |  | [Details](/attachment.cgi?id=9027787&action=edit) |
| [delay\_http\_server.py](/attachment.cgi?id=9027788)  [6 years ago](#c2)  [yaniv.frank](/user_profile?user_id=628924)   1.07 KB, text/x-python |  | [Details](/attachment.cgi?id=9027788&action=edit) |
| [Bug 1510114.](/attachment.cgi?id=9029299)  [6 years ago](#c17)  [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)   47 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-beta+](#c24 "6 years ago")  RyanVM : [approval-mozilla-esr60+](#c24 "6 years ago")  abillings : [sec-approval+](#c20 "6 years ago") | [Details](/attachment.cgi?id=9029299&action=edit) | [Review](/attachment.cgi?id=9029299) |
| [1510114 terminal output after crash.txt](/attachment.cgi?id=9040239)  [6 years ago](#c29)  [Stefan [:StefanG\_QA]](/user_profile?user_id=584294)   12.81 KB, text/plain |  | [Details](/attachment.cgi?id=9040239&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [yaniv.frank](/user_profile?user_id=628924)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1510114#c0)• 6 years ago |
|  | |

Attached file
[ASAN log from mozilla-central linux64-asan-debug 20181126161820](attachment.cgi?id=9027785)
— [Details](attachment.cgi?id=9027785&action=edit)

While parsing an HTML5 stream, a microtask checkpoint is performed when a custom element is being created.
By using a mutation observer callback it's possible to run arbitrary javascript code inside this checkpoint, allowing us to cause the destruction of the currently running nsHtml5StreamParser object by navigating to another page.
When the checkpoint finishes, a write to freed heap memory (a 0x1000 sized allocation previously belonging to nsHtml5StreamParser) occurs.
The content being written to freed memory is a pointer to a newly created nsIContent object, and it is written at a controllable offset (determined by the number of elements in the stream).
In the attached POC, a WebGLBuffer object is allocated in place of the freed object and the bug is used to overwrite its mByteLength field, potentially allowing for further disclosure and corruption of memory. tested successfully on Firefox 63.0.3 - Windows 7.
$ python delay\_http\_server.py 8080 &
$ firefox <http://127.0.0.1:8080/customelements_uaf_poc.html>

|  | [yaniv.frank](/user_profile?user_id=628924)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1510114#c1)• 6 years ago |
|  | |

Attached file
[customelements\_uaf\_poc.html](attachment.cgi?id=9027787)
— [Details](attachment.cgi?id=9027787&action=edit)

|  | [yaniv.frank](/user_profile?user_id=628924)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1510114#c2)• 6 years ago |
|  | |

Attached file
[delay\_http\_server.py](attachment.cgi?id=9027788)
— [Details](attachment.cgi?id=9027788&action=edit)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1510114#c3)• 6 years ago |
|  | |

Henri, can you make sure someone takes a look at this? Thanks.Flags: needinfo?(hsivonen)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a40692_20209)• 6 years ago |

[Attachment #9027785](/attachment.cgi?id=9027785&action=edit "ASAN log from mozilla-central linux64-asan-debug 20181126161820") -
Attachment mime type: text/x-log → text/plain

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1510114#c4)• 6 years ago |
|  | |

So the key part of the code looks like this (in nsHtml5TreeOperation.cpp):
case eTreeOpCreateHTMLElementNetwork:
case eTreeOpCreateHTMLElementNotNetwork: {
nsIContent\*\* target = mOne.node; // Now "target" points into "this"
...
\*target = CreateHTMLElement(name, ....) // Runs script, destroys "this".
Script runs under the CreateHTMLElement call. There are provisions for that there. The script in this example basically does:
location.replace("data:text/html,");
delayed\_xml.async = false;
delayed\_xml.load('delay.xml');
to start a load and spin the event loop, but it could use sync XHR as well (to work around us fixing [bug 332175](/show_bug.cgi?id=332175 "RESOLVED FIXED - Drop XMLDocument.load() support")).
I would assume we have some setup for preventing this problem when the nsHtml5TreeOperation would run an inline <script>, right? We probably need to use a similar setup here or something.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a41163_20209)• 6 years ago |

Status: UNCONFIRMED → NEWEver confirmed: true

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a42523_75935)• 6 years ago |

Group: core-security → dom-core-security

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1510114#c5)• 6 years ago |
|  | |

A non-asyc/defer <script> is always the last operation of a tree op flush. It's been a while since I've thought about custom element, but I'd have expected microtasks not to be run until the end of the tree of flush.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1510114#c6)• 6 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #5](/show_bug.cgi?id=1510114#c5 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))
> A non-asyc/defer <script> is always the last operation of a tree op flush.
> It's been a while since I've thought about custom element, but I'd have
> expected microtasks not to be run until the end of the tree of flush.
s/tree of flush/tree op flush/

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1510114#c7)• 6 years ago |
|  | |

> I'd have expected microtasks not to be run until the end of the tree of flush
So per spec, there's a microtask checkpoint performed right before creating an element with a custom element definition. See <https://html.spec.whatwg.org/multipage/parsing.html#create-an-element-for-the-token> step 6. That's basically what we implement, looks like; there's this code in nsHtml5TreeOperation::CreateHTMLElement:
{
nsAutoMicroTask mt;
}
which will do a checkpoint. Furthermore, step 9 of the same algorithm will invoke custom element reactions (which is running script directly; no microtask checkpoints involved) and those invocations will do their own microtask checkpoints.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1510114#c8)• 6 years ago |
|  | |

OK. After refreshing my memory of this code, <https://searchfox.org/mozilla-central/source/parser/html/nsHtml5AutoPauseUpdate.h#16> is supposed to keep the builder alive, which is supposed to keep the op queue, including the current op alive. nsHtml5TreeOpExecutor::ClearOpQueue(), nsHtml5TreeOpExecutor::MoveOpsFrom(nsTArray<nsHtml5TreeOperation>& aOpQueue), and nsHtml5TreeOpExecutor::RemoveFromStartOfOpQueue(size\_t aNumberOfOpsToRemove) all MOZ\_RELEASE\_ASSERT that it's OK to modify the op queue. nsHtml5AutoFlush is supposed to manage the state that the MOZ\_RELEASE\_ASSERTs assert on.
<https://searchfox.org/mozilla-central/source/parser/html/nsHtml5TreeOpStage.cpp#24> is supposed to be protected by mMutex.
So what I said in [comment 5](/show_bug.cgi?id=1510114#c5 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser") about expecting microtasks not to run was wrong and instead something is broken in the above-described mechanisms.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1510114#c9)• 6 years ago |
|  | |

We do have a nsHtml5AutoPauseUpdate in CreateHTMLElement. But it's going out of scope before we return from the call, and the treebuilder dies at that point.
Would it make sense to move the scoping for that nsHtml5AutoPauseUpdate out to nsHtml5TreeOperation::Perform in the eTreeOpCreateHTMLElement\* cases?
I don't know whether we'd want something in nsHtml5TreeBuilder::createElement too (that calls CreateHTMLElement).

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1510114#c10)• 6 years ago |
|  | |

(In reply to Boris Zbarsky [:bzbarsky, bz on IRC] from [comment #9](/show_bug.cgi?id=1510114#c9 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))
> Would it make sense to move the scoping for that nsHtml5AutoPauseUpdate out
> to nsHtml5TreeOperation::Perform in the eTreeOpCreateHTMLElement\* cases?
Making the doc update have a larger scope might be bad in terms of performance, since we'd close and reopen doc updates when not strictly necessary. (Though I'm not sure if Stylo has changed the cost from what it used to be.)
As for keeping the builder alive, we are also supposed to have outer stack-based pinning:
<https://searchfox.org/mozilla-central/source/parser/html/nsHtml5TreeOpExecutor.cpp#579>
<https://searchfox.org/mozilla-central/source/parser/html/nsHtml5TreeOpExecutor.cpp#392>
So when the use after free in the first stack in the ASAN report runs, there should be nsHtml5FlushLoopGuard guard(this); in nsHtml5TreeOpExecutor::RunFlushLoop() keeping the nsHtml5TreeOpExecutor alive. And, yet, the cycle collector running from the nested event loop is the second ASAN stack feels eligible to destroy the nsHtml5TreeOpExecutor...
> I don't know whether we'd want something in
> nsHtml5TreeBuilder::createElement too (that calls CreateHTMLElement).
In the innerHTML case, which is different and is what I had in mind in [comment 5](/show_bug.cgi?id=1510114#c5 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser").

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1510114#c11)• 6 years ago |
|  | |

I don't think CC is destroying the nsHtml5TreeOpExecutor.
It \_is\_ destroying the nsHtml5TreeBuilder. The asan log attached claims that the op is being destroyed from ~nsHtml5TreeBuilder() on nsHtml5TreeBuilderCppSupplement.h line 98, which is right after the "mOpQueue.Clear()" in ~nsHtml5TreeBuilder().
That said, it looks to me like the tree op executor has a separate mOpQueue, right? And that's the one we're going through in RunFlushLoop. So it's not clear to me why destroying the nsHtml5TreeBuilder would affect that, offhand.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a224911_1689)• 6 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-critical](/buglist.cgi?keywords=sec-critical&resolution=---)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1510114#c12)• 6 years ago |
|  | |

(In reply to Boris Zbarsky [:bzbarsky, bz on IRC] from [comment #11](/show_bug.cgi?id=1510114#c11 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))
> I don't think CC is destroying the nsHtml5TreeOpExecutor.
>
> It \_is\_ destroying the nsHtml5TreeBuilder.
Oops. Right.
Specifically, it is destroyed by nsHtml5StreamParser::~nsHtml5StreamParser(), so it's the stream parsing nsHtml5TreeBuilder that's getting destroyed.
> That said, it looks to me like the tree op executor has a separate mOpQueue,
> right? And that's the one we're going through in RunFlushLoop. So it's not
> clear to me why destroying the nsHtml5TreeBuilder would affect that, offhand.
It appears that at some point, nsTArray has changed and as a side effect of the changes, the transfer of tree ops across threads has started using C++ moves applied to nsTArray. I guess the next step is auditing if moving from an nsTArray works the way the parser code expects.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1510114#c13)• 6 years ago |
|  | |

Mostly a note to self: This needs e10s enabled to reproduce under ASAN.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1510114#c14)• 6 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #12](/show_bug.cgi?id=1510114#c12 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))
> It appears that at some point, nsTArray has changed and as a side effect of
> the changes, the transfer of tree ops across threads has started using C++
> moves applied to nsTArray. I guess the next step is auditing if moving from
> an nsTArray works the way the parser code expects.
FWIW, as a matter of general C++ advice of "don't operate on moved-from values", the introduction of moves to op queue handling is wrong, since the parser will operated on a moved-from queue expecting it to have the post-move semantics of an empty nsTArray.
(I still haven't located the actual concrete problem, though. At least superficially, move seems to leave the moved-from nsTArray in the empty state.)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1510114#c15)• 6 years ago |
|  | |

A local ASAN debug build has fewer symbols optimized out and points to the real reason. It's not the op queue that gets deleted from underneath the executor (i.e. it's not a matter of moves with nsTArray). Instead, what gets deleted is mOldHandles and mHandles on the nsHtml5TreeBuilder.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1510114#c16)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1510114&comment_id=13789524 "1 revision") |
|  | |

Ah, mOne.node is a pointer into mHandles, right.
So making sure we keep the nsHtml5StreamParser alive on the stack should help, right?

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a557064_5490)• 6 years ago |

Assignee: nobody → hsivonenStatus: NEW → ASSIGNEDFlags: needinfo?(hsivonen)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1510114#c17)• 6 years ago |
|  | |

Attached file
[Bug 1510114.](attachment.cgi?id=9029299)
— [Details](attachment.cgi?id=9029299&action=edit)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1510114#c18)• 6 years ago |
|  | |

(In reply to Boris Zbarsky [:bzbarsky, bz on IRC] from [comment #16](/show_bug.cgi?id=1510114#c16 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))
> So making sure we keep the nsHtml5StreamParser alive on the stack should
> help, right?
Yes, it seems to be sufficient to fix this. Normally the stream parser is dropped at the end of the stream, but with the patch, it's kept alive via the stack if the parser is terminated from within a custom element constructor.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1510114#c19)• 6 years ago |
|  | |

Comment on [attachment 9029299](/attachment.cgi?id=9029299 "Bug 1510114.") [[details]](/attachment.cgi?id=9029299&action=edit "Bug 1510114.")
[Bug 1510114](/show_bug.cgi?id=1510114 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser").
[Security Approval Request]
How easily could an exploit be constructed based on the patch?: Not easy. The patch makes it obvious that we have a use-after-free involving nsHtml5StreamParser but does not make it obvious how to trigger it.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?: No
Which older supported branches are affected by this flaw?: All, but caniuse.com suggests not by default for ESR
If not all supported branches, which bug introduced the flaw?: [Bug 1378079](/show_bug.cgi?id=1378079 "RESOLVED FIXED - Creating an custom element from parser will synchronously call constructor")
Do you have backports for the affected branches?: No
If not, how different, hard to create, and risky will they be?: Backports are the same patch, possible with whitespace changes.
How likely is this patch to cause regressions; how much testing does it need?: Extremely unlikely. It's probably good to have a person other than me check with an ASAN build that the steps to reproduce no longer reproduce the ASAN failure.
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: sec-approval?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a1170142_75935)• 6 years ago |

Blocks: [1378079](/show_bug.cgi?id=1378079 "RESOLVED FIXED - Creating an custom element from parser will synchronously call constructor")
[status-firefox63](/buglist.cgi?f1=cf_status_firefox63&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=wontfix)
[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[tracking-firefox65](/buglist.cgi?f1=cf_tracking_firefox65&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a1334195_75935)• 6 years ago |

[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected)
[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1510114#c20)• 6 years ago |
|  | |

Comment on [attachment 9029299](/attachment.cgi?id=9029299 "Bug 1510114.") [[details]](/attachment.cgi?id=9029299&action=edit "Bug 1510114.")
[Bug 1510114](/show_bug.cgi?id=1510114 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser").
sec-approval+ for trunk. Please create and nominate patches for beta and ESR60 as well.
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: sec-approval? → sec-approval+

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1510114#c21)• 6 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #20](/show_bug.cgi?id=1510114#c20 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))
> sec-approval+ for trunk.
<https://hg.mozilla.org/integration/autoland/rev/69649540a938>
> Please create and nominate patches for beta and ESR60 as well.
The same patch applies. I'll nominate once the trunk landing has made it to Nightly.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1510114#c22)• 6 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/69649540a938d1f3d9f145f34d074932a3feff4e>
<https://hg.mozilla.org/mozilla-central/rev/69649540a938>Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 6 years ago
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla66

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1510114#c23)• 6 years ago |
|  | |

Comment on [attachment 9029299](/attachment.cgi?id=9029299 "Bug 1510114.") [[details]](/attachment.cgi?id=9029299&action=edit "Bug 1510114.")
[Bug 1510114](/show_bug.cgi?id=1510114 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser").
[Beta/Release Uplift Approval Request]
Feature/Bug causing the regression: [Bug 1378079](/show_bug.cgi?id=1378079 "RESOLVED FIXED - Creating an custom element from parser will synchronously call constructor")
User impact if declined: The usual assumed consequences of use-after-free.
Is this code covered by automated tests?: No
Has the fix been verified in Nightly?: Yes
Needs manual test from QE?: Yes
If yes, steps to reproduce: See [comment 0](/show_bug.cgi?id=1510114#c0 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser") for the steps (to be performed in an ASAN build).
List of other uplifts needed: None
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): This patch merely holds an existing object alive for slightly longer (until the end of a method scope) than before. Making an object cycle collection-eligible slightly later poses a very low risk.
String changes made/needed: None
[ESR Uplift Approval Request]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
User impact if declined: The usual assumed consequences of use-after-free.
Fix Landed on Version: 66
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): This patch merely holds an existing object alive for slightly longer (until the end of a method scope) than before. Making an object cycle collection-eligible slightly later poses a very low risk.
String or UUID changes made by this patch: None
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: approval-mozilla-esr60?
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1510114#c24)• 6 years ago |
|  | |

Comment on [attachment 9029299](/attachment.cgi?id=9029299 "Bug 1510114.") [[details]](/attachment.cgi?id=9029299&action=edit "Bug 1510114.")
[Bug 1510114](/show_bug.cgi?id=1510114 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser").
[Triage Comment]
Fixes a sec-crit. Approved for 65.0b6 and 60.5.0esr.
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: approval-mozilla-esr60?
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: approval-mozilla-esr60+
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: approval-mozilla-beta?
[Attachment #9029299](/attachment.cgi?id=9029299&action=edit "Bug 1510114.") -
Flags: approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1510114#c25)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/c717fd7ff885>
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1510114#c26)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/d7a3568fa10c>
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a2043953_280903)• 6 years ago |

Flags: sec-bounty?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a2044188_280903)• 6 years ago |

Alias: CVE-2018-18500

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a2112762_488993)• 6 years ago |

Flags: qe-verify+Whiteboard: [post-critsmash-triage]

|  | [Stefan [:StefanG\_QA]](/user_profile?user_id=584294) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1510114#c27)• 6 years ago |
|  | |

In order to verify this issue, I will need more explicit steps. Thanks.

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1510114#c28)• 6 years ago |
|  | |

(In reply to Stefan [:StefanG\_QA] from [comment #27](/show_bug.cgi?id=1510114#c27 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))
> In order to verify this issue, I will need more explicit steps. Thanks.
1. Use 64-bit Linux
2. Download [attachment 9027787](/attachment.cgi?id=9027787 "customelements_uaf_poc.html") [[details]](/attachment.cgi?id=9027787&action=edit "customelements_uaf_poc.html") and [attachment 9027788](/attachment.cgi?id=9027788 "delay_http_server.py") [[details]](/attachment.cgi?id=9027788&action=edit "delay_http_server.py") and put both in the same directory.
3. cd into that directory
4. Run python delay\_http\_server.py 8080
5. In another terminal window, start an ASAN-enabled Firefox build.
6. In the Firefox build navigate to <http://127.0.0.1:8080/customelements_uaf_poc.html>
7. Check the terminal output from Firefox.
If ASAN didn't report an error as part of the terminal output from Firefox, things should be OK.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a3608033_1689)• 6 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a4500092_280903)• 6 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main65+][adv-esr60.5+]

|  | [Stefan [:StefanG\_QA]](/user_profile?user_id=584294) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1510114#c29)• 6 years ago |
|  | |

Attached file
[1510114 terminal output after crash.txt](attachment.cgi?id=9040239)
— [Details](attachment.cgi?id=9040239&action=edit)

Mozilla/5.0 (X11; Linux x86\_64; rv:65.0) Gecko/20100101 Firefox/65.0 (20181219203225)

I've tested this issue on Ubuntu 18.10 using the provided steps in [comment 28](/show_bug.cgi?id=1510114#c28 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"). During execution, I experienced several tab crashes and two browser crashes. Attached is the output from the terminal after a browser crash.

Flags: needinfo?(hsivonen)

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1510114#c30)• 6 years ago |
|  | |

On surface, [attachment 9040239](/attachment.cgi?id=9040239 "1510114 terminal output after crash.txt") [[details]](/attachment.cgi?id=9040239&action=edit "1510114 terminal output after crash.txt") looks unrelated to the Custom Elements bug. Also, the Custom Elements bug with this POC was expected to only crash the tab, not the whole browser.

However, the POC uses WebGLBuffer, so given "GraphicsCriticalError" in the ASAN report, it's possible that the same POC also reveals a graphics bug now that the parser bug is no longer in the way. Could you, please, file a new graphics security bug with the steps you took?

Flags: needinfo?(hsivonen)

|  | [Stefan [:StefanG\_QA]](/user_profile?user_id=584294) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1510114#c31)• 6 years ago |
|  | |

Based on [comment 30](/show_bug.cgi?id=1510114#c30 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser") I will mark this issue as Verified fixed since the encountered error is not related to the issue presented here.

Mozilla/5.0 (X11; Linux x86\_64; rv:60.0) Gecko/20100101 Firefox/60.0 (20181220134820)

Status: RESOLVED → VERIFIED
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=verified)
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=verified)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=verified)Flags: qe-verify+

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1510114#c32)• 6 years ago |
|  | |

(In reply to Henri Sivonen (:hsivonen) from [comment #30](/show_bug.cgi?id=1510114#c30 "VERIFIED FIXED - Heap write-after-free in Custom Elements / HTML5 Parser"))

> However, the POC uses WebGLBuffer, so given "GraphicsCriticalError" in the ASAN report, it's possible that the same POC also reveals a graphics bug now that the parser bug is no longer in the way. Could you, please, file a new graphics security bug with the steps you took?

This is now [bug 1524711](/show_bug.cgi?id=1524711 "NEW - Crash Annotation GraphicsCriticalError |[C0][GFX1-]").

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a5982186_5490)• 6 years ago |

Whiteboard: [post-critsmash-triage][adv-main65+][adv-esr60.5+] → [post-critsmash-triage][adv-main65+][adv-esr60.5+][coordinate disclosure with bug 1524711]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a6273401_1689)• 6 years ago |

See Also: → [1524711](/show_bug.cgi?id=1524711 "NEW - Crash Annotation GraphicsCriticalError |[C0][GFX1-]")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a38613130_1689)• 5 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1510114#a173797349_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1510114&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [yaniv.frank](/user_profile?user_id=628924)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from usn.ubuntu.com_1b014408_20250126_004219.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3874-1: Firefox vulnerabilities

30 January 2019

Firefox could be made to crash or run programs as your login if it
opened a malicious website.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.10](/security/notices?release=cosmic)
* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)
* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [firefox](/security/cves?package=firefox) - Mozilla Open Source web browser

## Details

Multiple security issues were discovered in Firefox. If a user were

tricked in to opening a specially crafted website, an attacker could

potentially exploit these to cause a denial of service, gain additional

privileges by escaping the sandbox, or execute arbitrary code.

([CVE-2018-18500](/security/CVE-2018-18500), [CVE-2018-18501](/security/CVE-2018-18501), [CVE-2018-18502](/security/CVE-2018-18502), [CVE-2018-18503](/security/CVE-2018-18503),

[CVE-2018-18504](/security/CVE-2018-18504), [CVE-2018-18505](/security/CVE-2018-18505))

It was discovered that Firefox allowed PAC files to specify that requests

to localhost are sent through the proxy to another server. If proxy

auto-detection is enabled, an attacker could potentially exploit this to

conduct attacks on local services and tools. ([CVE-2018-18506](/security/CVE-2018-18506))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.10

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.18.10.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.18.10.1)

##### Ubuntu 18.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.18.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.18.04.1)

##### Ubuntu 16.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.16.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.16.04.1)

##### Ubuntu 14.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.14.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.14.04.1)

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* [CVE-2018-18500](/security/CVE-2018-18500)
* [CVE-2018-18501](/security/CVE-2018-18501)
* [CVE-2018-18502](/security/CVE-2018-18502)
* [CVE-2018-18503](/security/CVE-2018-18503)
* [CVE-2018-18504](/security/CVE-2018-18504)
* [CVE-2018-18505](/security/CVE-2018-18505)
* [CVE-2018-18506](/security/CVE-2018-18506)

## Related notices

* [USN-3897-1](/security/notices/USN-3897-1)
* [USN-3927-1](/security/notices/USN-3927-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page


