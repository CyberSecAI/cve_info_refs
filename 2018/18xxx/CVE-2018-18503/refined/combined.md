=== Content from bugzilla.mozilla.org_9068bfd8_20250126_010553.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1087565)
* [XML](/show_bug.cgi?ctype=xml&id=1087565)

Closed
[Bug 1087565](/show_bug.cgi?id=1087565)
(CVE-2011-3079)

Opened 10 years ago
Closed 10 years ago

# IPC Channel does not validate the listener.

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

IPC Channel does not validate the listener.

## Categories

### (Core :: IPC, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=IPC#IPC)

IPC
▾

Core :: IPC
Core inter-process communication and IPDL system for communicating with and isolating sub-processes. Please file plugin-specific IPC bugs in Core: Plug-Ins and content-specific IPC bugs in Core: DOM: Content Processes.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=IPC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=IPC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=IPC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla40

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox37 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox37&o1=equals&v1=wontfix) |
| firefox38 | [+](/buglist.cgi?f1=cf_tracking_firefox38&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=fixed) |
| firefox38.0.5 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox38_0_5&o1=equals&v1=fixed) |
| firefox39 | [+](/buglist.cgi?f1=cf_tracking_firefox39&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=fixed) |
| firefox40 | [+](/buglist.cgi?f1=cf_tracking_firefox40&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=fixed) |
| firefox-esr31 | [38+](/buglist.cgi?f1=cf_tracking_firefox_esr31&o1=equals&v1=38%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=verified) |
| firefox-esr38 | --- | [verified](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=verified) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |
| b2g-v2.0 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected) |
| b2g-v2.0M | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected) |
| b2g-v2.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=unaffected) |
| b2g-v2.1S | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=unaffected) |
| b2g-v2.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=unaffected) |
| b2g-master | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox37 |  | wontfix |
| firefox38 | + | fixed |
| firefox38.0.5 |  | fixed |
| firefox39 | + | fixed |
| firefox40 | + | fixed |
| firefox-esr31 | 38+ | verified |
| firefox-esr38 |  | verified |
| b2g-v1.4 |  | unaffected |
| b2g-v2.0 |  | unaffected |
| b2g-v2.0M |  | unaffected |
| b2g-v2.1 |  | unaffected |
| b2g-v2.1S |  | unaffected |
| b2g-v2.2 |  | unaffected |
| relnote-firefox |  | --- |
| b2g-master |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jld, Assigned: bobowen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8877ff082c9a902bbf383dc11c1aeffc?d=mm&size=40)  [bobowen](/user_profile?user_id=458623)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

24 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation"), [1156835](/show_bug.cgi?id=1156835 "RESOLVED FIXED - Investigate if the fix for bug 1087565 still has problems because of the use of the command line to pass the secret.")

Dependency [tree](/showdependencytree.cgi?id=1087565&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1087565)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main38+][adv-esr31.7+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2011-3079

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main38+][adv-esr31.7+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c19 "10 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [Verify the child process with a secret hello on Windows.](/attachment.cgi?id=8589804)  [10 years ago](#c6)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.28 KB, patch | dvander : [review+](#c11 "10 years ago") | [Details](/attachment.cgi?id=8589804&action=edit) | [Diff](/attachment.cgi?id=8589804&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804) |
| --- | --- | --- |
| [Verify the child process with a secret hello on Windows. v2](/attachment.cgi?id=8595453)  [10 years ago](#c12)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.47 KB, patch | dvander : [review+](#c13 "10 years ago")  abillings : [sec-approval+](#c15 "10 years ago") | [Details](/attachment.cgi?id=8595453&action=edit) | [Diff](/attachment.cgi?id=8595453&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453) |
| [Aurora/Beta - Verify the child process with a secret hello on Windows.](/attachment.cgi?id=8596514)  [10 years ago](#c17)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.57 KB, patch | Sylvestre : [approval-mozilla-aurora+](#c22 "10 years ago")  Sylvestre : [approval-mozilla-release+](#c22 "10 years ago") | [Details](/attachment.cgi?id=8596514&action=edit) | [Diff](/attachment.cgi?id=8596514&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596514) |
| [ESR31 - Verify the child process with a secret hello on Windows.](/attachment.cgi?id=8596522)  [10 years ago](#c18)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.80 KB, patch | bkerensa : [approval-mozilla-esr31+](#a16762197_294742 "10 years ago") | [Details](/attachment.cgi?id=8596522&action=edit) | [Diff](/attachment.cgi?id=8596522&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596522) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1087565#c0)• 10 years ago |
|  | |

We have have probably inherited [CVE-2011-3079](https://www.cve.org/CVERecord?id=CVE-2011-3079) from our import of Chromium's IPC code 5½ years ago.
My understanding of this bug is: Chromium IPC endpoints have names, and knowing the name is sufficient to connect to it. These names were predictable and, on Windows, are reflected in the named pipe namespace which an untrusted process can traverse. The patch adds 32 bits of randomness to each name, and excludes that part from the pipe name on Windows. (Anyone with more knowledge of IPC is invited to correct this summary if needed.)
There's also a patch on the bug which seems to not be directly related to the IPC issue itself, and has something to do with Windows security levels: <https://crbug.com/117627#c18>
+++ This bug was initially created as a clone of [Bug #958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation") +++
"IPC Channel does not validate the listener."
<http://code.google.com/p/chromium/issues/detail?id=117627>

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a231_462836)• 10 years ago |

Blocks: [958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation")No longer depends on: [958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a2257345_1689)• 10 years ago |

Group: dom-core-security

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1087565#c1)• 10 years ago |
|  | |

But the attacker would still have to have a process running on the user's machine to do this, right?

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1087565#c2)• 10 years ago |
|  | |

(In reply to ben turner [:bent] (use the needinfo? flag!) from [comment #1](/show_bug.cgi?id=1087565#c1 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> But the attacker would still have to have a process running on the user's
> machine to do this, right?
Yes. The impact is privilege escalation from a compromised child process.

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1087565#c3)• 10 years ago |
|  | |

I started trying to see how hard this is to backport, and it's definitely not easy (even by the standards of hand-applied diffs set by the other children of [bug 958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation")). IPC::Channel seems to have been nontrivially refactored between our fork and the upstream bug, at least for the Windows implementation, so I'm not even sure where some of the parts of the first patch should be applied without spending more time making sense of both copies. Other parts of it depend on parts of chromium/base that don't (or no longer) exist in our tree, so they'd have to be (re-)imported or replaced, but that's a more straightforward complication.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1087565#c4)• 10 years ago |
|  | |

I've been in and around this code recently and looking at their patches, I've convinced myself as to how to backport this.
So, I'll pick this one up.
Jed - from what I can tell this doesn't affect posix and their patches don't in effect change the posix implementation. So, I'm not sure this needs to block [bug 866876](/show_bug.cgi?id=866876 "RESOLVED INVALID - [TRACKER] B2G Gecko security").Assignee: nobody → bobowen.codeStatus: NEW → ASSIGNEDFlags: needinfo?(jld)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1087565#c5)• 10 years ago |
|  | |

(In reply to Bob Owen (:bobowen) from [comment #4](/show_bug.cgi?id=1087565#c4 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Jed - from what I can tell this doesn't affect posix and their patches don't
> in effect change the posix implementation. So, I'm not sure this needs to
> block [bug 866876](/show_bug.cgi?id=866876 "RESOLVED INVALID - [TRACKER] B2G Gecko security").
I've looked at the patches some more, and I think I agree — if I'm reading it correctly, the IPC hello message payload is just the pid on POSIX (and the fix here is to add a secret int for Windows only). It's a little confusing because of the references to “validated channels” and needing to generate random names even in the POSIX case. I'm still not as sure as I'd ideally like to be of what's going on with that.No longer blocks: [b2gGeckoSecurity](/show_bug.cgi?id=866876 "RESOLVED INVALID - [TRACKER] B2G Gecko security")Flags: needinfo?(jld)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1087565#c6)• 10 years ago |
|  | |

Attached patch

[Verify the child process with a secret hello on Windows.](attachment.cgi?id=8589804&action=diff) (obsolete)
— [Details](attachment.cgi?id=8589804&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)

This is basically a port of [1] to our much older (modified) branch of the code.
I've had to change a few things to get it to work.
For the other changes mentioned in the bug:
[2] doesn't apply to our version of the code
[3] is a sandboxing code change, which we already have
I'm afraid I completely forgot about be careful pushing sec bugs to try ... sorry:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=0279d3d18835>
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=bfb5eca57e57>
\* bobowen slaps his own wrists ... really hard
[1] [https://chromium.googlesource.com/chromium/src/+/5c41e6e1cd446c3b2bc0ed17e66dffbc76f7c650%5E!/](https://chromium.googlesource.com/chromium/src/%2B/5c41e6e1cd446c3b2bc0ed17e66dffbc76f7c650%5E%21/)
[2] [https://chromium.googlesource.com/chromium/src/+/0590878f77dd9d3791b936287db516a99d14efb0%5E!/](https://chromium.googlesource.com/chromium/src/%2B/0590878f77dd9d3791b936287db516a99d14efb0%5E%21/)
[3] [https://chromium.googlesource.com/chromium/src/+/48fae61b8a6c9b741f001d478c595b6c7c0af4d9%5E!/](https://chromium.googlesource.com/chromium/src/%2B/48fae61b8a6c9b741f001d478c595b6c7c0af4d9%5E%21/)
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1087565#c7)• 10 years ago |
|  | |

Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
Verify the child process with a secret hello on Windows.
Review of [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804):
-----------------------------------------------------------------
This looks fine, just some things that I'd like clarified or adjusted first.
::: ipc/chromium/src/chrome/common/ipc\_channel.h
@@ +137,5 @@
> + static std::wstring GenerateUniqueRandomChannelID();
> +
> + // Generates a channel ID that, if passed to the client as a shared secret,
> + // will validate that the client's authenticity. On platforms that do not
> + // require additional this is simply calls GenerateUniqueRandomChannelID().
nit: "do not require additional validation"
::: ipc/chromium/src/chrome/common/ipc\_channel\_win.cc
@@ +164,5 @@
> std::wostringstream ss;
> + ss << L"\\\\.\\pipe\\chrome.";
> +
> + // Prevent the shared secret from ending up in the pipe name.
> + size\_t index = channel\_id.find\_first\_of(L'\\');
This strikes me as a little hacky. It would be nicer if GenerateVerifiedChannelID returned some kind of struct or tuple of (id, secret) or (channel-id, safe-pipe-id) instead, and Channel was constructed with that.
@@ +172,5 @@
> + }
> + ss << channel\_id.substr(0, index - 1);
> + } else {
> + // This case is here to support predictable named pipes in tests.
> + if (secret) {
CreatePipe() is the only caller of PipeName() and it passes a valid |secret|. Is there a reason to check for null here and above?
@@ +226,5 @@
> + // Don't send the secret to the untrusted process, and don't send a secret
> + // if the value is zero (for IPC backwards compatability).
> + int32\_t secret = validate\_client\_ ? 0 : client\_secret\_;
> + if (!m->WriteInt(GetCurrentProcessId()) ||
> + (secret && !m->WriteUInt32(secret))) {
nit: brace on newline for multi-line |if|
Using validate\_client\_ here is a little confusing. Reads better as:
int32\_t secret = (mode == MODE\_CLIENT) ? client\_secret\_ : 0;
@@ +368,5 @@
> + // The Hello message contains the process id and a secret if we need
> + // to validate the client.
> + MessageIterator it = MessageIterator(m);
> + int32\_t claimed\_pid = it.NextInt();
> + if (validate\_client\_ && (it.NextInt() != client\_secret\_)) {
Assuming we get rid of validate\_client\_ this check, I think, would be:
if (mode == MODE\_SERVER &&
client\_secret\_ &&
(it.NextInt() != client\_secret\_))
{
::: ipc/chromium/src/chrome/common/ipc\_channel\_win.h
@@ +107,5 @@
> // implement Unsound\_NumQueuedMessages.
> size\_t output\_queue\_length\_;
>
> + // Determines if we should validate a client's secret on connection.
> + bool validate\_client\_;
It looks like we can drop this, since client\_secret\_ == 0 implies no validation. If for some reason we can't drop it, a name without "client" would be better (like "needs\_validation\_" or something).
@@ +112,5 @@
> + // This is a unique per-channel value used to authenticate the client end of
> + // a connection. If the value is non-zero, the client passes it in the hello
> + // and the host validates. (We don't send the zero value fto preserve IPC
> + // compatability with existing clients that don't validate the channel.)
> + int32\_t client\_secret\_;
The word "client" can get confusing in IPC. Would "shared\_secret\_" or "challenge\_secret\_" be better here?
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1087565#c8)• 10 years ago |
|  | |

I assume the way the shared secret makes its way to the child process in the first place is a command line argument to CreateProcess(). If that's the case, we should check that unprivileged processes can't query that information with NtQueryInformationProcess(). Or as a precaution we could zap the PEB command line memory after it's been consumed.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1087565#c9)• 10 years ago |
|  | |

Thanks for the review.
(In reply to David Anderson [:dvander] from [comment #8](/show_bug.cgi?id=1087565#c8 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> I assume the way the shared secret makes its way to the child process in the
> first place is a command line argument to CreateProcess(). If that's the
> case, we should check that unprivileged processes can't query that
> information with NtQueryInformationProcess(). Or as a precaution we could
> zap the PEB command line memory after it's been consumed.
Yeah, I wondered about that.
For what it's worth, I don't think that Chrome clears the command line memory at all and certainly you can still see the channel ID and secret in Process Explorer.
As another part of this bug fix they started using an untrusted integrity level on the renderers, I think to stop them from opening other low (or higher) integrity processes like their gpu process.
We can't use untrusted on the content process currently and I'm not clear what benefit that would give us at the moment anyway.
We use untrusted as the delayed integrity level for GMP processes.
I suppose the other risk (such as it is) is from other low privileged processes from using the pipe and impersonating a Gecko child process.
I'm not sure how easy it would be for them to determine and open a child process, steal the secret and then use their pipe.
I'm pretty new to all this IPC stuff, so it would be good for me to investigate it and see if clearing the secret or other measures would be useful.
I'm on PTO tomorrow and next week, so would you mind if I picked this up in a follow-up bug?
Although, I suspect I'm not going to get this landed before I go anyway. :)
(In reply to David Anderson [:dvander] from [comment #7](/show_bug.cgi?id=1087565#c7 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
> Verify the child process with a secret hello on Windows.
>
> Review of [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804):
> -----------------------------------------------------------------
>
> This looks fine, just some things that I'd like clarified or adjusted first.
In general I was trying to keep this as close to the chromium patch as possible, while not changing too much of our existing code.
Life is already made difficult by the fact that our chromium IPC code is so old and by the fact that we have modified it fairly heavily.
I was trying to not make matters worse, although maybe that's a lost cause. :-)
I've commented about the ones that aren't style / typos below.
If you still want the proposed changes I'll have to pick this up after my PTO.
> ::: ipc/chromium/src/chrome/common/ipc\_channel\_win.cc
> @@ +164,5 @@
> > std::wostringstream ss;
> > + ss << L"\\\\.\\pipe\\chrome.";
> > +
> > + // Prevent the shared secret from ending up in the pipe name.
> > + size\_t index = channel\_id.find\_first\_of(L'\\');
>
> This strikes me as a little hacky. It would be nicer if
> GenerateVerifiedChannelID returned some kind of struct or tuple of (id,
> secret) or (channel-id, safe-pipe-id) instead, and Channel was constructed
> with that.
I agree, I imagine that they were trying to prevent the patch from hitting too many areas of their code, but I'm only guessing.
It does seem a bit odd given that in their patch they've already changed to use a ChannelHandle, so should have been able to add this without too much pain.
In our case we would have to change the other parts that use channel id and we'd end up moving this parsing logic to where we read the command line parameter.
> @@ +172,5 @@
> > + }
> > + ss << channel\_id.substr(0, index - 1);
> > + } else {
> > + // This case is here to support predictable named pipes in tests.
> > + if (secret) {
>
> CreatePipe() is the only caller of PipeName() and it passes a valid
> |secret|. Is there a reason to check for null here and above?
There was another part of the code, that we don't have, that passes null.
Not entirely sure where they use that.
> @@ +226,5 @@
> > + // Don't send the secret to the untrusted process, and don't send a secret
> > + // if the value is zero (for IPC backwards compatability).
> > + int32\_t secret = validate\_client\_ ? 0 : client\_secret\_;
> > + if (!m->WriteInt(GetCurrentProcessId()) ||
> > + (secret && !m->WriteUInt32(secret))) {
>
> nit: brace on newline for multi-line |if|
>
> Using validate\_client\_ here is a little confusing. Reads better as:
>
> int32\_t secret = (mode == MODE\_CLIENT) ? client\_secret\_ : 0;
Yeah, I found this difficult to read, but I suppose it depends on whether the extra confusion of moving further away form their code is worth it.
I agree that this is clearer.
I think that other changes that didn't fit into our code would have made dropping validate\_client\_ altogether a little more difficult.
> @@ +112,5 @@
> > + // This is a unique per-channel value used to authenticate the client end of
> > + // a connection. If the value is non-zero, the client passes it in the hello
> > + // and the host validates. (We don't send the zero value fto preserve IPC
> > + // compatability with existing clients that don't validate the channel.)
> > + int32\_t client\_secret\_;
>
> The word "client" can get confusing in IPC. Would "shared\_secret\_" or
> "challenge\_secret\_" be better here?
I suppose it is the client side of the pipe, but I agree this can be confusing.
Our use of Parent and Child has confused me a bit it the past as well. :-)Flags: needinfo?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1087565#c10)• 10 years ago |
|  | |

(In reply to Bob Owen (:bobowen) (PTO 10-19 Apr) from [comment #9](/show_bug.cgi?id=1087565#c9 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> I'm on PTO tomorrow and next week, so would you mind if I picked this up in
> a follow-up bug?
> Although, I suspect I'm not going to get this landed before I go anyway. :)
Sure.
> In general I was trying to keep this as close to the chromium patch as
> possible, while not changing too much of our existing code.
Ah, I see. It doesn't bother me too much if we diverge from Chromium, since that ship sailed a long time ago. I would really like to see the word "client\_" changed and validate\_client\_ removed if possible, the other stuff I'll leave up to you.Flags: needinfo?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1087565#c11)• 10 years ago |
|  | |

Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
Verify the child process with a secret hello on Windows.
r=me conditional on follow-up fixes as noted
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Flags: review+

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a15626693_458623)• 10 years ago |

Blocks: [1156835](/show_bug.cgi?id=1156835 "RESOLVED FIXED - Investigate if the fix for bug 1087565 still has problems because of the use of the command line to pass the secret.")

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1087565#c12)• 10 years ago |
|  | |

Attached patch

[Verify the child process with a secret hello on Windows. v2](attachment.cgi?id=8595453&action=diff)
— [Details](attachment.cgi?id=8595453&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)

Re-addressing your original review.
r?ing again as things didn't quite work out as hoped in some cases.
Try push as things have shifted a bit:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=9bc7385353bd>
(In reply to David Anderson [:dvander] from [comment #8](/show_bug.cgi?id=1087565#c8 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> I assume the way the shared secret makes its way to the child process in the
> first place is a command line argument to CreateProcess(). If that's the
> case, we should check that unprivileged processes can't query that
> information with NtQueryInformationProcess(). Or as a precaution we could
> zap the PEB command line memory after it's been consumed.
[Bug 1156835](/show_bug.cgi?id=1156835 "RESOLVED FIXED - Investigate if the fix for bug 1087565 still has problems because of the use of the command line to pass the secret.") filed as a follow-up.
(In reply to David Anderson [:dvander] from [comment #7](/show_bug.cgi?id=1087565#c7 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
> > + // require additional this is simply calls GenerateUniqueRandomChannelID().
>
> nit: "do not require additional validation"
Fixed.
> ::: ipc/chromium/src/chrome/common/ipc\_channel\_win.cc
> @@ +164,5 @@
> > std::wostringstream ss;
> > + ss << L"\\\\.\\pipe\\chrome.";
> > +
> > + // Prevent the shared secret from ending up in the pipe name.
> > + size\_t index = channel\_id.find\_first\_of(L'\\');
>
> This strikes me as a little hacky. It would be nicer if
> GenerateVerifiedChannelID returned some kind of struct or tuple of (id,
> secret) or (channel-id, safe-pipe-id) instead, and Channel was constructed
> with that.
I left this as we would need this logic somewhere when we parsed the channel from the command line.
> @@ +172,5 @@
> > + }
> > + ss << channel\_id.substr(0, index - 1);
> > + } else {
> > + // This case is here to support predictable named pipes in tests.
> > + if (secret) {
>
> CreatePipe() is the only caller of PipeName() and it passes a valid
> |secret|. Is there a reason to check for null here and above?
Removed and added a MOZ\_ASSERT at the top of the function for safety.
> @@ +226,5 @@
> > + // Don't send the secret to the untrusted process, and don't send a secret
> > + // if the value is zero (for IPC backwards compatability).
> > + int32\_t secret = validate\_client\_ ? 0 : client\_secret\_;
> > + if (!m->WriteInt(GetCurrentProcessId()) ||
> > + (secret && !m->WriteUInt32(secret))) {
>
> nit: brace on newline for multi-line |if|
Fixed.
Is this in our style guide?
I don't remember it, but I think it is definitely clearer with the multi-lines.
> Using validate\_client\_ here is a little confusing. Reads better as:
>
> int32\_t secret = (mode == MODE\_CLIENT) ? client\_secret\_ : 0;
Unfortunately mode isn't available here or in the other place where we'd need it.
I could have added it as a member variable, but that seemed like a bigger change.
So, I've renamed validate\_client\_ to waiting\_for\_shared\_secret\_ and changed the comments, to hopefully make it clear what is going on here.
> @@ +368,5 @@
> > + // The Hello message contains the process id and a secret if we need
> > + // to validate the client.
> > + MessageIterator it = MessageIterator(m);
> > + int32\_t claimed\_pid = it.NextInt();
> > + if (validate\_client\_ && (it.NextInt() != client\_secret\_)) {
>
> Assuming we get rid of validate\_client\_ this check, I think, would be:
>
> if (mode == MODE\_SERVER &&
> client\_secret\_ &&
> (it.NextInt() != client\_secret\_))
> {
As above mode isn't available here.
I also made the comment clearer here (hopefully).
> ::: ipc/chromium/src/chrome/common/ipc\_channel\_win.h
> @@ +107,5 @@
> > // implement Unsound\_NumQueuedMessages.
> > size\_t output\_queue\_length\_;
> >
> > + // Determines if we should validate a client's secret on connection.
> > + bool validate\_client\_;
>
> It looks like we can drop this, since client\_secret\_ == 0 implies no
> validation. If for some reason we can't drop it, a name without "client"
> would be better (like "needs\_validation\_" or something).
This is now waiting\_for\_shared\_secret\_
> @@ +112,5 @@
> > + // This is a unique per-channel value used to authenticate the client end of
> > + // a connection. If the value is non-zero, the client passes it in the hello
> > + // and the host validates. (We don't send the zero value fto preserve IPC
> > + // compatability with existing clients that don't validate the channel.)
> > + int32\_t client\_secret\_;
>
> The word "client" can get confusing in IPC. Would "shared\_secret\_" or
> "challenge\_secret\_" be better here?
This is now shared\_secret\_
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Attachment is obsolete: true
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1087565#c13)• 10 years ago |
|  | |

Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
Verify the child process with a secret hello on Windows. v2
Review of [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453):
-----------------------------------------------------------------
Looks good, thanks! re: style guide, not sure - it is for js/src. I haven't seen a situation where it looks worse.
::: ipc/chromium/src/chrome/common/ipc\_channel\_win.h
@@ +111,5 @@
>
> + // This is a unique per-channel value used to authenticate the client end of
> + // a connection. If the value is non-zero, the client passes it in the hello
> + // and the host validates. (We don't send the zero value to preserve IPC
> + // compatability with existing clients that don't validate the channel.)
nit: compatibility
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: review?(dvander) → review+

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1087565#c14)• 10 years ago |
|  | |

Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
Verify the child process with a secret hello on Windows. v2
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
You would need to have a compromised process on the machine already, so that you could run arbitrary code.
Even then, the most you could do is "impersonate" a gecko child process using the named pipe.
For what it's worth, the Chromium guys only marked this as medium severity.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Yes, the comments make the issue clear.
Also, this is already a public bug as it is reported for Chromium.
Which older supported branches are affected by this flaw?
Since the Chromium IPC code landed, I think, so all.
However, I think we only started using it for real, when either GMP or the thumbnail generation started to be used.
If not all supported branches, which bug introduced the flaw?
n/a
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Doesn't quite apply cleanly on Beta/Aurora (because of one of my own changes :-) ), but would be really easy to fix, if it were deemed necessary.
How likely is this patch to cause regressions; how much testing does it need?
Should be pretty safe and if it does cause regressions, they should be fairly obvious and widespread for e10s on Windows I think.
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1087565#c15)• 10 years ago |
|  | |

Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
Verify the child process with a secret hello on Windows. v2
sec-approval+ for trunk.
We'll want Aurora, Beta, and ESR31 patches for this created and nominated as well.
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a15718159_280903)• 10 years ago |

[status-firefox37](/buglist.cgi?f1=cf_status_firefox37&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox37&o1=equals&v1=wontfix)
[status-firefox38](/buglist.cgi?f1=cf_status_firefox38&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=affected)
[status-firefox39](/buglist.cgi?f1=cf_status_firefox39&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=affected)
[status-firefox40](/buglist.cgi?f1=cf_status_firefox40&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=affected)
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=affected)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected)
[tracking-firefox38](/buglist.cgi?f1=cf_tracking_firefox38&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox38&o1=equals&v1=%2B)
[tracking-firefox39](/buglist.cgi?f1=cf_tracking_firefox39&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox39&o1=equals&v1=%2B)
[tracking-firefox40](/buglist.cgi?f1=cf_tracking_firefox40&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox40&o1=equals&v1=%2B)
[tracking-firefox-esr31](/buglist.cgi?f1=cf_tracking_firefox_esr31&o1=isnotempty):
--- → [38+](/buglist.cgi?f1=cf_tracking_firefox_esr31&o1=equals&v1=38%2B)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1087565#c16)• 10 years ago |
|  | |

remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/2cb85f5cadab>
Thanks for the r+ and s-a+.
(In reply to David Anderson [:dvander] from [comment #13](/show_bug.cgi?id=1087565#c13 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
> > + // compatability with existing clients that don't validate the channel.)
>
> nit: compatibility
Fixed before pushing, thanks.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1087565#c17)• 10 years ago |
|  | |

Attached patch

[Aurora/Beta - Verify the child process with a secret hello on Windows.](attachment.cgi?id=8596514&action=diff)
— [Details](attachment.cgi?id=8596514&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596514)

Minor rebase due to some surrounding context changes.
Approval Request Comment
[Feature/regressing bug #]:
The code would have been brought in with the first cut of Chromium IPC code back in June 2009.
[User impact if declined]:
In theory a compromised, but low privileged process would be able to impersonate a Gecko child process, possible achieving some privilege escalation through communication with the firefox.exe process.
[Describe test coverage new/current, TreeHerder]:
Child processes are tested through GMP/EME, e10s and (I believe) thumbnail generation tests.
[Risks and why]:
Medium-low - while not a trivial patch the idea behind it is simple. Any issues would hopefully be obvious as the code is involved with the IPC channel initialisation.
[String/UUID change made/needed]:
None.
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-beta?
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-aurora?

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1087565#c18)• 10 years ago |
|  | |

Attached patch

[ESR31 - Verify the child process with a secret hello on Windows.](attachment.cgi?id=8596522&action=diff)
— [Details](attachment.cgi?id=8596522&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596522)

Again mainly surrounding context changes, but also an old version of ipc/chromium/src/base/atomic\_sequence\_num.h existed.
It looks like this was removed some time after ESR31, as it wasn't being used, so I've just overwritten it with the new version.
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
sec-high
User impact if declined:
In theory a compromised, but low privileged process would be able to impersonate a Gecko child process, possible achieving some privilege escalation through communication with the firefox.exe process.
Fix Landed on Version:
Fx40
Risk to taking this patch (and alternatives if risky):
Medium-low - while not a trivial patch the idea behind it is simple. Any issues would hopefully be obvious as the code is involved with the IPC channel initialisation.
String or UUID changes made by this patch:
None
See <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for more info.
[Attachment #8596522](/attachment.cgi?id=8596522&action=edit "ESR31 - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-esr31?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1087565#c19)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/2cb85f5cadab>Status: ASSIGNED → RESOLVEDClosed: 10 years ago
[status-firefox40](/buglist.cgi?f1=cf_status_firefox40&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla40

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1087565#c20)• 10 years ago |
|  | |

Is this a security issue for ESR31? I didn't think we had any sandboxing on that branch, but maybe there are NPAPI plugins doing their own sandboxing that could be escaped this way?

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1087565#c21)• 10 years ago |
|  | |

(In reply to Jed Davis [:jld] {UTC-7} from [comment #20](/show_bug.cgi?id=1087565#c20 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Is this a security issue for ESR31? I didn't think we had any sandboxing on
> that branch, but maybe there are NPAPI plugins doing their own sandboxing
> that could be escaped this way?
Well, we have the thumbnail content process.
So, in theory a compromised non-gecko low privileged process could impersonate that process.
Like I've said before, I'm not sure how easy that would be in reality or whether it would be able to do anything damaging.

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1087565#c22)• 10 years ago |
|  | |

Comment on [attachment 8596514](/attachment.cgi?id=8596514 "Aurora/Beta - Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8596514&action=diff "Aurora/Beta - Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596514)
Aurora/Beta - Verify the child process with a secret hello on Windows.
[Triage Comment]
Let's take it
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-release+
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-beta?
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-aurora?
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1087565#c23)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/78c576630fed>
[status-firefox39](/buglist.cgi?f1=cf_status_firefox39&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1087565#c24)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-release/rev/c1f04200ed98>
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected)
[status-b2g-v2.0M](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=unaffected)
[status-b2g-v2.1S](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=unaffected)
[status-b2g-v2.2](/buglist.cgi?f1=cf_status_b2g_2_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=unaffected)
[status-b2g-master](/buglist.cgi?f1=cf_status_b2g_master&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=unaffected)
[status-firefox38](/buglist.cgi?f1=cf_status_firefox38&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=fixed)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1087565#c25)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/c1f04200ed98>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16240681_75935)• 10 years ago |

[status-firefox38.0.5](/buglist.cgi?f1=cf_status_firefox38_0_5&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox38_0_5&o1=equals&v1=fixed)

|  | [Benjamin Kerensa [:bkerensa]](/user_profile?user_id=294742) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16762197_294742)• 10 years ago |

[Attachment #8596522](/attachment.cgi?id=8596522&action=edit "ESR31 - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-esr31? → approval-mozilla-esr31+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1087565#c26)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr31/rev/7f3854a8ddcf>
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16767191_1689)• 10 years ago |

Group: dom-core-security

|  | [[SV Manager] Florin Mezei, QA (:FlorinMezei)](/user_profile?user_id=500713) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1087565#c27)• 10 years ago |
|  | |

Is there a need for manually testing this fix? If yes, could you please provide some detailed steps on how to do it?Flags: needinfo?(bobowen.code)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1087565#c28)• 10 years ago |
|  | |

(In reply to Florin Mezei, QA (:FlorinMezei) from [comment #27](/show_bug.cgi?id=1087565#c27 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Is there a need for manually testing this fix? If yes, could you please
> provide some detailed steps on how to do it?
I'm not sure how you would go about testing this other than observing (using something like Process Explorer) that there is now a random secret number on the end of the channel ID in the command line.
If you managed to pause the child process (through debugging) before it connected to the named pipe and attempted to connect to the the named pipe (which is the channel ID without the extra "/<unique number>").
If you then don't send the correct Hello message (including the random secret) then it should fail.
In the Chromium bug, I think this was just a theoretical attack, it didn't have any PoC exploits.
The theory in the bug is that on Windows low privileged processes can enumerate named pipes and could potentially attempt to connect to them.Flags: needinfo?(bobowen.code)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1087565#c29)• 10 years ago |
|  | |

Who do I credit for this in our security advisory? You, Jed? Christoph? Both of you? Someone else? :-)Flags: needinfo?(jld)Whiteboard: [adv-main38+][adv-esr31.7+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16861444_280903)• 10 years ago |

Alias: CVE-2011-3079Summary: CVE-2011-3079: IPC Channel does not validate the listener. → IPC Channel does not validate the listener.

|  | [[SV Manager] Florin Mezei, QA (:FlorinMezei)](/user_profile?user_id=500713) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1087565#c30)• 10 years ago |
|  | |

I was able to verify this on Windows 7 x64, in Firefox ESR 31.7.0 and 38.0, using Process Explorer. The plugin-container.exe process displays "\<random number>" appended at the end of the "--channel" parameter in the Command Line field. This appended value does not show in an older build like 31.2.0 ESR.
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=verified)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=verified)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1087565#c31)• 10 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #29](/show_bug.cgi?id=1087565#c29 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Who do I credit for this in our security advisory? You, Jed? Christoph? Both
> of you? Someone else? :-)
I think it makes sense to credit both of us — cdiehl reported it to Mozilla originally, but the bug wasn't recognized as security-sensitive until I found it.Flags: needinfo?(jld) → needinfo?(cdiehl)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1087565#c32)• 10 years ago |
|  | |

That seems fair. I'll do that.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a18138874_368570)• 10 years ago |

Flags: needinfo?(cdiehl)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a27170278_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a53474315_1689)• 9 years ago |

Group: core-security-release

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a220837180_578488)• 3 years ago |

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---)
You need to [log in](/show_bug.cgi?id=1087565&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Owen (:bobowen)](/user_profile?user_id=458623)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_2cec426f_20250126_010551.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1497749)
* [XML](/show_bug.cgi?ctype=xml&id=1497749)

Closed
[Bug 1497749](/show_bug.cgi?id=1497749)
(CVE-2018-18505)

Opened 6 years ago
Closed 6 years ago

# IPC channels created via Endpoint passing don't authenticate the client

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

IPC channels created via Endpoint passing don't authenticate the client

## Categories

### (Core :: IPC, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=IPC#IPC)

IPC
▾

Core :: IPC
Core inter-process communication and IPDL system for communicating with and isolating sub-processes. Please file plugin-specific IPC bugs in Core: Plug-Ins and content-specific IPC bugs in Core: DOM: Content Processes.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=IPC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=IPC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=IPC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Windows

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla66

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) |
| firefox64 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix) |
| firefox65 | [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed) |
| firefox66 | [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 | 65+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox64 |  | wontfix |
| firefox65 | + | fixed |
| firefox66 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jld, Assigned: bobowen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8877ff082c9a902bbf383dc11c1aeffc?d=mm&size=40)  [bobowen](/user_profile?user_id=458623)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[fission-ipc](/show_bug.cgi?id=1484019 "NEW - [meta] Enforce Content Process Restrictions in IPC")

Dependency [tree](/showdependencytree.cgi?id=1497749&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1497749)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-priv-escalation, sec-high, Whiteboard: [post-critsmash-triage][adv-main65+][adv-esr60.5+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-18505

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main65+][adv-esr60.5+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [avaida](/user_profile?user_id=488993) | [qe-verify](#a6264690_488993 "6 years ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Get secret from channel ID when pipe handle passed.](/attachment.cgi?id=9028909)  [6 years ago](#c2)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   1.26 KB, patch | jld : [review+](#a4474230_462836 "6 years ago")  RyanVM : [approval-mozilla-beta+](#c9 "6 years ago")  RyanVM : [approval-mozilla-esr60+](#c9 "6 years ago")  abillings : [sec-approval+](#c5 "6 years ago") | [Details](/attachment.cgi?id=9028909&action=edit) | [Diff](/attachment.cgi?id=9028909&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1497749#c0)• 6 years ago |
|  | |

On Windows we implement IPC channels using named pipes: the server (parent) side creates a pipe and then the client (child) side connects to it by name.
[Bug 1087565](/show_bug.cgi?id=1087565 "RESOLVED FIXED - IPC Channel does not validate the listener.") / [CVE-2011-3079](https://www.cve.org/CVERecord?id=CVE-2011-3079) dealt with the possibility of a sandboxed process connecting to a channel meant for another process and impersonating it to achieve privilege escalation, by adding a 32-bit shared secret that the client must send to the server. (According to comments in the upstream patch, the pipe namespace can be enumerated even by low-privileged processes.)
However, this works correctly only for the initial channel created when the process is started; additional channels created by passing Endpoint instances over IPC don't do this.
The Endpoint-bound channels use a different ChannelImpl constructor ([1] vs. [2]); it behaves similarly in the client, but in the server it doesn't initialize the shared secret, which means[3] that it silently ignores the client's secret and doesn't verify it.
This may predate [bug 1223240](/show_bug.cgi?id=1223240 "RESOLVED FIXED - Make it easier to set up top-level protocols"), which added the Endpoint system: that ChannelImpl constructor goes back to [bug 564086](/show_bug.cgi?id=564086 "RESOLVED FIXED - IPDL: Offer a PFoo::Bridge(process1, process2) interface to open a new IPC channel between process1/process2") (part j in the patch series), and it's not in upstream Chromium, so this could be something that was overlooked during the crossport in [bug 1087565](/show_bug.cgi?id=1087565 "RESOLVED FIXED - IPC Channel does not validate the listener.").
I haven't constructed a proof-of-concept to verify this; I discovered it by accident while doing Try runs with extra logging to investigate [bug 1368036](/show_bug.cgi?id=1368036 "RESOLVED FIXED - Intermittent Windows TC TEST-UNEXPECTED-FAIL | leakcheck | tab process: missing output line for total leaks!"). It should be relatively easy to make the client send a bad secret (or none) for this type of channel, but I don't currently have a Windows development environment, and a patch like that probably shouldn't be pushed to a public repo like Try.
[1] <https://searchfox.org/mozilla-central/rev/80ac71c1c54af788b32e851192dfd2de2ec18e18/ipc/chromium/src/chrome/common/ipc_channel_win.cc#64-82>
[2] <https://searchfox.org/mozilla-central/rev/80ac71c1c54af788b32e851192dfd2de2ec18e18/ipc/chromium/src/chrome/common/ipc_channel_win.cc#48-62>
[3] <https://searchfox.org/mozilla-central/rev/80ac71c1c54af788b32e851192dfd2de2ec18e18/ipc/chromium/src/chrome/common/ipc_channel_win.cc#197>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a140686_1689)• 6 years ago |

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a1249933_279663)• 6 years ago |

Flags: needinfo?(bobowencode)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1497749#c1)• 6 years ago |
|  | |

I couldn't see where this was using the other constructor at first, but it's when the TransportDescriptor is opened at [1].
On the face of it this looks fairly easy to fix.
[1] <https://searchfox.org/mozilla-central/rev/e22c0d152060f4f8d4ca8904094f15f65a1b6f93/ipc/glue/Transport_win.cpp#82>Assignee: nobody → bobowencodeStatus: NEW → ASSIGNEDFlags: needinfo?(bobowencode)Priority: -- → P1

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1497749#c2)• 6 years ago |
|  | |

Attached patch

[Get secret from channel ID when pipe handle passed.](attachment.cgi?id=9028909&action=diff)
— [Details](attachment.cgi?id=9028909&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)

This gets the shared secret from the channel ID even when we don't need the pipe name.
I tested that it was checking the secret by incremening it, which caused the message from the NOTREACHED() after the secret check and killed the child.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: review?(jld)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a4474230_462836)• 6 years ago |

[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: review?(jld) → review+

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1497749#c3)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
[Security Approval Request]
How easily could an exploit be constructed based on the patch?: The issue that this was trying to address was a theoretical one in the original chromium bug, I don't think they had anything close to a PoC.
However I think it is relatively obvious from the patch what is being fixed, assuming you understand the original problem.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?: Yes
Which older supported branches are affected by this flaw?: All
If not all supported branches, which bug introduced the flaw?: None
Do you have backports for the affected branches?: Yes
If not, how different, hard to create, and risky will they be?:
How likely is this patch to cause regressions; how much testing does it need?: This code gets used for all channels set up through Endpoints, so just running firefox exercises it multiple times.
The change is very simple and once the shared secret is extracted from the channel ID it is checked by the same code used for the main channel.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: sec-approval?

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1497749#c4)• 6 years ago |
|  | |

If it matters for CVE assignment or release notes or something like that: what's going on here is that our original fix for [CVE-2011-3079](https://www.cve.org/CVERecord?id=CVE-2011-3079) was incomplete, because of how our fork had diverged from Chromium, and this corrects that.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1497749#c5)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
sec-approval+ for trunk. We'll want Beta and ESR60 patches made and nominated.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a5957141_280903)• 6 years ago |

[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix)
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected)
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[tracking-firefox65](/buglist.cgi?f1=cf_tracking_firefox65&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B)
[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1497749#c6)• 6 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/3d060df6e3258ed74b800c7ee0e89e001116f98d>

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1497749#c7)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
[Beta/Release Uplift Approval Request]
Feature/Bug causing the regression: Chromium IPC
User impact if declined: Theoretical attack on IPC pipes from already compromised process.
Is this code covered by automated tests?: Yes
Has the fix been verified in Nightly?: No
Needs manual test from QE?: No
If yes, steps to reproduce:
List of other uplifts needed: None
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): This code gets used for all channels set up through Endpoints, so just running firefox exercises it multiple times.
The change is very simple and once the shared secret is extracted from the channel ID it is checked by the same code used for the main channel.
String changes made/needed: None
[ESR Uplift Approval Request]
If this is not a sec:{high,crit} bug, please state case for ESR consideration: sec-high
User impact if declined: Theoretical attack on IPC pipes from already compromised process.
Fix Landed on Version: 66
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): This code gets used for all channels set up through Endpoints, so just running firefox exercises it multiple times.
The change is very simple and once the shared secret is extracted from the channel ID it is checked by the same code used for the main channel.
String or UUID changes made by this patch: NOne
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-esr60?
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-beta?

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1497749#c8)• 6 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/3d060df6e325>Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 6 years ago
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla66

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1497749#c9)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
[Triage Comment]
Hardens our IPC pipes in the event of a compromised content process. Approved for 65.0b6 and 60.5.0esr.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-esr60?
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-esr60+
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-beta?
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1497749#c10)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/a6d805438104>
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1497749#c11)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/f46f8873c19e>
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a6264690_488993)• 6 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a8653076_280903)• 6 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main65+][adv-esr60.5+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a9044186_280903)• 6 years ago |

Alias: CVE-2018-18505

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a26085774_1689)• 5 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1497749&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Owen (:bobowen)](/user_profile?user_id=458623)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_3e1c97f2_20250124_122355.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-01

## Security vulnerabilities fixed in Firefox 65

Announced
January 29, 2019
Impact
critical
Products
Firefox
Fixed in

* Firefox 65

#### [#CVE-2018-18500: Use-after-free parsing HTML5 stream](#CVE-2018-18500)

Reporter
Yaniv Frank with SophosLabs
Impact
critical
##### Description

A use-after-free vulnerability can occur while parsing an HTML5 stream in concert with custom HTML elements. This results in the stream parser object being freed while still in use, leading to a potentially exploitable crash.

##### References

* [Bug 1510114](https://bugzilla.mozilla.org/show_bug.cgi?id=1510114)

#### [#CVE-2018-18504: Memory corruption and out-of-bounds read of texture client buffer](#CVE-2018-18504)

Reporter
Markus Vervier of X41 D-SEC GmbH
Impact
high
##### Description

A crash and out-of-bounds read can occur when the buffer of a texture client is freed while it is still in use during graphic operations. This results in a potentially exploitable crash and the possibility of reading from the memory of the freed buffers.

##### References

* [Bug 1496413](https://bugzilla.mozilla.org/show_bug.cgi?id=1496413)

#### [#CVE-2018-18505: Privilege escalation through IPC channel messages](#CVE-2018-18505)

Reporter
Jed Davis
Impact
high
##### Description

An earlier fix for an Inter-process Communication (IPC) vulnerability, CVE-2011-3079, added authentication to communication between IPC endpoints and server parents during IPC process creation. This authentication is insufficient for channels created after the IPC process is started, leading to the authentication not being correctly applied to later channels. This could allow for a sandbox escape through IPC channels due to lack of message validation in the listener process.

##### References

* [Bug 1497749](https://bugzilla.mozilla.org/show_bug.cgi?id=1497749)
* [CVE-2011-3079](https://bugzilla.mozilla.org/show_bug.cgi?id=1087565)

#### [#CVE-2018-18503: Memory corruption with Audio Buffer](#CVE-2018-18503)

Reporter
Nils
Impact
moderate
##### Description

When JavaScript is used to create and manipulate an audio buffer, a potentially exploitable crash may occur because of a compartment mismatch in some situations.

##### References

* [Bug 1509442](https://bugzilla.mozilla.org/show_bug.cgi?id=1509442)

#### [#CVE-2018-18506: Proxy Auto-Configuration file can define localhost access to be proxied](#CVE-2018-18506)

Reporter
Jann Horn
Impact
moderate
##### Description

When proxy auto-detection is enabled, if a web server serves a Proxy Auto-Configuration (PAC) file or if a PAC file is loaded locally, this PAC file can specify that requests to the localhost are to be sent through the proxy to another server. This behavior is disallowed by default when a proxy is manually configured, but when enabled could allow for attacks on services and tools that bind to the localhost for networked behavior if they are accessed through browsing.

##### References

* [Bug 1503393](https://bugzilla.mozilla.org/show_bug.cgi?id=1503393)

#### [#CVE-2018-18502: Memory safety bugs fixed in Firefox 65](#CVE-2018-18502)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Arthur Iakab, Christoph Diehl, Christian Holler, Kalel, Emilio Cobos Álvarez, Cristina Coroiu, Noemi Erli, Natalia Csoregi, Julian Seward, Gary Kwong, Tyson Smith, Yaron Tausky, and Ronald Crane reported memory safety bugs present in Firefox 64. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 65](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1499426%2C1480090%2C1472990%2C1514762%2C1501482%2C1505887%2C1508102%2C1508618%2C1511580%2C1493497%2C1510145%2C1516289%2C1506798%2C1512758)

#### [#CVE-2018-18501: Memory safety bugs fixed in Firefox 65 and Firefox ESR 60.5](#CVE-2018-18501)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alex Gaynor, Christoph Diehl, Steven Crane, Jason Kratzer, Gary Kwong, and Christian Holler reported memory safety bugs present in Firefox 64 and Firefox ESR 60.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 65 and Firefox ESR 60.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1512450%2C1517542%2C1513201%2C1460619%2C1502871%2C1516738%2C1516514)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from usn.ubuntu.com_1b014408_20250124_122354.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3874-1: Firefox vulnerabilities

30 January 2019

Firefox could be made to crash or run programs as your login if it
opened a malicious website.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.10](/security/notices?release=cosmic)
* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)
* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [firefox](/security/cves?package=firefox) - Mozilla Open Source web browser

## Details

Multiple security issues were discovered in Firefox. If a user were

tricked in to opening a specially crafted website, an attacker could

potentially exploit these to cause a denial of service, gain additional

privileges by escaping the sandbox, or execute arbitrary code.

([CVE-2018-18500](/security/CVE-2018-18500), [CVE-2018-18501](/security/CVE-2018-18501), [CVE-2018-18502](/security/CVE-2018-18502), [CVE-2018-18503](/security/CVE-2018-18503),

[CVE-2018-18504](/security/CVE-2018-18504), [CVE-2018-18505](/security/CVE-2018-18505))

It was discovered that Firefox allowed PAC files to specify that requests

to localhost are sent through the proxy to another server. If proxy

auto-detection is enabled, an attacker could potentially exploit this to

conduct attacks on local services and tools. ([CVE-2018-18506](/security/CVE-2018-18506))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.10

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.18.10.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.18.10.1)

##### Ubuntu 18.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.18.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.18.04.1)

##### Ubuntu 16.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.16.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.16.04.1)

##### Ubuntu 14.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.14.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.14.04.1)

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* [CVE-2018-18500](/security/CVE-2018-18500)
* [CVE-2018-18501](/security/CVE-2018-18501)
* [CVE-2018-18502](/security/CVE-2018-18502)
* [CVE-2018-18503](/security/CVE-2018-18503)
* [CVE-2018-18504](/security/CVE-2018-18504)
* [CVE-2018-18505](/security/CVE-2018-18505)
* [CVE-2018-18506](/security/CVE-2018-18506)

## Related notices

* [USN-3897-1](/security/notices/USN-3897-1)
* [USN-3927-1](/security/notices/USN-3927-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page


