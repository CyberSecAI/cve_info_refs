=== Content from github.com_0370886b_20250124_185824.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAlchemyCMS%2Falchemy_cms%2Fblob%2F4.1-stable%2Fapp%2Fcontrollers%2Falchemy%2Fadmin%2Fbase_controller.rb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAlchemyCMS%2Falchemy_cms%2Fblob%2F4.1-stable%2Fapp%2Fcontrollers%2Falchemy%2Fadmin%2Fbase_controller.rb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AlchemyCMS%2Falchemy_cms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AlchemyCMS](/AlchemyCMS)
/
**[alchemy\_cms](/AlchemyCMS/alchemy_cms)**
Public

* [Notifications](/login?return_to=%2FAlchemyCMS%2Falchemy_cms) You must be signed in to change notification settings
* [Fork
  315](/login?return_to=%2FAlchemyCMS%2Falchemy_cms)
* [Star
   853](/login?return_to=%2FAlchemyCMS%2Falchemy_cms)

* [Code](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
* [Issues
  1](/AlchemyCMS/alchemy_cms/issues)
* [Pull requests
  4](/AlchemyCMS/alchemy_cms/pulls)
* [Discussions](/AlchemyCMS/alchemy_cms/discussions)
* [Actions](/AlchemyCMS/alchemy_cms/actions)
* [Security](/AlchemyCMS/alchemy_cms/security)
* [Insights](/AlchemyCMS/alchemy_cms/pulse)

Additional navigation options

* [Code](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
* [Issues](/AlchemyCMS/alchemy_cms/issues)
* [Pull requests](/AlchemyCMS/alchemy_cms/pulls)
* [Discussions](/AlchemyCMS/alchemy_cms/discussions)
* [Actions](/AlchemyCMS/alchemy_cms/actions)
* [Security](/AlchemyCMS/alchemy_cms/security)
* [Insights](/AlchemyCMS/alchemy_cms/pulse)

## Files

 4.1-stable
## Breadcrumbs

1. [alchemy\_cms](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
2. /[app](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app)
3. /[controllers](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers)
4. /[alchemy](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy)
5. /[admin](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy/admin)
/
# base\_controller.rb

Copy path Blame  Blame
## Latest commit

## History

[History](/AlchemyCMS/alchemy_cms/commits/4.1-stable/app/controllers/alchemy/admin/base_controller.rb)171 lines (146 loc) · 4.93 KB 4.1-stable
## Breadcrumbs

1. [alchemy\_cms](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
2. /[app](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app)
3. /[controllers](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers)
4. /[alchemy](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy)
5. /[admin](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy/admin)
/
# base\_controller.rb

Top
## File metadata and controls

* Code
* Blame

171 lines (146 loc) · 4.93 KB[Raw](https://github.com/AlchemyCMS/alchemy_cms/raw/refs/heads/4.1-stable/app/controllers/alchemy/admin/base_controller.rb)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171# frozen\_string\_literal: true
module Alchemy module Admin class BaseController < Alchemy::BaseController include Userstamp include Locale
 before\_action { enforce\_ssl if ssl\_required? && !request.ssl? } before\_action :load\_locked\_pages
 helper\_method :clipboard\_empty?, :trash\_empty?, :get\_clipboard, :is\_admin?, :options\_from\_params
 check\_authorization
 rescue\_from Exception do |exception| if exception.is\_a? CanCan::AccessDenied permission\_denied(exception) elsif raise\_exception? raise else exception\_handler(exception) end end
 layout :set\_layout
 def leave authorize! :leave, :alchemy\_admin render template: '/alchemy/admin/leave', layout: !request.xhr? end
 private
 # Disable layout rendering for xhr requests. def set\_layout request.xhr? ? false : 'alchemy/admin' end
 # Handles exceptions def exception\_handler(error) exception\_logger(error) show\_error\_notice(error) if defined?(Airbrake) notify\_airbrake(error) unless Rails.env.development? || Rails.env.test? end end
 # Displays an error notice in the Alchemy backend. def show\_error\_notice(error) @error = error # truncate the message, because very long error messages (i.e from mysql2) causes cookie overflow errors @notice = error.message[0..255] @trace = error.backtrace[0..50] if request.xhr? render action: "error\_notice" else render '500', status: 500 end end
 # Returns clipboard items for given category def get\_clipboard(category) session[:alchemy\_clipboard] ||= {} session[:alchemy\_clipboard][category.to\_s] ||= [] end
 # Checks if clipboard for given category is blank def clipboard\_empty?(category) get\_clipboard(category).blank? end
 def trash\_empty?(category) "alchemy/#{category.singularize}".classify.constantize.trashed.blank? end
 def set\_stamper if Alchemy.user\_class < ActiveRecord::Base Alchemy.user\_class.stamper = current\_alchemy\_user end end
 def reset\_stamper if Alchemy.user\_class < ActiveRecord::Base Alchemy.user\_class.reset\_stamper end end
 # Returns true if the current\_alchemy\_user (The logged-in Alchemy User) has the admin role. def is\_admin? return false if !current\_alchemy\_user current\_alchemy\_user.admin? end
 # Displays errors in a #errors div if any errors are present on the object. # Or redirects to the given redirect url. # # @param object [ActiveRecord::Base] # @param redirect\_url [String] # @param flash\_notice [String] # def render\_errors\_or\_redirect(object, redirect\_url, flash\_notice) if object.errors.empty? flash[:notice] = Alchemy.t(flash\_notice) do\_redirect\_to redirect\_url else render action: (params[:action] == 'update' ? 'edit' : 'new') end end
 def per\_page\_value\_for\_screen\_size Alchemy::Deprecation.warn("#per\_page\_value\_for\_screen\_size is deprecated, please use #items\_per\_page instead") return items\_per\_page if session[:screen\_size].blank? screen\_height = session[:screen\_size].split('x').last.to\_i (screen\_height / 50) - 12 end
 # Does redirects for html and js requests # def do\_redirect\_to(url\_or\_path) respond\_to do |format| format.js { @redirect\_url = url\_or\_path render :redirect } format.html { redirect\_to url\_or\_path } end end
 # Extracts options from params and permits all keys # # If no options are present it returns an empty parameters hash. # # @returns [ActionController::Parameters] def options\_from\_params @\_options\_from\_params ||= begin (params[:options] || ActionController::Parameters.new).permit! end end
 # This method decides if we want to raise an exception or not. # # I.e. in test environment. # def raise\_exception? Rails.env.test? || is\_page\_preview? end
 # Are we currently in the page edit mode page preview. def is\_page\_preview? controller\_path == 'alchemy/admin/pages' && action\_name == 'show' end
 def load\_locked\_pages @locked\_pages = Page.locked\_by(current\_alchemy\_user).order(:locked\_at) end
 # Returns the current site for admin controllers. # def current\_alchemy\_site @current\_alchemy\_site ||= begin site\_id = params[:site\_id] || session[:alchemy\_site\_id] site = Site.find\_by(id: site\_id) || super session[:alchemy\_site\_id] = site.id site end end end endend

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_08a9c6f6_20250124_185832.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAlchemyCMS%2Falchemy_cms%2Fblob%2F4.1-stable%2Fapp%2Fcontrollers%2Falchemy%2Fadmin%2Fresources_controller.rb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAlchemyCMS%2Falchemy_cms%2Fblob%2F4.1-stable%2Fapp%2Fcontrollers%2Falchemy%2Fadmin%2Fresources_controller.rb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AlchemyCMS%2Falchemy_cms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AlchemyCMS](/AlchemyCMS)
/
**[alchemy\_cms](/AlchemyCMS/alchemy_cms)**
Public

* [Notifications](/login?return_to=%2FAlchemyCMS%2Falchemy_cms) You must be signed in to change notification settings
* [Fork
  315](/login?return_to=%2FAlchemyCMS%2Falchemy_cms)
* [Star
   853](/login?return_to=%2FAlchemyCMS%2Falchemy_cms)

* [Code](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
* [Issues
  1](/AlchemyCMS/alchemy_cms/issues)
* [Pull requests
  4](/AlchemyCMS/alchemy_cms/pulls)
* [Discussions](/AlchemyCMS/alchemy_cms/discussions)
* [Actions](/AlchemyCMS/alchemy_cms/actions)
* [Security](/AlchemyCMS/alchemy_cms/security)
* [Insights](/AlchemyCMS/alchemy_cms/pulse)

Additional navigation options

* [Code](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
* [Issues](/AlchemyCMS/alchemy_cms/issues)
* [Pull requests](/AlchemyCMS/alchemy_cms/pulls)
* [Discussions](/AlchemyCMS/alchemy_cms/discussions)
* [Actions](/AlchemyCMS/alchemy_cms/actions)
* [Security](/AlchemyCMS/alchemy_cms/security)
* [Insights](/AlchemyCMS/alchemy_cms/pulse)

## Files

 4.1-stable
## Breadcrumbs

1. [alchemy\_cms](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
2. /[app](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app)
3. /[controllers](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers)
4. /[alchemy](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy)
5. /[admin](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy/admin)
/
# resources\_controller.rb

Copy path Blame  Blame
## Latest commit

## History

[History](/AlchemyCMS/alchemy_cms/commits/4.1-stable/app/controllers/alchemy/admin/resources_controller.rb)169 lines (139 loc) · 5.24 KB 4.1-stable
## Breadcrumbs

1. [alchemy\_cms](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
2. /[app](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app)
3. /[controllers](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers)
4. /[alchemy](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy)
5. /[admin](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy/admin)
/
# resources\_controller.rb

Top
## File metadata and controls

* Code
* Blame

169 lines (139 loc) · 5.24 KB[Raw](https://github.com/AlchemyCMS/alchemy_cms/raw/refs/heads/4.1-stable/app/controllers/alchemy/admin/resources_controller.rb)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169# frozen\_string\_literal: true
require 'csv'require 'alchemy/resource'require 'alchemy/resources\_helper'
module Alchemy module Admin class ResourcesController < Alchemy::Admin::BaseController COMMON\_SEARCH\_FILTER\_EXCLUDES = [:id, :utf8, :\_method, :\_, :format].freeze
 include Alchemy::ResourcesHelper
 helper Alchemy::ResourcesHelper, TagsHelper helper\_method :resource\_handler, :search\_filter\_params, :items\_per\_page, :items\_per\_page\_options
 before\_action :load\_resource, only: [:show, :edit, :update, :destroy]
 before\_action :authorize\_resource
 def index @query = resource\_handler.model.ransack(search\_filter\_params[:q]) items = @query.result
 if contains\_relations? items = items.includes(\*resource\_relations\_names) end
 if search\_filter\_params[:tagged\_with].present? items = items.tagged\_with(search\_filter\_params[:tagged\_with]) end
 if search\_filter\_params[:filter].present? items = items.public\_send(sanitized\_filter\_params) end
 respond\_to do |format| format.html { items = items.page(params[:page] || 1).per(items\_per\_page) instance\_variable\_set("@#{resource\_handler.resources\_name}", items) } format.csv { instance\_variable\_set("@#{resource\_handler.resources\_name}", items) } end end
 def new instance\_variable\_set("@#{resource\_handler.resource\_name}", resource\_handler.model.new) end
 def show render action: 'edit' end
 def edit; end
 def create instance\_variable\_set("@#{resource\_handler.resource\_name}", resource\_handler.model.new(resource\_params)) resource\_instance\_variable.save render\_errors\_or\_redirect( resource\_instance\_variable, resources\_path(resource\_instance\_variable.class, search\_filter\_params), flash\_notice\_for\_resource\_action ) end
 def update resource\_instance\_variable.update\_attributes(resource\_params) render\_errors\_or\_redirect( resource\_instance\_variable, resources\_path(resource\_instance\_variable.class, search\_filter\_params), flash\_notice\_for\_resource\_action ) end
 def destroy resource\_instance\_variable.destroy flash\_notice\_for\_resource\_action do\_redirect\_to resource\_url\_proxy.url\_for(search\_filter\_params.merge(action: 'index')) end
 def resource\_handler @\_resource\_handler ||= Alchemy::Resource.new(controller\_path, alchemy\_module) end
 protected
 # Returns a translated +flash[:notice]+. # The key should look like "Modelname successfully created|updated|destroyed." def flash\_notice\_for\_resource\_action(action = params[:action]) return if resource\_instance\_variable.errors.any? case action.to\_sym when :create verb = "created" when :update verb = "updated" when :destroy verb = "removed" end flash[:notice] = Alchemy.t("#{resource\_handler.resource\_name.classify} successfully #{verb}", default: Alchemy.t("Successfully #{verb}")) end
 def is\_alchemy\_module? !alchemy\_module.nil? && !alchemy\_module['engine\_name'].nil? end
 def alchemy\_module @alchemy\_module ||= module\_definition\_for(controller: params[:controller], action: 'index') end
 def load\_resource instance\_variable\_set("@#{resource\_handler.resource\_name}", resource\_handler.model.find(params[:id])) end
 def authorize\_resource authorize!(action\_name.to\_sym, resource\_instance\_variable || resource\_handler.model) end
 # Permits all parameters as default! # # THIS IS INSECURE! Although only signed in admin users can send requests anyway, but we should change this. # # Please define this method in your inheriting controller and set the parameters you want to permit. # # TODO: Hook this into authorization provider. # def resource\_params params.require(resource\_handler.namespaced\_resource\_name).permit! end
 def sanitized\_filter\_params resource\_model.alchemy\_resource\_filters.detect do |filter| filter == search\_filter\_params[:filter] end || :all end
 def search\_filter\_params @\_search\_filter\_params ||= params.except(\*COMMON\_SEARCH\_FILTER\_EXCLUDES).permit(\*common\_search\_filter\_includes).to\_h end
 def common\_search\_filter\_includes [ # contrary to Rails' documentation passing an empty hash to permit all keys does not work {options: options\_from\_params.keys}, {q: [ resource\_handler.search\_field\_name, :s ]}, :tagged\_with, :filter, :page, :per\_page ].freeze end
 def items\_per\_page cookies[:alchemy\_items\_per\_page] = params[:per\_page] || cookies[:alchemy\_items\_per\_page] || Alchemy::Config.get(:items\_per\_page) end
 def items\_per\_page\_options per\_page = Alchemy::Config.get(:items\_per\_page) [per\_page, per\_page \* 2, per\_page \* 4] end end endend

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from packetstormsecurity.com_6adffedc_20250124_185820.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from github.com_2873a95a_20250124_185828.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAlchemyCMS%2Falchemy_cms%2Fblob%2F4.1-stable%2Fapp%2Fcontrollers%2Falchemy%2Fadmin%2Fpictures_controller.rb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FAlchemyCMS%2Falchemy_cms%2Fblob%2F4.1-stable%2Fapp%2Fcontrollers%2Falchemy%2Fadmin%2Fpictures_controller.rb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=AlchemyCMS%2Falchemy_cms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[AlchemyCMS](/AlchemyCMS)
/
**[alchemy\_cms](/AlchemyCMS/alchemy_cms)**
Public

* [Notifications](/login?return_to=%2FAlchemyCMS%2Falchemy_cms) You must be signed in to change notification settings
* [Fork
  315](/login?return_to=%2FAlchemyCMS%2Falchemy_cms)
* [Star
   853](/login?return_to=%2FAlchemyCMS%2Falchemy_cms)

* [Code](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
* [Issues
  1](/AlchemyCMS/alchemy_cms/issues)
* [Pull requests
  4](/AlchemyCMS/alchemy_cms/pulls)
* [Discussions](/AlchemyCMS/alchemy_cms/discussions)
* [Actions](/AlchemyCMS/alchemy_cms/actions)
* [Security](/AlchemyCMS/alchemy_cms/security)
* [Insights](/AlchemyCMS/alchemy_cms/pulse)

Additional navigation options

* [Code](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
* [Issues](/AlchemyCMS/alchemy_cms/issues)
* [Pull requests](/AlchemyCMS/alchemy_cms/pulls)
* [Discussions](/AlchemyCMS/alchemy_cms/discussions)
* [Actions](/AlchemyCMS/alchemy_cms/actions)
* [Security](/AlchemyCMS/alchemy_cms/security)
* [Insights](/AlchemyCMS/alchemy_cms/pulse)

## Files

 4.1-stable
## Breadcrumbs

1. [alchemy\_cms](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
2. /[app](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app)
3. /[controllers](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers)
4. /[alchemy](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy)
5. /[admin](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy/admin)
/
# pictures\_controller.rb

Copy path Blame  Blame
## Latest commit

## History

[History](/AlchemyCMS/alchemy_cms/commits/4.1-stable/app/controllers/alchemy/admin/pictures_controller.rb)180 lines (157 loc) · 4.88 KB 4.1-stable
## Breadcrumbs

1. [alchemy\_cms](/AlchemyCMS/alchemy_cms/tree/4.1-stable)
2. /[app](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app)
3. /[controllers](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers)
4. /[alchemy](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy)
5. /[admin](/AlchemyCMS/alchemy_cms/tree/4.1-stable/app/controllers/alchemy/admin)
/
# pictures\_controller.rb

Top
## File metadata and controls

* Code
* Blame

180 lines (157 loc) · 4.88 KB[Raw](https://github.com/AlchemyCMS/alchemy_cms/raw/refs/heads/4.1-stable/app/controllers/alchemy/admin/pictures_controller.rb)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180# frozen\_string\_literal: true
module Alchemy module Admin class PicturesController < Alchemy::Admin::ResourcesController include UploaderResponses
 helper 'alchemy/admin/tags'
 before\_action :load\_resource, only: [:show, :edit, :update, :destroy, :info]
 authorize\_resource class: Alchemy::Picture
 def index @size = params[:size].present? ? params[:size] : 'medium' @query = Picture.ransack(search\_filter\_params[:q]) @pictures = Picture.search\_by( search\_filter\_params, @query, items\_per\_page )
 if in\_overlay? archive\_overlay end end
 def show @previous = @picture.previous(params) @next = @picture.next(params) @assignments = @picture.essence\_pictures.joins(content: {element: :page}) render action: 'show' end
 def create @picture = Picture.new(picture\_params) @picture.name = @picture.humanized\_name if @picture.save render successful\_uploader\_response(file: @picture) else render failed\_uploader\_response(file: @picture) end end
 def edit\_multiple @pictures = Picture.where(id: params[:picture\_ids]) @tags = @pictures.collect(&:tag\_list).flatten.uniq.join(', ') end
 def update if @picture.update(picture\_params) @message = { body: Alchemy.t(:picture\_updated\_successfully, name: @picture.name), type: 'notice' } else @message = { body: Alchemy.t(:picture\_update\_failed), type: 'error' } end render :update end
 def update\_multiple @pictures = Picture.find(params[:picture\_ids]) @pictures.each do |picture| picture.update\_name\_and\_tag\_list!(params) end flash[:notice] = Alchemy.t("Pictures updated successfully") redirect\_to\_index end
 def delete\_multiple if request.delete? && params[:picture\_ids].present? pictures = Picture.find(params[:picture\_ids]) names = [] not\_deletable = [] pictures.each do |picture| if picture.deletable? names << picture.name picture.destroy else not\_deletable << picture.name end end if not\_deletable.any? flash[:warn] = Alchemy.t( "These pictures could not be deleted, because they were in use", names: not\_deletable.to\_sentence ) else flash[:notice] = Alchemy.t("Pictures deleted successfully", names: names.to\_sentence) end else flash[:warn] = Alchemy.t("Could not delete Pictures") end rescue StandardError => e flash[:error] = e.message ensure redirect\_to\_index end
 def destroy name = @picture.name @picture.destroy flash[:notice] = Alchemy.t("Picture deleted successfully", name: name) rescue StandardError => e flash[:error] = e.message ensure redirect\_to\_index end
 def items\_per\_page if in\_overlay? case params[:size] when 'small' then 25 when 'large' then 4 else 9 end else cookies[:alchemy\_pictures\_per\_page] = params[:per\_page] || cookies[:alchemy\_pictures\_per\_page] || pictures\_per\_page\_for\_size(params[:size]) end end
 def items\_per\_page\_options per\_page = pictures\_per\_page\_for\_size(@size) [per\_page, per\_page \* 2, per\_page \* 4] end
 private
 def pictures\_per\_page\_for\_size(size) case size when 'small' then 60 when 'large' then 12 else 20 end end
 def in\_overlay? params[:element\_id].present? end
 def archive\_overlay @content = Content.select('id').find\_by(id: params[:content\_id]) @element = Element.select('id').find\_by(id: params[:element\_id])
 respond\_to do |format| format.html { render partial: 'archive\_overlay' } format.js { render action: 'archive\_overlay' } end end
 def redirect\_to\_index do\_redirect\_to admin\_pictures\_path(search\_filter\_params) end
 def search\_filter\_params @\_search\_filter\_params ||= params.except(\*COMMON\_SEARCH\_FILTER\_EXCLUDES + [:picture\_ids]).permit( \*common\_search\_filter\_includes + [ :size, :element\_id, :swap, :content\_id ] ) end
 def picture\_params params.require(:picture).permit(:image\_file, :upload\_hash, :name, :tag\_list) end end endend

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


