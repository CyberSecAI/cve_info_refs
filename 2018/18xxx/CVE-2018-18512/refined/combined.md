=== Content from bugzilla.mozilla.org_2cec426f_20250126_024417.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1497749)
* [XML](/show_bug.cgi?ctype=xml&id=1497749)

Closed
[Bug 1497749](/show_bug.cgi?id=1497749)
(CVE-2018-18505)

Opened 6 years ago
Closed 6 years ago

# IPC channels created via Endpoint passing don't authenticate the client

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

IPC channels created via Endpoint passing don't authenticate the client

## Categories

### (Core :: IPC, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=IPC#IPC)

IPC
▾

Core :: IPC
Core inter-process communication and IPDL system for communicating with and isolating sub-processes. Please file plugin-specific IPC bugs in Core: Plug-Ins and content-specific IPC bugs in Core: DOM: Content Processes.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=IPC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=IPC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=IPC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Windows

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla66

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr60 | [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) |
| firefox64 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix) |
| firefox65 | [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed) |
| firefox66 | [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 | 65+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox64 |  | wontfix |
| firefox65 | + | fixed |
| firefox66 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jld, Assigned: bobowen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8877ff082c9a902bbf383dc11c1aeffc?d=mm&size=40)  [bobowen](/user_profile?user_id=458623)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### (Blocks 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[fission-ipc](/show_bug.cgi?id=1484019 "NEW - [meta] Enforce Content Process Restrictions in IPC")

Dependency [tree](/showdependencytree.cgi?id=1497749&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1497749)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-priv-escalation, sec-high, Whiteboard: [post-critsmash-triage][adv-main65+][adv-esr60.5+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-18505

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main65+][adv-esr60.5+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [avaida](/user_profile?user_id=488993) | [qe-verify](#a6264690_488993 "6 years ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Get secret from channel ID when pipe handle passed.](/attachment.cgi?id=9028909)  [6 years ago](#c2)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   1.26 KB, patch | jld : [review+](#a4474230_462836 "6 years ago")  RyanVM : [approval-mozilla-beta+](#c9 "6 years ago")  RyanVM : [approval-mozilla-esr60+](#c9 "6 years ago")  abillings : [sec-approval+](#c5 "6 years ago") | [Details](/attachment.cgi?id=9028909&action=edit) | [Diff](/attachment.cgi?id=9028909&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1497749#c0)• 6 years ago |
|  | |

On Windows we implement IPC channels using named pipes: the server (parent) side creates a pipe and then the client (child) side connects to it by name.
[Bug 1087565](/show_bug.cgi?id=1087565 "RESOLVED FIXED - IPC Channel does not validate the listener.") / [CVE-2011-3079](https://www.cve.org/CVERecord?id=CVE-2011-3079) dealt with the possibility of a sandboxed process connecting to a channel meant for another process and impersonating it to achieve privilege escalation, by adding a 32-bit shared secret that the client must send to the server. (According to comments in the upstream patch, the pipe namespace can be enumerated even by low-privileged processes.)
However, this works correctly only for the initial channel created when the process is started; additional channels created by passing Endpoint instances over IPC don't do this.
The Endpoint-bound channels use a different ChannelImpl constructor ([1] vs. [2]); it behaves similarly in the client, but in the server it doesn't initialize the shared secret, which means[3] that it silently ignores the client's secret and doesn't verify it.
This may predate [bug 1223240](/show_bug.cgi?id=1223240 "RESOLVED FIXED - Make it easier to set up top-level protocols"), which added the Endpoint system: that ChannelImpl constructor goes back to [bug 564086](/show_bug.cgi?id=564086 "RESOLVED FIXED - IPDL: Offer a PFoo::Bridge(process1, process2) interface to open a new IPC channel between process1/process2") (part j in the patch series), and it's not in upstream Chromium, so this could be something that was overlooked during the crossport in [bug 1087565](/show_bug.cgi?id=1087565 "RESOLVED FIXED - IPC Channel does not validate the listener.").
I haven't constructed a proof-of-concept to verify this; I discovered it by accident while doing Try runs with extra logging to investigate [bug 1368036](/show_bug.cgi?id=1368036 "RESOLVED FIXED - Intermittent Windows TC TEST-UNEXPECTED-FAIL | leakcheck | tab process: missing output line for total leaks!"). It should be relatively easy to make the client send a bad secret (or none) for this type of channel, but I don't currently have a Windows development environment, and a patch like that probably shouldn't be pushed to a public repo like Try.
[1] <https://searchfox.org/mozilla-central/rev/80ac71c1c54af788b32e851192dfd2de2ec18e18/ipc/chromium/src/chrome/common/ipc_channel_win.cc#64-82>
[2] <https://searchfox.org/mozilla-central/rev/80ac71c1c54af788b32e851192dfd2de2ec18e18/ipc/chromium/src/chrome/common/ipc_channel_win.cc#48-62>
[3] <https://searchfox.org/mozilla-central/rev/80ac71c1c54af788b32e851192dfd2de2ec18e18/ipc/chromium/src/chrome/common/ipc_channel_win.cc#197>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a140686_1689)• 6 years ago |

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a1249933_279663)• 6 years ago |

Flags: needinfo?(bobowencode)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1497749#c1)• 6 years ago |
|  | |

I couldn't see where this was using the other constructor at first, but it's when the TransportDescriptor is opened at [1].
On the face of it this looks fairly easy to fix.
[1] <https://searchfox.org/mozilla-central/rev/e22c0d152060f4f8d4ca8904094f15f65a1b6f93/ipc/glue/Transport_win.cpp#82>Assignee: nobody → bobowencodeStatus: NEW → ASSIGNEDFlags: needinfo?(bobowencode)Priority: -- → P1

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1497749#c2)• 6 years ago |
|  | |

Attached patch

[Get secret from channel ID when pipe handle passed.](attachment.cgi?id=9028909&action=diff)
— [Details](attachment.cgi?id=9028909&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)

This gets the shared secret from the channel ID even when we don't need the pipe name.
I tested that it was checking the secret by incremening it, which caused the message from the NOTREACHED() after the secret check and killed the child.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: review?(jld)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a4474230_462836)• 6 years ago |

[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: review?(jld) → review+

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1497749#c3)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
[Security Approval Request]
How easily could an exploit be constructed based on the patch?: The issue that this was trying to address was a theoretical one in the original chromium bug, I don't think they had anything close to a PoC.
However I think it is relatively obvious from the patch what is being fixed, assuming you understand the original problem.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?: Yes
Which older supported branches are affected by this flaw?: All
If not all supported branches, which bug introduced the flaw?: None
Do you have backports for the affected branches?: Yes
If not, how different, hard to create, and risky will they be?:
How likely is this patch to cause regressions; how much testing does it need?: This code gets used for all channels set up through Endpoints, so just running firefox exercises it multiple times.
The change is very simple and once the shared secret is extracted from the channel ID it is checked by the same code used for the main channel.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: sec-approval?

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1497749#c4)• 6 years ago |
|  | |

If it matters for CVE assignment or release notes or something like that: what's going on here is that our original fix for [CVE-2011-3079](https://www.cve.org/CVERecord?id=CVE-2011-3079) was incomplete, because of how our fork had diverged from Chromium, and this corrects that.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1497749#c5)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
sec-approval+ for trunk. We'll want Beta and ESR60 patches made and nominated.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a5957141_280903)• 6 years ago |

[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix)
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected)
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[tracking-firefox65](/buglist.cgi?f1=cf_tracking_firefox65&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B)
[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1497749#c6)• 6 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/3d060df6e3258ed74b800c7ee0e89e001116f98d>

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1497749#c7)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
[Beta/Release Uplift Approval Request]
Feature/Bug causing the regression: Chromium IPC
User impact if declined: Theoretical attack on IPC pipes from already compromised process.
Is this code covered by automated tests?: Yes
Has the fix been verified in Nightly?: No
Needs manual test from QE?: No
If yes, steps to reproduce:
List of other uplifts needed: None
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): This code gets used for all channels set up through Endpoints, so just running firefox exercises it multiple times.
The change is very simple and once the shared secret is extracted from the channel ID it is checked by the same code used for the main channel.
String changes made/needed: None
[ESR Uplift Approval Request]
If this is not a sec:{high,crit} bug, please state case for ESR consideration: sec-high
User impact if declined: Theoretical attack on IPC pipes from already compromised process.
Fix Landed on Version: 66
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): This code gets used for all channels set up through Endpoints, so just running firefox exercises it multiple times.
The change is very simple and once the shared secret is extracted from the channel ID it is checked by the same code used for the main channel.
String or UUID changes made by this patch: NOne
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-esr60?
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-beta?

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1497749#c8)• 6 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/3d060df6e325>Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 6 years ago
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla66

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1497749#c9)• 6 years ago |
|  | |

Comment on [attachment 9028909](/attachment.cgi?id=9028909 "Get secret from channel ID when pipe handle passed.") [[details]](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") [[diff]](/attachment.cgi?id=9028909&action=diff "Get secret from channel ID when pipe handle passed.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1497749&attachment=9028909)
Get secret from channel ID when pipe handle passed.
[Triage Comment]
Hardens our IPC pipes in the event of a compromised content process. Approved for 65.0b6 and 60.5.0esr.
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-esr60?
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-esr60+
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-beta?
[Attachment #9028909](/attachment.cgi?id=9028909&action=edit "Get secret from channel ID when pipe handle passed.") -
Flags: approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1497749#c10)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/a6d805438104>
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1497749#c11)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/f46f8873c19e>
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a6264690_488993)• 6 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a8653076_280903)• 6 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main65+][adv-esr60.5+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a9044186_280903)• 6 years ago |

Alias: CVE-2018-18505

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1497749#a26085774_1689)• 5 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1497749&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Owen (:bobowen)](/user_profile?user_id=458623)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from wiki.mozilla.org_73f8d6fa_20250126_024420.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_3659d679_20250126_024420.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_e094cd2f_20250124_180521.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-03

## Security vulnerabilities fixed in Thunderbird 60.5

Announced
January 29, 2019
Impact
critical
Products
Thunderbird
Fixed in

* Thunderbird 60.5

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2018-18500: Use-after-free parsing HTML5 stream](#CVE-2018-18500)

Reporter
Yaniv Frank with SophosLabs
Impact
critical
##### Description

A use-after-free vulnerability can occur while parsing an HTML5 stream in concert with custom HTML elements. This results in the stream parser object being freed while still in use, leading to a potentially exploitable crash.

##### References

* [Bug 1510114](https://bugzilla.mozilla.org/show_bug.cgi?id=1510114)

#### [#CVE-2018-18505: Privilege escalation through IPC channel messages](#CVE-2018-18505)

Reporter
Jed Davis
Impact
high
##### Description

An earlier fix for an Inter-process Communication (IPC) vulnerability, CVE-2011-3079, added authentication to communication between IPC endpoints and server parents during IPC process creation. This authentication is insufficient for channels created after the IPC process is started, leading to the authentication not being correctly applied to later channels. This could allow for a sandbox escape through IPC channels due to lack of message validation in the listener process.

##### References

* [Bug 1497749](https://bugzilla.mozilla.org/show_bug.cgi?id=1497749)
* [CVE-2011-3079](https://bugzilla.mozilla.org/show_bug.cgi?id=1087565)

#### [#CVE-2018-18512: Use-after-free during sound notifications](#CVE-2018-18512)

Reporter
Wayne Mery
Impact
high
##### Description

A use-after-free vulnerability can occur while playing a sound notification in Thunderbird. The memory storing the sound data is immediately freed, although the sound is still being played asynchronously, leading to a potentially exploitable crash.

##### References

* [Bug 1482659](https://bugzilla.mozilla.org/show_bug.cgi?id=1482659)

#### [#CVE-2016-5824: DoS (use-after-free) via a crafted ics file](#CVE-2016-5824)

Reporter
Brandon Perry
Impact
low
##### Description

A vulnerability in the Libical libary used by Thunderbird can allow remote attackers to cause a denial of service (use-after-free) via a crafted ICS calendar file.

##### References

* [Bug 1275400](https://bugzilla.mozilla.org/show_bug.cgi?id=1275400)

#### [#CVE-2018-18513: DOS and crash with crafted S/MIME message or XPI package](#CVE-2018-18513)

Reporter
Hanno Böck, Damian Poddebniak
Impact
moderate
##### Description

A crash can occur when processing a crafted S/MIME message or an XPI package containing a crafted signature. This can be used as a denial-of-service (DOS) attack because Thunderbird reopens the last seen message on restart, triggering the crash again.

##### References

* [Bug 1533300](https://bugzilla.mozilla.org/show_bug.cgi?id=1533300)

#### [#CVE-2018-18501: Memory safety bugs fixed in Firefox 65, Firefox ESR 60.5, and Thunderbird 60.5](#CVE-2018-18501)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alex Gaynor, Christoph Diehl, Steven Crane, Jason Kratzer, Gary Kwong, and Christian Holler reported memory safety bugs present in Firefox 64, Firefox ESR 60.4, and Thunderbird 60.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 65, Firefox ESR 60.5, and Thunderbird 60.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1512450%2C1517542%2C1513201%2C1460619%2C1502871%2C1516738%2C1516514)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_9068bfd8_20250126_024419.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1087565)
* [XML](/show_bug.cgi?ctype=xml&id=1087565)

Closed
[Bug 1087565](/show_bug.cgi?id=1087565)
(CVE-2011-3079)

Opened 10 years ago
Closed 10 years ago

# IPC Channel does not validate the listener.

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

IPC Channel does not validate the listener.

## Categories

### (Core :: IPC, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=IPC#IPC)

IPC
▾

Core :: IPC
Core inter-process communication and IPDL system for communicating with and isolating sub-processes. Please file plugin-specific IPC bugs in Core: Plug-Ins and content-specific IPC bugs in Core: DOM: Content Processes.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=IPC&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=IPC&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=IPC)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla40

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox37 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox37&o1=equals&v1=wontfix) |
| firefox38 | [+](/buglist.cgi?f1=cf_tracking_firefox38&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=fixed) |
| firefox38.0.5 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox38_0_5&o1=equals&v1=fixed) |
| firefox39 | [+](/buglist.cgi?f1=cf_tracking_firefox39&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=fixed) |
| firefox40 | [+](/buglist.cgi?f1=cf_tracking_firefox40&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=fixed) |
| firefox-esr31 | [38+](/buglist.cgi?f1=cf_tracking_firefox_esr31&o1=equals&v1=38%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=verified) |
| firefox-esr38 | --- | [verified](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=verified) |
| b2g-v1.4 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected) |
| b2g-v2.0 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected) |
| b2g-v2.0M | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected) |
| b2g-v2.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=unaffected) |
| b2g-v2.1S | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=unaffected) |
| b2g-v2.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=unaffected) |
| b2g-master | --- | [unaffected](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| firefox37 |  | wontfix |
| firefox38 | + | fixed |
| firefox38.0.5 |  | fixed |
| firefox39 | + | fixed |
| firefox40 | + | fixed |
| firefox-esr31 | 38+ | verified |
| firefox-esr38 |  | verified |
| b2g-v1.4 |  | unaffected |
| b2g-v2.0 |  | unaffected |
| b2g-v2.0M |  | unaffected |
| b2g-v2.1 |  | unaffected |
| b2g-v2.1S |  | unaffected |
| b2g-v2.2 |  | unaffected |
| relnote-firefox |  | --- |
| b2g-master |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jld, Assigned: bobowen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8877ff082c9a902bbf383dc11c1aeffc?d=mm&size=40)  [bobowen](/user_profile?user_id=458623)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0e698ba5145076e93cadb50d6e22edcf?d=mm&size=40)  [jld](/user_profile?user_id=462836)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

24 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation"), [1156835](/show_bug.cgi?id=1156835 "RESOLVED FIXED - Investigate if the fix for bug 1087565 still has problems because of the use of the command line to pass the secret.")

Dependency [tree](/showdependencytree.cgi?id=1087565&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1087565)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [adv-main38+][adv-esr31.7+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2011-3079

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[sec-vector](/buglist.cgi?keywords=sec-vector&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main38+][adv-esr31.7+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c19 "10 years ago") | ? |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 1 obsolete file)

| [Verify the child process with a secret hello on Windows.](/attachment.cgi?id=8589804)  [10 years ago](#c6)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.28 KB, patch | dvander : [review+](#c11 "10 years ago") | [Details](/attachment.cgi?id=8589804&action=edit) | [Diff](/attachment.cgi?id=8589804&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804) |
| --- | --- | --- |
| [Verify the child process with a secret hello on Windows. v2](/attachment.cgi?id=8595453)  [10 years ago](#c12)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.47 KB, patch | dvander : [review+](#c13 "10 years ago")  abillings : [sec-approval+](#c15 "10 years ago") | [Details](/attachment.cgi?id=8595453&action=edit) | [Diff](/attachment.cgi?id=8595453&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453) |
| [Aurora/Beta - Verify the child process with a secret hello on Windows.](/attachment.cgi?id=8596514)  [10 years ago](#c17)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.57 KB, patch | Sylvestre : [approval-mozilla-aurora+](#c22 "10 years ago")  Sylvestre : [approval-mozilla-release+](#c22 "10 years ago") | [Details](/attachment.cgi?id=8596514&action=edit) | [Diff](/attachment.cgi?id=8596514&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596514) |
| [ESR31 - Verify the child process with a secret hello on Windows.](/attachment.cgi?id=8596522)  [10 years ago](#c18)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   21.80 KB, patch | bkerensa : [approval-mozilla-esr31+](#a16762197_294742 "10 years ago") | [Details](/attachment.cgi?id=8596522&action=edit) | [Diff](/attachment.cgi?id=8596522&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596522) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1087565#c0)• 10 years ago |
|  | |

We have have probably inherited [CVE-2011-3079](https://www.cve.org/CVERecord?id=CVE-2011-3079) from our import of Chromium's IPC code 5½ years ago.
My understanding of this bug is: Chromium IPC endpoints have names, and knowing the name is sufficient to connect to it. These names were predictable and, on Windows, are reflected in the named pipe namespace which an untrusted process can traverse. The patch adds 32 bits of randomness to each name, and excludes that part from the pipe name on Windows. (Anyone with more knowledge of IPC is invited to correct this summary if needed.)
There's also a patch on the bug which seems to not be directly related to the IPC issue itself, and has something to do with Windows security levels: <https://crbug.com/117627#c18>
+++ This bug was initially created as a clone of [Bug #958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation") +++
"IPC Channel does not validate the listener."
<http://code.google.com/p/chromium/issues/detail?id=117627>

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a231_462836)• 10 years ago |

Blocks: [958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation")No longer depends on: [958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a2257345_1689)• 10 years ago |

Group: dom-core-security

|  | [Ben Turner (not reading bugmail, use the needinfo flag!)](/user_profile?user_id=200444) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1087565#c1)• 10 years ago |
|  | |

But the attacker would still have to have a process running on the user's machine to do this, right?

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1087565#c2)• 10 years ago |
|  | |

(In reply to ben turner [:bent] (use the needinfo? flag!) from [comment #1](/show_bug.cgi?id=1087565#c1 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> But the attacker would still have to have a process running on the user's
> machine to do this, right?
Yes. The impact is privilege escalation from a compromised child process.

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1087565#c3)• 10 years ago |
|  | |

I started trying to see how hard this is to backport, and it's definitely not easy (even by the standards of hand-applied diffs set by the other children of [bug 958895](/show_bug.cgi?id=958895 "RESOLVED FIXED - [meta] Import upstream chromium security fixes into our IPC implementation")). IPC::Channel seems to have been nontrivially refactored between our fork and the upstream bug, at least for the Windows implementation, so I'm not even sure where some of the parts of the first patch should be applied without spending more time making sense of both copies. Other parts of it depend on parts of chromium/base that don't (or no longer) exist in our tree, so they'd have to be (re-)imported or replaced, but that's a more straightforward complication.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1087565#c4)• 10 years ago |
|  | |

I've been in and around this code recently and looking at their patches, I've convinced myself as to how to backport this.
So, I'll pick this one up.
Jed - from what I can tell this doesn't affect posix and their patches don't in effect change the posix implementation. So, I'm not sure this needs to block [bug 866876](/show_bug.cgi?id=866876 "RESOLVED INVALID - [TRACKER] B2G Gecko security").Assignee: nobody → bobowen.codeStatus: NEW → ASSIGNEDFlags: needinfo?(jld)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1087565#c5)• 10 years ago |
|  | |

(In reply to Bob Owen (:bobowen) from [comment #4](/show_bug.cgi?id=1087565#c4 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Jed - from what I can tell this doesn't affect posix and their patches don't
> in effect change the posix implementation. So, I'm not sure this needs to
> block [bug 866876](/show_bug.cgi?id=866876 "RESOLVED INVALID - [TRACKER] B2G Gecko security").
I've looked at the patches some more, and I think I agree — if I'm reading it correctly, the IPC hello message payload is just the pid on POSIX (and the fix here is to add a secret int for Windows only). It's a little confusing because of the references to “validated channels” and needing to generate random names even in the POSIX case. I'm still not as sure as I'd ideally like to be of what's going on with that.No longer blocks: [b2gGeckoSecurity](/show_bug.cgi?id=866876 "RESOLVED INVALID - [TRACKER] B2G Gecko security")Flags: needinfo?(jld)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1087565#c6)• 10 years ago |
|  | |

Attached patch

[Verify the child process with a secret hello on Windows.](attachment.cgi?id=8589804&action=diff) (obsolete)
— [Details](attachment.cgi?id=8589804&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)

This is basically a port of [1] to our much older (modified) branch of the code.
I've had to change a few things to get it to work.
For the other changes mentioned in the bug:
[2] doesn't apply to our version of the code
[3] is a sandboxing code change, which we already have
I'm afraid I completely forgot about be careful pushing sec bugs to try ... sorry:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=0279d3d18835>
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=bfb5eca57e57>
\* bobowen slaps his own wrists ... really hard
[1] [https://chromium.googlesource.com/chromium/src/+/5c41e6e1cd446c3b2bc0ed17e66dffbc76f7c650%5E!/](https://chromium.googlesource.com/chromium/src/%2B/5c41e6e1cd446c3b2bc0ed17e66dffbc76f7c650%5E%21/)
[2] [https://chromium.googlesource.com/chromium/src/+/0590878f77dd9d3791b936287db516a99d14efb0%5E!/](https://chromium.googlesource.com/chromium/src/%2B/0590878f77dd9d3791b936287db516a99d14efb0%5E%21/)
[3] [https://chromium.googlesource.com/chromium/src/+/48fae61b8a6c9b741f001d478c595b6c7c0af4d9%5E!/](https://chromium.googlesource.com/chromium/src/%2B/48fae61b8a6c9b741f001d478c595b6c7c0af4d9%5E%21/)
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1087565#c7)• 10 years ago |
|  | |

Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
Verify the child process with a secret hello on Windows.
Review of [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804):
-----------------------------------------------------------------
This looks fine, just some things that I'd like clarified or adjusted first.
::: ipc/chromium/src/chrome/common/ipc\_channel.h
@@ +137,5 @@
> + static std::wstring GenerateUniqueRandomChannelID();
> +
> + // Generates a channel ID that, if passed to the client as a shared secret,
> + // will validate that the client's authenticity. On platforms that do not
> + // require additional this is simply calls GenerateUniqueRandomChannelID().
nit: "do not require additional validation"
::: ipc/chromium/src/chrome/common/ipc\_channel\_win.cc
@@ +164,5 @@
> std::wostringstream ss;
> + ss << L"\\\\.\\pipe\\chrome.";
> +
> + // Prevent the shared secret from ending up in the pipe name.
> + size\_t index = channel\_id.find\_first\_of(L'\\');
This strikes me as a little hacky. It would be nicer if GenerateVerifiedChannelID returned some kind of struct or tuple of (id, secret) or (channel-id, safe-pipe-id) instead, and Channel was constructed with that.
@@ +172,5 @@
> + }
> + ss << channel\_id.substr(0, index - 1);
> + } else {
> + // This case is here to support predictable named pipes in tests.
> + if (secret) {
CreatePipe() is the only caller of PipeName() and it passes a valid |secret|. Is there a reason to check for null here and above?
@@ +226,5 @@
> + // Don't send the secret to the untrusted process, and don't send a secret
> + // if the value is zero (for IPC backwards compatability).
> + int32\_t secret = validate\_client\_ ? 0 : client\_secret\_;
> + if (!m->WriteInt(GetCurrentProcessId()) ||
> + (secret && !m->WriteUInt32(secret))) {
nit: brace on newline for multi-line |if|
Using validate\_client\_ here is a little confusing. Reads better as:
int32\_t secret = (mode == MODE\_CLIENT) ? client\_secret\_ : 0;
@@ +368,5 @@
> + // The Hello message contains the process id and a secret if we need
> + // to validate the client.
> + MessageIterator it = MessageIterator(m);
> + int32\_t claimed\_pid = it.NextInt();
> + if (validate\_client\_ && (it.NextInt() != client\_secret\_)) {
Assuming we get rid of validate\_client\_ this check, I think, would be:
if (mode == MODE\_SERVER &&
client\_secret\_ &&
(it.NextInt() != client\_secret\_))
{
::: ipc/chromium/src/chrome/common/ipc\_channel\_win.h
@@ +107,5 @@
> // implement Unsound\_NumQueuedMessages.
> size\_t output\_queue\_length\_;
>
> + // Determines if we should validate a client's secret on connection.
> + bool validate\_client\_;
It looks like we can drop this, since client\_secret\_ == 0 implies no validation. If for some reason we can't drop it, a name without "client" would be better (like "needs\_validation\_" or something).
@@ +112,5 @@
> + // This is a unique per-channel value used to authenticate the client end of
> + // a connection. If the value is non-zero, the client passes it in the hello
> + // and the host validates. (We don't send the zero value fto preserve IPC
> + // compatability with existing clients that don't validate the channel.)
> + int32\_t client\_secret\_;
The word "client" can get confusing in IPC. Would "shared\_secret\_" or "challenge\_secret\_" be better here?
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1087565#c8)• 10 years ago |
|  | |

I assume the way the shared secret makes its way to the child process in the first place is a command line argument to CreateProcess(). If that's the case, we should check that unprivileged processes can't query that information with NtQueryInformationProcess(). Or as a precaution we could zap the PEB command line memory after it's been consumed.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1087565#c9)• 10 years ago |
|  | |

Thanks for the review.
(In reply to David Anderson [:dvander] from [comment #8](/show_bug.cgi?id=1087565#c8 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> I assume the way the shared secret makes its way to the child process in the
> first place is a command line argument to CreateProcess(). If that's the
> case, we should check that unprivileged processes can't query that
> information with NtQueryInformationProcess(). Or as a precaution we could
> zap the PEB command line memory after it's been consumed.
Yeah, I wondered about that.
For what it's worth, I don't think that Chrome clears the command line memory at all and certainly you can still see the channel ID and secret in Process Explorer.
As another part of this bug fix they started using an untrusted integrity level on the renderers, I think to stop them from opening other low (or higher) integrity processes like their gpu process.
We can't use untrusted on the content process currently and I'm not clear what benefit that would give us at the moment anyway.
We use untrusted as the delayed integrity level for GMP processes.
I suppose the other risk (such as it is) is from other low privileged processes from using the pipe and impersonating a Gecko child process.
I'm not sure how easy it would be for them to determine and open a child process, steal the secret and then use their pipe.
I'm pretty new to all this IPC stuff, so it would be good for me to investigate it and see if clearing the secret or other measures would be useful.
I'm on PTO tomorrow and next week, so would you mind if I picked this up in a follow-up bug?
Although, I suspect I'm not going to get this landed before I go anyway. :)
(In reply to David Anderson [:dvander] from [comment #7](/show_bug.cgi?id=1087565#c7 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
> Verify the child process with a secret hello on Windows.
>
> Review of [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804):
> -----------------------------------------------------------------
>
> This looks fine, just some things that I'd like clarified or adjusted first.
In general I was trying to keep this as close to the chromium patch as possible, while not changing too much of our existing code.
Life is already made difficult by the fact that our chromium IPC code is so old and by the fact that we have modified it fairly heavily.
I was trying to not make matters worse, although maybe that's a lost cause. :-)
I've commented about the ones that aren't style / typos below.
If you still want the proposed changes I'll have to pick this up after my PTO.
> ::: ipc/chromium/src/chrome/common/ipc\_channel\_win.cc
> @@ +164,5 @@
> > std::wostringstream ss;
> > + ss << L"\\\\.\\pipe\\chrome.";
> > +
> > + // Prevent the shared secret from ending up in the pipe name.
> > + size\_t index = channel\_id.find\_first\_of(L'\\');
>
> This strikes me as a little hacky. It would be nicer if
> GenerateVerifiedChannelID returned some kind of struct or tuple of (id,
> secret) or (channel-id, safe-pipe-id) instead, and Channel was constructed
> with that.
I agree, I imagine that they were trying to prevent the patch from hitting too many areas of their code, but I'm only guessing.
It does seem a bit odd given that in their patch they've already changed to use a ChannelHandle, so should have been able to add this without too much pain.
In our case we would have to change the other parts that use channel id and we'd end up moving this parsing logic to where we read the command line parameter.
> @@ +172,5 @@
> > + }
> > + ss << channel\_id.substr(0, index - 1);
> > + } else {
> > + // This case is here to support predictable named pipes in tests.
> > + if (secret) {
>
> CreatePipe() is the only caller of PipeName() and it passes a valid
> |secret|. Is there a reason to check for null here and above?
There was another part of the code, that we don't have, that passes null.
Not entirely sure where they use that.
> @@ +226,5 @@
> > + // Don't send the secret to the untrusted process, and don't send a secret
> > + // if the value is zero (for IPC backwards compatability).
> > + int32\_t secret = validate\_client\_ ? 0 : client\_secret\_;
> > + if (!m->WriteInt(GetCurrentProcessId()) ||
> > + (secret && !m->WriteUInt32(secret))) {
>
> nit: brace on newline for multi-line |if|
>
> Using validate\_client\_ here is a little confusing. Reads better as:
>
> int32\_t secret = (mode == MODE\_CLIENT) ? client\_secret\_ : 0;
Yeah, I found this difficult to read, but I suppose it depends on whether the extra confusion of moving further away form their code is worth it.
I agree that this is clearer.
I think that other changes that didn't fit into our code would have made dropping validate\_client\_ altogether a little more difficult.
> @@ +112,5 @@
> > + // This is a unique per-channel value used to authenticate the client end of
> > + // a connection. If the value is non-zero, the client passes it in the hello
> > + // and the host validates. (We don't send the zero value fto preserve IPC
> > + // compatability with existing clients that don't validate the channel.)
> > + int32\_t client\_secret\_;
>
> The word "client" can get confusing in IPC. Would "shared\_secret\_" or
> "challenge\_secret\_" be better here?
I suppose it is the client side of the pipe, but I agree this can be confusing.
Our use of Parent and Child has confused me a bit it the past as well. :-)Flags: needinfo?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1087565#c10)• 10 years ago |
|  | |

(In reply to Bob Owen (:bobowen) (PTO 10-19 Apr) from [comment #9](/show_bug.cgi?id=1087565#c9 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> I'm on PTO tomorrow and next week, so would you mind if I picked this up in
> a follow-up bug?
> Although, I suspect I'm not going to get this landed before I go anyway. :)
Sure.
> In general I was trying to keep this as close to the chromium patch as
> possible, while not changing too much of our existing code.
Ah, I see. It doesn't bother me too much if we diverge from Chromium, since that ship sailed a long time ago. I would really like to see the word "client\_" changed and validate\_client\_ removed if possible, the other stuff I'll leave up to you.Flags: needinfo?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1087565#c11)• 10 years ago |
|  | |

Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
Verify the child process with a secret hello on Windows.
r=me conditional on follow-up fixes as noted
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Flags: review+

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a15626693_458623)• 10 years ago |

Blocks: [1156835](/show_bug.cgi?id=1156835 "RESOLVED FIXED - Investigate if the fix for bug 1087565 still has problems because of the use of the command line to pass the secret.")

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1087565#c12)• 10 years ago |
|  | |

Attached patch

[Verify the child process with a secret hello on Windows. v2](attachment.cgi?id=8595453&action=diff)
— [Details](attachment.cgi?id=8595453&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)

Re-addressing your original review.
r?ing again as things didn't quite work out as hoped in some cases.
Try push as things have shifted a bit:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=9bc7385353bd>
(In reply to David Anderson [:dvander] from [comment #8](/show_bug.cgi?id=1087565#c8 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> I assume the way the shared secret makes its way to the child process in the
> first place is a command line argument to CreateProcess(). If that's the
> case, we should check that unprivileged processes can't query that
> information with NtQueryInformationProcess(). Or as a precaution we could
> zap the PEB command line memory after it's been consumed.
[Bug 1156835](/show_bug.cgi?id=1156835 "RESOLVED FIXED - Investigate if the fix for bug 1087565 still has problems because of the use of the command line to pass the secret.") filed as a follow-up.
(In reply to David Anderson [:dvander] from [comment #7](/show_bug.cgi?id=1087565#c7 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Comment on [attachment 8589804](/attachment.cgi?id=8589804 "Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8589804&action=diff "Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8589804)
> > + // require additional this is simply calls GenerateUniqueRandomChannelID().
>
> nit: "do not require additional validation"
Fixed.
> ::: ipc/chromium/src/chrome/common/ipc\_channel\_win.cc
> @@ +164,5 @@
> > std::wostringstream ss;
> > + ss << L"\\\\.\\pipe\\chrome.";
> > +
> > + // Prevent the shared secret from ending up in the pipe name.
> > + size\_t index = channel\_id.find\_first\_of(L'\\');
>
> This strikes me as a little hacky. It would be nicer if
> GenerateVerifiedChannelID returned some kind of struct or tuple of (id,
> secret) or (channel-id, safe-pipe-id) instead, and Channel was constructed
> with that.
I left this as we would need this logic somewhere when we parsed the channel from the command line.
> @@ +172,5 @@
> > + }
> > + ss << channel\_id.substr(0, index - 1);
> > + } else {
> > + // This case is here to support predictable named pipes in tests.
> > + if (secret) {
>
> CreatePipe() is the only caller of PipeName() and it passes a valid
> |secret|. Is there a reason to check for null here and above?
Removed and added a MOZ\_ASSERT at the top of the function for safety.
> @@ +226,5 @@
> > + // Don't send the secret to the untrusted process, and don't send a secret
> > + // if the value is zero (for IPC backwards compatability).
> > + int32\_t secret = validate\_client\_ ? 0 : client\_secret\_;
> > + if (!m->WriteInt(GetCurrentProcessId()) ||
> > + (secret && !m->WriteUInt32(secret))) {
>
> nit: brace on newline for multi-line |if|
Fixed.
Is this in our style guide?
I don't remember it, but I think it is definitely clearer with the multi-lines.
> Using validate\_client\_ here is a little confusing. Reads better as:
>
> int32\_t secret = (mode == MODE\_CLIENT) ? client\_secret\_ : 0;
Unfortunately mode isn't available here or in the other place where we'd need it.
I could have added it as a member variable, but that seemed like a bigger change.
So, I've renamed validate\_client\_ to waiting\_for\_shared\_secret\_ and changed the comments, to hopefully make it clear what is going on here.
> @@ +368,5 @@
> > + // The Hello message contains the process id and a secret if we need
> > + // to validate the client.
> > + MessageIterator it = MessageIterator(m);
> > + int32\_t claimed\_pid = it.NextInt();
> > + if (validate\_client\_ && (it.NextInt() != client\_secret\_)) {
>
> Assuming we get rid of validate\_client\_ this check, I think, would be:
>
> if (mode == MODE\_SERVER &&
> client\_secret\_ &&
> (it.NextInt() != client\_secret\_))
> {
As above mode isn't available here.
I also made the comment clearer here (hopefully).
> ::: ipc/chromium/src/chrome/common/ipc\_channel\_win.h
> @@ +107,5 @@
> > // implement Unsound\_NumQueuedMessages.
> > size\_t output\_queue\_length\_;
> >
> > + // Determines if we should validate a client's secret on connection.
> > + bool validate\_client\_;
>
> It looks like we can drop this, since client\_secret\_ == 0 implies no
> validation. If for some reason we can't drop it, a name without "client"
> would be better (like "needs\_validation\_" or something).
This is now waiting\_for\_shared\_secret\_
> @@ +112,5 @@
> > + // This is a unique per-channel value used to authenticate the client end of
> > + // a connection. If the value is non-zero, the client passes it in the hello
> > + // and the host validates. (We don't send the zero value fto preserve IPC
> > + // compatability with existing clients that don't validate the channel.)
> > + int32\_t client\_secret\_;
>
> The word "client" can get confusing in IPC. Would "shared\_secret\_" or
> "challenge\_secret\_" be better here?
This is now shared\_secret\_
[Attachment #8589804](/attachment.cgi?id=8589804&action=edit "Verify the child process with a secret hello on Windows.") -
Attachment is obsolete: true
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: review?(dvander)

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1087565#c13)• 10 years ago |
|  | |

Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
Verify the child process with a secret hello on Windows. v2
Review of [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453):
-----------------------------------------------------------------
Looks good, thanks! re: style guide, not sure - it is for js/src. I haven't seen a situation where it looks worse.
::: ipc/chromium/src/chrome/common/ipc\_channel\_win.h
@@ +111,5 @@
>
> + // This is a unique per-channel value used to authenticate the client end of
> + // a connection. If the value is non-zero, the client passes it in the hello
> + // and the host validates. (We don't send the zero value to preserve IPC
> + // compatability with existing clients that don't validate the channel.)
nit: compatibility
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: review?(dvander) → review+

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1087565#c14)• 10 years ago |
|  | |

Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
Verify the child process with a secret hello on Windows. v2
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
You would need to have a compromised process on the machine already, so that you could run arbitrary code.
Even then, the most you could do is "impersonate" a gecko child process using the named pipe.
For what it's worth, the Chromium guys only marked this as medium severity.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
Yes, the comments make the issue clear.
Also, this is already a public bug as it is reported for Chromium.
Which older supported branches are affected by this flaw?
Since the Chromium IPC code landed, I think, so all.
However, I think we only started using it for real, when either GMP or the thumbnail generation started to be used.
If not all supported branches, which bug introduced the flaw?
n/a
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
Doesn't quite apply cleanly on Beta/Aurora (because of one of my own changes :-) ), but would be really easy to fix, if it were deemed necessary.
How likely is this patch to cause regressions; how much testing does it need?
Should be pretty safe and if it does cause regressions, they should be fairly obvious and widespread for e10s on Windows I think.
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1087565#c15)• 10 years ago |
|  | |

Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
Verify the child process with a secret hello on Windows. v2
sec-approval+ for trunk.
We'll want Aurora, Beta, and ESR31 patches for this created and nominated as well.
[Attachment #8595453](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a15718159_280903)• 10 years ago |

[status-firefox37](/buglist.cgi?f1=cf_status_firefox37&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox37&o1=equals&v1=wontfix)
[status-firefox38](/buglist.cgi?f1=cf_status_firefox38&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=affected)
[status-firefox39](/buglist.cgi?f1=cf_status_firefox39&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=affected)
[status-firefox40](/buglist.cgi?f1=cf_status_firefox40&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=affected)
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=affected)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected)
[tracking-firefox38](/buglist.cgi?f1=cf_tracking_firefox38&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox38&o1=equals&v1=%2B)
[tracking-firefox39](/buglist.cgi?f1=cf_tracking_firefox39&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox39&o1=equals&v1=%2B)
[tracking-firefox40](/buglist.cgi?f1=cf_tracking_firefox40&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox40&o1=equals&v1=%2B)
[tracking-firefox-esr31](/buglist.cgi?f1=cf_tracking_firefox_esr31&o1=isnotempty):
--- → [38+](/buglist.cgi?f1=cf_tracking_firefox_esr31&o1=equals&v1=38%2B)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1087565#c16)• 10 years ago |
|  | |

remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/2cb85f5cadab>
Thanks for the r+ and s-a+.
(In reply to David Anderson [:dvander] from [comment #13](/show_bug.cgi?id=1087565#c13 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Comment on [attachment 8595453](/attachment.cgi?id=8595453 "Verify the child process with a secret hello on Windows. v2") [[details]](/attachment.cgi?id=8595453&action=edit "Verify the child process with a secret hello on Windows. v2") [[diff]](/attachment.cgi?id=8595453&action=diff "Verify the child process with a secret hello on Windows. v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8595453)
> > + // compatability with existing clients that don't validate the channel.)
>
> nit: compatibility
Fixed before pushing, thanks.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1087565#c17)• 10 years ago |
|  | |

Attached patch

[Aurora/Beta - Verify the child process with a secret hello on Windows.](attachment.cgi?id=8596514&action=diff)
— [Details](attachment.cgi?id=8596514&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596514)

Minor rebase due to some surrounding context changes.
Approval Request Comment
[Feature/regressing bug #]:
The code would have been brought in with the first cut of Chromium IPC code back in June 2009.
[User impact if declined]:
In theory a compromised, but low privileged process would be able to impersonate a Gecko child process, possible achieving some privilege escalation through communication with the firefox.exe process.
[Describe test coverage new/current, TreeHerder]:
Child processes are tested through GMP/EME, e10s and (I believe) thumbnail generation tests.
[Risks and why]:
Medium-low - while not a trivial patch the idea behind it is simple. Any issues would hopefully be obvious as the code is involved with the IPC channel initialisation.
[String/UUID change made/needed]:
None.
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-beta?
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-aurora?

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1087565#c18)• 10 years ago |
|  | |

Attached patch

[ESR31 - Verify the child process with a secret hello on Windows.](attachment.cgi?id=8596522&action=diff)
— [Details](attachment.cgi?id=8596522&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596522)

Again mainly surrounding context changes, but also an old version of ipc/chromium/src/base/atomic\_sequence\_num.h existed.
It looks like this was removed some time after ESR31, as it wasn't being used, so I've just overwritten it with the new version.
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
sec-high
User impact if declined:
In theory a compromised, but low privileged process would be able to impersonate a Gecko child process, possible achieving some privilege escalation through communication with the firefox.exe process.
Fix Landed on Version:
Fx40
Risk to taking this patch (and alternatives if risky):
Medium-low - while not a trivial patch the idea behind it is simple. Any issues would hopefully be obvious as the code is involved with the IPC channel initialisation.
String or UUID changes made by this patch:
None
See <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for more info.
[Attachment #8596522](/attachment.cgi?id=8596522&action=edit "ESR31 - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-esr31?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1087565#c19)• 10 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/2cb85f5cadab>Status: ASSIGNED → RESOLVEDClosed: 10 years ago
[status-firefox40](/buglist.cgi?f1=cf_status_firefox40&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox40&o1=equals&v1=fixed)Flags: in-testsuite?Resolution: --- → FIXEDTarget Milestone: --- → mozilla40

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1087565#c20)• 10 years ago |
|  | |

Is this a security issue for ESR31? I didn't think we had any sandboxing on that branch, but maybe there are NPAPI plugins doing their own sandboxing that could be escaped this way?

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1087565#c21)• 10 years ago |
|  | |

(In reply to Jed Davis [:jld] {UTC-7} from [comment #20](/show_bug.cgi?id=1087565#c20 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Is this a security issue for ESR31? I didn't think we had any sandboxing on
> that branch, but maybe there are NPAPI plugins doing their own sandboxing
> that could be escaped this way?
Well, we have the thumbnail content process.
So, in theory a compromised non-gecko low privileged process could impersonate that process.
Like I've said before, I'm not sure how easy that would be in reality or whether it would be able to do anything damaging.

|  | [Sylvestre Ledru [:Sylvestre]](/user_profile?user_id=495955) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1087565#c22)• 10 years ago |
|  | |

Comment on [attachment 8596514](/attachment.cgi?id=8596514 "Aurora/Beta - Verify the child process with a secret hello on Windows.") [[details]](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") [[diff]](/attachment.cgi?id=8596514&action=diff "Aurora/Beta - Verify the child process with a secret hello on Windows.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1087565&attachment=8596514)
Aurora/Beta - Verify the child process with a secret hello on Windows.
[Triage Comment]
Let's take it
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-release+
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-beta?
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-aurora?
[Attachment #8596514](/attachment.cgi?id=8596514&action=edit "Aurora/Beta - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-aurora+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1087565#c23)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-aurora/rev/78c576630fed>
[status-firefox39](/buglist.cgi?f1=cf_status_firefox39&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox39&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1087565#c24)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-release/rev/c1f04200ed98>
[status-b2g-v1.4](/buglist.cgi?f1=cf_status_b2g_1_4&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_1_4&o1=equals&v1=unaffected)
[status-b2g-v2.0](/buglist.cgi?f1=cf_status_b2g_2_0&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0&o1=equals&v1=unaffected)
[status-b2g-v2.0M](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_0m&o1=equals&v1=unaffected)
[status-b2g-v2.1](/buglist.cgi?f1=cf_status_b2g_2_1&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1&o1=equals&v1=unaffected)
[status-b2g-v2.1S](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_1_s&o1=equals&v1=unaffected)
[status-b2g-v2.2](/buglist.cgi?f1=cf_status_b2g_2_2&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_2_2&o1=equals&v1=unaffected)
[status-b2g-master](/buglist.cgi?f1=cf_status_b2g_master&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_b2g_master&o1=equals&v1=unaffected)
[status-firefox38](/buglist.cgi?f1=cf_status_firefox38&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox38&o1=equals&v1=fixed)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1087565#c25)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/c1f04200ed98>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16240681_75935)• 10 years ago |

[status-firefox38.0.5](/buglist.cgi?f1=cf_status_firefox38_0_5&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox38_0_5&o1=equals&v1=fixed)

|  | [Benjamin Kerensa [:bkerensa]](/user_profile?user_id=294742) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16762197_294742)• 10 years ago |

[Attachment #8596522](/attachment.cgi?id=8596522&action=edit "ESR31 - Verify the child process with a secret hello on Windows.") -
Flags: approval-mozilla-esr31? → approval-mozilla-esr31+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1087565#c26)• 10 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-esr31/rev/7f3854a8ddcf>
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16767191_1689)• 10 years ago |

Group: dom-core-security

|  | [[SV Manager] Florin Mezei, QA (:FlorinMezei)](/user_profile?user_id=500713) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1087565#c27)• 10 years ago |
|  | |

Is there a need for manually testing this fix? If yes, could you please provide some detailed steps on how to do it?Flags: needinfo?(bobowen.code)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1087565#c28)• 10 years ago |
|  | |

(In reply to Florin Mezei, QA (:FlorinMezei) from [comment #27](/show_bug.cgi?id=1087565#c27 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Is there a need for manually testing this fix? If yes, could you please
> provide some detailed steps on how to do it?
I'm not sure how you would go about testing this other than observing (using something like Process Explorer) that there is now a random secret number on the end of the channel ID in the command line.
If you managed to pause the child process (through debugging) before it connected to the named pipe and attempted to connect to the the named pipe (which is the channel ID without the extra "/<unique number>").
If you then don't send the correct Hello message (including the random secret) then it should fail.
In the Chromium bug, I think this was just a theoretical attack, it didn't have any PoC exploits.
The theory in the bug is that on Windows low privileged processes can enumerate named pipes and could potentially attempt to connect to them.Flags: needinfo?(bobowen.code)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1087565#c29)• 10 years ago |
|  | |

Who do I credit for this in our security advisory? You, Jed? Christoph? Both of you? Someone else? :-)Flags: needinfo?(jld)Whiteboard: [adv-main38+][adv-esr31.7+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a16861444_280903)• 10 years ago |

Alias: CVE-2011-3079Summary: CVE-2011-3079: IPC Channel does not validate the listener. → IPC Channel does not validate the listener.

|  | [[SV Manager] Florin Mezei, QA (:FlorinMezei)](/user_profile?user_id=500713) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1087565#c30)• 10 years ago |
|  | |

I was able to verify this on Windows 7 x64, in Firefox ESR 31.7.0 and 38.0, using Process Explorer. The plugin-container.exe process displays "\<random number>" appended at the end of the "--channel" parameter in the Command Line field. This appended value does not show in an older build like 31.2.0 ESR.
[status-firefox-esr31](/buglist.cgi?f1=cf_status_firefox_esr31&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr31&o1=equals&v1=verified)
[status-firefox-esr38](/buglist.cgi?f1=cf_status_firefox_esr38&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr38&o1=equals&v1=verified)

|  | [Jed Davis [:jld] ⟨⏰|UTC-8⟩ ⟦he/him⟧](/user_profile?user_id=462836)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1087565#c31)• 10 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #29](/show_bug.cgi?id=1087565#c29 "RESOLVED FIXED - IPC Channel does not validate the listener."))
> Who do I credit for this in our security advisory? You, Jed? Christoph? Both
> of you? Someone else? :-)
I think it makes sense to credit both of us — cdiehl reported it to Mozilla originally, but the bug wasn't recognized as security-sensitive until I found it.Flags: needinfo?(jld) → needinfo?(cdiehl)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1087565#c32)• 10 years ago |
|  | |

That seems fair. I'll do that.

|  | [Christoph Diehl [:posidron]](/user_profile?user_id=368570) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a18138874_368570)• 10 years ago |

Flags: needinfo?(cdiehl)

|  | [BMO Automation](/user_profile?user_id=546015) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a27170278_546015)• 9 years ago |

Group: core-security → core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a53474315_1689)• 9 years ago |

Group: core-security-release

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1087565#a220837180_578488)• 3 years ago |

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---)
You need to [log in](/show_bug.cgi?id=1087565&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Bob Owen (:bobowen)](/user_profile?user_id=458623)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_76a650cf_20250124_180519.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1482659)
* [XML](/show_bug.cgi?ctype=xml&id=1482659)

Closed
[Bug 1482659](/show_bug.cgi?id=1482659)
(CVE-2018-18512)

Opened 6 years ago
Closed 6 years ago

# startup crash in soundInitWavHdr playing sound file for new mail

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

startup crash in soundInitWavHdr playing sound file for new mail

## Categories

### (Core :: Widget: Win32, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Widget%3A%20Win32#Widget%3A%20Win32)

Widget: Win32
▾

Core :: Widget: Win32
Mapping of cross platform widget interfaces to Win32 platform APIs.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Widget%3A%20Win32)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla66

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| thunderbird\_esr60 | [+](/buglist.cgi?f1=cf_tracking_thunderbird_esr60&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr60&o1=equals&v1=fixed) |
| firefox-esr60 | [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) |
| firefox63 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=wontfix) |
| firefox64 | [+](/buglist.cgi?f1=cf_tracking_firefox64&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix) |
| firefox65 | [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed) |
| firefox66 | [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr60 | + | fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 | 65+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox63 |  | wontfix |
| firefox64 | + | wontfix |
| firefox65 | + | fixed |
| firefox66 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: wsmwk, Assigned: tnguyen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/5ccdceb82585a45b9a1af19a95517e69?d=mm&size=40)  [tnguyen](/user_profile?user_id=550180)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/976cc55d51282c1c46821f8451605062?d=mm&size=40)  [wsmwk](/user_profile?user_id=29811)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/605ee8cd1c9a74704916c7bdc4e4865d?d=mm&size=40)  [rkraesig](/user_profile?user_id=699639)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

27 people

## References

### ( [URL](https://support.mozilla.org/en-US/questions/1236833 "https://support.mozilla.org/en-US/questions/1236833") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[1401678](/show_bug.cgi?id=1401678 "VERIFIED FIXED - [e10s] No sound alert when using Find in page (accessibility.typeaheadfind.enablesound)"), [1495799](/show_bug.cgi?id=1495799 "RESOLVED FIXED - Crash in CWaveQueue::AddToTail playing custom sound when getting new mail/messages")

[1363163](/show_bug.cgi?id=1363163 "RESOLVED FIXED - nsSoundPlayer::SoundReleaser::Run should not add to existing jank")

Dependency [tree](/showdependencytree.cgi?id=1482659&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1482659)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1498494](/show_bug.cgi?id=1498494 "RESOLVED DUPLICATE - Crash when some new mail wav sound file try to play"), [1512798](/show_bug.cgi?id=1512798 "RESOLVED DUPLICATE - Thunderbird closed automatically when Lightning notice calendar is displayed"), [1515028](/show_bug.cgi?id=1515028 "RESOLVED DUPLICATE - V60.3.3 crashes directly upon new mail received")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[support.mozilla.org/en-US/questions/1...](https://support.mozilla.org/en-US/questions/1236833 "https://support.mozilla.org/en-US/questions/1236833")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (7 keywords, Whiteboard: [startupcrash][tbird topcrash][regression: TB60][post-critsmash-triage][adv-esr60.5+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-18512

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[topcrash-thunderbird](/buglist.cgi?keywords=topcrash-thunderbird&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[startupcrash][tbird topcrash][regression: TB60][post-critsmash-triage][adv-esr60.5+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [bmaris](/user_profile?user_id=458188) | [qe-verify](#a13707768_458188 "6 years ago") | - |
| --- | --- | --- |
| [bmaris](/user_profile?user_id=458188) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

[[@ soundInitWavHdr ]](https://crash-stats.mozilla.org/signature/?signature=soundInitWavHdr)

[[@ memcpy | soundInitWavHdr ]](https://crash-stats.mozilla.org/signature/?signature=memcpy%20%7C%20soundInitWavHdr)

[[@ CWaveQueue::AddToTail ]](https://crash-stats.mozilla.org/signature/?signature=CWaveQueue%3A%3AAddToTail)

[[@ CWaveHandle::AddHeader ]](https://crash-stats.mozilla.org/signature/?signature=CWaveHandle%3A%3AAddHeader)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Hawaii 50 2010.wav](/attachment.cgi?id=9023834)  [6 years ago](#c17)  [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)   5.06 MB, audio/wav |  | [Details](/attachment.cgi?id=9023834&action=edit) |
| --- | --- | --- |
| [Bug 1482659 - Purge the last sound, free then start to play a sound](/attachment.cgi?id=9031434)  [6 years ago](#c38)  [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)   47 bytes, text/x-phabricator-request | abillings : [approval-mozilla-beta+](#c57 "6 years ago")  abillings : [approval-mozilla-esr60+](#c57 "6 years ago")  abillings : [sec-approval+](#c57 "6 years ago") | [Details](/attachment.cgi?id=9031434&action=edit) | [Review](/attachment.cgi?id=9031434) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1482659#c0)• 6 years ago |
|  | |

For reasons unknown, this is has gone from obsurity in 52.x (almost zero crashes), to #3 crash for 60.0 - visually seen in the graph <https://crash-stats.mozilla.com/signature/?product=Thunderbird&signature=soundInitWavHdr&date=%3E%3D2018-05-11T10%3A52%3A28.000Z&date=%3C2018-08-11T10%3A52%3A28.000Z&_columns=date&_columns=product&_columns=version&_columns=build_id&_columns=platform&_columns=reason&_columns=address&_columns=install_time&_sort=-date&page=1#summary> which also shows this as a startup crash
This bug was filed from the Socorro interface and is
report [bp-19d63b14-ab22-4b0d-ad96-156eb0180808](https://crash-stats.mozilla.org/report/index/19d63b14-ab22-4b0d-ad96-156eb0180808).
=============================================================
Top 10 frames of crashing thread:
0 winmm.dll soundInitWavHdr
1 winmm.dll soundLoadMemory
2 winmm.dll \_EH\_prolog3\_catch\_GS
3 winmm.dll mmWndProc
4 user32.dll \_InternalCallWinProc
5 user32.dll UserCallWinProcCheckWow
6 user32.dll DispatchMessageWorker
7 user32.dll DispatchMessageA
8 winmm.dll mciwindow
9 kernel32.dll BaseThreadInitThunk
=============================================================

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1482659#c1)• 6 years ago |
|  | |

I haven't checked to see whether this is seen in nightly builds
[status-thunderbird60](/buglist.cgi?f1=cf_status_thunderbird_60&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_thunderbird_60&o1=equals&v1=wontfix)
[status-thunderbird\_esr60](/buglist.cgi?f1=cf_status_thunderbird_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_esr60&o1=equals&v1=affected)
[tracking-thunderbird\_esr60](/buglist.cgi?f1=cf_tracking_thunderbird_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_thunderbird_esr60&o1=equals&v1=%3F)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1482659#c2)• 6 years ago |
|  | |

90% of crashes version 60. Not a single nightly crash.
60% windows 10.
Average user who crashes, has this crash sig about 6 times according to <https://crash-stats.mozilla.com/topcrashers/?product=Thunderbird&version=60.0>
Uptick started ~March 19 <https://crash-stats.mozilla.com/signature/?signature=soundInitWavHdr&date=%3E%3D2017-12-01T10%3A21%3A00.000Z&date=%3C2018-03-28T13%3A21%3A00.000Z#graphs>
initially affecting 59.0b2
[bp-1a5b803d-25eb-4df8-83cc-7a3dd0180316](https://crash-stats.mozilla.org/report/index/1a5b803d-25eb-4df8-83cc-7a3dd0180316) 2018-03-16 11:36:04 59.0b2 20180228045324
[bp-0e1f244b-11e3-4e71-9775-875f90180317](https://crash-stats.mozilla.org/report/index/0e1f244b-11e3-4e71-9775-875f90180317) 2018-03-17 15:03:25 59.0b2 20180228045324
[bp-9e713b75-8497-4994-aa73-9e8eb0180318](https://crash-stats.mozilla.org/report/index/9e713b75-8497-4994-aa73-9e8eb0180318) 2018-03-18 20:19:27 59.0b2 20180228045324
[bp-6d5aa79d-dcc5-441d-a7e3-d17f90180319](https://crash-stats.mozilla.org/report/index/6d5aa79d-dcc5-441d-a7e3-d17f90180319) 2018-03-19 02:37:15 59.0b2 20180228045324
[bp-e6876d1a-ed15-4f77-8c02-16fe60180319](https://crash-stats.mozilla.org/report/index/e6876d1a-ed15-4f77-8c02-16fe60180319) 2018-03-19 11:48:30 59.0b2 20180228045324
[bp-40d26fe7-6b61-4e72-93c3-0be460180319](https://crash-stats.mozilla.org/report/index/40d26fe7-6b61-4e72-93c3-0be460180319) 2018-03-19 12:41:01 59.0b2 20180228045324
[bp-5ebdf56a-1bd1-4923-aeb2-b23ee0180319](https://crash-stats.mozilla.org/report/index/5ebdf56a-1bd1-4923-aeb2-b23ee0180319) 2018-03-19 15:23:58 59.0b2 20180228045324
[bp-707bb4f2-62de-42d0-abbc-8a5a30180319](https://crash-stats.mozilla.org/report/index/707bb4f2-62de-42d0-abbc-8a5a30180319) 2018-03-19 17:10:25 59.0b2 20180228045324Flags: needinfo?(m\_kato)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1482659#c3)• 6 years ago |
|  | |

(In reply to Wayne Mery (:wsmwk) from [comment #2](/show_bug.cgi?id=1482659#c2 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> 90% of crashes version 60. Not a single nightly crash.
> 60% windows 10.
> Average user who crashes, has this crash sig about 6 times according to
> <https://crash-stats.mozilla.com/topcrashers/?product=Thunderbird&version=60.0>
It seems to be buffer overrun since all address is over page boundary.
> Uptick started ~March 19
> <https://crash-stats.mozilla.com/signature/>
> ?signature=soundInitWavHdr&date=%3E%3D2017-12-01T10%3A21%3A00.
> 000Z&date=%3C2018-03-28T13%3A21%3A00.000Z#graphs
> initially affecting 59.0b2
If this is generic issue, it will occur on Firefox, but no crash on Firefox. So I think that this depends on sound file (wav?) . Does Thunderbird (or c-c-) change sound find such as mail biff?Flags: needinfo?(m\_kato)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1482659#c4)• 6 years ago |
|  | |

Right there are no FIrefox crashes and we do you sound for biff.
I'd assume the cause to be Windows, except the strong Thunderbird connection plus it started.
I was wrong about no nightly crashes
[bp-9d206d81-a855-4cb3-b2c9-0d3420180112](https://crash-stats.mozilla.org/report/index/9d206d81-a855-4cb3-b2c9-0d3420180112) 59.0a1
[bp-5bd2ea09-184d-44bf-b5bb-fac0d0180213](https://crash-stats.mozilla.org/report/index/5bd2ea09-184d-44bf-b5bb-fac0d0180213) 57.0a1

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1482659#c5)• 6 years ago |
|  | |

CWaveQueue::AddToTail [bp-3ae7c5f7-6276-4bf1-851a-1852a0180821](https://crash-stats.mozilla.org/report/index/3ae7c5f7-6276-4bf1-851a-1852a0180821) is the same?
#10 crash for 60.0, is all win7, and started in the 56 beta time period like [bp-eede566f-5542-4a76-9857-44e740180822](https://crash-stats.mozilla.org/report/index/eede566f-5542-4a76-9857-44e740180822)
CWaveHandle::AddHeader is #31 crash, all win10 - [bp-0183b6c7-2e66-4a9d-895a-7cb0a0180823](https://crash-stats.mozilla.org/report/index/0183b6c7-2e66-4a9d-895a-7cb0a0180823)Flags: needinfo?(m\_kato)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1482659#c6)• 6 years ago |
|  | |

(In reply to Wayne Mery (:wsmwk) from [comment #5](/show_bug.cgi?id=1482659#c5 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> CWaveQueue::AddToTail [bp-3ae7c5f7-6276-4bf1-851a-1852a0180821](https://crash-stats.mozilla.org/report/index/3ae7c5f7-6276-4bf1-851a-1852a0180821) is the same?
> #10 crash for 60.0, is all win7, and started in the 56 beta time period like
> [bp-eede566f-5542-4a76-9857-44e740180822](https://crash-stats.mozilla.org/report/index/eede566f-5542-4a76-9857-44e740180822)
>
> CWaveHandle::AddHeader is #31 crash, all win10 -
> [bp-0183b6c7-2e66-4a9d-895a-7cb0a0180823](https://crash-stats.mozilla.org/report/index/0183b6c7-2e66-4a9d-895a-7cb0a0180823)
I think no. It seems that sound file is corrupted, heap allocation failure, or a bug of microsoft's code, but I don't know why.Flags: needinfo?(m\_kato)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a4484917_29811)• 6 years ago |

See Also: → [1495799](/show_bug.cgi?id=1495799 "RESOLVED FIXED - Crash in CWaveQueue::AddToTail playing custom sound when getting new mail/messages")

|  | [Matt](/user_profile?user_id=352993) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1482659#c7)• 6 years ago |
|  | |

The user crashing here <https://support.mozilla.org/en-US/questions/1236959> determined that disabling Lightning stopped the crash.
I am guessing the issue may be with playing chrome://calendar/content/sound.wav or the user chosen replacement.

|  | [Arthur K. (he/him)](/user_profile?user_id=393183) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1482659#c8)• 6 years ago |
|  | |

(In reply to Matt from [comment #7](/show_bug.cgi?id=1482659#c7 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> The user crashing here <https://support.mozilla.org/en-US/questions/1236959>
> determined that disabling Lightning stopped the crash.
>
> I am guessing the issue may be with playing
> chrome://calendar/content/sound.wav or the user chosen replacement.
@Wayne: You answered a similar question from a user in 2016 (<https://support.mozilla.org/en-US/questions/1148612>) and it turned out to be a custom sound set by a user. A user recently posted this crash on m.s.thunderbird as well (<https://crash-stats.mozilla.com/report/index/2876b771-2d99-4179-85ef-d06ff0181015>) and I pointed them to the article where the user solved their own issue by resetting to default sounds. Perhaps the type of .WAV file is bad or of a different spec? Just a hunch. Maybe the user could submit the .WAV file for comparison against the default .WAV files in TB?

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1482659#c9)• 6 years ago |
|  | |

(In reply to Arthur K. from [comment #8](/show_bug.cgi?id=1482659#c8 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> ...
> ... A user recently posted this crash on m.s.thunderbird as well
> (<https://crash-stats.mozilla.com/report/index/2876b771-2d99-4179-85ef>-
> d06ff0181015) and I pointed them to the article where the user solved their
> own issue by resetting to default sounds. Perhaps the type of .WAV file is
> bad or of a different spec? Just a hunch. Maybe the user could submit the
> .WAV file for comparison against the default .WAV files in TB?
THanks all the great details. Can you make that contact and get the user engaged here?Flags: needinfo?(thee.chicago.wolf)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1482659#c10)• 6 years ago |
|  | |

Also signature memcpy | soundInitWavHdr [bp-e0749a90-1111-4b58-9e26-5c3980181105](https://crash-stats.mozilla.org/report/index/e0749a90-1111-4b58-9e26-5c3980181105)Crash Signature: [@ soundInitWavHdr] → [@ soundInitWavHdr]
[@ memcpy | soundInitWavHdr]

|  | [Arthur K. (he/him)](/user_profile?user_id=393183) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1482659#c11)• 6 years ago |
|  | |

(In reply to Wayne Mery (:wsmwk) from [comment #9](/show_bug.cgi?id=1482659#c9 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> (In reply to Arthur K. from [comment #8](/show_bug.cgi?id=1482659#c8 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> > ...
> > ... A user recently posted this crash on m.s.thunderbird as well
> > (<https://crash-stats.mozilla.com/report/index/2876b771-2d99-4179-85ef>-
> > d06ff0181015) and I pointed them to the article where the user solved their
> > own issue by resetting to default sounds. Perhaps the type of .WAV file is
> > bad or of a different spec? Just a hunch. Maybe the user could submit the
> > .WAV file for comparison against the default .WAV files in TB?
>
> THanks all the great details. Can you make that contact and get the user
> engaged here?
Through the forums, the user reported they'd fixed their issue. I'll reach out to see if they are interested in follow up for this bug.Flags: needinfo?(thee.chicago.wolf)

|  | [Arthur K. (he/him)](/user_profile?user_id=393183) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1482659#c12)• 6 years ago |
|  | |

I can't seem to find the thread where the user was talking about his crash so I can't reach out to him.

|  | [Matt](/user_profile?user_id=352993) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1482659#c13)• 6 years ago |
|  | |

I read in the support forums that it is a known issue that Thunderbird crashes on large wav files. Is that relevant here perhaps.

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1482659#c14)• 6 years ago |
|  | |

Reporter with customized 2.5MB sound file at <https://support.mozilla.org/en-US/questions/1239797> also crashes @ soundInitWavHdr, so it is confirmed this crash and [bug 1495799](/show_bug.cgi?id=1495799 "RESOLVED FIXED - Crash in CWaveQueue::AddToTail playing custom sound when getting new mail/messages") are the same issue
<https://crash-stats.mozilla.com/report/index/71fc4311-1271-4be1-9b22-4d7bb0181107>
<https://crash-stats.mozilla.com/report/index/2c353e9d-24af-4b3f-85cc-701bf0181107>
<https://crash-stats.mozilla.com/report/index/8aeff99d-4839-4bc3-983e-96f590181107>
<https://crash-stats.mozilla.com/report/index/b1909030-e111-43bb-9527-e3ab30181107>
[status-thunderbird64](/buglist.cgi?f1=cf_status_thunderbird_64&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_thunderbird_64&o1=equals&v1=affected)Keywords: [topcrash](/buglist.cgi?keywords=topcrash&resolution=---) → [topcrash-thunderbird](/buglist.cgi?keywords=topcrash-thunderbird&resolution=---)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a7715698_29811)• 6 years ago |

See Also: [1495799](/show_bug.cgi?id=1495799 "RESOLVED FIXED - Crash in CWaveQueue::AddToTail playing custom sound when getting new mail/messages") →

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a7716206_29811)• 6 years ago |

URL: [https://support.mozilla.org/en-US/que...](https://support.mozilla.org/en-US/questions/1236833)Crash Signature: [@ soundInitWavHdr]
[@ memcpy | soundInitWavHdr] → [@ soundInitWavHdr]
[@ memcpy | soundInitWavHdr]
[@ CWaveQueue::AddToTail ]
[@ CWaveHandle::AddHeader ]Summary: startup crash in soundInitWavHdr → startup crash in soundInitWavHdr playing sound file for new mail

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1482659#c17)• 6 years ago |
|  | |

Attached audio
[Hawaii 50 2010.wav](attachment.cgi?id=9023834)
— [Details](attachment.cgi?id=9023834&action=edit)

RMS' 5mb testcase from [bug 1498494](/show_bug.cgi?id=1498494 "RESOLVED DUPLICATE - Crash when some new mail wav sound file try to play") tested in clean profile from tools > options > general > play
TB55.0b2 doesn't crash
TB56.0b1 does crash
So this should be solvable
Alice can you get a regression range from nightlyesFlags: needinfo?(alice0775)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1482659#c18)• 6 years ago |
|  | |

<https://support.mozilla.org/en-US/questions/1239732>
<https://support.mozilla.org/en-US/questions/1239829>

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1482659#c19)• 6 years ago |
|  | |

(In reply to Wayne Mery (:wsmwk) from [comment #17](/show_bug.cgi?id=1482659#c17 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> Created [attachment 9023834](/attachment.cgi?id=9023834 "Hawaii 50 2010.wav") [[details]](/attachment.cgi?id=9023834&action=edit "Hawaii 50 2010.wav")
> Hawaii 50 2010.wav
>
> RMS' 5mb testcase from [bug 1498494](/show_bug.cgi?id=1498494 "RESOLVED DUPLICATE - Crash when some new mail wav sound file try to play") tested in clean profile from tools >
> options > general > play
> TB55.0b2 doesn't crash
> TB56.0b1 does crash
>
> So this should be solvable
>
> Alice can you get a regression range from nightlyes
I think disabling(removing) the such cosmetic sub-feature is best way for maintenance purpose.
Regression window:
<https://hg.mozilla.org/comm-central/pushloghtml?fromchange=2a185ec18e89412466841a9755c49561f05bf142&tochange=6ccad3aa817af34d04fd8585ba0ce642f0b9193b>
<https://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=d50abca6521baeae8ac6b07ddf843d63a1aa5f84&tochange=8f80d594c08d5c7a112e5d4b9eb44ffca717eb7b>Flags: needinfo?(alice0775)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1482659#c20)• 6 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/676386703e2d> ?

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1482659#c21)• 6 years ago |
|  | |

Ah, I think that SND\_ASYNC causes this issue. During playing sound, data may be free. sound is play on non-main thread, we don't need SND\_ASYNC flag. UAF...
Previous fix calls ::PlaySound(nullptr, nullptr, SND\_PURGE). So it waits sound is finished.Group: core-security
[status-thunderbird60](/buglist.cgi?f1=cf_status_thunderbird_60&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_thunderbird_60&o1=equals&v1=wontfix) → ---
[status-thunderbird64](/buglist.cgi?f1=cf_status_thunderbird_64&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_thunderbird_64&o1=equals&v1=affected) → ---Component: General → Widget: Win32Product: Thunderbird → Core

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1482659#c22)• 6 years ago |
|  | |

This seems to be regression of [bug 1363163](/show_bug.cgi?id=1363163 "RESOLVED FIXED - nsSoundPlayer::SoundReleaser::Run should not add to existing jank").Assignee: nobody → m\_katoKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a7731751_8636)• 6 years ago |

Assignee: m\_kato → nobody

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1482659#c23)• 6 years ago |
|  | |

tnguyen, could you handle this since this seems to be regression by your [bug 1363163](/show_bug.cgi?id=1363163 "RESOLVED FIXED - nsSoundPlayer::SoundReleaser::Run should not add to existing jank")? I think that root cause is that you remove ::PlaySound(nullptr, nullptr, SND\_PURGE) or you set SND\_ASYNC to play sound.
Thanks, Alice-san and Wayne.Flags: needinfo?(tnguyen)

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1482659#c24)• 6 years ago |
|  | |

I can reproduce the crash on Nightly65.0a1, but not Firefox64.0b7 windows10.
Steps to reproduce:
1. set accessibility.typeaheadfind = true
2. set accessibility.typeaheadfind.soundURL = file:///C:/hogehoge/Hawaii%2050%202010.wav
3. Open web page <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions>
4. Key press ex
Actual Results:
Tab crashes, or browser crashes sometimes
Expected Results:
Not crash

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a7733249_293623)• 6 years ago |

[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected)

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1482659#c25)• 6 years ago |
|  | |

(In reply to Alice0775 White from [comment #24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> I can reproduce the crash on Nightly65.0a1, but not Firefox64.0b7 windows10.
>
> Steps to reproduce:
> 1. set accessibility.typeaheadfind = true
> 2. set accessibility.typeaheadfind.soundURL =
> file:///C:/hogehoge/Hawaii%2050%202010.wav
> 3. Open web page
> <https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions>
> 4. Key press ex
>
> Actual Results:
> Tab crashes, or browser crashes sometimes
>
> Expected Results:
> Not crash
Regression window(autoland):
<https://hg.mozilla.org/integration/autoland/pushloghtml?fromchange=2366aeabd64c6ea5c7723b8f6bbcf3d5c0c85d46&tochange=1e6c23942e9b95bb3d729e0b9f2d8fc0294c7549>
[status-firefox63](/buglist.cgi?f1=cf_status_firefox63&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=%3F)
[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=%3F)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F)

|  | [Makoto Kato [:m\_kato]](/user_profile?user_id=8636) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1482659#c26)• 6 years ago |
|  | |

After [bug 1401678](/show_bug.cgi?id=1401678 "VERIFIED FIXED - [e10s] No sound alert when using Find in page (accessibility.typeaheadfind.enablesound)"), nsISound will work well even if on content process, so it is easy to reproduce this.

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a7747212_29811)• 6 years ago |

Keywords: [reproducible](/buglist.cgi?keywords=reproducible&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)OS: Windows 10 → WindowsWhiteboard: [startupcrash] → [startupcrash][tbird topcrash]

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1482659#c27)• 6 years ago |
|  | |

Thanks for reporting this bug. I could take a look, but please wait for a while, I don't have Windows platform at the momentFlags: needinfo?(tnguyen)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a8044107_29811)• 6 years ago |

Blocks: [1363163](/show_bug.cgi?id=1363163 "RESOLVED FIXED - nsSoundPlayer::SoundReleaser::Run should not add to existing jank")Whiteboard: [startupcrash][tbird topcrash] → [startupcrash][tbird topcrash][regression: TB60]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a8052127_1689)• 6 years ago |

Group: core-security → layout-core-security

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a8103050_101158)• 6 years ago |

[tracking-thunderbird\_esr60](/buglist.cgi?f1=cf_tracking_thunderbird_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_thunderbird_esr60&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_thunderbird_esr60&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a8126401_75935)• 6 years ago |

Blocks: [1401678](/show_bug.cgi?id=1401678 "VERIFIED FIXED - [e10s] No sound alert when using Find in page (accessibility.typeaheadfind.enablesound)")
[status-firefox63](/buglist.cgi?f1=cf_status_firefox63&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=%3F) → [wontfix](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=wontfix)
[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=%3F) → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[tracking-firefox64](/buglist.cgi?f1=cf_tracking_firefox64&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox64&o1=equals&v1=%2B)
[tracking-firefox65](/buglist.cgi?f1=cf_tracking_firefox65&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [64+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=64%2B)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a8251135_29811)• 6 years ago |

Blocks: [1495799](/show_bug.cgi?id=1495799 "RESOLVED FIXED - Crash in CWaveQueue::AddToTail playing custom sound when getting new mail/messages")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1482659#c28)• 6 years ago |
|  | |

Ethan, is there someone else on your team with access to a Windows machine able to take a look at this? Would be great if we could get this fixed during this cycle still.Flags: needinfo?(ettseng)

|  | [Ethan Tseng [:ethan]](/user_profile?user_id=473897) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1482659#c29)• 6 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #28](/show_bug.cgi?id=1482659#c28 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> Ethan, is there someone else on your team with access to a Windows machine
> able to take a look at this? Would be great if we could get this fixed
> during this cycle still.
Thomas, please let me know if you have problem to debug on Windows platform.Assignee: nobody → tnguyenFlags: needinfo?(ettseng)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1482659#c30)• 6 years ago |
|  | |

I will take a look at this, I have just loaned a Windows machine and got it. Thanks for assigning that to me :)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1482659#c31)• 6 years ago |
|  | |

Finally, I had a good Windows device to debug this bug. At the first look (build with release config), I tried to remove all ::Playsound calls in
<https://searchfox.org/mozilla-central/source/widget/windows/nsSound.cpp>
including ::PlaySound(nullptr, nullptr, SND\_PURGE) and PlaySoundW with SND\_ASYNC
And it still crashes follow steps in [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"). I suspect that is not related to Playsound or we have 2 separate issue here.
I will take a closer look

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1482659#c32)• 6 years ago |
|  | |

(In reply to Thomas Nguyen from [comment #31](/show_bug.cgi?id=1482659#c31 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> Finally, I had a good Windows device to debug this bug. At the first look
> (build with release config), I tried to remove all ::Playsound calls in
> <https://searchfox.org/mozilla-central/source/widget/windows/nsSound.cpp>
>
> including ::PlaySound(nullptr, nullptr, SND\_PURGE) and PlaySoundW with
> SND\_ASYNC
> And it still crashes follow steps in [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"). I suspect that is not
> related to Playsound or we have 2 separate issue here.
> I will take a closer look
I am pretty sure the crash in steps [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") is not related to Playsound API (windows api), I followed the steps on Mac OSX and I had the same crashes.

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1482659#c33)• 6 years ago |
|  | |

(In reply to Thomas from [comment #32](/show_bug.cgi?id=1482659#c32 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))
> I am pretty sure the crash in steps [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") is not related to Playsound API (windows api),
> I followed the steps on Mac OSX and I had the same crashes.
Thomas, was that with Thunderbird?
Dossy tried "5.3 MB MP3 file and it didn't crash. This is on OSX High Sierra 10.13.6 on TB 60.3.2."Flags: needinfo?(tnguyen)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1482659#c34)• 6 years ago |
|  | |

I tried Firefox (steps [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail")).
Firefox seems to work well with that API, and the crash in [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") should be caused by another reason. Probably we have to change this bug's flag to Thunderbird only.Flags: needinfo?(tnguyen)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1482659#c35)• 6 years ago |
|  | |

But you are right, flags |= SND\_MEMORY | SND\_ASYNC seems to be a potential issue.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a9858753_280903)• 6 years ago |

[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
[64+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=64%2B) → [65+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=65%2B)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1482659#c37)• 6 years ago |
|  | |

Do we need a different set of eyes on this?

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1482659#c38)• 6 years ago |
|  | |

Attached file
[Bug 1482659 - Purge the last sound, free then start to play a sound](attachment.cgi?id=9031434)
— [Details](attachment.cgi?id=9031434&action=edit)

SND\_MEMORY | SND\_ASYNC flag could cause a very high chance of crashing.
Data may be free, but it’s entirely possible that the PlaySound API is
still using it.

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1482659#c39)• 6 years ago |
|  | |

Sorry for the delay, I could confirm SND\_MEMORY | SND\_ASYNC is our problem.
Neither of them is dangerous until we combine the two together and there's a chance of crashing due to the combination of these flags.
I removed the SND\_ASYNC and the crash is fixed in thunderbird. We don't
Hi Makoto, do you agree with the fix? The playsound API implementation is non-public and I have no idea to see what will happen with and w/o SND\_ASYNC.

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a11120608_29811)• 6 years ago |

[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: feedback?(m\_kato)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1482659#c40)• 6 years ago |
|  | |

Comment on [attachment 9031434](/attachment.cgi?id=9031434 "Bug 1482659 - Purge the last sound, free then start to play a sound") [[details]](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound")
[Bug 1482659](/show_bug.cgi?id=1482659 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") - Purge the last sound, free then start to play a sound
Apparently reviewed? (I can't see the patch in phabricator)Flags: needinfo?(tnguyen)
[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: feedback?(m\_kato)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1482659#c41)• 6 years ago |
|  | |

Yes， the patch was r+. I am trying to run several times in firefox to see if there's any problem before I could land thisFlags: needinfo?(tnguyen)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1482659#c42)• 6 years ago |
|  | |

I could not land the patch because it causes a regression. Removing SND\_ASYNC makes the function could not return immediately.
It may not block UI (running in a thread) but the sound is still playing.
Currently Playsound API implementation is limited accessed and I don't know a good idea to stop playing sound in a thread without SND\_ASYNC.
masayuki, do you have any idea?Flags: needinfo?(masayuki)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1482659#c43)• 6 years ago |
|  | |

That's weird if Firefox and Thunderbird are using the same nsISound but the crashes are only in Thunderbird.
There is no particular difference, except the call in Firefox
<https://searchfox.org/mozilla-central/rev/47edbd91c43db6229cf32d1fc4bae9b325b9e2d0/widget/windows/nsSound.cpp#226>
I will try tomorrow.

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1482659#c46)• 6 years ago |
|  | |

Ah, I see...
How about to keep grabbing nsSoundPlayer instance in the player thread even after calling Playsound with SND\_ASYNC and SND\_PURGE, and release it immediately after next call of Playsound? If it helps, you should release the last sound when the main process is being shut down for avoiding the memory leak detection.Flags: needinfo?(masayuki)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1482659#c47)• 6 years ago |
|  | |

We don't know when PlaySound API finish/stop playing, so we have to keep the sound data alive until the next sound is played. The sound data we will keep is totally useless after the sound player finishes, but I think that's what we have at the moment.
Masayuki, could you please take a look at the update?Flags: needinfo?(masayuki)

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a11388429_34283)• 6 years ago |

Flags: needinfo?(masayuki)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1482659#c48)• 6 years ago |
|  | |

(I assume NI was cancelled to avoid spammage during the holiday)Flags: needinfo?(masayuki)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1482659#c49)• 6 years ago |
|  | |

Cleared ni because working in phabricatorFlags: needinfo?(masayuki)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a12527564_406194)• 6 years ago |

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [repeli](/user_profile?user_id=629586) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1482659#c50)• 6 years ago |
|  | |

Have someone a Workaround for me, because I need my calendar items very urgent. Can I go to an older version Thunderbird/Lightning? Whne yes, which Version is working and how can I activate an older Version?
How can I export my Thunderbird data (Email, addresses, calendar items (without lightning), to switch a Microsoft Product?
Thanks for the help

|  | [Jorg K (CEST = GMT+2)](/user_profile?user_id=176914) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1482659#c51)• 6 years ago |
|  | |

You can download an older version here and disable updates.
<http://ftp.mozilla.org/pub/thunderbird/releases/52.9.1/>
You need to click through to the right platform and language.
If you disable custom sounds with TB 52, TB 60 should then work on the new profile.
Good luck with Microsoft!

|  | [repeli](/user_profile?user_id=629586) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1482659#c52)• 6 years ago |
|  | |

Super, it's work now fine with TB 60 and Lightning. So I do not need to Switch to Microsoft. Thanks

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1482659#c53)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1482659&comment_id=13848395 "2 revisions") |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

Summary : Sound data may be free, but it’s entirely possible that the PlaySound API is still using it.

Because we don't know when the PlaySound API stop/finish playing, so we should keep the sound data alive until playing the next sound

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a12948386_600971)• 6 years ago |

[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Attachment description: Bug 1482659 Remove SND\_ASYNC flag when playing sound → Bug 1482659 - Keep sound data alive until playing the next sound

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a13022982_600971)• 6 years ago |

[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Attachment description: Bug 1482659 - Keep sound data alive until playing the next sound → Bug 1482659 - Purge the last sound, free then start to play a sound

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1482659#c54)• 6 years ago |
|  | |

Comment on [attachment 9031434](/attachment.cgi?id=9031434 "Bug 1482659 - Purge the last sound, free then start to play a sound") [[details]](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound")

[Bug 1482659](/show_bug.cgi?id=1482659 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") - Purge the last sound, free then start to play a sound

[Security Approval Request]

How easily could an exploit be constructed based on the patch?: Not easy to exploit in Firefox, but easy to test in Thunderbird. Thunderbird supports playing a sound directly when user click playing (preview) sound.

Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?: No

Which older supported branches are affected by this flaw?: firefox <= 65, firefox-esr60

If not all supported branches, which bug introduced the flaw?: [Bug 1482659](/show_bug.cgi?id=1482659 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail")

Do you have backports for the affected branches?: Yes

If not, how different, hard to create, and risky will they be?:

How likely is this patch to cause regressions; how much testing does it need?: Not in Firefox. But it would be great if we could test in Thunderbird more because Thunderbird supports playing a sound directly.

[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: sec-approval?

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1482659#c55)• 6 years ago |
|  | |

Comment on [attachment 9031434](/attachment.cgi?id=9031434 "Bug 1482659 - Purge the last sound, free then start to play a sound") [[details]](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound")

[Bug 1482659](/show_bug.cgi?id=1482659 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") - Purge the last sound, free then start to play a sound

[Beta/Release Uplift Approval Request]

Feature/Bug causing the regression: [Bug 1363163](/show_bug.cgi?id=1363163 "RESOLVED FIXED - nsSoundPlayer::SoundReleaser::Run should not add to existing jank")

User impact if declined: Sometimes crash when playing sound, particularly in thunderbird

Is this code covered by automated tests?: No

Has the fix been verified in Nightly?: Yes

Needs manual test from QE?: Yes

If yes, steps to reproduce: - Go to Thunderbird Menu -> Options -> Options -> Generals

* Change the custom sound to the sound with sizes > 5 Mb.
* Play

List of other uplifts needed: None

Risk to taking this patch: Low

Why is the change risky/not risky? (and alternatives if risky): We did not change to much, just keep the sound alive longer

String changes made/needed:

[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: approval-mozilla-beta?

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1482659#c56)• 6 years ago |
|  | |

Comment on [attachment 9031434](/attachment.cgi?id=9031434 "Bug 1482659 - Purge the last sound, free then start to play a sound") [[details]](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound")

[Bug 1482659](/show_bug.cgi?id=1482659 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") - Purge the last sound, free then start to play a sound

[ESR Uplift Approval Request]

If this is not a sec:{high,crit} bug, please state case for ESR consideration:

User impact if declined: Sometimes crash when playing sound, particularly in thunderbird

Fix Landed on Version:

Risk to taking this patch: Low

Why is the change risky/not risky? (and alternatives if risky): We did not change too much, just keep the sound data alive longer

String or UUID changes made by this patch: No

[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: approval-mozilla-esr60?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1482659#c57)• 6 years ago |
|  | |

Comment on [attachment 9031434](/attachment.cgi?id=9031434 "Bug 1482659 - Purge the last sound, free then start to play a sound") [[details]](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound")

[Bug 1482659](/show_bug.cgi?id=1482659 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") - Purge the last sound, free then start to play a sound

Approvals given. Please get this checked in ASAP so it can make upcoming beta builds.

[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: sec-approval?
[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: sec-approval+
[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: approval-mozilla-esr60?
[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: approval-mozilla-esr60+
[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: approval-mozilla-beta?
[Attachment #9031434](/attachment.cgi?id=9031434&action=edit "Bug 1482659 - Purge the last sound, free then start to play a sound") -
Flags: approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1482659#c58)• 6 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/5665c5f25198>

[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected)
[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1482659#c59)• 6 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/5665c5f25198>

Group: layout-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 6 years ago
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla66

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1482659#c60)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/c4bda79261ba>

[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1482659#c61)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/7defe9bd65cd>

[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)
[status-thunderbird\_esr60](/buglist.cgi?f1=cf_status_thunderbird_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_thunderbird_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_thunderbird_esr60&o1=equals&v1=fixed)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a13179556_458186)• 6 years ago |

Flags: qe-verify+

|  | [Iulia Cristescu, QA [:JuliaC] (away, please needinfo? cornel.ionce@softvision.ro)](/user_profile?user_id=565219) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1482659#c62)• 6 years ago |
|  | |

I am not able to reproduce the initial issue on the affected Firefox builds, using the steps provided in [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"), neither on Windows 10 x64 nor on Windows 7 x86.

Alice, can you please try to confirm the fix on the targeted versions?

Flags: needinfo?(alice0775)

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1482659#c63)• 6 years ago |
|  | |

I can still crash with str [comment 24](/show_bug.cgi?id=1482659#c24 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") on Nightly66.0a1.

Crash ID [bp-2251238b-40f8-46f0-bd13-deac00190114](https://crash-stats.mozilla.org/report/index/2251238b-40f8-46f0-bd13-deac00190114)

Build ID 20190114104248

User Agent Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0

Flags: needinfo?(alice0775)

|  | [Thomas Nguyen (:tnguyen)](/user_profile?user_id=550180)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1482659#c64)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1482659&comment_id=13861021 "1 revision") |
|  | |

That is a different issue and not related to PlaySound API, library. Should be an easy fix, because it is an assertion that prevents the init from calling in content.

<https://hg.mozilla.org/mozilla-central/annotate/3dc7d345da5282969b71079d483ff8c30558819d/widget/nsSoundProxy.cpp#l45>

Could you please file another bug about that?

|  | [Alice0775 White](/user_profile?user_id=293623) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1482659#c65)• 6 years ago |
|  | |

(In reply to Thomas Nguyen from [comment #64](/show_bug.cgi?id=1482659#c64 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))

> That is a different issue and not related to PlaySound API, library. Should
>
> be an easy fix, because it is an assertion that prevents the init from
>
> calling in content.
>
> <https://hg.mozilla.org/mozilla-central/annotate/>
>
> 3dc7d345da5282969b71079d483ff8c30558819d/widget/nsSoundProxy.cpp#l45
>
> Could you please file another bug about that?

filed: [Bug 1519882](/show_bug.cgi?id=1519882 "RESOLVED WORKSFORME - Crash in nsSoundProxy::Init")

|  | [Iulia Cristescu, QA [:JuliaC] (away, please needinfo? cornel.ionce@softvision.ro)](/user_profile?user_id=565219) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1482659#c66)• 6 years ago |
|  | |

Dropping the qe+ plus flag based on the previous comments.

Flags: qe-verify+

|  | [Bogdan Maris, Desktop Test Engineering](/user_profile?user_id=458188) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a13707768_458188)• 6 years ago |

Flags: qe-verify-Whiteboard: [startupcrash][tbird topcrash][regression: TB60] → [startupcrash][tbird topcrash][regression: TB60][post-critsmash-triage]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1482659#c67)• 6 years ago |
|  | |

Wayne,

Does this reproduce in Firefox at all? It seems like, while the affecting code exists everywhere, this is a Thunderbird only issue as far as triggering. If so, I would ask TB people to write a security advisory text for it once TB ships a version with the fix but will not include it in the Firefox advisories.

Flags: needinfo?(vseerror)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)  Reporter |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1482659#c68)• 6 years ago |
|  | |

kaie, can you supply the draft CVE? ping me on irc if any questions.

Flags: needinfo?(vseerror) → needinfo?(kaie)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1482659#c69)• 6 years ago |
|  | |

Looking at the patch, I wonder if there could still be a race. Maybe I'm wrong, I've asked in phabricator to doublecheck.

Here's a potential CVE text. Please double check for correctness.

CVE-2019-NNNN:

title: Use-after-free during sound notifications

impact: critical

reporter:

description: |

crash when playing a sound notification. The memory storing the sound data was immediately freed, although the sound is still being played asynchronously, causing a use-after-free crash.

bugs:

- url: 1482659

Flags: needinfo?(kaie)

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1482659#c70)• 6 years ago |
|  | |

(In reply to Kai Engert (:kaie:) from [comment #69](/show_bug.cgi?id=1482659#c69 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))

> Looking at the patch, I wonder if there could still be a race.

After learning more about recent C++ features, I take this back. The code seems fine.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1482659#c71)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1482659&comment_id=13963791 "1 revision") |
|  | |

Kai,

I don't recall this ever showing up in an advisory for Thunderbird. Should we write one now for the issue?

Whiteboard: [startupcrash][tbird topcrash][regression: TB60][post-critsmash-triage] → [startupcrash][tbird topcrash][regression: TB60][post-critsmash-triage][adv-esr60.5+]

|  | [Kai Engert [:KaiE:]](/user_profile?user_id=36541) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1482659#c72)• 6 years ago |
|  | |

(In reply to Al Billings [:abillings] from [comment #71](/show_bug.cgi?id=1482659#c71 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail"))

> I don't recall this ever showing up in an advisory for Thunderbird. Should we write one now for the issue?

Al, yes, I think we're ready to do so. [Comment 69](/show_bug.cgi?id=1482659#c69 "RESOLVED FIXED - startup crash in soundInitWavHdr playing sound file for new mail") has draft CVE text.

Based on the commit from Jan 10, it should have been fixed starting with TB 60.5.0 released Jan 29.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a17906767_280903)• 6 years ago |

Alias: CVE-2018-18512

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1482659#a31209945_1689)• 5 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1482659&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Wayne Mery (:wsmwk)](/user_profile?user_id=29811)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


